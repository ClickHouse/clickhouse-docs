# Generating documentation from source code

A [script in our docs repo](https://github.com/ClickHouse/clickhouse-docs/blob/main/scripts/settings/autogenerate-settings.sh) 
is used to run SQL queries which generate markdown documentation from the system tables in ClickHouse and insert it 
into the appropriate pages before build time of the docs.

## Session settings

Documentation for session settings is autogenerated from source file [`src/Core/Settings.cpp`](https://github.com/ClickHouse/ClickHouse/blob/master/src/Core/Settings.cpp).
[SQL](../scripts/settings/session-settings.sql)

## Format settings

Documentation for session settings is autogenerated from source file [`src/Core/FormatFactorySettings.h`](https://github.com/ClickHouse/ClickHouse/blob/master/src/Core/FormatFactorySettings.h).
[SQL](../scripts/settings/format-settings.sql)

## Server settings

Documentation for session settings are extracted from [`src/Core/ServerSettings.cpp`](https://github.com/ClickHouse/ClickHouse/blob/master/src/Core/ServerSettings.cpp).

Note that this file contains only a fraction of all server settings. 
The reason is that server settings can be nested and `system.server_settings` 
(which is built from `src/Core/ServerSettings.cpp`) and cannot represent nested
settings.

Example:

```yaml
<query_cache>
    <max_size_in_bytes>1073741824</max_size_in_bytes>
    <max_entries>1024</max_entries>
    <max_entry_size_in_bytes>1048576</max_entry_size_in_bytes>
    <max_entry_size_in_rows>30000000</max_entry_size_in_rows>
</query_cache>
```
As a result of the above, you will find the server settings which are not found 
in `system.server_settings` documented in file `_server_settings_outside_source.md`

The auto-generation script reads these in, combines them with the ones from 
`system.settings` and appends the formatted settings to `settings.md`.

**As such, if you need to make a change to the settings you see on the 
[server settings](clickhouse.com/docs/operations/server-configuration-parameters/) 
page, you will need to check if the setting is in `system.server_settings`. 
If it is, then please edit the setting description in the source code documentation
in [`ServerSettings.cpp`](https://github.com/ClickHouse/ClickHouse/blob/master/src/Core/ServerSettings.cpp) 
or else edit `_server_settings_outside_source.md`.**

[SQL](../scripts/settings/global-server-settings.sql)

## MergeTree settings

Documentation for MergeTree settings is autogenerated from [MergeTreeSettings.cpp](https://github.com/ClickHouse/ClickHouse/blob/master/src/Storages/MergeTree/MergeTreeSettings.cpp)

[SQL](../scripts/settings/mergetree-settings.sql)

## System tables

TO DO

## Functions

Documentation for functions is autogenerated from the documentation in system tables (`system.functions`) which is 
registered along with the function registration in the C++ code. ([Example](https://github.com/ClickHouse/ClickHouse/blob/a0216c8120f00479f50237e41c897c2bf244e1ef/src/Functions/FunctionChar.cpp#L116-L158))

This [script](https://github.com/ClickHouse/clickhouse-docs/blob/main/scripts/settings/autogenerate-settings.sh) is used to generate
the markdown docs for functions.

Adding a new page can be done by:

1. Adding the function [category](https://github.com/ClickHouse/ClickHouse/blob/85700c135ccad89d3651a7a92ca63bb989743ba6/src/Common/FunctionDocumentation.cpp#L222-L273) to the [list of function categories to generate](https://github.com/ClickHouse/clickhouse-docs/blob/c31d64bc5d71c6c3afc5b520dbb73386e303447b/scripts/settings/autogenerate-settings.sh#L253-L278).
2. The docs are automatically generated for the categories defined above by [this SQL code](https://github.com/ClickHouse/clickhouse-docs/blob/main/scripts/settings/generate-functions.sql). It produces a temporary markdown file with convention: `category-functions.md`. If the category name contains spaces, e.g. "String Splitting" then the temporary file will be `string_splitting-functions.md`.
3. Register the temporary file name [here](https://github.com/ClickHouse/clickhouse-docs/blob/c31d64bc5d71c6c3afc5b520dbb73386e303447b/scripts/settings/autogenerate-settings.sh#L372)
4. Register the destination file you want to insert the markdown into [here](https://github.com/ClickHouse/clickhouse-docs/blob/c31d64bc5d71c6c3afc5b520dbb73386e303447b/scripts/settings/autogenerate-settings.sh#L399)

The script takes the content of the temporary markdown file and inserts it into the destination file between tags `<!--AUTOGENERATED_START-->` and `<!--AUTOGENERATED_END-->`. If those tags do not exist you will get a warning.
