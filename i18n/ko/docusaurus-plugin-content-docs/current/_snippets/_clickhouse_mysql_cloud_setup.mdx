import mysql_1 from '@site/static/images/_snippets/mysql1.png';
import mysql_2 from '@site/static/images/_snippets/mysql2.png';
import mysql_3 from '@site/static/images/_snippets/mysql3.png';
import mysql_4 from '@site/static/images/_snippets/mysql4.png';
import mysql_5 from '@site/static/images/_snippets/mysql5.png';
import Image from '@theme/IdealImage';
import {VerticalStepper} from "@clickhouse/click-ui/bundled";

<VerticalStepper headerLevel="h4">
  #### `Connect your app` 선택 \{#select-connect-your-app\}

  ClickHouse Cloud Service를 생성한 후 `Connect your app` 화면에서 드롭다운 목록에서 MySQL을 선택합니다.

  <Image size="lg" img={mysql_1} alt="MySQL 인터페이스 선택 드롭다운을 보여주는 ClickHouse Cloud 자격 증명 화면" border />

  #### MySQL 인터페이스 활성화 \{#enable-mysql-interface\}

  이 서비스에 대해 MySQL 인터페이스를 활성화하도록 스위치를 켭니다.
  그러면 이 서비스에 대해 포트 `3306`이 열리고, 고유한 MySQL 사용자 이름이 포함된 MySQL 연결 화면이 표시됩니다.

  <Image size="lg" img={mysql_2} alt="MySQL 인터페이스 활성화 토글과 연결 세부 정보를 보여주는 ClickHouse Cloud MySQL 인터페이스 화면" border />

  또는, 기존 서비스에 대해 MySQL 인터페이스를 활성화하려면 다음을 수행합니다.

  #### `Connect` 선택 \{#select-connect\}

  서비스가 `Running` 상태인지 확인한 다음 MySQL 인터페이스를 활성화하려는 서비스를 클릭합니다.
  왼쪽 메뉴에서 &quot;Connect&quot;를 선택합니다.

  <Image size="lg" img={mysql_3} alt="Connect 옵션이 강조 표시된 ClickHouse Cloud 서비스 연결 화면" border />

  #### `MySQL` 선택 \{#choose-mysql\}

  `Connect With` 드롭다운에서 `MySQL`을 선택합니다.

  <Image size="md" img={mysql_4} alt="MySQL 옵션 선택을 보여주는 ClickHouse Cloud 연결 화면" border />

  #### MySQL 인터페이스 활성화 \{#enable-mysql-interface\}

  이 서비스에 대해 MySQL 인터페이스를 활성화하도록 스위치를 켭니다.
  그러면 이 서비스에 대해 포트 `3306`이 열리고, 고유한 MySQL 사용자 이름이 포함된 MySQL 연결 화면이 표시됩니다.
</VerticalStepper>

<Image size="md" img={mysql_5} alt="MySQL 인터페이스가 활성화된 상태에서 연결 세부 정보를 보여주는 ClickHouse Cloud 연결 화면" border />

## ClickHouse Cloud에서 readonly MySQL 사용자 생성 \{#creating-multiple-mysql-users-in-clickhouse-cloud\}

ClickHouse Cloud는 기본 사용자와 동일한 비밀번호를 사용하는 `mysql4<subdomain>` 사용자를 자동으로 생성합니다.
`<subdomain>` 부분은 ClickHouse Cloud 호스트 이름의 첫 번째 부분에 해당합니다.

이 사용자 이름 형식은 보안 연결을 설정하지만 TLS 핸드셰이크에 [SNI (Server Name Indication)](https://www.cloudflare.com/learning/ssl/what-is-sni) 데이터를 포함하지 않는 도구와의 호환성을 위해 필요합니다.
SNI 정보가 없으면 시스템은 올바른 내부 라우팅을 수행할 수 없으므로, 사용자 이름에 포함된 `<subdomain>` 힌트가 필요한 라우팅 정보를 제공합니다.
MySQL 콘솔 클라이언트가 이러한 특성을 갖는 도구의 한 예입니다.

:::tip
권장 모범 사례는 새로운 readonly MySQL 사용자를 생성하는 것입니다.
:::

:::note
`foobar.us-east1.aws.clickhouse.cloud`와 같은 ClickHouse Cloud 호스트 이름의 경우 `<subdomain>` 부분은 `foobar`가 되며, 사용자 정의 MySQL 사용자 이름은 `mysql4foobar_team1`처럼 지정할 수 있습니다.
:::

<VerticalStepper headerLevel="h4">
  #### readonly settings profile 생성 \{#create-a-custom-settings-user\}

  readonly 사용자에 적용할 [settings profile](/sql-reference/statements/create/settings-profile)을 생성하고,
  `readonly` 설정을 `1`로 지정합니다:

  ```sql
  CREATE SETTINGS PROFILE readonly_profile SETTINGS readonly = 1
  ```

  #### 새로운 readonly MySQL 사용자 생성 \{#create-a-readonly-mysql-user\}

  다음 형식을 따르는 이름으로 [사용자를 생성](/sql-reference/statements/create/user)합니다:

  ```sql
  mysql4<subdomain>_<username>
  ```

  새 사용자에 `readonly_profile`을 적용하고 비밀번호가 double SHA1 형식인지 확인합니다. 예시는 다음과 같습니다:

  ```sql
  CREATE USER mysql4foobar_readonly
  IDENTIFIED WITH double_sha1_password BY 'YourPassword42$'
  SETTINGS PROFILE 'readonly_profile';
  ```

  #### 새 사용자에게 원하는 테이블에 접근할 수 있는 권한 부여 \{#grant-the-new-user-the-necessary-permissions\}

  새 사용자가 원하는 테이블이나 데이터베이스와 상호 작용할 수 있도록 필요한 권한을 [부여](/sql-reference/statements/grant)합니다.
  예를 들어, `system.query_log`에만 접근 권한을 부여하려는 경우:

  ```sql
  GRANT SELECT ON system.query_log TO mysql4foobar_readonly;
  ```

  :::note
  readonly 사용자에 대해서는 접근을 허용하려는 테이블에만 `SELECT` 권한을 부여해야 합니다.
  :::

  새로 생성한 사용자는 MySQL 인터페이스를 사용하여 ClickHouse Cloud 서비스에 연결하는 데 사용할 수 있습니다.
</VerticalStepper>

### ClickHouse Cloud에서 여러 MySQL 사용자 문제 해결 \{#troubleshooting-multiple-mysql-users-in-clickhouse-cloud\}

새 MySQL 사용자를 생성한 후 MySQL CLI 클라이언트로 접속할 때 다음과 같은 오류가 표시되는 경우:

```
ERROR 2013 (HY000): Lost connection to MySQL server at 'reading authorization packet', system error: 54
```

이 경우, 사용자 이름이 ([위](#creating-multiple-mysql-users-in-clickhouse-cloud))에서 설명한 것처럼 `mysql4<subdomain>_<username>` 형식을 따르는지 확인하십시오.
