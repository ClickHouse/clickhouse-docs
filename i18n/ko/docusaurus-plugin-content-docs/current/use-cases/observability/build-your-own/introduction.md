---
'title': '소개'
'description': 'ClickHouse를 관측 가능성 솔루션으로 사용하기'
'slug': '/use-cases/observability/introduction'
'keywords':
- 'observability'
- 'logs'
- 'traces'
- 'metrics'
- 'OpenTelemetry'
- 'Grafana'
- 'OTel'
'show_related_blogs': true
'doc_type': 'guide'
---

import observability_1 from '@site/static/images/use-cases/observability/observability-1.png';
import observability_2 from '@site/static/images/use-cases/observability/observability-2.png';
import Image from '@theme/IdealImage';


# ClickHouse를 사용한 가시성

## 소개 {#introduction}

이 가이드는 ClickHouse를 사용하여 SQL 기반의 가시성 솔루션을 구축하려는 사용자들을 위해 설계되었습니다. 이는 로그와 추적에 중점을 두고 있으며, 데이터 수집, 액세스 패턴에 맞춘 스키마 최적화 및 비구조 로그에서 구조를 추출하는 등의 솔루션 구축의 모든 측면을 다룹니다.

ClickHouse는 가시성을 위한 즉시 사용 가능한 솔루션이 아닙니다. 그러나 이는 가시성 데이터를 저장하기 위한 매우 효율적인 스토리지 엔진으로 사용할 수 있으며, 이는 비할 데 없는 압축율과 번개처럼 빠른 쿼리 응답 시간을 제공합니다. 사용자가 가시성 솔루션 내에서 ClickHouse를 사용하기 위해서는 사용자 인터페이스와 데이터 수집 프레임워크가 모두 필요합니다. 현재는 가시성 신호의 시각화를 위해 **Grafana**를 사용하고, 데이터 수집을 위해 **OpenTelemetry**를 추천합니다(두 통합 모두 공식적으로 지원됩니다).

<Image img={observability_1} alt="Simple OTel" size="md"/>

<br />

:::note OpenTelemetry만이 아님
OpenTelemetry(OTel) 프로젝트를 데이터 수집에 사용하는 것을 권장하지만, Vector와 Fluentd와 같은 다른 프레임워크와 도구를 사용하여 유사한 아키텍처를 생성할 수도 있습니다(예: [Fluent Bit를 사용하는 예](https://clickhouse.com/blog/kubernetes-logs-to-clickhouse-fluent-bit)). Superset 및 Metabase와 같은 대체 시각화 도구도 존재합니다.
:::

## ClickHouse를 사용하는 이유는? {#why-use-clickhouse}

모든 중앙 집중식 가시성 저장소의 가장 중요한 기능은 다양한 소스에서 발생하는 방대한 양의 로그 데이터를 신속하게 집계, 분석 및 검색하는 능력입니다. 이러한 중앙 집중화는 문제 해결을 간소화하여 서비스 중단의 근본 원인을 쉽게 파악할 수 있도록 도와줍니다.

사용자들이 점점 더 가격에 민감해지고 있으며, 기존의 즉시 사용 가능한 솔루션의 비용이 그들이 제공하는 가치에 비해 높고 예측할 수 없음을 발견하고 있습니다. 따라서 쿼리 성능이 허용 가능한 비용 효율적이고 예측 가능한 로그 스토리지가 더 이상 중요해졌습니다.

ClickHouse는 성능과 비용 효율성 덕분에 가시성 제품에서 로깅 및 추적 스토리지 엔진의 사실상 표준이 되었습니다.

특히 ClickHouse가 가시성 데이터 저장에 이상적인 이유는 다음과 같습니다:

- **압축** - 가시성 데이터는 일반적으로 HTTP 코드나 서비스 이름과 같은 고유한 집합에서 값을 가져오는 필드를 포함합니다. ClickHouse의 컬럼 지향 저장소는 값이 정렬되어 저장되므로 이 데이터를 매우 효과적으로 압축할 수 있습니다. 특히 시간 시리즈 데이터에 대한 다양한 전문 코덱과 결합할 때 더욱 그렇습니다. 다른 데이터 저장소와 달리 ClickHouse는 로그 및 추적 데이터를 평균적으로 최대 14배 압축할 수 있습니다. 대규모 가시성 설치의 경우 이러한 압축은 상당한 스토리지 절약을 제공하고, 디스크에서 읽어야 할 데이터가 줄어들어 쿼리를 가속화하는 데 도움을 줍니다.
- **빠른 집계** - 가시성 솔루션은 일반적으로 오류율을 보여주는 선 그래프나 트래픽 소스를 보여주는 막대 그래프와 같은 데이터 시각화에 크게 의존합니다. 집계 또는 GROUP BY는 이러한 차트를 구동하는 데 필수적이며, 이는 문제 진단을 위한 워크플로에서 필터를 적용할 때 빠르고 반응해야 합니다. ClickHouse의 컬럼 지향 형식은 벡터화된 쿼리 실행 엔진과 결합되어 빠른 집계를 가능하게 하며, 스파스 인덱스는 사용자의 행동에 대한 신속한 데이터 필터링을 허용합니다.
- **빠른 선형 스캔** - 대체 기술은 로그를 빠르게 쿼리하기 위해 역 인덱스에 의존하지만, 이는 항상 높은 디스크 및 자원 사용으로 이어집니다. ClickHouse는 추가적인 선택적 인덱스 유형으로 역 인덱스를 제공하지만, 선형 스캔은 매우 병렬화되어 있으며 머신의 모든 가용 코어를 사용합니다(다르게 설정하지 않는 한). 이는 높은 최적화된 텍스트 일치 연산자와 함께 (압축된 상태로) 초당 10GB 이상을 스캔할 수 있는 가능성을 제공합니다. [고도로 최적화된 텍스트 일치 연산자](/sql-reference/functions/string-search-functions).
- **SQL의 친숙함** - SQL은 모든 엔지니어가 친숙한 보편적인 언어입니다. 50년 이상의 개발을 통해 데이터 분석을 위한 사실상 표준 언어로 입증되었으며, 여전히 [3번째로 인기 있는 프로그래밍 언어](https://clickhouse.com/blog/the-state-of-sql-based-observability#lingua-franca)입니다. 가시성은 SQL이 이상적인 또 다른 데이터 문제입니다.
- **분석 함수** - ClickHouse는 SQL 쿼리를 더 쉽고 간단하게 작성할 수 있도록 설계된 분석 기능을 통해 ANSI SQL을 확장합니다. 이는 데이터 잘라내기 및 다지기에 필요한 근본 원인 분석을 수행하는 사용자에게 필수적입니다.
- **보조 인덱스** - ClickHouse는 특정 쿼리 프로필을 가속화하기 위해 블룸 필터와 같은 보조 인덱스를 지원합니다. 이러한 인덱스는 선택적으로 컬럼 수준에서 활성화할 수 있어 사용자에게 세부적인 제어를 제공하고 비용-성능 이점을 평가할 수 있습니다.
- **오픈 소스 및 오픈 표준** - 오픈 소스 데이터베이스인 ClickHouse는 OpenTelemetry와 같은 오픈 표준을 수용합니다. 프로젝트에 기여하고 적극적으로 참여할 수 있는 능력은 매력적이며, 공급업체 종속성의 문제를 피할 수 있습니다.

## 가시성을 위한 ClickHouse 사용 시기 {#when-should-you-use-clickhouse-for-observability}

ClickHouse를 가시성 데이터에 사용하려면 사용자가 SQL 기반의 가시성을 수용해야 합니다. SQL 기반의 가시성 역사에 대한 [이 블로그 글](https://clickhouse.com/blog/the-state-of-sql-based-observability)를 추천하지만, 요약하자면:

SQL 기반의 가시성이 적합하다면:

- 당신 또는 당신의 팀이 SQL에 익숙하거나 배우고 싶어 하는 경우
- 잠금 방지 및 확장을 달성하기 위해 OpenTelemetry와 같은 개방형 표준을 준수하는 것을 선호하는 경우
- 수집에서 저장 및 시각화에 이르는 오픈 소스 혁신에 의해 구동되는 생태계를 운영할 의향이 있는 경우
- 관리하는 가시성 데이터의 중간 또는 대량 성장 가능성을 염두에 두고 있는 경우(심지어 매우 큰 양도 포함)
- TCO(총 소유 비용)를 통제하고 가시성 비용이 급증하는 것을 피하고 싶어 하는 경우
- 비용 관리를 위해 가시성 데이터의 짧은 데이터 보존 기간에 갇히고 싶지 않거나 이는 원하지 않는 경우

다음과 같은 경우 SQL 기반의 가시성이 적합하지 않을 수 있습니다:

- SQL을 배우거나 생성하는 것이 당신이나 당신의 팀에게 매력적이지 않은 경우
- 패키지화된 엔드 투 엔드 가시성 경험을 찾고 있는 경우
- 가시성 데이터의 양이 너무 작아(예: &lt;150 GiB) 확실한 차이를 만들 수 없고 성장할 것으로 예상되지 않는 경우
- 사용 사례가 메트릭 중심이며 PromQL이 필요한 경우. 이 경우, 여전히 ClickHouse를 로그 및 추적에 사용하면서 Prometheus를 메트릭에 사용할 수 있으며, Grafana에서 프레젠테이션 레이어에서 통합할 수 있습니다.
- 생태계가 더 성숙해지고 SQL 기반의 가시성이 더 즉시 사용 가능해질 때까지 기다리는 것이 선호되는 경우

## 로그 및 추적 {#logs-and-traces}

가시성 사용 사례에는 세 가지 뚜렷한 기둥이 있습니다: 로그, 추적 및 메트릭. 각 기둥은 고유의 데이터 유형과 액세스 패턴이 있습니다.

현재 ClickHouse를 사용하여 두 가지 유형의 가시성 데이터를 저장하는 것을 추천합니다:

- **로그** - 로그는 시스템 내에서 발생하는 이벤트의 타임스탬프가 있는 기록으로, 소프트웨어 운영의 다양한 측면에 대한 세부 정보를 캡처합니다. 로그의 데이터는 일반적으로 비구조적이거나 반구조적이며 오류 메시지, 사용자 활동 로그, 시스템 변경 및 기타 이벤트를 포함할 수 있습니다. 로그는 문제 해결, 이상 탐지 및 시스템 내 문제로 이어진 특정 이벤트를 이해하는 데 매우 중요합니다.

```response
54.36.149.41 - - [22/Jan/2019:03:56:14 +0330] "GET
/filter/27|13%20%D9%85%DA%AF%D8%A7%D9%BE%DB%8C%DA%A9%D8%B3%D9%84,27|%DA%A9%D9%85%D8%AA%D8%B1%20%D8%A7%D8%B2%205%20%D9%85%DA%AF%D8%A7%D9%BE%DB%8C%DA%A9%D8%B3%D9%84,p53 HTTP/1.1" 200 30577 "-" "Mozilla/5.0 (compatible; AhrefsBot/6.1; +http://ahrefs.com/robot/)" "-"
```

- **추적** - 추적은 분산 시스템 내에서 다양한 서비스를 통과하는 요청의 여정을 캡처하여 이러한 요청의 경로와 성능을 세부적으로 설명합니다. 추적의 데이터는 매우 구조화되어 있으며, 요청이 수행하는 각 단계를 매핑하는 스팬 및 추적으로 구성됩니다. 추적은 시스템 성능에 대한 귀중한 통찰력을 제공하며, 병목 현상, 지연 문제를 식별하고 마이크로서비스의 효율성을 최적화하는 데 도움을 줍니다.

:::note 메트릭
ClickHouse를 사용하여 메트릭 데이터를 저장할 수 있지만, 이 기둥은 ClickHouse에서 성숙하지 않아 Prometheus 데이터 형식 및 PromQL과 같은 기능에 대한 지원이 pending입니다.
:::

### 분산 추적 {#distributed-tracing}

분산 추적은 가시성의 중요한 기능입니다. 분산 추적은 간단히 추적으로 불리며, 시스템 내에서 요청의 여정을 매핑합니다. 요청은 최종 사용자나 애플리케이션에서 시작되며 시스템 전반에 확산되어 마이크로서비스 간의 작업 흐름을 생성합니다. 이 순서를 기록하고 Subsequent events가 상관관계가 있도록 허용함으로써 가시성 사용자 또는 SRE는 복잡하거나 서버리스인 아키텍처와 관계없이 애플리케이션 흐름에서 문제를 진단할 수 있습니다.

각 추적은 여러 스팬으로 구성되며, 요청과 관련된 초기 스팬을 루트 스팬이라고 합니다. 이 루트 스팬은 시작부터 끝까지 전체 요청을 캡처합니다. 루트 아래의 Subsequent spans는 요청 중에 발생하는 다양한 단계 또는 작업에 대한 세부적인 통찰력을 제공합니다. 추적이 없으면 분산 시스템에서 성능 문제를 진단하는 것이 매우 어려울 수 있습니다. 추적은 요청이 시스템을 이동하는 동안의 이벤트 순서를 구체적으로 설명하여 분산 시스템에서 디버깅하고 이해하는 과정을 용이하게 합니다.

대부분의 가시성 공급업체는 이 정보를 폭포로 시각화하며, 상대적인 타이밍은 비례 크기의 수평 막대를 사용하여 표시됩니다. 예를 들어, Grafana에서:

<Image img={observability_2} alt="Example trace" size="lg" border/>

로그 및 추적 개념에 깊이 익숙해져야 하는 사용자에게는 [OpenTelemetry 문서](https://opentelemetry.io/docs/concepts/)를 강력히 추천합니다.
