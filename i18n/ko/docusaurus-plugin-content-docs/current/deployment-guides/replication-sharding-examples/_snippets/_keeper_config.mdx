ClickHouse 복제를 작동시키기 위해서는 ClickHouse Keeper 클러스터를 설정하고 구성해야 합니다. ClickHouse Keeper는 데이터 복제를 위한 조정 시스템을 제공하며, 또한 사용할 수 있는 Zookeeper의 대체 역할을 합니다. 그러나 ClickHouse Keeper를 사용하는 것이 권장되는데, 이는 더 나은 보증과 신뢰성을 제공하며 ZooKeeper보다 적은 자원을 사용하기 때문입니다. 고가용성을 위해서는 최소한 세 개의 ClickHouse Keeper 노드를 실행하는 것이 권장됩니다.

:::note
ClickHouse Keeper는 ClickHouse와 함께 클러스터의 어떤 노드에서도 실행될 수 있지만, 데이터베이스 클러스터와 독립적으로 ClickHouse Keeper 클러스터를 스케일링하고 관리할 수 있도록 전용 노드에서 실행하는 것이 권장됩니다.
:::

다음 명령어를 사용하여 각 ClickHouse Keeper 노드에 대한 `keeper_config.xml` 파일을 생성합니다. 명령어는 예제 폴더의 루트에서 실행해야 합니다:

```bash
for i in {01..03}; do
  touch fs/volumes/clickhouse-keeper-${i}/etc/clickhouse-keeper/keeper_config.xml
done
```

각 노드 디렉터리 `fs/volumes/clickhouse-keeper-{}/etc/clickhouse-keeper`에 생성된 빈 구성 파일을 수정합니다. 아래 강조된 줄은 각 노드에 맞게 변경해야 합니다:

```xml title="/clickhouse-keeper/keeper_config.xml"
<clickhouse replace="true">
    <logger>
        <level>information</level>
        <log>/var/log/clickhouse-keeper/clickhouse-keeper.log</log>
        <errorlog>/var/log/clickhouse-keeper/clickhouse-keeper.err.log</errorlog>
        <size>1000M</size>
        <count>3</count>
    </logger>
    <listen_host>0.0.0.0</listen_host>
    <keeper_server>
        <tcp_port>9181</tcp_port>
        <!--highlight-next-line-->
        <server_id>1</server_id>
        <log_storage_path>/var/lib/clickhouse/coordination/log</log_storage_path>
        <snapshot_storage_path>/var/lib/clickhouse/coordination/snapshots</snapshot_storage_path>
        <coordination_settings>
            <operation_timeout_ms>10000</operation_timeout_ms>
            <session_timeout_ms>30000</session_timeout_ms>
            <raft_logs_level>information</raft_logs_level>
        </coordination_settings>
        <raft_configuration>
            <server>
                <id>1</id>
                <hostname>clickhouse-keeper-01</hostname>
                <port>9234</port>
            </server>
            <server>
                <id>2</id>
                <hostname>clickhouse-keeper-02</hostname>
                <port>9234</port>
            </server>
            <server>
                <id>3</id>
                <hostname>clickhouse-keeper-03</hostname>
                <port>9234</port>
            </server>
        </raft_configuration>
    </keeper_server>
</clickhouse>
```
