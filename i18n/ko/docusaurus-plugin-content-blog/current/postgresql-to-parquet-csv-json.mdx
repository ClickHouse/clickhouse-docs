---
title: "PostgreSQL 데이터를 Parquet, CSV 또는 JSON으로 내보내는 방법"
date: 2023-03-22
description: "다양한 예제를 통해 `clickhouse-local`을 사용하여 PostgreSQL 데이터를 Parquet, CSV 또는 JSON 형식으로 내보내는 방법을 알아봅니다."
tags: ['데이터 내보내기', '데이터 형식']
keywords: ['PostgreSQL', 'Parquet', 'CSV', 'JSON']
---

{frontMatter.description}

{{/* 생략 */}}

## PostgreSQL 데이터를 Parquet, CSV 또는 JSON으로 내보내는 방법 \{#how-to-export-postgresql-data-to-parquet-csv-or-json\}

`clickhouse-local`을 사용하면 간단하게 처리할 수 있습니다:

* 데이터를 읽기 위해 [`postgresql` 테이블 함수](https://clickhouse.com/docs/sql-reference/table-functions/postgresql)를 사용합니다.
* `INTO OUTFILE _filename_ FORMAT` 절을 사용하고 원하는 출력 형식을 지정합니다.

출력 형식은 ClickHouse에서 지원하는 [출력 형식](https://clickhouse.com/docs/interfaces/formats) 중 하나가 될 수 있습니다. 몇 가지 예제를 살펴보겠습니다...

이 예제들은 ClickHouse 바이너리에 포함된 `clickhouse-local`을 사용합니다. 다음 명령으로 다운로드합니다:

```bash
curl https://clickhouse.com/ | sh
```

## PostgreSQL를 Parquet으로 내보내기 \{#export-postgresql-to-parquet\}

`postgresql` 테이블 함수는 원격 PostgreSQL 서버에 저장된 데이터에 대해 `SELECT`(및 `INSERT`) 쿼리를 실행할 수 있게 해줍니다. 예를 들어, PostgreSQL에서 테이블의 전체 내용을 조회하려면 다음과 같이 할 수 있습니다:

```bash
SELECT *
FROM
   postgresql(
    'localhost:5432',
    'postgres_database',
    'postgres_table',
    'user',
    'password'
);
```

`INTO OUTFILE`을 사용하여 이 쿼리의 출력을 파일로 전달할 수 있습니다. 생성할 파일의 형식은 `FORMAT`으로 지정합니다. 이제 PostgreSQL 테이블의 전체 내용을 가져와 Parquet 파일로 내보내 보겠습니다.

```bash
./clickhouse local -q "SELECT * FROM
   postgresql(
    'localhost:5432',
    'postgres_database',
    'postgres_table',
    'user',
    'password'
)
INTO OUTFILE 'my_output_file.parquet'"
```

:::note
출력 파일 이름에 `.parquet` 확장자가 있으므로 ClickHouse는 Parquet 형식을 사용하려는 것으로 간주합니다. 따라서 `FORMAT Parquet` 절을 생략했습니다.
:::

## PostgreSQL을 CSV로 내보내기 \{#export-postgresql-to-csv\}

출력에 더 적절한 파일 이름을 지정한다는 점만 제외하면 Parquet과 동일합니다.

```bash
./clickhouse local -q "SELECT * FROM
   postgresql(
    'localhost:5432',
    'postgres_database',
    'postgres_table',
    'user',
    'password'
)
INTO OUTFILE 'my_output_file.csv'"
```

이것으로 완료되었습니다! ClickHouse는 출력 파일 이름의 `.csv` 확장자를 인식하고 데이터를 쉼표로 구분된 형식으로 출력합니다. 나머지는 위에서 사용한 명령과 완전히 동일합니다.

## PostgreSQL를 JSON으로 내보내기 \{#export-postgresql-to-json\}

PostgreSQL에서 JSON으로 내보내려면 파일 이름만 바꾸면 되며, ClickHouse가 형식을 자동으로 인식합니다.

```bash
./clickhouse local -q "SELECT * FROM
   postgresql(
    'localhost:5432',
    'postgres_database',
    'postgres_table',
    'user',
    'password'
)
INTO OUTFILE 'my_output_file.ndjson'"
```

:::note
여기에서 그칠 필요는 없습니다. `clickhouse-local`을 사용하여 PostgreSQL에서 데이터를 가져와 [모든 종류의 출력 형식](https://clickhouse.com/docs/sql-reference/formats/)으로 전송할 수 있습니다.

ClickHouse가 파일 이름 확장자만으로 출력 형식을 결정하지 못하거나, 출력 형식을 명시적으로 지정하려는 경우 `FOMRAT` 절을 추가하십시오:

```bash
./clickhouse local -q "SELECT * FROM
   postgresql(
    'localhost:5432',
    'postgres_database',
    'postgres_table',
    'user',
    'password'
)
INTO OUTFILE 'my_output_file.ndjson'
FORMAT JSONEachRow"
```

:::

## PostgreSQL를 다른 프로세스로 스트리밍하기 \{#stream-postgresql-to-another-process\}

`INTO OUTFILE`을 사용하는 대신 테이블 함수의 결과를 다른 프로세스로 스트리밍할 수 있습니다. 다음은 이 구문을 보여 주기 위한 간단한 예시로, Linux `wc -l` 명령을 사용하여 행 수를 세는 방법입니다:

```bash
./clickhouse local -q "SELECT *
FROM s3('https://datasets-documentation.s3.eu-west-3.amazonaws.com/house_parquet/house_0.parquet'
FORMAT JSONEachRow
)" | wc -l
```

또한 행을 셸 스크립트, Python 스크립트, 또는 원하는 다른 프로세스로도 손쉽게 스트리밍할 수 있습니다.
