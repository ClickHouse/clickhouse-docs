---
title: ClickPipes에서 프라이빗 RDS에 액세스하기 위한 AWS PrivateLink 설정
description: AWS PrivateLink를 통해 프라이빗 RDS를 ClickPipes에서 액세스할 수 있도록 설정하는 단계입니다.
date: 2024-11-27
tags: ['보안 및 인증', 'Cloud 관리']
keywords: ['AWS PrivateLink', '프라이빗 RDS', 'ClickPipes']
---

{frontMatter.description}

{/* 생략 */}

## ClickPipes에서 프라이빗 RDS를 노출하기 위한 AWS PrivateLink 설정 \{#aws-privatelink-setup-to-expose-private-rds-for-clickpipes\}

AWS PrivateLink을 통해 프라이빗 RDS를 ClickPipes에 노출하는 설정 단계이며, 리전 간(Cross-Region) 액세스도 지원합니다.

:::info
이는 AWS Endpoint Service를 사용하며 주로 리전 간(Cross-Region) 액세스에 적합합니다. 동일 리전 내 액세스가 필요한 경우
[대신 VPC 리소스 생성](/integrations/clickpipes/aws-privatelink#vpc-resource)을
권장합니다.
:::

## Private link 생성 \{#private-link-creation\}

RDS 인스턴스에 대한 **VPC endpoint service**를 생성하려면 다음 단계를 따르십시오. Endpoint service가 필요한 RDS 인스턴스가 여러 개이거나 인스턴스별로 서로 다른 listener 포트를 사용하는 경우, 아래 단계를 반복합니다.

1. VPC 찾기 및 [NLB 생성](https://docs.aws.amazon.com/elasticloadbalancing/latest/network/create-network-load-balancer.html)
   * 대상 VPC로 이동하여 Network Load Balancer(NLB)를 생성합니다. NLB는 내부(프라이빗)용이어야 하며, 인터넷 연결용(public)이어서는 안 됩니다.

2. Target Group 구성

   * Target group이 RDS 인스턴스의 endpoint IP와 포트(일반적으로 PostgreSQL은 5432, MySQL은 3306)를 가리키도록 설정합니다.

   :::note

   새 RDS endpoint IP로 target group을 자동으로 업데이트하려면 AWS Lambda 함수 또는 기타 자동화 도구를 사용할 수 있습니다.
   이 목적을 위해 사용할 수 있는 terraform 모듈 중 하나는 [여기](https://github.com/MaterializeInc/terraform-aws-rds-privatelink)에 있습니다.

   :::

   * **중요**: DB Cluster/Aurora를 사용하는 경우, RDS 인스턴스 endpoint로는 공용 endpoint가 아닌 WRITER Endpoint만 사용해야 합니다.
   * NLB에서 TLS 종료가 발생하지 않도록 TCP 프로토콜을 사용해야 합니다.

3. Listener Port 설정
   * Load balancer의 listener port는 target group에서 사용하는 포트(일반적으로 PostgreSQL은 5432, MySQL은 3306)와 일치해야 합니다.

4. VPC Endpoint Service 생성
   * VPC에서 NLB를 가리키는 endpoint service를 생성합니다.
   * 특정 계정의 연결 요청을 허용하도록 설정합니다.

5. ClickPipes가 Endpoint Service를 사용하도록 권한 부여
   * 이 endpoint service를 요청할 수 있도록 ClickPipes 계정에 권한을 부여합니다.
     * 허용된 principal을 구성할 때 다음 principal ID를 추가합니다:
       ```
       arn:aws:iam::072088201116:root
       ```

6. NLB에서 &quot;Enforce Security Group Inbound Rules on Private Link Traffic&quot; 비활성화(NLB에 security group이 연결된 경우)
   * NLB 설정으로 이동하여, NLB에 security group이 연결되어 있는 경우 &quot;Enforce Security Group Inbound Rules on Private Link Traffic&quot; 설정을 비활성화합니다.
   * Terraform을 사용하는 경우, NLB에 대해 `enforce_security_group_inbound_rules_on_private_link_traffic` 속성을 `off`로 설정합니다.
   * 이 설정은 ClickPipes VPC에서 NLB로의 트래픽을 허용하는 데 **필수**입니다.

7. **선택 사항**: 데이터베이스 리전과 ClickPipes 리전이 다른 경우 Cross-region 지원 활성화
   * VPC 콘솔의 `Endpoint Services`에서 endpoint service를 선택합니다.
   * `Actions` 버튼을 클릭한 후 `Modify supported Regions`를 선택합니다.
   * Endpoint service에 대한 액세스를 허용하려는 리전을 추가합니다. ClickPipes 리전 목록은 [여기](/integrations/clickpipes#list-of-static-ips)를 참고하십시오.

8. **MySQL 사용 시 권장 사항**
   * MySQL을 사용하는 경우, 소스 데이터베이스의 파라미터로 `skip_name_resolve=1`을 설정하는 것이 좋습니다.
     NLB에서 반복적으로 health check를 수행하기 때문에 MySQL이 NLB 호스트를 차단할 수 있습니다. 이 파라미터를 설정하면 DNS 호스트 이름 조회를 완전히
     비활성화하여 NLB 호스트를 차단하는 일이 발생하지 않습니다. RDS를 사용하는 경우 인스턴스 재부팅이 필요합니다.

## 연결 시작 \{#initiating-connection\}

작업이 완료되면 [연결을 시작](/integrations/clickpipes/aws-privatelink#creating-clickpipe)하는 가이드를 따르십시오.

콘솔에서 상태가 `Ready`로 표시되면, 다음 섹션을 참고하여 ClickPipe를 생성하십시오.

## ClickPipes 생성 \{#creating-clickpipes\}

이전 단계에서 발급받은 DNS 이름을 사용해 [ClickPipe를 생성](/integrations/clickpipes/postgres)합니다.

## RDS 엔드포인트 IP 동적 업데이트 \{#dynamically-updating-the-rds-endpoint-ip\}

RDS 엔드포인트 IP가 변경될 때(재시작/장애 조치/업데이트 발생 시) NLB 대상 그룹(Target Group)을 새 IP 주소로
업데이트해야 합니다. 이 작업은 AWS Lambda 함수 또는 기타 자동화 도구를 사용하여 자동화할 수 있습니다.