---
date: 2023-03-24
title: "S3에서 연도와 월 단위로 파티션 쓰기를 수행하는 방법"
description: "사용자 정의 경로 구조를 사용해 데이터를 구성하면서, ClickHouse에서 연도와 월 단위로 파티션된 데이터를 S3 버킷에 쓰는 방법을 설명합니다."
tags: ['데이터 내보내기', '네이티브 클라이언트와 인터페이스']
keywords: ['S3', '파티션 쓰기']
---

{frontMatter.description}

{/* 생략 */}

## S3에서 연도 및 월별로 파티션된 쓰기를 수행하는 방법 알아보기 \{#learn-how-to-do-partitioned-writes-by-year-and-month-on-s3\}

S3 버킷의 경로를 다음과 같은 구조가 되도록 분리하여 데이터를 내보내고자 합니다:

* 2022
  * 1
  * 2
  * ...
  * 12
* 2021
  * 1
  * 2
  * ...
  * 12

등등 ...

## 답변 \{#answer\}

다음 ClickHouse 테이블이 있다고 가정합니다:

```sql
CREATE TABLE sample_data (
    `name` String,
    `age` Int,
    `time` DateTime
) ENGINE = MergeTree
ORDER BY
    name
```

항목 10,000개를 추가합니다:

```sql
INSERT INTO
    sample_data
SELECT
    *
FROM
    generateRandom(
        'name String, age Int, time DateTime',
        10,
        10,
        10
    )
LIMIT
    10000;
```

다음 명령을 실행하여 S3 버킷 `my_bucket` 안에 원하는 구조를 생성합니다 (이 예제에서는 파일을 Parquet 형식으로 저장합니다):

```sql
INSERT INTO
    FUNCTION s3(
        'https://s3-host:4321/my_bucket/{_partition_id}/file.parquet.gz',
        's3-access-key',
        's3-secret-access-key',
        Parquet,
        'name String, age Int, time DateTime'
    ) PARTITION BY concat(
        formatDateTime(time, '%Y'),
        '/',
        formatDateTime(time, '%m')
    )
SELECT
    name,
    age,
    time
FROM
    sample_data
Query id: 55adcf22-f6af-491e-b697-d09694bbcc56

Ok.

0 rows in set. Elapsed: 15.579 sec. Processed 10.00 thousand rows, 219.93 KB (641.87 rows/s., 14.12 KB/s.)
```
