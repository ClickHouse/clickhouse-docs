---
title: ClickHouse에서 "Cannot Append Data in Parquet Format" 오류 해결하기
description: ClickHouse에서 "Cannot append data in format Parquet to file" 오류가 발생하고 있습니까? 이 문서에서는 이 문제를 해결하는 방법을 살펴봅니다.
date: 2023-03-25
tags: ['오류 및 예외', '데이터 형식']
keywords: ['Parquet', 'Cannot Append Data']
---

{frontMatter.description}

{/* 생략 */}

## ClickHouse에서 「Cannot Append Data in Parquet Format」 오류 해결 \{#resolving-cannot-append-data-in-parquet-format-error-in-clickhouse\}

ClickHouse에서 「Cannot append data in format Parquet to file」 오류가 발생합니까?

일반적으로 이 오류는 다음과 같은 형태로 보고됩니다:

`DB::Exception: Cannot append data in format Parquet to file, because this format doesn't support appends. (CANNOT_APPEND_TO_FILE)`

Parquet 포맷을 사용하는 `File` 테이블 엔진으로 테이블을 생성했다고 가정해 보겠습니다.

```sql
CREATE TABLE parquet_test
(
    `x` UInt32,
    `y` String
)
ENGINE = File(Parquet)
```

테이블에는 단 한 번만 데이터를 기록할 수 있습니다:

```sql
INSERT INTO parquet_test VALUES
   (1, 'Hello'),
   (2, 'Hi')
```

이 명령은 `data/default/parquet_test` 폴더에 `data.Parquet`라는 이름의 파일을 생성합니다. 다른 배치를 삽입하려고 시도하면:

```sql
INSERT INTO parquet_test VALUES
   (3, 'World'),
   (4, 'Bye')
```

...다음 오류가 발생합니다:

```response
Code: 641. DB::Exception: Received from localhost:9000. DB::Exception: Cannot append data in format Parquet to file, because this format doesn't support appends. You can allow to create a new file on each insert by enabling setting engine_file_allow_create_multiple_files. (CANNOT_APPEND_TO_FILE)
```

ClickHouse에서는 Parquet 파일에 데이터를 추가로 기록할 수 없습니다. 하지만 [`engine_file_allow_create_multiple_files` setting](https://clickhouse.com/docs/operations/settings/settings#engine_file_allow_create_multiple_files)을 활성화하면 ClickHouse가 `INSERT`마다 새 파일을 생성하도록 설정할 수 있습니다. 이 설정을 활성화하면 각 `INSERT` 시 다음 패턴을 따르는 이름으로 새 파일이 생성됩니다:

`data.Parquet` -&gt; `data.1.Parquet` -&gt; `data.2.Parquet` 등:

이제 직접 시도해 보겠습니다. 두 개의 명령을 `parquet.sql`이라는 하나의 파일에 넣겠습니다:

```sql
SET engine_file_allow_create_multiple_files = 1;

INSERT INTO default.parquet_test VALUES  (3, 'World'), (4, 'Bye');
```

`clickhouse-client`를 사용해 실행합니다:

```bash
./clickhouse client --queries-file parquet.sql
```

이제 `data/default/parquet_test` 디렉터리에 두 개의 파일이 있습니다(이후 각 INSERT마다 새 파일이 생성됩니다).

:::note
`engine_file_allow_create_multiple_files` 설정은 JSON, ORC와 같이 추가(append)가 불가능한 다른 데이터 포맷에도 적용됩니다.
:::
