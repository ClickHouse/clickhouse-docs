---
date: 2023-10-26
title: ClickHouse를 벡터 검색에 사용할 수 있습니까?
description: ClickHouse를 사용하여 임베딩을 저장하고 코사인 유사도와 같은 거리 함수를 사용해 검색하는 등 벡터 검색을 수행하는 방법을 알아봅니다.
tags: ['사용 사례', '개념']
keywords: ['벡터 검색']
---

{frontMatter.description}

{/* 생략 */}

## 벡터 검색을 위한 ClickHouse! \{#clickhouse-for-vector-search\}

ClickHouse는 벡터 검색을 수행할 수 있습니다.

보다 특화된 벡터 데이터베이스와 비교했을 때, 벡터 검색에 ClickHouse를 사용할 경우의 주요 장점은 다음과 같습니다.

* 검색을 수행하기 전에 ClickHouse의 필터링 및 전문 검색(full-text search) 기능을 사용하여 데이터 세트를 정제할 수 있습니다.
* 데이터 세트에 대한 분석을 수행할 수 있습니다.
* 기존 데이터에 대해 `JOIN`을 실행할 수 있습니다.
* 또 다른 데이터베이스를 관리하여 인프라를 복잡하게 만들 필요가 없습니다.

다음은 벡터 검색을 위해 ClickHouse를 사용하는 방법을 간단히 보여 주는 튜토리얼입니다.

## 1. Create embeddings \{#1-create-embeddings\}

데이터(문서, 이미지, 구조화된 데이터)는 &#95;임베딩(embeddings)&#95;으로 변환되어야 합니다. [OpenAI Embeddings API](https://platform.openai.com/docs/api-reference/embeddings)를 사용하거나 오픈 소스 Python 라이브러리인 [SentenceTransformers](https://www.sbert.net/)를 사용하여 임베딩을 생성하는 것을 권장합니다.

임베딩은 데이터를 표현하는 부동소수점 수로 이루어진 큰 배열로 이해할 수 있습니다. 임베딩에 대해 더 알고 싶다면 [OpenAI에서 제공하는 이 가이드를 참고하십시오](https://platform.openai.com/docs/guides/embeddings/what-are-embeddings).

## 2. 임베딩 저장 \{#2-store-the-embeddings\}

임베딩을 생성한 후에는 ClickHouse에 저장해야 합니다. 각 임베딩은 별도의 행에 저장되며, 필터링, 집계 또는 분석을 위한 메타데이터를 포함할 수 있습니다. 다음은 캡션과 함께 이미지를 저장할 수 있는 테이블의 예시입니다:

```sql
CREATE TABLE images
(
	`_file` LowCardinality(String),
	`caption` String,
	`image_embedding` Array(Float32)
)
ENGINE = MergeTree;
```

## 3. 관련 임베딩 검색 \{#3-search-for-related-embeddings\}

데이터셋에서 개 사진을 검색하려고 한다고 가정해 보겠습니다. `cosineDistance`와 같은 거리 함수를 사용해 개 이미지의 임베딩을 만든 뒤, 관련된 이미지를 검색할 수 있습니다.

```sql
SELECT
    _file,
	caption,
	cosineDistance(
        -- An embedding of your "input" dog picture
        [0.5736801028251648, 0.2516217529773712, ...,  -0.6825592517852783],
        image_embedding
    ) AS score
FROM images
ORDER BY score ASC
LIMIT 10
```

이 쿼리는 제공한 강아지 이미지와 가장 관련성이 높을 것으로 예상되는 상위 10개 이미지의 `_file` 이름과 `caption`을 반환합니다.

## 추가 자료 \{#further-reading\}

ClickHouse를 사용한 벡터 검색에 대한 보다 자세한 튜토리얼은 다음 문서를 참고하십시오.

* [정확 및 근사 벡터 검색](https://clickhouse.com/docs/engines/table-engines/mergetree-family/annindexes)