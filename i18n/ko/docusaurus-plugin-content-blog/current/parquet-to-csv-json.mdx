---
title: Parquet 파일을 CSV 또는 JSON으로 변환하려면 어떻게 해야 합니까?
description: "ClickHouse의 `clickhouse-local` 도구를 사용하여 Parquet 파일을 CSV 또는 JSON 형식으로 쉽게 변환하는 방법을 알아봅니다."
date: 2023-03-22
tags: ['데이터 소스', '데이터 형식']
keywords: ['변환', 'Parquet', 'CSV', 'JSON']
---

{frontMatter.description}

{/* 요약 */}

## Parquet 파일을 CSV 또는 JSON으로 변환하기 \{#converting-files-from-parquet-to-csv-or-json\}

`clickhouse-local`을 사용하면 ClickHouse가 지원하는 [입력 및 출력 형식](https://clickhouse.com/docs/interfaces/formats) 간에 파일을 변환할 수 있습니다 (70개가 넘는 다양한 형식을 지원합니다). 이 문서에서는 S3에 있는 Parquet 파일을 CSV와 JSON 파일로 변환하는 방법을 살펴봅니다.

처음부터 시작하겠습니다. ClickHouse에는 파일, 데이터베이스 및 기타 리소스에서 데이터를 읽어와 테이블로 변환하는 [table functions](https://clickhouse.com/docs/sql-reference/table-functions/) 모음이 있습니다. 예시로, S3에 Parquet 파일이 있다고 가정하겠습니다. 이를 읽기 위해 `s3` table function을 사용할 것입니다 (ClickHouse는 파일 이름을 보고 Parquet 파일임을 인식합니다).

먼저, `clickhouse` 바이너리를 다운로드합니다:

```bash
curl https://clickhouse.com/ | sh
```

## 테이블 함수(table function)를 사용해 데이터에 접근하기 \{#accessing-the-data-using-a-table-function\}

`s3` table function이 생성한 결과 테이블에 대해 `DESCRIBE`를 실행하여 파일을 정상적으로 읽을 수 있는지 확인합니다.

```bash
./clickhouse local -q "DESCRIBE s3('https://datasets-documentation.s3.eu-west-3.amazonaws.com/house_parquet/house_0.parquet')"
```

이 파일에는 영국에서 거래된 주택의 매매 가격이 포함되어 있습니다. 응답은 다음과 같습니다.

```response
price	Nullable(Int64)
date	Nullable(UInt16)
postcode1	Nullable(String)
postcode2	Nullable(String)
type	Nullable(String)
is_new	Nullable(UInt8)
duration	Nullable(String)
addr1	Nullable(String)
addr2	Nullable(String)
street	Nullable(String)
locality	Nullable(String)
town	Nullable(String)
district	Nullable(String)
county	Nullable(String)
```

이 데이터에 원하는 쿼리를 자유롭게 실행할 수 있습니다. 예를 들어 어느 마을의 주택 평균 가격이 가장 높은지 살펴보겠습니다.

```bash
./clickhouse local -q "SELECT
   town,
   avg(price) AS avg_price
FROM s3('https://datasets-documentation.s3.eu-west-3.amazonaws.com/house_parquet/house_0.parquet')
GROUP BY town
ORDER BY avg_price DESC
LIMIT 10"
```

응답은 다음과 같이 표시됩니다:

```bash
GATWICK	16818750
CHALFONT ST GILES	938090.0985915493
VIRGINIA WATER	789301.1320224719
COBHAM	699874.7111622555
BEACONSFIELD	677247.5483146068
ESHER	616004.6888297872
KESTON	607585.8597560975
GERRARDS CROSS	566330.2959086584
ASCOT	551491.2975753123
WEYBRIDGE	548974.828692494
```

## Parquet 파일을 CSV로 변환하기 \{#convert-the-parquet-file-to-a-csv\}

SQL 쿼리의 결과를 파일로 보낼 수 있습니다. S3에 있는 Parquet 파일에서 모든 컬럼을 가져와 그 출력을 새로운 CSV 파일로 저장해 보겠습니다. 출력 파일 이름이 `.csv`로 끝나기 때문에 ClickHouse는 `CSV` 출력 포맷을 사용해야 한다는 것을 자동으로 인식합니다:

```bash
./clickhouse local -q "SELECT *
FROM s3('https://datasets-documentation.s3.eu-west-3.amazonaws.com/house_parquet/house_0.parquet')
INTO OUTFILE 'house_prices.csv'"
```

제대로 동작했는지 확인해 보겠습니다:

```response
$ tail house_prices.csv
70000,10508,"YO8","9XN","detached",0,"freehold","7","","POPPY CLOSE","SELBY","SELBY","SELBY","NORTH YORKSHIRE"
130000,14274,"YO8","9XP","detached",0,"freehold","10","","HEATHER CLOSE","","SELBY","SELBY","NORTH YORKSHIRE"
150000,18180,"YO8","9XP","detached",0,"freehold","11","","HEATHER CLOSE","","SELBY","SELBY","NORTH YORKSHIRE"
157000,18088,"YO8","9XP","detached",0,"freehold","12","","HEATHER CLOSE","","SELBY","SELBY","NORTH YORKSHIRE"
134000,17333,"YO8","9XP","semi-detached",0,"freehold","16","","HEATHER CLOSE","","SELBY","SELBY","NORTH YORKSHIRE"
250000,13405,"YO8","9YA","detached",0,"freehold","6","","YORKDALE COURT","HAMBLETON","SELBY","SELBY","NORTH YORKSHIRE"
59500,11166,"YO8","9YB","semi-detached",0,"freehold","4","","YORKDALE DRIVE","HAMBLETON","SELBY","SELBY","NORTH YORKSHIRE"
142500,17648,"YO8","9YB","semi-detached",0,"freehold","4A","","YORKDALE DRIVE","HAMBLETON","SELBY","SELBY","NORTH YORKSHIRE"
230000,15125,"YO8","9YD","detached",0,"freehold","1","","ONE ACRE GARTH","HAMBLETON","SELBY","SELBY","NORTH YORKSHIRE"
250000,15950,"YO8","9YD","detached",0,"freehold","3","","ONE ACRE GARTH","HAMBLETON","SELBY","SELBY","NORTH YORKSHIRE"
```

## Parquet 파일을 JSON으로 변환하기 \{#convert-the-parquet-file-to-a-json\}

Parquet 파일을 JSON으로 변환하려면 출력 파일 이름에서 확장자만 변경하면 됩니다:

```bash
./clickhouse local -q "SELECT *
FROM s3('https://datasets-documentation.s3.eu-west-3.amazonaws.com/house_parquet/house_0.parquet')
INTO OUTFILE 'house_prices.ndjson'"
```

정상적으로 동작하는지 확인해 보겠습니다:

```response
 $ tail house_prices.ndjson
{"price":"70000","date":10508,"postcode1":"YO8","postcode2":"9XN","type":"detached","is_new":0,"duration":"freehold","addr1":"7","addr2":"","street":"POPPY CLOSE","locality":"SELBY","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}
{"price":"130000","date":14274,"postcode1":"YO8","postcode2":"9XP","type":"detached","is_new":0,"duration":"freehold","addr1":"10","addr2":"","street":"HEATHER CLOSE","locality":"","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}
{"price":"150000","date":18180,"postcode1":"YO8","postcode2":"9XP","type":"detached","is_new":0,"duration":"freehold","addr1":"11","addr2":"","street":"HEATHER CLOSE","locality":"","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}
{"price":"157000","date":18088,"postcode1":"YO8","postcode2":"9XP","type":"detached","is_new":0,"duration":"freehold","addr1":"12","addr2":"","street":"HEATHER CLOSE","locality":"","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}
{"price":"134000","date":17333,"postcode1":"YO8","postcode2":"9XP","type":"semi-detached","is_new":0,"duration":"freehold","addr1":"16","addr2":"","street":"HEATHER CLOSE","locality":"","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}
{"price":"250000","date":13405,"postcode1":"YO8","postcode2":"9YA","type":"detached","is_new":0,"duration":"freehold","addr1":"6","addr2":"","street":"YORKDALE COURT","locality":"HAMBLETON","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}
{"price":"59500","date":11166,"postcode1":"YO8","postcode2":"9YB","type":"semi-detached","is_new":0,"duration":"freehold","addr1":"4","addr2":"","street":"YORKDALE DRIVE","locality":"HAMBLETON","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}
{"price":"142500","date":17648,"postcode1":"YO8","postcode2":"9YB","type":"semi-detached","is_new":0,"duration":"freehold","addr1":"4A","addr2":"","street":"YORKDALE DRIVE","locality":"HAMBLETON","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}
{"price":"230000","date":15125,"postcode1":"YO8","postcode2":"9YD","type":"detached","is_new":0,"duration":"freehold","addr1":"1","addr2":"","street":"ONE ACRE GARTH","locality":"HAMBLETON","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}
{"price":"250000","date":15950,"postcode1":"YO8","postcode2":"9YD","type":"detached","is_new":0,"duration":"freehold","addr1":"3","addr2":"","street":"ONE ACRE GARTH","locality":"HAMBLETON","town":"SELBY","district":"SELBY","county":"NORTH YORKSHIRE"}
```

## CSV를 Parquet으로 변환 \{#convert-csv-to-parquet\}

양방향으로 동작하므로 새 CSV 파일을 손쉽게 읽어서 Parquet 파일로 출력할 수 있습니다. 로컬 파일 `house_prices.csv`는 ClickHouse에서 `file` 테이블 함수를 사용해 읽을 수 있으며, ClickHouse는 파일 이름이 `.parquet`으로 끝나는 것을 기준으로 파일을 Parquet 형식으로 출력합니다(또는 `FORMAT Parquet` 절을 추가할 수도 있습니다):

```bash
./clickhouse local -q "SELECT *
FROM file('house_prices.csv')
INTO OUTFILE 'house_prices.parquet'"
```

위에서 언급했듯이, `clickhouse local`과 함께 ClickHouse의 [입력 및 출력 포맷](https://clickhouse.com/docs/interfaces/formats)을 사용하면 파일을 다양한 포맷으로 쉽게 변환할 수 있습니다.
