---
title: ClickHouse 테이블에서 오래된 레코드를 삭제할 수 있습니까?
description: "간단한 답은 \"예\"입니다. ClickHouse에는 오래된 데이터를 제거하여 디스크 공간을 확보할 수 있는 여러 메커니즘이 있습니다. 각 메커니즘은 서로 다른 상황을 위해 설계되었습니다."
date: 2022-10-19
tags: ['데이터 삭제']
keywords: ['오래된 레코드 삭제']
---

{frontMatter.description}

{/* 생략 */}

## 짧은 답은 &quot;예&quot;입니다 \{#the-short-answer-is-yes\}

짧은 답은 &quot;예&quot;입니다. ClickHouse에는 오래된 데이터를 제거하여 디스크 공간을 확보할 수 있는 여러 가지 메커니즘이 있습니다. 각 메커니즘은 서로 다른 상황에 맞게 설계되었습니다.

## TTL \{#ttl\}

ClickHouse에서는 특정 조건이 충족되었을 때 값을 자동으로 삭제하도록 설정할 수 있습니다. 이 조건은 일반적으로 타임스탬프 컬럼에 대한 고정 오프셋처럼,任 arbitrary 컬럼을 기반으로 한 표현식으로 구성됩니다.

이 방식의 핵심 장점은 한 번 TTL을 설정해 두면 외부 시스템에서 별도로 트리거할 필요가 없고, 백그라운드에서 데이터 삭제가 자동으로 수행된다는 점입니다.

:::note
TTL은 데이터를 [/dev/null](https://en.wikipedia.org/wiki/Null_device)로만 이동하는 데 사용할 수 있을 뿐 아니라, SSD에서 HDD로 데이터를 이동하는 등 서로 다른 스토리지 시스템 간에 데이터를 이동하는 데에도 사용할 수 있습니다.
:::

[TTL 구성](https://clickhouse.com/docs/engines/table-engines/mergetree-family/mergetree#table_engine-mergetree-ttl)에 대한 자세한 내용은 해당 문서를 참조하십시오.

## DELETE FROM \{#delete-from\}

[DELETE FROM](https://clickhouse.com/docs/sql-reference/statements/delete)은(는) ClickHouse에서 표준 DELETE 쿼리를 실행할 수 있게 합니다. 필터 절에서 대상으로 지정된 행은 삭제된 것으로 표시되며, 이후 결과 집합에서는 제외됩니다. 행 정리는 비동기적으로 처리됩니다.

:::note
DELETE FROM은 23.3 버전 이상에서 일반적으로 사용 가능합니다. 더 낮은 버전에서는 실험적 기능이며, 다음과 같이 활성화해야 합니다:

```
SET allow_experimental_lightweight_delete = true;
```

:::

## ALTER DELETE \{#alter-delete\}

ALTER DELETE는 비동기 배치 연산을 사용하여 행을 제거합니다. DELETE FROM과는 달리, ALTER DELETE를 실행한 이후 배치 연산이 완료되기 전에 실행되는 쿼리에는 여전히 삭제 대상 행이 포함됩니다. 자세한 내용은 [ALTER DELETE](https://clickhouse.com/docs/sql-reference/statements/alter/delete) 문서를 참고하십시오.

`ALTER DELETE`는 오래된 데이터를 유연하게 제거하는 데 사용할 수 있습니다. 이를 정기적으로 실행해야 하는 경우, 가장 큰 단점은 쿼리를 제출하기 위한 외부 시스템이 필요하다는 점입니다. 또한 삭제할 행이 하나뿐이더라도 뮤테이션이 전체 파트를 재작성하기 때문에 성능 측면에서의 고려 사항도 존재합니다.

이 방식은 ClickHouse를 기반으로 한 시스템을 [GDPR](https://gdpr-info.eu) 규정을 준수하도록 만드는 가장 일반적인 접근 방식입니다.

[mutations](https://clickhouse.com/docs/sql-reference/statements/alter/#alter-mutations)에 대한 자세한 내용은 문서를 참고하십시오.

## DROP PARTITION \{#drop-partition\}

`ALTER TABLE ... DROP PARTITION`은(는) 전체 파티션을 삭제하는 비용 효율적인 방법입니다. 그만큼 유연하지는 않으며 테이블을 생성할 때 적절한 파티션 스킴을 미리 구성해야 하지만, 가장 일반적인 사용 사례 대부분은 이 방법으로 처리할 수 있습니다. 일반적인 사용을 위해서는 뮤테이션과 마찬가지로 외부 시스템에서 실행되도록 해야 합니다.

자세한 내용은 [파티션 조작](https://clickhouse.com/docs/sql-reference/statements/alter/partition/#alter_drop-partition)을(를) 참조하십시오.

## TRUNCATE \{#truncate\}

테이블에서 모든 데이터를 삭제하는 것은 다소 극단적인 작업이지만, 어떤 경우에는 오히려 필요한 경우도 있습니다.

[테이블 비우기(table truncation)](https://clickhouse.com/docs/sql-reference/statements/truncate)에 대한 자세한 내용은 문서를 참조하십시오.