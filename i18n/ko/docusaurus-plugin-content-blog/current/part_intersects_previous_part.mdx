---
title: "DB::Exception: 파트 XXXXX가 이전 파트 YYYYY와 겹칩니다. 이는 버그이거나 ZooKeeper 데이터에 대한 수동 개입의 결과입니다."
date: 2023-05-02
description: "이 문서는 ClickHouse에서 파트가 서로 겹치면서 발생하는 DB::Exception 오류를 해결하는 방법을 설명하며, 이는 주로 경쟁 상태(race condition)나 ZooKeeper 데이터에 대한 수동 개입으로 인해 발생합니다."
tags: ['오류 및 예외', 'System Tables']
keywords: ['Part Intersects', 'system.replicas']
---

{frontMatter.description}

{{/* 생략 */}}

## 발생 원인 \{#why-it-occurs\}

이 오류가 발생하면 테이블이 읽기 전용(readonly)으로 표시되고, 오류 메시지에는 서로 겹치는 파트가 있다고 표시됩니다.

이 오류는 로그에서 확인하거나 다음 방법으로 확인할 수 있습니다.

```sql
SELECT *
FROM system.replicas
WHERE is_readonly = 1
```

오류 메시지는 다음과 같습니다.

```
Code: 49. DB::Exception: Part XXXXX intersects previous part YYYYY. It is a bug or a result of manual intervention in the ZooKeeper data. (LOGICAL_ERROR) (version 21.12.4.1 (official build))
```

## 오류 원인 \{#cause-of-the-error\}

이 오류는 `mergeSelectingTask`와 큐 재초기화 사이에서 발생하는 경쟁 상태(race condition) 때문에 발생할 수 있습니다.

## 해결 방법 \{#solution\}

다음 쿼리를 모든 레플리카에서 실행합니다.

```sql
DETACH TABLE table_name;  -- Required for DROP REPLICA

SYSTEM DROP REPLICA 'replica_name' FROM ZKPATH '/table_path_in_zk/'; -- It will remove everything from /table_path_in_zk

ATTACH TABLE table_name;  -- Table will be in readonly mode, because there is no metadata in ZK
```

그런 다음 모든 레플리카에서 다음 명령을 실행하십시오:

```sql
SYSTEM RESTORE REPLICA table_name;  -- It will detach all partitions, re-create metadata in ZK (like it's new empty table), and then attach all partitions back

SYSTEM SYNC REPLICA table_name; -- Wait for replicas to synchronize parts. Also it's recommended to check `system.detached_parts` on all replicas after recovery is finished.
```

:::tip
최신 버전의 ClickHouse로 업그레이드하는 것이 좋습니다.
:::

## 추가 자료 \{#additional-resources\}

관련 PR과 GitHub 이슈:

* [ClickHouse/ClickHouse#34096](https://github.com/ClickHouse/ClickHouse/pull/34096)
* [ClickHouse/ClickHouse#30651](https://github.com/ClickHouse/ClickHouse/pull/30651)
* [ClickHouse/ClickHouse#31060](https://github.com/ClickHouse/ClickHouse/pull/31060)
* [ClickHouse/ClickHouse#35863](https://github.com/ClickHouse/ClickHouse/issues/35863)

## 영향을 받는 버전: \{#versions-affected\}

ClickHouse v 22.12 이하 버전