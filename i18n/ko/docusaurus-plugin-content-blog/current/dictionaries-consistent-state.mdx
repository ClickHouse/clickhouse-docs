---
title: 왜 ClickHouse Cloud의 딕셔너리에서 데이터를 볼 수 없습니까?
description: 딕셔너리의 데이터가 생성 직후 바로 보이지 않을 수 있는 문제가 있습니다.
date: 2024-04-12
tags: ['Cloud 관리', '데이터 모델링']
keywords: ['딕셔너리']
---

{frontMatter.description}

{/* 이하 생략 */}

## ClickHouse의 딕셔너리 \{#dictionaries-in-clickhouse\}

ClickHouse Cloud에서 생성된 딕셔너리는 초기 생성 단계에서 일관성 문제가 발생할 수 있습니다. 이는 생성 직후에는 딕셔너리에 어떤 데이터도 보이지 않을 수 있음을 의미합니다. 그러나 여러 번 재시도하면 생성 쿼리가 서로 다른 레플리카에 도달하게 되고, 그 시점에는 데이터가 표시됩니다.

이는 때때로 파트가 서버에 도달하기 전에 딕셔너리가 먼저 생성되었기 때문에 발생합니다. 예를 들어 다음과 같습니다:

```
2024-01-25 13:38:25.615837 - CREATE DICTIONARY received
2024-01-25 13:38:25.626468 - CREATE DICTIONARY finished
2024-01-25 13:38:25.733008 - Part all_0_0_0 downloaded
```

앞에서 본 것처럼, 해당 파트는 딕셔너리가 생성된 이후에야 도착했습니다. `LIFETIME(MIN 0 MAX 0)`을 사용하면 이 문제는 더 심각해질 수 있는데, 이는 딕셔너리가 자동으로 갱신되지 않음을 의미하기 때문입니다. 따라서 `RELOAD DICTIONARIES` 명령을 실행할 때까지 딕셔너리는 비어 있는 상태로 유지됩니다.

이 문제를 해결하는 방법은 딕셔너리를 생성할 때 소스 테이블을 직접 지정하는 대신 `SELECT` 쿼리를 사용하고, `select_sequential_consistency=1` 설정을 활성화하는 것입니다.

소스 테이블을 지정하는 대신:

```sql
SOURCE(CLICKHOUSE(
    table 'test.temp_title_table_1706189903924'
    user default password 'PASSWORD'))
```

`select_sequential_consistency=1`을 설정한 `SELECT` 쿼리를 사용하십시오:`

```sql
SOURCE(CLICKHOUSE(QUERY
    'SELECT songTitle, mappedTitle
    FROM test.temp_title_table_1706189903924
    SETTINGS select_sequential_consistency=1' USER default PASSWORD ''))
```

## 왜 이 문제가 발생합니까? \{#why-does-this-issue-occur\}

데이터를 삽입한 후 딕셔너리를 생성하거나 다시 로드하면, DDL이 데이터(또는 새로운 데이터)보다 먼저 레플리카에 도달할 수 있습니다. 이로 인해 레플리카 간 딕셔너리가 서로 다른 상태가 될 수 있습니다. 그 결과, 쿼리를 처리하는 레플리카에 따라 서로 다른 결과가 반환될 수 있습니다.

테이블에 데이터를 삽입한 직후 읽기를 수행할 때도 동일한 현상이 발생합니다. 아직 데이터를 복제하지 않은 레플리카에서 읽으면 새로 삽입된 데이터를 볼 수 없습니다. 성능을 희생하더라도(일반적으로 사용을 권장하지 않는 이유입니다) 순차적 일관성이 필요하다면 `select_sequential_consistency`를 활성화할 수 있습니다.

딕셔너리의 경우는 조금 더 까다롭습니다. 딕셔너리는 쿼리의 설정이 아니라 서버의 설정을 사용하기 때문입니다. 그 결과, 딕셔너리에 데이터를 로드할 때 `SET select_sequential_consistency=1`을 실행하더라도 레플리카마다 데이터가 일관되지 않게 로드될 수 있습니다. 딕셔너리 소스 쿼리에서 `select_sequential_consistency=1`을 지정하면, 서버 전역 설정으로 활성화되지 않았더라도 딕셔너리가 이 설정을 따르도록 할 수 있습니다.