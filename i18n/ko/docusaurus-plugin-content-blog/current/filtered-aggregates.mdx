---
title: ClickHouse에서 필터링 집계 사용하기
description: "`-If` 및 `-Distinct` 집계 결합자(aggregate combinator)를 사용하여 ClickHouse에서 필터링 집계를 활용해 쿼리 구문을 단순화하고 분석 기능을 향상시키는 방법을 설명합니다."
date: 2023-03-01
tags: ['함수']
keywords: ['필터링 집계']
---

{frontMatter.description}

{{/* 일부 생략 */}}

## 필터링 집계 사용하기 \{#using-filtered-aggregates\}

ClickHouse는 *필터링 집계(filtered aggregates)*를 간단하고 직관적으로 작성할 수 있는 방법을 제공합니다.

예를 들어, 필터링 집계를 작성하는 표준 SQL 방식(이는 ClickHouse에서도 문제없이 동작합니다)과, 어떤 집계 함수에도 붙일 수 있는 `-If` [aggregate function combinator](https://clickhouse.com/docs/sql-reference/aggregate-functions/combinators/)를 사용하는 간단한 축약 구문을 비교해 보십시오:

```sql
--standard SQL
SELECT
   avg(number)
FILTER (WHERE number > 50)
FROM numbers(100)

--ClickHouse using an aggregate combinator
SELECT
   avgIf(number, number > 50)
FROM numbers(100)
```

마찬가지로 `-Distinct` 집계 조합자(aggregate combinator)도 있습니다.

```sql
--standard SQL
SELECT avg(DISTINCT number)

--ClickHouse using an aggregate combinator
SELECT avgDistinct(number)
```

필터링된 집계가 중요한 이유는 무엇입니까? 웹 분석 서비스에서 **「세그먼트 비교」** 기능을 구현할 수 있게 해 주기 때문입니다.
예를 들어:

```sql
WITH
   Region = 'us' AS segment1,
   Browser = 'Chrome' AS segment2
SELECT
   uniqIf(UserID, segment1),
   uniqIf(UserID, segment2)
WHERE segment1 OR segment2
```

자세한 내용은 ClickHouse 문서의 [집계 함수 조합자(aggregate function combinator)](https://clickhouse.com/docs/sql-reference/aggregate-functions/combinators/) 페이지를 참조하십시오.
