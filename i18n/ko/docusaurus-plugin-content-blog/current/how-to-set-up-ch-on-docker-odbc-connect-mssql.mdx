---
title: Docker에서 ODBC를 사용하여 Microsoft SQL Server(MSSQL) 데이터베이스에 연결하도록 ClickHouse를 설정하는 방법
description: "Docker에서 ODBC를 사용하여 Microsoft SQL Server(MSSQL) 데이터베이스에 연결하도록 ClickHouse를 설정하는 방법"
date: 2024-05-29
tags: ['Native Clients and Interfaces']
keywords: ['Docker', 'ODBC', 'Microsoft SQL Server', 'MSSQL']
---

import Image from "@theme/IdealImage";
import mssql_table from "@site/static/images/knowledgebase/ikb273/c8a5492f-5910-4454-bfbc-5c6ceda15ccd.png";
import mssql_login from "@site/static/images/knowledgebase/ikb273/568f1143-475e-422f-a26a-2c23ac324771.png";
import mssql_roles from "@site/static/images/knowledgebase/ikb273/63992978-7078-4985-b661-a3c095099ea7.png";
import mssql_user from "@site/static/images/knowledgebase/ikb273/15a407ca-53c1-45b1-9beb-ddd8eedde64a.png";

{frontMatter.description}

{/* 중략 */}

## Question \{#question\}

Docker 이미지로 ClickHouse를 설정하여 Microsoft SQL Server에 연결하려면 어떻게 해야 합니까?

## 답변 \{#answer\}

***이 예제에 대한 참고 사항***

* ClickHouse Docker Ubuntu 이미지를 사용합니다
* FreeTDS Driver를 사용합니다
* MSSQL Server 2012R2를 사용합니다
* 이 예제에서 Windows 호스트 이름은 IP `192.168.1.133`을(를) 가진 `MARSDB2.marsnet2.local`입니다 (사용자의 호스트 이름 및/또는 IP로 변경하십시오)
* MSSQL 인스턴스 이름은 `MARSDB2`입니다
* MSSQL 로그인 및 데이터베이스 사용자는 `sql_user`입니다

### 테스트용 MSSQL 예제 설정 ### \{#example-setup-in-mssql-for-testing-\}

MSSQL에서 생성한 데이터베이스와 테이블:

<Image img={mssql_table} size="md" alt="MSSQL 데이터베이스와 테이블 구조" border />

MSSQL 로그인 사용자 `sql_user`:

<Image img={mssql_login} size="md" alt="MSSQL 로그인 사용자 구성" border />

`sql_user`의 데이터베이스 역할 멤버십:

<Image img={mssql_roles} size="md" alt="MSSQL 데이터베이스 역할 멤버십" border />

로그인과 연결된 데이터베이스 사용자:

<Image img={mssql_user} size="md" alt="로그인과 연결된 MSSQL 데이터베이스 사용자" border />

### ODBC를 사용하여 ClickHouse 구성하기 \{#configuring-clickhouse-with-odbc\}

작업 디렉터리를 생성합니다:

```sh
mkdir ch-odbc-mssql
cd ch-odbc-mssql
```

`odbc.ini` 파일을 생성하십시오:

```sh
vim odbc.ini
```

DSN 이름과 IP를 업데이트하려면 다음 항목을 추가합니다:

```sh
[marsdb2_mssql]
Driver = FreeTDS
Server = 192.168.1.133
```

`odbcinst.ini` 파일을 생성하십시오:

```sh
vim odbcinst.ini
```

다음 항목을 추가하십시오 (`trace`는 선택 사항이지만 디버깅에 도움이 됩니다):

```sh
[ODBC]
Trace = Yes
TraceFile = /tmp/odbc.log

[FreeTDS]
Description = FreeTDS
Driver = /usr/lib/aarch64-linux-gnu/odbc/libtdsodbc.so
Setup = /usr/lib/x86_64-linux-gnu/odbc/libtdsS.so
UsageCount = 1
```

### Dockerfile을 구성하여 이미지를 다운로드하고 TDS 및 필요한 ODBC 라이브러리를 추가합니다 \{#configure-a-dockerfile-to-download-the-image-and-add-the-tds-and-required-odbc-libraries\}

Dockerfile을 작성합니다:

```sh
vim Dockerfile
```

Dockerfile 내용을 추가하십시오:

```sh
FROM clickhouse/clickhouse-server:23.10

# Install the ODBC driver

RUN apt-get update && apt-get install -y --no-install-recommends unixodbc \
    && apt-get install -y freetds-bin freetds-common freetds-dev libct4 libsybdb5 \
	&& apt-get install tdsodbc
```

새 Docker 이미지를 빌드하십시오:

```sh
docker build . -t marsnet/clickhouse-odbc:23.10
```

`docker-compose.yml` 파일을 생성하십시오:

```sh
vim docker-compose.yml
```

YAML 파일에 다음 내용을 추가하십시오:

```sh
version: '3.7'
services:
  clickhouse:
    image: marsnet/clickhouse-odbc:23.10
    container_name: clickhouse-odbc
    hostname: clickhouse-host
    ports:
      - "9000:9000"
      - "8123:8123"
      - "9009:9009"
    volumes:
      - ./odbc.ini:/etc/odbc.ini
      - ./odbcinst.ini:/etc/odbcinst.ini
    restart: always
    ulimits:
      memlock:
        soft: -1
        hard: -1
      nofile:
        soft: 262144
        hard: 262144
    deploy:
      resources:
        limits:
          memory: 4g
```

컨테이너를 시작합니다:

```sh
docker compose up --detach
```

컨테이너를 시작한 후 다음과 같은 결과가 표시됩니다:

```sh
ch-odbc-mssql % docker compose up --detach
[+] Running 1/1
 ✔ Container clickhouse-odbc  Started
```

컨테이너가 실행 중인지 확인하십시오:

```sh
ch-odbc-mssql % docker ps
CONTAINER ID   IMAGE                           COMMAND            CREATED          STATUS              PORTS                                                                    NAMES
87a400b803ce   marsnet/clickhouse-odbc:23.10   "/entrypoint.sh"   57 minutes ago   Up About a minute   0.0.0.0:8123->8123/tcp, 0.0.0.0:9000->9000/tcp, 0.0.0.0:9009->9009/tcp   clickhouse-odbc
```

### ODBC 연결 테스트 \{#test-odbc-connection\}

ClickHouse 클라이언트를 사용해 로그인합니다:

```sh
./clickhouse client
```

원격 MSSQL Database의 테이블에 대해 `odbc` 테이블 함수(table function)를 사용하여 `SELECT`를 테스트합니다.

```
clickhouse-host :) SELECT * from odbc('DSN=marsdb2_mssql;port=1433;Uid=sql_user;Pwd=ClickHouse123;Database=db1', 'table1');

SELECT *
FROM odbc('DSN=marsdb2_mssql;port=1433;Uid=sql_user;Pwd=ClickHouse123;Database=db1', 'table1')

Query id: 23494da2-6e12-4ade-95fa-372a0420cac1

┌─id─┬─column1─┐
│  1 │ abc     │
│  2 │ def     │
│  3 │ ghi     │
└────┴─────────┘

3 rows in set. Elapsed: 0.188 sec. 
```

`odbc` 테이블 엔진을 사용하여 원격 테이블을 생성할 수도 있습니다.

```sql
CREATE TABLE table1_odbc_mssql
(
    `id` Int32,
    `column1` String
)
ENGINE = ODBC('DSN=marsdb2_mssql;port=1433;Uid=sql_user;Pwd=ClickHouse123;Database=db1', 'dbo', 'table1')
```

새로 만든 원격 테이블을 테스트하려면 `SELECT` 쿼리를 사용하십시오:

```
clickhouse-host :) select * from table1_odbc_mssql;

SELECT *
FROM table1_odbc_mssql

Query id: 94724368-485d-4364-ae58-a435a225c37d

┌─id─┬─column1─┐
│  1 │ abc     │
│  2 │ def     │
│  3 │ ghi     │
└────┴─────────┘

3 rows in set. Elapsed: 0.218 sec. 
```

자세한 내용은 다음 자료를 참고하십시오:

* [https://hub.docker.com/&#95;/clickhouse](https://hub.docker.com/_/clickhouse)
* [https://clickhouse.com/docs/engines/table-engines/integrations/odbc](https://clickhouse.com/docs/engines/table-engines/integrations/odbc)
* [https://github.com/ClickHouse/clickhouse-odbc](https://github.com/ClickHouse/clickhouse-odbc)
