---
title: 파트 타입과 스토리지 포맷 이해하기
description: 'ClickHouse에서 파트 타입(Wide vs Compact)과 스토리지 포맷(Full vs Packed)의 차이를 살펴보고, 이것이 성능에 어떤 영향을 주는지 알아봅니다.'
date: 2026-02-03
tags: ['핵심 데이터 개념']
keywords: ['compact parts', 'wide parts', 'full storage', 'packed storage', 'part types', 'storage formats']
---

{frontMatter.description}

{/* 생략 */}

<br />

<br />

ClickHouse는 파트 내부의 데이터를 구성하기 위해 서로 독립적인 두 가지 개념을 사용합니다.

* **파트 타입**(Wide vs Compact): 하나의 파트 안에 컬럼 데이터가 어떻게 저장되는지 나타냅니다.
* **스토리지 포맷**(Full vs Packed): 파트의 파일이 디스크에 어떻게 저장되는지 나타냅니다.

## 파트 유형: Wide vs Compact \{#part-types-wide-vs-compact\}

파트 유형은 데이터 파트 내에서 컬럼 데이터가 어떻게 구성되는지 결정합니다.

| 유형 | 설명 | 적합한 용도 |
|------|-------------|----------|
| **Wide** | 각 컬럼이 각각의 [마크 파일](/concepts/glossary#mark-file)을 가진 별도 파일(들)에 저장됩니다 | 일부 컬럼만 선택하는 쿼리 |
| **Compact** | 모든 컬럼이 하나의 [마크 파일](/concepts/glossary#mark-file)을 가진 단일 파일에 저장됩니다 | 수집 성능 및 모든 컬럼을 사용하는 쿼리 |

### 각 타입이 사용되는 경우 \{#when-each-type-is-used\}

파트 유형은 다음 테이블 설정으로 제어합니다:

* [`min_bytes_for_wide_part`](/operations/settings/merge-tree-settings#min_bytes_for_wide_part): Wide 형식을 사용하기 위한 파트의 최소 바이트 수
* [`min_rows_for_wide_part`](/operations/settings/merge-tree-settings#min_rows_for_wide_part): Wide 형식을 사용하기 위한 파트의 최소 행 수

데이터 파트의 바이트 수 또는 행 수가 해당 설정값보다 작으면 파트는 `Compact` 형식으로 저장되고, 그렇지 않으면 `Wide` 형식을 사용합니다.

### 성능 고려사항 \{#performance-considerations\}

**Compact 파트:**

* 수집 성능이 더 우수합니다
* 쿼리가 모든 컬럼을 필요로 할 때 최적입니다
* 작은 파트에서 더 효율적입니다

**Wide 파트:**

* 일부 컬럼만 선택하는 쿼리에 더 효율적입니다
* 선택적인 컬럼 접근이 많은 대규모 데이터셋에 더 적합합니다

Compact 파트에서 Wide 파트로의 머지는 Wide 파트 간 머지보다 더 느린데, 이는 ClickHouse가 Compact 파트를 Wide 파트로 변환할 때는 [수직 병합](/merges#memory-optimized-merges) 알고리즘을 사용하고, Compact 파트 간 머지에는 수평 알고리즘을 사용하기 때문입니다. 크기에 관계없이 Wide 파트를 강제로 사용하려면 `min_bytes_for_wide_part=0`으로 설정할 수 있습니다.

이는 다음과 같은 시나리오에서 유용할 수 있습니다:

1. 컬럼 수가 매우 많은 테이블(예: 600개 이상의 컬럼)에 대규모 insert를 수행할 때 이 값을 0으로 설정하면 성능 향상에 도움이 될 수 있습니다
2. 머지 중에 과도한 메모리를 사용하는 `system.metric_log`, `system.text_log`와 같은 시스템 테이블의 메모리 사용을 최적화할 때
3. insert 작업량이 많은 테이블에서 스토리지 및 머지 동작을 최적화하고자 할 때
4. 크기 임계값에 따른 포맷 전환 오버헤드 없이 일관된 파트 포맷 동작을 유지하고자 할 때

이 값을 0으로 설정하면 특정 성능 특성이 개선될 수 있지만, Wide 파트 포맷으로 인해 S3 스토리지에 대한 GET 요청이 더 많이 발생할 수 있다는 점에는 유의해야 합니다.

### 제한 사항 \{#limitations\}

Compact 파트에서는 컬럼 크기 통계가 계산되지 않으며, 이는 모니터링 및 최적화 작업에 영향을 줄 수 있습니다. `system.parts_columns`를 쿼리하면 compact 파트의 `column_data_compressed_bytes`와 `column_data_uncompressed_bytes`는 `0`으로 표시됩니다. 자세한 내용은 [&quot;wide 또는 compact 파트의 개수와 크기 찾기&quot;](/knowledgebase/count-parts-by-type)를 참조하십시오.

## 스토리지 형식: Full vs Packed (ClickHouse Cloud) \{#storage-formats-full-vs-packed-clickhouse-cloud\}

스토리지 형식은 파트의 파일이 디스크에 실제로 어떻게 저장되는지를 결정합니다.

| Format | 설명 | 지원 환경 |
|--------|-------------|--------------|
| **Full** | 각 파일이 파트 디렉터리 내에 개별적으로 저장됩니다 | 오픈 소스 및 Cloud |
| **Packed** | 모든 파일이 하나의 아카이브 파일로 묶여 저장됩니다 | ClickHouse Cloud 전용 |

### 전체 저장소(Full storage) \{#full-storage\}

전체 저장소(Full storage)에서는 각 파트가 디스크에 개별적으로 저장되는 여러 개의 별도 파일로 구성됩니다. 이는 오픈 소스 ClickHouse에서 기본이자 유일한 옵션입니다.

### Packed 스토리지 (ClickHouse Cloud 전용) \{#packed-storage-clickhouse-cloud-only\}

Packed 스토리지에서는 모든 파트 파일을 하나의 아카이브로 묶어 저장합니다. 이를 통해 파일 작업 횟수가 크게 줄어들며, 각 요청마다 지연 시간과 비용이 발생하는 S3와 같은 원격 스토리지에서는 특히 중요합니다.

**Packed 스토리지의 이점:**

* S3/객체 스토리지 API 호출 감소
* 조정 서비스 메타데이터에 대한 부하 감소
* 더 낮은 스토리지 비용 (Full 스토리지는 비용이 훨씬 더 많이 들 수 있습니다)
* 원격 스토리지에서 작은 파트 처리 시 더 나은 성능

### Packed storage가 사용되는 경우 \{#when-packed-storage-is-used\}

ClickHouse Cloud에서 파트는 다음 **하나라도** 조건을 만족하면 Packed storage를 사용합니다:

* 압축되지 않은 바이트 수 &lt; [`min_bytes_for_full_part_storage`](/operations/settings/merge-tree-settings#min_bytes_for_full_part_storage)
* 행 수 &lt; [`min_rows_for_full_part_storage`](/operations/settings/merge-tree-settings#min_rows_for_full_part_storage)
* 머지 레벨 &lt; [`min_level_for_full_part_storage`](/operations/settings/merge-tree-settings#min_level_for_full_part_storage)

:::note Open source
`min_bytes_for_full_part_storage`, `min_rows_for_full_part_storage`, `min_level_for_full_part_storage` 설정은 오픈 소스 ClickHouse에도 정의되어 있지만, Packed storage 구현은 ClickHouse Cloud에서만 사용 가능하므로 아무런 영향을 미치지 않습니다.
:::

`min_level_for_full_part_storage` 설정은 특히 지속적으로 insert가 발생하는 테이블에 대해, ClickHouse Cloud 환경에서 성능과 비용을 동시에 최적화하는 데 사용할 수 있습니다.
이 설정은 ClickHouse 25.10 버전부터 사용할 수 있으며, `min_level_for_wide_part`와 함께 동작하여 파트 저장 전략을 포괄적으로 제어할 수 있게 합니다.

기본값(0)에서 변경을 고려할 수 있는 경우는 다음과 같습니다:

* 테이블에 정기적으로 데이터가 수집되는 경우, 초기 파트는 빠르게 머지되므로 처음부터 전체 파트 형식(full part format)으로 저장하는 것은 비효율적입니다
* 이 파라미터를 설정하면 insert 시 비용이 많이 드는 S3 PUT 요청을 방지할 수 있습니다. 예를 들어, 한 분석에서는 전체 파트를 생성하는 insert가 insert당 평균 31.3개의 PUT 요청을 발생시키는 반면, packed 파트만 생성하는 insert는 insert당 평균 2.22개의 PUT 요청만 발생하는 것으로 나타났습니다
* packed storage는 각 컬럼별 개별 파일을 생성하는 대신 모든 데이터를 하나의 파일에 기록하므로, 특히 컬럼이 많은 테이블에서 insert 작업이 더 빨라집니다.

권장 설정:

Cloud 배포 환경에서는 `min_level_for_full_part_storage = 2`로 설정하십시오.
이렇게 하면 다음이 보장됩니다:

* 레벨 0 파트(초기 insert)는 packed storage를 사용합니다
* 레벨 1 파트도 계속 packed storage를 사용합니다
* 레벨 2 이상인 파트만 전체 저장 형식(full storage format)을 사용합니다

:::tip
머지가 충분히 발생하지 않는, 매우 크지만 드문 쓰기를 받는 테이블에는 이 설정 사용을 피해야 합니다. 이런 경우, 대규모 초기 쓰기는 처음부터 full part storage의 이점을 얻을 수 있습니다.
:::

## 파트 유형과 스토리지 포맷 결합 \{#combining-part-types-and-storage-formats\}

이 두 개념은 서로 독립적이므로 ClickHouse Cloud를 사용하는지 오픈 소스 ClickHouse를 사용하는지와 관계없이 어떤 조합이든 사용할 수 있습니다:

| Combination | Use case |
|-------------|----------|
| Wide + Full | 로컬 스토리지의 큰 파트(오픈 소스 기본값) |
| Wide + Packed | 클라우드 스토리지의 큰 파트 |
| Compact + Full | 로컬 스토리지의 작은 파트 |
| Compact + Packed | 클라우드 스토리지의 작은 파트 |

## 파트 정보 조회하기 \{#querying-part-information\}

[`system.parts`](/operations/system-tables/parts) 테이블을 사용하여 기존 파트의 파트 유형과 스토리지 유형을 확인할 수 있습니다:

```sql
SELECT
    part_type,
    part_storage_type,
    max(level),
    count(),
    formatReadableSize(max(data_uncompressed_bytes)),
    formatReadableSize(min(data_uncompressed_bytes))
FROM system.parts
WHERE (database != 'system') AND active
GROUP BY
    1,
    2
ORDER BY
    1 ASC,
    2 ASC
```

다음과 같은 결과가 표시됩니다:

```response
   ┌─part_type─┬─part_storage_type─┬─max(level)─┬─count()─┬─formatReadab⋯sed_bytes))─┬─formatReadab⋯sed_bytes))─┐
1. │ Compact   │ Full              │      12688 │    2456 │ 1023.87 MiB              │ 23.78 MiB                │
2. │ Compact   │ Packed            │      97383 │   13748 │ 127.77 MiB               │ 1.00 B                   │
3. │ Wide      │ Full              │       7642 │    2000 │ 1.38 TiB                 │ 30.18 MiB                │
4. │ Wide      │ Packed            │         10 │     187 │ 110.01 MiB               │ 1.30 KiB                 │
   └───────────┴───────────────────┴────────────┴─────────┴──────────────────────────┴──────────────────────────┘
```
