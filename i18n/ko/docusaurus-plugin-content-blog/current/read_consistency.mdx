---
date: 2024-02-14
title: "ClickHouse에서 데이터 읽기 일관성을 보장하는 방법?"
description: "동일한 노드에 연결하든 임의의 노드에 연결하든 ClickHouse에서 데이터를 읽을 때 데이터 일관성을 보장하는 방법을 알아봅니다."
tags: ['성능 및 최적화']
keywords: ['읽기 일관성']
---

{frontMatter.description}

{/* 이하 생략 */}

## Question \{#question\}

ClickHouse Cloud에 데이터를 쓰고 있으며, 데이터를 읽을 때 최신의 완전한 정보를 읽는다는 점을 보장해야 합니다.

## 답변 \{#answer\}

### 동일한 노드와 통신하기 \{#talking-to-the-same-node\}

네이티브 프로토콜 또는 세션을 사용해 쓰기/읽기 작업을 수행하는 경우에는 동일한 레플리카에 연결되어 있어야 합니다. 이 시나리오에서는 쓰기를 수행하는 노드에서 직접 읽기를 수행하므로, 읽기는 항상 일관성을 유지합니다.

### 임의의 노드와 통신하기 \{#talking-to-a-random-node\}

동일한 노드와 통신한다고 보장할 수 없는 경우(예: 로드 밸런서를 통해 분산되는 HTTPS 호출로 노드와 통신하는 경우)에는 다음 중 하나를 사용할 수 있습니다.

A)

1. 데이터를 씁니다.
2. 새 레플리카에 연결합니다.
3. `SYSTEM SYNC REPLICA db.table_name LIGHTWEIGHT`를 실행합니다.
4. 최신 데이터를 읽습니다.

`SYSTEM` 명령 [참고 문서](https://clickhouse.com/docs/sql-reference/statements/system#sync-replica)를 참조하십시오.

또는

B) 순차적 일관성이 보장되는 범위 내에서 언제든지 읽습니다.

```sql
SELECT 
...
SETTINGS select_sequential_consistency = 1
```

ClickHouse Cloud와 기본 [SharedMergeTree](https://clickhouse.com/docs/cloud/reference/shared-merge-tree) 테이블 엔진을 사용할 때는 `insert_quorum_parallel`을 사용할 필요가 없다는 점에 유의하십시오. SharedMergeTree로의 모든 insert는 설계상 quorum insert로 처리됩니다.

[`SYSTEM SYNC REPLICAS`](https://clickhouse.com/docs/sql-reference/statements/system#sync-replica) 또는 [`select_sequential_consistency`](https://clickhouse.com/docs/operations/settings/settings#select_sequential_consistency)를 사용하면 ClickHouse Keeper에 가해지는 부하가 증가하고, 서비스의 부하 수준에 따라 성능이 저하될 수 있습니다.

권장되는 접근 방식은 동일한 세션 또는 네이티브 프로토콜(sticky connection)을 사용해 쓰기/읽기를 수행하는 것입니다.
