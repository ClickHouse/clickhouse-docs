---
title: 배열 컬럼으로 ClickHouse 테이블을 필터링하는 방법?
description: "배열 컬럼으로 ClickHouse 테이블을 필터링하는 방법을 설명하는 지식베이스 문서입니다."
date: 2024-12-17
tags: ['데이터 모델링', '함수']
keywords: ['필터링', '배열 컬럼']
---

{frontMatter.description}

{/* 생략 */}

## 소개 \{#introduction\}

배열 컬럼을 기준으로 ClickHouse 테이블을 필터링하는 작업은 흔하며, ClickHouse에는 배열 컬럼을 다루기 위한 다양한 [함수](/sql-reference/functions/array-functions)가 제공됩니다.

이 문서에서는 배열 컬럼을 기준으로 테이블을 필터링하는 방법에 중점을 두지만, 아래 동영상에서는 이외에도 다양한 배열 관련 함수를 다룹니다.

<iframe width="560" height="315" src="https://www.youtube.com/embed/JKHAdCFtYDg?si=OqS3ry1LFrOlF8Iy" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen />

## 예시 \{#example\}

문자열 배열과 정수 배열을 각각 포함하는 두 개의 컬럼 `tags_string`과 `tags_int`를 가진 테이블 예제를 사용합니다.

* 샘플용 데이터베이스와 테이블을 생성합니다.

```sql
CREATE DATABASE db1;
```

* 샘플 테이블을 생성하십시오

```sql
CREATE TABLE db1.tags_table
(
    `id` UInt64,
    `tags_string` Array(String),
    `tags_int` Array(UInt64),
)
ENGINE = MergeTree
ORDER BY id;
```

* 테이블에 샘플 데이터를 삽입합니다.

```sql
INSERT INTO db1.tags_table VALUES (1, ['tag1', 'tag2', 'tag3'], [1, 2, 3]), (2, ['tag2', 'tag3', 'tag4'], [2, 3, 4]), (3, ['tag1', 'tag3', 'tag5'], [1, 3, 5]);
```

`has(arr, elem)` 함수를 사용하여 `arr` 배열에 `elem` 요소가 포함된 행만 반환하도록 테이블을 필터링합니다.

`tags_string` 배열에 `tag1` 요소가 포함된 행만 반환하도록 테이블을 필터링합니다.

```sql
SELECT * FROM db1.tags_table WHERE has(tags_string, 'tag1');
```

```text
┌─id─┬─tags_string────────────┬─tags_int─┐
│  1 │ ['tag1','tag2','tag3'] │ [1,2,3]  │
│  3 │ ['tag1','tag3','tag5'] │ [1,3,5]  │
└────┴────────────────────────┴──────────┘
```

`hasAll(arr, elems)` 함수를 사용하여 `elems` 배열의 모든 요소가 `arr` 배열에 모두 포함된 행을 반환합니다.

테이블을 필터링하여 `tags_string` 배열의 모든 요소가 `['tag1', 'tag2']` 배열에 모두 포함된 행만 반환합니다.

```sql
SELECT * FROM db1.tags_table WHERE hasAll(tags_string, ['tag1', 'tag2']);
```

```text
┌─id─┬─tags_string────────────┬─tags_int─┐
│  1 │ ['tag1','tag2','tag3'] │ [1,2,3]  │
└────┴────────────────────────┴──────────┘
```

`hasAny(arr, elems)` FUNCTION을 사용하면 `elems` 배열의 요소 중 하나 이상이 `arr` 배열에 포함된 행을 반환합니다.

`tags_string` 배열의 요소 중 하나 이상이 `['tag1', 'tag2']` 배열에 포함된 행만 반환하도록 테이블을 필터링합니다.

```sql
SELECT * FROM db1.tags_table WHERE hasAny(tags_string, ['tag1', 'tag2']);
```

```text
┌─id─┬─tags_string────────────┬─tags_int─┐
│  1 │ ['tag1','tag2','tag3'] │ [1,2,3]  │
│  2 │ ['tag2','tag3','tag4'] │ [2,3,4]  │
│  3 │ ['tag1','tag3','tag5'] │ [1,3,5]  │
└────┴────────────────────────┴──────────┘
```

람다 FUNCTION과 `arrayExists(lambda, arr)` FUNCTION을 사용하여 테이블을 필터링할 수 있습니다.

`tags_int` 배열에서 최소 하나의 요소가 3보다 큰 행만 반환하도록 테이블을 필터링합니다.

```sql
SELECT * FROM db1.tags_table WHERE arrayExists(x -> x > 3, tags_int);
```

```text
┌─id─┬─tags_string────────────┬─tags_int─┐
│  2 │ ['tag2','tag3','tag4'] │ [2,3,4]  │
│  3 │ ['tag1','tag3','tag5'] │ [1,3,5]  │
└────┴────────────────────────┴──────────┘
```
