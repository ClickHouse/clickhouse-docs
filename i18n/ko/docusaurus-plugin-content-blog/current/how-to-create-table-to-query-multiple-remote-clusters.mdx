---
title: 여러 원격 클러스터에서 쿼리를 실행할 수 있는 테이블을 만드는 방법
description: "여러 원격 클러스터에서 쿼리를 실행할 수 있는 테이블을 만드는 방법"
date: 2024-07-03
tags: ['배포 및 확장']
keywords: ['쿼리', '원격 클러스터']
---

{frontMatter.description}

{{/* 생략 */}}

***

## Question \{#question\}

다른 클러스터나 인스턴스를 대상으로 쿼리할 수 있는 테이블은 어떻게 생성합니까?

## 답변 \{#answer\}

아래는 기능을 테스트하기 위한 간단한 예제입니다.

이 예제에서는 ClickHouse Cloud를 사용하지만, 자체 호스팅 클러스터를 사용할 때도 동일하게 작동합니다.
대상 노드 또는 로드 밸런서의 URL/호스트/DNS로 대상을 변경해야 합니다.

클러스터 A에서:

```
./clickhouse client --host clusterA.us-west-2.aws.clickhouse.cloud --secure --password 'Password123!'
```

데이터베이스를 생성하세요:

```
create database db1;
```

테이블을 생성하세요:

```
 CREATE TABLE db1.table1_remote1
(
    `id` UInt32,
    `timestamp_column` DateTime,
    `string_column` String
)
ENGINE = MergeTree()
ORDER BY id;
```

샘플 행을 삽입하세요:

```
insert into db1.table1_remote1
values
(1, '2023-09-29 00:01:00', 'a'),
(2, '2023-09-29 00:02:00', 'b'),
(3, '2023-09-29 00:03:00', 'c');
```

클러스터 B에서:

```
./clickhouse client --host clusterB.us-east-2.aws.clickhouse.cloud --secure --password 'Password123!'
```

데이터베이스를 생성하세요:

```
create database db1;
```

테이블을 생성하세요:

```
CREATE TABLE db1.table1_remote2
(
    `id` UInt32,
    `timestamp_column` DateTime,
    `string_column` String
)
ENGINE = MergeTree()
ORDER BY id;
```

샘플 행을 삽입하세요:

```
insert into db1.table1_remote1
values
(4, '2023-09-29 00:04:00', 'x'),
(5, '2023-09-29 00:05:00', 'y'),
(6, '2023-09-29 00:06:00', 'z');
```

클러스터 C:
*이 클러스터는 다른 두 클러스터로부터 데이터를 수집하는 용도로 사용되지만, 데이터 소스로도 사용할 수 있습니다.

```
./clickhouse client --host clusterC.us-west-2.aws.clickhouse.cloud --secure --password 'Password123!'
```

데이터베이스를 생성하세요:

```
create database db1;
```

다른 클러스터에 연결하기 위해 remoteSecure()를 사용하여 원격 테이블을 생성하세요.
원격 클러스터 A 테이블 정의:

```
CREATE TABLE db1.table1_remote1_main
(
    `id` UInt32,
    `timestamp_column` DateTime,
    `string_column` String
) AS remoteSecure('clusterA.us-west-2.aws.clickhouse.cloud:9440', 'db1.table1_remote1', 'default', 'Password123!');
```

원격 클러스터 B 테이블의 정의:

```
CREATE TABLE db1.table1_remote2_main
(
    `id` UInt32,
    `timestamp_column` DateTime,
    `string_column` String
) AS remoteSecure('clusterB.us-east-2.aws.clickhouse.cloud:9440', 'db1.table1_remote2', 'default', 'Password123!')
```

결과를 수집하는 데 사용할 병합 테이블을 CREATE합니다:

```
create table db1.table1_merge_remote
(
  id UInt32,
  timestamp_column DateTime,
  string_column String
)
engine = Merge('db1', 'table.\_main');
```

결과를 확인합니다:

```
clickhouse-cloud :) select * from db1.table1_merge_remote;

SELECT *
FROM db1.table1_merge_remote

Query id: 46b6e741-bbd1-47ed-b40e-69ddb6e0c364

┌─id─┬────timestamp_column─┬─string_column─┐
│  1 │ 2023-09-29 00:01:00 │ a             │
│  2 │ 2023-09-29 00:02:00 │ b             │
│  3 │ 2023-09-29 00:03:00 │ c             │
└────┴─────────────────────┴───────────────┘
┌─id─┬────timestamp_column─┬─string_column─┐
│  4 │ 2023-09-29 00:04:00 │ x             │
│  5 │ 2023-09-29 00:05:00 │ y             │
│  6 │ 2023-09-29 00:06:00 │ z             │
└────┴─────────────────────┴───────────────┘

6 rows in set. Elapsed: 0.275 sec. 
```

자세한 내용은 다음을 참조하세요:

* [원격 테이블 함수](/sql-reference/table-functions/remote)
* [Merge 테이블 엔진](/engines/table-engines/special/merge)