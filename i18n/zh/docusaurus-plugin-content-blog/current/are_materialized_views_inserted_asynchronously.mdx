---
title: 物化视图是同步写入的吗？
description: 本知识库文章探讨物化视图的写入是否为同步进行
date: 2023-03-01
tags: ['数据建模']
keywords: ['物化视图']
---

{frontMatter.description}

{/* 截断 */}


## 物化视图的插入是同步的吗？ \{#are-materialized-views-inserted-synchronously\}

**问题：** 当向一个源表插入新行时，这些新行也会被发送到该源表的所有物化视图。对物化视图的插入是否是同步执行的？也就是说，一旦服务器向客户端确认插入成功，是否就意味着所有物化视图都已经完全更新并可用于查询？

**回答：**

1. 当 `INSERT` 成功时，数据会同时插入到表和所有物化视图中。
2. 对物化视图而言，该插入操作不是原子的。在 `INSERT` 正在执行的那一刻，并发客户端可能会看到中间状态：数据已经插入主表但尚未插入物化视图，或者相反。
3. 如果你使用的是[异步插入（async inserts）](https://clickhouse.com/docs/optimize/asynchronous-inserts/)，它们会先收集数据，然后在内部执行一次常规插入，并向客户端返回与常规插入相同类型的响应。如果客户端在带有 `wait_for_async_insert` 选项（默认如此）的异步插入中收到了成功响应，则表示数据已同时插入到表及其所有物化视图中。

**问题：** 那链式 / 级联物化视图呢？

**回答：**
规则相同——带有成功响应的 `INSERT` 意味着数据已被插入到链中的每一个物化视图。该插入操作仍然是非原子的。