---
title: 如何在 Windows 10 上安装 ClickHouse？
description: "了解如何在 Windows 10 上通过 WSL 2 安装并测试 ClickHouse。内容包括环境搭建、疑难解答以及运行测试环境。"
date: 2023-04-24
tags: ['工具和实用程序']
keywords: ['Windows 10']
---

{frontMatter.description}

{/* 截断 */}

## 如何在 Microsoft Windows 上安装并测试 ClickHouse \{#how-to-install-and-test-clickhouse-on-microsoft-windows\}

在 Windows 10 上安装 ClickHouse 后，在插入数据时可能会遇到错误，例如：

```
DB::Exception: std::__1::__fs::filesystem::filesystem_error: 文件系统错误:重命名操作:权限被拒绝 ["./store/711/71144174-d098-4056-8976-6ad1204205ec/tmp_insert_all_1_1_0/"] ["./store/711/71144174-d098-4056-8976-6ad1204205ec/all_1_1_0/"]。堆栈追踪:
```

在 Windows 10 上，WSL 需要升级到 WSL 2。

* 右键单击 PowerShell 图标并选择“以管理员身份运行”来打开 PowerShell。

* 按照 Microsoft 的说明将 WSL 升级到 WSL 2，链接如下：
  [https://learn.microsoft.com/en-us/windows/wsl/install](https://learn.microsoft.com/en-us/windows/wsl/install)

* 升级完成后，在 PowerShell 中启动 WSL。

```
wsl
```

* 在测试时，请按照以下说明操作，你应该会看到类似的输出：
  由于只是测试，我以 root 用户身份登录，以避免权限问题：

```
sudo -i
```

* 创建 ClickHouse 目录：

```
root@marspc2:~# mkdir /clickhouse
```

* 在新建的目录下下载 ClickHouse：

```
root@marspc2:/# cd clickhouse

root@marspc2:/clickhouse# curl https://clickhouse.com | sh
  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  2739    0  2739    0     0   5515      0 --:--:-- --:--:-- --:--:--  5511

将下载 https://builds.clickhouse.com/master/amd64/clickhouse 至 clickhouse

  % Total    % Received % Xferd  Average Speed   Time    Time     Time  Current
                                 Dload  Upload   Total   Spent    Left  Speed
100  530M  100  530M    0     0  8859k      0  0:01:01  0:01:01 --:--:-- 8549k

ClickHouse 二进制文件下载成功,可通过以下命令运行:
    ./clickhouse

也可以进行安装:
    sudo ./clickhouse install
```

* 启动 ClickHouse 服务器：

```
root@marspc2:/clickhouse# ./clickhouse server
Processing configuration file 'config.xml'.
There is no file 'config.xml', will use embedded config.
Cannot set max size of core file to 1073741824
2023.04.17 19:19:23.155323 [ 500 ] {} <Information> SentryWriter: Sending crash reports is disabled
2023.04.17 19:19:23.165447 [ 500 ] {} <Trace> Pipe: Pipe capacity is 1.00 MiB
2023.04.17 19:19:23.271147 [ 500 ] {} <Information> Application: Starting ClickHouse 23.4.1.1222 (revision: 54473, git hash: 3993aef8e281815ac4269d44e27bb1dcdcff21cb, build id: AF16AA59B689841860F39ACDBED30AC8F9AB70FA), PID 500
2023.04.17 19:19:23.271208 [ 500 ] {} <Information> Application: starting up
2023.04.17 19:19:23.271237 [ 500 ] {} <Information> Application: OS name: Linux, version: 5.15.90.1-microsoft-standard-WSL2, architecture: x86_64
...
```

* 在另一个 WSL 窗口中，启动客户端：

```
root@marspc2:/clickhouse# ./clickhouse client
ClickHouse client version 23.4.1.1222 (official build).
Connecting to localhost:9000 as user default.
Connected to ClickHouse server version 23.4.1 revision 54462.

警告:
 * Linux 透明大页设置为"always"。请检查 /sys/kernel/mm/transparent_hugepage/enabled

marspc2. :)
```

* 创建数据库和表：

```
marspc2. :) create database db1;

CREATE DATABASE db1

Query id: 688f79e2-8132-44ed-98d6-0581abe9903a

Ok.

0 rows in set. Elapsed: 0.007 sec.

marspc2. :) create table db1.table1 (id Int64, string_column String) engine = MergeTree() order by id;

CREATE TABLE db1.table1
(
    `id` Int64,
    `string_column` String
)
ENGINE = MergeTree
ORDER BY id

Query id: d91a93b4-e13f-4e17-8201-f329223287d0

Ok.

0 rows in set. Elapsed: 0.010 sec.
```

* 插入示例数据行：

```
marspc2. :) insert into db1.table1 (id, string_column) values (1, 'a'), (2,'b');

INSERT INTO db1.table1 (id, string_column) FORMAT Values

Query id: 2b274eef-09af-434b-88e0-c25799649910

Ok.

2 rows in set. Elapsed: 0.003 sec.
```

* 查看数据行：

```
marspc2. :) select * from db1.table1;

SELECT *
FROM db1.table1

Query id: 74c76bf1-d944-4b21-a384-cc0b5e6aa579

┌─id─┬─string_column─┐
│  1 │ a             │
│  2 │ b             │
└────┴───────────────┘

2 rows in set. Elapsed: 0.002 sec.
```
