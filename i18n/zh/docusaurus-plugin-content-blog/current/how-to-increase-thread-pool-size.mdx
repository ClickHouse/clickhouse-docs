---
title: 如何增加 ClickHouse 中的线程数量
description: 了解如何通过调整 `max_thread_pool_size`、`thread_pool_queue_size` 和 `max_thread_pool_free_size` 等设置来配置 ClickHouse 的全局线程池（Global Thread Pool）。
date: 2023-03-01
tags: ['性能与优化']
keywords: ['可用线程数']
---

{frontMatter.description}

{/* 截断 */}


## 增加 ClickHouse 中的线程数量

ClickHouse 使用 **Global Thread pool** 中的线程来处理查询，并执行合并、变更等后台操作。如果没有空闲线程可用于处理查询，则会在线程池中创建一个新线程。

全局线程池的最大容量由 `max_thread_pool_size` 设置决定，默认值为 10,000。可以在配置中修改该值——这里我们将其设置为 20,000：

```xml
<max_thread_pool_size>20000</max_thread_pool_size>
```

如果修改 `max_thread_pool_size`，建议将 `thread_pool_queue_size` 也设置为相同的值。`thread_pool_queue_size` 指定的是可以在全局线程池中排队调度的任务的最大数量：

```xml
<thread_pool_queue_size>20000</thread_pool_queue_size>
```

如果服务器存在大量空闲线程，也可以通过 `max_thread_pool_free_size` 设置来释放资源。默认值为 1,000，这意味着全局线程池中的空闲线程数量永远不会超过 1,000。下面的示例将该值提高到 2,000：

```xml
<max_thread_pool_free_size>2000</max_thread_pool_free_size>
```

请参阅[文档](https://clickhouse.com/docs/operations/server-configuration-parameters/settings#max-thread-pool-size)，了解上述设置以及其他影响全局线程池的设置的更多详细信息。
