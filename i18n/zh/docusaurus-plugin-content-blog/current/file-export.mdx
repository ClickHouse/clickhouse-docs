---
title: 如何将 ClickHouse 中的数据导出到文件
description: 了解多种从 ClickHouse 导出数据的方法，包括 `INTO OUTFILE`、File 表引擎以及命令行重定向。
date: 2023-03-22
tags: ['数据导出']
keywords: ['数据导出', 'INTO OUTFILE', 'File 表引擎']
---

{frontMatter.description}

{/* 截断 */}


## 使用 INTO OUTFILE 子句

在查询中添加 [INTO OUTFILE](https://clickhouse.com/docs/sql-reference/statements/select/into-outfile) 子句。

例如：

```sql
SELECT * FROM table INTO OUTFILE 'file'
```

默认情况下，ClickHouse 使用文件名的扩展名来确定输出格式和压缩方式。例如，`nyc_taxi` 中的所有行将会以 Parquet 格式导出到名为 `nyc_taxi.parquet` 的文件中：

```sql
SELECT *
FROM nyc_taxi
INTO OUTFILE 'taxi_rides.parquet'
```

而下面的文件将是一个压缩的制表符分隔文件：

```sql
SELECT *
FROM nyc_taxi
INTO OUTFILE 'taxi_rides.tsv.gz'
```

如果 ClickHouse 无法从文件扩展名确定格式，则默认使用 [TabSeparated](https://clickhouse.com/docs/interfaces/formats) 格式输出数据。要显式指定 [输出格式](https://clickhouse.com/docs/interfaces/formats)，请使用 [FORMAT 子句](https://clickhouse.com/docs/sql-reference/statements/select/format)。

例如：

```sql
SELECT *
FROM nyc_taxi
INTO OUTFILE 'taxi_rides.txt'
FORMAT CSV
```


## 使用 File 表引擎

另一种方式是使用 [File](https://clickhouse.com/docs/engines/table-engines/special/file) 表引擎，此时 ClickHouse 使用文件来存储数据。可以直接对该文件执行查询和插入操作。

例如：

```sql
CREATE TABLE my_table (
   x UInt32,
   y String,
   z DateTime
)
ENGINE = File(Parquet)
```

插入几行记录：

```sql
INSERT INTO my_table VALUES
   (1, '你好', now()),
   (2, '世界', now()),
   (3, '再见', now())
```

该文件存储在 ClickHouse 服务器的 `data` 文件夹中——具体路径为 `/data/default/my_table`，文件名为 `data.Parquet`。

:::note
使用 `File` 表引擎在文件系统上创建和查询文件非常方便，但请记住，`File` 表不是 `MergeTree` 表，因此无法享受 `MergeTree` 带来的全部优势。在需要以便于处理的格式从 ClickHouse 导出数据时，将 `File` 作为一种便捷工具来使用。
:::


## 使用命令行重定向

```bash
$ clickhouse-client --query "SELECT * from table" --format FormatName > result.txt
```

请参阅 [clickhouse-client](https://clickhouse.com/docs/interfaces/cli)。
