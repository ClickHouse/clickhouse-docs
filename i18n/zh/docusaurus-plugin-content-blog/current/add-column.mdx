---
title: 向表中添加列
description: 本指南将介绍如何为现有表添加一列。
date: 2024-12-18
tags: ['数据建模']
keywords: ['添加列']
---

{frontMatter.description}

{/* 截断 */}

## 向表中添加列 \{#adding-a-column-to-a-table\}

我们将使用 clickhouse-local：

```bash
clickhouse -m --output_format_pretty_row_numbers=
```

假设我们有如下表：

```sql
CREATE TABLE events (
    date Date DEFAULT today(), 
    name String
) 
ENGINE = MergeTree
ORDER BY date;
```

我们来添加一条记录：

```sql
INSERT INTO events (name) VALUES ('Alexey');
```

现在来查询 `events` 表：

```sql
SELECT *
FROM events;
```

```text
┌───────date─┬─name───┐
│ 2024-12-18 │ Alexey │
└────────────┴────────┘
```

## 添加新列 \{#adding-a-new-column\}

现在假设我们要添加一个名为 `favoriteNumber`、类型为 `Float64` 的新列。
我们可以使用 [`ALTER TABLE...ADD COLUMN`](/sql-reference/statements/alter/column#add-column) 子句来实现这一点：

```sql
ALTER TABLE events 
ADD COLUMN favoriteNumber Float64 DEFAULT 7;
```

如果我们查询 `events` 表，可以看到如下输出：

```text
┌───────date─┬─name───┬─favoriteNumber─┐
│ 2024-12-18 │ Alexey │              7 │
└────────────┴────────┴────────────────┘
```

由于在插入该行时该列尚不存在，`Alexey` 这一行的默认值为 7。
接下来，让我们再添加一列：

```sql
INSERT INTO events (name) VALUES ('Tyler');
```

如果我们查询 `events` 表，会看到如下输出结果：

```text
┏━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┓
┃       日期 ┃ 姓名   ┃ 最喜欢的数字   ┃
┡━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━┩
│ 2024-12-18 │ Tyler  │              7 │
├────────────┼────────┼────────────────┤
│ 2024-12-18 │ Alexey │              7 │
└────────────┴────────┴────────────────┘
```

## 修改列的默认值 \{#modifying-a-columns-default-value\}

如果我们使用 [`ALTER TABLE...MODIFY COLUMN`](/sql-reference/statements/alter/column#modify-column) 子句将 `favoriteNumber` 列修改为其他类型，就会出现一些有趣的情况：

```sql
ALTER TABLE events 
MODIFY COLUMN favoriteNumber Float64 DEFAULT 99;
```

如果我们再次查询 `events`，就会看到如下输出：

```text
┏━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┓
┃       日期 ┃ 姓名   ┃ 最喜欢的数字   ┃
┡━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━┩
│ 2024-12-18 │ Tyler  │              7 │
├────────────┼────────┼────────────────┤
│ 2024-12-18 │ Alexey │             99 │
└────────────┴────────┴────────────────┘
```

`Tyler` 的取值保持为 `7`，这是创建该行时的默认值。
`Alexey` 采用了新的默认值 `99`，因为在创建该行时 `favoriteNumber` 列尚不存在。

如果我们希望 `Alexey` 这一行立即使用当前默认值，就需要调用 [`OPTIMIZE TABLE`](/sql-reference/statements/optimize)，强制将当前默认值写入磁盘：

```sql
OPTIMIZE TABLE events;
```

完成上述操作后，假设我们再次修改默认值：

```sql
ALTER TABLE events 
MODIFY COLUMN favoriteNumber Float64 DEFAULT 21;
```

接着再插入一行：

```sql
INSERT INTO events (name) VALUES ('Tanya');
```

最后，我们再查询一次 `events` 表：

```text
┏━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┓
┃       日期 ┃ 姓名   ┃ 喜爱数字 ┃
┡━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━┩
│ 2024-12-18 │ Alexey │             99 │
├────────────┼────────┼────────────────┤
│ 2024-12-18 │ Tyler  │              7 │
├────────────┼────────┼────────────────┤
│ 2024-12-18 │ Tanya  │             21 │
└────────────┴────────┴────────────────┘
```

`Tanya` 采用了新的默认值 `21`，而 `Alexey` 仍然保留旧的默认值 `99`。

## 控制表中列的位置 \{#controlling-column-position-in-table\}

当我们向表中添加新列时，默认情况下它会被添加到表的末尾。
不过，我们可以使用 `FIRST` 和 `AFTER` 子句来控制列的位置。

例如，如果我们想在 `name` 列之后添加一个名为 `favoriteColor` 的列，可以这样做：

```sql
ALTER TABLE events
ADD COLUMN favoriteColor String DEFAULT 'Yellow' AFTER name;
```

查询 `events`：

```text
┏━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┓
┃       日期 ┃ 姓名   ┃ 最喜欢的颜色  ┃ 最喜欢的数字   ┃
┡━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━┩
│ 2024-12-18 │ Alexey │ 黄色        │             99 │
├────────────┼────────┼───────────────┼────────────────┤
│ 2024-12-18 │ Tyler  │ 黄色        │              7 │
├────────────┼────────┼───────────────┼────────────────┤
│ 2024-12-18 │ Tanya  │ 黄色        │             21 │
└────────────┴────────┴───────────────┴────────────────┘
```

如果我们想添加一列 `favoriteDatabase` 并将其作为第一列，可以这样做：

```sql
ALTER TABLE events
ADD COLUMN favoriteDatabase String DEFAULT 'ClickHouse' FIRST;
```

```text
┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┓
┃ favoriteDatabase ┃       date ┃ name   ┃ favoriteColor ┃ favoriteNumber ┃
┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━┩
│ ClickHouse       │ 2024-12-18 │ Tanya  │ Yellow        │             21 │
├──────────────────┼────────────┼────────┼───────────────┼────────────────┤
│ ClickHouse       │ 2024-12-18 │ Alexey │ Yellow        │             99 │
├──────────────────┼────────────┼────────┼───────────────┼────────────────┤
│ ClickHouse       │ 2024-12-18 │ Tyler  │ Yellow        │              7 │
└──────────────────┴────────────┴────────┴───────────────┴────────────────┘
```

接下来来看一下这张表的定义：

```sql
SHOW CREATE TABLE events
FORMAT LineAsString
```

```sql
CREATE TABLE default.`clickhouse-local-ab404c86-56cc-495b-ad1d-fb343cac3bc0events`
(
    `favoriteDatabase` String DEFAULT 'ClickHouse',
    `date` Date DEFAULT today(),
    `name` String,
    `favoriteColor` String DEFAULT 'Yellow',
    `favoriteNumber` Float64 DEFAULT 21
)
ENGINE = MergeTree
ORDER BY date
SETTINGS index_granularity = 8192
```
