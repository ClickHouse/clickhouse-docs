---
title: 通过设置反向代理创建自定义 DNS 别名
description: 了解如何使用反向代理为实例设置自定义 DNS 别名
date: 2025-05-16
tags: ['服务器管理', '安全与认证']
keywords: ['自定义 DNS 别名', 'DNS']
hide_title: true
---

{frontMatter.description}

{/* 截断 */}

<br />

<br />


# 通过设置反向代理实现自定义 DNS 别名 \{#custom-dns-alias\}

> 在这篇知识库文章中，我们将向您介绍如何通过使用 Nginx 等反向代理，
> 为您的 ClickHouse Cloud 实例设置自定义 DNS 别名，以供 ClickHouse 原生客户端使用。

## 创建自签名证书

:::note
如果您使用的是签名证书，则不需要此步骤。
:::

使用您选择的域名创建自签名证书。
在本示例中，我们将使用域名 `xyz-customdomain.com`，并
创建一个名为 `MyCertificate.crt` 的证书。有关更多详细信息，请参阅 [&quot;Create SSL certificates&quot;](/guides/sre/configuring-ssl#2-create-ssl-certificates)。

将证书添加到 `/etc/clickhouse-client/config.xml` 中：

```yaml
<clickhouse>
    <openSSL>
        <client>
            <loadDefaultCAFile>false</loadDefaultCAFile>
            # highlight-next-line
            <caConfig>/etc/ssl/certs/MyCertificate.crt</caConfig>
            <cacheSessions>true</cacheSessions>
            <disableProtocols>sslv2,sslv3</disableProtocols>
            <preferServerCiphers>true</preferServerCiphers>
            <invalidCertificateHandler>
                <name>RejectCertificateHandler</name>
            </invalidCertificateHandler>
        </client>
    </openSSL>
</clickhouse>
```


## 更新 Nginx 配置

在你的 `nginx.conf` 配置文件中添加如下内容：

```text
proxy_ssl_name xyz.us-west-2.aws.clickhouse.cloud;
proxy_ssl_server_name on;
```

```text
stream {
    upstream stream_backend {
         server xyz.us-west-2.aws.clickhouse.cloud:9440;
    }

    server {
        listen                9440 ssl;
        proxy_pass            stream_backend;

        ssl_certificate       /etc/ssl/certs/MyCertificate.crt;
        ssl_certificate_key   /etc/ssl/certs/MyKey.key;
        ssl_protocols         SSLv3 TLSv1 TLSv1.1 TLSv1.2;
        ssl_ciphers           HIGH:!aNULL:!MD5;
        ssl_session_cache     shared:SSL:20m;
        ssl_session_timeout   4h;
        ssl_handshake_timeout 30s;
	proxy_ssl on;
	proxy_ssl_trusted_certificate /etc/ssl/certs/isrgrootx1.pem;
	proxy_ssl_session_reuse on;
        proxy_ssl_verify on;
    #highlight-next-line
	proxy_ssl_name xyz.us-west-2.aws.clickhouse.cloud;
    #highlight-next-line
	proxy_ssl_server_name on;
    }
}
```

其中 `isrgrootx1.pem` 是 ClickHouse Cloud 的根证书，该证书可从[此处](https://letsencrypt.org/certs/isrgrootx1.pem)下载。


## 更新 hosts 文件

:::note
如果您使用的是自己的域控制器，则无需执行以下步骤。
:::

在 Nginx 服务器上，将以下内容添加到您的 `/etc/hosts` 文件中：

```text title='/etc/hosts'
127.0.0.1   localhost localhost.localdomain localhost4 localhost4.localdomain4
::1         localhost6 localhost6.localdomain6
10.X.Y.Z  xyz-customdomain.com
```

其中 `10.X.Y.Z` 是你所使用的 Nginx 服务器的 IP 地址。


## 使用别名连接到 Cloud

现在可以使用自定义别名进行连接：

```bash
clickhouse-client --host xyz.customdomain.com --secure --password 'xxxxxxx'
ClickHouse 客户端版本 23.12.1.428（官方构建版本）。
正在以 default 用户身份连接到 xyz.customdomain.com:9440。
已连接到 ClickHouse 服务器版本 23.9.2。

clickhouse-cloud :)
```
