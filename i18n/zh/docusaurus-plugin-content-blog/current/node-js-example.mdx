---
title: å¦‚ä½•åœ¨ Node.js ä¸­ä½¿ç”¨ @clickhouse/client
description: "äº†è§£å¦‚ä½•åœ¨ Node.js åº”ç”¨ä¸­ä½¿ç”¨ @clickhouse/client ä¸ ClickHouse äº¤äº’å¹¶æ‰§è¡ŒæŸ¥è¯¢ã€‚"
date: 2023-11-22
tags: ['è¯­è¨€å®¢æˆ·ç«¯']
keywords: ['NodeJS']
---

{frontMatter.description}

{/* æˆªæ–­ */}

## åœ¨ Node.js ä¸­ä½¿ç”¨ @clickhouse/client \{#use-nodejs-with-clickhouseclient\}

ä¸‹é¢æ˜¯ä¸€ä¸ªåŸºæœ¬ç¤ºä¾‹ä»£ç æ–‡ä»¶ `main.ts`ã€‚

`package.json`ï¼ˆå°†å…¶æ”¾åœ¨é¡¹ç›®æ ¹ç›®å½• `./` ä¸‹ï¼‰ï¼š

```json
{
  "name": "ä¸€ä¸ªç®€å•çš„ ClickHouse å®¢æˆ·ç«¯ç¤ºä¾‹",
  "version": "1.0.0",
  "main": "main.js",
  "license": "MIT",
  "devDependencies": {
    "typescript": "^5.3.2"
  },
  "dependencies": {
    "@clickhouse/client": "^0.2.6"
  }
}
```

`Main.ts`ï¼ˆå°†å…¶æ”¾åœ¨ `./src` ç›®å½•ä¸‹ï¼‰ï¼š

```ts
import { ClickHouseClient, createClient } from '@clickhouse/client'; // or '@clickhouse/client-web'

interface ClickHouseResultSet<T> {
  meta: Meta[];
  data: T[];
  rows: number;
  statistics: Statistics;
}

interface Statistics {
  elapsed: number;
  rows_read: number;
  bytes_read: number;
}

interface Meta {
  name: string;
  type: string;
}

interface Count {
  c: number;
}

//è¯·æ ¹æ®éœ€è¦æ›¿æ¢å®¢æˆ·ç«¯è¿æ¥å‚æ•°,å¦‚ `host`ã€
//`username`ã€`password`ã€`database`ã€‚

const initClickHouseClient = async (): Promise<ClickHouseClient> => {
  const client = createClient({
    host: 'https://FQDN.aws.clickhouse.cloud',
    username: 'default',
    password: 'password',
    database: 'default',
    application: `pingpong`,
  });

  console.log('ClickHouse ping');
  if (!(await client.ping())) {
    throw new Error('ClickHouse ping å¤±è´¥!');
  }
  console.log('ClickHouse pong!');
  return client;
};

const main = async () => {
  console.log('æ­£åœ¨åˆå§‹åŒ– ClickHouse å®¢æˆ·ç«¯');
  const client = await initClickHouseClient();

  const row = await client.query({
    query: `SELECT count() AS c FROM system.tables WHERE database='system'`,
  });

  const jsonRow: ClickHouseResultSet<Count> = await row.json();

  console.log(`æ‰¾åˆ° ${jsonRow.data[0].c} ä¸ªç³»ç»Ÿè¡¨!`);

  await client.close();
  console.log(`ğŸ‘‹`);
};

main();
```

è¦å®‰è£…è½¯ä»¶åŒ…ï¼Œè¯·åœ¨ `./` ç›®å½•ä¸‹è¿è¡Œ `yarn`ï¼š

```
$ yarn
yarn install v1.22.19
[1/4] ğŸ”  æ­£åœ¨è§£æè½¯ä»¶åŒ…...
[2/4] ğŸšš  æ­£åœ¨è·å–è½¯ä»¶åŒ…...
[3/4] ğŸ”—  æ­£åœ¨é“¾æ¥ä¾èµ–é¡¹...
[4/4] ğŸ”¨  æ­£åœ¨æ„å»ºè½¯ä»¶åŒ…...
âœ¨  å®Œæˆ,ç”¨æ—¶ 0.14 ç§’ã€‚
```

åœ¨ `./` ç›®å½•ä¸‹ä½¿ç”¨ä»¥ä¸‹å‘½ä»¤æ‰§è¡Œ `main.ts` ä¸­çš„ä»£ç ï¼š

```
$ npx ts-node src/main.ts
```

å°†è¾“å‡ºï¼š

```
æ­£åœ¨åˆå§‹åŒ– ClickHouse å®¢æˆ·ç«¯
ClickHouse ping
ClickHouse pong!
å·²æ‰¾åˆ° 120 ä¸ªç³»ç»Ÿè¡¨ï¼
ğŸ‘‹
```
