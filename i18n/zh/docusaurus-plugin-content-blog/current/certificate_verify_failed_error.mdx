---
title: 解决 ClickHouse 中的 SSL 证书验证错误
description: 了解如何解决 SSL 证书验证失败（CERTIFICATE_VERIFY_FAILED）异常。
date: 2023-05-02
tags: ['安全与认证', '错误与异常']
keywords: ['错误', 'SSL 证书', '210']
---

{frontMatter.description}

{/* 截断 */}

## 解决 ClickHouse 中代码 210 SSL 证书验证错误 \{#resolving-ssl-certificate-verify-error-in-clickhouse\}

该错误通常报为：

`Code: 210. DB::NetException: SSL Exception: error:1000007d:SSL routines:OPENSSL_internal:CERTIFICATE_VERIFY_FAILED`

## 错误原因 \{#cause-of-the-error\}

在使用 `clickhouse-client` 连接 ClickHouse 服务器时可能会出现此错误。错误的原因可能是：

* 客户端配置文件 `config.xml` 中未包含机器默认 CA 存储中的根证书，或
* 存在未配置的自签名证书或内部 CA 证书

## 解决方案 \{#solution\}

如果使用内部或自签名 CA，请在客户端目录（例如 `/etc/clickhouse-client`）中的 `config.xml` 中配置 CA 根证书，并禁用从默认路径加载系统默认根 CA 证书的功能。

下面是一个示例配置：

```xml
<openSSL>
    <client>
        <loadDefaultCAFile>false</loadDefaultCAFile>
        <caConfig>/etc/clickhouse-server/certs/marsnet_ca.crt</caConfig>
        <cacheSessions>true</cacheSessions>
        <disableProtocols>sslv2,sslv3</disableProtocols>
        <preferServerCiphers>true</preferServerCiphers>
        <invalidCertificateHandler>
            <name>RejectCertificateHandler</name>
        </invalidCertificateHandler>
    </client>
</openSSL>
```

## 其他资源 \{#additional-resources\}

参阅 [https://clickhouse.com/docs/interfaces/cli/#configuration&#95;files](https://clickhouse.com/docs/interfaces/cli/#configuration_files)