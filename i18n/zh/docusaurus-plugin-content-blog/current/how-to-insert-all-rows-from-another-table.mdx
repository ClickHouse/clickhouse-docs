---
title: 如何将一个表中的所有行插入到另一个表中？
description: "一篇关于如何将一个表中的所有行插入到另一个表中的知识库文章。"
date: 2024-12-17
tags: ['数据摄取']
keywords: ['从表插入数据']
---

{frontMatter.description}

{/* 截断 */}


## 介绍 \{#introduction\}

有时你需要将一个表中的所有数据重新摄取到另一个表中。

例如，你可能希望将数据从 staging 表重新摄取到 production 表中。本文展示了如何使用 `INSERT INTO` 语句来完成这一操作。

## 示例

下面是一个简单示例，演示其工作原理以及如何测试：

* 创建一个示例数据库

```sql
CREATE DATABASE db1;
```

* 创建示例表

```sql
CREATE TABLE db1.source_table
(
    city VARCHAR,
    country VARCHAR,
    continent VARCHAR
)
engine = MergeTree()
ORDER BY continent;
```

* 向源表中插入一些数据

```sql
INSERT INTO db1.source_table (city, country, continent)
VALUES
    ('New York', 'USA', 'North America'),
    ('Tokyo', 'Japan', 'Asia'),
    ('Berlin', 'Germany', 'Europe'),
    ('Paris', 'France', 'Europe'),
    ('Cairo', 'Egypt', 'Africa'),
    ('Sydney', 'Australia', 'Australia');
```

* 检查源表的行数

```sql
SELECT COUNT(*) FROM db1.source_table;
```

```text
┌─count()─┐
│      6  │
└─────────┘
```

* 创建一个与源表结构相同的新表。

```sql
CREATE TABLE db1.target_table AS db1.source_table;
```

* 将源表中的所有行插入到目标表中。

```sql
INSERT INTO db1.target_table SELECT * FROM db1.source_table;
```

* 检查目标表的行数

```sql
SELECT COUNT(*) FROM db1.target_table;
```

```text
┌─count()─┐
│      6  │
└─────────┘
```

如果您想修改新表的结构，可以先查看源表的结构。

```sql
SHOW CREATE TABLE db1.source_table;
```

然后基于修改后的结构创建新表。在本例中，我们希望在目标表中新增一列 `population`。

```sql
CREATE TABLE db1.target_table_population
(
    `city` String,
    `country` String,
    `continent` String,
    `population` UInt16,
)
ENGINE = MergeTree
ORDER BY continent;
```

* 将源表中的所有行插入到目标表中，包括新增的列，并将所有行的 population 字段设为 0。

```sql
INSERT INTO db1.target_table_population (city, country, continent, population)
SELECT city, country, continent, 0 FROM db1.source_table;
```

* 检查目标表中的数据

```sql
SELECT * FROM db1.target_table_population LIMIT 3;
```

```text
┌─城市──────┬─国家───┬─大陆──────┬─人口─┐
│ 纽约  │ 美国       │ 北美洲  │          0 │
│ 东京     │ 日本     │ 亚洲           │          0 │
│ 柏林    │ 德国   │ 欧洲         │          0 │
└───────────┴───────────┴────────────────┴────────────┘
```
