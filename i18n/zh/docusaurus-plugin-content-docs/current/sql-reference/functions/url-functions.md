---
description: '用于处理 URL 的函数的文档'
sidebar_label: 'URL 函数'
slug: /sql-reference/functions/url-functions
title: '处理 URL 的函数'
doc_type: 'reference'
---

# 用于处理 URL 的函数 \{#functions-for-working-with-urls\}

## 概述 \{#overview\}

:::note
本节中提到的函数为了获得尽可能高的性能而进行了优化，因此在大多数情况下不遵循 RFC 3986 标准。
实现 RFC 3986 的函数会在函数名后附加 `RFC`，通常性能会较低。
:::

在处理不包含用户信息字符串或 `@` 符号的公共注册域名时，一般可以使用非 `RFC` 版本的函数。
下表详细说明了 URL 中的哪些符号可以（`✔`）或不可以（`✗`）被对应的 `RFC` 和非 `RFC` 版本解析：

| Symbol      | non-`RFC` | `RFC` |   |
| ----------- | --------- | ----- | - |
| &#39; &#39; | ✗         | ✗     |   |
| \t          | ✗         | ✗     |   |
| &lt;        | ✗         | ✗     |   |
| &gt;        | ✗         | ✗     |   |
| %           | ✗         | ✔*    |   |
| &#123;      | ✗         | ✗     |   |
| &#125;      | ✗         | ✗     |   |
|             |           | ✗     | ✗ |
| |           | ✗         | ✗     |   |
| \           | ✗         | ✗     |   |
| ^           | ✗         | ✗     |   |
| ~           | ✗         | ✔*    |   |
| [           | ✗         | ✗     |   |
| ]           | ✗         | ✔     |   |
| ;           | ✗         | ✔*    |   |
| =           | ✗         | ✔*    |   |
| &amp;       | ✗         | ✔*    |   |

带有 `*` 标记的符号是 RFC 3986 中的子分隔符，并且在 `@` 符号之后的用户信息中是允许的。

URL 函数分为两类：

* 提取 URL 某一部分的函数。若 URL 中不存在相关部分，则返回空字符串。
* 移除 URL 某一部分的函数。若 URL 中不存在类似部分，则 URL 保持不变。

:::note
下面列出的函数是从 `system.functions` 系统表中生成的。
:::

{/* 
    下列标签内的内容会在文档框架构建时被替换为
    从 system.functions 生成的文档。请不要修改或删除这些标签。
    参见：https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
  */ }

{/*AUTOGENERATED_START*/ }

## URLHierarchy \{#URLHierarchy\}

引入于：v1.1

返回一个数组，包含在路径和查询字符串中以符号 `/`、`?` 和 `#` 为结尾截断得到的 URL 片段。连续的分隔符字符被视为一个。结果的第一个元素为仅包含协议和主机名的 URL，此后各元素为路径逐步延长所形成的层级结构。

**语法**

```sql
URLHierarchy(url)
```

**参数**

* `url` — 要处理的 URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回一个数组，包含依次递增长度、构成层级结构的 URL。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**基本用法**

```sql title=Query
SELECT URLHierarchy('https://example.com/a/b?c=1')
```

```response title=Response
['https://example.com/','https://example.com/a/','https://example.com/a/b','https://example.com/a/b?c=1']
```

## URLPathHierarchy \{#URLPathHierarchy\}

引入版本：v1.1

返回一个数组，其中包含 URL 的路径部分，在遇到符号 `/`、`?` 和 `#` 时进行截断。与 `URLHierarchy` 不同，结果不包含协议和主机——它从路径开始。连续的分隔符字符会被视作一个分隔符。

**语法**

```sql
URLPathHierarchy(url)
```

**参数**

* `url` — 要处理的 URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回一个由逐渐变长的 URL 路径段组成的数组，构成一个层级结构。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**基本用法**

```sql title=Query
SELECT URLPathHierarchy('https://example.com/a/b?c=1')
```

```response title=Response
['/a/','/a/b','/a/b?c=1']
```

## cutFragment \{#cutFragment\}

引入版本：v1.1

从 URL 中移除片段标识符（包括 # 号）。

**语法**

```sql
cutFragment(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回去除片段标识符的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**用法示例**

```sql title=Query
SELECT cutFragment('http://example.com/path?query=value#fragment123');
```

```response title=Response
┌─cutFragment('http://example.com/path?query=value#fragment123')─┐
│ http://example.com/path?query=value                            │
└────────────────────────────────────────────────────────────────┘
```

## cutQueryString \{#cutQueryString\}

自 v1.1 版本引入

从 URL 中移除查询字符串（query string），包括问号本身。

**语法**

```sql
cutQueryString(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回移除了查询字符串的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**用法示例**

```sql title=Query
SELECT cutQueryString('http://example.com/path?query=value&param=123#fragment');
```

```response title=Response
┌─cutQueryString('http://example.com/path?query=value&param=123#fragment')─┐
│ http://example.com/path#fragment                                         │
└──────────────────────────────────────────────────────────────────────────┘
```

## cutQueryStringAndFragment \{#cutQueryStringAndFragment\}

自 v1.1 引入

从 URL 中移除查询字符串和片段标识符，包括问号（?）和井号（#）。

**语法**

```sql
cutQueryStringAndFragment(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回去除查询字符串和片段标识符后的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**用法示例**

```sql title=Query
SELECT cutQueryStringAndFragment('http://example.com/path?query=value&param=123#fragment');
```

```response title=Response
┌─cutQueryStringAndFragment('http://example.com/path?query=value&param=123#fragment')─┐
│ http://example.com/path                                                             │
└─────────────────────────────────────────────────────────────────────────────────────┘
```

## cutToFirstSignificantSubdomain \{#cutToFirstSignificantSubdomain\}

引入版本：v1.1

返回域名中，包含从顶级子域到[第一个显著子域](/sql-reference/functions/url-functions#firstSignificantSubdomain)这一部分的内容。

**语法**

```sql
cutToFirstSignificantSubdomain(url)
```

**参数**

* `url` — 要处理的 URL 或域名字符串。[`String`](/sql-reference/data-types/string)

**返回值**

返回域名中，从顶级后缀起向左直至第一个重要子域名（含）为止的那一部分；如果无法确定，则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**用法示例**

```sql title=Query
SELECT
    cutToFirstSignificantSubdomain('https://news.clickhouse.com.tr/'),
    cutToFirstSignificantSubdomain('www.tr'),
    cutToFirstSignificantSubdomain('tr');
```

```response title=Response
┌─cutToFirstSignificantSubdomain('https://news.clickhouse.com.tr/')─┬─cutToFirstSignificantSubdomain('www.tr')─┬─cutToFirstSignificantSubdomain('tr')─┐
│ clickhouse.com.tr                                                 │ tr                                       │                                      │
└───────────────────────────────────────────────────────────────────┴──────────────────────────────────────────┴──────────────────────────────────────┘
```

## cutToFirstSignificantSubdomainCustom \{#cutToFirstSignificantSubdomainCustom\}

引入版本：v21.1

返回域名中从顶级域开始一直到第一个重要子域（包含在内）的部分。接受自定义的 [TLD 列表](https://en.wikipedia.org/wiki/List_of_Internet_top-level_domains) 名称。如果需要最新的 TLD 列表或使用自定义列表时，该函数会很有用。

**配置示例**

```yaml
<!-- <top_level_domains_path>/var/lib/clickhouse/top_level_domains/</top_level_domains_path> -->
<top_level_domains_lists>
    <!-- https://publicsuffix.org/list/public_suffix_list.dat -->
    <public_suffix_list>public_suffix_list.dat</public_suffix_list>
    <!-- NOTE: path is under top_level_domains_path -->
</top_level_domains_lists>
```

**语法**

```sql
cutToFirstSignificantSubdomainCustom(url, tld_list_name)
```

**参数**

* `url` — 要处理的 URL 或域名字符串。[`String`](/sql-reference/data-types/string)
* `tld_list_name` — 在 ClickHouse 中配置的自定义 TLD 列表名称。[`const String`](/sql-reference/data-types/string)

**返回值**

返回域名的一部分，该部分包含自顶级域名起直到第一个重要子域的所有子域。[`String`](/sql-reference/data-types/string)

**示例**

**为非标准域名使用自定义 TLD 列表**

```sql title=Query
SELECT cutToFirstSignificantSubdomainCustom('bar.foo.there-is-no-such-domain', 'public_suffix_list')
```

```response title=Response
foo.there-is-no-such-domain
```

## cutToFirstSignificantSubdomainCustomRFC \{#cutToFirstSignificantSubdomainCustomRFC\}

引入版本：v22.10

返回域名中从顶级子域开始直至第一个重要子域的那一部分。
接受自定义的 [TLD 列表](https://en.wikipedia.org/wiki/List_of_Internet_top-level_domains)名称。
当需要一份最新的 TLD 列表或使用自定义列表时，此函数会很有用。
类似于 [cutToFirstSignificantSubdomainCustom](#cutToFirstSignificantSubdomainCustom)，但符合 RFC 3986。

**配置示例**

```xml
<!-- <top_level_domains_path>/var/lib/clickhouse/top_level_domains/</top_level_domains_path> -->
<top_level_domains_lists>
    <!-- https://publicsuffix.org/list/public_suffix_list.dat -->
    <public_suffix_list>public_suffix_list.dat</public_suffix_list>
    <!-- NOTE: path is under top_level_domains_path -->
</top_level_domains_lists>
```

**语法**

```sql
cutToFirstSignificantSubdomainCustomRFC(url, tld_list_name)
```

**参数**

* `url` — 需要根据 RFC 3986 进行处理的 URL 或域名字符串。- `tld_list_name` — 在 ClickHouse 中配置的自定义 TLD 列表名称。

**返回值**

返回域名中从顶级子域到第一个重要子域（含）这一部分。[`String`](/sql-reference/data-types/string)

**示例**

**用法示例**

```sql title=Query
SELECT cutToFirstSignificantSubdomainCustomRFC('www.foo', 'public_suffix_list');
```

```response title=Response
┌─cutToFirstSignificantSubdomainCustomRFC('www.foo', 'public_suffix_list')─────┐
│ www.foo                                                                      │
└──────────────────────────────────────────────────────────────────────────────┘
```

## cutToFirstSignificantSubdomainCustomWithWWW \{#cutToFirstSignificantSubdomainCustomWithWWW\}

引入版本：v21.1

返回域名中从顶级子域开始，一直到第一个重要子域之间的部分，但不会去除前缀 &#39;www&#39;。接受自定义的 TLD 列表名称。如果需要使用最新的 TLD 列表或自定义列表，可以使用此函数。

**配置示例**

````yaml
<!-- <top_level_domains_path>/var/lib/clickhouse/top_level_domains/</top_level_domains_path> -->
<top_level_domains_lists>
    <!-- https://publicsuffix.org/list/public_suffix_list.dat -->
    <public_suffix_list>public_suffix_list.dat</public_suffix_list>
    <!-- NOTE: path is under top_level_domains_path -->
</top_level_domains_lists>
    

**Syntax**

```sql
cutToFirstSignificantSubdomainCustomWithWWW(url, tld_list_name)
````

**参数**

* `url` — 要处理的 URL 或域名字符串。- `tld_list_name` — 在 ClickHouse 中配置的自定义 TLD 列表名称。

**返回值**

包含从最顶层子域名到第一个有意义子域名的域名部分，且不会去除 &#39;www&#39;。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT cutToFirstSignificantSubdomainCustomWithWWW('www.foo', 'public_suffix_list');
```

```response title=Response
┌─cutToFirstSignificantSubdomainCustomWithWWW('www.foo', 'public_suffix_list')─┐
│ www.foo                                                                      │
└──────────────────────────────────────────────────────────────────────────────┘
```

## cutToFirstSignificantSubdomainCustomWithWWWRFC \{#cutToFirstSignificantSubdomainRFC\}

引入于：v22.10

返回域名中包含顶级域及其子域、直到第一个有意义子域的部分，但不会去除 `www`。
接受自定义 TLD 列表的名称。
当需要更新的 TLD 列表或使用自定义列表时，这会非常有用。
类似于 [cutToFirstSignificantSubdomainCustomWithWWW](#cutToFirstSignificantSubdomainCustomWithWWW)，但符合 [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986)。

**配置示例**

````xml
<!-- <top_level_domains_path>/var/lib/clickhouse/top_level_domains/</top_level_domains_path> -->
<top_level_domains_lists>
    <!-- https://publicsuffix.org/list/public_suffix_list.dat -->
    <public_suffix_list>public_suffix_list.dat</public_suffix_list>
    <!-- NOTE: path is under top_level_domains_path -->
</top_level_domains_lists>
    

**Syntax**

```sql
cutToFirstSignificantSubdomainCustomWithWWWRFC(url, tld_list_name)
````

**参数**

* `url` — 待根据 RFC 3986 解析的 URL 或域名字符串。- `tld_list_name` — 在 ClickHouse 中配置的自定义 TLD 列表名称。

**返回值**

返回包含顶级子域名直到第一个重要子域名的域名部分，并且保留 `www`。[`String`](/sql-reference/data-types/string)

**示例**

**使用自定义 TLD 列表的 RFC 3986 解析（保留 www）**

```sql title=Query
SELECT cutToFirstSignificantSubdomainCustomWithWWWRFC('https://www.subdomain.example.custom', 'public_suffix_list')
```

```response title=Response
www.example.custom
```

## cutToFirstSignificantSubdomainRFC \{#cutToFirstSignificantSubdomainWithWWW\}

引入于：v22.10

返回域名中自顶级子域起，直至[“first significant subdomain”](/sql-reference/functions/url-functions#firstSignificantSubdomain)（第一个重要子域）之间的部分。与 [`cutToFirstSignificantSubdomain`](#cutToFirstSignificantSubdomain) 类似，但符合 [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986)。

**语法**

```sql
cutToFirstSignificantSubdomainRFC(url)
```

**参数**

* `url` — 按照 RFC 3986 进行解析的 URL 或域名字符串。[`String`](/sql-reference/data-types/string)

**返回值**

返回域名中从顶级子域到第一个重要子域的这部分（如果可能），否则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT
    cutToFirstSignificantSubdomain('http://user:password@example.com:8080'),
    cutToFirstSignificantSubdomainRFC('http://user:password@example.com:8080');
```

```response title=Response
┌─cutToFirstSignificantSubdomain('http://user:password@example.com:8080')─┬─cutToFirstSignificantSubdomainRFC('http://user:password@example.com:8080')─┐
│                                                                         │ example.com                                                                │
└─────────────────────────────────────────────────────────────────────────┴────────────────────────────────────────────────────────────────────────────┘
```

## cutToFirstSignificantSubdomainWithWWW \{#cutToFirstSignificantSubdomainWithWWWRFC\}

引入于：v20.12

返回域名中从顶级子域到“第一个有意义子域名”的部分，并且不去除 &#39;www.&#39;。

类似于 [`cutToFirstSignificantSubdomain`](#cutToFirstSignificantSubdomain)，但如果存在则保留 &#39;www.&#39; 前缀。

**语法**

```sql
cutToFirstSignificantSubdomainWithWWW(url)
```

**参数**

* `url` — 要处理的 URL 或域名字符串。[`String`](/sql-reference/data-types/string)

**返回值**

返回域名中从顶级子域开始直到第一个重要子域（含 www）这一部分；若无法确定，则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**用法示例**

```sql title=Query
SELECT
    cutToFirstSignificantSubdomainWithWWW('https://news.clickhouse.com.tr/'),
    cutToFirstSignificantSubdomainWithWWW('www.tr'),
    cutToFirstSignificantSubdomainWithWWW('tr');
```

```response title=Response
┌─cutToFirstSignificantSubdomainWithWWW('https://news.clickhouse.com.tr/')─┬─cutToFirstSignificantSubdomainWithWWW('www.tr')─┬─cutToFirstSignificantSubdomainWithWWW('tr')─┐
│ clickhouse.com.tr                                                        │ www.tr                                          │                                             │
└──────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────┴─────────────────────────────────────────────┘
```

## cutToFirstSignificantSubdomainWithWWWRFC \{#cutURLParameter\}

引入版本：v22.10

返回域名中，从顶级子域开始直到“第一个重要子域”的那一部分，但不会去除 &#39;www&#39;。类似于 [`cutToFirstSignificantSubdomainWithWWW`](#cutToFirstSignificantSubdomainWithWWW)，但符合 [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986)。

**语法**

```sql
cutToFirstSignificantSubdomainWithWWWRFC(url)
```

**参数**

* `url` — 需要根据 RFC 3986 进行处理的 URL 或域名字符串。

**返回值**

返回域名中从顶级子域名开始（在可能的情况下包含 &#39;www&#39;），一直到第一个重要子域名为止的部分；否则返回空字符串 [`String`](/sql-reference/data-types/string)。

**示例**

**使用示例**

```sql title=Query
SELECT
    cutToFirstSignificantSubdomainWithWWW('http:%2F%2Fwwwww.nova@mail.ru/economicheskiy'),
    cutToFirstSignificantSubdomainWithWWWRFC('http:%2F%2Fwwwww.nova@mail.ru/economicheskiy');
```

```response title=Response
┌─cutToFirstSignificantSubdomainWithWWW('http:%2F%2Fwwwww.nova@mail.ru/economicheskiy')─┬─cutToFirstSignificantSubdomainWithWWWRFC('http:%2F%2Fwwwww.nova@mail.ru/economicheskiy')─┐
│                                                                                       │ mail.ru                                                                                  │
└───────────────────────────────────────────────────────────────────────────────────────┴──────────────────────────────────────────────────────────────────────────────────────────┘
```

## cutURLParameter \{#cutWWW\}

自 v1.1 起引入

从 URL 中移除名为 `name` 的参数（如果存在）。
此函数不会对参数名中的字符进行编码或解码，例如 `Client ID` 和 `Client%20ID` 会被视为不同的参数名。

**语法**

```sql
cutURLParameter(url, name)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)
* `name` — URL 参数名称。[`String`](/sql-reference/data-types/string) 或 [`Array(String)`](/sql-reference/data-types/array)

**返回值**

移除了名为 `name` 的 URL 参数的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT
    cutURLParameter('http://bigmir.net/?a=b&c=d&e=f#g', 'a') AS url_without_a,
    cutURLParameter('http://bigmir.net/?a=b&c=d&e=f#g', ['c', 'e']) AS url_without_c_and_e;
```

```response title=Response
┌─url_without_a────────────────┬─url_without_c_and_e──────┐
│ http://bigmir.net/?c=d&e=f#g │ http://bigmir.net/?a=b#g │
└──────────────────────────────┴──────────────────────────┘
```

## cutWWW \{#decodeURLComponent\}

引入于：v1.1

从 URL 的域名中移除开头的 `www.`（如果存在）。

**语法**

```sql
cutWWW(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回去掉域名开头 `www.` 的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**用法示例**

```sql title=Query
SELECT cutWWW('http://www.example.com/path?query=value#fragment');
```

```response title=Response
┌─cutWWW('http://www.example.com/path?query=value#fragment')─┐
│ http://example.com/path?query=value#fragment               │
└────────────────────────────────────────────────────────────┘
```

## decodeURLComponent \{#decodeURLFormComponent\}

自 v1.1 引入

接受一个经过 URL 编码的字符串作为输入，并将其解码为原始的可读形式。

**语法**

```sql
decodeURLComponent(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回解码后的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT decodeURLComponent('http://127.0.0.1:8123/?query=SELECT%201%3B') AS DecodedURL;
```

```response title=Response
┌─DecodedURL─────────────────────────────┐
│ http://127.0.0.1:8123/?query=SELECT 1; │
└────────────────────────────────────────┘
```

## decodeURLFormComponent \{#domain\}

引入于：v1.1

使用表单编码规则（[RFC-1866](https://www.rfc-editor.org/rfc/rfc1866.html)）对 URL 编码的字符串进行解码，其中将 `+` 号还原为空格，并解码百分号编码的字符。

**语法**

```sql
decodeURLFormComponent(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回解码后的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT decodeURLFormComponent('http://127.0.0.1:8123/?query=SELECT%201+2%2B3') AS DecodedURL;
```

```response title=Response
┌─DecodedURL────────────────────────────────┐
│ http://127.0.0.1:8123/?query=SELECT 1 2+3 │
└───────────────────────────────────────────┘
```

## domain \{#domainRFC\}

自 v1.1 起引入

从 URL 中提取主机名。

URL 可以在包含或不包含协议的情况下指定。

**语法**

```sql
domain(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

如果输入字符串能够解析为 URL，则返回主机名，否则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT domain('svn+ssh://some.svn-hosting.com:80/repo/trunk');
```

```response title=Response
┌─domain('svn+ssh://some.svn-hosting.com:80/repo/trunk')─┐
│ some.svn-hosting.com                                   │
└────────────────────────────────────────────────────────┘
```

## domainRFC \{#domainWithoutWWW\}

自 v22.10 起引入

从 URL 中提取主机名。
类似于 [`domain`](#domain)，但符合 [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986) 标准。

**语法**

```sql
domainRFC(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

如果输入字符串可以解析为 URL，则返回主机名，否则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT
    domain('http://user:password@example.com:8080/path?query=value#fragment'),
    domainRFC('http://user:password@example.com:8080/path?query=value#fragment');
```

```response title=Response
┌─domain('http://user:password@example.com:8080/path?query=value#fragment')─┬─domainRFC('http://user:password@example.com:8080/path?query=value#fragment')─┐
│                                                                           │ example.com                                                                  │
└───────────────────────────────────────────────────────────────────────────┴──────────────────────────────────────────────────────────────────────────────┘
```

## domainWithoutWWW \{#domainWithoutWWWRFC\}

引入版本：v1.1

返回 URL 的域名；如果存在前缀 `www.`，则将其去除。

**语法**

```sql
domainWithoutWWW(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

如果输入字符串可以解析为 URL，则返回域名（不包含前缀 `www.`），否则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT domainWithoutWWW('http://paul@www.example.com:80/');
```

```response title=Response
┌─domainWithoutWWW('http://paul@www.example.com:80/')─┐
│ example.com                                         │
└─────────────────────────────────────────────────────┘
```

## domainWithoutWWWRFC \{#encodeURLComponent\}

自 v1.1 引入

返回去掉前缀 `www.` 的域名（如果存在）。类似于 [`domainWithoutWWW`](#domainWithoutWWW)，但遵循 [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986)。

**语法**

```sql
domainWithoutWWWRFC(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

如果输入字符串可以解析为 URL，则返回域名（不带前缀 `www.`），否则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**用法示例**

```sql title=Query
SELECT
    domainWithoutWWW('http://user:password@www.example.com:8080/path?query=value#fragment'),
    domainWithoutWWWRFC('http://user:password@www.example.com:8080/path?query=value#fragment');
```

```response title=Response
┌─domainWithoutWWW('http://user:password@www.example.com:8080/path?query=value#fragment')─┬─domainWithoutWWWRFC('http://user:password@www.example.com:8080/path?query=value#fragment')─┐
│                                                                                         │ example.com                                                                                │
└─────────────────────────────────────────────────────────────────────────────────────────┴────────────────────────────────────────────────────────────────────────────────────────────┘
```

## encodeURLComponent \{#encodeURLFormComponent\}

自 v22.3 起提供

接收一个普通字符串，并将其转换为 URL 编码（百分号编码）格式，其中特殊字符会被替换为相应的百分号编码序列。

**语法**

```sql
encodeURLComponent(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回编码后的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**用法示例**

```sql title=Query
SELECT encodeURLComponent('http://127.0.0.1:8123/?query=SELECT 1;') AS EncodedURL;
```

```response title=Response
┌─EncodedURL───────────────────────────────────────────────┐
│ http%3A%2F%2F127.0.0.1%3A8123%2F%3Fquery%3DSELECT%201%3B │
└──────────────────────────────────────────────────────────┘
```

## encodeURLFormComponent \{#extractURLParameter\}

自 v22.3 起引入

使用表单编码规则（[RFC-1866](https://www.rfc-editor.org/rfc/rfc1866.html)）对字符串进行编码，其中空格会被转换为 + 号，特殊字符会被进行百分号编码。

**语法**

```sql
encodeURLFormComponent(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回编码后的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**用法示例**

```sql title=Query
SELECT encodeURLFormComponent('http://127.0.0.1:8123/?query=SELECT 1 2+3') AS EncodedURL;
```

```response title=Response
┌─EncodedURL────────────────────────────────────────────────┐
│ http%3A%2F%2F127.0.0.1%3A8123%2F%3Fquery%3DSELECT+1+2%2B3 │
└───────────────────────────────────────────────────────────┘
```

## extractURLParameter \{#extractURLParameterNames\}

引入版本：v1.1

返回 URL 中名为 `name` 的参数值（如果存在），否则返回空字符串。
如果存在多个同名参数，则返回首次出现的值。
该函数假定 `url` 参数中的参数采用与参数 `name` 相同的编码方式。

**语法**

```sql
extractURLParameter(url, name)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)
* `name` — 参数名称。[`String`](/sql-reference/data-types/string)

**返回值**

返回指定名称的 URL 参数值。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT extractURLParameter('http://example.com/?param1=value1&param2=value2', 'param1');
```

```response title=Response
┌─extractURLPa⋯, 'param1')─┐
│ value1                   │
└──────────────────────────┘
```

## extractURLParameterNames \{#extractURLParameters\}

自 v1.1 版本引入

返回一个字符串数组，其中的字符串对应 URL 参数的名称。
返回值不会被解码。

**语法**

```sql
extractURLParameterNames(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回一个字符串数组，包含 URL 参数的名称。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**用法示例**

```sql title=Query
SELECT extractURLParameterNames('http://example.com/?param1=value1&param2=value2');
```

```response title=Response
┌─extractURLPa⋯m2=value2')─┐
│ ['param1','param2']      │
└──────────────────────────┘
```

## extractURLParameters \{#firstSignificantSubdomain\}

自 v1.1 引入

返回一个由 `name=value` 字符串组成的数组，对应 URL 参数。
这些值不会被解码。

**语法**

```sql
extractURLParameters(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回一个字符串数组，元素为与 URL 参数对应的 `name=value` 字符串。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**用法示例**

```sql title=Query
SELECT extractURLParameters('http://example.com/?param1=value1&param2=value2');
```

```response title=Response
┌─extractURLParame⋯&param2=value2')─┐
│ ['param1=value1','param2=value2'] │
└───────────────────────────────────┘
```

## firstSignificantSubdomain \{#firstSignificantSubdomainCustom\}

引入自：v1.1

返回“首个重要子域名”。

如果二级域名是 &#39;com&#39;、&#39;net&#39;、&#39;org&#39; 或 &#39;co&#39;，则首个重要子域名就是该二级域名。
否则，首个重要子域名就是三级域名。

例如，firstSignificantSubdomain(&#39;https://news.clickhouse.com/&#39;) = &#39;clickhouse&#39;，firstSignificantSubdomain (&#39;https://news.clickhouse.com.tr/&#39;) = &#39;clickhouse&#39;。

“无关紧要”的二级域名列表和其他实现细节未来可能会发生变化。

**语法**

```sql
```

**参数**

* 无。

**返回值**

**示例**

**firstSignificantSubdomain**

```sql title=Query
SELECT firstSignificantSubdomain('https://news.clickhouse.com/')
```

```response title=Response
```

## firstSignificantSubdomainCustom \{#firstSignificantSubdomainCustomRFC\}

引入版本：v21.1

使用自定义 TLD（顶级域名）列表，返回 URL 的第一个重要子域名。自定义 TLD 列表名称对应于一个配置，该配置定义哪些域名后缀应被视为顶级域名。这对于非标准的 TLD 层级结构非常有用。该函数使用简化的 URL 解析算法，并假定 URL 中的协议及其后的所有内容已被去掉。

**语法**

```sql
firstSignificantSubdomainCustom(url, tld_list_name)
```

**参数**

* `url` — 要从中提取子域名的 URL。[`String`](/sql-reference/data-types/string)
* `tld_list_name` — 配置中自定义 TLD 列表的名称。[`String`](/sql-reference/data-types/string)

**返回值**

返回第一个有效子域名。[`String`](/sql-reference/data-types/string)

**示例**

**基本用法**

```sql title=Query
SELECT firstSignificantSubdomainCustom('https://news.example.com', 'public_suffix_list')
```

```response title=Response
example
```

## firstSignificantSubdomainCustomRFC \{#firstSignificantSubdomainRFC\}

引入于 v22.10

与 `firstSignificantSubdomainCustom` 类似，但使用符合 RFC 3986 的 URL 解析方式，而非简化算法。

**语法**

```sql
firstSignificantSubdomainCustomRFC(url, tld_list_name)
```

**参数**

* `url` — 要从中提取子域名的 URL。[`String`](/sql-reference/data-types/string)
* `tld_list_name` — 配置中自定义的 TLD 列表名称。[`String`](/sql-reference/data-types/string)

**返回值**

返回第一个有意义的子域名。[`String`](/sql-reference/data-types/string)

**示例**

**基本用法**

```sql title=Query
SELECT firstSignificantSubdomainCustomRFC('https://news.example.com', 'public_suffix_list')
```

```response title=Response
example
```

## firstSignificantSubdomainRFC \{#fragment\}

引入于：v22.10

返回根据 RFC 1034 定义的“首个有效子域名”。

**语法**

```sql
```

**参数**

* 无。

**返回值**

**示例**

## fragment \{#netloc\}

引入版本：v1.1

返回不包含开头井号符号的片段标识符。

**语法**

```sql
fragment(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回不包含开头井号（#）的 fragment 标识符。[`String`](/sql-reference/data-types/string)

**示例**

**用法示例**

```sql title=Query
SELECT fragment('https://clickhouse.com/docs/getting-started/quick-start/cloud#1-create-a-clickhouse-service');
```

```response title=Response
┌─fragment('http⋯ouse-service')─┐
│ 1-create-a-clickhouse-service │
└───────────────────────────────┘
```

## netloc \{#path\}

引入版本：v20.5

从 URL 中提取网络位置部分（`username:password@host:port`）。

**语法**

```sql
netloc(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

从给定的 URL 中提取并返回 `username:password@host:port`。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT netloc('http://paul@www.example.com:80/');
```

```response title=Response
┌─netloc('http⋯e.com:80/')─┐
│ paul@www.example.com:80  │
└──────────────────────────┘
```

## path \{#pathFull\}

自 v1.1 起引入

返回 URL 中去除查询字符串后的路径部分。

**语法**

```sql
path(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回去掉查询字符串后的 URL 路径部分。[`String`](/sql-reference/data-types/string)

**示例**

**用法示例**

```sql title=Query
SELECT path('https://clickhouse.com/docs/sql-reference/functions/url-functions/?query=value');
```

```response title=Response
┌─path('https://clickhouse.com/en/sql-reference/functions/url-functions/?query=value')─┐
│ /docs/sql-reference/functions/url-functions/                                         │
└──────────────────────────────────────────────────────────────────────────────────────┘
```

## pathFull \{#port\}

引入版本：v1.1

与 [`path`](#path) 相同，但还包含 URL 的查询字符串和片段。

**语法**

```sql
pathFull(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回 URL 的路径，包括查询字符串和片段（fragment）。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT pathFull('https://clickhouse.com/docs/sql-reference/functions/url-functions/?query=value#section');
```

```response title=Response
┌─pathFull('https://clickhouse.com⋯unctions/?query=value#section')─┐
│ /docs/sql-reference/functions/url-functions/?query=value#section │
└──────────────────────────────────────────────────────────────────┘
```

## port \{#portRFC\}

自 v20.5 起提供

返回 URL 的端口号；如果 URL 不包含端口或无法解析，则返回 `default_port`。

**语法**

```sql
port(url[, default_port])
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)
* `default_port` — 可选。要返回的默认端口号。默认值为 `0`。[`UInt16`](/sql-reference/data-types/int-uint)

**返回值**

返回 URL 中的端口；如果 URL 中未指定端口，或发生验证错误，则返回默认端口。[`UInt16`](/sql-reference/data-types/int-uint)

**示例**

**使用示例**

```sql title=Query
SELECT port('https://clickhouse.com:8443/docs'), port('https://clickhouse.com/docs', 443);
```

```response title=Response
┌─port('https://clickhouse.com:8443/docs')─┬─port('https://clickhouse.com/docs', 443)─┐
│                                     8443 │                                      443 │
└──────────────────────────────────────────┴──────────────────────────────────────────┘
```

## portRFC \{#protocol\}

引入版本：v22.10

返回端口；如果 URL 不包含端口或无法解析，则返回 `default_port`。
与 [`port`](#port) 类似，但符合 [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986)。

**语法**

```sql
portRFC(url[, default_port])
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)
* `default_port` — 可选。要返回的默认端口号。默认值为 `0`。[`UInt16`](/sql-reference/data-types/int-uint)

**返回值**

返回端口号；如果 URL 中未包含端口，或发生校验错误，则返回默认端口号。[`UInt16`](/sql-reference/data-types/int-uint)

**示例**

**用法示例**

```sql title=Query
SELECT port('http://user:password@example.com:8080/'), portRFC('http://user:password@example.com:8080/');
```

```response title=Response
┌─port('http:/⋯com:8080/')─┬─portRFC('htt⋯com:8080/')─┐
│                        0 │                     8080 │
└──────────────────────────┴──────────────────────────┘
```

## protocol \{#queryString\}

自 v1.1 起引入

从 URL 中提取协议。

典型返回值示例：http、https、ftp、mailto、tel、magnet。

**语法**

```sql
protocol(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回 URL 的协议，若无法确定则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**用法示例**

```sql title=Query
SELECT protocol('https://clickhouse.com/');
```

```response title=Response
┌─protocol('https://clickhouse.com/')─┐
│ https                               │
└─────────────────────────────────────┘
```

## queryString \{#queryStringAndFragment\}

自 v1.1 起提供

返回 URL 中的查询字符串，不包括开头的问号，以及 `#` 及其之后的所有内容。

**语法**

```sql
queryString(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回 URL 的查询字符串（不包括开头的问号和片段部分）。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT queryString('https://clickhouse.com/docs?query=value&param=123#section');
```

```response title=Response
┌─queryString(⋯3#section')─┐
│ query=value&param=123    │
└──────────────────────────┘
```

## queryStringAndFragment \{#topLevelDomain\}

首次引入：v1.1

返回 URL 的查询字符串和片段标识符。

**语法**

```sql
queryStringAndFragment(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回 URL 的查询字符串和片段标识符。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT queryStringAndFragment('https://clickhouse.com/docs?query=value&param=123#section');
```

```response title=Response
┌─queryStringAnd⋯=123#section')─┐
│ query=value&param=123#section │
└───────────────────────────────┘
```

## topLevelDomain \{#topLevelDomainRFC\}

自 v1.1 引入

从 URL 中提取顶级域名。

:::note
URL 可以包含协议或不包含协议。
例如：

```text
svn+ssh://some.svn-hosting.com:80/repo/trunk
some.svn-hosting.com:80/repo/trunk
https://clickhouse.com/time/
```

:::

**语法**

```sql
topLevelDomain(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

如果输入字符串能被解析为 URL，则返回域名；否则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT topLevelDomain('svn+ssh://www.some.svn-hosting.com:80/repo/trunk');
```

```response title=Response
┌─topLevelDomain('svn+ssh://www.some.svn-hosting.com:80/repo/trunk')─┐
│ com                                                                │
└────────────────────────────────────────────────────────────────────┘
```

## topLevelDomainRFC

自 v22.10 起引入

从 URL 中提取顶级域名。
类似于 [`topLevelDomain`](#topLevelDomain)，但符合 [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986) 规范。

**语法**

```sql
topLevelDomainRFC(url)
```

**参数**

* `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

如果输入字符串可以解析为 URL，则返回其域名，否则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT topLevelDomain('http://foo:foo%41bar@foo.com'), topLevelDomainRFC('http://foo:foo%41bar@foo.com');
```

```response title=Response
┌─topLevelDomain('http://foo:foo%41bar@foo.com')─┬─topLevelDomainRFC('http://foo:foo%41bar@foo.com')─┐
│                                                │ com                                               │
└────────────────────────────────────────────────┴───────────────────────────────────────────────────┘
```

{/*AUTOGENERATED_END*/ }
