---
description: '用于处理 URL 的函数参考文档'
sidebar_label: 'URL'
slug: /sql-reference/functions/url-functions
title: '用于处理 URL 的函数'
doc_type: 'reference'
---



# 用于处理 URL 的函数



## 概述 {#overview}

:::note
本节中提到的函数针对最大性能进行了优化,大部分情况下不遵循 RFC-3986 标准。
实现 RFC-3986 的函数在其函数名后附加了 `RFC`,通常速度较慢。
:::

在处理不包含用户字符串和 `@` 符号的公开注册域名时,通常可以使用非 `RFC` 函数变体。
下表详细说明了 URL 中的哪些符号可以(`✔`)或不可以(`✗`)被相应的 `RFC` 和非 `RFC` 变体解析:

| 符号 | 非 `RFC` | `RFC` |
| ------ | --------- | ----- |
| ' '    | ✗         | ✗     |
| \t     | ✗         | ✗     |
| &lt;   | ✗         | ✗     |
| >      | ✗         | ✗     |
| %      | ✗         | ✔\*  |
| \{     | ✗         | ✗     |
| }      | ✗         | ✗     |
| \|     | ✗         | ✗     |
| \\\    | ✗         | ✗     |
| ^      | ✗         | ✗     |
| ~      | ✗         | ✔\*  |
| [      | ✗         | ✗     |
| ]      | ✗         | ✔    |
| ;      | ✗         | ✔\*  |
| =      | ✗         | ✔\*  |
| &      | ✗         | ✔\*  |

标记为 `*` 的符号是 RFC 3986 中的子分隔符,允许在 `@` 符号后的用户信息中使用。

URL 函数有两种类型:

- 提取 URL 部分的函数。如果 URL 中不存在相关部分,则返回空字符串。
- 删除 URL 部分的函数。如果 URL 中不存在类似内容,则 URL 保持不变。

:::note
以下函数是从 `system.functions` 系统表生成的。
:::

<!--
以下标签的内部内容在文档框架构建时会被替换为
从 system.functions 生成的文档。请勿修改或删除这些标签。
参见: https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
-->


<!--AUTOGENERATED_START-->

## cutFragment {#cutFragment}

引入版本:v1.1

从 URL 中移除片段标识符(包括井号)。

**语法**

```sql
cutFragment(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回移除片段标识符后的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT cutFragment('http://example.com/path?query=value#fragment123');
```

```response title=Response
┌─cutFragment('http://example.com/path?query=value#fragment123')─┐
│ http://example.com/path?query=value                            │
└────────────────────────────────────────────────────────────────┘
```


## cutQueryString {#cutQueryString}

引入版本:v1.1

从 URL 中移除查询字符串,包括问号。

**语法**

```sql
cutQueryString(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回移除查询字符串后的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=查询
SELECT cutQueryString('http://example.com/path?query=value&param=123#fragment');
```

```response title=响应
┌─cutQueryString('http://example.com/path?query=value&param=123#fragment')─┐
│ http://example.com/path#fragment                                         │
└──────────────────────────────────────────────────────────────────────────┘
```


## cutQueryStringAndFragment {#cutQueryStringAndFragment}

引入版本:v1.1

从 URL 中移除查询字符串和片段标识符,包括问号和井号。

**语法**

```sql
cutQueryStringAndFragment(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回移除了查询字符串和片段标识符的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT cutQueryStringAndFragment('http://example.com/path?query=value&param=123#fragment');
```

```response title=Response
┌─cutQueryStringAndFragment('http://example.com/path?query=value&param=123#fragment')─┐
│ http://example.com/path                                                             │
└─────────────────────────────────────────────────────────────────────────────────────┘
```


## cutToFirstSignificantSubdomain {#cutToFirstSignificantSubdomain}

引入版本:v1.1

返回域名中从顶级子域名到[第一个有效子域名](/sql-reference/functions/url-functions#firstSignificantSubdomain)的部分。

**语法**

```sql
cutToFirstSignificantSubdomain(url)
```

**参数**

- `url` — 要处理的 URL 或域名字符串。[`String`](/sql-reference/data-types/string)

**返回值**

如果可能,返回域名中从顶级子域名到第一个有效子域名的部分,否则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT
    cutToFirstSignificantSubdomain('https://news.clickhouse.com.tr/'),
    cutToFirstSignificantSubdomain('www.tr'),
    cutToFirstSignificantSubdomain('tr');
```

```response title=Response
┌─cutToFirstSignificantSubdomain('https://news.clickhouse.com.tr/')─┬─cutToFirstSignificantSubdomain('www.tr')─┬─cutToFirstSignificantSubdomain('tr')─┐
│ clickhouse.com.tr                                                 │ tr                                       │                                      │
└───────────────────────────────────────────────────────────────────┴──────────────────────────────────────────┴──────────────────────────────────────┘
```


## cutToFirstSignificantSubdomainCustom {#cutToFirstSignificantSubdomainCustom}

引入版本：v21.1

返回域名中包含顶级子域直到第一个有效子域的部分。接受自定义 [TLD 列表](https://en.wikipedia.org/wiki/List_of_Internet_top-level_domains)名称。当您需要使用最新的 TLD 列表或自定义列表时，此函数非常有用。

**配置示例**

```yaml
<!-- <top_level_domains_path>/var/lib/clickhouse/top_level_domains/</top_level_domains_path> -->
<top_level_domains_lists>
    <!-- https://publicsuffix.org/list/public_suffix_list.dat -->
    <public_suffix_list>public_suffix_list.dat</public_suffix_list>
    <!-- NOTE: path is under top_level_domains_path -->
</top_level_domains_lists>
```

**语法**

```sql
cutToFirstSignificantSubdomainCustom(url, tld_list_name)
```

**参数**

- `url` — 要处理的 URL 或域名字符串。[`String`](/sql-reference/data-types/string)
- `tld_list_name` — 在 ClickHouse 中配置的自定义 TLD 列表的名称。[`const String`](/sql-reference/data-types/string)

**返回值**

返回域名中包含顶级子域直到第一个有效子域的部分。[`String`](/sql-reference/data-types/string)

**示例**

**对非标准域名使用自定义 TLD 列表**

```sql title=查询
SELECT cutToFirstSignificantSubdomainCustom('bar.foo.there-is-no-such-domain', 'public_suffix_list')
```

```response title=响应
foo.there-is-no-such-domain
```


## cutToFirstSignificantSubdomainCustomRFC {#cutToFirstSignificantSubdomainCustomRFC}

引入版本:v22.10

返回域名中从顶级域到第一个有效子域的部分。
接受自定义 [TLD 列表](https://en.wikipedia.org/wiki/List_of_Internet_top-level_domains)名称。
当您需要使用最新的 TLD 列表或自定义列表时,此函数非常有用。
类似于 [cutToFirstSignificantSubdomainCustom](#cutToFirstSignificantSubdomainCustom),但遵循 RFC 3986 标准。

**配置示例**

```xml
<!-- <top_level_domains_path>/var/lib/clickhouse/top_level_domains/</top_level_domains_path> -->
<top_level_domains_lists>
    <!-- https://publicsuffix.org/list/public_suffix_list.dat -->
    <public_suffix_list>public_suffix_list.dat</public_suffix_list>
    <!-- NOTE: path is under top_level_domains_path -->
</top_level_domains_lists>
```

**语法**

```sql
cutToFirstSignificantSubdomainCustomRFC(url, tld_list_name)
```

**参数**

- `url` — 按照 RFC 3986 标准处理的 URL 或域名字符串。
- `tld_list_name` — 在 ClickHouse 中配置的自定义 TLD 列表名称。

**返回值**

返回域名中从顶级域到第一个有效子域的部分。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT cutToFirstSignificantSubdomainCustomRFC('www.foo', 'public_suffix_list');
```

```response title=Response
┌─cutToFirstSignificantSubdomainCustomRFC('www.foo', 'public_suffix_list')─────┐
│ www.foo                                                                      │
└──────────────────────────────────────────────────────────────────────────────┘
```


## cutToFirstSignificantSubdomainCustomWithWWW {#cutToFirstSignificantSubdomainCustomWithWWW}

引入版本:v21.1

返回域名中从顶级子域到第一个有效子域的部分,保留 'www'。接受自定义 TLD 列表名称。当您需要使用最新的 TLD 列表或自定义列表时,此功能会很有用。

**配置示例**

````yaml
<!-- <top_level_domains_path>/var/lib/clickhouse/top_level_domains/</top_level_domains_path> -->
<top_level_domains_lists>
    <!-- https://publicsuffix.org/list/public_suffix_list.dat -->
    <public_suffix_list>public_suffix_list.dat</public_suffix_list>
    <!-- NOTE: path is under top_level_domains_path -->
</top_level_domains_lists>


**语法**

```sql
cutToFirstSignificantSubdomainCustomWithWWW(url, tld_list_name)
````

**参数**

- `url` — 要处理的 URL 或域名字符串。- `tld_list_name` — 在 ClickHouse 中配置的自定义 TLD 列表名称。

**返回值**

域名中从顶级子域到第一个有效子域的部分,保留 'www'。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT cutToFirstSignificantSubdomainCustomWithWWW('www.foo', 'public_suffix_list');
```

```response title=Response
┌─cutToFirstSignificantSubdomainCustomWithWWW('www.foo', 'public_suffix_list')─┐
│ www.foo                                                                      │
└──────────────────────────────────────────────────────────────────────────────┘
```


## cutToFirstSignificantSubdomainCustomWithWWWRFC {#cutToFirstSignificantSubdomainCustomWithWWWRFC}

引入版本:v22.10

返回域名中从顶级域到第一个有效子域的部分,保留 `www`。
接受自定义 TLD 列表名称。
当您需要使用最新的 TLD 列表或自定义列表时,此功能非常有用。
类似于 [cutToFirstSignificantSubdomainCustomWithWWW](#cutToFirstSignificantSubdomainCustomWithWWW),但遵循 [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986) 标准。

**配置示例**

````xml
<!-- <top_level_domains_path>/var/lib/clickhouse/top_level_domains/</top_level_domains_path> -->
<top_level_domains_lists>
    <!-- https://publicsuffix.org/list/public_suffix_list.dat -->
    <public_suffix_list>public_suffix_list.dat</public_suffix_list>
    <!-- NOTE: path is under top_level_domains_path -->
</top_level_domains_lists>


**语法**

```sql
cutToFirstSignificantSubdomainCustomWithWWWRFC(url, tld_list_name)
````

**参数**

- `url` — 根据 RFC 3986 标准处理的 URL 或域名字符串。
- `tld_list_name` — 在 ClickHouse 中配置的自定义 TLD 列表名称。

**返回值**

返回域名中从顶级域到第一个有效子域的部分,保留 `www`。[`String`](/sql-reference/data-types/string)

**示例**

**使用自定义 TLD 列表进行 RFC 3986 解析并保留 www**

```sql title=查询
SELECT cutToFirstSignificantSubdomainCustomWithWWWRFC('https://www.subdomain.example.custom', 'public_suffix_list')
```

```response title=响应
www.example.custom
```


## cutToFirstSignificantSubdomainRFC {#cutToFirstSignificantSubdomainRFC}

引入版本：v22.10

返回域名中从顶级子域名到["第一个有效子域名"](/sql-reference/functions/url-functions#firstSignificantSubdomain)的部分。与 [`cutToFirstSignificantSubdomain`](#cutToFirstSignificantSubdomain) 类似,但遵循 [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986) 标准。

**语法**

```sql
cutToFirstSignificantSubdomainRFC(url)
```

**参数**

- `url` — 要按照 RFC 3986 标准处理的 URL 或域名字符串。[`String`](/sql-reference/data-types/string)

**返回值**

如果可能,返回域名中从顶级子域名到第一个有效子域名的部分,否则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT
    cutToFirstSignificantSubdomain('http://user:password@example.com:8080'),
    cutToFirstSignificantSubdomainRFC('http://user:password@example.com:8080');
```

```response title=Response
┌─cutToFirstSignificantSubdomain('http://user:password@example.com:8080')─┬─cutToFirstSignificantSubdomainRFC('http://user:password@example.com:8080')─┐
│                                                                         │ example.com                                                                │
└─────────────────────────────────────────────────────────────────────────┴────────────────────────────────────────────────────────────────────────────┘
```


## cutToFirstSignificantSubdomainWithWWW {#cutToFirstSignificantSubdomainWithWWW}

引入版本:v20.12

返回域名中从顶级子域到"第一个有效子域"的部分,保留 'www.' 前缀。

与 [`cutToFirstSignificantSubdomain`](#cutToFirstSignificantSubdomain) 类似,但如果存在 'www.' 前缀则会保留。

**语法**

```sql
cutToFirstSignificantSubdomainWithWWW(url)
```

**参数**

- `url` — 要处理的 URL 或域名字符串。[`String`](/sql-reference/data-types/string)

**返回值**

返回域名中从顶级子域到第一个有效子域(包含 www)的部分(如果可能),否则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT
    cutToFirstSignificantSubdomainWithWWW('https://news.clickhouse.com.tr/'),
    cutToFirstSignificantSubdomainWithWWW('www.tr'),
    cutToFirstSignificantSubdomainWithWWW('tr');
```

```response title=Response
┌─cutToFirstSignificantSubdomainWithWWW('https://news.clickhouse.com.tr/')─┬─cutToFirstSignificantSubdomainWithWWW('www.tr')─┬─cutToFirstSignificantSubdomainWithWWW('tr')─┐
│ clickhouse.com.tr                                                        │ www.tr                                          │                                             │
└──────────────────────────────────────────────────────────────────────────┴─────────────────────────────────────────────────┴─────────────────────────────────────────────┘
```


## cutToFirstSignificantSubdomainWithWWWRFC {#cutToFirstSignificantSubdomainWithWWWRFC}

引入版本：v22.10

返回域名中从顶级子域名到"第一个有效子域名"的部分，保留 'www'。与 [`cutToFirstSignificantSubdomainWithWWW`](#cutToFirstSignificantSubdomainWithWWW) 类似，但遵循 [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986) 规范。

**语法**

```sql
cutToFirstSignificantSubdomainWithWWWRFC(url)
```

**参数**

- `url` — 按照 RFC 3986 规范处理的 URL 或域名字符串。

**返回值**

返回域名中从顶级子域名到第一个有效子域名（保留 'www'）的部分，如果无法提取则返回空字符串 [`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=查询
SELECT
    cutToFirstSignificantSubdomainWithWWW('http:%2F%2Fwwwww.nova@mail.ru/economicheskiy'),
    cutToFirstSignificantSubdomainWithWWWRFC('http:%2F%2Fwwwww.nova@mail.ru/economicheskiy');
```

```response title=响应
┌─cutToFirstSignificantSubdomainWithWWW('http:%2F%2Fwwwww.nova@mail.ru/economicheskiy')─┬─cutToFirstSignificantSubdomainWithWWWRFC('http:%2F%2Fwwwww.nova@mail.ru/economicheskiy')─┐
│                                                                                       │ mail.ru                                                                                  │
└───────────────────────────────────────────────────────────────────────────────────────┴──────────────────────────────────────────────────────────────────────────────────────────┘
```


## cutURLParameter {#cutURLParameter}

引入版本:v1.1

从 URL 中移除 `name` 参数(如果存在)。
此函数不会对参数名称中的字符进行编码或解码,例如 `Client ID` 和 `Client%20ID` 会被视为不同的参数名称。

**语法**

```sql
cutURLParameter(url, name)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)
- `name` — URL 参数名称。[`String`](/sql-reference/data-types/string) 或 [`Array(String)`](/sql-reference/data-types/array)

**返回值**

移除 `name` URL 参数后的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT
    cutURLParameter('http://bigmir.net/?a=b&c=d&e=f#g', 'a') AS url_without_a,
    cutURLParameter('http://bigmir.net/?a=b&c=d&e=f#g', ['c', 'e']) AS url_without_c_and_e;
```

```response title=Response
┌─url_without_a────────────────┬─url_without_c_and_e──────┐
│ http://bigmir.net/?c=d&e=f#g │ http://bigmir.net/?a=b#g │
└──────────────────────────────┴──────────────────────────┘
```


## cutWWW {#cutWWW}

引入版本：v1.1

从 URL 的域名中移除前导 `www.`（如果存在）。

**语法**

```sql
cutWWW(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回移除域名前导 `www.` 后的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT cutWWW('http://www.example.com/path?query=value#fragment');
```

```response title=Response
┌─cutWWW('http://www.example.com/path?query=value#fragment')─┐
│ http://example.com/path?query=value#fragment               │
└────────────────────────────────────────────────────────────┘
```


## decodeURLComponent {#decodeURLComponent}

引入版本:v1.1

将 URL 编码的字符串解码为原始可读形式。

**语法**

```sql
decodeURLComponent(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回解码后的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT decodeURLComponent('http://127.0.0.1:8123/?query=SELECT%201%3B') AS DecodedURL;
```

```response title=Response
┌─DecodedURL─────────────────────────────┐
│ http://127.0.0.1:8123/?query=SELECT 1; │
└────────────────────────────────────────┘
```


## decodeURLFormComponent {#decodeURLFormComponent}

引入版本：v1.1

使用表单编码规则（[RFC-1866](https://www.rfc-editor.org/rfc/rfc1866.html)）对 URL 编码的字符串进行解码，其中 `+` 符号转换为空格，百分号编码的字符被解码。

**语法**

```sql
decodeURLFormComponent(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回解码后的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT decodeURLFormComponent('http://127.0.0.1:8123/?query=SELECT%201+2%2B3') AS DecodedURL;
```

```response title=Response
┌─DecodedURL────────────────────────────────┐
│ http://127.0.0.1:8123/?query=SELECT 1 2+3 │
└───────────────────────────────────────────┘
```


## domain {#domain}

引入版本:v1.1

从 URL 中提取主机名。

URL 可以包含或不包含协议。

**语法**

```sql
domain(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

如果输入字符串可以解析为 URL,则返回主机名,否则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=查询
SELECT domain('svn+ssh://some.svn-hosting.com:80/repo/trunk');
```

```response title=响应
┌─domain('svn+ssh://some.svn-hosting.com:80/repo/trunk')─┐
│ some.svn-hosting.com                                   │
└────────────────────────────────────────────────────────┘
```


## domainRFC {#domainRFC}

引入版本:v22.10

从 URL 中提取主机名。
与 [`domain`](#domain) 类似,但符合 [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986) 标准。

**语法**

```sql
domainRFC(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

如果输入字符串可以解析为 URL,则返回主机名,否则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=查询
SELECT
    domain('http://user:password@example.com:8080/path?query=value#fragment'),
    domainRFC('http://user:password@example.com:8080/path?query=value#fragment');
```

```response title=响应
┌─domain('http://user:password@example.com:8080/path?query=value#fragment')─┬─domainRFC('http://user:password@example.com:8080/path?query=value#fragment')─┐
│                                                                           │ example.com                                                                  │
└───────────────────────────────────────────────────────────────────────────┴──────────────────────────────────────────────────────────────────────────────┘
```


## domainWithoutWWW {#domainWithoutWWW}

引入版本:v1.1

返回 URL 的域名,如果存在前导 `www.` 则将其去除。

**语法**

```sql
domainWithoutWWW(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

如果输入字符串可以解析为 URL,则返回域名(不含前导 `www.`),否则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT domainWithoutWWW('http://paul@www.example.com:80/');
```

```response title=Response
┌─domainWithoutWWW('http://paul@www.example.com:80/')─┐
│ example.com                                         │
└─────────────────────────────────────────────────────┘
```


## domainWithoutWWWRFC {#domainWithoutWWWRFC}

引入版本：v1.1

返回去除前导 `www.` 的域名（如果存在）。与 [`domainWithoutWWW`](#domainWithoutWWW) 类似，但遵循 [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986) 标准。

**语法**

```sql
domainWithoutWWWRFC(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

如果输入字符串可以解析为 URL，则返回域名（去除前导 `www.`），否则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT
    domainWithoutWWW('http://user:password@www.example.com:8080/path?query=value#fragment'),
    domainWithoutWWWRFC('http://user:password@www.example.com:8080/path?query=value#fragment');
```

```response title=Response
┌─domainWithoutWWW('http://user:password@www.example.com:8080/path?query=value#fragment')─┬─domainWithoutWWWRFC('http://user:password@www.example.com:8080/path?query=value#fragment')─┐
│                                                                                         │ example.com                                                                                │
└─────────────────────────────────────────────────────────────────────────────────────────┴────────────────────────────────────────────────────────────────────────────────────────────┘
```


## encodeURLComponent {#encodeURLComponent}

引入版本:v22.3

将普通字符串转换为 URL 编码(百分号编码)格式,其中特殊字符会被替换为对应的百分号编码形式。

**语法**

```sql
encodeURLComponent(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回编码后的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT encodeURLComponent('http://127.0.0.1:8123/?query=SELECT 1;') AS EncodedURL;
```

```response title=Response
┌─EncodedURL───────────────────────────────────────────────┐
│ http%3A%2F%2F127.0.0.1%3A8123%2F%3Fquery%3DSELECT%201%3B │
└──────────────────────────────────────────────────────────┘
```


## encodeURLFormComponent {#encodeURLFormComponent}

引入版本：v22.3

使用表单编码规则（[RFC-1866](https://www.rfc-editor.org/rfc/rfc1866.html)）对字符串进行编码，其中空格转换为 + 号，特殊字符进行百分号编码。

**语法**

```sql
encodeURLFormComponent(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回编码后的 URL。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=查询
SELECT encodeURLFormComponent('http://127.0.0.1:8123/?query=SELECT 1 2+3') AS EncodedURL;
```

```response title=响应
┌─EncodedURL────────────────────────────────────────────────┐
│ http%3A%2F%2F127.0.0.1%3A8123%2F%3Fquery%3DSELECT+1+2%2B3 │
└───────────────────────────────────────────────────────────┘
```


## extractURLParameter {#extractURLParameter}

引入版本:v1.1

返回 URL 中 `name` 参数的值(如果存在),否则返回空字符串。
如果存在多个同名参数,则返回第一次出现的参数值。
该函数假定 `url` 参数中的参数编码方式与 `name` 参数的编码方式相同。

**语法**

```sql
extractURLParameter(url, name)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)
- `name` — 参数名称。[`String`](/sql-reference/data-types/string)

**返回值**

返回指定名称的 URL 参数值。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT extractURLParameter('http://example.com/?param1=value1&param2=value2', 'param1');
```

```response title=Response
┌─extractURLPa⋯, 'param1')─┐
│ value1                   │
└──────────────────────────┘
```


## extractURLParameterNames {#extractURLParameterNames}

引入版本:v1.1

返回一个字符串数组,包含 URL 参数的名称。
参数值不会被解码。

**语法**

```sql
extractURLParameterNames(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回一个字符串数组,包含 URL 参数的名称。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**使用示例**

```sql title=Query
SELECT extractURLParameterNames('http://example.com/?param1=value1&param2=value2');
```

```response title=Response
┌─extractURLPa⋯m2=value2')─┐
│ ['param1','param2']      │
└──────────────────────────┘
```


## extractURLParameters {#extractURLParameters}

引入版本：v1.1

返回与 URL 参数对应的 `name=value` 字符串数组。
返回的值不会被解码。

**语法**

```sql
extractURLParameters(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回与 URL 参数对应的 `name=value` 字符串数组。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**使用示例**

```sql title=查询
SELECT extractURLParameters('http://example.com/?param1=value1&param2=value2');
```

```response title=响应
┌─extractURLParame⋯&param2=value2')─┐
│ ['param1=value1','param2=value2'] │
└───────────────────────────────────┘
```


## firstSignificantSubdomain {#firstSignificantSubdomain}

引入版本:v

返回"首要子域名"。

首要子域名是指:如果顶级域名是 'com'、'net'、'org' 或 'co',则返回二级域名;否则返回三级域名。

例如,firstSignificantSubdomain('https://news.clickhouse.com/') = 'clickhouse',firstSignificantSubdomain('https://news.clickhouse.com.tr/') = 'clickhouse'。

"非首要"二级域名列表及其他实现细节可能会在未来发生变化。

**语法**

```sql

```

**参数**

- 无。

**返回值**

**示例**

**firstSignificantSubdomain**

```sql title=查询
SELECT firstSignificantSubdomain('https://news.clickhouse.com/')
```

```response title=响应

```


## firstSignificantSubdomainRFC {#firstSignificantSubdomainRFC}

引入版本: v

根据 RFC 1034 标准返回"首个有效子域"。

**语法**

```sql

```

**参数**

- 无。

**返回值**

**示例**


## fragment {#fragment}

引入版本：v1.1

返回 URL 片段标识符（不含开头的井号）。

**语法**

```sql
fragment(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回 URL 片段标识符（不含开头的井号）。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT fragment('https://clickhouse.com/docs/getting-started/quick-start/cloud#1-create-a-clickhouse-service');
```

```response title=Response
┌─fragment('http⋯ouse-service')─┐
│ 1-create-a-clickhouse-service │
└───────────────────────────────┘
```


## netloc {#netloc}

引入版本:v20.5

从 URL 中提取网络位置(`username:password@host:port`)。

**语法**

```sql
netloc(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

从给定的 URL 中返回 `username:password@host:port`。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT netloc('http://paul@www.example.com:80/');
```

```response title=Response
┌─netloc('http⋯e.com:80/')─┐
│ paul@www.example.com:80  │
└──────────────────────────┘
```


## path {#path}

引入版本:v1.1

从 URL 中返回不含查询字符串的路径。

**语法**

```sql
path(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回 URL 中不含查询字符串的路径。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT path('https://clickhouse.com/docs/sql-reference/functions/url-functions/?query=value');
```

```response title=Response
┌─path('https://clickhouse.com/en/sql-reference/functions/url-functions/?query=value')─┐
│ /docs/sql-reference/functions/url-functions/                                         │
└──────────────────────────────────────────────────────────────────────────────────────┘
```


## pathFull {#pathFull}

引入版本：v1.1

与 [`path`](#path) 相同,但包含 URL 的查询字符串和片段部分。

**语法**

```sql
pathFull(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回 URL 的路径,包含查询字符串和片段部分。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT pathFull('https://clickhouse.com/docs/sql-reference/functions/url-functions/?query=value#section');
```

```response title=Response
┌─pathFull('https://clickhouse.com⋯unctions/?query=value#section')─┐
│ /docs/sql-reference/functions/url-functions/?query=value#section │
└──────────────────────────────────────────────────────────────────┘
```


## port {#port}

引入版本:v20.5

返回 URL 的端口号,如果 URL 不包含端口或无法解析,则返回 `default_port`。

**语法**

```sql
port(url[, default_port])
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)
- `default_port` — 可选参数。要返回的默认端口号。默认为 `0`。[`UInt16`](/sql-reference/data-types/int-uint)

**返回值**

返回 URL 的端口号,如果 URL 中没有端口或发生验证错误,则返回默认端口。[`UInt16`](/sql-reference/data-types/int-uint)

**示例**

**使用示例**

```sql title=Query
SELECT port('https://clickhouse.com:8443/docs'), port('https://clickhouse.com/docs', 443);
```

```response title=Response
┌─port('https://clickhouse.com:8443/docs')─┬─port('https://clickhouse.com/docs', 443)─┐
│                                     8443 │                                      443 │
└──────────────────────────────────────────┴──────────────────────────────────────────┘
```


## portRFC {#portRFC}

引入版本:v22.10

如果 URL 不包含端口或无法解析,则返回端口或 `default_port`。
类似于 [`port`](#port),但符合 [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986) 标准。

**语法**

```sql
portRFC(url[, default_port])
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)
- `default_port` — 可选参数。要返回的默认端口号。默认值为 `0`。[`UInt16`](/sql-reference/data-types/int-uint)

**返回值**

返回端口号,如果 URL 中没有端口或发生验证错误,则返回默认端口。[`UInt16`](/sql-reference/data-types/int-uint)

**示例**

**使用示例**

```sql title=Query
SELECT port('http://user:password@example.com:8080/'), portRFC('http://user:password@example.com:8080/');
```

```response title=Response
┌─port('http:/⋯com:8080/')─┬─portRFC('htt⋯com:8080/')─┐
│                        0 │                     8080 │
└──────────────────────────┴──────────────────────────┘
```


## protocol {#protocol}

引入版本:v1.1

从 URL 中提取协议。

典型返回值示例:http、https、ftp、mailto、tel、magnet。

**语法**

```sql
protocol(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回 URL 的协议,如果无法确定则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=查询
SELECT protocol('https://clickhouse.com/');
```

```response title=响应
┌─protocol('https://clickhouse.com/')─┐
│ https                               │
└─────────────────────────────────────┘
```


## queryString {#queryString}

引入版本:v1.1

返回 URL 的查询字符串,不包含开头的问号、`#` 以及 `#` 之后的所有内容。

**语法**

```sql
queryString(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回 URL 的查询字符串,不包含开头的问号和片段标识符。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT queryString('https://clickhouse.com/docs?query=value&param=123#section');
```

```response title=Response
┌─queryString(⋯3#section')─┐
│ query=value&param=123    │
└──────────────────────────┘
```


## queryStringAndFragment {#queryStringAndFragment}

引入版本：v1.1

返回 URL 的查询字符串和片段标识符。

**语法**

```sql
queryStringAndFragment(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

返回 URL 的查询字符串和片段标识符。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT queryStringAndFragment('https://clickhouse.com/docs?query=value&param=123#section');
```

```response title=Response
┌─queryStringAnd⋯=123#section')─┐
│ query=value&param=123#section │
└───────────────────────────────┘
```


## topLevelDomain {#topLevelDomain}

Introduced in: v1.1

从 URL 中提取顶级域名。

:::note
URL 可以带协议或不带协议。
例如:

```text
svn+ssh://some.svn-hosting.com:80/repo/trunk
some.svn-hosting.com:80/repo/trunk
https://clickhouse.com/time/
```

:::

**语法**

```sql
topLevelDomain(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

如果输入字符串可以解析为 URL,则返回顶级域名。否则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT topLevelDomain('svn+ssh://www.some.svn-hosting.com:80/repo/trunk');
```

```response title=Response
┌─topLevelDomain('svn+ssh://www.some.svn-hosting.com:80/repo/trunk')─┐
│ com                                                                │
└────────────────────────────────────────────────────────────────────┘
```


## topLevelDomainRFC {#topLevelDomainRFC}

引入版本：v22.10

从 URL 中提取顶级域名。
与 [`topLevelDomain`](#topLevelDomain) 类似，但遵循 [RFC 3986](https://datatracker.ietf.org/doc/html/rfc3986) 规范。

**语法**

```sql
topLevelDomainRFC(url)
```

**参数**

- `url` — URL。[`String`](/sql-reference/data-types/string)

**返回值**

如果输入字符串可以解析为 URL，则返回域名。否则返回空字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=查询
SELECT topLevelDomain('http://foo:foo%41bar@foo.com'), topLevelDomainRFC('http://foo:foo%41bar@foo.com');
```

```response title=响应
┌─topLevelDomain('http://foo:foo%41bar@foo.com')─┬─topLevelDomainRFC('http://foo:foo%41bar@foo.com')─┐
│                                                │ com                                               │
└────────────────────────────────────────────────┴───────────────────────────────────────────────────┘
```

<!--AUTOGENERATED_END-->
