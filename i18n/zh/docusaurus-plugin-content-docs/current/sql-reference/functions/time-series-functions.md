---
description: '时间序列处理函数文档'
sidebar_label: 'TimeSeries'
slug: /sql-reference/functions/time-series-functions
title: '时间序列处理函数'
doc_type: 'reference'
---

# 时间序列函数 {#time-series-functions}

以下函数旨在与 `timeSeries*()` 聚合函数一起使用，例如
[timeSeriesInstantRateToGrid](../aggregate-functions/reference/timeSeriesInstantRateToGrid.md)、\
[timeSeriesLastToGrid](../aggregate-functions/reference/timeSeriesResampleToGridWithStaleness.md)
等。

## timeSeriesRange {#timeSeriesRange}

生成一系列时间戳。

**语法**

```sql
timeSeriesRange(start_timestamp, end_timestamp, step)
```

**参数**

* `start_timestamp` - 范围的起始时间。
* `end_timestamp` - 范围的结束时间。
* `step` - 范围的步长（单位：秒）。

**返回值**

* 返回一个时间戳序列 `[start_timestamp, start_timestamp + step, start_timestamp + 2 * step, ..., end_timestamp]`。

**示例**

查询：

```sql
SELECT timeSeriesRange('2025-06-01 00:00:00'::DateTime64(3), '2025-06-01 00:01:00'::DateTime64(3), 30) AS rng;
```

结果：

```text
┌────────────────────────────────────result─────────────────────────────────────────┐
│ ['2025-06-01 00:00:00.000', '2025-06-01 00:00:30.000', '2025-06-01 00:01:00.000'] │
└───────────────────────────────────────────────────────────────────────────────────┘
```

**注意**

* 如果在调用函数 `timeSeriesRange()` 时，`start_timestamp` 等于 `end_timestamp`，
  则会返回一个只包含该时间戳的、只有 1 个元素的数组：`[start_timestamp]`
* 函数 `timeSeriesRange()` 类似于函数 [range](../functions/array-functions.md#range)。
  例如，如果时间戳类型为 `DateTime64(3)` 且 `start_timestamp < end_timestamp`，那么
  `timeSeriesRange(start_timestamp, end_timestamp, step)` 会返回与下列表达式相同的结果：

```sql
range(start_timestamp::Int64, end_timestamp::Int64 + 1, step::Int64)::Array(DateTime64(3))
```

## timeSeriesFromGrid {#timeSeriesFromGrid}

将数值数组 `[value1, value2, value3, ..., valueN]` 转换为元组数组
`[(start_timestamp, value1), (start_timestamp + step, value2), (start_timestamp + 2 * step, value3), ..., (end_timestamp, valueN)]`。

如果数组 `[value1, value2, value3, ...]` 中的某些值为 `NULL`，则函数不会将这些 NULL 值复制到结果数组中，
但仍会递增当前时间戳。例如，对于 `[value1, NULL, value2]`，函数将返回
`[(start_timestamp, value1), (start_timestamp + 2 * step, value2)]`。

当前时间戳按步长递增，直到其大于 `end_timestamp`，每个时间戳都会与指定数值数组中的一个值组合。
如果数值的数量与时间戳的数量不匹配，函数将抛出异常。

**语法**

```sql
timeSeriesFromGrid(start_timestamp, end_timestamp, step, values);
```

**参数**

* `start_timestamp` - 网格的起始时间。
* `end_timestamp` - 网格的结束时间。
* `step` - 网格的步长（以秒为单位）。
* `values` - 数值数组 `[value1, value2, ..., valueN]`。

**返回值**

* 返回源数组中的数值，并将其与时间戳结合，映射到由 `start_timestamp` 和 `step` 定义的等间隔时间网格上。

**示例**

查询：

```sql
SELECT timeSeriesFromGrid('2025-06-01 00:00:00'::DateTime64(3), '2025-06-01 00:01:30.000'::DateTime64(3), 30, [10, 20, NULL, 30]) AS result;
```

结果：

```text
┌─────────────────────────────────────────────result─────────────────────────────────────────────┐
│ [('2025-06-01 00:00:00.000',10),('2025-06-01 00:00:30.000',20),('2025-06-01 00:01:30.000',30)] │
└────────────────────────────────────────────────────────────────────────────────────────────────┘
```

**注意**
函数 `timeSeriesFromGrid(start_timestamp, end_timestamp, step, values)` 返回的结果与以下表达式相同：

```sql
arrayFilter(x -> x.2 IS NOT NULL, arrayZip(timeSeriesRange(start_timestamp, end_timestamp, step), values))
```

{/* 
  下面标签内的内容会在文档框架构建时替换为
  由 system.functions 自动生成的文档。请不要修改或删除这些标签。
  详见：https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
  */ }

{/*AUTOGENERATED_START*/ }

{/*AUTOGENERATED_END*/ }
