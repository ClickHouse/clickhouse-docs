---
description: '字符串拆分函数文档'
sidebar_label: '字符串拆分'
slug: /sql-reference/functions/splitting-merging-functions
title: '字符串拆分函数'
doc_type: 'reference'
---

import DeprecatedBadge from '@theme/badges/DeprecatedBadge';


# 用于拆分字符串的函数

:::note
以下文档由 `system.functions` 系统表自动生成。
:::

{/* 
  下面标签内的内容会在文档框架构建期间被替换为
  由 system.functions 生成的文档。请勿修改或删除这些标签。
  参见：https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
  */ }

{/*AUTOGENERATED_START*/ }


## alphaTokens

引入于：v1.1

从字节范围 `a-z` 和 `A-Z` 中提取由连续字节组成的子字符串，并返回这些子字符串构成的数组。

**语法**

```sql
alphaTokens(s[, max_substrings])
```

**别名**: `splitByAlpha`

**参数**

* `s` — 要拆分的字符串。[`String`](/sql-reference/data-types/string)
* `max_substrings` — 可选。当 `max_substrings > 0` 时，返回的子串数量不超过 `max_substrings`，否则函数会返回尽可能多的子串。[`Int64`](/sql-reference/data-types/int-uint)

**返回值**

返回由 `s` 分割得到的子串数组。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**使用示例**

```sql title=Query
SELECT alphaTokens('abca1abc');
```

```response title=Response
┌─alphaTokens('abca1abc')─┐
│ ['abca','abc']          │
└─────────────────────────┘
```


## arrayStringConcat

自 v1.1 引入

使用提供的分隔符连接数组中各个值的字符串表示形式。该分隔符为可选参数，默认为空字符串。

**语法**

```sql
arrayStringConcat(arr[, separator])
```

**参数**

* `arr` — 要拼接的数组。[`Array(T)`](/sql-reference/data-types/array)
* `separator` — 可选。分隔符字符串。默认值为空字符串。[`const String`](/sql-reference/data-types/string)

**返回值**

返回拼接后的字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT arrayStringConcat(['12/05/2021', '12:50:00'], ' ') AS DateString;
```

```response title=Response
┌─DateString──────────┐
│ 12/05/2021 12:50:00 │
└─────────────────────┘
```


## extractAllGroupsVertical

引入版本：v20.5

使用正则表达式匹配字符串中的所有分组，并返回一个数组的数组（二维数组）。每个内部数组包含来自所有分组的匹配片段，并按照它们在输入字符串中的出现顺序进行组织。

**语法**

```sql
extractAllGroupsVertical(s, regexp)
```

**别名**: `extractAllGroups`

**参数**

* `s` — 要从中提取内容的输入字符串。[`String`](/sql-reference/data-types/string) 或 [`FixedString`](/sql-reference/data-types/fixedstring)
* `regexp` — 用于匹配的正则表达式。[`const String`](/sql-reference/data-types/string) 或 [`const FixedString`](/sql-reference/data-types/fixedstring)

**返回值**

返回一个数组的数组，其中每个内部数组包含一次匹配中捕获的分组。每次匹配都会生成一个数组，其元素对应于正则表达式中的捕获组（组 1、组 2 等）。如果未找到任何匹配，则返回空数组。[`Array(Array(String))`](/sql-reference/data-types/array)

**示例**

**使用示例**

```sql title=Query
WITH '< Server: nginx
< Date: Tue, 22 Jan 2019 00:26:14 GMT
< Content-Type: text/html; charset=UTF-8
< Connection: keep-alive
' AS s
SELECT extractAllGroupsVertical(s, '< ([\\w\\-]+): ([^\\r\\n]+)');
```

```response title=Response
[['Server','nginx'],['Date','Tue, 22 Jan 2019 00:26:14 GMT'],['Content-Type','text/html; charset=UTF-8'],['Connection','keep-alive']]
```


## ngrams

自 v21.11 版本引入

将 UTF-8 字符串分割为长度为 `N` 的 n-gram。

**语法**

```sql
ngrams(s, N)
```

**参数**

* `s` — 输入字符串。[`String`](/sql-reference/data-types/string) 或 [`FixedString`](/sql-reference/data-types/fixedstring)
* `N` — n-gram 的长度。[`const UInt8/16/32/64`](/sql-reference/data-types/int-uint)

**返回值**

返回由 n-gram 组成的数组。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**使用示例**

```sql title=Query
SELECT ngrams('ClickHouse', 3);
```

```response title=Response
['Cli','lic','ick','ckH','kHo','Hou','ous','use']
```


## splitByChar

引入版本：v1.1

将使用指定的、恰好为一个字符的常量字符串 `separator` 分隔的字符串拆分为子字符串数组。
如果分隔符出现在字符串的开头或结尾，或者存在多个连续的分隔符，则可能会产生空子字符串。

:::note
通过设置 [`splitby_max_substrings_includes_remaining_string`](../../operations/settings/settings.md#splitby_max_substrings_includes_remaining_string)（默认值：`0`）来控制当参数 `max_substrings > 0` 时，剩余字符串是否包含在结果数组的最后一个元素中。
:::

在以下情况下可能会产生空子字符串：

* 分隔符出现在字符串的开头或结尾
* 存在多个连续的分隔符
* 原始字符串 `s` 为空

**语法**

```sql
splitByChar(separator, s[, max_substrings])
```

**参数**

* `separator` — 分隔符，必须是单字节字符。[`String`](/sql-reference/data-types/string)
* `s` — 待拆分的字符串。[`String`](/sql-reference/data-types/string)
* `max_substrings` — 可选参数。若 `max_substrings > 0`，返回的数组最多包含 `max_substrings` 个子串，否则函数将返回尽可能多的子串。默认值为 `0`。[`Int64`](/sql-reference/data-types/int-uint)

**返回值**

返回由选定子串组成的数组。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**用法示例**

```sql title=Query
SELECT splitByChar(',', '1,2,3,abcde');
```

```response title=Response
┌─splitByChar(⋯2,3,abcde')─┐
│ ['1','2','3','abcde']    │
└──────────────────────────┘
```


## splitByNonAlpha

引入于：v21.9

将由空白符和标点字符分隔的字符串拆分为子字符串数组。

:::note
[`splitby_max_substrings_includes_remaining_string`](../../operations/settings/settings.md#splitby_max_substrings_includes_remaining_string)（默认值：`0`）控制当参数 `max_substrings > 0` 时，结果数组的最后一个元素中是否包含剩余字符串。
:::

**语法**

```sql
splitByNonAlpha(s[, max_substrings])
```

**参数**

* `s` — 要拆分的字符串。[`String`](/sql-reference/data-types/string)
* `max_substrings` — 可选参数。当 `max_substrings > 0` 时，返回的子字符串数量不会超过 `max_substrings`，否则函数会返回尽可能多的子字符串。默认值：`0`。[`Int64`](/sql-reference/data-types/int-uint)

**返回值**

返回由 `s` 拆分得到的子字符串数组。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**用法示例**

```sql title=Query
SELECT splitByNonAlpha('user@domain.com');
```

```response title=Response
['user','domain','com']
```


## splitByRegexp

引入版本：v21.6

将一个由给定正则表达式分隔的字符串拆分为子字符串数组。\
如果给定的正则表达式为空，则会将字符串拆分为由单个字符组成的数组。\
如果正则表达式未匹配到任何内容，则字符串不会被拆分。

在以下情况下可能会产生空子字符串：

* 非空正则表达式在字符串开头或结尾发生匹配
* 存在多个连续的非空正则表达式匹配
* 原始字符串为空且正则表达式非空。

:::note
通过设置 [`splitby_max_substrings_includes_remaining_string`](../../operations/settings/settings.md#splitby_max_substrings_includes_remaining_string)（默认值：`0`）可以控制当参数 `max_substrings > 0` 时，结果数组的最后一个元素中是否包含剩余字符串。
:::

**语法**

```sql
splitByRegexp(regexp, s[, max_substrings])
```

**参数**

* `regexp` — 正则表达式。常量。[`String`](/sql-reference/data-types/string) 或 [`FixedString`](/sql-reference/data-types/fixedstring)
* `s` — 要分割的字符串。[`String`](/sql-reference/data-types/string)
* `max_substrings` — 可选。当 `max_substrings > 0` 时，返回的子串数量不超过 `max_substrings`，否则函数将返回尽可能多的子串。默认值：`0`。[`Int64`](/sql-reference/data-types/int-uint)

**返回值**

返回由 `s` 中选取的子串组成的数组。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**使用示例**

```sql title=Query
SELECT splitByRegexp('\\d+', 'a12bc23de345f');
```

```response title=Response
┌─splitByRegex⋯c23de345f')─┐
│ ['a12bc23de345f']        │
└──────────────────────────┘
```

**空正则表达式**

```sql title=Query
SELECT splitByRegexp('', 'abcde');
```

```response title=Response
┌─splitByRegexp('', 'abcde')─┐
│ ['a','b','c','d','e']      │
└────────────────────────────┘
```


## splitByString

引入版本：v1.1

使用由多个字符组成的常量 `separator` 分割字符串，将其拆分为子字符串数组。\
如果字符串 `separator` 为空，则会将字符串 `s` 拆分为单个字符的数组。

可能产生空子字符串的情况包括：

* 非空分隔符出现在字符串的开头或结尾
* 出现多个连续的非空分隔符
* 原始字符串 `s` 为空但分隔符不为空

:::note
通过设置 [`splitby_max_substrings_includes_remaining_string`](../../operations/settings/settings.md#splitby_max_substrings_includes_remaining_string)（默认值：`0`），可以控制当参数 `max_substrings > 0` 时，结果数组的最后一个元素中是否包含剩余的字符串。
:::

**语法**

```sql
splitByString(separator, s[, max_substrings])
```

**参数**

* `separator` — 分隔符。[`String`](/sql-reference/data-types/string)
* `s` — 要拆分的字符串。[`String`](/sql-reference/data-types/string)
* `max_substrings` — 可选。当 `max_substrings > 0` 时，返回的子字符串数量不会超过 `max_substrings`，否则函数会返回尽可能多的子字符串。默认值：`0`。[`Int64`](/sql-reference/data-types/int-uint)

**返回值**

返回由 `s` 中选定子字符串组成的数组 [`Array(String)`](/sql-reference/data-types/array)

**示例**

**使用示例**

```sql title=Query
SELECT splitByString(', ', '1, 2 3, 4,5, abcde');
```

```response title=Response
┌─splitByStrin⋯4,5, abcde')─┐
│ ['1','2 3','4,5','abcde'] │
└───────────────────────────┘
```

**空分隔符**

```sql title=Query
SELECT splitByString('', 'abcde');
```

```response title=Response
┌─splitByString('', 'abcde')─┐
│ ['a','b','c','d','e']      │
└────────────────────────────┘
```


## splitByWhitespace

引入版本：v21.9

将按空白字符分隔的字符串拆分为子字符串数组。

:::note
通过设置 [`splitby_max_substrings_includes_remaining_string`](../../operations/settings/settings.md#splitby_max_substrings_includes_remaining_string)（默认值：`0`），可以控制当参数 `max_substrings > 0` 时，结果数组的最后一个元素中是否包含剩余的字符串。
:::

**语法**

```sql
splitByWhitespace(s[, max_substrings])
```

**参数**

* `s` — 要拆分的字符串。[`String`](/sql-reference/data-types/string)
* `max_substrings` — 可选。当 `max_substrings > 0` 时，返回的子串数量不超过 `max_substrings`，否则函数将返回尽可能多的子串。默认值：`0`。[`Int64`](/sql-reference/data-types/int-uint)

**返回值**

返回 `s` 的所选子串的数组。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**用法示例**

```sql title=Query
SELECT splitByWhitespace('  1!  a,  b.  ');
```

```response title=Response
['1!','a,','b.']
```


## tokens \

引入版本：v21.11

使用指定的 tokenizer 将字符串拆分为若干 token。
默认的 tokenizer 使用非字母数字的 ASCII 字符作为分隔符。

对于 `split` tokenizer，如果这些 token 并不构成[前缀码](https://en.wikipedia.org/wiki/Prefix_code)，通常希望在匹配时优先选择更长的分隔符。
为此，请按照分隔符长度从长到短的顺序传入。
例如，当 separators = `['%21', '%']` 时，字符串 `%21abc` 会被切分为 `['abc']`；而当 separators = `['%', '%21']` 时，则会被切分为 `['21ac']`（这大概率不是你想要的结果）。

**语法**

```sql
tokens(value[, tokenizer[, ngrams[, separators]]])
```

**参数**

* `value` — 输入字符串。[`String`](/sql-reference/data-types/string) 或 [`FixedString`](/sql-reference/data-types/fixedstring)
* `tokenizer` — 要使用的分词器。可选值为 `splitByNonAlpha`、`ngrams`、`splitByString`、`array` 和 `sparseGrams`。可选参数，如果未显式设置，默认值为 `splitByNonAlpha`。[`const String`](/sql-reference/data-types/string)
* `ngrams` — 仅当参数 `tokenizer` 为 `ngrams` 时生效：可选参数，用于定义 ngram 的长度。如果未显式设置，默认值为 `3`。[`const UInt8`](/sql-reference/data-types/int-uint)
* `separators` — 仅当参数 `tokenizer` 为 `split` 时生效：可选参数，用于定义分隔符字符串。如果未显式设置，默认值为 `[' ']`。[`const Array(String)`](/sql-reference/data-types/array)

**返回值**

返回由输入字符串生成的标记数组（tokens）。[`Array`](/sql-reference/data-types/array)

**示例**

**默认分词器**

```sql title=Query
SELECT tokens('test1,;\\\\ test2,;\\\\ test3,;\\\\   test4') AS tokens;
```

```response title=Response
['test1','test2','test3','test4']
```

**N-gram 分词器**

```sql title=Query
SELECT tokens('abc def', 'ngrams', 3) AS tokens;
```

```response title=Response
['abc','bc ','c d',' de','def']
```

{/*AUTOGENERATED_END*/ }
