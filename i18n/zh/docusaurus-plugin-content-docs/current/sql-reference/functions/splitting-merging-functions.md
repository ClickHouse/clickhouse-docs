---
description: '字符串分割函数文档'
sidebar_label: '字符串分割'
slug: /sql-reference/functions/splitting-merging-functions
title: '字符串分割函数'
doc_type: 'reference'
---

import DeprecatedBadge from '@theme/badges/DeprecatedBadge';

# 字符串分割函数 {#functions-for-splitting-strings}

:::note
以下文档由 `system.functions` 系统表自动生成。
:::

<!--
以下标签内的内容在文档框架构建时会被替换为
从 system.functions 生成的文档。请勿修改或删除这些标签。
参见:https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
-->


<!--AUTOGENERATED_START-->

## alphaTokens {#alphaTokens}

引入版本:v1.1

从 `a-z` 和 `A-Z` 范围中选择连续字节的子字符串,并返回所选子字符串的数组。

**语法**

```sql
alphaTokens(s[, max_substrings])
```

**别名**:`splitByAlpha`

**参数**

- `s` — 要分割的字符串。[`String`](/sql-reference/data-types/string)
- `max_substrings` — 可选。当 `max_substrings > 0` 时,返回的子字符串数量不超过 `max_substrings`,否则函数将返回尽可能多的子字符串。[`Int64`](/sql-reference/data-types/int-uint)

**返回值**

返回 `s` 的所选子字符串数组。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**使用示例**

```sql title=Query
SELECT alphaTokens('abca1abc');
```

```response title=Response
┌─alphaTokens('abca1abc')─┐
│ ['abca','abc']          │
└─────────────────────────┘
```

## arrayStringConcat {#arrayStringConcat}

引入版本:v1.1

将数组中各元素的字符串表示形式使用指定的分隔符连接起来。分隔符为可选参数,默认为空字符串。

**语法**

```sql
arrayStringConcat(arr[, separator])
```

**参数**

- `arr` — 要连接的数组。[`Array(T)`](/sql-reference/data-types/array)
- `separator` — 可选参数。分隔符字符串。默认为空字符串。[`const String`](/sql-reference/data-types/string)

**返回值**

返回连接后的字符串。[`String`](/sql-reference/data-types/string)

**示例**

**使用示例**

```sql title=Query
SELECT arrayStringConcat(['12/05/2021', '12:50:00'], ' ') AS DateString;
```

```response title=Response
┌─DateString──────────┐
│ 12/05/2021 12:50:00 │
└─────────────────────┘
```

## extractAllGroupsVertical {#extractAllGroupsVertical}

引入版本:v20.5

使用正则表达式匹配字符串中的所有分组,返回一个二维数组,其中每个数组包含一次匹配中所有捕获分组的内容,按照匹配在输入字符串中出现的顺序排列。

**语法**

```sql
extractAllGroupsVertical(s, regexp)
```

**别名**:`extractAllGroups`

**参数**

- `s` — 待提取的输入字符串。[`String`](/sql-reference/data-types/string) 或 [`FixedString`](/sql-reference/data-types/fixedstring)
- `regexp` — 用于匹配的正则表达式。[`const String`](/sql-reference/data-types/string) 或 [`const FixedString`](/sql-reference/data-types/fixedstring)

**返回值**

返回一个二维数组,其中每个内部数组包含一次匹配中的所有捕获分组。每次匹配生成一个数组,其元素按顺序对应正则表达式中的捕获分组(分组 1、分组 2 等)。如果未找到匹配项,则返回空数组。[`Array(Array(String))`](/sql-reference/data-types/array)

**示例**

**使用示例**

```sql title=查询
WITH '< Server: nginx
< Date: Tue, 22 Jan 2019 00:26:14 GMT
< Content-Type: text/html; charset=UTF-8
< Connection: keep-alive
' AS s
SELECT extractAllGroupsVertical(s, '< ([\\w\\-]+): ([^\\r\\n]+)');
```

```response title=响应
[['Server','nginx'],['Date','Tue, 22 Jan 2019 00:26:14 GMT'],['Content-Type','text/html; charset=UTF-8'],['Connection','keep-alive']]
```

## ngrams {#ngrams}

引入版本:v21.11

将 UTF-8 字符串拆分为包含 `ngramsize` 个符号的 n-gram。

**语法**

```sql
ngrams(s, ngram_size)
```

**参数**

- `s` — 输入字符串。[`String`](/sql-reference/data-types/string) 或 [`FixedString`](/sql-reference/data-types/fixedstring)
- `ngram_size` — n-gram 的大小。[`const UInt8/16/32/64`](/sql-reference/data-types/int-uint)

**返回值**

返回包含 n-gram 的数组。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**使用示例**

```sql title=查询
SELECT ngrams('ClickHouse', 3);
```

```response title=响应
['Cli','lic','ick','ckH','kHo','Hou','ous','use']
```

## splitByChar {#splitByChar}

引入版本：v1.1

将由指定的单字符常量字符串 `separator` 分隔的字符串拆分为子字符串数组。
如果分隔符出现在字符串的开头或结尾，或者存在多个连续的分隔符，则可能会产生空子字符串。

:::note
设置 [`splitby_max_substrings_includes_remaining_string`](../../operations/settings/settings.md#splitby_max_substrings_includes_remaining_string)（默认值：`0`）用于控制当参数 `max_substrings > 0` 时，是否将剩余字符串包含在结果数组的最后一个元素中。
:::

在以下情况下可能会产生空子字符串：

- 分隔符出现在字符串的开头或结尾
- 存在多个连续的分隔符
- 原始字符串 `s` 为空

**语法**

```sql
splitByChar(separator, s[, max_substrings])
```

**参数**

- `separator` — 分隔符，必须是单字节字符。[`String`](/sql-reference/data-types/string)
- `s` — 要拆分的字符串。[`String`](/sql-reference/data-types/string)
- `max_substrings` — 可选参数。如果 `max_substrings > 0`，返回的数组最多包含 `max_substrings` 个子字符串，否则函数将返回尽可能多的子字符串。默认值为 `0`。[`Int64`](/sql-reference/data-types/int-uint)

**返回值**

返回由选定子字符串组成的数组。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**使用示例**

```sql title=Query
SELECT splitByChar(',', '1,2,3,abcde');
```

```response title=Response
┌─splitByChar(⋯2,3,abcde')─┐
│ ['1','2','3','abcde']    │
└──────────────────────────┘
```

## splitByNonAlpha {#splitByNonAlpha}

引入版本：v21.9

将字符串按空格和标点符号分隔并拆分为子字符串数组。

:::note
设置 [`splitby_max_substrings_includes_remaining_string`](../../operations/settings/settings.md#splitby_max_substrings_includes_remaining_string)（默认值：`0`）用于控制当参数 `max_substrings > 0` 时，是否将剩余字符串包含在结果数组的最后一个元素中。
:::

**语法**

```sql
splitByNonAlpha(s[, max_substrings])
```

**参数**

- `s` — 要拆分的字符串。[`String`](/sql-reference/data-types/string)
- `max_substrings` — 可选参数。当 `max_substrings > 0` 时，返回的子字符串数量不超过 `max_substrings`，否则函数将返回尽可能多的子字符串。默认值：`0`。[`Int64`](/sql-reference/data-types/int-uint)

**返回值**

返回 `s` 拆分后的子字符串数组。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**使用示例**

```sql title=Query
SELECT splitByNonAlpha('user@domain.com');
```

```response title=Response
['user','domain','com']
```

## splitByRegexp {#splitByRegexp}

引入版本:v21.6

根据提供的正则表达式将字符串拆分为子字符串数组。
如果提供的正则表达式为空,则将字符串拆分为单个字符的数组。
如果正则表达式未找到匹配项,则字符串不会被拆分。

在以下情况下可能会产生空子字符串:

- 非空正则表达式在字符串的开头或结尾匹配
- 存在多个连续的非空正则表达式匹配
- 原始字符串为空而正则表达式不为空。

:::note
设置 [`splitby_max_substrings_includes_remaining_string`](../../operations/settings/settings.md#splitby_max_substrings_includes_remaining_string)(默认值:`0`)控制当参数 `max_substrings > 0` 时,剩余字符串是否包含在结果数组的最后一个元素中。
:::

**语法**

```sql
splitByRegexp(regexp, s[, max_substrings])
```

**参数**

- `regexp` — 正则表达式。常量。[`String`](/sql-reference/data-types/string) 或 [`FixedString`](/sql-reference/data-types/fixedstring)
- `s` — 要拆分的字符串。[`String`](/sql-reference/data-types/string)
- `max_substrings` — 可选。当 `max_substrings > 0` 时,返回的子字符串数量不超过 `max_substrings`,否则函数将返回尽可能多的子字符串。默认值:`0`。[`Int64`](/sql-reference/data-types/int-uint)

**返回值**

返回 `s` 的子字符串数组。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**使用示例**

```sql title=查询
SELECT splitByRegexp('\\d+', 'a12bc23de345f');
```

```response title=响应
┌─splitByRegex⋯c23de345f')─┐
│ ['a12bc23de345f']        │
└──────────────────────────┘
```

**空正则表达式**

```sql title=查询
SELECT splitByRegexp('', 'abcde');
```

```response title=响应
┌─splitByRegexp('', 'abcde')─┐
│ ['a','b','c','d','e']      │
└────────────────────────────┘
```

## splitByString {#splitByString}

引入版本:v1.1

使用由多个字符组成的常量 `separator` 将字符串分割为子字符串数组。
如果 `separator` 为空字符串,则将字符串 `s` 分割为单个字符的数组。

在以下情况下可能会产生空子字符串:

- 非空分隔符出现在字符串的开头或结尾
- 存在多个连续的非空分隔符
- 原始字符串 `s` 为空而分隔符不为空

:::note
设置 [`splitby_max_substrings_includes_remaining_string`](../../operations/settings/settings.md#splitby_max_substrings_includes_remaining_string)(默认值:`0`)用于控制当参数 `max_substrings > 0` 时,是否将剩余字符串包含在结果数组的最后一个元素中。
:::

**语法**

```sql
splitByString(separator, s[, max_substrings])
```

**参数**

- `separator` — 分隔符。[`String`](/sql-reference/data-types/string)
- `s` — 要分割的字符串。[`String`](/sql-reference/data-types/string)
- `max_substrings` — 可选参数。当 `max_substrings > 0` 时,返回的子字符串数量不超过 `max_substrings`,否则函数将返回尽可能多的子字符串。默认值:`0`。[`Int64`](/sql-reference/data-types/int-uint)

**返回值**

返回 `s` 的子字符串数组 [`Array(String)`](/sql-reference/data-types/array)

**示例**

**使用示例**

```sql title=Query
SELECT splitByString(', ', '1, 2 3, 4,5, abcde');
```

```response title=Response
┌─splitByStrin⋯4,5, abcde')─┐
│ ['1','2 3','4,5','abcde'] │
└───────────────────────────┘
```

**空分隔符**

```sql title=Query
SELECT splitByString('', 'abcde');
```

```response title=Response
┌─splitByString('', 'abcde')─┐
│ ['a','b','c','d','e']      │
└────────────────────────────┘
```

## splitByWhitespace {#splitByWhitespace}

引入版本:v21.9

将由空白字符分隔的字符串拆分为子字符串数组。

:::note
设置 [`splitby_max_substrings_includes_remaining_string`](../../operations/settings/settings.md#splitby_max_substrings_includes_remaining_string)(默认值:`0`)用于控制当参数 `max_substrings > 0` 时,是否将剩余字符串包含在结果数组的最后一个元素中。
:::

**语法**

```sql
splitByWhitespace(s[, max_substrings])
```

**参数**

- `s` — 要拆分的字符串。[`String`](/sql-reference/data-types/string)
- `max_substrings` — 可选参数。当 `max_substrings > 0` 时,返回的子字符串数量不超过 `max_substrings`,否则函数将返回尽可能多的子字符串。默认值:`0`。[`Int64`](/sql-reference/data-types/int-uint)

**返回值**

返回 `s` 拆分后的子字符串数组。[`Array(String)`](/sql-reference/data-types/array)

**示例**

**使用示例**

```sql title=Query
SELECT splitByWhitespace('  1!  a,  b.  ');
```

```response title=Response
['1!','a,','b.']
```

## tokens {#tokens}

引入版本:v21.11

使用指定的分词器将字符串拆分为标记(token)。
默认分词器使用非字母数字的 ASCII 字符作为分隔符。

对于 `split` 分词器,如果标记不构成[前缀码](https://en.wikipedia.org/wiki/Prefix_code),您可能希望匹配时优先使用较长的分隔符。
为此,请按长度降序传递分隔符。
例如,使用 separators = `['%21', '%']` 时,字符串 `%21abc` 将被分词为 `['abc']`,而使用 separators = `['%', '%21']` 则会分词为 `['21ac']`(这可能不是您想要的结果)。

**语法**

```sql
tokens(value[, tokenizer[, ngrams[, separators]]])
```

**参数**

- `value` — 输入字符串。[`String`](/sql-reference/data-types/string) 或 [`FixedString`](/sql-reference/data-types/fixedstring)
- `tokenizer` — 要使用的分词器。有效参数为 `splitByNonAlpha`、`ngrams`、`splitByString`、`array` 和 `sparseGrams`。可选参数,如果未显式设置,默认为 `splitByNonAlpha`。[`const String`](/sql-reference/data-types/string)
- `ngrams` — 仅当参数 `tokenizer` 为 `ngrams` 时相关:定义 n-gram 长度的可选参数。如果未显式设置,默认为 `3`。[`const UInt8`](/sql-reference/data-types/int-uint)
- `separators` — 仅当参数 `tokenizer` 为 `split` 时相关:定义分隔符字符串的可选参数。如果未显式设置,默认为 `[' ']`。[`const Array(String)`](/sql-reference/data-types/array)

**返回值**

返回从输入字符串生成的标记数组。[`Array`](/sql-reference/data-types/array)

**示例**

**默认分词器**

```sql title=查询
SELECT tokens('test1,;\\\\ test2,;\\\\ test3,;\\\\   test4') AS tokens;
```

```response title=响应
['test1','test2','test3','test4']
```

**N-gram 分词器**

```sql title=查询
SELECT tokens('abc def', 'ngrams', 3) AS tokens;
```

```response title=响应
['abc','bc ','c d',' de','def']
```

<!--AUTOGENERATED_END-->
