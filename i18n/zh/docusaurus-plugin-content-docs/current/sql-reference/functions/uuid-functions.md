---
description: '用于处理 UUID 的函数文档'
sidebar_label: 'UUID'
slug: /sql-reference/functions/uuid-functions
title: '用于处理 UUID 的函数'
doc_type: 'reference'
---

import DeprecatedBadge from '@theme/badges/DeprecatedBadge';

# 用于处理 UUID 的函数 {#functions-for-working-with-uuids}

## UUIDv7 生成 {#uuidv7-generation}

生成的 UUID 包含一个以毫秒为单位的 Unix 48 位时间戳，随后是版本号 &quot;7&quot;（4 位）、用于区分同一毫秒内 UUID 的计数器（42 位，其中包括变体字段值为 &quot;2&quot; 的 2 位），以及一个随机字段（32 位）。
对于任意给定的时间戳（`unix_ts_ms`），计数器从一个随机值开始，对每个新的 UUID 加 1，直到时间戳发生变化为止。如果计数器溢出，则将时间戳字段加 1，并将计数器重置为新的随机起始值。
UUID 生成函数保证，在并发运行的线程和查询中，对于同一时间戳的所有函数调用，计数器字段都是单调递增的。

```text
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤
|                           unix_ts_ms                          |
├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤
|          unix_ts_ms           |  ver  |   counter_high_bits   |
├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤
|var|                   counter_low_bits                        |
├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤
|                            rand_b                             |
└─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┘
```

## Snowflake ID 生成 {#snowflake-id-generation}

生成的 Snowflake ID 包含当前以毫秒为单位的 Unix 时间戳（41 位时间戳位 + 1 位最高为 0 的比特位），随后是机器 ID（10 位）以及用于在同一毫秒内区分 ID 的计数器（12 位）。对于任意给定的时间戳（`unix_ts_ms`），计数器从 0 开始，每生成一个新的 Snowflake ID 就加 1，直到时间戳发生变化。如果计数器溢出，则将时间戳字段加 1，并将计数器重置为 0。

:::note
生成的 Snowflake ID 基于从 1970-01-01 开始的 UNIX 纪元。由于 Snowflake ID 的纪元没有统一的标准或推荐方案，不同系统中的实现可能会使用不同的纪元，例如 Twitter/X（2010-11-04）或 Mastodon（2015-01-01）。
:::

```text
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤
|0|                         timestamp                           |
├─┼                 ┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤
|                   |     machine_id    |    machine_seq_num    |
└─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┘
```

{/*
  下面标签内的内容会在文档框架构建时
  被 system.functions 自动生成的文档替换。请不要修改或删除这些标签。
  参见：https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
  */ }

{/*AUTOGENERATED_START*/ }


## UUIDNumToString {#UUIDNumToString}

自 v1.1 引入

接受一个 UUID 的二进制表示形式，其格式可以通过可选参数 `variant` 指定（默认为 `Big-endian`），并返回一个包含 36 个字符的文本格式字符串。

**语法**

```sql
UUIDNumToString(binary[, variant])
```

**参数**

* `binary` — UUID 的二进制表示。[`FixedString(16)`](/sql-reference/data-types/fixedstring)
* `variant` — 按照 [RFC4122](https://datatracker.ietf.org/doc/html/rfc4122#section-4.1.1) 指定的变体。1 = `Big-endian`（默认），2 = `Microsoft`。[`(U)Int*`](/sql-reference/data-types/int-uint)

**返回值**

以字符串形式返回 UUID。[`String`](/sql-reference/data-types/string)

**示例**

**用法示例**

```sql title=Query
SELECT
    'a/<@];!~p{jTj={)' AS bytes,
    UUIDNumToString(toFixedString(bytes, 16)) AS uuid
```

```response title=Response
┌─bytes────────────┬─uuid─────────────────────────────────┐
│ a/<@];!~p{jTj={) │ 612f3c40-5d3b-217e-707b-6a546a3d7b29 │
└──────────────────┴──────────────────────────────────────┘
```

**Microsoft 变体**

```sql title=Query
SELECT
    '@</a;]~!p{jTj={)' AS bytes,
    UUIDNumToString(toFixedString(bytes, 16), 2) AS uuid
```

```response title=Response
┌─bytes────────────┬─uuid─────────────────────────────────┐
│ @</a;]~!p{jTj={) │ 612f3c40-5d3b-217e-707b-6a546a3d7b29 │
└──────────────────┴──────────────────────────────────────┘
```


## UUIDStringToNum {#UUIDStringToNum}

自 v1.1 引入

接受一个包含 36 个字符、格式为 `xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx` 的字符串，并返回其二进制表示形式的 [FixedString(16)](../data-types/fixedstring.md)，其格式可以通过 `variant` 参数可选指定（默认为 `Big-endian`）。

**语法**

```sql
UUIDStringToNum(string[, variant = 1])
```

**参数**

* `string` — 长度为 36 个字符的字符串或定长字符串 [`String`](/sql-reference/data-types/string) 或 [`FixedString(36)`](/sql-reference/data-types/fixedstring)
* `variant` — 按照 [RFC4122](https://datatracker.ietf.org/doc/html/rfc4122#section-4.1.1) 定义的变体。1 = `Big-endian`（默认），2 = `Microsoft`。[`(U)Int*`](/sql-reference/data-types/int-uint)

**返回值**

返回 `string` 的二进制形式。[`FixedString(16)`](/sql-reference/data-types/fixedstring)

**示例**

**用法示例**

```sql title=Query
SELECT
    '612f3c40-5d3b-217e-707b-6a546a3d7b29' AS uuid,
    UUIDStringToNum(uuid) AS bytes
```

```response title=Response
┌─uuid─────────────────────────────────┬─bytes────────────┐
│ 612f3c40-5d3b-217e-707b-6a546a3d7b29 │ a/<@];!~p{jTj={) │
└──────────────────────────────────────┴──────────────────┘
```

**Microsoft 版本**

```sql title=Query
SELECT
    '612f3c40-5d3b-217e-707b-6a546a3d7b29' AS uuid,
    UUIDStringToNum(uuid, 2) AS bytes
```

```response title=Response
┌─uuid─────────────────────────────────┬─bytes────────────┐
│ 612f3c40-5d3b-217e-707b-6a546a3d7b29 │ @</a;]~!p{jTj={) │
└──────────────────────────────────────┴──────────────────┘
```


## UUIDToNum {#UUIDToNum}

引入于：v24.5

接受一个 [UUID](../data-types/uuid.md)，并返回其作为 [FixedString(16)](../data-types/fixedstring.md) 的二进制表示，其格式可通过可选参数 `variant` 指定（默认为 `Big-endian`）。
此函数用于替代组合调用 `UUIDStringToNum(toString(uuid))`，因此在从 UUID 中提取字节时，不再需要先将 UUID 中间转换为字符串。

**语法**

```sql
UUIDToNum(uuid[, variant = 1])
```

**参数**

* `uuid` — UUID。[`String`](/sql-reference/data-types/string) 或 [`FixedString`](/sql-reference/data-types/fixedstring)
* `variant` — 按照 [RFC4122](https://datatracker.ietf.org/doc/html/rfc4122#section-4.1.1) 定义的变体。1 = `Big-endian`（默认），2 = `Microsoft`。[`(U)Int*`](/sql-reference/data-types/int-uint)

**返回值**

返回 UUID 的二进制形式。[`FixedString(16)`](/sql-reference/data-types/fixedstring)

**示例**

**用法示例**

```sql title=Query
SELECT
    toUUID('612f3c40-5d3b-217e-707b-6a546a3d7b29') AS uuid,
    UUIDToNum(uuid) AS bytes
```

```response title=Response
┌─uuid─────────────────────────────────┬─bytes────────────┐
│ 612f3c40-5d3b-217e-707b-6a546a3d7b29 │ a/<@];!~p{jTj={) │
└──────────────────────────────────────┴──────────────────┘
```

**Microsoft 变体**

```sql title=Query
SELECT
    toUUID('612f3c40-5d3b-217e-707b-6a546a3d7b29') AS uuid,
    UUIDToNum(uuid, 2) AS bytes
```

```response title=Response
┌─uuid─────────────────────────────────┬─bytes────────────┐
│ 612f3c40-5d3b-217e-707b-6a546a3d7b29 │ @</a;]~!p{jTj={) │
└──────────────────────────────────────┴──────────────────┘
```


## UUIDv7ToDateTime {#UUIDv7ToDateTime}

自 v24.5 引入

返回 UUID 第 7 版的时间戳部分。

**语法**

```sql
UUIDv7ToDateTime(uuid[, timezone])
```

**参数**

* `uuid` — UUID 版本 7。[`String`](/sql-reference/data-types/string)
* `timezone` — 可选。返回值的[时区名称](../../operations/server-configuration-parameters/settings.md#timezone)。[`String`](/sql-reference/data-types/string)

**返回值**

返回一个具有毫秒级精度的时间戳。如果该 UUID 不是有效的版本 7 UUID，则返回 `1970-01-01 00:00:00.000`。[`DateTime64(3)`](/sql-reference/data-types/datetime64)

**示例**

**用法示例**

```sql title=Query
SELECT UUIDv7ToDateTime(toUUID('018f05c9-4ab8-7b86-b64e-c9f03fbd45d1'))
```

```response title=Response
┌─UUIDv7ToDateTime(toUUID('018f05c9-4ab8-7b86-b64e-c9f03fbd45d1'))─┐
│                                          2024-04-22 15:30:29.048 │
└──────────────────────────────────────────────────────────────────┘
```

**带时区信息**

```sql title=Query
SELECT UUIDv7ToDateTime(toUUID('018f05c9-4ab8-7b86-b64e-c9f03fbd45d1'), 'America/New_York')
```

```response title=Response
┌─UUIDv7ToDateTime(toUUID('018f05c9-4ab8-7b86-b64e-c9f03fbd45d1'), 'America/New_York')─┐
│                                                             2024-04-22 11:30:29.048 │
└─────────────────────────────────────────────────────────────────────────────────────┘
```


## dateTime64ToSnowflake {#dateTime64ToSnowflake}

引入于：v21.10

<DeprecatedBadge />

:::warning
此函数已弃用，仅当启用了 [`allow_deprecated_snowflake_conversion_functions`](../../operations/settings/settings.md#allow_deprecated_snowflake_conversion_functions) 该设置时才可使用。
该函数将在未来的某个时间被移除。

请改用函数 [dateTime64ToSnowflakeID](#dateTime64ToSnowflakeID)。
:::

将 [DateTime64](../data-types/datetime64.md) 转换为指定时间点的第一个 [Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID)。

**语法**

```sql
dateTime64ToSnowflake(value)
```

**参数**

* `value` — 日期时间。[`DateTime64`](/sql-reference/data-types/datetime64)

**返回值**

返回将输入值转换为该时间点对应的第一个 Snowflake ID 的结果。[`Int64`](/sql-reference/data-types/int-uint)

**示例**

**使用示例**

```sql title=Query
WITH toDateTime64('2021-08-15 18:57:56.492', 3, 'Asia/Shanghai') AS dt64 SELECT dateTime64ToSnowflake(dt64);
```

```response title=Response
┌─dateTime64ToSnowflake(dt64)─┐
│         1426860704886947840 │
└─────────────────────────────┘
```


## dateTime64ToSnowflakeID {#dateTime64ToSnowflakeID}

引入版本：v24.6

将 [DateTime64](../data-types/datetime64.md) 值转换为给定时间点对应的第一个 [Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID)。

**语法**

```sql
dateTime64ToSnowflakeID(value[, epoch])
```

**参数**

* `value` — 日期时间。[`DateTime64`](/sql-reference/data-types/datetime64)
* `epoch` — Snowflake ID 的纪元起点，自 1970-01-01 起的毫秒数。默认为 0（1970-01-01）。若使用 Twitter/X 纪元（2015-01-01），请提供 1288834974657。[`UInt*`](/sql-reference/data-types/int-uint)

**返回值**

将输入值转换为 [`UInt64`](/sql-reference/data-types/int-uint)

**示例**

**简单示例**

```sql title=Query
SELECT dateTime64ToSnowflakeID(toDateTime64('2021-08-15 18:57:56', 3, 'Asia/Shanghai'))
```

```response title=Response
6832626394434895872
```


## dateTimeToSnowflake {#dateTimeToSnowflake}

首次引入于：v21.10

<DeprecatedBadge />

:::warning
此函数已被弃用，只有在启用 [`allow_deprecated_snowflake_conversion_functions`](../../operations/settings/settings.md#allow_deprecated_snowflake_conversion_functions) 设置后才能使用。
该函数将在未来的某个时间点被移除。

请改用函数 [dateTimeToSnowflakeID](#dateTimeToSnowflakeID)。
:::

将一个 [DateTime](../data-types/datetime.md) 值转换为该时间点生成的第一个 [Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID)。

**语法**

```sql
dateTimeToSnowflake(value)
```

**参数**

* `value` — 带时间的日期。[`DateTime`](/sql-reference/data-types/datetime)

**返回值**

返回该时间点对应的第一个 Snowflake ID。[`Int64`](/sql-reference/data-types/int-uint)

**示例**

**使用示例**

```sql title=Query
WITH toDateTime('2021-08-15 18:57:56', 'Asia/Shanghai') AS dt SELECT dateTimeToSnowflake(dt);
```

```response title=Response
┌─dateTimeToSnowflake(dt)─┐
│     1426860702823350272 │
└─────────────────────────┘
```


## dateTimeToSnowflakeID {#dateTimeToSnowflakeID}

自 v24.6 引入

将 [DateTime](../data-types/datetime.md) 值转换为在给定时间对应的第一个 [Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID)。

**语法**

```sql
dateTimeToSnowflakeID(value[, epoch])
```

**参数**

* `value` — 包含时间的日期值。[`DateTime`](/sql-reference/data-types/datetime)
* `epoch` — Snowflake ID 的纪元时间，自 1970-01-01 起按毫秒计算。默认值为 0（1970-01-01）。Twitter/X 纪元（2015-01-01）对应的值为 1288834974657。[`UInt*`](/sql-reference/data-types/int-uint)

**返回值**

输入值转换后的结果为 [`UInt64`](/sql-reference/data-types/int-uint)

**示例**

**简单示例**

```sql title=Query
SELECT dateTimeToSnowflakeID(toDateTime('2021-08-15 18:57:56', 'Asia/Shanghai'))
```

```response title=Response
6832626392367104000
```


## dateTimeToUUIDv7 {#dateTimeToUUIDv7}

引入版本：v25.9

将 [DateTime](../data-types/datetime.md) 值在给定时间点转换为 [UUIDv7](https://en.wikipedia.org/wiki/UUID#Version_7)。

有关 UUID 结构、计数器管理和并发保证的详细信息，请参阅 [&quot;UUIDv7 generation&quot;](#uuidv7-generation) 一节。

:::note
截至 2025 年 9 月，UUID 版本 7 仍处于草案阶段，其布局未来可能会发生变化。
:::

**语法**

```sql
dateTimeToUUIDv7(value)
```

**参数**

* `value` — DateTime 类型的日期时间值。[`DateTime`](/sql-reference/data-types/datetime)

**返回值**

返回一个 UUIDv7 值。[`UUID`](/sql-reference/data-types/uuid)

**示例**

**用法示例**

```sql title=Query
SELECT dateTimeToUUIDv7(toDateTime('2021-08-15 18:57:56', 'Asia/Shanghai'));
```

```response title=Response
┌─dateTimeToUUIDv7(toDateTime('2021-08-15 18:57:56', 'Asia/Shanghai'))─┐
│ 018f05af-f4a8-778f-beee-1bedbc95c93b                                   │
└─────────────────────────────────────────────────────────────────────────┘
```

**同一时间戳生成的多个 UUID**

```sql title=Query
SELECT dateTimeToUUIDv7(toDateTime('2021-08-15 18:57:56'));
SELECT dateTimeToUUIDv7(toDateTime('2021-08-15 18:57:56'));
```

```response title=Response
┌─dateTimeToUUIDv7(t⋯08-15 18:57:56'))─┐
│ 017b4b2d-7720-76ed-ae44-bbcc23a8c550 │
└──────────────────────────────────────┘
┌─dateTimeToUUIDv7(t⋯08-15 18:57:56'))─┐
│ 017b4b2d-7720-76ed-ae44-bbcf71ed0fd3 │
└──────────────────────────────────────┘
```


## generateSnowflakeID {#generateSnowflakeID}

引入版本：v24.6

生成一个 [Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID)。

`generateSnowflakeID` 函数保证在并发运行的线程和查询中，时间戳中的计数器字段在所有函数调用中单调递增。

实现细节参见 [&quot;Snowflake ID generation&quot;](#snowflake-id-generation) 一节。

**语法**

```sql
generateSnowflakeID([expr, [machine_id]])
```

**参数**

* `expr` — 任意[表达式](/sql-reference/syntax#expressions)，在查询中多次调用该函数时用于绕过[公共子表达式消除](/sql-reference/functions/overview#common-subexpression-elimination)优化。该表达式的值不会影响返回的 Snowflake ID。可选。 - `machine_id` — 机器 ID，使用其最低 10 位。[Int64](../data-types/int-uint.md)。可选。

**返回值**

返回 Snowflake ID。[`UInt64`](/sql-reference/data-types/int-uint)

**示例**

**用法示例**

```sql title=Query
CREATE TABLE tab (id UInt64)
ENGINE = MergeTree()
ORDER BY tuple();

INSERT INTO tab SELECT generateSnowflakeID();

SELECT * FROM tab;
```

```response title=Response
┌──────────────────id─┐
│ 7199081390080409600 │
└─────────────────────┘
```

**每行会生成多个 Snowflake ID**

```sql title=Query
SELECT generateSnowflakeID(1), generateSnowflakeID(2);
```

```response title=Response
┌─generateSnowflakeID(1)─┬─generateSnowflakeID(2)─┐
│    7199081609652224000 │    7199081609652224001 │
└────────────────────────┴────────────────────────┘
```

**结合表达式和机器 ID**

```sql title=Query
SELECT generateSnowflakeID('expr', 1);
```

```response title=Response
┌─generateSnowflakeID('expr', 1)─┐
│            7201148511606784002 │
└────────────────────────────────┘
```


## generateUUIDv4 {#generateUUIDv4}

自 v1.1 起引入

生成一个[第 4 版](https://tools.ietf.org/html/rfc4122#section-4.4) [UUID](../data-types/uuid.md)。

**语法**

```sql
generateUUIDv4([expr])
```

**参数**

* `expr` — 可选。任意表达式，用于在函数在同一查询中被多次调用时，绕过[公共子表达式消除](/sql-reference/functions/overview#common-subexpression-elimination)。该表达式的值不会影响返回的 UUID。

**返回值**

返回一个 UUIDv4。[`UUID`](/sql-reference/data-types/uuid)

**示例**

**用法示例**

```sql title=Query
SELECT generateUUIDv4(number) FROM numbers(3);
```

```response title=Response
┌─generateUUIDv4(number)───────────────┐
│ fcf19b77-a610-42c5-b3f5-a13c122f65b6 │
│ 07700d36-cb6b-4189-af1d-0972f23dc3bc │
│ 68838947-1583-48b0-b9b7-cf8268dd343d │
└──────────────────────────────────────┘
```

**公共子表达式消除**

```sql title=Query
SELECT generateUUIDv4(1), generateUUIDv4(1);
```

```response title=Response
┌─generateUUIDv4(1)────────────────────┬─generateUUIDv4(2)────────────────────┐
│ 2d49dc6e-ddce-4cd0-afb8-790956df54c1 │ 2d49dc6e-ddce-4cd0-afb8-790956df54c1 │
└──────────────────────────────────────┴──────────────────────────────────────┘
```


## generateUUIDv7 {#generateUUIDv7}

引入于：v24.5

生成一个[版本 7](https://datatracker.ietf.org/doc/html/draft-peabody-dispatch-new-uuid-format-04) [UUID](../data-types/uuid.md)。

关于 UUID 结构、计数器管理以及并发保证的详细信息，请参阅 [“UUIDv7 generation”](#uuidv7-generation) 一节。

:::note
截至 2025 年 9 月，版本 7 UUID 仍处于草案状态，其布局在未来可能会发生变化。
:::

**语法**

```sql
generateUUIDv7([expr])
```

**参数**

* `expr` — 可选。任意表达式，当在一次查询中多次调用该函数时，用于绕过[公共子表达式消除](/sql-reference/functions/overview#common-subexpression-elimination)。该表达式的值不会影响返回的 UUID。[`Any`](/sql-reference/data-types)

**返回值**

返回一个 UUIDv7。[`UUID`](/sql-reference/data-types/uuid)

**示例**

**用法示例**

```sql title=Query
SELECT generateUUIDv7(number) FROM numbers(3);
```

```response title=Response
┌─generateUUIDv7(number)───────────────┐
│ 019947fb-5766-7ed0-b021-d906f8f7cebb │
│ 019947fb-5766-7ed0-b021-d9072d0d1e07 │
│ 019947fb-5766-7ed0-b021-d908dca2cf63 │
└──────────────────────────────────────┘
```

**公共子表达式消除**

```sql title=Query
SELECT generateUUIDv7(1), generateUUIDv7(1);
```

```response title=Response
┌─generateUUIDv7(1)────────────────────┬─generateUUIDv7(1)────────────────────┐
│ 019947ff-0f87-7d88-ace0-8b5b3a66e0c1 │ 019947ff-0f87-7d88-ace0-8b5b3a66e0c1 │
└──────────────────────────────────────┴──────────────────────────────────────┘
```


## snowflakeIDToDateTime {#snowflakeIDToDateTime}

引入自：v24.6

返回 [Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID) 中时间戳部分对应的 [DateTime](../data-types/datetime.md) 类型值。

**语法**

```sql
snowflakeIDToDateTime(value[, epoch[, time_zone]])
```

**参数**

* `value` — Snowflake ID。[`UInt64`](/sql-reference/data-types/int-uint)
* `epoch` — 可选。Snowflake ID 的 epoch（自 1970-01-01 起的毫秒数）。默认值为 0（1970-01-01）。对于 Twitter/X 的 epoch（2015-01-01），请提供 1288834974657。[`UInt*`](/sql-reference/data-types/int-uint)
* `time_zone` — 可选。[Timezone](/operations/server-configuration-parameters/settings.md#timezone)。函数会根据该时区解析 `time_string`。[`String`](/sql-reference/data-types/string)

**返回值**

返回 `value` 的时间戳部分。[`DateTime`](/sql-reference/data-types/datetime)

**示例**

**用法示例**

```sql title=Query
SELECT snowflakeIDToDateTime(7204436857747984384) AS res
```

```response title=Response
┌─────────────────res─┐
│ 2024-06-06 10:59:58 │
└─────────────────────┘
```


## snowflakeIDToDateTime64 {#snowflakeIDToDateTime64}

引入版本：v24.6

返回 [Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID) 的时间戳部分，类型为 [DateTime64](../data-types/datetime64.md)。

**语法**

```sql
snowflakeIDToDateTime64(value[, epoch[, time_zone]])
```

**参数**

* `value` — Snowflake ID。[`UInt64`](/sql-reference/data-types/int-uint)
* `epoch` — 可选。Snowflake ID 的 epoch，以自 1970-01-01 起经过的毫秒数表示。默认为 0（1970-01-01）。对于 Twitter/X 所使用的 epoch（2015-01-01），请提供 1288834974657。[`UInt*`](/sql-reference/data-types/int-uint)
* `time_zone` — 可选。[Timezone](/operations/server-configuration-parameters/settings.md#timezone)。函数会根据 `time_zone` 指定的时区解析 `time_string`。[`String`](/sql-reference/data-types/string)

**返回值**

返回 `value` 的时间戳部分，类型为 `DateTime64`，scale = 3，即毫秒精度。[`DateTime64`](/sql-reference/data-types/datetime64)

**示例**

**使用示例**

```sql title=Query
SELECT snowflakeIDToDateTime64(7204436857747984384) AS res
```

```response title=Response
┌─────────────────res─┐
│ 2024-06-06 10:59:58 │
└─────────────────────┘
```


## snowflakeToDateTime {#snowflakeToDateTime}

引入于：v21.10

<DeprecatedBadge />

:::warning
此函数已弃用，仅当启用了 [`allow_deprecated_snowflake_conversion_functions`](../../operations/settings/settings.md#allow_deprecated_snowflake_conversion_functions) 设置时才能使用。
该函数将在未来的某个版本中移除。

请改用函数 [`snowflakeIDToDateTime`](#snowflakeIDToDateTime)。
:::

从 [Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID) 中提取时间戳部分，并以 [DateTime](../data-types/datetime.md) 格式返回。

**语法**

```sql
snowflakeToDateTime(value[, time_zone])
```

**参数**

* `value` — Snowflake ID。[`Int64`](/sql-reference/data-types/int-uint)
* `time_zone` — 可选参数。[Timezone](/operations/server-configuration-parameters/settings.md#timezone)。函数会根据该时区解析 `time_string`。[`String`](/sql-reference/data-types/string)

**返回值**

返回 `value` 中的时间戳部分。[`DateTime`](/sql-reference/data-types/datetime)

**示例**

**用法示例**

```sql title=Query
SELECT snowflakeToDateTime(CAST('1426860702823350272', 'Int64'), 'UTC');
```

```response title=Response
┌─snowflakeToDateTime(CAST('1426860702823350272', 'Int64'), 'UTC')─┐
│                                              2021-08-15 10:57:56 │
└──────────────────────────────────────────────────────────────────┘
```


## snowflakeToDateTime64 {#snowflakeToDateTime64}

引入版本：v21.10

<DeprecatedBadge />

:::warning
此函数已弃用，只有在启用设置 [`allow_deprecated_snowflake_conversion_functions`](../../operations/settings/settings.md#allow_deprecated_snowflake_conversion_functions) 时才能使用。
该函数将在未来的某个时间被移除。

请改用函数 [`snowflakeIDToDateTime64`](#snowflakeIDToDateTime64)。
:::

提取 [Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID) 中的时间戳部分，并以 [DateTime64](../data-types/datetime64.md) 格式返回。

**语法**

```sql
snowflakeToDateTime64(value[, time_zone])
```

**参数**

* `value` — Snowflake ID。[`Int64`](/sql-reference/data-types/int-uint)
* `time_zone` — 可选。[Timezone](/operations/server-configuration-parameters/settings.md#timezone)。函数会按照指定时区解析 `time_string`。[`String`](/sql-reference/data-types/string)

**返回值**

返回 `value` 的时间戳部分。[`DateTime64(3)`](/sql-reference/data-types/datetime64)

**示例**

**使用示例**

```sql title=Query
SELECT snowflakeToDateTime64(CAST('1426860802823350272', 'Int64'), 'UTC');
```

```response title=Response
┌─snowflakeToDateTime64(CAST('1426860802823350272', 'Int64'), 'UTC')─┐
│                                            2021-08-15 10:58:19.841 │
└────────────────────────────────────────────────────────────────────┘
```


## toUUIDOrDefault {#toUUIDOrDefault}

引入版本：v21.1

将一个 String 值转换为 UUID 类型。如果转换失败，则返回一个默认 UUID 值，而不是抛出错误。

该函数会尝试解析一个长度为 36 个字符、采用标准 UUID 格式（xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx）的字符串。
如果该字符串无法转换为有效的 UUID，函数将返回所提供的默认 UUID 值。

**语法**

```sql
toUUIDOrDefault(string, default)
```

**参数**

* `string` — 要转换为 UUID 的、长度为 36 个字符的 String 或 FixedString(36)。
* `default` — 当第一个参数无法转换为 UUID 类型时返回的 UUID 值。

**返回值**

如果转换成功，则返回转换后的 UUID；如果转换失败，则返回默认的 UUID。[`UUID`](/sql-reference/data-types/uuid)

**示例**

**转换成功时返回解析得到的 UUID**

```sql title=Query
SELECT toUUIDOrDefault('61f0c404-5cb3-11e7-907b-a6006ad3dba0', toUUID('59f0c404-5cb3-11e7-907b-a6006ad3dba0'));
```

```response title=Response
┌─toUUIDOrDefault('61f0c404-5cb3-11e7-907b-a6006ad3dba0', toUUID('59f0c404-5cb3-11e7-907b-a6006ad3dba0'))─┐
│ 61f0c404-5cb3-11e7-907b-a6006ad3dba0                                                                     │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

**失败的转换会返回默认 UUID**

```sql title=Query
SELECT toUUIDOrDefault('-----61f0c404-5cb3-11e7-907b-a6006ad3dba0', toUUID('59f0c404-5cb3-11e7-907b-a6006ad3dba0'));
```

```response title=Response
┌─toUUIDOrDefault('-----61f0c404-5cb3-11e7-907b-a6006ad3dba0', toUUID('59f0c404-5cb3-11e7-907b-a6006ad3dba0'))─┐
│ 59f0c404-5cb3-11e7-907b-a6006ad3dba0                                                                          │
└───────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```


## toUUIDOrNull {#toUUIDOrNull}

引入版本：v20.12

将输入值转换为 `UUID` 类型的值，但在出错时返回 `NULL`。

类似于 [`toUUID`](/sql-reference/functions/type-conversion-functions#toUUID)，但在转换出错时返回 `NULL` 而不是抛出异常。

支持的参数：

* 标准格式的 UUID 字符串表示（8-4-4-4-12 个十六进制数字）。
* 不带连字符的 UUID 字符串表示（32 个十六进制数字）。

不支持的参数（返回 `NULL`）：

* 无效的字符串格式。
* 非字符串类型。
* 格式错误的 UUID。

**语法**

```sql
toUUIDOrNull(x)
```

**参数**

* `x` — UUID 的字符串表示形式。[`String`](/sql-reference/data-types/string)

**返回值**

成功时返回 UUID 值，否则返回 `NULL`。[`UUID`](/sql-reference/data-types/uuid) 或 [`NULL`](/sql-reference/syntax#null)

**示例**

**用法示例**

```sql title=Query
SELECT
    toUUIDOrNull('550e8400-e29b-41d4-a716-446655440000') AS valid_uuid,
    toUUIDOrNull('invalid-uuid') AS invalid_uuid
```

```response title=Response
┌─valid_uuid───────────────────────────┬─invalid_uuid─┐
│ 550e8400-e29b-41d4-a716-446655440000 │         ᴺᵁᴸᴸ │
└──────────────────────────────────────┴──────────────┘
```

{/*AUTOGENERATED_END*/ }
