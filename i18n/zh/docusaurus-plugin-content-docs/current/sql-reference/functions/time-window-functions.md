---
description: '时间窗口函数相关文档'
sidebar_label: '时间窗口'
slug: /sql-reference/functions/time-window-functions
title: '时间窗口函数'
doc_type: 'reference'
keywords: ['时间窗口']
---

import ExperimentalBadge from '@theme/badges/ExperimentalBadge';
import CloudNotSupportedBadge from '@theme/badges/CloudNotSupportedBadge';


# 时间窗口函数

<ExperimentalBadge />
<CloudNotSupportedBadge />

时间窗口函数返回相应窗口的闭下界和开上界。
以下列出了用于 [WindowView](/sql-reference/statements/create/view#window-view) 的函数:

<!--
以下标签内的内容在文档框架构建时会被
从 system.functions 生成的文档所替换。请勿修改或删除这些标签。
参见: https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
-->


<!--AUTOGENERATED_START-->

## hop {#hop}

引入版本：v21.12

跳跃时间窗口具有固定的持续时间（`window_interval`），并按指定的跳跃间隔（`hop_interval`）进行跳跃。如果 `hop_interval` 小于 `window_interval`，跳跃窗口会发生重叠。因此，记录可以被分配到多个窗口。

由于一条记录可以被分配到多个跳跃窗口，当在没有 WINDOW VIEW 的情况下使用 hop 函数时，该函数仅返回第一个窗口的边界。

**语法**

```sql
hop(time_attr, hop_interval, window_interval[, timezone])
```

**参数**

- `time_attr` — 日期和时间。[`DateTime`](/sql-reference/data-types/datetime)
- `hop_interval` — 正数跳跃间隔。[`Interval`](/sql-reference/data-types/int-uint)
- `window_interval` — 正数窗口间隔。[`Interval`](/sql-reference/data-types/int-uint)
- `timezone` — 可选。时区名称。[`String`](/sql-reference/data-types/string)

**返回值**

返回相应跳跃窗口的包含下界和不包含上界。[`Tuple(DateTime, DateTime)`](/sql-reference/data-types/tuple)

**示例**

**跳跃窗口**

```sql title=Query
SELECT hop(now(), INTERVAL '1' DAY, INTERVAL '2' DAY)
```

```response title=Response
('2024-07-03 00:00:00','2024-07-05 00:00:00')
```


## hopEnd {#hopEnd}

引入版本:v22.1

返回对应跳跃窗口的排他上界。

由于一条记录可以分配给多个跳跃窗口,当在没有 `WINDOW VIEW` 的情况下使用 hop 函数时,该函数仅返回第一个窗口的边界。

**语法**

```sql
hopEnd(time_attr, hop_interval, window_interval[, timezone])
```

**参数**

- `time_attr` — 日期和时间。[`DateTime`](/sql-reference/data-types/datetime)
- `hop_interval` — 正跳跃间隔。[`Interval`](/sql-reference/data-types/int-uint)
- `window_interval` — 正窗口间隔。[`Interval`](/sql-reference/data-types/int-uint)
- `timezone` — 可选。时区名称。[`String`](/sql-reference/data-types/string)

**返回值**

返回对应跳跃窗口的排他上界。 [`DateTime`](/sql-reference/data-types/datetime)

**示例**

**跳跃窗口结束时间**

```sql title=Query
SELECT hopEnd(now(), INTERVAL '1' DAY, INTERVAL '2' DAY)
```

```response title=Response
2024-07-05 00:00:00
```


## hopStart {#hopStart}

引入版本:v22.1

返回对应跳跃窗口的起始边界(包含该边界)。

由于一条记录可以分配给多个跳跃窗口,当在没有 `WINDOW VIEW` 的情况下使用 hop 函数时,该函数仅返回第一个窗口的边界。

**语法**

```sql
hopStart(time_attr, hop_interval, window_interval[, timezone])
```

**参数**

- `time_attr` — 日期和时间。[`DateTime`](/sql-reference/data-types/datetime)
- `hop_interval` — 跳跃间隔,必须为正值。[`Interval`](/sql-reference/data-types/int-uint)
- `window_interval` — 窗口间隔,必须为正值。[`Interval`](/sql-reference/data-types/int-uint)
- `timezone` — 可选参数。时区名称。[`String`](/sql-reference/data-types/string)

**返回值**

返回对应跳跃窗口的起始边界(包含该边界)。[`DateTime`](/sql-reference/data-types/datetime)

**示例**

**跳跃窗口起始时间**

```sql title=查询
SELECT hopStart(now(), INTERVAL '1' DAY, INTERVAL '2' DAY)
```

```response title=响应
2024-07-03 00:00:00
```


## tumble {#tumble}

引入版本:v21.12

滚动时间窗口将记录分配到固定时长(`interval`)的非重叠连续窗口中。

**语法**

```sql
tumble(time_attr, interval[, timezone])
```

**参数**

- `time_attr` — 日期和时间。[`DateTime`](/sql-reference/data-types/datetime)
- `interval` — 窗口时间间隔。[`Interval`](/sql-reference/data-types/int-uint)
- `timezone` — 可选参数。时区名称。[`String`](/sql-reference/data-types/string)

**返回值**

返回对应滚动窗口的下界(包含)和上界(不包含)。[`Tuple(DateTime, DateTime)`](/sql-reference/data-types/tuple)

**示例**

**滚动窗口**

```sql title=Query
SELECT tumble(now(), toIntervalDay('1'))
```

```response title=Response
('2024-07-04 00:00:00','2024-07-05 00:00:00')
```


## tumbleEnd {#tumbleEnd}

引入版本：v22.1

返回相应滚动窗口的不包含上界。

**语法**

```sql
tumbleEnd(time_attr, interval[, timezone])
```

**参数**

- `time_attr` — 日期和时间。 [`DateTime`](/sql-reference/data-types/datetime)
- `interval` — 窗口间隔，Interval 类型。 [`Interval`](/sql-reference/data-types/int-uint)
- `timezone` — 可选参数。时区名称。 [`String`](/sql-reference/data-types/string)

**返回值**

返回相应滚动窗口的不包含上界。 [`DateTime`](/sql-reference/data-types/datetime)

**示例**

**滚动窗口结束时间**

```sql title=Query
SELECT tumbleEnd(now(), toIntervalDay('1'))
```

```response title=Response
2024-07-05 00:00:00
```


## tumbleStart {#tumbleStart}

引入版本:v22.1

返回对应滚动窗口的起始边界(包含该边界)。

**语法**

```sql
tumbleStart(time_attr, interval[, timezone])
```

**参数**

- `time_attr` — 日期和时间。[`DateTime`](/sql-reference/data-types/datetime)
- `interval` — 窗口间隔,类型为 Interval。[`Interval`](/sql-reference/data-types/int-uint)
- `timezone` — 可选参数。时区名称。[`String`](/sql-reference/data-types/string)

**返回值**

返回对应滚动窗口的起始边界(包含该边界)。[`DateTime`](/sql-reference/data-types/datetime)

**示例**

**滚动窗口起始时间**

```sql title=Query
SELECT tumbleStart(now(), toIntervalDay('1'))
```

```response title=Response
2024-07-04 00:00:00
```

<!--AUTOGENERATED_END-->


## 相关内容 {#related-content}

- [时间序列用例指南](/use-cases/time-series)
