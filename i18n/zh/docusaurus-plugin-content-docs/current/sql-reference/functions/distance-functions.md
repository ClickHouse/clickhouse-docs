---
description: '距离函数文档'
sidebar_label: '距离'
slug: /sql-reference/functions/distance-functions
title: '距离函数'
keywords: ['距离函数', '范数', '距离', '向量']
doc_type: '参考文档'
---

# 距离函数 \{#distance-functions\}

{/* 
  下面标签内部的内容会在文档框架构建过程中，
  被 system.functions 自动生成的文档替换。请不要修改或删除这些标签。
  参见：https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
  */ }

{/*AUTOGENERATED_START*/ }

## L1Distance \{#L1Distance\}

引入于：v21.11

计算 `L1` 空间中两点之间的距离（向量的元素为坐标）（1-范数，即 [taxicab geometry](https://en.wikipedia.org/wiki/Taxicab_geometry) 距离）。

**语法**

```sql
L1Distance(vector1, vector2)
```

**别名**：`distanceL1`

**参数**

* `vector1` — 第一个向量。[`Tuple(T)`](/sql-reference/data-types/tuple) 或 [`Array(T)`](/sql-reference/data-types/array)
* `vector2` — 第二个向量。[`Tuple(T)`](/sql-reference/data-types/tuple) 或 [`Array(T)`](/sql-reference/data-types/array)

**返回值**

返回 1-范数距离值。[`UInt32`](/sql-reference/data-types/int-uint) 或 [`Float64`](/sql-reference/data-types/float)

**示例**

**基本用法**

```sql title=Query
SELECT L1Distance((1, 2), (2, 3))
```

```response title=Response
┌─L1Distance((1, 2), (2, 3))─┐
│                          2 │
└────────────────────────────┘
```

## L1Norm \{#L1Norm\}

引入版本：v21.11

计算向量中各元素绝对值的和。

**语法**

```sql
L1Norm(vector)
```

**别名**: `normL1`

**参数**

* `vector` — 数值向量或元组。[`Array(T)`](/sql-reference/data-types/array) 或 [`Tuple(T)`](/sql-reference/data-types/tuple)

**返回值**

返回 L1 范数或 [出租车几何（taxicab geometry）](https://en.wikipedia.org/wiki/Taxicab_geometry) 距离。[`UInt*`](/sql-reference/data-types/int-uint) 或 [`Float*`](/sql-reference/data-types/float) 或 [`Decimal`](/sql-reference/data-types/decimal)

**示例**

**基本用法**

```sql title=Query
SELECT L1Norm((1, 2))
```

```response title=Response
┌─L1Norm((1, 2))─┐
│              3 │
└────────────────┘
```

## L1Normalize \{#L1Normalize\}

引入版本：v21.11

在 `L1` 空间（[出租车几何](https://en.wikipedia.org/wiki/Taxicab_geometry)）中，计算给定向量的单位向量（元组的元素表示坐标）。

**语法**

```sql
L1Normalize(tuple)
```

**别名**: `normalizeL1`

**参数**

* `tuple` — 数值组成的元组。[`Tuple(T)`](/sql-reference/data-types/tuple)

**返回值**

返回单位向量。[`Tuple(Float64)`](/sql-reference/data-types/tuple)

**示例**

**基本用法**

```sql title=Query
SELECT L1Normalize((1, 2))
```

```response title=Response
┌─L1Normalize((1, 2))─────────────────────┐
│ (0.3333333333333333,0.6666666666666666) │
└─────────────────────────────────────────┘
```

## L2Distance \{#L2Distance\}

引入版本：v21.11

计算欧几里得空间中两个点之间的距离（将向量的各元素视为坐标）（[Euclidean distance](https://en.wikipedia.org/wiki/Euclidean_distance)）。

**语法**

```sql
L2Distance(vector1, vector2)
```

**别名**: `distanceL2`

**参数**

* `vector1` — 第一个向量。[`Tuple(T)`](/sql-reference/data-types/tuple) 或 [`Array(T)`](/sql-reference/data-types/array)
* `vector2` — 第二个向量。[`Tuple(T)`](/sql-reference/data-types/tuple) 或 [`Array(T)`](/sql-reference/data-types/array)

**返回值**

返回 2 范数距离。[`Float64`](/sql-reference/data-types/float)

**示例**

**基本用法**

```sql title=Query
SELECT L2Distance((1, 2), (2, 3))
```

```response title=Response
┌─L2Distance((1, 2), (2, 3))─┐
│         1.4142135623730951 │
└────────────────────────────┘
```

## L2DistanceTransposed \{#L2DistanceTransposed\}

自 v25.10 引入

计算欧几里得空间中两个点之间的近似距离（向量的各个分量作为坐标）（参见 [Euclidean distance](https://en.wikipedia.org/wiki/Euclidean_distance)）。

**语法**

```sql
L2DistanceTransposed(vector1, vector2, p)
```

**别名**: `distanceL2Transposed`

**参数**

* `vectors` — 向量。[`QBit(T, UInt64)`](/sql-reference/data-types/qbit)
* `reference` — 参考向量。[`Array(T)`](/sql-reference/data-types/array)
* `p` — 在距离计算中从每个向量元素中使用的位数（1 到该元素的位宽）。量化级别控制精度与速度之间的权衡。使用较少的位可以带来更快的 I/O 和计算速度，但精度会降低；使用更多的位可以提高精度，但会牺牲性能。[`UInt`](/sql-reference/data-types/int-uint)

**返回值**

返回近似的 2-范数距离。[`Float64`](/sql-reference/data-types/float)

**示例**

**基本用法**

```sql title=Query
CREATE TABLE qbit (id UInt32, vec QBit(Float64, 2)) ENGINE = Memory;
INSERT INTO qbit VALUES (1, [0, 1]);
SELECT L2DistanceTransposed(vec, array(1, 2), 16) FROM qbit;
```

```response title=Response
┌─L2DistanceTransposed([0, 1], [1, 2], 16)─┐
│                       1.4142135623730951 │
└──────────────────────────────────────────┘
```

## L2Norm \{#L2Norm\}

在 v21.11 中引入

计算向量各元素平方和的平方根。

**语法**

```sql
L2Norm(vector)
```

**别名**: `normL2`

**参数**

* `vector` — 数值向量或元组类型。[`Tuple(T)`](/sql-reference/data-types/tuple) 或 [`Array(T)`](/sql-reference/data-types/array)

**返回值**

返回 L2 范数或 [欧氏距离](https://en.wikipedia.org/wiki/Euclidean_distance)。[`UInt*`](/sql-reference/data-types/int-uint) 或 [`Float*`](/sql-reference/data-types/float)

**示例**

**基本用法**

```sql title=Query
SELECT L2Norm((1, 2))
```

```response title=Response
┌───L2Norm((1, 2))─┐
│ 2.23606797749979 │
└──────────────────┘
```

## L2Normalize \{#L2Normalize\}

引入版本：v21.11

在欧几里得空间中，计算给定向量（元组的元素为各坐标）的单位向量（基于[欧几里得距离](https://en.wikipedia.org/wiki/Euclidean_distance)）。

**语法**

```sql
L2Normalize(tuple)
```

**别名**: `normalizeL2`

**参数**

* `tuple` — 一个数值类型的元组。[`Tuple(T)`](/sql-reference/data-types/tuple)

**返回值**

返回一个单位向量。[`Tuple(Float64)`](/sql-reference/data-types/tuple)

**示例**

**基本用法**

```sql title=Query
SELECT L2Normalize((3, 4))
```

```response title=Response
┌─L2Normalize((3, 4))─┐
│ (0.6,0.8)           │
└─────────────────────┘
```

## L2SquaredDistance \{#L2SquaredDistance\}

自 v22.7 引入

计算两个向量对应元素差的平方和。

**语法**

```sql
L2SquaredDistance(vector1, vector2)
```

**别名**: `distanceL2Squared`

**参数**

* `vector1` — 第一个向量。[`Tuple(T)`](/sql-reference/data-types/tuple) 或 [`Array(T)`](/sql-reference/data-types/array)
* `vector2` — 第二个向量。[`Tuple(T)`](/sql-reference/data-types/array) 或 [`Array(T)`](/sql-reference/data-types/array)

**返回值**

返回两个向量对应元素差值的平方和。[`Float64`](/sql-reference/data-types/float)

**示例**

**基础用法**

```sql title=Query
SELECT L2SquaredDistance([1, 2, 3], [0, 0, 0])
```

```response title=Response
┌─L2SquaredDis⋯ [0, 0, 0])─┐
│                       14 │
└──────────────────────────┘
```

## L2SquaredNorm \{#L2SquaredNorm\}

引入版本：v22.7

计算向量元素平方和的平方根（[`L2Norm`](#L2Norm)）的平方。

**语法**

```sql
L2SquaredNorm(vector)
```

**别名**: `normL2Squared`

**参数**

* `vector` — 数值向量或元组。[`Array(T)`](/sql-reference/data-types/array) 或 [`Tuple(T)`](/sql-reference/data-types/tuple)

**返回值**

返回 L2 范数的平方。[`UInt*`](/sql-reference/data-types/int-uint) 或 [`Float*`](/sql-reference/data-types/float) 或 [`Decimal`](/sql-reference/data-types/decimal)

**示例**

**基本用法**

```sql title=Query
SELECT L2SquaredNorm((1, 2))
```

```response title=Response
┌─L2SquaredNorm((1, 2))─┐
│                     5 │
└───────────────────────┘
```

## LinfDistance \{#LinfDistance\}

引入版本：v21.11

计算两个点在 `L_{inf}` 空间中的距离（向量的元素为坐标），即使用[最大范数（maximum norm）](https://en.wikipedia.org/wiki/Norm_\(mathematics\)#Maximum_norm_\(special_case_of:_infinity_norm,_uniform_norm,_or_supremum_norm\))。

**语法**

```sql
LinfDistance(vector1, vector2)
```

**别名**: `distanceLinf`

**参数**

* `vector1` — 第一个向量。[`Tuple(T)`](/sql-reference/data-types/tuple) 或 [`Array(T)`](/sql-reference/data-types/array)
* `vector2` — 第二个向量。[`Tuple(T)`](/sql-reference/data-types/array) 或 [`Array(T)`](/sql-reference/data-types/array)

**返回值**

返回无穷范数（Infinity-norm）距离。[`Float64`](/sql-reference/data-types/float)

**示例**

**基本用法**

```sql title=Query
SELECT LinfDistance((1, 2), (2, 3))
```

```response title=Response
┌─LinfDistance((1, 2), (2, 3))─┐
│                            1 │
└──────────────────────────────┘
```

## LinfNorm \{#LinfNorm\}

引入版本：v21.11

计算向量各元素绝对值的最大值。

**语法**

```sql
LinfNorm(vector)
```

**别名**: `normLinf`

**参数**

* `vector` — 数值向量或元组。[`Array(T)`](/sql-reference/data-types/array) 或 [`Tuple(T)`](/sql-reference/data-types/tuple)

**返回值**

返回 Linf 范数或最大绝对值。[`Float64`](/sql-reference/data-types/float)

**示例**

**基本用法**

```sql title=Query
SELECT LinfNorm((1, -2))
```

```response title=Response
┌─LinfNorm((1, -2))─┐
│                 2 │
└───────────────────┘
```

## LinfNormalize \{#LinfNormalize\}

引入于：v21.11

在 `L_{inf}` 空间中使用[最大范数](https://en.wikipedia.org/wiki/Norm_\(mathematics\)#Maximum_norm_\(special_case_of:_infinity_norm,_uniform_norm,_or_supremum_norm\))，计算给定向量的单位向量（元组的元素为该向量的各坐标）。

**语法**

```sql
LinfNormalize(tuple)
```

**别名**: `normalizeLinf`

**参数**

* `tuple` — 数值元组。[`Tuple(T)`](/sql-reference/data-types/tuple)

**返回值**

返回单位向量。[`Tuple(Float64)`](/sql-reference/data-types/tuple)

**示例**

**基本用法**

```sql title=Query
SELECT LinfNormalize((3, 4))
```

```response title=Response
┌─LinfNormalize((3, 4))─┐
│ (0.75,1)              │
└───────────────────────┘
```

## LpDistance \{#LpDistance\}

引入于：v21.11

计算 `Lp` 空间中两个点之间的距离（向量的元素作为坐标）（[p 范数距离](https://en.wikipedia.org/wiki/Norm_\(mathematics\)#p-norm)）。

**语法**

```sql
LpDistance(vector1, vector2, p)
```

**别名**：`distanceLp`

**参数**

* `vector1` — 第一个向量。[`Tuple(T)`](/sql-reference/data-types/tuple) 或 [`Array(T)`](/sql-reference/data-types/array)
* `vector2` — 第二个向量。[`Tuple(T)`](/sql-reference/data-types/tuple) 或 [`Array(T)`](/sql-reference/data-types/array)
* `p` — 幂。取值范围：区间 `[1; inf)` 内的实数。[`UInt*`](/sql-reference/data-types/int-uint) 或 [`Float*`](/sql-reference/data-types/float)

**返回值**

返回 p 范数距离。[`Float64`](/sql-reference/data-types/float)

**示例**

**基本用法**

```sql title=Query
SELECT LpDistance((1, 2), (2, 3), 3)
```

```response title=Response
┌─LpDistance((1, 2), (2, 3), 3)─┐
│            1.2599210498948732 │
└───────────────────────────────┘
```

## LpNorm \{#LpNorm\}

自 v21.11 引入

计算向量的 p 范数，即其各元素绝对值的 p 次幂之和的 p 次方根。

特殊情况：

* 当 p=1 时，等价于 L1Norm（曼哈顿距离）。
* 当 p=2 时，等价于 L2Norm（欧几里得距离）。
* 当 p=∞ 时，等价于 LinfNorm（最大范数）。

**语法**

```sql
LpNorm(vector, p)
```

**别名**: `normLp`

**参数**

* `vector` — 数值向量或元组。[`Tuple(T)`](/sql-reference/data-types/tuple) 或 [`Array(T)`](/sql-reference/data-types/array)
* `p` — 幂指数。取值为区间 `[1; inf)` 内的实数。[`UInt*`](/sql-reference/data-types/int-uint) 或 [`Float*`](/sql-reference/data-types/float)

**返回值**

返回 [Lp 范数](https://en.wikipedia.org/wiki/Norm_\(mathematics\)#p-norm)。[`Float64`](/sql-reference/data-types/float)

**示例**

**基本用法**

```sql title=Query
SELECT LpNorm((1, -2), 2)
```

```response title=Response
┌─LpNorm((1, -2), 2)─┐
│   2.23606797749979 │
└────────────────────┘
```

## LpNormalize \{#LpNormalize\}

引入于：v21.11

计算给定向量在 `Lp` 空间中的单位向量（将元组中的元素视为坐标，并使用 [p-范数](https://en.wikipedia.org/wiki/Norm_\(mathematics\)#p-norm)）。

**语法**

```sql
LpNormalize(tuple, p)
```

**别名**: `normalizeLp`

**参数**

* `tuple` — 数值元组。[`Tuple(T)`](/sql-reference/data-types/tuple)
* `p` — 幂次。取值范围为 `[1; inf)` 区间内的任意数值。[`UInt*`](/sql-reference/data-types/int-uint) 或 [`Float*`](/sql-reference/data-types/float)

**返回值**

返回单位向量。[`Tuple(Float64)`](/sql-reference/data-types/tuple)

**示例**

**用法示例**

```sql title=Query
SELECT LpNormalize((3, 4), 5)
```

```response title=Response
┌─LpNormalize((3, 4), 5)──────────────────┐
│ (0.7187302630182624,0.9583070173576831) │
└─────────────────────────────────────────┘
```

## cosineDistance \{#cosineDistance\}

引入于：v1.1

计算两个向量之间的[余弦距离](https://en.wikipedia.org/wiki/Cosine_similarity#Cosine_distance)（元组的元素为坐标）。返回值越小，向量越相似。

**语法**

```sql
cosineDistance(vector1, vector2)
```

**别名**: `distanceCosine`

**参数**

* `vector1` — 第一个元组。[`Tuple(T)`](/sql-reference/data-types/tuple) 或 [`Array(T)`](/sql-reference/data-types/array)
* `vector2` — 第二个元组。[`Tuple(T)`](/sql-reference/data-types/tuple) 或 [`Array(T)`](/sql-reference/data-types/array)

**返回值**

返回 1 减去两个向量夹角余弦的结果。[`Float64`](/sql-reference/data-types/float)

**示例**

**基本用法**

```sql title=Query
SELECT cosineDistance((1, 2), (2, 3));
```

```response title=Response
┌─cosineDistance((1, 2), (2, 3))─┐
│           0.007722123286332261 │
└────────────────────────────────┘
```

## cosineDistanceTransposed \{#cosineDistanceTransposed\}

自 v26.1 引入

计算两个点之间的近似[余弦距离](https://en.wikipedia.org/wiki/Cosine_similarity#Cosine_distance)（将向量的各分量视为坐标）。返回值越小，向量之间越相似。

**语法**

```sql
cosineDistanceTransposed(vector1, vector2, p)
```

**别名**: `distanceCosineTransposed`

**参数**

* `vectors` — 向量。[`QBit(T, UInt64)`](/sql-reference/data-types/qbit)
* `reference` — 参考向量。[`Array(T)`](/sql-reference/data-types/array)
* `p` — 在距离计算中，从每个向量元素中使用的位数（1 到元素位宽）。量化级别控制精度与速度之间的权衡。使用较少的位可以更快完成 I/O 和计算，但精度会降低；使用更多的位则可以提高精度，但会牺牲性能。[`UInt`](/sql-reference/data-types/int-uint)

**返回值**

返回 1 减去两个向量夹角余弦值的近似结果。[`Float64`](/sql-reference/data-types/float)

**示例**

**基本用法**

```sql title=Query
CREATE TABLE qbit (id UInt32, vec QBit(Float64, 2)) ENGINE = Memory;
INSERT INTO qbit VALUES (1, [0, 1]);
SELECT cosineDistanceTransposed(vec, array(1, 2), 16) FROM qbit;
```

```response title=Response
┌─cosineDistanceTransposed([0, 1], [1, 2], 16)─┐
│                          0.10557281085638826 │
└──────────────────────────────────────────────┘
```

{/*AUTOGENERATED_END*/ }
