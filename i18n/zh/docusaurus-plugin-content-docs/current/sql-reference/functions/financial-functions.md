---
description: '财务函数文档'
sidebar_label: '财务'
slug: /sql-reference/functions/financial-functions
title: '财务函数'
keywords: ['财务', '收益率', '净现值']
doc_type: 'reference'
---

# 财务函数 {#financial-functions}

:::note
以下文档是基于 `system.functions` 系统表生成的
:::

{/* 
  在文档框架构建时，下面这些标签内的内容
  会被由 system.functions 生成的文档替换。请不要修改或删除这些标签。
  参见：https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
  */ }

{/*AUTOGENERATED_START*/ }

## financialInternalRateOfReturn {#financialInternalRateOfReturn}

自 v25.7 引入

计算在固定时间间隔发生的一系列现金流的内部收益率（IRR）。
IRR 是使净现值（NPV）等于零的折现率。

IRR 通过求解下列方程得到：

$$
\sum&#95;{i=0}^n \frac{cashflow_i}{(1 + irr)^i} = 0
$$

**语法**

```sql
financialInternalRateOfReturn(现金流[, 估计值])
```

**参数**

* `cashflows` — 现金流数组。每个值表示一笔付款（负值）或收入（正值）。[`Array(Int8/16/32/64)`](/sql-reference/data-types/array) 或 [`Array(Float*)`](/sql-reference/data-types/array)
* `[, guess]` — 可选的内部收益率初始猜测值（常量，默认 0.1）。[`Float*`](/sql-reference/data-types/float)

**返回值**

返回内部收益率。如果计算无法收敛、输入数组为空或只有一个元素、所有现金流为零，或出现其他计算错误，则返回 `NaN`。[`Float64`](/sql-reference/data-types/float)

**示例**

**simple&#95;example**

```sql title=Query
SELECT financialInternalRateOfReturn([-100, 39, 59, 55, 20])
```

```response title=Response
0.2809484211599611
```

**simple&#95;example&#95;with&#95;guess**

```sql title=Query
SELECT financialInternalRateOfReturn([-100, 39, 59, 55, 20], 0.1)
```

```response title=Response
0.2809484211599611
```

## financialInternalRateOfReturnExtended {#financialInternalRateOfReturnExtended}

引入版本：v25.7

计算不规则时间间隔发生的一系列现金流的扩展内部收益率（XIRR）。XIRR 是使所有现金流的净现值（NPV）等于零的贴现率。

XIRR 尝试求解以下方程（以 `ACT_365F` 为例）：

$$
\sum_{i=0}^n \frac{cashflow_i}{(1 + rate)^{(date_i - date_0)/365}} = 0
$$

数组应按日期升序排序。日期必须唯一。

**语法**

```sql
financialInternalRateOfReturnExtended(cashflow, date [, guess, daycount])
```

**参数**

- `cashflow` — 与第二个参数中的日期相对应的现金流数组。[`Array(Int8/16/32/64)`](/sql-reference/data-types/array) 或 [`Array(Float*)`](/sql-reference/data-types/array)
- `date` — 与现金流相对应的唯一日期的有序数组。[`Array(Date)`](/sql-reference/data-types/array) 或 [`Array(Date32)`](/sql-reference/data-types/array)
- `[, guess]` — 可选。XIRR 计算的初始猜测值（常量值）。[`Float*`](/sql-reference/data-types/float)
- `[, daycount]` —
  可选的日计数惯例（默认为 'ACT_365F'）。支持的值：
- 'ACT_365F' - 实际天数/365 固定：使用日期之间的实际天数除以 365
- 'ACT_365_25' - 实际天数/365.25：使用日期之间的实际天数除以 365.25
  [`String`](/sql-reference/data-types/string)

**返回值**

返回 XIRR 值。如果无法执行计算，则返回 NaN。[`Float64`](/sql-reference/data-types/float)

**示例**

**简单示例**

```sql title=查询
SELECT financialInternalRateOfReturnExtended([-10000, 5750, 4250, 3250], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')])
```

```response title=响应
0.6342972615260243
```

**带猜测值的简单示例**

```sql title=查询
SELECT financialInternalRateOfReturnExtended([-10000, 5750, 4250, 3250], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')], 0.5)
```

```response title=响应
0.6342972615260243
```

**日计数简单示例**

```sql title=查询
SELECT round(financialInternalRateOfReturnExtended([100000, -110000], [toDate('2020-01-01'), toDate('2021-01-01')], 0.1, 'ACT_365_25'), 6) AS xirr_365_25
```

```response title=响应
0.099785
```

## financialNetPresentValue {#financialNetPresentValue}

引入于：v25.7

在假设各期现金流之间时间间隔相等的前提下，计算一系列现金流的净现值（NPV）。

默认变体（`start_from_zero` = true）：

$$
\sum&#95;{i=0}^{N-1} \frac{values_i}{(1 + rate)^i}
$$

与 Excel 兼容的变体（`start_from_zero` = false）：

$$
\sum&#95;{i=1}^{N} \frac{values_i}{(1 + rate)^i}
$$

**语法**

```sql
financialNetPresentValue(rate, cashflows[, start_from_zero])
```

**参数**

* `rate` — 要应用的折现率。[`Float*`](/sql-reference/data-types/float)
* `cashflows` — 现金流数组。每个值表示一笔支出（负值）或收入（正值）。[`Array(Int8/16/32/64)`](/sql-reference/data-types/array) 或 [`Array(Float*)`](/sql-reference/data-types/array)
* `[, start_from_zero]` — 可选的布尔参数，指示净现值（NPV）计算从第 `0` 期（true）还是第 `1` 期（false，与 Excel 兼容）开始。默认值：true。[`Bool`](/sql-reference/data-types/boolean)

**返回值**

返回一个 Float64 类型的净现值。[`Float64`](/sql-reference/data-types/float)

**示例**

**default&#95;calculation**

```sql title=Query
SELECT financialNetPresentValue(0.08, [-40000., 5000., 8000., 12000., 30000.])
```

```response title=Response
3065.2226681795255
```

**excel&#95;compatible&#95;calculation**

```sql title=Query
SELECT financialNetPresentValue(0.08, [-40000., 5000., 8000., 12000., 30000.], false)
```

```response title=Response
2838.1691372032656
```

## financialNetPresentValueExtended {#financialNetPresentValueExtended}

引入版本:v25.7

计算在不规则时间间隔发生的一系列现金流的扩展净现值(XNPV)。XNPV 在计算现值时会考虑每笔现金流的具体时间点。

`ACT_365F` 的 XNPV 公式:

$$
XNPV=\sum_{i=1}^n \frac{cashflow_i}{(1 + rate)^{(date_i - date_0)/365}}
$$

数组应按日期升序排序。日期必须唯一。

**语法**

```sql
financialNetPresentValueExtended(rate, cashflows, dates[, daycount])
```

**参数**

- `rate` — 应用的贴现率。[`Float*`](/sql-reference/data-types/float)
- `cashflows` — 现金流数组。每个值表示一笔支付(负值)或收入(正值)。必须至少包含一个正值和一个负值。[`Array(Int8/16/32/64)`](/sql-reference/data-types/array) 或 [`Array(Float*)`](/sql-reference/data-types/array)
- `dates` — 与每笔现金流对应的日期数组。必须与 cashflows 数组大小相同。[`Array(Date)`](/sql-reference/data-types/array) 或 [`Array(Date32)`](/sql-reference/data-types/array)
- `[, daycount]` — 可选的日计数惯例。支持的值:`'ACT_365F'`(默认)— 实际天数/365 固定法,`'ACT_365_25'` — 实际天数/365.25。[`String`](/sql-reference/data-types/string)

**返回值**

返回 Float64 类型的净现值。[`Float64`](/sql-reference/data-types/float)

**示例**

**基本用法**

```sql title=查询
SELECT financialNetPresentValueExtended(0.1, [-10000., 5750., 4250., 3250.], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')])
```

```response title=响应
2506.579458169746
```

**使用不同的日计数惯例**

```sql title=查询
SELECT financialNetPresentValueExtended(0.1, [-10000., 5750., 4250., 3250.], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')], 'ACT_365_25')
```

```response title=响应
2507.067268742502
```

<!--AUTOGENERATED_END-->

## 相关资源 {#related-resources}

- [ClickHouse 中的财务函数视频](https://www.youtube.com/watch?v=BePLPVa0w_o)
