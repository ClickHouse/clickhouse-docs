---
description: '财务函数文档'
sidebar_label: '财务'
slug: /sql-reference/functions/financial-functions
title: '财务函数'
keywords: ['财务', '收益率', '净现值']
doc_type: 'reference'
---

# 财务函数 {#financial-functions}

:::note
以下文档是基于 `system.functions` 系统表生成的
:::

{/* 
  在文档框架构建时，下面这些标签内的内容
  会被由 system.functions 生成的文档替换。请不要修改或删除这些标签。
  参见：https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
  */ }

{/*AUTOGENERATED_START*/ }

## financialInternalRateOfReturn {#financialInternalRateOfReturn}

自 v25.7 引入

计算在固定时间间隔发生的一系列现金流的内部收益率（IRR）。
IRR 是使净现值（NPV）等于零的折现率。

IRR 通过求解下列方程得到：

$$
\sum&#95;{i=0}^n \frac{cashflow_i}{(1 + irr)^i} = 0
$$

**语法**

```sql
financialInternalRateOfReturn(cashflows[, guess])
```

**参数**

* `cashflows` — 现金流数组。每个值表示一笔付款（负值）或收入（正值）。[`Array(Int8/16/32/64)`](/sql-reference/data-types/array) 或 [`Array(Float*)`](/sql-reference/data-types/array)
* `[, guess]` — 可选的内部收益率初始猜测值（常量，默认 0.1）。[`Float*`](/sql-reference/data-types/float)

**返回值**

返回内部收益率。如果计算无法收敛、输入数组为空或只有一个元素、所有现金流为零，或出现其他计算错误，则返回 `NaN`。[`Float64`](/sql-reference/data-types/float)

**示例**

**simple&#95;example**

```sql title=Query
SELECT financialInternalRateOfReturn([-100, 39, 59, 55, 20])
```

```response title=Response
0.2809484211599611
```

**simple_example_with_guess**

```sql title=Query
SELECT financialInternalRateOfReturn([-100, 39, 59, 55, 20], 0.1)
```

```response title=Response
0.2809484211599611
```



## financialInternalRateOfReturnExtended {#financialInternalRateOfReturnExtended}

Introduced in: v25.7


Calculates the Extended Internal Rate of Return (XIRR) for a series of cash flows occurring at irregular intervals. XIRR is the discount rate at which the net present value (NPV) of all cash flows equals zero.

XIRR attempts to solve the following equation (example for `ACT_365F`):

$$
\sum_{i=0}^n \frac{cashflow_i}{(1 + rate)^{(date_i - date_0)/365}} = 0
$$

Arrays should be sorted by date in ascending order. Dates need to be unique.
    

**Syntax**

```sql
financialInternalRateOfReturnExtended(cashflow, date [, guess, daycount])
```

**Arguments**

- `cashflow` — An array of cash flows corresponding to the dates in second param. [`Array(Int8/16/32/64)`](/sql-reference/data-types/array) or [`Array(Float*)`](/sql-reference/data-types/array)
- `date` — A sorted array of unique dates corresponding to the cash flows. [`Array(Date)`](/sql-reference/data-types/array) or [`Array(Date32)`](/sql-reference/data-types/array)
- `[, guess]` — Optional. Initial guess (constant value) for the XIRR calculation. [`Float*`](/sql-reference/data-types/float)
- `[, daycount]` — 
Optional day count convention (default 'ACT_365F'). Supported values:
- 'ACT_365F' - Actual/365 Fixed: Uses actual number of days between dates divided by 365
- 'ACT_365_25' - Actual/365.25: Uses actual number of days between dates divided by 365.25
             [`String`](/sql-reference/data-types/string)


**Returned value**

Returns the XIRR value. If the calculation cannot be performed, it returns NaN. [`Float64`](/sql-reference/data-types/float)

**Examples**

**simple_example**

```sql title=查询
SELECT financialInternalRateOfReturnExtended([-10000, 5750, 4250, 3250], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')])
```

```response title=响应
0.6342972615260243
```

**simple_example_with_guess**

```sql title=查询
SELECT financialInternalRateOfReturnExtended([-10000, 5750, 4250, 3250], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')], 0.5)
```

```response title=响应
0.6342972615260243
```

**simple_example_daycount**

```sql title=查询
SELECT round(financialInternalRateOfReturnExtended([100000, -110000], [toDate('2020-01-01'), toDate('2021-01-01')], 0.1, 'ACT_365_25'), 6) AS xirr_365_25
```

```response title=响应
0.099785
```



## financialNetPresentValue {#financialNetPresentValue}

Introduced in: v25.7


Calculates the Net Present Value (NPV) of a series of cash flows assuming equal time intervals between each cash flow.

Default variant (`start_from_zero` = true):

$$
\sum_{i=0}^{N-1} \frac{values_i}{(1 + rate)^i}
$$

Excel-compatible variant (`start_from_zero` = false):

$$
\sum_{i=1}^{N} \frac{values_i}{(1 + rate)^i}
$$
    

**Syntax**

```sql
financialNetPresentValue(rate, cashflows[, start_from_zero])
```

**Arguments**

- `rate` — The discount rate to apply. [`Float*`](/sql-reference/data-types/float)
- `cashflows` — Array of cash flows. Each value represents a payment (negative value) or income (positive value). [`Array(Int8/16/32/64)`](/sql-reference/data-types/array) or [`Array(Float*)`](/sql-reference/data-types/array)
- `[, start_from_zero]` — Optional boolean parameter indicating whether to start the NPV calculation from period `0` (true) or period `1` (false, Excel-compatible). Default: true. [`Bool`](/sql-reference/data-types/boolean)


**Returned value**

Returns the net present value as a Float64 value. [`Float64`](/sql-reference/data-types/float)

**Examples**

**default_calculation**

```sql title=Query
SELECT financialNetPresentValue(0.08, [-40000., 5000., 8000., 12000., 30000.])
```

```response title=Response
3065.2226681795255
```

**excel_compatible_calculation**

```sql title=Query
SELECT financialNetPresentValue(0.08, [-40000., 5000., 8000., 12000., 30000.], false)
```

```response title=Response
2838.1691372032656
```



## financialNetPresentValueExtended {#financialNetPresentValueExtended}

Introduced in: v25.7


Calculates the Extended Net Present Value (XNPV) for a series of cash flows occurring at irregular intervals. XNPV considers the specific timing of each cash flow when calculating present value.

XNPV equation for `ACT_365F`:

$$
XNPV=\sum_{i=1}^n \frac{cashflow_i}{(1 + rate)^{(date_i - date_0)/365}}
$$

Arrays should be sorted by date in ascending order. Dates need to be unique.
    

**Syntax**

```sql
financialNetPresentValueExtended(rate, cashflows, dates[, daycount])
```

**Arguments**

- `rate` — The discount rate to apply. [`Float*`](/sql-reference/data-types/float)
- `cashflows` — Array of cash flows. Each value represents a payment (negative value) or income (positive value). Must contain at least one positive and one negative value. [`Array(Int8/16/32/64)`](/sql-reference/data-types/array) or [`Array(Float*)`](/sql-reference/data-types/array)
- `dates` — Array of dates corresponding to each cash flow. Must have the same size as cashflows array. [`Array(Date)`](/sql-reference/data-types/array) or [`Array(Date32)`](/sql-reference/data-types/array)
- `[, daycount]` — Optional day count convention. Supported values: `'ACT_365F'` (default) — Actual/365 Fixed, `'ACT_365_25'` — Actual/365.25. [`String`](/sql-reference/data-types/string)


**Returned value**

Returns the net present value as a Float64 value. [`Float64`](/sql-reference/data-types/float)

**Examples**

**Basic usage**

```sql title=查询
SELECT financialNetPresentValueExtended(0.1, [-10000., 5750., 4250., 3250.], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')])
```

```response title=响应
2506.579458169746
```

**Using different day count convention**

```sql title=查询
SELECT financialNetPresentValueExtended(0.1, [-10000., 5750., 4250., 3250.], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')], 'ACT_365_25')
```

```response title=响应
2507.067268742502
```

<!--AUTOGENERATED_END-->

## 相关资源 {#related-resources}

- [ClickHouse 中的财务函数视频](https://www.youtube.com/watch?v=BePLPVa0w_o)
