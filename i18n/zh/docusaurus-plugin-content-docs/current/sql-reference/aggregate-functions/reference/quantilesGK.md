---
description: 'quantilesGK 的工作方式与 quantileGK 类似，但允许我们同时计算不同分位数水平的结果，并返回一个数组。'
slug: /sql-reference/aggregate-functions/reference/quantilesGK
title: 'quantilesGK'
doc_type: 'reference'
---

{/*AUTOGENERATED_START*/ }

## quantilesGK \{#quantilesGK\}

引入版本：v23.4

使用 [Greenwald-Khanna](http://infolab.stanford.edu/~datar/courses/cs361a/papers/quantiles.pdf) 算法，对数值数据序列在多个不同分位点上同时计算[分位数](https://en.wikipedia.org/wiki/Quantile)。

该函数与 [`quantileGK`](/sql-reference/aggregate-functions/reference/quantilegk) 的工作方式类似，但允许在一次遍历中计算多个分位水平，相比多次分别调用各个分位数函数更加高效。

Greenwald-Khanna 算法是一种用于在数据流上高效计算分位数的算法。
该算法由 Michael Greenwald 和 Sanjeev Khanna 于 2001 年提出。
该算法极其高效，仅使用 O(log n) 空间，并对每个元素只需 O(log log n) 时间（其中 n 为输入大小）。
它同样具有很高的精度，可以在可控精度下提供近似的分位数值。

**语法**

```sql
quantilesGK(accuracy, level1, level2, ...)(expr)
```

**参数**

* `accuracy` — 分位数的精度。常量正整数。精度值越大，误差越小。例如，如果将 `accuracy` 参数设置为 100，则计算出的分位数在较高概率下其误差不会超过 1%。分位数精度与算法计算复杂度之间存在折衷关系。[`UInt*`](/sql-reference/data-types/int-uint)
* `level` — 分位数的级别。一个或多个从 0 到 1 的常量浮点数。[`Float*`](/sql-reference/data-types/float)

**参数**

* `expr` — 对列值进行运算的表达式，结果为数值数据类型、Date 或 DateTime。[`(U)Int*`](/sql-reference/data-types/int-uint) 或 [`Float*`](/sql-reference/data-types/float) 或 [`Decimal*`](/sql-reference/data-types/decimal) 或 [`Date`](/sql-reference/data-types/date) 或 [`DateTime`](/sql-reference/data-types/datetime)

**返回值**

按指定顺序返回这些级别对应的分位数组成的数组。[`Array(Float64)`](/sql-reference/data-types/array) 或 [`Array(Date)`](/sql-reference/data-types/array) 或 [`Array(DateTime)`](/sql-reference/data-types/array)

**示例**

**使用 GK 算法计算多个分位数**

```sql title=Query
SELECT quantilesGK(1, 0.25, 0.5, 0.75)(number + 1) FROM numbers(1000);
```

```response title=Response
┌─quantilesGK(1, 0.25, 0.5, 0.75)(plus(number, 1))─┐
│ [1, 1, 1]                                        │
└──────────────────────────────────────────────────┘
```

**更高精度的分位数估计**

```sql title=Query
SELECT quantilesGK(100, 0.25, 0.5, 0.75)(number + 1) FROM numbers(1000);
```

```response title=Response
┌─quantilesGK(100, 0.25, 0.5, 0.75)(plus(number, 1))─┐
│ [251, 498, 741]                                    │
└────────────────────────────────────────────────────┘
```

{/*AUTOGENERATED_END*/ }
