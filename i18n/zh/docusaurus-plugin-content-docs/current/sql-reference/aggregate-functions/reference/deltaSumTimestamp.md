---
description: '对相邻行之间的差值求和。如果差值为负，则会被忽略。'
slug: /sql-reference/aggregate-functions/reference/deltasumtimestamp
title: 'deltaSumTimestamp'
doc_type: 'reference'
---

{/*AUTOGENERATED_START*/ }

## deltaSumTimestamp \{#deltaSumTimestamp\}

引入版本：v21.6

对相邻行之间的差值求和。
如果差值为负，则会被忽略。

此函数主要用于 [materialized views](/sql-reference/statements/create/view#materialized-view)，这些视图按某个时间桶对齐的时间戳（timestamp）排序并存储数据，例如按 `toStartOfMinute` 分桶。
由于此类 materialized view 中的行都具有相同的时间戳，如果不存储原始的、未取整的时间戳值，就无法以正确的顺序合并它们。
`deltaSumTimestamp` 函数会跟踪其已处理值的原始 `timestamp`，因此在分区片段合并期间可以正确计算函数的值（状态）。

若要计算有序集合上的增量和，可以直接使用 [`deltaSum`](/sql-reference/aggregate-functions/reference/deltasum) 函数。

**语法**

```sql
deltaSumTimestamp(value, timestamp)
```

**参数**

* `value` — 输入值。[`(U)Int*`](/sql-reference/data-types/int-uint) 或 [`Float*`](/sql-reference/data-types/float) 或 [`Date`](/sql-reference/data-types/date) 或 [`DateTime`](/sql-reference/data-types/datetime)
* `timestamp` — 用于确定值排序顺序的参数。[`(U)Int*`](/sql-reference/data-types/int-uint) 或 [`Float*`](/sql-reference/data-types/float) 或 [`Date`](/sql-reference/data-types/date) 或 [`DateTime`](/sql-reference/data-types/datetime)

**返回值**

返回按照 `timestamp` 参数排序后，相邻值之间差值的累积结果。[`(U)Int*`](/sql-reference/data-types/int-uint) 或 [`Float*`](/sql-reference/data-types/float) 或 [`Date`](/sql-reference/data-types/date) 或 [`DateTime`](/sql-reference/data-types/datetime)

**示例**

**基于时间戳排序的基本用法**

```sql title=Query
SELECT deltaSumTimestamp(value, timestamp)
FROM (SELECT number AS timestamp, [0, 4, 8, 3, 0, 0, 0, 1, 3, 5][number] AS value FROM numbers(1, 10))
```

```response title=Response
┌─deltaSumTimestamp(value, timestamp)─┐
│                                  13 │
└─────────────────────────────────────┘
```

{/*AUTOGENERATED_END*/ }
