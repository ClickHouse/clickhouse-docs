---
description: '通过线性插值计算直方图的分位数。'
slug: /sql-reference/aggregate-functions/reference/quantilePrometheusHistogram
title: 'quantilePrometheusHistogram'
doc_type: 'reference'
---

{/*AUTOGENERATED_START*/ }

## quantilePrometheusHistogram \{#quantilePrometheusHistogram\}

引入版本：v25.10

使用线性插值计算直方图的[quantile](https://en.wikipedia.org/wiki/Quantile)，会考虑每个直方图桶的累计值和上界。

为了获得插值结果，所有传入的值会被合并到一个数组中，然后根据它们对应的桶上界值进行排序。随后会类似 PromQL 中经典直方图的 [histogram&#95;quantile()](https://prometheus.io/docs/prometheus/latest/querying/functions/#histogram_quantile) 函数执行分位数插值：在找到分位数位置所在的桶后，使用该桶的下界和上界进行线性插值。

**另请参阅**

* [median](/sql-reference/aggregate-functions/reference/median)
* [quantiles](../../../sql-reference/aggregate-functions/reference/quantiles.md)

**语法**

```sql
quantilePrometheusHistogram(level)(bucket_upper_bound, cumulative_bucket_value)
```

**参数**

* `level` — 可选。分位数的级别。取值为 0 到 1 之间的常量浮点数。建议使用范围为 `[0.01, 0.99]` 的 `level` 值。默认值：`0.5`。在 `level=0.5` 时，函数计算[中位数](https://en.wikipedia.org/wiki/Median)。[`Float64`](/sql-reference/data-types/float)

**参数说明**

* `bucket_upper_bound` — 直方图桶的上边界。最高桶的上边界必须为 `+Inf`。[`Float64`](/sql-reference/data-types/float)
* `cumulative_bucket_value` — 直方图桶的累积值。随着桶上边界的增大，这些值必须单调递增。[`(U)Int*`](/sql-reference/data-types/int-uint) 或 [`Float64`](/sql-reference/data-types/float)

**返回值**

返回指定级别的分位数。[`Float64`](/sql-reference/data-types/float)

**示例**

**用法示例**

```sql title=Query
SELECT quantilePrometheusHistogram(bucket_upper_bound, cumulative_bucket_value)
FROM VALUES('bucket_upper_bound Float64, cumulative_bucket_value UInt64', (0, 6), (0.5, 11), (1, 14), (inf, 19));
```

```response title=Response
┌─quantilePrometheusHistogram(bucket_upper_bound, cumulative_bucket_value)─┐
│                                                                     0.35 │
└──────────────────────────────────────────────────────────────────────────┘
```

{/*AUTOGENERATED_END*/ }

**另请参阅**

* [median](/sql-reference/aggregate-functions/reference/median)
* [quantiles](../../../sql-reference/aggregate-functions/reference/quantiles.md)
