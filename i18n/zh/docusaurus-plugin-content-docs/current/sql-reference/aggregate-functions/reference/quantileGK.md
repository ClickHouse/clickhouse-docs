---
description: '使用 Greenwald-Khanna 算法计算数值序列的分位数。'
slug: /sql-reference/aggregate-functions/reference/quantileGK
title: 'quantileGK'
doc_type: 'reference'
---

{/*AUTOGENERATED_START*/ }

## quantileGK \{#quantileGK\}

引入于：v23.4

使用 [Greenwald-Khanna](http://infolab.stanford.edu/~datar/courses/cs361a/papers/quantiles.pdf) 算法计算数值数据序列的[分位数](https://en.wikipedia.org/wiki/Quantile)。Greenwald-Khanna 算法是一种用于在数据流中高效计算分位数的算法，由 Michael Greenwald 和 Sanjeev Khanna 于 2001 年提出。它广泛应用于数据库和大数据系统中，在这些场景下，需要对大规模数据流进行实时且较为精确的分位数计算。该算法在空间复杂度上仅为 O(log n)，并且对每个元素的时间复杂度仅为 O(log log n)（其中 n 为输入数据量）。同时，该算法具有很高的精度，能够以较高概率给出近似的分位数值。

`quantileGK` 与 ClickHouse 中其他分位数函数不同，因为它允许用户控制近似分位数结果的精度。

**语法**

```sql
quantileGK(accuracy, level)(expr)
```

**别名**: `medianGK`

**参数**

* `accuracy` — 分位数的精度。为正整数常量。精度值越大，误差越小。例如，如果将精度参数设置为 100，则计算得到的分位数在较高概率下误差不会超过 1%。计算得到的分位数精度与算法的计算复杂度之间存在权衡。更高的精度需要更多内存和计算资源来更准确地计算分位数，而较低的精度参数可以实现更快、更节省内存的计算，但精度会略有下降。[`UInt*`](/sql-reference/data-types/int-uint)
* `level` — 可选。分位数的级别。取值为 0 到 1 之间的常量浮点数。默认值：0.5。当 `level=0.5` 时，函数计算中位数。[`Float*`](/sql-reference/data-types/float)

**参数**

* `expr` — 针对列值进行运算的表达式，其结果为数值型数据类型、Date 或 DateTime。[`(U)Int*`](/sql-reference/data-types/int-uint) 或 [`Float*`](/sql-reference/data-types/float) 或 [`Decimal*`](/sql-reference/data-types/decimal) 或 [`Date`](/sql-reference/data-types/date) 或 [`DateTime`](/sql-reference/data-types/datetime)

**返回值**

返回指定级别和精度的分位数。[`Float64`](/sql-reference/data-types/float) 或 [`Date`](/sql-reference/data-types/date) 或 [`DateTime`](/sql-reference/data-types/datetime)

**示例**

**计算不同精度级别的分位数**

```sql title=Query
SELECT quantileGK(1, 0.25)(number + 1) FROM numbers(1000);
```

```response title=Response
┌─quantileGK(1, 0.25)(plus(number, 1))─┐
│                                    1 │
└──────────────────────────────────────┘
```

**更高精度的分位数估计**

```sql title=Query
SELECT quantileGK(100, 0.25)(number + 1) FROM numbers(1000);
```

```response title=Response
┌─quantileGK(100, 0.25)(plus(number, 1))─┐
│                                    251 │
└────────────────────────────────────────┘
```

{/*AUTOGENERATED_END*/ }

**另请参见**

* [median](../../../sql-reference/aggregate-functions/reference/median.md)
* [quantiles](../../../sql-reference/aggregate-functions/reference/quantiles.md)
