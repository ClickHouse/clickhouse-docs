---
slug: /changelogs/25.8
title: 'v25.8 Cloud 版本更新日志'
description: 'v25.8 快速发布版本更新日志'
keywords: ['changelog', 'cloud']
sidebar_label: '25.8'
sidebar_position: 1
doc_type: 'changelog'
---



## 向后不兼容的变更 {#backward-incompatible-changes}

### JSON 和数据格式变更 {#json-and-data-format-changes}

- 默认禁用 JSON 格式中 64 位整数的引号包裹。[#74079](https://github.com/ClickHouse/ClickHouse/pull/74079) ([Pavel Kruglov](https://github.com/Avogar))。
- 对于 JSON 中包含不同类型值的数组,推断为 `Array(Dynamic)` 而非未命名的 `Tuple`。若要使用之前的行为,请禁用设置 [`input_format_json_infer_array_of_dynamic_from_array_of_different_types`](/operations/settings/formats#input_format_json_infer_array_of_dynamic_from_array_of_different_types)。[#80859](https://github.com/ClickHouse/ClickHouse/pull/80859) ([Pavel Kruglov](https://github.com/Avogar))。
- 默认在 Parquet 输出格式中将 `Enum` 类型的值写为带有 `ENUM` 逻辑类型的 `BYTE_ARRAY`。[#84169](https://github.com/ClickHouse/ClickHouse/pull/84169) ([Pavel Kruglov](https://github.com/Avogar))。

### 存储和分区 {#storage-and-partitioning}

- 新增对 Hive 分区样式写入的支持,并重构读取实现(Hive 分区列不再是虚拟列)。[#76802](https://github.com/ClickHouse/ClickHouse/pull/76802) ([Arthur Passos](https://github.com/arthurpassos))。
- 默认启用 MergeTree 设置 [`write_marks_for_substreams_in_compact_parts`](/operations/settings/merge-tree-settings#write_marks_for_substreams_in_compact_parts)。这显著提升了从新创建的 Compact 部分读取子列的性能。版本低于 25.5 的服务器将无法读取新的 Compact 部分。[#84171](https://github.com/ClickHouse/ClickHouse/pull/84171) ([Pavel Kruglov](https://github.com/Avogar))。
- 禁止在 SummingMergeTree 中对显式列出的求和列执行 `RENAME COLUMN` 或 `DROP COLUMN` 操作。关闭 [#81836](https://github.com/ClickHouse/ClickHouse/issues/81836)。[#82821](https://github.com/ClickHouse/ClickHouse/pull/82821) ([Alexey Milovidov](https://github.com/alexey-milovidov))。

### 函数增强 {#function-enhancements}

- 为 [`extractKeyValuePairs`](/sql-reference/functions/tuple-map-functions#extractkeyvaluepairs) 函数引入新参数 `unexpected_quoting_character_strategy`,用于控制意外遇到 `quoting_character` 时的处理方式。更多详情请参阅 [`extractKeyValuePairs`](/sql-reference/functions/tuple-map-functions#extractkeyvaluepairs) 的文档。[#80657](https://github.com/ClickHouse/ClickHouse/pull/80657) ([Arthur Passos](https://github.com/arthurpassos))。
- 以前,函数 [`countMatches`](/sql-reference/functions/string-search-functions#countMatches) 会在第一个空匹配处停止计数,即使模式接受该匹配。为解决此问题,`countMatches` 现在在遇到空匹配时会前进一个字符并继续执行。希望保留旧行为的用户可以启用设置 `count_matches_stop_at_empty_match`。[#81676](https://github.com/ClickHouse/ClickHouse/pull/81676) ([Elmi Ahmadov](https://github.com/ahmadov))。

### 数据类型改进 {#data-type-improvements}

- 提高从 `Decimal` 到 `Float32` 转换的精度。实现从 `Decimal` 到 `BFloat16` 的转换。关闭 [#82660](https://github.com/ClickHouse/ClickHouse/issues/82660)。[#82823](https://github.com/ClickHouse/ClickHouse/pull/82823) ([Alexey Milovidov](https://github.com/alexey-milovidov))。

### 性能和资源管理 {#performance-and-resource-management}


- 之前,`BACKUP` 查询、合并和变更操作不使用服务器级的本地流量限流器(`max_local_read_bandwidth_for_server` 和 `max_local_write_bandwidth_for_server`)和远程流量限流器(`max_remote_read_network_bandwidth_for_server` 和 `max_remote_write_network_bandwidth_for_server`),而是仅通过专用的服务器设置(`max_backup_bandwidth_for_server`、`max_mutations_bandwidth_for_server` 和 `max_merges_bandwidth_for_server`)进行限流。现在,它们会同时使用这两种类型的限流器。[#81753](https://github.com/ClickHouse/ClickHouse/pull/81753) ([Sergei Trifonov](https://github.com/serxa))。
- 新增了设置 [`cluster_function_process_archive_on_multiple_nodes`](/operations/settings/settings#cluster_function_process_archive_on_multiple_nodes),当设置为 true(默认值)时,可以提高集群函数处理归档文件的性能。如果在早期版本中使用带归档文件的集群函数,为了保持兼容性并避免升级到 25.7+ 版本时出现错误,应将其设置为 `false`。[#82355](https://github.com/ClickHouse/ClickHouse/pull/82355) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 之前 [`concurrent_threads_scheduler`](/operations/server-configuration-parameters/settings#concurrent_threads_scheduler) 的默认值为 `round_robin`,在存在大量单线程查询(例如 `INSERT`)时被证明不够公平。此更改将更安全的替代方案 `fair_round_robin` 调度器设为默认值。[#84747](https://github.com/ClickHouse/ClickHouse/pull/84747) ([Sergei Trifonov](https://github.com/serxa))。
- 延迟物化仅在启用分析器时才会启用,以避免在没有分析器的情况下进行维护时可能出现的一些问题(例如,在条件中使用 `indexHint()` 时)。[#83791](https://github.com/ClickHouse/ClickHouse/pull/83791) ([Igor Nikonov](https://github.com/devcrafter))。

### 模式和 SQL 语法 {#schema-and-sql-syntax}

- 禁止创建没有可插入列的表。[#81835](https://github.com/ClickHouse/ClickHouse/pull/81835) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。
- 要求在默认表达式中包含点号的标识符周围使用反引号,以防止它们被解析为复合标识符。[#83162](https://github.com/ClickHouse/ClickHouse/pull/83162) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。
- 支持 PostgreSQL 风格的 heredoc 语法:`$tag$ string contents... $tag$`,也称为美元引用字符串字面量。在之前的版本中,对标签的限制较少:它们可以包含任意字符,包括标点符号和空格。这会导致与同样可以以美元符号开头的标识符产生解析歧义。同时,PostgreSQL 仅允许标签包含单词字符。为了解决这个问题,我们现在限制 heredoc 标签只能包含单词字符。关闭 [#84731](https://github.com/ClickHouse/ClickHouse/issues/84731)。[#84846](https://github.com/ClickHouse/ClickHouse/pull/84846) ([Alexey Milovidov](https://github.com/alexey-milovidov))。

### 安全性和权限 {#security-and-permissions}

- `SYSTEM RESTART REPLICAS` 只会在您拥有 `SHOW TABLES` 权限的数据库中重启副本。之前,即使没有访问该数据库的权限,该查询也会导致 Lazy 数据库中的表被唤醒,而这些表正在被并发删除。[#83321](https://github.com/ClickHouse/ClickHouse/pull/83321) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 函数 `azureBlobStorage`、`deltaLakeAzure` 和 `icebergAzure` 已更新,以正确验证 `AZURE` 权限。所有集群变体函数(`-Cluster` 函数)现在会根据其对应的非集群版本验证权限。此外,`icebergLocal` 和 `deltaLakeLocal` 函数现在会强制执行 `FILE` 权限检查。[#84938](https://github.com/ClickHouse/ClickHouse/pull/84938) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov


## 新功能 {#new-feature}

### 数据类型 {#data-types}

- 新增数据类型:[`Time`](/sql-reference/data-types/time) `([H]HH:MM:SS)` 和 [`Time64`](/sql-reference/data-types/time64) `([H]HH:MM:SS[.fractional])`,以及一些基本的类型转换函数和与其他数据类型交互的函数。新增了与旧版函数 `ToTime` 兼容的设置。[#81217](https://github.com/ClickHouse/ClickHouse/pull/81217) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。

### 函数 {#functions}


* 新增 [`NumericIndexedVector`](/sql-reference/functions/numeric-indexed-vector-functions)，一种基于按位切片与 roaring-bitmap 压缩实现的新向量数据结构，并提供 20 多个用于构建、分析和逐元素算术运算的函数。可减少存储占用，并加速在稀疏数据上的 `JOIN`、过滤和聚合。实现了 [#70582](https://github.com/ClickHouse/ClickHouse/issues/70582) 以及 T. Xiong 和 Y. Wang 在 VLDB 2024 发表的论文 “[Large-Scale Metric Computation in Online Controlled Experiment Platform](https://arxiv.org/abs/2405.08411)”。[#74193](https://github.com/ClickHouse/ClickHouse/pull/74193)（[FriendLey](https://github.com/FriendLey)）。
* 新增财务函数：[`financialInternalRateOfReturnExtended`](/sql-reference/functions/financial-functions#financialInternalRateOfReturnExtended)（`XIRR`）、[`financialInternalRateOfReturn`](/sql-reference/functions/financial-functions#financialInternalRateOfReturn)（`IRR`）、[`financialNetPresentValueExtended`](/sql-reference/functions/financial-functions#financialNetPresentValueExtended)（`XNPV`）、[`financialNetPresentValue`](/sql-reference/functions/financial-functions#financialNetPresentValue)（`NPV`）。[#81599](https://github.com/ClickHouse/ClickHouse/pull/81599)（[Joanna Hulboj](https://github.com/jh0x)）。
* 添加地理空间函数 [`polygonIntersectsCartesian`](/sql-reference/functions/geo/polygons#polygonsintersectcartesian) 和 [`polygonIntersectsSpherical`](/sql-reference/functions/geo/polygons#polygonsintersectspherical)，用于检查两个多边形是否相交。[#81882](https://github.com/ClickHouse/ClickHouse/pull/81882)（[Paul Lamb](https://github.com/plamb)）。
* 支持 [`lag`](/sql-reference/window-functions/lag) 和 [`lead`](/sql-reference/window-functions/lead) 窗口函数。修复 [#9887](https://github.com/ClickHouse/ClickHouse/issues/9887)。[#82108](https://github.com/ClickHouse/ClickHouse/pull/82108)（[Dmitry Novik](https://github.com/novikd)）。
* 新增函数 [`colorSRGBToOkLCH`](/sql-reference/functions/other-functions#colorSRGBToOKLCH) 和 [`colorOkLCHToSRGB`](/sql-reference/functions/other-functions#colorOKLCHToSRGB)，用于在 sRGB 和 OkLCH 色彩空间之间进行转换。 [#83679](https://github.com/ClickHouse/ClickHouse/pull/83679) ([Fgrtue](https://github.com/Fgrtue)).
* 用户现在可以使用 [`JSONExtractCaseInsensitive`](/sql-reference/functions/json-functions#JSONExtractCaseInsensitive)（以及其他 `JSONExtract` 变体）执行不区分大小写的 JSON 键查找。[#83770](https://github.com/ClickHouse/ClickHouse/pull/83770)（[Alistair Evans](https://github.com/alistairjevans)）。
* 新增了函数 [`nowInBlock64`](/sql-reference/functions/date-time-functions#nowInBlock64)。[#84178](https://github.com/ClickHouse/ClickHouse/pull/84178) ([Halersson Paris](https://github.com/halersson))。
* 添加函数 [`dateTimeToUUIDv7`](/sql-reference/functions/uuid-functions#dateTimeToUUIDv7)，用于将 `DateTime` 值转换为 `UUIDv7`。示例：`SELECT dateTimeToUUIDv7(toDateTime('2025-08-15 18:57:56'))` 返回 `0198af18-8320-7a7d-abd3-358db23b9d5c`。[#84319](https://github.com/ClickHouse/ClickHouse/pull/84319)（[samradovich](https://github.com/samradovich)）。
* 添加 [`timeSeriesDerivToGrid`](/sql-reference/aggregate-functions/reference/timeSeriesDerivToGrid) 和 [`timeSeriesPredictLinearToGrid`](/sql-reference/aggregate-functions/reference/timeSeriesPredictLinearToGrid) 聚合函数，用于将数据重新采样到由指定起始时间戳、结束时间戳和步长定义的时间网格上；分别计算类似 PromQL 的 `deriv` 和 `predict_linear` 函数。[#84328](https://github.com/ClickHouse/ClickHouse/pull/84328)（[Stephen Chi](https://github.com/stephchi0)）。
* 添加 [`timeSeriesRange`](/sql-reference/functions/time-series-functions#timeSeriesRange) 和 [`timeSeriesFromGrid`](/sql-reference/functions/time-series-functions#timeSeriesFromGrid) 函数。[#85435](https://github.com/ClickHouse/ClickHouse/pull/85435)（[Vitaly Baranov](https://github.com/vitlibar)）。

### 系统表 {#system-tables}

- 新增 [`system.dead_letter_queue`](/operations/system-tables/dead_letter_queue) 表,用于保存来自 Kafka 等引擎的错误消息。[#68873](https://github.com/ClickHouse/ClickHouse/pull/68873) ([Ilya Golshtein](https://github.com/ilejn))。
- 新增 [`system.zookeeper_connection_log`](/operations/system-tables/zookeeper_connection_log) 系统表,用于存储 ZooKeeper 连接的历史信息。[#79494](https://github.com/ClickHouse/ClickHouse/pull/79494) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
- 新增系统表 [`system.codecs`](/operations/system-tables/codecs),用于查询可用的编解码器。(issue [#81525](https://github.com/ClickHouse/ClickHouse/issues/81525))。[#81600](https://github.com/ClickHouse/ClickHouse/pull/81600) ([Jimmy Aguilar Mena](https://github.com/Ergus))。
- 引入 `system.completions` 表。关闭 [#81889](https://github.com/ClickHouse/ClickHouse/issues/81889)。[#83833](https://github.com/ClickHouse/ClickHouse/pull/83833) ([|2ustam](https://github.com/RuS2m))。

### Iceberg 和 DeltaLake {#iceberg-and-deltalake}

- 支持 Iceberg 模式演化中的复杂类型。[#73714](https://github.com/ClickHouse/ClickHouse/pull/73714) ([scanhex12](https://github.com/scanhex12))。
- 为 `insert` 查询引入 Iceberg 写入功能。[#82692](https://github.com/ClickHouse/ClickHouse/pull/82692) ([scanhex12](https://github.com/scanhex12))。
- 支持 Iceberg 表引擎的位置删除。[#83094](https://github.com/ClickHouse/ClickHouse/pull/83094) ([Daniil Ivanik](https://github.com/divanik))。
- 通过字段 ID 读取 Iceberg 数据文件。关闭 [#83065](https://github.com/ClickHouse/ClickHouse/issues/83065)。[#83653](https://github.com/ClickHouse/ClickHouse/pull/83653) ([scanhex12](https://github.com/scanhex12))。
- 支持创建表时的 Iceberg 写入。关闭 [#83927](https://github.com/ClickHouse/ClickHouse/issues/83927)。[#83983](https://github.com/ClickHouse/ClickHouse/pull/83983) ([scanhex12](https://github.com/scanhex12))。
- 支持写入 Glue 目录。[#84136](https://github.com/ClickHouse/ClickHouse/pull/84136) ([scanhex12](https://github.com/scanhex12))。
- 支持写入 Iceberg Rest 目录。[#84684](https://github.com/ClickHouse/ClickHouse/pull/84684) ([scanhex12](https://github.com/scanhex12))。
- 将所有 Iceberg 位置删除文件合并到数据文件中。这将减少 Iceberg 存储中 Parquet 文件的数量和大小。语法:`OPTIMIZE TABLE table_name`。[#85250](https://github.com/ClickHouse/ClickHouse/pull/85250) ([scanhex12](https://github.com/scanhex12))。
- 支持 Iceberg 的 `DROP TABLE` 操作(从 REST/Glue 目录中删除 + 删除表的元数据)。[#85395](https://github.com/ClickHouse/ClickHouse/pull/85395) ([scanhex12](https://github.com/scanhex12))。
- 支持 Iceberg 在读时合并格式下的 `ALTER DELETE` 变更操作。[#85549](https://github.com/ClickHouse/ClickHouse/pull/85549) ([scanhex12](https://github.com/scanhex12))。
- 支持写入 DeltaLake。关闭 [#79603](https://github.com/ClickHouse/ClickHouse/issues/79603)。[#85564](https://github.com/ClickHouse/ClickHouse/pull/85564) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 在元数据(清单条目)中写入更多 Iceberg 统计信息(列大小、下界和上界),用于最小-最大值剪枝。[#85746](https://github.com/ClickHouse/ClickHouse/pull/85746) ([scanhex12](https://github.com/scanhex12))。
- 支持在 Iceberg 中对简单类型执行添加/删除/修改列操作。[#85769](https://github.com/ClickHouse/ClickHouse/pull/85769) ([scanhex12](https://github.com/scanhex12))。


### MergeTree 与存储 {#mergetree-and-storage}

- 现在所有表都支持 `_table` 虚拟列,不再仅限于 Merge 类型表。[#63665](https://github.com/ClickHouse/ClickHouse/pull/63665) ([Xiaozhe Yu](https://github.com/wudidapaopao)).
- 为 `Float32` 和 `Float64` 类型的列添加了 SZ3 作为有损但误差可控的压缩编解码器。[#67161](https://github.com/ClickHouse/ClickHouse/pull/67161) ([scanhex12](https://github.com/scanhex12)).
- 为 `MergeTree` 系列表添加了轻量级更新支持。轻量级更新可以使用新语法:`UPDATE <table> SET col1 = val1, col2 = val2, ... WHERE <condition>`。通过轻量级更新实现了轻量级删除功能,可以通过设置 `lightweight_delete_mode = 'lightweight_update'` 来启用。[#82004](https://github.com/ClickHouse/ClickHouse/pull/82004) ([Anton Popov](https://github.com/CurtizJ)).
- 在 MergeTree 系列表中支持 `_part_granule_offset` 虚拟列。该列表示每行在其数据部分中所属颗粒/标记的从零开始的索引。这解决了 [#79572](https://github.com/ClickHouse/ClickHouse/issues/79572)。[#82341](https://github.com/ClickHouse/ClickHouse/pull/82341) ([Amos Bird](https://github.com/amosbird)).

### 协议与客户端支持 {#protocol-and-client-support}

- 通过添加 [`arrowflight`](/engines/table-engines/integrations/arrowflight) 表引擎实现了对 [ArrowFlight RPC](https://arrow.apache.org/docs/format/Flight.html) 协议的支持。[#74184](https://github.com/ClickHouse/ClickHouse/pull/74184) ([zakr600](https://github.com/zakr600)).
- 添加了 PostgreSQL 协议 `COPY` 命令支持。[#74344](https://github.com/ClickHouse/ClickHouse/pull/74344) ([scanhex12](https://github.com/scanhex12)).
- 为 mysql 协议添加了 C# 客户端支持。这解决了 [#83992](https://github.com/ClickHouse/ClickHouse/issues/83992)。[#84397](https://github.com/ClickHouse/ClickHouse/pull/84397) ([scanhex12](https://github.com/scanhex12)).
- 为 `mysql_port` 和 `postgresql_port` 强制使用安全连接。[#82962](https://github.com/ClickHouse/ClickHouse/pull/82962) ([Shaohua Wang](https://github.com/tiandiwonder)).

### SQL 与查询功能 {#sql-and-query-features}

- 除了 `DESCRIBE (SELECT ...)` 之外,还支持 `DESCRIBE SELECT`。[#82947](https://github.com/ClickHouse/ClickHouse/pull/82947) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
- 支持使用 `USE DATABASE {name}` 语法。[#81307](https://github.com/ClickHouse/ClickHouse/pull/81307) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
- 为并行副本实现了从投影读取的功能。添加了新设置 [`parallel_replicas_support_projection`](/operations/settings/settings#parallel_replicas_support_projection) 来控制是否启用投影支持。为简化实现,仅在 `parallel_replicas_local_plan` 激活时才启用投影支持。[#82807](https://github.com/ClickHouse/ClickHouse/pull/82807) ([zoomxi](https://github.com/zoomxi)).

### 格式 {#formats}

- 添加了 [`format_schema_source`](/operations/settings/formats#format_schema_source) 设置,用于定义 `format_schema` 的来源。[#80874](https://github.com/ClickHouse/ClickHouse/pull/80874) ([Tuan Pham Anh](https://github.com/tuanpach)).
- 添加了 `Hash` 作为新的输出格式。它为结果的所有列和行计算单个哈希值。这对于计算结果的"指纹"很有用,例如在数据传输成为瓶颈的使用场景中。示例:`SELECT arrayJoin(['abc', 'def']), 42 FORMAT Hash` 返回 `e5f9e676db098fdb9530d2059d8c23ef`。[#84607](https://github.com/ClickHouse/ClickHouse/pull/84607) ([Robert Schulze](https://github.com/rschu1ze)).


### 服务器配置和工作负载管理 {#server-configuration-and-workload-management}

- 服务器设置 [`cpu_slot_preemption`](/operations/server-configuration-parameters/settings#cpu_slot_preemption) 为工作负载启用抢占式 CPU 调度,并确保工作负载之间 CPU 时间的最大-最小公平分配。新增了用于 CPU 限流的工作负载设置:`max_cpus`、`max_cpu_share` 和 `max_burst_cpu_seconds`。[#80879](https://github.com/ClickHouse/ClickHouse/pull/80879) ([Sergei Trifonov](https://github.com/serxa))。
- 现已支持工作负载设置 [`max_waiting_queries`](/operations/server-configuration-parameters/settings#max_waiting_queries)。它可用于限制查询队列的大小。如果达到限制,所有后续查询将以 `SERVER_OVERLOADED` 错误终止。[#81250](https://github.com/ClickHouse/ClickHouse/pull/81250) ([Oleg Doronin](https://github.com/dorooleg))。
- 在达到配置的查询数量或时间阈值后断开 TCP 连接。解决了 [#68000](https://github.com/ClickHouse/ClickHouse/issues/68000)。[#81472](https://github.com/ClickHouse/ClickHouse/pull/81472) ([Kenny Sun](https://github.com/hwabis))。

### 云存储 {#cloud-storage}

- 为 `AzureBlobStorage` 添加 `extra_credentials`,以使用 `client_id` 和 `tenant_id` 进行身份验证。[#84235](https://github.com/ClickHouse/ClickHouse/pull/84235) ([Pablo Marcos](https://github.com/pamarcos))。

### Keeper {#keeper}

- 添加了在 Keeper Multi 查询中设置任意 watch 的功能。[#84964](https://github.com/ClickHouse/ClickHouse/pull/84964) ([Mikhail Artemenko](https://github.com/Michicosun))。
- 支持部分聚合指标。[#85328](https://github.com/ClickHouse/ClickHouse/pull/85328) ([Mikhail Artemenko](https://github.com/Michicosun))。


## 实验性功能 {#experimental-features}

### 表引擎和表函数 {#table-engines-and-table-functions}

- 新增 Ytsaurus 表引擎和表函数。[#77606](https://github.com/ClickHouse/ClickHouse/pull/77606) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。

### 文本索引改进 {#text-index-improvements}

- 新增函数 `searchAny` 和 `searchAll`,作为搜索文本索引的通用工具。[#80641](https://github.com/ClickHouse/ClickHouse/pull/80641) ([Elmi Ahmadov](https://github.com/ahmadov))。
- 文本索引现已支持 `string` 分词器。[#81752](https://github.com/ClickHouse/ClickHouse/pull/81752) ([Elmi Ahmadov](https://github.com/ahmadov))。
- 将 `text` 索引的默认索引粒度值调整为 64。此调整可提升内部基准测试中平均查询的预期性能。[#82162](https://github.com/ClickHouse/ClickHouse/pull/82162) ([Jimmy Aguilar Mena](https://github.com/Ergus))。
- 修复了 256 位位图存储问题:虽然状态的出边标签按顺序存储,但出边状态按其在哈希表中的出现顺序保存到磁盘,导致从磁盘读取时标签可能指向错误的下一个状态。[#82783](https://github.com/ClickHouse/ClickHouse/pull/82783) ([Elmi Ahmadov](https://github.com/ahmadov))。
- 改进了 FST 树的存储方式:之前 FST 树以未压缩形式保存到磁盘,可能导致磁盘读写时性能下降或 I/O 带宽占用过高。[#83093](https://github.com/ClickHouse/ClickHouse/pull/83093) ([Elmi Ahmadov](https://github.com/ahmadov))。

### 功能成熟度更新 {#feature-maturity-updates}

- Catalog 功能升级至 Beta 阶段。[#85848](https://github.com/ClickHouse/ClickHouse/pull/85848) ([Melvyn Peignon](https://github.com/melvynator))。
- 轻量级更新功能从实验性阶段升级至 Beta 阶段。[#85952](https://github.com/ClickHouse/ClickHouse/pull/85952) ([Anton Popov](https://github.com/CurtizJ))。


## 性能改进 {#performance-improvements}

### 查询执行和聚合 {#query-execution-and-aggregation}

- 对 `-If` 聚合函数组合器进行了简单优化。[#78454](https://github.com/ClickHouse/ClickHouse/pull/78454) ([李扬](https://github.com/taiyang-li)).
- 新增逻辑(由设置 [`enable_producing_buckets_out_of_order_in_aggregation`](/operations/settings/settings#enable_producing_buckets_out_of_order_in_aggregation) 控制,默认启用),允许在内存高效聚合过程中无序发送某些桶。当某些聚合桶的合并时间明显长于其他桶时,该逻辑允许发起者同时合并具有更高桶 ID 的桶,从而提高性能。缺点是可能会增加内存使用量(但不应很显著)。[#80179](https://github.com/ClickHouse/ClickHouse/pull/80179) ([Nikita Taranov](https://github.com/nickitat)).
- 使 `TOTALS` 步骤之后的管道支持多线程。[#80331](https://github.com/ClickHouse/ClickHouse/pull/80331) ([UnamedRus](https://github.com/UnamedRus)).
- 当聚合查询仅包含对 `NOT NULL` 列的单个 `COUNT()` 函数时,聚合逻辑在哈希表探测期间完全内联。这避免了分配和维护任何聚合状态,显著降低了内存使用和 CPU 开销。此改进部分解决了 [#81982](https://github.com/ClickHouse/ClickHouse/issues/81982)。[#82104](https://github.com/ClickHouse/ClickHouse/pull/82104) ([Amos Bird](https://github.com/amosbird)).
- 当按多个字符串或数字列分组时,以列式方式计算序列化键。[#83884](https://github.com/ClickHouse/ClickHouse/pull/83884) ([李扬](https://github.com/taiyang-li)).
- 为 `-If` 组合器实现 `addManyDefaults`。[#83870](https://github.com/ClickHouse/ClickHouse/pull/83870) ([Raúl Marín](https://github.com/Algunenano)).

### JOIN 优化 {#join-optimizations}


- 新增设置 [`min_joined_block_size_rows`](/operations/settings/settings#min_joined_block_size_rows)(类似于 `min_joined_block_size_bytes`;默认值为 65409),用于控制 JOIN 输入和输出块的最小块大小(以行为单位)(如果连接算法支持)。小块将被压缩合并。[#81886](https://github.com/ClickHouse/ClickHouse/pull/81886) ([Nikita Taranov](https://github.com/nickitat))。
- 通过在仅有一个键列的典型情况下移除对哈希映射的额外循环,优化了 `HashJoin` 的性能,同时当 `null_map` 和 `join_mask` 始终为 `true`/`false` 时,消除了对它们的检查。[#82308](https://github.com/ClickHouse/ClickHouse/pull/82308) ([Nikita Taranov](https://github.com/nickitat))。
- 将来自 [#82308](https://github.com/ClickHouse/ClickHouse/issues/82308) 的 `null_map` 和 `JoinMask` 优化应用于具有多个析取条件的 JOIN 场景。此外,`KnownRowsHolder` 数据结构也得到了优化。[#83041](https://github.com/ClickHouse/ClickHouse/pull/83041) ([Nikita Taranov](https://github.com/nickitat))。
- 使用普通的 `std::vector<std::atomic_bool>` 作为连接标志,以避免在每次访问标志时计算哈希值。[#83043](https://github.com/ClickHouse/ClickHouse/pull/83043) ([Nikita Taranov](https://github.com/nickitat))。
- 在哈希 JOIN 主循环之外处理 `max_joined_block_rows`。略微提升了 ALL JOIN 的性能。[#83216](https://github.com/ClickHouse/ClickHouse/pull/83216) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- 当 `HashJoin` 使用 `lazy` 输出模式时,不预先为结果列分配内存。预先分配并非最优,特别是在匹配数量较少的情况下。此外,在连接完成后我们知道确切的匹配数量,因此可以更精确地预分配内存。[#83304](https://github.com/ClickHouse/ClickHouse/pull/83304) ([Nikita Taranov](https://github.com/nickitat))。
- 如果右侧由连接键列函数确定(所有行都具有唯一的连接键值),则所有 `LEFT/INNER` JOIN 将自动转换为 `RightAny`。[#84010](https://github.com/ClickHouse/ClickHouse/pull/84010) ([Nikita Taranov](https://github.com/nickitat))。
- 提升了在 `Join` 模式下应用补丁部分的性能。[#85040](https://github.com/ClickHouse/ClickHouse/pull/85040) ([Anton Popov](https://github.com/CurtizJ))。

### 分布式查询改进 {#distributed-query-improvements}


- 引入了一个选项,可将数据块的(解)压缩和(反)序列化操作从与网络连接关联的单个线程卸载到管道线程中。通过设置 `enable_parallel_blocks_marshalling` 进行控制。这应该能够加速在发起节点和远程节点之间传输大量数据的分布式查询。[#78694](https://github.com/ClickHouse/ClickHouse/pull/78694) ([Nikita Taranov](https://github.com/nickitat)).
- 并行分布式 `INSERT SELECT` 默认启用,在此模式下 `INSERT SELECT` 在每个分片上独立执行,请参阅 `parallel_distributed_insert_select` 设置。 [#80425](https://github.com/ClickHouse/ClickHouse/pull/80425) ([Igor Nikonov](https://github.com/devcrafter)).
- 在原生协议中压缩日志和性能分析事件。在拥有 100+ 副本的集群上,未压缩的性能分析事件会占用 1..10 MB/秒的带宽,并且在慢速互联网连接上进度条会变得迟缓。这解决了 [#82533](https://github.com/ClickHouse/ClickHouse/issues/82533). [#82535](https://github.com/ClickHouse/ClickHouse/pull/82535) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- 并行分布式 `INSERT SELECT` 默认启用,在此模式下 INSERT SELECT 在每个分片上独立执行,请参阅 `parallel_distributed_insert_select` 设置。[#83040](https://github.com/ClickHouse/ClickHouse/pull/83040) ([Igor Nikonov](https://github.com/devcrafter)).
- 修复了并行副本的最小任务大小计算问题。[#84752](https://github.com/ClickHouse/ClickHouse/pull/84752) ([Nikita Taranov](https://github.com/nickitat)).

### 索引改进 {#index-improvements}

- 使用向量相似度索引的向量搜索查询由于减少了存储读取和 CPU 使用率而实现了更低的延迟。[#79103](https://github.com/ClickHouse/ClickHouse/pull/79103) ([Shankar Iyer](https://github.com/shankar-iyer)).
- 在 `filterPartsByQueryConditionCache` 中遵守 `merge_tree_min_{rows,bytes}_for_seek` 设置,使其与其他通过索引过滤的方法保持一致。[#80312](https://github.com/ClickHouse/ClickHouse/pull/80312) ([李扬](https://github.com/taiyang-li)).
- 优先处理更高粒度的 min-max 索引。解决了 [#75381](https://github.com/ClickHouse/ClickHouse/issues/75381). [#83798](https://github.com/ClickHouse/ClickHouse/pull/83798) ([Maruth Goyal](https://github.com/maruthgoyal)).
- 布隆过滤器索引现在可用于类似 `has([c1, c2, ...], column)` 的条件,其中 `column` 不是 `Array` 类型。这提高了此类查询的性能,使其与 `IN` 运算符一样高效。[#83945](https://github.com/ClickHouse/ClickHouse/pull/83945) ([Doron David](https://github.com/dorki)).
- 按文件大小递增顺序处理索引。最终的索引排序优先考虑 minmax 和向量索引(分别由于其简单性和选择性),然后是小型索引。在 minmax/向量索引中,也优先选择较小的索引。[#84094](https://github.com/ClickHouse/ClickHouse/pull/84094) ([Maruth Goyal](https://github.com/maruthgoyal)).
- 以前,文本索引数据会被分成多个段(每个段的默认大小为 256 MiB)。这可能会减少构建文本索引时的内存消耗,但会增加磁盘空间需求并增加查询响应时间。[#84590](https://github.com/ClickHouse/ClickHouse/pull/84590) ([Elmi Ahmadov](https://github.com/ahmadov)).

### 子查询优化 {#subquery-optimizations}


- 通过使用等价类移除冗余的 `JOIN` 操作来优化关联子查询的生成计划。如果所有关联列都存在等价表达式,且启用了 `query_plan_correlated_subqueries_use_substitution` 设置,则不会生成 `CROSS JOIN`。[#82435](https://github.com/ClickHouse/ClickHouse/pull/82435) ([Dmitry Novik](https://github.com/novikd))。
- 当关联子查询作为 `EXISTS` 函数的参数时,仅读取所需的列。[#82443](https://github.com/ClickHouse/ClickHouse/pull/82443) ([Dmitry Novik](https://github.com/novikd))。

### Azure Blob Storage 改进 {#azure-blob-storage-improvements}

- [`azureBlobStorage`](/engines/table-engines/integrations/azureBlobStorage) 表引擎现在会在可能的情况下缓存并重用托管身份认证令牌,以避免限流。[#79860](https://github.com/ClickHouse/ClickHouse/pull/79860) ([Nick Blakely](https://github.com/niblak))。
- 将 Azure Blob Storage 的 curl HTTP 客户端替换为 Poco HTTP 客户端。为这些客户端引入了多个设置,这些设置与 S3 的设置相对应。为 Azure 和 S3 引入了更激进的连接超时设置。改进了对 Azure 性能事件和指标的内省能力。新客户端默认启用,为基于 Azure Blob Storage 的冷查询提供了更优的延迟表现。可以通过设置 `azure_sdk_use_native_client=false` 来恢复使用旧的 `Curl` 客户端。[#83294](https://github.com/ClickHouse/ClickHouse/pull/83294) ([alesapin](https://github.com/alesapin))。

### 存储引擎改进 {#storage-engine-improvements}

- 修复了 Redis 和 KeeperMap 存储的按键过滤功能。[#81833](https://github.com/ClickHouse/ClickHouse/pull/81833) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。
- `ATTACH PARTITION` 不再导致所有缓存被清除。[#82377](https://github.com/ClickHouse/ClickHouse/pull/82377) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 在创建存储快照数据时避免持有锁,以减少高并发负载下的锁竞争。[#83510](https://github.com/ClickHouse/ClickHouse/pull/83510) ([Duc Canh Le](https://github.com/canhld94))。
- 删除临时部分可能需要一段时间(特别是使用 S3 时),目前我们在 `MergeTreeBackgroundExecutor` 中持有全局锁的情况下执行此操作。当由于连接丢失需要重启所有表并等待后台任务完成时,表甚至可能在只读模式下卡住长达一小时。但看起来调用 `cancel` 时并不需要这个锁。[#84311](https://github.com/ClickHouse/ClickHouse/pull/84311) ([Alexander Tokmakov](https://github.com/tavplubix))。

### 格式改进 {#format-improvements}

- 新的 Parquet 读取器实现。通常更快,并支持页级过滤器下推和 `PREWHERE`。目前处于实验阶段。使用 `input_format_parquet_use_native_reader_v3` 设置来启用。[#82789](https://github.com/ClickHouse/ClickHouse/pull/82789) ([Michael Kolupaev](https://github.com/al13n321))。
- 通过在没有解析错误时重用序列化器,提高了 ProtobufSingle 输入格式的性能。[#83613](https://github.com/ClickHouse/ClickHouse/pull/83613) ([Eduard Karacharov](https://github.com/korowa))。

### 数据类型和序列化优化 {#data-type-and-serialization-optimizations}

- 通过为 MergeTree 中的 `JSON` 共享数据实现新的序列化方式,显著提高了从 MergeTree 共享数据中读取 `JSON` 子列的性能。[#83777](https://github.com/ClickHouse/ClickHouse/pull/83777) ([Pavel Kruglov](https://github.com/Avogar))。
- 通过简化代码来优化字符串反序列化。关闭 [#38564](https://github.com/ClickHouse/ClickHouse/issues/38564)。[#84561](https://github.com/ClickHouse/ClickHouse/pull/84561) ([Alexey Milovidov](https://github.com/alexey-milovidov))。

### 管道和执行改进 {#pipeline-and-execution-improvements}


- 在管道构建期间最小化端口头中的内存复制。原始 [PR](https://github.com/ClickHouse/ClickHouse/pull/70105) 由 [heymind](https://github.com/heymind) 提交。[#83381](https://github.com/ClickHouse/ClickHouse/pull/83381) ([Raúl Marín](https://github.com/Algunenano))。
- 提升管道构建性能。[#83631](https://github.com/ClickHouse/ClickHouse/pull/83631) ([Raúl Marín](https://github.com/Algunenano))。
- 优化 MergeTreeReadersChain::getSampleBlock。[#83875](https://github.com/ClickHouse/ClickHouse/pull/83875) ([Raúl Marín](https://github.com/Algunenano))。
- 优化常量物化,适用于仅需返回单行的场景。[#85071](https://github.com/ClickHouse/ClickHouse/pull/85071) ([Alexey Milovidov](https://github.com/alexey-milovidov))。

### 内存和资源优化 {#memory-and-resource-optimizations}

- 调整部分 jemalloc 配置以提升性能。[#81807](https://github.com/ClickHouse/ClickHouse/pull/81807) ([Antonio Andelic](https://github.com/antonio2368))。
- 在 ProfileEvents 的 Counter 中添加对齐以减少伪共享。[#82697](https://github.com/ClickHouse/ClickHouse/pull/82697) ([Jiebin Sun](https://github.com/jiebinn))。
- 减少 CompressedReadBufferBase::readCompressedData 中不必要的 memcpy 调用。[#83986](https://github.com/ClickHouse/ClickHouse/pull/83986) ([Raúl Marín](https://github.com/Algunenano))。

### 查询规划和分析 {#query-planning-and-analysis}

- 加速 QueryTreeHash。[#82617](https://github.com/ClickHouse/ClickHouse/pull/82617) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。

### 日志改进 {#logging-improvements}

- 引入异步日志记录。[#82516](https://github.com/ClickHouse/ClickHouse/pull/82516) ([Raúl Marín](https://github.com/Algunenano))。

### 函数优化 {#function-optimizations}

- 通过移除临时数据优化 `largestTriangleThreeBuckets`。[#84479](https://github.com/ClickHouse/ClickHouse/pull/84479) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 优化并简化了多个字符串处理函数的实现。修正了部分函数的错误文档。注意:`byteSize` 对于 String 列和包含 String 列的复杂类型的输出已从每个空字符串 9 字节更改为 8 字节,这是预期行为。[#85063](https://github.com/ClickHouse/ClickHouse/pull/85063) ([Alexey Milovidov](https://github.com/alexey-milovidov))。

### Keeper 改进 {#keeper-improvements}

- 改进 Keeper 的 RocksDB 初始加载。[#83390](https://github.com/ClickHouse/ClickHouse/pull/83390) ([Antonio Andelic](https://github.com/antonio2368))。

### 数据湖改进 {#data-lake-improvements}

- 改进使用 delta-kernel-rs 后端的并行文件处理。[#85642](https://github.com/ClickHouse/ClickHouse/pull/85642) ([Azat Khuzhin](https://github.com/azat))。


## 改进 {#improvements}

### 访问控制与安全 {#access-control-and-security}

- 为数据源引入了两种新的访问类型:`READ` 和 `WRITE`,并弃用了所有先前与数据源相关的访问类型。之前使用 `GRANT S3 ON *.* TO user`,现在使用:`GRANT READ, WRITE ON S3 TO user`。这还允许为数据源分别设置 `READ` 和 `WRITE` 权限,例如:`GRANT READ ON * TO user`、`GRANT WRITE ON S3 TO user`。该功能由设置 `access_control_improvements.enable_read_write_grants` 控制,默认禁用。[#73659](https://github.com/ClickHouse/ClickHouse/pull/73659) ([pufit](https://github.com/pufit)).
- 允许在 `CREATE USER` 查询中为用户名使用参数。[#81387](https://github.com/ClickHouse/ClickHouse/pull/81387) ([Diskein](https://github.com/Diskein)).
- 从核心转储中排除敏感数据。添加了两个分配器:与 AWS 库兼容的 `AwsNodumpMemoryManager` 和与 STL 兼容的 `JemallocNodumpSTLAllocator`。两者都是 Jemalloc 分配器的包装器。它们使用 Jemalloc 的扩展钩子和 madvise 将内存页标记为"不转储"。用于 S3 凭证、用户凭证和部分查询数据。[#82441](https://github.com/ClickHouse/ClickHouse/pull/82441) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
- 由临时用户创建的视图现在将存储实际用户的副本,并且在临时用户被删除后不再失效。[#84763](https://github.com/ClickHouse/ClickHouse/pull/84763) ([pufit](https://github.com/pufit)).
- 以不区分大小写的方式匹配外部认证的 forward_headers。[#84737](https://github.com/ClickHouse/ClickHouse/pull/84737) ([ingodwerust](https://github.com/ingodwerust)).
- 在 `system.grants` 中添加 `parameter` 列,用于确定 `GRANT READ/WRITE` 的数据源类型以及 `GRANT TABLE ENGINE` 的表引擎。[#85643](https://github.com/ClickHouse/ClickHouse/pull/85643) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).

### 备份与恢复 {#backup-and-restore}

- 允许备份 PostgreSQL、MySQL 和 DataLake 数据库。此类数据库的备份仅保存定义,不保存其中的数据。[#79982](https://github.com/ClickHouse/ClickHouse/pull/79982) ([Nikolay Degterinsky](https://github.com/evillique)).
- 将写入备份文件的所有日志消息设置为 TRACE 级别。[#82907](https://github.com/ClickHouse/ClickHouse/pull/82907) ([Hans Krutzer](https://github.com/hkrutzer)).
- 引入 [`backup_restore_s3_retry_initial_backoff_ms`](/operations/settings/settings#backup_restore_s3_retry_initial_backoff_ms)、[`backup_restore_s3_retry_max_backoff_ms`](/operations/settings/settings#backup_restore_s3_retry_max_backoff_ms)、[`backup_restore_s3_retry_jitter_factor`](/operations/settings/settings#backup_restore_s3_retry_jitter_factor) 来配置备份和恢复操作期间使用的 S3 重试退避策略。[#84421](https://github.com/ClickHouse/ClickHouse/pull/84421) ([Julia Kartseva](https://github.com/jkartseva)).
- 引入新的 [`backup_slow_all_threads_after_retryable_s3_error`](/operations/settings/settings#backup_slow_all_threads_after_retryable_s3_error) 设置,通过在观察到单个可重试错误时减慢所有线程的速度,来降低由 `SlowDown` 等错误引起的重试风暴期间对 S3 的压力。[#84854](https://github.com/ClickHouse/ClickHouse/pull/84854) ([Julia Kartseva](https://github.com/jkartseva)).

### 数据完整性与验证 {#data-integrity-and-validation}


- 在提交之前验证数据分片具有一致的 checksum.txt 文件。[#76625](https://github.com/ClickHouse/ClickHouse/pull/76625) ([Sema Checherinda](https://github.com/CheSema))。
- 如果某列当前正受到未完成数据变更的影响,则禁止启动 `RENAME COLUMN` alter 变更操作。[#81823](https://github.com/ClickHouse/ClickHouse/pull/81823) ([Mikhail Artemenko](https://github.com/Michicosun))。
- 现在变更快照将从可见数据分片的快照构建。快照中使用的变更计数器也将根据包含的变更重新计算。[#82945](https://github.com/ClickHouse/ClickHouse/pull/82945) ([Mikhail Artemenko](https://github.com/Michicosun))。
- 添加解析数据分片前缀和后缀的能力,并检查非常量列的覆盖范围。[#83377](https://github.com/ClickHouse/ClickHouse/pull/83377) ([Mikhail Artemenko](https://github.com/Michicosun))。

### Iceberg 表引擎 {#iceberg-table-engine}

- 支持 Iceberg 表引擎的位置删除功能。[#80237](https://github.com/ClickHouse/ClickHouse/pull/80237) ([YanghongZhong](https://github.com/yahoNanJing))。
- 现在 ClickHouse 支持 Iceberg 的压缩 `metadata.json` 文件。修复 [#70874](https://github.com/ClickHouse/ClickHouse/issues/70874)。[#81451](https://github.com/ClickHouse/ClickHouse/pull/81451) ([alesapin](https://github.com/alesapin))。
- 修复通过字段 ID 读取复杂类型的 Iceberg 数据的问题。[#84821](https://github.com/ClickHouse/ClickHouse/pull/84821) ([scanhex12](https://github.com/scanhex12))。
- 支持从 pyiceberg 读取 Iceberg 写入的数据。[#84466](https://github.com/ClickHouse/ClickHouse/pull/84466) ([scanhex12](https://github.com/scanhex12))。
- 为数据湖表引擎添加快照版本功能。[#84659](https://github.com/ClickHouse/ClickHouse/pull/84659) ([Pete Hampton](https://github.com/pjhampton))。
- 支持使用 Iceberg 写入 version-hint 文件。这解决了 [#85097](https://github.com/ClickHouse/ClickHouse/issues/85097)。[#85130](https://github.com/ClickHouse/ClickHouse/pull/85130) ([scanhex12](https://github.com/scanhex12))。
- 通过 [`iceberg_metadata_compression_method`](/operations/settings/settings#iceberg_metadata_compression_method) 设置支持压缩 `.metadata.json` 文件。支持所有 ClickHouse 压缩方法。这解决了 [#84895](https://github.com/ClickHouse/ClickHouse/issues/84895)。[#85196](https://github.com/ClickHouse/ClickHouse/pull/85196) ([scanhex12](https://github.com/scanhex12))。
- 优化了 Iceberg 位置删除文件的内存使用。不再将所有删除文件数据加载到内存中,而是仅将 Parquet 删除文件中的当前行组保留在 RAM 中。这显著降低了处理大型位置删除文件时的内存消耗。[#85329](https://github.com/ClickHouse/ClickHouse/pull/85329) ([scanhex12](https://github.com/scanhex12))。
- 允许异步迭代 Iceberg 表中的对象,而无需显式存储每个数据文件的对象。[#85369](https://github.com/ClickHouse/ClickHouse/pull/85369) ([Daniil Ivanik](https://github.com/divanik))。
- 支持 Iceberg 等值删除功能。[#85843](https://github.com/ClickHouse/ClickHouse/pull/85843) ([Han Fei](https://github.com/hanfei1991))。

### DeltaLake 表引擎 {#deltalake-table-engine}


- 改进 `DeltaLake` 表引擎:delta-kernel-rs 提供了 `ExpressionVisitor` API,本 PR 已实现该 API 并将其应用于分区列表达式转换(它将替换我们代码中之前使用的 delta-kernel-rs 已弃用的旧方式)。未来,此 `ExpressionVisitor` 还将支持实现基于统计信息的剪枝以及一些 delta-lake 专有特性。此外,此更改旨在支持 `DeltaLakeCluster` 表引擎中的分区剪枝(解析表达式的结果 - ActionsDAG - 将被序列化并与数据路径一起从发起节点发送,因为剪枝所需的此类信息仅作为元信息存在于数据文件列表中,而数据文件列表仅由发起节点生成,但必须应用于每个读取服务器上的数据)。[#81136](https://github.com/ClickHouse/ClickHouse/pull/81136) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 修复数据湖集群函数的分区剪枝问题。[#82131](https://github.com/ClickHouse/ClickHouse/pull/82131) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 修复 DeltaLakeCluster 表函数中读取分区数据的问题。在本 PR 中,集群函数协议版本已升级,允许从发起节点向副本发送额外信息。此额外信息包含 delta-kernel 转换表达式,用于解析分区列(以及未来的其他内容,如生成列等)。[#82132](https://github.com/ClickHouse/ClickHouse/pull/82132) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 现在 Datalake 数据库会抛出更友好的异常。修复 [#81211](https://github.com/ClickHouse/ClickHouse/issues/81211)。[#82304](https://github.com/ClickHouse/ClickHouse/pull/82304) ([alesapin](https://github.com/alesapin))。
- 在 `DeltaLake` 存储中实现内部 `delta-kernel-rs` 过滤(统计信息和分区剪枝)。[#84006](https://github.com/ClickHouse/ClickHouse/pull/84006) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 添加设置 [`delta_lake_enable_expression_visitor_logging`](/operations/settings/settings#delta_lake_enable_expression_visitor_logging) 以关闭表达式访问器日志,因为在调试时,即使对于测试日志级别,这些日志也可能过于冗长。[#84315](https://github.com/ClickHouse/ClickHouse/pull/84315) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 添加设置 [`delta_lake_snapshot_version`](/operations/settings/settings#delta_lake_snapshot_version) 以支持在 `DeltaLake` 表引擎中读取特定快照版本。[#85295](https://github.com/ClickHouse/ClickHouse/pull/85295) ([Kseniia Sumarokova](https://github.com/kssenii))。

### 数据湖集成 {#data-lake-integration}

- 通过异步请求加速数据目录中的表列表操作。[#81084](https://github.com/ClickHouse/ClickHouse/pull/81084) ([alesapin](https://github.com/alesapin))。
- 在 Glue 目录中支持 `TimestampTZ`。此更改关闭 [#81654](https://github.com/ClickHouse/ClickHouse/issues/81654)。[#83132](https://github.com/ClickHouse/ClickHouse/pull/83132) ([scanhex12](https://github.com/scanhex12))。
- 将 FormatParserGroup 拆分为两个独立的结构,第一个负责共享计算和 IO 资源,第二个负责共享过滤资源(过滤 ActionDag、KeyCondition)。这样做是为了让不同线程更灵活地共享使用这些结构。[#83997](https://github.com/ClickHouse/ClickHouse/pull/83997) ([Daniil Ivanik](https://github.com/divanik))。
- 在 Azure 配置中添加缺失的 `partition_columns_in_data_file`。[#85373](https://github.com/ClickHouse/ClickHouse/pull/85373) ([Arthur Passos](https://github.com/arthurpassos))。
- 添加 show_data_lake_catalogs_in_system_tables 标志以管理在 system.tables 中添加数据湖表,解决 [#85384](https://github.com/ClickHouse/ClickHouse/issues/85384)。[#85411](https://github.com/ClickHouse/ClickHouse/pull/85411) ([Smita Kulkarni](https://github.com/SmitaRKulkarni))。

### S3 和对象存储 {#s3-and-object-storage}


- 在 `s3_plain_rewritable` 中实现 `moveFile` 和 `replaceFile` 方法,以支持将其用作数据库磁盘。[#79424](https://github.com/ClickHouse/ClickHouse/pull/79424) ([Tuan Pham Anh](https://github.com/tuanpach))。
- S3 读写请求在 HTTP 套接字级别进行限流(而非整个 S3 请求级别),以避免 `max_remote_read_network_bandwidth_for_server` 和 `max_remote_write_network_bandwidth_for_server` 限流导致的问题。[#81837](https://github.com/ClickHouse/ClickHouse/pull/81837) ([Sergei Trifonov](https://github.com/serxa))。
- 此 PR 在启用 `s3_slow_all_threads_after_network_error` 配置时,为 S3 重试机制引入抖动机制。[#81849](https://github.com/ClickHouse/ClickHouse/pull/81849) ([zoomxi](https://github.com/zoomxi))。
- 实现使用显式提供的 IAM 角色进行 AWS S3 身份验证。实现 GCS 的 OAuth 认证。这些功能此前仅在 ClickHouse Cloud 中提供,现已开源。同步部分接口,例如对象存储连接参数的序列化。[#84011](https://github.com/ClickHouse/ClickHouse/pull/84011) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 允许对外部聚合/排序使用任意存储策略(即对象存储,例如 S3)。[#84734](https://github.com/ClickHouse/ClickHouse/pull/84734) ([Azat Khuzhin](https://github.com/azat))。
- 收集所有待删除对象以执行单次对象存储删除操作。[#85316](https://github.com/ClickHouse/ClickHouse/pull/85316) ([Mikhail Artemenko](https://github.com/Michicosun))。

### S3Queue 表引擎 {#s3queue-table-engine}

- 现在可以在 S3Queue 表引擎的 `keeper_path` 设置中使用 `{uuid}` 等宏。[#82463](https://github.com/ClickHouse/ClickHouse/pull/82463) ([Nikolay Degterinsky](https://github.com/evillique))。
- 添加新的服务器设置 `s3queue_disable_streaming`,用于禁用 S3Queue 表引擎中的流式处理。此设置可在不重启服务器的情况下更改。[#82515](https://github.com/ClickHouse/ClickHouse/pull/82515) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 向 `system.s3queue_log` 添加 `commit_time`、`commit_id` 列。[#83016](https://github.com/ClickHouse/ClickHouse/pull/83016) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 为 s3queue 关闭过程添加日志记录。[#83163](https://github.com/ClickHouse/ClickHouse/pull/83163) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 在服务器关闭时,先关闭 S3(Azure 等)Queue 流式处理,然后再关闭任何表。[#83530](https://github.com/ClickHouse/ClickHouse/pull/83530) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 支持在 `S3Queue` 表级别更改物化视图插入设置。添加了新的 `S3Queue` 级别设置:`min_insert_block_size_rows_for_materialized_views` 和 `min_insert_block_size_bytes_for_materialized_views`。默认情况下将使用配置文件级别的设置,`S3Queue` 级别的设置将覆盖配置文件设置。[#83971](https://github.com/ClickHouse/ClickHouse/pull/83971) ([Kseniia Sumarokova](https://github.com/kssenii))。
- S3Queue 有序模式修复:如果调用了关闭操作,则提前退出。[#84463](https://github.com/ClickHouse/ClickHouse/pull/84463) ([Kseniia Sumarokova](https://github.com/kssenii))。

### Kafka 集成 {#kafka-integration}


- 手动统计已消费的消息数量,避免依赖 StorageKafka2 中先前提交的偏移量。[#81662](https://github.com/ClickHouse/ClickHouse/pull/81662) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
- 将 `StorageKafka2` 集成到 [`system.kafka_consumers`](/operations/system-tables/kafka_consumers)。[#82652](https://github.com/ClickHouse/ClickHouse/pull/82652) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).

### ClickHouse Keeper 改进 {#clickhouse-keeper-improvements}

- Keeper 改进:在后台线程中跨磁盘移动变更日志文件。此前,将变更日志移动到不同磁盘会全局阻塞 Keeper 直至移动完成。如果移动操作耗时较长(例如移动到 S3 磁盘),会导致性能下降。[#82485](https://github.com/ClickHouse/ClickHouse/pull/82485) ([Antonio Andelic](https://github.com/antonio2368)).
- Keeper 改进:新增配置项 `keeper_server.cleanup_old_and_ignore_new_acl`。启用后,所有节点的 ACL 将被清除,同时新请求的 ACL 将被忽略。如果目标是完全移除节点的 ACL,务必保持该配置启用状态直至创建新快照。[#82496](https://github.com/ClickHouse/ClickHouse/pull/82496) ([Antonio Andelic](https://github.com/antonio2368)).
- Keeper 改进:支持为 world:anyone ACL 设置特定权限。[#82755](https://github.com/ClickHouse/ClickHouse/pull/82755) ([Antonio Andelic](https://github.com/antonio2368)).
- 新增在配置中为路径指定额外 Keeper ACL 的支持。如需为特定路径添加额外 ACL,可在配置的 `zookeeper.path_acls` 下定义。[#82898](https://github.com/ClickHouse/ClickHouse/pull/82898) ([Antonio Andelic](https://github.com/antonio2368)).
- 新增 ProfileEvent,当 Keeper 因软内存限制拒绝写入时触发。[#82963](https://github.com/ClickHouse/ClickHouse/pull/82963) ([Xander Garbett](https://github.com/Garbett1)).
- 默认启用 Keeper 中的 `create_if_not_exists`、`check_not_exists`、`remove_recursive` 功能标志,以支持新类型的请求。[#83488](https://github.com/ClickHouse/ClickHouse/pull/83488) ([Antonio Andelic](https://github.com/antonio2368)).
- 新增使用 `apply_to_children` 配置在特定 Keeper 节点上应用额外 ACL 的支持。[#84137](https://github.com/ClickHouse/ClickHouse/pull/84137) ([Antonio Andelic](https://github.com/antonio2368)).
- 为 KeeperClient 新增 `get_acl` 命令。[#84641](https://github.com/ClickHouse/ClickHouse/pull/84641) ([Antonio Andelic](https://github.com/antonio2368)).
- 在 Keeper 中新增 4LW 命令 `lgrq`,用于切换接收请求的日志记录。[#84719](https://github.com/ClickHouse/ClickHouse/pull/84719) ([Antonio Andelic](https://github.com/antonio2368)).
- 降低 Keeper 中存储锁的竞争。[#84732](https://github.com/ClickHouse/ClickHouse/pull/84732) ([Antonio Andelic](https://github.com/antonio2368)).
- `encrypt_decrypt` 工具现已支持加密的 ZooKeeper 连接。[#84764](https://github.com/ClickHouse/ClickHouse/pull/84764) ([Roman Vasin](https://github.com/rvasin)).
- 使用 `keeper_server.coordination_settings.latest_logs_cache_entry_count_threshold` 和 `keeper_server.coordination_settings.commit_logs_cache_entry_count_threshold` 按条目数量限制 Keeper 日志条目缓存大小。[#84877](https://github.com/ClickHouse/ClickHouse/pull/84877) ([Antonio Andelic](https://github.com/antonio2368)).

### JSON 和 Dynamic 类型 {#json-and-dynamic-types}


- 在 Wide 部分添加 `columns_substreams.txt` 文件以跟踪该部分中存储的所有子流。这有助于跟踪 JSON 和 Dynamic 类型中的动态流,从而避免读取这些列的样本来获取动态流列表(例如用于列大小计算)。此外,现在所有动态流都会反映在 `system.parts_columns` 中。[#81091](https://github.com/ClickHouse/ClickHouse/pull/81091) ([Pavel Kruglov](https://github.com/Avogar))。
- 允许在 JSON 和 Dynamic 列中使用 `ALTER UPDATE`。[#82419](https://github.com/ClickHouse/ClickHouse/pull/82419) ([Pavel Kruglov](https://github.com/Avogar))。
- 用户现在可以在 JSON 类型中使用 `Time` 和 `Time64` 类型。[#83784](https://github.com/ClickHouse/ClickHouse/pull/83784) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- 添加设置 `json_type_escape_dots_in_keys` 以在 JSON 类型解析期间转义 JSON 键中的点。该设置默认禁用。[#84207](https://github.com/ClickHouse/ClickHouse/pull/84207) ([Pavel Kruglov](https://github.com/Avogar))。

### Parquet 和 ORC 格式 {#parquet-and-orc-formats}

- 引入设置以配置 ORC 压缩块大小,并将其默认值从 64KB 更新为 256KB,以与 Spark 或 Hive 保持一致。[#80602](https://github.com/ClickHouse/ClickHouse/pull/80602) ([李扬](https://github.com/taiyang-li))。
- 支持按照[规范](https://github.com/apache/parquet-format/blob/master/LogicalTypes.md#enum)要求将 Parquet 枚举写入为字节数组。稍后将提供更多信息。[#81090](https://github.com/ClickHouse/ClickHouse/pull/81090) ([Arthur Passos](https://github.com/arthurpassos))。
- 支持将 GeoParquet 作为输出格式写入。[#81784](https://github.com/ClickHouse/ClickHouse/pull/81784) ([scanhex12](https://github.com/scanhex12))。

### 分布式查询和并行副本 {#distributed-queries-and-parallel-replicas}

- 引入了新设置 enable_add_distinct_to_in_subqueries。启用后,ClickHouse 将自动为分布式查询的 IN 子句中的子查询添加 DISTINCT。这可以显著减少分片之间传输的临时表大小并提高网络效率。注意:这是一种权衡——虽然网络传输减少了,但每个节点需要执行额外的合并(去重)工作。当网络传输成为瓶颈且合并成本可接受时,启用此设置。[#81908](https://github.com/ClickHouse/ClickHouse/pull/81908) ([fhw12345](https://github.com/fhw12345))。
- 如果在 `address_expression` 参数中提供了集群,则添加对带有并行副本的 `remote-()` 表函数的支持。同时修复了 [#73295](https://github.com/ClickHouse/ClickHouse/issues/73295)。[#82904](https://github.com/ClickHouse/ClickHouse/pull/82904) ([Igor Nikonov](https://github.com/devcrafter))。
- 使用并行副本的 JOIN 操作现在使用 JOIN 逻辑步骤。如果使用并行副本的 JOIN 查询出现任何问题,请尝试 `SET query_plan_use_new_logical_join_step=0` 并报告问题。[#83801](https://github.com/ClickHouse/ClickHouse/pull/83801) ([Vladimir Cherkasov](https://github.com/vdimir))。

### 设置和配置 {#settings-and-configuration}


- 将设置 `allow_experimental_join_condition` 标记为已废弃。[#80566](https://github.com/ClickHouse/ClickHouse/pull/80566) ([Vladimir Cherkasov](https://github.com/vdimir))。
- 总体和按用户的网络限流器不再重置,确保 `max_network_bandwidth_for_all_users` 和 `max_network_bandwidth_for_all_users` 限制永不超出。[#81729](https://github.com/ClickHouse/ClickHouse/pull/81729) ([Sergei Trifonov](https://github.com/serxa))。
- 引入 `optimize_rewrite_regexp_functions` 设置(默认启用),允许优化器在检测到特定正则表达式模式时,将某些 `replaceRegexpAll`、`replaceRegexpOne` 和 `extract` 调用重写为更简单、更高效的形式。(问题 [#81981](https://github.com/ClickHouse/ClickHouse/issues/81981))。[#81992](https://github.com/ClickHouse/ClickHouse/pull/81992) ([Amos Bird](https://github.com/amosbird))。
- 根据 listen_backlog(默认 4096)调整 TCP 服务器队列(默认 64)。[#82045](https://github.com/ClickHouse/ClickHouse/pull/82045) ([Azat Khuzhin](https://github.com/azat))。
- 新增无需重启服务器即可动态重新加载 `max_local_read_bandwidth_for_server` 和 `max_local_write_bandwidth_for_server` 的功能。[#82083](https://github.com/ClickHouse/ClickHouse/pull/82083) ([Kai Zhu](https://github.com/nauu))。
- 引入设置 `enable_vector_similarity_index`,必须启用该设置才能使用向量相似度索引。现有设置 `allow_experimental_vector_similarity_index` 现已废弃,但如有需要仍可使用。[#83459](https://github.com/ClickHouse/ClickHouse/pull/83459) ([Robert Schulze](https://github.com/rschu1ze))。
- 除 `max_joined_block_size_rows` 外,新增 [`max_joined_block_size_bytes`](/operations/settings/settings#max_joined_block_size_bytes) 来限制包含大型列的 JOIN 操作的内存使用。[#83869](https://github.com/ClickHouse/ClickHouse/pull/83869) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- 修复 cluster_function_process_archive_on_multiple_nodes 的兼容性问题。[#83968](https://github.com/ClickHouse/ClickHouse/pull/83968) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 默认启用关联子查询支持。[#85107](https://github.com/ClickHouse/ClickHouse/pull/85107) ([Dmitry Novik](https://github.com/novikd))。
- 新增 `database_replicated` 设置,用于定义 DatabaseReplicatedSettings 的默认值。如果在 Replicated DB 创建查询中未指定该设置,则使用此默认值。[#85127](https://github.com/ClickHouse/ClickHouse/pull/85127) ([Tuan Pham Anh](https://github.com/tuanpach))。
- 允许在 `s3` 或 `s3Cluster` 表引擎/函数中使用键值参数,例如 `s3('url', CSV, structure = 'a Int32', compression_method = 'gzip')`。[#85134](https://github.com/ClickHouse/ClickHouse/pull/85134) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 将非关联的 `EXISTS` 作为标量子查询执行。这允许使用标量子查询缓存并对结果进行常量折叠,有助于索引优化。为保持兼容性,新增设置 `execute_exists_as_scalar_subquery=1`。[#85481](https://github.com/ClickHouse/ClickHouse/pull/85481) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- 支持更多复合标识符的解析场景。特别是改进了 `ARRAY JOIN` 与旧分析器的兼容性。引入新设置 `analyzer_compatibility_allow_compound_identifiers_in_unflatten_nested` 以保持旧行为。[#85492](https://github.com/ClickHouse/ClickHouse/pull/85492) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。

### 系统表和可观测性 {#system-tables-and-observability}


- 向 ClickHouse 异步指标添加压力指标。[#80779](https://github.com/ClickHouse/ClickHouse/pull/80779) ([Xander Garbett](https://github.com/Garbett1))。
- 添加指标 `MarkCacheEvictedBytes`、`MarkCacheEvictedMarks`、`MarkCacheEvictedFiles` 用于跟踪标记缓存的驱逐情况。(issue [#60989](https://github.com/ClickHouse/ClickHouse/issues/60989))。[#80799](https://github.com/ClickHouse/ClickHouse/pull/80799) ([Shivji Kumar Jha](https://github.com/shiv4289))。
- `system.formats` 表现在包含格式的扩展信息,例如 HTTP 内容类型、模式推断能力等。[#81505](https://github.com/ClickHouse/ClickHouse/pull/81505) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 添加支持使用 `TRUNCATE TABLE system.warnings` 清除 `system.warnings` 表中的所有警告。[#82087](https://github.com/ClickHouse/ClickHouse/pull/82087) ([Vladimir Cherkasov](https://github.com/vdimir))。
- 在 `system.licenses` 中列出 Rust crate 的许可证。[#82440](https://github.com/ClickHouse/ClickHouse/pull/82440) ([Raúl Marín](https://github.com/Algunenano))。
- 通过统计信息估算复杂的 CNF/DNF 表达式,例如 `(a < 1 and a > 0) or b = 3`。[#82663](https://github.com/ClickHouse/ClickHouse/pull/82663) ([Han Fei](https://github.com/hanfei1991))。
- 在某些情况下,我们需要为指标提供多个维度。例如,按错误代码统计失败的合并或变更操作,而不是使用单一计数器。[#83030](https://github.com/ClickHouse/ClickHouse/pull/83030) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
- 为 `MergeParts` 条目的 part_log 性能事件添加进程资源指标(例如 `UserTimeMicroseconds`、`SystemTimeMicroseconds`、`RealTimeMicroseconds`)。[#83460](https://github.com/ClickHouse/ClickHouse/pull/83460) ([Vladimir Cherkasov](https://github.com/vdimir))。
- 现在同时报告 Cgroup 级别和系统级别的指标。Cgroup 级别的指标名称为 `CGroup<Metric>`,操作系统级别的指标(从 procfs 收集)名称为 `OS<Metric>`。[#84317](https://github.com/ClickHouse/ClickHouse/pull/84317) ([Nikita Taranov](https://github.com/nickitat))。
- 添加维度指标以监控并发有界队列的大小,按队列类型和实例 ID 标记以提高可观测性。[#84675](https://github.com/ClickHouse/ClickHouse/pull/84675) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
- [`system.columns`](/operations/system-tables/columns) 表现在提供 `column` 作为现有 `name` 列的别名。[#84695](https://github.com/ClickHouse/ClickHouse/pull/84695) ([Yunchi Pang](https://github.com/yunchipang))。
- 向 `system.errors` 添加格式字符串列。此列用于在告警规则中按相同错误类型进行分组。[#84776](https://github.com/ClickHouse/ClickHouse/pull/84776) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
- 使 Async Log 的限制可调整并添加内省功能。[#85105](https://github.com/ClickHouse/ClickHouse/pull/85105) ([Raúl Marín](https://github.com/Algunenano))。
- 在获取 system.columns 的表列大小时忽略 `UNKNOWN_DATABASE`。[#85632](https://github.com/ClickHouse/ClickHouse/pull/85632) ([Azat Khuzhin](https://github.com/azat))。

### 数据库引擎 {#database-engines}

### 系统和内部改进 {#system-and-internal-improvements}


- 修复通过手动将表 UUID 添加到 DatabaseCatalog 来附加具有只读远程磁盘的数据库。[#82670](https://github.com/ClickHouse/ClickHouse/pull/82670) ([Tuan Pham Anh](https://github.com/tuanpach))。
- 改进 `distributed_ddl_output_mode='*_only_active'` 时的 DDL 任务处理,不再等待复制延迟超过 `max_replication_lag_to_enqueue` 的新副本或已恢复副本。这有助于避免当新副本在初始化或恢复后变为活动状态但累积了大量复制日志时出现 `DDL task is not finished on some hosts` 错误。同时实现了 `SYSTEM SYNC DATABASE REPLICA STRICT` 查询,该查询会等待复制日志降至 `max_replication_lag_to_enqueue` 以下。[#83302](https://github.com/ClickHouse/ClickHouse/pull/83302) ([Alexander Tokmakov](https://github.com/tavplubix))。
- 更改 SystemLogs 关闭顺序,使其在普通表之后执行(在系统表之前,而不是在普通表之前)。[#83134](https://github.com/ClickHouse/ClickHouse/pull/83134) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 为复制数据库设置添加服务器设置 `logs_to_keep`,允许配置复制数据库的默认 `logs_to_keep` 参数。较低的值可减少 ZooKeeper 节点数量(在有多个数据库时尤其有益),而较高的值允许缺失的副本在较长停机时间后追赶进度。[#84183](https://github.com/ClickHouse/ClickHouse/pull/84183) ([Alexey Khatskevich](https://github.com/Khatskevich))。
- 将复制数据库设置 `max_retries_before_automatic_recovery` 的默认值更改为 10,在某些情况下可实现更快的恢复。[#84369](https://github.com/ClickHouse/ClickHouse/pull/84369) ([Alexander Tokmakov](https://github.com/tavplubix))。
- 通过跳过旧临时表的创建和重命名,优化复制数据库中非追加式可刷新物化视图的 DDL 操作。[#84858](https://github.com/ClickHouse/ClickHouse/pull/84858) ([Tuan Pham Anh](https://github.com/tuanpach))。

### 复制与同步 {#replication-and-synchronization}

### 系统与内部改进 {#systemandinternalimprovements}

- 改进 `SYSTEM RESTART REPLICA`,在发生 ZooKeeper 连接问题时重试表创建,防止表被遗忘。[#82616](https://github.com/ClickHouse/ClickHouse/pull/82616) ([Nikolay Degterinsky](https://github.com/evillique))。
- 在 `ReplicatedMergeTree::executeMetadataAlter` 中添加 UUID 验证,以防止在获取 StorageID 和调用 `IDatabase::alterTable` 之间交换表时出现错误的表定义。[#82666](https://github.com/ClickHouse/ClickHouse/pull/82666) ([Nikolay Degterinsky](https://github.com/evillique))。
- 移除与实验性零拷贝复制相关的实验性 `send_metadata` 逻辑。此代码从未使用过,不受支持,且可能已损坏,没有测试来验证其功能。[#82508](https://github.com/ClickHouse/ClickHouse/pull/82508) ([alesapin](https://github.com/alesapin))。
- 在 `remote_fs_zero_copy_zookeeper_path` 中添加对宏展开的支持。[#85437](https://github.com/ClickHouse/ClickHouse/pull/85437) ([Mikhail Koviazin](https://github.com/mkmkme))。

### 函数与表达式 {#functions-and-expressions}


* 函数 `addressToSymbol` 和 `system.symbols` 表将使用文件偏移量而不是虚拟内存地址。[#81896](https://github.com/ClickHouse/ClickHouse/pull/81896)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在为命名元组推导超类型时，尽量保留元素名称。[#81345](https://github.com/ClickHouse/ClickHouse/pull/81345) ([lgbo](https://github.com/lgbo-ustc))。
* 允许在不同窗口中对同一列混用不同的排序规则。 [#82877](https://github.com/ClickHouse/ClickHouse/pull/82877) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 添加函数，用于将类型写入 WKB 格式。[#82935](https://github.com/ClickHouse/ClickHouse/pull/82935) ([scanhex12](https://github.com/scanhex12))。
* 新增支持将 `Time` 和 `Time64` 解析为 MM:SS、M:SS、SS 或 S 格式。[#83299](https://github.com/ClickHouse/ClickHouse/pull/83299)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 函数 `reinterpret()` 现在支持转换为 `Array(T)`，其中 `T` 是固定大小的数据类型（issue [#82621](https://github.com/ClickHouse/ClickHouse/issues/82621)）。[#83399](https://github.com/ClickHouse/ClickHouse/pull/83399)（[Shankar Iyer](https://github.com/shankar-iyer)）。
* 修复 `structureToProtobufSchema` 和 `structureToCapnProtoSchema` 函数，使其正确添加以零结尾的字节而不是使用换行符，从而防止输出中缺失换行符，并避免在依赖该零结尾字节的函数（例如 `logTrace`、`demangle`、`extractURLParameter`、`toStringCutToZero` 和 `encrypt`/`decrypt`）中出现潜在的缓冲区溢出。修复 [#85062](https://github.com/ClickHouse/ClickHouse/issues/85062)。[#85063](https://github.com/ClickHouse/ClickHouse/pull/85063)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复 `regexp_tree` 字典布局，以支持处理包含空字节的字符串。[#85063](https://github.com/ClickHouse/ClickHouse/pull/85063)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复 `formatRowNoNewline` 函数：当使用 `Values` 格式或任意行末不带换行符的格式调用该函数时，会导致输出的最后一个字符被错误截断。[#85063](https://github.com/ClickHouse/ClickHouse/pull/85063)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复 `stem` 函数中的异常安全性错误，该错误在极少数情况下可能导致内存泄漏。[#85063](https://github.com/ClickHouse/ClickHouse/pull/85063)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复 `FixedString` 参数的 `initcap` 函数，使其在同一数据块中，当前一个字符串以单词字符结尾时，也能在下一个字符串的开头正确识别单词起始位置。 [#85063](https://github.com/ClickHouse/ClickHouse/pull/85063) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 修复 Apache `ORC` 格式中的一个安全漏洞，该漏洞可能导致未初始化内存泄露。[#85063](https://github.com/ClickHouse/ClickHouse/pull/85063) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 更改了 `replaceRegexpAll` 及其别名 `REGEXP_REPLACE` 的行为：即使前一个匹配已经覆盖了整个字符串，现在也允许在字符串末尾出现空匹配（例如 `^a*|a*$` 或 `^|.*`），使其语义与 JavaScript、Perl、Python、PHP 和 Ruby 保持一致，但与 PostgreSQL 不同。 [#85063](https://github.com/ClickHouse/ClickHouse/pull/85063) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 优化并简化了许多字符串处理函数的实现。修正了多个函数的错误文档。注意：对于 `String` 列以及包含 `String` 列的复杂类型，`byteSize` 的输出已从每个空字符串 9 字节调整为每个空字符串 8 字节，这是符合预期的行为。[#85063](https://github.com/ClickHouse/ClickHouse/pull/85063)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在函数 `timeSeries*ToGrid()` 中允许步长为零。这是 [https://github.com/ClickHouse/ClickHouse/pull/75036](https://github.com/ClickHouse/ClickHouse/pull/75036) 的第 3 部分。[#85390](https://github.com/ClickHouse/ClickHouse/pull/85390)（[Vitaly Baranov](https://github.com/vitlibar)）。
* 为函数 `nested` 增加对内部数组的支持。 [#85719](https://github.com/ClickHouse/ClickHouse/pull/85719) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).

### MergeTree 改进 {#mergetree-improvements}

- 更精细地禁用依赖于即时更新或补丁部分更新的列的跳数索引。现在,跳数索引仅在受即时变更或补丁部分影响的部分中不被使用;以前,这些索引在所有部分中都被禁用。[#84241](https://github.com/ClickHouse/ClickHouse/pull/84241) ([Anton Popov](https://github.com/CurtizJ))。
- 添加 MergeTree 设置 `search_orphaned_parts_drives` 以限制查找部分的范围,例如通过具有本地元数据的磁盘。[#84710](https://github.com/ClickHouse/ClickHouse/pull/84710) ([Ilya Golshtein](https://github.com/ilejn))。
- 为 `WHERE` 添加缺失的 `read_in_order_use_virtual_row` 支持。这允许对于过滤器未完全下推到 `PREWHERE` 的查询跳过读取更多部分。[#84835](https://github.com/ClickHouse/ClickHouse/pull/84835) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- 修复 MergeTree 中"紧凑"Variant 判别器序列化的使用。以前在某些可以使用的情况下未被使用。[#84141](https://github.com/ClickHouse/ClickHouse/pull/84141) ([Pavel Kruglov](https://github.com/Avogar))。
- 为补丁部分中的总未压缩字节数添加限制(表设置 [`max_uncompressed_bytes_in_patches`](/operations/settings/merge-tree-settings#max_uncompressed_bytes_in_patches))。这可以防止轻量级更新后 `SELECT` 查询显著变慢,并防止可能滥用轻量级更新。[#85641](https://github.com/ClickHouse/ClickHouse/pull/85641) ([Anton Popov](https://github.com/CurtizJ))。

### 缓存和内存管理 {#cache-and-memory-management}

- 修复文件系统缓存中的逻辑错误:"拥有零字节但范围未完成"。[#81868](https://github.com/ClickHouse/ClickHouse/pull/81868) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 添加会合哈希以改善缓存局部性。[#82511](https://github.com/ClickHouse/ClickHouse/pull/82511) ([Anton Ivashkin](https://github.com/ianton-ru))。
- 重构文件系统缓存的动态调整大小功能。添加了更多用于内省的日志。[#82556](https://github.com/ClickHouse/ClickHouse/pull/82556) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 减少可执行用户定义函数的查询内存跟踪开销。[#83929](https://github.com/ClickHouse/ClickHouse/pull/83929) ([Eduard Karacharov](https://github.com/korowa))。
- 外部库完成的所有分配现在对 ClickHouse 的内存跟踪器可见并被正确计入。这可能导致某些查询报告的内存使用量"增加"或出现 `MEMORY_LIMIT_EXCEEDED` 失败。[#84082](https://github.com/ClickHouse/ClickHouse/pull/84082) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- 为加密命名集合的 encrypted_buffer 分配所需的最小内存量。[#84432](https://github.com/ClickHouse/ClickHouse/pull/84432) ([Pablo Marcos](https://github.com/pamarcos))。

### 向量相似度索引 {#vector-similarity-index}

- 防止用户在 `NumericIndexedVector` 中使用 `nan` 和 `inf`。修复 [#82239](https://github.com/ClickHouse/ClickHouse/issues/82239) 及更多问题。[#82681](https://github.com/ClickHouse/ClickHouse/pull/82681) ([Raufs Dunamalijevs](https://github.com/rienath))。
- 向量相似度索引现在支持二进制量化。二进制量化显著减少内存消耗并加快构建向量索引的过程(由于更快的距离计算)。此外,现有设置 `vector_search_postfilter_multiplier` 已被弃用并由更通用的设置 `vector_search_index_fetch_multiplier` 替代。[#85024](https://github.com/ClickHouse/ClickHouse/pull/85024) ([Shankar Iyer](https://github.com/shankar-iyer))。
- 使用向量相似度索引的近似向量搜索现已正式发布。[#85888](https://github.com/ClickHouse/ClickHouse/pull/85888) ([Robert Schulze](https://github.com/rschu1ze))。


### 错误处理和消息 {#error-handling-and-messages}

- Connection 头部在所有头部末尾发送。当我们确定连接应该保持时。[#81951](https://github.com/ClickHouse/ClickHouse/pull/81951) ([Sema Checherinda](https://github.com/CheSema))。
- 在之前的版本中,聚合函数状态与 IPv4 相乘会产生逻辑错误而非正确的错误代码。关闭 [#82817](https://github.com/ClickHouse/ClickHouse/issues/82817)。[#82818](https://github.com/ClickHouse/ClickHouse/pull/82818) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 改进了 `AsynchronousMetrics` 中的错误处理。如果 `/sys/block` 目录存在但无法访问,服务器将在不监控块设备的情况下启动。关闭 [#79229](https://github.com/ClickHouse/ClickHouse/issues/79229)。[#83115](https://github.com/ClickHouse/ClickHouse/pull/83115) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 对于包含格式错误的 select 语句的物化视图,`INSERT` 的依赖检查存在错误,用户可能会收到晦涩的 `std::exception` 而非带有清晰解释的有意义错误。现已修复。修复了:[#82889](https://github.com/ClickHouse/ClickHouse/issues/82889)。[#83190](https://github.com/ClickHouse/ClickHouse/pull/83190) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- 不在异常消息中输出过长的表达式操作描述。关闭 [#83164](https://github.com/ClickHouse/ClickHouse/issues/83164)。[#83350](https://github.com/ClickHouse/ClickHouse/pull/83350) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 当存储正在关闭时,`getStatus` 会抛出 `ErrorCodes::ABORTED` 异常。以前,这会导致 select 查询失败。现在我们捕获 `ErrorCodes::ABORTED` 异常并有意忽略它们。[#83435](https://github.com/ClickHouse/ClickHouse/pull/83435) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
- 使加载和添加投影时某些情况下的异常消息更易于阅读。[#83728](https://github.com/ClickHouse/ClickHouse/pull/83728) ([Robert Schulze](https://github.com/rschu1ze))。
- 在检查 EOF 之前检查连接是否已取消,以防止从已关闭的连接读取。修复 [#83893](https://github.com/ClickHouse/ClickHouse/issues/83893)。[#84227](https://github.com/ClickHouse/ClickHouse/pull/84227) ([Raufs Dunamalijevs](https://github.com/rienath))。
- 通过简化内部检查,改进了客户端连接的服务器关闭处理。[#84312](https://github.com/ClickHouse/ClickHouse/pull/84312) ([Raufs Dunamalijevs](https://github.com/rienath))。
- UDF 执行期间的低级错误现在会返回错误代码 `UDF_EXECUTION_FAILED`,而以前可能返回不同的错误代码。[#84547](https://github.com/ClickHouse/ClickHouse/pull/84547) ([Xu Jia](https://github.com/XuJia0210))。

### SQL 格式化改进 {#sql-formatting-improvements}


- 修复 `CREATE DICTIONARY` 格式不一致问题。关闭 [#82105](https://github.com/ClickHouse/ClickHouse/issues/82105)。[#82829](https://github.com/ClickHouse/ClickHouse/pull/82829) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 修复包含 `materialize` 函数时 `TTL` 格式不一致问题。关闭 [#82828](https://github.com/ClickHouse/ClickHouse/issues/82828)。[#82831](https://github.com/ClickHouse/ClickHouse/pull/82831) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 修复子查询中包含输出选项(如 INTO OUTFILE)时 `EXPLAIN AST` 格式不一致问题。关闭 [#82826](https://github.com/ClickHouse/ClickHouse/issues/82826)。[#82840](https://github.com/ClickHouse/ClickHouse/pull/82840) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 修复在不允许使用别名的上下文中,带别名的括号表达式格式不一致问题。关闭 [#82836](https://github.com/ClickHouse/ClickHouse/issues/82836)。关闭 [#82837](https://github.com/ClickHouse/ClickHouse/issues/82837)。[#82867](https://github.com/ClickHouse/ClickHouse/pull/82867) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 修复带查询参数的 CREATE USER 格式问题(例如 `CREATE USER {username:Identifier} IDENTIFIED WITH no_password`)。[#84376](https://github.com/ClickHouse/ClickHouse/pull/84376) ([Azat Khuzhin](https://github.com/azat))。
- 修复 CREATE DICTIONARY 查询中带参数的列(例如 Decimal(8))后尾随逗号的解析问题。关闭 [#85586](https://github.com/ClickHouse/ClickHouse/issues/85586)。[#85653](https://github.com/ClickHouse/ClickHouse/pull/85653) ([Nikolay Degterinsky](https://github.com/evillique))。

### 外部集成 {#external-integrations}

- 统一使用命名集合时 ODBC 和 JDBC 的参数名称。[#83410](https://github.com/ClickHouse/ClickHouse/pull/83410) ([Andrey Zvonov](https://github.com/zvonand))。
- MongoDB:隐式解析字符串为数值类型。以前,如果从 MongoDB 源接收到字符串值用于 ClickHouse 表的数值列,会抛出异常。现在,引擎会自动尝试从字符串中解析数值。关闭 [#81167](https://github.com/ClickHouse/ClickHouse/issues/81167)。[#84069](https://github.com/ClickHouse/ClickHouse/pull/84069) ([Kirill Nikiforov](https://github.com/allmazz))。
- 允许在不支持的架构上使用 `simdjson`(以前会导致 `CANNOT_ALLOCATE_MEMORY` 错误)。[#84966](https://github.com/ClickHouse/ClickHouse/pull/84966) ([Azat Khuzhin](https://github.com/azat))。

### 其他改进 {#miscellaneous-improvements}


- 添加 Ytsaurus 表引擎和表函数。[#77606](https://github.com/ClickHouse/ClickHouse/pull/77606) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。
- 改进 HashJoin::needUsedFlagsForPerRightTableRow,对交叉连接返回 false。[#82379](https://github.com/ClickHouse/ClickHouse/pull/82379) ([lgbo](https://github.com/lgbo-ustc))。
- 允许将 map 列作为元组数组进行读写。[#82408](https://github.com/ClickHouse/ClickHouse/pull/82408) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。
- 此 PR 已被回滚。[#82884](https://github.com/ClickHouse/ClickHouse/pull/82884) ([Mithun p](https://github.com/mithunputhusseri))。
- 异步日志:限制队列中保存的最大条目数。[#83214](https://github.com/ClickHouse/ClickHouse/pull/83214) ([Raúl Marín](https://github.com/Algunenano))。
- 在 JSON 输入格式中启用将 Date/Date32 作为整数处理。[#83597](https://github.com/ClickHouse/ClickHouse/pull/83597) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。
- 改进了布隆过滤器索引(常规、ngram 和 token)的支持,当第一个参数是常量数组(集合)且第二个参数是索引列(子集)时可以利用索引,从而实现更高效的查询执行。[#84700](https://github.com/ClickHouse/ClickHouse/pull/84700) ([Doron David](https://github.com/dorki))。
- 允许在将 `IN` / `GLOBAL IN` 过滤器下推到 KeyValue 存储主键(例如 EmbeddedRocksDB、KeeperMap)时进行集合值类型转换。[#84515](https://github.com/ClickHouse/ClickHouse/pull/84515) ([Eduard Karacharov](https://github.com/korowa))。
- 消除了当索引分析导致并行副本读取的范围为空时的全表扫描。[#84971](https://github.com/ClickHouse/ClickHouse/pull/84971) ([Eduard Karacharov](https://github.com/korowa))。
- 修复了在本地主机上运行集成测试时可能出现的一系列问题。[#82135](https://github.com/ClickHouse/ClickHouse/pull/82135) ([Oleg Doronin](https://github.com/dorooleg))。
- 默认为旧部署启用 trace_log.symbolize。[#85456](https://github.com/ClickHouse/ClickHouse/pull/85456) ([Azat Khuzhin](https://github.com/azat))。

#### Bug 修复(官方稳定版本中用户可见的错误行为) {#bug-fixes}

### 性能优化 {#performance-optimizations}

- 修复 SummingMergeTree 中在 25.5 版本 https://github.com/ClickHouse/ClickHouse/pull/79051 引入的性能下降问题。[#82130](https://github.com/ClickHouse/ClickHouse/pull/82130) ([Pavel Kruglov](https://github.com/Avogar))。
- 修复启用分析器时次级查询总是从 VIEW 读取所有列导致的性能下降问题。修复 [#81718](https://github.com/ClickHouse/ClickHouse/issues/81718)。[#83036](https://github.com/ClickHouse/ClickHouse/pull/83036) ([Dmitry Novik](https://github.com/novikd))。
- 对于没有依赖关系的创建表操作不检查循环依赖。这修复了在 https://github.com/ClickHouse/ClickHouse/pull/65405 中引入的创建数千个表的使用场景的性能下降问题。[#83077](https://github.com/ClickHouse/ClickHouse/pull/83077) ([Pavel Kruglov](https://github.com/Avogar))。
- 使 `DISTINCT` 窗口聚合以线性时间运行,并修复 `sumDistinct` 中的一个 bug。关闭 [#79792](https://github.com/ClickHouse/ClickHouse/issues/79792)。关闭 [#52253](https://github.com/ClickHouse/ClickHouse/issues/52253)。[#79859](https://github.com/ClickHouse/ClickHouse/pull/79859) ([Nihal Z. Miaji](https://github.com/nihalzp))。

### 查询执行修复 {#query-execution-fixes}


* 对于包含 `ORDER BY ... LIMIT BY ... LIMIT N` 组合的查询，当 `ORDER BY` 以 `PartialSorting` 的方式执行时，计数器 `rows_before_limit_at_least` 现在反映的是 `LIMIT` 子句实际消耗的行数，而不是排序变换阶段消耗的行数。[#78999](https://github.com/ClickHouse/ClickHouse/pull/78999) ([Eduard Karacharov](https://github.com/korowa)).
* 修复在使用 `<=>` 运算符与 Join 存储时的逻辑错误，现在查询会返回正确的错误码。[#80165](https://github.com/ClickHouse/ClickHouse/pull/80165) ([Vladimir Cherkasov](https://github.com/vdimir))。
* 修复在与 `remote` 函数族一起使用时 `loop` 函数发生崩溃的问题。确保在 `loop(remote(...))` 中正确遵守 LIMIT 子句。[#80299](https://github.com/ClickHouse/ClickHouse/pull/80299)（[Julia Kartseva](https://github.com/jkartseva)）。
* 修复 `to_utc_timestamp` 和 `from_utc_timestamp` 函数在处理 Unix 纪元开始之前的日期（1970-01-01）以及超过最大日期（2106-02-07 06:28:15）的日期时的错误行为。现在，这些函数会分别将值正确地截断到纪元开始和最大日期。 [#80498](https://github.com/ClickHouse/ClickHouse/pull/80498) ([Surya Kant Ranjan](https://github.com/iit2009046)).
* 修复在 `transform_null_in=1` 时，左侧参数为 null 且子查询结果为非可空时的 `IN` 执行问题。[#81584](https://github.com/ClickHouse/ClickHouse/pull/81584) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在处理标量关联子查询时未读取所需列的问题。修复了 [#81716](https://github.com/ClickHouse/ClickHouse/issues/81716)。[#81805](https://github.com/ClickHouse/ClickHouse/pull/81805)（[Dmitry Novik](https://github.com/novikd)）。
* 修复在查询中仅使用常量别名列时的过滤分析问题，解决了 [#79448](https://github.com/ClickHouse/ClickHouse/issues/79448)。[#82037](https://github.com/ClickHouse/ClickHouse/pull/82037)（[Dmitry Novik](https://github.com/novikd)）。
* 修复在包含 `WHERE` 条件和 `IndexSet`，且使用了 `arrayJoin` 的查询中出现的 `Not found column` 错误。 [#82113](https://github.com/ClickHouse/ClickHouse/pull/82113) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* 修复在 CTE 定义中引用另一个同名表表达式时抛出的 `TOO_DEEP_SUBQUERIES` 异常。[#83413](https://github.com/ClickHouse/ClickHouse/pull/83413) ([Dmitry Novik](https://github.com/novikd))。
* 修复在启用查询条件缓存（设置 `use_query_condition_cache`）时，包含 `WHERE ... IN (<subquery>)` 子句的查询返回结果不正确的问题。[#83445](https://github.com/ClickHouse/ClickHouse/pull/83445) ([LB7666](https://github.com/acking-you)).
* 在某些极端情况下，包含 `UNION ALL` 的 `INSERT SELECT` 可能导致空指针解引用。此更改修复了 [#83618](https://github.com/ClickHouse/ClickHouse/issues/83618)。[#83643](https://github.com/ClickHouse/ClickHouse/pull/83643)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复在分析相关列的行策略表达式时出现的 `LOGICAL_ERROR`。[#82618](https://github.com/ClickHouse/ClickHouse/pull/82618)（[Dmitry Novik](https://github.com/novikd)）。
* 修复了在查询条件缓存与递归 CTE 联合使用时产生错误结果的问题（问题 [#81506](https://github.com/ClickHouse/ClickHouse/issues/81506)）。[#84026](https://github.com/ClickHouse/ClickHouse/pull/84026)（[zhongyuankai](https://github.com/zhongyuankai)）。
* 修复对无效 `WINDOW` 定义进行无限递归分析的问题。修复 [#83131](https://github.com/ClickHouse/ClickHouse/issues/83131)。[#84242](https://github.com/ClickHouse/ClickHouse/pull/84242)（[Dmitry Novik](https://github.com/novikd)）。
* 修复在 `additional_table_filters expression` 设置中使用 `IN (subquery)` 时的 `Not-ready Set` 问题。[#85210](https://github.com/ClickHouse/ClickHouse/pull/85210) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* 修复在启用 `optimize_syntax_fuse_functions` 时出现的重复子查询逻辑错误，关闭 [#75511](https://github.com/ClickHouse/ClickHouse/issues/75511)。[#83300](https://github.com/ClickHouse/ClickHouse/pull/83300)（[Vladimir Cherkasov](https://github.com/vdimir)）。

### Iceberg 和 DataLake 修复 {#iceberg-and-datalake-fixes}

- 修复通过 REST catalog 查询 Iceberg 表时的元数据解析问题。... [#80562](https://github.com/ClickHouse/ClickHouse/pull/80562) ([Saurabh Kumar Ojha](https://github.com/saurabhojha)).
- 修复 Iceberg 中的数据竞争问题。 [#82088](https://github.com/ClickHouse/ClickHouse/pull/82088) ([Azat Khuzhin](https://github.com/azat)).
- 修复 Iceberg 的 "Context has expired" 错误。 [#82146](https://github.com/ClickHouse/ClickHouse/pull/82146) ([Azat Khuzhin](https://github.com/azat)).
- 现在 ClickHouse 可以在 schema 演化后从 Glue catalog 读取 Iceberg 表。修复了 [#81272](https://github.com/ClickHouse/ClickHouse/issues/81272). [#82301](https://github.com/ClickHouse/ClickHouse/pull/82301) ([alesapin](https://github.com/alesapin)).
- 修复 Iceberg 中的数据竞争问题。 [#82841](https://github.com/ClickHouse/ClickHouse/pull/82841) ([Azat Khuzhin](https://github.com/azat)).
- 禁用 Iceberg 数组元素和 Iceberg map 值的基于边界的文件裁剪,包括所有嵌套子字段。 [#83520](https://github.com/ClickHouse/ClickHouse/pull/83520) ([Daniil Ivanik](https://github.com/divanik)).
- 修复复杂类型的 Iceberg 写入问题。 [#85330](https://github.com/ClickHouse/ClickHouse/pull/85330) ([scanhex12](https://github.com/scanhex12)).
- 复杂类型不支持写入上下界。 [#85332](https://github.com/ClickHouse/ClickHouse/pull/85332) ([scanhex12](https://github.com/scanhex12)).
- 修复 Iceberg 中字段的可空性问题。 [#85977](https://github.com/ClickHouse/ClickHouse/pull/85977) ([scanhex12](https://github.com/scanhex12)).
- 不再创建空的 Iceberg 删除文件。 [#86061](https://github.com/ClickHouse/ClickHouse/pull/86061) ([scanhex12](https://github.com/scanhex12)).
- 更新 Iceberg 写入中的元数据时间戳。 [#85711](https://github.com/ClickHouse/ClickHouse/pull/85711) ([scanhex12](https://github.com/scanhex12)).
- 修复 Spark 无法读取位置删除文件的问题。 [#85762](https://github.com/ClickHouse/ClickHouse/pull/85762) ([scanhex12](https://github.com/scanhex12)).
- 停止从 manifest 文件中获取 schema,改为为每个 snapshot 独立存储相关 schema。从对应的 snapshot 推断每个数据文件的相关 schema。之前的行为违反了 Iceberg 规范中关于具有现有状态的 manifest 文件条目的规定。 [#84588](https://github.com/ClickHouse/ClickHouse/pull/84588) ([Daniil Ivanik](https://github.com/divanik)).
- 现在 Iceberg 不再尝试在 SELECT 查询之间缓存相关 snapshot 版本,而是始终正确解析 snapshot。早期尝试缓存 Iceberg snapshot 导致了使用 Iceberg 表进行时间旅行时的问题。 [#85038](https://github.com/ClickHouse/ClickHouse/pull/85038) ([Daniil Ivanik](https://github.com/divanik)).
- 修复通过 REST catalog 查询 Iceberg 表时的元数据解析问题。... [#85531](https://github.com/ClickHouse/ClickHouse/pull/85531) ([Saurabh Kumar Ojha](https://github.com/saurabhojha)).
- 修复 icebergS3Cluster 和 icebergAzureCluster 表函数中的密钥掩码问题。 [#85658](https://github.com/ClickHouse/ClickHouse/pull/85658) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).

### DeltaLake 修复 {#deltalake-fixes}


- 修复 `DeltaLake` 存储引擎中 delta-kernel 的列裁剪问题。关闭 [#84543](https://github.com/ClickHouse/ClickHouse/issues/84543)。[#84745](https://github.com/ClickHouse/ClickHouse/pull/84745) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 刷新 DeltaLake 存储引擎中 delta-kernel 的凭证。[#84751](https://github.com/ClickHouse/ClickHouse/pull/84751) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 修复 delta-kernel 实现中的段错误。[#85160](https://github.com/ClickHouse/ClickHouse/pull/85160) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 修复 `DeltaLake` 引擎 delta-kernel 实现中的竞态条件。[#85221](https://github.com/ClickHouse/ClickHouse/pull/85221) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 修复 `DeltaLake` 引擎在禁用 delta-kernel 时读取分区数据的问题。该问题在 25.7 版本中引入 (https://github.com/ClickHouse/ClickHouse/pull/81136)。[#85223](https://github.com/ClickHouse/ClickHouse/pull/85223) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 为保持兼容性,将 25.5 版本之前的 `allow_experimental_delta_kernel_rs` 值更改为 `false`。[#84587](https://github.com/ClickHouse/ClickHouse/pull/84587) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 修复从缓存中读取 delta lake 行数的问题。[#85704](https://github.com/ClickHouse/ClickHouse/pull/85704) ([Kseniia Sumarokova](https://github.com/kssenii))。

### TTL 和 MergeTree 修复 {#ttl-and-mergetree-fixes}

- 当 TTL 删除行时重新计算 min-max 索引,以确保依赖该索引的算法(如 `minmax_count_projection`)的正确性。此修复解决了 [#77091](https://github.com/ClickHouse/ClickHouse/issues/77091)。[#77166](https://github.com/ClickHouse/ClickHouse/pull/77166) ([Amos Bird](https://github.com/amosbird))。
- 修复更新 TTL 时 TTL GROUP BY 中不正确的 TTL 重新计算问题。[#81222](https://github.com/ClickHouse/ClickHouse/pull/81222) ([Evgeniy Ulasik](https://github.com/H0uston))。
- 修复在 TTL 表达式中使用字典时合并过程中出现的 "Context has expired" 错误。[#81690](https://github.com/ClickHouse/ClickHouse/pull/81690) ([Azat Khuzhin](https://github.com/azat))。
- 修复在 TTL 的 GROUP BY 和 SET 中使用相同列时导致的 LOGICAL_ERROR 及后续崩溃问题。[#82054](https://github.com/ClickHouse/ClickHouse/pull/82054) ([Pablo Marcos](https://github.com/pamarcos))。
- 当表中所有 TTL 被移除后,MergeTree 现在不再执行任何与 TTL 相关的操作。[#84441](https://github.com/ClickHouse/ClickHouse/pull/84441) ([alesapin](https://github.com/alesapin))。
- 修复 `ALTER MODIFY ORDER BY` 未验证排序键中 TTL 列的问题。现在在 `ALTER` 操作期间,在 `ORDER BY` 子句中使用 TTL 列时会被正确拒绝,从而防止潜在的表损坏。[#84536](https://github.com/ClickHouse/ClickHouse/pull/84536) ([xiaohuanlin](https://github.com/xiaohuanlin))。

### 投影修复 {#projection-fixes}


- 修复列类型更改为 Nullable 时物化投影过程中的逻辑错误。[#80741](https://github.com/ClickHouse/ClickHouse/pull/80741) ([Pavel Kruglov](https://github.com/Avogar))。
- 修复当 `enable_shared_storage_snapshot_in_query = 1` 时 `mergeTreeProjection` 表函数中父元数据使用不当的问题。此修复针对 [#82634](https://github.com/ClickHouse/ClickHouse/issues/82634)。[#82638](https://github.com/ClickHouse/ClickHouse/pull/82638) ([Amos Bird](https://github.com/amosbird))。
- 修复当表包含投影、`lightweight_mutation_projection_mode = 'rebuild'` 且用户执行轻量级删除操作删除表中任意数据块的所有行时,偶发的 ClickHouse 崩溃问题。[#84158](https://github.com/ClickHouse/ClickHouse/pull/84158) ([alesapin](https://github.com/alesapin))。
- 修复包含损坏投影的数据分片的备份问题。[#85362](https://github.com/ClickHouse/ClickHouse/pull/85362) ([Antonio Andelic](https://github.com/antonio2368))。
- 在稳定之前,禁止在发布版本的投影中使用 `_part_offset` 列。[#85372](https://github.com/ClickHouse/ClickHouse/pull/85372) ([Sema Checherinda](https://github.com/CheSema))。

### 并行副本修复 {#parallel-replicas-fixes}

- 对于某些使用并行副本执行的查询,顺序读取优化可能在发起节点上应用但未在远程节点上应用。这导致并行副本协调器(在发起节点上)和远程节点使用不同的读取模式,这是一个逻辑错误。[#80652](https://github.com/ClickHouse/ClickHouse/pull/80652) ([Igor Nikonov](https://github.com/devcrafter))。
- 当子查询包含 `FINAL` 时禁用并行副本 [#81401](https://github.com/ClickHouse/ClickHouse/issues/81401)。[#83455](https://github.com/ClickHouse/ClickHouse/pull/83455) ([zoomxi](https://github.com/zoomxi))。
- 修复包含并行副本和多个 INNER 连接后跟 RIGHT 连接的查询的 `LOGICAL_ERROR`。对于此类查询不使用并行副本。[#84299](https://github.com/ClickHouse/ClickHouse/pull/84299) ([Vladimir Cherkasov](https://github.com/vdimir))。
- 使用并行副本且采用逆序读取优化的查询可能产生不正确的结果。[#85406](https://github.com/ClickHouse/ClickHouse/pull/85406) ([Igor Nikonov](https://github.com/devcrafter))。

### 身份验证和安全 {#authentication-and-security}


- 修复日志/query_log 中命名集合值隐藏的问题。关闭 [#82405](https://github.com/ClickHouse/ClickHouse/issues/82405)。[#82510](https://github.com/ClickHouse/ClickHouse/pull/82510) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 从 AST 解析 SCRAM_SHA256_PASSWORD 类型时为认证数据设置盐值。[#82888](https://github.com/ClickHouse/ClickHouse/pull/82888) ([Tuan Pham Anh](https://github.com/tuanpach))。
- 屏蔽 Avro schema registry 认证详细信息,使其对用户和日志不可见。[#83713](https://github.com/ClickHouse/ClickHouse/pull/83713) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
- 修复执行 `REVOKE S3 ON system.*` 时错误撤销 `*.*` 的 S3 权限的问题。此修复解决了 [#83417](https://github.com/ClickHouse/ClickHouse/issues/83417)。[#83420](https://github.com/ClickHouse/ClickHouse/pull/83420) ([pufit](https://github.com/pufit))。
- 修复当服务器设置 `allow_no_password` 更改为 0 后,使用 `no_password` 创建的用户尝试登录时导致服务器崩溃的问题。[#84426](https://github.com/ClickHouse/ClickHouse/pull/84426) ([Shankar Iyer](https://github.com/shankar-iyer))。
- 改进尝试创建使用 JWT 认证的用户时的错误消息。[#85072](https://github.com/ClickHouse/ClickHouse/pull/85072) ([Konstantin Bogdanov](https://github.com/thevar1able))。
- 屏蔽 `deltaLakeAzure`、`deltaLakeCluster`、`icebergS3Cluster` 和 `icebergAzureCluster` 的凭据。[#85889](https://github.com/ClickHouse/ClickHouse/pull/85889) ([Julian Maicher](https://github.com/jmaicher))。
- 修复 [#79963](https://github.com/ClickHouse/ClickHouse/pull/79963) 中引入的错误。向带有定义者的物化视图插入数据时,权限检查应使用定义者的授权。修复 [#79951](https://github.com/ClickHouse/ClickHouse/issues/79951)。[#83502](https://github.com/ClickHouse/ClickHouse/pull/83502) ([pufit](https://github.com/pufit))。

### 备份和恢复修复 {#backup-and-restore-fixes}

- 修复空 `Memory` 表的备份问题,该问题导致备份恢复失败并出现 `BACKUP_ENTRY_NOT_FOUND` 错误。[#82791](https://github.com/ClickHouse/ClickHouse/pull/82791) ([Julia Kartseva](https://github.com/jkartseva))。
- 修复在只读磁盘上恢复备份时的误导性错误消息。[#83051](https://github.com/ClickHouse/ClickHouse/pull/83051) ([Julia Kartseva](https://github.com/jkartseva))。
- 修复连接问题后启动多余内部备份的问题。[#84755](https://github.com/ClickHouse/ClickHouse/pull/84755) ([Vitaly Baranov](https://github.com/vitlibar))。

### 窗口函数和聚合函数 {#window-and-aggregate-functions}

- 修复合并期间发生异常时 `Aggregator` 可能崩溃的问题。[#81450](https://github.com/ClickHouse/ClickHouse/pull/81450) ([Nikita Taranov](https://github.com/nickitat))。
- 修复合并期间发生异常时 `Aggregator` 可能崩溃的问题。[#82022](https://github.com/ClickHouse/ClickHouse/pull/82022) ([Nikita Taranov](https://github.com/nickitat))。
- 修复 arraySimilarity 中的复制粘贴错误,禁止使用 UInt32 和 Int32 权重。更新测试和文档。[#82103](https://github.com/ClickHouse/ClickHouse/pull/82103) ([Mikhail f. Shiryaev](https://github.com/Felixoid))。
- 修复 `numericIndexedVectorPointwiseAdd`、`numericIndexedVectorPointwiseSubtract`、`numericIndexedVectorPointwiseMultiply`、`numericIndexedVectorPointwiseDivide` 函数应用于大数时发生的溢出问题。[#82165](https://github.com/ClickHouse/ClickHouse/pull/82165) ([Raufs Dunamalijevs](https://github.com/rienath))。

### Parquet 和文件格式修复 {#parquet-and-file-format-fixes}


- 修复 Parquet 布隆过滤器错误地将 `WHERE function(key) IN (...)` 条件当作 `WHERE key IN (...)` 应用的问题。[#81255](https://github.com/ClickHouse/ClickHouse/pull/81255) ([Michael Kolupaev](https://github.com/al13n321))。
- 修复 Parquet 写入器为 Decimal 类型输出错误统计信息(最小值/最大值)的问题。[#83754](https://github.com/ClickHouse/ClickHouse/pull/83754) ([Michael Kolupaev](https://github.com/al13n321))。
- 修复 `groupArraySample`/`groupArrayLast` 在空元素情况下的反序列化问题(当输入为空时,反序列化可能会跳过部分二进制数据,这可能导致数据读取损坏以及 TCP 协议中的 UNKNOWN_PACKET_FROM_SERVER 错误)。此问题不影响数值和日期时间类型。[#82763](https://github.com/ClickHouse/ClickHouse/pull/82763) ([Pedro Ferreira](https://github.com/PedroTadim))。
- 修复在 RowBinary 格式中写入包含 NULL 值的 JSON 路径的问题。[#83923](https://github.com/ClickHouse/ClickHouse/pull/83923) ([Pavel Kruglov](https://github.com/Avogar))。

### JOIN 修复 {#join-fixes}

- 修复对使用 `Merge` 存储引擎的表执行 JOIN 表达式查询时的过滤器修改问题。修复 [#82092](https://github.com/ClickHouse/ClickHouse/issues/82092)。[#82950](https://github.com/ClickHouse/ClickHouse/pull/82950) ([Dmitry Novik](https://github.com/novikd))。
- 修复键值存储使用类型转换后的键进行 JOIN 时的崩溃问题。[#82497](https://github.com/ClickHouse/ClickHouse/pull/82497) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。
- 修复在包含多个 JOIN 的查询中解析匹配器时的逻辑错误,关闭 [#81969](https://github.com/ClickHouse/ClickHouse/issues/81969)。[#82421](https://github.com/ClickHouse/ClickHouse/pull/82421) ([Vladimir Cherkasov](https://github.com/vdimir))。
- 修复当等式操作数类型不同或引用常量时,过滤器合并到 JOIN 条件中的问题。修复 [#83432](https://github.com/ClickHouse/ClickHouse/issues/83432)。[#84145](https://github.com/ClickHouse/ClickHouse/pull/84145) ([Dmitry Novik](https://github.com/novikd))。
- 修复在不等式条件上执行 JOIN 时,当其中一列为 `LowCardinality` 而另一列为常量时出现的逻辑错误 `Expected single dictionary argument for function`。关闭 [#81779](https://github.com/ClickHouse/ClickHouse/issues/81779)。[#84019](https://github.com/ClickHouse/ClickHouse/pull/84019) ([Alexey Milovidov](https://github.com/alexey-milovidov))。

### 复制数据库修复 {#replicated-database-fixes}


- 修复 DDLWorker 和 DatabaseReplicatedDDLWorker 中的 markReplicasActive。[#81395](https://github.com/ClickHouse/ClickHouse/pull/81395) ([Tuan Pham Anh](https://github.com/tuanpach))。
- 修复 `DatabaseReplicated::getClusterImpl`。如果 `hosts` 的第一个元素(或多个元素)的 `id == DROPPED_MARK` 且同一分片没有其他元素,则 `shards` 的第一个元素将是空向量,导致 `std::out_of_range` 异常。[#82093](https://github.com/ClickHouse/ClickHouse/pull/82093) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
- 跟踪异步表加载作业的数量。如果存在正在运行的作业,则不更新 `TransactionLog::removeOldEntries` 中的 `tail_ptr`。[#82824](https://github.com/ClickHouse/ClickHouse/pull/82824) ([Tuan Pham Anh](https://github.com/tuanpach))。
- 修复以下问题:如果使用 `add_minmax_index_for_numeric_columns=1` 或 `add_minmax_index_for_string_columns=1` 创建 MergeTree 表,索引随后在 ALTER 操作期间被物化,这会导致 Replicated 数据库在新副本上无法正确初始化。[#83751](https://github.com/ClickHouse/ClickHouse/pull/83751) ([Nikolay Degterinsky](https://github.com/evillique))。
- 修复当 DEFINER 被删除时,在 Replicated 数据库的新副本上创建 RMV 的问题。[#85327](https://github.com/ClickHouse/ClickHouse/pull/85327) ([Nikolay Degterinsky](https://github.com/evillique))。
- 修复当移动元数据文件耗时较长时恢复复制数据库的问题。[#85177](https://github.com/ClickHouse/ClickHouse/pull/85177) ([Tuan Pham Anh](https://github.com/tuanpach))。
- 在 Keeper 中恢复数据库元数据后强制恢复 Replicated 数据库。[#85960](https://github.com/ClickHouse/ClickHouse/pull/85960) ([Tuan Pham Anh](https://github.com/tuanpach))。
- 修复 `Replicated` 数据库恢复中的错误:如果表名包含 `%` 符号,在恢复期间可能会使用不同的名称重新创建表。[#85987](https://github.com/ClickHouse/ClickHouse/pull/85987) ([Alexander Tokmakov](https://github.com/tavplubix))。
- 现在 DDL worker 会从副本集中清理过期的主机。这将减少 ZooKeeper 中存储的元数据量。[#88154](https://github.com/ClickHouse/ClickHouse/pull/88154) ([alesapin](https://github.com/alesapin))。

### 轻量级更新修复 {#lightweight-updates-fixes}

- 修复使用 `ReplacingMergeTree` 和 `CollapsingMergeTree` 引擎的表的轻量级更新。[#84851](https://github.com/ClickHouse/ClickHouse/pull/84851) ([Anton Popov](https://github.com/CurtizJ))。
- 修复轻量级更新中更新表中所有列时的逻辑错误。[#84380](https://github.com/ClickHouse/ClickHouse/pull/84380) ([Anton Popov](https://github.com/CurtizJ))。
- 修复在版本低于 25.7 的服务器上创建的使用 `ReplicatedMergeTree` 引擎的表的轻量级更新。[#84933](https://github.com/ClickHouse/ClickHouse/pull/84933) ([Anton Popov](https://github.com/CurtizJ))。
- 修复在运行 `ALTER TABLE ... REPLACE PARTITION` 查询后,使用非复制 `MergeTree` 引擎的表的轻量级更新。[#84941](https://github.com/ClickHouse/ClickHouse/pull/84941) ([Anton Popov](https://github.com/CurtizJ))。
- 修复 `ReplicatedMergeTree` 中补丁部分的清理。以前,轻量级更新的结果可能在副本上暂时不可见,直到从另一个副本下载物化补丁部分的合并或变异部分后才可见。[#85121](https://github.com/ClickHouse/ClickHouse/pull/85121) ([Anton Popov](https://github.com/CurtizJ))。

### S3 和对象存储修复 {#s3-and-object-storage-fixes}


- 修复 S3 表函数在密钥掩码中的参数验证问题,防止可能出现 `LOGICAL_ERROR`,关闭 [#80620](https://github.com/ClickHouse/ClickHouse/issues/80620)。[#82056](https://github.com/ClickHouse/ClickHouse/pull/82056) ([Vladimir Cherkasov](https://github.com/vdimir))。
- 修复服务器处于内存压力下时远程查询可能出现的死锁问题。[#82160](https://github.com/ClickHouse/ClickHouse/pull/82160) ([Kirill](https://github.com/kirillgarbar))。
- 为 AWS ECS 令牌添加过期时间,以便可以重新加载。[#82422](https://github.com/ClickHouse/ClickHouse/pull/82422) ([Konstantin Bogdanov](https://github.com/thevar1able))。
- 修复外部表引擎中缓存缓冲区禁用边界对齐的问题。该问题在 https://github.com/ClickHouse/ClickHouse/pull/81868 中引入。[#82493](https://github.com/ClickHouse/ClickHouse/pull/82493) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 修复 S3 客户端的 `no_sign_request` 问题。该选项可用于显式避免对 S3 请求进行签名,也可以使用基于端点的设置为特定端点定义此选项。[#83379](https://github.com/ClickHouse/ClickHouse/pull/83379) ([Antonio Andelic](https://github.com/antonio2368))。
- 在从 s3Cluster() 执行 INSERT SELECT 到复制 MergeTree 时跳过不可用的节点。[#83676](https://github.com/ClickHouse/ClickHouse/pull/83676) ([Igor Nikonov](https://github.com/devcrafter))。
- 修复 S3 请求速率降速的提前返回条件:当所有线程因可重试错误而暂停时,只需 s3_slow_all_threads_after_network_error 或 backup_slow_all_threads_after_retryable_s3_error 其中之一为 true 即可启用降速行为,而不是要求两者都为 true。[#85505](https://github.com/ClickHouse/ClickHouse/pull/85505) ([Julia Kartseva](https://github.com/jkartseva))。
- 修复通过 Distributed 表或远程表函数从对象存储函数读取时的逻辑错误。修复:[#84658](https://github.com/ClickHouse/ClickHouse/issues/84658)、[#85173](https://github.com/ClickHouse/ClickHouse/issues/85173)、[#52022](https://github.com/ClickHouse/ClickHouse/issues/52022)。[#85359](https://github.com/ClickHouse/ClickHouse/pull/85359) ([alesapin](https://github.com/alesapin))。
- 修复 S3Queue 的逻辑错误"表已注册"。关闭 [#84433](https://github.com/ClickHouse/ClickHouse/issues/84433)。该问题在 https://github.com/ClickHouse/ClickHouse/pull/83530 之后引入。[#84677](https://github.com/ClickHouse/ClickHouse/pull/84677) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 修复大型设置值导致 S3Queue 表和副本重启失败的问题。[#86074](https://github.com/ClickHouse/ClickHouse/pull/86074) ([Nikolay Degterinsky](https://github.com/evillique))。

### Dynamic 和 Variant 类型修复 {#dynamicandvarianttypefixes}

- 修复解析失败时 Dynamic 列的回滚问题。[#82169](https://github.com/ClickHouse/ClickHouse/pull/82169) ([Pavel Kruglov](https://github.com/Avogar))。
- 修复 UNION 中 Variant 类型可能导致的崩溃问题。[#83295](https://github.com/ClickHouse/ClickHouse/pull/83295) ([Pavel Kruglov](https://github.com/Avogar))。
- 修复使用延迟物化读取 Variant 列的问题。[#84400](https://github.com/ClickHouse/ClickHouse/pull/84400) ([Pavel Kruglov](https://github.com/Avogar))。
- 从现有表读取时,在执行默认/物化表达式期间不验证实验性/可疑类型。[#81618](https://github.com/ClickHouse/ClickHouse/pull/81618) ([Pavel Kruglov](https://github.com/Avogar))。

### Keeper 修复 {#keeper-fixes}


- Keeper 修复:在会话关闭时删除临时节点后正确更新总监视计数。[#83583](https://github.com/ClickHouse/ClickHouse/pull/83583) ([Antonio Andelic](https://github.com/antonio2368))。
- 修复 Keeper 变更日志的乱序写入问题。此前,可能存在对变更日志的进行中写入,但回滚可能导致目标文件的并发更改。这会导致日志不一致和可能的数据丢失。[#84434](https://github.com/ClickHouse/ClickHouse/pull/84434) ([Antonio Andelic](https://github.com/antonio2368))。
- 修复使用 RocksDB 存储的 Keeper 的内存泄漏问题(迭代器未被销毁)。[#84523](https://github.com/ClickHouse/ClickHouse/pull/84523) ([Azat Khuzhin](https://github.com/azat))。
- 修复 Keeper 设置 `rotate_log_storage_interval = 0` 会导致 ClickHouse 崩溃的问题。(问题 [#83975](https://github.com/ClickHouse/ClickHouse/issues/83975))。[#84637](https://github.com/ClickHouse/ClickHouse/pull/84637) ([George Larionov](https://github.com/george-larionov))。
- 修复 Keeper 返回的总监视计数错误。[#84890](https://github.com/ClickHouse/ClickHouse/pull/84890) ([Antonio Andelic](https://github.com/antonio2368))。
- 在 RefreshTask 中从 'view' 获取 zookeeper 时锁定 'mutex'。[#84699](https://github.com/ClickHouse/ClickHouse/pull/84699) ([Tuan Pham Anh](https://github.com/tuanpach))。

### 索引修复 {#indexing-fixes}

- 修复在使用包含交替和非字面量首选项的正则表达式对 token/ngram 索引进行过滤时过度跳过颗粒的问题。[#79373](https://github.com/ClickHouse/ClickHouse/pull/79373) ([Eduard Karacharov](https://github.com/korowa))。
- 设置 `use_skip_indexes_if_final_exact_mode` 的实现(在 25.6 中引入)可能会因 `MergeTree` 引擎设置/数据分布而无法选择相关的候选范围。该问题现已解决。[#82667](https://github.com/ClickHouse/ClickHouse/pull/82667) ([Shankar Iyer](https://github.com/shankar-iyer))。
- 设置 `use_skip_indexes_if_final_exact_mode` 的优化(在 25.6 中引入)可能会因 `MergeTree` 引擎设置/数据分布而无法选择相关的候选范围。该问题现已解决。[#82879](https://github.com/ClickHouse/ClickHouse/pull/82879) ([Shankar Iyer](https://github.com/shankar-iyer))。
- 此前,`set` 索引在检查颗粒是否通过过滤器时未考虑 `Nullable` 列(问题 [#75485](https://github.com/ClickHouse/ClickHouse/issues/75485))。[#84305](https://github.com/ClickHouse/ClickHouse/pull/84305) ([Elmi Ahmadov](https://github.com/ahmadov))。
- 在 `MinMax` 索引评估期间,与 NaN 值的比较未使用正确的范围。[#84386](https://github.com/ClickHouse/ClickHouse/pull/84386) ([Elmi Ahmadov](https://github.com/ahmadov))。
- `ngram` 和 `no_op` 分词器不再因空输入标记而导致(实验性)文本索引崩溃。[#84849](https://github.com/ClickHouse/ClickHouse/pull/84849) ([Robert Schulze](https://github.com/rschu1ze))。

### 物化视图修复 {#materialized-view-fixes}


- 修复表依赖关系中导致物化视图遗漏 INSERT 查询的错误。[#82222](https://github.com/ClickHouse/ClickHouse/pull/82222) ([Nikolay Degterinsky](https://github.com/evillique))。
- 在 https://github.com/ClickHouse/ClickHouse/pull/79963 之后,物化视图中子列的使用出现问题,用户可能会收到错误 `Not found column X in block`。此行为已修复。这修复了:[#82784](https://github.com/ClickHouse/ClickHouse/issues/82784)。[#83221](https://github.com/ClickHouse/ClickHouse/pull/83221) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- 修复当类型不同时物化视图中的 illegal_type_of_argument 错误。[#85135](https://github.com/ClickHouse/ClickHouse/pull/85135) ([Sema Checherinda](https://github.com/CheSema))。

### Azure 和云存储修复 {#azure-and-cloud-storage-fixes}

- 在 AzureBlobStorage 中,对于原生复制我们会比较身份验证方法,在此过程中如果遇到异常,更新代码以回退到读取和复制(即非原生复制)。[#82693](https://github.com/ClickHouse/ClickHouse/pull/82693) ([Smita Kulkarni](https://github.com/SmitaRKulkarni))。
- 修复 `AzureIteratorAsync` 中的双重释放问题。[#85064](https://github.com/ClickHouse/ClickHouse/pull/85064) ([Nikita Taranov](https://github.com/nickitat))。

### 崩溃和稳定性修复 {#crash-and-stability-fixes}

- 修复在终止会话时日志记录可能发生的崩溃,因为 user_id 有时可能为空。[#82513](https://github.com/ClickHouse/ClickHouse/pull/82513) ([Bharat Nallan](https://github.com/bharatnc))。
- 修复客户端在错误的 `INSERT` 后连接保持断开状态导致的崩溃。[#83253](https://github.com/ClickHouse/ClickHouse/pull/83253) ([Azat Khuzhin](https://github.com/azat))。
- 修复计算包含空列的块大小时发生的崩溃。[#83271](https://github.com/ClickHouse/ClickHouse/pull/83271) ([Raúl Marín](https://github.com/Algunenano))。
- 修复在启用 CPU 调度的负载下执行设置为 'max_threads=1' 的查询时可能发生的崩溃。[#83387](https://github.com/ClickHouse/ClickHouse/pull/83387) ([Fan Ziqi](https://github.com/f2quantum))。
- 将 `zoutofmemory` 设为硬件错误,否则会抛出逻辑错误。参见 https://github.com/clickhouse/clickhouse-core-incidents/issues/877。[#84420](https://github.com/ClickHouse/ClickHouse/pull/84420) ([Han Fei](https://github.com/hanfei1991))。
- 修复 `BackgroundSchedulePool` 关闭期间可能的中止(由于从任务加入线程)以及可能的挂起(在单元测试中)。[#83769](https://github.com/ClickHouse/ClickHouse/pull/83769) ([Azat Khuzhin](https://github.com/azat))。
- 修复由后台取消检查线程引起的死锁。[#84203](https://github.com/ClickHouse/ClickHouse/pull/84203) ([Antonio Andelic](https://github.com/antonio2368))。
- 修复在库桥清理期间由于递归上下文锁定导致的关闭死锁。[#83824](https://github.com/ClickHouse/ClickHouse/pull/83824) ([Azat Khuzhin](https://github.com/azat))。
- 修复客户端在错误的 `INSERT` 后连接保持断开状态导致的崩溃。[#83842](https://github.com/ClickHouse/ClickHouse/pull/83842) ([Azat Khuzhin](https://github.com/azat))。
- 修复在字符串反序列化期间发生 `MEMORY_LIMIT_EXCEEDED` 时可能的未定义行为(崩溃)。[#85440](https://github.com/ClickHouse/ClickHouse/pull/85440) ([Azat Khuzhin](https://github.com/azat))。
- 修复在更改设置 `log_comment` 或 `insert_deduplication_token` 的异步插入中罕见的崩溃。[#85540](https://github.com/ClickHouse/ClickHouse/pull/85540) ([Anton Popov](https://github.com/CurtizJ))。

### Glue 和目录修复 {#glue-and-catalog-fixes}


- 修复 Glue Catalog 集成中的错误。现在 ClickHouse 可以读取包含嵌套数据类型的表,其中某些子列包含 decimal 类型,例如:`map<string, decimal(9, 2)>`。修复 [#81301](https://github.com/ClickHouse/ClickHouse/issues/81301)。[#82114](https://github.com/ClickHouse/ClickHouse/pull/82114) ([alesapin](https://github.com/alesapin))。
- ClickHouse 现在可以从 Glue Catalog 读取表类型以小写形式指定的表。[#84316](https://github.com/ClickHouse/ClickHouse/pull/84316) ([alesapin](https://github.com/alesapin))。
- Unity Catalog 现在会忽略非 Delta 表中包含异常数据类型的架构。修复 [#85699](https://github.com/ClickHouse/ClickHouse/issues/85699)。[#85950](https://github.com/ClickHouse/ClickHouse/pull/85950) ([alesapin](https://github.com/alesapin))。

### 函数修复 {#function-fixes}

- 函数 `trim{Left,Right,Both}` 现在支持 "FixedString(N)" 类型的输入字符串。例如,`SELECT trimBoth(toFixedString('abc', 3), 'ac')` 现在可以正常工作。[#82691](https://github.com/ClickHouse/ClickHouse/pull/82691) ([Robert Schulze](https://github.com/rschu1ze))。
- 当函数 `trim` 使用全常量输入调用时,现在会产生常量输出字符串。(错误 [#78796](https://github.com/ClickHouse/ClickHouse/issues/78796))。[#82900](https://github.com/ClickHouse/ClickHouse/pull/82900) ([Robert Schulze](https://github.com/rschu1ze))。
- 修复当格式化符 `%f` 与可变大小格式化符(例如 `%M`)一起使用时,函数 `formatDateTime` 输出不正确的问题。[#83020](https://github.com/ClickHouse/ClickHouse/pull/83020) ([Robert Schulze](https://github.com/rschu1ze))。
- 修复 `CASE` 函数中 `NULL` 参数的错误。[#82436](https://github.com/ClickHouse/ClickHouse/pull/82436) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- 在 `lowCardinalityKeys` 函数中不再使用共享字典的无关部分。[#83118](https://github.com/ClickHouse/ClickHouse/pull/83118) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 修复 colorSRGBToOKLCH/colorOKLCHToSRGB 函数在混合使用常量和非常量参数时的问题。[#83906](https://github.com/ClickHouse/ClickHouse/pull/83906) ([Azat Khuzhin](https://github.com/azat))。
- 修复 `array()` 函数中空元组构造不正确的问题。此修复解决了 [#84202](https://github.com/ClickHouse/ClickHouse/issues/84202)。[#84297](https://github.com/ClickHouse/ClickHouse/pull/84297) ([Amos Bird](https://github.com/amosbird))。
- 修复导致 Bech32 编码和解码不正确的错误。该错误最初未被发现,是因为用于测试的在线算法实现也存在相同的问题。[#84257](https://github.com/ClickHouse/ClickHouse/pull/84257) ([George Larionov](https://github.com/george-larionov))。

### 分布式查询修复 {#distributed-query-fixes}


- 带有 `LIMIT` 的并行分布式 `INSERT SELECT` 被允许执行是不正确的,会导致目标表中出现重复数据。[#84477](https://github.com/ClickHouse/ClickHouse/pull/84477) ([Igor Nikonov](https://github.com/devcrafter))。
- 当存在 `JOIN` 或子查询时,不要尝试将表函数替换为其集群替代方案。[#84335](https://github.com/ClickHouse/ClickHouse/pull/84335) ([Konstantin Bogdanov](https://github.com/thevar1able))。
- 添加检查以判断关联子查询是否在分布式上下文中使用,避免崩溃。修复 [#82205](https://github.com/ClickHouse/ClickHouse/issues/82205)。[#85030](https://github.com/ClickHouse/ClickHouse/pull/85030) ([Dmitry Novik](https://github.com/novikd))。
- 使用 `distributed_depth` 作为 `*Cluster` 函数的指示器是不正确的,可能导致数据重复;应改用 `client_info.collaborate_with_initiator`。[#85734](https://github.com/ClickHouse/ClickHouse/pull/85734) ([Konstantin Bogdanov](https://github.com/thevar1able))。
- 支持在目标表为 `Distributed` 的并行分布式 `INSERT SELECT` 中使用 `WITH` 语句的全局常量。之前,该查询可能会抛出 `Unknown expression identifier` 错误。[#85811](https://github.com/ClickHouse/ClickHouse/pull/85811) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- 修复在 `DatabaseReplicated` 中尝试执行 `CREATE ... AS (SELECT * FROM s3Cluster(...))` 时的逻辑错误。[#85904](https://github.com/ClickHouse/ClickHouse/pull/85904) ([Konstantin Bogdanov](https://github.com/thevar1able))。
- 在对 Distributed 表执行 ALTER 操作时添加对 sharding_key 的检查。之前,不正确的 ALTER 操作会破坏表定义并导致服务器重启失败。[#86015](https://github.com/ClickHouse/ClickHouse/pull/86015) ([Nikolay Degterinsky](https://github.com/evillique))。

### 指标和监控修复 {#metrics-and-monitoring-fixes}

- 修复异步指标设置 `asynchronous_metrics_update_period_s` 和 `asynchronous_heavy_metrics_update_period_s` 的验证。[#82310](https://github.com/ClickHouse/ClickHouse/pull/82310) ([Bharat Nallan](https://github.com/bharatnc))。
- 修复 `IndexUncompressedCacheBytes`/`IndexUncompressedCacheCells`/`IndexMarkCacheBytes`/`IndexMarkCacheFiles` 指标(之前它们被包含在没有 `Cache` 前缀的指标中)。[#83730](https://github.com/ClickHouse/ClickHouse/pull/83730) ([Azat Khuzhin](https://github.com/azat))。
- 修复 QueryMetricLog 中的 `LOGICAL_ERROR`:Mutex 不能为 `NULL`。[#82979](https://github.com/ClickHouse/ClickHouse/pull/82979) ([Pablo Marcos](https://github.com/pamarcos))。
- 修复不正确的指标 KafkaAssignedPartitions 和 KafkaConsumersWithAssignment。[#85494](https://github.com/ClickHouse/ClickHouse/pull/85494) ([Ilya Golshtein](https://github.com/ilejn))。
- 修复使用 `PREWHERE`(显式或自动)时已处理字节统计被低估的问题。[#85495](https://github.com/ClickHouse/ClickHouse/pull/85495) ([Michael Kolupaev](https://github.com/al13n321))。
- 修复后台调度池和执行器的内存跟踪偏差。[#84946](https://github.com/ClickHouse/ClickHouse/pull/84946) ([Azat Khuzhin](https://github.com/azat))。

### 数据类型和转换修复 {#data-type-and-conversion-fixes}


- 修复 Time 解析可能导致 msan 问题的情况。此修复解决了:[#82477](https://github.com/ClickHouse/ClickHouse/issues/82477)。[#82514](https://github.com/ClickHouse/ClickHouse/pull/82514) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- 修复 `LowCardinality(Float32|Float64|BFloat16)` 类型中 NaN 值的排序问题。[#83786](https://github.com/ClickHouse/ClickHouse/pull/83786) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。
- 修复从 `Date` 转换为 `DateTime64` 时大值(\>2106-02-07)溢出的问题。[#83982](https://github.com/ClickHouse/ClickHouse/pull/83982) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- 修复隐式读取负 Time 值到表中的问题,并使文档更加清晰。[#83091](https://github.com/ClickHouse/ClickHouse/pull/83091) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- `DoubleDelta` 编解码器现在只能应用于数值类型的列。特别是 `FixedString` 列不能再使用 `DoubleDelta` 进行压缩。(修复 [#80220](https://github.com/ClickHouse/ClickHouse/issues/80220))。[#84383](https://github.com/ClickHouse/ClickHouse/pull/84383) ([Jimmy Aguilar Mena](https://github.com/Ergus))。
- 修复 `JSONExtract` 在将 JSON 数字转换为 Decimal 类型时的精度损失问题。现在数值型 JSON 值会保留其精确的十进制表示,避免浮点舍入误差。[#85665](https://github.com/ClickHouse/ClickHouse/pull/85665) ([ssive7b](https://github.com/ssive7b))。

### 内存和资源管理 {#memory-and-resource-management}

- 修复 `max_untracked_memory` 相关的内存计算错误。[#83607](https://github.com/ClickHouse/ClickHouse/pull/83607) ([Azat Khuzhin](https://github.com/azat))。
- 不在查询之间共享 `async_read_counters`。[#83423](https://github.com/ClickHouse/ClickHouse/pull/83423) ([Azat Khuzhin](https://github.com/azat))。
- 修复将文件缓存用作临时数据存储时可能出现的未初始化错误。[#83539](https://github.com/ClickHouse/ClickHouse/pull/83539) ([Bharat Nallan](https://github.com/bharatnc))。
- 始终应用 `filesystem_prefetches_limit`(不仅限于 `MergeTreePrefetchedReadPool`)。[#83999](https://github.com/ClickHouse/ClickHouse/pull/83999) ([Azat Khuzhin](https://github.com/azat))。

### 配置和设置修复 {#configuration-and-settings-fixes}


- 通过 URI 传递设置时,将采用最后一个值。[#82137](https://github.com/ClickHouse/ClickHouse/pull/82137) ([Sema Checherinda](https://github.com/CheSema))。
- 修复客户端中的数据竞争问题(通过不使用全局上下文)和 `session_timezone` 覆盖问题(之前如果在 `users.xml`/客户端选项中将 `session_timezone` 设置为非空值,而在查询上下文中设置为空值,则会使用 `users.xml` 中的值,这是错误的;现在查询上下文将始终优先于全局上下文)。[#82444](https://github.com/ClickHouse/ClickHouse/pull/82444) ([Azat Khuzhin](https://github.com/azat))。
- 禁止将 `threadpool_writer_pool_size` 设置为零,以确保服务器操作不会卡住。[#82532](https://github.com/ClickHouse/ClickHouse/pull/82532) ([Bharat Nallan](https://github.com/bharatnc))。
- 解决设置 `role_cache_expiration_time_seconds` 配置中的轻微整数溢出问题(问题 [#83374](https://github.com/ClickHouse/ClickHouse/issues/83374))。[#83461](https://github.com/ClickHouse/ClickHouse/pull/83461) ([wushap](https://github.com/wushap))。
- 禁止将 `max_insert_block_size` 设置为零值,因为这可能导致逻辑错误。[#83688](https://github.com/ClickHouse/ClickHouse/pull/83688) ([Bharat Nallan](https://github.com/bharatnc))。
- 修复当 `block_size_bytes=0` 时 `estimateCompressionRatio()` 中的无限循环问题。[#83704](https://github.com/ClickHouse/ClickHouse/pull/83704) ([Azat Khuzhin](https://github.com/azat))。
- 在使用 multipart 的 HTTP 请求中,`date_time_input_format` 等参数会被忽略。[#85570](https://github.com/ClickHouse/ClickHouse/pull/85570) ([Sema Checherinda](https://github.com/CheSema))。

### MongoDB 修复 {#mongodb-fixes}

- 之前,`MongoDB` 表引擎定义可以在 `host:port` 参数中包含路径组件,该组件会被静默忽略。MongoDB 集成拒绝加载此类表。通过此修复,_如果 `MongoDB` 引擎有五个参数,我们允许加载此类表并忽略路径组件_,使用参数中的数据库名称。_注意:_ 此修复不适用于新创建的表或使用 `mongo` 表函数的查询,也不适用于字典源和命名集合。[#81942](https://github.com/ClickHouse/ClickHouse/pull/81942) ([Vladimir Cherkasov](https://github.com/vdimir))。

### 其他修复 {#miscellaneous-fixes}


* 在较早的版本中，服务器在处理对 `/js` 的请求时返回了过多的内容。此更改解决了 [#61890](https://github.com/ClickHouse/ClickHouse/issues/61890)。[#81895](https://github.com/ClickHouse/ClickHouse/pull/81895)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复 `InterpreterInsertQuery::extendQueryLogElemImpl`，在需要时为数据库和表名称添加反引号（例如，当名称包含 `-` 等特殊字符时）。[#81528](https://github.com/ClickHouse/ClickHouse/pull/81528)（[Ilia Shvyrialkin](https://github.com/Harzu)）。
* 修复 suggestion 线程与主客户端线程之间可能存在的数据竞争。[#82233](https://github.com/ClickHouse/ClickHouse/pull/82233) ([Azat Khuzhin](https://github.com/azat)).
* 修复 `union/intersect/except_default_mode` 重写中的异常安全问题。关闭 [#82664](https://github.com/ClickHouse/ClickHouse/issues/82664)。[#82820](https://github.com/ClickHouse/ClickHouse/pull/82820)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在使用非缓存的 `Database` 实现时，对应表的元数据会在返回列并且引用失效后被删除。 [#82939](https://github.com/ClickHouse/ClickHouse/pull/82939) ([buyval01](https://github.com/buyval01))。
* `JSONEachRowWithProgress` 中的 `onprogress` 调用现在与收尾阶段同步。[#83879](https://github.com/ClickHouse/ClickHouse/pull/83879) ([Sema Checherinda](https://github.com/CheSema))。
* 修复了一个罕见的错误：在执行 `MATERIALIZE COLUMN` 查询时，可能会在 `checksums.txt` 中出现意外记录，最终导致数据分片被标记为分离。 [#84007](https://github.com/ClickHouse/ClickHouse/pull/84007) ([alesapin](https://github.com/alesapin)).
* 在定期刷新分片时正确处理异常。 [#84083](https://github.com/ClickHouse/ClickHouse/pull/84083) ([Azat Khuzhin](https://github.com/azat)).
* 修复布尔字面量列名的生成逻辑，使其使用 &quot;true&quot;/&quot;false&quot; 而不是 &quot;1&quot;/&quot;0&quot;，以防止在查询中布尔字面量与整数字面量之间出现列名冲突。[#84945](https://github.com/ClickHouse/ClickHouse/pull/84945) ([xiaohuanlin](https://github.com/xiaohuanlin)).
* 修复 Merge 表引擎中可能存在的不准确排序问题。 [#85025](https://github.com/ClickHouse/ClickHouse/pull/85025) ([Xiaozhe Yu](https://github.com/wudidapaopao)).
* 为 DiskEncrypted 实现缺失的 API。 [#85028](https://github.com/ClickHouse/ClickHouse/pull/85028) ([Azat Khuzhin](https://github.com/azat)).
* 引入向后兼容性设置，在发生名称冲突时允许新的解析器在 `WITH` 子句中引用外层别名。修复 [#82700](https://github.com/ClickHouse/ClickHouse/issues/82700)。[#83797](https://github.com/ClickHouse/ClickHouse/pull/83797)（[Dmitry Novik](https://github.com/novikd)）。
* 在启用 analyzer 时，允许在 `remote` 表函数的 `view(...)` 参数中引用任意表。修复了 [#78717](https://github.com/ClickHouse/ClickHouse/issues/78717)。修复了 [#79377](https://github.com/ClickHouse/ClickHouse/issues/79377)。[#83844](https://github.com/ClickHouse/ClickHouse/pull/83844)（[Dmitry Novik](https://github.com/novikd)）。
* 修复在 MergeTree 中用于实验性事务的“写入改为追加”操作在处理 `plain_rewritable`/`plain` 元数据类型时被简单忽略的问题。 [#83695](https://github.com/ClickHouse/ClickHouse/pull/83695) ([Tuan Pham Anh](https://github.com/tuanpach)).
* 修复 `IAccessStorage` 中的日志记录器用法。[#84365](https://github.com/ClickHouse/ClickHouse/pull/84365)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 修复在数据湖中基于虚拟列进行文件裁剪的问题。 [#84520](https://github.com/ClickHouse/ClickHouse/pull/84520) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复在查询存在延迟的远程数据源时可能导致向量越界的问题。[#84820](https://github.com/ClickHouse/ClickHouse/pull/84820)（[George Larionov](https://github.com/george-larionov)）。
* 在表元数据中为 object queue 引擎正确存储所有设置。[#84860](https://github.com/ClickHouse/ClickHouse/pull/84860) ([Antonio Andelic](https://github.com/antonio2368)).
* 修复在将惰性列与外部排序配合使用时出现的 `CORRUPTED_DATA` 错误。[#84738](https://github.com/ClickHouse/ClickHouse/pull/84738) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
* 在 `SYSTEM DROP REPLICA` 查询中移除不必要的 `getStatus()` 调用。修复了在后台删除表时抛出 `Shutdown for storage is called` 异常的问题。[#85220](https://github.com/ClickHouse/ClickHouse/pull/85220)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 在 `CREATE OR REPLACE` 和 `RENAME` 查询中补充缺失的表名长度校验。[#85326](https://github.com/ClickHouse/ClickHouse/pull/85326) ([Michael Kolupaev](https://github.com/al13n321))。
* 修复在针对 JSON 执行 `ALTER UPDATE` 时出现的崩溃和数据损坏问题。 [#85383](https://github.com/ClickHouse/ClickHouse/pull/85383) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在处理大字符串时 `coalescing merge tree` 的段错误。关闭了 [#84582](https://github.com/ClickHouse/ClickHouse/issues/84582)。[#85709](https://github.com/ClickHouse/ClickHouse/pull/85709)（[scanhex12](https://github.com/scanhex12)）。
* 修复 `send_logs_source_regexp`（在 [#85105](https://github.com/ClickHouse/ClickHouse/issues/85105) 中进行异步日志重构之后）。[#85797](https://github.com/ClickHouse/ClickHouse/pull/85797)（[Azat Khuzhin](https://github.com/azat)）。
* 修复在出现 `MEMORY_LIMIT_EXCEEDED` 错误时，带有 update&#95;field 的字典可能产生的不一致问题。[#85807](https://github.com/ClickHouse/ClickHouse/pull/85807) ([Azat Khuzhin](https://github.com/azat)).
* 修复由 `url()` 表函数发起的 HTTP 请求，使其在访问非标准端口时，能在 Host 头中正确包含端口号。此更改解决了在使用预签名 URL 访问运行在自定义端口上的 S3 兼容服务（例如开发环境中常见的 MinIO）时出现的认证失败问题。（修复 [#85898](https://github.com/ClickHouse/ClickHouse/issues/85898)）。[#85921](https://github.com/ClickHouse/ClickHouse/pull/85921)（[Tom Quist](https://github.com/tomquist)）。
