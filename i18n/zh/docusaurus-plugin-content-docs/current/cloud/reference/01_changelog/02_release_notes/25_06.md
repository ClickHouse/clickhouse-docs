---
slug: /changelogs/25.6
title: 'v25.6 云版本更新日志'
description: 'v25.6 快速发布版本更新日志'
keywords: ['changelog', 'cloud']
sidebar_label: '25.6'
sidebar_position: 2
doc_type: 'changelog'
---



## 向后不兼容的变更 {#backward-incompatible-change}

- 函数 `geoToH3()` 现在按照 (lat, lon, res) 的顺序接受输入(这是几何函数的标准顺序)。希望保留旧版输入顺序 (lon, lat, res) 的用户可以设置 `geotoh3_lon_lat_input_order = true`。[#78852](https://github.com/ClickHouse/ClickHouse/pull/78852) ([Pratima Patel](https://github.com/pratimapatel2008))。
- 类型为 `full_text` 的索引已重命名为 `gin`。这遵循了 PostgreSQL 和其他数据库更为常用的术语。现有的 `full_text` 类型索引仍可加载,但在尝试将其用于搜索时会抛出异常(建议改用 `gin` 索引)。[#79024](https://github.com/ClickHouse/ClickHouse/pull/79024) ([Robert Schulze](https://github.com/rschu1ze))。
- 添加了文件系统缓存设置 `allow_dynamic_cache_resize`,默认值为 `false`,用于允许动态调整文件系统缓存大小。原因:在某些环境中(ClickHouse Cloud),所有扩展事件都通过重启进程来实现,我们希望明确禁用此功能以更好地控制行为并作为安全措施。此 PR 标记为向后不兼容,因为在旧版本中,动态缓存调整默认启用且无需特殊设置。[#79148](https://github.com/ClickHouse/ClickHouse/pull/79148) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 移除了对旧版索引类型 `annoy` 和 `usearch` 的支持。这两者长期以来一直是存根,即每次尝试使用这些旧版索引都会返回错误。如果您仍有 `annoy` 和 `usearch` 索引,请删除它们。[#79802](https://github.com/ClickHouse/ClickHouse/pull/79802) ([Robert Schulze](https://github.com/rschu1ze))。#_ 移除 `format_alter_commands_with_parentheses` 服务器设置。该设置在 24.2 中引入并默认禁用。在 25.2 中默认启用。由于没有不支持新格式的 LTS 版本,我们可以移除该设置。[#79970](https://github.com/ClickHouse/ClickHouse/pull/79970) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。#_ 次要变更:强制 backup_threads 和 restore_threads 服务器设置为非零值。[#80224](https://github.com/ClickHouse/ClickHouse/pull/80224) ([Raúl Marín](https://github.com/Algunenano))。
- 修复 bitNot() 对 String 类型返回以零结尾的字符串。[#80791](https://github.com/ClickHouse/ClickHouse/pull/80791) ([Azat Khuzhin](https://github.com/azat))。


## 新功能 {#new-feature}


* 在 MergeTree 的 `SETTINGS` 中新增一个选项，用于指定默认压缩编解码器，当 `CREATE` 查询未为给定列显式定义时，将使用该默认值。此更改解决了 [#42005](https://github.com/ClickHouse/ClickHouse/issues/42005)。[#66394](https://github.com/ClickHouse/ClickHouse/pull/66394)（[gvoelfin](https://github.com/gvoelfin)）。
* 跟进 [https://github.com/ClickHouse/ClickHouse/pull/71943](https://github.com/ClickHouse/ClickHouse/pull/71943)。此 PR 实现了 `Time`/`Time64` 数据类型。实现了新的数据类型：Time（HHH:MM:SS）和 Time64（HHH:MM:SS.`<fractional>`）、一些基础的转换（cast）函数以及与其他数据类型交互的函数。同时，将已有函数名 `toTime` 更名为 `toTimeWithFixedDate`，因为需要将 `toTime` 保留给类型转换函数使用。[#75735](https://github.com/ClickHouse/ClickHouse/pull/75735)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 在 `WHERE` 子句的 `EXISTS` 表达式中支持使用相关子查询作为参数。修复了 [#72459](https://github.com/ClickHouse/ClickHouse/issues/72459)。[#76078](https://github.com/ClickHouse/ClickHouse/pull/76078)（[Dmitry Novik](https://github.com/novikd)）。
* 允许向 Merge 表引擎写入数据。 [#77484](https://github.com/ClickHouse/ClickHouse/pull/77484) ([Anton Ivashkin](https://github.com/ianton-ru)).
* 用于 ReplicatedMergeTree 表的分布式 `INSERT SELECT` 现在能够高效地利用并行副本，通过在不同节点上选取不同的数据并独立执行插入来实现 `INSERT` 的并行化。[#78041](https://github.com/ClickHouse/ClickHouse/pull/78041)（[Igor Nikonov](https://github.com/devcrafter)）。
* 添加 `mapContainsValuesLike`/`mapContainsValues`/`mapExtractValuesLike` 函数以根据 map 中的值进行过滤，并在基于 Bloom 过滤器的索引中提供对它们的支持。 [#78171](https://github.com/ClickHouse/ClickHouse/pull/78171) ([UnamedRus](https://github.com/UnamedRus))。
* 新增 `system.iceberg_history` 表。[#78244](https://github.com/ClickHouse/ClickHouse/pull/78244)（[Smita Kulkarni](https://github.com/SmitaRKulkarni)）。
* 为工作负载新增查询槽位调度，详见 [https://clickhouse.com/docs/operations/workload-scheduling#query&#95;scheduling](https://clickhouse.com/docs/operations/workload-scheduling#query_scheduling)。[#78415](https://github.com/ClickHouse/ClickHouse/pull/78415)（[Sergei Trifonov](https://github.com/serxa)）。
* 添加 `getServerSetting` 和 `getMergeTreeSetting` 函数。关闭了 [https://github.com/clickhouse/clickhouse/issues/78318](https://github.com/clickhouse/clickhouse/issues/78318)。[#78439](https://github.com/ClickHouse/ClickHouse/pull/78439)（[NamNguyenHoai](https://github.com/NamHoaiNguyen)）。
* 设置约束现已支持配置不允许的取值。[#78499](https://github.com/ClickHouse/ClickHouse/pull/78499) ([Bharat Nallan](https://github.com/bharatnc))。
* 新增 `iceberg_enable_version_hint` 设置，以利用 `version-hint.text` 文件。[#78594](https://github.com/ClickHouse/ClickHouse/pull/78594) ([Arnaud Briche](https://github.com/arnaudbriche))。
* 支持使用 `LIKE` 关键字筛选并截断数据库中的特定表。 [#78597](https://github.com/ClickHouse/ClickHouse/pull/78597) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* `clickhouse-local`（及其简写别名 `ch`）现在在存在待处理的输入数据时，会隐式添加 `FROM table`。由此解决了 [#65023](https://github.com/ClickHouse/ClickHouse/issues/65023)。同时，如果未指定 `--input-format` 且正在处理常规文件，则在 `clickhouse-local` 中会自动推断输入格式。[#79085](https://github.com/ClickHouse/ClickHouse/pull/79085)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 新增 [`icebergHash`](https://iceberg.apache.org/spec/#appendix-b-32-bit-hash-requirements) 和 [`icebergBucketTransform`](https://iceberg.apache.org/spec/#bucket-transform-details) 函数。支持对使用 [`bucket transfom`](https://iceberg.apache.org/spec/#partitioning) 分区的 `Iceberg` 表进行数据文件剪枝。[#79262](https://github.com/ClickHouse/ClickHouse/pull/79262)（[Daniil Ivanik](https://github.com/divanik)）。
* 新增对 Coalescing Merge Tree 的支持。修复了 [#78869](https://github.com/ClickHouse/ClickHouse/issues/78869)。[#79344](https://github.com/ClickHouse/ClickHouse/pull/79344)（[Konstantin Vedernikov](https://github.com/scanhex12)）。
* 添加 `stringBytesUniq` 和 `stringBytesEntropy` 函数，用于搜索可能是随机或加密的数据。[#79350](https://github.com/ClickHouse/ClickHouse/pull/79350)（[Sachin Kumar Singh](https://github.com/sachinkumarsingh092)）。
* 在 MergeTree 系列表中支持 `_part_starting_offset` 虚拟列。该列表示所有前面各 part 的累计行数，在查询时基于当前的 part 列表计算得出。这些累计值在整个查询执行过程中都会被保留，即使在进行 part 剪枝之后仍然有效。相关内部逻辑已重构以支持此行为。 [#79417](https://github.com/ClickHouse/ClickHouse/pull/79417) ([Amos Bird](https://github.com/amosbird))。
* 新增了设置 `enable_shared_storage_snapshot_in_query`，用于在单个查询中让所有子查询共享同一个存储快照。即使在查询中多次引用同一张表，也能保证对该表的读取保持一致性。 [#79471](https://github.com/ClickHouse/ClickHouse/pull/79471) ([Amos Bird](https://github.com/amosbird))。
* 支持将 CH JSON 列写入 Parquet，并将 Parquet 中的 JSON 列直接读取为 CH JSON 列。[#79649](https://github.com/ClickHouse/ClickHouse/pull/79649) ([Nihal Z. Miaji](https://github.com/nihalzp))。
* 将 [`chdig`](https://github.com/azat/chdig/) 捆绑为 ClickHouse 的一部分——一个用于 ClickHouse 的 TUI 界面（类似 top）。[#79666](https://github.com/ClickHouse/ClickHouse/pull/79666)（[Azat Khuzhin](https://github.com/azat)）。
* 为 `pointInPolygon` 添加对 `MultiPolygon` 的支持。[#79773](https://github.com/ClickHouse/ClickHouse/pull/79773) ([Nihal Z. Miaji](https://github.com/nihalzp)).
* 添加对 Geo Parquet 的支持。此更改关闭了 [#75317](https://github.com/ClickHouse/ClickHouse/issues/75317)。[#79777](https://github.com/ClickHouse/ClickHouse/pull/79777)（[Konstantin Vedernikov](https://github.com/scanhex12)）。
* 新增对通过 `deltaLakeLocal` 表函数查询本地文件系统挂载的 Delta 表的支持。 [#79781](https://github.com/ClickHouse/ClickHouse/pull/79781) ([roykim98](https://github.com/roykim98)).
* 新增 Base32 编码/解码功能。[#79809](https://github.com/ClickHouse/ClickHouse/pull/79809)（[Joanna Hulboj](https://github.com/jh0x)）。
* ClickHouse 向量搜索现已支持预过滤和后过滤，并提供相关设置以便进行更细粒度的控制。（Issue [#78161](https://github.com/ClickHouse/ClickHouse/issues/78161)）。[#79854](https://github.com/ClickHouse/ClickHouse/pull/79854)（[Shankar Iyer](https://github.com/shankar-iyer)）。
* 支持用于读取 WKB 格式的函数。这部分解决了 [#43941](https://github.com/ClickHouse/ClickHouse/issues/43941)。[#80139](https://github.com/ClickHouse/ClickHouse/pull/80139) ([Konstantin Vedernikov](https://github.com/scanhex12))。
* 新增设置项 `cast_string_to_date_time_mode`，允许在从 String 类型进行 cast 时选择 DateTime 的解析模式。[#80210](https://github.com/ClickHouse/ClickHouse/pull/80210) ([Pavel Kruglov](https://github.com/Avogar))。
* 新增了 `Bech32` 和 `Bech32m` 编码与解码函数（问题 [#40381](https://github.com/ClickHouse/ClickHouse/issues/40381)）。[#80239](https://github.com/ClickHouse/ClickHouse/pull/80239)（[George Larionov](https://github.com/glarik)）。
* 在 Atomic 和 Ordinary 数据库引擎中支持 `disk` 设置，用于指定存储表元数据文件的磁盘。[#80546](https://github.com/ClickHouse/ClickHouse/pull/80546) ([Tuan Pham Anh](https://github.com/tuanpach))。
* 支持用于解包和比较 MergeTree 数据部件的函数。 [#80573](https://github.com/ClickHouse/ClickHouse/pull/80573) ([Mikhail Artemenko](https://github.com/Michicosun)).
* `timeSeries*` 辅助函数，用于在处理时间序列数据时加速某些使用场景： - 将数据重新采样到具有指定起始时间戳、结束时间戳和步长的时间网格上 - 计算类似 PromQL 的 `delta`、`rate`、`idelta` 和 `irate`。[#80590](https://github.com/ClickHouse/ClickHouse/pull/80590) ([Alexander Gololobov](https://github.com/davenger)).
* 允许根据数据所在的磁盘过滤选用于查询的数据部分。 [#80650](https://github.com/ClickHouse/ClickHouse/pull/80650) ([tanner-bruce](https://github.com/tanner-bruce)).
* 添加一个包含嵌入式 Web 工具列表的入口页面。当由类似浏览器的用户代理请求时，将会打开该页面。[#81129](https://github.com/ClickHouse/ClickHouse/pull/81129) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 支持在 `arrayFirst`、`arrayFirstIndex`、`arrayLast` 和 `arrayLastIndex` 中过滤 `NULL` 值。修复了 [#81113](https://github.com/ClickHouse/ClickHouse/issues/81113)。[#81197](https://github.com/ClickHouse/ClickHouse/pull/81197)（[Lennard Eijsackers](https://github.com/Blokje5)）。





## 实验性功能 {#experimental-feature}

- 为 Iceberg 数据湖提供 Hive metastore 目录支持。[#77677](https://github.com/ClickHouse/ClickHouse/pull/77677) ([Konstantin Vedernikov](https://github.com/scanhex12))。
- 支持通过键值对方式传递显式参数。当前支持的参数包括一个必需参数 `tokenizer` 以及两个可选参数 `max_rows_per_postings_list` 和 `ngram_size`。[#80262](https://github.com/ClickHouse/ClickHouse/pull/80262) ([Elmi Ahmadov](https://github.com/ahmadov))。
- 实验性索引类型 `gin` 已重命名为 `text`。现有的 `gin` 类型索引仍可加载,但在搜索中使用时会抛出异常(建议使用 `text` 索引代替)。[#80855](https://github.com/ClickHouse/ClickHouse/pull/80855) ([Robert Schulze](https://github.com/rschu1ze))。


## 性能优化 {#performance-improvement}


* 通过在多个 granule 上同时计算其表达式来加速二级索引。[#64109](https://github.com/ClickHouse/ClickHouse/pull/64109)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 引入了一个阈值（由设置 `parallel_hash_join_threshold` 控制），当右表大小低于该阈值时会回退到使用 `hash` 算法。[#76185](https://github.com/ClickHouse/ClickHouse/pull/76185)（[Nikita Taranov](https://github.com/nickitat)）。
* 当前对 `Pipe::resize` 的实现，是通过在管道拓扑中插入一个单一的 `Resize` 或 `StrictResize` 节点来完成的，该节点作为中心枢纽，将所有输入流（上游节点）连接到统一的一组输出流（下游节点）。这种设计在管道图执行期间会对 `ExecutingGraph::Node::status_mutex` 产生竞争，尤其是在高核心数环境中。当管道扩展到几十甚至上百个流时，这种竞争会导致如下问题：[ #77562](https://github.com/ClickHouse/ClickHouse/pull/77562)（[Zhiguo Zhou](https://github.com/ZhiguoZh)）。
* 通过允许并行执行 `INSERT` 操作来提升 `S3Queue`/`AzureQueue` 的性能（可通过队列设置 `parallel_inserts=true` 启用）。此前 `S3Queue`/`AzureQueue` 只能并行执行处理流水线的第一部分（下载、解析），而 `INSERT` 为单线程执行，并且 `INSERT` 几乎总是瓶颈。现在性能将几乎可以随 `processing_threads_num` 线性扩展。[#77671](https://github.com/ClickHouse/ClickHouse/pull/77671) ([Azat Khuzhin](https://github.com/azat))。
* 将 compact 部件格式修改为为每个子流保存标记，从而可以读取单独的子列。旧的 compact 格式在读取时仍受支持，并且可以通过 MergeTree 设置 `write_marks_for_substreams_in_compact_parts` 在写入时启用。出于更安全升级的考虑，该设置默认禁用，因为它会更改 compact 部件的存储方式。在接下来的某个版本中，它将默认启用。[#77940](https://github.com/ClickHouse/ClickHouse/pull/77940)（[Pavel Kruglov](https://github.com/Avogar)）。
* 引入了新的设置项 `use_skip_indexes_in_final_exact_mode`。如果对 `ReplacingMergeTree` 表的查询带有 `FINAL` 子句，仅根据 skip 索引读取表范围可能会产生不正确的结果。该设置可以通过扫描与 skip 索引返回的主键范围有重叠的较新数据部分，确保返回正确结果。设置为 0 表示禁用，1 表示启用。[#78350](https://github.com/ClickHouse/ClickHouse/pull/78350) ([Shankar Iyer](https://github.com/shankar-iyer))。
* 现在，我们根据副本数量来确定在启用并行副本读取时的任务大小。这样在待读取数据量不太大时，可以在副本之间实现更均衡的工作分配。[#78695](https://github.com/ClickHouse/ClickHouse/pull/78695)（[Nikita Taranov](https://github.com/nickitat)）。
* 允许在分布式聚合的最终阶段并行合并 `uniqExact` 状态。[#78703](https://github.com/ClickHouse/ClickHouse/pull/78703) ([Nikita Taranov](https://github.com/nickitat)).
* 修复了在按键聚合中并行合并 `uniqExact` 状态时可能出现的性能下降问题。 [#78724](https://github.com/ClickHouse/ClickHouse/pull/78724) ([Nikita Taranov](https://github.com/nickitat))。
  #* 将 `DELETE FROM ... WHERE 1` 查询替换为 `TRUNCATE`。（已回滚）。 [#78739](https://github.com/ClickHouse/ClickHouse/pull/78739) ([Konstantin Vedernikov](https://github.com/scanhex12))。
* 减少对 Azure 存储中 List Blobs API 的调用次数。[#78860](https://github.com/ClickHouse/ClickHouse/pull/78860)（[Julia Kartseva](https://github.com/jkartseva)）。
* 如果可能，将过滤查询计划步骤中的等值条件合并到 `JOIN` 条件中，以便可以将它们用作哈希表键。[#78877](https://github.com/ClickHouse/ClickHouse/pull/78877) ([Dmitry Novik](https://github.com/novikd))。
* 将正则表达式替换为 `extractKeyValuePairs`，以提升 Hive 路径解析性能。[#79067](https://github.com/ClickHouse/ClickHouse/pull/79067)（[Arthur Passos](https://github.com/arthurpassos)）。
* 优化并行副本场景下分布式 `INSERT SELECT` 的性能。 [#79441](https://github.com/ClickHouse/ClickHouse/pull/79441) ([Azat Khuzhin](https://github.com/azat))。
* 允许将包含子列的条件移动到 `PREWHERE`。[#79489](https://github.com/ClickHouse/ClickHouse/pull/79489) ([Pavel Kruglov](https://github.com/Avogar))。
* 针对所有类型的布隆过滤器进行了性能优化。 [#79800](https://github.com/ClickHouse/ClickHouse/pull/79800) ([Delyan Kratunov](https://github.com/dkratunov))。
* 防止 `LogSeriesLimiter` 在每次构造时都执行清理操作，从而避免在高并发场景下出现锁竞争和性能退化。[#79864](https://github.com/ClickHouse/ClickHouse/pull/79864) ([filimonov](https://github.com/filimonov)).
* 默认启用 `compile_expressions`（用于普通表达式片段的 JIT 编译器），从而修复了 [#51264](https://github.com/ClickHouse/ClickHouse/issues/51264)、[#56386](https://github.com/ClickHouse/ClickHouse/issues/56386) 和 [#66486](https://github.com/ClickHouse/ClickHouse/issues/66486)。[#79907](https://github.com/ClickHouse/ClickHouse/pull/79907)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 通过 trivial count 优化加速查询。 [#79945](https://github.com/ClickHouse/ClickHouse/pull/79945) ([Raúl Marín](https://github.com/Algunenano))。
* 在 `UniqExactSet::merge` 中为其中一个集合为空的情况引入了快速路径。同时，现在如果左侧集合是两级结构而右侧集合是单级结构，我们将不再把右侧集合转换为两级结构。[#79971](https://github.com/ClickHouse/ClickHouse/pull/79971) ([Nikita Taranov](https://github.com/nickitat))。
* 为 `convertDecimalsImpl` 添加 `__attribute__((always_inline))` 属性。 [#79999](https://github.com/ClickHouse/ClickHouse/pull/79999) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 将 `input_format_parquet_bloom_filter_push_down` 的默认值设为 true。同时修复设置变更历史中的一个错误。[#80058](https://github.com/ClickHouse/ClickHouse/pull/80058) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
  #* 默认将日志记录改为异步。你可以通过在 `<logger>` 下将 `<async>` 设置为 `false` 来禁用此行为。[#80125](https://github.com/ClickHouse/ClickHouse/pull/80125) ([Raúl Marín](https://github.com/Algunenano))。
* 在使用两级哈希表时，提升内存复用效率并减少缺页错误。 [#80245](https://github.com/ClickHouse/ClickHouse/pull/80245) ([Jiebin Sun](https://github.com/jiebinn))。
* 在 `QueryConditionCache` 中避免不必要的更新并降低锁竞争。[#80247](https://github.com/ClickHouse/ClickHouse/pull/80247) ([Jiebin Sun](https://github.com/jiebinn))。
* 对 `concatenateBlocks` 进行了小幅优化，有助于并行 Hash Join。 [#80328](https://github.com/ClickHouse/ClickHouse/pull/80328) ([李扬](https://github.com/taiyang-li)).
* 在从主键范围中选择 mark 范围时，如果主键被函数包裹，则无法使用二分查找。此 PR 放宽了这一限制：当主键被一系列始终单调的函数包裹，或当 RPN（逆波兰表达式）中包含一个恒为真的元素时，仍然可以应用二分查找。此 PR 关闭了 [#45536](https://github.com/ClickHouse/ClickHouse/issues/45536)。[#80597](https://github.com/ClickHouse/ClickHouse/pull/80597)（[zoomxi](https://github.com/zoomxi)）。
* 改进 Kafka 引擎的关闭速度（当存在多个 Kafka 表时，移除额外的 3 秒延迟）。[#80796](https://github.com/ClickHouse/ClickHouse/pull/80796) ([Azat Khuzhin](https://github.com/azat)).
* 减少异步插入的内存占用，并提升插入查询的性能。[#80972](https://github.com/ClickHouse/ClickHouse/pull/80972) ([Raúl Marín](https://github.com/Algunenano))。
* 如果日志表被禁用，则不要对处理器进行性能分析。 [#81256](https://github.com/ClickHouse/ClickHouse/pull/81256) ([Raúl Marín](https://github.com/Algunenano))。
* 当源数据正好满足请求时，加速 `toFixedString`。 [#81257](https://github.com/ClickHouse/ClickHouse/pull/81257) ([Raúl Marín](https://github.com/Algunenano)).
* 如果用户没有配额限制，则不要处理配额值。[#81549](https://github.com/ClickHouse/ClickHouse/pull/81549) ([Raúl Marín](https://github.com/Algunenano))。
* 将 ProcfsMetricsProvider 设为 thread&#95;local，以便在任务之间保持文件处于打开状态。[#81576](https://github.com/ClickHouse/ClickHouse/pull/81576) ([Raúl Marín](https://github.com/Algunenano))。
* 修复了内存跟踪中的性能回归。 [#81694](https://github.com/ClickHouse/ClickHouse/pull/81694) ([Michael Kolupaev](https://github.com/al13n321)).





## 改进 {#improvement}


#* 如果指定 `--path` 命令行参数,`clickhouse-local` 将在重启后保留其数据库。这解决了 [#50647](https://github.com/ClickHouse/ClickHouse/issues/50647)。这解决了 [#49947](https://github.com/ClickHouse/ClickHouse/issues/49947)。[#71722](https://github.com/ClickHouse/ClickHouse/pull/71722) ([Alexey Milovidov](https://github.com/alexey-milovidov))。

* `EXPLAIN SYNTAX` 现在使用新的分析器。它返回一个由查询树构建的抽象语法树（AST）。新增选项 `query_tree_passes`，用于控制在将查询树转换为 AST 之前要执行的遍数。[#74536](https://github.com/ClickHouse/ClickHouse/pull/74536) ([Vladimir Cherkasov](https://github.com/vdimir)).
  #* 在文件系统缓存中默认使用 SLRU 缓存策略。[#75072](https://github.com/ClickHouse/ClickHouse/pull/75072) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 重构了向视图推送数据的逻辑。[#77309](https://github.com/ClickHouse/ClickHouse/pull/77309) ([Sema Checherinda](https://github.com/CheSema))。
* 对象存储集群表函数（例如 `s3Cluster`）现在会基于一致哈希为副本分配要读取的文件，从而提升缓存局部性。[#77326](https://github.com/ClickHouse/ClickHouse/pull/77326)（[Andrej Hoos](https://github.com/adikus)）。
* 在发生 `AuthenticationRequired` 错误后刷新 S3 凭证。[#77353](https://github.com/ClickHouse/ClickHouse/pull/77353) ([Vitaly Baranov](https://github.com/vitlibar)).
* 通过构建器在某些 HTTP 缓冲区中嵌入代理配置。[#77693](https://github.com/ClickHouse/ClickHouse/pull/77693)（[Arthur Passos](https://github.com/arthurpassos)）。
* 在 `system.asynchronous_metrics` 中添加了字典相关的度量指标 - `DictionaryMaxUpdateDelay` - 字典更新的最大延迟（以秒为单位） - `DictionaryTotalFailedUpdates` - 自上次所有字典成功加载以来的错误次数。 [#78175](https://github.com/ClickHouse/ClickHouse/pull/78175) ([Vlad](https://github.com/codeworse)).
* 添加函数 `divideOrNull`、`moduloOrNull`、`intDivOrNull`、`positiveModuloOrNull`，当右侧参数为 0 时返回 NULL。 [#78276](https://github.com/ClickHouse/ClickHouse/pull/78276) ([kevinyhzou](https://github.com/KevinyhZou)).
* 扩展 `isIPAddressInRange` 函数，使其支持 String、IPv4、IPv6、Nullable(String)、Nullable(IPv4) 和 Nullable(IPv6) 数据类型。[#78364](https://github.com/ClickHouse/ClickHouse/pull/78364)（[YjyJeff](https://github.com/YjyJeff)）。
* 动态修改 PostgreSQL 引擎连接池管理器设置。[#78414](https://github.com/ClickHouse/ClickHouse/pull/78414)（[Samay Sharma](https://github.com/samay-sharma)）。
* 允许在常规投影中指定 `_part_offset`。这是构建投影索引的第一步。它可以与 [#58224](https://github.com/ClickHouse/ClickHouse/issues/58224) 一起使用，并有助于改进 [https://github.com/ClickHouse/ClickHouse/pull/63207](https://github.com/ClickHouse/ClickHouse/pull/63207)。[#78429](https://github.com/ClickHouse/ClickHouse/pull/78429)（[Amos Bird](https://github.com/amosbird)）。
* 改进分布式查询中的分片键优化。[#78452](https://github.com/ClickHouse/ClickHouse/pull/78452) ([fhw12345](https://github.com/fhw12345)).
* 为 `system.named_collections` 添加新列（`create_query` 和 `source`）。解决 [#78179](https://github.com/ClickHouse/ClickHouse/issues/78179)。[#78582](https://github.com/ClickHouse/ClickHouse/pull/78582)（[MikhailBurdukov](https://github.com/MikhailBurdukov)）。
* 在系统表 `system.query_condition_cache` 中新增字段 `condition`。该字段存储的明文条件，其哈希值被用作查询条件缓存的键。 [#78671](https://github.com/ClickHouse/ClickHouse/pull/78671) ([Robert Schulze](https://github.com/rschu1ze)).
* 使用 ClickHouse Keeper 为 StorageKafka2 实现类似 Kafka rebalance 的逻辑。对于每个副本，我们支持两种类型的分区锁：永久锁和临时锁。副本会尽可能长时间地持有永久锁，在任何时刻，副本上的永久锁数量不超过 `all_topic_partitions / active_replicas_count`（其中 `all_topic_partitions` 是所有分区的数量，`active_replicas_count` 是活动副本的数量），如果超过，则该副本会释放部分分区的锁。一些分区会被副本临时持有。副本上的临时锁最大数量会动态变化，以便给其他副本机会将部分分区获取为永久锁。在更新临时锁时，副本会释放其所有临时锁，并尝试重新获取其他分区的临时锁。[#78726](https://github.com/ClickHouse/ClickHouse/pull/78726)（[Daria Fomina](https://github.com/sinfillo)）。
* 为 `Kafka` 表引擎新增用于 SASL 配置和凭据的表设置。这样可以在 `CREATE TABLE` 语句中直接配置针对 Kafka 及兼容 Kafka 系统的基于 SASL 的认证，而无需使用配置文件或命名集合。[#78810](https://github.com/ClickHouse/ClickHouse/pull/78810)（[Christoph Wurm](https://github.com/cwurm)）。
* 新增针对可能为保存损坏表而创建的数据库的警告。[#78841](https://github.com/ClickHouse/ClickHouse/pull/78841)（[János Benjamin Antal](https://github.com/antaljanosbenjamin)）。
* 现在可以在 `BFloat16` 列上创建向量相似度索引。[#78850](https://github.com/ClickHouse/ClickHouse/pull/78850) ([Robert Schulze](https://github.com/rschu1ze))。
* 在 best-effort 模式的 DateTime64 解析中支持带小数部分的 Unix 时间戳。[#78908](https://github.com/ClickHouse/ClickHouse/pull/78908) ([Pavel Kruglov](https://github.com/Avogar))。
* 在 DeltaLake 存储的 delta-kernel 实现中修复 `columnMappingMode.name` 问题，并为架构演进添加测试。[#78921](https://github.com/ClickHouse/ClickHouse/pull/78921)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 通过改进值转换，提高以 Values 格式向 Variant 列插入数据的效果。 [#78923](https://github.com/ClickHouse/ClickHouse/pull/78923) ([Pavel Kruglov](https://github.com/Avogar)).
* 在 `S3Queue` 引擎中新增 `_time` 虚拟列。[#78926](https://github.com/ClickHouse/ClickHouse/pull/78926)（[Anton Ivashkin](https://github.com/ianton-ru)）。
* `tokens` 函数已扩展为可接受一个额外的 “tokenizer” 参数以及更多与该 tokenizer 相关的专用参数。[#79001](https://github.com/ClickHouse/ClickHouse/pull/79001)（[Elmi Ahmadov](https://github.com/ahmadov)）。
* `SHOW CLUSTER` 语句现在会展开其参数中的宏（如果有）。 [#79006](https://github.com/ClickHouse/ClickHouse/pull/79006) ([arf42](https://github.com/arf42))。
* 哈希函数现在支持在数组、元组和映射中处理 `NULL` 值。（issues [#48365](https://github.com/ClickHouse/ClickHouse/issues/48365) 和 [#48623](https://github.com/ClickHouse/ClickHouse/issues/48623)）。[#79008](https://github.com/ClickHouse/ClickHouse/pull/79008)（[Michael Kolupaev](https://github.com/al13n321)）。
* 为只读 MergeTree 表添加刷新支持。[#79033](https://github.com/ClickHouse/ClickHouse/pull/79033) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
  #* 将 cctz 更新到 2025a。[#79043](https://github.com/ClickHouse/ClickHouse/pull/79043) ([Raúl Marín](https://github.com/Algunenano))。
* 使用于在 CPU 过载时控制断开连接的设置支持热重载。 [#79052](https://github.com/ClickHouse/ClickHouse/pull/79052) ([Alexey Katsman](https://github.com/alexkats)).
* 这有助于提升易用性。[#79066](https://github.com/ClickHouse/ClickHouse/pull/79066) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 默认启用查询条件缓存。[#79080](https://github.com/ClickHouse/ClickHouse/pull/79080) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
  #* 使 Web UI 中的标签页操作可撤销。此更改解决了 [#71284](https://github.com/ClickHouse/ClickHouse/issues/71284)。[#79084](https://github.com/ClickHouse/ClickHouse/pull/79084) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 在 `recoverLostReplica` 过程中移除这些设置，与 [https://github.com/ClickHouse/ClickHouse/pull/78637](https://github.com/ClickHouse/ClickHouse/pull/78637) 中的处理方式相同。[#79113](https://github.com/ClickHouse/ClickHouse/pull/79113)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 为 Parquet 索引裁剪新增 ProfileEvents ParquetReadRowGroups 和 ParquetPrunedRowGroups。 [#79180](https://github.com/ClickHouse/ClickHouse/pull/79180) ([flynn](https://github.com/ucasfl))。
* 为 Azure Blob 存储中的普通磁盘在 `system.tables` 中上报的数据路径添加容器前缀，使其与 S3 和 GCP 的报告保持一致。 [#79241](https://github.com/ClickHouse/ClickHouse/pull/79241) ([Julia Kartseva](https://github.com/jkartseva)).
* 支持在集群上执行 ALTER DATABASE 操作。 [#79242](https://github.com/ClickHouse/ClickHouse/pull/79242) ([Tuan Pham Anh](https://github.com/tuanpach)).
* 显式跳过 QueryMetricLog 统计收集过程中错过的运行，否则日志将需要很长时间才能追上当前时间。[#79257](https://github.com/ClickHouse/ClickHouse/pull/79257) ([Mikhail Artemenko](https://github.com/Michicosun))。
* 新增了对轻量级删除按需应用的支持（通过设置 `lightweight_deletes_sync = 0`、`apply_mutations_on_fly = 1` 实现）。[#79281](https://github.com/ClickHouse/ClickHouse/pull/79281)（[Anton Popov](https://github.com/CurtizJ)）。
* 针对需要删除所有行的数据分，优化了 `ALTER ... DELETE` 变更操作。现在，在此类情况下，会直接创建一个空数据分来替代原始数据分，而无需实际执行变更操作。[#79307](https://github.com/ClickHouse/ClickHouse/pull/79307) ([Anton Popov](https://github.com/CurtizJ))。
* 针对 `CHColumnToArrowColumn` 做了一些小优化。[#79308](https://github.com/ClickHouse/ClickHouse/pull/79308)（[Bharat Nallan](https://github.com/bharatnc)）。
* 设置 `allow_archive_path_syntax` 被错误地标记为实验功能。添加了一个测试，以防止实验性设置在默认情况下被启用。 [#79320](https://github.com/ClickHouse/ClickHouse/pull/79320) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 使页面缓存设置可以在每个查询级别进行调整。这对于更快速的实验以及对高吞吐量、低延迟查询进行精细调优是必需的。[#79337](https://github.com/ClickHouse/ClickHouse/pull/79337)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 对于看起来像大多数 64 位哈希的数字，不要以美化格式输出数字提示。此更改修复了 [#79334](https://github.com/ClickHouse/ClickHouse/issues/79334)。[#79338](https://github.com/ClickHouse/ClickHouse/pull/79338)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 如果在终端中以 pretty 格式显示数据，且后续数据块具有相同的列宽，则可以在上一个数据块的基础上继续，通过向上移动光标将其与上一个数据块拼接在一起。此功能修复了 [#79333](https://github.com/ClickHouse/ClickHouse/issues/79333) 中的问题。该功能由新的设置项 `output_format_pretty_glue_chunks` 控制。[#79339](https://github.com/ClickHouse/ClickHouse/pull/79339)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 高级仪表板上图表的颜色将根据对应查询的哈希值计算得出。这样在滚动浏览仪表板时，更容易记住并定位某个图表。[#79341](https://github.com/ClickHouse/ClickHouse/pull/79341)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 添加异步指标 `FilesystemCacheCapacity` —— `cache` 虚拟文件系统中的总容量。该指标对于整体基础设施监控非常有用。[#79348](https://github.com/ClickHouse/ClickHouse/pull/79348)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 优化对 system.parts 的访问（仅在需要时读取列/索引大小）。 [#79352](https://github.com/ClickHouse/ClickHouse/pull/79352) ([Azat Khuzhin](https://github.com/azat)).
* 在查询 `'SHOW CLUSTER <name>'` 时，仅选择重要字段，而不是所有字段。[#79368](https://github.com/ClickHouse/ClickHouse/pull/79368)（[Tuan Pham Anh](https://github.com/tuanpach)）。
* 支持为 `DatabaseCatalog` 指定存储设置。 [#79407](https://github.com/ClickHouse/ClickHouse/pull/79407) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 在 delta 内核中增加对本地存储的支持。[#79416](https://github.com/ClickHouse/ClickHouse/pull/79416) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 新增查询级别设置以启用 delta-kernel-rs：`allow_experimental_delta_kernel_rs`。[#79418](https://github.com/ClickHouse/ClickHouse/pull/79418)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 修复从 Azure/S3 Blob 存储中列出 Blob 时可能出现的潜在无限循环问题。[#79425](https://github.com/ClickHouse/ClickHouse/pull/79425)（[Alexander Gololobov](https://github.com/davenger)）。
* 现在，ClickHouse 也支持以 `param-<name>`（连字符）形式的查询参数，除了原有的 `param_<name>`（下划线）形式之外。这已解决 [#63093](https://github.com/ClickHouse/ClickHouse/issues/63093)。[#79429](https://github.com/ClickHouse/ClickHouse/pull/79429) ([Engel Danila](https://github.com/aaaengel))。
  #* 添加文件系统缓存设置 `max_size_ratio_to_total_space`。[#79460](https://github.com/ClickHouse/ClickHouse/pull/79460) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 在启用校验和的情况下，从本地向远程 S3 复制数据时，新增了关于带宽减免的详细警告信息。[#79464](https://github.com/ClickHouse/ClickHouse/pull/79464) ([VicoWu](https://github.com/VicoWu))。
* 将 `clickhouse-benchmark` 的 `reconnect` 选项重新配置为接受 0、1 或 N 作为取值，以相应控制重连行为。[#79465](https://github.com/ClickHouse/ClickHouse/pull/79465) ([Sachin Kumar Singh](https://github.com/sachinkumarsingh092))。
* 新增设置项 `input_format_max_block_size_bytes`，用于限制在输入格式中创建的数据块大小（以字节为单位）。这有助于在导入包含大值的行时避免过高的内存占用。[#79495](https://github.com/ClickHouse/ClickHouse/pull/79495) ([Pavel Kruglov](https://github.com/Avogar))。
* 提升 sparseGrams 的速度和内存使用效率。[#79517](https://github.com/ClickHouse/ClickHouse/pull/79517) ([Konstantin Vedernikov](https://github.com/scanhex12))。
* 在插入到 Compact 部分时，尽可能避免对块进行额外复制。[#79536](https://github.com/ClickHouse/ClickHouse/pull/79536) ([Pavel Kruglov](https://github.com/Avogar))。
* 默认启用 `DeltaLake` 存储的 delta-kernel 实现。[#79541](https://github.com/ClickHouse/ClickHouse/pull/79541) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 如果从 URL 读取数据时涉及多个重定向，则会在整个重定向链中正确应用 `enable_url_encoding` 设置。[#79563](https://github.com/ClickHouse/ClickHouse/pull/79563)（[Shankar Iyer](https://github.com/shankar-iyer)）。
* 允许对位于不同 `plain_rewritable` 磁盘上的表执行 `ALTER TABLE ... MOVE|REPLACE PARTITION`。 [#79566](https://github.com/ClickHouse/ClickHouse/pull/79566) ([Julia Kartseva](https://github.com/jkartseva))。
* 在 `WHERE` 子句中支持标量关联子查询。关闭了 [#6697](https://github.com/ClickHouse/ClickHouse/issues/6697)。[#79600](https://github.com/ClickHouse/ClickHouse/pull/79600)（[Dmitry Novik](https://github.com/novikd)）。
* 之前当 `input_format_parquet_max_block_size = 0` 时，ClickHouse 会卡住。现在该问题已修复，从而关闭了 [#79394](https://github.com/ClickHouse/ClickHouse/issues/79394)。[#79601](https://github.com/ClickHouse/ClickHouse/pull/79601)（[abashkeev](https://github.com/abashkeev)）。
* 为 `startup_scripts` 新增 `throw_on_error` 设置：当 `throw_on_error` 为 true 时，只有在所有查询都成功完成的情况下，服务器才会启动。默认情况下，`throw_on_error` 为 false，从而保留之前的行为。[#79732](https://github.com/ClickHouse/ClickHouse/pull/79732) ([Aleksandr Musorin](https://github.com/AVMusorin))。
* 当参考向量的类型为 `Array(BFloat16)` 时，现在也会使用向量相似度索引。[#79745](https://github.com/ClickHouse/ClickHouse/pull/79745) ([Shankar Iyer](https://github.com/shankar-iyer))。
* 将 `last_error_message`、`last_error_trace` 和 `query_id` 添加到 `system.error_log` 表中。相关 Issue [#75816](https://github.com/ClickHouse/ClickHouse/issues/75816)。[#79836](https://github.com/ClickHouse/ClickHouse/pull/79836)（[Andrei Tinikov](https://github.com/Dolso)）。
  #* 默认启用崩溃报告发送功能。可在服务器配置文件中将其关闭。[#79838](https://github.com/ClickHouse/ClickHouse/pull/79838)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 系统表 `system.functions` 现在会显示各个函数首次引入的 ClickHouse 版本。 [#79839](https://github.com/ClickHouse/ClickHouse/pull/79839) ([Robert Schulze](https://github.com/rschu1ze)).
* 新增了 `access_control_improvements.enable_user_name_access_type` 配置项。该配置项用于启用或禁用在 [https://github.com/ClickHouse/ClickHouse/pull/72246](https://github.com/ClickHouse/ClickHouse/pull/72246) 中引入的针对用户/角色的精细化授权。如果集群中存在版本低于 25.1 的副本，建议关闭此配置项。[#79842](https://github.com/ClickHouse/ClickHouse/pull/79842) ([pufit](https://github.com/pufit))。
* `ASTSelectWithUnionQuery::clone()` 方法的正确实现现在也会考虑 `is_normalized` 字段。这可能有助于修复 [#77569](https://github.com/ClickHouse/ClickHouse/issues/77569)。[#79909](https://github.com/ClickHouse/ClickHouse/pull/79909)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 在简单场景下，支持在投影列表中使用相关子查询。 [#79925](https://github.com/ClickHouse/ClickHouse/pull/79925) ([Dmitry Novik](https://github.com/novikd)).
* 修复某些使用 `EXCEPT` 运算符的查询在格式化时不一致的问题。如果 `EXCEPT` 运算符左侧以 `*` 结尾，格式化后的查询会丢失括号，从而被解析为带有 `EXCEPT` 修饰符的 `*` 表达式。这些查询是通过模糊测试工具（fuzzer）发现的，在实际使用中不太可能遇到。本次修复关闭了 [#79950](https://github.com/ClickHouse/ClickHouse/issues/79950)。[#79952](https://github.com/ClickHouse/ClickHouse/pull/79952)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 允许在任何类型的 `http_handlers` 中添加 `http_response_headers`。[#79975](https://github.com/ClickHouse/ClickHouse/pull/79975) ([Andrey Zvonov](https://github.com/zvonand)).
* 通过对变体反序列化顺序进行缓存，对 JSON 类型解析进行了小幅改进。[#79984](https://github.com/ClickHouse/ClickHouse/pull/79984)（[Pavel Kruglov](https://github.com/Avogar)）。
* 在可行的情况下，允许将 `GLOBAL [NOT] IN` 谓词下推到 `PREWHERE` 子句。[#79996](https://github.com/ClickHouse/ClickHouse/pull/79996)（[Eduard Karacharov](https://github.com/korowa)）。
* 新增设置项 `s3_slow_all_threads_after_network_error`。 [#80035](https://github.com/ClickHouse/ClickHouse/pull/80035) ([Vitaly Baranov](https://github.com/vitlibar))。
* 关于所选待合并部分的日志级别设置不正确（Information）。关闭 [#80061](https://github.com/ClickHouse/ClickHouse/issues/80061)。[#80062](https://github.com/ClickHouse/ClickHouse/pull/80062)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `reverse` 函数现已支持 `Tuple` 数据类型。已关闭 [#80053](https://github.com/ClickHouse/ClickHouse/issues/80053)。[#80083](https://github.com/ClickHouse/ClickHouse/pull/80083) ([flynn](https://github.com/ucasfl))。
* `enble_url_encoding` 的默认值现已设置为 `False`。[#80088](https://github.com/ClickHouse/ClickHouse/pull/80088)（[Shankar Iyer](https://github.com/shankar-iyer)）。
* 这个小补丁修复了 [#75817](https://github.com/ClickHouse/ClickHouse/issues/75817)：支持从 `system.zookeeper` 表中获取 `auxiliary_zookeepers` 数据。[#80146](https://github.com/ClickHouse/ClickHouse/pull/80146)（[Nikolay Govorov](https://github.com/mrdimidium)）。
* 使用向量相似度索引的向量搜索功能现已进入 beta 阶段（此前为实验特性）。 [#80164](https://github.com/ClickHouse/ClickHouse/pull/80164) ([Robert Schulze](https://github.com/rschu1ze))。
* 添加关于服务器 TCP 套接字的异步指标，以提高可观测性。修复 [#80187](https://github.com/ClickHouse/ClickHouse/issues/80187)。[#80188](https://github.com/ClickHouse/ClickHouse/pull/80188)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 函数 `tokens` 现在支持使用 `string` 作为分词器。 [#80195](https://github.com/ClickHouse/ClickHouse/pull/80195) ([Robert Schulze](https://github.com/rschu1ze)).
* 并行副本：当所有读取任务都已分配给其他副本时，不再等待那些未使用的慢副本。 [#80199](https://github.com/ClickHouse/ClickHouse/pull/80199) ([Igor Nikonov](https://github.com/devcrafter))。
* 为 `simpleAggregateFunction` 新增对 `anylast_respect_nulls` 和 `any_respect_nulls` 的支持。 [#80219](https://github.com/ClickHouse/ClickHouse/pull/80219) ([Diskein](https://github.com/Diskein)).
* 移除针对复制数据库的不必要调用 `adjustCreateQueryForBackup()`。 [#80282](https://github.com/ClickHouse/ClickHouse/pull/80282) ([Vitaly Baranov](https://github.com/vitlibar)).
  #* 允许在 `clickhouse-local` 中使用额外选项（在 `--` 之后，例如 `-- --config.value='abc'`）时省略等号。关闭 [#80292](https://github.com/ClickHouse/ClickHouse/issues/80292)。 [#80293](https://github.com/ClickHouse/ClickHouse/pull/80293) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 在 `SHOW ... LIKE` 查询中高亮显示元字符。修复了 [#80275](https://github.com/ClickHouse/ClickHouse/issues/80275) 中的问题。[#80297](https://github.com/ClickHouse/ClickHouse/pull/80297) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
  #* 在 `clickhouse-local` 中使 SQL UDF 持久化。此前创建的函数会在启动时加载。修复了 [#80085](https://github.com/ClickHouse/ClickHouse/issues/80085) 中的问题。[#80300](https://github.com/ClickHouse/ClickHouse/pull/80300) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 支持对 `Time`/`Time64` 类型的比较。 [#80327](https://github.com/ClickHouse/ClickHouse/pull/80327) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 修复 `EXPLAIN PLAN` 中对 `DISTINCT` 预处理步骤的描述。[#80330](https://github.com/ClickHouse/ClickHouse/pull/80330) ([UnamedRus](https://github.com/UnamedRus)).
* 允许在 ODBC/JDBC 中使用命名集合。 [#80334](https://github.com/ClickHouse/ClickHouse/pull/80334) ([Andrey Zvonov](https://github.com/zvonand))。
* 启用多投影过滤功能，允许在 part 级过滤中使用多个投影。此更改解决了 [#55525](https://github.com/ClickHouse/ClickHouse/issues/55525)。这是继 [#78429](https://github.com/ClickHouse/ClickHouse/issues/78429) 之后实现投影索引的第二步。[#80343](https://github.com/ClickHouse/ClickHouse/pull/80343)（[Amos Bird](https://github.com/amosbird)）。
* 用于统计只读磁盘和损坏磁盘数量的指标。在启动 DiskLocalCheckThread 时会记录指示性日志。[#80391](https://github.com/ClickHouse/ClickHouse/pull/80391) ([VicoWu](https://github.com/VicoWu))。
* 实现对支持投影的 `s3_plain_rewritable` 存储的支持。在之前的版本中，当对象被移动时，S3 中引用投影的元数据对象不会被更新。关闭 [#70258](https://github.com/ClickHouse/ClickHouse/issues/70258)。[#80393](https://github.com/ClickHouse/ClickHouse/pull/80393)（[Sav](https://github.com/sberss)）。
* 并行副本使用单独的连接超时设置，请参阅 `parallel_replicas_connect_timeout_ms`。在此之前，并行副本查询使用 `connect_timeout_with_failover_ms`/`connect_timeout_with_failover_secure_ms` 作为连接超时（默认 1 秒）。[#80421](https://github.com/ClickHouse/ClickHouse/pull/80421)（[Igor Nikonov](https://github.com/devcrafter)）。
* `SYSTEM UNFREEZE` 命令不会在只读磁盘和只写一次磁盘上尝试查找数据部分。解决了 [#80430](https://github.com/ClickHouse/ClickHouse/issues/80430)。[#80432](https://github.com/ClickHouse/ClickHouse/pull/80432)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 将已合并数据片段消息的日志级别从 INFO 更改为 TRACE。 [#80476](https://github.com/ClickHouse/ClickHouse/pull/80476) ([Hans Krutzer](https://github.com/hkrutzer)).
* 为 Native 格式中的 Dynamic 和 JSON 实现扁平化序列化，使在序列化/反序列化 Dynamic 和 JSON 数据时无需使用诸如 Dynamic 的 shared variant、JSON 的 shared data 等特殊结构。可以通过设置 `output_format_native_use_flattened_dynamic_and_json_serialization` 来启用此序列化方式。此序列化方式可用于在不同语言的客户端中更方便地在 TCP 协议下支持 Dynamic 和 JSON。 [#80499](https://github.com/ClickHouse/ClickHouse/pull/80499) ([Pavel Kruglov](https://github.com/Avogar))。
* 修改 Iceberg 表分区裁剪的默认行为。[#80583](https://github.com/ClickHouse/ClickHouse/pull/80583)（[Melvyn Peignon](https://github.com/melvynator)）。
* 为索引搜索算法的可观测性添加两个新的 ProfileEvents：`IndexBinarySearchAlgorithm` 和 `IndexGenericExclusionSearchAlgorithm`。[#80679](https://github.com/ClickHouse/ClickHouse/pull/80679)（[Pablo Marcos](https://github.com/pamarcos)）。
* 在旧版内核上，对于不支持的 `MADV_POPULATE_WRITE` 不再在日志中输出告警（以避免日志噪声）。[#80704](https://github.com/ClickHouse/ClickHouse/pull/80704) ([Robert Schulze](https://github.com/rschu1ze)).
* 在 TTL 中新增对 Date32 和 DateTime64 的支持。[#80710](https://github.com/ClickHouse/ClickHouse/pull/80710)（[Andrey Zvonov](https://github.com/zvonand)）。
* 调整 `max_merge_delayed_streams_for_parallel_write` 的兼容性参数值。 [#80760](https://github.com/ClickHouse/ClickHouse/pull/80760) ([Azat Khuzhin](https://github.com/azat)).
* 修复崩溃问题：如果在析构函数中尝试删除用于将临时数据溢写到磁盘的临时文件时抛出异常，程序可能会终止。 [#80776](https://github.com/ClickHouse/ClickHouse/pull/80776) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 为 `SYSTEM SYNC REPLICA` 命令添加 `IF EXISTS` 修饰符。 [#80810](https://github.com/ClickHouse/ClickHouse/pull/80810) ([Raúl Marín](https://github.com/Algunenano)).
* 扩展关于 &quot;Having zero bytes, but read range is not finished...&quot; 的异常消息，在 `system.filesystem_cache` 中新增 `finished_download_time` 列。 [#80849](https://github.com/ClickHouse/ClickHouse/pull/80849) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 此前，全文索引不支持 `packed` 存储，因为段 ID 需要通过在磁盘上实时读写 `.gin_sid` 文件来更新。而在 `packed` 存储下，不支持从未提交文件中读取值，这就会引发问题。[#80852](https://github.com/ClickHouse/ClickHouse/pull/80852) ([Elmi Ahmadov](https://github.com/ahmadov))。
* 在将 `EXPLAIN` 与 `indexes = 1` 一起使用时，在其输出中添加一个搜索算法部分。该部分会显示 “binary search” 或 “generic exclusion search”。 [#80881](https://github.com/ClickHouse/ClickHouse/pull/80881) ([Pablo Marcos](https://github.com/pamarcos))。
* 在 2024 年初，由于新的 analyzer 默认未启用，`prefer_column_name_to_alias` 在 MySQL 处理程序中被硬编码为 `True`。现在，它已不再被硬编码。[#80916](https://github.com/ClickHouse/ClickHouse/pull/80916)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 现在，`system.iceberg_history` 会显示针对 glue 或 iceberg rest 等 catalog 数据库的历史记录，并且将 `system.iceberg_history` 中的 `table_name` 和 `database_name` 列分别重命名为 `table` 和 `database`，以保持一致性。[#80975](https://github.com/ClickHouse/ClickHouse/pull/80975) ([alesapin](https://github.com/alesapin))。
* 为 `merge` 表函数启用只读模式，从而在使用它时不再需要 `CREATE TEMPORARY TABLE` 权限。 [#80981](https://github.com/ClickHouse/ClickHouse/pull/80981) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
* 优化内存缓存的自检能力（在 `system.metrics` 中公开缓存相关信息，以补充 `system.asynchronouse_metrics` 的不完整性）。在 `dashboard.html` 中新增以内存缓存大小（字节数）为单位的展示。`VectorSimilarityIndexCacheSize`/`IcebergMetadataFilesCacheSize` 已重命名为 `VectorSimilarityIndexCacheBytes`/`IcebergMetadataFilesCacheBytes`。[#81023](https://github.com/ClickHouse/ClickHouse/pull/81023) ([Azat Khuzhin](https://github.com/azat)).
* 在从 system.rocksdb 读取时，忽略那些使用无法包含 RocksDB 表的引擎的数据库。 [#81083](https://github.com/ClickHouse/ClickHouse/pull/81083) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* 允许在 `clickhouse-local` 配置文件中配置 `filesystem_caches` 和 `named_collections`。 [#81105](https://github.com/ClickHouse/ClickHouse/pull/81105) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 修复 `INSERT` 查询中 `PARTITION BY` 的高亮显示问题。在先前版本中，`PARTITION BY` 未被高亮为关键字。[#81106](https://github.com/ClickHouse/ClickHouse/pull/81106) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
  #* 对 Web UI 进行两项小改进：正确处理没有输出的查询，例如 `CREATE`、`INSERT`（直到最近，这些查询会导致加载指示器一直旋转）；- 双击表时滚动到顶部。[#81131](https://github.com/ClickHouse/ClickHouse/pull/81131) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
  #* 将 `c-ares` 更新到 `v1.34.5`。[#81159](https://github.com/ClickHouse/ClickHouse/pull/81159) ([Konstantin Bogdanov](https://github.com/thevar1able)).
  #* 将 curl 升级到 8.14，以修复 CVE-2025-5025 和 CVE-2025-4947。[#81171](https://github.com/ClickHouse/ClickHouse/pull/81171) ([larryluogit](https://github.com/larryluogit)).
  #* 将 libarchive 升级到 3.7.9，以修复以下问题：CVE-2024-20696 CVE-2025-25724 CVE-2024-48958 CVE-2024-57970 CVE-2025-1632 CVE-2024-48957 CVE-2024-48615。[#81174](https://github.com/ClickHouse/ClickHouse/pull/81174) ([larryluogit](https://github.com/larryluogit)).
  #* 将 libxml2 升级到 2.14.3。[#81187](https://github.com/ClickHouse/ClickHouse/pull/81187) ([larryluogit](https://github.com/larryluogit)).
* `MemoryResidentWithoutPageCache` 表示服务器进程使用的物理内存量（以字节为单位），不包括用户态页缓存。当启用用户态页缓存时，该指标能更准确地反映实际内存使用情况。禁用用户态页缓存时，该值等于 MemoryResident。 [#81233](https://github.com/ClickHouse/ClickHouse/pull/81233) ([Jayme Bird](https://github.com/jaymebrd))。
* 将客户端、本地服务器、Keeper 客户端和 disks 应用中手动记录的异常标记为已记录，从而避免重复记录日志。 [#81271](https://github.com/ClickHouse/ClickHouse/pull/81271) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* 将 `use_skip_indexes_if_final` 和 `use_skip_indexes_if_final_exact_mode` 的默认设置现已改为 `True`。带有 `FINAL` 子句的查询现在将在适用时使用跳过索引（skip indexes）来预筛选 granule，并同时读取与匹配主键范围对应的任何额外 granule。若需要保留之前产生近似/不精确结果的行为，用户可在经过谨慎评估后将 `use_skip_indexes_if_final_exact_mode` 设置为 `False`。[#81331](https://github.com/ClickHouse/ClickHouse/pull/81331) ([Shankar Iyer](https://github.com/shankar-iyer))。
  #* 当在 Web UI 中存在多个查询时，将会运行光标所在的那个查询。为 [#80977](https://github.com/ClickHouse/ClickHouse/issues/80977) 的延续。[#81354](https://github.com/ClickHouse/ClickHouse/pull/81354) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 该 PR 解决了转换函数单调性检查中 `is_strict` 实现的问题。目前，一些转换函数（例如 toFloat64(UInt32) 和 toDate(UInt8)）在本应返回 true 时错误地将 `is_strict` 返回为 false。[#81359](https://github.com/ClickHouse/ClickHouse/pull/81359) ([zoomxi](https://github.com/zoomxi))。
  #* 在带日志功能的文件系统中，`mkdir` 会被写入文件系统的日志，并持久化到磁盘上。如果磁盘较慢，这一步可能需要较长时间。因此，很有必要将其移出 reserve 锁的作用范围。[#81371](https://github.com/ClickHouse/ClickHouse/pull/81371) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 在检查某个 `KeyCondition` 是否匹配一个连续区间时，如果键被包裹在一串非严格函数（non-strict function chain）中，则可能需要将 `Constraint::POINT` 转换为 `Constraint::RANGE`。例如：`toDate(event_time) = '2025-06-03'` 对 `event_time` 隐含的区间为：[`2025-06-03 00:00:00`, `2025-06-04 00:00:00`)。该 PR 修复了这一行为。[#81400](https://github.com/ClickHouse/ClickHouse/pull/81400) ([zoomxi](https://github.com/zoomxi)).
  #* 使用 `postgres` 16.9。[#81437](https://github.com/ClickHouse/ClickHouse/pull/81437) ([Konstantin Bogdanov](https://github.com/thevar1able)).
  #* 使用 `openssl` 3.2.4。[#81438](https://github.com/ClickHouse/ClickHouse/pull/81438) ([Konstantin Bogdanov](https://github.com/thevar1able)).
  #* 使用 `abseil-cpp` 2025-01-27。[#81440](https://github.com/ClickHouse/ClickHouse/pull/81440) ([Konstantin Bogdanov](https://github.com/thevar1able)).
  #* 使用 `mongo-c-driver` 1.30.4。[#81449](https://github.com/ClickHouse/ClickHouse/pull/81449) ([Konstantin Bogdanov](https://github.com/thevar1able)).
  #* 使用 `krb5` 1.21.3-final。[#81453](https://github.com/ClickHouse/ClickHouse/pull/81453) ([Konstantin Bogdanov](https://github.com/thevar1able)).
  #* 使用 `orc` 2.1.2。[#81455](https://github.com/ClickHouse/ClickHouse/pull/81455) ([Konstantin Bogdanov](https://github.com/thevar1able)).
  #* 在 `clickhouse-local` 中添加对 `--database` 参数的支持。现在可以切换到之前创建的数据库。此更改关闭了 [#44115](https://github.com/ClickHouse/ClickHouse/issues/44115)。[#81465](https://github.com/ClickHouse/ClickHouse/pull/81465) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
  #* 当指定了 `--host` 或 `--port` 时，`clickhouse`/`ch` 别名将调用 `clickhouse-client` 而不是 `clickhouse-local`。这是对 [#79422](https://github.com/ClickHouse/ClickHouse/issues/79422) 的延续，并关闭了 [#65252](https://github.com/ClickHouse/ClickHouse/issues/65252)。[#81509](https://github.com/ClickHouse/ClickHouse/pull/81509) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 现在我们已经有了 keeper 响应时间分布数据，可以对直方图的桶进行优化。[#81516](https://github.com/ClickHouse/ClickHouse/pull/81516)（[Miсhael Stetsyuk](https://github.com/mstetsyuk)）。
* 将 Iceberg manifest 文件的读取延后到首次执行查询时。[#81619](https://github.com/ClickHouse/ClickHouse/pull/81619) ([Daniil Ivanik](https://github.com/divanik)).
  #* 使用 `grpc` 1.73.0。[#81629](https://github.com/ClickHouse/ClickHouse/pull/81629) ([Konstantin Bogdanov](https://github.com/thevar1able)).
  #* 使用 `delta-kernel-rs` v0.12.1。[#81707](https://github.com/ClickHouse/ClickHouse/pull/81707) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 新增 profile 事件 `PageCacheReadBytes`。 [#81742](https://github.com/ClickHouse/ClickHouse/pull/81742) ([Kseniia Sumarokova](https://github.com/kssenii)).





## 错误修复(官方稳定版本中用户可见的异常行为) {#bug-fix-user-visible-misbehavior-in-an-official-stable-release}


* 修复了使用 `SELECT EXCEPT` 查询的参数化视图。关闭了 [#49447](https://github.com/ClickHouse/ClickHouse/issues/49447)。[#57380](https://github.com/ClickHouse/ClickHouse/pull/57380)（[Nikolay Degterinsky](https://github.com/evillique)）。
* Analyzer：在 join 中对列类型进行提升后修复列投影名称。关闭 [#63345](https://github.com/ClickHouse/ClickHouse/issues/63345)。[#63519](https://github.com/ClickHouse/ClickHouse/pull/63519)（[Dmitry Novik](https://github.com/novikd)）。
* 物化视图可能会启动得太晚，例如在为其提供数据流的 Kafka 表启动之后才启动。 [#72123](https://github.com/ClickHouse/ClickHouse/pull/72123) ([Ilya Golshtein](https://github.com/ilejn))。
* 修复了在启用 analyzer&#95;compatibility&#95;join&#95;using&#95;top&#95;level&#95;identifier 且存在列名冲突时出现的逻辑错误。[#75676](https://github.com/ClickHouse/ClickHouse/pull/75676)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 修复了在多次执行异步（`alter_sync = 0`）`RENAME COLUMN` 和 `ADD COLUMN` 查询后，从 `MergeTree` 表读取时偶发的崩溃问题。[#76346](https://github.com/ClickHouse/ClickHouse/pull/76346) ([Anton Popov](https://github.com/CurtizJ))。
* 在启用 analyzer 时，修复了在创建 `VIEW` 时对 `SELECT` 查询的重写。修复了 [#75956](https://github.com/ClickHouse/ClickHouse/issues/75956)。[#76356](https://github.com/ClickHouse/ClickHouse/pull/76356)（[Dmitry Novik](https://github.com/novikd)）。
* 在启用 `allow_push_predicate_ast_for_distributed_subqueries` 时，修复下推谓词中对 CTE 的使用问题。修复 [#75647](https://github.com/ClickHouse/ClickHouse/issues/75647)。修复 [#79672](https://github.com/ClickHouse/ClickHouse/issues/79672)。[#77316](https://github.com/ClickHouse/ClickHouse/pull/77316)（[Dmitry Novik](https://github.com/novikd)）。
* 修复了通过 `apply_settings_from_server` 从服务器应用 `async_insert` 的问题（此前会在客户端导致 `Unknown packet 11 from server` 错误）。[#77578](https://github.com/ClickHouse/ClickHouse/pull/77578) ([Azat Khuzhin](https://github.com/azat)).
* 修复了在复制数据库中，可刷新物化视图在新添加副本上无法工作的问题。 [#77774](https://github.com/ClickHouse/ClickHouse/pull/77774) ([Michael Kolupaev](https://github.com/al13n321)).
* 修复了可刷新物化视图导致备份损坏的问题。 [#77893](https://github.com/ClickHouse/ClickHouse/pull/77893) ([Michael Kolupaev](https://github.com/al13n321)).
* 修复 `transform` 旧版触发逻辑中的错误。 [#78247](https://github.com/ClickHouse/ClickHouse/pull/78247) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 修复了一个问题：当 `SYSTEM SYNC REPLICA LIGHTWEIGHT 'foo'` 指定的副本不存在时，仍然会错误地报告成功。该命令现在会在尝试同步之前，先在 Keeper 中正确验证该副本是否存在。[#78405](https://github.com/ClickHouse/ClickHouse/pull/78405) ([Jayme Bird](https://github.com/jaymebrd))。
* 修复了在某些情况下与 analyzer 一起使用时未应用二级索引的问题。修复了 [#65607](https://github.com/ClickHouse/ClickHouse/issues/65607)，修复了 [#69373](https://github.com/ClickHouse/ClickHouse/issues/69373)。[#78485](https://github.com/ClickHouse/ClickHouse/pull/78485)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 修复在启用压缩的 HTTP 协议下导出 profile 事件（`NetworkSendElapsedMicroseconds`/`NetworkSendBytes`）的问题（误差不应超过缓冲区大小，通常约为 1 MiB）。 [#78516](https://github.com/ClickHouse/ClickHouse/pull/78516) ([Azat Khuzhin](https://github.com/azat)).
  #* ```sql CREATE TABLE t0 ( key Int32, value Int32 ) ENGINE=MergeTree() PRIMARY KEY key PARTITION BY key % 2;. [#78593](https://github.com/ClickHouse/ClickHouse/pull/78593) ([Vlad](https://github.com/codeworse)).
* 修复在 `JOIN ... USING` 涉及 `ALIAS` 列时分析器产生 `LOGICAL_ERROR` 的问题——现在应抛出更合适的错误。[#78618](https://github.com/ClickHouse/ClickHouse/pull/78618)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* 修复分析器：当 SELECT 包含位置参数时，`CREATE VIEW ... ON CLUSTER` 会失败。 [#78663](https://github.com/ClickHouse/ClickHouse/pull/78663) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 修复在对带有模式推断的表函数执行 `INSERT SELECT` 且 `SELECT` 中包含标量子查询时出现的 `Block structure mismatch` 错误。[#78677](https://github.com/ClickHouse/ClickHouse/pull/78677)（[Pervakov Grigorii](https://github.com/GrigoryPervakov)）。
* 修复分析器：当在 Distributed 表上的 SELECT 查询中设置 `prefer_global_in_and_join=1` 时，应将 `in` 函数替换为 `globalIn`。 [#78749](https://github.com/ClickHouse/ClickHouse/pull/78749) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 修复了若干类型的 `SELECT` 查询，这些查询从使用 `MongoDB` 引擎的表或 `mongodb` 表函数中读取数据：在 `WHERE` 子句中对常量值进行隐式转换的查询（例如 `WHERE datetime = '2025-03-10 00:00:00'`）；带有 `LIMIT` 和 `GROUP BY` 的查询。此前，这些查询可能会返回错误的结果。[#78777](https://github.com/ClickHouse/ClickHouse/pull/78777)（[Anton Popov](https://github.com/CurtizJ)）。
* 修复不同 JSON 类型之间的转换。现在通过先转换为 String 再进行简单类型转换来完成不同 JSON 类型之间的转换。这样效率较低，但可以保证 100% 的准确性。 [#78807](https://github.com/ClickHouse/ClickHouse/pull/78807) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复将 Dynamic 类型转换为 Interval 时的逻辑错误。 [#78813](https://github.com/ClickHouse/ClickHouse/pull/78813) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复 JSON 解析出错时的列回滚问题。 [#78836](https://github.com/ClickHouse/ClickHouse/pull/78836) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在使用常量别名列进行 `JOIN` 时出现的 “bad cast” 错误。[#78848](https://github.com/ClickHouse/ClickHouse/pull/78848)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 不允许在物化视图中对视图与目标表中类型不一致的列使用 `PREWHERE`。 [#78889](https://github.com/ClickHouse/ClickHouse/pull/78889) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复解析 Variant 列损坏二进制数据时的逻辑错误。 [#78982](https://github.com/ClickHouse/ClickHouse/pull/78982) ([Pavel Kruglov](https://github.com/Avogar)).
* 当将 Parquet 批大小设置为 0 时会抛出异常。此前当 `output_format_parquet_batch_size = 0` 时，ClickHouse 会出现挂起问题。现在这一行为已被修复。[#78991](https://github.com/ClickHouse/ClickHouse/pull/78991) ([daryawessely](https://github.com/daryawessely))。
* 修复紧凑部件中使用 basic 格式的 Variant 判别符的反序列化问题。该问题是在 [https://github.com/ClickHouse/ClickHouse/pull/55518](https://github.com/ClickHouse/ClickHouse/pull/55518) 中引入的。[#79000](https://github.com/ClickHouse/ClickHouse/pull/79000)（[Pavel Kruglov](https://github.com/Avogar)）。
* `complex_key_ssd_cache` 类型的字典现在会拒绝 `block_size` 和 `write_buffer_size` 为零或负数的参数值（问题 [#78314](https://github.com/ClickHouse/ClickHouse/issues/78314)）。[#79028](https://github.com/ClickHouse/ClickHouse/pull/79028)（[Elmi Ahmadov](https://github.com/ahmadov)）。
* 避免在 SummingMergeTree 中对非聚合列使用 Field。这可能会在 SummingMergeTree 中使用 Dynamic/Variant 类型时导致意外错误。[#79051](https://github.com/ClickHouse/ClickHouse/pull/79051) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复了 analyzer 中从物化视图读取数据时，当目标表为分布式表且表头不同所导致的问题。 [#79059](https://github.com/ClickHouse/ClickHouse/pull/79059) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复了在一个非常特定的场景下发生的崩溃：当在 `ON CLUSTER` 查询的 `CONSTRAINT` 部分中使用 `currentDatabase` 函数时会触发崩溃。修复问题 [#78100](https://github.com/ClickHouse/ClickHouse/issues/78100)。[#79070](https://github.com/ClickHouse/ClickHouse/pull/79070)（[pufit](https://github.com/pufit)）。
* 修复了一个问题：在对存在批量插入的表进行查询时，`arrayUnion()` 会返回多余（错误）的值。修复了 [#75057](https://github.com/ClickHouse/ClickHouse/issues/75057)。[#79079](https://github.com/ClickHouse/ClickHouse/pull/79079)（[Peter Nguyen](https://github.com/petern48)）。
* 修复跨服务器查询中 external roles 传递的问题。[#79099](https://github.com/ClickHouse/ClickHouse/pull/79099) ([Andrey Zvonov](https://github.com/zvonand))。
* 始终为 S3 的 ListObject 操作设置前缀。 [#79114](https://github.com/ClickHouse/ClickHouse/pull/79114) ([Azat Khuzhin](https://github.com/azat)).
* 修复了一个 bug：在对包含批量插入的表调用 `arrayUnion()` 时，会返回多余的（错误的）值。修复 [#79157](https://github.com/ClickHouse/ClickHouse/issues/79157)。[#79158](https://github.com/ClickHouse/ClickHouse/pull/79158)（[Peter Nguyen](https://github.com/petern48)）。
* 修复过滤下推后的逻辑错误。 [#79164](https://github.com/ClickHouse/ClickHouse/pull/79164) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* 改为在 SingleValueDataGeneric 中使用 IColumn 而不是 Field。这修复了某些聚合函数（例如对 `Dynamic/Variant/JSON` 类型的 `argMax`）返回值不正确的问题。[#79166](https://github.com/ClickHouse/ClickHouse/pull/79166) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复在通过基于 HTTP 的端点使用 delta-kernel 实现的 DeltaLake 表引擎时的问题，并修复 NOSIGN。解决 [#78124](https://github.com/ClickHouse/ClickHouse/issues/78124)。[#79203](https://github.com/ClickHouse/ClickHouse/pull/79203)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* Keeper 修复：避免因 multi 请求失败而触发 watch。[#79247](https://github.com/ClickHouse/ClickHouse/pull/79247) ([Antonio Andelic](https://github.com/antonio2368)).
* 在 `IN` 中禁止使用 Dynamic 和 JSON 类型。由于当前对 `IN` 的实现，这可能会导致产生不正确的结果。在 `IN` 中正确支持这些类型较为复杂，可能会在未来实现。[#79282](https://github.com/ClickHouse/ClickHouse/pull/79282)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复 JSON 类型解析时的重复路径检查。 [#79317](https://github.com/ClickHouse/ClickHouse/pull/79317) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复 SecureStreamSocket 连接问题。[#79383](https://github.com/ClickHouse/ClickHouse/pull/79383)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 修复在加载包含数据的 plain&#95;rewritable 磁盘时出现的问题。 [#79439](https://github.com/ClickHouse/ClickHouse/pull/79439) ([Julia Kartseva](https://github.com/jkartseva)).
* 修复在 MergeTree 的 Wide 部分中动态检测子列时发生的崩溃。[#79466](https://github.com/ClickHouse/ClickHouse/pull/79466) ([Pavel Kruglov](https://github.com/Avogar)).
* 仅在初始建表查询时验证表名长度。不要对后续创建执行此验证，以避免破坏向后兼容性。[#79488](https://github.com/ClickHouse/ClickHouse/pull/79488) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* 在若干使用稀疏列的表的场景中修复了 `Block structure mismatch` 错误。 [#79491](https://github.com/ClickHouse/ClickHouse/pull/79491) ([Anton Popov](https://github.com/CurtizJ)).
* 修复了两个会触发 `Logical Error: Can't set alias of * of Asterisk on alias` 的场景。[#79505](https://github.com/ClickHouse/ClickHouse/pull/79505) ([Raúl Marín](https://github.com/Algunenano))。
* 修复了在 Azure Blob Storage 上应用 `use_native_copy` 和 `allow_azure_native_copy` 设置的问题，并更新为仅在凭据匹配时才使用原生复制，从而解决了 [#78964](https://github.com/ClickHouse/ClickHouse/issues/78964)。[#79561](https://github.com/ClickHouse/ClickHouse/pull/79561)（[Smita Kulkarni](https://github.com/SmitaRKulkarni)）。
* 修复在重命名 Atomic 类型数据库时使用错误路径的问题。 [#79569](https://github.com/ClickHouse/ClickHouse/pull/79569) ([Tuan Pham Anh](https://github.com/tuanpach))。
* 修复在同时按 JSON 列和其他列排序时的问题。 [#79591](https://github.com/ClickHouse/ClickHouse/pull/79591) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在从远程读取且同时禁用 `use_hedged_requests` 和 `allow_experimental_parallel_reading_from_replicas` 时出现的结果重复返回问题。 [#79599](https://github.com/ClickHouse/ClickHouse/pull/79599) ([Eduard Karacharov](https://github.com/korowa)).
* 修复在使用 Unity Catalog 时 delta-kernel 实现中发生的崩溃问题。[#79677](https://github.com/ClickHouse/ClickHouse/pull/79677)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 解析自动发现集群相关的宏。 [#79696](https://github.com/ClickHouse/ClickHouse/pull/79696) ([Anton Ivashkin](https://github.com/ianton-ru)).
* 修复在检查某列是否为相关列时，由于该列的来源作用域未知而导致的逻辑错误。修复 [#78183](https://github.com/ClickHouse/ClickHouse/issues/78183)。修复 [#79451](https://github.com/ClickHouse/ClickHouse/issues/79451)。[#79727](https://github.com/ClickHouse/ClickHouse/pull/79727)（[Dmitry Novik](https://github.com/novikd)）。
* 修复在使用 ColumnConst 和 Analyzer 的 grouping sets 中出现的错误结果。[#79743](https://github.com/ClickHouse/ClickHouse/pull/79743) ([Andrey Zvonov](https://github.com/zvonand)).
* 修复在本地副本已过期的情况下，从分布式表读取时本地分片结果出现重复的问题。 [#79761](https://github.com/ClickHouse/ClickHouse/pull/79761) ([Eduard Karacharov](https://github.com/korowa))。
* 对配置不正确的 `page_cache_limits` 进行适当处理。 [#79805](https://github.com/ClickHouse/ClickHouse/pull/79805) ([Bharat Nallan](https://github.com/bharatnc))。
* 修正了当可变长度格式符（例如 `%W`，表示星期几，如 `Monday`、`Tuesday` 等）后接复合格式符（一次输出多个组件的格式符，例如 `%D`，即美国日期格式 `05/04/25`）时，SQL 函数 `formatDateTime` 的结果。 [#79835](https://github.com/ClickHouse/ClickHouse/pull/79835) ([Robert Schulze](https://github.com/rschu1ze))。
* IcebergS3 支持 COUNT 优化，但 IcebergS3Cluster 不支持。因此，在集群模式下返回的 count() 结果可能是副本数量的倍数。[#79844](https://github.com/ClickHouse/ClickHouse/pull/79844)（[wxybear](https://github.com/wxybear)）。
* 修复符号位为负的 NaN 的排序顺序。 [#79847](https://github.com/ClickHouse/ClickHouse/pull/79847) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。
* 现在 `GROUP BY ALL` 不再考虑 `GROUPING` 子句。[#79915](https://github.com/ClickHouse/ClickHouse/pull/79915) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 修复了在延迟物化模式下，如果在投影之前查询执行未使用任何列时会出现 `AMBIGUOUS_COLUMN_NAME` 错误的问题。例如 `SELECT * FROM t ORDER BY rand() LIMIT 5`。[#79926](https://github.com/ClickHouse/ClickHouse/pull/79926)（[Igor Nikonov](https://github.com/devcrafter)）。
* 修复了 `TopK` / `TopKWeighted` 函数中不正确的状态合并问题，该问题即使在容量尚未耗尽时也会导致误差值过大。 [#79939](https://github.com/ClickHouse/ClickHouse/pull/79939) ([Joel Höner](https://github.com/athre0z)).
* 在查询 `CREATE DATABASE datalake ENGINE = DataLakeCatalog(\'http://catalog:8181\', \'admin\', \'password\')` 中隐藏密码。 [#79941](https://github.com/ClickHouse/ClickHouse/pull/79941) ([Han Fei](https://github.com/hanfei1991)).
* 允许在 `JOIN USING` 中指定别名。当列被重命名时可以通过该别名来指定它（例如，由于 `ARRAY JOIN`）。修复 [#73707](https://github.com/ClickHouse/ClickHouse/issues/73707)。[#79942](https://github.com/ClickHouse/ClickHouse/pull/79942)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 在 `azure_blob_storage` 对象存储中遵守 `readonly` 设置。[#79954](https://github.com/ClickHouse/ClickHouse/pull/79954) ([Julia Kartseva](https://github.com/jkartseva)).
* 修复了在使用带反斜杠转义字符的 `match(column, '^…')` 时可能导致的查询结果不正确或内存不足崩溃的问题。[#79969](https://github.com/ClickHouse/ClickHouse/pull/79969) ([filimonov](https://github.com/filimonov))。
* 为数据湖禁用 Hive 分区，部分解决了 [https://github.com/issues/assigned?issue=ClickHouse%7CClickHouse%7C79937](https://github.com/issues/assigned?issue=ClickHouse%7CClickHouse%7C79937)。[#80005](https://github.com/ClickHouse/ClickHouse/pull/80005)（[Daniil Ivanik](https://github.com/divanik)）。
* 无法应用带有 lambda 表达式的 skip 索引。修复当索引定义中的高阶函数与查询中的完全一致时的处理问题。 [#80025](https://github.com/ClickHouse/ClickHouse/pull/80025) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
* 使带有 `UNION` 的物化视图能在新副本上正确工作。 [#80037](https://github.com/ClickHouse/ClickHouse/pull/80037) ([Samay Sharma](https://github.com/samay-sharma)).
* 在副本上从复制日志执行 `ATTACH_PART` 命令附加数据分片时，修复元数据版本不正确的问题。 [#80038](https://github.com/ClickHouse/ClickHouse/pull/80038) ([Aleksei Filatov](https://github.com/aalexfvk)).
* SQL 函数 `parseDateTime` 中的格式说明符 `%e` 现在可以识别一位数字的日期（例如 `3`），而之前要求使用空格填充（例如 ` 3`）。这使其行为与 MySQL 兼容。若要保留之前的行为，请将设置项 `parsedatetime_e_requires_space_padding` 设为 `1`。（issue [#78243](https://github.com/ClickHouse/ClickHouse/issues/78243)). [#80057](https://github.com/ClickHouse/ClickHouse/pull/80057) ([Robert Schulze](https://github.com/rschu1ze)).
* Executable User Defined Functions (eUDF) 的名称不会像其他函数那样被加入到 `system.query_log` 表的 `used_functions` 列中。此 PR 实现了在请求中使用 eUDF 时，将其名称补充记录到该列中。[#80073](https://github.com/ClickHouse/ClickHouse/pull/80073) ([Kyamran](https://github.com/nibblerenush))。
  #* 修复 ClickHouse 日志中的警告 `Cannot find 'kernel' in '[...]/memory.stat'`（问题 [#77410](https://github.com/ClickHouse/ClickHouse/issues/77410)）。[#80129](https://github.com/ClickHouse/ClickHouse/pull/80129) ([Robert Schulze](https://github.com/rschu1ze))。
* 修复 Arrow 格式中使用 LowCardinality(FixedString) 时的逻辑错误。 [#80156](https://github.com/ClickHouse/ClickHouse/pull/80156) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复从 Merge 引擎读取子列的问题。[#80158](https://github.com/ClickHouse/ClickHouse/pull/80158) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复 `KeyCondition` 中数值类型比较相关的错误。[#80207](https://github.com/ClickHouse/ClickHouse/pull/80207) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 在对带有 projections 的表应用延迟物化时，修复 `AMBIGUOUS_COLUMN_NAME` 错误。 [#80251](https://github.com/ClickHouse/ClickHouse/pull/80251) ([Igor Nikonov](https://github.com/devcrafter)).
* 修复在使用隐式投影时，对 LIKE &#39;ab&#95;c%&#39; 这类字符串前缀过滤条件的不正确 count 优化。此修复解决了 [#80250](https://github.com/ClickHouse/ClickHouse/issues/80250)。[#80261](https://github.com/ClickHouse/ClickHouse/pull/80261)（[Amos Bird](https://github.com/amosbird)）。
* 修复 MongoDB 文档中嵌套数值字段被错误序列化为字符串的问题。移除对来自 MongoDB 的文档的最大深度限制。[#80289](https://github.com/ClickHouse/ClickHouse/pull/80289)（[Kirill Nikiforov](https://github.com/allmazz)）。
* 在 Replicated 数据库中对 RMT 的元数据检查放宽限制。关闭 [#80296](https://github.com/ClickHouse/ClickHouse/issues/80296)。[#80298](https://github.com/ClickHouse/ClickHouse/pull/80298)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 修正 PostgreSQL 存储中 DateTime 和 DateTime64 的文本表示。[#80301](https://github.com/ClickHouse/ClickHouse/pull/80301)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* 允许在 `StripeLog` 表中使用带时区的 `DateTime`。这解决了 [#44120](https://github.com/ClickHouse/ClickHouse/issues/44120)。[#80304](https://github.com/ClickHouse/ClickHouse/pull/80304)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在查询计划步骤会改变行数的情况下，对包含非确定性函数的谓词禁用 filter-push-down。修复了 [#40273](https://github.com/ClickHouse/ClickHouse/issues/40273)。[#80329](https://github.com/ClickHouse/ClickHouse/pull/80329)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 修复在带有子列的投影中可能出现的逻辑错误和崩溃。[#80333](https://github.com/ClickHouse/ClickHouse/pull/80333) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在 `ON` 表达式不是简单等值条件时，由逻辑 JOIN 步骤上的过滤下推优化导致的 `NOT_FOUND_COLUMN_IN_BLOCK` 错误。修复 [#79647](https://github.com/ClickHouse/ClickHouse/issues/79647) 和 [#77848](https://github.com/ClickHouse/ClickHouse/issues/77848)。[#80360](https://github.com/ClickHouse/ClickHouse/pull/80360)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 修复在分区表中按逆序读取键时产生错误结果的问题。该修复解决了 [#79987](https://github.com/ClickHouse/ClickHouse/issues/79987)。[#80448](https://github.com/ClickHouse/ClickHouse/pull/80448)（[Amos Bird](https://github.com/amosbird)）。
* 修复了在具有可为空键并启用 optimize&#95;read&#95;in&#95;order 的表中出现的错误排序问题。[#80515](https://github.com/ClickHouse/ClickHouse/pull/80515) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。
* 修复了在使用 SYSTEM STOP REPLICATED VIEW 暂停视图后，可刷新的物化视图在执行 DROP 操作时卡住的问题。 [#80543](https://github.com/ClickHouse/ClickHouse/pull/80543) ([Michael Kolupaev](https://github.com/al13n321)).
* 修复在分布式查询中使用常量 `tuple` 时出现的 “Cannot find column” 错误。[#80596](https://github.com/ClickHouse/ClickHouse/pull/80596)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* 在启用 `join_use_nulls` 时修复了分布式表中的 `shardNum` 函数。[#80612](https://github.com/ClickHouse/ClickHouse/pull/80612) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
* 修复在 Merge 引擎中读取仅存在于部分表中的列时出现错误结果的问题。 [#80643](https://github.com/ClickHouse/ClickHouse/pull/80643) ([Pavel Kruglov](https://github.com/Avogar)).
* `iceberg_history` 表中的时间戳现在应当是正确的。[#80711](https://github.com/ClickHouse/ClickHouse/pull/80711) ([Melvyn Peignon](https://github.com/melvynator))。
* 修复对象存储表函数中仅包含单个元素的枚举通配模式的处理。[#80716](https://github.com/ClickHouse/ClickHouse/pull/80716) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 修复了 `Tuple(Dynamic)` 与 `String` 的比较函数中错误的结果类型，该问题会导致逻辑错误。[#80728](https://github.com/ClickHouse/ClickHouse/pull/80728) ([Pavel Kruglov](https://github.com/Avogar))。
* 为 Unity Catalog 添加缺失的受支持数据类型 `timestamp_ntz`。修复 [#79535](https://github.com/ClickHouse/ClickHouse/issues/79535) 和 [#79875](https://github.com/ClickHouse/ClickHouse/issues/79875)。[#80740](https://github.com/ClickHouse/ClickHouse/pull/80740)（[alesapin](https://github.com/alesapin)）。
* 修复在使用 `IN cte` 的分布式查询中出现的 `THERE_IS_NO_COLUMN` 错误。对应问题：[#75032](https://github.com/ClickHouse/ClickHouse/issues/75032)。[#80757](https://github.com/ClickHouse/ClickHouse/pull/80757)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 修复外部 `ORDER BY` 产生过多文件的问题（会导致内存占用过高）。 [#80777](https://github.com/ClickHouse/ClickHouse/pull/80777) ([Azat Khuzhin](https://github.com/azat)).
  #* 此 PR 可能会关闭 [#80742](https://github.com/ClickHouse/ClickHouse/issues/80742)。 [#80783](https://github.com/ClickHouse/ClickHouse/pull/80783) ([zoomxi](https://github.com/zoomxi)).
  #* 修复 Kafka 中的崩溃问题，原因是 get&#95;member&#95;id() 尝试从 NULL 创建 std::string（这很可能只在连接 broker 失败时才会出现）。 [#80793](https://github.com/ClickHouse/ClickHouse/pull/80793) ([Azat Khuzhin](https://github.com/azat)).
* 在关闭 Kafka 引擎之前，应正确等待所有消费者结束运行（如果在关闭后仍有处于活动状态的消费者，可能会触发各种调试断言，并且在表被删除/分离后仍可能在后台从 broker 读取数据）。[#80795](https://github.com/ClickHouse/ClickHouse/pull/80795) ([Azat Khuzhin](https://github.com/azat)).
* 修复由 `predicate-push-down` 优化引起的 `NOT_FOUND_COLUMN_IN_BLOCK` 错误。对应问题 [#80443](https://github.com/ClickHouse/ClickHouse/issues/80443)。[#80834](https://github.com/ClickHouse/ClickHouse/pull/80834)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 修复在带有 `USING` 的 `JOIN` 中解析表函数中的星号 (*) 通配符时的逻辑错误。 [#80894](https://github.com/ClickHouse/ClickHouse/pull/80894) ([Vladimir Cherkasov](https://github.com/vdimir))。
* 修复 Iceberg 元数据文件缓存的内存统计。 [#80904](https://github.com/ClickHouse/ClickHouse/pull/80904) ([Azat Khuzhin](https://github.com/azat)).
* 修复在使用可为空分区键时产生的分区错误。[#80913](https://github.com/ClickHouse/ClickHouse/pull/80913) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* 修复在启用谓词下推的分布式查询（`allow_push_predicate_ast_for_distributed_subqueries=1`）且源表在发起查询的节点上不存在时出现的 `Table does not exist` 错误。修复了 [#77281](https://github.com/ClickHouse/ClickHouse/issues/77281)。[#80915](https://github.com/ClickHouse/ClickHouse/pull/80915)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 修复使用命名窗口的嵌套函数中的逻辑错误。[#80926](https://github.com/ClickHouse/ClickHouse/pull/80926) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* 修复可为空列和浮点列的极值问题。[#80970](https://github.com/ClickHouse/ClickHouse/pull/80970) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。
* 修复在查询 system.tables 时可能出现的崩溃问题（在内存紧张时更容易发生）。[#80976](https://github.com/ClickHouse/ClickHouse/pull/80976) ([Azat Khuzhin](https://github.com/azat)).
* 修复在对其压缩格式由文件扩展名推断的文件执行带截断（truncate）的原子重命名时出现的问题。 [#80979](https://github.com/ClickHouse/ClickHouse/pull/80979) ([Pablo Marcos](https://github.com/pamarcos))。
  #* 修复 ErrorCodes::getName。 [#81032](https://github.com/ClickHouse/ClickHouse/pull/81032) ([RinChanNOW](https://github.com/RinChanNOWWW))。
* 修复了当用户未拥有所有表的访问权限时，无法在 Unity Catalog 中列出表的问题。现在所有表都会被正确列出，尝试从受限表中读取时将抛出异常。[#81044](https://github.com/ClickHouse/ClickHouse/pull/81044) ([alesapin](https://github.com/alesapin))。
* 现在，ClickHouse 在执行 `SHOW TABLES` 查询时会忽略来自数据湖目录的错误和异常响应。修复了问题 [#79725](https://github.com/ClickHouse/ClickHouse/issues/79725)。[#81046](https://github.com/ClickHouse/ClickHouse/pull/81046)（[alesapin](https://github.com/alesapin)）。
* 修复 `JSONExtract` 和 `JSON` 类型在将整数解析为 `DateTime64` 时的解析问题。[#81050](https://github.com/ClickHouse/ClickHouse/pull/81050)（[Pavel Kruglov](https://github.com/Avogar)）。
* 将 `date_time_input_format` 设置体现在模式推断缓存中。 [#81052](https://github.com/ClickHouse/ClickHouse/pull/81052) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在执行 `INSERT` 时，如果在查询已开始但尚未发送列之前表被 `DROP` 而导致的崩溃问题。[#81053](https://github.com/ClickHouse/ClickHouse/pull/81053) ([Azat Khuzhin](https://github.com/azat)).
* 修复 `quantileDeterministic` 中使用未初始化的值的问题。 [#81062](https://github.com/ClickHouse/ClickHouse/pull/81062) ([Azat Khuzhin](https://github.com/azat)).
* 修复 `metadatastoragefromdisk` 磁盘事务的硬链接计数管理，并添加测试。 [#81066](https://github.com/ClickHouse/ClickHouse/pull/81066) ([Sema Checherinda](https://github.com/CheSema)).
* 与其他函数不同，用户定义函数（UDF）的名称不会被添加到 `system.query_log` 表中。本 PR 实现了在请求中使用 UDF 时，将该 UDF 的名称添加到 `used_executable_user_defined_functions` 或 `used_sql_user_defined_functions` 这两列之一中。[#81101](https://github.com/ClickHouse/ClickHouse/pull/81101)（[Kyamran](https://github.com/nibblerenush)）。
* 修复了在通过 HTTP 协议使用文本格式（`JSON`、`Values` 等）进行插入且省略 `Enum` 字段时，出现 `Too large size ... passed to allocator` 错误或可能发生崩溃的问题。 [#81145](https://github.com/ClickHouse/ClickHouse/pull/81145) ([Anton Popov](https://github.com/CurtizJ)).
* 修复在将包含稀疏列的 INSERT 数据块推送到非 MT 物化视图时出现的 LOGICAL&#95;ERROR。 [#81161](https://github.com/ClickHouse/ClickHouse/pull/81161) ([Azat Khuzhin](https://github.com/azat)).
* 修复在交叉复制环境下，`distributed_product_mode_local=local` 出现 `Unknown table expression identifier` 错误的问题。[#81162](https://github.com/ClickHouse/ClickHouse/pull/81162)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 修复了在对 Parquet 文件进行过滤后错误缓存行数的问题。 [#81184](https://github.com/ClickHouse/ClickHouse/pull/81184) ([Michael Kolupaev](https://github.com/al13n321)).
* 修复在使用相对缓存路径时 fs 缓存 `max_size_to_total_space` 设置的问题。 [#81237](https://github.com/ClickHouse/ClickHouse/pull/81237) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复了在以 Parquet 格式输出常量元组或映射时导致 clickhouse-local 崩溃的问题。[#81249](https://github.com/ClickHouse/ClickHouse/pull/81249) ([Michael Kolupaev](https://github.com/al13n321))。
* 校验通过网络接收的数组偏移。 [#81269](https://github.com/ClickHouse/ClickHouse/pull/81269) ([Azat Khuzhin](https://github.com/azat)).
* 修复在连接空表并使用窗口函数的查询中的一些边界情况。该缺陷会导致并行流数量呈爆炸式增长，进而引发 OOM。 [#81299](https://github.com/ClickHouse/ClickHouse/pull/81299) ([Alexander Gololobov](https://github.com/davenger)).
* 针对数据湖集群函数（`deltaLakeCluster`、`icebergCluster` 等）的修复：（1）修复在使用旧版 analyzer 搭配 `Cluster` 函数时，`DataLakeConfiguration` 中可能出现的段错误；（2）移除对数据湖元数据的重复更新（多余的对象存储请求）；（3）修复在未显式指定格式时，对象存储中的冗余列举操作问题（此前已对非集群的数据湖引擎完成修复）。[#81300](https://github.com/ClickHouse/ClickHouse/pull/81300)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 使 `force_restore_data` 标志可用于恢复丢失的 Keeper 元数据。[#81324](https://github.com/ClickHouse/ClickHouse/pull/81324) ([Raúl Marín](https://github.com/Algunenano)).
* 修复 delta-kernel 中的区域错误。修复了 [#79914](https://github.com/ClickHouse/ClickHouse/issues/79914)。[#81353](https://github.com/ClickHouse/ClickHouse/pull/81353)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 禁用 `divideOrNull` 的不正确 JIT。[#81370](https://github.com/ClickHouse/ClickHouse/pull/81370)（[Raúl Marín](https://github.com/Algunenano)）。
* 修复在 MergeTree 表具有较长分区列名时出现的插入错误。[#81390](https://github.com/ClickHouse/ClickHouse/pull/81390) ([hy123q](https://github.com/haoyangqian)).
* 不要将多个 manifest 文件的内容同时存入内存。 [#81470](https://github.com/ClickHouse/ClickHouse/pull/81470) ([Daniil Ivanik](https://github.com/divanik))。
* 修复在关闭后台线程池（`background_.*pool_size`）时可能发生的崩溃。[#81473](https://github.com/ClickHouse/ClickHouse/pull/81473) ([Azat Khuzhin](https://github.com/azat)).
* 修复在使用 `URL` 引擎向表写入时出现的 `Npy` 格式越界读取问题。此修复关闭了 [#81356](https://github.com/ClickHouse/ClickHouse/issues/81356)。[#81502](https://github.com/ClickHouse/ClickHouse/pull/81502)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* Web UI 有可能显示 `NaN%`（典型的 JavaScript 问题）。[#81507](https://github.com/ClickHouse/ClickHouse/pull/81507) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 修复 `database_replicated_enforce_synchronous_settings=1` 时 `DatabaseReplicated` 的问题。[#81564](https://github.com/ClickHouse/ClickHouse/pull/81564)（[Azat Khuzhin](https://github.com/azat)）。
* 修复 LowCardinality(Nullable(...)) 类型的排序顺序。 [#81583](https://github.com/ClickHouse/ClickHouse/pull/81583) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。
* 如果尚未从套接字完整读取请求，服务器不应保持 HTTP 连接。[#81595](https://github.com/ClickHouse/ClickHouse/pull/81595) ([Sema Checherinda](https://github.com/CheSema)).
* 使标量相关子查询返回投影表达式的可为空结果。修复相关子查询产生空结果集时的处理方式。[#81632](https://github.com/ClickHouse/ClickHouse/pull/81632) ([Dmitry Novik](https://github.com/novikd))。
* 修复在对 `ReplicatedMergeTree` 执行 `ATTACH` 操作时出现的 `Unexpected relative path for a deduplicated part` 错误。[#81647](https://github.com/ClickHouse/ClickHouse/pull/81647) ([Azat Khuzhin](https://github.com/azat))。
* 查询设置 `use_iceberg_partition_pruning` 对 iceberg 存储无效，因为它使用的是全局上下文而非查询上下文。由于其默认值为 true，因此这一问题并不严重。此 PR 修复了该问题。[#81673](https://github.com/ClickHouse/ClickHouse/pull/81673) ([Han Fei](https://github.com/hanfei1991)).
* 为 MergeTree 设置 `merge_max_block_size` 添加验证，以确保其不为零。[#81693](https://github.com/ClickHouse/ClickHouse/pull/81693) ([Bharat Nallan](https://github.com/bharatnc))。
* 修复 `clickhouse-local` 中导致 `DROP VIEW ` 查询卡死的问题。[#81705](https://github.com/ClickHouse/ClickHouse/pull/81705)（[Bharat Nallan](https://github.com/bharatnc)）。
* 修复 StorageRedis 在某些情况下的 JOIN 操作。 [#81736](https://github.com/ClickHouse/ClickHouse/pull/81736) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。
* 修复在启用旧分析器且使用空 `USING ()` 时 `ConcurrentHashJoin` 中出现的崩溃问题。[#81754](https://github.com/ClickHouse/ClickHouse/pull/81754) ([Nikita Taranov](https://github.com/nickitat)).
* Keeper 修复：当日志中存在无效条目时，阻止提交新的日志。此前，如果 leader 错误地应用了某些日志条目，它仍会继续提交新的日志，即使 follower 会检测到摘要不匹配并中止。[#81780](https://github.com/ClickHouse/ClickHouse/pull/81780)（[Antonio Andelic](https://github.com/antonio2368)）。