---
slug: /changelogs/24.8
title: 'v24.8 云端版本更新日志'
description: 'v24.8 快速发布更新日志'
keywords: ['changelog', 'cloud']
sidebar_label: '24.8'
sidebar_position: 6
doc_type: 'changelog'
---

基于 v24.8 版本的 ClickHouse Cloud 服务相关更新。



## 向后不兼容的变更 {#backward-incompatible-change}

- 更改 Variant 数据类型的二进制序列化:添加紧凑模式以避免对仅包含单一变体或仅包含 NULL 值的颗粒多次写入相同的判别符。添加 MergeTree 设置 use_compact_variant_discriminators_serialization,该设置默认启用。请注意,Variant 类型仍处于实验阶段,序列化中的向后不兼容变更不应影响您,除非您之前已与技术支持团队合作提前启用了此功能。[#62774](https://github.com/ClickHouse/ClickHouse/pull/62774) (Kruglov Pavel)。

- 禁止在 Replicated 数据库中使用 CREATE MATERIALIZED VIEW ... ENGINE Replicated\*MergeTree POPULATE AS SELECT ...。此特定 PR 仅适用于仍在使用 ReplicatedMergeTree 的用户。[#63963](https://github.com/ClickHouse/ClickHouse/pull/63963) (vdimir)。

- 指标 KeeperOutstandingRequets 已重命名为 KeeperOutstandingRequests。这修复了 [#66179](https://github.com/ClickHouse/ClickHouse/issues/66179) 中报告的拼写错误。[#66206](https://github.com/ClickHouse/ClickHouse/pull/66206) (Robert Schulze)。

- clickhouse-client 和 clickhouse-local 现在默认使用多查询模式(而非单查询模式)。例如,clickhouse-client -q "SELECT 1; SELECT 2" 现在可以正常工作,而用户以前必须添加 --multiquery(或 -n)。--multiquery/-n 开关已过时。多查询语句中的 INSERT 查询根据其 FORMAT 子句进行特殊处理:如果 FORMAT 是 VALUES(最常见的情况),INSERT 语句的结束由查询末尾的尾随分号 ; 表示。对于所有其他 FORMAT(例如 CSV 或 JSONEachRow),INSERT 语句的结束由查询末尾的两个换行符 \n\n 表示。[#63898](https://github.com/ClickHouse/ClickHouse/pull/63898) (wxybear)。

- 在以前的版本中,可以通过在数据类型名称后附加 WithDictionary 来使用 LowCardinality 数据类型的替代语法。这是最初的工作实现,从未记录或向公众公开。现在,它已被弃用。如果您使用了此语法,则必须 ALTER 您的表并将数据类型重命名为 LowCardinality。[#66842](https://github.com/ClickHouse/ClickHouse/pull/66842)(Alexey Milovidov)。

- 修复与分布式目标表一起使用的 Buffer 存储引擎的逻辑错误。这是一个向后不兼容的变更:如果表在查询中出现多次(例如,在自连接中),使用 Buffer 与分布式目标表的查询可能会停止工作。[#67015](https://github.com/vdimir) (vdimir)。

- 在以前的版本中,使用接近零的负参数调用基于 Gamma 函数的随机分布函数(如卡方分布、Student 分布、Fisher 分布)会导致长时间计算或无限循环。在新版本中,使用零或负参数调用这些函数将产生异常。这解决了 [#67297](https://github.com/ClickHouse/ClickHouse/issues/67297)。[#67326](https://github.com/ClickHouse/ClickHouse/pull/67326) (Alexey Milovidov)。

- 在以前的版本中,如果要求生成非常大的数组,arrayWithConstant 可能会很慢。在新版本中,每个数组限制为 1 GB。这解决了 [#32754](https://github.com/ClickHouse/ClickHouse/issues/32754)。[#67741](https://github.com/ClickHouse/ClickHouse/pull/67741) (Alexey Milovidov)。

- 修复 REPLACE 修饰符格式化(禁止省略括号)。[#67774](https://github.com/ClickHouse/ClickHouse/pull/67774) (Azat Khuzhin)。


## 新功能 {#new-feature}

- 扩展 tuple 函数以在查询中构造命名元组。引入 tupleNames 函数用于从元组中提取名称。[#54881](https://github.com/ClickHouse/ClickHouse/pull/54881) (Amos Bird)。

- 为 full_sorting_join 算法添加 ASOF JOIN 支持,关闭 [#54493](https://github.com/ClickHouse/ClickHouse/issues/54493)。[#55051](https://github.com/ClickHouse/ClickHouse/pull/55051) (vdimir)。

- 添加了新的表函数 fuzzQuery。该函数允许对给定的查询字符串进行随机变化修改。示例:SELECT query FROM fuzzQuery('SELECT 1');。[#62103](https://github.com/ClickHouse/ClickHouse/pull/62103) (pufit)。

- 添加新的窗口函数 percent_rank。[#62747](https://github.com/ClickHouse/ClickHouse/pull/62747) (lgbo)。

- 在 clickhouse-client 中支持 JWT 身份验证。[#62829](https://github.com/ClickHouse/ClickHouse/pull/62829) (Konstantin Bogdanov)。

- 添加 SQL 函数 changeYear、changeMonth、changeDay、changeHour、changeMinute、changeSecond。例如,SELECT changeMonth(toDate('2024-06-14'), 7) 返回日期 2024-07-14。[#63186](https://github.com/ClickHouse/ClickHouse/pull/63186) (cucumber95)。

- 添加 system.error_log 系统表,其中包含来自 system.errors 表的错误值历史记录,定期刷新到磁盘。[#65381](https://github.com/ClickHouse/ClickHouse/pull/65381) (Pablo Marcos)。

- 添加聚合函数 groupConcat。功能与 arrayStringConcat( groupArray(column), ',') 基本相同,可以接收 2 个参数:字符串分隔符和要处理的元素数量。[#65451](https://github.com/ClickHouse/ClickHouse/pull/65451) (Yarik Briukhovetskyi)。

- 添加 AzureQueue 存储引擎。[#65458](https://github.com/ClickHouse/ClickHouse/pull/65458) (Kseniia Sumarokova)。

- 添加新设置以禁用/启用将页面索引写入 parquet 文件。[#65475](https://github.com/ClickHouse/ClickHouse/pull/65475) (lgbo)。

- 使用表函数 file 时自动在目录路径末尾附加通配符 \*。[#66019](https://github.com/ClickHouse/ClickHouse/pull/66019) (Zhidong (David) Guo)。

- 在非交互模式下为客户端添加 --memory-usage 选项。[#66393](https://github.com/ClickHouse/ClickHouse/pull/66393) (vdimir)。

- 为 S3 表引擎添加 \_etag 虚拟列。修复 [#65312](https://github.com/ClickHouse/ClickHouse/issues/65312)。[#65386](https://github.com/ClickHouse/ClickHouse/pull/65386) (skyoct)

- 此拉取请求为不同引擎(File、URL、S3、AzureBlobStorage、HDFS)引入了 Hive 风格分区。Hive 风格分区将数据组织到分区子目录中,使查询和管理大型数据集更加高效。目前,它仅创建具有相应名称和数据的虚拟列。后续 PR 将引入相应的数据过滤功能(性能提升)。[#65997](https://github.com/ClickHouse/ClickHouse/pull/65997) (Yarik Briukhovetskyi)。

- 添加 printf 函数以实现 Spark 兼容性。[#66257](https://github.com/ClickHouse/ClickHouse/pull/66257) (李扬)。

- 添加了使用 readWKTLineString 函数读取 WKT 格式 MULTILINESTRING 几何图形的支持。[#67647](https://github.com/ClickHouse/ClickHouse/pull/67647) (Jacob Reckhard)。

- 为查询缓存添加了标记(命名空间)机制。具有不同标记的相同查询会被查询缓存视为不同的查询。示例:SELECT 1 SETTINGS use_query_cache = 1, query_cache_tag = 'abc' 和 SELECT 1 SETTINGS use_query_cache = 1, query_cache_tag = 'def' 现在会创建不同的查询缓存条目。[#68235](https://github.com/ClickHouse/ClickHouse/pull/68235)(sakulali)。
