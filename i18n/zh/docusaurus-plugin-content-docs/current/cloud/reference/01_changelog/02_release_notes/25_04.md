---
slug: /changelogs/25.4
title: 'v25.4 Cloud 更新日志'
description: 'v25.4 快速发布版本更新日志'
keywords: ['changelog', 'cloud']
sidebar_label: '25.4'
sidebar_position: 3
doc_type: 'changelog'
---



## 不兼容变更 {#backward-incompatible-changes}


* Parquet 输出格式现在会将 Date 和 DateTime 列转换为 Parquet 原生支持的日期/时间类型,而不是将它们写入为原始数值。DateTime 现在转换为 DateTime64(3)(原先为 UInt32);可通过设置 `output_format_parquet_datetime_as_uint32` 恢复旧版行为。Date 现在转换为 Date32(原先为 UInt16)。[#70950](https://github.com/ClickHouse/ClickHouse/pull/70950) ([Michael Kolupaev](https://github.com/al13n321))。
* 默认情况下，不允许在 ORDER BY 和比较函数 `less/greater/equal/etc` 中使用可比较类型（如 JSON/Object/AggregateFunction）。[#73276](https://github.com/ClickHouse/ClickHouse/pull/73276) ([Pavel Kruglov](https://github.com/Avogar))。
* `JSONEachRowWithProgress` 现在会在进度更新时实时写入进度信息。在之前的版本中,进度仅在每个结果块处理完成后才显示,这使得该功能几乎无用。现已改进进度显示方式:不再显示零值。需要注意的是,即使进度更新非常频繁,也会发送进度信息,这可能产生大量网络流量。另外需要注意,当输出启用压缩时,进度信息不会被刷新。此更改解决了 [#70800](https://github.com/ClickHouse/ClickHouse/issues/70800)。[#73834](https://github.com/ClickHouse/ClickHouse/pull/73834) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* `mysql` 字典源不再执行 `SHOW TABLE STATUS` 查询，因为对于 InnoDB 表以及所有较新的 MySQL 版本，该查询不再提供任何有价值的信息。此变更关闭了 [#72636](https://github.com/ClickHouse/ClickHouse/issues/72636)。该变更向后兼容，但被列在此类变更中，以便你能够注意到它。[#73914](https://github.com/ClickHouse/ClickHouse/pull/73914)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `Merge` 表将通过对其列进行并集并推导公共类型来统一底层表的结构。此更改关闭了 [#64864](https://github.com/ClickHouse/ClickHouse/issues/64864)。此更改关闭了 [#35307](https://github.com/ClickHouse/ClickHouse/issues/35307)。在某些情况下，此更改可能与旧版本不兼容。例如，当各个表之间不存在公共类型，但仍然可以转换为第一个表的类型时，比如 `UInt64` 和 `Int64`，或任意数值类型与 `String` 的情况。如果你希望恢复旧行为，请将 `merge_table_max_tables_to_look_for_schema_inference` 设置为 `1`，或者将 `compatibility` 设置为 `24.12` 或更早版本。[#73956](https://github.com/ClickHouse/ClickHouse/pull/73956)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `CHECK TABLE` 查询现在需要单独的 `CHECK` 权限。在之前的版本中,只需拥有 `SHOW TABLES` 权限即可运行这些查询。但 `CHECK TABLE` 查询可能会消耗大量资源,而通常应用于 `SELECT` 查询的复杂度限制并不适用于它。这可能导致 DoS 攻击风险。[#74471](https://github.com/ClickHouse/ClickHouse/pull/74471) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 当 `allow_materialized_view_with_bad_select` 为 `false` 时，检查物化视图中的所有列是否与目标表中的列一一对应。 [#74481](https://github.com/ClickHouse/ClickHouse/pull/74481) ([Christoph Wurm](https://github.com/cwurm))。
* 函数 `h3ToGeo()` 现在按照 `(lat, lon)` 的顺序返回结果（这是几何函数的标准顺序）。希望保留旧版结果顺序 `(lon, lat)` 的用户可以将设置项 `h3togeo_lon_lat_result_order` 设为 `true`。 [#74719](https://github.com/ClickHouse/ClickHouse/pull/74719) ([Manish Gill](https://github.com/mgill25)).
* 添加 `JSONCompactEachRowWithProgress` 和 `JSONCompactStringsEachRowWithProgress` 格式，是对 [#69989](https://github.com/ClickHouse/ClickHouse/issues/69989) 的延续。`JSONCompactWithNames` 和 `JSONCompactWithNamesAndTypes` 不再输出 &quot;totals&quot; —— 显然这是之前实现中的一个错误。[#75037](https://github.com/ClickHouse/ClickHouse/pull/75037) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 将 `format_alter_operations_with_parentheses` 的默认值改为 true，以使 alter 命令列表的语义更加明确（参见 [https://github.com/ClickHouse/ClickHouse/pull/59532](https://github.com/ClickHouse/ClickHouse/pull/59532)）。这会导致与 24.3 之前版本集群的复制不兼容。如果你正在升级使用较旧版本的集群，请在服务器配置中关闭该设置，或先升级到 24.3。[#75302](https://github.com/ClickHouse/ClickHouse/pull/75302)（[Raúl Marín](https://github.com/Algunenano)）。
* 禁止对复制数据库执行 `TRUNCATE DATABASE` 操作。[#76651](https://github.com/ClickHouse/ClickHouse/pull/76651)（[Bharat Nallan](https://github.com/bharatnc)）。
* 当分析器被禁用时,无论 `compatibility` 设置如何,默认禁用并行副本。仍可通过显式将 `parallel_replicas_only_with_analyzer` 设置为 `false` 来更改此行为。[#77115](https://github.com/ClickHouse/ClickHouse/pull/77115) ([Igor Nikonov](https://github.com/devcrafter))。
* 不再支持在设置中将 `NaN` 或 `inf` 用作浮点数值。[#77546](https://github.com/ClickHouse/ClickHouse/pull/77546) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 修复了在 `dateTrunc` 与负值日期/日期时间参数一起使用时出现的问题。[#77622](https://github.com/ClickHouse/ClickHouse/pull/77622) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 旧版 MongoDB 集成已被移除。服务器设置 `use_legacy_mongodb_integration` 已废弃，现在不起任何作用。[#77895](https://github.com/ClickHouse/ClickHouse/pull/77895) ([Robert Schulze](https://github.com/rschu1ze))。
* 增强 `SummingMergeTree` 的校验逻辑，对用作分区键或排序键的列跳过聚合操作。[#78022](https://github.com/ClickHouse/ClickHouse/pull/78022)（[Pervakov Grigorii](https://github.com/GrigoryPervakov)）。





## 新功能 {#new-features}


* 为反序列化后的 skipping 索引 granule 新增了内存缓存，这可以加速重复使用 skipping 索引的查询。新缓存的大小由服务端设置项 `skipping_index_cache_size` 和 `skipping_index_cache_max_entries` 控制。引入该缓存的初衷是加速向量相似度索引，而它们现在已经快了很多。[#70102](https://github.com/ClickHouse/ClickHouse/pull/70102)（[Robert Schulze](https://github.com/rschu1ze)）。
* 全新的 Userspace Page Cache 实现，支持在进程内存中缓存数据，而无需依赖操作系统的页面缓存。当数据存储在未由本地文件系统缓存支撑的远程虚拟文件系统上时，这非常有用。[#70509](https://github.com/ClickHouse/ClickHouse/pull/70509) ([Michael Kolupaev](https://github.com/al13n321))。
* 添加设置，以便按特定时间戳查询 Iceberg 表。[#71072](https://github.com/ClickHouse/ClickHouse/pull/71072)（[Brett Hoerner](https://github.com/bretthoerner)）。
* 在 Iceberg 中为与时间相关的分区转换操作实现 Iceberg 表的分区裁剪。 [#72044](https://github.com/ClickHouse/ClickHouse/pull/72044) ([Daniil Ivanik](https://github.com/divanik)).
* 通过设置 `enable_minmax_index_for_all_numeric_columns`（用于数值列）和 `enable_minmax_index_for_all_string_columns`（用于字符串列），可以为由 MergeTree 管理的列默认启用创建 min-max（跳过）索引的能力。当前这两个设置均为禁用状态，因此尚未产生任何行为变更。[#72090](https://github.com/ClickHouse/ClickHouse/pull/72090)（[Smita Kulkarni](https://github.com/SmitaRKulkarni)）。
* 新增聚合函数 sequenceMatchEvents，用于在给定模式下返回最长事件链中匹配事件的时间戳。 [#72349](https://github.com/ClickHouse/ClickHouse/pull/72349) ([UnamedRus](https://github.com/UnamedRus))。
* `SELECT` 和 `VIEW` 语句现在支持别名，例如：`SELECT b FROM (SELECT number, number*2 FROM numbers(2)) AS x (a, b);`。这使得 TPC-H 查询 15 可以在无需修改的情况下运行。[#72480](https://github.com/ClickHouse/ClickHouse/pull/72480) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 新增设置 `enable_adaptive_memory_spill_scheduler`，允许同一查询中的多个 grace JOIN 监控其整体内存占用，并自适应地触发向外部存储的溢写，以防止出现 MEMORY&#95;LIMIT&#95;EXCEEDED。 [#72728](https://github.com/ClickHouse/ClickHouse/pull/72728) ([lgbo](https://github.com/lgbo-ustc)).
* 新增 `arrayNormalizedGini` 函数。[#72823](https://github.com/ClickHouse/ClickHouse/pull/72823) ([flynn](https://github.com/ucasfl)).
* 支持低基数字面量数据类型，修复 [#72256](https://github.com/ClickHouse/ClickHouse/issues/72256)。[#72833](https://github.com/ClickHouse/ClickHouse/pull/72833)（[zhanglistar](https://github.com/zhanglistar)）。
* 当同时启用 `min_age_to_force_merge_seconds` 和 `min_age_to_force_merge_on_partition_only` 时，分区数据片段的合并将忽略最大字节数限制。 [#73656](https://github.com/ClickHouse/ClickHouse/pull/73656) ([Kai Zhu](https://github.com/nauu))。
* 支持从 Apache Arrow/Parquet/ORC 读取 `HALF_FLOAT` 值（会读取为 `Float32`）。这解决了 [#72960](https://github.com/ClickHouse/ClickHouse/issues/72960)。请注意，IEEE-754 半精度浮点数与 `BFloat16` 并不相同。解决 [#73835](https://github.com/ClickHouse/ClickHouse/issues/73835)。[#73836](https://github.com/ClickHouse/ClickHouse/pull/73836)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `system.trace_log` 表将包含两个新列 `symbols` 和 `lines`，用于存储已符号化的堆栈跟踪。这样可以更方便地收集和导出性能剖析信息。该行为由服务端配置项 `trace_log` 下的 `symbolize` 控制，默认启用。[#73896](https://github.com/ClickHouse/ClickHouse/pull/73896)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 添加新函数 `generateSerialID`，可用于在表中生成自增数字。该功能是由 [kazalika](https://github.com/kazalika) 发起的 [#64310](https://github.com/ClickHouse/ClickHouse/issues/64310) 的延续，并据此关闭了 [#62485](https://github.com/ClickHouse/ClickHouse/issues/62485)。[#73950](https://github.com/ClickHouse/ClickHouse/pull/73950)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 添加了语法 `query1 PARALLEL WITH query2 PARALLEL WITH query3 ... PARALLEL WITH queryN`。这意味着子查询 `{query1, query2, ... queryN}` 可以彼此并行运行（并且更推荐这样使用）。[#73983](https://github.com/ClickHouse/ClickHouse/pull/73983) ([Vitaly Baranov](https://github.com/vitlibar))。
* 现在，Play UI 在查询运行期间具有进度条，并支持取消查询。它会显示记录总数以及更详细的速度信息。表格可以在数据一到达时就逐步渲染。启用 HTTP 压缩。表格渲染速度变得更快。表头变为固定（sticky）。它支持选择单元格，并可通过方向键在单元格之间导航。修复了选中单元格的描边导致其变小的问题。单元格不再在鼠标悬停时展开，而只在被选中时展开。停止渲染传入数据的时机现在由客户端而非服务器端决定。为数值中的数字分组提供高亮显示。整体设计得到了更新，变得更加醒目。它会检查服务器是否可达以及凭据是否正确，并显示服务器版本和运行时间。云图标在所有字体中都以描边样式呈现，即使在 Safari 中也是如此。嵌套数据类型中的大整数将获得更好的渲染效果。将正确显示 inf/nan。将在鼠标悬停在列头上时显示数据类型。[#74204](https://github.com/ClickHouse/ClickHouse/pull/74204)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 通过设置 `add_minmax_index_for_numeric_columns`（用于数值列）和 `add_minmax_index_for_string_columns`（用于字符串列），为由 MergeTree 管理的列默认启用创建 min-max（跳过）索引的能力。目前这两个设置均为禁用状态，因此暂时还不会带来行为变更。[#74266](https://github.com/ClickHouse/ClickHouse/pull/74266)（[Smita Kulkarni](https://github.com/SmitaRKulkarni)）。
* 将 `script_query_number` 和 `script_line_number` 字段添加到 `system.query_log`、原生协议中的 ClientInfo，以及服务器日志中。此更改解决了 [#67542](https://github.com/ClickHouse/ClickHouse/issues/67542)。感谢 [pinsvin00](https://github.com/pinsvin00) 早前在 [#68133](https://github.com/ClickHouse/ClickHouse/issues/68133) 中发起了这一特性。[#74477](https://github.com/ClickHouse/ClickHouse/pull/74477)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 为 `DateTime64` 添加减号运算符支持，以便在 `DateTime64` 值之间以及与 `DateTime` 之间进行相减。[#74482](https://github.com/ClickHouse/ClickHouse/pull/74482) ([Li Yin](https://github.com/liyinsg))。
* 在 AzureBlobStorage 中支持 DeltaLake 表引擎。修复 [#68043](https://github.com/ClickHouse/ClickHouse/issues/68043)。[#74541](https://github.com/ClickHouse/ClickHouse/pull/74541)（[Smita Kulkarni](https://github.com/SmitaRKulkarni)）。
* 添加 bind&#95;host 设置，用于为 clickhouse 客户端连接指定源 IP 地址。[#74741](https://github.com/ClickHouse/ClickHouse/pull/74741) ([Todd Yocum](https://github.com/toddyocum))。
* 新增支持在提交后，在执行 `SELECT` 查询时立即应用尚未完成（尚未由后台进程物化）的 mutation。可通过设置 `apply_mutations_on_fly` 来启用该功能。[#74877](https://github.com/ClickHouse/ClickHouse/pull/74877) ([Anton Popov](https://github.com/CurtizJ)).
* 修复了此前在 `toStartOfInterval` 的 datetime 参数为负数时出现的一些意外情况。为此实现了一个名为 toStartOfIntervalAllowNegative 的新函数，该函数在功能上基本相同，但只返回 Date32/DateTime64 类型。[#74933](https://github.com/ClickHouse/ClickHouse/pull/74933)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 新增了一个函数 `initialQueryStartTime`。它返回当前查询的起始时间。在分布式查询中，该值在所有分片上都相同。 [#75087](https://github.com/ClickHouse/ClickHouse/pull/75087) ([Roman Lomonosov](https://github.com/lomik))。
* 在 system.tables 中引入 parametrized&#95;view&#95;parameters 字段。关闭 [https://github.com/clickhouse/clickhouse/issues/66756](https://github.com/clickhouse/clickhouse/issues/66756)。 [#75112](https://github.com/ClickHouse/ClickHouse/pull/75112)（[NamNguyenHoai](https://github.com/NamHoaiNguyen)）。
* 允许修改数据库注释。关闭 [#73351](https://github.com/ClickHouse/ClickHouse/issues/73351) ### 面向用户变更的文档更新。 [#75622](https://github.com/ClickHouse/ClickHouse/pull/75622) ([NamNguyenHoai](https://github.com/NamHoaiNguyen)).
* 新增在无数据库层的情况下执行 ATTACH 表的功能（避免使用 UUID hack）。[#75788](https://github.com/ClickHouse/ClickHouse/pull/75788) ([Azat Khuzhin](https://github.com/azat))。
* 新增了 `concurrent_threads_scheduler` 服务器设置，用于控制并发查询之间的 CPU 资源分配方式。可以设置为 `round_robin`（之前的行为）或 `fair_round_robin`，以解决 INSERT 与 SELECT 之间 CPU 分配不公平的问题。[#75949](https://github.com/ClickHouse/ClickHouse/pull/75949) ([Sergei Trifonov](https://github.com/serxa))。
* 恢复在 v24.10 中因许可证问题被移除的 QPL 编解码器。[#76021](https://github.com/ClickHouse/ClickHouse/pull/76021) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* 新增函数 `arraySymmetricDifference`。该函数返回在多个数组参数中但未同时出现在所有参数中的所有元素。示例：`SELECT arraySymmetricDifference([1, 2], [2, 3])` 返回 `[1, 3]`。（issue [#61673](https://github.com/ClickHouse/ClickHouse/issues/61673)）。[#76231](https://github.com/ClickHouse/ClickHouse/pull/76231)（[Filipp Abapolov](https://github.com/pheepa)）。
* 添加 `estimatecompressionratio` 聚合函数 — 参见 [#70801](https://github.com/ClickHouse/ClickHouse/issues/70801)。 [#76661](https://github.com/ClickHouse/ClickHouse/pull/76661)（[Tariq Almawash](https://github.com/talmawash)）。
* `FilterTransformPassedRows` 和 `FilterTransformPassedBytes` 性能事件将显示查询执行期间通过过滤的行数和字节数。[#76662](https://github.com/ClickHouse/ClickHouse/pull/76662) ([Onkar Deshpande](https://github.com/onkar))。
* 新增了 `keccak256` 哈希函数，该函数常用于区块链实现中，特别是在基于 EVM 的系统中。[#76669](https://github.com/ClickHouse/ClickHouse/pull/76669)（[Arnaud Briche](https://github.com/arnaudbriche)）。
* Scram SHA256，并更新 Postgres wire 认证。[#76839](https://github.com/ClickHouse/ClickHouse/pull/76839) ([scanhex12](https://github.com/scanhex12))。
* 该功能新增了：可以定义一组要从客户端请求头中转发给外部 HTTP 认证器的 `headers`。 [#77054](https://github.com/ClickHouse/ClickHouse/pull/77054) ([inv2004](https://github.com/inv2004))。
* 支持 `IcebergMetadataFilesCache`，用于将 manifest 文件/列表和 metadata.json 存储在同一个缓存中。 [#77156](https://github.com/ClickHouse/ClickHouse/pull/77156) ([Han Fei](https://github.com/hanfei1991))。
* 添加了函数 `arrayLevenshteinDistance`、`arrayLevenshteinDistanceWeighted` 和 `arraySimilarity`。 [#77187](https://github.com/ClickHouse/ClickHouse/pull/77187)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* 新增三个函数：`icebergTruncate`（遵循规范 [https://iceberg.apache.org/spec/#truncate-transform-details](https://iceberg.apache.org/spec/#truncate-transform-details)）、`toYearNumSinceEpoch` 和 `toMonthNumSinceEpoch`。在 `Iceberg` 引擎中为分区裁剪添加对 `truncate` 变换的支持。[#77403](https://github.com/ClickHouse/ClickHouse/pull/77403) ([alesapin](https://github.com/alesapin))。
* 允许用户查询 Iceberg 表在之前某个时间点的状态。[#77439](https://github.com/ClickHouse/ClickHouse/pull/77439)（[Daniil Ivanik](https://github.com/divanik)）。
* 为工作负载新增了 CPU 时间片调度功能,详情请参阅 [https://clickhouse.com/docs/operations/workload-scheduling#cpu&#95;scheduling](https://clickhouse.com/docs/operations/workload-scheduling#cpu_scheduling)。[#77595](https://github.com/ClickHouse/ClickHouse/pull/77595) ([Sergei Trifonov](https://github.com/serxa))。
* `hasAll()` 函数现在可以利用 `tokenbf&#95;v1`、`ngrambf&#95;v1` 全文跳过索引。[#77662](https://github.com/ClickHouse/ClickHouse/pull/77662) ([UnamedRus](https://github.com/UnamedRus))。
* `JSON` 数据类型已可在生产环境中使用。参见 [https://jsonbench.com/](https://jsonbench.com/)。`Dynamic` 和 `Variant` 数据类型已可在生产环境中使用。 [#77785](https://github.com/ClickHouse/ClickHouse/pull/77785) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 为反序列化后的向量相似度索引新增了一个内存缓存，这将加速重复执行的近似最近邻（ANN）搜索查询。新缓存的大小通过服务端设置 `vector_similarity_index_cache_size` 和 `vector_similarity_index_cache_max_entries` 进行控制。此功能取代了早期版本中的跳过索引缓存功能。[#77905](https://github.com/ClickHouse/ClickHouse/pull/77905)（[Shankar Iyer](https://github.com/shankar-iyer)）。
* 新增 `sparseGrams` 和 `sparseGramsHashes` 函数及其 UTF8 版本。作者：[scanhex12](https://github.com/scanhex12)。[#78176](https://github.com/ClickHouse/ClickHouse/pull/78176)（[Pervakov Grigorii](https://github.com/GrigoryPervakov)）。
* 引入 `toInterval` 函数。该函数接受两个参数（值和单位），并将值转换为特定的 `Interval` 类型。[#78723](https://github.com/ClickHouse/ClickHouse/pull/78723)（[Andrew Davis](https://github.com/pulpdrew)）。





## 实验性功能 {#experimental-features}

- 通过新设置 `enable_replacing_merge_with_cleanup_for_min_age_to_force_merge`,允许在可配置的超时时间后自动清理合并整个分区。[#76440](https://github.com/ClickHouse/ClickHouse/pull/76440) ([Christoph Wurm](https://github.com/cwurm)).
- 为基于 AWS S3 和本地文件系统的 DeltaLake 表添加 [Unity Catalog](https://www.databricks.com/product/unity-catalog) 支持。[#76988](https://github.com/ClickHouse/ClickHouse/pull/76988) ([alesapin](https://github.com/alesapin)).
- 引入与 AWS Glue 服务目录的实验性集成,用于 Iceberg 表。[#77257](https://github.com/ClickHouse/ClickHouse/pull/77257) ([alesapin](https://github.com/alesapin)).


## 性能改进 {#performance-improvements}


* 通过延迟投影优化性能,避免读取未使用的列。[#55518](https://github.com/ClickHouse/ClickHouse/pull/55518) ([Xiaozhe Yu](https://github.com/wudidapaopao))。
* 优先从最有可能不相等的列开始比较行。[#63780](https://github.com/ClickHouse/ClickHouse/pull/63780) ([UnamedRus](https://github.com/UnamedRus))。
* 优化 `RowBinary` 输入格式，修复 [#63805](https://github.com/ClickHouse/ClickHouse/issues/63805)。[#65059](https://github.com/ClickHouse/ClickHouse/pull/65059)（[Pavel Kruglov](https://github.com/Avogar)）。
* 通过底层优化提升字符串反序列化速度。[#65948](https://github.com/ClickHouse/ClickHouse/pull/65948)（[Nikita Taranov](https://github.com/nickitat)）。
* 在部分代码中应用 `preserve_most` 属性。[#67778](https://github.com/ClickHouse/ClickHouse/pull/67778)（[Nikita Taranov](https://github.com/nickitat)）。
* 实现查询条件缓存以提升重复条件查询的性能。不满足条件的数据范围将作为临时索引存储在内存中,后续查询将使用该索引。关闭 [#67768](https://github.com/ClickHouse/ClickHouse/issues/67768) ### 面向用户的变更文档条目。[#69236](https://github.com/ClickHouse/ClickHouse/pull/69236) ([zhongyuankai](https://github.com/zhongyuankai))。
* 为 `NativeORCBlockInputFormat` 提供异步 IO 预取支持，通过隐藏远程 IO 延迟来提升整体性能。在我的测试用例中，加速比可达 1.47 倍。[#70534](https://github.com/ClickHouse/ClickHouse/pull/70534) ([李扬](https://github.com/taiyang-li))。
* 通过按键重新划分右连接表，提升 grace hash join 的性能。 [#72237](https://github.com/ClickHouse/ClickHouse/pull/72237) ([kevinyhzou](https://github.com/KevinyhZou)).
* 在 `materialize ttl` 中重新引入对 `ttl_only_drop_parts` 的遵循;仅读取必要的列来重新计算 TTL,并通过替换为空分区的方式删除分区。[#72751](https://github.com/ClickHouse/ClickHouse/pull/72751) ([Andrey Zvonov](https://github.com/zvonand))。
* 允许 `arrayROCAUC` 和 `arrayAUCPR` 计算整条曲线的局部面积，从而可以在超大规模数据集上并行执行其计算。[#72904](https://github.com/ClickHouse/ClickHouse/pull/72904) ([Emmanuel](https://github.com/emmanuelsdias))。
* 避免生成过多空闲线程。 [#72920](https://github.com/ClickHouse/ClickHouse/pull/72920) ([Guo Wangyang](https://github.com/guowangy)).
* 在 `parallel_hash` JOIN 算法的探测阶段中，按哈希拆分左表数据块的步骤已被移除。[#73089](https://github.com/ClickHouse/ClickHouse/pull/73089)（[Nikita Taranov](https://github.com/nickitat)）。
* 如果在表函数中仅使用花括号展开，则不要列出 blob 存储键。修复了 [#73333](https://github.com/ClickHouse/ClickHouse/issues/73333)。[#73518](https://github.com/ClickHouse/ClickHouse/pull/73518)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 根据 [#70502](https://github.com/ClickHouse/ClickHouse/issues/70502) 中的测试，在算术计算中将 Int256 和 UInt256 替换为 clang 内置的 i256。 [#73658](https://github.com/ClickHouse/ClickHouse/pull/73658)（[李扬](https://github.com/taiyang-li)）。
* 为所有参数类型均为数值型的函数添加快速路径，修复了 [https://github.com/ClickHouse/ClickHouse/pull/72258](https://github.com/ClickHouse/ClickHouse/pull/72258) 中的性能问题。[#73820](https://github.com/ClickHouse/ClickHouse/pull/73820)（[李扬](https://github.com/taiyang-li)）。
* 不要在非函数列上使用 `maskedExecute`，并提升短路执行的性能。[#73965](https://github.com/ClickHouse/ClickHouse/pull/73965) ([lgbo](https://github.com/lgbo-ustc))。
* 为 Kafka/NATS/RabbitMQ/FileLog 禁用头部检测以提升性能。[#74006](https://github.com/ClickHouse/ClickHouse/pull/74006) ([Azat Khuzhin](https://github.com/azat)).
* 按值使用日志包装器，不要在堆上为它们分配内存。[#74034](https://github.com/ClickHouse/ClickHouse/pull/74034) ([Mikhail Artemenko](https://github.com/Michicosun))。
* 在使用 `GROUPING SETS` 进行聚合后，以更高的并行度执行 pipeline。 [#74082](https://github.com/ClickHouse/ClickHouse/pull/74082) ([Nikita Taranov](https://github.com/nickitat))。
* 缩短 `MergeTreeReadPool` 中的临界区。[#74202](https://github.com/ClickHouse/ClickHouse/pull/74202) ([Guo Wangyang](https://github.com/guowangy)).
* 已优化函数 `indexHint`。现在，仅作为函数 `indexHint` 参数使用的列不会从表中读取。[#74314](https://github.com/ClickHouse/ClickHouse/pull/74314) ([Anton Popov](https://github.com/CurtizJ)).
* 并行副本性能优化。对于与并行副本协议无关的数据包，现在在查询发起端的反序列化始终在 pipeline 线程中执行。此前，它可能会在负责 pipeline 调度的线程中执行，这会降低发起端的响应速度并延迟 pipeline 的执行。[#74398](https://github.com/ClickHouse/ClickHouse/pull/74398)（[Igor Nikonov](https://github.com/devcrafter)）。
* 修复了 `LowCardinality` 列内存占用大小计算的问题。[#74688](https://github.com/ClickHouse/ClickHouse/pull/74688) ([Nikita Taranov](https://github.com/nickitat)).
* 提升了从 S3 读取 Wide parts 时整个 JSON 列的读取性能。通过为子列前缀反序列化添加预取、缓存已反序列化的前缀以及对子列前缀进行并行反序列化来实现。在类似 `SELECT data FROM table` 的查询中，从 S3 读取 JSON 列的速度提升约 4 倍，而在类似 `SELECT data FROM table LIMIT 10` 的查询中，提升约 10 倍。[#74827](https://github.com/ClickHouse/ClickHouse/pull/74827)（[Pavel Kruglov](https://github.com/Avogar)）。
* 为异步插入预先分配内存以提升性能。 [#74945](https://github.com/ClickHouse/ClickHouse/pull/74945) ([Ilya Golshtein](https://github.com/ilejn)).
* 修复了在优化器交换连接两侧时 `ConcurrentHashJoin` 中的双重预分配问题。[#75149](https://github.com/ClickHouse/ClickHouse/pull/75149) ([Nikita Taranov](https://github.com/nickitat)).
* 修复了在 `max_rows_in_join = max_bytes_in_join = 0` 时 `parallel_hash` 中不必要的竞争。[#75155](https://github.com/ClickHouse/ClickHouse/pull/75155) ([Nikita Taranov](https://github.com/nickitat))。
* 在某些 `JOIN` 场景下略有优化：预先计算输出行数并为其预留内存。[#75376](https://github.com/ClickHouse/ClickHouse/pull/75376) ([Alexander Gololobov](https://github.com/davenger))。
* `plain_rewritable` 元数据文件很小，无需使用很大的默认缓冲区。请使用大小合适、能够匹配给定路径的写缓冲区，以在存在大量活跃分片时提升内存利用率。### 面向用户变更的文档条目。[#75758](https://github.com/ClickHouse/ClickHouse/pull/75758) ([Julia Kartseva](https://github.com/jkartseva))。
* 在某些情况下（例如空数组列），数据部分可能包含空文件。当表存放在元数据与对象存储分离的磁盘上时，我们可以跳过将空 blob 写入 ObjectStorage，而仅为这些文件存储元数据。[#75860](https://github.com/ClickHouse/ClickHouse/pull/75860)（[Alexander Gololobov](https://github.com/davenger)）。
* 已经发现，并发控制可能会导致 `INSERT` 与 `SELECT` 之间的 CPU 分配不公平：当所有 CPU 插槽在没有竞争的情况下被无条件分配给 `max_threads` = 1 的 INSERT 时，`max_threads` 值较高的 SELECT 却因为只能使用单个线程而出现性能下降。[#75941](https://github.com/ClickHouse/ClickHouse/pull/75941)（[Sergei Trifonov](https://github.com/serxa)）。
* 对 `wrapInNullable` 进行简单优化，以避免不必要的 `null map` 分配。[#76489](https://github.com/ClickHouse/ClickHouse/pull/76489) ([李扬](https://github.com/taiyang-li)).
* 改进 Decimal32/Decimal64/DateTime64 的 min/max 性能。[#76570](https://github.com/ClickHouse/ClickHouse/pull/76570) ([李扬](https://github.com/taiyang-li))。
* 在删除部件时主动从缓存中淘汰数据。如果数据量较小，不要让缓存增长到最大大小。[#76641](https://github.com/ClickHouse/ClickHouse/pull/76641) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 查询编译（设置 `compile_expressions`）现在会考虑机器类型。这大幅提升了此类查询的执行速度。[#76753](https://github.com/ClickHouse/ClickHouse/pull/76753)（[Robert Schulze](https://github.com/rschu1ze)）。
* 优化 `arraySort`。 [#76850](https://github.com/ClickHouse/ClickHouse/pull/76850) ([李扬](https://github.com/taiyang-li)).
* 通过对 `col->insertFrom()` 调用进行去虚拟化，加速构建 JOIN 结果。[#77350](https://github.com/ClickHouse/ClickHouse/pull/77350) ([Alexander Gololobov](https://github.com/davenger)).
* 将同一部分的合并标记合并后一次性写入查询条件缓存，从而减少锁的开销。 [#77377](https://github.com/ClickHouse/ClickHouse/pull/77377) ([zhongyuankai](https://github.com/zhongyuankai)).
* 对单个 `Nullable` 或低基数列的 `ORDER BY` 进行优化。 [#77789](https://github.com/ClickHouse/ClickHouse/pull/77789) ([李扬](https://github.com/taiyang-li)).
* 在缓存被被动使用时（例如用于合并），禁用 `filesystem_cache_prefer_bigger_buffer_size`。[#77898](https://github.com/ClickHouse/ClickHouse/pull/77898) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 为 Iceberg 实现了 `count()` 的简单计数优化。现在带有 `count()` 且没有任何过滤条件的查询应该会更快。修复 [#77639](https://github.com/ClickHouse/ClickHouse/issues/77639)。[#78090](https://github.com/ClickHouse/ClickHouse/pull/78090)（[alesapin](https://github.com/alesapin)）。
* 基于列的 lower&#95;bound 和 upper&#95;bound 值支持 Iceberg 数据剪枝。修复了 [#77638](https://github.com/ClickHouse/ClickHouse/issues/77638)。[#78242](https://github.com/ClickHouse/ClickHouse/pull/78242)（[alesapin](https://github.com/alesapin)）。
* 优化 `NativeReader` 的内存使用。 [#78442](https://github.com/ClickHouse/ClickHouse/pull/78442) ([Azat Khuzhin](https://github.com/azat)).
* 简单优化：如果需要使用 `CAST`，则不要将 `count(if())` 重写为 `countIf`。关闭 [#78564](https://github.com/ClickHouse/ClickHouse/issues/78564)。 [#78565](https://github.com/ClickHouse/ClickHouse/pull/78565)（[李扬](https://github.com/taiyang-li)）。





## 改进 {#improvements}


* 在可使用 `multiRead` 的场景中取消单个 `get` 请求，从而减少对 Keeper 的请求数量；在副本数量增加的情况下，单个 `get` 请求可能会给 Keeper 带来显著负载。[#56862](https://github.com/ClickHouse/ClickHouse/pull/56862)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 为 MySQL 添加基于命名集合的 SSL 身份验证支持。修复 [#59111](https://github.com/ClickHouse/ClickHouse/issues/59111)。[#59452](https://github.com/ClickHouse/ClickHouse/pull/59452)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 通过在 `ConstantNode` 中存储 `ColumnPtr` 而非 `Field` 来提升新分析器基础设施的性能。相关 issue：[#62245](https://github.com/ClickHouse/ClickHouse/issues/62245)。[#63198](https://github.com/ClickHouse/ClickHouse/pull/63198)（[Dmitry Novik](https://github.com/novikd)）。
* 当服务器过载时拒绝查询。判断依据是等待时间(`OSCPUWaitMicroseconds`)与繁忙时间(`OSCPUVirtualTimeMicroseconds`)的比率。当该比率介于 `min_os_cpu_wait_time_ratio_to_throw` 和 `max_os_cpu_wait_time_ratio_to_throw`(这些是查询级别的设置)之间时,查询会以一定概率被丢弃。[#63206](https://github.com/ClickHouse/ClickHouse/pull/63206) ([Alexey Katsman](https://github.com/alexkats))。
* 尽早释放数据块以降低内存占用。[#65647](https://github.com/ClickHouse/ClickHouse/pull/65647) ([lgbo](https://github.com/lgbo-ustc))。
* `processors_profile_log` 表现在有了默认配置，TTL 为 30 天。 [#66139](https://github.com/ClickHouse/ClickHouse/pull/66139) ([Ilya Yatsishin](https://github.com/qoega)).
* 允许在数据类型为 DateTime64 的列上创建 `bloom_filter` 索引。[#66416](https://github.com/ClickHouse/ClickHouse/pull/66416) ([Yutong Xiao](https://github.com/YutSean))。
* 引入延迟分桶，并使用它们来跟踪 S3 请求的首字节读写时间和连接时间。这样我们之后就可以利用收集的数据计算近似分位数并调整超时时间。[#69783](https://github.com/ClickHouse/ClickHouse/pull/69783) ([Alexey Katsman](https://github.com/alexkats))。
* 传递给 `Executable` 存储的查询不再局限于单线程执行。[#70084](https://github.com/ClickHouse/ClickHouse/pull/70084) ([yawnt](https://github.com/yawnt))。
* 为 OpenTelemetry span 日志表添加了 HTTP 标头，以增强可追踪性。 [#70516](https://github.com/ClickHouse/ClickHouse/pull/70516) ([jonymohajanGmail](https://github.com/jonymohajanGmail)).
* 支持在写入 ORC 文件时使用自定义时区,而不再强制使用 `GMT` 时区。[#70615](https://github.com/ClickHouse/ClickHouse/pull/70615) ([kevinyhzou](https://github.com/KevinyhZou))。
* 如果启用了并行副本，请将表函数替换为对应的 `-Cluster` 版本。修复了 [#65024](https://github.com/ClickHouse/ClickHouse/issues/65024)。[#70659](https://github.com/ClickHouse/ClickHouse/pull/70659)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 跨云写入备份时遵守 IO 调度设置。[#71093](https://github.com/ClickHouse/ClickHouse/pull/71093) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
* 在后台重新建立与 MySQL 和 Postgres 字典副本的连接，以避免阻塞对相应字典的请求。[#71101](https://github.com/ClickHouse/ClickHouse/pull/71101) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 在 system.asynchronous&#95;metrics 中添加度量指标别名。 [#71164](https://github.com/ClickHouse/ClickHouse/pull/71164) ([megao](https://github.com/jetgm)).
* 可刷新物化视图的刷新操作现在会记录在 `system.query_log` 中。[#71333](https://github.com/ClickHouse/ClickHouse/pull/71333)（[Michael Kolupaev](https://github.com/al13n321)）。
* 同时评估 Parquet 布隆过滤器和最小值/最大值索引。这样才能正确支持：`x = 3 or x > 5`，当数据 = [1, 2, 4, 5] 时。[#71383](https://github.com/ClickHouse/ClickHouse/pull/71383)（[Arthur Passos](https://github.com/arthurpassos)）。
* 交互式指标改进。修复来自并行副本的指标未完整显示的问题。按最近更新时间优先排序显示指标，然后按名称的字典序排序。不显示陈旧指标。[#71631](https://github.com/ClickHouse/ClickHouse/pull/71631) ([Julia Kartseva](https://github.com/jkartseva))。
* 历史上由于某些原因，`ALTER TABLE MOVE PARTITION TO TABLE` 查询检查的是 `SELECT` 和 `ALTER DELETE` 权限，而不是专门的 `ALTER_MOVE_PARTITION`。此 PR 开始使用该访问类型。为了兼容性，如果已授予 `SELECT` 和 `ALTER DELETE`，则仍会隐式授予此权限，但这种行为将在未来版本中移除。修复 [#16403](https://github.com/ClickHouse/ClickHouse/issues/16403)。[#71632](https://github.com/ClickHouse/ClickHouse/pull/71632)（[pufit](https://github.com/pufit)）。
* 启用将 `use_hive_partitioning` 作为默认设置。 [#71636](https://github.com/ClickHouse/ClickHouse/pull/71636) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 在尝试对排序键中的列进行实体化时抛出异常，而不是允许其破坏排序顺序。不过，这仍然无法解决 [#71777](https://github.com/ClickHouse/ClickHouse/issues/71777)。[#71891](https://github.com/ClickHouse/ClickHouse/pull/71891) ([Peter Nguyen](https://github.com/petern48))。
* 在启用 hash join 算法时，允许使用更通用的 join 计划算法。[#71926](https://github.com/ClickHouse/ClickHouse/pull/71926) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
* 在 `EXPLAIN QUERY TREE` 中隐藏机密信息。[#72025](https://github.com/ClickHouse/ClickHouse/pull/72025) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 允许使用可配置磁盘来存储数据库和表的元数据文件。磁盘名称可以通过 `database_disk.disk` 配置参数进行设置。[#72027](https://github.com/ClickHouse/ClickHouse/pull/72027) ([Tuan Pham Anh](https://github.com/tuanpach))。
* 在原生读取器中支持 Parquet 的整数逻辑类型。 [#72105](https://github.com/ClickHouse/ClickHouse/pull/72105) ([Arthur Passos](https://github.com/arthurpassos)).
* 默认将 JSON 输出格式以美观形式展示。新增设置 `output_format_json_pretty_print` 来控制该行为，并默认启用。[#72148](https://github.com/ClickHouse/ClickHouse/pull/72148) ([Pavel Kruglov](https://github.com/Avogar))。
* 如果默认用户需要密码，则在浏览器中以交互方式请求凭据。此前版本中，服务器返回 HTTP 403；现在返回 HTTP 401。 [#72198](https://github.com/ClickHouse/ClickHouse/pull/72198) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 此 PR 将访问类型 `CREATE_USER`、`ALTER_USER`、`DROP_USER`、`CREATE_ROLE`、`ALTER_ROLE`、`DROP_ROLE` 从全局权限转换为参数化权限。这意味着用户现在可以更精确地授予访问管理权限:[#72246](https://github.com/ClickHouse/ClickHouse/pull/72246) ([pufit](https://github.com/pufit))。
* 允许在集群配置中为分片命名。 [#72276](https://github.com/ClickHouse/ClickHouse/pull/72276) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* 支持在具有不同参数的 JSON 类型之间执行 `CAST` 和 `ALTER` 操作。[#72303](https://github.com/ClickHouse/ClickHouse/pull/72303) ([Pavel Kruglov](https://github.com/Avogar))。
* 将 `latest_fail_error_code_name` 列添加到 `system.mutations` 中。我们需要该列来引入一个用于监控卡住 mutation 的新指标，并使用它来构建云环境中错误类型的可视化图表，并且（可选）添加一个更加安静的新告警。[#72398](https://github.com/ClickHouse/ClickHouse/pull/72398) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
* 减少在附加分区时的内存分配。[#72583](https://github.com/ClickHouse/ClickHouse/pull/72583) ([Konstantin Morozov](https://github.com/k-morozov)).
* 使 `max&#95;bytes&#95;before&#95;external&#95;sort` 限制依赖于整个查询的内存消耗（之前它表示单个排序线程中排序块的字节数，现在它与 `max_bytes_before_external_group_by` 含义相同——即所有线程在整个查询中可使用的内存总上限）。同时新增一个用于控制磁盘上块大小的设置——`min_external_sort_block_bytes`。[#72598](https://github.com/ClickHouse/ClickHouse/pull/72598) ([Azat Khuzhin](https://github.com/azat))。
* 忽略 trace collector 设置的内存限制。 [#72606](https://github.com/ClickHouse/ClickHouse/pull/72606) ([Azat Khuzhin](https://github.com/azat)).
* 在 MergeTree 排序键和跳过索引中增加对子列的支持。[#72644](https://github.com/ClickHouse/ClickHouse/pull/72644) ([Pavel Kruglov](https://github.com/Avogar)).
* 将服务器设置 `dictionaries_lazy_load` 和 `wait_dictionaries_load_at_startup` 添加到 `system.server_settings`。 [#72664](https://github.com/ClickHouse/ClickHouse/pull/72664)（[Christoph Wurm](https://github.com/cwurm)）。
* 将设置 `max_backup_bandwidth` 添加到可以在 `BACKUP`/`RESTORE` 查询中指定的设置列表。[#72665](https://github.com/ClickHouse/ClickHouse/pull/72665) ([Christoph Wurm](https://github.com/cwurm))。
* 并行副本使用关于副本可用性的历史信息来改进副本选择，但在连接不可用时不会更新该副本的错误计数。此 PR 在副本不可用时会更新其错误计数。 [#72666](https://github.com/ClickHouse/ClickHouse/pull/72666) ([zoomxi](https://github.com/zoomxi)).
* 将 ReplicatedMergeTree 引擎中已出现复制分片的日志级别下调，从而减少在复制集群中生成的日志量。[#72876](https://github.com/ClickHouse/ClickHouse/pull/72876) ([mor-akamai](https://github.com/morkalfon)).
* 许多新功能将需要对代码进行更好的封装（与 Iceberg 元数据相关的部分）以及更好的代码抽象。[#72941](https://github.com/ClickHouse/ClickHouse/pull/72941)（[Daniil Ivanik](https://github.com/divanik)）。
* 为 JSON 列中的值提供等值比较支持。[#72991](https://github.com/ClickHouse/ClickHouse/pull/72991) ([Pavel Kruglov](https://github.com/Avogar)).
* 改进包含 JSON 子列的标识符格式，避免使用不必要的反引号。 [#73085](https://github.com/ClickHouse/ClickHouse/pull/73085) ([Pavel Kruglov](https://github.com/Avogar)).
* 以 `Test` 日志级别记录 `PREWHERE` 条件。[#73116](https://github.com/ClickHouse/ClickHouse/pull/73116) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 在隐式指定 `ENGINE` 时支持使用 `SETTINGS`，并支持混合使用引擎和查询的设置。[#73120](https://github.com/ClickHouse/ClickHouse/pull/73120) ([Raúl Marín](https://github.com/Algunenano)).
* 当启用 `optimize_on_insert` 时，将数据片段写为 level 1。这样可以对新写入的数据片段上的带有 `FINAL` 的查询应用多种优化。[#73132](https://github.com/ClickHouse/ClickHouse/pull/73132)（[Anton Popov](https://github.com/CurtizJ)）。
* 对于类似 `WHERE a<b AND b<c AND c<5` 的查询，可以推导出新的比较条件（`a<5 AND b<5`），从而提升过滤效果。 [#73164](https://github.com/ClickHouse/ClickHouse/pull/73164) ([Shichao Jin](https://github.com/jsc0218)).
* 改进对析取表达式中公共表达式的抽取。即使所有析取项之间不存在共同子表达式，也允许对最终生成的过滤表达式进行简化。作为[#71537](https://github.com/ClickHouse/ClickHouse/issues/71537)的后续工作。[#73271](https://github.com/ClickHouse/ClickHouse/pull/73271)（[Dmitry Novik](https://github.com/novikd)）。
* 在 `S3(Azure)Queue` 存储中，现在可以为创建时未指定设置的表补充添加设置。[#73283](https://github.com/ClickHouse/ClickHouse/pull/73283) ([Kseniia Sumarokova](https://github.com/kssenii))。
* clickhouse-client 现已支持使用 Ctrl+D 来结束查询。可以使用 Ctrl+D 来代替输入分号并按 Enter。此外，在单行模式下，Ctrl+D 的行为与按 Enter 相同。[#73293](https://github.com/ClickHouse/ClickHouse/pull/73293) ([Xiaozhe Yu](https://github.com/wudidapaopao)).
* 引入名为 `least_greatest_legacy_null_behavior` 的设置（默认值：`false`），用于控制函数 `least` 和 `greatest` 在处理 `NULL` 参数时，是无条件返回 `NULL`（当为 `true` 时），还是忽略这些参数（当为 `false` 时）。 [#73344](https://github.com/ClickHouse/ClickHouse/pull/73344) ([Robert Schulze](https://github.com/rschu1ze))。
* 在清理线程 ObjectStorageQueueMetadata 中使用 Keeper 多重请求。 [#73357](https://github.com/ClickHouse/ClickHouse/pull/73357) ([Antonio Andelic](https://github.com/antonio2368)).
* 新的 MongoDB 驱动程序现已成为默认驱动。希望继续使用旧版驱动的用户可以将服务器设置 `use_legacy_mongodb_integration` 设为 true。[#73359](https://github.com/ClickHouse/ClickHouse/pull/73359)（[Robert Schulze](https://github.com/rschu1ze)）。
* 当 ClickHouse 在 cgroup 下运行时，我们仍会收集与系统负载、进程调度、内存等相关的全局系统异步指标。当 ClickHouse 是主机上唯一一个资源消耗较高的进程时，这些指标可能会提供有用的信号。[#73369](https://github.com/ClickHouse/ClickHouse/pull/73369)（[Nikita Taranov](https://github.com/nickitat)）。
* 在 `S3Queue` 存储中，支持将 24.6 之前创建的旧有有序表迁移到带有分桶的新结构。[#73467](https://github.com/ClickHouse/ClickHouse/pull/73467)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 新增与现有 `system.s3queue` 类似的 `system.azure_queue`。 [#73477](https://github.com/ClickHouse/ClickHouse/pull/73477) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复了一个回归问题：使用带有修饰符的排序规则区域设置时会抛出错误。比如，`SELECT arrayJoin(['kk 50', 'KK 01', ' KK 2', ' KK 3', 'kk 1', 'x9y99', 'x9y100']) item ORDER BY item ASC COLLATE 'tr-u-kn-true-ka-shifted` 现在可以正常工作。[#73544](https://github.com/ClickHouse/ClickHouse/pull/73544)（[Robert Schulze](https://github.com/rschu1ze)）。
* 支持 Nullable(JSON) 类型。 [#73556](https://github.com/ClickHouse/ClickHouse/pull/73556) ([Pavel Kruglov](https://github.com/Avogar)).
* 函数 `parseDateTime64`（及其变体）现在能够对 1970 年之前和 2106 年之后的输入日期生成正确结果。例如：`SELECT parseDateTime64InJodaSyntax('2200-01-01 00:00:00.000', 'yyyy-MM-dd HH:mm:ss.SSS')`。[#73594](https://github.com/ClickHouse/ClickHouse/pull/73594)（[zhanglistar](https://github.com/zhanglistar)）。
* 解决了一些用户反馈的 `clickhouse-disks` 易用性问题。关闭 [#67136](https://github.com/ClickHouse/ClickHouse/issues/67136)。[#73616](https://github.com/ClickHouse/ClickHouse/pull/73616)（[Daniil Ivanik](https://github.com/divanik)）。
* 允许修改 S3Queue 和 AzureQueue 存储引擎中的提交设置。(提交设置包括:max&#95;processed&#95;files&#95;before&#95;commit、max&#95;processed&#95;rows&#95;before&#95;commit、max&#95;processed&#95;bytes&#95;before&#95;commit、max&#95;processing&#95;time&#95;sec&#95;before&#95;commit)。[#73635](https://github.com/ClickHouse/ClickHouse/pull/73635) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 在 S3(Azure)Queue 存储中聚合各数据源的进度，以便与提交限制设置进行比较。 [#73641](https://github.com/ClickHouse/ClickHouse/pull/73641) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 在 `BACKUP`/`RESTORE` 查询中支持核心配置。[#73650](https://github.com/ClickHouse/ClickHouse/pull/73650) ([Vitaly Baranov](https://github.com/vitlibar))。
* 在 Parquet 输出中读取 `output_format_compression_level`。 [#73651](https://github.com/ClickHouse/ClickHouse/pull/73651) ([Arthur Passos](https://github.com/arthurpassos))。
* 将读取的 Arrow `fixed_size_list` 作为 `Array` 处理，而不再视为不支持的类型。[#73654](https://github.com/ClickHouse/ClickHouse/pull/73654) ([Julian Meyers](https://github.com/J-Meyers))。
* 此 PR 新增了两个备份引擎：`Memory`（在当前用户会话内保存备份）和 `Null`（不会在任何地方保存备份）。[#73690](https://github.com/ClickHouse/ClickHouse/pull/73690) ([Vitaly Baranov](https://github.com/vitlibar))。
* `concurrent_threads_soft_limit_num` 和 `concurrent_threads_soft_limit_num_ratio_to_cores` 现在可在无需重启服务器的情况下更改。[#73713](https://github.com/ClickHouse/ClickHouse/pull/73713) ([Sergei Trifonov](https://github.com/serxa)).
* 在 `formatReadable` 函数中增加对扩展数值类型（`Decimal`、大整数）的支持。[#73765](https://github.com/ClickHouse/ClickHouse/pull/73765)（[Raúl Marín](https://github.com/Algunenano)）。
* 在 tuple 列中字段匹配时遵循列名大小写不敏感规则。关闭 [https://github.com/apache/incubator-gluten/issues/8324](https://github.com/apache/incubator-gluten/issues/8324)。[#73780](https://github.com/ClickHouse/ClickHouse/pull/73780) ([李扬](https://github.com/taiyang-li))。
* 为 Postgres 线协议提供 TLS 支持。 [#73812](https://github.com/ClickHouse/ClickHouse/pull/73812) ([scanhex12](https://github.com/scanhex12)).
* 默认启用 `LowCardinality(UUID)`。实践表明，这对 ClickHouse Cloud 客户非常实用。[#73826](https://github.com/ClickHouse/ClickHouse/pull/73826) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 改进安装过程中的提示信息。[#73827](https://github.com/ClickHouse/ClickHouse/pull/73827) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 改进了 ClickHouse Cloud 的密码重置提示信息。 [#73831](https://github.com/ClickHouse/ClickHouse/pull/73831) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 改进在 File 表无法向文件追加数据时的错误消息。[#73832](https://github.com/ClickHouse/ClickHouse/pull/73832)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 当用户在终端中误请求输出二进制格式（例如 Native、Parquet、Avro）时弹出确认提示。此更改关闭了 [#59524](https://github.com/ClickHouse/ClickHouse/issues/59524)。[#73833](https://github.com/ClickHouse/ClickHouse/pull/73833)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `BFloat16` 数据类型已准备好用于生产环境。 [#73840](https://github.com/ClickHouse/ClickHouse/pull/73840) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 在终端中以 Pretty 和 Vertical 格式显示结果时高亮行尾空格，以提升可读性。该行为由设置 `output_format_pretty_highlight_trailing_spaces` 控制。初始实现由 [Braden Burns](https://github.com/bradenburns) 在 [#72996](https://github.com/ClickHouse/ClickHouse/issues/72996) 中提交。关闭了 [#71590](https://github.com/ClickHouse/ClickHouse/issues/71590)。[#73847](https://github.com/ClickHouse/ClickHouse/pull/73847)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 当从文件重定向 `stdin` 时，`clickhouse-client` 和 `clickhouse-local` 将自动检测输入的压缩格式。此更改关闭了 [#70865](https://github.com/ClickHouse/ClickHouse/issues/70865)。[#73848](https://github.com/ClickHouse/ClickHouse/pull/73848)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在 pretty 格式中默认截断过长的列名。此行为由 `output_format_pretty_max_column_name_width_cut_to` 和 `output_format_pretty_max_column_name_width_min_chars_to_cut` 设置控制。此更改是对 [tanmaydatta](https://github.com/tanmaydatta) 在 [#66502](https://github.com/ClickHouse/ClickHouse/issues/66502) 中工作的延续。该改动关闭了 [#65968](https://github.com/ClickHouse/ClickHouse/issues/65968)。[#73851](https://github.com/ClickHouse/ClickHouse/pull/73851)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 让 `Pretty` 格式更美观：如果距离上一个数据块输出的时间间隔不长，则将多个数据块压缩合并输出。通过新的设置 `output_format_pretty_squash_consecutive_ms`（默认 50 ms）和 `output_format_pretty_squash_max_wait_ms`（默认 1000 ms）进行控制。延续 [#49537](https://github.com/ClickHouse/ClickHouse/issues/49537) 的改动。这一改动关闭了 [#49153](https://github.com/ClickHouse/ClickHouse/issues/49153)。[#73852](https://github.com/ClickHouse/ClickHouse/pull/73852)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复 SQLite 的类型映射（将整数类型映射为 `int64`，将浮点类型映射为 `float64`）。[#73853](https://github.com/ClickHouse/ClickHouse/pull/73853)（[Joanna Hulboj](https://github.com/jh0x)）。
* 新增一个用于统计当前正在合并的源数据部分数量的指标。此更改关闭了 [#70809](https://github.com/ClickHouse/ClickHouse/issues/70809)。[#73868](https://github.com/ClickHouse/ClickHouse/pull/73868)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 当输出到终端时，在 `Vertical` 格式中对列进行高亮显示。可以通过设置 `output_format_pretty_color` 禁用此行为。 [#73898](https://github.com/ClickHouse/ClickHouse/pull/73898) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 增强了 MySQL 兼容性,现在 `mysqlsh`(Oracle 提供的功能丰富的 MySQL CLI)可以连接到 ClickHouse,从而便于进行测试。[#73912](https://github.com/ClickHouse/ClickHouse/pull/73912) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 如果输出记录数大于 N = `output_format_pretty_max_rows`，则不再只显示前 N 行，而是从中间截断输出表，显示前 N/2 行和后 N/2 行。延续 [#64200](https://github.com/ClickHouse/ClickHouse/issues/64200)。关闭 [#59502](https://github.com/ClickHouse/ClickHouse/issues/59502)。[#73929](https://github.com/ClickHouse/ClickHouse/pull/73929)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 函数 `isIPv4String` 在正确的 IPv4 地址后紧跟一个零字节时会返回 true，而在这种情况下它本应返回 false。是对 [#65387](https://github.com/ClickHouse/ClickHouse/issues/65387) 的延续。[#73946](https://github.com/ClickHouse/ClickHouse/pull/73946)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 使 MySQL wire protocol 中的错误码与 MySQL 保持兼容。[#56831](https://github.com/ClickHouse/ClickHouse/issues/56831) 的后续工作。修复 [#50957](https://github.com/ClickHouse/ClickHouse/issues/50957)。[#73948](https://github.com/ClickHouse/ClickHouse/pull/73948)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 添加设置 `validate_enum_literals_in_opearators`，用于在诸如 `IN`、`NOT IN` 等运算符中校验枚举字面量是否属于该枚举类型，如果字面量不是有效的枚举值则抛出异常。 [#73985](https://github.com/ClickHouse/ClickHouse/pull/73985) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 在 `S3(Azure)Queue` 存储中，将所有文件（由提交设置定义的单个批次）在单个 keeper 事务中一并提交。 [#73991](https://github.com/ClickHouse/ClickHouse/pull/73991) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 为可执行 UDF 和字典禁用表头检测（可能导致 Function &#39;X&#39;: wrong result, expected Y row(s), actual Y-1）。[#73992](https://github.com/ClickHouse/ClickHouse/pull/73992) ([Azat Khuzhin](https://github.com/azat)).
* 为 `EXPLAIN PLAN` 添加了 `distributed` 选项。现在，`EXPLAIN distributed=1 ...` 会将远程执行计划附加到 `ReadFromParallelRemote*` 步骤。[#73994](https://github.com/ClickHouse/ClickHouse/pull/73994)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 为带有 Dynamic 参数的 not/xor 使用正确的返回类型。[#74013](https://github.com/ClickHouse/ClickHouse/pull/74013)（[Pavel Kruglov](https://github.com/Avogar)）。
* 允许在创建表之后更改 `add_implicit_sign_column_constraint_for_collapsing_engine`。[#74014](https://github.com/ClickHouse/ClickHouse/pull/74014)（[Christoph Wurm](https://github.com/cwurm)）。
* 在物化视图的 `SELECT` 查询中支持子列。 [#74030](https://github.com/ClickHouse/ClickHouse/pull/74030) ([Pavel Kruglov](https://github.com/Avogar))。
* 美观格式现在可以在表格单元格内渲染多行字段，从而提升可读性。该功能默认启用，并可通过设置 `output_format_pretty_multiline_fields` 进行控制。这是对 [Volodyachan](https://github.com/Volodyachan) 在 [#64094](https://github.com/ClickHouse/ClickHouse/issues/64094) 中工作的延续。此更改关闭了 [#56912](https://github.com/ClickHouse/ClickHouse/issues/56912)。[#74032](https://github.com/ClickHouse/ClickHouse/pull/74032)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在查询计划层面为 `MergingAggregated` 步骤提供对 `predicate-push-down` 优化的支持。在使用新分析器时，这可以提升某些查询的性能。[#74073](https://github.com/ClickHouse/ClickHouse/pull/74073) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
* 现在可以通过三种简单方式在 `clickhouse-client` 中设置自定义提示符：1. 通过命令行参数 `--prompt`；2. 在配置文件中，通过设置 `<prompt>[...]</prompt>`；3. 同样在配置文件中，通过为每个连接设置 `<connections_credentials><prompt>[...]</prompt></connections_credentials>`。[#74168](https://github.com/ClickHouse/ClickHouse/pull/74168)（[Christoph Wurm](https://github.com/cwurm)）。
* 将 Prometheus Remote Write 响应的成功状态码从 200/OK 更改为 204/NoContent。 [#74170](https://github.com/ClickHouse/ClickHouse/pull/74170) ([Michael Dempsey](https://github.com/bluestealth)).
* 在浏览器中将 `X-ClickHouse` HTTP 头部暴露给 JavaScript，使编写应用程序更加方便。[#74180](https://github.com/ClickHouse/ClickHouse/pull/74180) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `JSONEachRowWithProgress` 格式将包含带有元数据的事件，以及 totals 和 extremes。它还包括 `rows_before_limit_at_least` 和 `rows_before_aggregation`。如果在部分结果之后出现异常，此格式会正确输出该异常。进度信息现在包含已耗费的纳秒数。结束时会发送最后一个进度事件。查询运行期间的进度信息打印频率不会高于 `interactive_delay` 设置的取值。 [#74181](https://github.com/ClickHouse/ClickHouse/pull/74181) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 沙漏将在 Play UI 中顺滑旋转。[#74182](https://github.com/ClickHouse/ClickHouse/pull/74182) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 即使 HTTP 响应已被压缩，也要在数据包一到达时立即发送。这样浏览器就可以接收进度数据包和压缩数据。[#74201](https://github.com/ClickHouse/ClickHouse/pull/74201) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 新增支持在无需重启服务器的情况下，动态重新加载 `max_remote_read_network_bandwidth_for_serve` 和 `max_remote_write_network_bandwidth_for_server`。 [#74206](https://github.com/ClickHouse/ClickHouse/pull/74206) ([Kai Zhu](https://github.com/nauu)).
* 在 ClickHouse Client 中，通过连接到 9440 端口自动检测是否使用安全连接。[#74212](https://github.com/ClickHouse/ClickHouse/pull/74212) ([Christoph Wurm](https://github.com/cwurm))。
* 为 `http_handlers` 启用仅凭用户名的用户认证（此前还需要用户提供密码）。[#74221](https://github.com/ClickHouse/ClickHouse/pull/74221)（[Azat Khuzhin](https://github.com/azat)）。
* 对替代查询语言 PRQL 和 KQL 的支持已标记为实验性特性。要使用它们，请将设置 `allow_experimental_prql_dialect = 1` 和 `allow_experimental_kusto_dialect = 1` 打开。 [#74224](https://github.com/ClickHouse/ClickHouse/pull/74224) ([Robert Schulze](https://github.com/rschu1ze))。
* 在更多聚合函数中支持返回默认的 `Enum` 类型。[#74272](https://github.com/ClickHouse/ClickHouse/pull/74272)（[Raúl Marín](https://github.com/Algunenano)）。
* 在 `OPTIMIZE TABLE` 中，现在可以使用关键字 `FORCE` 来替代原有的关键字 `FINAL`。[#74342](https://github.com/ClickHouse/ClickHouse/pull/74342) ([Robert Schulze](https://github.com/rschu1ze))。
* 添加了一个 MergeTree 设置 `materialize_skip_indexes_on_merge`，用于在合并期间禁止创建 skip 索引。这样用户可以通过显式执行 `ALTER TABLE [..] MATERIALIZE INDEX [...]` 来控制何时创建 skip 索引。如果 skip 索引的构建开销较大（例如向量相似性索引），这将非常有用。[#74401](https://github.com/ClickHouse/ClickHouse/pull/74401)（[Robert Schulze](https://github.com/rschu1ze)）。
* 在默认表达式和物化表达式中支持子列。 [#74403](https://github.com/ClickHouse/ClickHouse/pull/74403) ([Pavel Kruglov](https://github.com/Avogar))。
* 优化 Storage(S3/Azure)Queue 中的 keeper 请求。[#74410](https://github.com/ClickHouse/ClickHouse/pull/74410) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 添加 `IsServerShuttingDown` 指标，用于在服务器关闭耗时过长时触发告警。 [#74429](https://github.com/ClickHouse/ClickHouse/pull/74429) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
* 在 EXPLAIN 输出中新增了 iceberg 表名。 [#74485](https://github.com/ClickHouse/ClickHouse/pull/74485) ([alekseev-maksim](https://github.com/alekseev-maksim)).
* 默认情况下最多使用 `1000` 个并行副本。[#74504](https://github.com/ClickHouse/ClickHouse/pull/74504) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* 在旧分析器中使用 `RECURSIVE CTE` 时提供更明确的错误信息。[#74523](https://github.com/ClickHouse/ClickHouse/pull/74523)（[Raúl Marín](https://github.com/Algunenano)）。
* 优化 Storage(S3/Azure)Queue 中的 Keeper 请求。 [#74538](https://github.com/ClickHouse/ClickHouse/pull/74538) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 在从 S3 磁盘读取时改进 HTTP 会话复用（[#72401](https://github.com/ClickHouse/ClickHouse/issues/72401)）。[#74548](https://github.com/ClickHouse/ClickHouse/pull/74548)（[Julian Maicher](https://github.com/jmaicher)）。
* 在 `system.errors` 中显示扩展错误信息。[#74574](https://github.com/ClickHouse/ClickHouse/pull/74574) ([Vitaly Baranov](https://github.com/vitlibar))。
* 为所有类型的复制任务启用了退避逻辑，这有助于降低 CPU 使用率、内存占用以及日志文件大小。新增了 `max_postpone_time_for_failed_replicated_fetches_ms`、`max_postpone_time_for_failed_replicated_merges_ms` 和 `max_postpone_time_for_failed_replicated_tasks_ms` 设置，其行为类似于 `max_postpone_time_for_failed_mutations_ms`。 [#74576](https://github.com/ClickHouse/ClickHouse/pull/74576) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* 对 `parallel_hash` JOIN 算法中的 `max_joined_block_size_rows` 设置进行了更精确的计量，有助于避免相比 `hash` 算法的额外内存消耗。 [#74630](https://github.com/ClickHouse/ClickHouse/pull/74630) ([Nikita Taranov](https://github.com/nickitat)).
* 添加了对 libhdfs3 配置选项 `dfs.client.use.datanode.hostname` 的支持。[#74635](https://github.com/ClickHouse/ClickHouse/pull/74635) ([Mikhail Tiukavkin](https://github.com/freshertm))。
* 修复错误：编解码器 &#39;snappy&#39; 不支持设置压缩级别。[#74659](https://github.com/ClickHouse/ClickHouse/pull/74659) ([Arthur Passos](https://github.com/arthurpassos))。
* 允许在客户端与 clickhouse-keeper 通信时使用密码。如果你为服务端和客户端正确配置了 SSL，这个功能的用处不大，但在某些场景下仍然可能有用。密码长度不能超过 16 个字符。它与 Keeper Auth 模型无关。[#74673](https://github.com/ClickHouse/ClickHouse/pull/74673) ([alesapin](https://github.com/alesapin))。
* 允许在创建备份时使用 blob 路径计算校验和。[#74729](https://github.com/ClickHouse/ClickHouse/pull/74729) ([Vitaly Baranov](https://github.com/vitlibar)).
* 如果在两个部分中，`JOIN` 键都是主键（`PK`）的前缀，则对 `JOIN` 使用动态分片。可以通过 `query_plan_join_shard_by_pk_ranges` 设置启用此优化（默认禁用）。[#74733](https://github.com/ClickHouse/ClickHouse/pull/74733)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 为配置重新加载器添加错误代码。 [#74746](https://github.com/ClickHouse/ClickHouse/pull/74746) ([Garrett Thomas](https://github.com/garrettthomaskth)).
* 在 MySQL 和 PostgreSQL 表函数与引擎中新增对 IPv6 地址的支持。[#74796](https://github.com/ClickHouse/ClickHouse/pull/74796) ([Mikhail Koviazin](https://github.com/mkmkme))。
* `codec Gorilla` 的参数现在将始终保存在 `.sql` 文件中的表元数据中。解决了：[#70072](https://github.com/ClickHouse/ClickHouse/issues/70072)。[#74814](https://github.com/ClickHouse/ClickHouse/pull/74814)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 为 `divideDecimal` 实现短路优化。修复 [#74280](https://github.com/ClickHouse/ClickHouse/issues/74280)。[#74843](https://github.com/ClickHouse/ClickHouse/pull/74843)（[Kevin Mingtarja](https://github.com/kevinmingtarja)）。
* 提升 Keeper 中大型多请求操作的性能。 [#74849](https://github.com/ClickHouse/ClickHouse/pull/74849) ([Antonio Andelic](https://github.com/antonio2368)).
* 现在可以在启动脚本中配置用户。[#74894](https://github.com/ClickHouse/ClickHouse/pull/74894)（[pufit](https://github.com/pufit)）。
* 在 `ALTER TABLE FETCH PARTITION` 中并行抓取数据分片（线程池大小由 `max_fetch_partition_thread_pool_size` 控制）。[#74978](https://github.com/ClickHouse/ClickHouse/pull/74978) ([Azat Khuzhin](https://github.com/azat))。
* 为 `system.query_cache` 新增了查询 ID 列（issue [#68205](https://github.com/ClickHouse/ClickHouse/issues/68205)）。 [#74982](https://github.com/ClickHouse/ClickHouse/pull/74982)（[NamNguyenHoai](https://github.com/NamHoaiNguyen)）。
* 重新启用了 SSH 协议。修复了一些严重漏洞，禁止再使用自定义 pager 或指定 `server-logs-file`。默认禁用了通过环境变量传递客户端选项（仍可通过 config.xml 中的 `ssh-server.enable_client_options_passing` 实现）。新增对 progress 表、查询取消、自动补全、profile events 进度、stdin 和 `send_logs_level` 选项的支持。关闭了任务：[#74340](https://github.com/ClickHouse/ClickHouse/issues/74340)。[#74989](https://github.com/ClickHouse/ClickHouse/pull/74989)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 修复在查询解释阶段出现异常时，未按查询中指定的自定义格式输出异常的问题。此前版本中，异常使用的是默认格式，而不是查询中指定的格式。此更改关闭了 [#55422](https://github.com/ClickHouse/ClickHouse/issues/55422)。[#74994](https://github.com/ClickHouse/ClickHouse/pull/74994)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 实现了解析增强功能（Sequence ID 解析：新增在清单文件中解析序列标识符的功能；Avro 元数据解析：重新设计 Avro 元数据解析器，使其易于扩展以支持未来的增强）。 [#75010](https://github.com/ClickHouse/ClickHouse/pull/75010) ([Daniil Ivanik](https://github.com/divanik)).
* 现在允许使用 `KILL QUERY` 和超时参数(`max_execution_time`)来取消 `ALTER TABLE ... FREEZE ...` 查询。[#75016](https://github.com/ClickHouse/ClickHouse/pull/75016) ([Kirill](https://github.com/kirillgarbar))。
* 新增对将 `groupUniqArrayArrayMap` 用作 `SimpleAggregateFunction` 的支持。 [#75034](https://github.com/ClickHouse/ClickHouse/pull/75034) ([Miel Donkers](https://github.com/mdonkers)).
* 在 Postgres 线路协议中支持预编译语句。 [#75035](https://github.com/ClickHouse/ClickHouse/pull/75035) ([scanhex12](https://github.com/scanhex12)).
* 在数据库引擎 `Iceberg` 中隐藏目录凭证设置。修复了 [#74559](https://github.com/ClickHouse/ClickHouse/issues/74559)。[#75080](https://github.com/ClickHouse/ClickHouse/pull/75080)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 在 BuzzHouse 中补充了几个缺失的特性：`ILIKE` 和 `REGEXP` 运算符、`<=>` 以及 `IS NOT DISTINCT FROM`。[#75168](https://github.com/ClickHouse/ClickHouse/pull/75168)（[Pedro Ferreira](https://github.com/PedroTadim)）。
* 设置 `min_chunk_bytes_for_parallel_parsing` 现在不能为零。此更改修复了：[#71110](https://github.com/ClickHouse/ClickHouse/issues/71110)。[#75239](https://github.com/ClickHouse/ClickHouse/pull/75239)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* `intExp2` / `intExp10`：为原本未定义的行为进行定义：对于过小的参数返回 0，对于过大的参数返回 `18446744073709551615`，若为 `nan` 则抛出异常。[#75312](https://github.com/ClickHouse/ClickHouse/pull/75312)（[Vitaly Baranov](https://github.com/vitlibar)）。
* 在 `DatabaseIceberg` 中通过目录配置原生支持 `s3.endpoint`。修复 [#74558](https://github.com/ClickHouse/ClickHouse/issues/74558)。[#75375](https://github.com/ClickHouse/ClickHouse/pull/75375)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 当执行 `SYSTEM DROP REPLICA` 的用户没有足够权限时，不要悄然失败。 [#75377](https://github.com/ClickHouse/ClickHouse/pull/75377) ([Bharat Nallan](https://github.com/bharatnc)).
* 添加一个用于统计任意系统日志刷新失败次数的 `ProfileEvent`。 [#75466](https://github.com/ClickHouse/ClickHouse/pull/75466) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 为解密和解压缩添加检查和日志。[#75471](https://github.com/ClickHouse/ClickHouse/pull/75471) ([Vitaly Baranov](https://github.com/vitlibar))。
* 在 `parseTimeDelta` 函数中增加了对微符号（U+00B5）的支持。现在微符号（U+00B5）和希腊字母 μ（U+03BC）都被识别为微秒的有效表示形式，使 ClickHouse 的行为与 Go 的实现保持一致（[参见 time.go](https://github.com/golang/go/blob/ad7b46ee4ac1cee5095d64b01e8cf7fcda8bee5e/src/time/time.go#L983C19-L983C20) 和 [time/format.go](https://github.com/golang/go/blob/ad7b46ee4ac1cee5095d64b01e8cf7fcda8bee5e/src/time/format.go#L1608-L1609)）。[#75472](https://github.com/ClickHouse/ClickHouse/pull/75472)（[Vitaly Orlov](https://github.com/orloffv)）。
* 将服务器端设置（`send_settings_to_client`）替换为客户端设置（`apply_settings_from_server`），用于控制客户端代码（例如解析 INSERT 数据和格式化查询输出）是否应当使用服务器 `users.xml` 和用户配置文件中的设置。否则将仅使用来自客户端命令行、会话以及查询本身的设置。请注意，这仅适用于原生客户端（不适用于例如 HTTP），并且不适用于大部分查询处理过程（该过程发生在服务器端）。[#75478](https://github.com/ClickHouse/ClickHouse/pull/75478)（[Michael Kolupaev](https://github.com/al13n321)）。
* Keeper 改进：在提交到内存存储时禁用摘要计算以提升性能。可以通过 `keeper_server.digest_enabled_on_commit` 配置项启用。对请求进行预处理时仍会计算摘要。[#75490](https://github.com/ClickHouse/ClickHouse/pull/75490) ([Antonio Andelic](https://github.com/antonio2368)).
* 在可能的情况下，将过滤表达式从 JOIN 的 ON 子句中下推。[#75536](https://github.com/ClickHouse/ClickHouse/pull/75536) ([Vladimir Cherkasov](https://github.com/vdimir))。
* 在出现语法错误时提供更清晰的错误消息。此前，如果查询过大，且长度超出限制的 token 是一个非常长的字符串字面量，用于说明原因的消息会被夹在该超长 token 的两个示例之间而丢失。修复了错误消息中对包含 UTF-8 的查询进行错误截断的问题。修复了对查询片段进行过度引用的问题。修复了 [#75473](https://github.com/ClickHouse/ClickHouse/issues/75473)。[#75561](https://github.com/ClickHouse/ClickHouse/pull/75561)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在存储 `S3(Azure)Queue` 中添加配置文件事件（profile events）。 [#75618](https://github.com/ClickHouse/ClickHouse/pull/75618) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 出于兼容性原因，禁用从服务器向客户端发送设置（`send_settings_to_client=false`）（该功能之后将重新实现为客户端设置，以提升易用性）。 [#75648](https://github.com/ClickHouse/ClickHouse/pull/75648) ([Michael Kolupaev](https://github.com/al13n321)).
* 添加配置项 `memory_worker_correct_memory_tracker`，以启用利用在后台线程中定期读取的不同来源信息来校正内部内存跟踪器。 [#75714](https://github.com/ClickHouse/ClickHouse/pull/75714) ([Antonio Andelic](https://github.com/antonio2368))。
* 在 PrometheusRemoteReadProtocol 中使用分析器（Analyzer）。 [#75729](https://github.com/ClickHouse/ClickHouse/pull/75729) ([Dmitry Novik](https://github.com/novikd)).
* 我们已经支持 gauge/counter 指标类型。然而，这些类型不足以覆盖某些指标（例如对 keeper 的请求响应时间），因此需要引入对 histogram 指标类型的支持。该接口与 Prometheus 客户端高度相似，只需调用 `observe(value)`，即可在对应于该值的 bucket 中将计数器加一。histogram 指标通过 system.histogram&#95;metrics 暴露。[#75736](https://github.com/ClickHouse/ClickHouse/pull/75736)（[Miсhael Stetsyuk](https://github.com/mstetsyuk)）。
* 将列 `normalized_query_hash` 添加到 `system.processes` 中。注意：虽然可以使用 `normalizedQueryHash` 函数按需轻松计算该列，但这是为后续更改做准备所必需的。[#75756](https://github.com/ClickHouse/ClickHouse/pull/75756) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 即使存在基于已不存在的数据库创建的 `Merge` 表，查询 `system.tables` 也不会抛出异常。移除 `Hive` 表中的 `getTotalRows` 方法，因为我们不允许它执行复杂操作。[#75772](https://github.com/ClickHouse/ClickHouse/pull/75772) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* Web UI 现在支持交互式数据库导航。 [#75777](https://github.com/ClickHouse/ClickHouse/pull/75777) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 允许在存储策略中组合只读和读写磁盘（作为多个卷或多个磁盘）。这样可以从整个卷中读取数据，而插入操作将优先写入可写磁盘（即写时复制存储策略）。[#75862](https://github.com/ClickHouse/ClickHouse/pull/75862) ([Azat Khuzhin](https://github.com/azat))。
* 从 `system.opentelemetry_span_log` 的默认 `ORDER BY` 中移除了 `trace_id`。 [#75907](https://github.com/ClickHouse/ClickHouse/pull/75907) ([Azat Khuzhin](https://github.com/azat)).
* 加密（XML 属性 `encrypted_by`）现在可以应用于任意配置文件（config.xml、users.xml、嵌套配置文件）。此前，它仅适用于顶层 config.xml 文件。[#75911](https://github.com/ClickHouse/ClickHouse/pull/75911)（[Mikhail Gorshkov](https://github.com/mgorshkov)）。
* 以微秒精度存储备份的 start&#95;time/end&#95;time。 [#75929](https://github.com/ClickHouse/ClickHouse/pull/75929) ([Aleksandr Musorin](https://github.com/AVMusorin))。
* 新增 `MemoryTrackingUncorrected` 指标，用于显示未经过 RSS 校正的内部全局内存跟踪器的值。 [#75935](https://github.com/ClickHouse/ClickHouse/pull/75935) ([Antonio Andelic](https://github.com/antonio2368)).
* 在 MergeTree 中惰性计算列和索引的大小。[#75938](https://github.com/ClickHouse/ClickHouse/pull/75938)（[Pavel Kruglov](https://github.com/Avogar)）。
* 当输出列绑定到左表时,将 join 转换为 in 子查询,由于首先需要执行唯一性检查步骤,因此默认禁用此功能,待后续添加该步骤后启用。[#75942](https://github.com/ClickHouse/ClickHouse/pull/75942) ([Shichao Jin](https://github.com/jsc0218))。
* 新增服务器设置 `throw_on_unknown_workload`,用于选择当查询的 `workload` 设置为未知值时的行为:允许无限制访问(默认)或抛出 `RESOURCE_ACCESS_DENIED` 错误。该设置可用于强制所有查询使用工作负载调度。[#75999](https://github.com/ClickHouse/ClickHouse/pull/75999) ([Sergei Trifonov](https://github.com/serxa))。
* 使新的实验性 Kafka 表引擎完全遵循 Keeper 功能标志。[#76004](https://github.com/ClickHouse/ClickHouse/pull/76004) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
* 除非必要，不要在 `ARRAY JOIN` 中将子列重写为 `getSubcolumn`。 [#76018](https://github.com/ClickHouse/ClickHouse/pull/76018) ([Pavel Kruglov](https://github.com/Avogar))。
* 在加载表时对协调错误进行重试。[#76020](https://github.com/ClickHouse/ClickHouse/pull/76020) ([Alexander Tokmakov](https://github.com/tavplubix))。
* 改进 `system.warnings` 表，并新增一些可动态添加、更新或移除的警告消息。 [#76029](https://github.com/ClickHouse/ClickHouse/pull/76029) ([Bharat Nallan](https://github.com/bharatnc)).
* 在 `SYSTEM FLUSH LOGS` 中支持刷新单个日志。[#76132](https://github.com/ClickHouse/ClickHouse/pull/76132)（[Raúl Marín](https://github.com/Algunenano)）。
* 改进了 `/binary` 服务器页面。使用 Hilbert 曲线替代 Morton 曲线。在方形区域中显示 512 MB 的地址范围,能够更充分地填充整个方形区域(在之前的版本中,地址仅填充了方形区域的一半)。根据库名称而非函数名称对地址进行着色。允许在区域外进行更大范围的滚动。[#76192](https://github.com/ClickHouse/ClickHouse/pull/76192) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 此 PR 禁止运行查询 `ALTER USER user1 ADD PROFILES a, DROP ALL PROFILES`，因为所有 `DROP` 操作在顺序中必须放在最前面。[#76242](https://github.com/ClickHouse/ClickHouse/pull/76242) ([pufit](https://github.com/pufit))。
* 针对 SYNC REPLICA 的多项改进（更友好的错误信息、更完善的测试、更合理的校验）。[#76307](https://github.com/ClickHouse/ClickHouse/pull/76307) ([Azat Khuzhin](https://github.com/azat))。
* 在出现 TOO&#95;MANY&#95;SIMULTANEOUS&#95;QUERIES 错误时重试 ON CLUSTER 查询。[#76352](https://github.com/ClickHouse/ClickHouse/pull/76352) ([Patrick Galbraith](https://github.com/CaptTofu)).
* 将 `output_format_pretty_max_rows` 的默认值从 10000 调整为 1000。我认为这样在可用性方面更好。[#76407](https://github.com/ClickHouse/ClickHouse/pull/76407) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 在只读 MergeTree 表中支持刷新操作。[#76467](https://github.com/ClickHouse/ClickHouse/pull/76467)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在备份到 S3 过程中，如果在多部分复制时因 `Access Denied` 失败，则使用正确的回退机制。当在使用不同凭据的 bucket 之间进行备份时，多部分复制可能会产生 `Access Denied` 错误。[#76515](https://github.com/ClickHouse/ClickHouse/pull/76515)（[Antonio Andelic](https://github.com/antonio2368)）。
* 更快关闭 ClickHouse Server（去除 2.5 秒延迟）。[#76550](https://github.com/ClickHouse/ClickHouse/pull/76550) ([Azat Khuzhin](https://github.com/azat)).
* 在 system.errors 中添加 query&#95;id。相关工单 [#75815](https://github.com/ClickHouse/ClickHouse/issues/75815)。[#76581](https://github.com/ClickHouse/ClickHouse/pull/76581)（[Vladimir Baikov](https://github.com/bkvvldmr)）。
* 将 librdkafka 升级到 2.8.0 版本，并改进了 Kafka 表的关闭流程，从而减少了在删除表和重启服务器时的延迟。`engine=Kafka` 在删除表时不再显式退出 consumer group。相反，consumer 会继续留在 group 中，直到在一段空闲时间后根据 `session_timeout_ms`（默认：45 秒）被自动移除。[#76621](https://github.com/ClickHouse/ClickHouse/pull/76621)（[filimonov](https://github.com/filimonov)）。
* 修复对 S3 请求设置的校验。[#76658](https://github.com/ClickHouse/ClickHouse/pull/76658) ([Vitaly Baranov](https://github.com/vitlibar))。
* 避免在 `readbufferfroms3` 和其他远程读取缓冲区中出现多余的内存分配，将其内存占用减少一半。 [#76692](https://github.com/ClickHouse/ClickHouse/pull/76692) ([Sema Checherinda](https://github.com/CheSema)).
* 支持在视图中读取 JSON 类型及其子列。[#76903](https://github.com/ClickHouse/ClickHouse/pull/76903) ([Pavel Kruglov](https://github.com/Avogar)).
* 添加对将 UInt128 转换为 IPv6 的支持。这样可以对 IPv6 执行 `bitAnd` 运算和算术运算，并将结果转换回 IPv6。关闭 [#76752](https://github.com/ClickHouse/ClickHouse/issues/76752)。这也允许将对 IPv6 执行 `bitAnd` 运算的结果再转换回 IPv6。参见：[https://github.com/ClickHouse/ClickHouse/pull/57707](https://github.com/ClickHouse/ClickHouse/pull/57707)。[#76928](https://github.com/ClickHouse/ClickHouse/pull/76928)（[Muzammil Abdul Rehman](https://github.com/muzammilar)）。
* 像 `server_settings` 或 `settings` 这样的系统表都有一个 `default` 值列，这非常方便，只有 `merge_tree_settings` 和 `replicated_merge_tree_settings` 没有启用该列。[#76942](https://github.com/ClickHouse/ClickHouse/pull/76942) ([Diego Nieto](https://github.com/lesandie))。
* 默认情况下，不会在 Variant 类型的文本格式中解析特殊 Bool 值。可以通过设置 `allow_special_bool_values_inside_variant` 来启用此行为。[#76974](https://github.com/ClickHouse/ClickHouse/pull/76974) ([Pavel Kruglov](https://github.com/Avogar)).
* 在会话级别和服务器级别支持配置低优先级查询中每个任务的等待时间。[#77013](https://github.com/ClickHouse/ClickHouse/pull/77013) ([VicoWu](https://github.com/VicoWu))。
* 新增 `ProfileEvents::QueryPreempted`，其逻辑与 `CurrentMetrics::QueryPreempted` 相同。 [#77015](https://github.com/ClickHouse/ClickHouse/pull/77015) ([VicoWu](https://github.com/VicoWu)).
* 此前，`database replicated` 可能会在日志中打印查询中指定的凭据。该问题已修复，并关闭了：[#77123](https://github.com/ClickHouse/ClickHouse/issues/77123)。[#77133](https://github.com/ClickHouse/ClickHouse/pull/77133)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 将 zstd 从 1.5.5 升级到 1.5.7，带来[显著的性能提升](https://github.com/facebook/zstd/releases/tag/v1.5.7)。[#77137](https://github.com/ClickHouse/ClickHouse/pull/77137)（[Pradeep Chhetri](https://github.com/chhetripradeep)）。
* 允许在 plain&#95;rewritable 磁盘上执行 ALTER TABLE DROP PARTITION 操作。 [#77138](https://github.com/ClickHouse/ClickHouse/pull/77138) ([Julia Kartseva](https://github.com/jkartseva)).
* 在零拷贝复制的情况下，在执行合并/变更之前，新增最多随机休眠 500ms 的能力，该休眠与分片大小无关。[#77165](https://github.com/ClickHouse/ClickHouse/pull/77165) ([Alexey Katsman](https://github.com/alexkats))。
* 在将 `TRUNCATE` 与 `INTO OUTFILE` 一起使用时支持原子性重命名。修复了 [#70323](https://github.com/ClickHouse/ClickHouse/issues/70323)。[#77181](https://github.com/ClickHouse/ClickHouse/pull/77181)（[Onkar Deshpande](https://github.com/onkar)）。
* 对 PostgreSQL 的 CHARACTER、CHAR 和 BPCHAR 使用 FixedString。[#77304](https://github.com/ClickHouse/ClickHouse/pull/77304) ([Pablo Marcos](https://github.com/pamarcos))。
* 允许通过存储/表函数设置 `iceberg_metadata_file_path` 显式指定要读取的 Iceberg 元数据文件。修复了 [#47412](https://github.com/ClickHouse/ClickHouse/issues/47412)。[#77318](https://github.com/ClickHouse/ClickHouse/pull/77318)（[alesapin](https://github.com/alesapin)）。
* 支持使用远程磁盘为数据库存储元数据文件。[#77365](https://github.com/ClickHouse/ClickHouse/pull/77365) ([Tuan Pham Anh](https://github.com/tuanpach))。
* 为 JSON 数据类型的值实现比较功能。现在可以像比较 Map 一样比较 JSON 对象。[#77397](https://github.com/ClickHouse/ClickHouse/pull/77397) ([Pavel Kruglov](https://github.com/Avogar)).
* 更改已回退。 [#77399](https://github.com/ClickHouse/ClickHouse/pull/77399) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 备份/恢复设置 `allow_s3_native_copy` 现在支持三个可能的取值：`False` - 不会使用 S3 原生拷贝；`True`（旧默认值）- ClickHouse 将首先尝试使用 S3 原生拷贝，如果失败则回退到读+写方式；`'auto'`（新默认值）- ClickHouse 会先比较源端和目标端的凭据。如果相同，ClickHouse 将尝试 S3 原生拷贝，失败时再回退到读+写方式。如果不同，ClickHouse 将直接使用读+写方式。[#77401](https://github.com/ClickHouse/ClickHouse/pull/77401) ([Vitaly Baranov](https://github.com/vitlibar)).
* 支持 plain&#95;rewritable 磁盘的 ALTER TABLE ... ATTACH|DETACH|MOVE|REPLACE PARTITION 操作。[#77406](https://github.com/ClickHouse/ClickHouse/pull/77406) ([Julia Kartseva](https://github.com/jkartseva))。
* 跳过索引缓存的改动已被回退。 [#77447](https://github.com/ClickHouse/ClickHouse/pull/77447) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* 在 Wide 部分中预取 JSON 列时减少内存使用。[#77640](https://github.com/ClickHouse/ClickHouse/pull/77640) ([Pavel Kruglov](https://github.com/Avogar)).
* 在 DeltaLake 表引擎的 delta kernel 中增加对 AWS 会话令牌和环境凭证的支持。[#77661](https://github.com/ClickHouse/ClickHouse/pull/77661)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 在 `additional_table_filters` 设置中支持查询参数。变更后，以下查询将成功执行：[ #77680](https://github.com/ClickHouse/ClickHouse/pull/77680)（[wxybear](https://github.com/wxybear)）。
* 现在可以在 UDF（用户自定义函数）的 XML 定义中通过一个新标签将其标记为确定性函数（deterministic）。同时，查询缓存现在会检查查询中调用的 UDF 是否为确定性函数；如果是，则会缓存该查询的结果。（Issue [#59988](https://github.com/ClickHouse/ClickHouse/issues/59988)）。[#77769](https://github.com/ClickHouse/ClickHouse/pull/77769)（[Jimmy Aguilar Mena](https://github.com/Ergus)）。
* 添加了对 Buffer 表引擎参数的验证。 [#77840](https://github.com/ClickHouse/ClickHouse/pull/77840) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* 添加配置项 `enable_hdfs_pread` 以启用或禁用 HDFS 预读。 [#77885](https://github.com/ClickHouse/ClickHouse/pull/77885) ([kevinyhzou](https://github.com/KevinyhZou)).
* 为 ZooKeeper 的 `multi` 读写请求数量添加 profile events。 [#77888](https://github.com/ClickHouse/ClickHouse/pull/77888) ([JackyWoo](https://github.com/JackyWoo))。
* 在开启 `disable_insertion_and_mutation` 时，允许创建临时表并向其插入数据。[#77901](https://github.com/ClickHouse/ClickHouse/pull/77901) ([Xu Jia](https://github.com/XuJia0210))。
* 将 max&#95;insert&#95;delayed&#95;streams&#95;for&#95;parallel&#95;write 下调至 100。 [#77919](https://github.com/ClickHouse/ClickHouse/pull/77919) ([Azat Khuzhin](https://github.com/azat)).
* 新增了通过 `max_merge_delayed_streams_for_parallel_write` 配置合并操作中可并行刷写列数的功能（这应当可以将针对 S3 的纵向合并内存使用量减少约 25 倍）。 [#77922](https://github.com/ClickHouse/ClickHouse/pull/77922) ([Azat Khuzhin](https://github.com/azat)).
* 修复 joda 语法中类似 &#39;yyy&#39; 的年份解析问题。[#77973](https://github.com/ClickHouse/ClickHouse/pull/77973) ([李扬](https://github.com/taiyang-li)).
* 附加 MergeTree 表的分片时将按照其数据块顺序执行，这对于诸如 ReplacingMergeTree 等特殊合并算法非常重要。此更改关闭了 [#71009](https://github.com/ClickHouse/ClickHouse/issues/71009)。[#77976](https://github.com/ClickHouse/ClickHouse/pull/77976)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 查询掩码规则现在可以在发生匹配时抛出 `LOGICAL_ERROR`。这有助于检查预定义的密码是否在日志中的任何位置泄露。[#78094](https://github.com/ClickHouse/ClickHouse/pull/78094) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
* 在 `information_schema.tables` 中新增列 `index_length_column`，以提高与 MySQL 的兼容性。[#78119](https://github.com/ClickHouse/ClickHouse/pull/78119) ([Paweł Zakrzewski](https://github.com/KrzaQ))。
* 引入两个新指标：`TotalMergeFailures` 和 `NonAbortedMergeFailures`。这些指标用于检测在短时间内出现过多合并失败的情况。[#78150](https://github.com/ClickHouse/ClickHouse/pull/78150) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
* 修复在路径样式中未指定 key 时对 S3 URI 的错误解析。[#78185](https://github.com/ClickHouse/ClickHouse/pull/78185) ([Arthur Passos](https://github.com/arthurpassos))。
* 修复异步指标 `BlockActiveTime`、`BlockDiscardTime`、`BlockWriteTime`、`BlockQueueTime` 和 `BlockReadTime` 的错误取值（在此变更之前，1 秒被错误地报告为 0.001）。 [#78211](https://github.com/ClickHouse/ClickHouse/pull/78211) ([filimonov](https://github.com/filimonov)).
* 在将数据推送到基于 StorageS3(Azure)Queue 的物化视图时，针对错误的重试现在会遵循 `loading_retries` 限制。在此之前，此类错误会被无限次重试。[#78313](https://github.com/ClickHouse/ClickHouse/pull/78313) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 在基于 delta-kernel-rs 实现的 StorageDeltaLake 中，修复了性能问题和进度条。[#78368](https://github.com/ClickHouse/ClickHouse/pull/78368) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 向量相似性索引可能会将主内存最多多分配 2 倍。此修复重构了内存分配策略，降低了内存消耗，并提升了向量相似性索引缓存的效果。（issue [#78056](https://github.com/ClickHouse/ClickHouse/issues/78056)）。[#78394](https://github.com/ClickHouse/ClickHouse/pull/78394)（[Shankar Iyer](https://github.com/shankar-iyer)）。
* 为 `system.metric_log` 表引入一个用于指定模式类型的设置 `schema_type`。允许使用三种模式：`wide` —— 当前使用的模式，每个 metric/event 存储在单独的列中（对单列读取最高效）；`transposed` —— 类似于 `system.asynchronous_metric_log`，metric/event 以行的形式存储；以及最有意思的 `transposed_with_wide_view` —— 使用 `transposed` 模式创建底层表，同时再引入一个采用 `wide` 模式的视图，将对视图的查询转换为对底层表的查询。在 `transposed_with_wide_view` 中，视图不支持亚秒级精度，`event_time_microseconds` 只是一个用于向后兼容的别名。[#78412](https://github.com/ClickHouse/ClickHouse/pull/78412) ([alesapin](https://github.com/alesapin)).
* 为运行时磁盘添加对 `include`、`from_env`、`from_zk` 的支持。关闭 [#78177](https://github.com/ClickHouse/ClickHouse/issues/78177)。[#78470](https://github.com/ClickHouse/ClickHouse/pull/78470)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 在 iceberg 表函数和引擎中新增多种便捷方式来解析根 metadata.json 文件。修复 [#78455](https://github.com/ClickHouse/ClickHouse/issues/78455)。[#78475](https://github.com/ClickHouse/ClickHouse/pull/78475)（[Daniil Ivanik](https://github.com/divanik)）。
* 在 Delta Lake 中支持分区裁剪。 [#78486](https://github.com/ClickHouse/ClickHouse/pull/78486) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 在 ClickHouse 中为 SSH 协议添加基于密码的身份验证支持。[#78586](https://github.com/ClickHouse/ClickHouse/pull/78586) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
* 为长时间运行的 `mutation` 在 `system.warnings` 表中添加动态警告。 [#78658](https://github.com/ClickHouse/ClickHouse/pull/78658) ([Bharat Nallan](https://github.com/bharatnc)).
* 如果 CPU 严重过载，则会终止连接。该决策基于等待时间（`OSCPUWaitMicroseconds`）与忙碌时间（`OSCPUVirtualTimeMicroseconds`）的比值。当该比值介于 `min_os_cpu_wait_time_ratio_to_drop_connection` 和 `max_os_cpu_wait_time_ratio_to_drop_connection` 之间时，将以一定概率终止查询。[#78778](https://github.com/ClickHouse/ClickHouse/pull/78778)（[Alexey Katsman](https://github.com/alexkats)）。
* 允许在 Hive 分区中使用空值。[#78816](https://github.com/ClickHouse/ClickHouse/pull/78816)（[Arthur Passos](https://github.com/arthurpassos)）。
* 修复 `BFloat16` 在 `IN` 子句中的类型转换问题（即 `SELECT toBFloat16(1) IN [1, 2, 3];` 现在返回 `1`）。修复了 [#78754](https://github.com/ClickHouse/ClickHouse/issues/78754)。[#78839](https://github.com/ClickHouse/ClickHouse/pull/78839)（[Raufs Dunamalijevs](https://github.com/rienath)）。
* 如果已设置 `disk=`，则不再在其他磁盘上检查 MergeTree 的各个部分。 [#78855](https://github.com/ClickHouse/ClickHouse/pull/78855) ([Azat Khuzhin](https://github.com/azat)).
* 将 `system.query_log` 中 `used_data_type_families` 的数据类型规范化为标准形式。 [#78972](https://github.com/ClickHouse/ClickHouse/pull/78972) ([Kseniia Sumarokova](https://github.com/kssenii)).





## Bug Fix (官方稳定版本中用户可见的错误行为) {#bug-fix}


* 修复使用 keeper-client 无法创建 SEQUENTIAL 节点的问题。 [#64177](https://github.com/ClickHouse/ClickHouse/pull/64177) ([Duc Canh Le](https://github.com/canhld94)).
* 修复了从父作用域解析标识符的问题。允许在 WITH 子句中为表达式使用别名。修复了 [#58994](https://github.com/ClickHouse/ClickHouse/issues/58994)、[#62946](https://github.com/ClickHouse/ClickHouse/issues/62946)、[#63239](https://github.com/ClickHouse/ClickHouse/issues/63239)、[#65233](https://github.com/ClickHouse/ClickHouse/issues/65233)、[#71659](https://github.com/ClickHouse/ClickHouse/issues/71659)、[#71828](https://github.com/ClickHouse/ClickHouse/issues/71828)、[#68749](https://github.com/ClickHouse/ClickHouse/issues/68749)。[#66143](https://github.com/ClickHouse/ClickHouse/pull/66143) ([Dmitry Novik](https://github.com/novikd))。
* 修复 PositionImpl::vectorVector 中字符计数错误的问题。[#71003](https://github.com/ClickHouse/ClickHouse/pull/71003) ([思维](https://github.com/heymind))。
* 修复 `negate` 函数的单调性。在之前的版本中，查询 `select * from a where -x = -42;`（其中 `x` 为主键）可能会返回错误的结果。[#71440](https://github.com/ClickHouse/ClickHouse/pull/71440) ([Michael Kolupaev](https://github.com/al13n321))。
* 由于未处理部分权限撤销的问题,针对访问实体的 `RESTORE` 操作所需权限超出了必要范围。此 PR 修复了该问题。关闭 [#71853](https://github.com/ClickHouse/ClickHouse/issues/71853)。[#71958](https://github.com/ClickHouse/ClickHouse/pull/71958) ([pufit](https://github.com/pufit))。
* 避免在执行 `ALTER TABLE REPLACE/MOVE PARTITION FROM/TO TABLE` 后进入暂停状态。为后台任务调度获取正确的设置。[#72024](https://github.com/ClickHouse/ClickHouse/pull/72024)（[Aleksei Filatov](https://github.com/aalexfvk)）。
* 修复 `arrayIntersect` 中对空元组的处理。这修复了 [#72578](https://github.com/ClickHouse/ClickHouse/issues/72578)。[#72581](https://github.com/ClickHouse/ClickHouse/pull/72581)（[Amos Bird](https://github.com/amosbird)）。
* 修复在某些输入和输出格式（例如 Parquet、Arrow）中对空 `tuple` 的处理。[#72616](https://github.com/ClickHouse/ClickHouse/pull/72616)（[Michael Kolupaev](https://github.com/al13n321)）。
* 现在，在使用通配符数据库/表时发出的列级 `GRANT SELECT/INSERT` 语句会抛出错误。[#72646](https://github.com/ClickHouse/ClickHouse/pull/72646) ([Johann Gan](https://github.com/johanngan)).
* 修复了这样一种情况：由于目标访问实体中存在隐式授权，用户无法执行 `REVOKE ALL ON *.*`。 [#72872](https://github.com/ClickHouse/ClickHouse/pull/72872) ([pufit](https://github.com/pufit)).
* 修复异步分布式 INSERT 在处理待处理批次时卡住的问题(例如由于 `No such file or directory` 错误)。[#72939](https://github.com/ClickHouse/ClickHouse/pull/72939) ([Azat Khuzhin](https://github.com/azat))。
* 添加对 Azure SAS 令牌的支持。[#72959](https://github.com/ClickHouse/ClickHouse/pull/72959) ([Azat Khuzhin](https://github.com/azat))。
* 修复 `formatDateTime` 标量函数中正时区的格式化方式。 [#73091](https://github.com/ClickHouse/ClickHouse/pull/73091) ([ollidraese](https://github.com/ollidraese)).
* 修复了在通过 PROXYv1 建立连接且设置了 `auth_use_forwarded_address` 时源端口反映不正确的问题 —— 之前错误地使用了代理端口。新增 `currentQueryID()` 函数。[#73095](https://github.com/ClickHouse/ClickHouse/pull/73095) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 在 `TCPHandler` 中将格式设置传递给 `NativeWriter`，以便正确应用诸如 `output_format_native_write_json_as_string` 之类的设置。[#73179](https://github.com/ClickHouse/ClickHouse/pull/73179) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复使用错误前缀读取 JSON 子对象子列的行为。 [#73182](https://github.com/ClickHouse/ClickHouse/pull/73182) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复 `StorageObjectStorageQueue` 中的崩溃。 [#73274](https://github.com/ClickHouse/ClickHouse/pull/73274) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复了在服务器关闭期间可刷新物化视图中出现的罕见崩溃问题。[#73323](https://github.com/ClickHouse/ClickHouse/pull/73323) ([Michael Kolupaev](https://github.com/al13n321)).
* 函数 `formatDateTime` 的 `%f` 占位符现在始终生成六位（子秒）数字。这使得其行为与 MySQL 的 `DATE_FORMAT` 函数保持兼容。可以通过设置 `formatdatetime_f_prints_scale_number_of_digits = 1` 来恢复之前的行为。[#73324](https://github.com/ClickHouse/ClickHouse/pull/73324) ([ollidraese](https://github.com/ollidraese))。
* 通过在索引分析期间对隐式 `Date` 到 `DateTime` 转换强制采用饱和行为，改进了日期时间转换。这解决了由于日期时间取值范围限制而可能导致的索引分析不准确问题，修复了 [#73307](https://github.com/ClickHouse/ClickHouse/issues/73307)。同时还修复了在 `date_time_overflow_behavior = 'ignore'`（默认值）时显式调用 `toDateTime` 的转换问题。[#73326](https://github.com/ClickHouse/ClickHouse/pull/73326)（[Amos Bird](https://github.com/amosbird)）。
* 修复了从 `s3` 存储和表函数读取时按 `_etag` 列进行过滤的问题。 [#73353](https://github.com/ClickHouse/ClickHouse/pull/73353) ([Anton Popov](https://github.com/CurtizJ)).
* 修复了使用旧分析器时,在 `JOIN ON` 表达式中使用 `IN (subquery)` 导致的 `Not-ready Set is passed as the second argument for function 'in'` 错误。[#73382](https://github.com/ClickHouse/ClickHouse/pull/73382) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
* 修复 Dynamic 和 JSON 列的压缩准备问题。此前在某些情况下,即使类型/路径数量未达到限制,新类型仍可能被插入到共享变体/共享数据中。[#73388](https://github.com/ClickHouse/ClickHouse/pull/73388) ([Pavel Kruglov](https://github.com/Avogar))。
* 在类型的二进制解码过程中检查损坏的大小值，以避免过大的内存分配。 [#73390](https://github.com/ClickHouse/ClickHouse/pull/73390) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复了在启用并行副本时，从单副本集群读取数据时的逻辑错误。 [#73403](https://github.com/ClickHouse/ClickHouse/pull/73403) ([Michael Kolupaev](https://github.com/al13n321)).
* 修复在 ZooKeeper 和旧版 Keeper 上运行的 ObjectStorageQueue。 [#73420](https://github.com/ClickHouse/ClickHouse/pull/73420) ([Antonio Andelic](https://github.com/antonio2368)).
* 实现了修复,以便默认启用 Hive 分区。[#73479](https://github.com/ClickHouse/ClickHouse/pull/73479) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 修复创建向量相似性索引时的数据竞争问题。 [#73517](https://github.com/ClickHouse/ClickHouse/pull/73517) ([Antonio Andelic](https://github.com/antonio2368)).
* 修复了当字典的数据源包含数据错误的函数时发生的段错误。 [#73535](https://github.com/ClickHouse/ClickHouse/pull/73535) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 修复 `storage S3(Azure)Queue` 中插入失败时的重试逻辑。关闭 [#70951](https://github.com/ClickHouse/ClickHouse/issues/70951)。[#73546](https://github.com/ClickHouse/ClickHouse/pull/73546)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 修复了在某些情况下，对包含 `LowCardinality` 元素且启用了 `optimize_functions_to_subcolumns` 设置的元组使用函数 `tupleElement` 时可能出现的错误。 [#73548](https://github.com/ClickHouse/ClickHouse/pull/73548) ([Anton Popov](https://github.com/CurtizJ)).
* 修复了解析 `enum` 通配符后接范围时的问题。修复了 [#73473](https://github.com/ClickHouse/ClickHouse/issues/73473)。[#73569](https://github.com/ClickHouse/ClickHouse/pull/73569)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 修复了在针对非复制表的子查询中，`parallel_replicas_for_non_replicated_merge_tree` 被忽略的问题。 [#73584](https://github.com/ClickHouse/ClickHouse/pull/73584) ([Igor Nikonov](https://github.com/devcrafter)).
* 修复在任务无法被调度时抛出的 `std::logical_error`，该问题在压力测试中被发现。示例堆栈跟踪：`2024.12.19 02:05:46.171833 [ 18190 ] {01f0daba-d3cc-4898-9e0e-c2c263306427} <Fatal> : Logical error: 'std::exception. Code: 1001, type: std::__1::future_error, e.what() = The associated promise has been destructed prior to the associated state becoming ready. (version 25.1.1.18724), Stack trace:.` [#73629](https://github.com/ClickHouse/ClickHouse/pull/73629) ([Alexander Gololobov](https://github.com/davenger)).
* 在 `EXPLAIN SYNTAX` 中不再对查询进行解析，以避免在分布式查询中因处理阶段不正确而导致逻辑错误。修复了 [#65205](https://github.com/ClickHouse/ClickHouse/issues/65205)。[#73634](https://github.com/ClickHouse/ClickHouse/pull/73634)（[Dmitry Novik](https://github.com/novikd)）。
* 修复 Dynamic 列中可能的数据不一致问题。修复可能出现的逻辑错误 `Nested columns sizes are inconsistent with local_discriminators column size`。[#73644](https://github.com/ClickHouse/ClickHouse/pull/73644) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复了在带有 `FINAL` 和 `SAMPLE` 的查询中出现的 `NOT_FOUND_COLUMN_IN_BLOCK` 错误。修复了在对启用 `FINAL` 优化的 `CollapsingMergeTree` 使用 `FINAL` 进行查询时得到的不正确结果。 [#73682](https://github.com/ClickHouse/ClickHouse/pull/73682) ([Anton Popov](https://github.com/CurtizJ)).
* 修复 LIMIT BY COLUMNS 中的崩溃。[#73686](https://github.com/ClickHouse/ClickHouse/pull/73686) ([Raúl Marín](https://github.com/Algunenano))。
* 修复了这样一个问题：在被强制使用普通 `projection` 的情况下，即便查询与该 `projection` 的定义完全一致，却没有选择该 `projection`，从而导致报错。 [#73700](https://github.com/ClickHouse/ClickHouse/pull/73700) ([Shichao Jin](https://github.com/jsc0218)).
* 修复 `Dynamic`/`Object` 结构的反序列化问题，该问题可能会导致 `CANNOT_READ_ALL_DATA` 异常。[#73767](https://github.com/ClickHouse/ClickHouse/pull/73767) ([Pavel Kruglov](https://github.com/Avogar))。
* 在从备份恢复数据分片时跳过 `metadata_version.txt`。[#73768](https://github.com/ClickHouse/ClickHouse/pull/73768)（[Vitaly Baranov](https://github.com/vitlibar)）。
* 修复 [#73737](https://github.com/ClickHouse/ClickHouse/issues/73737)。[#73775](https://github.com/ClickHouse/ClickHouse/pull/73775)（[zhanglistar](https://github.com/zhanglistar)）。
* 修复 [#72078](https://github.com/ClickHouse/ClickHouse/issues/72078)（S3 Express 支持功能已损坏）。[#73777](https://github.com/ClickHouse/ClickHouse/pull/73777)（[Sameer Tamsekar](https://github.com/stamsekar)）。
* 允许在 CollapsingMergeTree 表中合并 sign 列值无效的行。[#73864](https://github.com/ClickHouse/ClickHouse/pull/73864)（[Christoph Wurm](https://github.com/cwurm)）。
* 修复以下错误：`Row 1: ────── hostname: c-test-wy-37-server-nlkyjyb-0.c-test-wy-37-server-headless.ns-test-wy-37.svc.cluster.local type: ExceptionWhileProcessing event_date: 2024-12-23 event_time: 2024-12-23 16:21:19 event_time_microseconds: 2024-12-23 16:21:19.824624 query_start_time: 2024-12-23 16:21:19 query_start_time_microseconds: 2024-12-23 16:21:19.747142 query_duration_ms: 77 read_rows: 1 read_bytes: 134 written_rows: 0 written_bytes: 0 result_rows: 0 result_bytes: 0 memory_usage: 7824 current_database: default query: CREATE DATABASE db0 formatted_query: normalized_query_hash: 7820917191074023511 -- 7.82 quintillion query_kind: Create databases: ['db0'] tables: [] columns: [] partitions: [] projections: [] views: [] exception_code: 170 exception: Code: 170. DB::Exception: Bad get: has Null, requested Int64: While executing DDLOnClusterQueryStatus. (BAD_GET) (version 25.1.1.19134 (official build)) stack_trace: 0. ./build_docker/./src/Common/Exception.cpp:107: DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000da5e53b 1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x00000000088aca4c 2. DB::Exception::Exception<std::basic_string_view<char, std::char_traits<char>>, std::basic_string_view<char, std::char_traits<char>>>(int, FormatStringHelperImpl<std::type_identity<std::basic_string_view<char, std::char_traits<char>>>::type, std::type_identity<std::basic_string_view<char, std::char_traits<char>>>::type>, std::basic_string_view<char, std::char_traits<char>>&&, std::basic_string_view<char, std::char_traits<char>>&&) @ 0x00000000088bae8b 3. auto& DB::Field::safeGet<long>() & @ 0x0000000008a3c748 4. ./src/Core/Field.h:484: DB::ColumnVector<long>::insert(DB::Field const&) @ 0x0000000012e44c0f 5. ./build_docker/./src/Interpreters/DDLOnClusterQueryStatusSource.cpp:53: DB::DDLOnClusterQueryStatusSource::generateChunkWithUnfinishedHosts() const @ 0x0000000012a40214 6. ./build_docker/./src/Interpreters/DDLOnClusterQueryStatusSource.cpp:104: DB::DDLOnClusterQueryStatusSource::handleTimeoutExceeded() @ 0x0000000012a41640 7. ./build_docker/./src/Interpreters/DDLOnClusterQueryStatusSource.cpp:109: DB::DDLOnClusterQueryStatusSource::stopWaitingOfflineHosts() @ 0x0000000012a41be9 8. ./build_docker/./src/Interpreters/DistributedQueryStatusSource.cpp:182: DB::DistributedQueryStatusSource::generate() @ 0x0000000011feb3bf 9. ./build_docker/./src/Processors/ISource.cpp:139: DB::ISource::tryGenerate() @ 0x0000000014148f5b 10. ./build_docker/./src/Processors/ISource.cpp:108: DB::ISource::work() @ 0x0000000014148c47 11. ./build_docker/./src/Processors/Executors/ExecutionThreadContext.cpp:49: DB::ExecutionThreadContext::executeTask() @ 0x0000000014164fc7 12. ./build_docker/./src/Processors/Executors/PipelineExecutor.cpp:290: DB::PipelineExecutor::executeStepImpl(unsigned long, std::atomic<bool>*) @ 0x00000000141577e5`。[#73876](https://github.com/ClickHouse/ClickHouse/pull/73876)（[Tuan Pham Anh](https://github.com/tuanpach)）。
* 修复了 `map()` 类型偶尔比较失败的问题,该问题是由于可能创建缺少嵌套元组显式命名(&#39;keys&#39;,&#39;values&#39;)的 `Map` 导致的。[#73878](https://github.com/ClickHouse/ClickHouse/pull/73878) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 在解析 `GROUP BY ALL` 子句时忽略窗口函数。修复 [#73501](https://github.com/ClickHouse/ClickHouse/issues/73501)。[#73916](https://github.com/ClickHouse/ClickHouse/pull/73916)（[Dmitry Novik](https://github.com/novikd)）。
* 为客户端-服务器通信正确传递 `Native` 格式设置。[#73924](https://github.com/ClickHouse/ClickHouse/pull/73924) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复隐式权限（之前被当作通配符处理）。 [#73932](https://github.com/ClickHouse/ClickHouse/pull/73932) ([Azat Khuzhin](https://github.com/azat))。
* 修复在创建嵌套 `Map` 时的高内存占用问题。 [#73982](https://github.com/ClickHouse/ClickHouse/pull/73982) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复解析嵌套 JSON 时包含空键的问题。[#73993](https://github.com/ClickHouse/ClickHouse/pull/73993)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复：当某个 `alias` 被另一个 `alias` 引用且按相反顺序被选择时，该 `alias` 可能不会被添加到 `projection` 中。[#74033](https://github.com/ClickHouse/ClickHouse/pull/74033) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 使用 plain&#95;rewritable 元数据的磁盘可以在多个服务器实例之间共享。预期的场景是：一个实例读取某个元数据对象，而另一个实例对其进行修改。在使用 Azure 存储进行 plain&#95;rewritable 初始化时，将忽略“对象未找到”错误，其行为与为 S3 实现的逻辑类似。[#74059](https://github.com/ClickHouse/ClickHouse/pull/74059) ([Julia Kartseva](https://github.com/jkartseva))。
* 修复了在枚举类型和空表情况下 `any` 和 `anyLast` 的行为。[#74061](https://github.com/ClickHouse/ClickHouse/pull/74061)（[Joanna Hulboj](https://github.com/jh0x)）。
* 修复了用户在 `Kafka` 表引擎中使用关键字参数时的问题。[#74064](https://github.com/ClickHouse/ClickHouse/pull/74064) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 修复在 `Storage S3Queue` 中将带有 &quot;s3queue&#95;&quot; 前缀的设置修改为不带此前缀，或从不带此前缀修改为带此前缀时的行为。 [#74075](https://github.com/ClickHouse/ClickHouse/pull/74075) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 添加设置 `allow_push_predicate_ast_for_distributed_subqueries`。这为使用 analyzer 的分布式查询增加了基于 AST 的谓词下推功能。这是一个临时方案，我们会使用它，直到支持带查询计划序列化的分布式查询为止。修复 [#66878](https://github.com/ClickHouse/ClickHouse/issues/66878) [#69472](https://github.com/ClickHouse/ClickHouse/issues/69472) [#65638](https://github.com/ClickHouse/ClickHouse/issues/65638) [#68030](https://github.com/ClickHouse/ClickHouse/issues/68030) [#73718](https://github.com/ClickHouse/ClickHouse/issues/73718)。[#74085](https://github.com/ClickHouse/ClickHouse/pull/74085)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 修复了在 [#73095](https://github.com/ClickHouse/ClickHouse/issues/73095) 之后，`forwarded_for` 字段中可能会包含端口，从而导致无法解析带端口的主机名的问题。[#74116](https://github.com/ClickHouse/ClickHouse/pull/74116)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* 修复了 `ALTER TABLE (DROP STATISTICS ...) (DROP STATISTICS ...)` 的错误格式。[#74126](https://github.com/ClickHouse/ClickHouse/pull/74126)（[Han Fei](https://github.com/hanfei1991)）。
* 修复问题 [#66112](https://github.com/ClickHouse/ClickHouse/issues/66112)。[#74128](https://github.com/ClickHouse/ClickHouse/pull/74128)（[Anton Ivashkin](https://github.com/ianton-ru)）。
* 在 `CREATE TABLE` 中不再可以将 `Loop` 用作表引擎。此前这种组合会导致段错误。[#74137](https://github.com/ClickHouse/ClickHouse/pull/74137) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 修复安全问题，防止在 postgresql 和 sqlite 表函数中发生 SQL 注入。[#74144](https://github.com/ClickHouse/ClickHouse/pull/74144)（[Pablo Marcos](https://github.com/pamarcos)）。
* 修复从启用压缩的 Memory 引擎表中读取子列时发生的崩溃。修复了 [#74009](https://github.com/ClickHouse/ClickHouse/issues/74009)。[#74161](https://github.com/ClickHouse/ClickHouse/pull/74161)（[Nikita Taranov](https://github.com/nickitat)）。
* 修复了对 `system.detached_tables` 执行查询时出现的无限循环问题。[#74190](https://github.com/ClickHouse/ClickHouse/pull/74190) ([Konstantin Morozov](https://github.com/k-morozov))。
* 修复在将文件标记为失败时 `s3queue` 中的逻辑错误。 [#74216](https://github.com/ClickHouse/ClickHouse/pull/74216) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 检查某些存储中不支持的类型。[#74218](https://github.com/ClickHouse/ClickHouse/pull/74218) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复在 macOS 上通过 PostgreSQL 接口执行 `INSERT INTO SELECT` 查询时发生的崩溃（问题 [#72938](https://github.com/ClickHouse/ClickHouse/issues/72938)）。[#74231](https://github.com/ClickHouse/ClickHouse/pull/74231)（[Artem Yurov](https://github.com/ArtemYurov)）。
* 修复从基础备份执行 `RESTORE` 时的原生复制设置（`allow_s3_native_copy`/`allow_azure_native_copy`）。 [#74286](https://github.com/ClickHouse/ClickHouse/pull/74286) ([Azat Khuzhin](https://github.com/azat)).
* 修复了当数据库中已分离表的数量是 `max_block_size` 的倍数时出现的问题。 [#74289](https://github.com/ClickHouse/ClickHouse/pull/74289) ([Konstantin Morozov](https://github.com/k-morozov)).
* 修复通过 ObjectStorage（如 S3）进行复制时，当源端和目标端凭据不同时的行为。 [#74331](https://github.com/ClickHouse/ClickHouse/pull/74331) ([Azat Khuzhin](https://github.com/azat)).
* 修复了复制数据库中未初始化的 max&#95;log&#95;ptr。 [#74336](https://github.com/ClickHouse/ClickHouse/pull/74336) ([Konstantin Morozov](https://github.com/k-morozov))。
* 修复在 GCS 上进行原生复制时对“在 JSON API 中使用 Rewrite 方法”的检测。[#74338](https://github.com/ClickHouse/ClickHouse/pull/74338)（[Azat Khuzhin](https://github.com/azat)）。
* 修复插入区间（`INTERVAL`）时的崩溃（问题 [#74299](https://github.com/ClickHouse/ClickHouse/issues/74299)）。 [#74478](https://github.com/ClickHouse/ClickHouse/pull/74478)（[NamNguyenHoai](https://github.com/NamHoaiNguyen)）。
* 修复在聚合投影中使用 `count(nullable)` 时的错误投影分析。该修复解决了 [#74495](https://github.com/ClickHouse/ClickHouse/issues/74495)。此 PR 还在投影分析相关位置添加了一些日志，以帮助澄清为何会使用某个投影或为何不会使用。[#74498](https://github.com/ClickHouse/ClickHouse/pull/74498)（[Amos Bird](https://github.com/amosbird)）。
* 修复 `BackgroundMergesAndMutationsPoolSize` 的计算错误（此前为实际值的 2 倍）。[#74509](https://github.com/ClickHouse/ClickHouse/pull/74509) ([alesapin](https://github.com/alesapin))。
* 修复在启用 Cluster Discovery 时导致 keeper watch 泄漏的错误。 [#74521](https://github.com/ClickHouse/ClickHouse/pull/74521) ([RinChanNOW](https://github.com/RinChanNOWWW)).
* 修复常量 JSON 字面量的格式化。此前这可能会在将查询发送到另一台服务器时导致语法错误。[#74533](https://github.com/ClickHouse/ClickHouse/pull/74533) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复 UBSan 报告的内存对齐问题 [#74512](https://github.com/ClickHouse/ClickHouse/issues/74512)。[#74534](https://github.com/ClickHouse/ClickHouse/pull/74534)（[Arthur Passos](https://github.com/arthurpassos)）。
* 修复在创建表期间 KeeperMap 的并发清理问题。[#74568](https://github.com/ClickHouse/ClickHouse/pull/74568)（[Antonio Andelic](https://github.com/antonio2368)）。
* 在存在 `EXCEPT` 或 `INTERSECT` 的情况下，不要在子查询中移除未使用的投影列，以保证查询结果的正确性。修复 [#73930](https://github.com/ClickHouse/ClickHouse/issues/73930)。修复 [#66465](https://github.com/ClickHouse/ClickHouse/issues/66465)。[#74577](https://github.com/ClickHouse/ClickHouse/pull/74577)（[Dmitry Novik](https://github.com/novikd)）。
* 修复在启用隐式投影时，使用常量分区表达式导致的 `CREATE` 查询异常问题。此修复对应 [#74596](https://github.com/ClickHouse/ClickHouse/issues/74596)。[#74634](https://github.com/ClickHouse/ClickHouse/pull/74634)（[Amos Bird](https://github.com/amosbird)）。
* 修复了在启用稀疏序列化时，包含 `Tuple` 列的表之间执行的 `INSERT SELECT` 查询。 [#74698](https://github.com/ClickHouse/ClickHouse/pull/74698) ([Anton Popov](https://github.com/CurtizJ))。
* 函数 `right` 在使用常量负偏移量时工作不正确。 [#74701](https://github.com/ClickHouse/ClickHouse/pull/74701) ([Daniil Ivanik](https://github.com/divanik))。
* 修复由于客户端解压过程存在缺陷，导致插入 gzip 压缩数据有时失败的问题。[#74707](https://github.com/ClickHouse/ClickHouse/pull/74707) ([siyuan](https://github.com/linkwk7)).
* 避免在 `INSERT` 因异常结束后将连接置于异常状态。 [#74740](https://github.com/ClickHouse/ClickHouse/pull/74740) ([Azat Khuzhin](https://github.com/azat)).
* 避免重用已处于中间状态的连接。 [#74749](https://github.com/ClickHouse/ClickHouse/pull/74749) ([Azat Khuzhin](https://github.com/azat)).
* 带有通配符授权的部分 `REVOKE` 可能会移除超出预期的权限。修复了 [#74263](https://github.com/ClickHouse/ClickHouse/issues/74263)。[#74751](https://github.com/ClickHouse/ClickHouse/pull/74751)（[pufit](https://github.com/pufit)）。
* 修复在解析 `JSON` 类型声明时，当类型名不是大写时导致的崩溃。[#74784](https://github.com/ClickHouse/ClickHouse/pull/74784) ([Pavel Kruglov](https://github.com/Avogar)).
* Keeper 修复：修正从磁盘读取日志条目的问题。 [#74785](https://github.com/ClickHouse/ClickHouse/pull/74785) ([Antonio Andelic](https://github.com/antonio2368)).
* 修复了对 `SYSTEM REFRESH/START/STOP VIEW` 权限检查的逻辑，现在在对特定视图执行查询时，不再需要在 `*.*` 上拥有此权限，只需对该视图本身具备相应权限即可。[#74789](https://github.com/ClickHouse/ClickHouse/pull/74789)（[Alexander Tokmakov](https://github.com/tavplubix)）。
* `hasColumnInTable` 函数目前不会考虑别名列。已修复为同样适用于别名列。[#74841](https://github.com/ClickHouse/ClickHouse/pull/74841) ([Bharat Nallan](https://github.com/bharatnc))。
* Keeper：修复在连接建立之前连接已被终止时出现的 `logical_error`。[#74844](https://github.com/ClickHouse/ClickHouse/pull/74844)（[Michael Kolupaev](https://github.com/al13n321)）。
* 修复了在存在使用 `AzureBlobStorage` 的表时服务器无法启动的问题。现在会在不向 Azure 发送任何请求的情况下加载这些表。[#74880](https://github.com/ClickHouse/ClickHouse/pull/74880) ([Alexey Katsman](https://github.com/alexkats)).
* 修复在执行 BACKUP 和 RESTORE 操作时，`query_log` 中缺失的 `used_privileges` 和 `missing_privileges` 字段的问题。[#74887](https://github.com/ClickHouse/ClickHouse/pull/74887) ([Alexey Katsman](https://github.com/alexkats))。
* 修复在 Azure Blob Storage 中对包含空列的表执行数据部分合并时出现的 FILE&#95;DOESNT&#95;EXIST 错误。[#74892](https://github.com/ClickHouse/ClickHouse/pull/74892) ([Julia Kartseva](https://github.com/jkartseva))。
* 修复在与临时表进行 JOIN 时的投影列名问题，关闭 [#68872](https://github.com/ClickHouse/ClickHouse/issues/68872)。[#74897](https://github.com/ClickHouse/ClickHouse/pull/74897)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 如果在执行 `hdfs select` 请求时出现 `sasl` 错误，则在 HDFS 中刷新 `krb ticket`。 [#74930](https://github.com/ClickHouse/ClickHouse/pull/74930) ([inv2004](https://github.com/inv2004)).
* 修复在 `startup_scripts` 中针对 Replicated 数据库的查询。[#74942](https://github.com/ClickHouse/ClickHouse/pull/74942) ([Azat Khuzhin](https://github.com/azat))。
* 修复在使用空安全比较时，`JOIN ON` 子句中使用类型别名的表达式存在的问题。 [#74970](https://github.com/ClickHouse/ClickHouse/pull/74970) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 在移除操作失败时，将 part 的状态从“正在删除”恢复为“已过期”。[#74985](https://github.com/ClickHouse/ClickHouse/pull/74985) ([Sema Checherinda](https://github.com/CheSema)).
* 在此前的版本中，当存在标量子查询时，我们会在数据格式初始化阶段（即在写入 HTTP 头之前）就开始写入进度信息（从处理子查询过程中累积得到）。这会导致 HTTP 头丢失，例如 X-ClickHouse-QueryId、X-ClickHouse-Format 以及 Content-Type。[#74991](https://github.com/ClickHouse/ClickHouse/pull/74991) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 修复在 `database_replicated_allow_replicated_engine_arguments=0` 时的 `CREATE TABLE AS...` 查询问题。[#75000](https://github.com/ClickHouse/ClickHouse/pull/75000)（[Bharat Nallan](https://github.com/bharatnc)）。
* 修复在发生 INSERT 异常后，客户端连接可能被留在异常状态的问题。 [#75030](https://github.com/ClickHouse/ClickHouse/pull/75030) ([Azat Khuzhin](https://github.com/azat)).
* 修复由于 PSQL 复制中未捕获的异常导致的崩溃。[#75062](https://github.com/ClickHouse/ClickHouse/pull/75062) ([Azat Khuzhin](https://github.com/azat)).
* Sasl 可能导致任何 rpc 调用失败，此修复可以在 `krb5` 票据过期时重试该调用。 [#75063](https://github.com/ClickHouse/ClickHouse/pull/75063) ([inv2004](https://github.com/inv2004)).
* 修复了在启用 `optimize_function_to_subcolumns` 设置时，对 `Array`、`Map` 和 `Nullable(..)` 列使用主键和二级索引的行为。此前，这些列的索引可能会被忽略。 [#75081](https://github.com/ClickHouse/ClickHouse/pull/75081) ([Anton Popov](https://github.com/CurtizJ)).
* 在为带有内部表的物化视图时禁用 `flatten_nested`，因为无法使用此类展开后的列。[#75085](https://github.com/ClickHouse/ClickHouse/pull/75085)（[Christoph Wurm](https://github.com/cwurm)）。
* 修复了在 `forwarded_for` 字段中对某些 IPv6 地址（例如 ::ffff:1.1.1.1）的错误解析问题，该问题会导致客户端因异常而断开连接。[#75133](https://github.com/ClickHouse/ClickHouse/pull/75133) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 修复了针对 LowCardinality 可空数据类型的 nullsafe JOIN 处理。此前在 `JOIN ON` 中使用 nullsafe 比较（例如 `IS NOT DISTINCT FROM`、`<=>`、`a IS NULL AND b IS NULL OR a == b`）时，与 LowCardinality 列配合时工作不正确。[#75143](https://github.com/ClickHouse/ClickHouse/pull/75143) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 使用新的 analyzer 修复包含未使用插值的查询。[#75173](https://github.com/ClickHouse/ClickHouse/pull/75173) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
* 修复在使用 `INSERT` 时 `CTE` 的崩溃问题。 [#75188](https://github.com/ClickHouse/ClickHouse/pull/75188) ([Shichao Jin](https://github.com/jsc0218)).
* Keeper 修复：在回滚日志时避免写入已损坏的变更日志。 [#75197](https://github.com/ClickHouse/ClickHouse/pull/75197) ([Antonio Andelic](https://github.com/antonio2368)).
* 在适当的情况下使用 `BFloat16` 作为超类型。修复了：[#74404](https://github.com/ClickHouse/ClickHouse/issues/74404)。[#75236](https://github.com/ClickHouse/ClickHouse/pull/75236)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 修复在 `JOIN ON` 中同时使用 `any_join_distinct_right_table_keys` 和 `OR` 时，连接结果中出现意外默认值的问题。[#75262](https://github.com/ClickHouse/ClickHouse/pull/75262) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 对 `azureblobstorage` 表引擎的凭据进行屏蔽。 [#75319](https://github.com/ClickHouse/ClickHouse/pull/75319) ([Garrett Thomas](https://github.com/garrettthomaskth)).
* 修复了 ClickHouse 在某些情况下可能错误地向 PostgreSQL、MySQL 或 SQLite 等外部数据库执行过滤下推的行为。已关闭相关问题：[#71423](https://github.com/ClickHouse/ClickHouse/issues/71423)。[#75320](https://github.com/ClickHouse/ClickHouse/pull/75320)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 修复在以 Protobuf 格式输出时，与并行执行查询 `SYSTEM DROP FORMAT SCHEMA CACHE` 相关的 protobuf 模式缓存崩溃问题。 [#75357](https://github.com/ClickHouse/ClickHouse/pull/75357) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复了在并行副本场景下,`HAVING` 子句中的过滤条件下推时可能导致的逻辑错误或未初始化内存问题。[#75363](https://github.com/ClickHouse/ClickHouse/pull/75363) ([Vladimir Cherkasov](https://github.com/vdimir))。
* 对 `icebergS3`、`icebergAzure` 表函数和表引擎中的敏感信息进行隐藏。[#75378](https://github.com/ClickHouse/ClickHouse/pull/75378) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 现在可以正确处理函数 `TRIM` 中通过计算得到的空白修剪字符。例如：`SELECT TRIM(LEADING concat('') FROM 'foo')`（问题 [#69922](https://github.com/ClickHouse/ClickHouse/issues/69922)）。[#75399](https://github.com/ClickHouse/ClickHouse/pull/75399)（[Manish Gill](https://github.com/mgill25)）。
* 修复 `IOutputFormat` 中的数据竞争。 [#75448](https://github.com/ClickHouse/ClickHouse/pull/75448) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在对分布式表执行 JOIN 时使用 Array 类型的 JSON 子列时可能出现的错误 `Elements ... and ... of Nested data structure ... (Array columns) have different array sizes`。 [#75512](https://github.com/ClickHouse/ClickHouse/pull/75512) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复结果缓冲区大小计算错误。关闭 [#70031](https://github.com/ClickHouse/ClickHouse/issues/70031)。[#75548](https://github.com/ClickHouse/ClickHouse/pull/75548)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 修复 `allow_feature_tier` 与兼容性 `mergetree` 设置之间的交互。 [#75635](https://github.com/ClickHouse/ClickHouse/pull/75635) ([Raúl Marín](https://github.com/Algunenano)).
* 修复在文件被重试时，`system.s3queue_log` 中 `processed_rows` 值不正确的问题。[#75666](https://github.com/ClickHouse/ClickHouse/pull/75666)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 当物化视图向 URL 引擎写入数据时,如果出现连接问题,现在会遵循 `materialized_views_ignore_errors` 设置。[#75679](https://github.com/ClickHouse/ClickHouse/pull/75679) ([Christoph Wurm](https://github.com/cwurm))。
* 修复了在多次对不同类型列之间执行异步 `RENAME` 查询（`alter_sync = 0`）后，从 `MergeTree` 表读取数据时极少数情况下可能发生的崩溃问题。[#75693](https://github.com/ClickHouse/ClickHouse/pull/75693) ([Anton Popov](https://github.com/CurtizJ))。
* 修复某些包含 `UNION ALL` 的查询中出现的 `Block structure mismatch in QueryPipeline stream` 错误。[#75715](https://github.com/ClickHouse/ClickHouse/pull/75715)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 在对其主键列执行 `ALTER MODIFY` 时重建投影。此前，在对用作投影主键的列执行 `ALTER MODIFY` 后进行查询，可能会导致 `CANNOT_READ_ALL_DATA` 错误。[#75720](https://github.com/ClickHouse/ClickHouse/pull/75720) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在使用 analyzer 时标量子查询的 `ARRAY JOIN` 结果不正确的问题。[#75732](https://github.com/ClickHouse/ClickHouse/pull/75732) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* 修复了 `DistinctSortedStreamTransform` 中的空指针解引用。[#75734](https://github.com/ClickHouse/ClickHouse/pull/75734)（[Nikita Taranov](https://github.com/nickitat)）。
* 修复 `allow_suspicious_ttl_expressions` 的行为。[#75771](https://github.com/ClickHouse/ClickHouse/pull/75771) ([Aleksei Filatov](https://github.com/aalexfvk))。
* 修复函数 `translate` 中未初始化内存读取的问题。此更改关闭了 [#75592](https://github.com/ClickHouse/ClickHouse/issues/75592)。[#75794](https://github.com/ClickHouse/ClickHouse/pull/75794)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在 Native 格式中将格式设置应用到 JSON 的字符串格式化。 [#75832](https://github.com/ClickHouse/ClickHouse/pull/75832) ([Pavel Kruglov](https://github.com/Avogar)).
* 在设置变更历史中记录了 v24.12 版本默认启用并行哈希作为连接算法。这意味着如果配置的兼容性级别低于 v24.12,ClickHouse 将继续使用非并行哈希进行连接。[#75870](https://github.com/ClickHouse/ClickHouse/pull/75870) ([Robert Schulze](https://github.com/rschu1ze))。
* 修复了一个错误：具有隐式添加的 min-max 索引的表无法复制到新表中（问题 [#75677](https://github.com/ClickHouse/ClickHouse/issues/75677)）。[#75877](https://github.com/ClickHouse/ClickHouse/pull/75877)（[Smita Kulkarni](https://github.com/SmitaRKulkarni)）。
* `clickhouse-library-bridge` 允许从文件系统加载任意库文件,因此只有在隔离环境中运行才是安全的。为了防止与 clickhouse-server 部署在一起时出现安全漏洞,我们将库文件的路径限制在配置文件中指定的位置。该漏洞由 **Arseniy Dugin** 通过 [ClickHouse Bug Bounty Program](https://github.com/ClickHouse/ClickHouse/issues/38986) 发现。[#75954](https://github.com/ClickHouse/ClickHouse/pull/75954) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 我们曾经对部分元数据使用了 JSON 序列化，这是一个错误做法，因为 JSON 在字符串字面量中不支持二进制数据，包括零字节。SQL 查询可以包含二进制数据和无效的 UTF-8，因此我们也必须在元数据文件中支持这些内容。与此同时，ClickHouse 的 `JSONEachRow` 以及类似格式通过在二进制数据的完美往返上做取舍、偏离 JSON 标准来解决这一问题。相关设计动机说明参见：[https://github.com/ClickHouse/ClickHouse/pull/73668#issuecomment-2560501790](https://github.com/ClickHouse/ClickHouse/pull/73668#issuecomment-2560501790)。解决方案是让 `Poco::JSON` 库与 ClickHouse 中的 JSON 格式序列化行为保持一致。此更改关闭了 [#73668](https://github.com/ClickHouse/ClickHouse/issues/73668)。[#75963](https://github.com/ClickHouse/ClickHouse/pull/75963)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复在执行 DETACH PART 时出现的 `Part <...> does not contain in snapshot of previous virtual parts. (PART_IS_TEMPORARILY_LOCKED)` 错误。[#76039](https://github.com/ClickHouse/ClickHouse/pull/76039) ([Aleksei Filatov](https://github.com/aalexfvk))。
* 修复对存储引擎 `S3Queue` 中提交限制的检查。[#76104](https://github.com/ClickHouse/ClickHouse/pull/76104) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复附加带自动索引（`add_minmax_index_for_numeric_columns`/`add_minmax_index_for_string_columns`）的 MergeTree 表时的问题。[#76139](https://github.com/ClickHouse/ClickHouse/pull/76139) ([Azat Khuzhin](https://github.com/azat))。
* 修复了作业父线程的堆栈跟踪（受 `enable_job_stack_trace` 设置控制）未被打印的问题。修复了 `enable_job_stack_trace` 设置未正确传递到线程，导致堆栈跟踪内容并不总是遵循该设置的问题。[#76191](https://github.com/ClickHouse/ClickHouse/pull/76191) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 在大端架构上修复 `reinterpretAs` 与 `FixedString` 的兼容性问题。[#76253](https://github.com/ClickHouse/ClickHouse/pull/76253) ([Azat Khuzhin](https://github.com/azat)).
* 修复了由 UUID 与表名之间竞争导致的各种错误（例如，它修复了 `RENAME` 与 `RESTART REPLICA` 之间的竞争：在并发执行 `RENAME` 和 `SYSTEM RESTART REPLICA` 的情况下，可能会导致重启错误的副本，和/或使其中一张表停留在 `Table X is being restarted` 状态）。 [#76308](https://github.com/ClickHouse/ClickHouse/pull/76308) ([Azat Khuzhin](https://github.com/azat)).
* 从信号处理程序中移除了内存分配。 [#76446](https://github.com/ClickHouse/ClickHouse/pull/76446) ([Nikita Taranov](https://github.com/nickitat)).
* 修复动态文件系统缓存调整大小时在回收过程中处理意外错误的问题。 [#76466](https://github.com/ClickHouse/ClickHouse/pull/76466) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复了并行哈希中 `used_flag` 的初始化问题，该问题可能会导致服务器崩溃。[#76580](https://github.com/ClickHouse/ClickHouse/pull/76580)（[Nikita Taranov](https://github.com/nickitat)）。
* 修复了在投影中调用 `defaultProfiles()` 函数时出现的逻辑错误。[#76627](https://github.com/ClickHouse/ClickHouse/pull/76627) ([pufit](https://github.com/pufit))。
* 不要在 Web UI 中通过浏览器发起交互式基本身份验证请求。修复了 [#76319](https://github.com/ClickHouse/ClickHouse/issues/76319)。[#76637](https://github.com/ClickHouse/ClickHouse/pull/76637)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复从分布式表中查询布尔字面量时出现的 THERE&#95;IS&#95;NO&#95;COLUMN 异常。[#76656](https://github.com/ClickHouse/ClickHouse/pull/76656) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 表目录中的子路径选择方式经过更深度的优化。[#76681](https://github.com/ClickHouse/ClickHouse/pull/76681)（[Daniil Ivanik](https://github.com/divanik)）。
* 修复在对主键中包含子列的表执行 `ALTER` 后出现的错误 `Not found column in block`。在 [https://github.com/ClickHouse/ClickHouse/pull/72644](https://github.com/ClickHouse/ClickHouse/pull/72644) 之后，需要 [https://github.com/ClickHouse/ClickHouse/pull/74403](https://github.com/ClickHouse/ClickHouse/pull/74403)。[#76686](https://github.com/ClickHouse/ClickHouse/pull/76686)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 为 null 短路添加性能测试并修复 bug。 [#76708](https://github.com/ClickHouse/ClickHouse/pull/76708) ([李扬](https://github.com/taiyang-li)).
* 在最终完成输出写缓冲区之前先刷新其内容。修复在某些输出格式完成阶段生成的 `LOGICAL_ERROR`，例如 `JSONEachRowWithProgressRowOutputFormat`。 [#76726](https://github.com/ClickHouse/ClickHouse/pull/76726) ([Antonio Andelic](https://github.com/antonio2368)).
* 为 MongoDB 二进制 UUID 添加了支持（[#74452](https://github.com/ClickHouse/ClickHouse/issues/74452)）- 修复了在使用表函数时对 MongoDB 的 `WHERE` 下推（[#72210](https://github.com/ClickHouse/ClickHouse/issues/72210)）- 修改了 MongoDB 与 ClickHouse 之间的类型映射，使得 MongoDB 的二进制 UUID 只能被解析为 ClickHouse 的 UUID。这样可以避免未来出现歧义和意外行为。- 修复了 OID 映射，并保留向后兼容性。[#76762](https://github.com/ClickHouse/ClickHouse/pull/76762)（[Kirill Nikiforov](https://github.com/allmazz)）。
* 修复在并行前缀反序列化 JSON 子列时的异常处理。[#76809](https://github.com/ClickHouse/ClickHouse/pull/76809) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复 `lgamma` 函数对负整数的处理行为。[#76840](https://github.com/ClickHouse/ClickHouse/pull/76840) ([Ilya Kataev](https://github.com/IlyaKataev)).
* 修复针对显式定义主键的反向键分析问题。类似于 [#76654](https://github.com/ClickHouse/ClickHouse/issues/76654)。[#76846](https://github.com/ClickHouse/ClickHouse/pull/76846)（[Amos Bird](https://github.com/amosbird)）。
* 修复 JSON 格式中 Bool 值的美观输出。 [#76905](https://github.com/ClickHouse/ClickHouse/pull/76905) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在异步插入时出错后回滚 JSON 列失败可能导致的崩溃。[#76908](https://github.com/ClickHouse/ClickHouse/pull/76908) ([Pavel Kruglov](https://github.com/Avogar)).
* 之前，`multi_if` 在计划阶段和主执行阶段可能返回不同类型的列。这会导致生成从 C++ 角度来看具有未定义行为的代码。[#76914](https://github.com/ClickHouse/ClickHouse/pull/76914)（[Nikita Taranov](https://github.com/nickitat)）。
* 修复了 MergeTree 中对常量可为 `NULL` 键的错误序列化问题。此修复解决了 [#76939](https://github.com/ClickHouse/ClickHouse/issues/76939)。[#76985](https://github.com/ClickHouse/ClickHouse/pull/76985)（[Amos Bird](https://github.com/amosbird)）。
* 修复 `BFloat16` 值的排序。已关闭 [#75487](https://github.com/ClickHouse/ClickHouse/issues/75487)。已关闭 [#75669](https://github.com/ClickHouse/ClickHouse/issues/75669)。[#77000](https://github.com/ClickHouse/ClickHouse/pull/77000)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 通过在数据片段一致性检查中添加跳过临时子列的逻辑，修复了带有 `variant` 子列的 `JSON` 的缺陷。 [#72187](https://github.com/ClickHouse/ClickHouse/issues/72187). [#77034](https://github.com/ClickHouse/ClickHouse/pull/77034) ([Smita Kulkarni](https://github.com/SmitaRKulkarni)).
* 修复在 `Values` 格式中解析模板时，由于类型不匹配而导致的崩溃问题。 [#77071](https://github.com/ClickHouse/ClickHouse/pull/77071) ([Pavel Kruglov](https://github.com/Avogar)).
* 不允许再创建在主键中包含子列的 EmbeddedRocksDB 表。此前可以创建此类表，但 `SELECT` 查询会失败。[#77074](https://github.com/ClickHouse/ClickHouse/pull/77074) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复分布式查询中的非法比较问题，因为向远端下推谓词时未正确处理字面量类型。[#77093](https://github.com/ClickHouse/ClickHouse/pull/77093) ([Duc Canh Le](https://github.com/canhld94))。
* 修复在创建 Kafka 表时遇到异常而导致的崩溃。[#77121](https://github.com/ClickHouse/ClickHouse/pull/77121) ([Pavel Kruglov](https://github.com/Avogar)).
* 在 Kafka 和 RabbitMQ 引擎中新增对 JSON 及其子列的支持。 [#77122](https://github.com/ClickHouse/ClickHouse/pull/77122) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在 macOS 上的异常栈展开问题。 [#77126](https://github.com/ClickHouse/ClickHouse/pull/77126) ([Eduard Karacharov](https://github.com/korowa)).
* 修复在 `getSubcolumn` 函数中读取 `null` 子列时的问题。[#77163](https://github.com/ClickHouse/ClickHouse/pull/77163)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复了分析器中带有字面量表达式的跳数索引无法正常工作的问题,并在索引分析过程中移除了冗余的类型转换。[#77229](https://github.com/ClickHouse/ClickHouse/pull/77229) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复在 `Array` 类型和不支持的函数上使用时的布隆过滤器索引问题。 [#77271](https://github.com/ClickHouse/ClickHouse/pull/77271) ([Pavel Kruglov](https://github.com/Avogar)).
* 我们现在仅在初始的 `CREATE` 查询中检查对表数量的限制。[#77274](https://github.com/ClickHouse/ClickHouse/pull/77274) ([Nikolay Degterinsky](https://github.com/evillique))。
* `SELECT toBFloat16(-0.0) == toBFloat16(0.0)` 现在会正确返回 `true`（之前为 `false`）。这使其行为与 `Float32` 和 `Float64` 保持一致。[#77290](https://github.com/ClickHouse/ClickHouse/pull/77290) ([Shankar Iyer](https://github.com/shankar-iyer)).
* 修复对未初始化的 `key_index` 变量可能存在的不正确引用，该问题可能会在 debug 构建中导致崩溃（在 release 构建中，此未初始化引用不会导致问题，因为后续代码很可能会抛出错误）。### 面向用户可见变更的文档条目。[#77305](https://github.com/ClickHouse/ClickHouse/pull/77305) ([wxybear](https://github.com/wxybear))。
* 已回退。[#77307](https://github.com/ClickHouse/ClickHouse/pull/77307) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* 修复 Bool 类型分区的名称。该问题是在 [https://github.com/ClickHouse/ClickHouse/pull/74533](https://github.com/ClickHouse/ClickHouse/pull/74533) 中引入的。[#77319](https://github.com/ClickHouse/ClickHouse/pull/77319)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复包含可为空元素的元组与字符串之间的比较。例如，在此更改之前，元组 `(1, null)` 与字符串 `'(1,null)'` 进行比较会导致错误。另一个示例是元组 `(1, a)`（其中 `a` 是 Nullable 列）与字符串 `'(1, 2)'` 之间的比较。本次更改解决了这些问题。 [#77323](https://github.com/ClickHouse/ClickHouse/pull/77323) ([Alexey Katsman](https://github.com/alexkats))。
* 修复 `ObjectStorageQueueSource` 中的崩溃问题。该问题是在 [https://github.com/ClickHouse/ClickHouse/pull/76358](https://github.com/ClickHouse/ClickHouse/pull/76358) 中引入的。[#77325](https://github.com/ClickHouse/ClickHouse/pull/77325)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复了 `close_session` 查询参数未生效的问题,该问题导致命名会话只能在 `session_timeout` 超时后才会关闭。[#77336](https://github.com/ClickHouse/ClickHouse/pull/77336) ([Alexey Katsman](https://github.com/alexkats))。
* 修复与 `input()` 搭配使用时的 `async_insert` 问题。 [#77340](https://github.com/ClickHouse/ClickHouse/pull/77340) ([Azat Khuzhin](https://github.com/azat))。
* 修复:当查询规划器移除排序列时,`WITH FILL` 可能会失败并报 `NOT_FOUND_COLUMN_IN_BLOCK` 错误。类似问题与 `INTERPOLATE` 表达式的 DAG 计算不一致有关。[#77343](https://github.com/ClickHouse/ClickHouse/pull/77343) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 已回退。[#77390](https://github.com/ClickHouse/ClickHouse/pull/77390) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 修复了在未附加物化视图（mv）的情况下从 NATS 服务器接收消息的问题。 [#77392](https://github.com/ClickHouse/ClickHouse/pull/77392) ([Dmitry Novikov](https://github.com/dmitry-sles-novikov)).
* 修复通过 `merge` 表函数从空的 `FileLog` 读取时出现的逻辑错误，关闭 [#75575](https://github.com/ClickHouse/ClickHouse/issues/75575)。[#77441](https://github.com/ClickHouse/ClickHouse/pull/77441)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 修复了在为无效 AST 节点设置别名时触发的若干 `LOGICAL_ERROR`。[#77445](https://github.com/ClickHouse/ClickHouse/pull/77445)（[Raúl Marín](https://github.com/Algunenano)）。
* 在 filesystem cache 的实现中，修复了文件段写入过程中的错误处理问题。[#77471](https://github.com/ClickHouse/ClickHouse/pull/77471) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 让 DatabaseIceberg 使用由目录提供的正确元数据文件。修复 [#75187](https://github.com/ClickHouse/ClickHouse/issues/75187)。[#77486](https://github.com/ClickHouse/ClickHouse/pull/77486)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 在 shared variant 的 Dynamic 序列化中使用默认格式设置。[#77572](https://github.com/ClickHouse/ClickHouse/pull/77572) ([Pavel Kruglov](https://github.com/Avogar))。
* 回滚“在标量子查询执行中避免使用 toAST()”的更改。[#77584](https://github.com/ClickHouse/ClickHouse/pull/77584)（[Raúl Marín](https://github.com/Algunenano)）。
* 修复在本地磁盘上检查表数据路径是否存在的逻辑。[#77608](https://github.com/ClickHouse/ClickHouse/pull/77608)（[Tuan Pham Anh](https://github.com/tuanpach)）。
* 查询缓存现在假定 UDF 是非确定性的。因此，包含 UDF 的查询结果将不再被缓存。此前，用户可以定义非确定性的 UDF，而其结果会被错误地缓存（问题 [#77553](https://github.com/ClickHouse/ClickHouse/issues/77553)）。[#77633](https://github.com/ClickHouse/ClickHouse/pull/77633)（[Jimmy Aguilar Mena](https://github.com/Ergus)）。
* 修复了在某些类型中将常量值发送到远程端时的问题。 [#77634](https://github.com/ClickHouse/ClickHouse/pull/77634) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复 `system.filesystem_cache_log` 仅在设置 `enable_filesystem_cache_log` 启用时才生效的问题。 [#77650](https://github.com/ClickHouse/ClickHouse/pull/77650) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复在投影中调用 `defaultRoles()` 函数时的逻辑错误。作为对 [#76627](https://github.com/ClickHouse/ClickHouse/issues/76627) 的后续修复。[#77667](https://github.com/ClickHouse/ClickHouse/pull/77667)（[pufit](https://github.com/pufit)）。
* 修复由于上下文过期导致的 StorageS3(Azure)Queue 崩溃问题。[#77720](https://github.com/ClickHouse/ClickHouse/pull/77720)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 函数 `arrayResize` 的第二个 `Nullable` 类型参数现已被禁止。此前，如果第二个参数为 `Nullable`，可能会导致从报错到结果错误等各种问题。（issue [#48398](https://github.com/ClickHouse/ClickHouse/issues/48398)）。[#77724](https://github.com/ClickHouse/ClickHouse/pull/77724)（[Manish Gill](https://github.com/mgill25)）。
* 在 RabbitMQ、Nats、Redis、AzureQueue 表引擎中隐藏凭证信息。[#77755](https://github.com/ClickHouse/ClickHouse/pull/77755) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 修复 ArgMin/ArgMax 中与 NaN 比较时的未定义行为。[#77756](https://github.com/ClickHouse/ClickHouse/pull/77756) ([Raúl Marín](https://github.com/Algunenano)).
* 即使在操作不会产生任何需要写入的数据块时，也要定期检查合并和变更是否被取消。 [#77766](https://github.com/ClickHouse/ClickHouse/pull/77766) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* 已回退。[#77843](https://github.com/ClickHouse/ClickHouse/pull/77843) ([Vladimir Cherkasov](https://github.com/vdimir))。
* 修复在出现 `NOT_FOUND_COLUMN_IN_BLOCK` 错误时可能发生的崩溃。[#77854](https://github.com/ClickHouse/ClickHouse/pull/77854)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 修复在向 `StorageSystemObjectStorageQueueSettings` 填充数据时发生的崩溃。[#77878](https://github.com/ClickHouse/ClickHouse/pull/77878)（[Bharat Nallan](https://github.com/bharatnc)）。
* 在 SSH 服务器中禁用历史记录的模糊搜索（因为它需要 skim）。 [#78002](https://github.com/ClickHouse/ClickHouse/pull/78002) ([Azat Khuzhin](https://github.com/azat)).
* 修复了一个错误:当表中存在另一个已定义向量相似度索引的向量列时,对未索引列执行向量搜索查询会返回错误结果。(Issue [#77978](https://github.com/ClickHouse/ClickHouse/issues/77978)). [#78069](https://github.com/ClickHouse/ClickHouse/pull/78069) ([Shankar Iyer](https://github.com/shankar-iyer)).
* 修复 `The requested output format {} is binary... Do you want to output it anyway? [y/N]` 提示信息。[#78095](https://github.com/ClickHouse/ClickHouse/pull/78095)（[Azat Khuzhin](https://github.com/azat)）。
* 修复了在 `toStartOfInterval` 中使用零原点参数时的一个错误。[#78096](https://github.com/ClickHouse/ClickHouse/pull/78096)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 禁止在 HTTP 接口中指定空的 `session_id` 查询参数。[#78098](https://github.com/ClickHouse/ClickHouse/pull/78098) ([Alexey Katsman](https://github.com/alexkats)).
* 修复 `Database Replicated` 中可能发生的元数据被覆盖问题，该问题可能是在执行 `ALTER` 查询后紧接着执行 `RENAME` 查询时触发的。[#78107](https://github.com/ClickHouse/ClickHouse/pull/78107) ([Nikolay Degterinsky](https://github.com/evillique))。
* 修复 NATS 引擎中的崩溃问题。 [#78108](https://github.com/ClickHouse/ClickHouse/pull/78108) ([Dmitry Novikov](https://github.com/dmitry-sles-novikov)).
* 不要尝试在用于 SSH 的嵌入式客户端中创建 `history_file`。 [#78112](https://github.com/ClickHouse/ClickHouse/pull/78112) ([Azat Khuzhin](https://github.com/azat))。
* 修复在执行 RENAME DATABASE 或 DROP TABLE 查询后，`system.detached_tables` 显示不正确信息的问题。 [#78126](https://github.com/ClickHouse/ClickHouse/pull/78126) ([Nikolay Degterinsky](https://github.com/evillique))。
* 修复了在 [https://github.com/ClickHouse/ClickHouse/pull/77274](https://github.com/ClickHouse/ClickHouse/pull/77274) 之后 `Database Replicated` 对表数量过多时进行检查的逻辑。同时，将该检查提前到创建存储之前执行，以避免在使用 RMT 或 `KeeperMap` 时在 ZooKeeper 中产生未被计入的节点。[#78127](https://github.com/ClickHouse/ClickHouse/pull/78127)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 修复因并发执行 S3Queue 元数据初始化可能导致的崩溃。[#78131](https://github.com/ClickHouse/ClickHouse/pull/78131) ([Azat Khuzhin](https://github.com/azat)).
* `groupArray*` 函数现在在 `max_size` 参数为 Int 类型且值为 0 时会抛出 BAD&#95;ARGUMENTS 错误，就像对 UInt 类型已经如此处理的一样，而不是尝试继续执行。 [#78140](https://github.com/ClickHouse/ClickHouse/pull/78140) ([Eduard Karacharov](https://github.com/korowa)).
* 修复在执行 `recoverLostReplica` 时，如果本地表在被分离前就被移除而导致的崩溃问题。[#78173](https://github.com/ClickHouse/ClickHouse/pull/78173) ([Raúl Marín](https://github.com/Algunenano)).
* 修复 `system.s3_queue_settings` 中始终返回 `false` 的 `alterable` 列。[#78187](https://github.com/ClickHouse/ClickHouse/pull/78187) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 对 Azure 访问签名进行脱敏处理，使其不会对用户可见，也不会出现在日志中。[#78189](https://github.com/ClickHouse/ClickHouse/pull/78189) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复 Wide 部分中带前缀子流的预取问题。[#78205](https://github.com/ClickHouse/ClickHouse/pull/78205) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复了在键数组类型为 `LowCardinality(Nullable)` 时，`mapFromArrays` 导致崩溃或结果不正确的问题。 [#78240](https://github.com/ClickHouse/ClickHouse/pull/78240) ([Eduard Karacharov](https://github.com/korowa)).
* 修复 delta-kernel 认证选项。 [#78255](https://github.com/ClickHouse/ClickHouse/pull/78255) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 当副本的 `disable_insertion_and_mutation` 为 true 时，不再调度 RefreshMV 任务。该任务本质上是一次插入操作，如果 `disable_insertion_and_mutation` 为 true，则会失败。 [#78277](https://github.com/ClickHouse/ClickHouse/pull/78277) ([Xu Jia](https://github.com/XuJia0210)).
* 验证对 Merge 引擎底层表的访问权限。 [#78339](https://github.com/ClickHouse/ClickHouse/pull/78339) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* `Distributed` 引擎表上的 FINAL 修饰符可能会被忽略。[#78428](https://github.com/ClickHouse/ClickHouse/pull/78428) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* `Bitmapmin` 在位图为 `empty` 时返回 uint32&#95;max（当输入类型为 ≥ 8 位时返回 uint64&#95;max），这与空 `roaring_bitmap` 的 `minimum()` 行为一致。 [#78444](https://github.com/ClickHouse/ClickHouse/pull/78444) ([wxybear](https://github.com/wxybear)).
* 回滚“在代码部分位置应用 preserve&#95;most 属性”的更改，因为它可能导致崩溃。[#78449](https://github.com/ClickHouse/ClickHouse/pull/78449) ([Azat Khuzhin](https://github.com/azat))。
* 对 `INFILE` 的 schema 推断使用插入用的列。 [#78490](https://github.com/ClickHouse/ClickHouse/pull/78490) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* 在启用 `distributed_aggregation_memory_efficient` 时，在读取 `FROM` 之后立即禁用查询处理并行化，否则可能会导致逻辑错误。修复了 [#76934](https://github.com/ClickHouse/ClickHouse/issues/76934)。[#78500](https://github.com/ClickHouse/ClickHouse/pull/78500)（[flynn](https://github.com/ucasfl)）。
* 在应用 `max_streams_to_max_threads_ratio` 设置后，如果计划的 stream 数为零，则至少保留一个用于读取的 stream。 [#78505](https://github.com/ClickHouse/ClickHouse/pull/78505) ([Eduard Karacharov](https://github.com/korowa)).
* 在 S3Queue 存储中修复逻辑错误 “Cannot unregister: table uuid is not registered”。关闭 [#78285](https://github.com/ClickHouse/ClickHouse/issues/78285)。[#78541](https://github.com/ClickHouse/ClickHouse/pull/78541)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* ClickHouse 现在能够在同时启用了 cgroups v1 和 v2 的系统上自动识别其 cgroup v2。[#78566](https://github.com/ClickHouse/ClickHouse/pull/78566) ([Grigory Korolev](https://github.com/gkorolev)).
* 在与表级设置配合使用时，ObjectStorage 集群表函数会失败。[#78587](https://github.com/ClickHouse/ClickHouse/pull/78587)（[Daniil Ivanik](https://github.com/divanik)）。
* ReplicatedMergeTree 在执行 `INSERT` 时不支持更完善的事务检查。[#78633](https://github.com/ClickHouse/ClickHouse/pull/78633) ([Azat Khuzhin](https://github.com/azat))。
* 在附加时应用查询设置。[#78637](https://github.com/ClickHouse/ClickHouse/pull/78637) ([Raúl Marín](https://github.com/Algunenano))。
* 修复了在 `iceberg_metadata_file_path` 中指定无效路径时出现的崩溃问题。 [#78688](https://github.com/ClickHouse/ClickHouse/pull/78688) ([alesapin](https://github.com/alesapin)).
* 在使用 delta-kernel 实现的 DeltaLake 表引擎中，修复了在读取 schema 与表的 schema 不一致且同时存在分区列时，会导致“未找到列”错误的问题。 [#78690](https://github.com/ClickHouse/ClickHouse/pull/78690) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 此更新修复了一个错误：当两个命名会话使用相同名称，且新会话在旧会话超时到期前创建时，新会话会在旧会话的预定超时时间意外关闭。[#78698](https://github.com/ClickHouse/ClickHouse/pull/78698) ([Alexey Katsman](https://github.com/alexkats))。
* 运行 CHECK TABLE 时不再阻塞表关闭。[#78782](https://github.com/ClickHouse/ClickHouse/pull/78782) ([Raúl Marín](https://github.com/Algunenano))。
* Keeper 修复:修复所有情况下的临时节点计数问题。[#78799](https://github.com/ClickHouse/ClickHouse/pull/78799) ([Antonio Andelic](https://github.com/antonio2368))。
* 修复在使用除 `view()` 之外的表函数时，`StorageDistributed` 中的错误类型转换。关闭 [#78464](https://github.com/ClickHouse/ClickHouse/issues/78464)。[#78828](https://github.com/ClickHouse/ClickHouse/pull/78828)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 修复 `tupleElement(*, 1)` 的格式化。关闭 [#78639](https://github.com/ClickHouse/ClickHouse/issues/78639)。[#78832](https://github.com/ClickHouse/ClickHouse/pull/78832)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 类型为 `ssd_cache` 的字典现在会拒绝 `block_size` 和 `write_buffer_size` 为零或负数的参数（问题 [#78314](https://github.com/ClickHouse/ClickHouse/issues/78314)）。[#78854](https://github.com/ClickHouse/ClickHouse/pull/78854)（[Elmi Ahmadov](https://github.com/ahmadov)）。
* 修复在发生异常关闭后执行 `ALTER` 时 `REFRESHABLE MV` 中出现的崩溃问题。[#78858](https://github.com/ClickHouse/ClickHouse/pull/78858) ([Azat Khuzhin](https://github.com/azat)).
* 修复在 CSV 格式中对无效 `DateTime` 值的解析。[#78919](https://github.com/ClickHouse/ClickHouse/pull/78919)（[Pavel Kruglov](https://github.com/Avogar)）。





## 构建/测试/打包改进 {#build-testing-packaging-improvement}


* 内部依赖 LLVM 从 16 升级至 18。[#66053](https://github.com/ClickHouse/ClickHouse/pull/66053) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
* 恢复已删除的 nats 集成测试并修复错误。- 修复了 nats 引擎中的一些竞态条件 - 修复了在连接丢失情况下向 nats 进行流式写入时可能发生的数据丢失问题 - 修复了当从 nats 的流式传输结束时，接收最后一个数据块可能出现卡死的问题 - `nats_max_reconnect` 已被弃用且不再生效，现会始终重连，并使用 `nats_reconnect_wait` 作为重连等待时间。[#69772](https://github.com/ClickHouse/ClickHouse/pull/69772) ([Dmitry Novikov](https://github.com/dmitry-sles-novikov))。
* 修复无法生成 contrib openssl 的 asm 文件的问题。 [#72622](https://github.com/ClickHouse/ClickHouse/pull/72622) ([RinChanNOW](https://github.com/RinChanNOWWW)).
* 修复测试 03210&#95;variant&#95;with&#95;aggregate&#95;function&#95;type 的稳定性问题。[#74012](https://github.com/ClickHouse/ClickHouse/pull/74012)（[Anton Ivashkin](https://github.com/ianton-ru)）。
* 在 ARM 和 Intel 架构的 Mac 上支持构建 HDFS。[#74244](https://github.com/ClickHouse/ClickHouse/pull/74244) ([Yan Xin](https://github.com/yxheartipp))。
* 通用安装脚本现在也会在 macOS 上提供安装选项。 [#74339](https://github.com/ClickHouse/ClickHouse/pull/74339) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 在未启用 Kerberos 时修复构建。[#74771](https://github.com/ClickHouse/ClickHouse/pull/74771) ([flynn](https://github.com/ucasfl))。
* 更新到内置 LLVM 19。 [#75148](https://github.com/ClickHouse/ClickHouse/pull/75148) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* *可能存在不兼容变更*：改进以设置更为严格的默认值。当前默认值已经是安全的。用户必须显式指定一个选项才能对外暴露端口。但当 `default` 用户既没有通过 `CLICKHOUSE_PASSWORD` 设置密码，且/或没有通过 `CLICKHOUSE_USER` 环境变量更改用户名时，它应当只能从本地系统访问，作为额外的一层防护。[#75259](https://github.com/ClickHouse/ClickHouse/pull/75259)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* 集成测试对每一批并行测试运行设置了 1 小时的超时时间。当达到该超时时间时，会终止 `pytest`，并且可能缺失部分日志。内部的 pytest 超时时间被设置为 55 分钟，以便能够在会话中打印结果，而不会触发外部的超时信号。修复了 [#75532](https://github.com/ClickHouse/ClickHouse/issues/75532)。[#75533](https://github.com/ClickHouse/ClickHouse/pull/75533)（[Ilya Yatsishin](https://github.com/qoega)）。
* 将所有与 clickhouse-server 相关的操作封装为函数,并仅在 `entrypoint.sh` 中启动默认二进制文件时执行。这项改进在 [#50724](https://github.com/ClickHouse/ClickHouse/issues/50724) 中提出,长期以来一直被推迟。为 `clickhouse-extract-from-config` 添加了 `--users` 开关,用于从 `users.xml` 中获取值。[#75643](https://github.com/ClickHouse/ClickHouse/pull/75643) ([Mikhail f. Shiryaev](https://github.com/Felixoid))。
* 对于压力测试，如果在我们通过 gdb 收集栈回溯期间服务器没有退出，则会增加额外的等待时间，以减少 `Possible deadlock on shutdown (see gdb.log)` 检测产生的噪声。该延迟只会在测试未成功完成的情况下增加。[#75668](https://github.com/ClickHouse/ClickHouse/pull/75668) ([Ilya Yatsishin](https://github.com/qoega))。
* 恢复已删除的 nats 集成测试并修复错误。 - 修复了 nats 引擎中的一些竞争条件 - 修复了在连接丢失情况下向 nats 进行数据流式写入时可能发生的数据丢失问题 - 修复了从 nats 流式读取结束时接收最后一个数据块可能卡死的问题 - `nats_max_reconnect` 已弃用且不再生效，重连将一直进行，并受 `nats_reconnect_wait` 超时时间控制。 [#75850](https://github.com/ClickHouse/ClickHouse/pull/75850) ([Dmitry Novikov](https://github.com/dmitry-sles-novikov)).
* 在为 Darwin 进行交叉编译时启用 ICU 和 gRPC。 [#75922](https://github.com/ClickHouse/ClickHouse/pull/75922) ([Raúl Marín](https://github.com/Algunenano)).
* 修复由于在终止进程组时使用 `sleep` 而导致拆分测试输出异常的问题。[#76090](https://github.com/ClickHouse/ClickHouse/pull/76090)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* 不要在运行结束时再收集 `docker-compose` 日志，因为脚本经常会被终止。请改为在后台收集这些日志。[#76140](https://github.com/ClickHouse/ClickHouse/pull/76140)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* 将 Kafka 存储的测试拆分到多个文件中。修复了 [#69452](https://github.com/ClickHouse/ClickHouse/issues/69452)。[#76208](https://github.com/ClickHouse/ClickHouse/pull/76208)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* `clickhouse-odbc-bridge` 和 `clickhouse-library-bridge` 已迁移到单独的代码仓库 [https://github.com/ClickHouse/odbc-bridge/](https://github.com/ClickHouse/odbc-bridge/)。[#76225](https://github.com/ClickHouse/ClickHouse/pull/76225)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 从二进制中移除约 20MB 的死代码。 [#76226](https://github.com/ClickHouse/ClickHouse/pull/76226) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 由于引入 `block()`，将最低要求的 CMake 版本提升至 3.25。 [#76316](https://github.com/ClickHouse/ClickHouse/pull/76316) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* 将 fmt 升级至 11.1.3。 [#76547](https://github.com/ClickHouse/ClickHouse/pull/76547) ([Raúl Marín](https://github.com/Algunenano)).
* 将 `lz4` 升级到 `1.10.0`。[#76571](https://github.com/ClickHouse/ClickHouse/pull/76571) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* 将 `curl` 更新到 `8.12.1`。 [#76572](https://github.com/ClickHouse/ClickHouse/pull/76572) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 将 `libcpuid` 升级到 `0.7.1`。[#76573](https://github.com/ClickHouse/ClickHouse/pull/76573) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* 使用机器可读格式解析 `pytest` 结果。[#76910](https://github.com/ClickHouse/ClickHouse/pull/76910) ([Mikhail f. Shiryaev](https://github.com/Felixoid))。
* 修复 Rust 交叉编译问题，并允许完全禁用 Rust。 [#76921](https://github.com/ClickHouse/ClickHouse/pull/76921) ([Raúl Marín](https://github.com/Algunenano)).
* 需要使用 clang 19 来构建该项目。 [#76945](https://github.com/ClickHouse/ClickHouse/pull/76945) ([Raúl Marín](https://github.com/Algunenano)).
* 该测试在串行模式下执行时间超过 10 秒，对于快速测试而言过长。[#76948](https://github.com/ClickHouse/ClickHouse/pull/76948) ([Mikhail f. Shiryaev](https://github.com/Felixoid))。
* 将 `sccache` 升级至 `0.10.0`。 [#77580](https://github.com/ClickHouse/ClickHouse/pull/77580) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 在 Rust 中遵循 CPU 目标特性设置，并在所有 crate 中启用 LTO。[#78590](https://github.com/ClickHouse/ClickHouse/pull/78590)（[Raúl Marín](https://github.com/Algunenano)）。
* 将 `minizip-ng` 升级至 `4.0.9`。[#78917](https://github.com/ClickHouse/ClickHouse/pull/78917) ([Konstantin Bogdanov](https://github.com/thevar1able))。
