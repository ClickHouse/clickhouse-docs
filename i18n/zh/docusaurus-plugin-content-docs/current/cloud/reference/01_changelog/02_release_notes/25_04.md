---
slug: /changelogs/25.4
title: 'v25.4 云版本更新日志'
description: 'v25.4 云版本快速发布更新日志'
keywords: ['changelog', 'cloud']
sidebar_label: '25.4'
sidebar_position: 3
doc_type: 'changelog'
---



## 不兼容变更 {#backward-incompatible-changes}


* Parquet 输出格式会将 Date 和 DateTime 列转换为 Parquet 所支持的日期/时间类型，而不是将它们写为原始数字。DateTime 现在变为 DateTime64(3)（原为：UInt32）；通过设置 `output_format_parquet_datetime_as_uint32` 可以恢复旧行为。Date 现在变为 Date32（原为：UInt16）。 [#70950](https://github.com/ClickHouse/ClickHouse/pull/70950) ([Michael Kolupaev](https://github.com/al13n321)).
* 默认情况下，不允许在 `ORDER BY` 和比较函数 `less/greater/equal/etc` 中使用可比类型（如 JSON/Object/AggregateFunction）。[#73276](https://github.com/ClickHouse/ClickHouse/pull/73276)（[Pavel Kruglov](https://github.com/Avogar)）。
* `JSONEachRowWithProgress` 会在每次进度更新时立即写出进度。在之前的版本中，进度只会在每个结果块之后显示，这几乎让它失去了意义。修改进度的显示方式：不再输出为零的数值。请注意，即使进度更新非常频繁，也都会被发送，这可能会产生大量流量。还要注意，当输出被压缩时，进度不会被刷新。修复了 [#70800](https://github.com/ClickHouse/ClickHouse/issues/70800)。[#73834](https://github.com/ClickHouse/ClickHouse/pull/73834)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `mysql` 字典源不再执行 `SHOW TABLE STATUS` 查询，因为对于 InnoDB 表以及任何较新的 MySQL 版本来说，它已经不再提供任何有用的信息。这样就解决了 [#72636](https://github.com/ClickHouse/ClickHouse/issues/72636)。此更改保持向后兼容，但仍被归入本类别，以便你能注意到它。[#73914](https://github.com/ClickHouse/ClickHouse/pull/73914)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `Merge` 表现在会通过对各个底层表的列取并集并推导出公共类型来统一这些表的结构。这关闭了 [#64864](https://github.com/ClickHouse/ClickHouse/issues/64864)。这也关闭了 [#35307](https://github.com/ClickHouse/ClickHouse/issues/35307)。在某些情况下，此变更可能与旧版本不兼容。例如，当各个表之间不存在公共类型，但仍然可以转换为第一个表的类型时（例如 UInt64 与 Int64，或任意数值类型与 String），就会出现这种情况。如果你希望恢复旧行为，将 `merge_table_max_tables_to_look_for_schema_inference` 设置为 `1`，或者将 `compatibility` 设置为 `24.12` 或更早版本。[#73956](https://github.com/ClickHouse/ClickHouse/pull/73956)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 现在，执行 `CHECK TABLE` 查询需要单独的 `CHECK` 权限。在此前的版本中，仅拥有 `SHOW TABLES` 权限就可以运行这些查询。但 `CHECK TABLE` 查询可能非常耗费资源，而且对 `SELECT` 查询所施加的常规查询复杂度限制并不适用于它，这带来了潜在的 DoS 风险。[#74471](https://github.com/ClickHouse/ClickHouse/pull/74471)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 当 `allow_materialized_view_with_bad_select` 为 `false` 时，检查物化视图中的所有列是否与目标表中的列一一对应。[#74481](https://github.com/ClickHouse/ClickHouse/pull/74481) ([Christoph Wurm](https://github.com/cwurm))。
* 函数 `h3ToGeo()` 现在按 `(lat, lon)` 的顺序返回结果（这是几何函数的标准顺序）。希望保留旧版结果顺序 `(lon, lat)` 的用户可以将设置项 `h3togeo_lon_lat_result_order` 设为 `true`。 [#74719](https://github.com/ClickHouse/ClickHouse/pull/74719) ([Manish Gill](https://github.com/mgill25))。
* 添加 `JSONCompactEachRowWithProgress` 和 `JSONCompactStringsEachRowWithProgress` 格式，为 [#69989](https://github.com/ClickHouse/ClickHouse/issues/69989) 的后续更新。`JSONCompactWithNames` 和 `JSONCompactWithNamesAndTypes` 不再输出 &quot;totals&quot;——显然这是先前实现中的一个错误。[#75037](https://github.com/ClickHouse/ClickHouse/pull/75037)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 将 `format_alter_operations_with_parentheses` 的默认值改为 true，使 alter 命令列表的格式无歧义（参见 [https://github.com/ClickHouse/ClickHouse/pull/59532](https://github.com/ClickHouse/ClickHouse/pull/59532)）。这会导致与 24.3 之前版本的集群在复制时不兼容。如果你正在升级使用旧版本的集群，请在服务端配置中关闭该设置，或者先升级到 24.3。 [#75302](https://github.com/ClickHouse/ClickHouse/pull/75302)（[Raúl Marín](https://github.com/Algunenano)）。
* 禁止在复制数据库上执行 TRUNCATE DATABASE 操作。 [#76651](https://github.com/ClickHouse/ClickHouse/pull/76651) ([Bharat Nallan](https://github.com/bharatnc))。
* 当禁用了 `analyzer` 时，默认禁用并行副本，与 `compatibility` 设置无关。仍然可以通过将 `parallel_replicas_only_with_analyzer` 显式设置为 `false` 来更改此行为。[#77115](https://github.com/ClickHouse/ClickHouse/pull/77115) ([Igor Nikonov](https://github.com/devcrafter))。
* 现在不再支持在设置中将 `NaN` 或 `inf` 用作浮点数值。[#77546](https://github.com/ClickHouse/ClickHouse/pull/77546)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 修复了 `dateTrunc` 与负日期/datetime 参数一起使用时的相关问题。[#77622](https://github.com/ClickHouse/ClickHouse/pull/77622) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 旧版 MongoDB 集成已被移除。服务器设置 `use_legacy_mongodb_integration` 已被弃用，现在不再起任何作用。[#77895](https://github.com/ClickHouse/ClickHouse/pull/77895)（[Robert Schulze](https://github.com/rschu1ze)）。
* 增强 `SummingMergeTree` 校验逻辑，对用作分区键或排序键的列跳过聚合。[#78022](https://github.com/ClickHouse/ClickHouse/pull/78022) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。





## 新功能 {#new-features}


* 为反序列化的 skipping 索引粒度新增了内存缓存，这可以加速重复使用 skipping 索引的查询。新缓存的大小由服务器设置项 `skipping_index_cache_size` 和 `skipping_index_cache_max_entries` 控制。添加该缓存的最初动机是向量相似度索引，它们现在快了很多。[#70102](https://github.com/ClickHouse/ClickHouse/pull/70102) ([Robert Schulze](https://github.com/rschu1ze))。
* 全新实现的 Userspace Page Cache 允许在进程内存中缓存数据，而无需依赖操作系统页面缓存。当数据存储在没有本地文件系统缓存支持的远程虚拟文件系统上时，这一功能非常有用。 [#70509](https://github.com/ClickHouse/ClickHouse/pull/70509) ([Michael Kolupaev](https://github.com/al13n321))。
* 新增设置，用于按照特定时间戳查询 Iceberg 表。[#71072](https://github.com/ClickHouse/ClickHouse/pull/71072) ([Brett Hoerner](https://github.com/bretthoerner)).
* 在 Iceberg 中为与时间相关的分区转换操作实现 Iceberg 表的分区裁剪。 [#72044](https://github.com/ClickHouse/ClickHouse/pull/72044) ([Daniil Ivanik](https://github.com/divanik))。
* 添加对由 MergeTree 管理的列默认创建 min-max（skipping）索引的支持，可通过设置 `enable_minmax_index_for_all_numeric_columns`（针对数值列）和 `enable_minmax_index_for_all_string_columns`（针对字符串列）来启用。目前这两个设置都处于禁用状态，因此暂时不会带来任何行为变化。[#72090](https://github.com/ClickHouse/ClickHouse/pull/72090)（[Smita Kulkarni](https://github.com/SmitaRKulkarni)）。
* 新增聚合函数 `sequenceMatchEvents`，用于根据给定模式返回最长事件链中匹配事件的时间戳。 [#72349](https://github.com/ClickHouse/ClickHouse/pull/72349) ([UnamedRus](https://github.com/UnamedRus)).
* `SELECT` 和 `VIEW` 语句现在支持别名，例如：`SELECT b FROM (SELECT number, number*2 FROM numbers(2)) AS x (a, b);`。这使得 TPC-H 查询 15 可以在无需修改的情况下运行。[#72480](https://github.com/ClickHouse/ClickHouse/pull/72480) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 新增了一个设置 `enable_adaptive_memory_spill_scheduler`，允许同一查询中的多个 grace JOIN 监控其合计内存占用，并自适应地触发向外部存储的落盘（spilling），以防止触发 MEMORY&#95;LIMIT&#95;EXCEEDED。 [#72728](https://github.com/ClickHouse/ClickHouse/pull/72728) ([lgbo](https://github.com/lgbo-ustc)).
* 新增了函数 `arrayNormalizedGini`。 [#72823](https://github.com/ClickHouse/ClickHouse/pull/72823) ([flynn](https://github.com/ucasfl)).
* 支持低基数 Decimal 数据类型，修复 [#72256](https://github.com/ClickHouse/ClickHouse/issues/72256)。[#72833](https://github.com/ClickHouse/ClickHouse/pull/72833) ([zhanglistar](https://github.com/zhanglistar))。
* 当同时启用 `min_age_to_force_merge_seconds` 和 `min_age_to_force_merge_on_partition_only` 时，数据分片的合并将忽略最大字节数限制。 [#73656](https://github.com/ClickHouse/ClickHouse/pull/73656) ([Kai Zhu](https://github.com/nauu))。
* 支持从 Apache Arrow/Parquet/ORC 读取 HALF&#95;FLOAT 值（会被读取为 Float32）。此更改解决了 [#72960](https://github.com/ClickHouse/ClickHouse/issues/72960)。请注意，IEEE-754 half float 与 BFloat16 并不相同。解决 [#73835](https://github.com/ClickHouse/ClickHouse/issues/73835)。[#73836](https://github.com/ClickHouse/ClickHouse/pull/73836)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `system.trace_log` 表中将新增两列 `symbols` 和 `lines`，用于存储符号化后的堆栈跟踪信息。这使得收集和导出性能剖析信息更加方便。该功能由 `trace_log` 中的服务器配置项 `symbolize` 控制，且默认启用。[#73896](https://github.com/ClickHouse/ClickHouse/pull/73896)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 新增函数 `generateSerialID`，可用于在表中生成自增序号。延续了由 [kazalika](https://github.com/kazalika) 发起的 [#64310](https://github.com/ClickHouse/ClickHouse/issues/64310)。此更改关闭了 [#62485](https://github.com/ClickHouse/ClickHouse/issues/62485)。[#73950](https://github.com/ClickHouse/ClickHouse/pull/73950)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 添加语法 `query1 PARALLEL WITH query2 PARALLEL WITH query3 ... PARALLEL WITH queryN`。这意味着子查询 `{query1, query2, ... queryN}` 可以彼此并行运行（并且推荐这样使用）。[#73983](https://github.com/ClickHouse/ClickHouse/pull/73983) ([Vitaly Baranov](https://github.com/vitlibar))。
* 现在，Play UI 在查询运行期间会显示进度条，并支持取消查询。它会显示记录总数以及更详细的速度信息。表格可以在数据到达后立即增量渲染。启用 HTTP 压缩后，表格渲染速度变得更快。表头现在是固定的。支持选中单元格并通过方向键在单元格之间导航。修复了选中单元格的轮廓导致其变小的问题。单元格不再在鼠标悬停时扩展，而只在选中时扩展。停止渲染传入数据的时机现在由客户端而不是服务器端决定。数值会按数字分组进行高亮显示。整体设计进行了焕新，风格更加醒目。它会检查服务器是否可达以及凭据是否正确，并显示服务器版本和运行时间。云图标在所有字体中（即便在 Safari 中）都有描边。嵌套数据类型中的大整数将得到更好的渲染。它将正确显示 inf/nan。当鼠标悬停在列表头上时，将显示数据类型。[#74204](https://github.com/ClickHouse/ClickHouse/pull/74204)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 通过设置 `add_minmax_index_for_numeric_columns`（用于数值列）和 `add_minmax_index_for_string_columns`（用于字符串列），新增了为由 MergeTree 管理的列默认创建 min-max（跳过）索引的功能。目前这两个设置均为禁用状态，因此暂时不会带来任何行为变更。[#74266](https://github.com/ClickHouse/ClickHouse/pull/74266)（[Smita Kulkarni](https://github.com/SmitaRKulkarni)）。
* 将 `script_query_number` 和 `script_line_number` 字段添加到 `system.query_log`、原生协议中的 ClientInfo 以及服务器日志中。这一更改解决了 [#67542](https://github.com/ClickHouse/ClickHouse/issues/67542)。感谢 [pinsvin00](https://github.com/pinsvin00) 之前在 [#68133](https://github.com/ClickHouse/ClickHouse/issues/68133) 中推动这一特性。[#74477](https://github.com/ClickHouse/ClickHouse/pull/74477)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 为 `DateTime64` 添加减号运算符支持，允许在 `DateTime64` 值之间以及与 `DateTime` 之间进行减法运算。[#74482](https://github.com/ClickHouse/ClickHouse/pull/74482) ([Li Yin](https://github.com/liyinsg)).
* 为 AzureBlobStorage 提供 DeltaLake 表引擎支持。修复 [#68043](https://github.com/ClickHouse/ClickHouse/issues/68043)。[#74541](https://github.com/ClickHouse/ClickHouse/pull/74541)（[Smita Kulkarni](https://github.com/SmitaRKulkarni)）。
* 添加 `bind_host` 设置，用于为 clickhouse 客户端连接指定源 IP 地址。[#74741](https://github.com/ClickHouse/ClickHouse/pull/74741) ([Todd Yocum](https://github.com/toddyocum))。
* 添加了在提交后执行 `SELECT` 查询时，立即应用尚未完成（尚未由后台进程物化）的 mutation 的能力。可以通过设置 `apply_mutations_on_fly` 来启用此功能。[#74877](https://github.com/ClickHouse/ClickHouse/pull/74877)（[Anton Popov](https://github.com/CurtizJ)）。
* 修复了此前在 `toStartOfInterval` 的 datetime 参数为负数时出现的一些未预期情况。通过实现一个名为 toStartOfIntervalAllowNegative 的新函数完成，该函数的功能基本相同，但只返回 Date32/DateTime64。 [#74933](https://github.com/ClickHouse/ClickHouse/pull/74933) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 新增了一个函数 `initialQueryStartTime`，用于返回当前查询的开始时间。在分布式查询中，该值在所有分片上保持一致。[#75087](https://github.com/ClickHouse/ClickHouse/pull/75087)（[Roman Lomonosov](https://github.com/lomik)）。
* 在 system.tables 中引入 `parametrized_view_parameters`。修复了 [https://github.com/clickhouse/clickhouse/issues/66756](https://github.com/clickhouse/clickhouse/issues/66756)。[#75112](https://github.com/ClickHouse/ClickHouse/pull/75112)（[NamNguyenHoai](https://github.com/NamHoaiNguyen)）。
* 允许修改数据库注释。修复 [#73351](https://github.com/ClickHouse/ClickHouse/issues/73351) ### 面向用户可见变更的文档条目。[#75622](https://github.com/ClickHouse/ClickHouse/pull/75622) ([NamNguyenHoai](https://github.com/NamHoaiNguyen)).
* 新增在没有数据库层的情况下 ATTACH 表的能力（避免依赖 UUID hack）。 [#75788](https://github.com/ClickHouse/ClickHouse/pull/75788) ([Azat Khuzhin](https://github.com/azat)).
* 新增 `concurrent_threads_scheduler` 服务器设置，用于控制在并发查询之间如何分配 CPU 资源。可以设置为 `round_robin`（原有行为）或 `fair_round_robin`，以解决 INSERT 与 SELECT 之间 CPU 分配不公平的问题。[#75949](https://github.com/ClickHouse/ClickHouse/pull/75949) ([Sergei Trifonov](https://github.com/serxa)).
* 恢复在 v24.10 中因许可问题被移除的 QPL 编解码器。[#76021](https://github.com/ClickHouse/ClickHouse/pull/76021) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* 新增函数 `arraySymmetricDifference`。该函数返回多个数组参数中未在所有参数中同时出现的所有元素。示例：`SELECT arraySymmetricDifference([1, 2], [2, 3])` 返回 `[1, 3]`。（issue [#61673](https://github.com/ClickHouse/ClickHouse/issues/61673)）。[#76231](https://github.com/ClickHouse/ClickHouse/pull/76231)（[Filipp Abapolov](https://github.com/pheepa)）。
* 添加 `estimatecompressionratio` 聚合函数，参见 [#70801](https://github.com/ClickHouse/ClickHouse/issues/70801)。[#76661](https://github.com/ClickHouse/ClickHouse/pull/76661)（[Tariq Almawash](https://github.com/talmawash)）。
* `FilterTransformPassedRows` 和 `FilterTransformPassedBytes` profile event 将显示在查询执行期间被过滤的行数和字节数。[#76662](https://github.com/ClickHouse/ClickHouse/pull/76662)（[Onkar Deshpande](https://github.com/onkar)）。
* 添加了 `keccak256` 哈希函数，该函数常用于区块链实现，尤其是在基于 EVM 的系统中。[#76669](https://github.com/ClickHouse/ClickHouse/pull/76669) ([Arnaud Briche](https://github.com/arnaudbriche))。
* Scram SHA256 与更新 PostgreSQL wire 认证协议。[#76839](https://github.com/ClickHouse/ClickHouse/pull/76839) ([scanhex12](https://github.com/scanhex12)).
* 该功能新增了配置请求头列表的能力，用于将客户端请求中的这些请求头转发给外部 `http` 认证器。[#77054](https://github.com/ClickHouse/ClickHouse/pull/77054) ([inv2004](https://github.com/inv2004))。
* 支持 `IcebergMetadataFilesCache`，用于在同一个缓存中存储 manifest 文件/列表和 metadata.json。 [#77156](https://github.com/ClickHouse/ClickHouse/pull/77156) ([Han Fei](https://github.com/hanfei1991)).
* 添加了函数 `arrayLevenshteinDistance`、`arrayLevenshteinDistanceWeighted` 和 `arraySimilarity`。 [#77187](https://github.com/ClickHouse/ClickHouse/pull/77187)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* 新增三个函数：`icebergTruncate`（符合规范：[https://iceberg.apache.org/spec/#truncate-transform-details](https://iceberg.apache.org/spec/#truncate-transform-details)）、`toYearNumSinceEpoch` 和 `toMonthNumSinceEpoch`。在 `Iceberg` 引擎的分区剪枝中支持 `truncate` 变换。[#77403](https://github.com/ClickHouse/ClickHouse/pull/77403) ([alesapin](https://github.com/alesapin))。
* 允许用户查询 Iceberg 表在先前某个时间点的状态。[#77439](https://github.com/ClickHouse/ClickHouse/pull/77439)（[Daniil Ivanik](https://github.com/divanik)）。
* 为工作负载新增了 CPU 槽位调度功能，详情参见 [https://clickhouse.com/docs/operations/workload-scheduling#cpu&#95;scheduling](https://clickhouse.com/docs/operations/workload-scheduling#cpu_scheduling)。[#77595](https://github.com/ClickHouse/ClickHouse/pull/77595)（[Sergei Trifonov](https://github.com/serxa)）。
* `hasAll()` 函数现在可以利用 tokenbf&#95;v1 和 ngrambf&#95;v1 全文跳跃索引。 [#77662](https://github.com/ClickHouse/ClickHouse/pull/77662) ([UnamedRus](https://github.com/UnamedRus)).
* `JSON` 数据类型已可用于生产环境。参见 [https://jsonbench.com/](https://jsonbench.com/)。`Dynamic` 和 `Varaint` 数据类型已可用于生产环境。[#77785](https://github.com/ClickHouse/ClickHouse/pull/77785)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 为反序列化后的向量相似度索引新增了一个内存缓存，这应能加速重复执行的近似最近邻（ANN）搜索查询。新缓存的大小由服务器设置 `vector_similarity_index_cache_size` 和 `vector_similarity_index_cache_max_entries` 控制。此功能取代了早期版本中的跳过索引缓存功能。[#77905](https://github.com/ClickHouse/ClickHouse/pull/77905) ([Shankar Iyer](https://github.com/shankar-iyer))。
* 添加了 sparseGrams 和 sparseGramsHashes 函数及其 UTF8 版本。作者：[scanhex12](https://github.com/scanhex12)。[#78176](https://github.com/ClickHouse/ClickHouse/pull/78176)（[Pervakov Grigorii](https://github.com/GrigoryPervakov)）。
* 引入 `toInterval` 函数。该函数接受 2 个参数（值和单位），并将值转换为特定的 `Interval` 类型。[#78723](https://github.com/ClickHouse/ClickHouse/pull/78723) ([Andrew Davis](https://github.com/pulpdrew))。





## 实验性功能 {#experimental-features}

- 通过新设置 `enable_replacing_merge_with_cleanup_for_min_age_to_force_merge`,允许在可配置的超时时间后自动清理合并整个分区。[#76440](https://github.com/ClickHouse/ClickHouse/pull/76440) ([Christoph Wurm](https://github.com/cwurm))。
- 为基于 AWS S3 和本地文件系统的 DeltaLake 表添加 [Unity Catalog](https://www.databricks.com/product/unity-catalog) 支持。[#76988](https://github.com/ClickHouse/ClickHouse/pull/76988) ([alesapin](https://github.com/alesapin))。
- 引入针对 Iceberg 表的 AWS Glue 服务目录实验性集成。[#77257](https://github.com/ClickHouse/ClickHouse/pull/77257) ([alesapin](https://github.com/alesapin))。


## 性能改进 {#performance-improvements}


* 通过使用惰性投影优化性能，避免读取未使用的列。[#55518](https://github.com/ClickHouse/ClickHouse/pull/55518) ([Xiaozhe Yu](https://github.com/wudidapaopao))。
* 开始优先从最有可能不相等的列比较行。 [#63780](https://github.com/ClickHouse/ClickHouse/pull/63780) ([UnamedRus](https://github.com/UnamedRus)).
* 优化 `RowBinary` 输入格式。修复 [#63805](https://github.com/ClickHouse/ClickHouse/issues/63805)。[#65059](https://github.com/ClickHouse/ClickHouse/pull/65059)（[Pavel Kruglov](https://github.com/Avogar)）。
* 通过底层优化加速字符串反序列化。 [#65948](https://github.com/ClickHouse/ClickHouse/pull/65948) ([Nikita Taranov](https://github.com/nickitat)).
* 在代码的部分位置应用 `preserve_most` 属性。[#67778](https://github.com/ClickHouse/ClickHouse/pull/67778)（[Nikita Taranov](https://github.com/nickitat)）。
* 实现查询条件缓存，以提升包含重复条件的查询性能。将不满足条件的数据区间记录为内存中的临时索引，后续查询将使用该索引。关闭 [#67768](https://github.com/ClickHouse/ClickHouse/issues/67768) ### 面向用户变更的文档条目。 [#69236](https://github.com/ClickHouse/ClickHouse/pull/69236) ([zhongyuankai](https://github.com/zhongyuankai)).
* 为 `NativeORCBlockInputFormat` 增加异步 IO 预取支持，通过隐藏远程 IO 延迟来提升整体性能。在我的测试用例中，性能提升可达 1.47 倍。[#70534](https://github.com/ClickHouse/ClickHouse/pull/70534) ([李扬](https://github.com/taiyang-li))。
* 通过按键值重新划分右侧关联表，提升 grace hash join 的性能。 [#72237](https://github.com/ClickHouse/ClickHouse/pull/72237) ([kevinyhzou](https://github.com/KevinyhZou)).
* 在 `materialize ttl` 中重新启用对 `ttl_only_drop_parts` 的支持；在通过将分片替换为空分片来删除分片时，只读取重新计算 TTL 所需的列。[#72751](https://github.com/ClickHouse/ClickHouse/pull/72751) ([Andrey Zvonov](https://github.com/zvonand))。
* 允许 `arrayROCAUC` 和 `arrayAUCPR` 计算整条曲线的局部面积，从而可以在海量数据集上并行化整个计算过程。[#72904](https://github.com/ClickHouse/ClickHouse/pull/72904) ([Emmanuel](https://github.com/emmanuelsdias)).
* 避免创建过多空闲线程。 [#72920](https://github.com/ClickHouse/ClickHouse/pull/72920) ([Guo Wangyang](https://github.com/guowangy)).
* 在 `parallel_hash` JOIN 算法的探测阶段中，按哈希拆分左表数据块的操作已被移除。[#73089](https://github.com/ClickHouse/ClickHouse/pull/73089) ([Nikita Taranov](https://github.com/nickitat))。
* 如果在表函数中只使用花括号展开，则不要列出 blob 存储键。修复了 [#73333](https://github.com/ClickHouse/ClickHouse/issues/73333)。[#73518](https://github.com/ClickHouse/ClickHouse/pull/73518)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 根据 [#70502](https://github.com/ClickHouse/ClickHouse/issues/70502) 中的测试结果，在算术计算中将 Int256 和 UInt256 替换为 clang 内建的 i256。 [#73658](https://github.com/ClickHouse/ClickHouse/pull/73658)（[李扬](https://github.com/taiyang-li)）。
* 为所有参数类型均为数值类型的函数新增快速路径，修复了 [https://github.com/ClickHouse/ClickHouse/pull/72258](https://github.com/ClickHouse/ClickHouse/pull/72258) 中的性能问题。[#73820](https://github.com/ClickHouse/ClickHouse/pull/73820)（[李扬](https://github.com/taiyang-li)）。
* 不要在非函数列上应用 `maskedExecute`，以提升短路求值的性能。 [#73965](https://github.com/ClickHouse/ClickHouse/pull/73965) ([lgbo](https://github.com/lgbo-ustc)).
* 为 Kafka/NATS/RabbitMQ/FileLog 禁用头部检测以提升性能。[#74006](https://github.com/ClickHouse/ClickHouse/pull/74006)（[Azat Khuzhin](https://github.com/azat)）。
* 按值使用日志包装器，不要在堆上分配它们。 [#74034](https://github.com/ClickHouse/ClickHouse/pull/74034) ([Mikhail Artemenko](https://github.com/Michicosun)).
* 在使用 `GROUPING SETS` 进行聚合之后，以更高的并行度执行流水线。 [#74082](https://github.com/ClickHouse/ClickHouse/pull/74082) ([Nikita Taranov](https://github.com/nickitat))。
* 缩小 `MergeTreeReadPool` 中的临界区范围。 [#74202](https://github.com/ClickHouse/ClickHouse/pull/74202) ([Guo Wangyang](https://github.com/guowangy)).
* 已对函数 `indexHint` 进行了优化。现在，仅作为函数 `indexHint` 参数使用的列不会再从表中读取。[#74314](https://github.com/ClickHouse/ClickHouse/pull/74314) ([Anton Popov](https://github.com/CurtizJ)).
* 并行副本性能改进。对于与并行副本协议无关的数据包，其在查询发起端的反序列化现在始终在 pipeline 线程中进行。此前，这一步可能在负责 pipeline 调度的线程中执行，从而降低发起端的响应能力并延迟 pipeline 的执行。 [#74398](https://github.com/ClickHouse/ClickHouse/pull/74398) ([Igor Nikonov](https://github.com/devcrafter)).
* 修复了对 `LowCardinality` 列内存占用大小的计算。 [#74688](https://github.com/ClickHouse/ClickHouse/pull/74688) ([Nikita Taranov](https://github.com/nickitat)).
* 通过为子列前缀反序列化添加预取、对已反序列化前缀进行缓存以及对子列前缀进行并行反序列化，提高了从 S3 读取 Wide 部分中整个 JSON 列的性能。在类似 `SELECT data FROM table` 的查询中，从 S3 读取 JSON 列的速度提升了 4 倍，在类似 `SELECT data FROM table LIMIT 10` 的查询中则提升了约 10 倍。 [#74827](https://github.com/ClickHouse/ClickHouse/pull/74827) ([Pavel Kruglov](https://github.com/Avogar)).
* 为异步插入预分配内存以提升性能。 [#74945](https://github.com/ClickHouse/ClickHouse/pull/74945) ([Ilya Golshtein](https://github.com/ilejn))。
* 修复了在优化器交换连接两侧时，`ConcurrentHashJoin` 中出现的重复预分配问题。 [#75149](https://github.com/ClickHouse/ClickHouse/pull/75149) ([Nikita Taranov](https://github.com/nickitat)).
* 修复了在 `max_rows_in_join = max_bytes_in_join = 0` 时 `parallel_hash` 中不必要的竞争。[#75155](https://github.com/ClickHouse/ClickHouse/pull/75155) ([Nikita Taranov](https://github.com/nickitat))。
* 在某些 JOIN 场景中略有改进：预先计算输出行数并为其预留内存。[#75376](https://github.com/ClickHouse/ClickHouse/pull/75376) ([Alexander Gololobov](https://github.com/davenger))。
* `plain_rewritable` 元数据文件很小，不需要很大的默认缓冲区。请使用大小与给定路径相适配的写缓冲区，以在存在大量活跃分片时提升内存利用率。### 面向用户的变更文档条目。[#75758](https://github.com/ClickHouse/ClickHouse/pull/75758) ([Julia Kartseva](https://github.com/jkartseva))。
* 在某些情况下（例如空数组列），数据部分可能包含空文件。当表使用元数据与对象存储分离的磁盘布局时，我们可以跳过将空 `blob` 写入 `ObjectStorage`，只为这些文件存储元数据。[#75860](https://github.com/ClickHouse/ClickHouse/pull/75860)（[Alexander Gololobov](https://github.com/davenger)）。
* 发现并发控制可能导致 INSERT 与 SELECT 之间的 CPU 分配不公平：当所有 CPU 插槽在没有竞争的情况下无条件分配给 `max_threads` = 1 的 INSERT 时，`max_threads` 值较高的 SELECT 由于实际上只能使用单个线程而出现性能不佳的问题。[#75941](https://github.com/ClickHouse/ClickHouse/pull/75941) ([Sergei Trifonov](https://github.com/serxa))。
* 对 `wrapInNullable` 进行小幅优化，以避免不必要的 `null map` 分配。 [#76489](https://github.com/ClickHouse/ClickHouse/pull/76489) ([李扬](https://github.com/taiyang-li)).
* 提升 `Decimal32`/`Decimal64`/`DateTime64` 的 `min`/`max` 计算性能。[#76570](https://github.com/ClickHouse/ClickHouse/pull/76570) ([李扬](https://github.com/taiyang-li))。
* 在删除分片时主动从缓存中驱逐相关数据。如果数据总量较小，不要让缓存占用增长到配置的最大上限。[#76641](https://github.com/ClickHouse/ClickHouse/pull/76641) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 查询编译（设置 `compile_expressions`）现在会考虑机器类型。这显著提升了此类查询的执行速度。[#76753](https://github.com/ClickHouse/ClickHouse/pull/76753)（[Robert Schulze](https://github.com/rschu1ze)）。
* 优化 `arraySort`。 [#76850](https://github.com/ClickHouse/ClickHouse/pull/76850) ([李扬](https://github.com/taiyang-li)).
* 通过对 `col->insertFrom()` 调用进行去虚拟化，加速构建 JOIN 结果。[#77350](https://github.com/ClickHouse/ClickHouse/pull/77350) ([Alexander Gololobov](https://github.com/davenger)).
* 将同一分片的标记合并后一次性写入查询条件缓存，以减少锁的开销。[#77377](https://github.com/ClickHouse/ClickHouse/pull/77377) ([zhongyuankai](https://github.com/zhongyuankai))。
* 优化对单个 `Nullable` 或低基数列的排序。 [#77789](https://github.com/ClickHouse/ClickHouse/pull/77789) ([李扬](https://github.com/taiyang-li))。
* 在缓存被被动使用时（例如用于合并），禁用 `filesystem_cache_prefer_bigger_buffer_size`。 [#77898](https://github.com/ClickHouse/ClickHouse/pull/77898) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 为 Iceberg 实现了简单的 count 优化。现在包含 `count()` 且没有任何过滤条件的查询应该会更快。修复 [#77639](https://github.com/ClickHouse/ClickHouse/issues/77639)。[#78090](https://github.com/ClickHouse/ClickHouse/pull/78090) ([alesapin](https://github.com/alesapin))。
* 为列的 `lower_bound` 和 `upper_bound` 值提供 Iceberg 数据裁剪支持。修复了 [#77638](https://github.com/ClickHouse/ClickHouse/issues/77638)。 [#78242](https://github.com/ClickHouse/ClickHouse/pull/78242) ([alesapin](https://github.com/alesapin))。
* 优化 NativeReader 的内存使用。 [#78442](https://github.com/ClickHouse/ClickHouse/pull/78442) ([Azat Khuzhin](https://github.com/azat)).
* 简单优化：如果需要使用 `CAST`，则不要将 `count(if())` 重写为 `countIf`。关闭 [#78564](https://github.com/ClickHouse/ClickHouse/issues/78564)。[#78565](https://github.com/ClickHouse/ClickHouse/pull/78565)（[李扬](https://github.com/taiyang-li)）。





## 改进 {#improvements}


* 通过在可使用 `multiRead` 的场景中避免使用单个 `get` 请求，减少对 Keeper 的请求数量，从而在副本数量增加时避免这些请求给 Keeper 带来显著负载。[#56862](https://github.com/ClickHouse/ClickHouse/pull/56862) ([Nikolay Degterinsky](https://github.com/evillique))。
* 为 MySQL 的命名集合添加对 SSL 身份验证的支持。修复 [#59111](https://github.com/ClickHouse/ClickHouse/issues/59111)。[#59452](https://github.com/ClickHouse/ClickHouse/pull/59452)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 通过在 `ConstantNode` 中存储 `ColumnPtr` 而非 `Field` 来提升新分析器基础设施的性能。相关问题 [#62245](https://github.com/ClickHouse/ClickHouse/issues/62245)。[#63198](https://github.com/ClickHouse/ClickHouse/pull/63198)（[Dmitry Novik](https://github.com/novikd)）。
* 当服务器过载时拒绝查询。该决策基于等待时间（`OSCPUWaitMicroseconds`）与繁忙时间（`OSCPUVirtualTimeMicroseconds`）的比值。当该比值介于 `min_os_cpu_wait_time_ratio_to_throw` 和 `max_os_cpu_wait_time_ratio_to_throw` 之间时（它们是查询级别设置），查询会以一定概率被丢弃。[#63206](https://github.com/ClickHouse/ClickHouse/pull/63206)（[Alexey Katsman](https://github.com/alexkats)）。
* 尽早释放数据块以降低内存占用。[#65647](https://github.com/ClickHouse/ClickHouse/pull/65647) ([lgbo](https://github.com/lgbo-ustc)).
* `processors_profile_log` 表现在具有默认配置，TTL 为 30 天。[#66139](https://github.com/ClickHouse/ClickHouse/pull/66139)（[Ilya Yatsishin](https://github.com/qoega)）。
* 允许在数据类型为 DateTime64 的列上创建 `bloom_filter` 索引。 [#66416](https://github.com/ClickHouse/ClickHouse/pull/66416) ([Yutong Xiao](https://github.com/YutSean)).
* 引入延迟分桶，用于跟踪 S3 请求的首字节读写时间和连接时间。这样我们就可以在之后利用收集的数据来计算近似分位数并调整超时时间。[#69783](https://github.com/ClickHouse/ClickHouse/pull/69783) ([Alexey Katsman](https://github.com/alexkats))。
* 传递给 `Executable` 存储的查询不再受限于单线程执行。[#70084](https://github.com/ClickHouse/ClickHouse/pull/70084) ([yawnt](https://github.com/yawnt))。
* 为 OpenTelemetry span 日志表添加了 HTTP 标头，以增强可追踪性。[#70516](https://github.com/ClickHouse/ClickHouse/pull/70516) ([jonymohajanGmail](https://github.com/jonymohajanGmail)).
* 支持按自定义时区写入 ORC 文件，而不再总是使用 `GMT` 时区。[#70615](https://github.com/ClickHouse/ClickHouse/pull/70615) ([kevinyhzou](https://github.com/KevinyhZou))。
* 如果启用了并行副本，请将表函数替换为对应的 `-Cluster` 变体。修复了 [#65024](https://github.com/ClickHouse/ClickHouse/issues/65024)。[#70659](https://github.com/ClickHouse/ClickHouse/pull/70659)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 在跨云写入备份时遵守 IO 调度设置。 [#71093](https://github.com/ClickHouse/ClickHouse/pull/71093) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* 在后台重新建立到 MySQL 和 Postgres 字典副本的连接，从而避免延迟对相应字典的请求。[#71101](https://github.com/ClickHouse/ClickHouse/pull/71101) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 在 system.asynchronous&#95;metrics 中添加指标别名。[#71164](https://github.com/ClickHouse/ClickHouse/pull/71164) ([megao](https://github.com/jetgm)).
* 可刷新的物化视图的刷新操作现在会记录在 `system.query_log` 中。[#71333](https://github.com/ClickHouse/ClickHouse/pull/71333) ([Michael Kolupaev](https://github.com/al13n321))。
* 同时评估 Parquet 布隆过滤器和最小/最大值索引。这样才能正确支持：`x = 3 or x > 5`，当 data = [1, 2, 4, 5] 时。[#71383](https://github.com/ClickHouse/ClickHouse/pull/71383)（[Arthur Passos](https://github.com/arthurpassos)）。
* 交互式指标改进。修复并行副本指标未完整显示的问题。按最近更新时间对指标排序显示，然后再按名称的字典序排序。不显示陈旧指标。[#71631](https://github.com/ClickHouse/ClickHouse/pull/71631)（[Julia Kartseva](https://github.com/jkartseva)）。
* 出于历史原因，查询 `ALTER TABLE MOVE PARTITION TO TABLE` 检查的是 `SELECT` 和 `ALTER DELETE` 权限，而不是专门的 `ALTER_MOVE_PARTITION`。此 PR 开始使用该访问类型。为了兼容性，如果授予了 `SELECT` 和 `ALTER DELETE`，则也会隐式授予该权限，但此行为将在未来版本中移除。修复 [#16403](https://github.com/ClickHouse/ClickHouse/issues/16403)。[#71632](https://github.com/ClickHouse/ClickHouse/pull/71632)（[pufit](https://github.com/pufit)）。
* 默认启用 `use_hive_partitioning`。 [#71636](https://github.com/ClickHouse/ClickHouse/pull/71636) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 在尝试物化排序键中的列时抛出异常，而不是允许其破坏排序顺序。不过这并不能解决 [#71777](https://github.com/ClickHouse/ClickHouse/issues/71777)。[#71891](https://github.com/ClickHouse/ClickHouse/pull/71891)（[Peter Nguyen](https://github.com/petern48)）。
* 在启用 Hash Join 算法时，允许使用更通用的 Join 规划算法。 [#71926](https://github.com/ClickHouse/ClickHouse/pull/71926) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* 在 `EXPLAIN QUERY TREE` 中隐藏敏感信息。[#72025](https://github.com/ClickHouse/ClickHouse/pull/72025) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 允许使用可配置磁盘来存储数据库和表的元数据文件。磁盘名称可以通过 `database_disk.disk` 配置参数进行设置。[#72027](https://github.com/ClickHouse/ClickHouse/pull/72027) ([Tuan Pham Anh](https://github.com/tuanpach))。
* 在原生读取器中支持 Parquet 整数逻辑类型。 [#72105](https://github.com/ClickHouse/ClickHouse/pull/72105) ([Arthur Passos](https://github.com/arthurpassos)).
* 默认对 JSON 输出格式进行美化。添加新的设置 `output_format_json_pretty_print` 来控制该行为，并默认启用。[#72148](https://github.com/ClickHouse/ClickHouse/pull/72148)（[Pavel Kruglov](https://github.com/Avogar)）。
* 如果默认用户需要密码，则在浏览器中以交互方式请求凭证。与之前版本中服务器返回 HTTP 403 不同，现在返回 HTTP 401。[#72198](https://github.com/ClickHouse/ClickHouse/pull/72198)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 此 PR 将访问类型 `CREATE_USER`、`ALTER_USER`、`DROP_USER`、`CREATE_ROLE`、`ALTER_ROLE`、`DROP_ROLE` 从全局改为参数化。这意味着用户现在可以更精细地授予访问管理相关的权限：[#72246](https://github.com/ClickHouse/ClickHouse/pull/72246)（[pufit](https://github.com/pufit)）。
* 允许在集群配置中设置分片名称。[#72276](https://github.com/ClickHouse/ClickHouse/pull/72276) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。
* 支持在参数不同的 JSON 类型之间执行 `CAST` 和 `ALTER` 操作。[#72303](https://github.com/ClickHouse/ClickHouse/pull/72303) ([Pavel Kruglov](https://github.com/Avogar))。
* 将 `latest_fail_error_code_name` 列添加到 `system.mutations` 中。我们需要这个列来引入一个用于检测卡住 mutation 的新指标，并用它来构建云端错误的可视化图表，并在需要时新增一个噪声更低的告警。[#72398](https://github.com/ClickHouse/ClickHouse/pull/72398) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
* 减少在附加分区时的内存分配。 [#72583](https://github.com/ClickHouse/ClickHouse/pull/72583) ([Konstantin Morozov](https://github.com/k-morozov)).
* 使 `max&#95;bytes&#95;before&#95;external&#95;sort` 的限制取决于整个查询的内存消耗（之前它表示单个排序线程中排序块的字节数限制，现在它与 `max_bytes_before_external_group_by` 含义相同——即所有线程在整个查询中可使用内存的总上限）。同时新增了一个用于控制磁盘上块大小的设置——`min_external_sort_block_bytes`。[#72598](https://github.com/ClickHouse/ClickHouse/pull/72598) ([Azat Khuzhin](https://github.com/azat))。
* 忽略 trace 采集器的内存限制。[#72606](https://github.com/ClickHouse/ClickHouse/pull/72606) ([Azat Khuzhin](https://github.com/azat)).
* 在 MergeTree 排序键和跳过索引中增加对子列的支持。[#72644](https://github.com/ClickHouse/ClickHouse/pull/72644) ([Pavel Kruglov](https://github.com/Avogar))。
* 将服务器设置项 `dictionaries_lazy_load` 和 `wait_dictionaries_load_at_startup` 添加到 `system.server_settings` 中。[#72664](https://github.com/ClickHouse/ClickHouse/pull/72664)（[Christoph Wurm](https://github.com/cwurm)）。
* 将设置项 `max_backup_bandwidth` 添加到可在 `BACKUP`/`RESTORE` 查询中指定的设置列表中。[#72665](https://github.com/ClickHouse/ClickHouse/pull/72665)（[Christoph Wurm](https://github.com/cwurm)）。
* 并行副本会利用关于副本可用性的历史信息来优化副本选择，但在连接不可用时不会更新该副本的错误计数。此 PR 使得在副本不可用时也会更新其错误计数。[#72666](https://github.com/ClickHouse/ClickHouse/pull/72666) ([zoomxi](https://github.com/zoomxi))。
* 在 `ReplicatedMergeTree` 引擎中降低已出现的复制分片的日志级别，从而减少在复制集群中生成的日志量。[#72876](https://github.com/ClickHouse/ClickHouse/pull/72876)（[mor-akamai](https://github.com/morkalfon)）。
* 许多新功能将需要对与 Iceberg 元数据相关的代码进行更好的封装，并提供更合理的代码抽象。[#72941](https://github.com/ClickHouse/ClickHouse/pull/72941)（[Daniil Ivanik](https://github.com/divanik)）。
* 为 JSON 列中的值提供等值比较支持。 [#72991](https://github.com/ClickHouse/ClickHouse/pull/72991) ([Pavel Kruglov](https://github.com/Avogar)).
* 改进带有 JSON 子列的标识符的格式化方式，避免使用不必要的反引号。 [#73085](https://github.com/ClickHouse/ClickHouse/pull/73085) ([Pavel Kruglov](https://github.com/Avogar)).
* 以 `Test` 级别记录 `PREWHERE` 条件。 [#73116](https://github.com/ClickHouse/ClickHouse/pull/73116) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 支持在隐式指定 `ENGINE` 时使用 `SETTINGS`，并允许同时使用表引擎设置和查询设置的 `SETTINGS`。 [#73120](https://github.com/ClickHouse/ClickHouse/pull/73120) ([Raúl Marín](https://github.com/Algunenano)).
* 当启用 `optimize_on_insert` 时，将数据片段写为 level 1。这样可以在针对新写入的数据片段、带有 `FINAL` 的查询中使用多种优化。[#73132](https://github.com/ClickHouse/ClickHouse/pull/73132) ([Anton Popov](https://github.com/CurtizJ))。
* 对于类似 `WHERE a<b AND b<c AND c<5` 的查询，可以推导出新的比较条件（`a<5 AND b<5`），从而提升过滤效果。[#73164](https://github.com/ClickHouse/ClickHouse/pull/73164)（[Shichao Jin](https://github.com/jsc0218)）。
* 改进在析取条件中提取公共表达式的能力。即使并非所有析取项都有公共子表达式，也允许对生成的过滤条件进行简化。延续自 [#71537](https://github.com/ClickHouse/ClickHouse/issues/71537)。[#73271](https://github.com/ClickHouse/ClickHouse/pull/73271)（[Dmitry Novik](https://github.com/novikd)）。
* 在 `S3(Azure)Queue` 存储中，现在可以为在创建时未指定 `settings` 的表补充添加 `settings`。 [#73283](https://github.com/ClickHouse/ClickHouse/pull/73283) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `clickhouse-client` 现已支持使用 Ctrl+D 结束查询。可以使用 Ctrl+D 来代替输入分号并按 Enter。此外，在单行模式下，使 Ctrl+D 的行为与按 Enter 相同。[#73293](https://github.com/ClickHouse/ClickHouse/pull/73293)（[Xiaozhe Yu](https://github.com/wudidapaopao)）。
* 引入设置 `least_greatest_legacy_null_behavior`（默认值：`false`），用于控制函数 `least` 和 `greatest` 在处理 `NULL` 参数时的行为：当其为 `true` 时，无条件返回 `NULL`；当其为 `false` 时，则忽略这些参数。 [#73344](https://github.com/ClickHouse/ClickHouse/pull/73344) ([Robert Schulze](https://github.com/rschu1ze))。
* 在清理线程 ObjectStorageQueueMetadata 中使用 Keeper 多请求。 [#73357](https://github.com/ClickHouse/ClickHouse/pull/73357) ([Antonio Andelic](https://github.com/antonio2368)).
* 新的 MongoDB 驱动程序现在是默认选项。希望继续使用旧版驱动的用户可以将服务器设置 `use_legacy_mongodb_integration` 设为 true。 [#73359](https://github.com/ClickHouse/ClickHouse/pull/73359) ([Robert Schulze](https://github.com/rschu1ze))。
* 当 ClickHouse 在 cgroup 中运行时，我们仍然会收集与系统负载、进程调度、内存等相关的全局系统异步指标。当 ClickHouse 是宿主机上唯一高资源消耗的进程时，这些指标可能会提供有用的信号。[#73369](https://github.com/ClickHouse/ClickHouse/pull/73369)（[Nikita Taranov](https://github.com/nickitat)）。
* 在 `S3Queue` 存储中，现在可以将 24.6 之前创建的旧有有序表迁移到带有 bucket 的新结构中。[#73467](https://github.com/ClickHouse/ClickHouse/pull/73467)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 添加与现有 `system.s3queue` 类似的 `system.azure_queue`。 [#73477](https://github.com/ClickHouse/ClickHouse/pull/73477) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 修复了一个回归问题：使用带有修饰符的排序规则区域设置时会抛出错误。例如，`SELECT arrayJoin(['kk 50', 'KK 01', ' KK 2', ' KK 3', 'kk 1', 'x9y99', 'x9y100']) item ORDER BY item ASC COLLATE 'tr-u-kn-true-ka-shifted` 现在可以正常工作。[#73544](https://github.com/ClickHouse/ClickHouse/pull/73544)（[Robert Schulze](https://github.com/rschu1ze)）。
* 支持 Nullable(JSON) 类型。 [#73556](https://github.com/ClickHouse/ClickHouse/pull/73556) ([Pavel Kruglov](https://github.com/Avogar)).
* 函数 `parseDateTime64`（及其变体）现在可以对 1970 年之前 / 2106 年之后的输入日期生成正确结果。示例：`SELECT parseDateTime64InJodaSyntax('2200-01-01 00:00:00.000', 'yyyy-MM-dd HH:mm:ss.SSS')`。[#73594](https://github.com/ClickHouse/ClickHouse/pull/73594)（[zhanglistar](https://github.com/zhanglistar)）。
* 解决了一些用户反馈的 `clickhouse-disks` 可用性问题。修复 [#67136](https://github.com/ClickHouse/ClickHouse/issues/67136)。[#73616](https://github.com/ClickHouse/ClickHouse/pull/73616)（[Daniil Ivanik](https://github.com/divanik)）。
* 允许在存储 S3(Azure)Queue 中修改提交设置（提交设置包括：max&#95;processed&#95;files&#95;before&#95;commit、max&#95;processed&#95;rows&#95;before&#95;commit、max&#95;processed&#95;bytes&#95;before&#95;commit、max&#95;processing&#95;time&#95;sec&#95;before&#95;commit）。[#73635](https://github.com/ClickHouse/ClickHouse/pull/73635)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 在 `S3(Azure)Queue` 存储中聚合各个数据源的进度，以便与提交上限设置进行比较。[#73641](https://github.com/ClickHouse/ClickHouse/pull/73641)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 在 `BACKUP`/`RESTORE` 查询中支持核心配置。 [#73650](https://github.com/ClickHouse/ClickHouse/pull/73650) ([Vitaly Baranov](https://github.com/vitlibar)).
* 在 Parquet 输出中支持读取 `output_format_compression_level`。 [#73651](https://github.com/ClickHouse/ClickHouse/pull/73651) ([Arthur Passos](https://github.com/arthurpassos))。
* 将读取的 Arrow fixed&#95;size&#95;list 作为 `Array` 处理，而不再将其视为不支持的类型。[#73654](https://github.com/ClickHouse/ClickHouse/pull/73654) ([Julian Meyers](https://github.com/J-Meyers))。
* 此 PR 新增了两个备份引擎：`Memory`（在当前用户会话内保留备份）和 `Null`（不会在任何地方保留备份）。[#73690](https://github.com/ClickHouse/ClickHouse/pull/73690) ([Vitaly Baranov](https://github.com/vitlibar))。
* `concurrent_threads_soft_limit_num` 和 `concurrent_threads_soft_limit_num_ratio_to_cores` 现在可以在无需重启服务器的情况下更改。[#73713](https://github.com/ClickHouse/ClickHouse/pull/73713)（[Sergei Trifonov](https://github.com/serxa)）。
* 为 `formatReadable` 系列函数新增对扩展数值类型（`Decimal`、大整数）的支持。 [#73765](https://github.com/ClickHouse/ClickHouse/pull/73765) ([Raúl Marín](https://github.com/Algunenano))。
* 在 `tuple` 列的字段匹配中，遵循列名大小写不敏感规则。关闭 [https://github.com/apache/incubator-gluten/issues/8324](https://github.com/apache/incubator-gluten/issues/8324)。[#73780](https://github.com/ClickHouse/ClickHouse/pull/73780)（[李扬](https://github.com/taiyang-li)）。
* 为 Postgres 线协议提供 TLS 支持。 [#73812](https://github.com/ClickHouse/ClickHouse/pull/73812) ([scanhex12](https://github.com/scanhex12)).
* 默认允许使用 `LowCardinality(UUID)`。这在 ClickHouse Cloud 客户中已被证明是实用的。[#73826](https://github.com/ClickHouse/ClickHouse/pull/73826) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 改进了安装过程中的提示信息。 [#73827](https://github.com/ClickHouse/ClickHouse/pull/73827) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 改进了 ClickHouse Cloud 的密码重置消息。[#73831](https://github.com/ClickHouse/ClickHouse/pull/73831) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 改进在 File 表无法向文件追加数据时的错误消息。[#73832](https://github.com/ClickHouse/ClickHouse/pull/73832)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 当用户在终端中不小心请求以二进制格式（例如 `Native`、`Parquet`、`Avro`）输出时，会弹出确认提示。关闭了 [#59524](https://github.com/ClickHouse/ClickHouse/issues/59524)。[#73833](https://github.com/ClickHouse/ClickHouse/pull/73833)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `BFloat16` 数据类型已可用于生产环境。[#73840](https://github.com/ClickHouse/ClickHouse/pull/73840)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在终端中使用 Pretty 和 Vertical 格式时高亮显示行尾空格，以提升可读性。该行为由 `output_format_pretty_highlight_trailing_spaces` 设置控制。最初由 [Braden Burns](https://github.com/bradenburns) 在 [#72996](https://github.com/ClickHouse/ClickHouse/issues/72996) 中实现。关闭了 [#71590](https://github.com/ClickHouse/ClickHouse/issues/71590)。[#73847](https://github.com/ClickHouse/ClickHouse/pull/73847)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 当 `stdin` 从文件重定向输入时，`clickhouse-client` 和 `clickhouse-local` 会自动检测压缩格式。此更改解决了 [#70865](https://github.com/ClickHouse/ClickHouse/issues/70865)。[#73848](https://github.com/ClickHouse/ClickHouse/pull/73848)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 默认情况下会在 `pretty` 格式中截断过长的列名。可以通过 `output_format_pretty_max_column_name_width_cut_to` 和 `output_format_pretty_max_column_name_width_min_chars_to_cut` 这两个设置进行控制。该改动是对 [tanmaydatta](https://github.com/tanmaydatta) 在 [#66502](https://github.com/ClickHouse/ClickHouse/issues/66502) 中工作的延续，并关闭了问题 [#65968](https://github.com/ClickHouse/ClickHouse/issues/65968)。[#73851](https://github.com/ClickHouse/ClickHouse/pull/73851)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 让 `Pretty` 格式显示得更美观：如果距离上一个数据块输出的时间不长，则将多个块合并显示。可通过新设置 `output_format_pretty_squash_consecutive_ms`（默认 50 ms）和 `output_format_pretty_squash_max_wait_ms`（默认 1000 ms）进行控制。是对 [#49537](https://github.com/ClickHouse/ClickHouse/issues/49537) 的延续。此变更关闭了 [#49153](https://github.com/ClickHouse/ClickHouse/issues/49153)。[#73852](https://github.com/ClickHouse/ClickHouse/pull/73852)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复 SQLite 的类型映射（将整数类型映射为 `int64`，将浮点数类型映射为 `float64`）。 [#73853](https://github.com/ClickHouse/ClickHouse/pull/73853) ([Joanna Hulboj](https://github.com/jh0x))。
* 新增一个用于统计当前正在合并的源数据片段数量的指标。修复了 [#70809](https://github.com/ClickHouse/ClickHouse/issues/70809)。[#73868](https://github.com/ClickHouse/ClickHouse/pull/73868)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 当输出到终端时，在 `Vertical` 格式中对列进行高亮显示。可以通过 `output_format_pretty_color` 设置禁用此行为。[#73898](https://github.com/ClickHouse/ClickHouse/pull/73898) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 将 MySQL 兼容性增强到这样的程度：现在 `mysqlsh`（Oracle 提供的功能丰富的 MySQL 命令行工具）可以连接到 ClickHouse。这是为了方便测试。[#73912](https://github.com/ClickHouse/ClickHouse/pull/73912) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 如果输出记录的数量大于 N = `output_format_pretty_max_rows`，则我们不会只显示前 N 行，而是会从中间截断输出表，显示前 N/2 行和最后 N/2 行。此更改是对 [#64200](https://github.com/ClickHouse/ClickHouse/issues/64200) 的延续，并关闭了 [#59502](https://github.com/ClickHouse/ClickHouse/issues/59502)。[#73929](https://github.com/ClickHouse/ClickHouse/pull/73929)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 函数 `isIPv4String` 在正确的 IPv4 地址后面紧跟一个零字节时会返回 true，而在这种情况下本应返回 false。为 [#65387](https://github.com/ClickHouse/ClickHouse/issues/65387) 的后续修复。[#73946](https://github.com/ClickHouse/ClickHouse/pull/73946)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 使 MySQL 线协议中的错误码与 MySQL 保持兼容。[#56831](https://github.com/ClickHouse/ClickHouse/issues/56831) 的后续工作。修复 [#50957](https://github.com/ClickHouse/ClickHouse/issues/50957)。[#73948](https://github.com/ClickHouse/ClickHouse/pull/73948)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 添加设置 `validate_enum_literals_in_opearators`，用于在 `IN`、`NOT IN` 等运算符中根据枚举类型校验枚举字面量，如果字面量不是有效的枚举值则抛出异常。[#73985](https://github.com/ClickHouse/ClickHouse/pull/73985) ([Vladimir Cherkasov](https://github.com/vdimir))。
* 在 `S3(Azure)Queue` 存储中，将由提交设置定义的单个批次中的所有文件，在一次 keeper 事务中统一提交。[#73991](https://github.com/ClickHouse/ClickHouse/pull/73991) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 为可执行 UDF 和字典禁用表头检测（否则可能导致 Function &#39;X&#39;: wrong result, expected Y row(s), actual Y-1）。 [#73992](https://github.com/ClickHouse/ClickHouse/pull/73992) ([Azat Khuzhin](https://github.com/azat)).
* 为 `EXPLAIN PLAN` 添加 `distributed` 选项。现在，`EXPLAIN distributed=1 ...` 会将远程执行计划附加到 `ReadFromParallelRemote*` 步骤。[#73994](https://github.com/ClickHouse/ClickHouse/pull/73994) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
* 为具有 `Dynamic` 参数的 `not`/`xor` 使用正确的返回类型。 [#74013](https://github.com/ClickHouse/ClickHouse/pull/74013) ([Pavel Kruglov](https://github.com/Avogar)).
* 允许在建表后修改 `add_implicit_sign_column_constraint_for_collapsing_engine`。 [#74014](https://github.com/ClickHouse/ClickHouse/pull/74014) ([Christoph Wurm](https://github.com/cwurm)).
* 在物化视图的 `SELECT` 查询中增加对子列的支持。 [#74030](https://github.com/ClickHouse/ClickHouse/pull/74030) ([Pavel Kruglov](https://github.com/Avogar)).
* Pretty 格式可以在表格单元格内渲染多行字段，从而提升可读性。该功能默认启用，并可通过设置 `output_format_pretty_multiline_fields` 进行控制。这是对 [Volodyachan](https://github.com/Volodyachan) 在 [#64094](https://github.com/ClickHouse/ClickHouse/issues/64094) 中工作的延续。此更改关闭了 [#56912](https://github.com/ClickHouse/ClickHouse/issues/56912)。[#74032](https://github.com/ClickHouse/ClickHouse/pull/74032)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在查询计划层面为 `MergingAggregated` 步骤提供 `predicate-push-down` 优化支持，从而在使用新分析器时提升部分查询的性能。[#74073](https://github.com/ClickHouse/ClickHouse/pull/74073)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 现在可以通过三种简单方式在 `clickhouse-client` 中设置自定义提示符：1. 通过命令行参数 `--prompt`；2. 在配置文件中通过设置 `<prompt>[...]</prompt>`；3. 依然在配置文件中，通过逐连接设置 `<connections_credentials><prompt>[...]</prompt></connection_credentials>`。 [#74168](https://github.com/ClickHouse/ClickHouse/pull/74168) ([Christoph Wurm](https://github.com/cwurm))。
* 将 Prometheus 远程写入响应的成功状态码从 200/OK 修改为 204/NoContent。[#74170](https://github.com/ClickHouse/ClickHouse/pull/74170) ([Michael Dempsey](https://github.com/bluestealth))。
* 在浏览器中将 X-ClickHouse HTTP 头信息暴露给 JavaScript，从而让编写应用程序更加方便。[#74180](https://github.com/ClickHouse/ClickHouse/pull/74180) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `JSONEachRowWithProgress` 格式现在会包含带有元数据的事件，以及 totals 和 extremes。它还包括 `rows_before_limit_at_least` 和 `rows_before_aggregation`。如果在部分结果之后出现异常，该格式会正确输出异常。进度信息现在包含已耗费的纳秒数。结束时会发出最后一个进度事件。查询运行期间的进度输出频率不会高于 `interactive_delay` 设置的值。[#74181](https://github.com/ClickHouse/ClickHouse/pull/74181)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 沙漏将在 Play UI 中平滑旋转。[#74182](https://github.com/ClickHouse/ClickHouse/pull/74182) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 即使 HTTP 响应已被压缩，也要在数据包一到达时立即发送。这样浏览器就能接收进度数据包和已压缩的数据。[#74201](https://github.com/ClickHouse/ClickHouse/pull/74201) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 新增支持在无需重启服务器的情况下，动态重新加载 `max_remote_read_network_bandwidth_for_serve` 和 `max_remote_write_network_bandwidth_for_server`。 [#74206](https://github.com/ClickHouse/ClickHouse/pull/74206) ([Kai Zhu](https://github.com/nauu)).
* 在 ClickHouse Client 中，通过连接端口 9440 自动检测是否使用安全连接。[#74212](https://github.com/ClickHouse/ClickHouse/pull/74212)（[Christoph Wurm](https://github.com/cwurm)）。
* 为 `http_handlers` 实现仅通过用户名进行用户身份验证（此前还要求用户提供密码）。 [#74221](https://github.com/ClickHouse/ClickHouse/pull/74221) ([Azat Khuzhin](https://github.com/azat)).
* 对替代查询语言 PRQL 和 KQL 的支持被标记为实验性功能。要使用它们，请将 `allow_experimental_prql_dialect = 1` 和 `allow_experimental_kusto_dialect = 1` 写入设置。 [#74224](https://github.com/ClickHouse/ClickHouse/pull/74224) ([Robert Schulze](https://github.com/rschu1ze))。
* 在更多聚合函数中支持返回默认的 `Enum` 类型。[#74272](https://github.com/ClickHouse/ClickHouse/pull/74272)（[Raúl Marín](https://github.com/Algunenano)）。
* 在 `OPTIMIZE TABLE` 中，现在可以使用关键字 `FORCE` 来替代现有的关键字 `FINAL`。[#74342](https://github.com/ClickHouse/ClickHouse/pull/74342) ([Robert Schulze](https://github.com/rschu1ze))。
* 新增了一个 MergeTree 设置项 `materialize_skip_indexes_on_merge`，用于在合并过程中禁止创建 skip 索引。这样用户可以通过 `ALTER TABLE [..] MATERIALIZE INDEX [...]` 明确控制何时创建 skip 索引。如果 skip 索引的构建成本较高（例如向量相似度索引），这将非常有用。[#74401](https://github.com/ClickHouse/ClickHouse/pull/74401) ([Robert Schulze](https://github.com/rschu1ze))。
* 在 `DEFAULT` 和 `MATERIALIZED` 表达式中支持子列。 [#74403](https://github.com/ClickHouse/ClickHouse/pull/74403) ([Pavel Kruglov](https://github.com/Avogar)).
* 优化 Storage(S3/Azure)Queue 中的 keeper 请求。 [#74410](https://github.com/ClickHouse/ClickHouse/pull/74410) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 添加 `IsServerShuttingDown` 指标，用于在服务器关闭耗时过长时触发告警。[#74429](https://github.com/ClickHouse/ClickHouse/pull/74429) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
* 在 `EXPLAIN` 输出中添加了 Iceberg 表名。 [#74485](https://github.com/ClickHouse/ClickHouse/pull/74485) ([alekseev-maksim](https://github.com/alekseev-maksim)).
* 默认最多使用 `1000` 个并行副本。[#74504](https://github.com/ClickHouse/ClickHouse/pull/74504) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* 在旧版分析器中使用 RECURSIVE CTE 时提供更明确的错误信息。[#74523](https://github.com/ClickHouse/ClickHouse/pull/74523)（[Raúl Marín](https://github.com/Algunenano)）。
* 优化 Storage(S3/Azure)Queue 中的 keeper 请求。[#74538](https://github.com/ClickHouse/ClickHouse/pull/74538) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 在从 S3 磁盘读取数据时改进 HTTP 会话复用（[#72401](https://github.com/ClickHouse/ClickHouse/issues/72401)）。[#74548](https://github.com/ClickHouse/ClickHouse/pull/74548)（[Julian Maicher](https://github.com/jmaicher)）。
* 在 `system.errors` 中显示详细错误消息。[#74574](https://github.com/ClickHouse/ClickHouse/pull/74574) ([Vitaly Baranov](https://github.com/vitlibar)).
* 为所有类型的复制任务启用了退避逻辑，这有助于降低 CPU 使用率、内存占用和日志文件大小。新增了 `max_postpone_time_for_failed_replicated_fetches_ms`、`max_postpone_time_for_failed_replicated_merges_ms` 和 `max_postpone_time_for_failed_replicated_tasks_ms` 这几个设置项，其作用类似于 `max_postpone_time_for_failed_mutations_ms`。 [#74576](https://github.com/ClickHouse/ClickHouse/pull/74576) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* 对 `parallel_hash` JOIN 算法中的 `max_joined_block_size_rows` 设置进行了更精确的处理，有助于避免相较于 `hash` 算法的额外内存消耗。 [#74630](https://github.com/ClickHouse/ClickHouse/pull/74630) ([Nikita Taranov](https://github.com/nickitat)).
* 新增对 `dfs.client.use.datanode.hostname` libhdfs3 配置项的支持。[#74635](https://github.com/ClickHouse/ClickHouse/pull/74635) ([Mikhail Tiukavkin](https://github.com/freshertm))。
* 修复问题：编解码器 &#39;snappy&#39; 不支持设置压缩级别。 [#74659](https://github.com/ClickHouse/ClickHouse/pull/74659) ([Arthur Passos](https://github.com/arthurpassos))。
* 允许在客户端与 clickhouse-keeper 通信时使用密码。如果你已经为服务器和客户端正确配置了 SSL，这个功能的用途并不大，但在某些场景下仍然可能有用。密码长度不能超过 16 个字符。它与 Keeper Auth 模型无关。[#74673](https://github.com/ClickHouse/ClickHouse/pull/74673) ([alesapin](https://github.com/alesapin)).
* 允许在创建备份时使用 blob 路径来计算校验和。 [#74729](https://github.com/ClickHouse/ClickHouse/pull/74729) ([Vitaly Baranov](https://github.com/vitlibar))。
* 当 `JOIN` 键在两侧都是主键前缀时，对 `JOIN` 使用动态分片。可通过 `query_plan_join_shard_by_pk_ranges` 设置启用此优化（默认禁用）。[#74733](https://github.com/ClickHouse/ClickHouse/pull/74733)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 为配置重载器添加错误代码。 [#74746](https://github.com/ClickHouse/ClickHouse/pull/74746) ([Garrett Thomas](https://github.com/garrettthomaskth)).
* 在 MySQL 和 PostgreSQL 表函数和引擎中新增对 IPv6 地址的支持。 [#74796](https://github.com/ClickHouse/ClickHouse/pull/74796) ([Mikhail Koviazin](https://github.com/mkmkme))。
* Gorilla 编解码器的参数现在将始终保存在 .sql 文件中的表元数据里。此项变更解决了：[#70072](https://github.com/ClickHouse/ClickHouse/issues/70072)。[#74814](https://github.com/ClickHouse/ClickHouse/pull/74814)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 为 `divideDecimal` 实现短路优化。修复 [#74280](https://github.com/ClickHouse/ClickHouse/issues/74280)。[#74843](https://github.com/ClickHouse/ClickHouse/pull/74843)（[Kevin Mingtarja](https://github.com/kevinmingtarja)）。
* 提升 Keeper 中大规模多请求操作的性能。 [#74849](https://github.com/ClickHouse/ClickHouse/pull/74849) ([Antonio Andelic](https://github.com/antonio2368)).
* 现在可以在启动脚本中配置用户。[#74894](https://github.com/ClickHouse/ClickHouse/pull/74894) ([pufit](https://github.com/pufit))。
* 在 `ALTER TABLE FETCH PARTITION` 中并行拉取分片（线程池大小由 `max_fetch_partition_thread_pool_size` 控制）。 [#74978](https://github.com/ClickHouse/ClickHouse/pull/74978) ([Azat Khuzhin](https://github.com/azat)).
* 在 `system.query_cache` 中新增了查询 ID 列（issue [#68205](https://github.com/ClickHouse/ClickHouse/issues/68205)）。 [#74982](https://github.com/ClickHouse/ClickHouse/pull/74982)（[NamNguyenHoai](https://github.com/NamHoaiNguyen)）。
* 重新启用了 SSH 协议。修复了一些严重漏洞，现已无法使用自定义分页程序（pager）或指定 `server-logs-file`。默认情况下禁用了通过环境变量传递客户端选项（仍可通过 config.xml 中的 `ssh-server.enable_client_options_passing` 开启）。增加了对 progress 表、查询取消、补全、profile events 进度、stdin 以及 `send_logs_level` 选项的支持。修复了：[#74340](https://github.com/ClickHouse/ClickHouse/issues/74340)。[#74989](https://github.com/ClickHouse/ClickHouse/pull/74989)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 修复在查询解释期间出现的异常的格式化方式，使其能够使用自定义格式。在之前的版本中，异常始终使用默认格式进行格式化，而不是查询中指定的格式。此变更关闭了 [#55422](https://github.com/ClickHouse/ClickHouse/issues/55422)。[#74994](https://github.com/ClickHouse/ClickHouse/pull/74994)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 实现了解析增强功能（序列 ID 解析：新增对清单文件中序列标识符的解析功能；以及 Avro 元数据解析：重新设计 Avro 元数据解析器，以便未来可以轻松扩展）。 [#75010](https://github.com/ClickHouse/ClickHouse/pull/75010) ([Daniil Ivanik](https://github.com/divanik)).
* 现在可以使用 `KILL QUERY` 或超时（`max_execution_time`）来取消 `ALTER TABLE ... FREEZE ...` 查询。[#75016](https://github.com/ClickHouse/ClickHouse/pull/75016) ([Kirill](https://github.com/kirillgarbar)).
* 为 `groupUniqArrayArrayMap` 作为 `SimpleAggregateFunction` 的用法添加支持。 [#75034](https://github.com/ClickHouse/ClickHouse/pull/75034) ([Miel Donkers](https://github.com/mdonkers))。
* 在 PostgreSQL 线协议中支持预备语句。 [#75035](https://github.com/ClickHouse/ClickHouse/pull/75035) ([scanhex12](https://github.com/scanhex12)).
* 在数据库引擎 `Iceberg` 中隐藏目录凭证设置。修复了 [#74559](https://github.com/ClickHouse/ClickHouse/issues/74559)。[#75080](https://github.com/ClickHouse/ClickHouse/pull/75080)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 在 BuzzHouse 中补充实现了若干此前缺失的功能：`ILIKE` 和 `REGEXP` 运算符、`<=>` 和 `IS NOT DISTINCT FROM`。[#75168](https://github.com/ClickHouse/ClickHouse/pull/75168)（[Pedro Ferreira](https://github.com/PedroTadim)）。
* 设置 `min_chunk_bytes_for_parallel_parsing` 现在不再允许为零。此更改修复了：[#71110](https://github.com/ClickHouse/ClickHouse/issues/71110)。[#75239](https://github.com/ClickHouse/ClickHouse/pull/75239)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* `intExp2` / `intExp10`：为先前未定义的行为进行了规范：对于过小的参数返回 0，对于过大的参数返回 `18446744073709551615`，若为 `nan` 则抛出异常。[#75312](https://github.com/ClickHouse/ClickHouse/pull/75312)（[Vitaly Baranov](https://github.com/vitlibar)）。
* 在 `DatabaseIceberg` 的目录配置中原生支持 `s3.endpoint`。修复 [#74558](https://github.com/ClickHouse/ClickHouse/issues/74558)。[#75375](https://github.com/ClickHouse/ClickHouse/pull/75375)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 当执行 `SYSTEM DROP REPLICA` 的用户权限不足时，不再静默失败。[#75377](https://github.com/ClickHouse/ClickHouse/pull/75377) ([Bharat Nallan](https://github.com/bharatnc)).
* 添加一个 `ProfileEvent`，用于统计任意系统日志刷新失败的次数。[#75466](https://github.com/ClickHouse/ClickHouse/pull/75466) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 为解密和解压缩操作添加检查和日志记录。 [#75471](https://github.com/ClickHouse/ClickHouse/pull/75471) ([Vitaly Baranov](https://github.com/vitlibar)).
* 在 `parseTimeDelta` 函数中新增了对微符号（U+00B5）的支持。现在微符号（U+00B5）和希腊字母 μ（U+03BC）都可以被识别为微秒的有效表示方式，使 ClickHouse 的行为与 Go 的实现保持一致（[参见 time.go](https://github.com/golang/go/blob/ad7b46ee4ac1cee5095d64b01e8cf7fcda8bee5e/src/time/time.go#L983C19-L983C20) 和 [time/format.go](https://github.com/golang/go/blob/ad7b46ee4ac1cee5095d64b01e8cf7fcda8bee5e/src/time/format.go#L1608-L1609)）。[#75472](https://github.com/ClickHouse/ClickHouse/pull/75472)（[Vitaly Orlov](https://github.com/orloffv)）。
* 将服务器端设置（`send_settings_to_client`）替换为客户端设置（`apply_settings_from_server`），用于控制客户端代码（例如解析 INSERT 数据和格式化查询输出）是否应当使用服务器 `users.xml` 及其用户配置文件中的设置。否则将只会使用来自客户端命令行、会话以及查询本身的设置。注意，这仅适用于原生客户端（不适用于如 HTTP 之类的接口），并且不适用于大部分查询处理阶段（这些是在服务器端执行的）。[#75478](https://github.com/ClickHouse/ClickHouse/pull/75478)（[Michael Kolupaev](https://github.com/al13n321)）。
* Keeper 改进：在提交到内存存储时禁用摘要计算，以提升性能。可以通过 `keeper_server.digest_enabled_on_commit` 配置项启用该功能。在预处理请求时仍会计算摘要。[#75490](https://github.com/ClickHouse/ClickHouse/pull/75490) ([Antonio Andelic](https://github.com/antonio2368))。
* 在可能的情况下，将过滤表达式从 JOIN ON 子句中下推。 [#75536](https://github.com/ClickHouse/ClickHouse/pull/75536) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 在语法错误时提供更清晰的错误信息。此前，如果查询过大且超出长度限制的标记是一个非常长的字符串字面量，用于说明错误原因的消息会被夹在该超长标记的两个示例中间而丢失。修复了在错误信息中包含 `UTF-8` 的查询被错误截断的问题。修复了查询片段被过度加引号的问题。修复了 [#75473](https://github.com/ClickHouse/ClickHouse/issues/75473)。 [#75561](https://github.com/ClickHouse/ClickHouse/pull/75561)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在存储 `S3(Azure)Queue` 中添加分析事件（profile events）。[#75618](https://github.com/ClickHouse/ClickHouse/pull/75618) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 为兼容性起见，禁用从服务器向客户端发送设置（`send_settings_to_client=false`）（该功能稍后将作为客户端设置重新实现，以提高可用性）。 [#75648](https://github.com/ClickHouse/ClickHouse/pull/75648) ([Michael Kolupaev](https://github.com/al13n321)).
* 添加配置项 `memory_worker_correct_memory_tracker`，以启用基于后台线程周期性读取的不同来源信息来校正内部内存追踪器。 [#75714](https://github.com/ClickHouse/ClickHouse/pull/75714) ([Antonio Andelic](https://github.com/antonio2368))。
* 在 PrometheusRemoteReadProtocol 中使用 Analyzer。 [#75729](https://github.com/ClickHouse/ClickHouse/pull/75729) ([Dmitry Novik](https://github.com/novikd)).
* 我们已经支持 `gauge`/`counter` 指标类型。不过，这些类型对于某些指标（例如 keeper 请求的响应时间）来说并不足够，因此还需要支持 `histogram` 指标类型。该接口与 Prometheus 客户端非常相似，你只需调用 `observe(value)`，即可在与该值对应的桶中递增计数器。`histogram` 指标通过 `system.histogram_metrics` 暴露。[#75736](https://github.com/ClickHouse/ClickHouse/pull/75736)（[Miсhael Stetsyuk](https://github.com/mstetsyuk)）。
* 将列 `normalized_query_hash` 添加到 `system.processes` 中。注意：虽然可以使用 `normalizedQueryHash` 函数在运行时轻松计算该值，但这是为后续更改做准备所必需的。[#75756](https://github.com/ClickHouse/ClickHouse/pull/75756) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 即使存在基于已被删除数据库创建的 `Merge` 表，查询 `system.tables` 也不会抛出异常。移除 `Hive` 表上的 `getTotalRows` 方法，因为我们不允许其执行复杂操作。[#75772](https://github.com/ClickHouse/ClickHouse/pull/75772) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* Web UI 现在提供交互式数据库导航功能。[#75777](https://github.com/ClickHouse/ClickHouse/pull/75777) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 允许在 `storage policy` 中组合只读和读写磁盘（可以是多个 `volume`，也可以是多块磁盘）。这样可以从整个 `volume` 读取数据，而插入操作将优先写入可写磁盘（即 `Copy-on-Write storage policy`）。 [#75862](https://github.com/ClickHouse/ClickHouse/pull/75862) ([Azat Khuzhin](https://github.com/azat)).
* 从 `system.opentelemetry_span_log` 的默认 `ORDER BY` 子句中移除 `trace_id`。 [#75907](https://github.com/ClickHouse/ClickHouse/pull/75907) ([Azat Khuzhin](https://github.com/azat)).
* 现在可以将加密（XML 属性 `encrypted_by`）应用于任意配置文件（config.xml、users.xml、嵌套配置文件）。此前它仅适用于顶层 config.xml 文件。[#75911](https://github.com/ClickHouse/ClickHouse/pull/75911)（[Mikhail Gorshkov](https://github.com/mgorshkov)）。
* 以微秒精度存储备份的 start&#95;time/end&#95;time。[#75929](https://github.com/ClickHouse/ClickHouse/pull/75929)（[Aleksandr Musorin](https://github.com/AVMusorin)）。
* 新增 `MemoryTrackingUncorrected` 指标，用于显示未经 RSS 校正的内部全局内存跟踪器的值。 [#75935](https://github.com/ClickHouse/ClickHouse/pull/75935) ([Antonio Andelic](https://github.com/antonio2368)).
* 在 MergeTree 中按需延迟计算列和索引的大小。 [#75938](https://github.com/ClickHouse/ClickHouse/pull/75938) ([Pavel Kruglov](https://github.com/Avogar)).
* 当输出列只依赖左表时，可以将 `JOIN` 转换为 `IN` 子查询，但需要先增加一个去重步骤；在该步骤补充之前，此优化默认处于禁用状态。 [#75942](https://github.com/ClickHouse/ClickHouse/pull/75942) ([Shichao Jin](https://github.com/jsc0218)).
* 新增了服务器设置 `throw_on_unknown_workload`，用于控制在查询中将 `workload` 设置为未知值时的行为：可以允许无限制访问（默认），或抛出 `RESOURCE_ACCESS_DENIED` 错误。可用于强制所有查询使用 workload 调度。 [#75999](https://github.com/ClickHouse/ClickHouse/pull/75999) ([Sergei Trifonov](https://github.com/serxa)).
* 使新的实验性 Kafka 表引擎完全遵循 Keeper 功能标志。 [#76004](https://github.com/ClickHouse/ClickHouse/pull/76004) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* 如果没有必要，在 `ARRAY JOIN` 中不要将子列重写为 `getSubcolumn`。 [#76018](https://github.com/ClickHouse/ClickHouse/pull/76018) ([Pavel Kruglov](https://github.com/Avogar))。
* 在加载表时对协调错误进行重试。[#76020](https://github.com/ClickHouse/ClickHouse/pull/76020) ([Alexander Tokmakov](https://github.com/tavplubix)).
* 改进 `system.warnings` 表，并新增一些可动态添加、更新或删除的警告消息。[#76029](https://github.com/ClickHouse/ClickHouse/pull/76029) ([Bharat Nallan](https://github.com/bharatnc))。
* 在 `SYSTEM FLUSH LOGS` 中支持单独刷新各类日志。 [#76132](https://github.com/ClickHouse/ClickHouse/pull/76132) ([Raúl Marín](https://github.com/Algunenano)).
* 改进了 `/binary` 服务器页面。使用 Hilbert 曲线替代 Morton 曲线。在正方形中显示 512 MB 范围的地址，使正方形填充得更充分（在之前的版本中，地址只填充了正方形的一半）。为更接近库名而非函数名的地址着色。允许在区域外多滚动一点。[#76192](https://github.com/ClickHouse/ClickHouse/pull/76192)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 此 PR 禁止运行查询 `ALTER USER user1 ADD PROFILES a, DROP ALL PROFILES`，因为所有 `DROP` 操作必须在顺序中排在最前面。[#76242](https://github.com/ClickHouse/ClickHouse/pull/76242) ([pufit](https://github.com/pufit))。
* 针对 `SYNC REPLICA` 的多项增强（更清晰的错误信息、更完善的测试、合理性检查）。 [#76307](https://github.com/ClickHouse/ClickHouse/pull/76307) ([Azat Khuzhin](https://github.com/azat)).
* 在出现 TOO&#95;MANY&#95;SIMULTANEOUS&#95;QUERIES 错误时重试 ON CLUSTER 查询。[#76352](https://github.com/ClickHouse/ClickHouse/pull/76352) ([Patrick Galbraith](https://github.com/CaptTofu))。
* 将 `output_format_pretty_max_rows` 的默认值从 10000 调整为 1000。我认为这在易用性方面更好。[#76407](https://github.com/ClickHouse/ClickHouse/pull/76407)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在只读 MergeTree 表中增加对 refresh 操作的支持。 [#76467](https://github.com/ClickHouse/ClickHouse/pull/76467) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 在执行备份时，当对 S3 的分段拷贝因 `Access Denied` 失败时，使用正确的回退机制。当在使用不同凭证的 bucket 之间进行备份时，分段拷贝可能会产生 `Access Denied` 错误。[#76515](https://github.com/ClickHouse/ClickHouse/pull/76515) ([Antonio Andelic](https://github.com/antonio2368)).
* 加快 ClickHouse 服务器关闭速度（去除 2.5 秒延迟）。[#76550](https://github.com/ClickHouse/ClickHouse/pull/76550) ([Azat Khuzhin](https://github.com/azat)).
* 在 system.errors 中添加 query&#95;id。相关工单 [#75815](https://github.com/ClickHouse/ClickHouse/issues/75815)。[#76581](https://github.com/ClickHouse/ClickHouse/pull/76581)（[Vladimir Baikov](https://github.com/bkvvldmr)）。
* 将 `librdkafka` 升级到 2.8.0 版本，并改进了 Kafka 表的关闭流程，从而减少了在删除表和重启服务器时的延迟。`engine=Kafka` 在表被删除时不再显式退出 consumer group。取而代之的是，consumer 会继续留在 group 中，直到因一段时间无活动超过 `session_timeout_ms`（默认：45 秒）后被自动移除。[#76621](https://github.com/ClickHouse/ClickHouse/pull/76621)（[filimonov](https://github.com/filimonov)）。
* 修复 `s3` 请求设置的验证逻辑。 [#76658](https://github.com/ClickHouse/ClickHouse/pull/76658) ([Vitaly Baranov](https://github.com/vitlibar)).
* 避免在 `readbufferfroms3` 和其他远程读取缓冲区中进行多余的内存分配，将其内存占用减少一半。 [#76692](https://github.com/ClickHouse/ClickHouse/pull/76692) ([Sema Checherinda](https://github.com/CheSema)).
* 从视图中读取时支持 `JSON` 类型及其子列。 [#76903](https://github.com/ClickHouse/ClickHouse/pull/76903) ([Pavel Kruglov](https://github.com/Avogar)).
* 添加对将 UInt128 转换为 IPv6 的支持。这使得可以对 IPv6 执行 `bitAnd` 运算和算术运算，并将结果转换回 IPv6。修复了 [#76752](https://github.com/ClickHouse/ClickHouse/issues/76752)。这也允许将对 IPv6 执行 `bitAnd` 运算的结果转换回 IPv6。参见：[https://github.com/ClickHouse/ClickHouse/pull/57707](https://github.com/ClickHouse/ClickHouse/pull/57707)。[#76928](https://github.com/ClickHouse/ClickHouse/pull/76928)（[Muzammil Abdul Rehman](https://github.com/muzammilar)）。
* 像 `server_settings` 或 `settings` 这样的系统表都有一个 `default` 值列，这非常方便。只有 `merge_tree_settings` 和 `replicated_merge_tree_settings` 没有启用该列。[#76942](https://github.com/ClickHouse/ClickHouse/pull/76942)（[Diego Nieto](https://github.com/lesandie)）。
* 默认情况下，不再在 `Variant` 类型的文本格式中解析特殊的 Bool 值。可以通过设置 `allow_special_bool_values_inside_variant` 来启用该行为。 [#76974](https://github.com/ClickHouse/ClickHouse/pull/76974) ([Pavel Kruglov](https://github.com/Avogar))。
* 支持在会话级和服务器级配置低优先级查询中每个任务的等待时间。[#77013](https://github.com/ClickHouse/ClickHouse/pull/77013) ([VicoWu](https://github.com/VicoWu)).
* 新增了 `ProfileEvents::QueryPreempted`，其逻辑与 `CurrentMetrics::QueryPreempted` 相同。[#77015](https://github.com/ClickHouse/ClickHouse/pull/77015) ([VicoWu](https://github.com/VicoWu))。
* 此前，`database replicated` 可能会在日志中输出查询中指定的凭据。此问题已修复。相关 issue 已关闭：[#77123](https://github.com/ClickHouse/ClickHouse/issues/77123)。[#77133](https://github.com/ClickHouse/ClickHouse/pull/77133)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 将 zstd 从 1.5.5 升级到 1.5.7，带来了显著的[性能提升](https://github.com/facebook/zstd/releases/tag/v1.5.7)。 [#77137](https://github.com/ClickHouse/ClickHouse/pull/77137)（[Pradeep Chhetri](https://github.com/chhetripradeep)）。
* 允许在 plain&#95;rewritable 磁盘上使用 ALTER TABLE DROP PARTITION。 [#77138](https://github.com/ClickHouse/ClickHouse/pull/77138) ([Julia Kartseva](https://github.com/jkartseva)).
* 在零拷贝复制的情况下，在执行合并/变更之前，新增最多随机休眠 500ms 的功能，其持续时间与分片大小无关。 [#77165](https://github.com/ClickHouse/ClickHouse/pull/77165) ([Alexey Katsman](https://github.com/alexkats)).
* 在 `TRUNCATE` 与 `INTO OUTFILE` 搭配使用时支持原子重命名。修复了 [#70323](https://github.com/ClickHouse/ClickHouse/issues/70323)。[#77181](https://github.com/ClickHouse/ClickHouse/pull/77181)（[Onkar Deshpande](https://github.com/onkar)）。
* 对 PostgreSQL 的 CHARACTER、CHAR 和 BPCHAR 类型使用 FixedString。 [#77304](https://github.com/ClickHouse/ClickHouse/pull/77304) ([Pablo Marcos](https://github.com/pamarcos))。
* 允许通过存储/表函数设置 `iceberg_metadata_file_path`，显式指定要读取的 Iceberg 元数据文件。修复了 [#47412](https://github.com/ClickHouse/ClickHouse/issues/47412)。[#77318](https://github.com/ClickHouse/ClickHouse/pull/77318)（[alesapin](https://github.com/alesapin)）。
* 支持数据库使用远程磁盘来存储元数据文件。[#77365](https://github.com/ClickHouse/ClickHouse/pull/77365) ([Tuan Pham Anh](https://github.com/tuanpach))。
* 实现了对 JSON 数据类型值的比较功能。现在可以像比较 Map 一样比较 JSON 对象。[#77397](https://github.com/ClickHouse/ClickHouse/pull/77397) ([Pavel Kruglov](https://github.com/Avogar))。
* 更改已回退。 [#77399](https://github.com/ClickHouse/ClickHouse/pull/77399) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 备份/恢复设置 `allow_s3_native_copy` 现在支持三个可能的取值：- `False` - 不使用 S3 原生复制；- `True`（旧默认值）- ClickHouse 会先尝试使用 S3 原生复制，如果失败则回退到读+写方式；- `'auto'`（新默认值）- ClickHouse 会先比较源端和目标端的访问凭证。如果相同，ClickHouse 会尝试使用 S3 原生复制，如失败则回退到读+写方式；如果不同，ClickHouse 将直接采用读+写方式。[#77401](https://github.com/ClickHouse/ClickHouse/pull/77401) ([Vitaly Baranov](https://github.com/vitlibar))。
* 为 plain&#95;rewritable 磁盘增加对 ALTER TABLE ... ATTACH|DETACH|MOVE|REPLACE PARTITION 的支持。[#77406](https://github.com/ClickHouse/ClickHouse/pull/77406) ([Julia Kartseva](https://github.com/jkartseva)).
* 跳过索引缓存的改动已回退。 [#77447](https://github.com/ClickHouse/ClickHouse/pull/77447) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* 在预取 Wide 部分中的 JSON 列时减少内存使用。[#77640](https://github.com/ClickHouse/ClickHouse/pull/77640) ([Pavel Kruglov](https://github.com/Avogar))。
* 为 DeltaLake 表引擎的 delta kernel 增加对 AWS 会话令牌和环境凭证的支持。 [#77661](https://github.com/ClickHouse/ClickHouse/pull/77661) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 在 `additional_table_filters` 设置中支持查询参数。更改之后，下述查询将会成功：[ #77680](https://github.com/ClickHouse/ClickHouse/pull/77680)（[wxybear](https://github.com/wxybear)）。
* 现在可以在 UDF 的 XML 定义中通过一个新标签将用户自定义函数（UDF）标记为确定性函数。另外，查询缓存现在会检查查询中调用的 UDF 是否为确定性函数。如果是，则会缓存该查询的结果。（Issue [#59988](https://github.com/ClickHouse/ClickHouse/issues/59988)）。[#77769](https://github.com/ClickHouse/ClickHouse/pull/77769)（[Jimmy Aguilar Mena](https://github.com/Ergus)）。
* 增加了对 `Buffer` 表引擎参数的校验。 [#77840](https://github.com/ClickHouse/ClickHouse/pull/77840) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* 添加配置项 `enable_hdfs_pread`，用于启用或禁用 HDFS 预读。 [#77885](https://github.com/ClickHouse/ClickHouse/pull/77885) ([kevinyhzou](https://github.com/KevinyhZou))。
* 为 ZooKeeper 中的 `multi` 读写请求数量添加 profile 事件。 [#77888](https://github.com/ClickHouse/ClickHouse/pull/77888) ([JackyWoo](https://github.com/JackyWoo)).
* 在启用 `disable_insertion_and_mutation` 时，允许创建临时表并向其中插入数据。 [#77901](https://github.com/ClickHouse/ClickHouse/pull/77901) ([Xu Jia](https://github.com/XuJia0210)).
* 将 `max_insert_delayed_streams_for_parallel_write` 限制降低为 100。 [#77919](https://github.com/ClickHouse/ClickHouse/pull/77919) ([Azat Khuzhin](https://github.com/azat)).
* 添加通过 `max_merge_delayed_streams_for_parallel_write` 配置合并时可并行刷写列数的功能（这应当能将针对 S3 的垂直合并的内存占用减少约 25 倍）。 [#77922](https://github.com/ClickHouse/ClickHouse/pull/77922) ([Azat Khuzhin](https://github.com/azat)).
* 修复 `joda` 语法中诸如 &#39;yyy&#39; 之类的年份解析。[#77973](https://github.com/ClickHouse/ClickHouse/pull/77973) ([李扬](https://github.com/taiyang-li)).
* 对 MergeTree 表的 part 附加操作将按照其数据块顺序执行，这对于 ReplacingMergeTree 等特殊合并算法非常重要。此更改关闭了 [#71009](https://github.com/ClickHouse/ClickHouse/issues/71009)。[#77976](https://github.com/ClickHouse/ClickHouse/pull/77976)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 现在查询掩码规则在发生匹配时可以抛出 `LOGICAL_ERROR`。这有助于检查预先定义的密码是否在日志中的任意位置发生泄漏。[#78094](https://github.com/ClickHouse/ClickHouse/pull/78094) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
* 向 `information_schema.tables` 添加了 `index_length_column` 列，以增强与 MySQL 的兼容性。[#78119](https://github.com/ClickHouse/ClickHouse/pull/78119)（[Paweł Zakrzewski](https://github.com/KrzaQ)）。
* 引入两个新指标：`TotalMergeFailures` 和 `NonAbortedMergeFailures`。这些指标用于检测在较短时间内发生过多合并失败的情况。[#78150](https://github.com/ClickHouse/ClickHouse/pull/78150)（[Miсhael Stetsyuk](https://github.com/mstetsyuk)）。
* 修复在使用 path 风格且路径中未指定 `key` 时对 S3 URI 的错误解析。[#78185](https://github.com/ClickHouse/ClickHouse/pull/78185) ([Arthur Passos](https://github.com/arthurpassos))。
* 修复异步指标 `BlockActiveTime`、`BlockDiscardTime`、`BlockWriteTime`、`BlockQueueTime` 和 `BlockReadTime` 的错误取值（修改前会将 1 秒错误地报告为 0.001）。 [#78211](https://github.com/ClickHouse/ClickHouse/pull/78211) ([filimonov](https://github.com/filimonov))。
* 在将数据推送到基于 StorageS3(Azure)Queue 的物化视图时，对发生的错误遵循 `loading_retries` 的重试次数上限。在此之前，此类错误会被无限次重试。 [#78313](https://github.com/ClickHouse/ClickHouse/pull/78313) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 在使用 delta-kernel-rs 实现的 StorageDeltaLake 中，修复性能问题并改进进度条。 [#78368](https://github.com/ClickHouse/ClickHouse/pull/78368) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 向量相似度索引可能会将主内存多分配至多 2 倍。此修复重新设计了内存分配策略，降低内存占用，并提升向量相似度索引缓存的效率。（issue [#78056](https://github.com/ClickHouse/ClickHouse/issues/78056)）。[#78394](https://github.com/ClickHouse/ClickHouse/pull/78394)（[Shankar Iyer](https://github.com/shankar-iyer)）。
* 为具有模式类型的 `system.metric_log` 表引入一个名为 `schema_type` 的设置。允许的模式有三种：`wide` —— 当前模式，每个 metric/event 存储在单独的列中（对单列读取最有效）；`transposed` —— 类似于 `system.asynchronous_metric_log`，metric/event 以行形式存储；以及最有意思的 `transposed_with_wide_view` —— 使用 `transposed` 模式创建底层表，同时引入一个使用 `wide` 模式的视图，将查询转换到底层表上执行。在 `transposed_with_wide_view` 中，视图不支持亚秒级分辨率，`event_time_microseconds` 只是用于向后兼容的别名。[#78412](https://github.com/ClickHouse/ClickHouse/pull/78412) ([alesapin](https://github.com/alesapin))。
* 为运行时磁盘添加对 `include`、`from_env`、`from_zk` 的支持。修复 [#78177](https://github.com/ClickHouse/ClickHouse/issues/78177)。[#78470](https://github.com/ClickHouse/ClickHouse/pull/78470)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 在 iceberg 表函数和引擎中新增多种便捷方式来解析根 `metadata.json` 文件。修复 [#78455](https://github.com/ClickHouse/ClickHouse/issues/78455)。[#78475](https://github.com/ClickHouse/ClickHouse/pull/78475)（[Daniil Ivanik](https://github.com/divanik)）。
* 在 Delta Lake 中支持分区剪枝。 [#78486](https://github.com/ClickHouse/ClickHouse/pull/78486) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 在 ClickHouse 的 SSH 协议中支持基于密码的身份验证。[#78586](https://github.com/ClickHouse/ClickHouse/pull/78586) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* 为长时间运行的变更操作在 `system.warnings` 表中添加动态告警。 [#78658](https://github.com/ClickHouse/ClickHouse/pull/78658) ([Bharat Nallan](https://github.com/bharatnc)).
* 如果 CPU 严重过载，则丢弃连接。该决策基于等待时间（`OSCPUWaitMicroseconds`）与忙碌时间（`OSCPUVirtualTimeMicroseconds`）的比值。当该比值介于 `min_os_cpu_wait_time_ratio_to_drop_connection` 和 `max_os_cpu_wait_time_ratio_to_drop_connection` 之间时，将以一定概率丢弃查询。 [#78778](https://github.com/ClickHouse/ClickHouse/pull/78778) ([Alexey Katsman](https://github.com/alexkats))。
* 在 Hive 分区中允许空值。[#78816](https://github.com/ClickHouse/ClickHouse/pull/78816)（[Arthur Passos](https://github.com/arthurpassos)）。
* 修复 `BFloat16` 在 `IN` 子句中的类型转换问题（例如，`SELECT toBFloat16(1) IN [1, 2, 3];` 现在返回 `1`）。修复 [#78754](https://github.com/ClickHouse/ClickHouse/issues/78754)。[#78839](https://github.com/ClickHouse/ClickHouse/pull/78839)（[Raufs Dunamalijevs](https://github.com/rienath)）。
* 如果设置了 `disk=`，则不再检查位于其他磁盘上的 MergeTree 分区。 [#78855](https://github.com/ClickHouse/ClickHouse/pull/78855) ([Azat Khuzhin](https://github.com/azat)).
* 将 `system.query_log` 中 `used_data_type_families` 的数据类型规范化。[#78972](https://github.com/ClickHouse/ClickHouse/pull/78972)（[Kseniia Sumarokova](https://github.com/kssenii)）。





## Bug Fix (官方稳定版本中用户可见的错误行为) {#bug-fix}


* 修复使用 keeper-client 无法创建 SEQUENTIAL 节点的错误。 [#64177](https://github.com/ClickHouse/ClickHouse/pull/64177) ([Duc Canh Le](https://github.com/canhld94)).
* 修复父作用域中的标识符解析，允许在 `WITH` 子句中将表达式使用别名。修复 [#58994](https://github.com/ClickHouse/ClickHouse/issues/58994)。修复 [#62946](https://github.com/ClickHouse/ClickHouse/issues/62946)。修复 [#63239](https://github.com/ClickHouse/ClickHouse/issues/63239)。修复 [#65233](https://github.com/ClickHouse/ClickHouse/issues/65233)。修复 [#71659](https://github.com/ClickHouse/ClickHouse/issues/71659)。修复 [#71828](https://github.com/ClickHouse/ClickHouse/issues/71828)。修复 [#68749](https://github.com/ClickHouse/ClickHouse/issues/68749)。[#66143](https://github.com/ClickHouse/ClickHouse/pull/66143)（[Dmitry Novik](https://github.com/novikd)）。
* 修复 PositionImpl::vectorVector 中错误的字符计数问题。[#71003](https://github.com/ClickHouse/ClickHouse/pull/71003)（[思维](https://github.com/heymind)）。
* 修复 `negate` 函数的单调性。在此前版本中，当 `x` 为主键时，查询 `select * from a where -x = -42;` 可能会返回错误结果。 [#71440](https://github.com/ClickHouse/ClickHouse/pull/71440) ([Michael Kolupaev](https://github.com/al13n321))。
* 由于未处理的部分撤销，针对访问实体的 `RESTORE` 操作所需的权限超出了实际需要。此 PR 修复了该问题。修复了 [#71853](https://github.com/ClickHouse/ClickHouse/issues/71853)。[#71958](https://github.com/ClickHouse/ClickHouse/pull/71958)（[pufit](https://github.com/pufit)）。
* 避免在执行 `ALTER TABLE REPLACE/MOVE PARTITION FROM/TO TABLE` 后产生暂停。获取用于后台任务调度的正确设置。[#72024](https://github.com/ClickHouse/ClickHouse/pull/72024) ([Aleksei Filatov](https://github.com/aalexfvk))。
* 修复 `arrayIntersect` 中对空元组的处理。这修复了 [#72578](https://github.com/ClickHouse/ClickHouse/issues/72578)。[#72581](https://github.com/ClickHouse/ClickHouse/pull/72581)（[Amos Bird](https://github.com/amosbird)）。
* 修复在某些输入和输出格式（例如 Parquet、Arrow）中处理空 `Tuple` 的问题。[#72616](https://github.com/ClickHouse/ClickHouse/pull/72616)（[Michael Kolupaev](https://github.com/al13n321)）。
* 现在，在通配符数据库/表上使用列级 `GRANT SELECT/INSERT` 语句会抛出错误。[#72646](https://github.com/ClickHouse/ClickHouse/pull/72646) ([Johann Gan](https://github.com/johanngan)).
* 修复了这样一种情况：由于目标访问实体中存在隐式权限，用户无法执行 `REVOKE ALL ON *.*`。[#72872](https://github.com/ClickHouse/ClickHouse/pull/72872) ([pufit](https://github.com/pufit))。
* 修复在处理异步分布式 INSERT 的待处理批次时出现卡死的问题（例如由于 `No such file or directory`）。 [#72939](https://github.com/ClickHouse/ClickHouse/pull/72939) ([Azat Khuzhin](https://github.com/azat)).
* 新增对 Azure SAS 令牌的支持。 [#72959](https://github.com/ClickHouse/ClickHouse/pull/72959) ([Azat Khuzhin](https://github.com/azat))。
* 修复 `formatDateTime` 标量函数中正时区的格式化方式。 [#73091](https://github.com/ClickHouse/ClickHouse/pull/73091) ([ollidraese](https://github.com/ollidraese)).
* 修复在通过 PROXYv1 建立连接且已设置 `auth_use_forwarded_address` 时未能正确反映源端口的问题——此前会错误地使用代理端口。新增 `currentQueryID()` 函数。[#73095](https://github.com/ClickHouse/ClickHouse/pull/73095) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 在 `TCPHandler` 中将格式设置传递到 `NativeWriter`，以便像 `output_format_native_write_json_as_string` 这样的设置能够被正确应用。[#73179](https://github.com/ClickHouse/ClickHouse/pull/73179)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复读取 JSON 子对象子列时使用错误前缀的问题。 [#73182](https://github.com/ClickHouse/ClickHouse/pull/73182) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复 `StorageObjectStorageQueue` 中的崩溃。 [#73274](https://github.com/ClickHouse/ClickHouse/pull/73274) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复在服务器关闭期间可刷新物化视图中出现的罕见崩溃问题。[#73323](https://github.com/ClickHouse/ClickHouse/pull/73323) ([Michael Kolupaev](https://github.com/al13n321)).
* 函数 `formatDateTime` 的 `%f` 占位符现在始终生成六位（子秒）数字，从而使其行为与 MySQL 的 `DATE_FORMAT` 函数保持兼容。可以通过设置 `formatdatetime_f_prints_scale_number_of_digits = 1` 来恢复之前的行为。[#73324](https://github.com/ClickHouse/ClickHouse/pull/73324)（[ollidraese](https://github.com/ollidraese)）。
* 通过在索引分析中对隐式的 `Date` 到 `DateTime` 转换强制采用饱和行为，改进了 datetime 转换。这解决了由于 datetime 范围限制而可能导致的索引分析结果不准确的问题。修复了 [#73307](https://github.com/ClickHouse/ClickHouse/issues/73307)。同时也修复了在 `date_time_overflow_behavior = 'ignore'`（默认值）时显式调用 `toDateTime` 时的转换行为。[#73326](https://github.com/ClickHouse/ClickHouse/pull/73326)（[Amos Bird](https://github.com/amosbird)）。
* 修复了从 `s3` 存储和表函数读取数据时按 `_etag` 列进行过滤的问题。[#73353](https://github.com/ClickHouse/ClickHouse/pull/73353) ([Anton Popov](https://github.com/CurtizJ))。
* 修复在旧版 analyzer 中，当在 `JOIN ON` 表达式中使用 `IN (subquery)` 时出现的 `Not-ready Set is passed as the second argument for function 'in'` 错误。[#73382](https://github.com/ClickHouse/ClickHouse/pull/73382)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 修复了 Dynamic 和 JSON 列在合并压缩（squash）前的准备逻辑。此前在某些情况下，即使尚未达到类型/路径数量的上限，新类型也可能被插入到 shared variant/shared data 中。[#73388](https://github.com/ClickHouse/ClickHouse/pull/73388)（[Pavel Kruglov](https://github.com/Avogar)）。
* 在类型的二进制解码过程中检查损坏的大小值，以避免过大的内存分配。 [#73390](https://github.com/ClickHouse/ClickHouse/pull/73390) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复了在启用并行副本时从单副本集群读取数据时的逻辑错误。[#73403](https://github.com/ClickHouse/ClickHouse/pull/73403) ([Michael Kolupaev](https://github.com/al13n321)).
* 修复在使用 ZooKeeper 和旧版 Keeper 时的 ObjectStorageQueue。 [#73420](https://github.com/ClickHouse/ClickHouse/pull/73420) ([Antonio Andelic](https://github.com/antonio2368)).
* 实现了用于默认启用 hive 分区的修复。 [#73479](https://github.com/ClickHouse/ClickHouse/pull/73479) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 修复在创建向量相似性索引时出现的数据竞争问题。 [#73517](https://github.com/ClickHouse/ClickHouse/pull/73517) ([Antonio Andelic](https://github.com/antonio2368))。
* 修复了当字典的数据源包含带有错误数据的函数时出现的段错误。 [#73535](https://github.com/ClickHouse/ClickHouse/pull/73535) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 修复 `storage S3(Azure)Queue` 中插入失败后的重试逻辑。关闭 [#70951](https://github.com/ClickHouse/ClickHouse/issues/70951)。[#73546](https://github.com/ClickHouse/ClickHouse/pull/73546)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 修复了函数 `tupleElement` 中的一个错误，该错误在某些情况下会出现在包含 `LowCardinality` 元素且启用了 `optimize_functions_to_subcolumns` 设置的元组中。 [#73548](https://github.com/ClickHouse/ClickHouse/pull/73548) ([Anton Popov](https://github.com/CurtizJ)).
* 修复了解析 `enum` 通配符后接范围的情况。修复了 [#73473](https://github.com/ClickHouse/ClickHouse/issues/73473)。[#73569](https://github.com/ClickHouse/ClickHouse/pull/73569)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 修复了在非复制表的子查询中被忽略的 parallel&#95;replicas&#95;for&#95;non&#95;replicated&#95;merge&#95;tree 固定设置。[#73584](https://github.com/ClickHouse/ClickHouse/pull/73584) ([Igor Nikonov](https://github.com/devcrafter)).
* 修复在任务无法被调度时抛出的 `std::logical_error`。在压力测试中发现。示例堆栈跟踪：`2024.12.19 02:05:46.171833 [ 18190 ] {01f0daba-d3cc-4898-9e0e-c2c263306427} <Fatal> : Logical error: 'std::exception. Code: 1001, type: std::__1::future_error, e.what() = The associated promise has been destructed prior to the associated state becoming ready. (version 25.1.1.18724), Stack trace:.` [#73629](https://github.com/ClickHouse/ClickHouse/pull/73629) ([Alexander Gololobov](https://github.com/davenger)).
* 在 `EXPLAIN SYNTAX` 中不再解析查询，以避免在分布式查询阶段选择错误时导致逻辑错误。修复了 [#65205](https://github.com/ClickHouse/ClickHouse/issues/65205)。[#73634](https://github.com/ClickHouse/ClickHouse/pull/73634)（[Dmitry Novik](https://github.com/novikd)）。
* 修复 Dynamic 列中可能出现的数据不一致问题。修复了可能出现的逻辑错误 `Nested columns sizes are inconsistent with local_discriminators column size`。 [#73644](https://github.com/ClickHouse/ClickHouse/pull/73644)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复了在包含 `FINAL` 和 `SAMPLE` 的查询中出现的 `NOT_FOUND_COLUMN_IN_BLOCK` 错误。修复了从 `CollapsingMergeTree` 中使用 `FINAL` 查询时产生的不正确结果，并启用了对 `FINAL` 的优化。[#73682](https://github.com/ClickHouse/ClickHouse/pull/73682) ([Anton Popov](https://github.com/CurtizJ)).
* 修复在 `LIMIT BY COLUMNS` 中出现的崩溃。 [#73686](https://github.com/ClickHouse/ClickHouse/pull/73686) ([Raúl Marín](https://github.com/Algunenano)).
* 修复一个错误：在强制使用普通投影时，即使查询与定义的投影完全一致，该投影也不会被选中，导致报错。 [#73700](https://github.com/ClickHouse/ClickHouse/pull/73700) ([Shichao Jin](https://github.com/jsc0218)).
* 修复 `Dynamic/Object` 结构的反序列化。该问题可能导致抛出 `CANNOT_READ_ALL_DATA` 异常。[#73767](https://github.com/ClickHouse/ClickHouse/pull/73767)（[Pavel Kruglov](https://github.com/Avogar)）。
* 在从备份恢复分片时跳过 `metadata_version.txt` 文件。[#73768](https://github.com/ClickHouse/ClickHouse/pull/73768) ([Vitaly Baranov](https://github.com/vitlibar))。
* 修复 [#73737](https://github.com/ClickHouse/ClickHouse/issues/73737)。[#73775](https://github.com/ClickHouse/ClickHouse/pull/73775)（[zhanglistar](https://github.com/zhanglistar)）。
* 修复了 [#72078](https://github.com/ClickHouse/ClickHouse/issues/72078)（S3 Express 支持异常）。[#73777](https://github.com/ClickHouse/ClickHouse/pull/73777)（[Sameer Tamsekar](https://github.com/stamsekar)）。
* 允许在 CollapsingMergeTree 表中合并含有无效 sign 列值的行。 [#73864](https://github.com/ClickHouse/ClickHouse/pull/73864) ([Christoph Wurm](https://github.com/cwurm)).
* 修复以下错误：`Row 1: ────── hostname: c-test-wy-37-server-nlkyjyb-0.c-test-wy-37-server-headless.ns-test-wy-37.svc.cluster.local type: ExceptionWhileProcessing event_date: 2024-12-23 event_time: 2024-12-23 16:21:19 event_time_microseconds: 2024-12-23 16:21:19.824624 query_start_time: 2024-12-23 16:21:19 query_start_time_microseconds: 2024-12-23 16:21:19.747142 query_duration_ms: 77 read_rows: 1 read_bytes: 134 written_rows: 0 written_bytes: 0 result_rows: 0 result_bytes: 0 memory_usage: 7824 current_database: default query: CREATE DATABASE db0 formatted_query: normalized_query_hash: 7820917191074023511 -- 7.82 quintillion query_kind: Create databases: ['db0'] tables: [] columns: [] partitions: [] projections: [] views: [] exception_code: 170 exception: Code: 170. DB::Exception: Bad get: has Null, requested Int64: While executing DDLOnClusterQueryStatus. (BAD_GET) (version 25.1.1.19134 (official build)) stack_trace: 0. ./build_docker/./src/Common/Exception.cpp:107: DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000da5e53b 1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x00000000088aca4c 2. DB::Exception::Exception<std::basic_string_view<char, std::char_traits<char>>, std::basic_string_view<char, std::char_traits<char>>>(int, FormatStringHelperImpl<std::type_identity<std::basic_string_view<char, std::char_traits<char>>>::type, std::type_identity<std::basic_string_view<char, std::char_traits<char>>>::type>, std::basic_string_view<char, std::char_traits<char>>&&, std::basic_string_view<char, std::char_traits<char>>&&) @ 0x00000000088bae8b 3. auto& DB::Field::safeGet<long>() & @ 0x0000000008a3c748 4. ./src/Core/Field.h:484: DB::ColumnVector<long>::insert(DB::Field const&) @ 0x0000000012e44c0f 5. ./build_docker/./src/Interpreters/DDLOnClusterQueryStatusSource.cpp:53: DB::DDLOnClusterQueryStatusSource::generateChunkWithUnfinishedHosts() const @ 0x0000000012a40214 6. ./build_docker/./src/Interpreters/DDLOnClusterQueryStatusSource.cpp:104: DB::DDLOnClusterQueryStatusSource::handleTimeoutExceeded() @ 0x0000000012a41640 7. ./build_docker/./src/Interpreters/DDLOnClusterQueryStatusSource.cpp:109: DB::DDLOnClusterQueryStatusSource::stopWaitingOfflineHosts() @ 0x0000000012a41be9 8. ./build_docker/./src/Interpreters/DistributedQueryStatusSource.cpp:182: DB::DistributedQueryStatusSource::generate() @ 0x0000000011feb3bf 9. ./build_docker/./src/Processors/ISource.cpp:139: DB::ISource::tryGenerate() @ 0x0000000014148f5b 10. ./build_docker/./src/Processors/ISource.cpp:108: DB::ISource::work() @ 0x0000000014148c47 11. ./build_docker/./src/Processors/Executors/ExecutionThreadContext.cpp:49: DB::ExecutionThreadContext::executeTask() @ 0x0000000014164fc7 12. ./build_docker/./src/Processors/Executors/PipelineExecutor.cpp:290: DB::PipelineExecutor::executeStepImpl(unsigned long, std::atomic<bool>*) @ 0x00000000141577e5`。[#73876](https://github.com/ClickHouse/ClickHouse/pull/73876) ([Tuan Pham Anh](https://github.com/tuanpach))。
* 修复了在可以创建其嵌套 tuple 未对（&#39;keys&#39;、&#39;values&#39;）进行显式命名的 `Map` 时，`map()` 类型偶尔无法进行比较的问题。[#73878](https://github.com/ClickHouse/ClickHouse/pull/73878) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 在解析 `GROUP BY ALL` 子句时忽略窗口函数。修复 [#73501](https://github.com/ClickHouse/ClickHouse/issues/73501)。[#73916](https://github.com/ClickHouse/ClickHouse/pull/73916)（[Dmitry Novik](https://github.com/novikd)）。
* 在客户端与服务器通信时正确传递 `Native` 格式设置。[#73924](https://github.com/ClickHouse/ClickHouse/pull/73924) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复隐式权限问题（之前按通配符处理）。 [#73932](https://github.com/ClickHouse/ClickHouse/pull/73932) ([Azat Khuzhin](https://github.com/azat)).
* 修复在创建嵌套 `Map` 时的高内存使用问题。[#73982](https://github.com/ClickHouse/ClickHouse/pull/73982) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复解析键为空的嵌套 JSON 时的问题。 [#73993](https://github.com/ClickHouse/ClickHouse/pull/73993) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复：当某个 `alias` 被另一个 `alias` 引用且按相反顺序进行选择时，该 `alias` 可能不会被添加到 `projection` 中。 [#74033](https://github.com/ClickHouse/ClickHouse/pull/74033) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 使用 plain&#95;rewritable 元数据的磁盘可以在多个服务器实例之间共享。预期的用法是：一个实例可以读取某个元数据对象，而另一个实例可以对其进行修改。在使用 Azure 存储进行 plain&#95;rewritable 初始化时，“对象未找到”错误会被忽略，其行为与对 S3 的实现类似。[#74059](https://github.com/ClickHouse/ClickHouse/pull/74059)（[Julia Kartseva](https://github.com/jkartseva)）。
* 修复 `any` 和 `anyLast` 在枚举类型和空表场景下的行为。[#74061](https://github.com/ClickHouse/ClickHouse/pull/74061) ([Joanna Hulboj](https://github.com/jh0x)).
* 修复了用户在 `kafka` 表引擎中使用关键字参数时的问题。[#74064](https://github.com/ClickHouse/ClickHouse/pull/74064) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 修复在修改 `S3Queue` 存储设置时，在带有 &quot;s3queue&#95;&quot; 前缀与不带此前缀之间相互转换时的问题。 [#74075](https://github.com/ClickHouse/ClickHouse/pull/74075) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 添加了一个名为 `allow_push_predicate_ast_for_distributed_subqueries` 的设置。该设置为使用 analyzer 的分布式查询增加了基于 AST 的谓词下推功能。这是一个临时解决方案，我们会使用它直到支持带查询计划序列化的分布式查询为止。修复了 [#66878](https://github.com/ClickHouse/ClickHouse/issues/66878) [#69472](https://github.com/ClickHouse/ClickHouse/issues/69472) [#65638](https://github.com/ClickHouse/ClickHouse/issues/65638) [#68030](https://github.com/ClickHouse/ClickHouse/issues/68030) [#73718](https://github.com/ClickHouse/ClickHouse/issues/73718)。[#74085](https://github.com/ClickHouse/ClickHouse/pull/74085)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 修复了这样的问题：在 [#73095](https://github.com/ClickHouse/ClickHouse/issues/73095) 之后，`forwarded_for` 字段中可能会带有端口，从而导致无法解析包含端口的主机名。[#74116](https://github.com/ClickHouse/ClickHouse/pull/74116)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* 修复了 `ALTER TABLE (DROP STATISTICS ...) (DROP STATISTICS ...)` 的错误格式问题。 [#74126](https://github.com/ClickHouse/ClickHouse/pull/74126) ([Han Fei](https://github.com/hanfei1991)).
* 修复了问题 [#66112](https://github.com/ClickHouse/ClickHouse/issues/66112)。[#74128](https://github.com/ClickHouse/ClickHouse/pull/74128)（[Anton Ivashkin](https://github.com/ianton-ru)）。
* 在 `CREATE TABLE` 中已无法再将 `Loop` 用作表引擎。此前这种组合会导致段错误。[#74137](https://github.com/ClickHouse/ClickHouse/pull/74137)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 修复安全问题，防止在 `postgresql` 和 `sqlite` 表函数中发生 SQL 注入。 [#74144](https://github.com/ClickHouse/ClickHouse/pull/74144) ([Pablo Marcos](https://github.com/pamarcos))。
* 修复从压缩的 Memory 引擎表中读取子列时发生的崩溃问题。修复了 [#74009](https://github.com/ClickHouse/ClickHouse/issues/74009)。[#74161](https://github.com/ClickHouse/ClickHouse/pull/74161)（[Nikita Taranov](https://github.com/nickitat)）。
* 修复了在查询 `system.detached_tables` 时出现的无限循环问题。[#74190](https://github.com/ClickHouse/ClickHouse/pull/74190)（[Konstantin Morozov](https://github.com/k-morozov)）。
* 修复在将文件标记为失败时 `s3queue` 中的逻辑错误。[#74216](https://github.com/ClickHouse/ClickHouse/pull/74216) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 检查某些存储中不支持的类型。 [#74218](https://github.com/ClickHouse/ClickHouse/pull/74218) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在 macOS 上通过 PostgreSQL 接口执行 `INSERT INTO SELECT` 查询时出现的崩溃问题（问题 [#72938](https://github.com/ClickHouse/ClickHouse/issues/72938)）。[#74231](https://github.com/ClickHouse/ClickHouse/pull/74231)（[Artem Yurov](https://github.com/ArtemYurov)）。
* 修复从基础备份执行 `RESTORE` 时的原生复制设置（`allow_s3_native_copy`/`allow_azure_native_copy`）。 [#74286](https://github.com/ClickHouse/ClickHouse/pull/74286) ([Azat Khuzhin](https://github.com/azat)).
* 修复了当数据库中已分离表的数量是 `max_block_size` 的整数倍时出现的问题。 [#74289](https://github.com/ClickHouse/ClickHouse/pull/74289) ([Konstantin Morozov](https://github.com/k-morozov))。
* 修复通过 ObjectStorage（如 S3）进行复制时，当源和目标凭证不同时的行为。 [#74331](https://github.com/ClickHouse/ClickHouse/pull/74331) ([Azat Khuzhin](https://github.com/azat)).
* 修复了在复制数据库中未初始化的 `max_log_ptr`。 [#74336](https://github.com/ClickHouse/ClickHouse/pull/74336) ([Konstantin Morozov](https://github.com/k-morozov)).
* 修复在 GCS 上进行原生拷贝时对“在 JSON API 中使用 Rewrite 方法”的检测。[#74338](https://github.com/ClickHouse/ClickHouse/pull/74338) ([Azat Khuzhin](https://github.com/azat))。
* 修复插入 `INTERVAL` 时发生的崩溃（问题 [#74299](https://github.com/ClickHouse/ClickHouse/issues/74299)）。[#74478](https://github.com/ClickHouse/ClickHouse/pull/74478)（[NamNguyenHoai](https://github.com/NamHoaiNguyen)）。
* 修复在聚合投影中使用 `count(nullable)` 时不正确的投影分析，解决了 [#74495](https://github.com/ClickHouse/ClickHouse/issues/74495)。此 PR 还在投影分析相关位置增加了一些日志，以便澄清为何会使用某个投影或为何不会使用。[#74498](https://github.com/ClickHouse/ClickHouse/pull/74498) ([Amos Bird](https://github.com/amosbird))。
* 修复 `BackgroundMergesAndMutationsPoolSize` 的错误计算（之前计算结果为实际值的 2 倍）。[#74509](https://github.com/ClickHouse/ClickHouse/pull/74509) ([alesapin](https://github.com/alesapin))。
* 修复在启用 Cluster Discovery 时导致 keeper watches 泄漏的问题。 [#74521](https://github.com/ClickHouse/ClickHouse/pull/74521) ([RinChanNOW](https://github.com/RinChanNOWWW))。
* 修复了格式化常量 JSON 字面量的问题。此前这可能会在将查询发送到另一台服务器时导致语法错误。[#74533](https://github.com/ClickHouse/ClickHouse/pull/74533)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复 UBSan 报告的内存对齐问题 [#74512](https://github.com/ClickHouse/ClickHouse/issues/74512)。[#74534](https://github.com/ClickHouse/ClickHouse/pull/74534)（[Arthur Passos](https://github.com/arthurpassos)）。
* 修复在创建表期间 `KeeperMap` 并发清理的行为。 [#74568](https://github.com/ClickHouse/ClickHouse/pull/74568) ([Antonio Andelic](https://github.com/antonio2368)).
* 在存在 `EXCEPT` 或 `INTERSECT` 的情况下，不要在子查询中移除未使用的投影列，以保留正确的查询结果。修复了 [#73930](https://github.com/ClickHouse/ClickHouse/issues/73930)。修复了 [#66465](https://github.com/ClickHouse/ClickHouse/issues/66465)。[#74577](https://github.com/ClickHouse/ClickHouse/pull/74577)（[Dmitry Novik](https://github.com/novikd)）。
* 修复在启用隐式投影时，使用常量分区表达式会导致 `CREATE` 查询异常的问题。此更改修复了 [#74596](https://github.com/ClickHouse/ClickHouse/issues/74596)。[#74634](https://github.com/ClickHouse/ClickHouse/pull/74634)（[Amos Bird](https://github.com/amosbird)）。
* 修复了在启用稀疏序列化时，包含 `Tuple` 列的表之间执行的 `INSERT SELECT` 查询。 [#74698](https://github.com/ClickHouse/ClickHouse/pull/74698) ([Anton Popov](https://github.com/CurtizJ)).
* 函数 `right` 在使用常量负偏移量时工作不正确。[#74701](https://github.com/ClickHouse/ClickHouse/pull/74701) ([Daniil Ivanik](https://github.com/divanik))。
* 修复由于客户端解压逻辑有缺陷，导致插入 gzip 压缩数据有时失败的问题。 [#74707](https://github.com/ClickHouse/ClickHouse/pull/74707) ([siyuan](https://github.com/linkwk7)).
* 避免在 `INSERT` 以异常结束后将连接留在损坏状态。 [#74740](https://github.com/ClickHouse/ClickHouse/pull/74740) ([Azat Khuzhin](https://github.com/azat)).
* 避免重用处于中间状态的连接。 [#74749](https://github.com/ClickHouse/ClickHouse/pull/74749) ([Azat Khuzhin](https://github.com/azat))。
* 在使用通配符授权的情况下，部分撤销操作可能会移除超出预期的权限。修复了 [#74263](https://github.com/ClickHouse/ClickHouse/issues/74263)。[#74751](https://github.com/ClickHouse/ClickHouse/pull/74751)（[pufit](https://github.com/pufit)）。
* 修复在解析 JSON 类型声明时，当类型名不是全大写时导致的崩溃。[#74784](https://github.com/ClickHouse/ClickHouse/pull/74784) ([Pavel Kruglov](https://github.com/Avogar)).
* Keeper 修复：修正从磁盘读取日志记录的问题。 [#74785](https://github.com/ClickHouse/ClickHouse/pull/74785) ([Antonio Andelic](https://github.com/antonio2368)).
* 修复了对 `SYSTEM REFRESH/START/STOP VIEW` 所需权限的检查逻辑，现在在针对某个特定视图执行查询时，不再需要在 `*.*` 上拥有对应授权，只需对该视图本身授予相应权限即可。[#74789](https://github.com/ClickHouse/ClickHouse/pull/74789) ([Alexander Tokmakov](https://github.com/tavplubix)).
* `hasColumnInTable` 函数目前不会考虑别名列。修复它，使其同样适用于别名列。[#74841](https://github.com/ClickHouse/ClickHouse/pull/74841) ([Bharat Nallan](https://github.com/bharatnc))。
* Keeper：修复在连接建立前即被终止时发生的 logical&#95;error。 [#74844](https://github.com/ClickHouse/ClickHouse/pull/74844) ([Michael Kolupaev](https://github.com/al13n321)).
* 修复了一个问题：当存在使用 `AzureBlobStorage` 的表时，服务器无法启动。现在会在不向 Azure 发出任何请求的情况下加载这些表。[#74880](https://github.com/ClickHouse/ClickHouse/pull/74880) ([Alexey Katsman](https://github.com/alexkats))。
* 修复在 BACKUP 和 RESTORE 操作的 `query_log` 中缺少的 `used_privileges` 和 `missing_privileges` 字段。[#74887](https://github.com/ClickHouse/ClickHouse/pull/74887) ([Alexey Katsman](https://github.com/alexkats)).
* 修复在 Azure Blob Storage 中对包含空列的表执行数据部分合并时出现的 FILE&#95;DOESNT&#95;EXIST 错误。[#74892](https://github.com/ClickHouse/ClickHouse/pull/74892)（[Julia Kartseva](https://github.com/jkartseva)）。
* 在与临时表进行 `JOIN` 时修复投影列名的问题，关闭 [#68872](https://github.com/ClickHouse/ClickHouse/issues/68872)。[#74897](https://github.com/ClickHouse/ClickHouse/pull/74897)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 如果在执行 HDFS `SELECT` 请求期间出现 `sasl` 错误，则刷新 HDFS 的 `krb` 凭证。 [#74930](https://github.com/ClickHouse/ClickHouse/pull/74930) ([inv2004](https://github.com/inv2004)).
* 修复在 `startup_scripts` 中对 Replicated 数据库的查询。[#74942](https://github.com/ClickHouse/ClickHouse/pull/74942)（[Azat Khuzhin](https://github.com/azat)）。
* 修复在使用空安全比较时，`JOIN ON` 子句中带类型别名的表达式相关问题。[#74970](https://github.com/ClickHouse/ClickHouse/pull/74970) ([Vladimir Cherkasov](https://github.com/vdimir))。
* 当删除操作失败时，将 part 的状态从“正在删除”恢复为“已过期”。 [#74985](https://github.com/ClickHouse/ClickHouse/pull/74985) ([Sema Checherinda](https://github.com/CheSema)).
* 在之前的版本中，当存在标量子查询时，我们会在数据格式初始化期间就开始写入进度信息（由处理该子查询累积而来），而这发生在写入 HTTP 头之前。这会导致诸如 X-ClickHouse-QueryId、X-ClickHouse-Format 以及 Content-Type 等 HTTP 头丢失。[#74991](https://github.com/ClickHouse/ClickHouse/pull/74991)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复在 `database_replicated_allow_replicated_engine_arguments=0` 配置下的 `CREATE TABLE AS...` 查询。 [#75000](https://github.com/ClickHouse/ClickHouse/pull/75000) ([Bharat Nallan](https://github.com/bharatnc)).
* 修复在发生 INSERT 异常后客户端连接被遗留在异常状态的问题。 [#75030](https://github.com/ClickHouse/ClickHouse/pull/75030) ([Azat Khuzhin](https://github.com/azat)).
* 修复 PSQL 复制中未捕获异常导致的崩溃。[#75062](https://github.com/ClickHouse/ClickHouse/pull/75062) ([Azat Khuzhin](https://github.com/azat))。
* Sasl 可能导致任意 RPC 调用失败，此修复可以在 krb5 ticket 过期时重试该调用。 [#75063](https://github.com/ClickHouse/ClickHouse/pull/75063) ([inv2004](https://github.com/inv2004))。
* 修复了在启用 `optimize_function_to_subcolumns` 设置时，对 `Array`、`Map` 和 `Nullable(..)` 列使用索引（主索引和二级索引）的问题。此前，这些列的索引可能会被忽略。[#75081](https://github.com/ClickHouse/ClickHouse/pull/75081)（[Anton Popov](https://github.com/CurtizJ)）。
* 在创建带有内部表的物化视图时禁用 `flatten_nested`，因为无法使用这样扁平化得到的列。[#75085](https://github.com/ClickHouse/ClickHouse/pull/75085)（[Christoph Wurm](https://github.com/cwurm)）。
* 修复了在 `forwarded_for` 字段中对某些 IPv6 地址（例如 ::ffff:1.1.1.1）的错误解析问题，该问题会导致客户端因抛出异常而断开连接。[#75133](https://github.com/ClickHouse/ClickHouse/pull/75133)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* 修复了针对 LowCardinality 可为空数据类型的 nullsafe JOIN 处理。此前在使用 nullsafe 比较的 JOIN ON（如 `IS NOT DISTINCT FROM`、`<=>`、`a IS NULL AND b IS NULL OR a == b`）时，LowCardinality 列无法被正确处理。[#75143](https://github.com/ClickHouse/ClickHouse/pull/75143) ([Vladimir Cherkasov](https://github.com/vdimir))。
* 使用新的 analyzer 修复包含未使用插值的查询。 [#75173](https://github.com/ClickHouse/ClickHouse/pull/75173) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* 修复在使用 Insert 的 CTE 时出现的崩溃问题。 [#75188](https://github.com/ClickHouse/ClickHouse/pull/75188) ([Shichao Jin](https://github.com/jsc0218)).
* Keeper 修复：在回滚日志时避免写入已损坏的变更日志。 [#75197](https://github.com/ClickHouse/ClickHouse/pull/75197) ([Antonio Andelic](https://github.com/antonio2368))。
* 在合适的情况下将 `BFloat16` 用作超类型。解决了：[#74404](https://github.com/ClickHouse/ClickHouse/issues/74404)。[#75236](https://github.com/ClickHouse/ClickHouse/pull/75236)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 修复在使用 `any&#95;join&#95;distinct&#95;right&#95;table&#95;keys` 且 `JOIN ON` 条件中包含 `OR` 时，`JOIN` 结果中出现的意外默认值的问题。 [#75262](https://github.com/ClickHouse/ClickHouse/pull/75262) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 对 `azureblobstorage` 表引擎的凭据进行脱敏处理。 [#75319](https://github.com/ClickHouse/ClickHouse/pull/75319) ([Garrett Thomas](https://github.com/garrettthomaskth))。
* 修复了 ClickHouse 可能错误地将过滤下推到 PostgreSQL、MySQL 或 SQLite 等外部数据库的行为。关闭关联问题：[#71423](https://github.com/ClickHouse/ClickHouse/issues/71423)。[#75320](https://github.com/ClickHouse/ClickHouse/pull/75320)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 修复了在以 Protobuf 格式输出的同时并行执行查询 `SYSTEM DROP FORMAT SCHEMA CACHE` 时，可能在 Protobuf 模式缓存中发生的崩溃问题。 [#75357](https://github.com/ClickHouse/ClickHouse/pull/75357) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在使用并行副本时，下推 `HAVING` 过滤条件可能导致的逻辑错误或未初始化内存问题。[#75363](https://github.com/ClickHouse/ClickHouse/pull/75363)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 对 `icebergS3`、`icebergAzure` 表函数和表引擎中的敏感信息进行隐藏。 [#75378](https://github.com/ClickHouse/ClickHouse/pull/75378) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 现在可以正确处理 `TRIM` 函数中由表达式计算得到的空裁剪字符。示例：`SELECT TRIM(LEADING concat('') FROM 'foo')`（Issue [#69922](https://github.com/ClickHouse/ClickHouse/issues/69922)）。[#75399](https://github.com/ClickHouse/ClickHouse/pull/75399)（[Manish Gill](https://github.com/mgill25)）。
* 修复 `IOutputFormat` 中的数据竞态。 [#75448](https://github.com/ClickHouse/ClickHouse/pull/75448) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在分布式表上进行 `JOIN`，且使用 `Array` 类型的 JSON 子列时，可能出现的错误：`Elements ... and ... of Nested data structure ... (Array columns) have different array sizes`。 [#75512](https://github.com/ClickHouse/ClickHouse/pull/75512) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复结果缓冲区大小计算无效的问题。关闭 [#70031](https://github.com/ClickHouse/ClickHouse/issues/70031)。[#75548](https://github.com/ClickHouse/ClickHouse/pull/75548)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 修复 `allow_feature_tier` 与兼容性 `mergetree` 设置之间的交互。 [#75635](https://github.com/ClickHouse/ClickHouse/pull/75635) ([Raúl Marín](https://github.com/Algunenano))。
* 修复在文件被重试时，`system.s3queue_log` 中 `processed_rows` 值不正确的问题。 [#75666](https://github.com/ClickHouse/ClickHouse/pull/75666) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 当物化视图向 URL 引擎写入数据且出现连接问题时，遵循 `materialized_views_ignore_errors` 设置。 [#75679](https://github.com/ClickHouse/ClickHouse/pull/75679) ([Christoph Wurm](https://github.com/cwurm)).
* 修复了在多次对不同类型的列之间执行异步 `RENAME` 查询（`alter_sync = 0`）后，从 `MergeTree` 表读取数据时极少数情况下发生的崩溃问题。 [#75693](https://github.com/ClickHouse/ClickHouse/pull/75693) ([Anton Popov](https://github.com/CurtizJ)).
* 修复某些包含 `UNION ALL` 的查询中出现的 `Block structure mismatch in QueryPipeline stream` 错误。[#75715](https://github.com/ClickHouse/ClickHouse/pull/75715) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* 在对其主键列执行 `ALTER MODIFY` 时重建投影。此前，在对用于投影主键的列执行 `ALTER MODIFY` 后进行查询，可能会导致 `CANNOT_READ_ALL_DATA` 错误。 [#75720](https://github.com/ClickHouse/ClickHouse/pull/75720) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复在使用 analyzer 时，标量子查询的 `ARRAY JOIN` 返回结果不正确的问题。[#75732](https://github.com/ClickHouse/ClickHouse/pull/75732) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
* 修复了 `DistinctSortedStreamTransform` 中的空指针解引用问题。[#75734](https://github.com/ClickHouse/ClickHouse/pull/75734) ([Nikita Taranov](https://github.com/nickitat))。
* 修复 `allow_suspicious_ttl_expressions` 的行为。[#75771](https://github.com/ClickHouse/ClickHouse/pull/75771)（[Aleksei Filatov](https://github.com/aalexfvk)）。
* 修复函数 `translate` 中的未初始化内存读取问题。此更改关闭了 [#75592](https://github.com/ClickHouse/ClickHouse/issues/75592)。[#75794](https://github.com/ClickHouse/ClickHouse/pull/75794)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在 Native 格式中，将格式设置应用到 JSON 的字符串格式化。[#75832](https://github.com/ClickHouse/ClickHouse/pull/75832) ([Pavel Kruglov](https://github.com/Avogar)).
* 在设置变更历史中记录了在 v24.12 中将并行哈希启用为默认 `join` 算法。这意味着，如果配置了低于 v24.12 的兼容性级别，ClickHouse 将继续使用非并行哈希进行 `join`。[#75870](https://github.com/ClickHouse/ClickHouse/pull/75870) ([Robert Schulze](https://github.com/rschu1ze))。
* 修复了一个错误：带有隐式添加的 min-max 索引的表无法被复制到新表中（问题 [#75677](https://github.com/ClickHouse/ClickHouse/issues/75677)）。[#75877](https://github.com/ClickHouse/ClickHouse/pull/75877)（[Smita Kulkarni](https://github.com/SmitaRKulkarni)）。
* `clickhouse-library-bridge` 允许从文件系统中打开任意库，因此出于安全考虑应仅在隔离环境中运行。为防止其在与 clickhouse-server 同机运行时产生漏洞，我们会将可加载库的路径限制在配置中指定的位置。该漏洞由 **Arseniy Dugin** 通过 [ClickHouse Bug Bounty Program](https://github.com/ClickHouse/ClickHouse/issues/38986) 发现。[#75954](https://github.com/ClickHouse/ClickHouse/pull/75954)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 我们曾在某些元数据中使用了 JSON 序列化，这是一个错误，因为 JSON 不支持在字符串字面量中直接包含二进制数据（包括零字节）。SQL 查询可以包含二进制数据和无效的 UTF-8，因此我们也必须在元数据文件中支持这一点。与此同时，ClickHouse 的 `JSONEachRow` 以及类似格式通过在标准 JSON 规范上作出偏离，来确保二进制数据能够实现严格的往返无损。相关动机说明见此处：[https://github.com/ClickHouse/ClickHouse/pull/73668#issuecomment-2560501790](https://github.com/ClickHouse/ClickHouse/pull/73668#issuecomment-2560501790)。解决方案是让 `Poco::JSON` 库与 ClickHouse 中的 JSON 格式序列化保持一致。此更改解决了 [#73668](https://github.com/ClickHouse/ClickHouse/issues/73668)。[#75963](https://github.com/ClickHouse/ClickHouse/pull/75963)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复在执行 DETACH PART 时出现的 `Part <...> does not contain in snapshot of previous virtual parts. (PART_IS_TEMPORARILY_LOCKED)` 错误。 [#76039](https://github.com/ClickHouse/ClickHouse/pull/76039) ([Aleksei Filatov](https://github.com/aalexfvk)).
* 修复对 `S3Queue` 存储中提交次数限制的检查。[#76104](https://github.com/ClickHouse/ClickHouse/pull/76104) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复附加带自动索引（`add_minmax_index_for_numeric_columns`/`add_minmax_index_for_string_columns`）的 MergeTree 表时的问题。 [#76139](https://github.com/ClickHouse/ClickHouse/pull/76139) ([Azat Khuzhin](https://github.com/azat)).
* 修复了作业父线程的堆栈跟踪（受 `enable_job_stack_trace` 设置控制）未输出的问题。修复了 `enable_job_stack_trace` 设置未正确传递到各线程，导致生成的堆栈跟踪内容不总是遵循该设置的问题。[#76191](https://github.com/ClickHouse/ClickHouse/pull/76191) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 在大端架构上修复 `reinterpretAs` 与 `FixedString` 搭配使用时的问题。 [#76253](https://github.com/ClickHouse/ClickHouse/pull/76253) ([Azat Khuzhin](https://github.com/azat)).
* 修复所有由于 UUID 与表名之间竞争导致的各类错误（例如，它会修复 `RENAME` 与 `RESTART REPLICA` 之间的竞争问题。在 `RENAME` 与 `SYSTEM RESTART REPLICA` 并发的情况下，可能会导致重启了错误的副本，和/或将某个表一直停留在 `Table X is being restarted` 状态）。[#76308](https://github.com/ClickHouse/ClickHouse/pull/76308)（[Azat Khuzhin](https://github.com/azat)）。
* 从信号处理程序中移除了分配操作。 [#76446](https://github.com/ClickHouse/ClickHouse/pull/76446) ([Nikita Taranov](https://github.com/nickitat)).
* 修复在淘汰期间处理意外错误时动态文件系统缓存调整大小的问题。 [#76466](https://github.com/ClickHouse/ClickHouse/pull/76466) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复了并行哈希中 `used_flag` 的初始化。这可能会导致服务器崩溃。[#76580](https://github.com/ClickHouse/ClickHouse/pull/76580)（[Nikita Taranov](https://github.com/nickitat)）。
* 修复在投影中调用 `defaultProfiles()` 函数时出现的逻辑错误。[#76627](https://github.com/ClickHouse/ClickHouse/pull/76627)（[pufit](https://github.com/pufit)）。
* 在 Web UI 中的浏览器里不再请求交互式基本身份验证。修复了 [#76319](https://github.com/ClickHouse/ClickHouse/issues/76319)。[#76637](https://github.com/ClickHouse/ClickHouse/pull/76637)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复在从分布式表中查询布尔字面量时出现的 THERE&#95;IS&#95;NO&#95;COLUMN 异常。 [#76656](https://github.com/ClickHouse/ClickHouse/pull/76656) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 表目录中的子路径选择方式更加完善。 [#76681](https://github.com/ClickHouse/ClickHouse/pull/76681) ([Daniil Ivanik](https://github.com/divanik))。
* 修复在对包含子列的主键执行 `ALTER` 后出现的错误 `Not found column in block`。在 [https://github.com/ClickHouse/ClickHouse/pull/72644](https://github.com/ClickHouse/ClickHouse/pull/72644) 之后，还需要 [https://github.com/ClickHouse/ClickHouse/pull/74403](https://github.com/ClickHouse/ClickHouse/pull/74403)。[#76686](https://github.com/ClickHouse/ClickHouse/pull/76686)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 为 null 短路添加性能测试并修复相关缺陷。 [#76708](https://github.com/ClickHouse/ClickHouse/pull/76708) ([李扬](https://github.com/taiyang-li))。
* 在最终完成输出缓冲区之前先刷新它们。修复在某些输出格式最终化过程中产生的 `LOGICAL_ERROR`，例如 `JSONEachRowWithProgressRowOutputFormat`。[#76726](https://github.com/ClickHouse/ClickHouse/pull/76726) ([Antonio Andelic](https://github.com/antonio2368))。
* 为 MongoDB 二进制 UUID 添加了支持（[#74452](https://github.com/ClickHouse/ClickHouse/issues/74452)）- 修复了在使用表函数时对 MongoDB 的 `WHERE` 下推（[#72210](https://github.com/ClickHouse/ClickHouse/issues/72210)）- 修改了 MongoDB 与 ClickHouse 之间的类型映射，使 MongoDB 的二进制 UUID 现在只能解析为 ClickHouse 的 `UUID`。这应当避免将来的歧义和意外情况。- 修复了 `OID` 映射，同时保留向后兼容性。[#76762](https://github.com/ClickHouse/ClickHouse/pull/76762)（[Kirill Nikiforov](https://github.com/allmazz)）。
* 修复在 JSON 子列并行前缀反序列化过程中的异常处理。 [#76809](https://github.com/ClickHouse/ClickHouse/pull/76809) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复 `lgamma` 函数在负整数上的行为。[#76840](https://github.com/ClickHouse/ClickHouse/pull/76840) ([Ilya Kataev](https://github.com/IlyaKataev))。
* 修复对显式定义主键的反向键分析。类似于 [#76654](https://github.com/ClickHouse/ClickHouse/issues/76654)。[#76846](https://github.com/ClickHouse/ClickHouse/pull/76846)（[Amos Bird](https://github.com/amosbird)）。
* 修复 JSON 格式中 Bool 值的美观打印。 [#76905](https://github.com/ClickHouse/ClickHouse/pull/76905) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在异步插入过程中出错时，由于 JSON 列回滚异常可能导致的崩溃。[#76908](https://github.com/ClickHouse/ClickHouse/pull/76908) ([Pavel Kruglov](https://github.com/Avogar)).
* 此前，`multi_if` 在规划阶段和主执行阶段可能返回不同类型的列。这会导致从 C++ 的角度来看属于未定义行为的代码。[#76914](https://github.com/ClickHouse/ClickHouse/pull/76914)（[Nikita Taranov](https://github.com/nickitat)）。
* 修复了 MergeTree 中常量可为空键的错误序列化问题。此修复解决了 [#76939](https://github.com/ClickHouse/ClickHouse/issues/76939)。[#76985](https://github.com/ClickHouse/ClickHouse/pull/76985)（[Amos Bird](https://github.com/amosbird)）。
* 修复 `BFloat16` 值的排序问题。修复了 [#75487](https://github.com/ClickHouse/ClickHouse/issues/75487)。修复了 [#75669](https://github.com/ClickHouse/ClickHouse/issues/75669)。[#77000](https://github.com/ClickHouse/ClickHouse/pull/77000)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 通过在数据片段一致性检查中添加跳过临时子列的检查，修复了带有 `variant` 子列的 JSON 的错误。[#72187](https://github.com/ClickHouse/ClickHouse/issues/72187)。[#77034](https://github.com/ClickHouse/ClickHouse/pull/77034)（[Smita Kulkarni](https://github.com/SmitaRKulkarni)）。
* 修复在 `Values` 格式的模板解析中由于类型不匹配导致的崩溃。 [#77071](https://github.com/ClickHouse/ClickHouse/pull/77071) ([Pavel Kruglov](https://github.com/Avogar)).
* 不再允许在主键中包含子列的 EmbeddedRocksDB 表被创建。此前可以创建此类表，但 `SELECT` 查询会失败。[#77074](https://github.com/ClickHouse/ClickHouse/pull/77074) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复分布式查询中的非法比较问题，因为将谓词下推到远端时未正确处理字面量类型。[#77093](https://github.com/ClickHouse/ClickHouse/pull/77093) ([Duc Canh Le](https://github.com/canhld94)).
* 修复在创建 Kafka 表时因异常导致的崩溃。[#77121](https://github.com/ClickHouse/ClickHouse/pull/77121) ([Pavel Kruglov](https://github.com/Avogar)).
* 在 Kafka 和 RabbitMQ 引擎中支持新的 JSON 及其子列。 [#77122](https://github.com/ClickHouse/ClickHouse/pull/77122) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复 macOS 上的异常栈展开问题。[#77126](https://github.com/ClickHouse/ClickHouse/pull/77126) ([Eduard Karacharov](https://github.com/korowa))。
* 修复在 `getSubcolumn` 函数中读取 `null` 子列的问题。[#77163](https://github.com/ClickHouse/ClickHouse/pull/77163) ([Pavel Kruglov](https://github.com/Avogar))。
* 在 analyzer 中修复包含字面量的表达式导致 `skip indexes` 不生效的问题，并在索引分析期间移除多余的类型转换。 [#77229](https://github.com/ClickHouse/ClickHouse/pull/77229) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复了与 `Array` 以及不受支持函数相关的 bloom filter 索引问题。 [#77271](https://github.com/ClickHouse/ClickHouse/pull/77271) ([Pavel Kruglov](https://github.com/Avogar)).
* 关于表数量的限制应只在最初的 `CREATE` 查询中进行检查。[#77274](https://github.com/ClickHouse/ClickHouse/pull/77274) ([Nikolay Degterinsky](https://github.com/evillique)).
* `SELECT toBFloat16(-0.0) == toBFloat16(0.0)` 现在会正确返回 `true`（此前为 `false`）。这使其行为与 `Float32` 和 `Float64` 保持一致。[#77290](https://github.com/ClickHouse/ClickHouse/pull/77290)（[Shankar Iyer](https://github.com/shankar-iyer)）。
* 修复对未初始化的 `key_index` 变量可能存在的不正确引用，这在 debug 构建中可能导致崩溃（在 release 构建中此未初始化引用不会造成问题，因为后续代码很可能会抛出错误）。### 面向用户可见变更的文档条目。[#77305](https://github.com/ClickHouse/ClickHouse/pull/77305) ([wxybear](https://github.com/wxybear)).
* 已回滚。[#77307](https://github.com/ClickHouse/ClickHouse/pull/77307) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* 修复了 Bool 分区键对应的分区名称。在 [https://github.com/ClickHouse/ClickHouse/pull/74533](https://github.com/ClickHouse/ClickHouse/pull/74533) 中曾被改坏。[#77319](https://github.com/ClickHouse/ClickHouse/pull/77319)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复包含可为空元素的 `Tuple` 与字符串之间的比较问题。举例来说，在此变更之前，`Tuple` `(1, null)` 与字符串 `'(1,null)'` 的比较会导致错误。另一个例子是 `Tuple` `(1, a)`（其中 `a` 是一个 `Nullable` 列）与字符串 `'(1, 2)'` 的比较也会出错。此更改解决了这些问题。[#77323](https://github.com/ClickHouse/ClickHouse/pull/77323)（[Alexey Katsman](https://github.com/alexkats)）。
* 修复 `ObjectStorageQueueSource` 中的崩溃问题。该问题是在 [https://github.com/ClickHouse/ClickHouse/pull/76358](https://github.com/ClickHouse/ClickHouse/pull/76358) 中引入的。[#77325](https://github.com/ClickHouse/ClickHouse/pull/77325)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复了一个错误：`close_session` 查询参数此前不起作用，导致命名会话只有在 `session_timeout` 之后才会被关闭。[#77336](https://github.com/ClickHouse/ClickHouse/pull/77336) ([Alexey Katsman](https://github.com/alexkats))。
* 修复了与 `input()` 搭配使用时的 `async_insert`。[#77340](https://github.com/ClickHouse/ClickHouse/pull/77340)（[Azat Khuzhin](https://github.com/azat)）。
* 修复：当查询规划器移除排序列时，`WITH FILL` 可能因为 `NOT_FOUND_COLUMN_IN_BLOCK` 而失败。类似的问题与为 `INTERPOLATE` 表达式计算出的不一致 DAG 有关。[#77343](https://github.com/ClickHouse/ClickHouse/pull/77343) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 已回退。 [#77390](https://github.com/ClickHouse/ClickHouse/pull/77390) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 修复了在未附加物化视图的情况下从 nats 服务器接收消息的问题。 [#77392](https://github.com/ClickHouse/ClickHouse/pull/77392) ([Dmitry Novikov](https://github.com/dmitry-sles-novikov)).
* 修复通过 `merge` 表函数从空 `FileLog` 读取时的逻辑错误，关闭 [#75575](https://github.com/ClickHouse/ClickHouse/issues/75575)。[#77441](https://github.com/ClickHouse/ClickHouse/pull/77441)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 修复了在为无效 AST 节点设置别名时触发的若干 `LOGICAL_ERROR`。[#77445](https://github.com/ClickHouse/ClickHouse/pull/77445)（[Raúl Marín](https://github.com/Algunenano)）。
* 在 filesystem cache 的实现中，修复了文件段写入过程中的错误处理。[#77471](https://github.com/ClickHouse/ClickHouse/pull/77471) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 让 DatabaseIceberg 使用由 catalog 提供的正确元数据文件。修复 [#75187](https://github.com/ClickHouse/ClickHouse/issues/75187)。[#77486](https://github.com/ClickHouse/ClickHouse/pull/77486)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 在从 shared variant 进行 Dynamic 序列化时，使用默认格式设置。[#77572](https://github.com/ClickHouse/ClickHouse/pull/77572) ([Pavel Kruglov](https://github.com/Avogar))。
* 回滚“在执行标量子查询时避免使用 toAST()”的更改。[#77584](https://github.com/ClickHouse/ClickHouse/pull/77584)（[Raúl Marín](https://github.com/Algunenano)）。
* 修复在本地磁盘上检查表数据路径是否存在的逻辑。 [#77608](https://github.com/ClickHouse/ClickHouse/pull/77608) ([Tuan Pham Anh](https://github.com/tuanpach)).
* 查询缓存现在假定 UDF 为非确定性函数。因此，包含 UDF 的查询结果将不再被缓存。此前，用户可以定义非确定性的 UDF，而其结果会被错误地缓存（问题 [#77553](https://github.com/ClickHouse/ClickHouse/issues/77553)）。[#77633](https://github.com/ClickHouse/ClickHouse/pull/77633)（[Jimmy Aguilar Mena](https://github.com/Ergus)）。
* 修复在某些类型上向远程端发送常量值的行为。[#77634](https://github.com/ClickHouse/ClickHouse/pull/77634) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复 `system.filesystem_cache_log` 仅在启用设置 `enable_filesystem_cache_log` 时才生效的问题。 [#77650](https://github.com/ClickHouse/ClickHouse/pull/77650) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复在投影中调用 `defaultRoles()` 函数时出现的逻辑错误。作为对 [#76627](https://github.com/ClickHouse/ClickHouse/issues/76627) 的后续修复。[#77667](https://github.com/ClickHouse/ClickHouse/pull/77667)（[pufit](https://github.com/pufit)）。
* 修复由于上下文过期导致的 StorageS3(Azure)Queue 崩溃问题。 [#77720](https://github.com/ClickHouse/ClickHouse/pull/77720) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 现在不再允许函数 `arrayResize` 的第二个参数为 `Nullable` 类型。此前，当第二个参数为 `Nullable` 时，可能会出现从报错到结果错误等各种问题。（issue [#48398](https://github.com/ClickHouse/ClickHouse/issues/48398)）。[#77724](https://github.com/ClickHouse/ClickHouse/pull/77724)（[Manish Gill](https://github.com/mgill25)）。
* 在 RabbitMQ、Nats、Redis 和 AzureQueue 表引擎中隐藏凭据。 [#77755](https://github.com/ClickHouse/ClickHouse/pull/77755) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复 ArgMin/ArgMax 在与 NaN 比较时的未定义行为。[#77756](https://github.com/ClickHouse/ClickHouse/pull/77756)（[Raúl Marín](https://github.com/Algunenano)）。
* 即使在操作不会产生任何要写入的数据块时，也要定期检查合并和变更是否被取消。 [#77766](https://github.com/ClickHouse/ClickHouse/pull/77766) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* 已回退。[#77843](https://github.com/ClickHouse/ClickHouse/pull/77843) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 修复在出现 `NOT_FOUND_COLUMN_IN_BLOCK` 错误时可能发生的崩溃。[#77854](https://github.com/ClickHouse/ClickHouse/pull/77854) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 修复在为 `StorageSystemObjectStorageQueueSettings` 填充数据时发生的崩溃问题。 [#77878](https://github.com/ClickHouse/ClickHouse/pull/77878) ([Bharat Nallan](https://github.com/bharatnc)).
* 在 SSH 服务器中禁用历史记录的模糊搜索功能（因为它依赖 `skim`）。 [#78002](https://github.com/ClickHouse/ClickHouse/pull/78002) ([Azat Khuzhin](https://github.com/azat)).
* 修复了一个错误：当在未建立索引的列上执行向量搜索查询时，如果表中存在另一列已经定义了向量相似度索引的向量列，则会返回不正确的结果。（Issue [#77978](https://github.com/ClickHouse/ClickHouse/issues/77978)）。[#78069](https://github.com/ClickHouse/ClickHouse/pull/78069)（[Shankar Iyer](https://github.com/shankar-iyer)）。
* 修复 `The requested output format {} is binary... Do you want to output it anyway? [y/N]` 提示。[#78095](https://github.com/ClickHouse/ClickHouse/pull/78095)（[Azat Khuzhin](https://github.com/azat)）。
* 修复了在 `toStartOfInterval` 使用起点为零的参数时的一个错误。[#78096](https://github.com/ClickHouse/ClickHouse/pull/78096)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 禁止在 HTTP 接口中传入空的 `session_id` 查询参数。 [#78098](https://github.com/ClickHouse/ClickHouse/pull/78098) ([Alexey Katsman](https://github.com/alexkats)).
* 修复了 `Database Replicated` 中的元数据被错误覆盖的问题，该问题可能在执行 `ALTER` 查询后紧接着执行 `RENAME` 查询时出现。 [#78107](https://github.com/ClickHouse/ClickHouse/pull/78107) ([Nikolay Degterinsky](https://github.com/evillique))。
* 修复 NATS 引擎中的崩溃。 [#78108](https://github.com/ClickHouse/ClickHouse/pull/78108) ([Dmitry Novikov](https://github.com/dmitry-sles-novikov)).
* 不要尝试在 SSH 嵌入式客户端中创建 `history_file`。 [#78112](https://github.com/ClickHouse/ClickHouse/pull/78112) ([Azat Khuzhin](https://github.com/azat)).
* 修复在执行 RENAME DATABASE 或 DROP TABLE 查询后 `system.detached_tables` 显示不正确信息的问题。[#78126](https://github.com/ClickHouse/ClickHouse/pull/78126)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 在 [https://github.com/ClickHouse/ClickHouse/pull/77274](https://github.com/ClickHouse/ClickHouse/pull/77274) 之后，修复了在使用 `Database Replicated` 时对表数量过多的检查。同时，将该检查提前到创建存储之前执行，以避免在 RMT 或 `KeeperMap` 场景下在 ZooKeeper 中创建未被统计的节点。[#78127](https://github.com/ClickHouse/ClickHouse/pull/78127)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 修复因并发进行 S3Queue 元数据初始化而可能导致的崩溃。[#78131](https://github.com/ClickHouse/ClickHouse/pull/78131) ([Azat Khuzhin](https://github.com/azat))。
* `groupArray*` 函数现在在 `max_size` 参数为 Int 类型且值为 0 时会抛出 `BAD_ARGUMENTS` 错误，与此前对 UInt 类型参数的处理方式保持一致，而不是在该值下尝试继续执行。 [#78140](https://github.com/ClickHouse/ClickHouse/pull/78140) ([Eduard Karacharov](https://github.com/korowa)).
* 如果本地表在分离之前就被删除，避免在执行 recoverLostReplica 时发生崩溃。 [#78173](https://github.com/ClickHouse/ClickHouse/pull/78173) ([Raúl Marín](https://github.com/Algunenano)).
* 修复 `system.s3_queue_settings` 中 &quot;alterable&quot; 列始终返回 `false` 的问题。 [#78187](https://github.com/ClickHouse/ClickHouse/pull/78187) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 对 Azure 访问签名进行脱敏处理，使其对用户不可见且不会出现在日志中。 [#78189](https://github.com/ClickHouse/ClickHouse/pull/78189) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复 Wide 部分中带前缀子流的预取问题。 [#78205](https://github.com/ClickHouse/ClickHouse/pull/78205) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复了在键数组类型为 `LowCardinality(Nullable)` 时，`mapFromArrays` 发生崩溃或产生错误结果的问题。[#78240](https://github.com/ClickHouse/ClickHouse/pull/78240) ([Eduard Karacharov](https://github.com/korowa)).
* 修复 delta-kernel 身份验证选项。[#78255](https://github.com/ClickHouse/ClickHouse/pull/78255) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 当副本的 `disable_insertion_and_mutation` 为 true 时，不再调度 RefreshMV 任务。由于该任务本质上是一次插入操作，如果 `disable_insertion_and_mutation` 为 true，则任务会失败。 [#78277](https://github.com/ClickHouse/ClickHouse/pull/78277) ([Xu Jia](https://github.com/XuJia0210)).
* 验证对 Merge 引擎底层表的访问权限。[#78339](https://github.com/ClickHouse/ClickHouse/pull/78339) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* `Distributed` 引擎表的 FINAL 修饰符可能会被忽略。[#78428](https://github.com/ClickHouse/ClickHouse/pull/78428) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* `Bitmapmin` 在位图为空时返回 uint32&#95;max（当输入类型 ≥ 8 位时返回 uint64&#95;max），这与空 `roaring_bitmap` 的 `minimum()` 行为一致。 [#78444](https://github.com/ClickHouse/ClickHouse/pull/78444) ([wxybear](https://github.com/wxybear)).
* 回退“在代码部分位置应用 `preserve_most` 属性”的更改，因为它可能导致崩溃。[#78449](https://github.com/ClickHouse/ClickHouse/pull/78449) ([Azat Khuzhin](https://github.com/azat))。
* 对 INFILE 的模式推断使用插入列。 [#78490](https://github.com/ClickHouse/ClickHouse/pull/78490) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* 在启用 `distributed_aggregation_memory_efficient` 时，禁用在读取 `FROM` 之后立即并行化查询处理的行为，否则可能导致逻辑错误。修复 [#76934](https://github.com/ClickHouse/ClickHouse/issues/76934)。[#78500](https://github.com/ClickHouse/ClickHouse/pull/78500)（[flynn](https://github.com/ucasfl)）。
* 在应用 `max_streams_to_max_threads_ratio` 设置后，如果计划的流数量为零，则至少为读取设置一个流。[#78505](https://github.com/ClickHouse/ClickHouse/pull/78505) ([Eduard Karacharov](https://github.com/korowa)).
* 在 S3Queue 存储中修复了逻辑错误 “Cannot unregister: table uuid is not registered”。关闭 [#78285](https://github.com/ClickHouse/ClickHouse/issues/78285)。[#78541](https://github.com/ClickHouse/ClickHouse/pull/78541)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* ClickHouse 现在能够在同时启用 cgroup v1 和 v2 的系统上自动识别其 cgroup v2。[#78566](https://github.com/ClickHouse/ClickHouse/pull/78566)（[Grigory Korolev](https://github.com/gkorolev)）。
* `ObjectStorage` 集群表函数在与表级设置一起使用时会失败。 [#78587](https://github.com/ClickHouse/ClickHouse/pull/78587) ([Daniil Ivanik](https://github.com/divanik)).
* ReplicatedMergeTree 在执行 `INSERT` 时不支持更完善的事务检查。[#78633](https://github.com/ClickHouse/ClickHouse/pull/78633) ([Azat Khuzhin](https://github.com/azat))。
* 在附加过程中应用查询设置。 [#78637](https://github.com/ClickHouse/ClickHouse/pull/78637) ([Raúl Marín](https://github.com/Algunenano)).
* 修复了在 `iceberg_metadata_file_path` 中指定无效路径时会发生的崩溃。[#78688](https://github.com/ClickHouse/ClickHouse/pull/78688) ([alesapin](https://github.com/alesapin))。
* 在使用 delta-kernel 实现的 DeltaLake 表引擎中，修复了在读取模式与表模式不一致且同时存在分区列时导致“找不到列”错误的问题。 [#78690](https://github.com/ClickHouse/ClickHouse/pull/78690) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 此更新修复了一个 bug：当新建的命名会话与之前的会话同名，且是在旧会话超时时间到期之前创建时，新会话会在旧会话预定的结束时间被意外关闭。[#78698](https://github.com/ClickHouse/ClickHouse/pull/78698)（[Alexey Katsman](https://github.com/alexkats)）。
* 在运行 CHECK TABLE 时，不再阻塞表的关闭。 [#78782](https://github.com/ClickHouse/ClickHouse/pull/78782) ([Raúl Marín](https://github.com/Algunenano)).
* Keeper 修复：在所有情况下修正 `ephemeral` 计数。[#78799](https://github.com/ClickHouse/ClickHouse/pull/78799) ([Antonio Andelic](https://github.com/antonio2368))。
* 修复在使用除 `view()` 之外的表函数时，`StorageDistributed` 中错误的类型转换。修复 [#78464](https://github.com/ClickHouse/ClickHouse/issues/78464)。[#78828](https://github.com/ClickHouse/ClickHouse/pull/78828)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 修复 `tupleElement(*, 1)` 的格式化问题。关闭 [#78639](https://github.com/ClickHouse/ClickHouse/issues/78639)。[#78832](https://github.com/ClickHouse/ClickHouse/pull/78832)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 类型为 `ssd_cache` 的字典现在会拒绝 `block_size` 和 `write_buffer_size` 为零或负数的参数（问题 [#78314](https://github.com/ClickHouse/ClickHouse/issues/78314)）。[#78854](https://github.com/ClickHouse/ClickHouse/pull/78854)（[Elmi Ahmadov](https://github.com/ahmadov)）。
* 修复在异常关闭后执行 `ALTER` 时，`REFRESHABLE MV` 出现崩溃的问题。 [#78858](https://github.com/ClickHouse/ClickHouse/pull/78858) ([Azat Khuzhin](https://github.com/azat)).
* 修复在 CSV 格式中解析无效 `DateTime` 值的问题。 [#78919](https://github.com/ClickHouse/ClickHouse/pull/78919) ([Pavel Kruglov](https://github.com/Avogar)).





## 构建/测试/打包改进 {#build-testing-packaging-improvement}


* 内部依赖 LLVM 从 16 升级至 18。[#66053](https://github.com/ClickHouse/ClickHouse/pull/66053)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 恢复已删除的 nats 集成测试并修复错误。 - 修复了 nats 引擎中的一些竞态条件 - 修复了在连接丢失情况下向 nats 进行流式写入时的数据丢失问题 - 修复了从 nats 进行流式读取结束时接收最后一块数据可能发生的卡死问题 - `nats_max_reconnect` 已被弃用且不再生效，重连将始终进行，其间隔由 `nats_reconnect_wait` 超时时间控制。 [#69772](https://github.com/ClickHouse/ClickHouse/pull/69772) ([Dmitry Novikov](https://github.com/dmitry-sles-novikov)).
* 修复 `contrib openssl` 的 asm 文件无法生成的问题。[#72622](https://github.com/ClickHouse/ClickHouse/pull/72622) ([RinChanNOW](https://github.com/RinChanNOWWW))。
* 修复测试 03210&#95;variant&#95;with&#95;aggregate&#95;function&#95;type 的稳定性问题。 [#74012](https://github.com/ClickHouse/ClickHouse/pull/74012) ([Anton Ivashkin](https://github.com/ianton-ru)).
* 支持在 ARM 和 Intel 架构的 Mac 上构建 HDFS。 [#74244](https://github.com/ClickHouse/ClickHouse/pull/74244) ([Yan Xin](https://github.com/yxheartipp)).
* 通用安装脚本现在会在 macOS 上同样提示进行安装。 [#74339](https://github.com/ClickHouse/ClickHouse/pull/74339) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 在未启用 Kerberos 时修复构建问题。[#74771](https://github.com/ClickHouse/ClickHouse/pull/74771) ([flynn](https://github.com/ucasfl))。
* 更新嵌入式 LLVM 至 19 版。[#75148](https://github.com/ClickHouse/ClickHouse/pull/75148)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* *可能存在不兼容变更*：改进以设置更为严格的默认值。目前的默认配置已经是安全的。用户必须显式指定选项才能公开端口。但当 `default` 用户没有通过环境变量 `CLICKHOUSE_PASSWORD` 设置密码和/或没有通过 `CLICKHOUSE_USER` 修改用户名时，它应当只能从本地系统访问，作为额外一层防护。[#75259](https://github.com/ClickHouse/ClickHouse/pull/75259)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* 集成测试对单个并行测试批次设置了 1 小时的超时时间。当达到该超时时间时，`pytest` 会被强制终止，因此可能缺少部分日志。内部的 pytest 超时时间被设置为 55 分钟，以便能够打印会话结果并避免触发外部超时信号。关闭 [#75532](https://github.com/ClickHouse/ClickHouse/issues/75532)。[#75533](https://github.com/ClickHouse/ClickHouse/pull/75533)（[Ilya Yatsishin](https://github.com/qoega)）。
* 将所有与 clickhouse-server 相关的操作封装为函数，并仅在 `entrypoint.sh` 中启动默认二进制文件时执行。在 [#50724](https://github.com/ClickHouse/ClickHouse/issues/50724) 中提出了这一长期搁置的改进。为 `clickhouse-extract-from-config` 增加了 `--users` 开关，用于从 `users.xml` 中获取值。[#75643](https://github.com/ClickHouse/ClickHouse/pull/75643)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* 对于压力测试，如果在通过 gdb 收集堆栈跟踪时服务器没有退出，将增加额外的等待时间，以减少 `Possible deadlock on shutdown (see gdb.log)` 检测的噪声。只有在测试未成功完成时才会增加这段延迟。[#75668](https://github.com/ClickHouse/ClickHouse/pull/75668) ([Ilya Yatsishin](https://github.com/qoega))。
* 恢复已删除的 nats 集成测试并修复错误。- 修复了 nats 引擎中的一些竞态条件 - 修复了在连接丢失情况下向 nats 进行数据流式传输时可能发生的数据丢失问题 - 修复了从 nats 流式传输结束时接收最后一个数据块时出现冻结的问题 - `nats_max_reconnect` 已弃用且不再生效，重连将持续进行，并使用 `nats_reconnect_wait` 作为等待间隔。[#75850](https://github.com/ClickHouse/ClickHouse/pull/75850) ([Dmitry Novikov](https://github.com/dmitry-sles-novikov)).
* 在为 Darwin 进行交叉编译时启用 ICU 和 gRPC。 [#75922](https://github.com/ClickHouse/ClickHouse/pull/75922) ([Raúl Marín](https://github.com/Algunenano))。
* 修复由于在终止进程组时使用 `sleep` 导致拆分测试输出异常的问题。[#76090](https://github.com/ClickHouse/ClickHouse/pull/76090) ([Mikhail f. Shiryaev](https://github.com/Felixoid)).
* 不要在运行结束时再收集 `docker-compose` 日志，因为脚本经常会被杀死。应改为在后台收集这些日志。 [#76140](https://github.com/ClickHouse/ClickHouse/pull/76140) ([Mikhail f. Shiryaev](https://github.com/Felixoid)).
* 将 Kafka 存储的测试拆分到多个文件中。修复了 [#69452](https://github.com/ClickHouse/ClickHouse/issues/69452)。[#76208](https://github.com/ClickHouse/ClickHouse/pull/76208)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* `clickhouse-odbc-bridge` 和 `clickhouse-library-bridge` 已迁移到独立仓库：[https://github.com/ClickHouse/odbc-bridge/](https://github.com/ClickHouse/odbc-bridge/)。[#76225](https://github.com/ClickHouse/ClickHouse/pull/76225)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 从二进制文件中移除约 20MB 的冗余代码。 [#76226](https://github.com/ClickHouse/ClickHouse/pull/76226) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 由于引入 `block()`，将最低要求的 CMake 版本提升至 3.25。[#76316](https://github.com/ClickHouse/ClickHouse/pull/76316) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* 将 fmt 更新为 11.1.3。 [#76547](https://github.com/ClickHouse/ClickHouse/pull/76547) ([Raúl Marín](https://github.com/Algunenano))。
* 将 `lz4` 升级至 `1.10.0`。 [#76571](https://github.com/ClickHouse/ClickHouse/pull/76571) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 将 `curl` 升级至 `8.12.1`。[#76572](https://github.com/ClickHouse/ClickHouse/pull/76572)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 将 `libcpuid` 升级至 `0.7.1`。[#76573](https://github.com/ClickHouse/ClickHouse/pull/76573) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 使用机器可读格式来解析 `pytest` 结果。[#76910](https://github.com/ClickHouse/ClickHouse/pull/76910)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* 修复 Rust 交叉编译，并允许完全禁用 Rust。 [#76921](https://github.com/ClickHouse/ClickHouse/pull/76921) ([Raúl Marín](https://github.com/Algunenano))。
* 构建该项目需要 clang 19。 [#76945](https://github.com/ClickHouse/ClickHouse/pull/76945) ([Raúl Marín](https://github.com/Algunenano)).
* 该测试在串行模式下执行时间超过 10 秒，对快速测试来说过长。[#76948](https://github.com/ClickHouse/ClickHouse/pull/76948)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* 将 `sccache` 升级到 `0.10.0`。 [#77580](https://github.com/ClickHouse/ClickHouse/pull/77580) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 在 Rust 中遵循 CPU 目标特性，并在所有 crate 中启用 LTO。[#78590](https://github.com/ClickHouse/ClickHouse/pull/78590) ([Raúl Marín](https://github.com/Algunenano))。
* 将 `minizip-ng` 更新至 `4.0.9`。[#78917](https://github.com/ClickHouse/ClickHouse/pull/78917)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
