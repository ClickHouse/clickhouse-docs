---
slug: /changelogs/25.4
title: 'v25.4 Cloud 更新日志'
description: 'v25.4 快速发布版本更新日志'
keywords: ['更新日志', '云']
sidebar_label: '25.4'
sidebar_position: 4
doc_type: 'changelog'
---

## 向后不兼容的变更 {#backward-incompatible-changes}

* Parquet 输出格式会将 Date 和 DateTime 列转换为 Parquet 支持的日期/时间类型，而不是将它们写为原始数值。DateTime 现在改为 DateTime64(3)（之前为：UInt32）；设置 `output_format_parquet_datetime_as_uint32` 可以恢复旧行为。Date 现在改为 Date32（之前为：UInt16）。[#70950](https://github.com/ClickHouse/ClickHouse/pull/70950)（[Michael Kolupaev](https://github.com/al13n321)）。
* 默认情况下，不允许在 ORDER BY 和 `less/greater/equal/etc` 等比较函数中使用类似 JSON/Object/AggregateFunction 的可比较类型。[#73276](https://github.com/ClickHouse/ClickHouse/pull/73276)（[Pavel Kruglov](https://github.com/Avogar)）。
* `JSONEachRowWithProgress` 会在每当有进度时写出进度。在之前的版本中，只在结果的每个数据块之后才显示进度，这使得它几乎毫无用处。对进度的显示方式进行了修改：不再显示为零的数值。请注意，即使进度变化很频繁，也会发送进度信息，这可能会产生大量网络流量。还要注意，当输出被压缩时，进度不会被刷新。修复了 [#70800](https://github.com/ClickHouse/ClickHouse/issues/70800)。[#73834](https://github.com/ClickHouse/ClickHouse/pull/73834)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `mysql` 字典源不再执行 `SHOW TABLE STATUS` 查询，因为对于 InnoDB 表以及任何较新的 MySQL 版本，这个查询都不再提供任何有效信息。此更改解决了 [#72636](https://github.com/ClickHouse/ClickHouse/issues/72636)。该更改是向后兼容的，但仍被归类在本节中，以便您有机会注意到它。[#73914](https://github.com/ClickHouse/ClickHouse/pull/73914)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `Merge` 表将通过取其列的并集并推导出公共类型来统一底层表的结构。这修复了 [#64864](https://github.com/ClickHouse/ClickHouse/issues/64864)。这修复了 [#35307](https://github.com/ClickHouse/ClickHouse/issues/35307)。在某些情况下，此更改可能会引入向后不兼容。一个例子是，当各个表之间不存在公共类型，但仍然可以转换为第一个表的类型时，例如 UInt64 和 Int64 的情况，或者任意数值类型与 String 的情况。如果你想恢复旧的行为，请将 `merge_table_max_tables_to_look_for_schema_inference` 设置为 `1`，或将 `compatibility` 设置为 `24.12` 或更早版本。[#73956](https://github.com/ClickHouse/ClickHouse/pull/73956)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `CHECK TABLE` 查询现在需要单独的 `CHECK` 权限。在之前的版本中，仅具有 `SHOW TABLES` 权限就足以运行这些查询。但是，`CHECK TABLE` 查询可能会非常耗费资源，而且针对 `SELECT` 查询的常规查询复杂度限制并不适用于它。这带来了潜在的 DoS 攻击风险。[#74471](https://github.com/ClickHouse/ClickHouse/pull/74471)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 当 `allow_materialized_view_with_bad_select` 为 `false` 时，校验物化视图中的所有列是否与目标表一致。 [#74481](https://github.com/ClickHouse/ClickHouse/pull/74481) ([Christoph Wurm](https://github.com/cwurm)).
* 函数 `h3ToGeo()` 现在按 `(lat, lon)` 顺序返回结果（这是几何函数中的标准顺序）。希望保留旧版结果顺序 `(lon, lat)` 的用户可以将设置 `h3togeo_lon_lat_result_order` 设为 `true`。 [#74719](https://github.com/ClickHouse/ClickHouse/pull/74719) ([Manish Gill](https://github.com/mgill25))。
* 添加 `JSONCompactEachRowWithProgress` 和 `JSONCompactStringsEachRowWithProgress` 格式，作为对 [#69989](https://github.com/ClickHouse/ClickHouse/issues/69989) 的后续工作。`JSONCompactWithNames` 和 `JSONCompactWithNamesAndTypes` 不再输出“totals”——显然这是之前实现中的一个错误。[#75037](https://github.com/ClickHouse/ClickHouse/pull/75037) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 将 `format_alter_operations_with_parentheses` 的默认值改为 true，以使 ALTER 命令列表的输出不产生歧义（参见 [https://github.com/ClickHouse/ClickHouse/pull/59532](https://github.com/ClickHouse/ClickHouse/pull/59532)）。这会导致与 24.3 之前版本的集群之间的复制失败。如果正在升级使用旧版本的集群，请在服务器配置中关闭该设置，或者先升级到 24.3。 [#75302](https://github.com/ClickHouse/ClickHouse/pull/75302) ([Raúl Marín](https://github.com/Algunenano))。
* 禁止对复制数据库执行 `TRUNCATE DATABASE` 操作。 [#76651](https://github.com/ClickHouse/ClickHouse/pull/76651) ([Bharat Nallan](https://github.com/bharatnc)).
* 当禁用 `analyzer` 时，将默认禁用并行副本，与 `compatibility` 设置无关。仍然可以通过将 `parallel_replicas_only_with_analyzer` 显式设置为 `false` 来更改此行为。[#77115](https://github.com/ClickHouse/ClickHouse/pull/77115)（[Igor Nikonov](https://github.com/devcrafter)）。
* 现在不再允许在设置中将 `NaN` 或 `inf` 作为浮点数值使用。[#77546](https://github.com/ClickHouse/ClickHouse/pull/77546)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 修复了在将 `dateTrunc` 与负数日期/日期时间参数一起使用时的情况。[#77622](https://github.com/ClickHouse/ClickHouse/pull/77622) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 旧版 MongoDB 集成已被移除。服务器端设置 `use_legacy_mongodb_integration` 已废弃，现已不再产生任何作用。[#77895](https://github.com/ClickHouse/ClickHouse/pull/77895)（[Robert Schulze](https://github.com/rschu1ze)）。
* 增强 SummingMergeTree 的验证逻辑，使其对作为分区键或排序键的列跳过聚合。 [#78022](https://github.com/ClickHouse/ClickHouse/pull/78022) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).

## 新功能 {#new-features}

* 为反序列化后的 skipping 索引 granule 新增了一个内存缓存。这应当能够加速重复使用 skipping 索引的查询。新缓存的大小由服务器设置 `skipping_index_cache_size` 和 `skipping_index_cache_max_entries` 控制。引入该缓存的最初动机是向量相似度索引，这些索引现在已经快得多。[#70102](https://github.com/ClickHouse/ClickHouse/pull/70102) ([Robert Schulze](https://github.com/rschu1ze))。
* 全新的用户空间页面缓存（Userspace Page Cache）实现，允许在进程内存中缓存数据，而不是依赖操作系统的页面缓存。当数据存储在远程虚拟文件系统中且没有本地文件系统缓存作为后盾时，这一特性非常有用。[#70509](https://github.com/ClickHouse/ClickHouse/pull/70509)（[Michael Kolupaev](https://github.com/al13n321)）。
* 新增设置，用于按指定时间戳查询 Iceberg 表。[#71072](https://github.com/ClickHouse/ClickHouse/pull/71072) ([Brett Hoerner](https://github.com/bretthoerner))。
* 在 Iceberg 中为与时间相关的转换分区操作实现 Iceberg 表的分区剪枝。[#72044](https://github.com/ClickHouse/ClickHouse/pull/72044) ([Daniil Ivanik](https://github.com/divanik)).
* 新增通过设置 `enable_minmax_index_for_all_numeric_columns`（数值列）和 `enable_minmax_index_for_all_string_columns`（字符串列），为由 MergeTree 管理的列默认创建 min-max（跳过）索引的能力。目前这两个设置均为禁用状态，因此行为上暂时没有变化。[#72090](https://github.com/ClickHouse/ClickHouse/pull/72090)（[Smita Kulkarni](https://github.com/SmitaRKulkarni)）。
* 新增聚合函数 sequenceMatchEvents，用于在给定模式中，为最长的一条事件链返回其各事件的时间戳。 [#72349](https://github.com/ClickHouse/ClickHouse/pull/72349) ([UnamedRus](https://github.com/UnamedRus)).
* `SELECT` 和 `VIEW` 语句现在支持别名，例如：`SELECT b FROM (SELECT number, number*2 FROM numbers(2)) AS x (a, b);`。这使得 TPC-H 查询 15 无需修改即可运行。[#72480](https://github.com/ClickHouse/ClickHouse/pull/72480)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 新增了一个设置项 `enable_adaptive_memory_spill_scheduler`，允许在同一查询中对多个 grace JOIN 的总体内存占用进行监控，并以自适应方式触发将数据溢写到外部存储，以防止 MEMORY&#95;LIMIT&#95;EXCEEDED。 [#72728](https://github.com/ClickHouse/ClickHouse/pull/72728) ([lgbo](https://github.com/lgbo-ustc))。
* 新增了函数 `arrayNormalizedGini`。 [#72823](https://github.com/ClickHouse/ClickHouse/pull/72823) ([flynn](https://github.com/ucasfl)).
* 支持低基数 Decimal 数据类型，并修复 [#72256](https://github.com/ClickHouse/ClickHouse/issues/72256)。[#72833](https://github.com/ClickHouse/ClickHouse/pull/72833)（[zhanglistar](https://github.com/zhanglistar)）。
* 当同时启用 `min_age_to_force_merge_seconds` 和 `min_age_to_force_merge_on_partition_only` 时，数据片段合并将忽略最大字节数限制。[#73656](https://github.com/ClickHouse/ClickHouse/pull/73656) ([Kai Zhu](https://github.com/nauu))。
* 支持从 Apache Arrow/Parquet/ORC 读取 HALF&#95;FLOAT 值（会被读取为 Float32）。已关闭 [#72960](https://github.com/ClickHouse/ClickHouse/issues/72960)。请注意，IEEE-754 的 half float 与 BFloat16 并不相同。已关闭 [#73835](https://github.com/ClickHouse/ClickHouse/issues/73835)。[#73836](https://github.com/ClickHouse/ClickHouse/pull/73836)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `system.trace_log` 表将包含两个新列：`symbols` 和 `lines`，其中存储符号化的堆栈跟踪。这使得收集和导出性能分析信息更加方便。该行为由服务器配置中 `trace_log` 部分的 `symbolize` 配置项控制，且默认启用。[#73896](https://github.com/ClickHouse/ClickHouse/pull/73896)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 添加新函数 `generateSerialID`，可用于在表中生成自增序号。延续了 [kazalika](https://github.com/kazalika) 的 [#64310](https://github.com/ClickHouse/ClickHouse/issues/64310) 工作。此更改关闭了 [#62485](https://github.com/ClickHouse/ClickHouse/issues/62485)。[#73950](https://github.com/ClickHouse/ClickHouse/pull/73950)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 添加语法 `query1 PARALLEL WITH query2 PARALLEL WITH query3 ... PARALLEL WITH queryN`。这意味着允许子查询 `{query1, query2, ... queryN}` 彼此并行运行（并且推荐这样做）。[#73983](https://github.com/ClickHouse/ClickHouse/pull/73983) ([Vitaly Baranov](https://github.com/vitlibar))。
* 现在，Play UI 在查询运行期间会显示进度条，并允许取消查询。它会显示记录总数以及关于速度的详细信息。数据一到达，表格就可以增量渲染。启用了 HTTP 压缩后，表格渲染速度变得更快。表头现在为固定显示。它支持选中单元格，并可通过方向键在单元格间导航。修复了选中单元格的描边会使其变小的问题。单元格不再在鼠标悬停时扩展，而只会在选中时扩展。停止渲染传入数据的时机现在由客户端而不是服务器端决定。为数字的分组高亮显示。整体设计进行了焕新，并变得更加醒目。它会检查服务器是否可达、凭证是否正确，并显示服务器版本和运行时间。云图标在每种字体中都是描边样式，即便是在 Safari 中也是如此。嵌套数据类型中的大整数将拥有更好的显示效果。将正确显示 inf/nan。鼠标悬停在列标题上时，将显示数据类型。[#74204](https://github.com/ClickHouse/ClickHouse/pull/74204)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 通过设置 `add_minmax_index_for_numeric_columns`（用于数值列）和 `add_minmax_index_for_string_columns`（用于字符串列），新增支持为由 MergeTree 管理的列默认创建 min-max（跳过）索引。目前这两个设置均为禁用状态，因此尚不会改变现有行为。[#74266](https://github.com/ClickHouse/ClickHouse/pull/74266)（[Smita Kulkarni](https://github.com/SmitaRKulkarni)）。
* 将 `script_query_number` 和 `script_line_number` 字段添加到 `system.query_log`、原生协议中的 ClientInfo，以及服务器日志中。由此解决了 [#67542](https://github.com/ClickHouse/ClickHouse/issues/67542)。感谢 [pinsvin00](https://github.com/pinsvin00) 早先在 [#68133](https://github.com/ClickHouse/ClickHouse/issues/68133) 中发起该特性。[#74477](https://github.com/ClickHouse/ClickHouse/pull/74477)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 为 DateTime64 增加减号运算符支持，以便支持在 DateTime64 值之间以及与 DateTime 之间进行减法运算。[#74482](https://github.com/ClickHouse/ClickHouse/pull/74482) ([Li Yin](https://github.com/liyinsg)).
* 为 AzureBlobStorage 添加对 DeltaLake 表引擎的支持。修复了 [#68043](https://github.com/ClickHouse/ClickHouse/issues/68043)。[#74541](https://github.com/ClickHouse/ClickHouse/pull/74541)（[Smita Kulkarni](https://github.com/SmitaRKulkarni)）。
* 添加 bind&#95;host 设置，用于指定 ClickHouse 客户端连接的源 IP 地址。[#74741](https://github.com/ClickHouse/ClickHouse/pull/74741)（[Todd Yocum](https://github.com/toddyocum)）。
* 新增支持在提交后执行 `SELECT` 查询时，即时应用未完成的（尚未由后台进程物化的）mutation。可以通过设置 `apply_mutations_on_fly` 来启用该功能。[#74877](https://github.com/ClickHouse/ClickHouse/pull/74877) ([Anton Popov](https://github.com/CurtizJ))。
* 修复了此前在 `toStartOfInterval` 的 datetime 参数为负数时出现的一些未预期情况。通过实现一个名为 toStartOfIntervalAllowNegative 的新函数来完成，该函数基本执行相同的操作，但只返回 Date32/DateTime64。[#74933](https://github.com/ClickHouse/ClickHouse/pull/74933) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 新增了一个函数 initialQueryStartTime。它返回当前查询的开始时间。在分布式查询中，该值在所有分片中都是相同的。[#75087](https://github.com/ClickHouse/ClickHouse/pull/75087)（[Roman Lomonosov](https://github.com/lomik)）。
* 在 system.tables 中新增 `parametrized_view_parameters` 字段。关闭 [https://github.com/clickhouse/clickhouse/issues/66756](https://github.com/clickhouse/clickhouse/issues/66756)。[#75112](https://github.com/ClickHouse/ClickHouse/pull/75112)（[NamNguyenHoai](https://github.com/NamHoaiNguyen)）。
* 允许修改数据库注释。关闭 [#73351](https://github.com/ClickHouse/ClickHouse/issues/73351) ### 关于用户可见变更的文档条目。 [#75622](https://github.com/ClickHouse/ClickHouse/pull/75622) ([NamNguyenHoai](https://github.com/NamHoaiNguyen)).
* 新增对在没有数据库层的情况下 ATTACH 表的支持（避免使用 UUID hack）。 [#75788](https://github.com/ClickHouse/ClickHouse/pull/75788) ([Azat Khuzhin](https://github.com/azat)).
* 新增了 `concurrent_threads_scheduler` 服务器设置，用于控制并发查询之间 CPU 资源的分配方式。该设置可以配置为 `round_robin`（此前的行为）或 `fair_round_robin`，以解决 INSERT 与 SELECT 之间 CPU 分配不公平的问题。[#75949](https://github.com/ClickHouse/ClickHouse/pull/75949) ([Sergei Trifonov](https://github.com/serxa))。
* 恢复在 v24.10 中因许可问题被移除的 QPL 编解码器。[#76021](https://github.com/ClickHouse/ClickHouse/pull/76021)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 新增函数 `arraySymmetricDifference`。该函数返回多个数组参数中在所有数组中并非都出现的所有元素。示例：`SELECT arraySymmetricDifference([1, 2], [2, 3])` 返回 `[1, 3]`。（issue [#61673](https://github.com/ClickHouse/ClickHouse/issues/61673)）。[#76231](https://github.com/ClickHouse/ClickHouse/pull/76231)（[Filipp Abapolov](https://github.com/pheepa)）。
* 添加 `estimatecompressionratio` 聚合函数——参见 [#70801](https://github.com/ClickHouse/ClickHouse/issues/70801)。[#76661](https://github.com/ClickHouse/ClickHouse/pull/76661)（[Tariq Almawash](https://github.com/talmawash)）。
* `FilterTransformPassedRows` 和 `FilterTransformPassedBytes` 性能分析事件将显示在查询执行过程中被过滤的行数和字节数。[#76662](https://github.com/ClickHouse/ClickHouse/pull/76662)（[Onkar Deshpande](https://github.com/onkar)）。
* 新增 `keccak256` 哈希函数，该函数在区块链实现中被广泛使用，尤其是在基于 EVM 的系统中。[#76669](https://github.com/ClickHouse/ClickHouse/pull/76669) ([Arnaud Briche](https://github.com/arnaudbriche))。
* 支持 SCRAM-SHA-256，并更新 PostgreSQL wire 协议认证。 [#76839](https://github.com/ClickHouse/ClickHouse/pull/76839) ([scanhex12](https://github.com/scanhex12)).
* 该功能新增了对一组 header 的配置能力，可将其从客户端请求头转发到外部 HTTP 认证器。 [#77054](https://github.com/ClickHouse/ClickHouse/pull/77054) ([inv2004](https://github.com/inv2004))。
* 支持 `IcebergMetadataFilesCache`，它会在同一缓存中存储 manifest 文件/列表和 metadata.json。[#77156](https://github.com/ClickHouse/ClickHouse/pull/77156) ([Han Fei](https://github.com/hanfei1991))。
* 新增函数 `arrayLevenshteinDistance`、`arrayLevenshteinDistanceWeighted` 和 `arraySimilarity`。[#77187](https://github.com/ClickHouse/ClickHouse/pull/77187)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* 新增三个函数：`icebergTruncate`（遵循规范：[https://iceberg.apache.org/spec/#truncate-transform-details](https://iceberg.apache.org/spec/#truncate-transform-details)）、`toYearNumSinceEpoch` 和 `toMonthNumSinceEpoch`。在 `Iceberg` 引擎的分区裁剪中支持 `truncate` 转换。[#77403](https://github.com/ClickHouse/ClickHouse/pull/77403) ([alesapin](https://github.com/alesapin))。
* 允许用户查询 Iceberg 表在先前某一时间点所处的状态。[#77439](https://github.com/ClickHouse/ClickHouse/pull/77439) ([Daniil Ivanik](https://github.com/divanik))。
* 为工作负载新增了 CPU 插槽调度支持，详情参见 [https://clickhouse.com/docs/operations/workload-scheduling#cpu&#95;scheduling](https://clickhouse.com/docs/operations/workload-scheduling#cpu_scheduling)。[#77595](https://github.com/ClickHouse/ClickHouse/pull/77595)（[Sergei Trifonov](https://github.com/serxa)）。
* `hasAll()` 函数现在可以利用 tokenbf&#95;v1 和 ngrambf&#95;v1 全文跳过索引。[#77662](https://github.com/ClickHouse/ClickHouse/pull/77662)（[UnamedRus](https://github.com/UnamedRus)）。
* `JSON` 数据类型已可用于生产环境。参见 [https://jsonbench.com/](https://jsonbench.com/)。`Dynamic` 和 `Varaint` 数据类型也已可用于生产环境。[#77785](https://github.com/ClickHouse/ClickHouse/pull/77785)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 为反序列化后的向量相似度索引新增了内存缓存。这可以加快重复执行的近似最近邻（ANN）搜索查询。新缓存的大小由服务器设置 `vector_similarity_index_cache_size` 和 `vector_similarity_index_cache_max_entries` 控制。此功能取代了早期版本中的跳过索引缓存机制。[#77905](https://github.com/ClickHouse/ClickHouse/pull/77905)（[Shankar Iyer](https://github.com/shankar-iyer)）。
* 新增了函数 sparseGrams 和 sparseGramsHashes 及其 UTF8 版本。作者：[scanhex12](https://github.com/scanhex12)。[#78176](https://github.com/ClickHouse/ClickHouse/pull/78176)（[Pervakov Grigorii](https://github.com/GrigoryPervakov)）。
* 引入 `toInterval` 函数。该函数接受 2 个参数（值和单位），并将该数值转换为特定的 `Interval` 类型。[#78723](https://github.com/ClickHouse/ClickHouse/pull/78723) ([Andrew Davis](https://github.com/pulpdrew))。

## 实验性特性 {#experimental-features}

* 通过新的设置 `enable_replacing_merge_with_cleanup_for_min_age_to_force_merge`，在可配置的超时时间后允许对整个分区执行自动清理合并。[#76440](https://github.com/ClickHouse/ClickHouse/pull/76440) ([Christoph Wurm](https://github.com/cwurm))。
* 为存储在 AWS S3 和本地文件系统上的 DeltaLake 表添加对 [Unity Catalog](https://www.databricks.com/product/unity-catalog) 的支持。[#76988](https://github.com/ClickHouse/ClickHouse/pull/76988) ([alesapin](https://github.com/alesapin))。
* 引入与 AWS Glue 服务目录的实验性集成，用于 Iceberg 表。[#77257](https://github.com/ClickHouse/ClickHouse/pull/77257) ([alesapin](https://github.com/alesapin))。

## 性能优化 {#performance-improvements}

* 通过使用惰性投影优化性能，避免读取未使用的列。 [#55518](https://github.com/ClickHouse/ClickHouse/pull/55518) ([Xiaozhe Yu](https://github.com/wudidapaopao)).
* 优先从最有可能不相等的列开始比较行。 [#63780](https://github.com/ClickHouse/ClickHouse/pull/63780) ([UnamedRus](https://github.com/UnamedRus)).
* 优化 RowBinary 输入格式，修复 [#63805](https://github.com/ClickHouse/ClickHouse/issues/63805)。[#65059](https://github.com/ClickHouse/ClickHouse/pull/65059) ([Pavel Kruglov](https://github.com/Avogar))。
* 通过底层优化提升字符串反序列化性能。 [#65948](https://github.com/ClickHouse/ClickHouse/pull/65948) ([Nikita Taranov](https://github.com/nickitat))。
* 在代码中的部分位置应用 `preserve_most` 属性。[#67778](https://github.com/ClickHouse/ClickHouse/pull/67778)（[Nikita Taranov](https://github.com/nickitat)）。
* 实现查询条件缓存，以在存在重复条件时提升查询性能。不满足条件的数据范围会作为临时索引缓存在内存中，后续查询将使用该索引。已关闭 [#67768](https://github.com/ClickHouse/ClickHouse/issues/67768) ### 面向用户的变更文档条目。 [#69236](https://github.com/ClickHouse/ClickHouse/pull/69236) ([zhongyuankai](https://github.com/zhongyuankai)).
* 为 `NativeORCBlockInputFormat` 增加异步 I/O 预取支持，通过隐藏远程 I/O 时延来提升整体性能。在我的测试用例中，性能提升可达 1.47 倍。[#70534](https://github.com/ClickHouse/ClickHouse/pull/70534) ([李扬](https://github.com/taiyang-li))。
* 通过按键对右侧连接表重新划分范围（rerange），提升 Grace 哈希连接的性能。[#72237](https://github.com/ClickHouse/ClickHouse/pull/72237) ([kevinyhzou](https://github.com/KevinyhZou))。
* 在 `materialize ttl` 中重新恢复对 `ttl_only_drop_parts` 的遵从；仅读取重新计算 TTL 所需的列，并通过将这些数据分片替换为空分片来删除它们。[#72751](https://github.com/ClickHouse/ClickHouse/pull/72751) ([Andrey Zvonov](https://github.com/zvonand)).
* 允许 `arrayROCAUC` 和 `arrayAUCPR` 计算整条曲线的局部面积，以便在超大规模数据集上并行计算。[#72904](https://github.com/ClickHouse/ClickHouse/pull/72904) ([Emmanuel](https://github.com/emmanuelsdias)).
* 避免创建过多空闲线程。 [#72920](https://github.com/ClickHouse/ClickHouse/pull/72920) ([Guo Wangyang](https://github.com/guowangy)).
* 在 `parallel_hash` JOIN 算法的探测阶段中，已移除了对左表数据块按哈希拆分的步骤。[#73089](https://github.com/ClickHouse/ClickHouse/pull/73089) ([Nikita Taranov](https://github.com/nickitat))。
* 当在表函数中仅使用花括号展开时，不要列出 Blob 存储对象键。关闭 [#73333](https://github.com/ClickHouse/ClickHouse/issues/73333)。[#73518](https://github.com/ClickHouse/ClickHouse/pull/73518)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 根据 [#70502](https://github.com/ClickHouse/ClickHouse/issues/70502) 中的测试，在算术计算中将 Int256 和 UInt256 替换为 clang 内置的 i256。[#73658](https://github.com/ClickHouse/ClickHouse/pull/73658) ([李扬](https://github.com/taiyang-li))。
* 为所有参数均为数值类型的函数添加快速路径。修复 [https://github.com/ClickHouse/ClickHouse/pull/72258](https://github.com/ClickHouse/ClickHouse/pull/72258) 中的性能问题。[#73820](https://github.com/ClickHouse/ClickHouse/pull/73820)（[李扬](https://github.com/taiyang-li)）。
* 不要对非函数列使用 `maskedExecute`，以提升短路执行的性能。 [#73965](https://github.com/ClickHouse/ClickHouse/pull/73965) ([lgbo](https://github.com/lgbo-ustc))。
* 禁用 Kafka/NATS/RabbitMQ/FileLog 的头部检测以提升性能。[#74006](https://github.com/ClickHouse/ClickHouse/pull/74006)（[Azat Khuzhin](https://github.com/azat)）。
* 按值使用日志包装器，不要在堆上为其分配内存。[#74034](https://github.com/ClickHouse/ClickHouse/pull/74034) ([Mikhail Artemenko](https://github.com/Michicosun)).
* 在使用 grouping sets 进行聚合后，以更高的并行度执行 pipeline。[#74082](https://github.com/ClickHouse/ClickHouse/pull/74082) ([Nikita Taranov](https://github.com/nickitat))。
* 缩小 `MergeTreeReadPool` 中的临界区范围。[#74202](https://github.com/ClickHouse/ClickHouse/pull/74202)（[Guo Wangyang](https://github.com/guowangy)）。
* 优化了函数 `indexHint`。现在，仅用作函数 `indexHint` 参数的列不会从表中读取。[#74314](https://github.com/ClickHouse/ClickHouse/pull/74314)（[Anton Popov](https://github.com/CurtizJ)）。
* 并行副本性能改进。对于与并行副本协议无关的数据包，其在查询发起方的反序列化现在始终由 pipeline 线程执行。此前，它可能在负责 pipeline 调度的线程中执行，这会降低发起方的响应性并延迟 pipeline 的执行。 [#74398](https://github.com/ClickHouse/ClickHouse/pull/74398) ([Igor Nikonov](https://github.com/devcrafter)).
* 修复了对 `LowCardinality` 列内存占用大小的计算。 [#74688](https://github.com/ClickHouse/ClickHouse/pull/74688) ([Nikita Taranov](https://github.com/nickitat)).
* 提升了在 Wide parts 中从 S3 读取整个 JSON 列的性能。通过为子列前缀的反序列化添加预取、缓存已反序列化的前缀，以及并行反序列化子列前缀来实现。在类似 `SELECT data FROM table` 的查询中，从 S3 读取 JSON 列的性能提升了 4 倍，在类似 `SELECT data FROM table LIMIT 10` 的查询中性能提升约 10 倍。[#74827](https://github.com/ClickHouse/ClickHouse/pull/74827)（[Pavel Kruglov](https://github.com/Avogar)）。
* 预先分配异步插入所使用的内存以提升性能。 [#74945](https://github.com/ClickHouse/ClickHouse/pull/74945) ([Ilya Golshtein](https://github.com/ilejn)).
* 修复了当优化器交换连接两侧时，`ConcurrentHashJoin` 中出现的双重预分配问题。[#75149](https://github.com/ClickHouse/ClickHouse/pull/75149) ([Nikita Taranov](https://github.com/nickitat)).
* 在 `max_rows_in_join = max_bytes_in_join = 0` 时，修复了 `parallel_hash` 中不必要的争用。[#75155](https://github.com/ClickHouse/ClickHouse/pull/75155) ([Nikita Taranov](https://github.com/nickitat)).
* 在某些 join 场景中有小幅性能提升：预先计算输出行数并为其预留内存。 [#75376](https://github.com/ClickHouse/ClickHouse/pull/75376) ([Alexander Gololobov](https://github.com/davenger))。
* `plain_rewritable` 元数据文件很小，不需要很大的默认缓冲区。使用与给定路径相匹配大小的写缓冲区，以在存在大量活动 part 时提升内存利用率。 ### 面向用户变更的文档条目。[#75758](https://github.com/ClickHouse/ClickHouse/pull/75758) ([Julia Kartseva](https://github.com/jkartseva))。
* 在某些情况下（例如空数组列），数据片段可能会包含空文件。当表位于磁盘上且元数据与对象存储分离时，我们可以跳过将空 blob 写入对象存储，仅为此类文件存储元数据。[#75860](https://github.com/ClickHouse/ClickHouse/pull/75860)（[Alexander Gololobov](https://github.com/davenger)）。
* 发现并发控制可能导致 INSERT 与 SELECT 之间的 CPU 分配不公平：当在没有竞争的情况下，将所有 CPU 插槽无条件分配给 `max_threads` = 1 的 INSERT 时，`max_threads` 值较高的 SELECT 由于实际上只能使用单个线程而导致性能下降。[#75941](https://github.com/ClickHouse/ClickHouse/pull/75941)（[Sergei Trifonov](https://github.com/serxa)）。
* 对 wrapInNullable 进行一次微小优化，以避免不必要的 null map 分配。[#76489](https://github.com/ClickHouse/ClickHouse/pull/76489) ([李扬](https://github.com/taiyang-li)).
* 提升 Decimal32/Decimal64/DateTime64 的最小值/最大值计算性能。 [#76570](https://github.com/ClickHouse/ClickHouse/pull/76570) ([李扬](https://github.com/taiyang-li)).
* 在删除分片时主动从缓存中清除对应数据。如果缓存中的数据量较少，不要让缓存增长到最大容量。 [#76641](https://github.com/ClickHouse/ClickHouse/pull/76641) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 查询编译（设置 `compile_expressions`）现在会考虑机器类型。这显著提升了此类查询的执行速度。 [#76753](https://github.com/ClickHouse/ClickHouse/pull/76753) ([Robert Schulze](https://github.com/rschu1ze))。
* 优化 `arraySort`。[#76850](https://github.com/ClickHouse/ClickHouse/pull/76850) ([李扬](https://github.com/taiyang-li)).
* 通过对 `col->insertFrom()` 的调用进行去虚拟化来加速构建 JOIN 结果。[#77350](https://github.com/ClickHouse/ClickHouse/pull/77350) ([Alexander Gololobov](https://github.com/davenger)).
* 将同一部分的 marks 合并后一次性写入查询条件缓存，以减少锁开销。 [#77377](https://github.com/ClickHouse/ClickHouse/pull/77377) ([zhongyuankai](https://github.com/zhongyuankai)).
* 对按单个可为空或低基数列的 ORDER BY 进行了优化。 [#77789](https://github.com/ClickHouse/ClickHouse/pull/77789) ([李扬](https://github.com/taiyang-li)).
* 当缓存处于被动使用场景（例如用于合并）时，禁用 `filesystem_cache_prefer_bigger_buffer_size`。 [#77898](https://github.com/ClickHouse/ClickHouse/pull/77898) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 为 Iceberg 实现了简单的计数优化。现在对于使用 `count()` 且没有任何过滤条件的查询应该会更快。关闭了 [#77639](https://github.com/ClickHouse/ClickHouse/issues/77639)。[#78090](https://github.com/ClickHouse/ClickHouse/pull/78090)（[alesapin](https://github.com/alesapin)）。
* 支持基于列的 lower&#95;bound 和 upper&#95;bound 值进行 Iceberg 数据裁剪。修复了 [#77638](https://github.com/ClickHouse/ClickHouse/issues/77638)。[#78242](https://github.com/ClickHouse/ClickHouse/pull/78242)（[alesapin](https://github.com/alesapin)）。
* 优化 NativeReader 的内存使用。 [#78442](https://github.com/ClickHouse/ClickHouse/pull/78442) ([Azat Khuzhin](https://github.com/azat)).
* 微小优化：当需要使用 `CAST` 时，不要将 `count(if())` 重写为 `countIf`。关闭 [#78564](https://github.com/ClickHouse/ClickHouse/issues/78564)。[#78565](https://github.com/ClickHouse/ClickHouse/pull/78565)（[李扬](https://github.com/taiyang-li)）。

## 改进内容 {#improvements}

* 在可使用 `multiRead` 的地方避免使用单个 `get` 请求，以减少 Keeper 请求的数量，因为随着副本数量的增加，单个 `get` 请求可能会给 Keeper 带来显著负载。[#56862](https://github.com/ClickHouse/ClickHouse/pull/56862) ([Nikolay Degterinsky](https://github.com/evillique))。
* 为 MySQL 具名集合添加对 SSL 身份验证的支持。关闭了 [#59111](https://github.com/ClickHouse/ClickHouse/issues/59111)。[#59452](https://github.com/ClickHouse/ClickHouse/pull/59452)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 通过在 `ConstantNode` 中存储 `ColumnPtr` 而不是 `Field` 来提升新的 analyzer 基础架构的性能。相关：[#62245](https://github.com/ClickHouse/ClickHouse/issues/62245)。[#63198](https://github.com/ClickHouse/ClickHouse/pull/63198)（[Dmitry Novik](https://github.com/novikd)）。
* 当服务器过载时拒绝查询。是否拒绝的决策基于等待时间（`OSCPUWaitMicroseconds`）与忙碌时间（`OSCPUVirtualTimeMicroseconds`）的比值。当该比值位于 `min_os_cpu_wait_time_ratio_to_throw` 和 `max_os_cpu_wait_time_ratio_to_throw` 之间时（这些是查询级别的设置），将以一定概率丢弃查询。[#63206](https://github.com/ClickHouse/ClickHouse/pull/63206)（[Alexey Katsman](https://github.com/alexkats)）。
* 尽可能早地丢弃数据块以降低内存占用。 [#65647](https://github.com/ClickHouse/ClickHouse/pull/65647) ([lgbo](https://github.com/lgbo-ustc)).
* `processors_profile_log` 表现已具有默认配置，TTL 为 30 天。[#66139](https://github.com/ClickHouse/ClickHouse/pull/66139)（[Ilya Yatsishin](https://github.com/qoega)）。
* 允许在 DateTime64 类型的列上创建 `bloom_filter` 索引。 [#66416](https://github.com/ClickHouse/ClickHouse/pull/66416) ([Yutong Xiao](https://github.com/YutSean)).
* 引入时延桶，用于跟踪针对 S3 请求的首字节读写时间和连接时间。这样我们之后就可以利用收集到的数据来计算近似分位数，并动态调整超时时间。[#69783](https://github.com/ClickHouse/ClickHouse/pull/69783)（[Alexey Katsman](https://github.com/alexkats)）。
* 传递给 `Executable` 存储的查询不再局限于只能使用单线程执行。[#70084](https://github.com/ClickHouse/ClickHouse/pull/70084) ([yawnt](https://github.com/yawnt))。
* 向 OpenTelemetry span 日志表中添加了 HTTP 头，以增强可追踪性。 [#70516](https://github.com/ClickHouse/ClickHouse/pull/70516) ([jonymohajanGmail](https://github.com/jonymohajanGmail)).
* 支持使用自定义时区写入 ORC 文件，而不再固定为 `GMT` 时区。[#70615](https://github.com/ClickHouse/ClickHouse/pull/70615) ([kevinyhzou](https://github.com/KevinyhZou)).
* 当启用了并行副本时，请将表函数替换为对应的 `-Cluster` 版本。修复了 [#65024](https://github.com/ClickHouse/ClickHouse/issues/65024)。[#70659](https://github.com/ClickHouse/ClickHouse/pull/70659)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 在跨云备份写入过程中遵循 IO 调度设置。[#71093](https://github.com/ClickHouse/ClickHouse/pull/71093)（[János Benjamin Antal](https://github.com/antaljanosbenjamin)）。
* 在后台重新建立到 MySQL 和 Postgres 字典副本的连接，而不会延迟对相应字典的请求。 [#71101](https://github.com/ClickHouse/ClickHouse/pull/71101) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 为 system.asynchronous&#95;metrics 添加指标别名。[#71164](https://github.com/ClickHouse/ClickHouse/pull/71164) ([megao](https://github.com/jetgm)).
* 可刷新物化视图的刷新操作现在会记录在 `system.query_log` 中。[#71333](https://github.com/ClickHouse/ClickHouse/pull/71333) ([Michael Kolupaev](https://github.com/al13n321))。
* 同时评估 Parquet 布隆过滤器和 min/max 索引。这样才能正确支持：`x = 3 or x > 5`，其中 data = [1, 2, 4, 5]。[#71383](https://github.com/ClickHouse/ClickHouse/pull/71383)（[Arthur Passos](https://github.com/arthurpassos)）。
* 交互式指标改进。修复来自并行副本的指标未完全显示的问题。按最近更新的时间排序显示指标，然后按名称的字典顺序排序。不再显示陈旧的指标。[#71631](https://github.com/ClickHouse/ClickHouse/pull/71631)（[Julia Kartseva](https://github.com/jkartseva)）。
* 过去由于某些原因，查询 `ALTER TABLE MOVE PARTITION TO TABLE` 会检查 `SELECT` 和 `ALTER DELETE` 权限，而不是专门的 `ALTER_MOVE_PARTITION`。此 PR 改为使用该访问类型。为保持兼容性，如果已授予 `SELECT` 和 `ALTER DELETE`，仍会隐式授予此权限，但这一行为将在未来版本中被移除。关闭 [#16403](https://github.com/ClickHouse/ClickHouse/issues/16403)。[#71632](https://github.com/ClickHouse/ClickHouse/pull/71632)（[pufit](https://github.com/pufit)）。
* 使 `use_hive_partitioning` 默认启用。[#71636](https://github.com/ClickHouse/ClickHouse/pull/71636)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 在尝试物化排序键中的列时抛出异常，而不是任其破坏排序顺序。不过，这并不能解决 [#71777](https://github.com/ClickHouse/ClickHouse/issues/71777)。[#71891](https://github.com/ClickHouse/ClickHouse/pull/71891)（[Peter Nguyen](https://github.com/petern48)）。
* 在启用 hash join 算法时，允许使用更通用的 join 计划算法。[#71926](https://github.com/ClickHouse/ClickHouse/pull/71926) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
* 在 `EXPLAIN QUERY TREE` 中隐藏敏感信息。 [#72025](https://github.com/ClickHouse/ClickHouse/pull/72025) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 允许使用可配置的磁盘来存储数据库和表的元数据文件。磁盘名称可以通过 `database_disk.disk` 配置参数进行设置。 [#72027](https://github.com/ClickHouse/ClickHouse/pull/72027) ([Tuan Pham Anh](https://github.com/tuanpach)).
* 在原生读取器中添加对 Parquet 整数逻辑类型的支持。 [#72105](https://github.com/ClickHouse/ClickHouse/pull/72105) ([Arthur Passos](https://github.com/arthurpassos)).
* 默认采用美化的 JSON 输出格式。新增设置 `output_format_json_pretty_print` 用于控制该行为，并默认启用。 [#72148](https://github.com/ClickHouse/ClickHouse/pull/72148) ([Pavel Kruglov](https://github.com/Avogar))。
* 如果默认用户设置了密码，则会在浏览器中以交互方式请求凭证。在之前的版本中，服务器会返回 HTTP 403；现在会返回 HTTP 401。[#72198](https://github.com/ClickHouse/ClickHouse/pull/72198)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 此 PR 将 `CREATE_USER`、`ALTER_USER`、`DROP_USER`、`CREATE_ROLE`、`ALTER_ROLE`、`DROP_ROLE` 这些访问类型从全局改为可参数化。这意味着用户现在可以更精细地授予访问管理相关权限：[#72246](https://github.com/ClickHouse/ClickHouse/pull/72246)（[pufit](https://github.com/pufit)）。
* 允许在集群配置中对名称进行分片处理。 [#72276](https://github.com/ClickHouse/ClickHouse/pull/72276) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* 支持在参数不同的 JSON 类型之间执行 CAST 和 ALTER。[#72303](https://github.com/ClickHouse/ClickHouse/pull/72303) ([Pavel Kruglov](https://github.com/Avogar))。
* 将 `latest_fail_error_code_name` 列添加到 `system.mutations`。我们需要这一列来引入一个用于卡住的 mutation 的新指标，并据此构建云环境中发生错误的图表，同时（可选）添加一个噪声更低的新告警。[#72398](https://github.com/ClickHouse/ClickHouse/pull/72398)（[Miсhael Stetsyuk](https://github.com/mstetsyuk)）。
* 减少在附加分区时的内存分配开销。 [#72583](https://github.com/ClickHouse/ClickHouse/pull/72583) ([Konstantin Morozov](https://github.com/k-morozov)).
* 将 `max&#95;bytes&#95;before&#95;external&#95;sort` 的限制改为依赖整个查询的总内存消耗（之前它表示单个排序线程中排序块的字节数，现在它与 `max_bytes_before_external_group_by` 具有相同的含义——即整个查询（所有线程）的总内存上限）。另外新增了一个用于控制磁盘上块大小的设置——`min_external_sort_block_bytes`。 [#72598](https://github.com/ClickHouse/ClickHouse/pull/72598) ([Azat Khuzhin](https://github.com/azat)).
* 忽略由 trace collector 施加的内存限制。[#72606](https://github.com/ClickHouse/ClickHouse/pull/72606) ([Azat Khuzhin](https://github.com/azat)).
* 在 MergeTree 的排序键和跳过索引中增加对子列的支持。 [#72644](https://github.com/ClickHouse/ClickHouse/pull/72644) ([Pavel Kruglov](https://github.com/Avogar)).
* 在 `system.server_settings` 中添加服务器设置项 `dictionaries_lazy_load` 和 `wait_dictionaries_load_at_startup`。 [#72664](https://github.com/ClickHouse/ClickHouse/pull/72664) ([Christoph Wurm](https://github.com/cwurm))。
* 将 `max_backup_bandwidth` 设置添加到可在 `BACKUP`/`RESTORE` 查询中指定的设置列表中。[#72665](https://github.com/ClickHouse/ClickHouse/pull/72665)（[Christoph Wurm](https://github.com/cwurm)）。
* 并行副本会利用副本可用性的历史信息来优化副本选择，但在连接不可用时不会更新该副本的错误计数。本 PR 在副本不可用时也会更新该副本的错误计数。 [#72666](https://github.com/ClickHouse/ClickHouse/pull/72666) ([zoomxi](https://github.com/zoomxi))。
* 将 ReplicatedMergeTree 引擎中新出现的副本数据片段的日志级别降低，从而减少在复制集群中生成的日志量。[#72876](https://github.com/ClickHouse/ClickHouse/pull/72876)（[mor-akamai](https://github.com/morkalfon)）。
* 许多新特性将需要对与 Iceberg 元数据相关的代码进行更好的封装和更合理的抽象。[#72941](https://github.com/ClickHouse/ClickHouse/pull/72941) ([Daniil Ivanik](https://github.com/divanik))。
* 支持对 JSON 列的值进行相等比较。 [#72991](https://github.com/ClickHouse/ClickHouse/pull/72991) ([Pavel Kruglov](https://github.com/Avogar))。
* 改进带有 JSON 子列的标识符的格式，避免使用不必要的反引号。 [#73085](https://github.com/ClickHouse/ClickHouse/pull/73085) ([Pavel Kruglov](https://github.com/Avogar)).
* 以 `Test` 级别记录 `PREWHERE` 条件。 [#73116](https://github.com/ClickHouse/ClickHouse/pull/73116) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 支持在隐式 ENGINE 情况下使用 SETTINGS，并支持在同一语句中混用引擎设置和查询设置。 [#73120](https://github.com/ClickHouse/ClickHouse/pull/73120) ([Raúl Marín](https://github.com/Algunenano)).
* 在启用 `optimize_on_insert` 时，将数据分片写为 level 1。这样可以在针对新写入分片、且带有 `FINAL` 的查询中使用多种优化。[#73132](https://github.com/ClickHouse/ClickHouse/pull/73132) ([Anton Popov](https://github.com/CurtizJ))。
* 对于类似 `WHERE a<b AND b<c AND c<5` 的查询，可以推导出新的比较条件（`a<5 AND b<5`），从而提升过滤效果。[#73164](https://github.com/ClickHouse/ClickHouse/pull/73164) ([Shichao Jin](https://github.com/jsc0218)).
* 改进对析取表达式中公共子表达式的提取。即使所有析取项中不存在共同子表达式，也允许简化最终的过滤表达式。延续自 [#71537](https://github.com/ClickHouse/ClickHouse/issues/71537)。[#73271](https://github.com/ClickHouse/ClickHouse/pull/73271)（[Dmitry Novik](https://github.com/novikd)）。
* 在 Storage `S3(Azure)Queue` 中，现在允许为最初在未配置任何设置的情况下创建的表补充添加设置。[#73283](https://github.com/ClickHouse/ClickHouse/pull/73283) ([Kseniia Sumarokova](https://github.com/kssenii)).
* clickhouse-client 现在支持使用 Ctrl+D 来结束查询，允许使用 Ctrl+D 来代替输入分号并按 Enter。此外，在单行模式下，让 Ctrl+D 的作用等同于按下 Enter。[#73293](https://github.com/ClickHouse/ClickHouse/pull/73293) ([Xiaozhe Yu](https://github.com/wudidapaopao))。
* 引入一个设置 `least_greatest_legacy_null_behavior`（默认值：`false`），用于控制函数 `least` 和 `greatest` 在处理 `NULL` 参数时，是无条件返回 `NULL`（当为 `true` 时），还是忽略这些参数（当为 `false` 时）。[#73344](https://github.com/ClickHouse/ClickHouse/pull/73344)（[Robert Schulze](https://github.com/rschu1ze)）。
* 在清理线程 ObjectStorageQueueMetadata 中使用 Keeper 的多请求功能。 [#73357](https://github.com/ClickHouse/ClickHouse/pull/73357) ([Antonio Andelic](https://github.com/antonio2368)).
* 现已默认使用新的 MongoDB 驱动程序。希望继续使用旧版驱动程序的用户可以将服务器设置项 `use_legacy_mongodb_integration` 配置为 true。[#73359](https://github.com/ClickHouse/ClickHouse/pull/73359) ([Robert Schulze](https://github.com/rschu1ze))。
* 当 ClickHouse 在 cgroup 环境下运行时，我们仍会收集与系统负载、进程调度、内存等相关的系统范围异步指标。当宿主机上只有 ClickHouse 这一高资源消耗进程时，这些指标可能会提供有用的信号。 [#73369](https://github.com/ClickHouse/ClickHouse/pull/73369) ([Nikita Taranov](https://github.com/nickitat))。
* 在 `S3Queue` 存储中，现在可以将 24.6 版本之前创建的旧 `Ordered` 表迁移到带有 bucket 的新结构中。[#73467](https://github.com/ClickHouse/ClickHouse/pull/73467)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 添加 `system.azure_queue`，与现有的 `system.s3queue` 类似。 [#73477](https://github.com/ClickHouse/ClickHouse/pull/73477) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复了一个回归问题：使用带修饰符的排序规则区域设置时会抛出错误。例如，`SELECT arrayJoin(['kk 50', 'KK 01', ' KK 2', ' KK 3', 'kk 1', 'x9y99', 'x9y100']) item ORDER BY item ASC COLLATE 'tr-u-kn-true-ka-shifted` 现在可以正常工作。[#73544](https://github.com/ClickHouse/ClickHouse/pull/73544)（[Robert Schulze](https://github.com/rschu1ze)）。
* 支持 Nullable(JSON) 类型。 [#73556](https://github.com/ClickHouse/ClickHouse/pull/73556) ([Pavel Kruglov](https://github.com/Avogar)).
* 函数 `parseDateTime64`（及其变体）现在对 1970 年之前或 2106 年之后的输入日期也会返回正确结果。示例：`SELECT parseDateTime64InJodaSyntax('2200-01-01 00:00:00.000', 'yyyy-MM-dd HH:mm:ss.SSS')`。 [#73594](https://github.com/ClickHouse/ClickHouse/pull/73594) ([zhanglistar](https://github.com/zhanglistar))。
* 修复了一些用户报告的 `clickhouse-disks` 可用性问题。关闭 [#67136](https://github.com/ClickHouse/ClickHouse/issues/67136)。[#73616](https://github.com/ClickHouse/ClickHouse/pull/73616)（[Daniil Ivanik](https://github.com/divanik)）。
* 允许更改 storage S3(Azure)Queue 的提交参数。（提交参数包括：max&#95;processed&#95;files&#95;before&#95;commit、max&#95;processed&#95;rows&#95;before&#95;commit、max&#95;processed&#95;bytes&#95;before&#95;commit、max&#95;processing&#95;time&#95;sec&#95;before&#95;commit）。 [#73635](https://github.com/ClickHouse/ClickHouse/pull/73635) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 在 S3(Azure)Queue 存储中汇总各个来源的进度，以便与提交限制设置进行比较。 [#73641](https://github.com/ClickHouse/ClickHouse/pull/73641) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 在 `BACKUP`/`RESTORE` 查询中支持核心配置。[#73650](https://github.com/ClickHouse/ClickHouse/pull/73650) ([Vitaly Baranov](https://github.com/vitlibar)).
* 在 Parquet 输出中读取 `output_format_compression_level` 设置。 [#73651](https://github.com/ClickHouse/ClickHouse/pull/73651) ([Arthur Passos](https://github.com/arthurpassos))。
* 在读取 arrow fixed&#95;size&#95;list 时，将其作为 Array 类型处理，而不再视为不受支持的类型。[#73654](https://github.com/ClickHouse/ClickHouse/pull/73654) ([Julian Meyers](https://github.com/J-Meyers)).
* 该 PR 新增了两个备份引擎：`Memory`（将备份保存在当前用户会话中）和 `Null`（不会在任何地方保存备份）：[#73690](https://github.com/ClickHouse/ClickHouse/pull/73690) ([Vitaly Baranov](https://github.com/vitlibar))。
* `concurrent_threads_soft_limit_num` 和 `concurrent_threads_soft_limit_num_ratio_to_cores` 可以在无需重启服务器的情况下更改。 [#73713](https://github.com/ClickHouse/ClickHouse/pull/73713) ([Sergei Trifonov](https://github.com/serxa))。
* 为 `formatReadable` 系列函数添加对扩展数值类型（Decimal、大整数）的支持。[#73765](https://github.com/ClickHouse/ClickHouse/pull/73765)（[Raúl Marín](https://github.com/Algunenano)）。
* 对 tuple 列中的字段也应用列名大小写不敏感匹配规则。关闭 [https://github.com/apache/incubator-gluten/issues/8324](https://github.com/apache/incubator-gluten/issues/8324)。[#73780](https://github.com/ClickHouse/ClickHouse/pull/73780)（[李扬](https://github.com/taiyang-li)）。
* 为 Postgres wire 协议提供 TLS 支持。 [#73812](https://github.com/ClickHouse/ClickHouse/pull/73812) ([scanhex12](https://github.com/scanhex12)).
* 默认允许使用 `LowCardinality(UUID)`。实践证明，这在 ClickHouse Cloud 的客户中非常实用。[#73826](https://github.com/ClickHouse/ClickHouse/pull/73826) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 改进安装过程中的提示信息。[#73827](https://github.com/ClickHouse/ClickHouse/pull/73827) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 改进了 ClickHouse Cloud 的密码重置提示信息。[#73831](https://github.com/ClickHouse/ClickHouse/pull/73831) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 改进当 File 表无法向文件追加数据时的错误信息。[#73832](https://github.com/ClickHouse/ClickHouse/pull/73832) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 当用户在终端中意外请求输出二进制格式（例如 Native、Parquet、Avro）时，增加确认提示。此更改解决了 [#59524](https://github.com/ClickHouse/ClickHouse/issues/59524)。[#73833](https://github.com/ClickHouse/ClickHouse/pull/73833)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `BFloat16` 数据类型已可在生产环境中使用。 [#73840](https://github.com/ClickHouse/ClickHouse/pull/73840) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 在终端中对 Pretty 和 Vertical 格式的输出高亮显示行末空格，以提升可读性。该行为由设置 `output_format_pretty_highlight_trailing_spaces` 控制。初始实现由 [Braden Burns](https://github.com/bradenburns) 在 [#72996](https://github.com/ClickHouse/ClickHouse/issues/72996) 中完成。关闭了 [#71590](https://github.com/ClickHouse/ClickHouse/issues/71590)。[#73847](https://github.com/ClickHouse/ClickHouse/pull/73847)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `clickhouse-client` 和 `clickhouse-local` 在从文件重定向标准输入时会自动检测压缩格式。此更改已关闭 [#70865](https://github.com/ClickHouse/ClickHouse/issues/70865)。[#73848](https://github.com/ClickHouse/ClickHouse/pull/73848)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在 pretty 输出格式中默认截断过长的列名。该行为由 `output_format_pretty_max_column_name_width_cut_to` 和 `output_format_pretty_max_column_name_width_min_chars_to_cut` 这两个设置控制。这是对 [tanmaydatta](https://github.com/tanmaydatta) 在 [#66502](https://github.com/ClickHouse/ClickHouse/issues/66502) 中工作的延续。本项改动关闭了 [#65968](https://github.com/ClickHouse/ClickHouse/issues/65968)。[#73851](https://github.com/ClickHouse/ClickHouse/pull/73851)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 让 `Pretty` 格式更美观：如果距上一个块输出的时间间隔较短，则将多个块压缩合并。可通过新设置 `output_format_pretty_squash_consecutive_ms`（默认 50 ms）和 `output_format_pretty_squash_max_wait_ms`（默认 1000 ms）进行控制。是对 [#49537](https://github.com/ClickHouse/ClickHouse/issues/49537) 的延续。本次更改关闭了 [#49153](https://github.com/ClickHouse/ClickHouse/issues/49153)。[#73852](https://github.com/ClickHouse/ClickHouse/pull/73852)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复 SQLite 的类型映射问题（将整数类型映射为 `int64`，将浮点类型映射为 `float64`）。[#73853](https://github.com/ClickHouse/ClickHouse/pull/73853) ([Joanna Hulboj](https://github.com/jh0x))。
* 新增一个统计当前正在合并的源数据分片数量的指标。此更改解决了 [#70809](https://github.com/ClickHouse/ClickHouse/issues/70809)。[#73868](https://github.com/ClickHouse/ClickHouse/pull/73868)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 当输出到终端时，在 `Vertical` 格式下高亮显示列。可以通过 `output_format_pretty_color` 设置来禁用此行为。[#73898](https://github.com/ClickHouse/ClickHouse/pull/73898) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 已将 MySQL 兼容性提升到这样的水平：现在 `mysqlsh`（Oracle 提供的功能丰富的 MySQL CLI）可以连接到 ClickHouse。这是为了方便测试。[#73912](https://github.com/ClickHouse/ClickHouse/pull/73912) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 如果输出记录数大于 N = `output_format_pretty_max_rows`，则不会仅显示前 N 行，而是将在中间截断输出表，显示前 N/2 行和后 N/2 行。作为对 [#64200](https://github.com/ClickHouse/ClickHouse/issues/64200) 的延续。此变更关闭了 [#59502](https://github.com/ClickHouse/ClickHouse/issues/59502)。[#73929](https://github.com/ClickHouse/ClickHouse/pull/73929)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 函数 `isIPv4String` 在正确的 IPv4 地址后紧跟一个零字节时会返回 true，而在这种情况下本应返回 false。这是对 [#65387](https://github.com/ClickHouse/ClickHouse/issues/65387) 的延续。[#73946](https://github.com/ClickHouse/ClickHouse/pull/73946)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 使 MySQL 线协议中的错误码与 MySQL 保持兼容。延续自 [#56831](https://github.com/ClickHouse/ClickHouse/issues/56831)。关闭 [#50957](https://github.com/ClickHouse/ClickHouse/issues/50957)。[#73948](https://github.com/ClickHouse/ClickHouse/pull/73948)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 添加设置项 `validate_enum_literals_in_opearators`，用于在 `IN`、`NOT IN` 等运算符中验证枚举字面量是否与枚举类型匹配，如果字面量不是有效的枚举值则抛出异常。 [#73985](https://github.com/ClickHouse/ClickHouse/pull/73985) ([Vladimir Cherkasov](https://github.com/vdimir))。
* 在存储引擎 `S3(Azure)Queue` 中，将由提交设置定义的单个批次中的所有文件在一次 Keeper 事务中提交。[#73991](https://github.com/ClickHouse/ClickHouse/pull/73991)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 为可执行 UDF 和字典禁用头部检测（可能导致 Function &#39;X&#39;: wrong result, expected Y row(s), actual Y-1）。 [#73992](https://github.com/ClickHouse/ClickHouse/pull/73992) ([Azat Khuzhin](https://github.com/azat)).
* 为 `EXPLAIN PLAN` 新增了 `distributed` 选项。现在，`EXPLAIN distributed=1 ...` 会在 `ReadFromParallelRemote*` 步骤中附加远程执行计划。[#73994](https://github.com/ClickHouse/ClickHouse/pull/73994) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
* 为带有 Dynamic 参数的 not/xor 运算使用正确的返回类型。[#74013](https://github.com/ClickHouse/ClickHouse/pull/74013)（[Pavel Kruglov](https://github.com/Avogar)）。
* 允许在创建表之后修改 `add_implicit_sign_column_constraint_for_collapsing_engine`。[#74014](https://github.com/ClickHouse/ClickHouse/pull/74014) ([Christoph Wurm](https://github.com/cwurm))。
* 在物化视图的 SELECT 查询中支持子列。[#74030](https://github.com/ClickHouse/ClickHouse/pull/74030) ([Pavel Kruglov](https://github.com/Avogar))。
* Pretty 输出格式可以在表格单元格内渲染多行字段，从而提高可读性。该功能默认启用，可通过设置 `output_format_pretty_multiline_fields` 进行控制。该改动是对 [Volodyachan](https://github.com/Volodyachan) 在 [#64094](https://github.com/ClickHouse/ClickHouse/issues/64094) 中工作的延续，并关闭了 [#56912](https://github.com/ClickHouse/ClickHouse/issues/56912)。[#74032](https://github.com/ClickHouse/ClickHouse/pull/74032)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在查询计划层面为 `MergingAggregated` 步骤新增对 `predicate-push-down` 优化的支持，这在使用新分析器时可提升部分查询的性能。 [#74073](https://github.com/ClickHouse/ClickHouse/pull/74073) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* 现在可以通过三种简单的方法在 `clickhouse-client` 中设置自定义提示符：1. 通过命令行参数 `--prompt`；2. 在配置文件中通过设置 `<prompt>[...]</prompt>`；3. 同样在配置文件中，通过为每个连接单独设置 `<connections_credentials><prompt>[...]</prompt></connection_credentials>`。 [#74168](https://github.com/ClickHouse/ClickHouse/pull/74168) ([Christoph Wurm](https://github.com/cwurm))。
* 将 Prometheus remote write 响应的成功状态码从 200/OK 更改为 204/NoContent。[#74170](https://github.com/ClickHouse/ClickHouse/pull/74170) ([Michael Dempsey](https://github.com/bluestealth))。
* 将 X-ClickHouse HTTP 头暴露给浏览器中的 JavaScript，这使得编写应用程序更加方便。[#74180](https://github.com/ClickHouse/ClickHouse/pull/74180)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `JSONEachRowWithProgress` 格式将包含带元数据的事件，以及 totals 和 extremes。它还包含 `rows_before_limit_at_least` 和 `rows_before_aggregation`。如果在部分结果之后出现异常，该格式会正确输出该异常。进度信息现在包含已消耗的纳秒数。结束时会发出最后一个进度事件。在查询执行期间，进度信息的输出频率不会高于 `interactive_delay` 设置的值。[#74181](https://github.com/ClickHouse/ClickHouse/pull/74181)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在 Play UI 中的沙漏将平滑旋转。 [#74182](https://github.com/ClickHouse/ClickHouse/pull/74182) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 即使 HTTP 响应经过压缩，也要在数据包一到达就立即发送。这样浏览器就能同时接收进度包和压缩数据。[#74201](https://github.com/ClickHouse/ClickHouse/pull/74201) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 新增支持在无需重启服务器的情况下，动态重新加载 `max_remote_read_network_bandwidth_for_serve` 和 `max_remote_write_network_bandwidth_for_server`。 [#74206](https://github.com/ClickHouse/ClickHouse/pull/74206) ([Kai Zhu](https://github.com/nauu)).
* 在 ClickHouse Client 中通过连接到 9440 端口自动检测是否使用安全连接。[#74212](https://github.com/ClickHouse/ClickHouse/pull/74212) ([Christoph Wurm](https://github.com/cwurm)).
* 为 `http_handlers` 支持仅使用用户名进行用户认证（此前还要求用户提供密码）。[#74221](https://github.com/ClickHouse/ClickHouse/pull/74221) ([Azat Khuzhin](https://github.com/azat))。
* 对替代查询语言 PRQL 和 KQL 的支持被标记为实验性功能。要使用它们，请将设置 `allow_experimental_prql_dialect = 1` 和 `allow_experimental_kusto_dialect = 1`。[#74224](https://github.com/ClickHouse/ClickHouse/pull/74224) ([Robert Schulze](https://github.com/rschu1ze))。
* 在更多聚合函数中支持返回默认 Enum 类型。[#74272](https://github.com/ClickHouse/ClickHouse/pull/74272)（[Raúl Marín](https://github.com/Algunenano)）。
* 在 `OPTIMIZE TABLE` 中，现在可以将关键字 `FORCE` 指定为现有关键字 `FINAL` 的替代。[#74342](https://github.com/ClickHouse/ClickHouse/pull/74342)（[Robert Schulze](https://github.com/rschu1ze)）。
* 添加了一个 MergeTree 设置 `materialize_skip_indexes_on_merge`，用于在合并期间禁止创建跳过索引。这样用户就可以通过 `ALTER TABLE [..] MATERIALIZE INDEX [...]` 显式控制跳过索引的创建时机。如果跳过索引的构建代价较高（例如向量相似度索引），这将非常有用。[#74401](https://github.com/ClickHouse/ClickHouse/pull/74401)（[Robert Schulze](https://github.com/rschu1ze)）。
* 在 `default` 和 `materialized` 表达式中支持使用子列。 [#74403](https://github.com/ClickHouse/ClickHouse/pull/74403) ([Pavel Kruglov](https://github.com/Avogar)).
* 在 Storage(S3/Azure)Queue 中优化 Keeper 请求。 [#74410](https://github.com/ClickHouse/ClickHouse/pull/74410) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 添加 `IsServerShuttingDown` 指标，用于在服务器关闭过程耗时过长时触发告警。[#74429](https://github.com/ClickHouse/ClickHouse/pull/74429) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
* 在 EXPLAIN 输出中添加了 Iceberg 表的名称。 [#74485](https://github.com/ClickHouse/ClickHouse/pull/74485) ([alekseev-maksim](https://github.com/alekseev-maksim)).
* 默认最多可使用 `1000` 个并行副本。[#74504](https://github.com/ClickHouse/ClickHouse/pull/74504)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 在使用旧版分析器配合 RECURSIVE CTE 时提供更好的错误信息。[#74523]([https://github.com/ClickHouse/ClickHouse/pull/74523)（[Raúl](https://github.com/ClickHouse/ClickHouse/pull/74523\)（\[Raúl) Marín]([https://github.com/Algunenano)）。](https://github.com/Algunenano\)）。)
* 优化 Storage(S3/Azure)Queue 中的 Keeper 请求。[#74538](https://github.com/ClickHouse/ClickHouse/pull/74538)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 提升从 S3 磁盘读取时的 HTTP 会话复用（[#72401](https://github.com/ClickHouse/ClickHouse/issues/72401)）。[#74548](https://github.com/ClickHouse/ClickHouse/pull/74548)（[Julian Maicher](https://github.com/jmaicher)）。
* 在 `system.errors` 中显示详细错误信息。[#74574](https://github.com/ClickHouse/ClickHouse/pull/74574) ([Vitaly Baranov](https://github.com/vitlibar)).
* 为所有类型的复制任务启用了退避逻辑，从而降低 CPU 使用率、内存占用以及日志文件大小。新增了与 `max_postpone_time_for_failed_mutations_ms` 类似的设置项 `max_postpone_time_for_failed_replicated_fetches_ms`、`max_postpone_time_for_failed_replicated_merges_ms` 和 `max_postpone_time_for_failed_replicated_tasks_ms`。[#74576](https://github.com/ClickHouse/ClickHouse/pull/74576) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。
* 更精确地考虑 `parallel_hash` JOIN 算法中的 `max_joined_block_size_rows` 设置，有助于避免相比 `hash` 算法的额外内存消耗。[#74630](https://github.com/ClickHouse/ClickHouse/pull/74630) ([Nikita Taranov](https://github.com/nickitat))。
* 在 libhdfs3 中添加了对 `dfs.client.use.datanode.hostname` 配置选项的支持。[#74635](https://github.com/ClickHouse/ClickHouse/pull/74635) ([Mikhail Tiukavkin](https://github.com/freshertm)).
* 修复错误：Codec &#39;snappy&#39; 不支持设置压缩级别。[#74659](https://github.com/ClickHouse/ClickHouse/pull/74659) ([Arthur Passos](https://github.com/arthurpassos))。
* 允许在客户端与 clickhouse-keeper 之间的通信中使用密码。如果你已经为服务器和客户端配置了合适的 SSL，这个功能就不是特别有用，但在某些场景下仍然有用。密码长度不能超过 16 个字符。它与 Keeper Auth 模型无关。[#74673](https://github.com/ClickHouse/ClickHouse/pull/74673) ([alesapin](https://github.com/alesapin))。
* 允许在创建备份时使用 blob 路径计算校验和。[#74729](https://github.com/ClickHouse/ClickHouse/pull/74729) ([Vitaly Baranov](https://github.com/vitlibar)).
* 当 JOIN 键在两侧都是主键（PK）的前缀时，使用动态分片来执行 JOIN。此优化可通过 `query_plan_join_shard_by_pk_ranges` 设置启用（默认禁用）。[#74733](https://github.com/ClickHouse/ClickHouse/pull/74733)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 为配置重载器添加错误码。[#74746](https://github.com/ClickHouse/ClickHouse/pull/74746) ([Garrett Thomas](https://github.com/garrettthomaskth))。
* 在 MySQL 和 PostgreSQL 的表函数和引擎中增加了对 IPv6 地址的支持。 [#74796](https://github.com/ClickHouse/ClickHouse/pull/74796) ([Mikhail Koviazin](https://github.com/mkmkme)).
* 现在，Gorilla 编解码器（codec Gorilla）的参数将始终保存在 .sql 文件中的表元数据中。此更改关闭了问题 [#70072](https://github.com/ClickHouse/ClickHouse/issues/70072)。[#74814](https://github.com/ClickHouse/ClickHouse/pull/74814)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 实现 `divideDecimal` 的短路优化。修复 [#74280](https://github.com/ClickHouse/ClickHouse/issues/74280)。[#74843](https://github.com/ClickHouse/ClickHouse/pull/74843)（[Kevin Mingtarja](https://github.com/kevinmingtarja)）。
* 提升 Keeper 中大规模多请求操作的性能。 [#74849](https://github.com/ClickHouse/ClickHouse/pull/74849) ([Antonio Andelic](https://github.com/antonio2368)).
* 现在可以在启动脚本中指定用户。[#74894](https://github.com/ClickHouse/ClickHouse/pull/74894)（[pufit](https://github.com/pufit)）。
* 在 `ALTER TABLE FETCH PARTITION` 中并行拉取分片（线程池大小由 `max_fetch_partition_thread_pool_size` 控制）。 [#74978](https://github.com/ClickHouse/ClickHouse/pull/74978) ([Azat Khuzhin](https://github.com/azat)).
* 向 `system.query_cache` 添加了查询 ID 列（问题 [#68205](https://github.com/ClickHouse/ClickHouse/issues/68205)）。[#74982](https://github.com/ClickHouse/ClickHouse/pull/74982)（[NamNguyenHoai](https://github.com/NamHoaiNguyen)）。
* 重新启用 SSH 协议支持。修复了一些严重漏洞，现已无法再使用自定义 pager 或指定 `server-logs-file`。默认禁用通过环境变量传递客户端选项（仍可通过 config.xml 中的 `ssh-server.enable_client_options_passing` 开启）。现在支持 progress 表、查询取消、自动补全、profile events 进度、stdin 以及 `send_logs_level` 选项。修复了问题：[#74340](https://github.com/ClickHouse/ClickHouse/issues/74340)。[#74989](https://github.com/ClickHouse/ClickHouse/pull/74989)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 在查询解析期间如果出现异常，使用自定义格式对异常进行格式化。此前版本中，异常始终使用默认格式，而不是查询中指定的格式。此更改关闭了 [#55422](https://github.com/ClickHouse/ClickHouse/issues/55422)。[#74994](https://github.com/ClickHouse/ClickHouse/pull/74994)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 实现了解析功能增强（Sequence ID 解析：新增在 manifest 文件中解析序列标识符的能力；Avro 元数据解析：重新设计 Avro 元数据解析器，使其在未来易于扩展）。 [#75010](https://github.com/ClickHouse/ClickHouse/pull/75010) ([Daniil Ivanik](https://github.com/divanik)).
* 现在支持通过 `KILL QUERY` 或执行超时（`max_execution_time`）来取消 `ALTER TABLE ... FREEZE ...` 查询。 [#75016](https://github.com/ClickHouse/ClickHouse/pull/75016) ([Kirill](https://github.com/kirillgarbar)).
* 新增对 `groupUniqArrayArrayMap` 作为 `SimpleAggregateFunction` 的支持。 [#75034](https://github.com/ClickHouse/ClickHouse/pull/75034) ([Miel Donkers](https://github.com/mdonkers)).
* 在 Postgres 线路协议中增加对预处理语句的支持。 [#75035](https://github.com/ClickHouse/ClickHouse/pull/75035) ([scanhex12](https://github.com/scanhex12)).
* 在 `Iceberg` 数据库引擎中隐藏目录凭据配置。修复 [#74559](https://github.com/ClickHouse/ClickHouse/issues/74559)。[#75080](https://github.com/ClickHouse/ClickHouse/pull/75080)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 在 BuzzHouse 中添加了几个之前缺失的功能：`ILIKE` 和 `REGEXP` 运算符、`<=>` 和 `IS NOT DISTINCT FROM`。 [#75168](https://github.com/ClickHouse/ClickHouse/pull/75168) ([Pedro Ferreira](https://github.com/PedroTadim))。
* 设置项 `min_chunk_bytes_for_parallel_parsing` 现在不能再被设为零。修复了：[ #71110](https://github.com/ClickHouse/ClickHouse/issues/71110)。[#75239](https://github.com/ClickHouse/ClickHouse/pull/75239)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* `intExp2` / `intExp10`：明确未定义行为：对过小的参数返回 0，对过大的参数返回 `18446744073709551615`，如果为 `nan` 则抛出异常。[#75312](https://github.com/ClickHouse/ClickHouse/pull/75312)（[Vitaly Baranov](https://github.com/vitlibar)）。
* 在 `DatabaseIceberg` 中通过 catalog 配置原生支持 `s3.endpoint`。关闭 [#74558](https://github.com/ClickHouse/ClickHouse/issues/74558)。[#75375](https://github.com/ClickHouse/ClickHouse/pull/75375)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 当执行 `SYSTEM DROP REPLICA` 的用户没有足够权限时，将不再静默失败。[#75377](https://github.com/ClickHouse/ClickHouse/pull/75377) ([Bharat Nallan](https://github.com/bharatnc))。
* 添加一个 ProfileEvent，用于统计任何系统日志刷写失败的次数。[#75466](https://github.com/ClickHouse/ClickHouse/pull/75466) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 为解密和解压缩添加检查和日志。 [#75471](https://github.com/ClickHouse/ClickHouse/pull/75471) ([Vitaly Baranov](https://github.com/vitlibar)).
* 在 `parseTimeDelta` 函数中新增了对微符号（U+00B5）的支持。现在微符号（U+00B5）和希腊字母 mu（U+03BC）都被识别为微秒的有效表示形式，使 ClickHouse 的行为与 Go 的实现保持一致（[参见 time.go](https://github.com/golang/go/blob/ad7b46ee4ac1cee5095d64b01e8cf7fcda8bee5e/src/time/time.go#L983C19-L983C20) 和 [time/format.go](https://github.com/golang/go/blob/ad7b46ee4ac1cee5095d64b01e8cf7fcda8bee5e/src/time/format.go#L1608-L1609)）。[#75472](https://github.com/ClickHouse/ClickHouse/pull/75472)（[Vitaly Orlov](https://github.com/orloffv)）。
* 将服务器端设置（`send_settings_to_client`）替换为客户端设置（`apply_settings_from_server`），该设置控制客户端侧代码（例如解析 INSERT 数据和格式化查询输出）是否应使用服务器端 `users.xml` 和用户配置文件中的设置。否则，将只使用来自客户端命令行、会话以及查询本身的设置。注意，这仅适用于原生客户端（不适用于例如 HTTP），并且不适用于大部分查询处理过程（这些处理发生在服务器端）。[#75478](https://github.com/ClickHouse/ClickHouse/pull/75478)（[Michael Kolupaev](https://github.com/al13n321)）。
* Keeper 改进：在提交到内存存储时禁用摘要计算以提升性能。可以通过 `keeper_server.digest_enabled_on_commit` 配置项启用该功能。在对请求进行预处理时仍会计算摘要。[#75490](https://github.com/ClickHouse/ClickHouse/pull/75490) ([Antonio Andelic](https://github.com/antonio2368))。
* 在可能的情况下，从 JOIN 的 ON 子句中下推过滤表达式。[#75536](https://github.com/ClickHouse/ClickHouse/pull/75536) ([Vladimir Cherkasov](https://github.com/vdimir))。
* 改进了语法错误时的错误信息。此前，如果查询过大，且长度超限的记号是一个非常长的字符串字面量，用于说明错误原因的消息会淹没在该超长记号的两个示例之间。修复了在错误信息中包含 UTF-8 字符的查询被错误截断的问题。修复了查询片段被过度加引号的问题。此更改关闭了 [#75473](https://github.com/ClickHouse/ClickHouse/issues/75473)。[#75561](https://github.com/ClickHouse/ClickHouse/pull/75561)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在存储 `S3(Azure)Queue` 中添加 ProfileEvents 事件。 [#75618](https://github.com/ClickHouse/ClickHouse/pull/75618) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 为兼容性起见，禁用从服务器向客户端发送设置（`send_settings_to_client=false`）（该功能稍后将以客户端设置的形式重新实现，以提升易用性）。 [#75648](https://github.com/ClickHouse/ClickHouse/pull/75648) ([Michael Kolupaev](https://github.com/al13n321)).
* 添加配置项 `memory_worker_correct_memory_tracker`，以启用利用后台线程定期读取的其他来源信息来修正内部内存跟踪器。 [#75714](https://github.com/ClickHouse/ClickHouse/pull/75714) ([Antonio Andelic](https://github.com/antonio2368))。
* 在 PrometheusRemoteReadProtocol 中使用 Analyzer。 [#75729](https://github.com/ClickHouse/ClickHouse/pull/75729) ([Dmitry Novik](https://github.com/novikd))。
* 我们已经支持 gauge/counter 类型的指标。然而，对于某些指标（例如对 ClickHouse Keeper 的请求响应时间）来说，这还不够用，因此需要增加对 histogram 类型指标的支持。该接口与 Prometheus 客户端非常相似，只需调用 `observe(value)`，即可增加对应 value 所在 bucket 中的计数。histogram 指标通过 system.histogram&#95;metrics 对外暴露。 [#75736](https://github.com/ClickHouse/ClickHouse/pull/75736) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
* 在 `system.processes` 中添加列 `normalized_query_hash`。注意：虽然可以通过 `normalizedQueryHash` 函数在运行时轻松计算得到，但这是为后续变更做准备所必需的。[#75756](https://github.com/ClickHouse/ClickHouse/pull/75756)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 即使存在一个基于已不存在数据库创建的 `Merge` 表，查询 `system.tables` 也不会抛出异常。移除 `Hive` 表中的 `getTotalRows` 方法，因为我们不允许它执行复杂操作。[#75772](https://github.com/ClickHouse/ClickHouse/pull/75772)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* Web UI 现已支持交互式数据库导航。[#75777](https://github.com/ClickHouse/ClickHouse/pull/75777)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 允许在存储策略中组合只读磁盘和读写磁盘（作为多个卷或多个磁盘）。这样可以从整个卷读取数据，而写入操作将优先落到可写磁盘上（即 Copy-on-Write 存储策略）。 [#75862](https://github.com/ClickHouse/ClickHouse/pull/75862) ([Azat Khuzhin](https://github.com/azat)).
* 从 system.opentelemetry&#95;span&#95;log 表的默认 ORDER BY 中移除 trace&#95;id。 [#75907](https://github.com/ClickHouse/ClickHouse/pull/75907) ([Azat Khuzhin](https://github.com/azat)).
* 现在可以将加密（XML 属性 `encrypted_by`）应用于任意配置文件（config.xml、users.xml、嵌套的配置文件）。此前，它只适用于顶层 config.xml 配置文件。[#75911](https://github.com/ClickHouse/ClickHouse/pull/75911)（[Mikhail Gorshkov](https://github.com/mgorshkov)）。
* 以微秒精度存储备份的 start&#95;time 和 end&#95;time。[#75929](https://github.com/ClickHouse/ClickHouse/pull/75929) ([Aleksandr Musorin](https://github.com/AVMusorin)).
* 新增名为 `MemoryTrackingUncorrected` 的指标，用于显示未经过 RSS 校正的内部全局内存跟踪器的值。 [#75935](https://github.com/ClickHouse/ClickHouse/pull/75935) ([Antonio Andelic](https://github.com/antonio2368)).
* 对 MergeTree 中的列和索引大小进行惰性计算。 [#75938](https://github.com/ClickHouse/ClickHouse/pull/75938) ([Pavel Kruglov](https://github.com/Avogar)).
* 当输出列仅依赖于左表时，可将 `JOIN` 转换为 `IN` 子查询；但该转换首先需要增加一个唯一性处理步骤，因此在该步骤补充之前默认不启用此优化。[#75942](https://github.com/ClickHouse/ClickHouse/pull/75942) ([Shichao Jin](https://github.com/jsc0218))。
* 新增了一个服务器设置 `throw_on_unknown_workload`，用于在查询设置了 `workload` 且其值为未知时选择行为：要么允许不受限制地访问（默认），要么抛出 `RESOURCE_ACCESS_DENIED` 错误。该设置可用于强制所有查询都使用 workload 调度。[#75999](https://github.com/ClickHouse/ClickHouse/pull/75999) ([Sergei Trifonov](https://github.com/serxa))。
* 使新的实验性的 Kafka 表引擎完全遵循 Keeper 功能开关。 [#76004](https://github.com/ClickHouse/ClickHouse/pull/76004) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* 在 ARRAY JOIN 中，如非必要，不要将子列重写为 getSubcolumn。 [#76018](https://github.com/ClickHouse/ClickHouse/pull/76018) ([Pavel Kruglov](https://github.com/Avogar)).
* 在加载表时重试协调相关错误。 [#76020](https://github.com/ClickHouse/ClickHouse/pull/76020) ([Alexander Tokmakov](https://github.com/tavplubix)).
* 改进 `system.warnings` 表，并添加一些可动态添加、更新或删除的警告信息。[#76029](https://github.com/ClickHouse/ClickHouse/pull/76029) ([Bharat Nallan](https://github.com/bharatnc))。
* 支持在 SYSTEM FLUSH LOGS 中单独刷新日志。[#76132](https://github.com/ClickHouse/ClickHouse/pull/76132) ([Raúl Marín](https://github.com/Algunenano)).
* 改进了 `/binary` 服务器的页面。使用 Hilbert 曲线替代 Morton 曲线。在方形中显示 512 MB 的地址，使方形填充得更充分（在之前的版本中，地址只填充了方形的一半）。根据更接近库名而非函数名为地址着色。允许在区域外多滚动一点。[#76192](https://github.com/ClickHouse/ClickHouse/pull/76192)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 该 PR 禁止再运行查询 `ALTER USER user1 ADD PROFILES a, DROP ALL PROFILES`，因为所有 `DROP` 操作必须排在最前面。[#76242](https://github.com/ClickHouse/ClickHouse/pull/76242) ([pufit](https://github.com/pufit)).
* 针对 SYNC REPLICA 的多项改进（更清晰的错误信息、更完善的测试、合理性检查）。 [#76307](https://github.com/ClickHouse/ClickHouse/pull/76307) ([Azat Khuzhin](https://github.com/azat)).
* 当出现 TOO&#95;MANY&#95;SIMULTANEOUS&#95;QUERIES 时，对 ON CLUSTER 查询进行重试。 [#76352](https://github.com/ClickHouse/ClickHouse/pull/76352) ([Patrick Galbraith](https://github.com/CaptTofu)).
* 将 `output_format_pretty_max_rows` 的默认值从 10000 更改为 1000。我认为这在易用性方面更好。[#76407](https://github.com/ClickHouse/ClickHouse/pull/76407)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 为只读 MergeTree 表增加刷新支持。[#76467](https://github.com/ClickHouse/ClickHouse/pull/76467) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 在备份到 S3 时，如果分段复制因 Access Denied 失败，则使用正确的回退机制。当在使用不同凭据的 bucket 之间执行备份时，分段复制可能会触发 Access Denied 错误。[#76515](https://github.com/ClickHouse/ClickHouse/pull/76515)（[Antonio Andelic](https://github.com/antonio2368)）。
* 加快 ClickHouse 服务器关闭速度（消除 2.5 秒延迟）。[#76550](https://github.com/ClickHouse/ClickHouse/pull/76550) ([Azat Khuzhin](https://github.com/azat)).
* 在 system.errors 中添加 query&#95;id。相关 Issue [#75815](https://github.com/ClickHouse/ClickHouse/issues/75815)。[#76581](https://github.com/ClickHouse/ClickHouse/pull/76581)（[Vladimir Baikov](https://github.com/bkvvldmr)）。
* 将 librdkafka 升级到 2.8.0 版本，并改进了 Kafka 表的关闭流程，从而减少在删除表和重启服务器时的延迟。`engine=Kafka` 在表被删除时不再显式退出其消费者组。取而代之的是，该消费者会继续留在组中，直到在 `session_timeout_ms`（默认：45 秒）内保持空闲后被自动移除。[#76621](https://github.com/ClickHouse/ClickHouse/pull/76621)（[filimonov](https://github.com/filimonov)）。
* 修复对 S3 请求配置的验证。[#76658](https://github.com/ClickHouse/ClickHouse/pull/76658) ([Vitaly Baranov](https://github.com/vitlibar)).
* 在 `readbufferfroms3` 和其他远程读取缓冲区中避免过多的内存分配，将其内存占用减半。 [#76692](https://github.com/ClickHouse/ClickHouse/pull/76692) ([Sema Checherinda](https://github.com/CheSema)).
* 支持从 View 中读取 JSON 类型及其子列。 [#76903](https://github.com/ClickHouse/ClickHouse/pull/76903) ([Pavel Kruglov](https://github.com/Avogar)).
* 添加对将 UInt128 转换为 IPv6 的支持。这使得可以对 IPv6 执行 `bitAnd` 运算和算术运算，并将其转换回 IPv6。关闭了 [#76752](https://github.com/ClickHouse/ClickHouse/issues/76752)。这也允许将对 IPv6 执行 `bitAnd` 运算的结果转换回 IPv6。参见：[https://github.com/ClickHouse/ClickHouse/pull/57707](https://github.com/ClickHouse/ClickHouse/pull/57707)。[#76928](https://github.com/ClickHouse/ClickHouse/pull/76928)（[Muzammil Abdul Rehman](https://github.com/muzammilar)）。
* 像 `server_settings` 或 `settings` 这样的系统表都带有一个 `default` 值列，这很方便。此前只有 `merge_tree_settings` 和 `replicated_merge_tree_settings` 未启用该列。[#76942](https://github.com/ClickHouse/ClickHouse/pull/76942)（[Diego Nieto](https://github.com/lesandie)）。
* 默认情况下，不再在 Variant 类型的文本格式中解析特殊的 Bool 值。可以通过启用设置 `allow_special_bool_values_inside_variant` 来恢复该行为。[#76974](https://github.com/ClickHouse/ClickHouse/pull/76974) ([Pavel Kruglov](https://github.com/Avogar)).
* 在会话级和服务器级支持按任务配置低优先级查询的等待时间。[#77013](https://github.com/ClickHouse/ClickHouse/pull/77013)（[VicoWu](https://github.com/VicoWu)）。
* 新增 `ProfileEvents::QueryPreempted`，其逻辑与 `CurrentMetrics::QueryPreempted` 一致。[#77015](https://github.com/ClickHouse/ClickHouse/pull/77015) ([VicoWu](https://github.com/VicoWu))。
* 此前，`database replicated` 可能会在日志中输出查询中指定的凭据。此行为已修复。相关问题已关闭：[#77123](https://github.com/ClickHouse/ClickHouse/issues/77123)。[#77133](https://github.com/ClickHouse/ClickHouse/pull/77133)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 将 zstd 从 1.5.5 升级到 1.5.7，带来了[相当不错的性能提升](https://github.com/facebook/zstd/releases/tag/v1.5.7)。[#77137](https://github.com/ClickHouse/ClickHouse/pull/77137)（[Pradeep Chhetri](https://github.com/chhetripradeep)）。
* 允许在 plain&#95;rewritable 磁盘上使用 ALTER TABLE DROP PARTITION。 [#77138](https://github.com/ClickHouse/ClickHouse/pull/77138) ([Julia Kartseva](https://github.com/jkartseva)).
* 在零拷贝复制的情况下，新增在合并/变更执行前随机休眠最长 500ms 的功能，且与数据片段大小无关。[#77165](https://github.com/ClickHouse/ClickHouse/pull/77165) ([Alexey Katsman](https://github.com/alexkats))。
* 在将 `TRUNCATE` 与 `INTO OUTFILE` 一起使用时，支持原子重命名。修复 [#70323](https://github.com/ClickHouse/ClickHouse/issues/70323)。[#77181](https://github.com/ClickHouse/ClickHouse/pull/77181)（[Onkar Deshpande](https://github.com/onkar)）。
* 对 PostgreSQL 的 CHARACTER、CHAR 和 BPCHAR 类型使用 FixedString。 [#77304](https://github.com/ClickHouse/ClickHouse/pull/77304) ([Pablo Marcos](https://github.com/pamarcos)).
* 允许通过存储/表函数设置 `iceberg_metadata_file_path` 来显式指定要读取的 Iceberg 元数据文件。修复 [#47412](https://github.com/ClickHouse/ClickHouse/issues/47412)。[#77318](https://github.com/ClickHouse/ClickHouse/pull/77318)（[alesapin](https://github.com/alesapin)）。
* 支持数据库使用远程磁盘存储元数据文件。[#77365](https://github.com/ClickHouse/ClickHouse/pull/77365) ([Tuan Pham Anh](https://github.com/tuanpach))。
* 实现 JSON 数据类型值的比较功能。现在可以像 Map 一样比较 JSON 对象。[#77397](https://github.com/ClickHouse/ClickHouse/pull/77397) ([Pavel Kruglov](https://github.com/Avogar))。
* 已回滚更改。[#77399](https://github.com/ClickHouse/ClickHouse/pull/77399) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 备份/恢复设置 `allow_s3_native_copy` 现在支持三个可能的取值：`False` - 不使用 S3 原生复制；`True`（旧默认值）- ClickHouse 将首先尝试使用 S3 原生复制，如果失败则回退到读取+写入方式；`'auto'`（新默认值）- ClickHouse 会先比较源和目标的凭证。如果相同，ClickHouse 将尝试使用 S3 原生复制，然后可能回退到读取+写入方式。如果不同，ClickHouse 将直接采用读取+写入方式。[#77401](https://github.com/ClickHouse/ClickHouse/pull/77401) ([Vitaly Baranov](https://github.com/vitlibar))。
* plain&#95;rewritable 磁盘现已支持 ALTER TABLE ... ATTACH|DETACH|MOVE|REPLACE PARTITION。 [#77406](https://github.com/ClickHouse/ClickHouse/pull/77406) ([Julia Kartseva](https://github.com/jkartseva)).
* 关于跳过索引缓存的更改已被回滚。[#77447](https://github.com/ClickHouse/ClickHouse/pull/77447) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* 在预取 Wide 格式数据部分中的 JSON 列时降低内存使用量。 [#77640](https://github.com/ClickHouse/ClickHouse/pull/77640) ([Pavel Kruglov](https://github.com/Avogar)).
* 在 DeltaLake 表引擎的 Delta 内核中增加对 AWS 会话令牌和环境变量凭证的支持。 [#77661](https://github.com/ClickHouse/ClickHouse/pull/77661) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 支持在 `additional_table_filters` 设置中使用查询参数。更改之后，以下查询将会成功执行：[#77680](https://github.com/ClickHouse/ClickHouse/pull/77680) ([wxybear](https://github.com/wxybear))。
* 现在可以在 UDF（用户定义函数）的 XML 定义中通过一个新的标签将其标记为确定性函数。此外，查询缓存现在会检查查询中调用的 UDF 是否为确定性函数；如果是，则会缓存该查询结果。（Issue [#59988](https://github.com/ClickHouse/ClickHouse/issues/59988)）。[#77769](https://github.com/ClickHouse/ClickHouse/pull/77769)（[Jimmy Aguilar Mena](https://github.com/Ergus)）。
* 新增 Buffer 表引擎参数校验功能。[#77840](https://github.com/ClickHouse/ClickHouse/pull/77840) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* 添加配置项 `enable_hdfs_pread` 用于启用或禁用 HDFS 预读（pread）。[#77885](https://github.com/ClickHouse/ClickHouse/pull/77885) ([kevinyhzou](https://github.com/KevinyhZou))。
* 新增用于统计 ZooKeeper “multi” 读写请求次数的 profile events。 [#77888](https://github.com/ClickHouse/ClickHouse/pull/77888) ([JackyWoo](https://github.com/JackyWoo)).
* 在启用 `disable_insertion_and_mutation` 设置时，允许创建临时表并向其中插入数据。 [#77901](https://github.com/ClickHouse/ClickHouse/pull/77901) ([Xu Jia](https://github.com/XuJia0210)).
* 将 max&#95;insert&#95;delayed&#95;streams&#95;for&#95;parallel&#95;write 的值降低至 100。 [#77919](https://github.com/ClickHouse/ClickHouse/pull/77919) ([Azat Khuzhin](https://github.com/azat)).
* 添加了通过 `max_merge_delayed_streams_for_parallel_write` 配置合并操作中可并行刷新的列数的支持（这应当能将写入 S3 的垂直合并的内存占用减少约 25 倍）。 [#77922](https://github.com/ClickHouse/ClickHouse/pull/77922) ([Azat Khuzhin](https://github.com/azat))。
* 修复 Joda 语法中类似 &#39;yyy&#39; 的年份解析问题。[#77973](https://github.com/ClickHouse/ClickHouse/pull/77973) ([李扬](https://github.com/taiyang-li)).
* 将 MergeTree 表的各个 part 按块顺序进行附加，这对于诸如 ReplacingMergeTree 之类的特殊合并算法非常重要。修复了 [#71009](https://github.com/ClickHouse/ClickHouse/issues/71009)。[#77976](https://github.com/ClickHouse/ClickHouse/pull/77976)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 查询脱敏规则现在可以在发生匹配时抛出 `LOGICAL_ERROR`。这有助于检查预定义密码是否在日志中的任何位置泄露。[#78094](https://github.com/ClickHouse/ClickHouse/pull/78094) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* 向 `information_schema.tables` 添加了列 `index_length_column`，以便更好地兼容 MySQL。[#78119](https://github.com/ClickHouse/ClickHouse/pull/78119) ([Paweł Zakrzewski](https://github.com/KrzaQ))。
* 引入两个新指标：`TotalMergeFailures` 和 `NonAbortedMergeFailures`。这些指标用于检测在短时间内发生过多合并失败的情况。[#78150](https://github.com/ClickHouse/ClickHouse/pull/78150)（[Miсhael Stetsyuk](https://github.com/mstetsyuk)）。
* 修复在使用路径风格且未指定 key 时，对 S3 URI 的错误解析。[#78185](https://github.com/ClickHouse/ClickHouse/pull/78185)（[Arthur Passos](https://github.com/arthurpassos)）。
* 修复异步指标 `BlockActiveTime`、`BlockDiscardTime`、`BlockWriteTime`、`BlockQueueTime` 和 `BlockReadTime` 的取值错误问题（修改前会将 1 秒错误地报告为 0.001）。[#78211](https://github.com/ClickHouse/ClickHouse/pull/78211)（[filimonov](https://github.com/filimonov)）。
* 在从 StorageS3(Azure)Queue 推送到物化视图时，现在会对出现的错误遵守 `loading_retries` 的重试次数限制。在此之前，此类错误会被无限次重试。[#78313](https://github.com/ClickHouse/ClickHouse/pull/78313) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 在采用 delta-kernel-rs 实现的 StorageDeltaLake 中，修复性能和进度条相关问题。[#78368](https://github.com/ClickHouse/ClickHouse/pull/78368) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 向量相似度索引可能会导致内存最多被多分配 2 倍。此修复重构了内存分配策略，降低了内存消耗，并提升了向量相似度索引缓存的有效性。（问题 [#78056](https://github.com/ClickHouse/ClickHouse/issues/78056)）。[#78394](https://github.com/ClickHouse/ClickHouse/pull/78394)（[Shankar Iyer](https://github.com/shankar-iyer)）。
* 为 `system.metric_log` 表引入了一个用于指定 schema 类型的设置项 `schema_type`。支持的 schema 有三种：`wide` —— 当前的 schema，每个 metric/event 单独占用一列（对单列读取最为高效）；`transposed` —— 类似于 `system.asynchronous_metric_log`，metrics/events 以行的形式存储；以及更有意思的 `transposed_with_wide_view` —— 使用 `transposed` schema 创建底层表，同时额外提供一个 `wide` schema 的视图，将对视图的查询转换到底层表。在 `transposed_with_wide_view` 中，视图不支持亚秒级分辨率，`event_time_microseconds` 仅作为向后兼容的别名存在。 [#78412](https://github.com/ClickHouse/ClickHouse/pull/78412) ([alesapin](https://github.com/alesapin))。
* 为运行时磁盘增加对 `include`、`from_env`、`from_zk` 的支持。关闭 [#78177](https://github.com/ClickHouse/ClickHouse/issues/78177)。[#78470](https://github.com/ClickHouse/ClickHouse/pull/78470)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 为 iceberg 表函数和引擎新增多种便捷方式，用于解析根 metadata.json 文件。修复 [#78455](https://github.com/ClickHouse/ClickHouse/issues/78455)。[#78475](https://github.com/ClickHouse/ClickHouse/pull/78475)（[Daniil Ivanik](https://github.com/divanik)）。
* 支持 Delta Lake 的分区裁剪。 [#78486](https://github.com/ClickHouse/ClickHouse/pull/78486) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 为 ClickHouse 中的 SSH 协议增加对基于密码认证的支持。 [#78586](https://github.com/ClickHouse/ClickHouse/pull/78586) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
* 为长时间运行的 mutation 向 `system.warnings` 表添加动态警告。[#78658](https://github.com/ClickHouse/ClickHouse/pull/78658) ([Bharat Nallan](https://github.com/bharatnc))。
* 当 CPU 严重过载时，丢弃连接。该决策基于等待时间（`OSCPUWaitMicroseconds`）与占用时间（`OSCPUVirtualTimeMicroseconds`）的比值做出。当该比值处于 `min_os_cpu_wait_time_ratio_to_drop_connection` 和 `max_os_cpu_wait_time_ratio_to_drop_connection` 之间时，将以一定概率丢弃查询。[#78778](https://github.com/ClickHouse/ClickHouse/pull/78778) ([Alexey Katsman](https://github.com/alexkats))。
* 允许 Hive 分区使用空值。[#78816](https://github.com/ClickHouse/ClickHouse/pull/78816) ([Arthur Passos](https://github.com/arthurpassos)).
* 修复 `BFloat16` 在 `IN` 子句中的类型转换问题（即 `SELECT toBFloat16(1) IN [1, 2, 3];` 现在会返回 `1`）。关闭 [#78754](https://github.com/ClickHouse/ClickHouse/issues/78754)。[#78839](https://github.com/ClickHouse/ClickHouse/pull/78839)（[Raufs Dunamalijevs](https://github.com/rienath)）。
* 如果设置了 disk=，则不要在其他磁盘上检查 MergeTree 的数据部分。 [#78855](https://github.com/ClickHouse/ClickHouse/pull/78855) ([Azat Khuzhin](https://github.com/azat)).
* 将 `system.query_log` 中 `used_data_type_families` 的数据类型统一为规范形式。[#78972](https://github.com/ClickHouse/ClickHouse/pull/78972) ([Kseniia Sumarokova](https://github.com/kssenii))。

## Bug 修复（官方稳定版本中用户可见的异常行为） {#bug-fix}

* 修复了使用 keeper-client 时无法创建 SEQUENTIAL 节点的问题。 [#64177](https://github.com/ClickHouse/ClickHouse/pull/64177) ([Duc Canh Le](https://github.com/canhld94)).
* 修正父作用域中的标识符解析。允许在 `WITH` 子句中为表达式使用别名。修复 [#58994](https://github.com/ClickHouse/ClickHouse/issues/58994)。修复 [#62946](https://github.com/ClickHouse/ClickHouse/issues/62946)。修复 [#63239](https://github.com/ClickHouse/ClickHouse/issues/63239)。修复 [#65233](https://github.com/ClickHouse/ClickHouse/issues/65233)。修复 [#71659](https://github.com/ClickHouse/ClickHouse/issues/71659)。修复 [#71828](https://github.com/ClickHouse/ClickHouse/issues/71828)。修复 [#68749](https://github.com/ClickHouse/ClickHouse/issues/68749)。[#66143](https://github.com/ClickHouse/ClickHouse/pull/66143)（[Dmitry Novik](https://github.com/novikd)）。
* 修复 PositionImpl::vectorVector 中错误的字符计数。[#71003](https://github.com/ClickHouse/ClickHouse/pull/71003) ([思维](https://github.com/heymind)).
* 修复 `negate` 函数的单调性问题。在之前的版本中，查询 `select * from a where -x = -42;`（其中 `x` 为主键）可能会返回错误结果。[#71440](https://github.com/ClickHouse/ClickHouse/pull/71440) ([Michael Kolupaev](https://github.com/al13n321))。
* 由于未正确处理部分权限撤销，针对访问实体执行 `RESTORE` 操作时所需权限超出了实际必要范围。此 PR 修复了该问题。关闭 [#71853](https://github.com/ClickHouse/ClickHouse/issues/71853)。[#71958](https://github.com/ClickHouse/ClickHouse/pull/71958)（[pufit](https://github.com/pufit)）。
* 避免在执行 `ALTER TABLE REPLACE/MOVE PARTITION FROM/TO TABLE` 后发生暂停。获取正确的后台任务调度设置。[#72024](https://github.com/ClickHouse/ClickHouse/pull/72024) ([Aleksei Filatov](https://github.com/aalexfvk))。
* 修复 `arrayIntersect` 对空元组的处理问题。修复了 [#72578](https://github.com/ClickHouse/ClickHouse/issues/72578)。[#72581](https://github.com/ClickHouse/ClickHouse/pull/72581)（[Amos Bird](https://github.com/amosbird)）。
* 修复某些输入和输出格式（例如 Parquet、Arrow）中空元组的处理。[#72616](https://github.com/ClickHouse/ClickHouse/pull/72616)（[Michael Kolupaev](https://github.com/al13n321)）。
* 现在，对通配符数据库/表执行列级 GRANT SELECT/INSERT 语句会报错。[#72646](https://github.com/ClickHouse/ClickHouse/pull/72646)（[Johann Gan](https://github.com/johanngan)）。
* 修复了由于目标访问实体中存在隐式权限授予而导致用户无法执行 `REVOKE ALL ON *.*` 的问题。[#72872](https://github.com/ClickHouse/ClickHouse/pull/72872) ([pufit](https://github.com/pufit)).
* 修复异步分布式 INSERT 在处理待处理批次时卡住的问题（例如遇到 `No such file or directory` 错误）。 [#72939](https://github.com/ClickHouse/ClickHouse/pull/72939) ([Azat Khuzhin](https://github.com/azat)).
* 添加对 Azure SAS 令牌的支持。 [#72959](https://github.com/ClickHouse/ClickHouse/pull/72959) ([Azat Khuzhin](https://github.com/azat)).
* 修复 `formatDateTime` 标量函数在正时区偏移下的格式化问题。[#73091](https://github.com/ClickHouse/ClickHouse/pull/73091) ([ollidraese](https://github.com/ollidraese))。
* 修复在通过 PROXYv1 建立连接且设置了 `auth_use_forwarded_address` 时，未能正确反映源端口的问题——此前错误地使用了代理端口。新增 `currentQueryID()` 函数。 [#73095](https://github.com/ClickHouse/ClickHouse/pull/73095) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 将格式设置传递到 `TCPHandler` 中的 `NativeWriter`，以确保诸如 `output_format_native_write_json_as_string` 之类的设置能够被正确应用。[#73179](https://github.com/ClickHouse/ClickHouse/pull/73179) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复读取 JSON 子对象的子列时使用错误前缀的问题。[#73182](https://github.com/ClickHouse/ClickHouse/pull/73182) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复 StorageObjectStorageQueue 中的崩溃问题。 [#73274](https://github.com/ClickHouse/ClickHouse/pull/73274) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复服务器关闭期间在可刷新物化视图中出现的罕见崩溃。[#73323](https://github.com/ClickHouse/ClickHouse/pull/73323) ([Michael Kolupaev](https://github.com/al13n321))。
* 函数 `formatDateTime` 的 `%f` 占位符现在无条件地生成 6 位（秒以下）数字。这使其行为与 MySQL 的 `DATE_FORMAT` 函数兼容。可以通过将设置项 `formatdatetime_f_prints_scale_number_of_digits` 设为 `1` 来恢复之前的行为。[#73324](https://github.com/ClickHouse/ClickHouse/pull/73324)（[ollidraese](https://github.com/ollidraese)）。
* 通过在索引分析中对隐式 Date 向 DateTime 的转换强制采用饱和处理，改进了日期时间转换逻辑。这解决了由于日期时间范围限制而导致的索引分析结果不准确的潜在问题，修复了 [#73307](https://github.com/ClickHouse/ClickHouse/issues/73307)。同时也修复了在 `date_time_overflow_behavior = 'ignore'`（默认值）时的显式 `toDateTime` 转换。[#73326](https://github.com/ClickHouse/ClickHouse/pull/73326)（[Amos Bird](https://github.com/amosbird)）。
* 修复了从 `S3` 存储和表函数读取时基于 `_etag` 列进行过滤的问题。[#73353](https://github.com/ClickHouse/ClickHouse/pull/73353) ([Anton Popov](https://github.com/CurtizJ))。
* 修复在使用旧分析器时，在 `JOIN ON` 表达式中使用 `IN (subquery)` 会触发 `Not-ready Set is passed as the second argument for function 'in'` 错误的问题。[#73382](https://github.com/ClickHouse/ClickHouse/pull/73382) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* 修复 Dynamic 和 JSON 列在压缩前的预处理逻辑。此前在某些情况下，即使尚未达到类型/路径的上限，新类型仍可能被插入到 shared variant/shared data 中。[#73388](https://github.com/ClickHouse/ClickHouse/pull/73388)（[Pavel Kruglov](https://github.com/Avogar)）。
* 在类型的二进制解码过程中检查损坏的大小值，以防止过大的内存分配。[#73390](https://github.com/ClickHouse/ClickHouse/pull/73390) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复了在启用并行副本功能的单副本集群中读取数据时出现的逻辑错误。 [#73403](https://github.com/ClickHouse/ClickHouse/pull/73403) ([Michael Kolupaev](https://github.com/al13n321)).
* 修复 ObjectStorageQueue 在与 ZooKeeper 和旧版本 Keeper 一起使用时的问题。[#73420](https://github.com/ClickHouse/ClickHouse/pull/73420) ([Antonio Andelic](https://github.com/antonio2368)).
* 实现了修复，使 hive 分区默认启用。[#73479](https://github.com/ClickHouse/ClickHouse/pull/73479)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 修复在创建向量相似度索引时的数据竞争问题。 [#73517](https://github.com/ClickHouse/ClickHouse/pull/73517) ([Antonio Andelic](https://github.com/antonio2368)).
* 修复了当字典源包含带有错误数据的函数时发生的段错误。 [#73535](https://github.com/ClickHouse/ClickHouse/pull/73535) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 修复存储引擎 S3(Azure)Queue 中对插入失败的重试机制。关闭 [#70951](https://github.com/ClickHouse/ClickHouse/issues/70951)。[#73546](https://github.com/ClickHouse/ClickHouse/pull/73546)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 修复了函数 `tupleElement` 中的错误，该错误在某些情况下处理具有 `LowCardinality` 元素并启用 `optimize_functions_to_subcolumns` 设置的元组时可能出现。[#73548](https://github.com/ClickHouse/ClickHouse/pull/73548) ([Anton Popov](https://github.com/CurtizJ)).
* 修复了解析后面跟随区间的 enum 通配符时的问题。修复了 [#73473](https://github.com/ClickHouse/ClickHouse/issues/73473)。[#73569](https://github.com/ClickHouse/ClickHouse/pull/73569)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 修复在非复制表的子查询中会忽略 parallel&#95;replicas&#95;for&#95;non&#95;replicated&#95;merge&#95;tree 设置的问题。 [#73584](https://github.com/ClickHouse/ClickHouse/pull/73584) ([Igor Nikonov](https://github.com/devcrafter)).
* 修复在无法调度任务时抛出的 `std::logical_error`。该问题在压力测试中发现。示例堆栈跟踪：`2024.12.19 02:05:46.171833 [ 18190 ] {01f0daba-d3cc-4898-9e0e-c2c263306427} <Fatal> : Logical error: 'std::exception. Code: 1001, type: std::__1::future_error, e.what() = The associated promise has been destructed prior to the associated state becoming ready. (version 25.1.1.18724), Stack trace:.` [#73629](https://github.com/ClickHouse/ClickHouse/pull/73629) ([Alexander Gololobov](https://github.com/davenger)).
* 在 `EXPLAIN SYNTAX` 中不对查询进行解释，以避免在分布式查询中因处理阶段设置不正确而产生逻辑错误。修复了 [#65205](https://github.com/ClickHouse/ClickHouse/issues/65205)。[#73634](https://github.com/ClickHouse/ClickHouse/pull/73634)（[Dmitry Novik](https://github.com/novikd)）。
* 修复 Dynamic 列中可能出现的数据不一致问题。修复可能出现的逻辑错误 `Nested columns sizes are inconsistent with local_discriminators column size`。[#73644](https://github.com/ClickHouse/ClickHouse/pull/73644) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复了在带有 `FINAL` 和 `SAMPLE` 的查询中出现的 `NOT_FOUND_COLUMN_IN_BLOCK` 错误。修复了从 `CollapsingMergeTree` 中使用 `FINAL` 的 SELECT 查询结果不正确的问题，并启用了 `FINAL` 的优化。[#73682](https://github.com/ClickHouse/ClickHouse/pull/73682) ([Anton Popov](https://github.com/CurtizJ)).
* 修复 LIMIT BY COLUMNS 中的崩溃。 [#73686](https://github.com/ClickHouse/ClickHouse/pull/73686) ([Raúl Marín](https://github.com/Algunenano)).
* 修复了这样一个 bug：在被强制使用常规投影，且查询与所定义的投影完全相同时，却没有选择该投影，从而导致报错。 [#73700](https://github.com/ClickHouse/ClickHouse/pull/73700) ([Shichao Jin](https://github.com/jsc0218)).
* 修复 Dynamic/Object 结构的反序列化问题。该问题可能会导致 CANNOT&#95;READ&#95;ALL&#95;DATA 异常。[#73767](https://github.com/ClickHouse/ClickHouse/pull/73767) ([Pavel Kruglov](https://github.com/Avogar))。
* 在从备份中恢复数据部分时跳过 `metadata_version.txt` 文件。[#73768](https://github.com/ClickHouse/ClickHouse/pull/73768) ([Vitaly Baranov](https://github.com/vitlibar))。
* 修复 [#73737](https://github.com/ClickHouse/ClickHouse/issues/73737)。[#73775](https://github.com/ClickHouse/ClickHouse/pull/73775)（[zhanglistar](https://github.com/zhanglistar)）。
* 修复了 [#72078](https://github.com/ClickHouse/ClickHouse/issues/72078)（S3 Express 支持功能异常）。[#73777](https://github.com/ClickHouse/ClickHouse/pull/73777)（[Sameer Tamsekar](https://github.com/stamsekar)）。
* 允许在 CollapsingMergeTree 表中合并包含 sign 列无效值的行。[#73864](https://github.com/ClickHouse/ClickHouse/pull/73864)（[Christoph Wurm](https://github.com/cwurm)）。
* 修复如下错误 `Row 1: ────── hostname: c-test-wy-37-server-nlkyjyb-0.c-test-wy-37-server-headless.ns-test-wy-37.svc.cluster.local type: ExceptionWhileProcessing event_date: 2024-12-23 event_time: 2024-12-23 16:21:19 event_time_microseconds: 2024-12-23 16:21:19.824624 query_start_time: 2024-12-23 16:21:19 query_start_time_microseconds: 2024-12-23 16:21:19.747142 query_duration_ms: 77 read_rows: 1 read_bytes: 134 written_rows: 0 written_bytes: 0 result_rows: 0 result_bytes: 0 memory_usage: 7824 current_database: default query: CREATE DATABASE db0 formatted_query: normalized_query_hash: 7820917191074023511 -- 7.82 quintillion query_kind: Create databases: ['db0'] tables: [] columns: [] partitions: [] projections: [] views: [] exception_code: 170 exception: Code: 170. DB::Exception: Bad get: has Null, requested Int64: While executing DDLOnClusterQueryStatus. (BAD_GET) (version 25.1.1.19134 (official build)) stack_trace: 0. ./build_docker/./src/Common/Exception.cpp:107: DB::Exception::Exception(DB::Exception::MessageMasked&&, int, bool) @ 0x000000000da5e53b 1. DB::Exception::Exception(PreformattedMessage&&, int) @ 0x00000000088aca4c 2. DB::Exception::Exception<std::basic_string_view<char, std::char_traits<char>>, std::basic_string_view<char, std::char_traits<char>>>(int, FormatStringHelperImpl<std::type_identity<std::basic_string_view<char, std::char_traits<char>>>::type, std::type_identity<std::basic_string_view<char, std::char_traits<char>>>::type>, std::basic_string_view<char, std::char_traits<char>>&&, std::basic_string_view<char, std::char_traits<char>>&&) @ 0x00000000088bae8b 3. auto& DB::Field::safeGet<long>() & @ 0x0000000008a3c748 4. ./src/Core/Field.h:484: DB::ColumnVector<long>::insert(DB::Field const&) @ 0x0000000012e44c0f 5. ./build_docker/./src/Interpreters/DDLOnClusterQueryStatusSource.cpp:53: DB::DDLOnClusterQueryStatusSource::generateChunkWithUnfinishedHosts() const @ 0x0000000012a40214 6. ./build_docker/./src/Interpreters/DDLOnClusterQueryStatusSource.cpp:104: DB::DDLOnClusterQueryStatusSource::handleTimeoutExceeded() @ 0x0000000012a41640 7. ./build_docker/./src/Interpreters/DDLOnClusterQueryStatusSource.cpp:109: DB::DDLOnClusterQueryStatusSource::stopWaitingOfflineHosts() @ 0x0000000012a41be9 8. ./build_docker/./src/Interpreters/DistributedQueryStatusSource.cpp:182: DB::DistributedQueryStatusSource::generate() @ 0x0000000011feb3bf 9. ./build_docker/./src/Processors/ISource.cpp:139: DB::ISource::tryGenerate() @ 0x0000000014148f5b 10. ./build_docker/./src/Processors/ISource.cpp:108: DB::ISource::work() @ 0x0000000014148c47 11. ./build_docker/./src/Processors/Executors/ExecutionThreadContext.cpp:49: DB::ExecutionThreadContext::executeTask() @ 0x0000000014164fc7 12. ./build_docker/./src/Processors/Executors/PipelineExecutor.cpp:290: DB::PipelineExecutor::executeStepImpl(unsigned long, std::atomic<bool>*) @ 0x00000000141577e5`。[#73876](https://github.com/ClickHouse/ClickHouse/pull/73876)（[Tuan Pham Anh](https://github.com/tuanpach)）。
* 修复了在比较 `map()` 类型时偶发失败的问题，该问题是由于允许创建其嵌套 tuple 未显式命名为（&#39;keys&#39;、&#39;values&#39;）的 `Map` 所致。 [#73878](https://github.com/ClickHouse/ClickHouse/pull/73878) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 在解析 GROUP BY ALL 子句时忽略窗口函数。修复 [#73501](https://github.com/ClickHouse/ClickHouse/issues/73501)。[#73916](https://github.com/ClickHouse/ClickHouse/pull/73916)（[Dmitry Novik](https://github.com/novikd)）。
* 在客户端-服务器通信中正确传播 Native 格式设置。[#73924](https://github.com/ClickHouse/ClickHouse/pull/73924) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复隐式权限（之前被当作通配符处理）。[#73932](https://github.com/ClickHouse/ClickHouse/pull/73932)（[Azat Khuzhin](https://github.com/azat)）。
* 修复在创建嵌套 Maps 时出现的过高内存占用。[#73982](https://github.com/ClickHouse/ClickHouse/pull/73982)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复解析包含空键的嵌套 JSON 的问题。 [#73993](https://github.com/ClickHouse/ClickHouse/pull/73993) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复：当某个别名被另一个别名引用并以相反顺序进行选择时，该别名可能不会被添加到 projection 中。[#74033](https://github.com/ClickHouse/ClickHouse/pull/74033) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 使用 plain&#95;rewritable 元数据的磁盘可以在多个服务器实例之间共享。这是预期的使用方式：一个实例读取某个元数据对象的同时，另一个实例对其进行修改。在使用 Azure 存储初始化 plain&#95;rewritable 时，如果出现对象未找到错误会被忽略，其行为与为 S3 实现的逻辑类似。 [#74059](https://github.com/ClickHouse/ClickHouse/pull/74059) ([Julia Kartseva](https://github.com/jkartseva)).
* 修复 `any` 和 `anyLast` 在处理枚举类型和空表时的行为。[#74061](https://github.com/ClickHouse/ClickHouse/pull/74061)（[Joanna Hulboj](https://github.com/jh0x)）。
* 修复了用户在 `kafka` 表引擎中指定关键字参数时出现的问题。[#74064](https://github.com/ClickHouse/ClickHouse/pull/74064)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 修复在修改 Storage `S3Queue` 设置时，在带有 &quot;s3queue&#95;&quot; 前缀与不带此前缀之间切换时的问题。 [#74075](https://github.com/ClickHouse/ClickHouse/pull/74075) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 添加设置 `allow_push_predicate_ast_for_distributed_subqueries`。这为使用 analyzer 的分布式查询增加了基于 AST 的谓词下推功能。这是一个临时解决方案，将会使用到分布式查询支持查询计划序列化为止。关闭 [#66878](https://github.com/ClickHouse/ClickHouse/issues/66878) [#69472](https://github.com/ClickHouse/ClickHouse/issues/69472) [#65638](https://github.com/ClickHouse/ClickHouse/issues/65638) [#68030](https://github.com/ClickHouse/ClickHouse/issues/68030) [#73718](https://github.com/ClickHouse/ClickHouse/issues/73718)。[#74085](https://github.com/ClickHouse/ClickHouse/pull/74085)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 修复了在 [#73095](https://github.com/ClickHouse/ClickHouse/issues/73095) 之后，`forwarded_for` 字段中可能包含端口，从而导致无法解析带端口的主机名的问题。[#74116](https://github.com/ClickHouse/ClickHouse/pull/74116)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* 修正了 `ALTER TABLE (DROP STATISTICS ...) (DROP STATISTICS ...)` 的格式错误。 [#74126](https://github.com/ClickHouse/ClickHouse/pull/74126) ([Han Fei](https://github.com/hanfei1991)).
* 修复了问题 [#66112](https://github.com/ClickHouse/ClickHouse/issues/66112)。[#74128](https://github.com/ClickHouse/ClickHouse/pull/74128)（[Anton Ivashkin](https://github.com/ianton-ru)）。
* 现在已无法在 `CREATE TABLE` 中将 `Loop` 用作表引擎。此前这种组合会导致段错误。[#74137](https://github.com/ClickHouse/ClickHouse/pull/74137)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 修复安全问题，防止在 PostgreSQL 和 SQLite 表函数中发生 SQL 注入。 [#74144](https://github.com/ClickHouse/ClickHouse/pull/74144) ([Pablo Marcos](https://github.com/pamarcos))。
* 修复从压缩的 Memory 引擎表中读取子列时发生的崩溃问题。修复了 [#74009](https://github.com/ClickHouse/ClickHouse/issues/74009)。[#74161](https://github.com/ClickHouse/ClickHouse/pull/74161)（[Nikita Taranov](https://github.com/nickitat)）。
* 修复了在查询 system.detached&#95;tables 时出现的无限循环问题。 [#74190](https://github.com/ClickHouse/ClickHouse/pull/74190) ([Konstantin Morozov](https://github.com/k-morozov)).
* 修复在将文件标记为失败时 s3queue 中的逻辑错误。 [#74216](https://github.com/ClickHouse/ClickHouse/pull/74216) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 为某些存储添加对不支持类型的检查。[#74218](https://github.com/ClickHouse/ClickHouse/pull/74218) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复了在 macOS 上通过 PostgreSQL 接口执行 `INSERT INTO SELECT` 查询时出现的崩溃问题（问题 [#72938](https://github.com/ClickHouse/ClickHouse/issues/72938)）。[#74231](https://github.com/ClickHouse/ClickHouse/pull/74231)（[Artem Yurov](https://github.com/ArtemYurov)）。
* 修复从基础备份执行 `RESTORE` 时的本机复制设置（`allow_s3_native_copy`/`allow_azure_native_copy`）。[#74286](https://github.com/ClickHouse/ClickHouse/pull/74286)（[Azat Khuzhin](https://github.com/azat)）。
* 修复了当数据库中分离的表数量是 max&#95;block&#95;size 的倍数时出现的问题。 [#74289](https://github.com/ClickHouse/ClickHouse/pull/74289) ([Konstantin Morozov](https://github.com/k-morozov)).
* 修复当源和目标使用不同凭证时，通过 ObjectStorage（如 S3）进行复制的问题。 [#74331](https://github.com/ClickHouse/ClickHouse/pull/74331) ([Azat Khuzhin](https://github.com/azat)).
* 修复了复制数据库中未初始化的 max&#95;log&#95;ptr。[#74336](https://github.com/ClickHouse/ClickHouse/pull/74336)（[Konstantin Morozov](https://github.com/k-morozov)）。
* 修复在 GCS 上进行原生复制时，“在 JSON API 中使用 Rewrite 方法”的检测逻辑。[#74338](https://github.com/ClickHouse/ClickHouse/pull/74338)（[Azat Khuzhin](https://github.com/azat)）。
* 修复在插入 interval 时发生的崩溃（问题 [#74299](https://github.com/ClickHouse/ClickHouse/issues/74299)）。[#74478](https://github.com/ClickHouse/ClickHouse/pull/74478)（[NamNguyenHoai](https://github.com/NamHoaiNguyen)）。
* 修复在聚合投影中使用 `count(nullable)` 时的错误投影分析问题。此更改修复了 [#74495](https://github.com/ClickHouse/ClickHouse/issues/74495)。此 PR 还在投影分析相关过程中添加了一些日志，以便明确说明为何会使用某个投影或不使用某个投影。[#74498](https://github.com/ClickHouse/ClickHouse/pull/74498)（[Amos Bird](https://github.com/amosbird)）。
* 修复 `BackgroundMergesAndMutationsPoolSize` 的错误计算（此前被错误地计算为实际值的 2 倍）。[#74509](https://github.com/ClickHouse/ClickHouse/pull/74509)（[alesapin](https://github.com/alesapin)）。
* 修复在启用 Cluster Discovery 时 Keeper watches 泄漏的问题。[#74521](https://github.com/ClickHouse/ClickHouse/pull/74521) ([RinChanNOW](https://github.com/RinChanNOWWW))。
* 修复格式化常量 JSON 字面量的问题。之前在将查询发送到其他服务器时，可能会导致语法错误。[#74533](https://github.com/ClickHouse/ClickHouse/pull/74533) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复 UBSan 报告的内存对齐问题 [#74512](https://github.com/ClickHouse/ClickHouse/issues/74512)。[#74534](https://github.com/ClickHouse/ClickHouse/pull/74534)（[Arthur Passos](https://github.com/arthurpassos)）。
* 修复 KeeperMap 在创建表时的并发清理逻辑。 [#74568](https://github.com/ClickHouse/ClickHouse/pull/74568) ([Antonio Andelic](https://github.com/antonio2368)).
* 在包含 `EXCEPT` 或 `INTERSECT` 的情况下，不要删除子查询中未使用的投影列，以保证查询结果的正确性。修复 [#73930](https://github.com/ClickHouse/ClickHouse/issues/73930)。修复 [#66465](https://github.com/ClickHouse/ClickHouse/issues/66465)。[#74577](https://github.com/ClickHouse/ClickHouse/pull/74577)（[Dmitry Novik](https://github.com/novikd)）。
* 修复在启用隐式投影时使用常量分区表达式导致异常的 CREATE 查询。这修复了 [#74596](https://github.com/ClickHouse/ClickHouse/issues/74596)。[#74634](https://github.com/ClickHouse/ClickHouse/pull/74634) ([Amos Bird](https://github.com/amosbird))。
* 修复了在启用稀疏序列化时，含有 `Tuple` 列的表之间执行 `INSERT SELECT` 查询的问题。[#74698](https://github.com/ClickHouse/ClickHouse/pull/74698) ([Anton Popov](https://github.com/CurtizJ)).
* 函数 `right` 在常量负偏移量情况下行为不正确。 [#74701](https://github.com/ClickHouse/ClickHouse/pull/74701) ([Daniil Ivanik](https://github.com/divanik)).
* 修复由于在客户端解压缩过程中存在缺陷，导致插入 gzip 压缩的数据有时失败的问题。 [#74707](https://github.com/ClickHouse/ClickHouse/pull/74707) ([siyuan](https://github.com/linkwk7))。
* 避免在因异常结束的 INSERT 操作之后，使连接处于损坏状态。 [#74740](https://github.com/ClickHouse/ClickHouse/pull/74740) ([Azat Khuzhin](https://github.com/azat)).
* 避免重用遗留在中间状态的连接。[#74749](https://github.com/ClickHouse/ClickHouse/pull/74749) ([Azat Khuzhin](https://github.com/azat)).
* 在使用通配符授权时进行部分撤销，可能会撤销超出预期的权限。修复了 [#74263](https://github.com/ClickHouse/ClickHouse/issues/74263)。[#74751](https://github.com/ClickHouse/ClickHouse/pull/74751)（[pufit](https://github.com/pufit)）。
* 修复在解析 JSON 类型声明时，当类型名称不是大写时可能导致的崩溃。 [#74784](https://github.com/ClickHouse/ClickHouse/pull/74784) ([Pavel Kruglov](https://github.com/Avogar)).
* Keeper：修复从磁盘读取日志条目的问题。 [#74785](https://github.com/ClickHouse/ClickHouse/pull/74785) ([Antonio Andelic](https://github.com/antonio2368)).
* 修复了对 SYSTEM REFRESH/START/STOP VIEW 所需权限的检查逻辑，现在在对某个特定视图执行查询时，不再需要在 `*.*` 上授予该权限，只需对该视图本身授予相应权限即可。[#74789](https://github.com/ClickHouse/ClickHouse/pull/74789) ([Alexander Tokmakov](https://github.com/tavplubix)).
* `hasColumnInTable` 函数目前不会考虑别名列。修复该函数，使其同样适用于别名列。[#74841](https://github.com/ClickHouse/ClickHouse/pull/74841) ([Bharat Nallan](https://github.com/bharatnc))。
* Keeper：修复在连接建立前就被终止时产生的 logical&#95;error。 [#74844](https://github.com/ClickHouse/ClickHouse/pull/74844) ([Michael Kolupaev](https://github.com/al13n321))。
* 修复了当存在使用 `AzureBlobStorage` 的表时服务器无法启动的问题。现在可以在无需向 Azure 发送任何请求的情况下加载这些表。[#74880](https://github.com/ClickHouse/ClickHouse/pull/74880) ([Alexey Katsman](https://github.com/alexkats))。
* 修复 `query_log` 中 BACKUP 和 RESTORE 操作缺失的 `used_privileges` 和 `missing_privileges` 字段。[#74887](https://github.com/ClickHouse/ClickHouse/pull/74887)（[Alexey Katsman](https://github.com/alexkats)）。
* 修复在 Azure Blob Storage 中对包含空列的表进行数据分片合并时出现的 `FILE_DOESNT_EXIST` 错误。[#74892](https://github.com/ClickHouse/ClickHouse/pull/74892) ([Julia Kartseva](https://github.com/jkartseva))。
* 在与临时表进行 JOIN 时修复投影列名，并关闭 [#68872](https://github.com/ClickHouse/ClickHouse/issues/68872)。[#74897](https://github.com/ClickHouse/ClickHouse/pull/74897)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 如果在 HDFS select 请求期间出现 SASL 错误，则刷新 HDFS Kerberos 票据。[#74930](https://github.com/ClickHouse/ClickHouse/pull/74930) ([inv2004](https://github.com/inv2004))。
* 修复 startup&#95;scripts 中针对 Replicated 数据库的查询。[#74942](https://github.com/ClickHouse/ClickHouse/pull/74942) ([Azat Khuzhin](https://github.com/azat)).
* 修复在 `JOIN ON` 子句中使用类型别名表达式并进行 NULL 安全比较时出现的问题。[#74970](https://github.com/ClickHouse/ClickHouse/pull/74970)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 当删除操作失败时，将 part 的状态从 deleting 回退为 outdated。[#74985](https://github.com/ClickHouse/ClickHouse/pull/74985)（[Sema Checherinda](https://github.com/CheSema)）。
* 在早期版本中，当存在标量子查询时，我们会在数据格式初始化阶段开始写入进度信息（由处理该子查询累积的进度），而这个阶段发生在写入 HTTP 头部之前。这会导致 HTTP 头部丢失，例如 X-ClickHouse-QueryId、X-ClickHouse-Format 以及 Content-Type。 [#74991](https://github.com/ClickHouse/ClickHouse/pull/74991) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 修复在 `database_replicated_allow_replicated_engine_arguments=0` 时 `CREATE TABLE AS...` 查询的问题。 [#75000](https://github.com/ClickHouse/ClickHouse/pull/75000) ([Bharat Nallan](https://github.com/bharatnc)).
* 修复在 INSERT 操作发生异常后客户端连接被遗留在异常状态的问题。 [#75030](https://github.com/ClickHouse/ClickHouse/pull/75030) ([Azat Khuzhin](https://github.com/azat)).
* 修复 PSQL 复制中因未捕获异常引发的崩溃。[#75062](https://github.com/ClickHouse/ClickHouse/pull/75062) ([Azat Khuzhin](https://github.com/azat)).
* SASL 可能导致任意 RPC 调用失败，此修复可以在 krb5 ticket 过期时重试该调用。[#75063](https://github.com/ClickHouse/ClickHouse/pull/75063) ([inv2004](https://github.com/inv2004)).
* 修复了在启用 `optimize_function_to_subcolumns` 设置时，对 `Array`、`Map` 和 `Nullable(..)` 列的索引（主索引和二级索引）的使用问题。此前，这些列上的索引可能会被忽略。 [#75081](https://github.com/ClickHouse/ClickHouse/pull/75081) ([Anton Popov](https://github.com/CurtizJ)).
* 在创建包含内部表的物化视图时应禁用 `flatten_nested`，因为之后将无法使用这些被扁平化的列。[#75085](https://github.com/ClickHouse/ClickHouse/pull/75085) ([Christoph Wurm](https://github.com/cwurm))。
* 修复了在 `forwarded_for` 字段中对某些 IPv6 地址（例如 ::ffff:1.1.1.1）的错误解析问题，该问题会导致客户端连接因异常而中断。[#75133](https://github.com/ClickHouse/ClickHouse/pull/75133)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* 修复了在处理 LowCardinality 可为空数据类型时的 nullsafe JOIN 问题。此前，在 JOIN ON 中使用空值安全（null-safe）比较（例如 `IS NOT DISTINCT FROM`、`<=>`、`a IS NULL AND b IS NULL OR a == b`）与 LowCardinality 列一起使用时，无法正常工作。[#75143](https://github.com/ClickHouse/ClickHouse/pull/75143)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 使用新的分析器修复包含未使用插值的查询。[#75173](https://github.com/ClickHouse/ClickHouse/pull/75173) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
* 修复在 CTE 与 INSERT 语句配合使用时出现的崩溃问题。[#75188](https://github.com/ClickHouse/ClickHouse/pull/75188) ([Shichao Jin](https://github.com/jsc0218)).
* Keeper 修复：在回滚日志时，避免向已损坏的变更日志写入数据。 [#75197](https://github.com/ClickHouse/ClickHouse/pull/75197) ([Antonio Andelic](https://github.com/antonio2368)).
* 在合适的情况下使用 `BFloat16` 作为超类型。由此关闭：[#74404](https://github.com/ClickHouse/ClickHouse/issues/74404)。[#75236](https://github.com/ClickHouse/ClickHouse/pull/75236)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 修复在使用 any&#95;join&#95;distinct&#95;right&#95;table&#95;keys 且 JOIN ON 条件中包含 OR 时，连接结果中出现的意外默认值。[#75262](https://github.com/ClickHouse/ClickHouse/pull/75262) ([Vladimir Cherkasov](https://github.com/vdimir))。
* 对 azureblobstorage 表引擎的凭证进行脱敏处理。 [#75319](https://github.com/ClickHouse/ClickHouse/pull/75319) ([Garrett Thomas](https://github.com/garrettthomaskth)).
* 修复了在某些情况下 ClickHouse 可能错误地将过滤下推到 PostgreSQL、MySQL 或 SQLite 等外部数据库的行为。已关闭的问题：[#71423](https://github.com/ClickHouse/ClickHouse/issues/71423)。[#75320](https://github.com/ClickHouse/ClickHouse/pull/75320)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 修复了在以 Protobuf 格式输出期间并行执行查询 `SYSTEM DROP FORMAT SCHEMA CACHE` 时，可能发生在 Protobuf 模式缓存中的崩溃问题。[#75357](https://github.com/ClickHouse/ClickHouse/pull/75357)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复在使用并行副本时，将来自 `HAVING` 的过滤条件下推时可能出现的逻辑错误或未初始化的内存问题。[#75363](https://github.com/ClickHouse/ClickHouse/pull/75363)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 在 `icebergS3`、`icebergAzure` 表函数和表引擎中隐藏敏感信息。[#75378](https://github.com/ClickHouse/ClickHouse/pull/75378)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 现在，当修剪字符是通过表达式计算且结果为空字符串时，函数 `TRIM` 能够被正确处理。例如：`SELECT TRIM(LEADING concat('') FROM 'foo')`（问题 [#69922](https://github.com/ClickHouse/ClickHouse/issues/69922)）。[#75399](https://github.com/ClickHouse/ClickHouse/pull/75399)（[Manish Gill](https://github.com/mgill25)）。
* 修复 IOutputFormat 中的数据竞争问题。 [#75448](https://github.com/ClickHouse/ClickHouse/pull/75448) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在针对分布式表执行 JOIN 时，使用 Array 类型的 JSON 子列时可能出现的错误 `Elements ... and ... of Nested data structure ... (Array columns) have different array sizes`。 [#75512](https://github.com/ClickHouse/ClickHouse/pull/75512) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复无效的结果缓冲区大小计算。关闭 [#70031](https://github.com/ClickHouse/ClickHouse/issues/70031)。[#75548](https://github.com/ClickHouse/ClickHouse/pull/75548)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 修正 allow&#95;feature&#95;tier 与 compatibility mergetree 设置之间的交互行为。 [#75635](https://github.com/ClickHouse/ClickHouse/pull/75635) ([Raúl Marín](https://github.com/Algunenano)).
* 修复在文件被重试处理时，system.s3queue&#95;log 中 processed&#95;rows 值不正确的问题。[#75666](https://github.com/ClickHouse/ClickHouse/pull/75666) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 当物化视图写入 URL 引擎且出现连接问题时，遵循 `materialized_views_ignore_errors` 设置。 [#75679](https://github.com/ClickHouse/ClickHouse/pull/75679) ([Christoph Wurm](https://github.com/cwurm)).
* 修复了在不同类型列之间多次异步执行 `RENAME` 查询（`alter_sync = 0`）后，从 `MergeTree` 表读取时出现的罕见崩溃问题。 [#75693](https://github.com/ClickHouse/ClickHouse/pull/75693) ([Anton Popov](https://github.com/CurtizJ)).
* 修复某些包含 `UNION ALL` 的查询出现 `Block structure mismatch in QueryPipeline stream` 错误的问题。[#75715](https://github.com/ClickHouse/ClickHouse/pull/75715)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 在对其主键列执行 ALTER MODIFY 操作时重建 projection。此前，在对用作 projection 主键的列执行 ALTER MODIFY 后再进行查询，可能会导致 `CANNOT_READ_ALL_DATA` 错误。[#75720](https://github.com/ClickHouse/ClickHouse/pull/75720) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复在标量子查询中使用 `ARRAY JOIN` 时的错误结果（在启用 analyzer 时）。 [#75732](https://github.com/ClickHouse/ClickHouse/pull/75732) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* 修复 `DistinctSortedStreamTransform` 中的空指针解引用问题。[#75734](https://github.com/ClickHouse/ClickHouse/pull/75734)（[Nikita Taranov](https://github.com/nickitat)）。
* 修复 `allow_suspicious_ttl_expressions` 的行为。[#75771](https://github.com/ClickHouse/ClickHouse/pull/75771) ([Aleksei Filatov](https://github.com/aalexfvk))。
* 修复了函数 `translate` 中未初始化内存读取的问题。此更改关闭了 [#75592](https://github.com/ClickHouse/ClickHouse/issues/75592)。[#75794](https://github.com/ClickHouse/ClickHouse/pull/75794)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在 Native 格式中，将格式设置作为字符串格式传递到 JSON。 [#75832](https://github.com/ClickHouse/ClickHouse/pull/75832) ([Pavel Kruglov](https://github.com/Avogar))。
* 在设置变更历史中记录了在 v24.12 中默认启用并行哈希作为 JOIN 算法的变更。这意味着，如果配置了早于 v24.12 的兼容性级别，ClickHouse 将继续使用非并行哈希进行 JOIN。[#75870](https://github.com/ClickHouse/ClickHouse/pull/75870)（[Robert Schulze](https://github.com/rschu1ze)）。
* 修复了一个缺陷：具有隐式添加的 min-max 索引的表无法复制到新表中（问题 [#75677](https://github.com/ClickHouse/ClickHouse/issues/75677)）。[#75877](https://github.com/ClickHouse/ClickHouse/pull/75877)（[Smita Kulkarni](https://github.com/SmitaRKulkarni)）。
* `clickhouse-library-bridge` 允许从文件系统中打开任意库，因此出于安全考虑，应仅在隔离环境中运行。为防止在其与 clickhouse-server 运行在同一环境时出现漏洞，我们将把库路径限制在配置中指定的位置。该漏洞由 **Arseniy Dugin** 通过 [ClickHouse Bug Bounty Program](https://github.com/ClickHouse/ClickHouse/issues/38986) 发现。[#75954](https://github.com/ClickHouse/ClickHouse/pull/75954)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 我们当时使用了 JSON 序列化来处理某些元数据，事实证明这是一个错误的选择，因为 JSON 不支持在字符串字面量中包含二进制数据（包括零字节）。SQL 查询可以包含二进制数据和无效的 UTF-8，因此我们也必须在元数据文件中支持这一点。与此同时，ClickHouse 的 `JSONEachRow` 和类似格式通过偏离 JSON 标准来规避这一问题，以换取对二进制数据的完美往返（roundtrip）支持。动机说明参见：[https://github.com/ClickHouse/ClickHouse/pull/73668#issuecomment-2560501790](https://github.com/ClickHouse/ClickHouse/pull/73668#issuecomment-2560501790)。解决方案是让 `Poco::JSON` 库与 ClickHouse 中的 JSON 格式序列化保持一致。此更改关闭了 [#73668](https://github.com/ClickHouse/ClickHouse/issues/73668)。[#75963](https://github.com/ClickHouse/ClickHouse/pull/75963)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在执行 DETACH PART 时，修复出现 `Part <...> does not contain in snapshot of previous virtual parts. (PART_IS_TEMPORARILY_LOCKED)` 错误的问题。 [#76039](https://github.com/ClickHouse/ClickHouse/pull/76039) ([Aleksei Filatov](https://github.com/aalexfvk)).
* 修复对存储引擎 `S3Queue` 中提交限制的检查。[#76104](https://github.com/ClickHouse/ClickHouse/pull/76104) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复在附加带有自动索引（`add_minmax_index_for_numeric_columns`/`add_minmax_index_for_string_columns`）的 MergeTree 表时出现的问题。[#76139](https://github.com/ClickHouse/ClickHouse/pull/76139) ([Azat Khuzhin](https://github.com/azat)).
* 修复了作业父线程的堆栈跟踪（`enable_job_stack_trace` 设置）未被打印的问题。修复了 `enable_job_stack_trace` 设置未正确传播到线程的问题，该问题导致生成的堆栈跟踪内容并不总是符合该设置。[#76191](https://github.com/ClickHouse/ClickHouse/pull/76191) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 修复在大端架构上使用 reinterpretAs 处理 FixedString 时的问题。 [#76253](https://github.com/ClickHouse/ClickHouse/pull/76253) ([Azat Khuzhin](https://github.com/azat)).
* 修复了由于 UUID 与表名之间的竞态条件导致的各种错误（例如，这解决了 `RENAME` 与 `RESTART REPLICA` 之间的竞态。在并发执行 `RENAME` 和 `SYSTEM RESTART REPLICA` 的情况下，您可能最终会重启错误的副本，和/或使其中一张表处于 `Table X is being restarted` 状态）。 [#76308](https://github.com/ClickHouse/ClickHouse/pull/76308) ([Azat Khuzhin](https://github.com/azat)).
* 从信号处理程序中删除了内存分配。 [#76446](https://github.com/ClickHouse/ClickHouse/pull/76446) ([Nikita Taranov](https://github.com/nickitat)).
* 修复动态文件系统缓存在淘汰过程中调整大小时处理意外错误的问题。[#76466](https://github.com/ClickHouse/ClickHouse/pull/76466) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复了并行哈希表中 `used_flag` 的初始化问题，该问题可能导致服务器崩溃。[#76580](https://github.com/ClickHouse/ClickHouse/pull/76580) ([Nikita Taranov](https://github.com/nickitat))。
* 修复在投影中调用 `defaultProfiles()` 函数时的逻辑错误。[#76627](https://github.com/ClickHouse/ClickHouse/pull/76627) ([pufit](https://github.com/pufit))。
* 在 Web UI 中不再通过浏览器请求交互式 Basic 认证。修复了 [#76319](https://github.com/ClickHouse/ClickHouse/issues/76319)。[#76637](https://github.com/ClickHouse/ClickHouse/pull/76637)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复从分布式表查询布尔字面量时出现的 THERE&#95;IS&#95;NO&#95;COLUMN 异常。[#76656](https://github.com/ClickHouse/ClickHouse/pull/76656) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 现在以更合理的方式选择表目录中的子路径。[#76681](https://github.com/ClickHouse/ClickHouse/pull/76681)（[Daniil Ivanik](https://github.com/divanik)）。
* 修复在修改主键中包含子列的表后出现的错误 `Not found column in block`。在 [https://github.com/ClickHouse/ClickHouse/pull/72644](https://github.com/ClickHouse/ClickHouse/pull/72644) 之后，还需要 [https://github.com/ClickHouse/ClickHouse/pull/74403](https://github.com/ClickHouse/ClickHouse/pull/74403)。[#76686](https://github.com/ClickHouse/ClickHouse/pull/76686)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 为 NULL 短路添加性能测试并修复缺陷。 [#76708](https://github.com/ClickHouse/ClickHouse/pull/76708) ([李扬](https://github.com/taiyang-li)).
* 在对输出写缓冲区进行最终处理之前先刷新它们。修复在某些输出格式最终处理期间产生的 `LOGICAL_ERROR`，例如 `JSONEachRowWithProgressRowOutputFormat`。 [#76726](https://github.com/ClickHouse/ClickHouse/pull/76726) ([Antonio Andelic](https://github.com/antonio2368))。
* 添加了对 MongoDB 二进制 UUID 的支持（[#74452](https://github.com/ClickHouse/ClickHouse/issues/74452)） - 修复了在使用表函数时对 MongoDB 的 WHERE 下推（[#72210](https://github.com/ClickHouse/ClickHouse/issues/72210)） - 修改了 MongoDB 与 ClickHouse 之间的类型映射，使得 MongoDB 的二进制 UUID 只能解析为 ClickHouse 的 UUID。这样可以避免今后出现歧义和意外行为。- 修复了 OID 映射，同时保留向后兼容性。[#76762](https://github.com/ClickHouse/ClickHouse/pull/76762)（[Kirill Nikiforov](https://github.com/allmazz)）。
* 修复在并行前缀反序列化 JSON 子列过程中的异常处理。[#76809](https://github.com/ClickHouse/ClickHouse/pull/76809) ([Pavel Kruglov](https://github.com/Avogar))。
* 修正 lgamma 函数在负整数上的行为。[#76840](https://github.com/ClickHouse/ClickHouse/pull/76840) ([Ilya Kataev](https://github.com/IlyaKataev)).
* 修复对显式定义主键的反向键分析问题。类似于 [#76654](https://github.com/ClickHouse/ClickHouse/issues/76654)。[#76846](https://github.com/ClickHouse/ClickHouse/pull/76846)（[Amos Bird](https://github.com/amosbird)）。
* 修复 JSON 格式中布尔值的美化输出。[#76905](https://github.com/ClickHouse/ClickHouse/pull/76905) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在异步插入过程中出错时，由于不正确的 JSON 列回滚导致的可能崩溃问题。 [#76908](https://github.com/ClickHouse/ClickHouse/pull/76908) ([Pavel Kruglov](https://github.com/Avogar)).
* 此前，`multi_if` 在计划阶段和主执行阶段可能返回不同类型的列。这会导致生成在 C++ 层面存在未定义行为的代码。[#76914](https://github.com/ClickHouse/ClickHouse/pull/76914)（[Nikita Taranov](https://github.com/nickitat)）。
* 修复了 MergeTree 中可为空的常量键的错误序列化问题。此修复解决了 [#76939](https://github.com/ClickHouse/ClickHouse/issues/76939)。[#76985](https://github.com/ClickHouse/ClickHouse/pull/76985)（[Amos Bird](https://github.com/amosbird)）。
* 修复 `BFloat16` 值的排序。已关闭 [#75487](https://github.com/ClickHouse/ClickHouse/issues/75487)。已关闭 [#75669](https://github.com/ClickHouse/ClickHouse/issues/75669)。[#77000](https://github.com/ClickHouse/ClickHouse/pull/77000)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 通过在 part 一致性检查中添加跳过临时子列的检查，修复了带有 Variant 子列的 JSON 的 bug。 [#72187](https://github.com/ClickHouse/ClickHouse/issues/72187)。 [#77034](https://github.com/ClickHouse/ClickHouse/pull/77034) ([Smita Kulkarni](https://github.com/SmitaRKulkarni))。
* 修复在 `Values` 格式中解析模板时由于类型不匹配而导致的崩溃问题。 [#77071](https://github.com/ClickHouse/ClickHouse/pull/77071) ([Pavel Kruglov](https://github.com/Avogar))。
* 不再允许创建在主键中包含子列的 EmbeddedRocksDB 表。此前虽然可以创建这样的表，但 `SELECT` 查询会失败。[#77074](https://github.com/ClickHouse/ClickHouse/pull/77074) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复分布式查询中的非法比较问题，因为在将谓词下推到远程节点时未正确处理字面量的类型。[#77093](https://github.com/ClickHouse/ClickHouse/pull/77093)（[Duc Canh Le](https://github.com/canhld94)）。
* 修复在创建 Kafka 表时因异常导致的崩溃。[#77121](https://github.com/ClickHouse/ClickHouse/pull/77121)（[Pavel Kruglov](https://github.com/Avogar)）。
* 在 Kafka 和 RabbitMQ 引擎中新增对 JSON 及其子列的支持。 [#77122](https://github.com/ClickHouse/ClickHouse/pull/77122) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复在 macOS 上异常栈展开的问题。 [#77126](https://github.com/ClickHouse/ClickHouse/pull/77126) ([Eduard Karacharov](https://github.com/korowa)).
* 修复 getSubcolumn 函数中读取 &#39;null&#39; 子列的问题。[#77163](https://github.com/ClickHouse/ClickHouse/pull/77163) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在 analyzer 中使用包含字面量的表达式时 skip 索引不生效的问题，并在索引分析阶段移除多余的类型转换。 [#77229](https://github.com/ClickHouse/ClickHouse/pull/77229) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复涉及 Array 和不受支持函数的布隆过滤器索引问题。 [#77271](https://github.com/ClickHouse/ClickHouse/pull/77271) ([Pavel Kruglov](https://github.com/Avogar)).
* 我们只应在最初的 CREATE 查询期间检查对表数量的限制。[#77274](https://github.com/ClickHouse/ClickHouse/pull/77274) ([Nikolay Degterinsky](https://github.com/evillique))。
* `SELECT toBFloat16(-0.0) == toBFloat16(0.0)` 现在会正确返回 `true`（此前为 `false`）。这使得其行为与 `Float32` 和 `Float64` 保持一致。[#77290](https://github.com/ClickHouse/ClickHouse/pull/77290) ([Shankar Iyer](https://github.com/shankar-iyer))。
* 修复了对未初始化的 `key_index` 变量可能不正确的引用，该问题可能会在调试构建中导致崩溃（在发布构建中，由于后续代码很可能会抛出错误，因此这个未初始化引用通常不会造成问题）。### 面向用户可见变更的文档条目。[#77305](https://github.com/ClickHouse/ClickHouse/pull/77305) ([wxybear](https://github.com/wxybear))。
* 已回滚。 [#77307](https://github.com/ClickHouse/ClickHouse/pull/77307) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* 修复了具有 Bool 值的分区名称问题。该问题是在 [https://github.com/ClickHouse/ClickHouse/pull/74533](https://github.com/ClickHouse/ClickHouse/pull/74533) 中引入的。[#77319](https://github.com/ClickHouse/ClickHouse/pull/77319)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复在包含可为空元素的 Tuple 与字符串之间进行比较时出现的问题。举例来说，在此更改之前，Tuple `(1, null)` 与 String `'(1,null)'` 之间的比较会导致错误。另一个例子是比较 Tuple `(1, a)` 与 String `'(1, 2)'`，其中 `a` 是一个 Nullable 列。此更改解决了这些问题。[#77323](https://github.com/ClickHouse/ClickHouse/pull/77323)（[Alexey Katsman](https://github.com/alexkats)）。
* 修复了 ObjectStorageQueueSource 中的崩溃问题。该问题是在 [https://github.com/ClickHouse/ClickHouse/pull/76358](https://github.com/ClickHouse/ClickHouse/pull/76358) 中引入的。[#77325](https://github.com/ClickHouse/ClickHouse/pull/77325)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复了一个错误：`close_session` 查询参数不起作用，导致命名会话只能在 `session_timeout` 之后才会被关闭。 [#77336](https://github.com/ClickHouse/ClickHouse/pull/77336) ([Alexey Katsman](https://github.com/alexkats)).
* 修复在使用 `input()` 时的 `async_insert` 问题。[#77340](https://github.com/ClickHouse/ClickHouse/pull/77340) ([Azat Khuzhin](https://github.com/azat))。
* 修复：当查询计划器移除排序列时，`WITH FILL` 可能因 `NOT_FOUND_COLUMN_IN_BLOCK` 而失败；同时修复了与为 `INTERPOLATE` 表达式计算的 DAG 不一致相关的类似问题。[#77343](https://github.com/ClickHouse/ClickHouse/pull/77343) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 已回滚。 [#77390](https://github.com/ClickHouse/ClickHouse/pull/77390) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 修复了在未附加物化视图（MV）的情况下从 NATS 服务器接收消息的问题。[#77392](https://github.com/ClickHouse/ClickHouse/pull/77392) ([Dmitry Novikov](https://github.com/dmitry-sles-novikov)).
* 修复通过 `merge` 表函数从空的 `FileLog` 读取时的逻辑错误，并关闭 [#75575](https://github.com/ClickHouse/ClickHouse/issues/75575)。[#77441](https://github.com/ClickHouse/ClickHouse/pull/77441)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 修复了多处在为无效 AST 节点设置别名时触发的 `LOGICAL_ERROR`。 [#77445](https://github.com/ClickHouse/ClickHouse/pull/77445) ([Raúl Marín](https://github.com/Algunenano)).
* 在文件系统缓存实现中修复了文件段写入过程中的错误处理问题。 [#77471](https://github.com/ClickHouse/ClickHouse/pull/77471) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 使 DatabaseIceberg 使用 catalog 提供的正确元数据文件。关闭了 [#75187](https://github.com/ClickHouse/ClickHouse/issues/75187)。[#77486](https://github.com/ClickHouse/ClickHouse/pull/77486)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 在 shared variant 的动态序列化中使用默认格式设置。 [#77572](https://github.com/ClickHouse/ClickHouse/pull/77572) ([Pavel Kruglov](https://github.com/Avogar)).
* 回退 &#39;在执行标量子查询时避免使用 toAST()&#39;. [#77584](https://github.com/ClickHouse/ClickHouse/pull/77584) ([Raúl Marín](https://github.com/Algunenano)).
* 修复在本地磁盘上检查表数据路径是否存在的逻辑。[#77608](https://github.com/ClickHouse/ClickHouse/pull/77608) ([Tuan Pham Anh](https://github.com/tuanpach))。
* 查询缓存现在默认将 UDF 视为非确定性函数。因此，包含 UDF 的查询结果将不再被缓存。此前，用户可以定义非确定性的 UDF，而其结果会被错误缓存（问题 [#77553](https://github.com/ClickHouse/ClickHouse/issues/77553)）。[#77633](https://github.com/ClickHouse/ClickHouse/pull/77633)（[Jimmy Aguilar Mena](https://github.com/Ergus)）。
* 修复了在向远程发送常量值时对某些类型的处理问题。[#77634](https://github.com/ClickHouse/ClickHouse/pull/77634) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复 `system.filesystem_cache_log` 仅在启用设置 `enable_filesystem_cache_log` 时才生效的问题。[#77650](https://github.com/ClickHouse/ClickHouse/pull/77650) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复在投影中调用 `defaultRoles()` 函数时的逻辑错误。作为对 [#76627](https://github.com/ClickHouse/ClickHouse/issues/76627) 的后续跟进。[#77667](https://github.com/ClickHouse/ClickHouse/pull/77667)（[pufit](https://github.com/pufit)）。
* 修复由于 StorageS3(Azure)Queue 中上下文过期导致的崩溃。[#77720](https://github.com/ClickHouse/ClickHouse/pull/77720)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 现在不再允许在函数 `arrayResize` 中使用类型为 `Nullable` 的第二个参数。此前，当第二个参数为 `Nullable` 时，可能会出现从报错到返回错误结果等各种问题。（问题 [#48398](https://github.com/ClickHouse/ClickHouse/issues/48398)）。[#77724](https://github.com/ClickHouse/ClickHouse/pull/77724)（[Manish Gill](https://github.com/mgill25)）。
* 在 RabbitMQ、NATS、Redis、AzureQueue 表引擎中隐藏凭据。[#77755](https://github.com/ClickHouse/ClickHouse/pull/77755) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复 ArgMin/ArgMax 中在比较 NaN 时的未定义行为。 [#77756](https://github.com/ClickHouse/ClickHouse/pull/77756) ([Raúl Marín](https://github.com/Algunenano)).
* 即使在操作不会产生任何要写入的数据块的情况下，也要定期检查合并（merge）和变更（mutation）是否已被取消。[#77766](https://github.com/ClickHouse/ClickHouse/pull/77766) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
* 已回滚。[#77843](https://github.com/ClickHouse/ClickHouse/pull/77843)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 修复在出现 `NOT_FOUND_COLUMN_IN_BLOCK` 错误时可能发生的崩溃。[#77854](https://github.com/ClickHouse/ClickHouse/pull/77854) ([Vladimir Cherkasov](https://github.com/vdimir))。
* 修复在填充数据时发生在 `StorageSystemObjectStorageQueueSettings` 中的崩溃。[#77878](https://github.com/ClickHouse/ClickHouse/pull/77878)（[Bharat Nallan](https://github.com/bharatnc)）。
* 在 SSH 服务器中禁用对历史记录的模糊搜索功能（因为这需要 skim）。 [#78002](https://github.com/ClickHouse/ClickHouse/pull/78002) ([Azat Khuzhin](https://github.com/azat)).
* 修复了这样一个问题：当在未建立索引的列上执行向量搜索查询时，如果表中存在另一列已定义向量相似度索引的向量列，则会返回不正确的结果。（Issue [#77978](https://github.com/ClickHouse/ClickHouse/issues/77978)）。[#78069](https://github.com/ClickHouse/ClickHouse/pull/78069)（[Shankar Iyer](https://github.com/shankar-iyer)）。
* 修复 `The requested output format {} is binary... Do you want to output it anyway? [y/N]` 提示信息。 [#78095](https://github.com/ClickHouse/ClickHouse/pull/78095) ([Azat Khuzhin](https://github.com/azat)).
* 修复了在 `toStartOfInterval` 使用 origin 参数为零时的一个缺陷。[#78096](https://github.com/ClickHouse/ClickHouse/pull/78096) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 禁止在 HTTP 接口中指定空值的 `session_id` 查询参数。 [#78098](https://github.com/ClickHouse/ClickHouse/pull/78098) ([Alexey Katsman](https://github.com/alexkats)).
* 修复 Database Replicated 中的元数据被错误覆盖的问题，该问题可能发生在紧接着执行 `ALTER` 查询后立即执行 `RENAME` 查询的情况下。 [#78107](https://github.com/ClickHouse/ClickHouse/pull/78107) ([Nikolay Degterinsky](https://github.com/evillique)).
* 修复 NATS 引擎中的崩溃。[#78108](https://github.com/ClickHouse/ClickHouse/pull/78108) ([Dmitry Novikov](https://github.com/dmitry-sles-novikov)).
* 不要尝试在嵌入式 SSH 客户端中创建 `history_file`。[#78112](https://github.com/ClickHouse/ClickHouse/pull/78112) ([Azat Khuzhin](https://github.com/azat)).
* 修复在执行 RENAME DATABASE 或 DROP TABLE 查询后，`system.detached_tables` 显示不正确信息的问题。[#78126](https://github.com/ClickHouse/ClickHouse/pull/78126) ([Nikolay Degterinsky](https://github.com/evillique))。
* 修复在 [https://github.com/ClickHouse/ClickHouse/pull/77274](https://github.com/ClickHouse/ClickHouse/pull/77274) 之后，对 Database Replicated 数据库中过多表数量的检查。同时，将该检查提前到创建存储之前执行，以避免在 RMT 或 KeeperMap 的情况下在 ZooKeeper 中创建未被计数的节点。[#78127](https://github.com/ClickHouse/ClickHouse/pull/78127)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 修复由于并发初始化 S3Queue 元数据而可能导致的潜在崩溃问题。[#78131](https://github.com/ClickHouse/ClickHouse/pull/78131) ([Azat Khuzhin](https://github.com/azat))。
* `groupArray*` 函数现在在 `max_size` 参数为 Int 类型且值为 0 时，会像对 UInt 类型参数一样返回 BAD&#95;ARGUMENTS 错误，而不是尝试继续执行。[#78140](https://github.com/ClickHouse/ClickHouse/pull/78140)（[Eduard Karacharov](https://github.com/korowa)）。
* 避免在本地表在分离前被删除时 `recoverLostReplica` 发生崩溃。[#78173](https://github.com/ClickHouse/ClickHouse/pull/78173) ([Raúl Marín](https://github.com/Algunenano))。
* 修复 system.s3&#95;queue&#95;settings 中 “alterable” 列始终返回 `false` 的问题。 [#78187](https://github.com/ClickHouse/ClickHouse/pull/78187) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 对 Azure 访问签名进行掩码处理，使其对用户不可见，也不会出现在日志中。 [#78189](https://github.com/ClickHouse/ClickHouse/pull/78189) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复 Wide 部分中带前缀的子流预取。 [#78205](https://github.com/ClickHouse/ClickHouse/pull/78205) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复了在键数组为 `LowCardinality(Nullable)` 类型时，`mapFromArrays` 发生崩溃或返回错误结果的问题。 [#78240](https://github.com/ClickHouse/ClickHouse/pull/78240) ([Eduard Karacharov](https://github.com/korowa)).
* 修复 delta-kernel 身份验证选项。[#78255](https://github.com/ClickHouse/ClickHouse/pull/78255) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 当副本的 `disable_insertion_and_mutation` 为 true 时，不再调度 RefreshMV 任务。该任务本质上是一次插入操作，如果 `disable_insertion_and_mutation` 为 true，则会失败。[#78277](https://github.com/ClickHouse/ClickHouse/pull/78277) ([Xu Jia](https://github.com/XuJia0210)).
* 验证对 Merge 引擎底层表的访问权限。[#78339](https://github.com/ClickHouse/ClickHouse/pull/78339) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。
* `Distributed` 引擎表可能会丢失 FINAL 修饰符。[#78428](https://github.com/ClickHouse/ClickHouse/pull/78428) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 当位图为空时，`Bitmapmin` 返回 `uint32_max`（当输入类型 &gt;= 8bits 时返回 `uint64_max`），这与空 `roaring_bitmap` 的 `minimum()` 行为一致。[#78444](https://github.com/ClickHouse/ClickHouse/pull/78444) ([wxybear](https://github.com/wxybear))。
* 回退 &quot;Apply preserve&#95;most attribute at some places in code&quot; 更改，因为它可能导致崩溃。 [#78449](https://github.com/ClickHouse/ClickHouse/pull/78449) ([Azat Khuzhin](https://github.com/azat)).
* 在 INFILE 的模式推断中使用插入列。 [#78490](https://github.com/ClickHouse/ClickHouse/pull/78490) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* 在启用 `distributed_aggregation_memory_efficient` 时，禁用在读取 `FROM` 之后立即并行化查询处理，以免导致逻辑错误。修复了 [#76934](https://github.com/ClickHouse/ClickHouse/issues/76934)。[#78500](https://github.com/ClickHouse/ClickHouse/pull/78500)（[flynn](https://github.com/ucasfl)）。
* 在应用 `max_streams_to_max_threads_ratio` 设置后，如果计划的流数为 0，则确保至少有一个用于读取的流。[#78505](https://github.com/ClickHouse/ClickHouse/pull/78505) ([Eduard Karacharov](https://github.com/korowa)).
* 在 S3Queue 存储中修复逻辑错误 “Cannot unregister: table uuid is not registered”。关闭了 [#78285](https://github.com/ClickHouse/ClickHouse/issues/78285)。[#78541](https://github.com/ClickHouse/ClickHouse/pull/78541)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 现在，在同时启用了 cgroup v1 和 v2 的系统上，ClickHouse 能够正确识别其 cgroup v2。[#78566](https://github.com/ClickHouse/ClickHouse/pull/78566)（[Grigory Korolev](https://github.com/gkorolev)）。
* 在与表级设置配合使用时，ObjectStorage 集群表函数会失败。[#78587](https://github.com/ClickHouse/ClickHouse/pull/78587) ([Daniil Ivanik](https://github.com/divanik))。
* ReplicatedMergeTree 尚不支持在 `INSERT` 时对事务进行更完善的检查。 [#78633](https://github.com/ClickHouse/ClickHouse/pull/78633) ([Azat Khuzhin](https://github.com/azat)).
* 在 ATTACH 操作期间应用查询设置。 [#78637](https://github.com/ClickHouse/ClickHouse/pull/78637) ([Raúl Marín](https://github.com/Algunenano)).
* 修复在 `iceberg_metadata_file_path` 中指定无效路径时发生的崩溃问题。[#78688](https://github.com/ClickHouse/ClickHouse/pull/78688)（[alesapin](https://github.com/alesapin)）。
* 在 DeltaLake 表引擎的 delta-kernel 实现中，修复了这样一种情况：当读取的 schema 与表的 schema 不一致且存在分区列时，会导致“找不到列”错误。 [#78690](https://github.com/ClickHouse/ClickHouse/pull/78690) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 此更新修复了一个 Bug：当两个会话具有相同名称且在旧会话超时之前创建了新的命名会话时，新会话会在旧会话预定的超时时刻被意外关闭。 [#78698](https://github.com/ClickHouse/ClickHouse/pull/78698) ([Alexey Katsman](https://github.com/alexkats))。
* 在运行 CHECK TABLE 时不再阻塞表的关闭。 [#78782](https://github.com/ClickHouse/ClickHouse/pull/78782) ([Raúl Marín](https://github.com/Algunenano)).
* Keeper 修复：在所有情况下修正 ephemeral 节点计数。[#78799](https://github.com/ClickHouse/ClickHouse/pull/78799) ([Antonio Andelic](https://github.com/antonio2368)).
* 修复在使用非 `view()` 的其他表函数时，`StorageDistributed` 中的不正确类型转换问题。关闭 [#78464](https://github.com/ClickHouse/ClickHouse/issues/78464)。[#78828](https://github.com/ClickHouse/ClickHouse/pull/78828)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 修复 `tupleElement(*, 1)` 的格式问题。关闭 [#78639](https://github.com/ClickHouse/ClickHouse/issues/78639)。[#78832](https://github.com/ClickHouse/ClickHouse/pull/78832)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 类型为 `ssd_cache` 的字典现在会拒绝 `block_size` 和 `write_buffer_size` 为零或负数的参数（问题 [#78314](https://github.com/ClickHouse/ClickHouse/issues/78314)）。[#78854](https://github.com/ClickHouse/ClickHouse/pull/78854)（[Elmi Ahmadov](https://github.com/ahmadov)）。
* 修复在异常关闭后执行 ALTER 时导致 REFRESHABLE MV 崩溃的问题。 [#78858](https://github.com/ClickHouse/ClickHouse/pull/78858) ([Azat Khuzhin](https://github.com/azat)).
* 修复在 CSV 格式中解析无效 DateTime 值的问题。[#78919](https://github.com/ClickHouse/ClickHouse/pull/78919) ([Pavel Kruglov](https://github.com/Avogar))。

## 构建/测试/打包改进 {#build-testing-packaging-improvement}

* 内部依赖项 LLVM 已从 16 升级到 18。 [#66053](https://github.com/ClickHouse/ClickHouse/pull/66053) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
* 恢复已删除的 nats 集成测试并修复问题。- 修复了 nats 引擎中的一些竞争条件 - 修复了在向 nats 进行数据流式传输时，连接丢失情况下出现的数据丢失问题 - 修复了从 nats 流式传输结束时接收最后一块数据时出现卡死的问题 - `nats_max_reconnect` 已被弃用且不再生效，现在会基于 `nats_reconnect_wait` 超时时间持续尝试重连。 [#69772](https://github.com/ClickHouse/ClickHouse/pull/69772) ([Dmitry Novikov](https://github.com/dmitry-sles-novikov)).
* 修复 contrib OpenSSL 的 asm 文件无法生成的问题。 [#72622](https://github.com/ClickHouse/ClickHouse/pull/72622) ([RinChanNOW](https://github.com/RinChanNOWWW)).
* 修复测试 03210&#95;variant&#95;with&#95;aggregate&#95;function&#95;type 的稳定性问题。 [#74012](https://github.com/ClickHouse/ClickHouse/pull/74012) ([Anton Ivashkin](https://github.com/ianton-ru)).
* 支持在 ARM 和 Intel 架构的 Mac 上构建 HDFS。 [#74244](https://github.com/ClickHouse/ClickHouse/pull/74244) ([Yan Xin](https://github.com/yxheartipp)).
* 通用安装脚本现在即使在 macOS 上也会建议进行安装。[#74339](https://github.com/ClickHouse/ClickHouse/pull/74339) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 修复在未启用 Kerberos 时的构建问题。[#74771](https://github.com/ClickHouse/ClickHouse/pull/74771) ([flynn](https://github.com/ucasfl)).
* 将内置的 LLVM 更新至 19。 [#75148](https://github.com/ClickHouse/ClickHouse/pull/75148) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* *可能引入不兼容变更*：进行了改进，以设置更为严格的默认配置。当前默认配置已经是安全的，用户必须显式指定选项才能暴露端口。但当 `default` 用户没有通过 `CLICKHOUSE_PASSWORD` 设置密码和/或没有通过 `CLICKHOUSE_USER` 环境变量更改用户名时，该用户应只能从本地系统访问，作为额外一层防护。[#75259](https://github.com/ClickHouse/ClickHouse/pull/75259)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* 集成测试对单个并行测试批次设置了 1 小时的超时时间。当达到该超时时间时，`pytest` 会被终止，可能导致部分日志丢失。内部的 pytest 超时时间被设置为 55 分钟，以便在会话结束时打印结果，并且不触发外部超时信号。关闭了 [#75532](https://github.com/ClickHouse/ClickHouse/issues/75532)。[#75533](https://github.com/ClickHouse/ClickHouse/pull/75533)（[Ilya Yatsishin](https://github.com/qoega)）。
* 将所有与 clickhouse-server 相关的操作封装为一个函数，并且仅在 `entrypoint.sh` 中启动默认二进制文件时执行这些操作。在 [#50724](https://github.com/ClickHouse/ClickHouse/issues/50724) 中提出了这一拖延已久的改进。为 `clickhouse-extract-from-config` 新增了选项 `--users`，用于从 `users.xml` 中获取值。[#75643](https://github.com/ClickHouse/ClickHouse/pull/75643)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* 对于压力测试，如果在我们通过 gdb 收集堆栈跟踪期间服务器没有退出，将会增加额外的等待时间，以减少 `Possible deadlock on shutdown (see gdb.log)` 检测的“噪声”。这只会在测试未成功完成的情况下引入额外延迟。 [#75668](https://github.com/ClickHouse/ClickHouse/pull/75668) ([Ilya Yatsishin](https://github.com/qoega)).
* 恢复已删除的 nats 集成测试并修复错误。 - 修复了 nats 引擎中的一些竞争条件 - 修复了在连接中断情况下向 nats 流式传输数据时的数据丢失问题 - 修复了从 nats 流式传输结束时接收最后一个数据块时出现卡住的问题 - `nats_max_reconnect` 已弃用且不再生效，将会持续尝试重连，并使用 `nats_reconnect_wait` 作为重连等待超时时间。 [#75850](https://github.com/ClickHouse/ClickHouse/pull/75850) ([Dmitry Novikov](https://github.com/dmitry-sles-novikov)).
* 在针对 Darwin 的交叉编译中启用 ICU 和 gRPC。[#75922](https://github.com/ClickHouse/ClickHouse/pull/75922) ([Raúl Marín](https://github.com/Algunenano)).
* 修复由于在终止进程组的过程中调用 `sleep` 而导致拆分测试的输出问题。[#76090](https://github.com/ClickHouse/ClickHouse/pull/76090) ([Mikhail f. Shiryaev](https://github.com/Felixoid)).
* 不要在运行结束时收集 `docker-compose` 日志，因为脚本经常会被终止。相反，请在后台收集这些日志。 [#76140](https://github.com/ClickHouse/ClickHouse/pull/76140) ([Mikhail f. Shiryaev](https://github.com/Felixoid)).
* 将 Kafka 存储相关测试拆分到多个文件中。修复 [#69452](https://github.com/ClickHouse/ClickHouse/issues/69452)。[#76208](https://github.com/ClickHouse/ClickHouse/pull/76208)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* `clickhouse-odbc-bridge` 和 `clickhouse-library-bridge` 已移至单独的代码仓库：[https://github.com/ClickHouse/odbc-bridge/](https://github.com/ClickHouse/odbc-bridge/)。[#76225](https://github.com/ClickHouse/ClickHouse/pull/76225)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 从二进制文件中删除约 20MB 的死代码。[#76226](https://github.com/ClickHouse/ClickHouse/pull/76226) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 由于引入 `block()`，将 CMake 的最低要求版本提高到 3.25。 [#76316](https://github.com/ClickHouse/ClickHouse/pull/76316) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* 将 fmt 更新为 11.1.3。[#76547](https://github.com/ClickHouse/ClickHouse/pull/76547) ([Raúl Marín](https://github.com/Algunenano)).
* 将 `lz4` 升级到 `1.10.0`。 [#76571](https://github.com/ClickHouse/ClickHouse/pull/76571) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 将 `curl` 升级到 `8.12.1`。[#76572](https://github.com/ClickHouse/ClickHouse/pull/76572) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 将 `libcpuid` 升级到 `0.7.1`。 [#76573](https://github.com/ClickHouse/ClickHouse/pull/76573) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* 使用机器可读格式解析 pytest 结果。[#76910](https://github.com/ClickHouse/ClickHouse/pull/76910) ([Mikhail f. Shiryaev](https://github.com/Felixoid))。
* 修复 Rust 交叉编译问题，并允许完全禁用 Rust。 [#76921](https://github.com/ClickHouse/ClickHouse/pull/76921) ([Raúl Marín](https://github.com/Algunenano)).
* 需要 clang 19 才能构建该项目。 [#76945](https://github.com/ClickHouse/ClickHouse/pull/76945) ([Raúl Marín](https://github.com/Algunenano)).
* 该测试在串行模式下执行，持续超过 10 秒，对于快速测试来说耗时过长。[#76948](https://github.com/ClickHouse/ClickHouse/pull/76948)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* 将 `sccache` 更新到 `0.10.0`。 [#77580](https://github.com/ClickHouse/ClickHouse/pull/77580) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 在 Rust 中遵从 CPU 目标特性配置，并在所有 crate 中启用 LTO。 [#78590](https://github.com/ClickHouse/ClickHouse/pull/78590) ([Raúl Marín](https://github.com/Algunenano)).
* 将 `minizip-ng` 升级到 `4.0.9` 版本。 [#78917](https://github.com/ClickHouse/ClickHouse/pull/78917) ([Konstantin Bogdanov](https://github.com/thevar1able)).