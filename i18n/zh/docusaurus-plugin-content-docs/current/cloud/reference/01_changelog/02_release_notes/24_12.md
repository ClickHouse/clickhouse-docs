---
slug: /changelogs/24.12
title: 'v24.12 Cloud 更新日志'
description: 'v24.12 快速发布更新日志'
keywords: ['changelog', 'cloud']
sidebar_label: '24.12'
sidebar_position: 4
doc_type: 'changelog'
---

基于 v24.12 版本的 ClickHouse Cloud 服务相关更新。



## 向后不兼容的变更 {#backward-incompatible-changes}

- 函数 `greatest` 和 `least` 现在会忽略 NULL 输入值,而之前如果其中一个参数为 NULL 则会返回 NULL。例如,`SELECT greatest(1, 2, NULL)` 现在返回 2。这使得行为与 PostgreSQL 兼容。[#65519](https://github.com/ClickHouse/ClickHouse/pull/65519) ([kevinyhzou](https://github.com/KevinyhZou))。
- 默认情况下不允许在 ORDER BY/GROUP BY/PARTITION BY/PRIMARY KEY 中使用 Variant/Dynamic 类型,因为这可能导致意外结果。[#69731](https://github.com/ClickHouse/ClickHouse/pull/69731) ([Pavel Kruglov](https://github.com/Avogar))。
- 移除系统表 `generate_series` 和 `generateSeries`。它们是在此处被错误添加的:[#59390](https://github.com/ClickHouse/ClickHouse/issues/59390)。[#71091](https://github.com/ClickHouse/ClickHouse/pull/71091) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 移除 `StorageExternalDistributed`。关闭 [#70600](https://github.com/ClickHouse/ClickHouse/issues/70600)。[#71176](https://github.com/ClickHouse/ClickHouse/pull/71176) ([flynn](https://github.com/ucasfl))。
- 服务器配置(users.xml)中的设置现在也会应用于客户端。这对格式设置很有用,例如 `date_time_output_format`。[#71178](https://github.com/ClickHouse/ClickHouse/pull/71178) ([Michael Kolupaev](https://github.com/al13n321))。
- 修复由于 JSON 子列文件中未转义的特殊符号而可能导致的 `No such file or directory` 错误。[#71182](https://github.com/ClickHouse/ClickHouse/pull/71182) ([Pavel Kruglov](https://github.com/Avogar))。
- 表引擎 Kafka、NATS 和 RabbitMQ 现在在 `SOURCES` 层级中拥有各自的授权。需要为使用这些引擎类型创建表的任何非默认数据库用户添加授权。[#71250](https://github.com/ClickHouse/ClickHouse/pull/71250) ([Christoph Wurm](https://github.com/cwurm))。
- 在执行完整的变更查询之前进行检查(包括子查询)。这可以防止意外运行无效查询并累积阻塞有效变更的失效变更。[#71300](https://github.com/ClickHouse/ClickHouse/pull/71300) ([Christoph Wurm](https://github.com/cwurm))。
- 将文件系统缓存设置 `skip_download_if_exceeds_query_cache` 重命名为 `filesystem_cache_skip_download_if_exceeds_per_query_cache_write_limit`。[#71578](https://github.com/ClickHouse/ClickHouse/pull/71578) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 禁止在 min/max 函数中使用 Dynamic/Variant 类型以避免混淆。[#71761](https://github.com/ClickHouse/ClickHouse/pull/71761) ([Pavel Kruglov](https://github.com/Avogar))。
- 移除 `deltaSumTimestamp` 中对 `Enum` 以及 `UInt128` 和 `UInt256` 参数的支持。移除 `deltaSumTimestamp` 第二个("timestamp")参数对 `Int8`、`UInt8`、`Int16` 和 `UInt16` 的支持。[#71790](https://github.com/ClickHouse/ClickHouse/pull/71790) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 当 ClickHouse 用作字典的数据源时,添加了源查询验证。[#72548](https://github.com/ClickHouse/ClickHouse/pull/72548) ([Alexey Katsman](https://github.com/alexkats))。


## 新功能 {#new-features}


* 实现 `SYSTEM LOAD PRIMARY KEY` 命令，用于为指定表的所有数据块加载主键索引，或在未指定表时为所有表加载主键索引。这对于基准测试以及在查询执行期间避免额外延迟非常有用。 [#66252](https://github.com/ClickHouse/ClickHouse/pull/66252) ([ZAWA&#95;ll](https://github.com/Zawa-ll)).
* 新增 `SYSTEM LOAD PRIMARY KEY` 语句，用于加载指定表中所有数据分片的主键索引；如果未指定表，则会加载所有表的主键索引。这对于进行基准测试以及避免查询执行期间产生额外延迟非常有用。 [#67733](https://github.com/ClickHouse/ClickHouse/pull/67733) ([ZAWA&#95;ll](https://github.com/Zawa-ll)).
* 添加 `CHECK GRANT` 查询，用于检查当前用户/角色是否已被授予特定权限，以及对应的表/列是否已加载到内存中。 [#68885](https://github.com/ClickHouse/ClickHouse/pull/68885) ([Unalian](https://github.com/Unalian)).
* 新增了用于描述工作负载和资源管理的 SQL 语法。[https://clickhouse.com/docs/en/operations/workload-scheduling](https://clickhouse.com/docs/en/operations/workload-scheduling)。[#69187](https://github.com/ClickHouse/ClickHouse/pull/69187)（[Sergei Trifonov](https://github.com/serxa)）。
* [Iceberg 数据存储](https://iceberg.apache.org/spec/#file-system-operations) 格式为用户提供了丰富的选项来修改其表的模式（schema）。在此 pull request 中，已经实现了对 Iceberg 格式表的读取，支持列顺序、列名以及简单类型扩展的变更。[#69445](https://github.com/ClickHouse/ClickHouse/pull/69445)（[Daniil Ivanik](https://github.com/divanik)）。
* 允许为每种身份验证方法单独设置过期时间，并从用户实体中去除该字段。 [#70090](https://github.com/ClickHouse/ClickHouse/pull/70090) ([Arthur Passos](https://github.com/arthurpassos)).
* 将外部用户角色从查询发起方推送到集群中的其他节点。当且仅当查询发起方能够访问外部认证服务（如 LDAP）时，此功能非常有用。 [#70332](https://github.com/ClickHouse/ClickHouse/pull/70332) ([Andrey Zvonov](https://github.com/zvonand)).
* 支持将 String 列通过 `ALTER` 转换为 JSON。此 PR 还将 JSON 和 Dynamic 类型的序列化更改为新的 V2 版本。旧的 V1 版本仍然可以通过启用设置 `merge_tree_use_v1_object_and_dynamic_serialization` 来继续使用（可在升级期间启用，以便在出现问题时能够无障碍回滚版本）。[#70442](https://github.com/ClickHouse/ClickHouse/pull/70442) ([Pavel Kruglov](https://github.com/Avogar)).
* 新增函数 `toUnixTimestamp64Second`，用于将 `DateTime64` 转换为具有固定秒级精度的 `Int64` 值，从而在日期早于 1970 年 1 月 1 日（星期四）UTC 时间 00:00:00 时也能够返回负值。 [#70597](https://github.com/ClickHouse/ClickHouse/pull/70597) ([zhanglistar](https://github.com/zhanglistar)).
* 新增 `enforce_index_structure_match_on_partition_manipulation` 设置，以便在源表的投影和二级索引是目标表对应定义的子集时允许执行 `ATTACH`。关闭 [#70602](https://github.com/ClickHouse/ClickHouse/issues/70602)。[#70603](https://github.com/ClickHouse/ClickHouse/pull/70603)（[zwy991114](https://github.com/zwy991114)）。
* 函数 `cast` 的输出与 Apache Spark 不一致，从而在 gluten 项目中产生差异，详见 [https://github.com/apache/incubator-gluten/issues/7602](https://github.com/apache/incubator-gluten/issues/7602)。此 PR 增加了 Spark 文本输出格式的支持功能，默认关闭。[#70957](https://github.com/ClickHouse/ClickHouse/pull/70957)（[zhanglistar](https://github.com/zhanglistar)）。
* 为 S3 endpoint 添加了一种用于用户认证的新 header 类型（`access_header`）。这样可以以最低优先级提供某个访问 header，并且它会被来自其他任意来源（例如表 schema 或命名集合）的 `access_key_id` 覆盖。[#71011](https://github.com/ClickHouse/ClickHouse/pull/71011) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。
* 设置分层的初始实现。[#71145](https://github.com/ClickHouse/ClickHouse/pull/71145) ([Raúl Marín](https://github.com/Algunenano))。
* 为带有 `FILL` 运算符的 `ORDER BY` 添加对 staleness 子句的支持。 [#71151](https://github.com/ClickHouse/ClickHouse/pull/71151) ([Mikhail Artemenko](https://github.com/Michicosun)).
* 通过对 JSON 字符串进行序列化/反序列化，实现从 Map/Tuple/Object 到新 JSON 类型的简单 CAST。 [#71320](https://github.com/ClickHouse/ClickHouse/pull/71320) ([Pavel Kruglov](https://github.com/Avogar)).
* 为聚合函数 `any` 添加了别名 `anyRespectNulls`、`firstValueRespectNulls` 和 `anyValueRespectNulls`，并为聚合函数 `anyLast` 添加了别名 `anyLastRespectNulls` 和 `lastValueRespectNulls`。这样可以使用更自然的纯驼峰式语法，而不是混合驼峰式/下划线语法，例如：可以使用 `SELECT anyLastRespectNullsStateIf` 来代替 `anyLast_respect_nullsStateIf`。 [#71403](https://github.com/ClickHouse/ClickHouse/pull/71403) ([Peter Nguyen](https://github.com/petern48)).
* 添加了配置参数 `date_time_utc`，使 JSON 日志格式支持使用 RFC 3339/ISO8601 格式的 UTC 日期时间。[#71560](https://github.com/ClickHouse/ClickHouse/pull/71560) ([Ali](https://github.com/xogoodnow))。
* 在查询计划中新增了一个选项，可选择由连接的哪一侧作为内部（构建）表。该行为由 `query_plan_join_swap_table` 控制，其值可以设置为 `auto`。在此模式下，ClickHouse 会尝试选择行数最少的那张表。[#71577](https://github.com/ClickHouse/ClickHouse/pull/71577)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 如果某个 part 的 index granularity 是常量，则对其 granularity 值的内存使用进行了优化。新增了一个功能，可以始终为 part 选择常量 granularity（通过设置 `use_const_adaptive_granularity`），从而确保其在内存中始终得到优化。这有助于在大型负载场景（共享存储中包含数万亿行数据）下，避免由于数据 part 的元数据（index granularity 的值）导致的内存使用持续增长。[#71786](https://github.com/ClickHouse/ClickHouse/pull/71786)（[Anton Popov](https://github.com/CurtizJ)）。
* 将 `allowed_feature_tier` 实现为一个全局开关，用于禁用所有实验 / 测试版功能。 [#71841](https://github.com/ClickHouse/ClickHouse/pull/71841) ([Raúl Marín](https://github.com/Algunenano)).
* 添加 `iceberg[S3;HDFS;Azure]Cluster`、`deltaLakeCluster`、`hudiCluster` 表函数。 [#72045](https://github.com/ClickHouse/ClickHouse/pull/72045) ([Mikhail Artemenko](https://github.com/Michicosun)).
* 新增语法 `ALTER USER {ADD|MODIFY|DROP SETTING}`、`ALTER USER {ADD|DROP PROFILE}`，以及对应的 `ALTER ROLE` 和 `ALTER PROFILE` 语法。[#72050](https://github.com/ClickHouse/ClickHouse/pull/72050) ([pufit](https://github.com/pufit)).
* 新增 `arrayPrAUC` 函数，用于计算精确率-召回率曲线的 AUC（曲线下面积）。 [#72073](https://github.com/ClickHouse/ClickHouse/pull/72073) ([Emmanuel](https://github.com/emmanuelsdias)).
* 为 `MergeTree` 表的主键索引添加了缓存（可通过表设置 `use_primary_key_cache` 启用）。如果为主键索引同时启用了懒加载和缓存，则主键索引会按需加载到缓存中（类似于 mark cache），而不是一直常驻内存。为数据分片的插入/合并/抓取操作以及表重启添加了主键索引预热（可通过设置 `prewarm_primary_key_cache` 启用)。[#72102](https://github.com/ClickHouse/ClickHouse/pull/72102) ([Anton Popov](https://github.com/CurtizJ))。
* 为数组类型新增 `indexOfAssumeSorted` 函数，用于在数组按非递减顺序排序时优化查找性能。 [#72517](https://github.com/ClickHouse/ClickHouse/pull/72517) ([Eric Kurbanov](https://github.com/erickurbanov)).
* 允许在聚合函数 `groupConcat` 中将分隔符作为可选的第二个参数使用。 [#72540](https://github.com/ClickHouse/ClickHouse/pull/72540) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 新增设置项 `http_response_headers`，允许你自定义 HTTP 响应头。例如，你可以让浏览器直接渲染存储在数据库中的图片。此更改关闭了 [#59620](https://github.com/ClickHouse/ClickHouse/issues/59620)。[#72656](https://github.com/ClickHouse/ClickHouse/pull/72656)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 新增函数 `fromUnixTimestamp64Second`，用于将 Int64 类型的 Unix 时间戳值转换为 DateTime64。 [#73146](https://github.com/ClickHouse/ClickHouse/pull/73146) ([Robert Schulze](https://github.com/rschu1ze))。





## 性能改进 {#performance-improvements}


* 新增 2 个设置：`short_circuit_function_evaluation_for_nulls` 和 `short_circuit_function_evaluation_for_nulls_threshold`。当数据块中 NULL 值所占比例超过指定阈值时，允许以短路方式在 `Nullable` 列上执行函数，也就是说，函数只会在非空行上执行。该设置仅适用于这样一类函数：在某行中只要有任一参数为 NULL，就会返回 NULL 值的函数。[#60129](https://github.com/ClickHouse/ClickHouse/pull/60129)（[李扬](https://github.com/taiyang-li)）。
* 降低了 `clickhouse disks remove --recursive` 在对象存储磁盘上的内存使用量。 [#67323](https://github.com/ClickHouse/ClickHouse/pull/67323) ([Kirill](https://github.com/kirillgarbar)).
* 现在在使用 `join_algorithm='parallel_hash'` 进行并行处理、在多个线程之间分发数据时，将不再复制输入数据块的列。[#67782](https://github.com/ClickHouse/ClickHouse/pull/67782) ([Nikita Taranov](https://github.com/nickitat))。
* 为更多类型的表达式启用 JIT 编译：`abs`/`bitCount`/`sign`/`modulo`/`pmod`/`isNull`/`isNotNull`/`assumeNotNull`/`to(U)Int*`/`toFloat*`，比较函数（`=`、`<`、`>`、`>=`、`<=`），逻辑函数（`and`、`or`）。[#70598](https://github.com/ClickHouse/ClickHouse/pull/70598)（[李扬](https://github.com/taiyang-li)）。
* 现在，当 `join_algorithm` 设置为 `default` 时，将优先使用 `parallel_hash` 算法（如果适用）。当无法使用 `parallel_hash` 时，之前的两种替代方案（`direct` 和 `hash`）仍会被采用。 [#70788](https://github.com/ClickHouse/ClickHouse/pull/70788) ([Nikita Taranov](https://github.com/nickitat))。
* 为互不相交的数据部分优化了 `Replacing` 合并算法。[#70977](https://github.com/ClickHouse/ClickHouse/pull/70977) ([Anton Popov](https://github.com/CurtizJ)).
* 在 `metrics` 和 `system.detached_parts` 中不再列出来自只读和一次写入磁盘的 detached parts。[#71086](https://github.com/ClickHouse/ClickHouse/pull/71086)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 默认情况下不要计算重型异步指标。该功能最初在 [#40332](https://github.com/ClickHouse/ClickHouse/issues/40332) 中引入，但为仅一个客户的需求而运行一个开销巨大的后台任务并不理想。[#71087](https://github.com/ClickHouse/ClickHouse/pull/71087)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 通过缩小临界区来提升 `system.query_metric_log` 采集间隔的性能和精度。[#71473](https://github.com/ClickHouse/ClickHouse/pull/71473) ([Pablo Marcos](https://github.com/pamarcos)).
* 添加选项，从 `WHERE` 和 `ON` 表达式中提取公共子表达式，以减少联接期间使用的哈希表数量。可通过 `optimize_extract_common_expressions = 1` 启用。 [#71537](https://github.com/ClickHouse/ClickHouse/pull/71537) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
* 允许在包含 `LowCardinality(String)` 的 `SELECT` 查询中使用索引。[#71598](https://github.com/ClickHouse/ClickHouse/pull/71598) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 在使用并行副本且启用了本地计划的查询执行过程中，将跳过在 worker 上进行跳过索引（skip index）分析。`coordinator` 会基于其自身（查询发起端）执行的索引分析，为各个 worker 选择要读取的范围。[#72109](https://github.com/ClickHouse/ClickHouse/pull/72109)（[Igor Nikonov](https://github.com/devcrafter)）。
* 从 [https://github.com/ClickHouse/ClickHouse/pull/57631](https://github.com/ClickHouse/ClickHouse/pull/57631) 恢复在 Compact 部分中对单列子列读取的优化。该优化曾被误删。[#72285](https://github.com/ClickHouse/ClickHouse/pull/72285)（[Pavel Kruglov](https://github.com/Avogar)）。
* 通过在比较器中去虚函数化调用，加速对 `LowCardinality(String)` 列的排序。[#72337](https://github.com/ClickHouse/ClickHouse/pull/72337) ([Alexander Gololobov](https://github.com/davenger))。
* 为部分简单数据类型优化 argMin/Max 函数。[#72350](https://github.com/ClickHouse/ClickHouse/pull/72350)（[alesapin](https://github.com/alesapin)）。
* 在内存跟踪器中使用共享锁优化锁机制，以减少锁竞争。[#72375](https://github.com/ClickHouse/ClickHouse/pull/72375) ([Jiebin Sun](https://github.com/jiebinn)).
* 新增了一个名为 `use_async_executor_for_materialized_views` 的设置。对物化视图查询使用异步（并可能是多线程）执行，可以加速 INSERT 期间的视图处理，但也会消耗更多内存。[#72497](https://github.com/ClickHouse/ClickHouse/pull/72497) ([alesapin](https://github.com/alesapin))。
* 将设置 `max_size_to_preallocate_for_aggregation` 和 `max_size_to_preallocate_for_joins` 的默认值进一步提升到 `10^12`，从而使该优化在更多场景下生效。 [#72555](https://github.com/ClickHouse/ClickHouse/pull/72555) ([Nikita Taranov](https://github.com/nickitat))。
* 改进了聚合函数状态反序列化的性能（适用于数据类型 `AggregateFunction` 以及分布式查询）。略微提升了 `RowBinary` 格式的解析性能。 [#72818](https://github.com/ClickHouse/ClickHouse/pull/72818) ([Anton Popov](https://github.com/CurtizJ)).





## 改进 {#improvement}


* 使用常量数组和常量捕获参数的高阶函数将返回常量。[#58400](https://github.com/ClickHouse/ClickHouse/pull/58400)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 通过生成虚拟行来优化顺序读取，从而在归并排序期间减少读取的数据量，在存在多个 part 时尤其有用。 [#62125](https://github.com/ClickHouse/ClickHouse/pull/62125) ([Shichao Jin](https://github.com/jsc0218)).
* 查询计划步骤名称（`EXPLAIN PLAN json=1`）和管道处理器名称（`EXPLAIN PIPELINE compact=0,graph=1`）现在带有唯一的 ID 后缀。这样可以将处理器性能分析输出和 OpenTelemetry 跟踪与 `EXPLAIN` 的输出进行对应。[#63518](https://github.com/ClickHouse/ClickHouse/pull/63518)（[qhsong](https://github.com/qhsong)）。
* 新增了在写入 Azure Blob Storage 后检查对象是否存在的选项，可通过设置 `check_objects_after_upload` 来控制。[#64847](https://github.com/ClickHouse/ClickHouse/pull/64847)（[Smita Kulkarni](https://github.com/SmitaRKulkarni)）。
* 修复 `HashTable` 中 `destroyElements` 的 use-after-destructor 逻辑。 [#65279](https://github.com/ClickHouse/ClickHouse/pull/65279) ([cangyin](https://github.com/cangyin)).
* 在 `clickhouse-local` 中默认使用 `Atomic` 数据库。解决了 [#50647](https://github.com/ClickHouse/ClickHouse/issues/50647) 中的第 1 和第 5 项。关闭 [#44817](https://github.com/ClickHouse/ClickHouse/issues/44817)。[#68024](https://github.com/ClickHouse/ClickHouse/pull/68024)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 写入缓冲区必须显式取消或结束。异常会打破 HTTP 协议，以便向客户端告知错误。 [#68800](https://github.com/ClickHouse/ClickHouse/pull/68800) ([Sema Checherinda](https://github.com/CheSema)).
* 通过创建 replica&#95;dir 并在 DDLWorker 中将副本标记为活跃，报告正在运行的 DDLWorker 主机。 [#69658](https://github.com/ClickHouse/ClickHouse/pull/69658) ([Tuan Pham Anh](https://github.com/tuanpach)).
* 1. 重构 `DDLQueryStatusSource`：- 将 `DDLQueryStatusSource` 重命名为 `DistributedQueryStatusSource`，并将其作为基类 - 创建两个子类 `DDLOnClusterQueryStatusSource` 和 `ReplicatedDatabaseQueryStatusSource`，继承自 `DistributedQueryStatusSource`，分别用于从 DDL On Cluster 和复制数据库中查询 DDL 任务状态。2. 在 `DDLOnClusterQueryStatusSource` 中支持停止等待离线主机。[#69660](https://github.com/ClickHouse/ClickHouse/pull/69660) ([Tuan Pham Anh](https://github.com/tuanpach))。
* 添加了新的取消逻辑：`CancellationChecker` 会为每个已启动的查询检查超时时间，并在超时后将其停止。 [#69880](https://github.com/ClickHouse/ClickHouse/pull/69880) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 移除 `allow_experimental_join_condition` 设置，默认允许使用非等值连接条件。[#69910](https://github.com/ClickHouse/ClickHouse/pull/69910) ([Vladimir Cherkasov](https://github.com/vdimir))。
* 默认启用 `parallel_replicas_local_plan`。在查询发起端构建完整的本地执行计划，可以在减少资源消耗的同时提升并行副本性能，并创造应用更多查询优化的空间。[#70171](https://github.com/ClickHouse/ClickHouse/pull/70171)（[Igor Nikonov](https://github.com/devcrafter)）。
* 在 `http_handlers` 中新增设置用户名/密码的能力（适用于 `dynamic_query_handler`/`predefined_query_handler`）。[#70725](https://github.com/ClickHouse/ClickHouse/pull/70725)（[Azat Khuzhin](https://github.com/azat)）。
* 在 S3Queue 存储中为某些设置添加对 `ALTER TABLE ... MODIFY/RESET SETTING ...` 的支持。[#70811](https://github.com/ClickHouse/ClickHouse/pull/70811)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 在列出目录时不要调用对象存储 API，因为这可能会导致成本过高。相反，应将文件名列表存储在内存中。这样做的权衡是初始加载时间增加，以及为存储文件名所需的内存开销增大。[#70823](https://github.com/ClickHouse/ClickHouse/pull/70823) ([Julia Kartseva](https://github.com/jkartseva)).
* 为 `clickhouse-compressor` 添加 `--threads` 参数，用于并行压缩数据。 [#70860](https://github.com/ClickHouse/ClickHouse/pull/70860) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 使 Replxx 客户端的历史记录大小可配置。[#71014](https://github.com/ClickHouse/ClickHouse/pull/71014) ([Jiří Kozlovský](https://github.com/jirislav))。
* 新增 `prewarm_mark_cache` 设置，可在插入、合并、拉取分片以及表启动时，将 mark 预加载到 mark cache 中。[#71053](https://github.com/ClickHouse/ClickHouse/pull/71053)（[Anton Popov](https://github.com/CurtizJ)）。
* 为 Parquet 原生读取器添加 Boolean 支持。[#71055](https://github.com/ClickHouse/ClickHouse/pull/71055)（[Arthur Passos](https://github.com/arthurpassos)）。
* 在与 S3 交互时，对更多类型的错误进行重试，例如 &quot;Malformed message&quot;。[#71088](https://github.com/ClickHouse/ClickHouse/pull/71088) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 降低部分与 S3 相关消息的日志级别。[#71090](https://github.com/ClickHouse/ClickHouse/pull/71090) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 支持写入文件名中包含空格的 HDFS 文件。[#71105](https://github.com/ClickHouse/ClickHouse/pull/71105) ([exmy](https://github.com/exmy))。
* `system.session_log` 已经足够好了。这一改动关闭了 [#51760](https://github.com/ClickHouse/ClickHouse/issues/51760)。[#71150](https://github.com/ClickHouse/ClickHouse/pull/71150)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复了在使用并行副本的查询中执行 `RIGHT` / `FULL` 联接的问题。现在，`RIGHT` 联接可以在并行副本间执行（右表读取会被分布式执行）。`FULL` 联接无法在多个节点之间并行化，只能在本地执行。 [#71162](https://github.com/ClickHouse/ClickHouse/pull/71162) ([Igor Nikonov](https://github.com/devcrafter))。
* 新增了用于限制复制表、字典和视图数量的设置。[#71179](https://github.com/ClickHouse/ClickHouse/pull/71179)（[Kirill](https://github.com/kirillgarbar)）。
* 修复了 [#71227](https://github.com/ClickHouse/ClickHouse/issues/71227)。[#71286](https://github.com/ClickHouse/ClickHouse/pull/71286)（[Arthur Passos](https://github.com/arthurpassos)）。
* 根据服务器/用户内存使用情况，自动将 `GROUP BY`/`ORDER BY` 切换为基于磁盘的执行。通过 `max_bytes_ratio_before_external_group_by`/`max_bytes_ratio_before_external_sort` 查询设置进行控制。[#71406](https://github.com/ClickHouse/ClickHouse/pull/71406)（[Azat Khuzhin](https://github.com/azat)）。
* 将按主机划分的仪表板 `Overview (host)` 和 `Cloud overview (host)` 添加到高级仪表板中。[#71422](https://github.com/ClickHouse/ClickHouse/pull/71422) ([alesapin](https://github.com/alesapin))。
* 函数 `translate` 现在支持在 `from` 参数包含的字符多于 `to` 参数时删除多余字符。示例：`SELECT translate('clickhouse', 'clickhouse', 'CLICK')` 现在返回 `CLICK`。 [#71441](https://github.com/ClickHouse/ClickHouse/pull/71441) ([shuai.xu](https://github.com/shuai-xu)).
* 新增了函数 `parseDateTime64`、`parseDateTime64OrNull` 和 `parseDateTime64OrZero`。与现有的函数 `parseDateTime`（及其变体）相比，这些函数返回 `DateTime64` 类型的值，而非 `DateTime`。[#71581](https://github.com/ClickHouse/ClickHouse/pull/71581) ([kevinyhzou](https://github.com/KevinyhZou))。
* 将 MergeTree 表引擎家族中 `index_granularity` 数组在内存中的占用进行收缩，以减少内存开销。[#71595](https://github.com/ClickHouse/ClickHouse/pull/71595) ([alesapin](https://github.com/alesapin)).
* 命令行应用程序现在会对语法进行高亮显示，即使是包含多个语句的情况也同样适用。[#71622](https://github.com/ClickHouse/ClickHouse/pull/71622) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 命令行应用程序在发生错误时将返回非零退出码。在之前的版本中，`disks` 应用程序在出错时会返回零，其他应用程序在错误码 256（`PARTITION_ALREADY_EXISTS`）和 512（`SET_NON_GRANTED_ROLE`）时也会返回零。[#71623](https://github.com/ClickHouse/ClickHouse/pull/71623)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `Vertical` 格式（当你以 `\G` 结束查询时也会启用）已具备 Pretty 系列格式的特性，例如：- 高亮显示数字中的千位分组；- 输出更易读的数字提示。[#71630](https://github.com/ClickHouse/ClickHouse/pull/71630)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 允许通过设置 `filesystem_cache_prefer_bigger_buffer_size` 来禁用文件系统缓存的内存缓冲区自动增大。[#71640](https://github.com/ClickHouse/ClickHouse/pull/71640) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 在文件系统缓存中，为后台下载的最大文件段大小新增了单独的设置 `background_download_max_file_segment_size`。 [#71648](https://github.com/ClickHouse/ClickHouse/pull/71648) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 将 `enable_http_compression` 的默认值从 0 修改为 1。修复 [#71591](https://github.com/ClickHouse/ClickHouse/issues/71591)。[#71774](https://github.com/ClickHouse/ClickHouse/pull/71774)（[Peter Nguyen](https://github.com/petern48)）。
* 支持将 Object 类型通过 ALTER 转换为 JSON。 [#71784](https://github.com/ClickHouse/ClickHouse/pull/71784) ([Pavel Kruglov](https://github.com/Avogar)).
* 略微改进了 JSON 类型解析：如果某个 JSON 路径对应的当前数据块包含多种类型的值，则会按照特定的“尽力而为”类型优先级顺序依次尝试，并选择最合适的类型。[#71785](https://github.com/ClickHouse/ClickHouse/pull/71785) ([Pavel Kruglov](https://github.com/Avogar)).
* 之前，从 `system.asynchronous_metrics` 读取时会等待并发更新完成。如果系统处于高负载状态，这可能会耗费很长时间。通过此更改，可以随时读取之前收集的值。[#71798](https://github.com/ClickHouse/ClickHouse/pull/71798)（[Alexander Gololobov](https://github.com/davenger)）。
* 将 `polling_max_timeout_ms` 设置为 10 分钟，将 `polling_backoff_ms` 设置为 30 秒。[#71817](https://github.com/ClickHouse/ClickHouse/pull/71817)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 像 &#39;SELECT - FROM t LIMIT 1&#39; 这样的查询过去会加载分片索引，即使它们并未被使用。[#71866](https://github.com/ClickHouse/ClickHouse/pull/71866) ([Alexander Gololobov](https://github.com/davenger))。
* 在旧版兼容性设置下，`allow_reorder_prewhere_conditions` 默认开启。 [#71867](https://github.com/ClickHouse/ClickHouse/pull/71867) ([Raúl Marín](https://github.com/Algunenano))。
* 在使用 `bitmapTransform` 函数且参数类型有效时，不再在 `system.errors` 表中递增 `ILLEGAL_TYPE_OF_ARGUMENT` 计数器。[#71971](https://github.com/ClickHouse/ClickHouse/pull/71971) ([Dmitry Novik](https://github.com/novikd))。
* 当通过 Dictionary 存储、dictionary 表函数，或直接对字典本身执行 SELECT 来从字典中检索数据时，现在只需要对该字典具有 `SELECT` 权限或 `dictGet` 权限即可。此更改与之前为防止 ACL 绕过所做的尝试保持一致：[https://github.com/ClickHouse/ClickHouse/pull/57362](https://github.com/ClickHouse/ClickHouse/pull/57362) 和 [https://github.com/ClickHouse/ClickHouse/pull/65359](https://github.com/ClickHouse/ClickHouse/pull/65359)。它还使后者具备向后兼容性。[#72051](https://github.com/ClickHouse/ClickHouse/pull/72051)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 在高级仪表板的 HTML 页面中，新增了一个下拉选择器，用于从 `system.dashboards` 表中选择仪表板。[#72081](https://github.com/ClickHouse/ClickHouse/pull/72081) ([Sergei Trifonov](https://github.com/serxa)).
* 在为分布式 `INSERT ... SELECT` 构建执行计划时遵从 `prefer_locahost_replica` 设置。[#72190](https://github.com/ClickHouse/ClickHouse/pull/72190)（[filimonov](https://github.com/filimonov)）。
* 该问题已在[此处进行了描述](https://github.com/ClickHouse/ClickHouse/issues/72091)。Azure Iceberg Writer 创建的 Iceberg 元数据文件（以及 manifest 文件）不符合规范。在此 PR 中，我尝试使用 v2 reader 读取 v1 Iceberg 格式的元数据（因为它们就是以这种方式写入的），并在其未在 manifest 文件中创建相应字段时抛出错误。[#72277](https://github.com/ClickHouse/ClickHouse/pull/72277)（[Daniil Ivanik](https://github.com/divanik)）。
* 将 JSON/Dynamic/Variant 类型从实验特性提升到 Beta 阶段。 [#72294](https://github.com/ClickHouse/ClickHouse/pull/72294) ([Pavel Kruglov](https://github.com/Avogar)).
* 现在允许在查询中使用带有 `UNION [ALL]` 的 `CREATE MATERIALIZED VIEW`。其行为与带有 `JOIN` 的物化视图相同：**只有 `SELECT` 表达式中的第一个表会作为插入的触发器**，所有其他表都会被忽略。 [#72347](https://github.com/ClickHouse/ClickHouse/pull/72347) ([alesapin](https://github.com/alesapin))。
* 在插入批次中的所有行共享同一个分区键值的情况下，加速向 MergeTree 的写入。 [#72348](https://github.com/ClickHouse/ClickHouse/pull/72348) ([alesapin](https://github.com/alesapin)).
* 将新的 MergeTreeIndexGranularityInternalArraysTotalSize 指标添加到 system.metrics 中。该指标用于定位包含超大数据集、容易出现高内存占用问题的实例。[#72490](https://github.com/ClickHouse/ClickHouse/pull/72490)（[Miсhael Stetsyuk](https://github.com/mstetsyuk)）。
* 在查询使用 `Format Null` 时，现在会识别单词 `Null` 的所有大小写写法。此前，其他形式（例如 `NULL`）虽然不会抛出异常，但在这些情况下实际上并不会按照 `Null` 格式进行处理。[#72658](https://github.com/ClickHouse/ClickHouse/pull/72658)（[Nikita Taranov](https://github.com/nickitat)）。
* 允许 `set` 中包含不在 `Enum` 中的未知值。修复 [#72662](https://github.com/ClickHouse/ClickHouse/issues/72662)。[#72686](https://github.com/ClickHouse/ClickHouse/pull/72686) ([zhanglistar](https://github.com/zhanglistar))。
* 在 `system.tables` 中添加 `total_bytes_with_inactive`，用于统计非活跃数据分片的总字节数。 [#72690](https://github.com/ClickHouse/ClickHouse/pull/72690) ([Kai Zhu](https://github.com/nauu)).
* 将 MergeTreeSettings 添加到 system.settings&#95;changes。 [#72694](https://github.com/ClickHouse/ClickHouse/pull/72694) ([Raúl Marín](https://github.com/Algunenano)).
* 为 Enum 数据类型增加对字符串搜索运算符（如 `LIKE`）的支持，修复 [#72661](https://github.com/ClickHouse/ClickHouse/issues/72661)。[#72732](https://github.com/ClickHouse/ClickHouse/pull/72732)（[zhanglistar](https://github.com/zhanglistar)）。
* 在 `notEmpty` 函数中支持 `JSON` 类型。 [#72741](https://github.com/ClickHouse/ClickHouse/pull/72741) ([Pavel Kruglov](https://github.com/Avogar))。
* 支持解析 GCS S3 的 `AuthenticationRequired` 错误。 [#72753](https://github.com/ClickHouse/ClickHouse/pull/72753) ([Vitaly Baranov](https://github.com/vitlibar)).
* 在函数 ifNull 和 coalesce 中支持 Dynamic 类型。[#72772](https://github.com/ClickHouse/ClickHouse/pull/72772) ([Pavel Kruglov](https://github.com/Avogar))。
* 新增了 `JoinBuildTableRowCount/JoinProbeTableRowCount/JoinResultRowCount` 性能事件（profile events）。[#72842](https://github.com/ClickHouse/ClickHouse/pull/72842) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 在函数 toFloat64/touInt32 等中支持 Dynamic。 [#72989](https://github.com/ClickHouse/ClickHouse/pull/72989) ([Pavel Kruglov](https://github.com/Avogar)).





## Bug Fix (官方稳定版本中用户可见的错误行为) {#bug-fix}


* 在执行 `ATTACH PART` 查询时被去重的分片不再会一直停留在带有 `attaching_` 前缀的状态。[#65636](https://github.com/ClickHouse/ClickHouse/pull/65636) ([Kirill](https://github.com/kirillgarbar))。
* 修复了 `IN` 函数中 `dateTime64` 精度丢失的错误。[#67230](https://github.com/ClickHouse/ClickHouse/pull/67230) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 修复在 `ORDER BY ... WITH FILL` 中使用带有 `IGNORE/RESPECT NULLS` 的函数时可能出现的逻辑错误，关闭 [#57609](https://github.com/ClickHouse/ClickHouse/issues/57609)。[#68234](https://github.com/ClickHouse/ClickHouse/pull/68234)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 修复了在达到内存限制时，使用 `Native` 格式进行异步插入时会出现的罕见逻辑错误。[#68965](https://github.com/ClickHouse/ClickHouse/pull/68965) ([Anton Popov](https://github.com/CurtizJ))。
* 修复 `CREATE TABLE` 中 EPHEMERAL 列的 `COMMENT`。[#70458](https://github.com/ClickHouse/ClickHouse/pull/70458)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* 修复 `JSONExtract` 在处理 LowCardinality(Nullable) 时的逻辑错误。 [#70549](https://github.com/ClickHouse/ClickHouse/pull/70549) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复了表名过长时的处理行为。[#70810](https://github.com/ClickHouse/ClickHouse/pull/70810) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 在 URL 引擎中新增支持通过用户自定义请求头覆盖 `Content-Type`。 [#70859](https://github.com/ClickHouse/ClickHouse/pull/70859) ([Artem Iurin](https://github.com/ortyomka)).
* 修复 `StorageS3Queue` 中的逻辑错误 “Cannot create a persistent node in /processed since it already exists”。[#70984](https://github.com/ClickHouse/ClickHouse/pull/70984)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 修复了在投影轻量级删除的重建选项中未考虑 `_row_exists` 列的缺陷。 [#71089](https://github.com/ClickHouse/ClickHouse/pull/71089) ([Shichao Jin](https://github.com/jsc0218)).
* 修复由于意外竞争条件导致 `system.query_metric_log` 中值错误的问题。 [#71124](https://github.com/ClickHouse/ClickHouse/pull/71124) ([Pablo Marcos](https://github.com/pamarcos))。
* 修复 `quantileExactWeightedInterpolated` 聚合函数名称不匹配的问题。该缺陷是在 [https://github.com/ClickHouse/ClickHouse/pull/69619](https://github.com/ClickHouse/ClickHouse/pull/69619) 中引入的。cc @Algunenano。[#71168](https://github.com/ClickHouse/ClickHouse/pull/71168) ([李扬](https://github.com/taiyang-li))。
* 修复在函数比较中使用 Dynamic 时出现的 bad&#95;weak&#95;ptr 异常。[#71183](https://github.com/ClickHouse/ClickHouse/pull/71183) ([Pavel Kruglov](https://github.com/Avogar))。
* 在 ReplicatedMergeTree 使用零拷贝复制时，如果仍有节点在使用某个 blob，则不要删除该 blob。[#71186](https://github.com/ClickHouse/ClickHouse/pull/71186) ([Antonio Andelic](https://github.com/antonio2368))。
* 修复通过 HTTP 和异步插入使用 Native 格式时忽略 `format` 设置的问题。 [#71193](https://github.com/ClickHouse/ClickHouse/pull/71193) ([Pavel Kruglov](https://github.com/Avogar)).
* 在将 `use_query_cache = 1` 设置用于 `SELECT` 查询时，如果系统表名以字面量形式出现（例如 `SELECT - FROM users WHERE name = 'system.metrics' SETTINGS use_query_cache = true;`），这些查询不再会被拒绝，现在可以正常执行。[#71254](https://github.com/ClickHouse/ClickHouse/pull/71254) ([Robert Schulze](https://github.com/rschu1ze))。
* 修复在设置 enable&#95;filesystem&#95;cache=1，但存储配置中的磁盘未配置任何缓存时导致内存使用增加的错误。[#71261](https://github.com/ClickHouse/ClickHouse/pull/71261)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 修复在从 Dynamic 列反序列化 LowCardinality 字典时可能出现的 &quot;Cannot read all data&quot; 错误。 [#71299](https://github.com/ClickHouse/ClickHouse/pull/71299) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复客户端中并行输出格式清理不完整的问题。 [#71304](https://github.com/ClickHouse/ClickHouse/pull/71304) ([Raúl Marín](https://github.com/Algunenano)).
* 在命名集合中补充了缺失的反转义处理。若没有该修复，clickhouse-server 将无法启动。[#71308](https://github.com/ClickHouse/ClickHouse/pull/71308) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* 通过原生协议修复空数据块的异步插入。 [#71312](https://github.com/ClickHouse/ClickHouse/pull/71312) ([Anton Popov](https://github.com/CurtizJ)).
* 修复在授予错误通配符权限时 AST 格式不一致的问题 [#71309](https://github.com/ClickHouse/ClickHouse/issues/71309)。[#71332](https://github.com/ClickHouse/ClickHouse/pull/71332)（[pufit](https://github.com/pufit)）。
* 在 JSON 类型提示中检查可疑类型和实验性类型。[#71369](https://github.com/ClickHouse/ClickHouse/pull/71369) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复带有 `Variant` 列的 `Chunk` 中出现的 “Invalid number of rows” 错误。[#71388](https://github.com/ClickHouse/ClickHouse/pull/71388)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复在向 `mongodb` 表函数传递错误参数（例如 `NULL`）时导致崩溃的问题。[#71426](https://github.com/ClickHouse/ClickHouse/pull/71426) ([Vladimir Cherkasov](https://github.com/vdimir))。
* 修复在启用 optimize&#95;rewrite&#95;array&#95;exists&#95;to&#95;has 时出现的崩溃问题。[#71432](https://github.com/ClickHouse/ClickHouse/pull/71432) ([Raúl Marín](https://github.com/Algunenano)).
* 修复在为 `palin_rewritable` 磁盘创建目录失败时回滚事务过程中出现 `NoSuchKey` 错误的问题。[#71439](https://github.com/ClickHouse/ClickHouse/pull/71439)（[Julia Kartseva](https://github.com/jkartseva)）。
* 修复了在插入操作中对设置 `max_insert_delayed_streams_for_parallel_write` 的使用。此前其行为不正确，可能会在向多个分区写入数据的插入操作中导致高内存占用。[#71474](https://github.com/ClickHouse/ClickHouse/pull/71474) ([Anton Popov](https://github.com/CurtizJ))。
* 修复在 `arrayJoin` 可能出现在 `WHERE` 条件中时，旧分析器中可能出现的错误 `Argument for function must be constant`。这是在 [https://github.com/ClickHouse/ClickHouse/pull/65414](https://github.com/ClickHouse/ClickHouse/pull/65414) 之后引入的回归。[#71476](https://github.com/ClickHouse/ClickHouse/pull/71476)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 防止在 0 列的 `SortCursor` 中发生崩溃（旧分析器）。[#71494](https://github.com/ClickHouse/ClickHouse/pull/71494)（[Raúl Marín](https://github.com/Algunenano)）。
* 修复由于未初始化的 ORC 数据导致的 date32 超出范围问题。更多详情参见 [https://github.com/apache/incubator-gluten/issues/7823](https://github.com/apache/incubator-gluten/issues/7823)。[#71500](https://github.com/ClickHouse/ClickHouse/pull/71500)（[李扬](https://github.com/taiyang-li)）。
* 修复在宽部中统计 `Dynamic` 和 `JSON` 类型列大小的问题。 [#71526](https://github.com/ClickHouse/ClickHouse/pull/71526) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在物化视图中的查询使用带有 CTE 的 `IN` 时的 Analyzer 问题。关闭 [#65598](https://github.com/ClickHouse/ClickHouse/issues/65598)。[#71538](https://github.com/ClickHouse/ClickHouse/pull/71538)（[Maksim Kita](https://github.com/kitaisreal)）。
* 在越界情况下，`bitShift` 函数返回 0 或默认字符，而不再抛出错误。[#71580](https://github.com/ClickHouse/ClickHouse/pull/71580) ([Pablo Marcos](https://github.com/pamarcos))。
* 修复在使用 `materialized view` 搭配某些引擎时导致的服务器崩溃问题。 [#71593](https://github.com/ClickHouse/ClickHouse/pull/71593) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。
* 在对包含指向常量数组别名的嵌套数据结构执行 `ARRAY JOIN` 时，会导致空指针解引用。此修复关闭了 [#71677](https://github.com/ClickHouse/ClickHouse/issues/71677)。[#71678](https://github.com/ClickHouse/ClickHouse/pull/71678)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复在使用空元组执行 ALTER 时出现的 `LOGICAL_ERROR`。此更改修复了 [#71647](https://github.com/ClickHouse/ClickHouse/issues/71647)。[#71679](https://github.com/ClickHouse/ClickHouse/pull/71679)（[Amos Bird](https://github.com/amosbird)）。
* 在针对分区列的谓词中使用 NOT IN 运算符时，不要转换常量集合。 [#71695](https://github.com/ClickHouse/ClickHouse/pull/71695) ([Eduard Karacharov](https://github.com/korowa)).
* 修复从 `LowCardinality(Nullable)` 到 `Dynamic` 的 `CAST`。此前，该操作可能会导致错误：`Bad cast from type DB::ColumnVector<int> to DB::ColumnNullable`。[#71742](https://github.com/ClickHouse/ClickHouse/pull/71742)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复在 `WHERE` 条件中对 `DateTime64` 类型主键使用 `toDayOfWeek` 时出现的异常。[#71849](https://github.com/ClickHouse/ClickHouse/pull/71849) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 修复了解析为稀疏列后默认值填充的逻辑。[#71854](https://github.com/ClickHouse/ClickHouse/pull/71854) ([Anton Popov](https://github.com/CurtizJ)).
* 修复在分布式表上当输入为 ALIAS 时 `GROUPING` 函数报错的问题，关闭 [#68602](https://github.com/ClickHouse/ClickHouse/issues/68602)。[#71855](https://github.com/ClickHouse/ClickHouse/pull/71855)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 修复了使用 `WITH TIES` 子句的 `SELECT` 查询可能返回行数不足的问题。 [#71886](https://github.com/ClickHouse/ClickHouse/pull/71886) ([wxybear](https://github.com/wxybear)).
* 修复 `arrayWithConstant` 计算时，由于将某列误判为超出数组大小上限而导致的 `TOO_LARGE_ARRAY_SIZE` 异常。 [#71894](https://github.com/ClickHouse/ClickHouse/pull/71894) ([Udi](https://github.com/udiz)).
* `clickhouse-benchmark` 对耗时超过一秒的查询报告了错误的指标。[#71898](https://github.com/ClickHouse/ClickHouse/pull/71898) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 修复 `clickhouse-client` 中进度指示器与进度表之间的数据竞争问题，该问题在使用 `FROM INFILE` 时会显现。现在在执行 `INSERT` 查询期间拦截按键，以切换进度表显示。[#71901](https://github.com/ClickHouse/ClickHouse/pull/71901) ([Julia Kartseva](https://github.com/jkartseva))。
* 修复 Pretty JSON 格式中 Dynamic 值的序列化。[#71923](https://github.com/ClickHouse/ClickHouse/pull/71923) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复 24.6 版本中 system.s3/azure&#95;queue&#95;log 表的 rows&#95;processed 列异常问题。修复了 [#69975](https://github.com/ClickHouse/ClickHouse/issues/69975)。[#71946](https://github.com/ClickHouse/ClickHouse/pull/71946)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 修复了在使用 `s3`/`s3Cluster` 函数时可能返回不完整结果或抛出异常的问题。该问题出现在 s3 URI 中使用通配符模式（例如 `pattern/*`）且存在一个键为 `pattern/` 的空对象时（此类对象会由 S3 控制台自动创建）。此外，将设置项 `s3_skip_empty_files` 的默认值从 `false` 修改为 `true`。 [#71947](https://github.com/ClickHouse/ClickHouse/pull/71947) ([Nikita Taranov](https://github.com/nickitat)).
* 修复 `clickhouse-client` 语法高亮导致的崩溃问题。修复了 [#71864](https://github.com/ClickHouse/ClickHouse/issues/71864)。[#71949](https://github.com/ClickHouse/ClickHouse/pull/71949)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 修复在 `ORDER BY` 中对 `MergeTree` 表使用二元单调函数且第一个参数为常量时出现的 `Illegal type` 错误。修复了 [#71941](https://github.com/ClickHouse/ClickHouse/issues/71941)。[#71966](https://github.com/ClickHouse/ClickHouse/pull/71966)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 仅允许在子查询中使用的 `EXPLAIN AST` 中包含 `SELECT` 查询。其他类型的查询会导致逻辑错误：`Bad cast from type DB::ASTCreateQuery to DB::ASTSelectWithUnionQuery` 或 `Inconsistent AST formatting`。[#71982](https://github.com/ClickHouse/ClickHouse/pull/71982) ([Pavel Kruglov](https://github.com/Avogar))。
* 当使用 `clickhouse-client` 插入一条记录时，客户端会从服务端读取列描述。但之前存在一个 Bug，我们以错误的顺序写入了这些描述，正确的顺序应为 [statistics, ttl, settings]。[#71991](https://github.com/ClickHouse/ClickHouse/pull/71991) ([Han Fei](https://github.com/hanfei1991))。
* 在启用 `format_alter_commands_with_parentheses` 时，修复 `MOVE PARTITION ... TO TABLE ...` ALTER 命令的格式。[#72080](https://github.com/ClickHouse/ClickHouse/pull/72080) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* 在 File/S3/URL/HDFS/Azure 引擎的 `CREATE` 查询中添加推断得到的格式名称。此前，格式名称会在每次服务器重启时重新推断，如果指定的数据文件已被删除，就会导致服务器启动失败。[#72108](https://github.com/ClickHouse/ClickHouse/pull/72108) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复了一个 Bug：`min_age_to_force_merge_on_partition_only` 会一直尝试对同一个已合并为单个 part 的分区进行合并，而不会去合并仍包含多个 part 的分区。[#72209](https://github.com/ClickHouse/ClickHouse/pull/72209) ([Christoph Wurm](https://github.com/cwurm))。
* 修复了在处理稀疏列时极少数情况下会发生的 `SimpleSquashingChunksTransform` 崩溃问题。 [#72226](https://github.com/ClickHouse/ClickHouse/pull/72226) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 修复了 `GraceHashJoin` 中的数据竞争问题，该问题可能导致某些行在 JOIN 输出中缺失。[#72233](https://github.com/ClickHouse/ClickHouse/pull/72233) ([Nikita Taranov](https://github.com/nickitat))。
* 修复了在启用 `enable_block_number_column` 设置时，对物化 `_block_number` 列执行的 `ALTER DELETE` 查询。 [#72261](https://github.com/ClickHouse/ClickHouse/pull/72261) ([Anton Popov](https://github.com/CurtizJ)).
* 修复了在并发调用 `ColumnDynamic::dumpStructure()` 时出现的数据竞争问题，例如在 `ConcurrentHashJoin` 构造函数中。[#72278](https://github.com/ClickHouse/ClickHouse/pull/72278) ([Nikita Taranov](https://github.com/nickitat))。
* 修复在 `ORDER BY ... WITH FILL` 中使用重复列时可能出现的 `LOGICAL_ERROR`。[#72387](https://github.com/ClickHouse/ClickHouse/pull/72387)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 在应用 `optimize_functions_to_subcolumns` 后，修复了多种场景中的类型不匹配问题。[#72394](https://github.com/ClickHouse/ClickHouse/pull/72394) ([Anton Popov](https://github.com/CurtizJ)).
* 修复解析 `BACKUP DATABASE db EXCEPT TABLES db.table` 查询时的错误。[#72429](https://github.com/ClickHouse/ClickHouse/pull/72429)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 禁止创建空的 Variant。[#72454](https://github.com/ClickHouse/ClickHouse/pull/72454) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复 `system.merges` 中 `result_part_path` 的格式错误。 [#72567](https://github.com/ClickHouse/ClickHouse/pull/72567) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 修复仅含单个元素的 glob 表达式解析问题。[#72572](https://github.com/ClickHouse/ClickHouse/pull/72572)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* 修复在包含 ARRAY JOIN 的分布式查询场景下，为 follower 服务器生成查询的逻辑问题。修复了 [#69276](https://github.com/ClickHouse/ClickHouse/issues/69276)。[#72608](https://github.com/ClickHouse/ClickHouse/pull/72608)（[Dmitry Novik](https://github.com/novikd)）。
* 修复在 `DateTime64` 中使用 `DateTime64` 时返回空结果的错误。[#72640](https://github.com/ClickHouse/ClickHouse/pull/72640) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 修复在 S3Queue 无序模式下，当 `tracked_files_limit` 设置值小于 S3 文件出现速率时会触发的“No such key”错误。[#72738](https://github.com/ClickHouse/ClickHouse/pull/72738)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 如果 `mark cache` 很大，清空它可能会花费较长时间。如果在此期间一直持有上下文的互斥锁，会阻塞许多其他操作，甚至在锁释放前都无法建立新的客户端连接。而且，为了实现同步其实不需要一直持有这个互斥锁，只要通过 `shared ptr` 持有对该缓存的本地引用就足够了。 [#72749](https://github.com/ClickHouse/ClickHouse/pull/72749) ([Alexander Gololobov](https://github.com/davenger))。
* 在其中一个测试实例上，PK cache 严重低估了自身的大小。具体来说，LowCardinality 列没有将字典的大小计算在内。修复方法是使用 column-&gt;allocatedBytes()，再加上一些对缓存条目大小的额外开销估算。[#72750](https://github.com/ClickHouse/ClickHouse/pull/72750)（[Alexander Gololobov](https://github.com/davenger)）。
* 修复在本地不存在该用户时 `RemoteQueryExecutor` 抛出的异常。[#72759](https://github.com/ClickHouse/ClickHouse/pull/72759)（[Andrey Zvonov](https://github.com/zvonand)）。
* 修复了在启用 `enable_block_number_column` 设置时，对物化 `_block_number` 列执行的变更操作的问题。 [#72854](https://github.com/ClickHouse/ClickHouse/pull/72854) ([Anton Popov](https://github.com/CurtizJ)).
* 修复在备份中存在空文件时使用普通可重写磁盘进行备份/恢复的问题。 [#72858](https://github.com/ClickHouse/ClickHouse/pull/72858) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 在 DistributedAsyncInsertDirectoryQueue 中正确取消写入操作。[#72885](https://github.com/ClickHouse/ClickHouse/pull/72885) ([Antonio Andelic](https://github.com/antonio2368)).
* 修复了在将不正确的数据解析为稀疏列时可能导致的崩溃问题（在启用设置 `enable_parsing_to_custom_serialization` 时可能发生）。 [#72891](https://github.com/ClickHouse/ClickHouse/pull/72891) ([Anton Popov](https://github.com/CurtizJ)).
* 修复在恢复备份时可能发生的崩溃。[#72947](https://github.com/ClickHouse/ClickHouse/pull/72947) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复了 `parallel_hash` JOIN 方法中的一个错误，该错误可能会在查询的 `ON` 子句中包含不等式过滤的复杂条件时出现。 [#72993](https://github.com/ClickHouse/ClickHouse/pull/72993) ([Nikita Taranov](https://github.com/nickitat)).
* 在 JSON 解析过程中使用默认格式设置，以避免反序列化出错。[#73043](https://github.com/ClickHouse/ClickHouse/pull/73043) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复在事务中使用不受支持的存储时发生崩溃的问题。[#73045](https://github.com/ClickHouse/ClickHouse/pull/73045) ([Raúl Marín](https://github.com/Algunenano)).
* 在解析 `Tuple` 时检查是否存在重复的 JSON 键。此前，这可能在解析过程中导致逻辑错误 `Invalid number of rows in Chunk`。[#73082](https://github.com/ClickHouse/ClickHouse/pull/73082) ([Pavel Kruglov](https://github.com/Avogar))。
