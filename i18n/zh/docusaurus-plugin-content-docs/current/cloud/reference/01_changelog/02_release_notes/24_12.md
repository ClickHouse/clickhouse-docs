---
slug: /changelogs/24.12
title: 'v24.12 Cloud 版本更新日志'
description: 'v24.12 版本的快速更新日志'
keywords: ['changelog', 'cloud']
sidebar_label: '24.12'
sidebar_position: 4
doc_type: 'changelog'
---

v24.12 版本中与 ClickHouse Cloud 服务相关的变更。



## 向后不兼容的变更 {#backward-incompatible-changes}

- 函数 `greatest` 和 `least` 现在会忽略 NULL 输入值,而之前如果其中一个参数为 NULL 则会返回 NULL。例如,`SELECT greatest(1, 2, NULL)` 现在返回 2。这使得行为与 PostgreSQL 兼容。[#65519](https://github.com/ClickHouse/ClickHouse/pull/65519) ([kevinyhzou](https://github.com/KevinyhZou))。
- 默认情况下不允许在 ORDER BY/GROUP BY/PARTITION BY/PRIMARY KEY 中使用 Variant/Dynamic 类型,因为这可能导致意外结果。[#69731](https://github.com/ClickHouse/ClickHouse/pull/69731) ([Pavel Kruglov](https://github.com/Avogar))。
- 移除系统表 `generate_series` 和 `generateSeries`。它们是在此处被错误添加的:[#59390](https://github.com/ClickHouse/ClickHouse/issues/59390)。[#71091](https://github.com/ClickHouse/ClickHouse/pull/71091) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 移除 `StorageExternalDistributed`。关闭 [#70600](https://github.com/ClickHouse/ClickHouse/issues/70600)。[#71176](https://github.com/ClickHouse/ClickHouse/pull/71176) ([flynn](https://github.com/ucasfl))。
- 服务器配置(users.xml)中的设置现在也会应用于客户端。这对格式设置很有用,例如 `date_time_output_format`。[#71178](https://github.com/ClickHouse/ClickHouse/pull/71178) ([Michael Kolupaev](https://github.com/al13n321))。
- 修复由于 JSON 子列文件中未转义的特殊符号而可能导致的 `No such file or directory` 错误。[#71182](https://github.com/ClickHouse/ClickHouse/pull/71182) ([Pavel Kruglov](https://github.com/Avogar))。
- 表引擎 Kafka、NATS 和 RabbitMQ 现在在 `SOURCES` 层级中拥有各自的授权。需要为使用这些引擎类型创建表的任何非默认数据库用户添加授权。[#71250](https://github.com/ClickHouse/ClickHouse/pull/71250) ([Christoph Wurm](https://github.com/cwurm))。
- 在执行完整的变更查询之前进行检查(包括子查询)。这可以防止意外运行无效查询并累积阻塞有效变更的失效变更。[#71300](https://github.com/ClickHouse/ClickHouse/pull/71300) ([Christoph Wurm](https://github.com/cwurm))。
- 将文件系统缓存设置 `skip_download_if_exceeds_query_cache` 重命名为 `filesystem_cache_skip_download_if_exceeds_per_query_cache_write_limit`。[#71578](https://github.com/ClickHouse/ClickHouse/pull/71578) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 禁止在 min/max 函数中使用 Dynamic/Variant 类型以避免混淆。[#71761](https://github.com/ClickHouse/ClickHouse/pull/71761) ([Pavel Kruglov](https://github.com/Avogar))。
- 移除 `deltaSumTimestamp` 中对 `Enum` 以及 `UInt128` 和 `UInt256` 参数的支持。移除 `deltaSumTimestamp` 第二个("timestamp")参数对 `Int8`、`UInt8`、`Int16` 和 `UInt16` 的支持。[#71790](https://github.com/ClickHouse/ClickHouse/pull/71790) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 当 ClickHouse 用作字典的数据源时,添加了源查询验证。[#72548](https://github.com/ClickHouse/ClickHouse/pull/72548) ([Alexey Katsman](https://github.com/alexkats))。


## 新功能 {#new-features}


* 实现 `SYSTEM LOAD PRIMARY KEY` 命令，用于为指定表的所有 part 加载主键索引，或者在未指定表时为所有表加载主键索引。这将有助于进行基准测试，并在查询执行过程中避免额外延迟。[#66252](https://github.com/ClickHouse/ClickHouse/pull/66252) ([ZAWA&#95;ll](https://github.com/Zawa-ll))。
* 新增语句 `SYSTEM LOAD PRIMARY KEY`，用于加载指定表中所有数据片段的主键索引；如果未指定表，则会为所有表加载主键索引。此功能可用于基准测试，并可避免在查询执行期间出现额外延迟。[#67733](https://github.com/ClickHouse/ClickHouse/pull/67733) ([ZAWA&#95;ll](https://github.com/Zawa-ll)).
* 添加 `CHECK GRANT` 查询，用于检查当前用户/角色是否拥有指定权限，以及对应的表/列是否存在于内存中。[#68885](https://github.com/ClickHouse/ClickHouse/pull/68885) ([Unalian](https://github.com/Unalian))。
* 新增用于定义工作负载和资源管理的 SQL 语法。 [https://clickhouse.com/docs/en/operations/workload-scheduling](https://clickhouse.com/docs/en/operations/workload-scheduling)。 [#69187](https://github.com/ClickHouse/ClickHouse/pull/69187) ([Sergei Trifonov](https://github.com/serxa))。
* [Iceberg 数据存储](https://iceberg.apache.org/spec/#file-system-operations) 格式为用户提供了灵活丰富的表模式修改能力。在此 pull request 中，实现了对 Iceberg 格式表的读取功能，即使列的顺序、列名以及简单类型扩展发生了更改也能正确读取。[#69445](https://github.com/ClickHouse/ClickHouse/pull/69445)（[Daniil Ivanik](https://github.com/divanik)）。
* 允许为每种身份验证方法单独设置过期时间，并从用户实体中移除。 [#70090](https://github.com/ClickHouse/ClickHouse/pull/70090) ([Arthur Passos](https://github.com/arthurpassos)).
* 将查询发起者的外部用户角色推送到集群中的其他节点。当只有发起者可以访问外部身份验证服务（例如 LDAP）时非常有用。[#70332](https://github.com/ClickHouse/ClickHouse/pull/70332)（[Andrey Zvonov](https://github.com/zvonand)）。
* 支持通过 ALTER 将 String 修改为 JSON。此 PR 还将 JSON 和 Dynamic 类型的序列化升级为新版本 V2。旧版本 V1 仍可通过启用设置 `merge_tree_use_v1_object_and_dynamic_serialization` 来使用（可在升级过程中启用，以便在不出问题的情况下回滚版本）。 [#70442](https://github.com/ClickHouse/ClickHouse/pull/70442) ([Pavel Kruglov](https://github.com/Avogar)).
* 新增函数 `toUnixTimestamp64Second`，用于将 `DateTime64` 转换为具有固定秒级精度的 `Int64` 类型值，从而在日期早于 1970 年 1 月 1 日星期四 00:00:00 UTC 时支持返回负值。 [#70597](https://github.com/ClickHouse/ClickHouse/pull/70597) ([zhanglistar](https://github.com/zhanglistar)).
* 新增设置项 `enforce_index_structure_match_on_partition_manipulation`，以便在源表的投影和二级索引是目标表中相应集合的子集时允许执行 ATTACH 操作。关闭 [#70602](https://github.com/ClickHouse/ClickHouse/issues/70602)。[#70603](https://github.com/ClickHouse/ClickHouse/pull/70603)（[zwy991114](https://github.com/zwy991114)）。
* 函数 `cast` 的输出与 Apache Spark 存在差异，这在 gluten 项目中导致结果不一致，参见 [https://github.com/apache/incubator-gluten/issues/7602](https://github.com/apache/incubator-gluten/issues/7602)。该 PR 新增了 Spark 文本输出格式支持，默认关闭。[#70957](https://github.com/ClickHouse/ClickHouse/pull/70957) ([zhanglistar](https://github.com/zhanglistar))。
* 为 S3 端点的用户认证新增了一种新的 header 类型（`access_header`）。这使得可以以最低优先级指定某个访问 header，并在来自其他任何来源（例如表结构或命名集合）的 `access_key_id` 存在时由其覆盖。[#71011](https://github.com/ClickHouse/ClickHouse/pull/71011) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。
* 初步实现了设置分层功能。 [#71145](https://github.com/ClickHouse/ClickHouse/pull/71145) ([Raúl Marín](https://github.com/Algunenano)).
* 为带有 `FILL` 运算符的 `ORDER BY` 添加对 staleness 子句的支持。[#71151](https://github.com/ClickHouse/ClickHouse/pull/71151) ([Mikhail Artemenko](https://github.com/Michicosun))。
* 通过对 JSON 字符串进行序列化/反序列化，实现从 Map/Tuple/Object 到新的 JSON 类型的简单 CAST。 [#71320](https://github.com/ClickHouse/ClickHouse/pull/71320) ([Pavel Kruglov](https://github.com/Avogar))。
* 为聚合函数 `any` 添加了别名 `anyRespectNulls`、`firstValueRespectNulls` 和 `anyValueRespectNulls`。同时为聚合函数 `anyLast` 添加了别名 `anyLastRespectNulls` 和 `lastValueRespectNulls`。这样可以使用更自然的纯驼峰命名语法，而不是混合使用驼峰命名和下划线的语法。例如：可以使用 `SELECT anyLastRespectNullsStateIf`，而不是 `anyLast_respect_nullsStateIf`。[#71403](https://github.com/ClickHouse/ClickHouse/pull/71403)（[Peter Nguyen](https://github.com/petern48)）。
* 添加了配置参数 `date_time_utc`，使 JSON 日志格式支持使用 RFC 3339/ISO8601 格式的 UTC 日期时间。 [#71560](https://github.com/ClickHouse/ClickHouse/pull/71560) ([Ali](https://github.com/xogoodnow))。
* 在查询计划中新增了一个选项，用于指定在 `JOIN` 中哪一侧作为内部（构建）表。该行为由 `query_plan_join_swap_table` 控制，可以将其设为 `auto`。在此模式下，ClickHouse 会尝试选择行数最少的表。[#71577](https://github.com/ClickHouse/ClickHouse/pull/71577)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 如果某个part的索引粒度是固定的，则优化了其索引粒度值的内存使用。新增了设置 `use_const_adaptive_granularity`，可以始终为part选择固定粒度，从而确保其内存使用始终得到优化。在大规模负载（共享存储中含有数万亿行）下，这有助于避免因数据part的元数据（索引粒度值）导致的内存使用持续增长。[#71786](https://github.com/ClickHouse/ClickHouse/pull/71786)（[Anton Popov](https://github.com/CurtizJ)）。
* 将 `allowed_feature_tier` 实现为全局开关，用于禁用所有实验性/测试版功能。[#71841](https://github.com/ClickHouse/ClickHouse/pull/71841) ([Raúl Marín](https://github.com/Algunenano))。
* 新增 `iceberg[S3;HDFS;Azure]Cluster`、`deltaLakeCluster`、`hudiCluster` 表函数。[#72045](https://github.com/ClickHouse/ClickHouse/pull/72045) ([Mikhail Artemenko](https://github.com/Michicosun))。
* 新增语法 `ALTER USER {ADD|MODIFY|DROP SETTING}`、`ALTER USER {ADD|DROP PROFILE}`，`ALTER ROLE` 和 `ALTER PROFILE` 同样支持这些语法。[#72050](https://github.com/ClickHouse/ClickHouse/pull/72050) ([pufit](https://github.com/pufit))。
* 新增了 `arrayPrAUC` 函数，用于计算精确率-召回率曲线的 AUC（曲线下面积）。 [#72073](https://github.com/ClickHouse/ClickHouse/pull/72073) ([Emmanuel](https://github.com/emmanuelsdias))。
* 为 `MergeTree` 表的主索引增加了缓存功能（可通过表设置 `use_primary_key_cache` 启用）。如果主索引同时开启了懒加载和缓存，则会按需将其加载到缓存中（类似于 mark 缓存），而不是始终常驻内存。为数据部分在插入 / 合并 / 拉取操作以及表重启时增加了主索引预热功能（可通过设置 `prewarm_primary_key_cache` 启用)。 [#72102](https://github.com/ClickHouse/ClickHouse/pull/72102) ([Anton Popov](https://github.com/CurtizJ)).
* 为数组类型新增 `indexOfAssumeSorted` 函数。在数组按非递减顺序排序的情况下优化查找性能。 [#72517](https://github.com/ClickHouse/ClickHouse/pull/72517) ([Eric Kurbanov](https://github.com/erickurbanov)).
* 现在支持在聚合函数 `groupConcat` 中使用分隔符作为可选的第二个参数。 [#72540](https://github.com/ClickHouse/ClickHouse/pull/72540) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 新增设置 `http_response_headers`，允许你自定义 HTTP 响应头。比如，你可以让浏览器渲染存储在数据库中的图片。此更改关闭了 [#59620](https://github.com/ClickHouse/ClickHouse/issues/59620)。[#72656](https://github.com/ClickHouse/ClickHouse/pull/72656)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 新增函数 `fromUnixTimestamp64Second`，用于将 Int64 Unix 时间戳值转换为 DateTime64。[#73146](https://github.com/ClickHouse/ClickHouse/pull/73146) ([Robert Schulze](https://github.com/rschu1ze))。





## 性能改进 {#performance-improvements}


* 新增两个设置 `short_circuit_function_evaluation_for_nulls` 和 `short_circuit_function_evaluation_for_nulls_threshold`，当数据块中 NULL 值的比例超过指定阈值时，可以对 `Nullable` 列以短路方式执行函数。也就是说，函数只会在非 NULL 值的行上执行。该机制仅适用于这样一类函数：对于至少一个参数为 NULL 的行返回 NULL 值的函数。 [#60129](https://github.com/ClickHouse/ClickHouse/pull/60129) ([李扬](https://github.com/taiyang-li)).
* 已降低对象存储磁盘上 `clickhouse disks remove --recursive` 的内存占用。[#67323](https://github.com/ClickHouse/ClickHouse/pull/67323) ([Kirill](https://github.com/kirillgarbar))。
* 现在，对于 `join_algorithm='parallel_hash'`，在为并行处理在不同线程之间分发数据时，将不再复制输入数据块的列。[#67782](https://github.com/ClickHouse/ClickHouse/pull/67782) ([Nikita Taranov](https://github.com/nickitat))。
* 为更多类型的表达式启用 JIT 编译：`abs`/`bitCount`/`sign`/`modulo`/`pmod`/`isNull`/`isNotNull`/`assumeNotNull`/`to(U)Int*`/`toFloat*`，比较函数（`=`, `<`, `>`, `>=`, `<=`），逻辑函数（`and`, `or`）。 [#70598](https://github.com/ClickHouse/ClickHouse/pull/70598) ([李扬](https://github.com/taiyang-li)).
* 现在，当 `join_algorithm` 设置为 `default` 时，将使用 `parallel_hash` 算法（如适用）。当 `parallel_hash` 无法使用时，仍会考虑此前的两种备选方案（`direct` 和 `hash`）。[#70788](https://github.com/ClickHouse/ClickHouse/pull/70788) ([Nikita Taranov](https://github.com/nickitat))
* 针对互不相交的数据部分优化了 `Replacing` 合并算法。[#70977](https://github.com/ClickHouse/ClickHouse/pull/70977)（[Anton Popov](https://github.com/CurtizJ)）。
* 不要在 metrics 和 system.detached&#95;parts 中列出只读和一次写入磁盘上的 detached parts。 [#71086](https://github.com/ClickHouse/ClickHouse/pull/71086) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 默认情况下不要计算重量级的异步指标。该功能在 [#40332](https://github.com/ClickHouse/ClickHouse/issues/40332) 中引入，但为了仅服务单个客户而运行开销很大的后台任务并不合适。[#71087](https://github.com/ClickHouse/ClickHouse/pull/71087)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 通过缩小临界区，提高 system.query&#95;metric&#95;log 采集间隔控制的性能和精度。[#71473](https://github.com/ClickHouse/ClickHouse/pull/71473) ([Pablo Marcos](https://github.com/pamarcos))。
* 新增一个选项，用于从 `WHERE` 和 `ON` 表达式中提取公共子表达式，以减少连接过程中使用的哈希表数量。可通过设置 `optimize_extract_common_expressions = 1` 启用。 [#71537](https://github.com/ClickHouse/ClickHouse/pull/71537) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* 允许在包含 `LowCardinality(String)` 的 `SELECT` 查询中使用索引。[#71598](https://github.com/ClickHouse/ClickHouse/pull/71598) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 在使用并行副本且启用了本地执行计划的查询执行过程中，不在 worker 上进行索引分析。协调器将基于自身（查询发起端）执行的索引分析，为各个 worker 选择需要读取的范围。 [#72109](https://github.com/ClickHouse/ClickHouse/pull/72109) ([Igor Nikonov](https://github.com/devcrafter)).
* 恢复从 [https://github.com/ClickHouse/ClickHouse/pull/57631](https://github.com/ClickHouse/ClickHouse/pull/57631) 引入的、用于在 Compact 部分中读取单个列子列的优化。该优化曾被误删。[#72285](https://github.com/ClickHouse/ClickHouse/pull/72285)（[Pavel Kruglov](https://github.com/Avogar)）。
* 通过在比较器中去除虚函数调用，加速对 `LowCardinality(String)` 列的排序。[#72337](https://github.com/ClickHouse/ClickHouse/pull/72337) ([Alexander Gololobov](https://github.com/davenger))。
* 为部分简单数据类型优化 argMin/argMax 函数。 [#72350](https://github.com/ClickHouse/ClickHouse/pull/72350) ([alesapin](https://github.com/alesapin)).
* 使用共享锁优化内存跟踪器中的锁机制，以减少锁竞争。[#72375](https://github.com/ClickHouse/ClickHouse/pull/72375)（[Jiebin Sun](https://github.com/jiebinn)）。
* 新增一个设置 `use_async_executor_for_materialized_views`。对物化视图查询使用异步执行（并可能启用多线程），可以加快 INSERT 期间视图的处理速度，但也会消耗更多内存。 [#72497](https://github.com/ClickHouse/ClickHouse/pull/72497) ([alesapin](https://github.com/alesapin)).
* 设置 `max_size_to_preallocate_for_aggregation` 和 `max_size_to_preallocate_for_joins` 的默认值进一步提升至 `10^12`，因此该优化将在更多场景下生效。 [#72555](https://github.com/ClickHouse/ClickHouse/pull/72555) ([Nikita Taranov](https://github.com/nickitat)).
* 改进了聚合函数状态在 `AggregateFunction` 数据类型以及分布式查询中的反序列化性能。略微提升了 `RowBinary` 格式的解析性能。 [#72818](https://github.com/ClickHouse/ClickHouse/pull/72818) ([Anton Popov](https://github.com/CurtizJ)).





## 改进 {#improvement}


* 当高阶函数使用常量数组和常量捕获参数时，将返回常量。[#58400](https://github.com/ClickHouse/ClickHouse/pull/58400)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 通过生成虚拟行实现顺序读取优化，从而在归并排序期间减少读取的数据量，在存在多个数据片段（part）时尤其有用。 [#62125](https://github.com/ClickHouse/ClickHouse/pull/62125) ([Shichao Jin](https://github.com/jsc0218)).
* 查询计划步骤名称（`EXPLAIN PLAN json=1`）和流水线处理器名称（`EXPLAIN PIPELINE compact=0,graph=1`）现在都在后缀中带有唯一 ID。这样就可以将处理器分析器的输出和 OpenTelemetry 跟踪与 EXPLAIN 的输出进行对应匹配。[#63518](https://github.com/ClickHouse/ClickHouse/pull/63518) ([qhsong](https://github.com/qhsong))。
* 新增了一个选项，用于在写入 Azure Blob Storage 之后检查对象是否存在，可通过设置 `check_objects_after_upload` 来控制。[#64847](https://github.com/ClickHouse/ClickHouse/pull/64847) ([Smita Kulkarni](https://github.com/SmitaRKulkarni))。
* 修复 HashTable destroyElements 中的 use-after-dtor 逻辑问题。[#65279](https://github.com/ClickHouse/ClickHouse/pull/65279)（[cangyin](https://github.com/cangyin)）。
* 在 `clickhouse-local` 中默认使用 `Atomic` 数据库。解决了 [#50647](https://github.com/ClickHouse/ClickHouse/issues/50647) 中的第 1 项和第 5 项问题。关闭了 [#44817](https://github.com/ClickHouse/ClickHouse/issues/44817)。[#68024](https://github.com/ClickHouse/ClickHouse/pull/68024)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 写入缓冲区必须显式地取消或结束。异常会中断 HTTP 协议的正常流程，以便向客户端告知错误。[#68800](https://github.com/ClickHouse/ClickHouse/pull/68800)（[Sema Checherinda](https://github.com/CheSema)）。
* 通过在 DDLWorker 中创建 replica&#95;dir 并将副本标记为活动状态，报告运行 DDLWorker 的主机。 [#69658](https://github.com/ClickHouse/ClickHouse/pull/69658) ([Tuan Pham Anh](https://github.com/tuanpach)).
* 1. 重构 `DDLQueryStatusSource`：- 将 `DDLQueryStatusSource` 重命名为 `DistributedQueryStatusSource`，并将其作为基类 - 创建两个子类 `DDLOnClusterQueryStatusSource` 和 `ReplicatedDatabaseQueryStatusSource`，从 `DDLQueryStatusSource` 继承，用于分别从 `DDL ON CLUSTER` 和复制数据库中查询 DDL 任务的状态。2. 在 `DDLOnClusterQueryStatusSource` 中支持停止等待离线主机。[#69660](https://github.com/ClickHouse/ClickHouse/pull/69660) ([Tuan Pham Anh](https://github.com/tuanpach))。
* 新增了一种取消逻辑：`CancellationChecker` 会为每个已启动的查询检查超时时间，并在达到超时时停止它们。 [#69880](https://github.com/ClickHouse/ClickHouse/pull/69880) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 移除 `allow_experimental_join_condition` 设置，默认允许非等值条件。[#69910](https://github.com/ClickHouse/ClickHouse/pull/69910)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 默认启用 `parallel_replicas_local_plan`。在查询发起节点构建完整的本地执行计划，可在消耗更少资源的情况下提升并行副本的性能，并为应用更多查询优化提供空间。[#70171](https://github.com/ClickHouse/ClickHouse/pull/70171) ([Igor Nikonov](https://github.com/devcrafter))。
* 在 `http_handlers` 中新增设置用户名/密码的功能（适用于 `dynamic_query_handler`/`predefined_query_handler`）。 [#70725](https://github.com/ClickHouse/ClickHouse/pull/70725) ([Azat Khuzhin](https://github.com/azat)).
* 在 S3Queue 存储中支持对某些设置执行 `ALTER TABLE ... MODIFY/RESET SETTING ...` 操作。[#70811](https://github.com/ClickHouse/ClickHouse/pull/70811) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 列出目录时不要调用对象存储 API，因为这可能会导致成本效率低下。相反，应将文件名列表存储在内存中。这样做的权衡是初始加载时间会增加，并且需要更多内存来存储文件名。[#70823](https://github.com/ClickHouse/ClickHouse/pull/70823)（[Julia Kartseva](https://github.com/jkartseva)）。
* 为 `clickhouse-compressor` 添加 `--threads` 参数，用于并行压缩数据。[#70860](https://github.com/ClickHouse/ClickHouse/pull/70860) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 使 Replxx 客户端历史记录容量可配置。[#71014](https://github.com/ClickHouse/ClickHouse/pull/71014) ([Jiří Kozlovský](https://github.com/jirislav))。
* 新增了 `prewarm_mark_cache` 设置，可在插入、合并、拉取数据分片以及表启动时，将标记加载到标记缓存中。[#71053](https://github.com/ClickHouse/ClickHouse/pull/71053) ([Anton Popov](https://github.com/CurtizJ))。
* 为 Parquet 原生读取器添加对布尔类型的支持。 [#71055](https://github.com/ClickHouse/ClickHouse/pull/71055) ([Arthur Passos](https://github.com/arthurpassos))。
* 在与 S3 交互时对更多错误进行重试，例如 “Malformed message”。 [#71088](https://github.com/ClickHouse/ClickHouse/pull/71088) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 将部分与 S3 相关的消息的日志级别下调。 [#71090](https://github.com/ClickHouse/ClickHouse/pull/71090) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 支持向名称包含空格的 HDFS 文件写入数据。 [#71105](https://github.com/ClickHouse/ClickHouse/pull/71105) ([exmy](https://github.com/exmy)).
* `system.session_log` 已经相当不错了。本次更改关闭了 [#51760](https://github.com/ClickHouse/ClickHouse/issues/51760)。[#71150](https://github.com/ClickHouse/ClickHouse/pull/71150)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复了在使用并行副本的查询中执行 RIGHT/FULL 联接的问题。现在，RIGHT 联接可以在并行副本上执行（右表的读取会分布到各个副本）。FULL 联接无法在节点之间并行化，只能在本地执行。[#71162](https://github.com/ClickHouse/ClickHouse/pull/71162)（[Igor Nikonov](https://github.com/devcrafter)）。
* 添加了限制复制表、字典和视图数量的设置。[#71179](https://github.com/ClickHouse/ClickHouse/pull/71179) ([Kirill](https://github.com/kirillgarbar))。
* 修复 [#71227](https://github.com/ClickHouse/ClickHouse/issues/71227)。[#71286](https://github.com/ClickHouse/ClickHouse/pull/71286)（[Arthur Passos](https://github.com/arthurpassos)）。
* 根据服务器/用户内存使用情况，自动将`GROUP BY`/`ORDER BY`切换为基于磁盘的执行。可通过查询设置 `max_bytes_ratio_before_external_group_by`/`max_bytes_ratio_before_external_sort` 进行控制。[#71406](https://github.com/ClickHouse/ClickHouse/pull/71406)（[Azat Khuzhin](https://github.com/azat)）。
* 将按主机划分的 `Overview (host)` 和 `Cloud overview (host)` 仪表板添加到高级仪表板中。[#71422](https://github.com/ClickHouse/ClickHouse/pull/71422) ([alesapin](https://github.com/alesapin))。
* 函数 `translate` 现在在 `from` 参数所含字符多于 `to` 参数时支持删除多余字符。示例：`SELECT translate('clickhouse', 'clickhouse', 'CLICK')` 现在返回 `CLICK`。[#71441](https://github.com/ClickHouse/ClickHouse/pull/71441) ([shuai.xu](https://github.com/shuai-xu))。
* 新增了 `parseDateTime64`、`parseDateTime64OrNull` 和 `parseDateTime64OrZero` 三个函数。与现有函数 `parseDateTime`（及其变体）相比，它们返回的值类型为 `DateTime64` 而不是 `DateTime`。[#71581](https://github.com/ClickHouse/ClickHouse/pull/71581) ([kevinyhzou](https://github.com/KevinyhZou))。
* 将内存中的 index&#95;granularity 数组收缩至合适大小，从而减少 MergeTree 系列表引擎的内存占用。 [#71595](https://github.com/ClickHouse/ClickHouse/pull/71595) ([alesapin](https://github.com/alesapin)).
* 命令行应用程序会对语法进行高亮显示，即使是多条语句也可以。 [#71622](https://github.com/ClickHouse/ClickHouse/pull/71622) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 命令行应用程序在发生错误时会返回非零退出码。在之前的版本中，`disks` 应用在出错时会返回 0，而其他应用在错误 256（`PARTITION_ALREADY_EXISTS`）和 512（`SET_NON_GRANTED_ROLE`）时也会返回 0。[#71623](https://github.com/ClickHouse/ClickHouse/pull/71623)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `Vertical` 格式（当查询以 `\G` 结束时也会启用）继承了 Pretty 格式的一些特性，例如：- 以高亮方式显示按千位分组的数字；- 输出更易读的数字提示信息。 [#71630](https://github.com/ClickHouse/ClickHouse/pull/71630) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 允许通过设置 `filesystem_cache_prefer_bigger_buffer_size` 来禁止增大用于文件系统缓存的内存缓冲区。 [#71640](https://github.com/ClickHouse/ClickHouse/pull/71640) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 在文件系统缓存中为后台下载的最大文件段大小新增单独的配置项 `background_download_max_file_segment_size`。 [#71648](https://github.com/ClickHouse/ClickHouse/pull/71648) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 将 `enable_http_compression` 的默认值从 0 修改为 1。修复 [#71591](https://github.com/ClickHouse/ClickHouse/issues/71591)。[#71774](https://github.com/ClickHouse/ClickHouse/pull/71774)（[Peter Nguyen](https://github.com/petern48)）。
* 支持使用 ALTER 将 Object 转换为 JSON。[#71784](https://github.com/ClickHouse/ClickHouse/pull/71784) ([Pavel Kruglov](https://github.com/Avogar)).
* 略微改进 JSON 类型解析：如果 JSON 路径对应的当前数据块中包含多种类型的值，则按照特定的最佳尝试顺序依次尝试不同类型，从中选择最合适的类型。 [#71785](https://github.com/ClickHouse/ClickHouse/pull/71785) ([Pavel Kruglov](https://github.com/Avogar))。
* 之前，从 `system.asynchronous_metrics` 读取数据会等待并发更新完成。如果系统处于高负载状态，这可能会花费较长时间。此更改之后，可以随时读取之前已收集的值。[#71798](https://github.com/ClickHouse/ClickHouse/pull/71798)（[Alexander Gololobov](https://github.com/davenger)）。
* 将 `polling_max_timeout_ms` 设置为 10 分钟，将 `polling_backoff_ms` 设置为 30 秒。 [#71817](https://github.com/ClickHouse/ClickHouse/pull/71817)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 像 &#39;SELECT - FROM t LIMIT 1&#39; 这样的查询以前会加载分片索引，尽管实际上并未使用它们。[#71866](https://github.com/ClickHouse/ClickHouse/pull/71866) ([Alexander Gololobov](https://github.com/davenger))。
* 在旧版兼容性设置下，Allow&#95;reorder&#95;prewhere&#95;conditions 默认启用。[#71867](https://github.com/ClickHouse/ClickHouse/pull/71867)（[Raúl Marín](https://github.com/Algunenano)）。
* 在使用 `bitmapTransform` 函数且参数类型有效时，不再递增 `system.errors` 表中的 `ILLEGAL_TYPE_OF_ARGUMENT` 计数器。 [#71971](https://github.com/ClickHouse/ClickHouse/pull/71971) ([Dmitry Novik](https://github.com/novikd)).
* 当通过 Dictionary 存储、dictionary 表函数，或直接对字典本身执行 SELECT 来从字典检索数据时，现在只需对该字典拥有 `SELECT` 权限或 `dictGet` 权限即可。该变更与之前为防止 ACL 绕过所做的尝试保持一致：[https://github.com/ClickHouse/ClickHouse/pull/57362](https://github.com/ClickHouse/ClickHouse/pull/57362) 和 [https://github.com/ClickHouse/ClickHouse/pull/65359](https://github.com/ClickHouse/ClickHouse/pull/65359)，并同时确保了后一项变更的向后兼容性。[#72051](https://github.com/ClickHouse/ClickHouse/pull/72051)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 在高级仪表板 HTML 页面中新增了一个用于选择 `system.dashboards` 表中仪表板的下拉菜单。[#72081](https://github.com/ClickHouse/ClickHouse/pull/72081)（[Sergei Trifonov](https://github.com/serxa)）。
* 在为分布式 `INSERT ... SELECT` 构建计划时遵循 `prefer_locahost_replica` 设置。 [#72190](https://github.com/ClickHouse/ClickHouse/pull/72190) ([filimonov](https://github.com/filimonov)).
* 该问题已在[此处描述](https://github.com/ClickHouse/ClickHouse/issues/72091)。Azure Iceberg Writer 创建的 Iceberg 元数据文件（以及 manifest 文件）违反了规格。在此 PR 中，我增加了使用 v2 reader 读取 v1 Iceberg 格式元数据的尝试（因为它就是以这种方式写入的），并在其未在 manifest 文件中创建对应字段时抛出错误。[#72277](https://github.com/ClickHouse/ClickHouse/pull/72277)（[Daniil Ivanik](https://github.com/divanik)）。
* 将 JSON/Dynamic/Variant 类型从实验特性升级到 beta 阶段。[#72294](https://github.com/ClickHouse/ClickHouse/pull/72294) ([Pavel Kruglov](https://github.com/Avogar))。
* 现在允许在查询中使用带有 `UNION [ALL]` 的 `CREATE MATERIALIZED VIEW`。其行为与使用 `JOIN` 的物化视图相同：**只有 `SELECT` 表达式中的第一张表会作为插入操作的触发器*，所有其他表都会被忽略。[#72347](https://github.com/ClickHouse/ClickHouse/pull/72347) ([alesapin](https://github.com/alesapin))。
* 在插入批次的所有行具有相同分区键值的情况下，加速向 MergeTree 的插入操作。 [#72348](https://github.com/ClickHouse/ClickHouse/pull/72348) ([alesapin](https://github.com/alesapin))。
* 将新的 MergeTreeIndexGranularityInternalArraysTotalSize 指标添加到 system.metrics 中。该指标用于定位数据集规模巨大的实例，这类实例容易出现高内存占用问题。[#72490](https://github.com/ClickHouse/ClickHouse/pull/72490) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
* 当查询使用 `Format Null` 时，现在会识别单词 `Null` 的所有大小写形式。此前，其他形式（例如 `NULL`）虽然不会抛出异常，但在这些情况下实际上并未真正使用 `Null` 格式。[#72658](https://github.com/ClickHouse/ClickHouse/pull/72658)（[Nikita Taranov](https://github.com/nickitat)）。
* 允许集合中包含不在 Enum 中的未知值。修复 [#72662](https://github.com/ClickHouse/ClickHouse/issues/72662)。[#72686](https://github.com/ClickHouse/ClickHouse/pull/72686) ([zhanglistar](https://github.com/zhanglistar))。
* 在 system.tables 表中新增 total&#95;bytes&#95;with&#95;inactive 列，用于统计非活动数据部分的总字节数。[#72690](https://github.com/ClickHouse/ClickHouse/pull/72690) ([Kai Zhu](https://github.com/nauu))。
* 将 MergeTreeSettings 添加到 system.settings&#95;changes。 [#72694](https://github.com/ClickHouse/ClickHouse/pull/72694) ([Raúl Marín](https://github.com/Algunenano)).
* 为 Enum 数据类型增加对字符串搜索运算符（如 LIKE）的支持，修复 [#72661](https://github.com/ClickHouse/ClickHouse/issues/72661)。[#72732](https://github.com/ClickHouse/ClickHouse/pull/72732)（[zhanglistar](https://github.com/zhanglistar)）。
* 在 `notEmpty` 函数中增加对 `JSON` 类型的支持。 [#72741](https://github.com/ClickHouse/ClickHouse/pull/72741) ([Pavel Kruglov](https://github.com/Avogar))。
* 支持解析 GCS S3 返回的 `AuthenticationRequired` 错误。 [#72753](https://github.com/ClickHouse/ClickHouse/pull/72753) ([Vitaly Baranov](https://github.com/vitlibar)).
* 在 ifNull 和 coalesce 函数中支持 Dynamic 类型。 [#72772](https://github.com/ClickHouse/ClickHouse/pull/72772) ([Pavel Kruglov](https://github.com/Avogar)).
* 新增 `JoinBuildTableRowCount/JoinProbeTableRowCount/JoinResultRowCount` profile 事件。 [#72842](https://github.com/ClickHouse/ClickHouse/pull/72842) ([Vladimir Cherkasov](https://github.com/vdimir))。
* 为函数 toFloat64/toUInt32 等添加对 Dynamic 的支持。 [#72989](https://github.com/ClickHouse/ClickHouse/pull/72989) ([Pavel Kruglov](https://github.com/Avogar))。





## 错误修复（官方稳定版本中用户可见的异常行为）{#bug-fix}


* 在执行 `ATTACH PART` 查询时去重的数据分片不再会一直处于带有 `attaching_` 前缀的状态。 [#65636](https://github.com/ClickHouse/ClickHouse/pull/65636) ([Kirill](https://github.com/kirillgarbar)).
* 修复了在 `IN` 函数中使用 `DateTime64` 类型时出现的精度丢失问题。[#67230](https://github.com/ClickHouse/ClickHouse/pull/67230)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 修复在 `ORDER BY ... WITH FILL` 子句中使用带有 `IGNORE/RESPECT NULLS` 的函数时可能出现的逻辑错误，关闭 [#57609](https://github.com/ClickHouse/ClickHouse/issues/57609)。[#68234](https://github.com/ClickHouse/ClickHouse/pull/68234)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 修复了在使用 `Native` 格式进行异步插入且达到内存限制时可能出现的罕见逻辑错误。 [#68965](https://github.com/ClickHouse/ClickHouse/pull/68965) ([Anton Popov](https://github.com/CurtizJ)).
* 修复 `CREATE TABLE` 语句中 EPHEMERAL 列的 `COMMENT`。 [#70458](https://github.com/ClickHouse/ClickHouse/pull/70458) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 修复 `JSONExtract` 在配合 LowCardinality(Nullable) 使用时的逻辑错误。[#70549](https://github.com/ClickHouse/ClickHouse/pull/70549)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复了表名过长时的处理行为。[#70810](https://github.com/ClickHouse/ClickHouse/pull/70810)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 在 URL 引擎中新增支持，允许通过用户自定义请求头覆盖 Content-Type。 [#70859](https://github.com/ClickHouse/ClickHouse/pull/70859) ([Artem Iurin](https://github.com/ortyomka)).
* 修复 `StorageS3Queue` 中出现的逻辑错误：“Cannot create a persistent node in /processed since it already exists”。[#70984](https://github.com/ClickHouse/ClickHouse/pull/70984)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 修复了在投影的轻量级删除重建选项中未考虑 &#95;row&#95;exists 列的错误。[#71089](https://github.com/ClickHouse/ClickHouse/pull/71089) ([Shichao Jin](https://github.com/jsc0218))。
* 修复由于意外竞态条件导致 `system.query_metric_log` 中出现错误值的问题。 [#71124](https://github.com/ClickHouse/ClickHouse/pull/71124) ([Pablo Marcos](https://github.com/pamarcos)).
* 修复聚合函数 `quantileExactWeightedInterpolated` 的名称不一致问题。该缺陷是在 [https://github.com/ClickHouse/ClickHouse/pull/69619](https://github.com/ClickHouse/ClickHouse/pull/69619) 中引入的。cc @Algunenano。[#71168](https://github.com/ClickHouse/ClickHouse/pull/71168)（[李扬](https://github.com/taiyang-li)）。
* 修复在函数比较中使用 Dynamic 时可能出现的 bad&#95;weak&#95;ptr 异常。[#71183](https://github.com/ClickHouse/ClickHouse/pull/71183)（[Pavel Kruglov](https://github.com/Avogar)）。
* 在使用零拷贝复制的 ReplicatedMergeTree 中，当仍有节点在使用某个 blob 时，不要删除该 blob。 [#71186](https://github.com/ClickHouse/ClickHouse/pull/71186) ([Antonio Andelic](https://github.com/antonio2368)).
* 修复通过 HTTP 和异步插入（Async Inserts）使用 Native 格式时忽略格式设置的问题。[#71193](https://github.com/ClickHouse/ClickHouse/pull/71193) ([Pavel Kruglov](https://github.com/Avogar)).
* 将设置 `use_query_cache = 1` 的 SELECT 查询在系统表名称以字面量形式出现时将不再被拒绝，例如 `SELECT - FROM users WHERE name = 'system.metrics' SETTINGS use_query_cache = true;` 现在可以正常运行。[#71254](https://github.com/ClickHouse/ClickHouse/pull/71254)（[Robert Schulze](https://github.com/rschu1ze)）。
* 修复在启用 `enable_filesystem_cache=1` 且存储配置中的磁盘未配置任何缓存时，会导致内存使用量增加的问题。[#71261](https://github.com/ClickHouse/ClickHouse/pull/71261) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 修复从 Dynamic 列反序列化 LowCardinality 字典时可能发生的 &quot;Cannot read all data&quot; 错误。 [#71299](https://github.com/ClickHouse/ClickHouse/pull/71299) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复客户端中并行输出格式清理不彻底的问题。[#71304](https://github.com/ClickHouse/ClickHouse/pull/71304) ([Raúl Marín](https://github.com/Algunenano))。
* 补充了命名集合中遗漏的反转义处理。若没有该修复，clickhouse-server 将无法启动。 [#71308](https://github.com/ClickHouse/ClickHouse/pull/71308) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* 通过原生协议修复异步插入空数据块的问题。[#71312](https://github.com/ClickHouse/ClickHouse/pull/71312) ([Anton Popov](https://github.com/CurtizJ))。
* 修复在授予错误的通配符权限时 AST 格式不一致的问题 [#71309](https://github.com/ClickHouse/ClickHouse/issues/71309)。 [#71332](https://github.com/ClickHouse/ClickHouse/pull/71332) ([pufit](https://github.com/pufit)).
* 检查 JSON 类型提示中的可疑和试验性类型。[#71369](https://github.com/ClickHouse/ClickHouse/pull/71369) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复在包含 Variant 列的 Chunk 中出现的 “Invalid number of rows in Chunk” 错误。[#71388](https://github.com/ClickHouse/ClickHouse/pull/71388) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复在向 `mongodb` 表函数传递错误参数（例如 `NULL`）时出现的崩溃问题。 [#71426](https://github.com/ClickHouse/ClickHouse/pull/71426) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 修复在启用 optimize&#95;rewrite&#95;array&#95;exists&#95;to&#95;has 时发生的崩溃。 [#71432](https://github.com/ClickHouse/ClickHouse/pull/71432) ([Raúl Marín](https://github.com/Algunenano)).
* 修复在 palin&#95;rewritable 磁盘上创建目录失败时，事务回滚期间出现 NoSuchKey 错误的问题。[#71439](https://github.com/ClickHouse/ClickHouse/pull/71439) ([Julia Kartseva](https://github.com/jkartseva))。
* 修复了在插入操作中对配置项 `max_insert_delayed_streams_for_parallel_write` 的使用。此前该配置项行为不正确，可能导致在向多个分区写入数据的插入操作中出现高内存占用。[#71474](https://github.com/ClickHouse/ClickHouse/pull/71474) ([Anton Popov](https://github.com/CurtizJ)).
* 修复在允许在 `WHERE` 条件中使用 arrayJoin 的情况下，旧分析器中可能出现的错误 `Argument for function must be constant`。该问题是合并请求 [https://github.com/ClickHouse/ClickHouse/pull/65414](https://github.com/ClickHouse/ClickHouse/pull/65414) 引入的回归。[#71476](https://github.com/ClickHouse/ClickHouse/pull/71476)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 避免在列数为 0 时 SortCursor 崩溃（旧分析器）。 [#71494](https://github.com/ClickHouse/ClickHouse/pull/71494) ([Raúl Marín](https://github.com/Algunenano)).
* 修复由未初始化的 ORC 数据导致的 date32 越界问题。更多详细信息请参阅 [https://github.com/apache/incubator-gluten/issues/7823](https://github.com/apache/incubator-gluten/issues/7823)。[#71500](https://github.com/ClickHouse/ClickHouse/pull/71500)（[李扬](https://github.com/taiyang-li)）。
* 修复在宽格式 part 中统计 Dynamic 和 JSON 类型列大小的问题。 [#71526](https://github.com/ClickHouse/ClickHouse/pull/71526) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复当物化视图中的查询在 CTE 中使用 `IN` 时 Analyzer 出现的问题。关闭 [#65598](https://github.com/ClickHouse/ClickHouse/issues/65598)。[#71538](https://github.com/ClickHouse/ClickHouse/pull/71538)（[Maksim Kita](https://github.com/kitaisreal)）。
* 当发生越界时，`bitShift` 函数返回 0 或默认字符，而不是抛出错误。[#71580](https://github.com/ClickHouse/ClickHouse/pull/71580) ([Pablo Marcos](https://github.com/pamarcos))。
* 修复在使用某些引擎的物化视图时导致服务器崩溃的问题。[#71593](https://github.com/ClickHouse/ClickHouse/pull/71593) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* 对包含指向常量数组的别名的嵌套数据结构执行 array join 时，可能导致空指针解引用。此问题修复了 [#71677](https://github.com/ClickHouse/ClickHouse/issues/71677)。[#71678](https://github.com/ClickHouse/ClickHouse/pull/71678)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复在对空元组执行 ALTER 时出现的 LOGICAL&#95;ERROR。此修复解决了 [#71647](https://github.com/ClickHouse/ClickHouse/issues/71647)。[#71679](https://github.com/ClickHouse/ClickHouse/pull/71679)（[Amos Bird](https://github.com/amosbird)）。
* 在分区列上使用 NOT IN 谓词时，不要转换其中的常量集。 [#71695](https://github.com/ClickHouse/ClickHouse/pull/71695) ([Eduard Karacharov](https://github.com/korowa)).
* 修复从 LowCardinality(Nullable) 向 Dynamic 进行 CAST 的问题。此前这可能会导致错误 `Bad cast from type DB::ColumnVector<int> to DB::ColumnNullable`。[#71742](https://github.com/ClickHouse/ClickHouse/pull/71742) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在 `WHERE` 条件中对 `DateTime64` 类型主键使用 `toDayOfWeek` 时出现的异常。[#71849](https://github.com/ClickHouse/ClickHouse/pull/71849)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* 修复了在解析为稀疏列后默认值的填充行为。 [#71854](https://github.com/ClickHouse/ClickHouse/pull/71854) ([Anton Popov](https://github.com/CurtizJ)).
* 修复在分布式表上，当输入为 ALIAS 列时 `GROUPING` 函数报错的问题，关闭 [#68602](https://github.com/ClickHouse/ClickHouse/issues/68602)。[#71855](https://github.com/ClickHouse/ClickHouse/pull/71855)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* 修复了使用 `WITH TIES` 子句时可能返回行数不足的 SELECT 语句问题。 [#71886](https://github.com/ClickHouse/ClickHouse/pull/71886) ([wxybear](https://github.com/wxybear)).
* 修复在 `arrayWithConstant` 求值过程中，由于某列被误判为超出数组大小限制而触发的 `TOO_LARGE_ARRAY_SIZE` 异常。[#71894](https://github.com/ClickHouse/ClickHouse/pull/71894) ([Udi](https://github.com/udiz))。
* `clickhouse-benchmark` 在查询耗时超过一秒时会报告错误的指标。[#71898](https://github.com/ClickHouse/ClickHouse/pull/71898) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 修复 clickhouse-client 中进度指示器与进度表之间的数据竞争问题。当使用 FROM INFILE 时可以观察到该问题。在执行 INSERT 查询期间拦截按键输入，以切换进度表显示。[#71901](https://github.com/ClickHouse/ClickHouse/pull/71901)（[Julia Kartseva](https://github.com/jkartseva)）。
* 修复在 Pretty JSON 格式中 Dynamic 类型值的序列化。[#71923](https://github.com/ClickHouse/ClickHouse/pull/71923) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复在 24.6 中出现异常的 system.s3/azure&#95;queue&#95;log 表的 rows&#95;processed 列。关闭 [#69975](https://github.com/ClickHouse/ClickHouse/issues/69975)。[#71946](https://github.com/ClickHouse/ClickHouse/pull/71946)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 修复了 `s3`/`s3Cluster` 函数可能返回不完整结果或抛出异常的问题。该问题涉及在 S3 URI 中使用 glob 模式（如 `pattern/*`），并且要求存在一个键为 `pattern/` 的空对象（此类对象会由 S3 Console 自动创建）。同时，将设置项 `s3_skip_empty_files` 的默认值从 `false` 改为 `true`。 [#71947](https://github.com/ClickHouse/ClickHouse/pull/71947) ([Nikita Taranov](https://github.com/nickitat))。
* 修复 `clickhouse-client` 中语法高亮导致的崩溃。关闭 [#71864](https://github.com/ClickHouse/ClickHouse/issues/71864)。[#71949](https://github.com/ClickHouse/ClickHouse/pull/71949)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 修复在 `ORDER BY` 中对 `MergeTree` 表使用二元单调函数且第一个参数为常量时出现的 `Illegal type` 错误。修复 [#71941](https://github.com/ClickHouse/ClickHouse/issues/71941)。[#71966](https://github.com/ClickHouse/ClickHouse/pull/71966)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 在子查询中使用 `EXPLAIN AST` 时仅允许 `SELECT` 查询。其他类型的查询会导致逻辑错误：&#39;Bad cast from type DB::ASTCreateQuery to DB::ASTSelectWithUnionQuery&#39; 或 `Inconsistent AST formatting`。 [#71982](https://github.com/ClickHouse/ClickHouse/pull/71982) ([Pavel Kruglov](https://github.com/Avogar)).
* 当使用 `clickhouse-client` 插入记录时，客户端会从服务器读取列描述。但此前存在一个 bug：我们以错误的顺序写入了这些描述，正确的顺序应为 [statistics, ttl, settings]。[#71991](https://github.com/ClickHouse/ClickHouse/pull/71991)（[Han Fei](https://github.com/hanfei1991)）。
* 在启用 `format_alter_commands_with_parentheses` 时，修正 `MOVE PARTITION ... TO TABLE ...` ALTER 命令的格式。[#72080](https://github.com/ClickHouse/ClickHouse/pull/72080) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
* 将推断得到的格式名称添加到 File/S3/URL/HDFS/Azure 引擎的 `CREATE` 查询中。之前会在每次服务器重启时重新推断格式名称，如果指定的数据文件已被删除，则会在服务器启动期间导致错误。[#72108](https://github.com/ClickHouse/ClickHouse/pull/72108) ([Pavel Kruglov](https://github.com/Avogar))。
* 修复了一个错误：`min_age_to_force_merge_on_partition_only` 会卡在反复尝试合并同一个已经被合并为单个 part 的分区上，而不会去合并那些仍包含多个 part 的分区。[#72209](https://github.com/ClickHouse/ClickHouse/pull/72209)（[Christoph Wurm](https://github.com/cwurm)）。
* 修复了在极少数情况下处理稀疏列时会导致 `SimpleSquashingChunksTransform` 崩溃的问题。[#72226](https://github.com/ClickHouse/ClickHouse/pull/72226) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 修复了 `GraceHashJoin` 中的数据竞争问题，该问题可能导致 join 结果中缺失某些行。[#72233](https://github.com/ClickHouse/ClickHouse/pull/72233) ([Nikita Taranov](https://github.com/nickitat))。
* 修复了在启用 `enable_block_number_column` 设置时，包含物化 `_block_number` 列的 `ALTER DELETE` 查询的问题。[#72261](https://github.com/ClickHouse/ClickHouse/pull/72261)（[Anton Popov](https://github.com/CurtizJ)）。
* 修复了在并发调用 `ColumnDynamic::dumpStructure()` 时出现的数据竞争问题，例如在 `ConcurrentHashJoin` 的构造函数中。 [#72278](https://github.com/ClickHouse/ClickHouse/pull/72278) ([Nikita Taranov](https://github.com/nickitat)).
* 修复在 `ORDER BY ... WITH FILL` 中使用重复列时可能出现的 `LOGICAL_ERROR`。 [#72387](https://github.com/ClickHouse/ClickHouse/pull/72387) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 在应用 `optimize_functions_to_subcolumns` 后，修复了若干场景下的类型不匹配问题。[#72394](https://github.com/ClickHouse/ClickHouse/pull/72394) ([Anton Popov](https://github.com/CurtizJ)).
* 修复解析 `BACKUP DATABASE db EXCEPT TABLES db.table` 查询时出现的错误。 [#72429](https://github.com/ClickHouse/ClickHouse/pull/72429) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* 禁止创建空的 Variant。[#72454](https://github.com/ClickHouse/ClickHouse/pull/72454)（[Pavel Kruglov](https://github.com/Avogar)）。
* 修复 `system.merges` 中 `result_part_path` 的无效格式。 [#72567](https://github.com/ClickHouse/ClickHouse/pull/72567) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* 修复仅包含单个元素的 glob 模式的解析。[#72572](https://github.com/ClickHouse/ClickHouse/pull/72572) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 在包含 ARRAY JOIN 的分布式查询中，修复了从属服务器的查询生成逻辑。修复了 [#69276](https://github.com/ClickHouse/ClickHouse/issues/69276)。[#72608](https://github.com/ClickHouse/ClickHouse/pull/72608)（[Dmitry Novik](https://github.com/novikd)）。
* 修复了在 `DateTime64` 中嵌套 `DateTime64` 时返回空结果的错误。 [#72640](https://github.com/ClickHouse/ClickHouse/pull/72640) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 修复在 S3Queue 无序模式下，当 `tracked_files_limit` 的设置值小于 S3 文件生成速率时出现的“No such key”错误。[#72738](https://github.com/ClickHouse/ClickHouse/pull/72738)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 如果标记缓存较大，清除它可能会花费较长时间。如果在此期间一直持有上下文互斥锁，会阻塞许多其他操作，甚至在互斥锁释放前都无法建立新的客户端连接。而且，为了实现同步实际上并不需要一直持有该互斥锁，只要通过 shared ptr 持有对缓存的本地引用就足够了。[#72749](https://github.com/ClickHouse/ClickHouse/pull/72749)（[Alexander Gololobov](https://github.com/davenger)）。
* 在某个测试实例上，PK cache 对自身大小的估计严重偏小。尤其是 `LowCardinality` 列没有将字典大小计算在内。修复方法是改为使用 `column-&gt;allocatedBytes()`，并在此基础上再加上一些缓存项大小的额外开销估算。[#72750](https://github.com/ClickHouse/ClickHouse/pull/72750)（[Alexander Gololobov](https://github.com/davenger)）。
* 修复 RemoteQueryExecutor 在本地不存在用户时抛出的异常。[#72759](https://github.com/ClickHouse/ClickHouse/pull/72759)（[Andrey Zvonov](https://github.com/zvonand)）。
* 修复了在启用 `enable_block_number_column` 设置时，物化的 `_block_number` 列上的变更操作问题。 [#72854](https://github.com/ClickHouse/ClickHouse/pull/72854) ([Anton Popov](https://github.com/CurtizJ)).
* 修复当备份中包含空文件时使用普通可重写磁盘进行备份/恢复的错误。 [#72858](https://github.com/ClickHouse/ClickHouse/pull/72858) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 正确取消 DistributedAsyncInsertDirectoryQueue 中的插入。 [#72885](https://github.com/ClickHouse/ClickHouse/pull/72885) ([Antonio Andelic](https://github.com/antonio2368)).
* 修复了在将错误数据解析到稀疏列中时导致的崩溃问题（在启用设置 `enable_parsing_to_custom_serialization` 时可能发生）。[#72891](https://github.com/ClickHouse/ClickHouse/pull/72891) ([Anton Popov](https://github.com/CurtizJ)).
* 修复备份恢复过程中的潜在崩溃问题。[#72947](https://github.com/ClickHouse/ClickHouse/pull/72947)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 修复了 `parallel_hash` JOIN 方法中的一个错误，该错误可能会在查询的 `ON` 子句中包含带不等式过滤的复杂条件时出现。 [#72993](https://github.com/ClickHouse/ClickHouse/pull/72993) ([Nikita Taranov](https://github.com/nickitat)).
* 在 JSON 解析时使用默认格式设置，以避免反序列化出错。[#73043](https://github.com/ClickHouse/ClickHouse/pull/73043) ([Pavel Kruglov](https://github.com/Avogar)).
* 修复在使用不受支持的存储时导致事务崩溃的问题。 [#73045](https://github.com/ClickHouse/ClickHouse/pull/73045) ([Raúl Marín](https://github.com/Algunenano)).
* 在解析 `Tuple` 时检查重复的 JSON 键。之前，这可能会在解析过程中导致逻辑错误 `Invalid number of rows in Chunk`。[#73082](https://github.com/ClickHouse/ClickHouse/pull/73082) ([Pavel Kruglov](https://github.com/Avogar))。
