---
slug: /whats-new/changelog/24.2-fast-release
title: "v24.2 变更日志"
description: "v24.2 快速发布版本变更日志"
keywords: ["变更日志"]
sidebar_label: "24.2"
sidebar_position: 9
doc_type: "changelog"
---

### ClickHouse 发布标签：24.2.2.15987 {#clickhouse-release-tag-242215987}


#### 向后不兼容的变更 {#backward-incompatible-change}

- 验证嵌套类型中的可疑/实验性类型。以前我们不会验证嵌套类型(如 Array/Tuple/Map)中的此类类型(JSON 除外)。[#59385](https://github.com/ClickHouse/ClickHouse/pull/59385) ([Kruglov Pavel](https://github.com/Avogar))。
- 排序子句 `ORDER BY ALL`(在 v23.12 中引入)已被 `ORDER BY *` 替代。对于包含名为 `all` 的列的表,之前的语法过于容易出错。[#59450](https://github.com/ClickHouse/ClickHouse/pull/59450) ([Robert Schulze](https://github.com/rschu1ze))。
- 为线程数和块大小添加合理性检查。[#60138](https://github.com/ClickHouse/ClickHouse/pull/60138) ([Raúl Marín](https://github.com/Algunenano))。
- 当查询级设置 `async_insert` 和 `deduplicate_blocks_in_dependent_materialized_views` 同时启用时,拒绝传入的 INSERT 查询。此行为由设置 `throw_if_deduplication_in_dependent_materialized_views_enabled_with_async_insert` 控制,默认启用。这是 https://github.com/ClickHouse/ClickHouse/pull/59699 的延续,用于解除 https://github.com/ClickHouse/ClickHouse/pull/59915 的阻塞。[#60888](https://github.com/ClickHouse/ClickHouse/pull/60888) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- 工具 `clickhouse-copier` 已移至 GitHub 上的独立仓库:https://github.com/ClickHouse/copier。它不再包含在安装包中,但仍可作为单独下载提供。这解决了:[#60734](https://github.com/ClickHouse/ClickHouse/issues/60734) 这解决了:[#60540](https://github.com/ClickHouse/ClickHouse/issues/60540) 这解决了:[#60250](https://github.com/ClickHouse/ClickHouse/issues/60250) 这解决了:[#52917](https://github.com/ClickHouse/ClickHouse/issues/52917) 这解决了:[#51140](https://github.com/ClickHouse/ClickHouse/issues/51140) 这解决了:[#47517](https://github.com/ClickHouse/ClickHouse/issues/47517) 这解决了:[#47189](https://github.com/ClickHouse/ClickHouse/issues/47189) 这解决了:[#46598](https://github.com/ClickHouse/ClickHouse/issues/46598) 这解决了:[#40257](https://github.com/ClickHouse/ClickHouse/issues/40257) 这解决了:[#36504](https://github.com/ClickHouse/ClickHouse/issues/36504) 这解决了:[#35485](https://github.com/ClickHouse/ClickHouse/issues/35485) 这解决了:[#33702](https://github.com/ClickHouse/ClickHouse/issues/33702) 这解决了:[#26702](https://github.com/ClickHouse/ClickHouse/issues/26702) ### 面向用户的变更文档条目。[#61058](https://github.com/ClickHouse/ClickHouse/pull/61058) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- 为提高与 MySQL 的兼容性,函数 `locate` 现在默认接受参数 `(needle, haystack[, start_pos])`。可以通过设置 `function_locate_has_mysql_compatible_argument_order = 0` 来恢复之前的行为 `(haystack, needle, [, start_pos])`。[#61092](https://github.com/ClickHouse/ClickHouse/pull/61092) ([Robert Schulze](https://github.com/rschu1ze))。
- 已过时的内存数据部分自 23.5 版本起已被弃用,自 23.10 版本起不再受支持。现在剩余代码已被移除。这是 [#55186](https://github.com/ClickHouse/ClickHouse/issues/55186) 和 [#45409](https://github.com/ClickHouse/ClickHouse/issues/45409) 的延续。您不太可能使用过内存数据部分,因为它们仅在 23.5 版本之前可用,并且只有在您通过为 MergeTree 表指定相应的 SETTINGS 手动启用它们时才可用。要检查是否有内存数据部分,请运行以下查询:`SELECT part_type, count() FROM system.parts GROUP BY part_type ORDER BY part_type`。要禁用内存数据部分的使用,请执行 `ALTER TABLE ... MODIFY SETTING min_bytes_for_compact_part = DEFAULT, min_rows_for_compact_part = DEFAULT`。在从旧版本 ClickHouse 升级之前,首先检查您是否有内存数据部分。如果存在内存数据部分,请先禁用它们,然后等待直到没有内存数据部分后再继续升级。[#61127](https://github.com/ClickHouse/ClickHouse/pull/61127) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 默认禁止在 `MergeTree` 表的 `ORDER BY` 中使用 `SimpleAggregateFunction`(类似于 `AggregateFunction` 被禁止,但它们被禁止是因为它们不可比较)(使用 `allow_suspicious_primary_key` 来允许它们)。[#61399](https://github.com/ClickHouse/ClickHouse/pull/61399) ([Azat Khuzhin](https://github.com/azat))。
- ClickHouse 允许在 String 数据类型中使用任意二进制数据,通常为 UTF-8。Parquet/ORC/Arrow 字符串仅支持 UTF-8。因此,您可以选择为 ClickHouse String 数据类型使用哪种 Arrow 数据类型 - String 或 Binary。这由设置 `output_format_parquet_string_as_string`、`output_format_orc_string_as_string`、`output_format_arrow_string_as_string` 控制。虽然 Binary 更正确且更兼容,但在大多数情况下,默认使用 String 将符合用户期望。Parquet/ORC/Arrow 支持多种压缩方法,包括 lz4 和 zstd。ClickHouse 支持所有压缩方法。一些较差的工具缺乏对更快的 `lz4` 压缩方法的支持,因此我们默认设置为 `zstd`。这由设置 `output_format_parquet_compression_method`、`output_format_orc_compression_method` 和 `output_format_arrow_compression_method` 控制。我们将 Parquet 和 ORC 的默认值更改为 `zstd`,但 Arrow 未更改(它强调用于低级使用)。[#61817](https://github.com/ClickHouse/ClickHouse/pull/61817) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 修复了物化视图安全问题,该问题允许用户在没有所需授权的情况下向表中插入数据。修复验证用户不仅有权限插入到物化视图,还有权限插入到所有底层表。这意味着一些以前可以工作的查询现在可能会因权限不足而失败。为解决此问题,该版本引入了视图的 SQL 安全新特性 [https://clickhouse.com/docs/sql-reference/statements/create/view#sql_security](/sql-reference/statements/create/view#sql_security)。[#54901](https://github.com/ClickHouse/ClickHouse/pull/54901) ([pufit](https://github.com/pufit))





#### 新功能 {#new-feature}

- Topk/topkweighed 支持返回值计数及其误差的模式。[#54508](https://github.com/ClickHouse/ClickHouse/pull/54508) ([UnamedRus](https://github.com/UnamedRus))。
- 新增语法,允许在视图/物化视图中指定定义者用户。这使得无需对底层表进行显式授权即可从视图执行查询/插入操作。[#54901](https://github.com/ClickHouse/ClickHouse/pull/54901) ([pufit](https://github.com/pufit))。
- 实现了将不同类型的 MergeTree 表自动转换为复制引擎。在表的数据目录(`/clickhouse/store/xxx/xxxyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy/`)中创建空的 `convert_to_replicated` 文件,该表将在下次服务器启动时自动转换。[#57798](https://github.com/ClickHouse/ClickHouse/pull/57798) ([Kirill](https://github.com/kirillgarbar))。
- 新增表函数 `mergeTreeIndex`。它表示 `MergeTree` 表的索引和标记文件的内容,可用于内省。语法:`mergeTreeIndex(database, table, [with_marks = true])`,其中 `database.table` 是使用 `MergeTree` 引擎的现有表。[#58140](https://github.com/ClickHouse/ClickHouse/pull/58140) ([Anton Popov](https://github.com/CurtizJ))。
- 在 `file/s3/hdfs/url/azureBlobStorage` 引擎中进行模式推断时,如果文件格式未知,则尝试自动检测。关闭 [#50576](https://github.com/ClickHouse/ClickHouse/issues/50576)。[#59092](https://github.com/ClickHouse/ClickHouse/pull/59092) ([Kruglov Pavel](https://github.com/Avogar))。
- 新增表函数 generate_series。此函数生成包含自然数等差数列的表。[#59390](https://github.com/ClickHouse/ClickHouse/pull/59390) ([divanik](https://github.com/divanik))。
- 新增查询 `ALTER TABLE table FORGET PARTITION partition`,用于删除与空分区相关的 ZooKeeper 节点。[#59507](https://github.com/ClickHouse/ClickHouse/pull/59507) ([Sergei Trifonov](https://github.com/serxa))。
- 支持以 tar 归档格式读取和写入备份。[#59535](https://github.com/ClickHouse/ClickHouse/pull/59535) ([josh-hildred](https://github.com/josh-hildred))。
- 提供新的聚合函数 'groupArrayIntersect'。后续:[#49862](https://github.com/ClickHouse/ClickHouse/issues/49862)。[#59598](https://github.com/ClickHouse/ClickHouse/pull/59598) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- 实现了 system.dns_cache 表,可用于调试 DNS 问题。[#59856](https://github.com/ClickHouse/ClickHouse/pull/59856) ([Kirill Nikiforov](https://github.com/allmazz))。
- 实现了对 S3Express 存储桶的支持。[#59965](https://github.com/ClickHouse/ClickHouse/pull/59965) ([Nikita Taranov](https://github.com/nickitat))。
- 编解码器 `LZ4HC` 将接受新的级别 2,比之前的最低级别 3 更快,但压缩率较低。在以前的版本中,`LZ4HC(2)` 及更低级别与 `LZ4HC(3)` 相同。作者:[Cyan4973](https://github.com/Cyan4973)。[#60090](https://github.com/ClickHouse/ClickHouse/pull/60090) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 实现了 system.dns_cache 表,可用于调试 DNS 问题。新增服务器设置 dns_cache_max_size。[#60257](https://github.com/ClickHouse/ClickHouse/pull/60257) ([Kirill Nikiforov](https://github.com/allmazz))。
- 新增函数 `toMillisecond`,返回 `DateTime` 或 `DateTime64` 类型值的毫秒部分。[#60281](https://github.com/ClickHouse/ClickHouse/pull/60281) ([Shaun Struwig](https://github.com/Blargian))。
- 支持 merge 表函数的单参数版本,如 `merge(['db_name', ] 'tables_regexp')`。[#60372](https://github.com/ClickHouse/ClickHouse/pull/60372) ([豪肥肥](https://github.com/HowePa))。
- 使所有格式名称不区分大小写,如 Tsv、TSV、tsv,甚至 rowbinary。[#60420](https://github.com/ClickHouse/ClickHouse/pull/60420) ([豪肥肥](https://github.com/HowePa))。
- 新增语法,允许在视图/物化视图中指定定义者用户。这使得无需对底层表进行显式授权即可从视图执行查询/插入操作。[#60439](https://github.com/ClickHouse/ClickHouse/pull/60439) ([pufit](https://github.com/pufit))。
- 为 `StorageMemory`(内存引擎)新增四个属性:`min_bytes_to_keep`、`max_bytes_to_keep`、`min_rows_to_keep` 和 `max_rows_to_keep` - 添加测试以反映新更改 - 更新 `memory.md` 文档 - 为 `MemorySink` 添加表 `context` 属性以启用对表参数边界的访问。[#60612](https://github.com/ClickHouse/ClickHouse/pull/60612) ([Jake Bamrah](https://github.com/JakeBamrah))。
- 新增函数 `toMillisecond`,返回 `DateTime` 或 `DateTime64` 类型值的毫秒部分。[#60649](https://github.com/ClickHouse/ClickHouse/pull/60649) ([Robert Schulze](https://github.com/rschu1ze))。
- 分离等待查询和执行查询的数量限制。新增服务器设置 `max_waiting_queries`,用于限制因 `async_load_databases` 而等待的查询数量。现有的执行查询数量限制不再计入等待查询。[#61053](https://github.com/ClickHouse/ClickHouse/pull/61053) ([Sergei Trifonov](https://github.com/serxa))。
- 新增对 `ATTACH PARTITION ALL` 的支持。[#61107](https://github.com/ClickHouse/ClickHouse/pull/61107) ([Kirill Nikiforov](https://github.com/allmazz))。





#### 性能改进 {#performance-improvement}

- 消除 SELECT 部分中 GROUP BY 键的 min/max/any/anyLast 聚合器。[#52230](https://github.com/ClickHouse/ClickHouse/pull/52230) ([JackyWoo](https://github.com/JackyWoo))。
- 改进涉及多个可空列时序列化聚合方法的性能。这是 [#51399](https://github.com/ClickHouse/ClickHouse/issues/51399) 的通用版本,不会影响抽象完整性。[#55809](https://github.com/ClickHouse/ClickHouse/pull/55809) ([Amos Bird](https://github.com/amosbird))。
- 延迟构建连接输出以提高 ALL 连接的性能。[#58278](https://github.com/ClickHouse/ClickHouse/pull/58278) ([LiuNeng](https://github.com/liuneng1994))。
- 改进聚合函数 ArgMin / ArgMax / any / anyLast / anyHeavy,以及 `ORDER BY {u8/u16/u32/u64/i8/i16/u32/i64) LIMIT 1` 查询。[#58640](https://github.com/ClickHouse/ClickHouse/pull/58640) ([Raúl Marín](https://github.com/Algunenano))。
- 通过减少分支预测失误,有条件地优化 bigint 和 big decimal 类型的 sum/avg 性能。[#59504](https://github.com/ClickHouse/ClickHouse/pull/59504) ([李扬](https://github.com/taiyang-li))。
- 改进具有活动变更的 SELECT 查询的性能。[#59531](https://github.com/ClickHouse/ClickHouse/pull/59531) ([Azat Khuzhin](https://github.com/azat))。
- 对列过滤器进行简单优化。避免底层数据类型不是数字的过滤列使用 `result_size_hint = -1` 进行过滤。在某些情况下,峰值内存可以减少到原来的 44%。[#59698](https://github.com/ClickHouse/ClickHouse/pull/59698) ([李扬](https://github.com/taiyang-li))。
- 主键将使用更少的内存。[#60049](https://github.com/ClickHouse/ClickHouse/pull/60049) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 改进主键和其他一些操作的内存使用。[#60050](https://github.com/ClickHouse/ClickHouse/pull/60050) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 表的主键将在首次访问时延迟加载到内存中。这由新的 MergeTree 设置 `primary_key_lazy_load` 控制,默认启用。这提供了几个优势:- 未使用的表不会加载主键;- 如果内存不足,将在首次使用时抛出异常,而不是在服务器启动时。这也带来了几个劣势:- 加载主键的延迟将在第一次查询时产生,而不是在接受连接之前;这在理论上可能引入惊群问题。这解决了 [#11188](https://github.com/ClickHouse/ClickHouse/issues/11188)。[#60093](https://github.com/ClickHouse/ClickHouse/pull/60093) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 向量化函数 `dotProduct`,对向量搜索很有用。[#60202](https://github.com/ClickHouse/ClickHouse/pull/60202) ([Robert Schulze](https://github.com/rschu1ze))。
- 如果表的主键包含大部分无用的列,则不将它们保留在内存中。这由新设置 `primary_key_ratio_of_unique_prefix_values_to_skip_suffix_columns` 控制,默认值为 `0.9`,这意味着:对于复合主键,如果某列的值在至少 0.9 的情况下发生变化,则不会加载其后的列。[#60255](https://github.com/ClickHouse/ClickHouse/pull/60255) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 当 result_type 的底层类型为数字时,以列式方式执行 multiIf 函数。[#60384](https://github.com/ClickHouse/ClickHouse/pull/60384) ([李扬](https://github.com/taiyang-li))。
- 如图 1 所示,将 "&&" 替换为 "&" 可以生成 SIMD 代码。![image](https://github.com/ClickHouse/ClickHouse/assets/26588299/a5a72ac4-6dc6-4d52-835a-4f512e55f0b9) 图 1. 从 '&&'(左)和 '&'(右)编译的代码。[#60498](https://github.com/ClickHouse/ClickHouse/pull/60498) ([Zhiguo Zhou](https://github.com/ZhiguoZh))。
- 更快的互斥锁(几乎快 2 倍)(之前由于 ThreadFuzzer 而较慢)。[#60823](https://github.com/ClickHouse/ClickHouse/pull/60823) ([Azat Khuzhin](https://github.com/azat))。
- 将连接排空从准备阶段移至工作阶段,并并行排空多个连接。[#60845](https://github.com/ClickHouse/ClickHouse/pull/60845) ([lizhuoyu5](https://github.com/lzydmxy))。
- 优化可空数字或可空字符串的 insertManyFrom。[#60846](https://github.com/ClickHouse/ClickHouse/pull/60846) ([李扬](https://github.com/taiyang-li))。
- 优化函数 `dotProduct` 以省略不必要且昂贵的内存复制。[#60928](https://github.com/ClickHouse/ClickHouse/pull/60928) ([Robert Schulze](https://github.com/rschu1ze))。
- 文件系统缓存的操作将减少锁竞争的影响。[#61066](https://github.com/ClickHouse/ClickHouse/pull/61066) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 优化 ColumnString::replicate 并防止 memcpySmallAllowReadWriteOverflow15Impl 被优化为内置 memcpy。解决 [#61074](https://github.com/ClickHouse/ClickHouse/issues/61074)。ColumnString::replicate 在 x86-64 上速度提升 2.46 倍。[#61075](https://github.com/ClickHouse/ClickHouse/pull/61075) ([李扬](https://github.com/taiyang-li))。
- 256 位整数的打印速度提升 30 倍。[#61100](https://github.com/ClickHouse/ClickHouse/pull/61100) ([Raúl Marín](https://github.com/Algunenano))。
- 如果带有语法错误的查询包含带正则表达式的 COLUMNS 匹配器,则在解析器回溯期间每次都会编译正则表达式,而不是只编译一次。这是一个根本性错误。编译后的正则表达式被放入 AST 中。但 AST 中的 A 表示"抽象",这意味着它不应包含重量级对象。在解析过程中可以创建和丢弃 AST 的部分,包括大量回溯。这导致解析端变慢,从而允许只读用户进行 DoS 攻击。但主要问题是它阻碍了模糊测试器的进展。[#61543](https://github.com/ClickHouse/ClickHouse/pull/61543) ([Alexey Milovidov](https://github.com/alexey-milovidov))。





#### 改进 {#improvement}

- While running the MODIFY COLUMN query for materialized views, check the inner table's structure to ensure every column exists. [#47427](https://github.com/ClickHouse/ClickHouse/pull/47427) ([sunny](https://github.com/sunny19930321)).
- Added table `system.keywords` which contains all the keywords from parser. Mostly needed and will be used for better fuzzing and syntax highlighting. [#51808](https://github.com/ClickHouse/ClickHouse/pull/51808) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
- Added support for parameterized view with analyzer to not analyze create parameterized view. Refactor existing parameterized view logic to not analyze create parameterized view. [#54211](https://github.com/ClickHouse/ClickHouse/pull/54211) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
- Ordinary database engine is deprecated. You will receive a warning in clickhouse-client if your server is using it. This closes [#52229](https://github.com/ClickHouse/ClickHouse/issues/52229). [#56942](https://github.com/ClickHouse/ClickHouse/pull/56942) ([shabroo](https://github.com/shabroo)).
- All zero copy locks related to a table have to be dropped when the table is dropped. The directory which contains these locks has to be removed also. [#57575](https://github.com/ClickHouse/ClickHouse/pull/57575) ([Sema Checherinda](https://github.com/CheSema)).
- Add short-circuit ability for `dictGetOrDefault` function. Closes [#52098](https://github.com/ClickHouse/ClickHouse/issues/52098). [#57767](https://github.com/ClickHouse/ClickHouse/pull/57767) ([jsc0218](https://github.com/jsc0218)).
- Allow declaring enum in external table structure. [#57857](https://github.com/ClickHouse/ClickHouse/pull/57857) ([Duc Canh Le](https://github.com/canhld94)).
- Running `ALTER COLUMN MATERIALIZE` on a column with `DEFAULT` or `MATERIALIZED` expression now writes the correct values: The default value for existing parts with default value or the non-default value for existing parts with non-default value. Previously, the default value was written for all existing parts. [#58023](https://github.com/ClickHouse/ClickHouse/pull/58023) ([Duc Canh Le](https://github.com/canhld94)).
- Enabled a backoff logic (e.g. exponential). Will provide an ability for reduced CPU usage, memory usage and log file sizes. [#58036](https://github.com/ClickHouse/ClickHouse/pull/58036) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
- Consider lightweight deleted rows when selecting parts to merge. [#58223](https://github.com/ClickHouse/ClickHouse/pull/58223) ([Zhuo Qiu](https://github.com/jewelzqiu)).
- Allow to define `volume_priority` in `storage_configuration`. [#58533](https://github.com/ClickHouse/ClickHouse/pull/58533) ([Andrey Zvonov](https://github.com/zvonand)).
- Add support for Date32 type in T64 codec. [#58738](https://github.com/ClickHouse/ClickHouse/pull/58738) ([Hongbin Ma](https://github.com/binmahone)).
- This PR makes http/https connections reusable for all uses cases. Even when response is 3xx or 4xx. [#58845](https://github.com/ClickHouse/ClickHouse/pull/58845) ([Sema Checherinda](https://github.com/CheSema)).
- Added comments for columns for more system tables. Continuation of https://github.com/ClickHouse/ClickHouse/pull/58356. [#59016](https://github.com/ClickHouse/ClickHouse/pull/59016) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
- Now we can use virtual columns in PREWHERE. It's worthwhile for non-const virtual columns like `_part_offset`. [#59033](https://github.com/ClickHouse/ClickHouse/pull/59033) ([Amos Bird](https://github.com/amosbird)).
- Settings for the Distributed table engine can now be specified in the server configuration file (similar to MergeTree settings), e.g. `<distributed> <flush_on_detach>false</flush_on_detach> </distributed>`. [#59291](https://github.com/ClickHouse/ClickHouse/pull/59291) ([Azat Khuzhin](https://github.com/azat)).
- Keeper improvement: cache only a certain amount of logs in-memory controlled by `latest_logs_cache_size_threshold` and `commit_logs_cache_size_threshold`. [#59460](https://github.com/ClickHouse/ClickHouse/pull/59460) ([Antonio Andelic](https://github.com/antonio2368)).
- Instead using a constant key, now object storage generates key for determining remove objects capability. [#59495](https://github.com/ClickHouse/ClickHouse/pull/59495) ([Sema Checherinda](https://github.com/CheSema)).
- Don't infer floats in exponential notation by default. Add a setting `input_format_try_infer_exponent_floats` that will restore previous behaviour (disabled by default). Closes [#59476](https://github.com/ClickHouse/ClickHouse/issues/59476). [#59500](https://github.com/ClickHouse/ClickHouse/pull/59500) ([Kruglov Pavel](https://github.com/Avogar)).
- Allow alter operations to be surrounded by parenthesis. The emission of parentheses can be controlled by the `format_alter_operations_with_parentheses` config. By default in formatted queries the parentheses are emitted as we store the formatted alter operations in some places as metadata (e.g.: mutations). The new syntax clarifies some of the queries where alter operations end in a list. E.g.: `ALTER TABLE x MODIFY TTL date GROUP BY a, b, DROP COLUMN c` cannot be parsed properly with the old syntax. In the new syntax the query `ALTER TABLE x (MODIFY TTL date GROUP BY a, b), (DROP COLUMN c)` is obvious. Older versions are not able to read the new syntax, therefore using the new syntax might cause issues if newer and older version of ClickHouse are mixed in a single cluster. [#59532](https://github.com/ClickHouse/ClickHouse/pull/59532) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
- Bumped Intel QPL (used by codec `DEFLATE_QPL`) from v1.3.1 to v1.4.0 . Also fixed a bug for polling timeout mechanism, as we observed in same cases timeout won't work properly, if timeout happen, IAA and CPU may process buffer concurrently. So far, we'd better make sure IAA codec status is not QPL_STS_BEING_PROCESSED, then fallback to SW codec. [#59551](https://github.com/ClickHouse/ClickHouse/pull/59551) ([jasperzhu](https://github.com/jinjunzh)).
- Add positional pread in libhdfs3. If you want to call positional read in libhdfs3, use the hdfsPread function in hdfs.h as follows. `tSize hdfsPread(hdfsFS fs, hdfsFile file, void * buffer, tSize length, tOffset position);`. [#59624](https://github.com/ClickHouse/ClickHouse/pull/59624) ([M1eyu](https://github.com/M1eyu2018)).
- Check for stack overflow in parsers even if the user misconfigured the `max_parser_depth` setting to a very high value. This closes [#59622](https://github.com/ClickHouse/ClickHouse/issues/59622). [#59697](https://github.com/ClickHouse/ClickHouse/pull/59697) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Unify xml and sql created named collection behaviour in kafka storage. [#59710](https://github.com/ClickHouse/ClickHouse/pull/59710) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
- Allow uuid in replica_path if CREATE TABLE explicitly has it. [#59908](https://github.com/ClickHouse/ClickHouse/pull/59908) ([Azat Khuzhin](https://github.com/azat)).
- Add column `metadata_version` of ReplicatedMergeTree table in `system.tables` system table. [#59942](https://github.com/ClickHouse/ClickHouse/pull/59942) ([Maksim Kita](https://github.com/kitaisreal)).
- Keeper improvement: add retries on failures for Disk related operations. [#59980](https://github.com/ClickHouse/ClickHouse/pull/59980) ([Antonio Andelic](https://github.com/antonio2368)).
- Add new config setting `backups.remove_backup_files_after_failure`: `<clickhouse> <backups> <remove_backup_files_after_failure>true</remove_backup_files_after_failure> </backups> </clickhouse>`. [#60002](https://github.com/ClickHouse/ClickHouse/pull/60002) ([Vitaly Baranov](https://github.com/vitlibar)).
- Use multiple threads while reading the metadata of tables from a backup while executing the RESTORE command. [#60040](https://github.com/ClickHouse/ClickHouse/pull/60040) ([Vitaly Baranov](https://github.com/vitlibar)).
- Now if `StorageBuffer` has more than 1 shard (`num_layers` > 1) background flush will happen simultaneously for all shards in multiple threads. [#60111](https://github.com/ClickHouse/ClickHouse/pull/60111) ([alesapin](https://github.com/alesapin)).
- Support specifying users for specific S3 settings in config using `user` key. [#60144](https://github.com/ClickHouse/ClickHouse/pull/60144) ([Antonio Andelic](https://github.com/antonio2368)).
- Copy S3 file GCP fallback to buffer copy in case GCP returned `Internal Error` with `GATEWAY_TIMEOUT` HTTP error code. [#60164](https://github.com/ClickHouse/ClickHouse/pull/60164) ([Maksim Kita](https://github.com/kitaisreal)).
- Allow "local" as object storage type instead of "local_blob_storage". [#60165](https://github.com/ClickHouse/ClickHouse/pull/60165) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Implement comparison operator for Variant values and proper Field inserting into Variant column. Don't allow creating `Variant` type with similar variant types by default (allow uder a setting `allow_suspicious_variant_types`) Closes [#59996](https://github.com/ClickHouse/ClickHouse/issues/59996). Closes [#59850](https://github.com/ClickHouse/ClickHouse/issues/59850). [#60198](https://github.com/ClickHouse/ClickHouse/pull/60198) ([Kruglov Pavel](https://github.com/Avogar)).
- Improved overall usability of virtual columns. Now it is allowed to use virtual columns in `PREWHERE` (it's worthwhile for non-const virtual columns like `_part_offset`). Now a builtin documentation is available for virtual columns as a comment of column in `DESCRIBE` query with enabled setting `describe_include_virtual_columns`. [#60205](https://github.com/ClickHouse/ClickHouse/pull/60205) ([Anton Popov](https://github.com/CurtizJ)).
- Short circuit execution for `ULIDStringToDateTime`. [#60211](https://github.com/ClickHouse/ClickHouse/pull/60211) ([Juan Madurga](https://github.com/jlmadurga)).
- Added `query_id` column for tables `system.backups` and `system.backup_log`. Added error stacktrace to `error` column. [#60220](https://github.com/ClickHouse/ClickHouse/pull/60220) ([Maksim Kita](https://github.com/kitaisreal)).
- Parallel flush of pending INSERT blocks of Distributed engine on `DETACH`/server shutdown and `SYSTEM FLUSH DISTRIBUTED` (Parallelism will work only if you have multi disk policy for table (like everything in Distributed engine right now)). [#60225](https://github.com/ClickHouse/ClickHouse/pull/60225) ([Azat Khuzhin](https://github.com/azat)).
- Filter setting is improper in `joinRightColumnsSwitchNullability`, resolve [#59625](https://github.com/ClickHouse/ClickHouse/issues/59625). [#60259](https://github.com/ClickHouse/ClickHouse/pull/60259) ([lgbo](https://github.com/lgbo-ustc)).
- Add a setting to force read-through cache for merges. [#60308](https://github.com/ClickHouse/ClickHouse/pull/60308) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Issue [#57598](https://github.com/ClickHouse/ClickHouse/issues/57598) mentions a variant behaviour regarding transaction handling. An issued COMMIT/ROLLBACK when no transaction is active is reported as an error contrary to MySQL behaviour. [#60338](https://github.com/ClickHouse/ClickHouse/pull/60338) ([PapaToemmsn](https://github.com/PapaToemmsn)).
- Added `none_only_active` mode for `distributed_ddl_output_mode` setting. [#60340](https://github.com/ClickHouse/ClickHouse/pull/60340) ([Alexander Tokmakov](https://github.com/tavplubix)).
- Connections through the MySQL port now automatically run with setting `prefer_column_name_to_alias = 1` to support QuickSight out-of-the-box. Also, settings `mysql_map_string_to_text_in_show_columns` and `mysql_map_fixed_string_to_text_in_show_columns` are now enabled by default, affecting also only MySQL connections. This increases compatibility with more BI tools. [#60365](https://github.com/ClickHouse/ClickHouse/pull/60365) ([Robert Schulze](https://github.com/rschu1ze)).
- When output format is Pretty format and a block consists of a single numeric value which exceeds one million, A readable number will be printed on table right. e.g. `┌──────count()─┐ │ 233765663884 │ -- 233.77 billion └──────────────┘`. [#60379](https://github.com/ClickHouse/ClickHouse/pull/60379) ([rogeryk](https://github.com/rogeryk)).
- Allow configuring HTTP redirect handlers for clickhouse-server. For example, you can make `/` redirect to the Play UI. [#60390](https://github.com/ClickHouse/ClickHouse/pull/60390) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- The advanced dashboard has slightly better colors for multi-line graphs. [#60391](https://github.com/ClickHouse/ClickHouse/pull/60391) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Fix a race condition in JavaScript code leading to duplicate charts on top of each other. [#60392](https://github.com/ClickHouse/ClickHouse/pull/60392) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Check for stack overflow in parsers even if the user misconfigured the `max_parser_depth` setting to a very high value. This closes [#59622](https://github.com/ClickHouse/ClickHouse/issues/59622). [#60434](https://github.com/ClickHouse/ClickHouse/pull/60434) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Function `substring` now has a new alias `byteSlice`. [#60494](https://github.com/ClickHouse/ClickHouse/pull/60494) ([Robert Schulze](https://github.com/rschu1ze)).
- Renamed server setting `dns_cache_max_size` to `dns_cache_max_entries` to reduce ambiguity. [#60500](https://github.com/ClickHouse/ClickHouse/pull/60500) ([Kirill Nikiforov](https://github.com/allmazz)).
- `SHOW INDEX | INDEXES | INDICES | KEYS` no longer sorts by the primary key columns (which was unintuitive). [#60514](https://github.com/ClickHouse/ClickHouse/pull/60514) ([Robert Schulze](https://github.com/rschu1ze)).
- Keeper improvement: abort during startup if an invalid snapshot is detected to avoid data loss. [#60537](https://github.com/ClickHouse/ClickHouse/pull/60537) ([Antonio Andelic](https://github.com/antonio2368)).
- Added MergeTree read split ranges into intersecting and non intersecting fault injection using `merge_tree_read_split_ranges_into_intersecting_and_non_intersecting_fault_probability` setting. [#60548](https://github.com/ClickHouse/ClickHouse/pull/60548) ([Maksim Kita](https://github.com/kitaisreal)).
- The Advanced dashboard now has controls always visible on scrolling. This allows you to add a new chart without scrolling up. [#60692](https://github.com/ClickHouse/ClickHouse/pull/60692) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- String types and Enums can be used in the same context, such as: arrays, UNION queries, conditional expressions. This closes [#60726](https://github.com/ClickHouse/ClickHouse/issues/60726). [#60727](https://github.com/ClickHouse/ClickHouse/pull/60727) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Update tzdata to 2024a. [#60768](https://github.com/ClickHouse/ClickHouse/pull/60768) ([Raúl Marín](https://github.com/Algunenano)).
- Support files without format extension in Filesystem database. [#60795](https://github.com/ClickHouse/ClickHouse/pull/60795) ([Kruglov Pavel](https://github.com/Avogar)).
- Keeper improvement: support `leadership_expiry_ms` in Keeper's settings. [#60806](https://github.com/ClickHouse/ClickHouse/pull/60806) ([Brokenice0415](https://github.com/Brokenice0415)).
- Always infer exponential numbers in JSON formats regardless of the setting `input_format_try_infer_exponent_floats`. Add setting `input_format_json_use_string_type_for_ambiguous_paths_in_named_tuples_inference_from_objects` that allows to use String type for ambiguous paths instead of an exception during named Tuples inference from JSON objects. [#60808](https://github.com/ClickHouse/ClickHouse/pull/60808) ([Kruglov Pavel](https://github.com/Avogar)).
- Add a flag for SMJ to treat null as biggest/smallest. So the behavior can be compitable with other SQL systems, like Apache Spark. [#60896](https://github.com/ClickHouse/ClickHouse/pull/60896) ([loudongfeng](https://github.com/loudongfeng)).
- Clickhouse version has been added to docker labels. Closes [#54224](https://github.com/ClickHouse/ClickHouse/issues/54224). [#60949](https://github.com/ClickHouse/ClickHouse/pull/60949) ([Nikolay Monkov](https://github.com/nikmonkov)).
- Add a setting `parallel_replicas_allow_in_with_subquery = 1` which allows subqueries for IN work with parallel replicas. [#60950](https://github.com/ClickHouse/ClickHouse/pull/60950) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
- DNSResolver shuffles set of resolved IPs. [#60965](https://github.com/ClickHouse/ClickHouse/pull/60965) ([Sema Checherinda](https://github.com/CheSema)).
- Support detect output format by file exctension in `clickhouse-client` and `clickhouse-local`. [#61036](https://github.com/ClickHouse/ClickHouse/pull/61036) ([豪肥肥](https://github.com/HowePa)).
- Check memory limit update periodically. [#61049](https://github.com/ClickHouse/ClickHouse/pull/61049) ([Han Fei](https://github.com/hanfei1991)).
- Enable processors profiling (time spent/in and out bytes for sorting, aggregation, ...) by default. [#61096](https://github.com/ClickHouse/ClickHouse/pull/61096) ([Azat Khuzhin](https://github.com/azat)).
- Add the function `toUInt128OrZero`, which was missed by mistake (the mistake is related to https://github.com/ClickHouse/ClickHouse/pull/945). The compatibility aliases `FROM_UNIXTIME` and `DATE_FORMAT` (they are not ClickHouse-native and only exist for MySQL compatibility) have been made case insensitive, as expected for SQL-compatibility aliases. [#61114](https://github.com/ClickHouse/ClickHouse/pull/61114) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Improvements for the access checks, allowing to revoke of unpossessed rights in case the target user doesn't have the revoking grants either. Example: ```sql GRANT SELECT ON _._ TO user1; REVOKE SELECT ON system.\* FROM user1;. [#61115](https://github.com/ClickHouse/ClickHouse/pull/61115) ([pufit](https://github.com/pufit)).
- Fix an error in previeous opt: https://github.com/ClickHouse/ClickHouse/pull/59698: remove break to make sure the first filtered column has minimum size cc @jsc0218. [#61145](https://github.com/ClickHouse/ClickHouse/pull/61145) ([李扬](https://github.com/taiyang-li)).
- Fix `has()` function with `Nullable` column (fixes [#60214](https://github.com/ClickHouse/ClickHouse/issues/60214)). [#61249](https://github.com/ClickHouse/ClickHouse/pull/61249) ([Mikhail Koviazin](https://github.com/mkmkme)).
- Now it's possible to specify attribute `merge="true"` in config substitutions for subtrees `<include from_zk="/path" merge="true">`. In case this attribute specified, clickhouse will merge subtree with existing configuration, otherwise default behavior is append new content to configuration. [#61299](https://github.com/ClickHouse/ClickHouse/pull/61299) ([alesapin](https://github.com/alesapin)).
- Add async metrics for virtual memory mappings: VMMaxMapCount & VMNumMaps. Closes [#60662](https://github.com/ClickHouse/ClickHouse/issues/60662). [#61354](https://github.com/ClickHouse/ClickHouse/pull/61354) ([Tuan Pham Anh](https://github.com/tuanpavn)).
- Use `temporary_files_codec` setting in all places where we create temporary data, for example external memory sorting and external memory GROUP BY. Before it worked only in `partial_merge` JOIN algorithm. [#61456](https://github.com/ClickHouse/ClickHouse/pull/61456) ([Maksim Kita](https://github.com/kitaisreal)).
- Remove duplicated check `containing_part.empty()`, It's already being checked here: https://github.com/ClickHouse/ClickHouse/blob/1296dac3c7e47670872c15e3f5e58f869e0bd2f2/src/Storages/MergeTree/MergeTreeData.cpp#L6141. [#61467](https://github.com/ClickHouse/ClickHouse/pull/61467) ([William Schoeffel](https://github.com/wiledusc)).
- Add a new setting `max_parser_backtracks` which allows to limit the complexity of query parsing. [#61502](https://github.com/ClickHouse/ClickHouse/pull/61502) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Less contention during dynamic resize of filesystem cache. [#61524](https://github.com/ClickHouse/ClickHouse/pull/61524) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Disallow sharded mode of StorageS3 queue, because it will be rewritten. [#61537](https://github.com/ClickHouse/ClickHouse/pull/61537) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Fixed typo: from `use_leagcy_max_level` to `use_legacy_max_level`. [#61545](https://github.com/ClickHouse/ClickHouse/pull/61545) ([William Schoeffel](https://github.com/wiledusc)).
- Remove some duplicate entries in blob_storage_log. [#61622](https://github.com/ClickHouse/ClickHouse/pull/61622) ([YenchangChan](https://github.com/YenchangChan)).
- Added `current_user` function as a compatibility alias for MySQL. [#61770](https://github.com/ClickHouse/ClickHouse/pull/61770) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
- Use managed identity for backups IO when using Azure Blob Storage. Add a setting to prevent ClickHouse from attempting to create a non-existent container, which requires permissions at the storage account level. [#61785](https://github.com/ClickHouse/ClickHouse/pull/61785) ([Daniel Pozo Escalona](https://github.com/danipozo)).
- In the previous version, some numbers in Pretty formats were not pretty enough. [#61794](https://github.com/ClickHouse/ClickHouse/pull/61794) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- A long value in Pretty formats won't be cut if it is the single value in the resultset, such as in the result of the `SHOW CREATE TABLE` query. [#61795](https://github.com/ClickHouse/ClickHouse/pull/61795) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Similarly to `clickhouse-local`, `clickhouse-client` will accept the `--output-format` option as a synonym to the `--format` option. This closes [#59848](https://github.com/ClickHouse/ClickHouse/issues/59848). [#61797](https://github.com/ClickHouse/ClickHouse/pull/61797) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- If stdout is a terminal and the output format is not specified, `clickhouse-client` and similar tools will use `PrettyCompact` by default, similarly to the interactive mode. `clickhouse-client` and `clickhouse-local` will handle command line arguments for input and output formats in a unified fashion. This closes [#61272](https://github.com/ClickHouse/ClickHouse/issues/61272). [#61800](https://github.com/ClickHouse/ClickHouse/pull/61800) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Underscore digit groups in Pretty formats for better readability. This is controlled by a new setting, `output_format_pretty_highlight_digit_groups`. [#61802](https://github.com/ClickHouse/ClickHouse/pull/61802) ([Alexey Milovidov](https://github.com/alexey-milovidov)).

#### 错误修复(官方稳定版本中用户可见的异常行为) {#bug-fix-user-visible-misbehavior-in-an-official-stable-release}


* 修复 `intDiv` 在 decimal 参数上的缺陷 [#59243](https://github.com/ClickHouse/ClickHouse/pull/59243)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 修复 wingfuzz 发现的 kql 问题 [#59626](https://github.com/ClickHouse/ClickHouse/pull/59626) ([Yong Wang](https://github.com/kashwy))。
* 修复 AsynchronousBoundedReadBuffer 出现的 “Read beyond last offset” 错误 [#59630](https://github.com/ClickHouse/ClickHouse/pull/59630)（[Vitaly Baranov](https://github.com/vitlibar)）。
* rabbitmq：修复存在既未 ack 也未 nack 的消息的问题 [#59775](https://github.com/ClickHouse/ClickHouse/pull/59775) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 为分析器修复在使用 `GROUP BY const` 时针对 `const` 和 `LowCardinality` 的函数执行问题 [#59986](https://github.com/ClickHouse/ClickHouse/pull/59986)（[Azat Khuzhin](https://github.com/azat)）。
* 修复 DateTime64 的精度转换问题 [#60004](https://github.com/ClickHouse/ClickHouse/pull/60004)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 修复向 SQLite 插入数据时单引号处理的问题（将单引号转义为两个单引号，而非使用反斜杠）[#60015](https://github.com/ClickHouse/ClickHouse/pull/60015)（[Azat Khuzhin](https://github.com/azat)）。
* 修复 `optimize&#95;uniq&#95;to&#95;count` 会移除列别名的问题 [#60026](https://github.com/ClickHouse/ClickHouse/pull/60026) ([Raúl Marín](https://github.com/Algunenano)).
* 修复 MergeTree 中 finished&#95;mutations&#95;to&#95;keep=0 的行为（因为文档指出 0 表示保留全部） [#60031](https://github.com/ClickHouse/ClickHouse/pull/60031) ([Azat Khuzhin](https://github.com/azat))。
* 修复在删除 s3queue 表时可能抛出的异常 [#60036](https://github.com/ClickHouse/ClickHouse/pull/60036)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* PartsSplitter 针对同一数据 part 的无效范围 [#60041](https://github.com/ClickHouse/ClickHouse/pull/60041) ([Maksim Kita](https://github.com/kitaisreal)).
* 在 DDLLogEntry 中使用从上下文获取的 max&#95;query&#95;size，而不是硬编码的 4096 [#60083](https://github.com/ClickHouse/ClickHouse/pull/60083) ([Kruglov Pavel](https://github.com/Avogar))。
* 修复查询格式不一致的问题 [#60095](https://github.com/ClickHouse/ClickHouse/pull/60095) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 修复子查询中 `EXPLAIN` 输出格式不一致的问题 [#60102](https://github.com/ClickHouse/ClickHouse/pull/60102)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复在使用 Nullable 时发生的 cosineDistance 崩溃 [#60150](https://github.com/ClickHouse/ClickHouse/pull/60150) ([Raúl Marín](https://github.com/Algunenano))。
* 允许将以字符串形式表示的 `bool` 转换为真正的 `bool` 值 [#60160](https://github.com/ClickHouse/ClickHouse/pull/60160) ([Robert Schulze](https://github.com/rschu1ze))。
* 修复 system.s3queue&#95;log [#60166](https://github.com/ClickHouse/ClickHouse/pull/60166) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 修复在聚合函数名可为空时使用 arrayReduce 的问题 [#60188](https://github.com/ClickHouse/ClickHouse/pull/60188) ([Raúl Marín](https://github.com/Algunenano))。
* 修复在预过滤阶段（主键、分区裁剪）执行 actions 时的问题 [#60196](https://github.com/ClickHouse/ClickHouse/pull/60196) ([Azat Khuzhin](https://github.com/azat)).
* 隐藏 s3queue 的敏感信息 [#60233](https://github.com/ClickHouse/ClickHouse/pull/60233) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 回滚“将 `ORDER BY ALL` 替换为 `ORDER BY *` 的更改” [#60248](https://github.com/ClickHouse/ClickHouse/pull/60248) ([Robert Schulze](https://github.com/rschu1ze))。
* Azure Blob Storage：修复 endpoint 和前缀相关问题 [#60251](https://github.com/ClickHouse/ClickHouse/pull/60251)（[SmitaRKulkarni](https://github.com/SmitaRKulkarni)）。
* 修正 HTTP 异常代码。 [#60252](https://github.com/ClickHouse/ClickHouse/pull/60252) ([Austin Kothig](https://github.com/kothiga)).
* 修复 LRUResource 缓存中的 Bug（Hive 缓存） [#60262](https://github.com/ClickHouse/ClickHouse/pull/60262) ([shanfengp](https://github.com/Aed-p)).
* s3queue：修复一个 bug（同时修复不稳定测试 test&#95;storage&#95;s3&#95;queue/test.py::test&#95;shards&#95;distributed） [#60282](https://github.com/ClickHouse/ClickHouse/pull/60282) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 修复 IPv6 哈希函数中未初始化值的使用以及结果无效的问题 [#60359](https://github.com/ClickHouse/ClickHouse/pull/60359) ([Kruglov Pavel](https://github.com/Avogar))。
* 在并行副本发生变更时强制重新分析 [#60362](https://github.com/ClickHouse/ClickHouse/pull/60362) ([Raúl Marín](https://github.com/Algunenano)).
* 修复在新的 disks 配置选项中对 plain 元数据类型的使用问题 [#60396](https://github.com/ClickHouse/ClickHouse/pull/60396)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 不再允许将 max&#95;parallel&#95;replicas 设置为 0，因为这没有意义 [#60430](https://github.com/ClickHouse/ClickHouse/pull/60430) ([Kruglov Pavel](https://github.com/Avogar))。
* 尝试修复 `mapContainsKeyLike` 中出现的逻辑错误 &#39;Cannot capture column because it has incompatible type&#39; [#60451](https://github.com/ClickHouse/ClickHouse/pull/60451) ([Kruglov Pavel](https://github.com/Avogar))。
* 修复 OptimizeDateOrDateTimeConverterWithPreimageVisitor 在空参数情况下的问题 [#60453](https://github.com/ClickHouse/ClickHouse/pull/60453) ([Raúl Marín](https://github.com/Algunenano)).
* 尽量避免在执行 CREATE TABLE 时计算标量子查询。 [#60464](https://github.com/ClickHouse/ClickHouse/pull/60464) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* 合并 [#59674](https://github.com/ClickHouse/ClickHouse/issues/59674)。 [#60470](https://github.com/ClickHouse/ClickHouse/pull/60470)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 在 s3Cluster 中正确检查键 [#60477](https://github.com/ClickHouse/ClickHouse/pull/60477) ([Antonio Andelic](https://github.com/antonio2368))。
* 修复在大量行因错误被跳过时并行解析中的死锁问题 [#60516](https://github.com/ClickHouse/ClickHouse/pull/60516) ([Kruglov Pavel](https://github.com/Avogar))。
* 修复 KQL 复合运算符的 `max_query_size`： [#60534](https://github.com/ClickHouse/ClickHouse/pull/60534) ([Yong Wang](https://github.com/kashwy)).
* Keeper 修复：在等待提交日志时添加超时设置 [#60544](https://github.com/ClickHouse/ClickHouse/pull/60544) ([Antonio Andelic](https://github.com/antonio2368)).
* 减少从 `system.numbers` 中读取的行数 [#60546](https://github.com/ClickHouse/ClickHouse/pull/60546) ([JackyWoo](https://github.com/JackyWoo))。
* 不再为日期类型输出数值提示信息 [#60577](https://github.com/ClickHouse/ClickHouse/pull/60577) ([Raúl Marín](https://github.com/Algunenano))。
* 修复从 `MergeTree` 读取时在过滤条件中使用非确定性函数的问题 [#60586](https://github.com/ClickHouse/ClickHouse/pull/60586)（[Kruglov Pavel](https://github.com/Avogar)）。
* 修复在兼容性设置值类型错误时的逻辑错误 [#60596](https://github.com/ClickHouse/ClickHouse/pull/60596)（[Kruglov Pavel](https://github.com/Avogar)）。
* 修复混合 x86-64 / ARM 集群中聚合函数状态不一致的问题 [#60610](https://github.com/ClickHouse/ClickHouse/pull/60610) ([Harry Lee](https://github.com/HarryLeeIBM))。
* fix(prql): 更健壮的 panic 处理程序 [#60615](https://github.com/ClickHouse/ClickHouse/pull/60615) ([Maximilian Roos](https://github.com/max-sixty)).
* 修复 `intDiv` 在 Decimal 和日期参数上的行为 [#60672](https://github.com/ClickHouse/ClickHouse/pull/60672)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 修复：在 ALTER MODIFY 查询中对 CTE 进行展开处理 [#60682](https://github.com/ClickHouse/ClickHouse/pull/60682) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 修复非 Atomic/Ordinary 数据库引擎（例如 Memory）中的 system.parts [#60689](https://github.com/ClickHouse/ClickHouse/pull/60689) ([Azat Khuzhin](https://github.com/azat))。
* 修复参数化视图在元数据文件中出现的“Invalid storage definition in metadata file”错误 [#60708](https://github.com/ClickHouse/ClickHouse/pull/60708) ([Azat Khuzhin](https://github.com/azat)).
* 修复 CompressionCodecMultiple 中的缓冲区溢出问题 [#60731](https://github.com/ClickHouse/ClickHouse/pull/60731)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 从 SQL/JSON 中移除无效内容 [#60738](https://github.com/ClickHouse/ClickHouse/pull/60738) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 移除聚合函数 quantileGK 中不正确的 sanitize 检查 [#60740](https://github.com/ClickHouse/ClickHouse/pull/60740) ([李扬](https://github.com/taiyang-li))。
* 通过将 streams 设置为 1，修复了 insert-select 与 insert&#95;deduplication&#95;token 的 bug [#60745](https://github.com/ClickHouse/ClickHouse/pull/60745) ([Jordi Villar](https://github.com/jrdi))。
* 阻止在不支持的分片上传操作中设置自定义元数据头部 [#60748](https://github.com/ClickHouse/ClickHouse/pull/60748)（[Francisco J. Jurado Moreno](https://github.com/Beetelbrox)）。
* 修复了 `toStartOfInterval` [#60763](https://github.com/ClickHouse/ClickHouse/pull/60763)（[Andrey Zvonov](https://github.com/zvonand)）。
* 修复 `arrayEnumerateRanked` 中的崩溃问题 [#60764](https://github.com/ClickHouse/ClickHouse/pull/60764)（[Raúl Marín](https://github.com/Algunenano)）。
* 修复在 INSERT SELECT JOIN 中使用 input() 时出现的崩溃问题 [#60765](https://github.com/ClickHouse/ClickHouse/pull/60765) ([Kruglov Pavel](https://github.com/Avogar))。
* 修复因子查询中 allow&#95;experimental&#95;analyzer 设置不同而导致的崩溃 [#60770](https://github.com/ClickHouse/ClickHouse/pull/60770) ([Dmitry Novik](https://github.com/novikd))。
* 取消从 S3 读取时的递归 [#60849](https://github.com/ClickHouse/ClickHouse/pull/60849) ([Antonio Andelic](https://github.com/antonio2368))。
* 修复 HashedDictionaryParallelLoader 在出错时可能出现卡死的问题 [#60926](https://github.com/ClickHouse/ClickHouse/pull/60926) ([vdimir](https://github.com/vdimir)).
* 修复 Replicated 数据库中的异步 RESTORE [#60934](https://github.com/ClickHouse/ClickHouse/pull/60934)（[Antonio Andelic](https://github.com/antonio2368)）。
* 修复通过原生协议异步插入到 `Log` 表时出现的死锁问题 [#61055](https://github.com/ClickHouse/ClickHouse/pull/61055) ([Anton Popov](https://github.com/CurtizJ)).
* 修复 `dictGetOrDefault` 在 `RangeHashedDictionary` 中对默认参数的惰性求值问题 [#61196](https://github.com/ClickHouse/ClickHouse/pull/61196)（[Kruglov Pavel](https://github.com/Avogar)）。
* 修复 `groupArraySorted` 中的多个错误 [#61203](https://github.com/ClickHouse/ClickHouse/pull/61203) ([Raúl Marín](https://github.com/Algunenano))。
* 修复独立二进制版 Keeper 的重新配置问题 [#61233](https://github.com/ClickHouse/ClickHouse/pull/61233)（[Antonio Andelic](https://github.com/antonio2368)）。
* 修正 S3 引擎中 session&#95;token 的使用方式 [#61234](https://github.com/ClickHouse/ClickHouse/pull/61234)（[Kruglov Pavel](https://github.com/Avogar)）。
* 修复聚合函数 `uniqExact` 可能产生不正确结果的问题 [#61257](https://github.com/ClickHouse/ClickHouse/pull/61257) ([Anton Popov](https://github.com/CurtizJ)).
* 修复 `SHOW DATABASE` 中的 bug [#61269](https://github.com/ClickHouse/ClickHouse/pull/61269)（[Raúl Marín](https://github.com/Algunenano)）。
* 修复 RabbitMQ 存储在包含 `MATERIALIZED` 列时的逻辑错误 [#61320](https://github.com/ClickHouse/ClickHouse/pull/61320) ([vdimir](https://github.com/vdimir))。
* 修复 `CREATE OR REPLACE DICTIONARY` 语句 [#61356](https://github.com/ClickHouse/ClickHouse/pull/61356)（[Vitaly Baranov](https://github.com/vitlibar)）。
* 修复包含 external ON CLUSTER 的 ATTACH 查询 [#61365](https://github.com/ClickHouse/ClickHouse/pull/61365) ([Nikolay Degterinsky](https://github.com/evillique))。
* 修复 actions DAG 拆分的问题 [#61458](https://github.com/ClickHouse/ClickHouse/pull/61458)（[Raúl Marín](https://github.com/Algunenano)）。
* 修复在 RESTORE 失败后无法完成恢复的问题 [#61466](https://github.com/ClickHouse/ClickHouse/pull/61466) ([Vitaly Baranov](https://github.com/vitlibar)).
* 通过兼容性设置正确禁用 async&#95;insert&#95;use&#95;adaptive&#95;busy&#95;timeout [#61468](https://github.com/ClickHouse/ClickHouse/pull/61468)（[Raúl Marín](https://github.com/Algunenano)）。
* 在恢复池中支持排队 [#61475](https://github.com/ClickHouse/ClickHouse/pull/61475) ([Nikita Taranov](https://github.com/nickitat)).
* 修复使用 UUID 读取 system.parts 时的错误（issue 61220）。 [#61479](https://github.com/ClickHouse/ClickHouse/pull/61479) ([Dan Wu](https://github.com/wudanzy)).
* 修复 Window View 中的崩溃 [#61526](https://github.com/ClickHouse/ClickHouse/pull/61526)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修复 `repeat` 在使用非原生整数时的问题 [#61527](https://github.com/ClickHouse/ClickHouse/pull/61527)（[Antonio Andelic](https://github.com/antonio2368)）。
* 修复客户端 `-s` 参数 [#61530](https://github.com/ClickHouse/ClickHouse/pull/61530) ([Mikhail f. Shiryaev](https://github.com/Felixoid)).
* 修复 `arrayPartialReverseSort` 中的崩溃问题 [#61539](https://github.com/ClickHouse/ClickHouse/pull/61539)（[Raúl Marín](https://github.com/Algunenano)）。
* 修复带常量位置参数的字符串搜索 [#61547](https://github.com/ClickHouse/ClickHouse/pull/61547) ([Antonio Andelic](https://github.com/antonio2368)).
* 修复 `addDays` 与 `DateTime64` 类型一起使用时导致错误的问题 [#61561](https://github.com/ClickHouse/ClickHouse/pull/61561)（[Shuai li](https://github.com/loneylee)）。
* 修复异步插入去重场景下的 `system.part_log` [#61620](https://github.com/ClickHouse/ClickHouse/pull/61620) ([Antonio Andelic](https://github.com/antonio2368)).
* 修复 system.parts 中的未就绪（Non-ready）集合。[#61666](https://github.com/ClickHouse/ClickHouse/pull/61666) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
