---
slug: /cloud/get-started/cloud/use-cases/data_lake_and_warehouse
title: '数据湖仓'
description: '使用 ClickHouse Cloud 构建现代数据湖仓架构，将数据湖的灵活性与数据仓库级数据库性能相结合'
keywords: ['使用场景', '数据湖与数据仓库']
sidebar_label: '数据仓库'
doc_type: 'guide'
---

import Image from '@theme/IdealImage';
import datalakehouse_01 from '@site/static/images/cloud/onboard/discover/use_cases/datalakehouse_01.png';

<iframe width="758" height="426" src="https://www.youtube.com/embed/mueG6z1mo8Y" title="Data lakehouses (in under 3 minutes)" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen />

数据湖仓是一种融合架构，将数据库原理应用于数据湖基础设施，同时兼具云存储系统的灵活性和可扩展性。

湖仓并不是对数据库的简单拆分，而是在截然不同的基础（云对象存储）之上构建类似数据库的能力，旨在在统一的平台上同时支持传统分析和现代 AI/ML 工作负载。


## 数据湖仓由哪些组件构成？ \{#components-of-the-data-lakehouse\}

现代数据湖仓架构是一种将数据仓库与数据湖技术融合在一起的架构，结合了这两种方法的优点。
该架构由多个相互独立但彼此联通的层组成，为数据存储、管理和分析提供一个灵活且健壮的平台。

对于希望实施或优化数据湖仓战略的组织来说，理解这些组件至关重要。分层架构允许替换单独组件，并使各层能够独立演进，从而提升架构灵活性并增强方案的前瞻性。

下面将介绍典型数据湖仓架构的核心构建模块，以及它们如何协同工作以构建统一的数据管理平台。

<Image img={datalakehouse_01} alt="数据湖仓的组件" size="md"/>

| 组件                    | 描述                                                                                                                                                                                                                                                                                                                                           |
|-------------------------|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| **数据源（Data sources）**        | 湖仓的数据源包括业务数据库、流式平台、物联网（IoT）设备、应用日志以及外部数据提供方。                                                                                                                                                                                                                                                      |
| **查询引擎（Query engine）**        | 针对存储在对象存储中的数据执行分析查询，并利用表格式层提供的元数据和优化能力。支持 SQL 以及其他潜在的查询语言，以高效分析海量数据。                                                                                                                                                                                                       |
| **元数据目录（Metadata catalog）**    | [数据目录](https://clickhouse.com/engineering-resources/data-catalog) 作为元数据的集中式存储库，用于存储和管理表定义与模式、分区信息以及访问控制策略。支持在整个湖仓中进行数据发现、血缘跟踪和治理。                                                                                                                                        |
| **表格式层（Table format layer）**  | [表格式层](https://clickhouse.com/engineering-resources/open-table-formats) 负责将数据文件按逻辑组织为表，提供类似数据库的特性，如 ACID 事务、模式约束与演进、时间穿梭能力，以及诸如数据跳过和聚簇等性能优化。                                                                                                                              |
| **对象存储（Object storage）**      | 该层为所有数据文件和元数据提供可扩展、持久且具成本效益的存储。负责以开放格式实现数据的物理持久化，使多个工具和系统能够直接访问这些数据。                                                                                                                                                                                                   |
| **客户端应用（Client applications）** | 各类连接到湖仓以查询数据、可视化洞察或构建数据产品的工具和应用。这些可以包括 BI 工具、数据科学笔记本、自定义应用以及 ETL/ELT 工具。                                                                                                                                                                                                     |



## 数据湖仓有哪些优势？ \{#benefits-of-the-data-lakehouse\}

与传统数据仓库和数据湖直接对比时，数据湖仓架构具备多项显著优势：

### 与传统数据仓库对比 \{#compared-to-traditional-data-warehouses\}

| # | Benefit                                          | Description                                                                                                                                                                                                                                                                                                                                                                                                                                |
|---|--------------------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1 | **成本效益**                                     | 湖仓利用低成本的对象存储，而不是专有存储格式，与采用高价集成存储的数据仓库相比，可显著降低存储成本。                                                                                                                                                                                                                                                                                                                                 |
| 2 | **组件灵活性与可替换性**                         | 湖仓架构允许组织替换不同组件。传统系统在需求变化或技术演进时通常需要整体替换，而湖仓可以通过替换查询引擎或表格式等单个组件实现渐进式演化。这种灵活性减少了厂商锁定，并使组织能够在不引发大规模中断式迁移的情况下适应不断变化的需求。                                                                                                                                                                                             |
| 3 | **开放格式支持**                                 | 湖仓以 Parquet 等开放文件格式存储数据，允许各类工具直接访问，而不会像专有数据仓库格式那样将访问限制在其封闭生态中，从而避免厂商锁定。                                                                                                                                                                                                                                                                           |
| 4 | **AI/ML 集成**                                   | 湖仓为机器学习框架和 Python/R 库提供对数据的直接访问，而传统数据仓库通常需要先导出数据后才能用于高级分析。                                                                                                                                                                                                                                                                                                                     |
| 5 | **独立伸缩**                                     | 湖仓将存储与计算解耦，允许根据实际需求分别伸缩；而在许多数据仓库中，存储与计算往往需要同步扩缩。                                                                                                                                                                                                                                                                                                                                   |

### 与数据湖对比 \{#compared-to-data-lakes\}

| # | Benefit                     | Description                                                                                                                                                                                         |
|---|-----------------------------|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1 | **查询性能**                | 湖仓实现了索引、统计信息以及数据布局优化，使 SQL 查询能够达到与数据仓库相当的速度，从而克服原始数据湖查询性能较差的问题。                                                                                                          |
| 2 | **数据一致性**              | 通过对 ACID 事务的支持，湖仓在并发操作期间能够保证一致性，解决了传统数据湖在文件冲突时可能导致数据损坏的重大缺陷。                                                                                                                    |
| 3 | **模式管理**                | 湖仓强制进行模式（Schema）校验并跟踪模式演进，避免了数据湖中常见的“数据沼泽”问题，即由于模式不一致导致数据难以使用。                                                                                                                  |
| 4 | **治理能力**                | 湖仓在行/列级别提供细粒度访问控制和审计功能，从而弥补基础数据湖在安全控制方面的不足。                                                                                                                                                  |
| 5 | **BI 工具支持**             | 湖仓提供 SQL 接口和相关优化，使其能够兼容标准 BI 工具；而原始数据湖通常需要额外的处理层才能进行可视化。                                                                                                                               |



## ClickHouse 在数据湖仓架构中扮演什么角色？ \{#where-does-clickhouse-fit-in-the-data-lakehouse-architecture\}

ClickHouse 是现代数据湖仓生态系统中的一款强大的分析查询引擎，为组织在大规模数据分析方面提供了高性能选项。凭借卓越的查询速度和高效率，ClickHouse 成为极具吸引力的选择。

在湖仓架构中，ClickHouse 作为一个专门的处理层，能够灵活地与底层数据交互。它可以直接查询存储在云对象存储系统（如 S3、Azure Blob Storage 或 Google Cloud Storage）中的 Parquet 文件，利用其优化的列式处理能力，即使在超大规模数据集上也能快速返回结果。这种直接查询能力使组织能够在无需复杂数据搬迁或转换流程的情况下分析其湖中数据。

对于更复杂的数据管理需求，ClickHouse 可以与 Apache Iceberg、Delta Lake 或 Apache Hudi 等开放表格式集成。这种集成使 ClickHouse 能够利用这些格式的高级特性，同时依然提供其广为人知的卓越查询性能。组织既可以直接集成这些表格式，也可以通过 AWS Glue、Unity 或其他元数据目录服务进行连接。

通过在湖仓架构中引入 ClickHouse 作为查询引擎，组织可以在保持湖仓方法所强调的灵活性与开放性的同时，对其数据湖运行极其快速的分析查询。这种组合在不牺牲湖仓模型核心优势（包括组件可互换性、开放格式以及统一数据管理）的前提下，提供了专用分析型数据库级别的性能特性。



## 混合架构：两全其美 \{#hybrid-architecture-the-best-of-both-worlds\}

虽然 ClickHouse 在查询 lakehouse 组件方面表现出色，但其高度优化的
存储引擎还带来了额外优势。对于需要超低延迟查询的用例——例如实时仪表盘、
运营分析或交互式用户体验——组织可以有选择地将对性能要求极高的数据
直接以 ClickHouse 原生格式进行存储。这种混合方法实现了两全其美：
在处理对时效性要求极高的分析时，可以利用 ClickHouse 专用存储实现无与伦比的
查询速度，同时在需要时仍可灵活查询更广泛的数据 lakehouse。

这种双重能力使组织能够实施分层数据策略：将热点、高频访问的数据
保存在 ClickHouse 的优化存储中，以实现亚秒级查询响应，同时在 lakehouse 中
依然保持对完整数据历史的无缝访问。团队可以基于性能需求而非技术限制做出架构决策，
既将 ClickHouse 用作关键负载的闪电般快速分析型数据库，又将其作为面向更广泛数据生态的
灵活查询引擎。
