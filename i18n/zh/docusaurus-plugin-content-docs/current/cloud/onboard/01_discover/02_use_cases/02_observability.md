---
slug: /cloud/get-started/cloud/use-cases/observability
title: '可观测性'
description: '在分布式应用中使用 ClickHouse Cloud 实现可观测性、监控、日志记录和系统性能分析'
keywords: ['use cases', 'observability']
sidebar_label: '可观测性'
doc_type: 'guide'
---

<iframe width="758" height="426" src="https://www.youtube.com/embed/eKlZoT6hPwI?si=Wyrft2T04E1v8US6" title="YouTube 视频播放器" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

现代软件系统非常复杂。微服务、云基础设施和分布式系统使得理解应用程序内部正在发生的情况变得愈发困难。当出现问题时，团队需要能够快速知道问题出在哪里以及为什么会发生。

这正是可观测性发挥作用之处。它已经从简单的系统监控演进为一种全面理解系统行为的方法。然而，要实现有效的可观测性并不容易——这不仅需要深入理解相关技术概念，还要应对组织层面的挑战。



## 什么是可观测性? {#what-is-observability}

可观测性是指通过检查系统的输出来了解其内部状态。
在软件系统中,这意味着通过应用程序和基础设施生成的数据来了解其内部运行情况。

该领域已经历了显著演进,可以通过两代不同的可观测性方法来理解。

第一代通常称为可观测性 1.0,围绕传统的"三大支柱"方法构建,即指标、日志和追踪。这种方法需要针对不同类型的遥测数据使用多个工具和数据存储。它通常要求工程师预先定义需要测量的内容,使得维护多个系统既昂贵又复杂。

现代可观测性,或称可观测性 2.0,采用了根本不同的方法。它基于为系统中的每个工作单元(例如一个 HTTP 请求和响应)收集广泛的结构化事件。这种方法捕获高基数数据,例如用户 ID、请求 ID、Git 提交哈希值、实例 ID、Kubernetes Pod 名称、特定路由参数和供应商事务 ID。一个经验法则是:如果某个元数据片段能够帮助我们理解系统的行为方式,就添加它。

这种丰富的数据收集使得无需预先定义指标即可动态切片和分析数据。团队可以从这些基础数据中派生出指标、追踪和其他可视化内容,从而能够回答关于系统行为的复杂问题,而这些问题在最初添加监测时可能并未预料到。

然而,实施现代可观测性能力也面临着挑战。组织需要可靠的方法来跨不同系统和技术收集、处理和导出这些丰富的遥测数据。虽然现代方法已经超越了传统界限,但理解可观测性的基本构建块仍然至关重要。


## 可观测性的三大支柱 {#three-pillars-of-observability}

为了更好地理解可观测性的演进过程及其实际应用,让我们来探讨可观测性的三大支柱——日志、指标和追踪。

尽管现代可观测性已经超越了将这些作为独立关注点的做法,但它们仍然是理解系统行为不同方面的基础概念。

1. **日志** - 记录系统内发生的离散事件的文本记录。
   这些记录提供了关于特定事件、错误和状态变化的详细上下文信息。
2. **指标** - 随时间收集的数值测量数据。包括计数器、
   仪表和直方图,用于跟踪系统性能、资源使用情况和业务关键绩效指标(KPI)。
3. **追踪** - 记录请求在分布式系统中流转的完整路径。
   这些记录有助于理解服务之间的关系并识别性能瓶颈。

这些支柱使团队能够监控、排查和优化其系统。
然而,真正的价值在于理解如何有效地收集、
分析和关联这三大支柱的数据,从而获得对系统行为的深入洞察。


## 可观测性的优势 {#the-benefits-of-observability}

虽然可观测性的技术层面——日志、指标和追踪——已被充分理解,但其业务价值同样值得重视。

在其著作 ["Observability Engineering"](https://clickhouse.com/engineering-resources/observability#:~:text=Observability%20Engineering)
(O'Reilly, 2022) 中,Charity Majors、Liz Fong-Jones 和 George Miranda 基于
行业研究和实际反馈,总结了组织实施适当可观测性实践可以获得的四项关键业务优势。
让我们来探讨这些优势:

### 更高的增量收入 {#higher-incremental-revenue}

作者指出,帮助团队提升正常运行时间和性能的可观测性工具可以通过改善代码质量来增加增量收入。
这体现在以下几个方面:

1. 改善客户体验:快速解决问题并防止服务降级可提高客户满意度和留存率
2. 提升系统可靠性:更高的正常运行时间意味着更多成功的交易和更少的业务机会损失
3. 增强性能:识别和优化性能瓶颈的能力有助于保持服务响应速度,从而维持客户参与度
4. 竞争优势:能够通过全面监控和快速问题解决来保持高服务质量的组织往往能够获得超越竞争对手的优势

### 通过更快的事件响应节省成本 {#cost-savings-from-faster-incident-response}

可观测性最直接的优势之一是通过更快地检测和解决问题来降低人力成本。这源于:

- 降低平均检测时间 (MTTD) 和平均解决时间 (MTTR)
- 改善查询响应时间,实现更快的问题调查
- 更快地识别性能瓶颈
- 减少待命时间
- 减少在不必要的回滚上浪费的资源

我们在实践中看到了这一点——[trip.com 使用 ClickHouse 构建了他们的可观测性系统](trip.com built their observability system with ClickHouse),
查询速度比之前的解决方案快 4-30 倍,90% 的查询在 300 毫秒内完成,从而实现了快速的问题调查。

### 通过避免事件节省成本 {#cost-savings-from-incidents-avoided}

可观测性不仅有助于更快地解决问题,还有助于完全预防问题。
作者强调团队可以通过以下方式预防关键问题:

- 在潜在问题变得严重之前识别它们
- 分析模式以防止问题重复发生
- 了解系统在不同条件下的行为
- 主动解决性能瓶颈
- 基于数据做出系统改进决策

ClickHouse 的[自有可观测性平台 LogHouse](https://clickhouse.com/blog/building-a-logging-platform-with-clickhouse-and-saving-millions-over-datadog)
展示了这一点。它使我们的核心工程师能够跨所有集群搜索历史模式,有助于防止问题重复发生。

### 通过降低员工流失率节省成本 {#cost-savings-from-decreased-employee-churn}

最容易被忽视的优势之一是对团队满意度和留存率的影响。
作者强调可观测性如何带来:

- 通过更好的工具提高工作满意度
- 通过减少未解决的问题降低开发人员的倦怠感
- 通过更好的信噪比减少告警疲劳
- 通过更好的事件管理降低待命压力
- 提高团队对系统可靠性的信心

我们在实践中看到了这一点——当 [Fastly 迁移到 ClickHouse](https://clickhouse.com/videos/scaling-graphite-with-clickhouse) 时,
他们的工程师对查询性能的提升感到惊讶,并指出:

> "我简直不敢相信。我实际上不得不返回几次,只是为了
> 确保我的查询方式正确……返回速度太快了。
> 这说不通。"

正如作者所强调的,虽然这些优势的具体衡量标准可能因工具和实施方式而异,但采用强大可观测性实践的组织都可以期待这些基本改进。关键在于有效地选择和实施正确的工具,以最大化这些优势。

实现这些优势需要克服几个重大障碍。即使是理解可观测性价值的组织也经常发现,实施过程会带来必须谨慎应对的意外复杂性和挑战。


## 实施可观测性的挑战 {#challenges-in-implementing-observability}

在组织内实施可观测性是深入了解系统性能和可靠性的变革性步骤。然而,这一过程并非一帆风顺。当组织努力充分发挥可观测性的潜力时,会遇到各种可能阻碍进展的障碍。让我们来了解其中一些挑战。

### 数据量和可扩展性 {#data-volume-and-scalability}

实施可观测性的主要障碍之一是管理现代系统生成的海量遥测数据及其可扩展性问题。随着组织的发展,需要监控的数据也随之增长,这需要能够高效处理大规模数据摄取和实时分析的解决方案。

### 与现有系统的集成 {#integration-with-existing-systems}

与现有系统的集成是另一个重大挑战。许多组织在异构环境中运行,使用多样化的技术,这使得可观测性工具必须与当前基础设施无缝集成。开放标准对于促进这种集成至关重要,可确保互操作性并降低在不同技术栈中部署可观测性解决方案的复杂性。

### 技能差距 {#skill-gaps}

技能差距也可能阻碍可观测性的成功实施。向高级可观测性解决方案的过渡通常需要数据分析和特定工具的专业知识。团队可能需要投资于培训或招聘来弥补这些差距,并充分利用其可观测性平台的能力。

### 成本管理 {#cost-management}

成本管理至关重要,因为可观测性解决方案可能变得昂贵,尤其是在大规模部署时。组织必须在这些工具的成本与其提供的价值之间取得平衡,寻求与传统方法相比能够显著节省成本的经济高效解决方案。

### 数据保留和存储 {#data-retention-and-storage}

数据保留和存储管理带来了额外的挑战。在不影响性能或洞察的情况下决定保留可观测性数据的时长需要仔细规划,以及能够在保持数据可访问性的同时减少存储需求的高效存储解决方案。

### 标准化和供应商锁定 {#standardization-and-vendor-lock-in}

确保标准化和避免供应商锁定对于保持可观测性解决方案的灵活性和适应性至关重要。通过遵循开放标准,组织可以避免被绑定到特定供应商,并确保其可观测性技术栈能够随着需求而演进。

### 安全性和合规性 {#security-and-compliance}

安全性和合规性考虑仍然至关重要,尤其是在可观测性系统中处理敏感数据时。组织必须确保其可观测性解决方案遵守相关法规并有效保护敏感信息。

这些挑战凸显了在实施能够有效满足组织需求的可观测性解决方案时,战略规划和明智决策的重要性。

为了应对这些挑战,组织需要采用结构良好的方法来实施可观测性。标准可观测性管道已经发展成为一个有效收集、处理和分析遥测数据的框架。这一演进最早且最具影响力的例子之一来自 Twitter 在 2013 年的经验。
