---
slug: /cloud/get-started/cloud/use-cases/observability
title: '可观测性'
description: '使用 ClickHouse Cloud 实现分布式应用的可观测性、监控、日志记录和系统性能分析'
keywords: ['使用场景', '可观测性']
sidebar_label: '可观测性'
doc_type: 'guide'
---

<iframe width="758" height="426" src="https://www.youtube.com/embed/eKlZoT6hPwI?si=Wyrft2T04E1v8US6" title="YouTube 视频播放器" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

现代软件系统非常复杂。微服务、云基础设施以及分布式系统让我们越来越难以理解应用程序内部到底发生了什么。当出现问题时，团队需要尽快弄清楚问题发生在哪里、为什么会发生。

此时就需要可观测性。它已经从简单的系统监控演进为全面理解系统行为的方法。然而，构建有效的可观测性体系并非易事——这既需要理解技术概念，也需要应对组织层面的挑战。



## 什么是可观测性？ {#what-is-observability}

可观测性是指通过检查系统的输出，来理解其内部状态。
在软件系统中，这意味着通过应用和基础设施生成的数据，来理解系统内部正在发生什么。

这一领域已经经历了显著演进，可以通过两代不同的可观测性方法来理解。

第一代常被称为 Observability 1.0，它围绕传统的指标（metrics）、日志（logs）和追踪（traces）这“三大支柱”方法构建。
这种方法需要为不同类型的遥测数据使用多个工具和数据存储。
它通常迫使工程师预先定义他们想要度量的内容，从而使维护多个系统变得既昂贵又复杂。

现代可观测性（Observability 2.0）采取了截然不同的方法。
它基于为系统中每个工作单元（例如一次 HTTP 请求及其响应）收集宽、结构化的事件。
这种方法会捕获高基数的数据，例如用户 ID、请求 ID、Git 提交哈希、实例 ID、Kubernetes pod（容器组）名称、特定路由参数以及供应商交易 ID。
一个经验法则是：如果某条元数据可能有助于我们理解系统行为，就应该把它加入进来。

这种丰富的数据采集使得在无需预先定义指标的情况下，对数据进行动态切分和分析成为可能。
团队可以从这些基础数据中派生出指标、追踪以及其他可视化内容，从而能够回答在最初添加观测时尚未预料到的复杂系统行为问题。

然而，实现现代可观测性能力本身也存在挑战。
组织需要可靠的方法，在多样化的系统和技术栈中收集、处理和导出这些丰富的遥测数据。
尽管现代方法已经超越了传统边界，但理解可观测性的基本构成要素仍然至关重要。



## 可观测性的三大支柱 {#three-pillars-of-observability}

为了更好地理解可观测性是如何演进以及在实践中如何运作的，我们来
考察可观测性的三大支柱——logs、metrics 和 traces。

尽管现代可观测性已经不再将它们视为彼此独立的关注点，
但它们依然是理解系统行为不同方面的基础概念。

1. **Logs** - 系统内部发生的离散事件的文本记录。
这些数据为特定事件、错误以及状态变化提供详细上下文。
2. **Metrics** - 随时间收集的数值型测量数据。包括计数器（counter）、
仪表（gauge）和直方图（histogram），用于跟踪系统性能、资源使用情况以及业务 KPI。
3. **Traces** - 记录请求在分布式系统中传递路径的数据。
这些数据有助于理解服务之间的关系并识别性能瓶颈。

这三大支柱使团队能够监控、排障并优化其系统。
然而，真正的价值在于理解如何有效地跨这三大支柱收集、
分析并关联数据，从而获得对系统行为有价值的洞察。



## 可观测性的收益 {#the-benefits-of-observability}

虽然可观测性的技术要素——logs、metrics 和 traces——已经广为人知，但从业务角度审视其带来的收益同样至关重要。

在他们的著作 ["Observability Engineering"](https://clickhouse.com/engineering-resources/observability#:~:text=Observability%20Engineering) 
（O'Reilly，2022）中，Charity Majors、Liz Fong-Jones 和 George Miranda 基于行业研究和一线反馈，总结出组织在实施完善的可观测性实践后可以预期获得的四大关键业务收益。
我们来逐一分析这些收益：

### 更高的增量收入 {#higher-incremental-revenue}

作者指出，通过帮助团队提升可用性和性能的可观测性工具，可以通过改善代码质量带来更高的增量收入。
这主要体现在以下几个方面：

1. 改善客户体验：快速解决问题并防止服务退化，可提升客户满意度和留存率
2. 提高系统可靠性：更好的可用性意味着更多成功交易和更少的业务流失
3. 性能增强：及时识别并优化性能瓶颈，有助于保持服务响应灵敏，从而持续吸引用户使用
4. 竞争优势：能够通过全面监控和快速问题解决来维持高服务质量的组织，往往能在竞争中取得优势

### 通过更快速的故障响应实现成本节约 {#cost-savings-from-faster-incident-response}

可观测性最直接的收益之一，是通过更快地发现和解决问题来降低人力成本。主要体现在：

* 降低平均发现时间（MTTD）和平均恢复时间（MTTR）
* 改善查询响应时间，从而加快问题排查
* 更快地识别性能瓶颈
* 减少值班（on-call）投入的时间
* 降低因不必要回滚而浪费的资源

这一点在实践中已有体现——[trip.com 使用 ClickHouse 构建了他们的可观测性系统](trip.com built their observability system with ClickHouse)，
查询速度相比此前方案提升了 4–30 倍，90% 的查询在 300ms 内完成，大幅提升了问题排查效率。

### 通过避免故障实现成本节约 {#cost-savings-from-incidents-avoided}

可观测性不仅仅是帮助更快解决问题——还可以帮助从根本上预防问题发生。
作者强调团队可以通过以下方式来避免关键故障：

* 在问题演变为严重事故之前识别潜在风险
* 分析模式以防止问题反复出现
* 理解系统在不同条件下的行为特征
* 主动解决性能瓶颈
* 基于数据驱动做出系统改进决策

ClickHouse [自研的可观测性平台 LogHouse](https://clickhouse.com/blog/building-a-logging-platform-with-clickhouse-and-saving-millions-over-datadog) 就是一个示例。
它使我们的核心工程师可以在所有集群上检索历史模式，从而帮助预防重复性问题。

### 通过降低员工流失率实现成本节约 {#cost-savings-from-decreased-employee-churn}

最容易被忽视的收益之一，是其对团队满意度和留存率的影响。
作者指出，可观测性可以带来：

* 通过更好的工具提升工作满意度
* 由于未解决问题减少而降低开发者倦怠
* 通过更佳的信噪比减少告警疲劳
* 通过更高效的故障管理降低值班压力
* 提升团队对系统可靠性的信心

这一点在实践中同样可见——当 [Fastly 迁移到 ClickHouse](https://clickhouse.com/videos/scaling-graphite-with-clickhouse) 时，
他们的工程师对查询性能的改进感到惊讶，并表示：

> “我简直不敢相信。我实际上不得不回头检查了好几次，确认自己是不是在正确地查询……返回得太快了。完全说不通。”

正如作者强调的那样，尽管这些收益的具体量化指标会因工具和实施方式而异，但对于采用了稳健可观测性实践的组织而言，这些根本性改进是可以预期的。
关键在于有效选择并部署合适的工具，以最大化这些收益。

要获得这些收益，需要跨越若干重大障碍。即使是已经理解可观测性价值的组织，也常常会发现，在落地过程中会出现诸多意料之外的复杂性和挑战，需要谨慎应对与化解。



## 实施可观测性中的挑战 {#challenges-in-implementing-observability}

在组织内部实施可观测性，是迈向更深入洞察系统性能与可靠性的具有变革意义的一步。然而，这一过程并非没有挑战。随着组织努力挖掘可观测性的全部潜力，往往会遇到各种可能阻碍进展的障碍。下面逐一进行说明。

### 数据量与可扩展性 {#data-volume-and-scalability}

实施可观测性的主要障碍之一，是管理现代系统产生的海量遥测数据及其可扩展性。随着组织的增长，需要监控的数据量也随之增加，从而需要能够高效处理大规模数据摄取和实时分析的解决方案。

### 与现有系统集成 {#integration-with-existing-systems}

与现有系统的集成是另一个重要挑战。许多组织运行在由多种技术组成的异构环境中，这就要求可观测性工具必须能够与当前基础设施无缝集成。开放标准对于促进这种集成至关重要，它们确保互操作性，并降低在不同技术栈上部署可观测性解决方案的复杂度。

### 技能差距 {#skill-gaps}

技能差距同样可能阻碍可观测性的成功实施。向高级可观测性解决方案的转变，往往需要具备数据分析和特定工具方面的专业知识。团队可能需要在培训或招聘上投入，以弥补这些差距，从而充分发挥其可观测性平台的能力。

### 成本管理 {#cost-management}

成本管理至关重要，因为可观测性解决方案的费用可能会变得非常高，尤其是在大规模场景下。组织必须在这些工具的成本与其带来的价值之间取得平衡，寻求相较于传统方法具有显著成本节约、且具备高性价比的解决方案。

### 数据保留与存储 {#data-retention-and-storage}

数据保留和存储管理带来了额外的挑战。在不影响性能或洞察质量的前提下，决定可观测性数据保留多长时间，需要周密规划，并依赖高效的存储解决方案，以在保持数据可访问性的同时减少存储需求。

### 标准化与厂商锁定 {#standardization-and-vendor-lock-in}

确保标准化并避免厂商锁定，对于保持可观测性解决方案的灵活性和适应性至关重要。通过遵循开放标准，组织可以避免被绑定到特定厂商，并确保其可观测性技术栈能够随自身需求演进。

### 安全与合规 {#security-and-compliance}

安全与合规考量始终至关重要，尤其是在可观测性系统中处理敏感数据时。组织必须确保其可观测性解决方案遵循相关法规，并能够有效保护敏感信息。

这些挑战强调了在实施可观测性解决方案时进行战略性规划和知情决策的重要性，以有效满足组织需求。

为应对这些挑战，组织需要一个结构清晰的可观测性实施路径。标准的可观测性管道已经演进，提供了一个用于高效收集、处理和分析遥测数据的框架。这一演进中最早且最具影响力的示例之一，来自 Twitter 在 2013 年的实践经验。
