---
sidebar_label: 'SQL 语法对照参考'
slug: /migrations/snowflake-translation-reference
description: 'SQL 语法对照参考'
keywords: ['Snowflake']
title: '从 Snowflake 迁移到 ClickHouse'
show_related_blogs: true
doc_type: '指南'
---



# Snowflake SQL 转换指南



## 数据类型 {#data-types}

### 数值类型 {#numerics}

在 ClickHouse 和 Snowflake 之间迁移数据的用户会立即注意到,ClickHouse 在声明数值类型时提供了更精细的精度控制。例如,Snowflake 为数值提供了 Number 类型,要求用户指定精度(总位数)和标度(小数点右侧的位数),总计最多 38 位。整数声明与 Number 同义,只是定义了固定的精度和标度,其范围相同。这种便利性是可能的,因为修改精度(对于整数,标度为 0)不会影响 Snowflake 中磁盘上的数据大小——在写入时,在微分区级别使用数值范围所需的最小字节数。然而,标度确实会影响存储空间,并通过压缩进行抵消。`Float64` 类型提供了更宽的数值范围,但会损失精度。

相比之下,ClickHouse 为浮点数和整数提供了多种有符号和无符号精度。通过这些类型,ClickHouse 用户可以明确指定整数所需的精度,以优化存储和内存开销。Decimal 类型等同于 Snowflake 的 Number 类型,还提供了两倍的精度和标度,达到 76 位。除了类似的 `Float64` 值外,ClickHouse 还提供了 `Float32`,用于精度不太关键而压缩至关重要的场景。

### 字符串类型 {#strings}

ClickHouse 和 Snowflake 在字符串数据存储方面采用了截然不同的方法。Snowflake 中的 `VARCHAR` 以 UTF-8 格式保存 Unicode 字符,允许用户指定最大长度。此长度对存储或性能没有影响,始终使用最小字节数来存储字符串,而只是为下游工具提供有用的约束。其他类型,如 `Text` 和 `NChar`,只是此类型的别名。相反,ClickHouse 使用 `String` 类型将所有[字符串数据存储为原始字节](/sql-reference/data-types/string)(无需指定长度),将编码交由用户处理,并提供适用于不同编码的[查询时函数](/sql-reference/functions/string-functions#lengthUTF8)。我们建议读者参阅["不透明数据参数"](https://utf8everywhere.org/#cookie)以了解其动机。因此,ClickHouse 的 `String` 在实现上更类似于 Snowflake 的 Binary 类型。[Snowflake](https://docs.snowflake.com/en/sql-reference/collation) 和 [ClickHouse](/sql-reference/statements/select/order-by#collation-support) 都支持"排序规则",允许用户自定义字符串的排序和比较方式。

### 半结构化类型 {#semi-structured-data}

Snowflake 支持用于半结构化数据的 `VARIANT`、`OBJECT` 和 `ARRAY` 类型。

ClickHouse 提供了等效的 [`Variant`](/sql-reference/data-types/variant)、`Object`(现已弃用,推荐使用原生 `JSON` 类型)和 [`Array`](/sql-reference/data-types/array) 类型。此外,ClickHouse 还有 [`JSON`](/sql-reference/data-types/newjson) 类型,它取代了现已弃用的 `Object('json')` 类型,并且在[与其他原生 JSON 类型的比较](https://jsonbench.com/)中表现出特别高的性能和存储效率。

ClickHouse 还通过 [`Nested`](/sql-reference/data-types/nested-data-structures/nested) 类型支持命名的 [`Tuple`](/sql-reference/data-types/tuple) 和 Tuple 数组,允许用户显式映射嵌套结构。这使得编解码器和类型优化可以应用于整个层次结构,而 Snowflake 则要求用户对外部对象使用 `OBJECT`、`VARIANT` 和 `ARRAY` 类型,并且不允许[显式的内部类型定义](https://docs.snowflake.com/en/sql-reference/data-types-semistructured#characteristics-of-an-object)。这种内部类型定义还简化了 ClickHouse 中对嵌套数值的查询,这些数值无需进行类型转换,并且可以在索引定义中使用。

在 ClickHouse 中,编解码器和优化类型也可以应用于子结构。这提供了一个额外的好处,即嵌套结构的压缩效果保持优异,并且与扁平化数据相当。相比之下,由于无法对子结构应用特定类型,Snowflake 建议[扁平化数据以实现最佳压缩](https://docs.snowflake.com/en/user-guide/semistructured-considerations#storing-semi-structured-data-in-a-variant-column-vs-flattening-the-nested-structure)。Snowflake 还对这些数据类型[施加了大小限制](https://docs.snowflake.com/en/user-guide/semistructured-considerations#data-size-limitations)。


### 类型参考 {#type-reference}


| Snowflake                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | ClickHouse                                                                                                                     | 注意                                                                                                                                                                                                     |   |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ | - |
| [`NUMBER`](https://docs.snowflake.com/en/sql-reference/data-types-numeric)                                                                                                                                                                                                                                                                                                                                                                                                      | [`Decimal`](/sql-reference/data-types/decimal)                                                                                 | ClickHouse 支持的精度和小数位数是 Snowflake 的两倍——76 位数字，对比 38 位数字。                                                                                                                                                |   |
| [`FLOAT`, `FLOAT4`, `FLOAT8`](https://docs.snowflake.com/en/sql-reference/data-types-numeric#data-types-for-floating-point-numbers)                                                                                                                                                                                                                                                                                                                                             | [`Float32`, `Float64`](/sql-reference/data-types/float)                                                                        | 在 Snowflake 中，所有浮点数均为 64 位。                                                                                                                                                                            |   |
| [`VARCHAR`](https://docs.snowflake.com/en/sql-reference/data-types-text#varchar)                                                                                                                                                                                                                                                                                                                                                                                                | [`String`](/sql-reference/data-types/string)                                                                                   |                                                                                                                                                                                                        |   |
| [`BINARY`](https://docs.snowflake.com/en/sql-reference/data-types-text#binary)                                                                                                                                                                                                                                                                                                                                                                                                  | [`String`](/sql-reference/data-types/string)                                                                                   |                                                                                                                                                                                                        |   |
| [`BOOLEAN`](https://docs.snowflake.com/en/sql-reference/data-types-logical)                                                                                                                                                                                                                                                                                                                                                                                                     | [`Bool`](/sql-reference/data-types/boolean)                                                                                    |                                                                                                                                                                                                        |   |
| [`DATE`](https://docs.snowflake.com/en/sql-reference/data-types-datetime#date)                                                                                                                                                                                                                                                                                                                                                                                                  | [`Date`](/sql-reference/data-types/date), [`Date32`](/sql-reference/data-types/date32)                                         | Snowflake 中的 `DATE` 提供的日期范围比 ClickHouse 更大，例如，`Date32` 的最小值为 `1900-01-01`，而 `Date` 的最小值为 `1970-01-01`。ClickHouse 中的 `Date` 提供了更具成本效益的（两字节）存储。                                                          |   |
| [`TIME(N)`](https://docs.snowflake.com/en/sql-reference/data-types-datetime#time)                                                                                                                                                                                                                                                                                                                                                                                               | 没有完全对应的类型，但可以用 [`DateTime`](/sql-reference/data-types/datetime) 和 [`DateTime64(N)`](/sql-reference/data-types/datetime64) 来表示。 | `DateTime64` 采用相同的精度概念。                                                                                                                                                                                |   |
| [`TIMESTAMP`](https://docs.snowflake.com/en/sql-reference/data-types-datetime#timestamp) - [`TIMESTAMP_LTZ`](https://docs.snowflake.com/en/sql-reference/data-types-datetime#timestamp-ltz-timestamp-ntz-timestamp-tz), [`TIMESTAMP_NTZ`](https://docs.snowflake.com/en/sql-reference/data-types-datetime#timestamp-ltz-timestamp-ntz-timestamp-tz), [`TIMESTAMP_TZ`](https://docs.snowflake.com/en/sql-reference/data-types-datetime#timestamp-ltz-timestamp-ntz-timestamp-tz) | [`DateTime`](/sql-reference/data-types/datetime) 和 [`DateTime64`](/sql-reference/data-types/datetime64)                        | `DateTime` 和 `DateTime64` 列可以可选地指定一个 TZ 参数。若未指定，则使用服务器的时区。此外，客户端还可以使用 `--use_client_time_zone` 参数。                                                                                                     |   |
| [`VARIANT`](https://docs.snowflake.com/en/sql-reference/data-types-semistructured#variant)                                                                                                                                                                                                                                                                                                                                                                                      | [`JSON`, `Tuple`, `Nested`](/interfaces/formats)                                                                               | `JSON` 类型在 ClickHouse 中仍为实验特性。该类型会在插入数据时推断列类型。`Tuple`、`Nested` 和 `Array` 也可以作为替代，用于构建具有显式类型的结构。                                                                                                        |   |
| [`OBJECT`](https://docs.snowflake.com/en/sql-reference/data-types-semistructured#object)                                                                                                                                                                                                                                                                                                                                                                                        | [`Tuple`, `Map`, `JSON`](/interfaces/formats)                                                                                  | `OBJECT` 和 `Map` 都类似于 ClickHouse 中的 `JSON` 类型，其中键为 `String`。ClickHouse 要求各个键对应的值在类型上保持一致并且是强类型的，而 Snowflake 使用 `VARIANT`，这意味着不同键的值可以是不同的类型。如果在 ClickHouse 中需要这种行为，请使用 `Tuple` 明确定义层级结构，或使用 `JSON` 类型。` |   |
| [`ARRAY`](https://docs.snowflake.com/en/sql-reference/data-types-semistructured#array)                                                                                                                                                                                                                                                                                                                                                                                          | [`Array`](/sql-reference/data-types/array), [`Nested`](/sql-reference/data-types/nested-data-structures/nested)                | Snowflake 中的 `ARRAY` 对其元素使用 `VARIANT`（一种超类型）。而在 ClickHouse 中，这些则是强类型的。                                                                                                                                 |   |
| [`GEOGRAPHY`](https://docs.snowflake.com/en/sql-reference/data-types-geospatial#geography-data-type)                                                                                                                                                                                                                                                                                                                                                                            | [`Point`, `Ring`, `Polygon`, `MultiPolygon`](/sql-reference/data-types/geo)                                                    | Snowflake 会强制指定坐标系（WGS 84），而 ClickHouse 则在查询时才应用坐标系。                                                                                                                                                   |   |
| [`GEOMETRY`](https://docs.snowflake.com/en/sql-reference/data-types-geospatial#geometry-data-type)                                                                                                                                                                                                                                                                                                                                                                              | [`Point`, `Ring`, `Polygon`, `MultiPolygon`](/sql-reference/data-types/geo)                                                    |                                                                                                                                                                                                        |   |



| ClickHouse Type   | Description                                                                                         |
|-------------------|-----------------------------------------------------------------------------------------------------|
| `IPv4` and `IPv6` | IP 专用类型，相比 Snowflake 可能实现更高效的存储。                                                     |
| `FixedString`     | 允许使用固定长度的字节数，对存储哈希值非常有用。                                                      |
| `LowCardinality`  | 允许对任意类型进行字典编码。当预期基数小于 100k 时非常有用。                                         |
| `Enum`            | 允许在 8 位或 16 位范围内对具名值进行高效编码。                                                       |
| `UUID`            | 用于高效存储 UUID。                                                                                 |
| `Array(Float32)`  | 向量可以表示为由 Float32 组成的 Array，并支持距离函数。                                              |

最后，ClickHouse 提供了一个独特的能力，即可以存储聚合函数的中间
[状态](/sql-reference/data-types/aggregatefunction)。该
state 的内部表示与具体实现相关，但允许将聚合的中间结果存储起来，并在之后通过对应的合并函数进行查询。通常，
此功能通过物化视图来使用，并且如下面演示的那样，通过
存储针对插入数据的查询的增量结果，可以在仅增加极少存储成本的情况下，
提升特定查询的性能（更多细节见后文）。
