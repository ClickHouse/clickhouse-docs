---
slug: /use-cases/observability/clickstack/migration/elastic/types
title: '映射类型'
pagination_prev: null
pagination_next: null
sidebar_label: '类型'
sidebar_position: 2
description: 'ClickHouse 与 Elasticsearch 中的映射类型'
show_related_blogs: true
keywords: ['JSON', 'Codecs']
doc_type: 'reference'
---

Elasticsearch 和 ClickHouse 支持的 数据类型非常丰富，但它们底层的存储和查询模型有着本质差异。本节将常用的 Elasticsearch 字段类型映射到对应的 ClickHouse 类型（在有对应类型时），并提供相关背景信息以辅助迁移工作。对于没有直接等价类型的情况，会在注释中给出替代方案或说明。



| **Elasticsearch 类型**                   | **ClickHouse 中的等价项**                                                                                                                                                                                                                                                                                                                           | **注释**                                                                                                                                                                                                                                                    |
| -------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | --------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `boolean`                              | [`UInt8`](/sql-reference/data-types/int-uint)或[`Bool`](/sql-reference/data-types/boolean)                                                                                                                                                                                                                                                      | ClickHouse 支持`Boolean`作为…的别名`UInt8`在更新的版本中。                                                                                                                                                                                                               |
| `keyword`                              | [`String`](/sql-reference/data-types/string)                                                                                                                                                                                                                                                                                                   | 用于精确匹配的过滤、分组和排序。                                                                                                                                                                                                                                          |
| `text`                                 | [`String`](/sql-reference/data-types/string)                                                                                                                                                                                                                                                                                                   | ClickHouse 对全文搜索的支持有限；分词需要借助如下函数自定义实现，例如`tokens`与数组函数结合使用。                                                                                                                                                                                                |
| `long`                                 | [`Int64`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                                                                                  | 64 位有符号整数。                                                                                                                                                                                                                                                |
| `integer`                              | [`Int32`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                                                                                  | 32 位有符号整数。                                                                                                                                                                                                                                                |
| `short`                                | [`Int16`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                                                                                  | 16 位带符号整数。                                                                                                                                                                                                                                                |
| `byte`                                 | [`Int8`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                                                                                   | 8 位有符号整数。                                                                                                                                                                                                                                                 |
| `unsigned_long`                        | [`UInt64`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                                                                                 | 无符号 64 位整数。                                                                                                                                                                                                                                               |
| `double`                               | [`Float64`](/sql-reference/data-types/float)                                                                                                                                                                                                                                                                                                   | 64 位浮点数。                                                                                                                                                                                                                                                  |
| `float`                                | [`Float32`](/sql-reference/data-types/float)                                                                                                                                                                                                                                                                                                   | 32 位浮点数。                                                                                                                                                                                                                                                  |
| `half_float`                           | [`Float32`](/sql-reference/data-types/float)或[`BFloat16`](/sql-reference/data-types/float)                                                                                                                                                                                                                                                     | 最接近的等价类型。ClickHouse 不支持 16 位浮点数。ClickHouse 有一个`BFloat16`- 这不同于 IEEE-754 半精度浮点数：half-float 在较小取值范围内提供更高精度，而 bfloat16 牺牲精度以换取更大的取值范围，因此更适合机器学习工作负载。                                                                                                         |
| `scaled_float`                         | [`Decimal(x, y)`](/sql-reference/data-types/decimal)                                                                                                                                                                                                                                                                                           | 存储定点数。                                                                                                                                                                                                                                                    |
| `date`                                 | [`DateTime`](/sql-reference/data-types/datetime)                                                                                                                                                                                                                                                                                               | 等价的秒级精度日期类型。                                                                                                                                                                                                                                              |
| `date_nanos`                           | [`DateTime64`](/sql-reference/data-types/datetime64)                                                                                                                                                                                                                                                                                           | ClickHouse 支持使用 `DateTime64(9)` 表达纳秒级精度。`DateTime64(9)`ClickHouse 通过 `DateTime64(9)` 类型支持纳秒级精度。                                                                                                                                                           |
| `binary`                               | [`String`](/sql-reference/data-types/string),[`FixedString(N)`](/sql-reference/data-types/fixedstring)                                                                                                                                                                                                                                         | 需要对二进制字段进行 base64 解码。                                                                                                                                                                                                                                     |
| `ip`                                   | [`IPv4`](/sql-reference/data-types/ipv4)IPv4、IPv6[`IPv6`](/sql-reference/data-types/ipv6)                                                                                                                                                                                                                                                      | 本地`IPv4`和`IPv6`支持原生 `IPv4` 和 `IPv6` 类型。                                                                                                                                                                                                                   |
| `object`                               | [`Nested`](/sql-reference/data-types/nested-data-structures/nested),[`Map`](/sql-reference/data-types/map)，[`Tuple`](/sql-reference/data-types/tuple)，[`JSON`](/sql-reference/data-types/newjson)                                                                                                                                              | ClickHouse 可以通过以下方式对类 JSON 对象建模：[`Nested`](/sql-reference/data-types/nested-data-structures/nested)或[`JSON`](/sql-reference/data-types/newjson)ClickHouse 可以使用 `Nested` 或 `JSON` 来对类 JSON 对象建模。                                                           |
| `flattened`                            | [`String`](/sql-reference/data-types/string)                                                                                                                                                                                                                                                                                                   | Elasticsearch 中的 `flattened` 类型将整个 JSON 对象存储为单个字段，从而在无需完整映射的情况下，实现对嵌套键的灵活、无模式访问。在 ClickHouse 中，可以通过使用 `String` 类型实现类似的功能，但需要配合物化视图进行处理。                                                                                                                   |
| `nested`                               | [`Nested`](/sql-reference/data-types/nested-data-structures/nested)                                                                                                                                                                                                                                                                            | ClickHouse`Nested`列在分组子字段时提供类似的语义，前提是用户使用`flatten_nested=0`在假定用户使用 `flatten_nested=0` 的前提下，ClickHouse 的 `Nested` 列为一组子字段提供了与其类似的语义。                                                                                                                       |
| `join`                                 | 无                                                                                                                                                                                                                                                                                                                                              | 没有直接的父子关系概念。在 ClickHouse 中不需要这一概念，因为支持跨表 JOIN。                                                                                                                                                                                                            |
| `alias`                                | [`Alias`](/sql-reference/statements/create/table#alias)列修改符                                                                                                                                                                                                                                                                                    | 别名[支持](/sql-reference/statements/create/table#alias)通过字段修饰符来实现。可以对这些别名应用函数，例如：`size String ALIAS formatReadableSize(size_bytes)`                                                                                                                          |
| `range``range` 类型（`*_range`）`*_range`) | [`Tuple(start, end)`](/sql-reference/data-types/tuple)或[`Array(T)`](/sql-reference/data-types/array)                                                                                                                                                                                                                                           | ClickHouse 没有原生的范围类型，但数值和日期范围可以使用[`Tuple(start, end)`](/sql-reference/data-types/tuple)或[`Array`](/sql-reference/data-types/array)结构。对于 IP 地址范围 (`ip_range`），将 CIDR 值存储为`String`并使用如下函数进行计算`isIPAddressInRange()`。或者考虑`ip_trie`基于 `ip_trie` 的查找字典，用于高效过滤。 |
| `aggregate_metric_double`              | [`AggregateFunction(...)`](/sql-reference/data-types/aggregatefunction)和[`SimpleAggregateFunction(...)`](/sql-reference/data-types/simpleaggregatefunction)                                                                                                                                                                                    | 使用聚合函数状态和物化视图来建模预聚合度量。所有聚合函数都支持聚合状态。                                                                                                                                                                                                                      |
| `histogram`                            | [`Tuple(Array(Float64), Array(UInt64))`](/sql-reference/data-types/tuple)                                                                                                                                                                                                                                                                      | 使用数组或自定义模式手动表示桶及其计数。                                                                                                                                                                                                                                      |
| `annotated-text`                       | [`String`](/sql-reference/data-types/string)                                                                                                                                                                                                                                                                                                   | 不支持实体感知搜索或标注等内置功能。                                                                                                                                                                                                                                        |
| `completion`,`search_as_you_type`      | 不适用                                                                                                                                                                                                                                                                                                                                            | 没有原生自动补全或建议（suggester）引擎。可以使用 `String` 和 搜索函数 来实现类似功能。`String`和[搜索函数](/sql-reference/functions/string-search-functions)没有原生的自动补全或推荐引擎。可以使用 `String` 和 搜索函数 来实现类似功能。                                                                                       |
| `semantic_text`                        | NA                                                                                                                                                                                                                                                                                                                                             | 没有原生的语义搜索功能——需要先生成嵌入向量，再使用向量搜索。                                                                                                                                                                                                                           |
| `token_count`                          | [`Int32`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                                                                                  | 在数据写入时使用，用于手动计算 token 数量，例如`length(tokens())`例如与 Materialized 列一起使用的函数                                                                                                                                                                                    |
| `dense_vector`                         | [`Array(Float32)`](/sql-reference/data-types/array)                                                                                                                                                                                                                                                                                            | 使用数组存储嵌入向量                                                                                                                                                                                                                                                |
| `sparse_vector`                        | [`Map(UInt32, Float32)`](/sql-reference/data-types/map)                                                                                                                                                                                                                                                                                        | 使用 `Map` 来模拟稀疏向量。目前尚不支持原生稀疏向量。                                                                                                                                                                                                                            |
| `rank_feature`/`rank_features`         | [`Float32`](/sql-reference/data-types/float)，[`Array(Float32)`](/sql-reference/data-types/array)                                                                                                                                                                                                                                               | 不支持原生的查询时加权，但可以在评分逻辑中手动实现。                                                                                                                                                                                                                                |
| `geo_point`                            | [`Tuple(Float64, Float64)`](/sql-reference/data-types/tuple)或[`Point`](/sql-reference/data-types/geo#point)                                                                                                                                                                                                                                    | 使用 (纬度, 经度) 的 `Tuple`。[`Point`](/sql-reference/data-types/geo#point)可作为 ClickHouse 的一种数据类型使用。                                                                                                                                                             |
| `geo_shape`,`shape`                    | [`Ring（环）`](/sql-reference/data-types/geo#ring)，[`LineString`](/sql-reference/data-types/geo#linestring)，[`MultiLineString`](/sql-reference/data-types/geo#multilinestring)，[`Polygon`](/sql-reference/data-types/geo#polygon)Ring、LineString、MultiLineString、Polygon、MultiPolygon[`MultiPolygon`](/sql-reference/data-types/geo#multipolygon) | 对地理图形和空间索引的原生支持。                                                                                                                                                                                                                                          |
| `percolator`                           | 无                                                                                                                                                                                                                                                                                                                                              | 没有查询索引这一概念。请改用标准 SQL 加增量物化视图。                                                                                                                                                                                                                             |
| `version`                              | [`String`](/sql-reference/data-types/string)                                                                                                                                                                                                                                                                                                   | ClickHouse 没有原生的 `version` 类型。可以将版本号存储为字符串，并在需要时使用自定义 UDF 来执行语义比较。如果需要范围查询，请考虑将其规范化为数值格式。                                                                                                                                                                 |

### 注意事项 {#notes}

- **数组**:在 Elasticsearch 中,所有字段原生支持数组。在 ClickHouse 中,数组必须显式定义(例如 `Array(String)`),其优势在于可以访问和查询特定位置,例如 `an_array[1]`。
- **多字段**:Elasticsearch 允许以[多种方式索引同一字段](https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/multi-fields#_multi_fields_with_multiple_analyzers)(例如同时作为 `text` 和 `keyword`)。在 ClickHouse 中,必须使用单独的列或视图来实现此模式。
- **Map 和 JSON 类型** - 在 ClickHouse 中,[`Map`](/sql-reference/data-types/map) 类型通常用于对动态键值结构建模,例如 `resourceAttributes` 和 `logAttributes`。此类型通过允许在运行时添加任意键来实现灵活的无模式数据摄取——在设计理念上类似于 Elasticsearch 中的 JSON 对象。但是,需要考虑以下重要限制:
  - **统一的值类型**:ClickHouse [`Map`](/sql-reference/data-types/map) 列必须具有一致的值类型(例如 `Map(String, String)`)。不支持混合类型的值,除非进行强制类型转换。
  - **性能开销**:访问 [`Map`](/sql-reference/data-types/map) 中的任何键都需要将整个 map 加载到内存中,这可能导致性能欠佳。
  - **无子列**:与 JSON 不同,[`Map`](/sql-reference/data-types/map) 中的键不会表示为真正的子列,这限制了 ClickHouse 高效索引、压缩和查询的能力。

  由于这些限制,ClickStack 正在从 [`Map`](/sql-reference/data-types/map) 迁移到 ClickHouse 增强的 [`JSON`](/sql-reference/data-types/newjson) 类型。[`JSON`](/sql-reference/data-types/newjson) 类型解决了 `Map` 的许多不足:
  - **真正的列式存储**:每个 JSON 路径都作为子列存储,实现高效的压缩、过滤和向量化查询执行。
  - **混合类型支持**:不同的数据类型(例如整数、字符串、数组)可以在同一路径下共存,无需强制类型转换或类型统一。
  - **文件系统可扩展性**:对动态键(`max_dynamic_paths`)和类型(`max_dynamic_types`)的内部限制可防止磁盘上列文件的爆炸式增长,即使在高基数键集的情况下也是如此。
  - **密集存储**:空值和缺失值以稀疏方式存储,以避免不必要的开销。

    [`JSON`](/sql-reference/data-types/newjson) 类型特别适合可观测性工作负载,既提供无模式数据摄取的灵活性,又具备原生 ClickHouse 类型的性能和可扩展性——使其成为动态属性字段中 [`Map`](/sql-reference/data-types/map) 的理想替代方案。

    有关 JSON 类型的更多详细信息,我们推荐阅读 [JSON 指南](https://clickhouse.com/docs/integrations/data-formats/json/overview)和["我们如何为 ClickHouse 构建新的强大 JSON 数据类型"](https://clickhouse.com/blog/a-new-powerful-json-data-type-for-clickhouse)。
