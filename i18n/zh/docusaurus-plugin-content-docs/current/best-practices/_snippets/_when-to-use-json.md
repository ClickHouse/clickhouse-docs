## 何时使用 `JSON` 类型 {#when-to-use-json-type}

`JSON` 类型专为在结构动态或不可预测的 JSON 对象中，对特定字段进行查询、过滤和聚合而设计。它通过将 JSON 对象拆分为多个子列来实现这一点，与使用 `Map` 或解析字符串等方案相比，可以显著减少选定字段的数据读取量，从而加速查询。

**不过，这也带来了一些重要的权衡：**

- `INSERT` 操作较慢 —— 将 JSON 拆分为子列、执行类型推断以及管理灵活的存储结构，会使插入操作比将 JSON 作为简单的 `String` 列存储更慢。
- 读取整个对象时较慢 —— 如果你需要获取完整的 JSON 文档（而不是特定字段），从 `JSON` 类型读取会比从 `String` 列读取更慢。当你不进行字段级查询时，从多个子列重建对象的开销并不会带来任何收益。
- 存储开销更大 —— 相比将 JSON 存为单个字符串值，维护独立的子列会增加结构性存储开销。

### 在以下情况使用 `JSON` 类型： {#use-json-type}

- 当数据结构具有动态性或不可预测性，不同文档之间的键各不相同
- 字段类型或模式（schema）会随时间变化，或在不同记录之间有所差异
- 你需要在无法预先预测结构的 JSON 对象中，对特定路径进行查询、过滤或聚合
- 你的使用场景涉及半结构化数据，如日志、事件，或模式（schema）不一致的用户生成内容

### 在以下情况下使用 `String` 列（或结构化类型）： {#use-string-type}

- 你的数据结构是已知且保持一致的——在这种情况下，应使用常规列、`Tuple`、`Array`、`Dynamic` 或 `Variant` 类型来代替
- `JSON` 文档被当作不透明的二进制大对象（blob），只以整体形式存储和检索，而不进行字段级分析
- 你不需要在数据库中对单个 JSON 字段进行查询或过滤
- `JSON` 只是传输/存储格式，不在 ClickHouse 内进行分析

:::tip
如果 `JSON` 是在数据库内部不被分析、仅用于存储和读取的不透明文档，则应将其存储为 `String` 字段。只有当你需要在动态 `JSON` 结构中的特定字段上进行高效的查询、过滤或聚合时，`JSON` 类型的优势才会体现出来。

你也可以组合使用多种方式——对可预测的顶层字段使用标准列，对负载中动态部分使用 `JSON` 列。
:::