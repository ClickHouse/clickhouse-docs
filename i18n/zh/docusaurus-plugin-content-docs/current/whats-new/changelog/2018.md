---
slug: /whats-new/changelog/2018
sidebar_position: 9
sidebar_label: '2018'
title: '2018 年变更日志'
description: '2018 年变更日志'
doc_type: 'changelog'
keywords: ['ClickHouse 2018', '2018 变更日志', '发行说明', '版本历史', '历史版本']
---



## ClickHouse 版本 18.16 {#clickhouse-release-18-16}

### ClickHouse 版本 18.16.1, 2018-12-21 {#clickhouse-release-18-16-1-2018-12-21}

#### 错误修复: {#bug-fixes}

- 修复了使用 ODBC 数据源更新字典时出现问题的错误。[#3825](https://github.com/ClickHouse/ClickHouse/issues/3825), [#3829](https://github.com/ClickHouse/ClickHouse/issues/3829)
- 聚合函数的 JIT 编译现已支持 LowCardinality 列。[#3838](https://github.com/ClickHouse/ClickHouse/issues/3838)

#### 改进: {#improvements}

- 新增 `low_cardinality_allow_in_native_format` 设置(默认启用)。禁用时,LowCardinality 列在 SELECT 查询中将转换为普通列,INSERT 查询中将要求使用普通列。[#3879](https://github.com/ClickHouse/ClickHouse/pull/3879)

#### 构建改进: {#build-improvements}

- 修复了 macOS 和 ARM 平台的构建问题。

### ClickHouse 版本 18.16.0, 2018-12-14 {#clickhouse-release-18-16-0-2018-12-14}

#### 新功能: {#new-features}


- 在半结构化输入格式（`JSONEachRow`、`TSKV`）中加载数据时,会对缺失字段计算 `DEFAULT` 表达式。该功能通过 `insert_sample_with_metadata` 设置启用。[#3555](https://github.com/ClickHouse/ClickHouse/pull/3555)
- `ALTER TABLE` 查询现在支持 `MODIFY ORDER BY` 操作,用于在添加或删除表列时更改排序键。这对于 `MergeTree` 系列中在合并时基于排序键执行额外任务的表非常有用,例如 `SummingMergeTree`、`AggregatingMergeTree` 等。[#3581](https://github.com/ClickHouse/ClickHouse/pull/3581) [#3755](https://github.com/ClickHouse/ClickHouse/pull/3755)
- 对于 `MergeTree` 系列表,现在可以指定不同的排序键（`ORDER BY`）和索引（`PRIMARY KEY`）。排序键可以比索引更长。[#3581](https://github.com/ClickHouse/ClickHouse/pull/3581)
- 添加了 `hdfs` 表函数和 `HDFS` 表引擎,用于从 HDFS 导入和导出数据。[chenxing-xc](https://github.com/ClickHouse/ClickHouse/pull/3617)
- 添加了用于处理 base64 的函数：`base64Encode`、`base64Decode`、`tryBase64Decode`。[Alexander Krasheninnikov](https://github.com/ClickHouse/ClickHouse/pull/3350)
- 现在可以使用参数配置 `uniqCombined` 聚合函数的精度（选择 HyperLogLog 单元的数量）。[#3406](https://github.com/ClickHouse/ClickHouse/pull/3406)
- 添加了 `system.contributors` 表,其中包含所有向 ClickHouse 提交代码的贡献者姓名。[#3452](https://github.com/ClickHouse/ClickHouse/pull/3452)
- 添加了在 `ALTER TABLE ... FREEZE` 查询中省略分区的功能,以便一次性备份所有分区。[#3514](https://github.com/ClickHouse/ClickHouse/pull/3514)
- 添加了 `dictGet` 和 `dictGetOrDefault` 函数,无需指定返回值类型。类型会根据字典描述自动确定。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3564)
- 现在可以在表描述中为列指定注释,并使用 `ALTER` 进行修改。[#3377](https://github.com/ClickHouse/ClickHouse/pull/3377)
- 支持对具有简单键的 `Join` 类型表进行读取。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3728)
- 现在可以在创建 `Join` 类型表时指定 `join_use_nulls`、`max_rows_in_join`、`max_bytes_in_join` 和 `join_overflow_mode` 选项。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3728)
- 添加了 `joinGet` 函数,允许像使用字典一样使用 `Join` 类型表。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3728)
- 向 `system.tables` 表添加了 `partition_key`、`sorting_key`、`primary_key` 和 `sampling_key` 列,以提供有关表键的信息。[#3609](https://github.com/ClickHouse/ClickHouse/pull/3609)
- 向 `system.columns` 表添加了 `is_in_partition_key`、`is_in_sorting_key`、`is_in_primary_key` 和 `is_in_sampling_key` 列。[#3609](https://github.com/ClickHouse/ClickHouse/pull/3609)
- 向 `system.parts` 表添加了 `min_time` 和 `max_time` 列。当分区键是由 `DateTime` 列组成的表达式时,这些列会被填充。[Emmanuel Donin de Rosière](https://github.com/ClickHouse/ClickHouse/pull/3800)

#### 错误修复： {#bug-fixes-1}


* 针对 `LowCardinality` 数据类型的修复和性能改进。使用 `LowCardinality(Nullable(...))` 的 `GROUP BY`。获取 `extremes` 的值。处理高阶函数。`LEFT ARRAY JOIN`。分布式 `GROUP BY`。返回 `Array` 的函数。`ORDER BY` 的执行。向 `Distributed` 表写入数据（nicelulu）。为使用 `Native` 协议的旧客户端发出的 `INSERT` 查询提供向后兼容性。为 `JOIN` 提供对 `LowCardinality` 的支持。在单一数据流模式下提升性能。[#3823](https://github.com/ClickHouse/ClickHouse/pull/3823) [#3803](https://github.com/ClickHouse/ClickHouse/pull/3803) [#3799](https://github.com/ClickHouse/ClickHouse/pull/3799) [#3769](https://github.com/ClickHouse/ClickHouse/pull/3769) [#3744](https://github.com/ClickHouse/ClickHouse/pull/3744) [#3681](https://github.com/ClickHouse/ClickHouse/pull/3681) [#3651](https://github.com/ClickHouse/ClickHouse/pull/3651) [#3649](https://github.com/ClickHouse/ClickHouse/pull/3649) [#3641](https://github.com/ClickHouse/ClickHouse/pull/3641) [#3632](https://github.com/ClickHouse/ClickHouse/pull/3632) [#3568](https://github.com/ClickHouse/ClickHouse/pull/3568) [#3523](https://github.com/ClickHouse/ClickHouse/pull/3523) [#3518](https://github.com/ClickHouse/ClickHouse/pull/3518)
* 修正了 `select_sequential_consistency` 选项的行为。此前，当启用此设置后，在开始向新分区写入数据时，有时会返回不完整的结果。[#2863](https://github.com/ClickHouse/ClickHouse/pull/2863)
* 在执行带有 `ON CLUSTER` 的 DDL 查询以及 `ALTER UPDATE/DELETE` 时，数据库能够被正确指定。 [#3772](https://github.com/ClickHouse/ClickHouse/pull/3772) [#3460](https://github.com/ClickHouse/ClickHouse/pull/3460)
* 现在会为 VIEW 中的子查询正确指定数据库。 [#3521](https://github.com/ClickHouse/ClickHouse/pull/3521)
* 修复了在 `VersionedCollapsingMergeTree` 中将 `PREWHERE` 与 `FINAL` 结合使用时出现的一个错误。[7167bfd7](https://github.com/ClickHouse/ClickHouse/commit/7167bfd7b365538f7a91c4307ad77e552ab4e8c1)
* 现在，您可以使用 `KILL QUERY` 来取消那些尚未开始执行、因为正在等待表被锁定的查询。[#3517](https://github.com/ClickHouse/ClickHouse/pull/3517)
* 修正了在午夜将时钟往回拨时的日期和时间计算（这种情况在伊朗会发生，在 1981 到 1983 年间也曾在莫斯科发生）。此前，这会导致时间被错误地重置为早一天，同时还会导致以文本形式输出的日期和时间格式不正确。[#3819](https://github.com/ClickHouse/ClickHouse/pull/3819)
* 修复了在某些场景下，当 `VIEW` 和子查询中省略数据库名时出现的错误。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3521)
* 修复了由于未对内部 `MATERIALIZED VIEW` 加锁，在同时对 `MATERIALIZED VIEW` 执行读取和删除操作时产生的竞态条件。 [#3404](https://github.com/ClickHouse/ClickHouse/pull/3404) [#3694](https://github.com/ClickHouse/ClickHouse/pull/3694)
* 修复了导致出现 `Lock handler cannot be nullptr.` 错误的问题。 [#3689](https://github.com/ClickHouse/ClickHouse/pull/3689)
* 修复了在启用 `compile_expressions` 选项时的查询处理（该选项默认启用）。像 `now` 函数这样的非确定性常量表达式不再被展开。[#3457](https://github.com/ClickHouse/ClickHouse/pull/3457)
* 修复了在 `toDecimal32/64/128` 函数中指定非常量 scale 参数时会发生的崩溃。
* 修复了在 `input_format_values_interpret_expressions` = 1 时，使用 `Values` 格式向非 `Nullable` 的 `Array` 类型列插入包含 `NULL` 元素的数组时会出现的错误。 [#3487](https://github.com/ClickHouse/ClickHouse/pull/3487) [#3503](https://github.com/ClickHouse/ClickHouse/pull/3503)
* 修复了在 ZooKeeper 不可用时 `DDLWorker` 中持续输出错误日志的问题。[8f50c620](https://github.com/ClickHouse/ClickHouse/commit/8f50c620334988b28018213ec0092fe6423847e2)
* 已修正 `quantile*` 函数在参数类型为 `Date` 和 `DateTime` 时的返回类型。[#3580](https://github.com/ClickHouse/ClickHouse/pull/3580)
* 修复了当 `WITH` 子句仅指定简单别名而不包含表达式时的处理逻辑。 [#3570](https://github.com/ClickHouse/ClickHouse/pull/3570)
* 修复了在启用 `enable_optimize_predicate_expression` 时对包含命名子查询和限定列名的查询的处理。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3588)
* 修复了在使用物化视图时出现的 `Attempt to attach to nullptr thread group` 错误。[Marek Vavruša](https://github.com/ClickHouse/ClickHouse/pull/3623)
* 修复了在向 `arrayReverse` 函数传递某些错误参数时导致的崩溃问题。[73e3a7b6](https://github.com/ClickHouse/ClickHouse/commit/73e3a7b662161d6005e7727d8a711b930386b871)
* 修复了 `extractURLParameter` 函数中的缓冲区溢出漏洞。改进了性能。为包含零字节的字符串添加了正确的处理逻辑。[141e9799](https://github.com/ClickHouse/ClickHouse/commit/141e9799e49201d84ea8e951d1bed4fb6d3dacb5)
* 修复了 `lowerUTF8` 和 `upperUTF8` 函数中的缓冲区溢出问题。移除了对 `FixedString` 类型参数执行这些函数的支持。[#3662](https://github.com/ClickHouse/ClickHouse/pull/3662)
* 修复了在删除 `MergeTree` 表时出现的一种罕见竞态条件。[#3680](https://github.com/ClickHouse/ClickHouse/pull/3680)
* 修复了在从 `Buffer` 表读取数据的同时对目标表执行 `ALTER` 或 `DROP` 操作时出现的竞态条件。 [#3719](https://github.com/ClickHouse/ClickHouse/pull/3719)
* 修复了当超出 `max_temporary_non_const_columns` 限制时会发生的段错误。 [#3788](https://github.com/ClickHouse/ClickHouse/pull/3788)

#### 改进: {#improvements-1}


* 服务器不会将处理后的配置文件写入 `/etc/clickhouse-server/` 目录，而是将它们保存在 `path` 路径下的 `preprocessed_configs` 目录中。这意味着 `/etc/clickhouse-server/` 目录对 `clickhouse` 用户没有写权限，从而提高了安全性。[#2443](https://github.com/ClickHouse/ClickHouse/pull/2443)
* `min_merge_bytes_to_use_direct_io` 选项的默认值为 10 GiB。当对 MergeTree 系列表进行合并并生成较大的表分片时，将以 `O_DIRECT` 模式执行，从而避免页缓存被过度淘汰。[#3504](https://github.com/ClickHouse/ClickHouse/pull/3504)
* 在表的数量非常多时加快服务器启动速度。[#3398](https://github.com/ClickHouse/ClickHouse/pull/3398)
* 在副本之间的连接中新增了连接池和 HTTP `Keep-Alive` 支持。[#3594](https://github.com/ClickHouse/ClickHouse/pull/3594)
* 如果查询语法无效，则通过 `HTTP` 接口返回 `400 Bad Request` 状态码（此前返回的是 500）。[31bc680a](https://github.com/ClickHouse/ClickHouse/commit/31bc680ac5f4bb1d0360a8ba4696fa84bb47d6ab)
* 为保持兼容性，`join_default_strictness` 选项的默认值为 `ALL`。[120e2cbe](https://github.com/ClickHouse/ClickHouse/commit/120e2cbe2ff4fbad626c28042d9b28781c805afe)
* 移除了 `re2` 库在处理无效或复杂正则表达式时向 `stderr` 输出日志的行为。[#3723](https://github.com/ClickHouse/ClickHouse/pull/3723)
* 为 `Kafka` 表引擎新增：在开始从 Kafka 读取之前检查订阅；以及该表的 kafka&#95;max&#95;block&#95;size 设置。[Marek Vavruša](https://github.com/ClickHouse/ClickHouse/pull/3396)
* `cityHash64`、`farmHash64`、`metroHash64`、`sipHash64`、`halfMD5`、`murmurHash2_32`、`murmurHash2_64`、`murmurHash3_32` 和 `murmurHash3_64` 函数现在可以用于任意数量的参数，并且支持元组形式的参数。[#3451](https://github.com/ClickHouse/ClickHouse/pull/3451) [#3519](https://github.com/ClickHouse/ClickHouse/pull/3519)
* `arrayReverse` 函数现在适用于任何类型的数组。[73e3a7b6](https://github.com/ClickHouse/ClickHouse/commit/73e3a7b662161d6005e7727d8a711b930386b871)
* 为 `timeSlots` 函数新增了一个可选参数：槽大小。[Kirill Shvakov](https://github.com/ClickHouse/ClickHouse/pull/3724)
* 对于 `FULL` 和 `RIGHT JOIN`，`max_block_size` 设置会应用于来自右表的未匹配数据流。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3699)
* 在 `clickhouse-benchmark` 和 `clickhouse-performance-test` 中添加了 `--secure` 命令行参数，用于启用 TLS。[#3688](https://github.com/ClickHouse/ClickHouse/pull/3688) [#3690](https://github.com/ClickHouse/ClickHouse/pull/3690)
* 当 `Buffer` 类型表的结构与目标表的结构不匹配时，进行类型转换。[Vitaly Baranov](https://github.com/ClickHouse/ClickHouse/pull/3603)
* 添加了 `tcp_keep_alive_timeout` 选项，用于在连接空闲达到指定时间间隔后启用 keep-alive 数据包。[#3441](https://github.com/ClickHouse/ClickHouse/pull/3441)
* 当分区键仅包含单列时，移除了在 `system.parts` 表中对分区键值不必要的加引号。 [#3652](https://github.com/ClickHouse/ClickHouse/pull/3652)
* `modulo` 函数可用于 `Date` 和 `DateTime` 数据类型。[#3385](https://github.com/ClickHouse/ClickHouse/pull/3385)
* 为 `POWER`、`LN`、`LCASE`、`UCASE`、`REPLACE`、`LOCATE`、`SUBSTR` 和 `MID` 函数添加了别名。[#3774](https://github.com/ClickHouse/ClickHouse/pull/3774) [#3763](https://github.com/ClickHouse/ClickHouse/pull/3763) 为了与 SQL 标准兼容，某些函数名不区分大小写。为兼容 SQL，增加了语法糖 `SUBSTRING(expr FROM start FOR length)`。[#3804](https://github.com/ClickHouse/ClickHouse/pull/3804)
* 新增支持使用 `mlock` 锁定与 `clickhouse-server` 可执行代码对应的内存页，以防止它们被强制从内存中移出。该功能默认禁用。 [#3553](https://github.com/ClickHouse/ClickHouse/pull/3553)
* 在启用 `min_bytes_to_use_direct_io` 选项时，从 `O_DIRECT` 读取数据时的性能有所提升。 [#3405](https://github.com/ClickHouse/ClickHouse/pull/3405)
* 在 key 参数为常量且默认参数为非常量的情况下，提升了 `dictGet...OrDefault` 函数的性能。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3563)
* `firstSignificantSubdomain` 函数现在也会处理 `gov`、`mil` 和 `edu` 这些域名后缀。[Igor Hatarist](https://github.com/ClickHouse/ClickHouse/pull/3601) 提升了性能。[#3628](https://github.com/ClickHouse/ClickHouse/pull/3628)
* 支持通过在 `/etc/default/clickhouse` 中定义 `CLICKHOUSE_PROGRAM_ENV`，在使用 `SYS-V init.d` 脚本启动 `clickhouse-server` 时指定自定义环境变量。
  [Pavlo Bashynskyi](https://github.com/ClickHouse/ClickHouse/pull/3612)
* 修正 clickhouse-server init 脚本的返回码。 [#3516](https://github.com/ClickHouse/ClickHouse/pull/3516)
* 现在，`system.metrics` 表新增了 `VersionInteger` 指标，而 `system.build_options` 增加了一行 `VERSION_INTEGER`，其中包含 ClickHouse 版本的数值表示形式，例如 `18016000`。 [#3644](https://github.com/ClickHouse/ClickHouse/pull/3644)
* 移除了将 `Date` 类型与数字进行比较的支持，以避免出现诸如 `date = 2018-12-17` 这类潜在错误，其中日期周围的引号可能会被误省略。 [#3687](https://github.com/ClickHouse/ClickHouse/pull/3687)
* 修复了 `rowNumberInAllBlocks` 等有状态函数的行为。此前它们由于在查询分析阶段就开始计数，导致输出结果比预期值大 1。 [Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3729)
* 如果无法删除 `force_restore_data` 文件，则会显示一条错误信息。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3794)

#### 构建改进： {#build-improvements-1}

- 更新了 `jemalloc` 库，修复了潜在的内存泄漏问题。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3557)
- 在调试构建中默认启用 `jemalloc` 性能分析。[2cc82f5c](https://github.com/ClickHouse/ClickHouse/commit/2cc82f5cbe266421cd4c1165286c2c47e5ffcb15)
- 新增了在系统仅安装 `Docker` 时运行集成测试的能力。[#3650](https://github.com/ClickHouse/ClickHouse/pull/3650)
- 在 SELECT 查询中新增了模糊表达式测试。[#3442](https://github.com/ClickHouse/ClickHouse/pull/3442)
- 新增了针对提交的压力测试，该测试以并行和随机顺序执行功能测试，以检测更多竞态条件。[#3438](https://github.com/ClickHouse/ClickHouse/pull/3438)
- 改进了在 Docker 镜像中启动 clickhouse-server 的方法。[Elghazal Ahmed](https://github.com/ClickHouse/ClickHouse/pull/3663)
- 针对 Docker 镜像，新增了使用 `/docker-entrypoint-initdb.d` 目录中的文件初始化数据库的支持。[Konstantin Lebedev](https://github.com/ClickHouse/ClickHouse/pull/3695)
- 修复了 ARM 平台上的构建问题。[#3709](https://github.com/ClickHouse/ClickHouse/pull/3709)

#### 向后不兼容的变更： {#backward-incompatible-changes}

- 移除了将 `Date` 类型与数字进行比较的能力。必须使用显式类型转换 `= toDate(17883)` 来替代 `toDate('2018-12-18') = 17883`。[#3687](https://github.com/ClickHouse/ClickHouse/pull/3687)


## ClickHouse 版本 18.14 {#clickhouse-release-18-14}

### ClickHouse 版本 18.14.19, 2018-12-19 {#clickhouse-release-18-14-19-2018-12-19}

#### 错误修复: {#bug-fixes-2}

- 修复了使用 ODBC 数据源更新字典时出现问题的错误。[#3825](https://github.com/ClickHouse/ClickHouse/issues/3825), [#3829](https://github.com/ClickHouse/ClickHouse/issues/3829)
- 执行 DDL `ON CLUSTER` 查询时现在能正确指定数据库。[#3460](https://github.com/ClickHouse/ClickHouse/pull/3460)
- 修复了超出 `max_temporary_non_const_columns` 限制时发生的段错误。[#3788](https://github.com/ClickHouse/ClickHouse/pull/3788)

#### 构建改进: {#build-improvements-2}

- 修复了 ARM 平台上的构建问题。

### ClickHouse 版本 18.14.18, 2018-12-04 {#clickhouse-release-18-14-18-2018-12-04}

#### 错误修复: {#bug-fixes-3}

- 修复了 `dictGet...` 函数在 `range` 类型字典中的错误,该错误发生在其中一个参数为常量而另一个不是常量时。[#3751](https://github.com/ClickHouse/ClickHouse/pull/3751)
- 修复了导致 Linux 内核日志中打印 `netlink: '...': attribute type 1 has an invalid length` 消息的错误,该问题仅在较新版本的 Linux 内核上出现。[#3749](https://github.com/ClickHouse/ClickHouse/pull/3749)
- 修复了 `empty` 函数在处理 `FixedString` 类型参数时发生的段错误。[Daniel, Dao Quang Minh](https://github.com/ClickHouse/ClickHouse/pull/3703)
- 修复了使用较大的 `max_query_size` 设置值时的过度内存分配问题(会一次性预分配 `max_query_size` 字节的内存块)。[#3720](https://github.com/ClickHouse/ClickHouse/pull/3720)

#### 构建变更: {#build-changes}

- 修复了使用操作系统软件包中版本 7 的 LLVM/Clang 库进行构建的问题(这些库用于运行时查询编译)。[#3582](https://github.com/ClickHouse/ClickHouse/pull/3582)

### ClickHouse 版本 18.14.17, 2018-11-30 {#clickhouse-release-18-14-17-2018-11-30}

#### 错误修复: {#bug-fixes-4}

- 修复了 ODBC 桥接进程未随主服务器进程一起终止的情况。[#3642](https://github.com/ClickHouse/ClickHouse/pull/3642)
- 修复了向 `Distributed` 表同步插入数据时,列列表与远程表的列列表不一致的问题。[#3673](https://github.com/ClickHouse/ClickHouse/pull/3673)
- 修复了删除 MergeTree 表时可能导致崩溃的罕见竞态条件。[#3643](https://github.com/ClickHouse/ClickHouse/pull/3643)
- 修复了当查询线程创建失败并出现 `Resource temporarily unavailable` 错误时发生的查询死锁问题。[#3643](https://github.com/ClickHouse/ClickHouse/pull/3643)
- 修复了使用 `CREATE AS table` 语法且 `ENGINE` 子句在 `AS table` 之前指定时的解析问题(该错误会导致忽略指定的引擎)。[#3692](https://github.com/ClickHouse/ClickHouse/pull/3692)

### ClickHouse 版本 18.14.15, 2018-11-21 {#clickhouse-release-18-14-15-2018-11-21}

#### 错误修复: {#bug-fixes-5}

- 在反序列化 `Array(String)` 类型的列时,内存块大小被高估,导致"超出内存限制"错误。该问题出现在版本 18.12.13 中。[#3589](https://github.com/ClickHouse/ClickHouse/issues/3589)

### ClickHouse 版本 18.14.14, 2018-11-20 {#clickhouse-release-18-14-14-2018-11-20}

#### 错误修复: {#bug-fixes-6}


- 修复了集群配置为安全模式(标志 `<secure>`)时 `ON CLUSTER` 查询的问题。[#3599](https://github.com/ClickHouse/ClickHouse/pull/3599)

#### 构建变更:{#build-changes-1}

- 修复了相关问题(系统 llvm-7,macOS)[#3582](https://github.com/ClickHouse/ClickHouse/pull/3582)

### ClickHouse 版本 18.14.13,2018-11-08 {#clickhouse-release-18-14-13-2018-11-08}

#### 错误修复:{#bug-fixes-7}

- 修复了 `Block structure mismatch in MergingSorted stream` 错误。[#3162](https://github.com/ClickHouse/ClickHouse/issues/3162)
- 修复了集群配置中启用安全连接(`<secure>` 标志)时 `ON CLUSTER` 查询的问题。[#3465](https://github.com/ClickHouse/ClickHouse/pull/3465)
- 修复了使用 `SAMPLE`、`PREWHERE` 和别名列的查询中的错误。[#3543](https://github.com/ClickHouse/ClickHouse/pull/3543)
- 修复了启用 `min_bytes_to_use_direct_io` 设置时偶发的 `unknown compression method` 错误。[3544](https://github.com/ClickHouse/ClickHouse/pull/3544)

#### 性能改进:{#performance-improvements}

- 修复了在 AMD EPYC 处理器上执行对 UInt16 或 Date 类型列进行 `GROUP BY` 的查询时的性能回退问题。[Igor Lapko](https://github.com/ClickHouse/ClickHouse/pull/3512)
- 修复了处理长字符串查询的性能回退问题。[#3530](https://github.com/ClickHouse/ClickHouse/pull/3530)

#### 构建改进:{#build-improvements-3}

- 简化 Arcadia 构建的改进。[#3475](https://github.com/ClickHouse/ClickHouse/pull/3475),[#3535](https://github.com/ClickHouse/ClickHouse/pull/3535)

### ClickHouse 版本 18.14.12,2018-11-02 {#clickhouse-release-18-14-12-2018-11-02}

#### 错误修复:{#bug-fixes-8}

- 修复了连接两个未命名子查询时的崩溃问题。[#3505](https://github.com/ClickHouse/ClickHouse/pull/3505)
- 修复了查询外部数据库时生成错误查询(包含空 `WHERE` 子句)的问题。[hotid](https://github.com/ClickHouse/ClickHouse/pull/3477)
- 修复了 ODBC 字典中使用错误超时值的问题。[Marek Vavruša](https://github.com/ClickHouse/ClickHouse/pull/3511)

### ClickHouse 版本 18.14.11,2018-10-29 {#clickhouse-release-18-14-11-2018-10-29}

#### 错误修复:{#bug-fixes-9}

- 修复了 LIMIT 查询中的 `Block structure mismatch in UNION stream: different number of columns` 错误。[#2156](https://github.com/ClickHouse/ClickHouse/issues/2156)
- 修复了在包含 Nested 结构内数组的表中合并数据时的错误。[#3397](https://github.com/ClickHouse/ClickHouse/pull/3397)
- 修复了禁用 `merge_tree_uniform_read_distribution` 设置(默认启用)时查询结果错误的问题。[#3429](https://github.com/ClickHouse/ClickHouse/pull/3429)
- 修复了以 Native 格式向 Distributed 表插入数据时的错误。[#3411](https://github.com/ClickHouse/ClickHouse/issues/3411)

### ClickHouse 版本 18.14.10,2018-10-23 {#clickhouse-release-18-14-10-2018-10-23}

- `compile_expressions` 设置(表达式的 JIT 编译)默认禁用。[#3410](https://github.com/ClickHouse/ClickHouse/pull/3410)
- `enable_optimize_predicate_expression` 设置默认禁用。

### ClickHouse 版本 18.14.9,2018-10-16 {#clickhouse-release-18-14-9-2018-10-16}

#### 新特性:{#new-features-1}


- `GROUP BY` 的 `WITH CUBE` 修饰符(也可使用替代语法 `GROUP BY CUBE(...)`)。[#3172](https://github.com/ClickHouse/ClickHouse/pull/3172)
- 新增 `formatDateTime` 函数。[Alexandr Krasheninnikov](https://github.com/ClickHouse/ClickHouse/pull/2770)
- 新增 `JDBC` 表引擎和 `jdbc` 表函数(需要安装 clickhouse-jdbc-bridge)。[Alexandr Krasheninnikov](https://github.com/ClickHouse/ClickHouse/pull/3210)
- 新增用于处理 ISO 周数的函数:`toISOWeek`、`toISOYear`、`toStartOfISOYear` 和 `toDayOfYear`。[#3146](https://github.com/ClickHouse/ClickHouse/pull/3146)
- 现在可以在 `MySQL` 和 `ODBC` 表中使用 `Nullable` 列。[#3362](https://github.com/ClickHouse/ClickHouse/pull/3362)
- 嵌套数据结构可以在 `JSONEachRow` 格式中作为嵌套对象读取。新增 `input_format_import_nested_json` 设置。[Veloman Yunkan](https://github.com/ClickHouse/ClickHouse/pull/3144)
- 插入数据时可对多个 `MATERIALIZED VIEW` 进行并行处理。请参阅 `parallel_view_processing` 设置。[Marek Vavruša](https://github.com/ClickHouse/ClickHouse/pull/3208)
- 新增 `SYSTEM FLUSH LOGS` 查询(强制将日志刷新到系统表,如 `query_log`)[#3321](https://github.com/ClickHouse/ClickHouse/pull/3321)
- 现在可以在声明 `Replicated` 表时使用预定义的 `database` 和 `table` 宏。[#3251](https://github.com/ClickHouse/ClickHouse/pull/3251)
- 新增以工程记数法(表示十的幂)读取 `Decimal` 类型值的功能。[#3153](https://github.com/ClickHouse/ClickHouse/pull/3153)

#### 实验性功能: {#experimental-features}

- 针对 `LowCardinality` 数据类型的 GROUP BY 子句优化。[#3138](https://github.com/ClickHouse/ClickHouse/pull/3138)
- 优化了 `LowCardinality` 数据类型的表达式计算。[#3200](https://github.com/ClickHouse/ClickHouse/pull/3200)

#### 改进: {#improvements-2}


* 显著降低了包含 `ORDER BY` 和 `LIMIT` 的查询的内存占用。请参阅 `max_bytes_before_remerge_sort` 设置。 [#3205](https://github.com/ClickHouse/ClickHouse/pull/3205)
* 如果未指定 `JOIN` 类型（如 `LEFT`、`INNER` 等），则默认为 `INNER JOIN`。 [#3147](https://github.com/ClickHouse/ClickHouse/pull/3147)
* 在包含 `JOIN` 的查询中，带限定符的星号能够正常工作。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3202)
* `ODBC` 表引擎会根据远程数据库的 SQL 方言正确选择标识符的引用方式。[Alexandr Krasheninnikov](https://github.com/ClickHouse/ClickHouse/pull/3210)
* `compile_expressions` 设置（表达式的 JIT 编译）默认是启用的。
* 修复了同时执行 `DROP DATABASE/TABLE IF EXISTS` 和 `CREATE DATABASE/TABLE IF NOT EXISTS` 时的行为问题。此前，`CREATE DATABASE ... IF NOT EXISTS` 查询可能会返回错误信息 `File ... already exists`，而 `CREATE TABLE ... IF NOT EXISTS` 和 `DROP TABLE IF EXISTS` 查询可能会返回 `Table ... is creating or attaching right now`。 [#3101](https://github.com/ClickHouse/ClickHouse/pull/3101)
* 从 MySQL 或 ODBC 表中查询时，右侧为常量的 LIKE 和 IN 表达式会被传递到远程服务器。[#3182](https://github.com/ClickHouse/ClickHouse/pull/3182)
* 在从 MySQL 和 ODBC 表查询时，`WHERE` 子句中与常量表达式的比较会被下推到远程服务器。此前，只会下推与常量的比较。 [#3182](https://github.com/ClickHouse/ClickHouse/pull/3182)
* 在终端中针对 `Pretty` 格式正确计算行宽，包括含有宽字符（如汉字）的字符串。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3257)。
* 在 `ALTER UPDATE` 查询中可以指定 `ON CLUSTER`。
* 提高了读取 `JSONEachRow` 格式数据时的性能。[#3332](https://github.com/ClickHouse/ClickHouse/pull/3332)
* 为兼容性为 `LENGTH` 和 `CHARACTER_LENGTH` 函数添加了别名。`CONCAT` 函数不再区分大小写。[#3306](https://github.com/ClickHouse/ClickHouse/pull/3306)
* 为 `DateTime` 类型新增了别名 `TIMESTAMP`。 [#3390](https://github.com/ClickHouse/ClickHouse/pull/3390)
* 在服务器日志中始终会为 query&#95;id 预留空间，即使该日志行与查询无关。这样便于使用第三方工具解析服务器文本日志。
* 当查询的内存消耗超过下一个整数级别的 GB 时，会被记录到日志中。[#3205](https://github.com/ClickHouse/ClickHouse/pull/3205)
* 针对以下情况新增了兼容模式：使用 Native 协议的客户端库在执行 `INSERT` 查询时，因误操作发送的列数少于服务端预期。使用 `clickhouse-cpp` 库时可能会出现这种情况。此前，这种情况会导致服务端崩溃。[#3171](https://github.com/ClickHouse/ClickHouse/pull/3171)
* 在 `clickhouse-copier` 中的用户自定义 WHERE 表达式中，现在可以使用 `partition_key` 别名（用于对源表分区进行额外过滤）。如果在复制过程中分区方案只发生了轻微变化，这将非常有用。[#3166](https://github.com/ClickHouse/ClickHouse/pull/3166)
* 为在高负载下自动降低数据读取速度，`Kafka` 引擎的工作流已迁移至后台线程池。[Marek Vavruša](https://github.com/ClickHouse/ClickHouse/pull/3215)。
* 支持在 `Cap'n Proto` 格式中读取类似 `struct` 结构的 `Tuple` 和 `Nested` 值。 [Marek Vavruša](https://github.com/ClickHouse/ClickHouse/pull/3216)
* `firstSignificantSubdomain` 函数的顶级域名列表现已包含 `biz`。 [decaseal](https://github.com/ClickHouse/ClickHouse/pull/3219)
* 在外部字典的配置中，`null_value` 被解释为该数据类型的默认值。[#3330](https://github.com/ClickHouse/ClickHouse/pull/3330)
* 为 `Decimal` 类型添加对 `intDiv` 和 `intDivOrZero` 函数的支持。[b48402e8](https://github.com/ClickHouse/ClickHouse/commit/b48402e8712e2b9b151e0eef8193811d433a1264)
* 在 `sumMap` 聚合函数中支持将 `Date`、`DateTime`、`UUID` 和 `Decimal` 类型用作键。 [#3281](https://github.com/ClickHouse/ClickHouse/pull/3281)
* 支持在外部字典中使用 `Decimal` 数据类型。[#3324](https://github.com/ClickHouse/ClickHouse/pull/3324)
* `SummingMergeTree` 表现在支持 `Decimal` 数据类型。[#3348](https://github.com/ClickHouse/ClickHouse/pull/3348)
* 为 `if` 添加了针对 `UUID` 的特化实现。 [#3366](https://github.com/ClickHouse/ClickHouse/pull/3366)
* 从 `MergeTree` 表读取数据时，减少了 `open` 和 `close` 系统调用的次数。[#3283](https://github.com/ClickHouse/ClickHouse/pull/3283)
* `TRUNCATE TABLE` 查询可以在任意副本上执行（查询会被发送到主副本）。[Kirill Shvakov](https://github.com/ClickHouse/ClickHouse/pull/3375)

#### 错误修复：{#bug-fixes-10}


* 修复了 `range_hashed` 类型字典的 `Dictionary` 表相关问题。该错误出现在 18.12.17 版本中。[#1702](https://github.com/ClickHouse/ClickHouse/pull/1702)
* 修复了在加载 `range_hashed` 字典时出现的错误（错误消息为 `Unsupported type Nullable (...)`）。该错误存在于 18.12.17 版本中。[#3362](https://github.com/ClickHouse/ClickHouse/pull/3362)
* 修复了 `pointInPolygon` 函数中的错误，该错误是由于在处理顶点数量多且彼此非常接近的多边形时，计算不精确而累积产生的误差所导致。 [#3331](https://github.com/ClickHouse/ClickHouse/pull/3331) [#3341](https://github.com/ClickHouse/ClickHouse/pull/3341)
* 如果在合并数据部分后，合并得到的新数据部分的校验和与另一副本上执行相同合并所得到的校验和不同，则会删除该合并结果并从另一副本下载该数据部分（这是正确的行为）。但在下载该数据部分之后，由于出现“该部分已存在”的错误，无法将其加入工作集（因为该数据部分是在合并之后经过一段延迟才被删除）。这导致系统循环地反复尝试下载同一份数据。[#3194](https://github.com/ClickHouse/ClickHouse/pull/3194)
* 修复了查询总内存消耗计算不正确的问题（由于计算错误，`max_memory_usage_for_all_queries` 设置无法正确生效，`MemoryTracking` 指标的值也不正确）。此错误存在于 18.12.13 版本中。[Marek Vavruša](https://github.com/ClickHouse/ClickHouse/pull/3344)
* 修复了 `CREATE TABLE ... ON CLUSTER ... AS SELECT ...` 的功能问题。该错误出现在 18.12.13 版本中。 [#3247](https://github.com/ClickHouse/ClickHouse/pull/3247)
* 修复了这样一种情况：当 `JOIN` 仅在远程服务器上执行时，会在发起查询的服务器上不必要地准备相关数据结构。 [#3340](https://github.com/ClickHouse/ClickHouse/pull/3340)
* 修复了 `Kafka` 引擎中的问题：在开始读取数据时发生异常后出现的死锁，以及在结束时出现的锁 [Marek Vavruša](https://github.com/ClickHouse/ClickHouse/pull/3215)。
* 对于 `Kafka` 表，没有传递可选的 `schema` 参数（即 `Cap'n'Proto` 格式的 schema）。[Vojtech Splichal](https://github.com/ClickHouse/ClickHouse/pull/3150)
* 如果 ZooKeeper 服务器集群中存在某些服务器，它们接受连接但在完成握手前立即关闭连接，ClickHouse 会选择连接到另一台服务器。此前，这会导致出现错误 `Cannot read all data. Bytes read: 0. Bytes expected: 4.`，并且服务器无法启动。[8218cf3a](https://github.com/ClickHouse/ClickHouse/commit/8218cf3a5f39a43401953769d6d12a0bb8d29da9)
* 如果 ZooKeeper 服务器集合中包含在进行 DNS 查询时返回错误的服务器，则这些服务器会被忽略。[17b8e209](https://github.com/ClickHouse/ClickHouse/commit/17b8e209221061325ad7ba0539f03c6e65f87f29)
* 修复了在以 `VALUES` 格式插入数据时（当 `input_format_values_interpret_expressions = 1` 时）在 `Date` 与 `DateTime` 之间进行类型转换的问题。此前，转换是在自 Unix 纪元起算的天数值与 Unix 时间戳之间进行的，这会导致意外结果。[#3229](https://github.com/ClickHouse/ClickHouse/pull/3229)
* 修正了 `Decimal` 与整数之间的类型转换。[#3211](https://github.com/ClickHouse/ClickHouse/pull/3211)
* 修复了 `enable_optimize_predicate_expression` 设置项中的错误。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3231)
* 修复了在使用非默认 CSV 分隔符（例如 `;`）时解析包含浮点数的 CSV 数据时出现的错误 [#3155](https://github.com/ClickHouse/ClickHouse/pull/3155)
* 修复了 `arrayCumSumNonNegative` 函数（当累加器小于零时，不再累加负值）。[Aleksey Studnev](https://github.com/ClickHouse/ClickHouse/pull/3163)
* 修复了在使用 `PREWHERE` 时，位于 `Distributed` 表之上的 `Merge` 表的工作机制。[#3165](https://github.com/ClickHouse/ClickHouse/pull/3165)
* 修复 `ALTER UPDATE` 查询中的错误。
* 修复了 18.12 版本中 `odbc` 表函数出现的错误。[#3197](https://github.com/ClickHouse/ClickHouse/pull/3197)
* 修复了使用 `StateArray` 组合器的聚合函数的行为。 [#3188](https://github.com/ClickHouse/ClickHouse/pull/3188)
* 修复了将 `Decimal` 值除以零时导致的崩溃。[69dd6609](https://github.com/ClickHouse/ClickHouse/commit/69dd6609193beb4e7acd3e6ad216eca0ccfb8179)
* 修正了使用 `Decimal` 与整数参数进行运算时的结果类型。[#3224](https://github.com/ClickHouse/ClickHouse/pull/3224)
* 修复了在 `Decimal128` 上执行 `GROUP BY` 时发生的段错误。 [3359ba06](https://github.com/ClickHouse/ClickHouse/commit/3359ba06c39fcd05bfdb87d6c64154819621e13a)
* `log_query_threads` 设置（记录每个查询执行线程的信息）现在仅在 `log_queries` 选项（记录查询信息）被设置为 1 时才会生效。由于 `log_query_threads` 选项默认启用，以前即使禁用了查询日志，线程相关的信息也仍然会被记录。 [#3241](https://github.com/ClickHouse/ClickHouse/pull/3241)
* 修复了 `quantiles` 聚合函数在分布式执行时出现的错误（错误信息：`Not found column quantile...`）。[292a8855](https://github.com/ClickHouse/ClickHouse/commit/292a885533b8e3b41ce8993867069d14cbd5a664)
* 修复了在同时使用由 18.12.17 版本服务器和更早版本服务器组成的集群时的兼容性问题。对于 `GROUP BY` 键同时包含定长和非定长字段的分布式查询，如果需要聚合的数据量很大，返回的数据并不总是被完全聚合（两条不同的记录可能包含相同的聚合键）。 [#3254](https://github.com/ClickHouse/ClickHouse/pull/3254)
* 修复了 `clickhouse-performance-test` 中对替换项的处理逻辑，以正确支持查询仅包含测试中声明的部分替换项的情况。[#3263](https://github.com/ClickHouse/ClickHouse/pull/3263)
* 修复了在 `FINAL` 与 `PREWHERE` 搭配使用时出现的错误。[#3298](https://github.com/ClickHouse/ClickHouse/pull/3298)
* 修复了在对通过 `ALTER` 添加的列上使用 `PREWHERE` 时的错误。[#3298](https://github.com/ClickHouse/ClickHouse/pull/3298)
* 为 `DEFAULT` 和 `MATERIALIZED` 表达式新增了禁止使用 `arrayJoin` 的检查。此前，在插入数据时使用 `arrayJoin` 会导致错误。 [#3337](https://github.com/ClickHouse/ClickHouse/pull/3337)
* 新增了对在 `PREWHERE` 子句中使用 `arrayJoin` 的检查。此前，在执行查询时，这会导致出现诸如 `Size ... does not match` 或 `Unknown compression method` 之类的报错信息。[#3357](https://github.com/ClickHouse/ClickHouse/pull/3357)
* 修复了在进行某种优化后在极少数情况下可能出现的段错误。该优化会将由相等性比较组成的 AND 链替换为对应的 IN 表达式。 [liuyimin-bytedance](https://github.com/ClickHouse/ClickHouse/pull/3339)
* 对 `clickhouse-benchmark` 进行了小幅修正：此前不会向服务器发送客户端信息；现在在关闭以及限制迭代次数时，可以更精确地计算已执行查询的数量。 [#3351](https://github.com/ClickHouse/ClickHouse/pull/3351) [#3352](https://github.com/ClickHouse/ClickHouse/pull/3352)

#### 向后不兼容的变更: {#backward-incompatible-changes-1}

- 移除了 `allow_experimental_decimal_type` 选项。`Decimal` 数据类型现已默认可用。[#3329](https://github.com/ClickHouse/ClickHouse/pull/3329)


## ClickHouse 版本 18.12 {#clickhouse-release-18-12}

### ClickHouse 版本 18.12.17, 2018-09-16 {#clickhouse-release-18-12-17-2018-09-16}

#### 新功能: {#new-features-2}

- 为 `clickhouse` 数据源实现了 `invalidate_query`(用于指定查询以检查外部字典是否需要更新的功能)。[#3126](https://github.com/ClickHouse/ClickHouse/pull/3126)
- 新增了使用 `UInt*`、`Int*` 和 `DateTime` 数据类型(以及 `Date` 类型)作为 `range_hashed` 外部字典键的功能,用于定义范围边界。现在可以使用 `NULL` 来表示开放范围。[Vasily Nemkov](https://github.com/ClickHouse/ClickHouse/pull/3123)
- `Decimal` 类型现在支持 `var*` 和 `stddev*` 聚合函数。[#3129](https://github.com/ClickHouse/ClickHouse/pull/3129)
- `Decimal` 类型现在支持数学函数(如 `exp`、`sin` 等)。[#3129](https://github.com/ClickHouse/ClickHouse/pull/3129)
- `system.part_log` 表现在包含 `partition_id` 列。[#3089](https://github.com/ClickHouse/ClickHouse/pull/3089)

#### 错误修复: {#bug-fixes-11}

- `Merge` 现在可以在 `Distributed` 表上正确工作。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3159)
- 修复了导致 ClickHouse 无法在 `Ubuntu Precise` 及更早版本上运行的不兼容问题(对 `glibc` 版本的不必要依赖)。该不兼容问题出现在版本 18.12.13 中。[#3130](https://github.com/ClickHouse/ClickHouse/pull/3130)
- 修复了 `enable_optimize_predicate_expression` 设置中的错误。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3107)
- 修复了一个向后兼容性的小问题,该问题出现在使用早于 18.12.13 版本的副本集群时,同时在具有较新版本的服务器上创建表的新副本(显示消息 `Can not clone replica, because the ... updated to new ClickHouse version`,这在逻辑上是合理的,但不应该发生)。[#3122](https://github.com/ClickHouse/ClickHouse/pull/3122)

#### 向后不兼容的变更: {#backward-incompatible-changes-2}

- `enable_optimize_predicate_expression` 选项默认启用(这相当乐观)。如果出现与搜索列名相关的查询分析错误,请将 `enable_optimize_predicate_expression` 设置为 0。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3107)

### ClickHouse 版本 18.12.14, 2018-09-13 {#clickhouse-release-18-12-14-2018-09-13}

#### 新功能: {#new-features-3}

- 新增了对 `ALTER UPDATE` 查询的支持。[#3035](https://github.com/ClickHouse/ClickHouse/pull/3035)
- 新增了 `allow_ddl` 选项,用于限制用户对 DDL 查询的访问。[#3104](https://github.com/ClickHouse/ClickHouse/pull/3104)
- 为 `MergeTree` 引擎新增了 `min_merge_bytes_to_use_direct_io` 选项,允许您设置合并总大小的阈值(当超过阈值时,数据部分文件将使用 O_DIRECT 处理)。[#3117](https://github.com/ClickHouse/ClickHouse/pull/3117)
- `system.merges` 系统表现在包含 `partition_id` 列。[#3099](https://github.com/ClickHouse/ClickHouse/pull/3099)

#### 改进 {#improvements-3}

- 如果数据部分在变更期间保持不变,则副本不会下载它。[#3103](https://github.com/ClickHouse/ClickHouse/pull/3103)
- 在使用 `clickhouse-client` 时,设置名称支持自动补全。[#3106](https://github.com/ClickHouse/ClickHouse/pull/3106)

#### 错误修复: {#bug-fixes-12}


- 添加了在插入时对 `Nested` 类型字段的数组元素大小的检查。[#3118](https://github.com/ClickHouse/ClickHouse/pull/3118)
- 修复了使用 `ODBC` 数据源和 `hashed` 存储方式更新外部字典时的错误。该错误出现在 18.12.13 版本中。
- 修复了从包含 `IN` 条件的查询创建临时表时发生的崩溃问题。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3098)
- 修复了针对可能包含 `NULL` 元素的数组的聚合函数中的错误。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3097)

### ClickHouse Release 18.12.13, 2018-09-10 {#clickhouse-release-18-12-13-2018-09-10}

#### 新特性: {#new-features-4}


* 添加了 `DECIMAL(digits, scale)` 数据类型（`Decimal32(scale)`、`Decimal64(scale)`、`Decimal128(scale)`）。要启用该功能，请通过设置 `allow_experimental_decimal_type` 来实现。 [#2846](https://github.com/ClickHouse/ClickHouse/pull/2846) [#2970](https://github.com/ClickHouse/ClickHouse/pull/2970) [#3008](https://github.com/ClickHouse/ClickHouse/pull/3008) [#3047](https://github.com/ClickHouse/ClickHouse/pull/3047)
* 为 `GROUP BY` 新增 `WITH ROLLUP` 修饰符（另一种语法形式：`GROUP BY ROLLUP(...)`）。[#2948](https://github.com/ClickHouse/ClickHouse/pull/2948)
* 在包含 JOIN 的查询中，根据 SQL 标准，星号字符会展开为所有表中所有列的列表。你可以在用户配置级别将 `asterisk_left_columns_only` 设置为 1 来恢复旧的行为。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2787)
* 新增对在 JOIN 中使用表函数的支持。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2907)
* 在 clickhouse-client 中按 Tab 键进行自动补全。 [Sergey Shcherbin](https://github.com/ClickHouse/ClickHouse/pull/2447)
* 在 clickhouse-client 中按下 Ctrl+C 会取消当前已输入的查询。 [#2877](https://github.com/ClickHouse/ClickHouse/pull/2877)
* 新增 `join_default_strictness` 设置（取值：`"`, `'any'`, `'all'`）。通过它，在使用 `JOIN` 时可以不再显式指定 `ANY` 或 `ALL`。[#2982](https://github.com/ClickHouse/ClickHouse/pull/2982)
* 服务器日志中与查询处理相关的每一行都会显示查询 ID。[#2482](https://github.com/ClickHouse/ClickHouse/pull/2482)
* 现在，您可以在 clickhouse-client 中获取查询执行日志（使用 `send_logs_level` 设置）。在分布式查询处理时，所有服务器上的日志都会逐级传递并汇总。[#2482](https://github.com/ClickHouse/ClickHouse/pull/2482)
* 现在，当执行查询时，`system.query_log` 和 `system.processes`（`SHOW PROCESSLIST`）表中会包含所有已更改设置的信息（`Settings` 数据的嵌套结构）。新增了 `log_query_settings` 设置。[#2482](https://github.com/ClickHouse/ClickHouse/pull/2482)
* `system.query_log` 和 `system.processes` 表现在会显示参与查询执行的线程数量（参见 `thread_numbers` 列）。 [#2482](https://github.com/ClickHouse/ClickHouse/pull/2482)
* 新增了用于统计以下内容的 `ProfileEvents` 计数器：通过网络进行读写所花费的时间、对磁盘进行读写所花费的时间、网络错误的次数，以及在网络带宽受限时的等待时间。[#2482](https://github.com/ClickHouse/ClickHouse/pull/2482)
* 添加了一组 `ProfileEvents` 计数器，其中包含来自 rusage 的系统指标（可用于获取用户态和内核态的 CPU 使用情况、缺页中断以及上下文切换等信息），以及来自 taskstats 的指标（用于获取 I/O 等待时间、CPU 等待时间，以及在使用和不使用页缓存情况下读取和写入的数据量）。 [#2482](https://github.com/ClickHouse/ClickHouse/pull/2482)
* `ProfileEvents` 计数器既在全局生效，也会分别作用于每个查询及其每个执行线程，从而可以对各个查询的资源消耗进行细致分析。 [#2482](https://github.com/ClickHouse/ClickHouse/pull/2482)
* 新增 `system.query_thread_log` 表，用于记录每个查询执行线程的信息。新增 `log_query_threads` 设置。[#2482](https://github.com/ClickHouse/ClickHouse/pull/2482)
* `system.metrics` 和 `system.events` 表现在内置了文档。[#3016](https://github.com/ClickHouse/ClickHouse/pull/3016)
* 新增 `arrayEnumerateDense` 函数。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2975)
* 新增了 `arrayCumSumNonNegative` 和 `arrayDifference` 函数。[Aleksey Studnev](https://github.com/ClickHouse/ClickHouse/pull/2942)
* 新增了 `retention` 聚合函数。[Sundy Li](https://github.com/ClickHouse/ClickHouse/pull/2887)
* 现在可以使用加号运算符合并聚合函数的状态，并将聚合函数的状态乘以非负常数。 [#3062](https://github.com/ClickHouse/ClickHouse/pull/3062) [#3034](https://github.com/ClickHouse/ClickHouse/pull/3034)
* MergeTree 系列表现在增加了虚拟列 `_partition_id`。 [#3089](https://github.com/ClickHouse/ClickHouse/pull/3089)

#### 实验性功能： {#experimental-features-1}

- 新增 `LowCardinality(T)` 数据类型。该数据类型会自动创建值的本地字典,允许在不解包字典的情况下进行数据处理。[#2830](https://github.com/ClickHouse/ClickHouse/pull/2830)
- 新增 JIT 编译函数的缓存以及编译前使用次数的计数器。要对表达式进行 JIT 编译,请启用 `compile_expressions` 设置。[#2990](https://github.com/ClickHouse/ClickHouse/pull/2990) [#3077](https://github.com/ClickHouse/ClickHouse/pull/3077)

#### 改进： {#improvements-4}


* 修复了在存在遗弃副本时复制日志无限累积的问题。为延迟较大的副本新增了高效的恢复模式。
* 当 `GROUP BY` 包含多个聚合字段且其中一个为字符串类型、其余为定长类型时，其性能得到了提升。
* 在使用 `PREWHERE` 以及将表达式隐式下推到 `PREWHERE` 时的性能得到提升。
* 提升了文本格式（`CSV`、`TSV`）的解析性能。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2977) [#2980](https://github.com/ClickHouse/ClickHouse/pull/2980)
* 提升了在二进制格式下读取字符串和数组的性能。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2955)
* 在单个服务器上存在大量表时，对 `system.tables` 和 `system.columns` 的查询性能得到提升，内存占用减少。[#2953](https://github.com/ClickHouse/ClickHouse/pull/2953)
* 修复了在大量查询请求导致错误时的性能问题（在 `perf top` 中可以看到 `_dl_addr` 函数，但服务器的 CPU 使用率并不高）。[#2938](https://github.com/ClickHouse/ClickHouse/pull/2938)
* 在启用 `enable_optimize_predicate_expression` 时，条件会被下推到 View 中。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2907)
* 对 `UUID` 数据类型的功能进行了改进。[#3074](https://github.com/ClickHouse/ClickHouse/pull/3074) [#2985](https://github.com/ClickHouse/ClickHouse/pull/2985)
* `UUID` 数据类型在 The-Alchemist 字典中已支持。[#2822](https://github.com/ClickHouse/ClickHouse/pull/2822)
* `visitParamExtractRaw` 函数在嵌套结构中也能正常工作。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2974)
* 启用 `input_format_skip_unknown_fields` 设置后，将会正确跳过 `JSONEachRow` 格式中的未知对象字段。[BlahGeek](https://github.com/ClickHouse/ClickHouse/pull/2958)
* 在使用带条件的 `CASE` 表达式时，现在可以省略 `ELSE`，其效果等同于 `ELSE NULL`。[#2920](https://github.com/ClickHouse/ClickHouse/pull/2920)
* 现在在配合 ZooKeeper 使用时，可以配置操作超时时间。[urykhy](https://github.com/ClickHouse/ClickHouse/pull/2971)
* 你可以将 `LIMIT n, m` 写成 `LIMIT n OFFSET m` 来指定偏移量。 [#2840](https://github.com/ClickHouse/ClickHouse/pull/2840)
* 你可以使用 `SELECT TOP n` 语法来代替 `LIMIT`。 [#2840](https://github.com/ClickHouse/ClickHouse/pull/2840)
* 已增大写入 system 表的队列大小，从而降低出现 `SystemLog parameter queue is full` 错误的频率。
* `windowFunnel` 聚合函数现在支持同时满足多个条件的事件。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2801)
* 在 `JOIN` 的 `USING` 子句中可以使用重复的列。 [#3006](https://github.com/ClickHouse/ClickHouse/pull/3006)
* `Pretty` 格式现在对按宽度对齐列的填充宽度增加了限制。请使用 `output_format_pretty_max_column_pad_width` 设置。如果某个值的宽度超过该限制，它仍会完整显示，但表中的其他单元格不会变得过宽。[#3003](https://github.com/ClickHouse/ClickHouse/pull/3003)
* `odbc` 表函数现在支持指定数据库/schema 名称。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2885)
* 新增支持使用在 `clickhouse-client` 配置文件中指定的用户名。[Vladimir Kozbin](https://github.com/ClickHouse/ClickHouse/pull/2909)
* `ZooKeeperExceptions` 计数器已拆分为三个计数器：`ZooKeeperUserExceptions`、`ZooKeeperHardwareExceptions` 和 `ZooKeeperOtherExceptions`。
* `ALTER DELETE` 查询可用于物化视图。
* 在定期运行 `ReplicatedMergeTree` 表的清理线程时引入了随机化，以避免在存在大量 `ReplicatedMergeTree` 表时出现周期性的负载峰值。
* 支持 `ATTACH TABLE ... ON CLUSTER` 查询。 [#3025](https://github.com/ClickHouse/ClickHouse/pull/3025)

#### 错误修复：{#bug-fixes-13}


* 修复了 `Dictionary` 表中的一个问题（会抛出 `Size of offsets does not match size of column` 或 `Unknown compression method` 异常）。该缺陷自 18.10.3 版本起出现。[#2913](https://github.com/ClickHouse/ClickHouse/issues/2913)
* 修复了在合并 `CollapsingMergeTree` 表时出现的一个 bug：如果其中一个数据分片为空（这类分片会在合并过程中或执行 `ALTER DELETE` 且所有数据被删除时生成），并且合并使用了 `vertical` 算法，就会触发该问题。 [#3049](https://github.com/ClickHouse/ClickHouse/pull/3049)
* 修复了在对 `Memory` 表执行 `DROP` 或 `TRUNCATE` 时，与并发执行的 `SELECT` 查询之间出现的竞争条件，该问题可能导致服务器崩溃。此缺陷出现在版本 1.1.54388 中。[#3038](https://github.com/ClickHouse/ClickHouse/pull/3038)
* 修复了在向 `Replicated` 表插入数据时，如果返回 `Session is expired` 错误，可能导致数据丢失的问题（数据丢失可通过 `ReplicatedDataLoss` 指标检测）。该错误出现在 1.1.54378 版本中。[#2939](https://github.com/ClickHouse/ClickHouse/pull/2939) [#2949](https://github.com/ClickHouse/ClickHouse/pull/2949) [#2964](https://github.com/ClickHouse/ClickHouse/pull/2964)
* 修复了在执行 `JOIN ... ON` 时出现的段错误。 [#3000](https://github.com/ClickHouse/ClickHouse/pull/3000)
* 修复了在 `WHERE` 表达式完全由限定列名组成时（例如 `WHERE table.column`）进行列名搜索时出现的错误。[#2994](https://github.com/ClickHouse/ClickHouse/pull/2994)
* 修复了在执行分布式查询且仅从远程服务器请求一个包含带子查询的 IN 表达式的列时出现的 “Not found column” 错误。[#3087](https://github.com/ClickHouse/ClickHouse/pull/3087)
* 修复了在分布式查询中，如果一个分片是本地而另一个不是，并且触发了将条件下推到 `PREWHERE` 的优化时可能出现的 `Block structure mismatch in UNION stream: different number of columns` 错误。[#2226](https://github.com/ClickHouse/ClickHouse/pull/2226) [#3037](https://github.com/ClickHouse/ClickHouse/pull/3037) [#3055](https://github.com/ClickHouse/ClickHouse/pull/3055) [#3065](https://github.com/ClickHouse/ClickHouse/pull/3065) [#3073](https://github.com/ClickHouse/ClickHouse/pull/3073) [#3090](https://github.com/ClickHouse/ClickHouse/pull/3090) [#3093](https://github.com/ClickHouse/ClickHouse/pull/3093)
* 修复了 `pointInPolygon` 函数在处理某些非凸多边形时的问题。 [#2910](https://github.com/ClickHouse/ClickHouse/pull/2910)
* 修复了将 `nan` 与整数比较时结果不正确的问题。[#3024](https://github.com/ClickHouse/ClickHouse/pull/3024)
* 修复了 `zlib-ng` 库中的一个错误，该错误在极少数情况下可能会导致段错误（segfault）。 [#2854](https://github.com/ClickHouse/ClickHouse/pull/2854)
* 修复了在向包含 `AggregateFunction` 列的表插入数据时出现的内存泄漏问题：当聚合函数的状态不是简单状态（需要单独分配内存），且一次插入请求被拆分为多个小数据块时会触发该问题。 [#3084](https://github.com/ClickHouse/ClickHouse/pull/3084)
* 修复了在同时创建和删除同一个 `Buffer` 或 `MergeTree` 表时可能出现的竞态条件问题。
* 修复了在比较由某些复杂类型（例如元组）组成的元组时可能发生段错误的问题。[#2989](https://github.com/ClickHouse/ClickHouse/pull/2989)
* 修复了在执行某些 `ON CLUSTER` 查询时可能发生的段错误。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2960)
* 修复了在处理 `Nullable` 数组元素时 `arrayDistinct` 函数中的错误。 [#2845](https://github.com/ClickHouse/ClickHouse/pull/2845) [#2937](https://github.com/ClickHouse/ClickHouse/pull/2937)
* `enable_optimize_predicate_expression` 选项现在可以正确支持包含 `SELECT *` 的情况。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2929)
* 修复了在重新初始化 ZooKeeper 会话时发生的段错误。 [#2917](https://github.com/ClickHouse/ClickHouse/pull/2917)
* 修复了在使用 ZooKeeper 时可能出现的阻塞问题。
* 修复了在 `SummingMergeTree` 中添加嵌套数据结构时使用的错误代码。
* 在为聚合函数状态分配内存时，会正确考虑内存对齐，从而在实现聚合函数状态时可以使用那些需要对齐的操作。[chenxing-xc](https://github.com/ClickHouse/ClickHouse/pull/2808)

#### 安全修复: {#security-fix}

- ODBC 数据源的安全使用。与 ODBC 驱动程序的交互使用独立的 `clickhouse-odbc-bridge` 进程。第三方 ODBC 驱动程序中的错误不再导致服务器稳定性问题或安全漏洞。[#2828](https://github.com/ClickHouse/ClickHouse/pull/2828) [#2879](https://github.com/ClickHouse/ClickHouse/pull/2879) [#2886](https://github.com/ClickHouse/ClickHouse/pull/2886) [#2893](https://github.com/ClickHouse/ClickHouse/pull/2893) [#2921](https://github.com/ClickHouse/ClickHouse/pull/2921)
- 修复了 `catBoostPool` 表函数中文件路径验证不正确的问题。[#2894](https://github.com/ClickHouse/ClickHouse/pull/2894)
- 系统表(`tables`、`databases`、`parts`、`columns`、`parts_columns`、`merges`、`mutations`、`replicas` 和 `replication_queue`)的内容根据用户配置的数据库访问权限(`allow_databases`)进行过滤。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2856)

#### 向后不兼容的变更: {#backward-incompatible-changes-3}

- 在包含 JOIN 的查询中,星号字符会扩展为所有表中的列列表,符合 SQL 标准。您可以通过在用户配置级别将 `asterisk_left_columns_only` 设置为 1 来恢复旧行为。

#### 构建变更: {#build-changes-2}

- 现在大多数集成测试可以按提交运行。
- 代码风格检查也可以按提交运行。
- 在 CentOS7/Fedora 上构建时,会正确选择 `memcpy` 实现。[Etienne Champetier](https://github.com/ClickHouse/ClickHouse/pull/2912)
- 使用 clang 构建时,除了常规的 `-Wall-Wextra -Werror` 之外,还添加了来自 `-Weverything` 的一些警告。[#2957](https://github.com/ClickHouse/ClickHouse/pull/2957)
- 调试构建使用 `jemalloc` 调试选项。
- 用于与 ZooKeeper 交互的库接口被声明为抽象接口。[#2950](https://github.com/ClickHouse/ClickHouse/pull/2950)


## ClickHouse 版本 18.10 {#clickhouse-release-18-10}

### ClickHouse 版本 18.10.3, 2018-08-13 {#clickhouse-release-18-10-3-2018-08-13}

#### 新功能: {#new-features-5}

- 复制功能支持使用 HTTPS。[#2760](https://github.com/ClickHouse/ClickHouse/pull/2760)
- 在现有的 `murmurHash2_32` 基础上,新增了 `murmurHash2_64`、`murmurHash3_32`、`murmurHash3_64` 和 `murmurHash3_128` 函数。[#2791](https://github.com/ClickHouse/ClickHouse/pull/2791)
- ClickHouse ODBC 驱动程序(`ODBCDriver2` 输出格式)支持 Nullable 类型。[#2834](https://github.com/ClickHouse/ClickHouse/pull/2834)
- 键列支持 `UUID` 类型。

#### 改进: {#improvements-5}

- 从配置文件中删除集群时,无需重启服务器即可移除集群。[#2777](https://github.com/ClickHouse/ClickHouse/pull/2777)
- 从配置文件中移除外部字典时,无需重启服务器即可删除外部字典。[#2779](https://github.com/ClickHouse/ClickHouse/pull/2779)
- 为 `Kafka` 表引擎添加了 `SETTINGS` 支持。[Alexander Marshalov](https://github.com/ClickHouse/ClickHouse/pull/2781)
- 改进了 `UUID` 数据类型(尚未完成)。[#2618](https://github.com/ClickHouse/ClickHouse/pull/2618)
- `SummingMergeTree`、`CollapsingMergeTree` 和 `VersionedCollapsingMergeTree` 引擎支持合并后的空数据分区。[#2815](https://github.com/ClickHouse/ClickHouse/pull/2815)
- 已完成的变更(`ALTER DELETE`)的旧记录会被删除。[#2784](https://github.com/ClickHouse/ClickHouse/pull/2784)
- 新增了 `system.merge_tree_settings` 表。[Kirill Shvakov](https://github.com/ClickHouse/ClickHouse/pull/2841)
- `system.tables` 表新增了依赖关系列:`dependencies_database` 和 `dependencies_table`。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2851)
- 新增了 `max_partition_size_to_drop` 配置选项。[#2782](https://github.com/ClickHouse/ClickHouse/pull/2782)
- 新增了 `output_format_json_escape_forward_slashes` 选项。[Alexander Bocharov](https://github.com/ClickHouse/ClickHouse/pull/2812)
- 新增了 `max_fetch_partition_retries_count` 设置。[#2831](https://github.com/ClickHouse/ClickHouse/pull/2831)
- 新增了 `prefer_localhost_replica` 设置,用于禁用本地副本优先选择,并在无需进程间交互的情况下访问本地副本。[#2832](https://github.com/ClickHouse/ClickHouse/pull/2832)
- 当对空的 `Float32` 或 `Float64` 集合进行聚合时,`quantileExact` 聚合函数返回 `nan`。[Sundy Li](https://github.com/ClickHouse/ClickHouse/pull/2855)

#### 错误修复: {#bug-fixes-14}


- 移除了 ODBC 连接字符串参数中不必要的转义,该转义会导致无法建立连接。此错误出现在 18.6.0 版本中。
- 修复了复制队列中处理 `REPLACE PARTITION` 命令的逻辑。如果同一分区存在两个 `REPLACE` 命令,错误的逻辑可能导致其中一个命令保留在复制队列中而未被执行。[#2814](https://github.com/ClickHouse/ClickHouse/pull/2814)
- 修复了当所有数据部分为空时的合并错误(这些部分由合并形成,或在所有数据被删除时由 `ALTER DELETE` 形成)。此错误出现在 18.1.0 版本中。[#2930](https://github.com/ClickHouse/ClickHouse/pull/2930)
- 修复了并发 `Set` 或 `Join` 的错误。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2823)
- 修复了子查询中 `UNION ALL` 查询出现的 `Block structure mismatch in UNION stream: different number of columns` 错误,该错误在其中一个 `SELECT` 查询包含重复列名时发生。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2094)
- 修复了连接到 MySQL 服务器时发生异常导致的内存泄漏问题。
- 修复了查询错误时 clickhouse-client 响应码不正确的问题。
- 修复了包含 DISTINCT 的物化视图的错误行为。[#2795](https://github.com/ClickHouse/ClickHouse/issues/2795)

#### 向后不兼容的变更 {#backward-incompatible-changes-4}

- 移除了对 Distributed 表的 CHECK TABLE 查询支持。

#### 构建变更: {#build-changes-3}

- 内存分配器已被替换:现在使用 `jemalloc` 代替 `tcmalloc`。在某些场景下,速度提升最多可达 20%。然而,也有一些查询的速度降低了最多 20%。在某些场景下,内存消耗减少了约 10%,稳定性得到改善。在高并发负载下,用户空间和系统的 CPU 使用率仅略有增加。[#2773](https://github.com/ClickHouse/ClickHouse/pull/2773)
- 使用子模块中的 libressl。[#1983](https://github.com/ClickHouse/ClickHouse/pull/1983) [#2807](https://github.com/ClickHouse/ClickHouse/pull/2807)
- 使用子模块中的 unixodbc。[#2789](https://github.com/ClickHouse/ClickHouse/pull/2789)
- 使用子模块中的 mariadb-connector-c。[#2785](https://github.com/ClickHouse/ClickHouse/pull/2785)
- 向代码仓库添加了依赖于测试数据可用性的功能测试文件(目前不包含测试数据本身)。


## ClickHouse 版本 18.6 {#clickhouse-release-18-6}

### ClickHouse 版本 18.6.0, 2018-08-02 {#clickhouse-release-18-6-0-2018-08-02}

#### 新功能: {#new-features-6}

- 为 JOIN ON 语法添加了 ON 表达式支持:
  `JOIN ON Expr([table.]column ...) = Expr([table.]column, ...) [AND Expr([table.]column, ...) = Expr([table.]column, ...) ...]`
  表达式必须是由 AND 运算符连接的等式链。等式的每一侧可以是对某个表的列进行的任意表达式运算。右表支持使用完全限定列名(`table.name`、`database.table.name`、`table_alias.name`、`subquery_alias.name`)。[#2742](https://github.com/ClickHouse/ClickHouse/pull/2742)
- 复制功能现已支持启用 HTTPS。[#2760](https://github.com/ClickHouse/ClickHouse/pull/2760)

#### 改进: {#improvements-6}

- 服务器现在会将其版本的补丁号传递给客户端。补丁版本信息可在 `system.processes` 和 `query_log` 中查看。[#2646](https://github.com/ClickHouse/ClickHouse/pull/2646)


## ClickHouse 版本 18.5 {#clickhouse-release-18-5}

### ClickHouse 版本 18.5.1, 2018-07-31 {#clickhouse-release-18-5-1-2018-07-31}

#### 新功能: {#new-features-7}

- 新增哈希函数 `murmurHash2_32` [#2756](https://github.com/ClickHouse/ClickHouse/pull/2756)。

#### 改进: {#improvements-7}

- 现在可以使用 `from_env` [#2741](https://github.com/ClickHouse/ClickHouse/pull/2741) 属性从环境变量中设置配置文件的值。
- 新增 `coalesce`、`ifNull` 和 `nullIf` 函数的不区分大小写版本 [#2752](https://github.com/ClickHouse/ClickHouse/pull/2752)。

#### 错误修复: {#bug-fixes-15}

- 修复了启动副本时可能出现的错误 [#2759](https://github.com/ClickHouse/ClickHouse/pull/2759)。


## ClickHouse 版本 18.4 {#clickhouse-release-18-4}

### ClickHouse 版本 18.4.0,2018-07-28 {#clickhouse-release-18-4-0-2018-07-28}

#### 新特性: {#new-features-8}

- 新增系统表:`formats`、`data_type_families`、`aggregate_function_combinators`、`table_functions`、`table_engines`、`collations` [#2721](https://github.com/ClickHouse/ClickHouse/pull/2721)。
- 新增了使用表函数代替表作为 `remote` 或 `cluster table function` 参数的能力 [#2708](https://github.com/ClickHouse/ClickHouse/pull/2708)。
- 复制协议支持 `HTTP Basic` 身份验证 [#2727](https://github.com/ClickHouse/ClickHouse/pull/2727)。
- `has` 函数现在支持在 `Enum` 值数组中搜索数值 [Maxim Khrisanfov](https://github.com/ClickHouse/ClickHouse/pull/2699)。
- 支持从 `Kafka` 读取时添加任意消息分隔符 [Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2701)。

#### 改进: {#improvements-8}

- `ALTER TABLE t DELETE WHERE` 查询不会重写未受 WHERE 条件影响的数据部分 [#2694](https://github.com/ClickHouse/ClickHouse/pull/2694)。
- `ReplicatedMergeTree` 表的 `use_minimalistic_checksums_in_zookeeper` 选项默认启用。此设置在版本 1.1.54378(2018-04-16)中添加。早于 1.1.54378 的版本不再支持安装。
- 支持运行指定 `ON CLUSTER` 的 `KILL` 和 `OPTIMIZE` 查询 [Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2689)。

#### 错误修复: {#bug-fixes-16}

- 修复了使用 IN 表达式进行聚合时出现的 `Column ... is not under an aggregate function and not in GROUP BY` 错误。此错误出现在版本 18.1.0 中。([bbdd780b](https://github.com/ClickHouse/ClickHouse/commit/bbdd780be0be06a0f336775941cdd536878dd2c2))
- 修复了 `windowFunnel` 聚合函数中的错误 [Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2735)。
- 修复了 `anyHeavy` 聚合函数中的错误 ([a2101df2](https://github.com/ClickHouse/ClickHouse/commit/a2101df25a6a0fba99aa71f8793d762af2b801ee))
- 修复了使用 `countArray()` 聚合函数时服务器崩溃的问题。

#### 向后不兼容的变更: {#backward-incompatible-changes-5}

- `Kafka` 引擎的参数从 `Kafka(kafka_broker_list, kafka_topic_list, kafka_group_name, kafka_format[, kafka_schema, kafka_num_consumers])` 更改为 `Kafka(kafka_broker_list, kafka_topic_list, kafka_group_name, kafka_format[, kafka_row_delimiter, kafka_schema, kafka_num_consumers])`。如果您的表使用了 `kafka_schema` 或 `kafka_num_consumers` 参数,则必须手动编辑元数据文件 `path/metadata/database/table.sql` 并添加值为 `''` 的 `kafka_row_delimiter` 参数。


## ClickHouse 版本 18.1 {#clickhouse-release-18-1}

### ClickHouse 版本 18.1.0，2018-07-23 {#clickhouse-release-18-1-0-2018-07-23}

#### 新特性： {#new-features-9}

- 支持对非复制 MergeTree 表执行 `ALTER TABLE t DELETE WHERE` 查询（[#2634](https://github.com/ClickHouse/ClickHouse/pull/2634)）。
- `uniq*` 系列聚合函数支持任意类型（[#2010](https://github.com/ClickHouse/ClickHouse/issues/2010)）。
- 比较运算符支持任意类型（[#2026](https://github.com/ClickHouse/ClickHouse/issues/2026)）。
- `users.xml` 文件允许以 `10.0.0.1/255.255.255.0` 格式设置子网掩码。这对于使用中间包含零的 IPv6 网络掩码是必需的（[#2637](https://github.com/ClickHouse/ClickHouse/pull/2637)）。
- 新增 `arrayDistinct` 函数（[#2670](https://github.com/ClickHouse/ClickHouse/pull/2670)）。
- SummingMergeTree 引擎现在支持 AggregateFunction 类型的列（[Constantin S. Pan](https://github.com/ClickHouse/ClickHouse/pull/2566)）。

#### 改进： {#improvements-9}

- 更改了版本号编号方案。现在第一部分表示发布年份（公元纪年，莫斯科时区，减去 2000），第二部分表示主要变更的编号（大多数版本会递增），第三部分是补丁版本。除非变更日志中另有说明，否则版本仍保持向后兼容。
- 提升了浮点数到字符串的转换速度（[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2664)）。
- 如果在插入过程中由于解析错误而跳过了某些行（启用 `input_allow_errors_num` 和 `input_allow_errors_ratio` 设置时可能发生），现在会将跳过的行数写入服务器日志（[Leonardo Cecchi](https://github.com/ClickHouse/ClickHouse/pull/2669)）。

#### 错误修复： {#bug-fixes-17}

- 修复了临时表的 TRUNCATE 命令问题（[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2624)）。
- 修复了 ZooKeeper 客户端库中的罕见死锁问题，该问题在读取响应时发生网络错误时出现（[c315200](https://github.com/ClickHouse/ClickHouse/commit/c315200e64b87e44bdf740707fc857d1fdf7e947)）。
- 修复了 CAST 到 Nullable 类型时的错误（[#1322](https://github.com/ClickHouse/ClickHouse/issues/1322)）。
- 修复了当区间边界重合时 `maxIntersection()` 函数返回错误结果的问题（[Michael Furmur](https://github.com/ClickHouse/ClickHouse/pull/2657)）。
- 修复了函数参数中 OR 表达式链的错误转换问题（[chenxing-xc](https://github.com/ClickHouse/ClickHouse/pull/2663)）。
- 修复了在另一个子查询内包含 `IN (subquery)` 表达式的查询性能下降问题（[#2571](https://github.com/ClickHouse/ClickHouse/issues/2571)）。
- 修复了在分布式查询中使用非大写字母的 `CAST` 函数时不同版本服务器之间的不兼容问题（[fe8c4d6](https://github.com/ClickHouse/ClickHouse/commit/fe8c4d64e434cacd4ceef34faa9005129f2190a5)）。
- 为查询外部 DBMS 添加了缺失的标识符引号（[#2635](https://github.com/ClickHouse/ClickHouse/issues/2635)）。

#### 向后不兼容的变更： {#backward-incompatible-changes-6}

- 将包含数字零的字符串转换为 DateTime 不再有效。示例：`SELECT toDateTime('0')`。这也是表中 `DateTime DEFAULT '0'` 以及字典中 `<null_value>0</null_value>` 不起作用的原因。解决方案：将 `0` 替换为 `0000-00-00 00:00:00`。


## ClickHouse Release 1.1 {#clickhouse-release-1-1}

### ClickHouse 版本 1.1.54394, 2018-07-12 {#clickhouse-release-1-1-54394-2018-07-12}

#### 新特性: {#new-features-10}

- 新增 `histogram` 聚合函数 ([Mikhail Surin](https://github.com/ClickHouse/ClickHouse/pull/2521))。
- `OPTIMIZE TABLE ... FINAL` 现在可以在不指定分区的情况下用于 `ReplicatedMergeTree` ([Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2600))。

#### 错误修复: {#bug-fixes-18}

- 修复了在发送和下载复制数据时套接字读写超时时间过短(一秒)的问题,该问题导致在网络或磁盘存在负载时无法下载较大的数据部分(会导致循环尝试下载数据部分)。此错误出现在版本 1.1.54388 中。
- 修复了在表中插入重复数据块时在 ZooKeeper 中使用 chroot 的问题。
- `has` 函数现在可以正确处理包含 Nullable 元素的数组 ([#2115](https://github.com/ClickHouse/ClickHouse/issues/2115))。
- `system.tables` 表现在可以在分布式查询中正确工作。`metadata_modification_time` 和 `engine_full` 列现在是非虚拟列。修复了仅查询这些列时出现的错误。
- 修复了在插入空数据块后空 `TinyLog` 表的工作方式 ([#2563](https://github.com/ClickHouse/ClickHouse/issues/2563))。
- 当 ZooKeeper 中节点的值为 NULL 时,`system.zookeeper` 表可以正常工作。

### ClickHouse 版本 1.1.54390, 2018-07-06 {#clickhouse-release-1-1-54390-2018-07-06}

#### 新特性: {#new-features-11}

- 查询可以以 `multipart/form-data` 格式发送(在 `query` 字段中),这在同时发送外部数据用于查询处理时非常有用 ([Olga Hvostikova](https://github.com/ClickHouse/ClickHouse/pull/2490))。
- 新增在读取 CSV 格式数据时启用或禁用单引号或双引号处理的功能。可以通过 `format_csv_allow_single_quotes` 和 `format_csv_allow_double_quotes` 设置进行配置 ([Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2574))。
- `OPTIMIZE TABLE ... FINAL` 现在可以在不指定分区的情况下用于非复制版本的 `MergeTree` ([Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2599))。

#### 改进: {#improvements-10}

- 改进了在可以使用表索引时使用 IN 运算符的性能,降低了内存消耗,并正确跟踪内存使用情况 ([#2584](https://github.com/ClickHouse/ClickHouse/pull/2584))。
- 移除了添加数据部分时冗余的校验和检查。这在存在大量副本时非常重要,因为在这些情况下检查总数等于 N^2。
- 为 `arrayEnumerateUniq` 函数新增对 `Array(Tuple(...))` 参数的支持 ([#2573](https://github.com/ClickHouse/ClickHouse/pull/2573))。
- 为 `runningDifference` 函数新增 `Nullable` 支持 ([#2594](https://github.com/ClickHouse/ClickHouse/pull/2594))。
- 改进了存在大量表达式时的查询分析性能 ([#2572](https://github.com/ClickHouse/ClickHouse/pull/2572))。
- 加快了 `ReplicatedMergeTree` 表中用于合并的数据部分选择速度。加快了 ZooKeeper 会话的恢复速度 ([#2597](https://github.com/ClickHouse/ClickHouse/pull/2597))。
- 如果 `MergeTree` 表的 `format_version.txt` 文件缺失,将重新创建该文件,这在复制目录结构但不包含文件后启动 ClickHouse 时很有意义 ([Ciprian Hacman](https://github.com/ClickHouse/ClickHouse/pull/2593))。

#### 错误修复: {#bug-fixes-19}


- 修复了使用 ZooKeeper 时的一个错误,该错误可能导致在重启服务器之前无法恢复表的会话和只读状态。
- 修复了使用 ZooKeeper 时的一个错误,该错误可能导致会话中断时旧节点未被删除。
- 修复了 `quantileTDigest` 函数处理 Float 参数时的错误(该错误在版本 1.1.54388 中引入)([Mikhail Surin](https://github.com/ClickHouse/ClickHouse/pull/2553))。
- 修复了 MergeTree 表索引中的一个错误,当主键列位于相同大小的有符号和无符号整数之间类型转换函数内部时会出现该错误([#2603](https://github.com/ClickHouse/ClickHouse/pull/2603))。
- 修复了当使用 `macros` 但配置文件中不存在时导致的段错误([#2570](https://github.com/ClickHouse/ClickHouse/pull/2570))。
- 修复了客户端重新连接时切换到默认数据库的问题([#2583](https://github.com/ClickHouse/ClickHouse/pull/2583))。
- 修复了禁用 `use_index_for_in_with_subqueries` 设置时出现的错误。

#### 安全修复: {#security-fix-1}

- 连接到 MySQL 时不再允许发送文件(`LOAD DATA LOCAL INFILE`)。

### ClickHouse 版本 1.1.54388, 2018-06-28 {#clickhouse-release-1-1-54388-2018-06-28}

#### 新特性: {#new-features-12}

- 支持对复制表执行 `ALTER TABLE t DELETE WHERE` 查询。新增 `system.mutations` 表以跟踪此类查询的进度。
- 支持对 \*MergeTree 表执行 `ALTER TABLE t [REPLACE|ATTACH] PARTITION` 查询。
- 支持 `TRUNCATE TABLE` 查询([Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2260))
- 为复制表新增多个 `SYSTEM` 查询(`RESTART REPLICAS`、`SYNC REPLICA`、`[STOP|START] [MERGES|FETCHES|SENDS REPLICATED|REPLICATION QUEUES]`)。
- 新增向使用 MySQL 引擎的表写入数据的功能以及相应的表函数([sundy-li](https://github.com/ClickHouse/ClickHouse/pull/2294))。
- 新增 `url()` 表函数和 `URL` 表引擎([Alexander Sapin](https://github.com/ClickHouse/ClickHouse/pull/2501))。
- 新增 `windowFunnel` 聚合函数([sundy-li](https://github.com/ClickHouse/ClickHouse/pull/2352))。
- 新增字符串函数 `startsWith` 和 `endsWith`([Vadim Plakhtinsky](https://github.com/ClickHouse/ClickHouse/pull/2429))。
- `numbers()` 表函数现在允许指定偏移量([Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2535))。
- `clickhouse-client` 的密码现在可以交互式输入。
- 服务器日志现在可以发送到 syslog([Alexander Krasheninnikov](https://github.com/ClickHouse/ClickHouse/pull/2459))。
- 支持在使用共享库源的字典中记录日志([Alexander Sapin](https://github.com/ClickHouse/ClickHouse/pull/2472))。
- 支持自定义 CSV 分隔符([Ivan Zhukov](https://github.com/ClickHouse/ClickHouse/pull/2263))
- 新增 `date_time_input_format` 设置。如果将此设置切换到 `'best_effort'`,DateTime 值将以多种格式读取。
- 新增用于数据混淆的 `clickhouse-obfuscator` 工具。使用示例:发布性能测试中使用的数据。

#### 实验性特性: {#experimental-features-2}

- 新增仅在需要时计算 `and` 参数的功能([Anastasia Tsarkova](https://github.com/ClickHouse/ClickHouse/pull/2272))
- 某些表达式现在可以进行 JIT 编译到本地代码([pyos](https://github.com/ClickHouse/ClickHouse/pull/2277))。

#### 错误修复: {#bug-fixes-20}


- 使用 `DISTINCT` 和 `ORDER BY` 的查询不再出现重复项。
- 使用 `ARRAY JOIN` 和 `arrayFilter` 的查询不再返回错误结果。
- 修复了从 Nested 结构读取数组列时的错误 ([#2066](https://github.com/ClickHouse/ClickHouse/issues/2066))。
- 修复了分析带有 `HAVING tuple IN (...)` 形式的 HAVING 子句的查询时的错误。
- 修复了分析带有递归别名的查询时的错误。
- 修复了从 ReplacingMergeTree 读取数据时,当 PREWHERE 中的条件过滤掉所有行时的错误 ([#2525](https://github.com/ClickHouse/ClickHouse/issues/2525))。
- 修复了在 HTTP 接口中使用会话时未应用用户配置文件设置的问题。
- 修复了 clickhouse-local 中从命令行参数应用设置的方式。
- ZooKeeper 客户端库现在使用从服务器接收的会话超时时间。
- 修复了 ZooKeeper 客户端库中客户端等待服务器响应时间超过超时时间的错误。
- 修复了对分区键列有条件的查询的数据分区修剪问题 ([#2342](https://github.com/ClickHouse/ClickHouse/issues/2342))。
- 现在可以在 `CLEAR COLUMN IN PARTITION` 之后进行合并 ([#2315](https://github.com/ClickHouse/ClickHouse/issues/2315))。
- 修复了 ODBC 表函数中的类型映射 ([sundy-li](https://github.com/ClickHouse/ClickHouse/pull/2268))。
- 修复了带时区和不带时区的 `DateTime` 类型比较 ([Alexander Bocharov](https://github.com/ClickHouse/ClickHouse/pull/2400))。
- 修复了 `CAST` 操作符的语法解析和格式化。
- 修复了 Distributed 表引擎的物化视图插入问题 ([Babacar Diassé](https://github.com/ClickHouse/ClickHouse/pull/2411))。
- 修复了从 `Kafka` 引擎向物化视图写入数据时的竞态条件 ([Yangkuan Liu](https://github.com/ClickHouse/ClickHouse/pull/2448))。
- 修复了 remote() 表函数中的 SSRF 漏洞。
- 修复了 `clickhouse-client` 在多行模式下的退出行为 ([#2510](https://github.com/ClickHouse/ClickHouse/issues/2510))。

#### 改进: {#improvements-11}

- 复制表中的后台任务现在在线程池中执行,而不是在单独的线程中执行 ([Silviu Caragea](https://github.com/ClickHouse/ClickHouse/pull/1722))。
- 改进了 LZ4 压缩性能。
- 加快了包含大量 JOIN 和子查询的查询分析速度。
- 当网络错误过多时,DNS 缓存现在会自动更新。
- 如果由于物化视图的数据分区过多而无法插入其中一个物化视图,则不再进行表插入。
- 修正了事件计数器 `Query`、`SelectQuery` 和 `InsertQuery` 中的差异。
- 如果元组类型匹配,则允许使用 `tuple IN (SELECT tuple)` 这样的表达式。
- 即使未配置 ZooKeeper,具有复制表的服务器也可以启动。
- 在计算可用 CPU 核心数时,现在会考虑 cgroups 的限制 ([Atri Sharma](https://github.com/ClickHouse/ClickHouse/pull/2325))。
- 在 systemd 配置文件中为配置目录添加了 chown ([Mikhail Shiryaev](https://github.com/ClickHouse/ClickHouse/pull/2421))。

#### 构建变更: {#build-changes-4}

- 可以使用 gcc8 编译器进行构建。
- 添加了从子模块构建 llvm 的功能。
- librdkafka 库的版本已更新至 v0.11.4。
- 添加了使用系统 libcpuid 库的功能。库版本已更新至 0.4.0。
- 修复了使用 vectorclass 库的构建 ([Babacar Diassé](https://github.com/ClickHouse/ClickHouse/pull/2274))。
- Cmake 现在默认为 ninja 生成文件(类似于使用 `-G Ninja`)。
- 添加了使用 libtinfo 库代替 libtermcap 的功能 ([Georgy Kondratiev](https://github.com/ClickHouse/ClickHouse/pull/2519))。
- 修复了 Fedora Rawhide 中的头文件冲突 ([#2520](https://github.com/ClickHouse/ClickHouse/issues/2520))。

#### 向后不兼容的变更: {#backward-incompatible-changes-7}


- 移除了 `Vertical` 和 `Pretty*` 格式中的转义,并删除了 `VerticalRaw` 格式。
- 如果在分布式查询中同时使用版本 1.1.54388(或更高版本)的服务器和旧版本的服务器,且查询包含不带 `AS` 关键字且 `cast` 一词不是大写的 `cast(x, 'Type')` 表达式,则会抛出类似 `Not found column cast(0, 'UInt8') in block` 的异常消息。解决方案:更新整个集群的服务器。

### ClickHouse 版本 1.1.54385, 2018-06-01 {#clickhouse-release-1-1-54385-2018-06-01}

#### 错误修复: {#bug-fixes-21}

- 修复了在某些情况下导致 ZooKeeper 操作阻塞的错误。

### ClickHouse 版本 1.1.54383, 2018-05-22 {#clickhouse-release-1-1-54383-2018-05-22}

#### 错误修复: {#bug-fixes-22}

- 修复了当表具有多个副本时复制队列变慢的问题。

### ClickHouse 版本 1.1.54381, 2018-05-14 {#clickhouse-release-1-1-54381-2018-05-14}

#### 错误修复: {#bug-fixes-23}

- 修复了当 ClickHouse 与 ZooKeeper 服务器失去连接时 ZooKeeper 中的节点泄漏问题。

### ClickHouse 版本 1.1.54380, 2018-04-21 {#clickhouse-release-1-1-54380-2018-04-21}

#### 新功能: {#new-features-13}

- 添加了表函数 `file(path, format, structure)`。从 `/dev/urandom` 读取字节的示例:`ln -s /dev/urandom /var/lib/clickhouse/user_files/random``clickhouse-client -q "SELECT * FROM file('random', 'RowBinary', 'd UInt8') LIMIT 10"`。

#### 改进: {#improvements-12}

- 子查询可以用 `()` 括号包裹以增强查询可读性。例如:`(SELECT 1) UNION ALL (SELECT 1)`。
- 来自 `system.processes` 表的简单 `SELECT` 查询不计入 `max_concurrent_queries` 限制。

#### 错误修复: {#bug-fixes-24}

- 修复了从 `MATERIALIZED VIEW` 查询时 `IN` 操作符的错误行为。
- 修复了在类似 `partition_key_column IN (...)` 的表达式中按分区索引进行错误过滤的问题。
- 修复了在表上执行 `RENAME` 后无法在非主副本上执行 `OPTIMIZE` 查询的问题。
- 修复了在非主副本上执行 `OPTIMIZE` 或 `ALTER` 查询时的授权错误。
- 修复了 `KILL QUERY` 冻结的问题。
- 修复了 ZooKeeper 客户端库中的错误,该错误在 ZooKeeper 配置中使用非空 `chroot` 前缀时会导致监视丢失、分布式 DDL 队列冻结以及复制队列变慢。

#### 向后不兼容的变更: {#backward-incompatible-changes-8}

- 移除了对类似 `(a, b) IN (SELECT (a, b))` 表达式的支持(您可以使用等效表达式 `(a, b) IN (SELECT a, b)`)。在以前的版本中,这些表达式会导致不确定的 `WHERE` 过滤或引发错误。

### ClickHouse 版本 1.1.54378, 2018-04-16 {#clickhouse-release-1-1-54378-2018-04-16}

#### 新功能: {#new-features-14}


- 无需重启服务器即可更改日志级别。
- 新增了 `SHOW CREATE DATABASE` 查询。
- `query_id` 可以传递给 `clickhouse-client` (elBroom)。
- 新增设置:`max_network_bandwidth_for_all_users`。
- 为 `MATERIALIZED VIEW` 新增了 `ALTER TABLE ... PARTITION ...` 支持。
- 在系统表中新增了数据部分未压缩大小的信息。
- 为分布式表新增了服务器到服务器的加密支持(在 `<remote_servers>` 的副本配置中设置 `<secure>1</secure>`)。
- 为 `ReplicatedMergeTree` 系列新增表级配置,以最小化存储在 Zookeeper 中的数据量:`use_minimalistic_checksums_in_zookeeper = 1`
- 配置 `clickhouse-client` 提示符。默认情况下,服务器名称现在会输出到提示符中。可以更改服务器的显示名称。它也会在 `X-ClickHouse-Display-Name` HTTP 头中发送 (Kirill Shvakov)。
- 可以为 `Kafka` 引擎指定多个逗号分隔的 `topics` (Tobias Adamson)
- 当查询被 `KILL QUERY` 或 `replace_running_query` 停止时,客户端会收到 `Query was canceled` 异常,而不是不完整的结果。

#### 改进: {#improvements-13}

- `ALTER TABLE ... DROP/DETACH PARTITION` 查询在复制队列的前端运行。
- 即使表只有单个数据部分,也可以使用 `SELECT ... FINAL` 和 `OPTIMIZE ... FINAL`。
- 如果 `query_log` 表被手动删除,会自动重新创建 (Kirill Shvakov)。
- `lengthUTF8` 函数运行速度更快 (zhang2014)。
- 当分片数量非常大时,改进了 `Distributed` 表中同步插入 (`insert_distributed_sync = 1`) 的性能。
- 服务器接受来自客户端的 `send_timeout` 和 `receive_timeout` 设置,并在连接到客户端时应用它们(以相反的顺序应用:服务器套接字的 `send_timeout` 设置为从客户端接收的 `receive_timeout` 值,反之亦然)。
- 异步插入到 `Distributed` 表的崩溃恢复更加稳健。
- `countEqual` 函数的返回类型从 `UInt32` 更改为 `UInt64` (谢磊)。

#### 错误修复: {#bug-fixes-25}

- 修复了当表达式左侧为 `Nullable` 时 `IN` 的错误。
- 当元组的某些组件在表索引中时,使用元组与 `IN` 现在会返回正确的结果。
- `max_execution_time` 限制现在可以正确地用于分布式查询。
- 修复了在 `system.columns` 表中计算复合列大小时的错误。
- 修复了创建临时表 `CREATE TEMPORARY TABLE IF NOT EXISTS` 时的错误。
- 修复了 `StorageKafka` 中的错误 (##2075)
- 修复了某些聚合函数的无效参数导致的服务器崩溃。
- 修复了阻止 `DETACH DATABASE` 查询停止 `ReplicatedMergeTree` 表后台任务的错误。
- 插入到聚合物化视图时,`Too many parts` 状态发生的可能性降低 (##2084)。
- 修正了配置中替换的递归处理,当一个替换必须在同一级别后跟另一个替换时。
- 修正了创建使用 `UNION ALL` 查询的 `VIEW` 时元数据文件中的语法。
- `SummingMergeTree` 现在可以正确地对具有复合键的嵌套数据结构进行求和。
- 修复了为 `ReplicatedMergeTree` 表选择领导者时可能出现的竞态条件。

#### 构建变更: {#build-changes-5}

- 构建支持 `ninja` 而不是 `make`,并且默认使用 `ninja` 构建发布版本。
- 重命名的软件包:`clickhouse-server-base` 改为 `clickhouse-common-static`;`clickhouse-server-common` 改为 `clickhouse-server`;`clickhouse-common-dbg` 改为 `clickhouse-common-static-dbg`。要安装,请使用 `clickhouse-server clickhouse-client`。为了向后兼容,旧名称的软件包仍将在存储库中加载。

#### 向后不兼容的变更: {#backward-incompatible-changes-9}


- 移除了当左侧指定数组时对 IN 表达式的特殊解释。以前,表达式 `arr IN (set)` 被解释为"至少有一个 `arr` 元素属于 `set`"。要在新版本中获得相同的行为,请使用 `arrayExists(x -> x IN (set), arr)`。
- 禁用了套接字选项 `SO_REUSEPORT` 的错误使用,该选项在 Poco 库中被错误地默认启用。请注意,在 Linux 上不再需要同时为 listen 指定地址 `::` 和 `0.0.0.0` - 只需使用 `::`即可,它允许同时监听 IPv4 和 IPv6 连接(使用默认内核配置设置)。您也可以通过在配置中指定 `<listen_reuse_port>1</listen_reuse_port>` 来恢复到以前版本的行为。

### ClickHouse 版本 1.1.54370, 2018-03-16 {#clickhouse-release-1-1-54370-2018-03-16}

#### 新特性: {#new-features-15}

- 添加了 `system.macros` 表,并在配置文件更改时自动更新宏。
- 添加了 `SYSTEM RELOAD CONFIG` 查询。
- 添加了 `maxIntersections(left_col, right_col)` 聚合函数,该函数返回同时相交的区间 `[left; right]` 的最大数量。`maxIntersectionsPosition(left, right)` 函数返回"最大"区间的起始位置。([Michael Furmur](https://github.com/ClickHouse/ClickHouse/pull/2012))。

#### 改进: {#improvements-14}

- 在向 `Replicated` 表插入数据时,对 `ZooKeeper` 的请求更少(并且大多数用户级错误已从 `ZooKeeper` 日志中消失)。
- 添加了为数据集创建别名的功能。示例:`WITH (1, 2, 3) AS set SELECT number IN set FROM system.numbers LIMIT 10`。

#### 错误修复: {#bug-fixes-26}

- 修复了从 `Distributed` 表的 Merge 表读取时出现的 `Illegal PREWHERE` 错误。
- 添加了修复,允许在仅支持 IPv4 的 Docker 容器中启动 clickhouse-server。
- 修复了从系统 `system.parts_columns` 表读取时的竞态条件。
- 移除了向 `Distributed` 表同步插入期间的双重缓冲,这可能导致连接超时。
- 修复了在开始 `SELECT` 查询之前等待不可用副本时间过长的错误。
- 修复了 `system.parts` 表中的错误日期。
- 修复了当 `ZooKeeper` 集群配置中的 `chroot` 非空时无法向 `Replicated` 表插入数据的错误。
- 修复了空 `ORDER BY` 表的垂直合并算法。
- 恢复了在查询远程表时使用字典的功能,即使这些字典在请求服务器上不存在。此功能在版本 1.1.54362 中丢失。
- 恢复了类似 `SELECT * FROM remote('server2', default.table) WHERE col IN (SELECT col2 FROM default.table)` 的查询行为,当 `IN` 的右侧应使用远程 `default.table` 而不是本地表时。此行为在版本 1.1.54358 中被破坏。
- 移除了 `Not found column ... in block` 的多余错误级别日志记录。

### ClickHouse 版本 1.1.54362, 2018-03-11 {#clickhouse-release-1-1-54362-2018-03-11}

#### 新特性: {#new-features-16}


* 对于空集合（例如 `SELECT count(*) FROM table WHERE 0`）在没有使用 `GROUP BY` 的情况下进行聚合时，现在会返回一行结果，其中聚合函数的值为 null，以符合 SQL 标准。若要恢复之前的行为（返回空结果），请将 `empty_result_for_aggregation_by_empty_set` 设置为 1。
* 为 `UNION ALL` 添加了类型转换支持。`UNION ALL` 中各个 `SELECT` 语句在对应的 `SELECT` 列位置上现在可以使用不同的别名，以符合 SQL 标准。
* 现在在 `LIMIT BY` 子句中支持任意表达式。此前只能使用由 `SELECT` 语句产生的列。
* 当 `IN` 运算符应用于由主键列上的表达式组成的元组时，会使用 `MergeTree` 表的索引。示例：`WHERE (UserID, EventDate) IN ((123, '2000-01-01'), ...)`（Anastasiya Tsarkova）。
* 新增了 `clickhouse-copier` 工具，用于跨集群复制数据和对数据进行重新分片（测试版）。
* 新增了一致性哈希函数：`yandexConsistentHash`、`jumpConsistentHash`、`sumburConsistentHash`。它们可以用作分片键，从而在后续重新分片时减少网络通信开销。
* 新增函数：`arrayAny`、`arrayAll`、`hasAny`、`hasAll`、`arrayIntersect`、`arrayResize`。
* 新增了 `arrayCumSum` 函数（Javi Santana）。
* 新增了 `parseDateTimeBestEffort`、`parseDateTimeBestEffortOrZero` 和 `parseDateTimeBestEffortOrNull` 函数，用于从字符串中读取 DateTime，该字符串可以采用多种不同的文本格式。
* 在更新时，可以从外部字典中部分重新加载数据（仅加载其指定字段的值比上次加载时更大的记录）（Arsen Hakobyan）。
* 新增了 `cluster` 表函数。示例：`cluster(cluster_name, db, table)`。如果集群名称以标识符的形式指定，则 `remote` 表函数可以接受集群名称作为第一个参数。
* 可以在 `INSERT` 查询中使用 `remote` 和 `cluster` 表函数。
* 在 `system.tables` 表中新增了 `create_table_query` 和 `engine_full` 虚拟列。`metadata_modification_time` 列是虚拟列。
* 向 `system.tables` 和 `system.databases` 表中添加了 `data_path` 和 `metadata_path` 列，并向 `system.parts` 和 `system.parts_columns` 表中添加了 `path` 列。
* 在 `system.part_log` 表中新增了更多与合并相关的信息。
* 可以为 `system.query_log` 表使用任意分区键（Kirill Shvakov）。
* `SHOW TABLES` 查询现在也会显示临时表。在 `system.tables` 中新增了临时表以及 `is_temporary` 列 (zhang2014)。
* 新增了 `DROP TEMPORARY TABLE` 和 `EXISTS TEMPORARY TABLE` 查询（zhang2014）。
* 为临时表添加对 `SHOW CREATE TABLE` 的支持（zhang2014）。
* 新增了用于内部进程相关设置的 `system_profile` 配置参数。
* 支持在 `MongoDB` 字典中将 `object_id` 作为属性加载（Pavel Litvinenko）。
* 在为以 `MongoDB` 为源的外部字典加载数据时，将 `null` 读取为默认值（Pavel Litvinenko）。
* 在 `Values` 格式中，从未用单引号括起的 Unix 时间戳中读取 `DateTime` 值。
* `remote` 表函数在部分副本缺少所请求表时支持故障转移。
* 运行 `clickhouse-server` 时，可以在命令行中覆盖配置参数。例如：`clickhouse-server -- --logger.level=information`。
* 实现了接受 `FixedString` 参数的 `empty` 函数：当字符串完全由空字节组成时，该函数返回 1（zhang2014）。
* 新增 `listen_try` 配置参数，当部分监听地址无法监听时（对禁用 IPv4 或 IPv6 支持的系统很有用），允许在不退出的情况下至少监听其中一个地址。
* 新增了 `VersionedCollapsingMergeTree` 表引擎。
* 在 `library` 字典源中支持行和任意数值类型。
* 可以使用不带主键的 `MergeTree` 表（需要指定 `ORDER BY tuple()`）。
* 只要参数不是 `NULL`，就可以将 `Nullable` 类型 `CAST` 为非 `Nullable` 类型。
* 可以对 `VIEW` 执行 `RENAME TABLE` 操作。
* 新增 `throwIf` 函数。
* 添加了 `odbc_default_field_size` 选项，可用于增大从 ODBC 源加载的值的最大长度（默认值为 1024）。
* `system.processes` 表和 `SHOW PROCESSLIST` 现在包含 `is_cancelled` 和 `peak_memory_usage` 列。

#### 改进: {#improvements-15}

- 对于 `INSERT SELECT` 查询或 `SELECT` 子查询，结果的限制和配额不再应用于中间数据。
- 服务器启动时检查 `Replicated` 表状态时，减少了 `force_restore_data` 的误触发。
- 添加了 `allow_distributed_ddl` 选项。
- `MergeTree` 表键的表达式中不允许使用非确定性函数。
- 来自 `config.d` 目录的替换文件按字母顺序加载。
- 改进了 `arrayElement` 函数在常量多维数组中包含空数组作为元素之一的情况下的性能。示例:`[[1], []][x]`。
- 使用包含大量替换的配置文件(例如,非常大的 IP 网络列表)时,服务器现在启动更快。
- 运行查询时,表值函数只运行一次。以前,`remote` 和 `mysql` 表值函数会执行两次相同的查询以从远程服务器检索表结构。
- 使用 `MkDocs` 文档生成器。
- 当尝试删除其他列的 `DEFAULT`/`MATERIALIZED` 表达式所依赖的表列时,会抛出异常(zhang2014)。
- 添加了将文本格式中的空行解析为 `Float` 数据类型的数字 0 的功能。此功能以前可用,但在 1.1.54342 版本中丢失。
- `Enum` 值可以在 `min`、`max`、`sum` 和其他一些函数中使用。在这些情况下,它使用相应的数值。此功能以前可用,但在 1.1.54337 版本中丢失。
- 添加了 `max_expanded_ast_elements` 以限制递归展开别名后 AST 的大小。

#### 错误修复: {#bug-fixes-27}

- 修复了错误地从子查询中删除不必要的列,或未从包含 `UNION ALL` 的子查询中删除列的情况。
- 修复了 `ReplacingMergeTree` 表合并中的错误。
- 修复了 `Distributed` 表中的同步插入(`insert_distributed_sync = 1`)。
- 修复了在子查询中使用 `FULL` 和 `RIGHT JOIN` 且存在重复列时的段错误。
- 修复了某些使用 `replace_running_query` 和 `KILL QUERY` 时的段错误。
- 修复了 `system.dictionaries` 表中 `source` 和 `last_exception` 列的顺序。
- 修复了 `DROP DATABASE` 查询未删除元数据文件的错误。
- 修复了 `Dictionary` 数据库的 `DROP DATABASE` 查询。
- 修复了 `uniqHLL12` 和 `uniqCombined` 函数在基数大于 1 亿项时精度低的问题(Alex Bocharov)。
- 修复了在 `INSERT` 查询中需要同时计算默认显式表达式时隐式默认值的计算(zhang2014)。
- 修复了对 `MergeTree` 表的查询无法完成的罕见情况(chenxing-xc)。
- 修复了当所有分片都是本地分片时,对 `Distributed` 表运行 `CHECK` 查询时发生的崩溃(chenxing.xc)。
- 修复了使用正则表达式的函数的轻微性能回退。
- 修复了从复杂表达式创建多维数组时的性能回退。
- 修复了可能导致元数据 `.sql` 文件中出现额外 `FORMAT` 部分的错误。
- 修复了在尝试删除查看显式指定表的 `MATERIALIZED VIEW` 时应用 `max_table_size_to_drop` 限制的错误。
- 修复了与旧客户端的不兼容性(旧客户端有时会收到 `DateTime('timezone')` 类型的数据,而它们无法理解)。
- 修复了当这些列的条件移至 `PREWHERE` 时,读取使用 `ALTER` 添加但对于旧分区为空的结构的 `Nested` 列元素时的错误。
- 修复了在对 `Merge` 表的查询中按虚拟 `_table` 列过滤表时的错误。
- 修复了在 `Distributed` 表中使用 `ALIAS` 列时的错误。
- 修复了使用 `quantile` 系列聚合函数的查询无法进行动态编译的错误。
- 修复了在使用包含大量表的 `Merge` 表以及使用 `GLOBAL` 子查询时,在极少数情况下查询执行管道中发生的竞态条件。
- 修复了在使用多参数聚合函数时将不同大小的数组传递给 `arrayReduce` 函数时的崩溃。
- 禁止在 `MATERIALIZED VIEW` 中使用带有 `UNION ALL` 的查询。
- 修复了服务器启动时 `part_log` 系统表初始化期间的错误(默认情况下,`part_log` 是禁用的)。

#### 向后不兼容的变更: {#backward-incompatible-changes-10}


- 移除了 `distributed_ddl_allow_replicated_alter` 选项。此行为现已默认启用。
- 移除了 `strict_insert_defaults` 设置。如果您曾使用此功能,请发送邮件至 `feedback@clickhouse.com`。
- 移除了 `UnsortedMergeTree` 引擎。

### ClickHouse 版本 1.1.54343,2018-02-05 {#clickhouse-release-1-1-54343-2018-02-05}

- 新增了在分布式 DDL 查询和 Distributed 表构造函数中定义集群名称的宏支持:`CREATE TABLE distr ON CLUSTER '{cluster}' (...) ENGINE = Distributed('{cluster}', 'db', 'table')`。
- 现在类似 `SELECT ... FROM table WHERE expr IN (subquery)` 的查询将使用 `table` 索引进行处理。
- 改进了向 Replicated 表插入数据时的重复项处理,使其不再影响复制队列的执行速度。

### ClickHouse 版本 1.1.54342,2018-01-22 {#clickhouse-release-1-1-54342-2018-01-22}

此版本包含针对先前版本 1.1.54337 的错误修复:

- 修复了 1.1.54337 中的回归问题:如果默认用户具有只读访问权限,服务器将拒绝启动并显示消息 `Cannot create database in readonly mode`。
- 修复了 1.1.54337 中的回归问题:在使用 systemd 的系统上,无论配置如何,日志始终写入 syslog;watchdog 脚本仍使用 init.d。
- 修复了 1.1.54337 中的回归问题:Docker 镜像中的默认配置错误。
- 修复了 GraphiteMergeTree 的非确定性行为(您可以在日志消息 `Data after merge is not byte-identical to the data on another replicas` 中看到此问题)。
- 修复了一个可能导致对 Replicated 表执行 OPTIMIZE 查询后合并不一致的错误(您可能在日志消息 `Part ... intersects the previous part` 中看到此问题)。
- 当目标表中存在 MATERIALIZED 列时,Buffer 表现在可以正常工作(由 zhang2014 贡献)。
- 修复了 NULL 实现中的一个错误。

### ClickHouse 版本 1.1.54337,2018-01-18 {#clickhouse-release-1-1-54337-2018-01-18}

#### 新特性: {#new-features-17}


- 新增对表中多维数组和元组（`Tuple` 数据类型）存储的支持。
- 支持在 `DESCRIBE` 和 `INSERT` 查询中使用表函数。新增对 `DESCRIBE` 中子查询的支持。示例：`DESC TABLE remote('host', default.hits)`；`DESC TABLE (SELECT 1)`；`INSERT INTO TABLE FUNCTION remote('host', default.hits)`。除 `INSERT INTO` 外，还支持 `INSERT INTO TABLE`。
- 改进了对时区的支持。`DateTime` 数据类型可以标注用于文本格式解析和格式化的时区。示例：`DateTime('Asia/Istanbul')`。当在函数中为 `DateTime` 参数指定时区时，返回类型将跟踪该时区，并且值将按预期显示。
- 新增函数 `toTimeZone`、`timeDiff`、`toQuarter`、`toRelativeQuarterNum`。`toRelativeHour`/`Minute`/`Second` 函数可以接受 `Date` 类型的值作为参数。`now` 函数名称区分大小写。
- 新增 `toStartOfFifteenMinutes` 函数（Kirill Shvakov）。
- 新增用于格式化查询的 `clickhouse format` 工具。
- 新增 `format_schema_path` 配置参数（Marek Vavruşa）。用于指定 `Cap'n Proto` 格式的模式。模式文件只能位于指定的目录中。
- 新增对外部字典和模型配置的配置替换（`incl` 和 `conf.d`）支持（Pavel Yakunin）。
- 为 `system.settings` 表新增包含文档的列（Kirill Shvakov）。
- 新增 `system.parts_columns` 表，包含 `MergeTree` 表每个数据部分中列大小的信息。
- 新增 `system.models` 表，包含已加载的 `CatBoost` 机器学习模型的信息。
- 新增 `mysql` 和 `odbc` 表函数以及相应的 `MySQL` 和 `ODBC` 表引擎，用于访问远程数据库。此功能处于测试阶段。
- 新增为 `groupArray` 聚合函数传递 `AggregateFunction` 类型参数的功能（因此您可以创建某些聚合函数状态的数组）。
- 移除了对聚合函数组合器各种组合的限制。例如，您可以使用 `avgForEachIf` 以及 `avgIfForEach` 聚合函数，它们具有不同的行为。
- `-ForEach` 聚合函数组合器扩展为支持多参数聚合函数的情况。
- 新增对 `Nullable` 参数聚合函数的支持，即使在函数返回非 `Nullable` 结果的情况下也是如此（由 Silviu Caragea 贡献）。示例：`groupArray`、`groupUniqArray`、`topK`。
- 为 `clickhouse-client` 新增 `max_client_network_bandwidth` 参数（Kirill Shvakov）。
- 具有 `readonly = 2` 设置的用户允许操作 TEMPORARY 表（CREATE、DROP、INSERT...）（Kirill Shvakov）。
- 新增对 `Kafka` 引擎使用多个消费者的支持。扩展了 `Kafka` 的配置选项（Marek Vavruša）。
- 新增 `intExp3` 和 `intExp4` 函数。
- 新增 `sumKahan` 聚合函数。
- 新增 to \* Number\* OrNull 函数，其中 \* Number\* 是数值类型。
- 新增对 `INSERT SELECT` 查询中 `WITH` 子句的支持（作者：zhang2014）。
- 新增设置：`http_connection_timeout`、`http_send_timeout`、`http_receive_timeout`。特别是，这些设置用于下载复制的数据部分。更改这些设置可以在网络过载时实现更快的故障转移。
- 新增对 `Null` 类型表的 `ALTER` 支持（Anastasiya Tsarkova）。
- `reinterpretAsString` 函数扩展为支持所有在内存中连续存储的数据类型。
- 为 `clickhouse-local` 工具新增 `--silent` 选项。它会抑制在 stderr 中打印查询执行信息。
- 新增对从文本中读取 `Date` 类型值的支持，其中月份和/或日期使用单个数字而不是两个数字指定（Amos Bird）。

#### 性能优化： {#performance-optimizations}


- 改进了聚合函数 `min`、`max`、`any`、`anyLast`、`anyHeavy`、`argMin`、`argMax` 在处理字符串参数时的性能。
- 改进了函数 `isInfinite`、`isFinite`、`isNaN`、`roundToExp2` 的性能。
- 改进了以文本格式解析和格式化 `Date` 和 `DateTime` 类型值的性能。
- 改进了浮点数解析的性能和精度。
- 降低了 `JOIN` 的内存使用量,适用于左右两部分存在同名列但未包含在 `USING` 子句中的情况。
- 通过降低计算稳定性要求,改进了聚合函数 `varSamp`、`varPop`、`stddevSamp`、`stddevPop`、`covarSamp`、`covarPop`、`corr` 的性能。原有的稳定版本函数可通过名称 `varSampStable`、`varPopStable`、`stddevSampStable`、`stddevPopStable`、`covarSampStable`、`covarPopStable`、`corrStable` 继续使用。

#### 错误修复: {#bug-fixes-28}


- 修复了执行 `DROP` 或 `DETACH PARTITION` 查询后的数据去重问题。在之前的版本中,删除分区后再次插入相同数据无法正常工作,因为插入的数据块被视为重复项。
- 修复了可能导致带有 `POPULATE` 的 `CREATE MATERIALIZED VIEW` 查询中 `WHERE` 子句解释错误的 bug。
- 修复了在 `zookeeper_servers` 配置中使用 `root_path` 参数时的 bug。
- 修复了将 `Date` 参数传递给 `toStartOfDay` 时产生意外结果的问题。
- 修复了 `addMonths` 和 `subtractMonths` 函数以及 `INTERVAL n MONTH` 算术运算在结果为上一年时的问题。
- 为 `DISTINCT`、`JOIN` 和 `uniq` 聚合函数以及外部字典添加了对 `UUID` 数据类型的缺失支持(Evgeniy Ivanov)。对 `UUID` 的支持仍不完整。
- 修复了当行求和为零时 `SummingMergeTree` 的行为问题。
- 对 `Kafka` 引擎进行了多项修复(Marek Vavruša)。
- 修复了 `Join` 表引擎的错误行为(Amos Bird)。
- 修复了 FreeBSD 和 OS X 下内存分配器的错误行为。
- `extractAll` 函数现在支持空匹配。
- 修复了阻止使用 `libressl` 替代 `openssl` 的错误。
- 修复了从临时表执行 `CREATE TABLE AS SELECT` 查询的问题。
- 修复了更新复制队列的非原子性问题。这可能导致副本失去同步,直到服务器重启。
- 修复了 `gcd`、`lcm` 和 `modulo`(`%` 运算符)中可能出现的溢出问题(Maks Skorokhod)。
- `-preprocessed` 文件现在在更改 `umask` 后创建(`umask` 可以在配置中更改)。
- 修复了使用自定义分区键时后台检查数据部分(`MergeTreePartChecker`)的 bug。
- 修复了文本格式中元组(`Tuple` 数据类型的值)的解析问题。
- 改进了传递给 `multiIf`、`array` 和其他一些函数的不兼容类型的错误消息。
- 重新设计了对 `Nullable` 类型的支持。修复了可能导致服务器崩溃的 bug。修复了几乎所有与 `NULL` 支持相关的其他 bug:INSERT SELECT 中的错误类型转换、HAVING 和 PREWHERE 中对 Nullable 的支持不足、`join_use_nulls` 模式、Nullable 类型作为 `OR` 运算符的参数等。
- 修复了与数据类型内部语义相关的各种 bug。例如:`SummingMergeTree` 中对 `Enum` 类型字段的不必要求和;`Pretty` 格式中 `Enum` 类型的对齐等。
- 对复合列允许的组合进行了更严格的检查。
- 修复了为 `FixedString` 数据类型指定非常大的参数时的溢出问题。
- 修复了 `topK` 聚合函数在一般情况下的 bug。
- 为带有 `-Array` 组合器的聚合函数的 n 元变体参数添加了缺失的数组大小相等性检查。
- 修复了 `clickhouse-client` 中 `--pager` 的 bug(作者:ks1322)。
- 修复了 `exp10` 函数的精度问题。
- 修复了 `visitParamExtract` 函数的行为,以更好地符合文档说明。
- 修复了指定错误数据类型时的崩溃问题。
- 修复了当所有列都是常量时 `DISTINCT` 的行为问题。
- 修复了使用 `tupleElement` 函数并将复杂常量表达式作为元组元素索引时的查询格式化问题。
- 修复了 `range_hashed` 字典的 `Dictionary` 表中的 bug。
- 修复了导致 `FULL` 和 `RIGHT JOIN` 结果中出现多余行的 bug(Amos Bird)。
- 修复了在配置重新加载期间在 `config.d` 目录中创建和删除临时文件时服务器崩溃的问题。
- 修复了 `SYSTEM DROP DNS CACHE` 查询:缓存已刷新但集群节点地址未更新的问题。
- 修复了对视图下的表执行 `DETACH TABLE` 后 `MATERIALIZED VIEW` 的行为问题(Marek Vavruša)。

#### 构建改进: {#build-improvements-4}


- 使用 `pbuilder` 工具进行构建。构建过程几乎完全独立于构建主机环境。
- 单个构建可用于不同的操作系统版本。软件包和二进制文件已实现与广泛的 Linux 系统兼容。
- 添加了 `clickhouse-test` 软件包。可用于运行功能测试。
- 源代码压缩包现在可以发布到代码仓库。可用于在不使用 GitHub 的情况下重现构建。
- 添加了与 Travis CI 的有限集成。由于 Travis 中构建时间的限制,仅测试调试构建并运行有限的测试子集。
- 在默认构建中添加了对 `Cap'n'Proto` 的支持。
- 将文档源格式从 `Restricted Text` 更改为 `Markdown`。
- 添加了对 `systemd` 的支持(Vladimir Smirnov)。由于与某些操作系统镜像不兼容,默认情况下处于禁用状态,可手动启用。
- 为了动态代码生成,将 `clang` 和 `lld` 嵌入到 `clickhouse` 二进制文件中。它们也可以作为 `clickhouse clang` 和 `clickhouse lld` 调用。
- 从代码中移除了 GNU 扩展的使用。启用了 `-Wextra` 选项。使用 `clang` 构建时,默认使用 `libc++` 而不是 `libstdc++`。
- 提取了 `clickhouse_parsers` 和 `clickhouse_common_io` 库以加快各种工具的构建速度。

#### 向后不兼容的变更: {#backward-incompatible-changes-11}

- 包含 `Nullable` 列的 `Log` 类型表中标记的格式以向后不兼容的方式进行了更改。如果您有这些表,应在启动新服务器版本之前将它们转换为 `TinyLog` 类型。为此,请在 `metadata` 目录中相应的 `.sql` 文件中将 `ENGINE = Log` 替换为 `ENGINE = TinyLog`。如果您的表没有 `Nullable` 列或表的类型不是 `Log`,则无需执行任何操作。
- 移除了 `experimental_allow_extended_storage_definition_syntax` 设置。现在此功能默认启用。
- 将 `runningIncome` 函数重命名为 `runningDifferenceStartingWithFirstvalue` 以避免混淆。
- 移除了当 ARRAY JOIN 直接在 FROM 之后指定且没有表时的 `FROM ARRAY JOIN arr` 语法(Amos Bird)。
- 移除了仅用于演示目的的 `BlockTabSeparated` 格式。
- 更改了聚合函数 `varSamp`、`varPop`、`stddevSamp`、`stddevPop`、`covarSamp`、`covarPop`、`corr` 的状态格式。如果您在表中存储了这些聚合函数的状态(使用 `AggregateFunction` 数据类型或具有相应状态的物化视图),请发送邮件至 feedback@clickhouse.com。
- 在以前的服务器版本中存在一个未记录的功能:如果聚合函数依赖于参数,您仍然可以在 AggregateFunction 数据类型中不带参数地指定它。例如:`AggregateFunction(quantiles, UInt64)` 而不是 `AggregateFunction(quantiles(0.5, 0.9), UInt64)`。此功能已移除。尽管它未记录在文档中,但我们计划在未来版本中再次支持它。
- Enum 数据类型不能在 min/max 聚合函数中使用。此功能将在下一个版本中恢复。

#### 升级时请注意: {#please-note-when-upgrading}

- 在集群上执行滚动更新时,当某些副本运行旧版本的 ClickHouse 而某些副本运行新版本时,复制会暂时停止,并且日志中会出现消息 `unknown parameter 'shard'`。在集群的所有副本更新后,复制将继续。
- 如果集群服务器上运行不同版本的 ClickHouse,使用以下函数的分布式查询可能会产生不正确的结果:`varSamp`、`varPop`、`stddevSamp`、`stddevPop`、`covarSamp`、`covarPop`、`corr`。您应该更新所有集群节点。


## [2017 年变更日志](./2017.md) {#changelog-for-2017}
