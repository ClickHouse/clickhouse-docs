---
description: '该表包含可即时计算并以 Prometheus 格式导出的直方图指标，且始终为最新状态。'
keywords: ['system table', 'histogram_metrics']
slug: /operations/system-tables/histogram_metrics
title: 'system.histogram_metrics'
doc_type: 'reference'
---

import SystemTableCloud from '@site/i18n/zh/docusaurus-plugin-content-docs/current/_snippets/_system_table_cloud.md';


# histogram_metrics \{#histogram_metrics\}

<SystemTableCloud />

此表包含可即时计算并以 Prometheus 格式导出的直方图类指标，且始终保持最新状态。用于替代已弃用的 `system.latency_log`。

列：

{/*AUTOGENERATED_START*/ }

* `metric` ([String](../../sql-reference/data-types/)) — 指标名称。
* `value` ([Int64](../../sql-reference/data-types/)) — 指标值。
* `description` ([String](../../sql-reference/data-types/)) — 指标描述。
* `labels` ([Map(String, String)](../../sql-reference/data-types/)) — 指标标签。

{/*AUTOGENERATED_END*/ }

**示例**

你可以使用如下查询以 Prometheus 格式导出所有直方图指标。

```sql
SELECT
  metric AS name,
  toFloat64(value) AS value,
  description AS help,
  labels,
  'histogram' AS type
FROM system.histogram_metrics
FORMAT Prometheus
```


## 指标说明 \{#metric_descriptions\}

### keeper_response_time_ms_bucket \{#keeper_response_time_ms_bucket\}

Keeper 的响应时间（以毫秒计）。

### keeper_client_queue_duration_milliseconds_bucket \{#keeper_client_queue_duration_milliseconds_bucket\}

请求在被 Keeper 客户端处理之前，从等待入队到在队列中排队的耗时，以毫秒为单位。

### keeper_receive_request_time_milliseconds_bucket \{#keeper_receive_request_time_milliseconds_bucket\}

在 Keeper TCP 处理程序中，从客户端接收并解析请求的耗时，以毫秒为单位。

### keeper_dispatcher_requests_queue_time_milliseconds_bucket \{#keeper_dispatcher_requests_queue_time_milliseconds_bucket\}

请求在 Keeper dispatcher 的请求队列中停留的时间（毫秒）。

### keeper_write_pre_commit_time_milliseconds_bucket \{#keeper_write_pre_commit_time_milliseconds_bucket\}

在 Raft 提交之前对写请求进行预处理所需的时间（以毫秒为单位）。

### keeper_write_commit_time_milliseconds_bucket \{#keeper_write_commit_time_milliseconds_bucket\}

Raft 提交后处理一次写请求所耗费的时间（毫秒）。

### keeper_dispatcher_responses_queue_time_milliseconds_bucket \{#keeper_dispatcher_responses_queue_time_milliseconds_bucket\}

响应在 Keeper dispatcher 响应队列中停留的时间（毫秒）。

### keeper_send_response_time_milliseconds_bucket \{#keeper_send_response_time_milliseconds_bucket\}

在 Keeper TCP 处理程序中向客户端发送响应的耗时（包括排队及写入 socket），单位为毫秒。

### keeper_read_wait_for_write_time_milliseconds_bucket \{#keeper_read_wait_for_write_time_milliseconds_bucket\}

读取请求为其所依赖的写入请求完成而等待的时间（单位：毫秒）。

### keeper_read_process_time_milliseconds_bucket \{#keeper_read_process_time_milliseconds_bucket\}

Keeper 中处理读请求所用时间（毫秒）。

### keeper_batch_size_elements_bucket \{#keeper_batch_size_elements_bucket\}

发送到 Raft 的批量大小（按元素数量计）。

### keeper_batch_size_bytes_bucket \{#keeper_batch_size_bytes_bucket\}

发送到 Raft 的批次大小（以字节为单位）。

**另请参阅**

- [system.asynchronous_metrics](/operations/system-tables/asynchronous_metrics) — 包含按周期计算的指标。
- [system.events](/operations/system-tables/events) — 包含已发生事件的数量。
- [system.metric_log](/operations/system-tables/metric_log) — 包含来自 `system.metrics` 和 `system.events` 表的历史指标值。
- [Monitoring](../../operations/monitoring.md) — ClickHouse 监控的基本概念。