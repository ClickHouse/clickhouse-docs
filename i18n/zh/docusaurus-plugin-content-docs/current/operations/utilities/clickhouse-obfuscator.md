---
description: 'ClickHouse Obfuscator 文档'
slug: /operations/utilities/clickhouse-obfuscator
title: 'clickhouse-obfuscator'
doc_type: 'reference'
---

一个用于表数据脱敏的简单工具。

它读取一张输入表并生成一张输出表。输出表保留输入表的部分特性，但其中的数据是不同的。
这使得可以发布与真实生产环境几乎相同的数据，用于基准测试。

它被设计为保留以下数据特性：

- 每一列以及每个列元组的值基数（不同值的数量）；
- 条件基数：在另一列取某个值的条件下，某一列中不同值的数量；
- 整数绝对值的概率分布；有符号整数的符号分布；浮点数的指数和符号分布；
- 字符串长度的概率分布；
- 数值为零的概率；空字符串和数组以及 `NULL` 的概率；

- 使用 LZ77 和熵编码家族编解码器压缩时的数据压缩比；
- 表内时间值的连续性（差值大小）；浮点数值的连续性；
- `DateTime` 值的日期部分；

- 字符串值的 UTF-8 合法性；
- 字符串值看起来是自然的。

上述大多数特性对于性能测试来说已经足够：

读取数据、过滤、聚合和排序等操作的速度，
由于保留了基数、数量级、压缩比等特性，将与在原始数据上的速度几乎相同。

它以确定性的方式工作：你定义一个种子值，变换过程由输入数据和种子共同决定。
某些变换是一一对应且可以被还原的，因此你需要使用足够大的种子并妥善保密。

它使用了一些密码学原语来转换数据，但从密码学的角度看，这样做并不严谨，因此除非有其他理由，否则不应认为结果是安全的。输出结果中可能保留了一些你并不希望公开的数据。

它总是保留 0、1、-1 这类数字、日期、数组长度以及空值标志，与源数据完全一致。
例如，你的表中有一列 `IsMobile`，取值为 0 和 1。在转换后的数据中，它仍然会有相同的值。

因此，用户仍然能够精确计算移动端流量的比例。

再举一个例子：当你的表中包含一些隐私数据，例如用户邮箱，而你不希望公开任何一个具体的邮箱地址时。
如果你的表足够大，包含多个不同的邮箱，且没有某个邮箱的出现频率远高于其他邮箱，那么所有数据都会被匿名化。但如果某列中不同值的数量较少，它可能会复现其中的部分值。
你应当了解该工具的工作算法，并对其命令行参数进行微调。

该工具仅在数据量至少达到中等规模（至少数千行）时效果较好。