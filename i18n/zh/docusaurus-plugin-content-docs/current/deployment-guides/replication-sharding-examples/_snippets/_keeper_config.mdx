为了使复制功能正常工作，需要设置并配置一个 ClickHouse Keeper 集群。ClickHouse Keeper 提供用于数据复制的协调系统，可作为 ZooKeeper 的替代方案（也可以继续使用 ZooKeeper）。不过推荐使用 ClickHouse Keeper，因为它能提供更好的一致性保证和可靠性，并且比 ZooKeeper 占用更少的资源。为了实现高可用性并维持法定人数（quorum），建议至少运行三个 ClickHouse Keeper 节点。

:::note
ClickHouse Keeper 可以与 ClickHouse 一样运行在集群的任意节点上，但建议将其部署在专用节点上，以便能够在不受数据库集群影响的情况下单独对 ClickHouse Keeper 集群进行扩缩容和管理。
:::

在示例目录的根目录下使用以下命令，为每个 ClickHouse Keeper 节点创建 `keeper_config.xml` 文件：

```bash
for i in {01..03}; do
  touch fs/volumes/clickhouse-keeper-${i}/etc/clickhouse-keeper/keeper_config.xml
done
```

修改在每个节点目录 `fs/volumes/clickhouse-keeper-{}/etc/clickhouse-keeper` 中创建的空配置文件。
下面高亮的行需要根据各自节点进行相应修改：

```xml title="/clickhouse-keeper/keeper_config.xml"
<clickhouse replace="true">
    <logger>
        <level>information</level>
        <log>/var/log/clickhouse-keeper/clickhouse-keeper.log</log>
        <errorlog>/var/log/clickhouse-keeper/clickhouse-keeper.err.log</errorlog>
        <size>1000M</size>
        <count>3</count>
    </logger>
    <listen_host>0.0.0.0</listen_host>
    <keeper_server>
        <tcp_port>9181</tcp_port>
        <!--highlight-next-line-->
        <server_id>1</server_id>
        <log_storage_path>/var/lib/clickhouse/coordination/log</log_storage_path>
        <snapshot_storage_path>/var/lib/clickhouse/coordination/snapshots</snapshot_storage_path>
        <coordination_settings>
            <operation_timeout_ms>10000</operation_timeout_ms>
            <session_timeout_ms>30000</session_timeout_ms>
            <raft_logs_level>information</raft_logs_level>
        </coordination_settings>
        <raft_configuration>
            <server>
                <id>1</id>
                <hostname>clickhouse-keeper-01</hostname>
                <port>9234</port>
            </server>
            <server>
                <id>2</id>
                <hostname>clickhouse-keeper-02</hostname>
                <port>9234</port>
            </server>
            <server>
                <id>3</id>
                <hostname>clickhouse-keeper-03</hostname>
                <port>9234</port>
            </server>
        </raft_configuration>
    </keeper_server>
</clickhouse>
```
