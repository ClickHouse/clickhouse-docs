---
title: "Как экспортировать данные PostgreSQL в Parquet, CSV или JSON?"
date: 2023-03-22
description: "Узнайте, как экспортировать данные PostgreSQL в форматы Parquet, CSV или JSON с помощью `clickhouse-local` на ряде примеров."
tags: ['Экспорт данных', 'Форматы данных']
keywords: ['PostgreSQL', 'Parquet', 'CSV', 'JSON']
---

{frontMatter.description}

{/* усечение */}

## Как экспортировать данные PostgreSQL в Parquet, CSV или JSON \{#how-to-export-postgresql-data-to-parquet-csv-or-json\}

С `clickhouse-local` это делается просто:

* Используйте [табличную функцию `postgresql`](https://clickhouse.com/docs/sql-reference/table-functions/postgresql) для чтения данных
* Используйте конструкцию `INTO OUTFILE _filename_ FORMAT` и укажите нужный формат вывода

Формат вывода может быть любым из поддерживаемых в ClickHouse [форматов вывода](https://clickhouse.com/docs/interfaces/formats). Рассмотрим несколько примеров...

В этих примерах используется `clickhouse-local`, который является частью бинарного дистрибутива ClickHouse. Скачайте его с помощью следующей команды:

```bash
curl https://clickhouse.com/ | sh
```

## Экспорт данных из PostgreSQL в Parquet \{#export-postgresql-to-parquet\}

Табличная функция `postgresql` позволяет выполнять запросы `SELECT` (и `INSERT`) к данным, которые хранятся на удалённом сервере PostgreSQL. Например, чтобы просмотреть всё содержимое таблицы в PostgreSQL:

```bash
SELECT *
FROM
   postgresql(
    'localhost:5432',
    'postgres_database',
    'postgres_table',
    'user',
    'password'
);
```

Мы можем выгрузить результат этого запроса в файл с помощью `INTO OUTFILE`. Используйте `FORMAT`, чтобы указать формат создаваемого файла. Давайте возьмём всё содержимое таблицы PostgreSQL и сохраним его в файл Parquet:

```bash
./clickhouse local -q "SELECT * FROM
   postgresql(
    'localhost:5432',
    'postgres_database',
    'postgres_table',
    'user',
    'password'
)
INTO OUTFILE 'my_output_file.parquet'"
```

:::note
Поскольку имя выходного файла имеет расширение `.parquet`, ClickHouse предполагает, что нам нужен формат Parquet, поэтому мы опустили указание `FORMAT Parquet`.
:::

## Экспорт PostgreSQL в CSV \{#export-postgresql-to-csv\}

Здесь всё то же, что и в случае с Parquet, за исключением того, что мы указываем более подходящее имя результирующего файла:

```bash
./clickhouse local -q "SELECT * FROM
   postgresql(
    'localhost:5432',
    'postgres_database',
    'postgres_table',
    'user',
    'password'
)
INTO OUTFILE 'my_output_file.csv'"
```

Вот и всё! ClickHouse по расширению `.csv` в имени выходного файла определяет, что нужно вывести данные в формате CSV (значения, разделённые запятыми). Во всём остальном это точно такая же команда, как и выше.

## Экспорт из PostgreSQL в JSON \{#export-postgresql-to-json\}

Чтобы экспортировать данные из PostgreSQL в JSON, достаточно изменить имя файла, и ClickHouse сам определит формат:

```bash
./clickhouse local -q "SELECT * FROM
   postgresql(
    'localhost:5432',
    'postgres_database',
    'postgres_table',
    'user',
    'password'
)
INTO OUTFILE 'my_output_file.ndjson'"
```

:::note
Вам не обязательно на этом останавливаться — вы можете использовать `clickhouse-local`, чтобы забирать данные из PostgreSQL и отправлять их во [все поддерживаемые форматы вывода](https://clickhouse.com/docs/sql-reference/formats/).

Если ClickHouse не может определить формат вывода по расширению файла или вы хотите явно выбрать формат, добавьте предложение `FOMRAT`:

```bash
./clickhouse local -q "SELECT * FROM
   postgresql(
    'localhost:5432',
    'postgres_database',
    'postgres_table',
    'user',
    'password'
)
INTO OUTFILE 'my_output_file.ndjson'
FORMAT JSONEachRow"
```

:::

## Потоковая передача данных из PostgreSQL в другой процесс \{#stream-postgresql-to-another-process\}

Вместо использования `INTO OUTFILE` вы можете направить результат табличной функции в другой процесс. Ниже приведён простой пример синтаксиса: мы подсчитываем количество строк с помощью команды Linux `wc -l`:

```bash
./clickhouse local -q "SELECT *
FROM s3('https://datasets-documentation.s3.eu-west-3.amazonaws.com/house_parquet/house_0.parquet'
FORMAT JSONEachRow
)" | wc -l
```

Однако мы без труда можем передавать строки в shell-скрипт, скрипт на Python или любой другой нужный вам процесс.
