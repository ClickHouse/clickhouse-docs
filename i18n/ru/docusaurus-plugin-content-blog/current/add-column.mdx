---
title: Добавление столбца в таблицу
description: В этом руководстве вы узнаете, как добавить столбец в существующую таблицу.
date: 2024-12-18
tags: ['Моделирование данных']
keywords: ['Добавление столбца']
---

{frontMatter.description}

{/* усечь */}


## Добавление столбца в таблицу

Для этого мы будем использовать clickhouse-local:

```bash
clickhouse -m --output_format_pretty_row_numbers=
```

Допустим, у нас есть следующая таблица:

```sql
CREATE TABLE events (
    date Date DEFAULT today(), 
    name String
) 
ENGINE = MergeTree
ORDER BY date;
```

Добавим одну запись:

```sql
INSERT INTO events (name) VALUES ('Алексей');
```

А теперь выполните запрос к таблице `events`:

```sql
SELECT *
FROM events;
```

```text
┌───────date─┬─name───┐
│ 2024-12-18 │ Alexey │
└────────────┴────────┘
```


## Добавление нового столбца

Предположим, что мы хотим добавить новый столбец `favoriteNumber` типа `Float64`.
Мы можем сделать это с помощью оператора [`ALTER TABLE...ADD COLUMN`](/sql-reference/statements/alter/column#add-column):

```sql
ALTER TABLE events 
ADD COLUMN favoriteNumber Float64 DEFAULT 7;
```

Если мы выполним запрос к таблице `events`, мы увидим следующий результат:

```text
┌───────date─┬─name───┬─favoriteNumber─┐
│ 2024-12-18 │ Alexey │              7 │
└────────────┴────────┴────────────────┘
```

Строка `Alexey` по умолчанию получает значение 7, так как этого столбца не существовало, когда мы добавляли эту строку.
Теперь добавим еще один столбец:

```sql
INSERT INTO events (name) VALUES ('Тайлер');
```

Если выполнить запрос к таблице `events`, мы получим следующий результат:

```text
┏━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┓
┃       дата ┃ имя    ┃ любимоеЧисло   ┃
┡━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━┩
│ 2024-12-18 │ Tyler  │              7 │
├────────────┼────────┼────────────────┤
│ 2024-12-18 │ Alexey │              7 │
└────────────┴────────┴────────────────┘
```


## Изменение значения по умолчанию столбца

Если мы изменим тип столбца `favoriteNumber`, используя оператор [`ALTER TABLE...MODIFY COLUMN`](/sql-reference/statements/alter/column#modify-column), всё становится интереснее:

```sql
ALTER TABLE events 
MODIFY COLUMN favoriteNumber Float64 DEFAULT 99;
```

Если мы снова выполним запрос к `events`, мы получим следующий результат:

```text
┏━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┓
┃       дата ┃ имя    ┃ любимоеЧисло   ┃
┡━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━┩
│ 2024-12-18 │ Tyler  │              7 │
├────────────┼────────┼────────────────┤
│ 2024-12-18 │ Alexey │             99 │
└────────────┴────────┴────────────────┘
```

`Tyler` содержит значение `7`, которое было значением по умолчанию на момент создания этой строки.
`Alexey` получает новое значение по умолчанию `99`, потому что столбец `favoriteNumber` не существовал, когда эта строка была создана.

Если мы хотим, чтобы строка `Alexey` сразу использовала текущее значение по умолчанию, нам нужно вызвать [`OPTIMIZE TABLE`](/sql-reference/statements/optimize), чтобы принудительно записать на диск актуальные значения по умолчанию:

```sql
OPTIMIZE TABLE events;
```

Теперь, допустим, мы ещё раз изменим значение по умолчанию:

```sql
ALTER TABLE events 
MODIFY COLUMN favoriteNumber Float64 DEFAULT 21;
```

А затем вставьте ещё одну строку:

```sql
INSERT INTO events (name) VALUES ('Таня');
```

Наконец, давайте ещё раз выполним запрос к таблице `events`:

```text
┏━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━━┓
┃       дата ┃ имя    ┃ любимоеЧисло   ┃
┡━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━━┩
│ 2024-12-18 │ Alexey │             99 │
├────────────┼────────┼────────────────┤
│ 2024-12-18 │ Tyler  │              7 │
├────────────┼────────┼────────────────┤
│ 2024-12-18 │ Tanya  │             21 │
└────────────┴────────┴────────────────┘
```

`Tanya` получает новое значение по умолчанию `21`, а у `Alexey` всё ещё используется старое значение по умолчанию `99`.


## Управление позицией столбца в таблице

Когда мы добавляем новый столбец, по умолчанию он добавляется в конец таблицы. Но мы можем использовать ключевые слова `FIRST` и `AFTER`, чтобы управлять его расположением.

Например, если мы хотим добавить столбец с именем `favoriteColor` после столбца `name`, мы можем сделать следующее:

```sql
ALTER TABLE events
ADD COLUMN favoriteColor String DEFAULT 'Yellow' AFTER name;
```

Выполним запрос к таблице `events`:

```text
┏━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┓
┃       дата ┃ имя    ┃ любимыйЦвет   ┃ любимоеЧисло   ┃
┡━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━┩
│ 2024-12-18 │ Alexey │ Жёлтый        │             99 │
├────────────┼────────┼───────────────┼────────────────┤
│ 2024-12-18 │ Tyler  │ Жёлтый        │              7 │
├────────────┼────────┼───────────────┼────────────────┤
│ 2024-12-18 │ Tanya  │ Жёлтый        │             21 │
└────────────┴────────┴───────────────┴────────────────┘
```

Если мы захотим добавить столбец `favoriteDatabase` и сделать так, чтобы он был первым в списке, мы можем сделать следующее:

```sql
ALTER TABLE events
ADD COLUMN favoriteDatabase String DEFAULT 'ClickHouse' FIRST;
```

```text
┏━━━━━━━━━━━━━━━━━━┳━━━━━━━━━━━━┳━━━━━━━━┳━━━━━━━━━━━━━━━┳━━━━━━━━━━━━━━━━┓
┃ favoriteDatabase ┃       date ┃ name   ┃ favoriteColor ┃ favoriteNumber ┃
┡━━━━━━━━━━━━━━━━━━╇━━━━━━━━━━━━╇━━━━━━━━╇━━━━━━━━━━━━━━━╇━━━━━━━━━━━━━━━━┩
│ ClickHouse       │ 2024-12-18 │ Tanya  │ Жёлтый        │             21 │
├──────────────────┼────────────┼────────┼───────────────┼────────────────┤
│ ClickHouse       │ 2024-12-18 │ Alexey │ Жёлтый        │             99 │
├──────────────────┼────────────┼────────┼───────────────┼────────────────┤
│ ClickHouse       │ 2024-12-18 │ Tyler  │ Жёлтый        │              7 │
└──────────────────┴────────────┴────────┴───────────────┴────────────────┘
```

Теперь посмотрим на определение таблицы:

```sql
SHOW CREATE TABLE events
FORMAT LineAsString
```

```sql
CREATE TABLE default.`clickhouse-local-ab404c86-56cc-495b-ad1d-fb343cac3bc0events`
(
    `favoriteDatabase` String DEFAULT 'ClickHouse',
    `date` Date DEFAULT today(),
    `name` String,
    `favoriteColor` String DEFAULT 'Yellow',
    `favoriteNumber` Float64 DEFAULT 21
)
ENGINE = MergeTree
ORDER BY date
SETTINGS index_granularity = 8192
```
