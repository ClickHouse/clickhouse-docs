---
title: Использование фильтрованных агрегатов в ClickHouse
description: Узнайте, как использовать фильтрованные агрегаты в ClickHouse с агрегатными комбинаторами `-If` и `-Distinct`, чтобы упростить запись запросов и расширить аналитические возможности.
date: 2023-03-01
tags: ['Functions']
keywords: ['Фильтрованные агрегаты']
---

{frontMatter.description}

{/* обрезка */}


## Использование фильтрующих агрегатов

ClickHouse предоставляет простой и интуитивно понятный способ задания *фильтрующих агрегатов*.

Например, сравните стандартный SQL-способ задания фильтрующих агрегатов (который отлично работает в ClickHouse) с сокращённым синтаксисом, использующим `-If` — [комбинатор агрегатных функций](https://clickhouse.com/docs/sql-reference/aggregate-functions/combinators/), который можно добавить к любой агрегатной функции:

```sql
--стандартный SQL
SELECT
   avg(number)
FILTER (WHERE number > 50)
FROM numbers(100)

--ClickHouse с использованием агрегатного комбинатора
SELECT
   avgIf(number, number > 50)
FROM numbers(100)
```

Аналогично существует агрегатный комбинатор `-Distinct`:

```sql
--стандартный SQL
SELECT avg(DISTINCT number)

--ClickHouse с использованием комбинатора агрегатных функций
SELECT avgDistinct(number)
```

Почему агрегатные функции с фильтром важны? Потому что они позволяют реализовать функцию **«сравнение сегментов»** в сервисах веб-аналитики.
Например:

```sql
WITH
   Region = 'us' AS segment1,
   Browser = 'Chrome' AS segment2
SELECT
   uniqIf(UserID, segment1),
   uniqIf(UserID, segment2)
WHERE segment1 OR segment2
```

Дополнительные сведения см. на странице [комбинатора агрегатных функций](https://clickhouse.com/docs/sql-reference/aggregate-functions/combinators/) в документации.
