---
title: Вставляются ли материализованные представления синхронно?
description: В этой статье базы знаний рассматривается, выполняется ли вставка в материализованные представления синхронно
date: 2023-03-01
tags: ['Моделирование данных']
keywords: ['Материализованное представление']
---

{frontMatter.description}

{/* truncate */}

## Вставляются ли материализованные представления синхронно? \{#are-materialized-views-inserted-synchronously\}

**Вопрос:** Когда в исходную таблицу вставляются новые строки, эти новые строки также отправляются во все материализованные представления этой исходной таблицы. Выполняются ли вставки в материализованные представления синхронно, то есть если сервер успешно подтверждает вставку клиенту, означает ли это, что все материализованные представления полностью обновлены и готовы к выполнению запросов?

**Ответ:**

1. Когда `INSERT` выполняется успешно, данные вставляются как в таблицу, так и во все материализованные представления.
2. Вставка не является атомарной операцией относительно материализованных представлений. В момент, когда выполняется `INSERT`, параллельные клиенты могут видеть промежуточное состояние, когда данные уже вставлены в основную таблицу, но ещё не вставлены в материализованные представления, или наоборот.
3. Если вы используете [async inserts](https://clickhouse.com/docs/optimize/asynchronous-inserts/), они накапливают данные и выполняют обычную вставку «под капотом», возвращая клиенту тот же тип ответа, что и для обычных вставок. Если клиент получил успешный ответ от асинхронной вставки с опцией `wait_for_async_insert` (что является значением по умолчанию), данные вставляются как в таблицу, так и во все её материализованные представления.

**Вопрос:** Как насчёт цепочек/каскадных материализованных представлений?

**Ответ:**
Действуют те же правила — `INSERT` с успешным ответом означает, что данные были вставлены во все материализованные представления в цепочке. Операция вставки не является атомарной.