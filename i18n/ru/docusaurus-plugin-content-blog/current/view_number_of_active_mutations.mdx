---
date: 2023-06-07
title: Как посмотреть число активных мутаций и мутаций в очереди?
description: Следите за числом активных и находящихся в очереди мутаций в ClickHouse, особенно при выполнении операций `ALTER` или `UPDATE`. Используйте таблицу `system.mutations` для отслеживания мутаций.
tags: ['Системные таблицы']
keywords: ['Активные мутации', 'Мутации в очереди']
---

{frontMatter.description}

{/* truncate */}

## Вопрос \{#question\}

Как посмотреть количество активных или находящихся в очереди мутаций?

## Ответ \{#answer\}

Мониторинг количества активных или находящихся в очереди мутаций важен, если вы выполняете много операторов `ALTER` или `UPDATE` для своих таблиц. Эти запросы перезаписывают части данных и не являются атомарными — они упорядочиваются в порядке создания части и применяются к каждой части в этом порядке. Более подробную информацию о мутациях можно найти в [документации](https://clickhouse.com/docs/sql-reference/statements/alter#mutations).

Каждая мутация создаёт запись в таблице `system.mutations`. При выполнении большого количества мутаций вы можете отслеживать количество выполняющихся и находящихся в очереди мутаций с помощью следующего запроса:

```
SELECT
   hostname() AS host,
   count()
   FROM clusterAllReplicas('default', 'system.mutations') WHERE not is_done
   GROUP BY host;
```

:::note
Этот запрос предполагает, что вы запускаете кластер с именем `default`, что соответствует имени вашего кластера в ClickHouse Cloud. Замените `default` на имя вашего кластера.

Если у вас нет кластера, используйте эту команду:

```sql
SELECT
   hostname() AS host,
   count()
   FROM system.mutations WHERE not is_done
   GROUP BY host;
```

:::

Мы также рекомендуем прочитать недавнюю [статью в блоге об обновлении и удалении данных](https://clickhouse.com/blog/handling-updates-and-deletes-in-clickhouse).
