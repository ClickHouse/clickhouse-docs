---
title: Как вставить все строки из одной таблицы в другую?
description: "Статья базы знаний о том, как вставить все строки из одной таблицы в другую."
date: 2024-12-17
tags: ['ингестия данных']
keywords: ['Вставка из таблицы']
---

{frontMatter.description}

{/* усечение */}


## Введение \{#introduction\}

Иногда требуется выполнить повторный приём всех данных из одной таблицы в другую.

Например, может понадобиться выполнить повторный приём данных из промежуточной таблицы (staging) в рабочую таблицу (production). В этой статье показано, как сделать это с помощью оператора `INSERT INTO`.

## Пример

Ниже приведён простой пример того, как это работает и как его протестировать:

* Создайте тестовую базу данных

```sql
CREATE DATABASE db1;
```

* Создайте тестовую таблицу

```sql
CREATE TABLE db1.source_table
(
    city VARCHAR,
    country VARCHAR,
    continent VARCHAR
)
engine = MergeTree()
ORDER BY continent;
```

* Добавьте некоторые данные в исходную таблицу

```sql
INSERT INTO db1.source_table (city, country, continent)
VALUES
    ('New York', 'USA', 'North America'),
    ('Tokyo', 'Japan', 'Asia'),
    ('Berlin', 'Germany', 'Europe'),
    ('Paris', 'France', 'Europe'),
    ('Cairo', 'Egypt', 'Africa'),
    ('Sydney', 'Australia', 'Australia');
```

* Проверьте количество строк в исходной таблице

```sql
SELECT COUNT(*) FROM db1.source_table;
```

```text
┌─count()─┐
│      6  │
└─────────┘
```

* Создайте новую таблицу с той же структурой, что и у исходной таблицы.

```sql
CREATE TABLE db1.target_table AS db1.source_table;
```

* Вставьте все строки из исходной таблицы в таблицу назначения.

```sql
INSERT INTO db1.target_table SELECT * FROM db1.source_table;
```

* Проверьте количество строк в целевой таблице

```sql
SELECT COUNT(*) FROM db1.target_table;
```

```text
┌─count()─┐
│      6  │
└─────────┘
```

Если вы хотите изменить структуру новой таблицы, вы можете сначала посмотреть структуру исходной таблицы.

```sql
SHOW CREATE TABLE db1.source_table;
```

Затем создайте новую таблицу с обновлённой структурой. В нашем случае мы хотим добавить новый столбец `population` в целевую таблицу.

```sql
CREATE TABLE db1.target_table_population
(
    `city` String,
    `country` String,
    `continent` String,
    `population` UInt16,
)
ENGINE = MergeTree
ORDER BY continent;
```

* Вставьте все строки из исходной таблицы в целевую таблицу, включая новый столбец. Поле population будет установлено в 0 для всех строк.

```sql
INSERT INTO db1.target_table_population (city, country, continent, population)
SELECT city, country, continent, 0 FROM db1.source_table;
```

* Проверьте данные в целевой таблице

```sql
SELECT * FROM db1.target_table_population LIMIT 3;
```

```text
┌─город─────┬─страна────┬─континент──────┬─население──┐
│ Нью-Йорк  │ США       │ Северная Америка│          0 │
│ Токио     │ Япония    │ Азия           │          0 │
│ Берлин    │ Германия  │ Европа         │          0 │
└───────────┴───────────┴────────────────┴────────────┘
```
