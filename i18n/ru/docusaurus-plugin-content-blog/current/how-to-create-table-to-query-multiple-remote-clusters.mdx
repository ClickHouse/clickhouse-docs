---
title: Как создать таблицу для выполнения запросов к нескольким удалённым кластерам
description: "Как создать таблицу для выполнения запросов к нескольким удалённым кластерам"
date: 2024-07-03
tags: ['Развертывания и масштабирование']
keywords: ['Запрос', 'Удалённый кластер']
---

{frontMatter.description}

{/* усечение */}

***

## Вопрос \{#question\}

Как создать таблицу, которая может выполнять запросы к другим кластерам или экземплярам?

## Ответ \{#answer\}

Ниже приведён простой пример для проверки работоспособности.

В этом примере используется ClickHouse Cloud, но пример также будет работать с самостоятельно развёрнутыми кластерами.
Целевые адреса потребуется изменить на URL/хосты/DNS целевого узла или балансировщика нагрузки.

В кластере A:

```
./clickhouse client --host clusterA.us-west-2.aws.clickhouse.cloud --secure --password 'Password123!'
```

Создайте базу данных:

```
create database db1;
```

Создайте таблицу:

```
CREATE TABLE db1.table1_remote1
(
    `id` UInt32,
    `timestamp_column` DateTime,
    `string_column` String
)
ENGINE = MergeTree()
ORDER BY id;
```

Вставьте несколько примеров строк:

```
insert into db1.table1_remote1
values
(1, '2023-09-29 00:01:00', 'a'),
(2, '2023-09-29 00:02:00', 'b'),
(3, '2023-09-29 00:03:00', 'c');
```

В кластере B:

```
./clickhouse client --host clusterB.us-east-2.aws.clickhouse.cloud --secure --password 'Password123!'
```

Создайте базу данных:

```
create database db1;
```

Создайте таблицу:

```
CREATE TABLE db1.table1_remote2
(
    `id` UInt32,
    `timestamp_column` DateTime,
    `string_column` String
)
ENGINE = MergeTree()
ORDER BY id;
```

Вставьте примеры строк:

```
insert into db1.table1_remote1
values
(4, '2023-09-29 00:04:00', 'x'),
(5, '2023-09-29 00:05:00', 'y'),
(6, '2023-09-29 00:06:00', 'z');
```

В кластере C:\
*этот кластер будет использоваться для сбора данных из двух других кластеров, но также может выступать в качестве источника.

```
./clickhouse client --host clusterC.us-west-2.aws.clickhouse.cloud --secure --password 'Password123!'
```

Создайте базу данных:

```
create database db1;
```

Создайте удалённые таблицы с использованием remoteSecure() для подключения к другим кластерам.\
Определение таблицы для удалённого кластера A:

```
CREATE TABLE db1.table1_remote1_main
(
    `id` UInt32,
    `timestamp_column` DateTime,
    `string_column` String
) AS remoteSecure('clusterA.us-west-2.aws.clickhouse.cloud:9440', 'db1.table1_remote1', 'default', 'Password123!');
```

Определение таблицы для удалённого кластера B:

```
CREATE TABLE db1.table1_remote2_main
(
    `id` UInt32,
    `timestamp_column` DateTime,
    `string_column` String
) AS remoteSecure('clusterB.us-east-2.aws.clickhouse.cloud:9440', 'db1.table1_remote2', 'default', 'Password123!')
```

Создайте таблицу типа Merge для сбора результатов:

```
create table db1.table1_merge_remote
(
  id UInt32,
  timestamp_column DateTime,
  string_column String
)
engine = Merge('db1', 'table.\_main');
```

Проверьте результаты:

```
clickhouse-cloud :) select * from db1.table1_merge_remote;

SELECT *
FROM db1.table1_merge_remote

Query id: 46b6e741-bbd1-47ed-b40e-69ddb6e0c364

┌─id─┬────timestamp_column─┬─string_column─┐
│  1 │ 2023-09-29 00:01:00 │ a             │
│  2 │ 2023-09-29 00:02:00 │ b             │
│  3 │ 2023-09-29 00:03:00 │ c             │
└────┴─────────────────────┴───────────────┘
┌─id─┬────timestamp_column─┬─string_column─┐
│  4 │ 2023-09-29 00:04:00 │ x             │
│  5 │ 2023-09-29 00:05:00 │ y             │
│  6 │ 2023-09-29 00:06:00 │ z             │
└────┴─────────────────────┴───────────────┘

6 rows in set. Elapsed: 0.275 sec.
```

Дополнительные сведения:

* [Табличная функция `remote`](/sql-reference/table-functions/remote)
* [Движок таблиц Merge](/engines/table-engines/special/merge)