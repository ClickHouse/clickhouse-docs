---
title: Как использовать команду EXCHANGE для обмена таблицами
description: "Как использовать команду EXCHANGE для обмена таблицами"
date: 2024-11-21
tags: ['Управление данными']
keywords: ['EXCHANGE']
---

{frontMatter.description}

{/* сократить */}

***

## Вопрос \{#question\}

Как использовать команду [`EXCHANGE`](/sql-reference/statements/exchange) для смены имен таблиц?

## Ответ \{#answer\}

Команда `EXCHANGE` полезна, когда нужно заменить текущую таблицу на другую временную таблицу, в которой, возможно, были обновлены первичные ключи или другие настройки.
Это выполняется атомарно, в отличие от команды `RENAME`.
Она также полезна, когда у вас есть материализованные представления, срабатывающие на исходной таблице, и вы хотите избежать их перестроения.

Ниже приведён простой пример, демонстрирующий, как это работает и как это протестировать:

* Создать тестовую базу данных

```sql
create database db1;
```

* Создайте примерную таблицу

```sql
create table db1.table1_exchange
(
 id Int32,
 string_field String
)
engine = MergeTree()
order by id;
```

* Вставить примерную строку

```sql
insert into db1.table1_exchange
values
(1, 'a');
```

* Создайте пример временной таблицы для обмена

```sql
create table db1.table1_exchange_temp
(
 id Int32,
 string_field String
)
engine = MergeTree()
order by id;
```

* Вставьте пример строки во временную таблицу

```sql
insert into db1.table1_exchange_temp
values
(2, 'b');
```

* Выполните команду `EXCHANGE`, чтобы поменять таблицы местами

```sql
exchange tables db1.table1_exchange and db1.table1_exchange_temp;
```

* Убедитесь, что таблицы теперь поменяны местами и строки в них тоже переставлены

```sql
select * from db1.table1_exchange;
```

```text
┌─id─┬─string_field─┐
│  2 │ b            │
└────┴──────────────┘

1 row in set. Elapsed: 0.002 sec. 
```
