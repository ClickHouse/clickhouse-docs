---
title: Краткий пример на Python с использованием модуля requests
description: "Пример использования Python и модуля requests для записи данных в ClickHouse и чтения из него"
date: 2022-07-10
tags: ['Нативные клиенты и интерфейсы']
keywords: ['Python']
---

{frontMatter.description}

{/* truncate */}


## Вопрос \{#question\}

Могу ли я просто выполнять HTTP-запросы к серверу ClickHouse с помощью модуля _requests_?

## Ответ

Да, вот пример кода.

```py
import requests
import datetime

create_replace_stmt = 'CREATE OR REPLACE TABLE test_table (name String, age UInt8) Engine=MergeTree ORDER BY tuple();'
select_query = 'SELECT count() FROM test_table'
insert_query = 'INSERT INTO test_table SELECT * FROM  generateRandom(\'name String, age UInt8\',1,1) LIMIT 300000000'

CH_URL = 'https://your_clickhouse_service_fqdn:8443'
CH_USER = 'default'
CH_PASSWORD = 'secret_pwd'

headers = {}
headers["X-ClickHouse-User"] = CH_USER
headers["X-ClickHouse-Key"] = CH_PASSWORD

now = (datetime.datetime.now())
print("{} - запуск...".format(now))


# создание/замена таблицы
now = (datetime.datetime.now())
print("{} - создание/замена таблицы...".format(now))
response = requests.post(url=CH_URL,
                         params={"database": "default",
                                 "query": create_replace_stmt,
                                 "session_id": "my-session-id-string"
                                 },
                         headers=headers)

# выполнение SELECT count()
response = requests.post(url=CH_URL,
                         params={"database": "default",
                                 "query": select_query,
                                 "session_id": "my-session-id-string"
                                 },
                         headers=headers)

now = (datetime.datetime.now())
print("{} - количество элементов в test_table до вставки: {}".format(
    now, response.content.decode('utf-8')))


# вставка данных
now = (datetime.datetime.now())
print("{} - вставка данных...".format(now))
response = requests.post(url=CH_URL,
                         params={"database": "default",
                                 "query": insert_query,
                                 "session_id": "my-session-id-string",
                                 "wait_end_of_query": 1
                                 },
                         headers=headers)

now = (datetime.datetime.now())
print("{} - вставка данных завершена...".format(now))

response = requests.post(url=CH_URL,
                         params={"database": "default",
                                 "query": select_query,
                                 "session_id": "my-session-id-string",
                                 },
                         headers=headers)

now = (datetime.datetime.now())
print("{} - количество элементов в test_table после вставки: {}".format(
    now, response.content.decode('utf-8')))
```

Пример ожидаемого результата:

```
(venv) ➜  venv/bin/python main.py
2023-07-07 14:54:27.336450 - запуск...
2023-07-07 14:54:27.336476 - создание/замена таблицы...
2023-07-07 14:54:28.125270 - элементов в test_table перед вставкой: 0

2023-07-07 14:54:28.125352 - Вставка данных...
2023-07-07 14:55:23.788466 - Вставка данных завершена...
2023-07-07 14:55:23.962134 - элементов в test_table после вставки: 299115357
```

requirements.txt

```
requests==2.31.0
```

См. эту другую [статью базы знаний](https://clickhouse.com/docs/knowledgebase/python-clickhouse-connect-example#steps) с инструкциями по настройке виртуального окружения Python.
