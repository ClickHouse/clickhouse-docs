---
title: Как увеличить количество потоков в ClickHouse
description: Узнайте, как настроить глобальный пул потоков в ClickHouse, регулируя параметры `max_thread_pool_size`, `thread_pool_queue_size` и `max_thread_pool_free_size`.
date: 2023-03-01
tags: ['Производительность и оптимизации']
keywords: ['Количество доступных потоков']
---

{frontMatter.description}

{/* truncate */}


## Увеличение числа потоков в ClickHouse

ClickHouse использует потоки из **глобального пула потоков (Global Thread Pool)** для обработки запросов, а также для выполнения фоновых операций, таких как слияния и мутации. Если нет свободного потока для обработки запроса, в пуле создаётся новый поток.

Максимальный размер глобального пула потоков определяется настройкой `max_thread_pool_size`, которая по умолчанию равна 10 000. Вы можете изменить это значение в конфигурационном файле — здесь мы устанавливаем его равным 20 000:

```xml
<max_thread_pool_size>20000</max_thread_pool_size>
```

Если вы изменяете `max_thread_pool_size`, мы рекомендуем установить для `thread_pool_queue_size` такое же значение. Параметр `thread_pool_queue_size` задаёт максимальное количество задач, которые могут быть поставлены в очередь глобального пула потоков:

```xml
<thread_pool_queue_size>20000</thread_pool_queue_size>
```

Вы также можете освободить ресурсы, если на сервере много простаивающих потоков, — с помощью настройки `max_thread_pool_free_size`. Значение по умолчанию — 1 000, что означает, что в глобальном пуле потоков никогда не может быть более 1 000 простаивающих потоков. В следующем примере значение увеличено до 2 000:

```xml
<max_thread_pool_free_size>2000</max_thread_pool_free_size>
```

Ознакомьтесь с [документацией](https://clickhouse.com/docs/operations/server-configuration-parameters/settings#max-thread-pool-size), чтобы узнать больше об указанных выше настройках и других параметрах, влияющих на глобальный пул потоков.
