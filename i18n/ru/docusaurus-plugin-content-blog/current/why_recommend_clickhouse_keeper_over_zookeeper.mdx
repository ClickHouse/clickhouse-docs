---
date: 2023-06-07
title: Почему рекомендуется использовать ClickHouse Keeper вместо ZooKeeper?
description: ClickHouse Keeper по сравнению с ZooKeeper снижает потребление дискового пространства, обеспечивает более быстрое восстановление и меньшее использование памяти, что дает более высокую производительность кластеров ClickHouse.
tags: ['Ключевые концепции данных']
keywords: ['ClickHouse Keeper', 'ZooKeeper']
---

{frontMatter.description}

{/* усечение */}

***


## Вопрос \{#question\}

ClickHouse Keeper предоставляет систему координации для репликации данных и выполнения распределённых DDL-запросов. ClickHouse Keeper совместим с ZooKeeper, но не всегда очевидно, почему стоит использовать ClickHouse Keeper вместо ZooKeeper. В этой статье рассматриваются некоторые преимущества Keeper.

## Ответ \{#answer\}

[ClickHouse Cloud](https://console.clickhouse.cloud/) использует `clickhouse-keeper` в крупномасштабных развертываниях для тысяч сервисов в многопользовательской среде. Мы спроектировали и разработали Keeper, чтобы отказаться от зависимости от Java-реализации ZooKeeper. ClickHouse Keeper устраняет множество хорошо известных недостатков ZooKeeper и предлагает дополнительные улучшения, включая:

- Снимки и логи потребляют значительно меньше дискового пространства благодаря более эффективному сжатию
- Отсутствует ограничение на размер пакета и данных узла по умолчанию (в ZooKeeper оно составляет 1 МБ)
- Нет проблемы переполнения `zxid` (в ZooKeeper это приводит к необходимости перезапуска каждые 2 млрд транзакций)
- Более быстрое восстановление после сетевых разделений благодаря использованию более эффективного протокола распределённого консенсуса
- Используется меньше памяти при том же объёме данных
- Проще настраивать, не требуется задавать размер кучи JVM или использовать отдельную реализацию сборщика мусора
- Несколько дополнительных команд в протоколе обеспечивают более быструю работу таблиц `ReplicatedMergeTree`
- Более широкое покрытие тестами Jepsen

Кроме того, служба поддержки ClickHouse отмечает значительное снижение числа проблем с кластерами в случаях, когда используется `clickhouse-keeper`, а не ZooKeeper.

Подробную информацию о настройке и запуске ClickHouse Keeper см. на [странице документации Keeper](https://clickhouse.com/docs/guides/sre/keeper/clickhouse-keeper).