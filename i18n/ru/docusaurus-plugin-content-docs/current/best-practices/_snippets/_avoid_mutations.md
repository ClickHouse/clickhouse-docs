В ClickHouse **мутации** — это операции, которые изменяют или удаляют существующие данные в таблице, обычно с помощью `ALTER TABLE ... DELETE` или `ALTER TABLE ... UPDATE`. Хотя эти операторы могут выглядеть похожими на стандартные SQL-операции, внутреннее устройство у них принципиально иное.

Вместо изменения строк на месте, мутации в ClickHouse представляют собой асинхронные фоновые процессы, которые переписывают целые [куски данных](/parts), затронутые изменением. Такой подход необходим из-за колоночно-ориентированной, неизменяемой модели хранения ClickHouse и может привести к значительному потреблению ресурсов ввода-вывода.

Когда выполняется мутация, ClickHouse планирует создание новых **мутированных кусков**, оставляя исходные куски нетронутыми до тех пор, пока новые не будут готовы. После готовности мутированные куски атомарно заменяют исходные. Однако, поскольку операция переписывает целые куски, даже незначительное изменение (например, обновление одной строки) может привести к масштабным перезаписям и избыточному усилению записи.

Для больших наборов данных это может вызвать существенный всплеск дисковых операций ввода-вывода и снизить общую производительность кластера. В отличие от слияний, мутации нельзя откатить после запуска, и они будут продолжать выполняться даже после перезапуска сервера, если только не будут явно отменены — см. [`KILL MUTATION`](/sql-reference/statements/kill#kill-mutation).

:::tip Мониторинг количества активных или ожидающих мутаций в ClickHouse
О том, как отслеживать количество активных или ожидающих мутаций, см. следующую [статью базы знаний](/knowledgebase/view_number_of_active_mutations).
:::

Мутации **полностью упорядочены**: они применяются к данным, вставленным до запуска мутации, в то время как более новые данные остаются незатронутыми. Они не блокируют вставки, но все же могут пересекаться с другими выполняющимися запросами. SELECT, выполняемый во время мутации, может читать смесь мутированных и немутированных кусков, что может привести к несогласованному представлению данных во время выполнения. ClickHouse выполняет мутации параллельно для каждого куска, что может дополнительно увеличить потребление памяти и процессора, особенно когда задействованы сложные подзапросы (например, x IN (SELECT ...)).

Как правило, **избегайте частых или масштабных мутаций**, особенно на таблицах с высокой нагрузкой. Вместо этого используйте альтернативные движки таблиц, такие как [ReplacingMergeTree](/guides/replacing-merge-tree) или [CollapsingMergeTree](/engines/table-engines/mergetree-family/collapsingmergetree), которые предназначены для более эффективной обработки исправлений данных во время выполнения запросов или слияний. Если мутации абсолютно необходимы, тщательно отслеживайте их с помощью таблицы system.mutations и используйте `KILL MUTATION`, если процесс застрял или работает некорректно. Неправильное использование мутаций может привести к снижению производительности, избыточной нагрузке на хранилище и потенциальной нестабильности сервиса — поэтому применяйте их с осторожностью и умеренно.

Для удаления данных пользователи также могут рассмотреть [легковесные удаления](/guides/developer/lightweight-delete) или управление данными через [партиции](/best-practices/choosing-a-partitioning-key), которые позволяют [эффективно удалять](/sql-reference/statements/alter/partition#drop-partitionpart) целые куски.