## Когда использовать тип `JSON` {#when-to-use-json-type}

Тип `JSON` предназначен для выполнения запросов, фильтрации и агрегации отдельных полей внутри JSON-объектов с динамической или непредсказуемой структурой. Это достигается за счёт разбиения JSON-объектов на отдельные подстолбцы, что существенно сокращает объём читаемых данных и ускоряет запросы по выбранным полям по сравнению с альтернативами вроде `Map` или парсинга строк.

**Однако это связано с важными издержками:**

- Более медленные операции `INSERT` — разбиение JSON на подстолбцы, определение типов и управление гибкими структурами хранения делает вставки медленнее по сравнению с сохранением JSON как простого столбца типа `String`.
- Медленнее при чтении целых объектов — если вам нужно получать полные JSON-документы (а не отдельные поля), тип `JSON` работает медленнее, чем чтение из столбца типа `String`. Накладные расходы на реконструкцию объектов из отдельных подстолбцов не дают выгоды, когда вы не выполняете запросы на уровне полей.
- Накладные расходы на хранение — поддержка отдельных подстолбцов добавляет структурные накладные расходы по сравнению с хранением JSON как одного строкового значения.

### Используйте тип `JSON`, когда: {#use-json-type}

- Ваши данные имеют динамическую или непредсказуемую структуру с разными ключами в разных документах
- Типы полей или схемы со временем меняются или отличаются между записями
- Вам нужно выполнять запросы, фильтрацию или агрегацию по конкретным путям внутри JSON-объектов, структуру которых нельзя предсказать заранее
- Ваш сценарий использования предполагает работу с полуструктурированными данными, такими как логи, события или пользовательский контент с неоднородными схемами

### Используйте столбец типа `String` (или структурированные типы), когда: {#use-string-type}

- Структура ваших данных известна и постоянна — в этом случае используйте обычные столбцы или типы `Nested`, `Tuple`, `Array`, `Dynamic` либо `Variant`
- Документы `JSON` рассматриваются как непрозрачные двоичные объекты, которые только сохраняются и извлекаются целиком без анализа на уровне полей
- Вам не нужно выполнять запросы или фильтрацию по отдельным полям JSON внутри базы данных
- `JSON` используется лишь как формат передачи/хранения и не анализируется в ClickHouse

:::tip
Если `JSON` — это непрозрачный документ, который не анализируется внутри базы данных, а только сохраняется и затем извлекается, его следует хранить в столбце типа `String`. Преимущества типа `JSON` проявляются только тогда, когда вам нужно эффективно выполнять запросы, фильтрацию или агрегацию по отдельным полям в динамических структурах `JSON`.

Вы также можете комбинировать подходы — использовать стандартные столбцы для предсказуемых полей верхнего уровня и столбец `JSON` для динамических частей полезной нагрузки.
:::