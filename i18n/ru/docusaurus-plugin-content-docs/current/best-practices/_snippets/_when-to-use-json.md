## Когда использовать тип `JSON` \\{#when-to-use-json-type\\}

Тип `JSON` предназначен для выполнения запросов, фильтрации и агрегации отдельных полей внутри JSON-объектов с динамической или непредсказуемой структурой. Это достигается за счёт разбиения JSON-объектов на отдельные подстолбцы, что значительно сокращает объём считываемых данных и ускоряет запросы по выбранным полям по сравнению с альтернативами, такими как `Map` или разбор строк.

**Однако это связано с важными компромиссами:**

- Более медленные операции `INSERT` — Разбиение JSON на подстолбцы, вывод типов и управление гибкими структурами хранения делает вставки медленнее по сравнению с хранением JSON в простом столбце типа `String`.
- Медленнее при чтении целых объектов — Если нужно извлекать полные JSON-документы (а не отдельные поля), тип `JSON` работает медленнее, чем чтение из столбца типа `String`. Накладные расходы на реконструкцию объектов из отдельных подстолбцов не дают преимуществ, если вы не выполняете запросы на уровне отдельных полей.
- Накладные расходы на хранение — Поддержка отдельных подстолбцов добавляет структурные накладные расходы по сравнению с хранением JSON как одного строкового значения.

### Используйте тип `JSON`, когда: \\{#use-json-type\\}

- Ваши данные имеют динамическую или непредсказуемую структуру с различающимися ключами в разных документах
- Типы полей или схемы со временем изменяются или различаются между записями
- Вам нужно выполнять запросы, фильтрацию или агрегирование по конкретным путям внутри объектов JSON, структуру которых невозможно заранее предсказать
- Ваш сценарий использования включает полуструктурированные данные, такие как логи, события или пользовательский контент с непоследовательными схемами

### Используйте столбец `String` (или структурированные типы), когда: \\{#use-string-type\\}

- Структура ваших данных известна и стабильна — в этом случае используйте обычные столбцы или типы `Tuple`, `Array`, `Dynamic` либо `Variant`
- Документы `JSON` рассматриваются как непрозрачные двоичные объекты, которые только сохраняются и извлекаются целиком без анализа на уровне полей
- Вам не нужно выполнять запросы или фильтрацию по отдельным полям JSON в базе данных
- `JSON` используется только как формат передачи/хранения и не анализируется в ClickHouse

:::tip
Если `JSON` — это непрозрачный документ, который не анализируется внутри базы данных и только сохраняется и затем извлекается, его следует хранить в столбце типа `String`. Преимущества типа `JSON` проявляются только тогда, когда вам нужно эффективно выполнять запросы, фильтрацию или агрегацию по конкретным полям внутри динамических структур `JSON`.

Вы также можете комбинировать подходы — использовать стандартные столбцы для предсказуемых верхнеуровневых полей и столбец `JSON` для динамических частей полезной нагрузки.
:::