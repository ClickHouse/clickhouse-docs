---
slug: /guides/sizing-and-hardware-recommendations
sidebar_label: 'Рекомендации по выбору конфигурации и оборудования'
sidebar_position: 4
title: 'Рекомендации по выбору конфигурации и оборудования'
description: 'В этом руководстве рассматриваются наши общие рекомендации по конфигурациям оборудования, вычислительных ресурсов, памяти и дисковой подсистемы для пользователей ClickHouse с открытым исходным кодом.'
doc_type: 'guide'
keywords: ['конфигурация', 'оборудование', 'планирование ресурсов', 'лучшие практики', 'производительность']
---



# Рекомендации по выбору конфигурации и оборудования

В этом руководстве приводятся общие рекомендации по конфигурации аппаратного обеспечения, вычислительных ресурсов, памяти и дисковой подсистемы для пользователей открытой версии ClickHouse. Если вы хотите упростить настройку, мы рекомендуем использовать [ClickHouse Cloud](https://clickhouse.com/cloud), поскольку он автоматически масштабируется и адаптируется к вашим нагрузкам, одновременно минимизируя затраты, связанные с управлением инфраструктурой.

Конфигурация вашего кластера ClickHouse в значительной степени зависит от сценариев использования и характера нагрузки вашего приложения. При планировании архитектуры необходимо учитывать следующие факторы:

- Параллелизм (количество запросов в секунду)
- Пропускная способность (число обрабатываемых строк в секунду)
- Объем данных
- Политика хранения данных
- Стоимость оборудования
- Стоимость обслуживания



## Диск {#disk}

Тип дисков, которые следует использовать с ClickHouse, зависит от объема данных, требований к задержке или пропускной способности.

### Оптимизация производительности {#optimizing-for-performance}

Для максимальной производительности рекомендуется напрямую подключать [тома SSD с выделенными IOPS от AWS](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/provisioned-iops.html) или эквивалентное решение от вашего облачного провайдера, оптимизированное для операций ввода-вывода.

### Оптимизация затрат на хранение {#optimizing-for-storage-costs}

Для снижения затрат можно использовать [тома EBS SSD общего назначения](https://docs.aws.amazon.com/AWSEC2/latest/UserGuide/general-purpose.html).

Также можно реализовать многоуровневое хранилище с использованием SSD и HDD в [архитектуре hot/warm/cold](/guides/developer/ttl#implementing-a-hotwarmcold-architecture). Альтернативно, для разделения вычислений и хранения можно использовать [AWS S3](https://aws.amazon.com/s3/) в качестве хранилища. Ознакомьтесь с нашим руководством по использованию ClickHouse с открытым исходным кодом с разделением вычислений и хранения [здесь](/guides/separation-storage-compute). Разделение вычислений и хранения доступно по умолчанию в ClickHouse Cloud.


## Процессор {#cpu}

### Какой процессор следует использовать? {#which-cpu-should-i-use}

Тип процессора зависит от характера использования. Однако в целом приложениям с большим количеством частых параллельных запросов, обрабатывающим большие объемы данных или использующим вычислительно интенсивные пользовательские функции (UDF), потребуется больше ядер процессора.

**Приложения с низкой задержкой или клиентоориентированные приложения**

Для требований к задержке в десятки миллисекунд, например для клиентоориентированных рабочих нагрузок, мы рекомендуем EC2 [серии i3](https://aws.amazon.com/ec2/instance-types/i3/) или [серии i4i](https://aws.amazon.com/ec2/instance-types/i4i/) от AWS или эквивалентные предложения вашего облачного провайдера, оптимизированные для операций ввода-вывода.

**Приложения с высокой параллельностью**

Для рабочих нагрузок, требующих оптимизации параллельности (более 100 запросов в секунду), мы рекомендуем [вычислительно оптимизированную серию C](https://aws.amazon.com/ec2/instance-types/#Compute_Optimized) от AWS или эквивалентное предложение вашего облачного провайдера.

**Сценарий использования хранилища данных**

Для рабочих нагрузок хранилищ данных и ad-hoc аналитических запросов мы рекомендуем [серию R-типа](https://aws.amazon.com/ec2/instance-types/#Memory_Optimized) от AWS или эквивалентное предложение вашего облачного провайдера, так как они оптимизированы по памяти.

---

### Какой должна быть загрузка процессора? {#what-should-cpu-utilization-be}

Для ClickHouse не существует стандартного целевого показателя загрузки процессора. Используйте такой инструмент, как [iostat](https://linux.die.net/man/1/iostat), для измерения средней загрузки процессора и соответствующим образом корректируйте размер серверов для управления неожиданными всплесками трафика. Однако для аналитических сценариев или сценариев хранилищ данных с ad-hoc запросами следует ориентироваться на загрузку процессора 10-20%.

### Сколько ядер процессора следует использовать? {#how-many-cpu-cores-should-i-use}

Количество процессоров зависит от вашей рабочей нагрузки. Однако в целом мы рекомендуем следующие соотношения памяти к ядрам процессора в зависимости от типа процессора:

- **[M-тип](https://aws.amazon.com/ec2/instance-types/) (сценарии общего назначения):** соотношение памяти к ядрам процессора 4 ГБ:1
- **[R-тип](https://aws.amazon.com/ec2/instance-types/#Memory_Optimized) (сценарии хранилищ данных):** соотношение памяти к ядрам процессора 8 ГБ:1
- **[C-тип](https://aws.amazon.com/ec2/instance-types/#Compute_Optimized) (вычислительно оптимизированные сценарии):** соотношение памяти к ядрам процессора 2 ГБ:1

Например, при использовании процессоров M-типа мы рекомендуем выделять 100 ГБ памяти на 25 ядер процессора. Чтобы определить объем памяти, подходящий для вашего приложения, необходимо профилировать использование памяти. Вы можете ознакомиться с [руководством по отладке проблем с памятью](/guides/developer/debugging-memory-issues) или использовать [встроенную панель мониторинга](/operations/monitoring) для мониторинга ClickHouse.


## Память {#memory}

Как и при выборе процессора, выбор соотношения памяти к хранилищу и памяти к процессору зависит от вашего сценария использования.

Требуемый объём оперативной памяти обычно зависит от:

- Сложности запросов.
- Объёма данных, обрабатываемых в запросах.

В целом, однако, чем больше у вас памяти, тем быстрее будут выполняться запросы.
Если ваш сценарий использования чувствителен к стоимости, будет достаточно меньших объёмов памяти, поскольку можно включить настройки ([`max_bytes_before_external_group_by`](/operations/settings/settings#max_bytes_before_external_group_by) и [`max_bytes_before_external_sort`](/operations/settings/settings#max_bytes_before_external_sort)), позволяющие сбрасывать данные на диск, но учтите, что это может существенно повлиять на производительность запросов.

### Каким должно быть соотношение памяти к хранилищу? {#what-should-the-memory-to-storage-ratio-be}

Для небольших объёмов данных приемлемо соотношение памяти к хранилищу 1:1, но общий объём памяти не должен быть меньше 8 ГБ.

Для сценариев использования с длительными периодами хранения данных или с большими объёмами данных мы рекомендуем соотношение памяти к хранилищу от 1:100 до 1:130. Например, 100 ГБ оперативной памяти на реплику при хранении 10 ТБ данных.

Для сценариев использования с частым доступом, таких как клиентские нагрузки, мы рекомендуем использовать больше памяти при соотношении памяти к хранилищу от 1:30 до 1:50.


## Реплики {#replicas}

Рекомендуется использовать как минимум три реплики на шард (или две реплики при использовании [Amazon EBS](https://aws.amazon.com/ebs/)). Кроме того, рекомендуется сначала выполнить вертикальное масштабирование всех реплик, прежде чем добавлять дополнительные реплики (горизонтальное масштабирование).

ClickHouse не выполняет автоматическое шардирование, и перешардирование набора данных потребует значительных вычислительных ресурсов. Поэтому, как правило, рекомендуется использовать максимально мощный доступный сервер, чтобы избежать необходимости перешардирования данных в будущем.

Рассмотрите возможность использования [ClickHouse Cloud](https://clickhouse.com/cloud), который масштабируется автоматически и позволяет легко управлять количеством реплик в соответствии с вашими потребностями.


## Примеры конфигураций для больших рабочих нагрузок {#example-configurations-for-large-workloads}

Конфигурации ClickHouse в значительной степени зависят от требований вашего конкретного приложения. Пожалуйста, [свяжитесь с отделом продаж](https://clickhouse.com/company/contact?loc=docs-sizing-and-hardware-recommendations), если вы хотите, чтобы мы помогли оптимизировать вашу архитектуру с точки зрения стоимости и производительности.

Для справки (а не в качестве рекомендаций) ниже приведены примеры конфигураций пользователей ClickHouse в производственной среде:

### Fortune 500 B2B SaaS {#fortune-500-b2b-saas}

<table>
  <tr>
    <td col='2'>
      <strong>
        <em>Хранилище</em>
      </strong>
    </td>
  </tr>
  <tr>
    <td>
      <strong>Ежемесячный объем новых данных</strong>
    </td>
    <td>30TB</td>
  </tr>
  <tr>
    <td>
      <strong>Общий объем хранилища (сжатые данные)</strong>
    </td>
    <td>540TB</td>
  </tr>
  <tr>
    <td>
      <strong>Срок хранения данных</strong>
    </td>
    <td>18 месяцев</td>
  </tr>
  <tr>
    <td>
      <strong>Диск на узел</strong>
    </td>
    <td>25TB</td>
  </tr>
  <tr>
    <td col='2'>
      <strong>
        <em>Процессор</em>
      </strong>
    </td>
  </tr>
  <tr>
    <td>
      <strong>Параллелизм</strong>
    </td>
    <td>Более 200 одновременных запросов</td>
  </tr>
  <tr>
    <td>
      <strong>Количество реплик (включая пару HA)</strong>
    </td>
    <td>44</td>
  </tr>
  <tr>
    <td>
      <strong>vCPU на узел</strong>
    </td>
    <td>62</td>
  </tr>
  <tr>
    <td>
      <strong>Всего vCPU</strong>
    </td>
    <td>2700</td>
  </tr>
  <tr>
    <td col='2'>
      <strong>
        <em>Память</em>
      </strong>
    </td>
  </tr>
  <tr>
    <td>
      <strong>Общий объем RAM</strong>
    </td>
    <td>11TB</td>
  </tr>
  <tr>
    <td>
      <strong>RAM на реплику</strong>
    </td>
    <td>256GB</td>
  </tr>
  <tr>
    <td>
      <strong>Соотношение RAM к vCPU</strong>
    </td>
    <td>4 GB:1</td>
  </tr>
  <tr>
    <td>
      <strong>Соотношение RAM к диску</strong>
    </td>
    <td>1:50</td>
  </tr>
</table>

### Телекоммуникационный оператор из списка Fortune 500 для сценария логирования {#fortune-500-telecom-operator-for-a-logging-use-case}


<table>
    <tr>
        <td col="2"><strong><em>Хранилище</em></strong></td>
    </tr>
    <tr>
        <td><strong>Объем журнальных данных в месяц</strong></td>
        <td>4860TB</td>
    </tr>
    <tr>
        <td><strong>Общий объем хранилища (в сжатом виде)</strong></td>
        <td>608TB</td>
    </tr>
    <tr>
        <td><strong>Срок хранения данных</strong></td>
        <td>30 дней</td>
    </tr>
    <tr>
        <td><strong>Диск на узел</strong></td>
        <td>13TB</td>
    </tr>
    <tr>
        <td col="2"><strong><em>CPU</em></strong></td>
    </tr>
    <tr>
        <td><strong>Число реплик (включая HA-пару)</strong></td>
        <td>38</td>
    </tr>
    <tr>
        <td><strong>vCPU на узел</strong></td>
        <td>42</td>
    </tr>
    <tr>
        <td><strong>Общее число vCPU</strong></td>
        <td>1600</td>
    </tr>
    <tr>
        <td col="2"><strong><em>Память</em></strong></td>
    </tr>
    <tr>
        <td><strong>Общий объем оперативной памяти</strong></td>
        <td>10TB</td>
    </tr>
    <tr>
        <td><strong>Оперативная память на реплику</strong></td>
        <td>256GB</td>
    </tr>
    <tr>
        <td><strong>Соотношение оперативной памяти и vCPU</strong></td>
        <td>6 GB:1</td>
    </tr>
    <tr>
        <td><strong>Соотношение оперативной памяти и диска</strong></td>
        <td>1:60</td>
    </tr>
</table>



## Дополнительные материалы {#further-reading}

Ниже приведены опубликованные статьи об архитектурах компаний, использующих ClickHouse с открытым исходным кодом:

- [Cloudflare](https://blog.cloudflare.com/http-analytics-for-6m-requests-per-second-using-clickhouse/?utm_source=linkedin&utm_medium=social&utm_campaign=blog)
- [eBay](https://innovation.ebayinc.com/tech/engineering/ou-online-analytical-processing/)
- [GitLab](https://handbook.gitlab.com/handbook/engineering/development/ops/monitor/observability/#clickhouse-datastore)
- [Lyft](https://eng.lyft.com/druid-deprecation-and-clickhouse-adoption-at-lyft-120af37651fd)
- [MessageBird](https://clickhouse.com/blog/how-messagebird-uses-clickhouse-to-monitor-the-delivery-of-billions-of-messages)
- [Microsoft](https://clickhouse.com/blog/self-service-data-analytics-for-microsofts-biggest-web-properties)
- [Uber](https://www.uber.com/en-ES/blog/logging/)
- [Zomato](https://blog.zomato.com/building-a-cost-effective-logging-platform-using-clickhouse-for-petabyte-scale)
