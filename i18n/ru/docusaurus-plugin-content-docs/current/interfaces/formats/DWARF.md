---
alias: []
description: 'Документация по формату DWARF'
input_format: true
keywords: ['DWARF']
output_format: false
slug: /interfaces/formats/DWARF
title: 'DWARF'
doc_type: 'reference'
---

| Вход | Выход  | Псевдоним |
|-------|---------|-------|
| ✔     | ✗       |       |



## Описание {#description}

Формат `DWARF` разбирает отладочные символы DWARF из ELF‑файла (исполняемого файла, библиотеки или объектного файла). 
Он похож на `dwarfdump`, но гораздо быстрее (сотни МБ/с) и поддерживает SQL. 
Он формирует по одной строке для каждой записи Debug Information Entry (DIE) в секции `.debug_info` 
и включает «нулевые» записи, которые кодировка DWARF использует для завершения списков потомков в дереве.

:::info
`.debug_info` состоит из *юнитов*, которые соответствуют единицам компиляции: 
- Каждый юнит — это дерево *DIE* с корневой записью `compile_unit`. 
- Каждый DIE имеет *тег* и список *атрибутов*. 
- Каждый атрибут имеет *имя* и *значение* (а также *форму*, которая определяет, как значение закодировано). 

Записи DIE представляют сущности из исходного кода, и их *тег* указывает, что это за сущность. Например, есть:

- функции (tag = `subprogram`)
- классы/структуры/перечисления (`class_type`/`structure_type`/`enumeration_type`)
- переменные (`variable`)
- аргументы функций (`formal_parameter`).

Структура дерева отражает структуру соответствующего исходного кода. Например, DIE с тегом `class_type` может содержать DIE `subprogram`, представляющие методы класса.
:::

Формат `DWARF` выводит следующие столбцы:

- `offset` — позиция DIE в секции `.debug_info`
- `size` — количество байт в закодированном DIE (включая атрибуты)
- `tag` — тип DIE; общепринятый префикс `DW_TAG_` опущен
- `unit_name` — имя единицы компиляции, содержащей данный DIE
- `unit_offset` — позиция единицы компиляции, содержащей данный DIE, в секции `.debug_info`
- `ancestor_tags` — массив тегов предков текущего DIE в дереве, в порядке от самого внутреннего к самому внешнему
- `ancestor_offsets` — смещения предков, параллельные `ancestor_tags`
- несколько распространённых атрибутов, дублированных из массива атрибутов для удобства:
  - `name`
  - `linkage_name` — искажённое (mangled) полностью квалифицированное имя; обычно есть только у функций (и то не у всех)
  - `decl_file` — имя файла исходного кода, в котором была объявлена эта сущность
  - `decl_line` — номер строки в исходном коде, в которой была объявлена эта сущность
- параллельные массивы, описывающие атрибуты:
  - `attr_name` — имя атрибута; общепринятый префикс `DW_AT_` опущен
  - `attr_form` — то, как атрибут закодирован и интерпретируется; общепринятый префикс `DW_FORM_` опущен
  - `attr_int` — целочисленное значение атрибута; 0, если у атрибута нет числового значения
  - `attr_str` — строковое значение атрибута; пустая строка, если у атрибута нет строкового значения



## Пример использования

Формат `DWARF` можно использовать для поиска единиц компиляции, которые содержат наибольшее количество определений функций (включая инстанцирований шаблонов и функций из подключённых заголовочных файлов):

```sql title="Query"
SELECT
    unit_name,
    count() AS c
FROM file('programs/clickhouse', DWARF)
WHERE tag = 'subprogram' AND NOT has(attr_name, 'declaration')
GROUP BY unit_name
ORDER BY c DESC
LIMIT 3
```

```text title="Response"
┌─unit_name──────────────────────────────────────────────────┬─────c─┐
│ ./src/Core/Settings.cpp                                    │ 28939 │
│ ./src/AggregateFunctions/AggregateFunctionSumMap.cpp       │ 23327 │
│ ./src/AggregateFunctions/AggregateFunctionUniqCombined.cpp │ 22649 │
└────────────────────────────────────────────────────────────┴───────┘

3 строки в наборе. Затрачено: 1.487 сек. Обработано 139.76 миллиона строк, 1.12 ГБ (93.97 миллиона строк/с, 752.77 МБ/с.)
Пиковое использование памяти: 271.92 МиБ.
```


## Настройки формата {#format-settings}
