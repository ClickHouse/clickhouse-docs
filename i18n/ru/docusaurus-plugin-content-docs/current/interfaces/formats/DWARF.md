---
alias: []
description: 'Документация по формату DWARF'
input_format: true
keywords: ['DWARF']
output_format: false
slug: /interfaces/formats/DWARF
title: 'DWARF'
doc_type: 'reference'
---

| Входной | Выходной | Псевдоним |
|---------|----------|-----------|
| ✔       | ✗        |           |



## Описание {#description}

Формат `DWARF` выполняет разбор отладочных символов DWARF из файла ELF (исполняемого файла, библиотеки или объектного файла).
Он похож на `dwarfdump`, но работает значительно быстрее (сотни МБ/с) и поддерживает SQL.
Он создаёт одну строку для каждой записи отладочной информации (DIE) в секции `.debug_info`
и включает «null»-записи, которые кодировка DWARF использует для завершения списков дочерних элементов в дереве.

:::info
`.debug_info` состоит из _единиц_, которые соответствуют единицам компиляции:

- Каждая единица представляет собой дерево *DIE* с `compile_unit` DIE в качестве корня.
- Каждый DIE имеет _тег_ и список _атрибутов_.
- Каждый атрибут имеет _имя_ и _значение_ (а также _форму_, которая определяет способ кодирования значения).

DIE представляют элементы из исходного кода, а их _тег_ указывает тип элемента. Например, существуют:

- функции (тег = `subprogram`)
- классы/структуры/перечисления (`class_type`/`structure_type`/`enumeration_type`)
- переменные (`variable`)
- аргументы функций (`formal_parameter`).

Древовидная структура отражает соответствующий исходный код. Например, DIE `class_type` может содержать DIE `subprogram`, представляющие методы класса.
:::

Формат `DWARF` выводит следующие столбцы:

- `offset` — позиция DIE в секции `.debug_info`
- `size` — количество байтов в закодированном DIE (включая атрибуты)
- `tag` — тип DIE; общепринятый префикс «DW*TAG*» опущен
- `unit_name` — имя единицы компиляции, содержащей данный DIE
- `unit_offset` — позиция единицы компиляции, содержащей данный DIE, в секции `.debug_info`
- `ancestor_tags` — массив тегов предков текущего DIE в дереве, в порядке от самого внутреннего к самому внешнему
- `ancestor_offsets` — смещения предков, параллельно `ancestor_tags`
- несколько общих атрибутов, продублированных из массива атрибутов для удобства:
  - `name` — имя
  - `linkage_name` — искажённое полное квалифицированное имя; обычно присутствует только у функций (но не у всех функций)
  - `decl_file` — имя файла исходного кода, в котором была объявлена данная сущность
  - `decl_line` — номер строки в исходном коде, где была объявлена данная сущность
- параллельные массивы, описывающие атрибуты:
  - `attr_name` — имя атрибута; общепринятый префикс «DW*AT*» опущен
  - `attr_form` — способ кодирования и интерпретации атрибута; общепринятый префикс «DW*FORM*» опущен
  - `attr_int` — целочисленное значение атрибута; 0, если атрибут не имеет числового значения
  - `attr_str` — строковое значение атрибута; пусто, если атрибут не имеет строкового значения


## Пример использования {#example-usage}

Формат `DWARF` можно использовать для поиска единиц компиляции с наибольшим количеством определений функций (включая инстанцирование шаблонов и функции из включённых заголовочных файлов):

```sql title="Запрос"
SELECT
    unit_name,
    count() AS c
FROM file('programs/clickhouse', DWARF)
WHERE tag = 'subprogram' AND NOT has(attr_name, 'declaration')
GROUP BY unit_name
ORDER BY c DESC
LIMIT 3
```

```text title="Ответ"
┌─unit_name──────────────────────────────────────────────────┬─────c─┐
│ ./src/Core/Settings.cpp                                    │ 28939 │
│ ./src/AggregateFunctions/AggregateFunctionSumMap.cpp       │ 23327 │
│ ./src/AggregateFunctions/AggregateFunctionUniqCombined.cpp │ 22649 │
└────────────────────────────────────────────────────────────┴───────┘

Получено 3 строки. Затрачено: 1.487 сек. Обработано 139.76 млн строк, 1.12 ГБ (93.97 млн строк/сек., 752.77 МБ/сек.)
Пиковое использование памяти: 271.92 МиБ.
```


## Настройки формата {#format-settings}
