---
description: 'Список изменений за 2026 год'
note: 'Этот файл сгенерирован с помощью команды yarn build'
slug: /whats-new/changelog/
sidebar_position: -9998
sidebar_label: '2026'
title: 'Список изменений 2026'
doc_type: 'changelog'
---

### Релиз ClickHouse 26.1, 2026-01-29. [Презентация](https://presentations.clickhouse.com/2026-release-26.1/), [Видео](TODO) \{#261\}

#### Обратно несовместимое изменение \{#backward-incompatible-change\}

* Исправлено непоследовательное форматирование, вызванное некорректной подстановкой алиасов в форматтере. Это закрывает [#82833](https://github.com/ClickHouse/ClickHouse/issues/82833). Это закрывает [#82832](https://github.com/ClickHouse/ClickHouse/issues/82832). Это закрывает [#68296](https://github.com/ClickHouse/ClickHouse/issues/68296). Это изменение потенциально несовместимо с предыдущими версиями: когда анализатор отключен, некоторые запросы CREATE VIEW с оператором IN, ссылающимся на алиас, не могут быть обработаны. Чтобы избежать несовместимости, включите анализатор (по умолчанию он включен, начиная с 24.3). [#82838](https://github.com/ClickHouse/ClickHouse/pull/82838) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Кодеки `DEFLATE_QPL` и `ZSTD_QAT` были удалены. Пользователям рекомендуется преобразовать существующие данные, сжатые с помощью `DEFLATE_QPL` или `ZSTD_QAT`, в другой кодек перед обновлением. Обратите внимание, что для использования этих кодеков необходимо было включить настройки `enable_deflate_qpl_codec` и `enable_zstd_qat_codec`. [#92150](https://github.com/ClickHouse/ClickHouse/pull/92150) ([Robert Schulze](https://github.com/rschu1ze)).
* Улучшена отладка UDF за счёт включения перехвата stderr в `system.query_log.exception`. Ранее stderr UDF записывался только в файлы и не был доступен в журналах запросов, что делало отладку невозможной. Теперь stderr по умолчанию вызывает исключения и полностью накапливается (до 1 МБ) перед их выбрасыванием, поэтому полные трассировки стека Python и сообщения об ошибках отображаются в `system.query_log.exception` для эффективного устранения неполадок. [#92209](https://github.com/ClickHouse/ClickHouse/pull/92209) ([Xu Jia](https://github.com/XuJia0210)).
* Пустой список столбцов в предложении `JOIN USING ()` теперь считается синтаксической ошибкой. Ранее предполагалось, что это приведёт к `INVALID_JOIN_ON_EXPRESSION` во время выполнения запроса. В некоторых случаях, например при соединении с хранилищем `Join`, это приводило к `LOGICAL_ERROR`, закрыта задача [#82502](https://github.com/ClickHouse/ClickHouse/issues/82502). [#92371](https://github.com/ClickHouse/ClickHouse/pull/92371) ([Vladimir Cherkasov](https://github.com/vdimir)).
* По умолчанию использовать частичное совпадение для оператора SKIP REGEXP в типе JSON. Закрывает [#79250](https://github.com/ClickHouse/ClickHouse/issues/79250). [#92847](https://github.com/ClickHouse/ClickHouse/pull/92847) ([Pavel Kruglov](https://github.com/Avogar)).
* Откатить изменение &quot;Allow INSERT into simple ALIAS columns&quot; (откат ClickHouse/ClickHouse[#84154](https://github.com/ClickHouse/ClickHouse/issues/84154)). Оно не работает с пользовательскими форматами и не управляется настройкой. [#92849](https://github.com/ClickHouse/ClickHouse/pull/92849) ([Azat Khuzhin](https://github.com/azat)).
* Настройка, при которой выбрасывается ошибка, если у каталога озера данных нет доступа к объектному хранилищу. [#93606](https://github.com/ClickHouse/ClickHouse/pull/93606) ([Konstantin Vedernikov](https://github.com/scanhex12)).
* Движок базы данных `Lazy` удалён и больше недоступен, что закрывает задачу [#91231](https://github.com/ClickHouse/ClickHouse/issues/91231). [#93627](https://github.com/ClickHouse/ClickHouse/pull/93627) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Удалён режим `transposed_with_wide_view` для `metric_log` — он неработоспособен из‑за ошибки. Теперь невозможно определять `system.metric_log` с этим режимом. Это частично отменяет [#78412](https://github.com/ClickHouse/ClickHouse/issues/78412). [#93867](https://github.com/ClickHouse/ClickHouse/pull/93867) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Планирование CPU для рабочих нагрузок теперь по умолчанию является вытесняющим. См. серверную настройку `cpu_slot_preemption`. [#94060](https://github.com/ClickHouse/ClickHouse/pull/94060) ([Sergei Trifonov](https://github.com/serxa)).
* Экранируйте имена файлов индексов, чтобы предотвратить повреждение частей. После этого изменения ClickHouse не сможет загрузить индексы с не-ASCII-символами в их именах, созданные предыдущими версиями. Для обработки таких случаев вы можете использовать настройку MergeTree `escape_index_filenames`. [#94079](https://github.com/ClickHouse/ClickHouse/pull/94079) ([Raúl Marín](https://github.com/Algunenano)).
* Настройки формата `exact_rows_before_limit`, `rows_before_aggregation`, `cross_to_inner_join_rewrite`, `regexp_dict_allow_hyperscan`, `regexp_dict_flag_case_insensitive`, `regexp_dict_flag_dotall` и `dictionary_use_async_executor` теперь стали обычными (не форматными) настройками. Это сугубо внутреннее изменение без видимых для пользователя побочных эффектов, за исключением (маловероятного) случая, когда вы указывали любую из этих настроек в определениях таблиц с движками Iceberg, DeltaLake, Kafka, S3, S3Queue, Azure, Hive, RabbitMQ, Set, FileLog или NATS. В таких случаях ранее эти настройки игнорировались, теперь такие определения приводят к ошибке. [#94106](https://github.com/ClickHouse/ClickHouse/pull/94106) ([Robert Schulze](https://github.com/rschu1ze)).
* Функции `joinGet/joinGetOrNull` теперь проверяют привилегии `SELECT` для исходной таблицы Join. После этого изменения вызов `joinGet('db.table', 'column', key)` требует, чтобы у пользователя была привилегия `SELECT` как на столбцы ключа, определённые в таблице Join, так и на столбец атрибута, который извлекается. Запросы без этих привилегий будут завершаться ошибкой `ACCESS_DENIED`. Для миграции выдайте необходимые разрешения с помощью `GRANT SELECT ON db.join_table TO user` для доступа ко всей таблице или `GRANT SELECT(key_col, attr_col) ON db.join_table TO user` для доступа на уровне столбцов. Это изменение затрагивает всех пользователей и приложения, использующие `joinGet`/`joinGetOrNull`, для которых ранее не были явно настроены привилегии `SELECT`. [#94307](https://github.com/ClickHouse/ClickHouse/pull/94307) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Теперь для запросов `CREATE TABLE ... AS ...` используется проверка `SHOW COLUMNS`. Ранее использовалась проверка `SHOW TABLES`, что требовало некорректной привилегии для такого типа проверки прав. [#94556](https://github.com/ClickHouse/ClickHouse/pull/94556) ([pufit](https://github.com/pufit)).
* Формат вывода `Hash` сделан независимым от размеров блоков. [#94503](https://github.com/ClickHouse/ClickHouse/pull/94503) ([Alexey Milovidov](https://github.com/alexey-milovidov)). Обратите внимание, что это изменит значения выходных хэшей по сравнению с предыдущими версиями.

#### Новая возможность \{#new-feature\}

* HTTP API и встроенный веб-интерфейс для ClickHouse Keeper. [#78181](https://github.com/ClickHouse/ClickHouse/pull/78181) ([pufit](https://github.com/pufit)).
* Дедупликация асинхронных вставок теперь работает с зависимыми materialized view. Когда происходит коллизия по block&#95;id, исходный блок фильтруется для удаления строк, связанных с этим block&#95;id, а оставшиеся строки преобразуются всеми соответствующими запросами SELECT из materialized view, в результате исходный блок перестраивается без конфликтующих строк. [#89140](https://github.com/ClickHouse/ClickHouse/pull/89140) ([Sema Checherinda](https://github.com/CheSema)). Теперь допускается использовать дедупликацию с асинхронными вставками, когда задействованы materialized view. [#93957](https://github.com/ClickHouse/ClickHouse/pull/93957) ([Sema Checherinda](https://github.com/CheSema)).
* Представлены новый синтаксис и фреймворк для упрощения и расширения возможностей индексов проекций. Это продолжение https://github.com/ClickHouse/ClickHouse/pull/81021. [#91844](https://github.com/ClickHouse/ClickHouse/pull/91844) ([Amos Bird](https://github.com/amosbird)).
* Добавлена поддержка текстового индекса для столбцов `Array`. [#89895](https://github.com/ClickHouse/ClickHouse/pull/89895) ([Jimmy Aguilar Mena](https://github.com/Ergus)).
* По умолчанию включена `use_variant_as_common_type`, что позволяет использовать несовместимые типы внутри `Array`, в запросах `UNION`, а также в ветвях `if`/`multiIf`/`case`. [#90677](https://github.com/ClickHouse/ClickHouse/pull/90677) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Новая системная таблица `zookeeper_info`. Реализует [#88014](https://github.com/ClickHouse/ClickHouse/issues/88014). [#90809](https://github.com/ClickHouse/ClickHouse/pull/90809) ([Smita Kulkarni](https://github.com/SmitaRKulkarni)).
* Добавлена поддержка типа `Variant` во всех функциях. [#90900](https://github.com/ClickHouse/ClickHouse/pull/90900) ([Bharat Nallan](https://github.com/bharatnc)).
* Добавляет метрику `ClickHouse_Info` в эндпоинт Prometheus `/metrics`, содержащую прежде всего информацию о версии, что позволяет строить графики, отслеживающие подробную информацию об изменении версий во времени. [#91125](https://github.com/ClickHouse/ClickHouse/pull/91125) ([Christoph Wurm](https://github.com/cwurm)).
* Введена новая четырехсимвольная команда `rcfg` для keeper, которая позволяет изменять конфигурацию кластера. Эта команда предоставляет более широкие возможности для изменения конфигурации, чем стандартный запрос `reconfigure`. Команда принимает `JSON`-строку в качестве аргумента. Весь набор байт, отправляемый в TCP-интерфейс, должен выглядеть так: `rcfg{json_string_length_big_endian}{json_string}`. Некоторые примеры использования команды могут выглядеть следующим образом: `{"preconditions": {"leaders": [1, 2], "members": [1, 2, 3, 4, 5]}, "actions": [{"transfer_leadership": [3]}, {"remove_members": [1, 2]}, {"set_priority": [{"id": 4, "priority": 100}, {"id": 5, "priority": 100}]}, {"transfer_leadership": [4, 5]}, {"set_priority": [{"id": 3, "priority": 0}]}]}`. [#91354](https://github.com/ClickHouse/ClickHouse/pull/91354) ([alesapin](https://github.com/alesapin)).
* Добавлена функция `reverseBySeparator`, которая обращает порядок подстрок в строке, разделённых указанным разделителем. Закрывает [#91463](https://github.com/ClickHouse/ClickHouse/issues/91463). [#91780](https://github.com/ClickHouse/ClickHouse/pull/91780) ([Xuewei Wang](https://github.com/Sallery-X)).
* Добавляет новую настройку `max_insert_block_size_bytes`, которая позволяет более тонко контролировать формирование вставляемых блоков. [#92833](https://github.com/ClickHouse/ClickHouse/pull/92833) ([Kirill Kopnev](https://github.com/Fgrtue)).
* Можно выполнять DDL‑запросы с указанием `ON CLUSTER` для реплицируемой базы данных, если включена настройка `ignore_on_cluster_for_replicated_database`. В этом случае имя кластера будет игнорироваться. [#92872](https://github.com/ClickHouse/ClickHouse/pull/92872) ([Kirill](https://github.com/kirillgarbar)).
* Реализована функция `mergeTreeAnalyzeIndex`. [#92954](https://github.com/ClickHouse/ClickHouse/pull/92954) ([Azat Khuzhin](https://github.com/azat)).
* Добавлена новая настройка `use_primary_key`. Установите значение `false`, чтобы отключить отсечение гранул по первичному ключу. [#93319](https://github.com/ClickHouse/ClickHouse/pull/93319) ([Nihal Z. Miaji](https://github.com/nihalzp)).
* Добавлена табличная функция `icebergLocalCluster`. [#93323](https://github.com/ClickHouse/ClickHouse/pull/93323) ([Anton Ivashkin](https://github.com/ianton-ru)).
* Добавлена функция `cosineDistanceTransposed`, которая приближённо вычисляет [косинусное расстояние](https://en.wikipedia.org/wiki/Cosine_similarity#Cosine_distance) между двумя точками. [#93621](https://github.com/ClickHouse/ClickHouse/pull/93621) ([Raufs Dunamalijevs](https://github.com/rienath)).
* Добавлен столбец `files` в таблицу system.parts, показывающий количество файлов в каждой части данных. [#94337](https://github.com/ClickHouse/ClickHouse/pull/94337) ([Match](https://github.com/gayanMatch)).
* Добавляет планировщик max-min fair для управления параллелизмом. Обеспечивает более высокую справедливость при сильной переподписке (oversubscription), когда множество запросов конкурируют за ограниченное число CPU-слотов. Кратковременные запросы не страдают из‑за долгих запросов, которые со временем накопили больше слотов. Включается с помощью серверной настройки `concurrent_threads_scheduler` со значением `max_min_fair`. [#94732](https://github.com/ClickHouse/ClickHouse/pull/94732) ([Sergei Trifonov](https://github.com/serxa)).
* Добавлена возможность клиенту ClickHouse переопределять TLS SNI при подключении к серверу. [#89761](https://github.com/ClickHouse/ClickHouse/pull/89761) ([Matt Klein](https://github.com/mattklein123)).
* Добавлена поддержка временных таблиц в вызовах функции `joinGet`. [#92973](https://github.com/ClickHouse/ClickHouse/pull/92973) ([Eduard Karacharov](https://github.com/korowa)).
* Добавлена поддержка векторов удаления в движке таблиц `DeltaLake`. [#93852](https://github.com/ClickHouse/ClickHouse/pull/93852) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Добавлена поддержка векторов удаления в deltaLakeCluster. [#94365](https://github.com/ClickHouse/ClickHouse/pull/94365) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Поддержка Google Cloud Storage для озёр данных. [#93866](https://github.com/ClickHouse/ClickHouse/pull/93866) ([Konstantin Vedernikov](https://github.com/scanhex12)).

#### Экспериментальные возможности \{#experimental-feature\}

* Перенести `QBit` из Experimental в Beta. [#93816](https://github.com/ClickHouse/ClickHouse/pull/93816) ([Raufs Dunamalijevs](https://github.com/rienath)).
* Добавить поддержку `Nullable(Tuple)`. Установите `allow_experimental_nullable_tuple_type = 1`, чтобы включить её. [#89643](https://github.com/ClickHouse/ClickHouse/pull/89643) ([Nihal Z. Miaji](https://github.com/nihalzp)).
* Добавить поддержку каталога Paimon REST, в продолжение https://github.com/ClickHouse/ClickHouse/pull/84423. [#92011](https://github.com/ClickHouse/ClickHouse/pull/92011) ([JIaQi Tang](https://github.com/JiaQiTang98)).

#### Повышение производительности \{#performance-improvement\}

* Параметр `use_skip_indexes_on_data_read` теперь по умолчанию включён. Эта настройка позволяет выполнять фильтрацию в потоковом режиме одновременно с чтением данных, улучшая производительность запросов и время их запуска. [#93407](https://github.com/ClickHouse/ClickHouse/pull/93407) ([Shankar Iyer](https://github.com/shankar-iyer)).
* PREWHERE для Datalakes и многостадийный PREWHERE в Parquet Reader v3. Resolves [#89101](https://github.com/ClickHouse/ClickHouse/issues/89101). [#93542](https://github.com/ClickHouse/ClickHouse/pull/93542) ([Konstantin Vedernikov](https://github.com/scanhex12)).
* Повышена производительность `DISTINCT` на столбцах с типом `LowCardinality`. Закрывает [#5917](https://github.com/ClickHouse/ClickHouse/issues/5917). [#91639](https://github.com/ClickHouse/ClickHouse/pull/91639) ([Nihal Z. Miaji](https://github.com/nihalzp)).
* Optimize `distinctJSONPaths` aggregate function so it reads only JSON paths from data parts and not the whole JSON column. [#92196](https://github.com/ClickHouse/ClickHouse/pull/92196) ([Pavel Kruglov](https://github.com/Avogar)).
* More filters pushed down JOINs. [#85556](https://github.com/ClickHouse/ClickHouse/pull/85556) ([Nikita Taranov](https://github.com/nickitat)).
* Расширена поддержка проталкивания фильтров из условия `ON` оператора `JOIN`, когда фильтр использует данные только с одной стороны. Добавлена поддержка соединений типов `ANY`, `SEMI`, `ANTI`. [#92584](https://github.com/ClickHouse/ClickHouse/pull/92584) ([Dmitry Novik](https://github.com/novikd)).
* Разрешить использование эквивалентных множеств для проталкивания фильтров для `SEMI JOIN`. Закрывает [#85239](https://github.com/ClickHouse/ClickHouse/issues/85239). [#92837](https://github.com/ClickHouse/ClickHouse/pull/92837) ([Dmitry Novik](https://github.com/novikd)).
* Пропускаем чтение левой стороны хэш-соединения, когда правая сторона пуста. Ранее левая сторона читалась до первого непустого блока, что могло приводить к значительным затратам при сильной фильтрации или агрегации. [#94062](https://github.com/ClickHouse/ClickHouse/pull/94062) ([Alexander Gololobov](https://github.com/davenger)).
* Использование метода «fastrange» (Daniel Lemire) для партиционирования данных внутри конвейера запроса. Это может улучшить параллельную сортировку и операции JOIN. [#93080](https://github.com/ClickHouse/ClickHouse/pull/93080) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Улучшена производительность оконных функций, когда PARTITION BY совпадает с ключом сортировки или является его префиксом. [#87299](https://github.com/ClickHouse/ClickHouse/pull/87299) ([Nikita Taranov](https://github.com/nickitat)).
* Внешний фильтр проталкивается в представления, что позволяет применять PREWHERE на локальных и удалённых узлах. Resolves [#88189](https://github.com/ClickHouse/ClickHouse/issues/88189). [#88316](https://github.com/ClickHouse/ClickHouse/pull/88316) ([Igor Nikonov](https://github.com/devcrafter)).
* Implement JIT compilations for more functions. Closes [#73509](https://github.com/ClickHouse/ClickHouse/issues/73509). [#88770](https://github.com/ClickHouse/ClickHouse/pull/88770) ([Alexey Milovidov](https://github.com/alexey-milovidov) with [Taiyang Li](https://github.com/taiyang-li)).
* If a skip index used in a `FINAL` query is on a column that is part of the primary key, the additional step to check for primary key intersection in other parts is unnecessary and now not performed. Resolves [#85897](https://github.com/ClickHouse/ClickHouse/issues/85897). [#93899](https://github.com/ClickHouse/ClickHouse/pull/93899) ([Shankar Iyer](https://github.com/shankar-iyer)).
* Optimize performance and memory usage for fractional `LIMIT` and `OFFSET`. [#91167](https://github.com/ClickHouse/ClickHouse/pull/91167) ([Ahmed Gouda](https://github.com/0xgouda)).
* Исправлено использование более быстрой логики произвольного чтения для префетчера Parquet Reader V3. Closes [#90890](https://github.com/ClickHouse/ClickHouse/issues/90890). [#91435](https://github.com/ClickHouse/ClickHouse/pull/91435) ([Arsen Muk](https://github.com/arsenmuk)).
* Improve performance of `icebergCluster`. Closes [#91462](https://github.com/ClickHouse/ClickHouse/issues/91462). [#91537](https://github.com/ClickHouse/ClickHouse/pull/91537) ([Yang Jiang](https://github.com/Ted-Jiang)).
* Don&#39;t filter by virtual columns on constant filters. [#91588](https://github.com/ClickHouse/ClickHouse/pull/91588) ([c-end](https://github.com/c-end)).
* Reduce INSERT/merges memory usage with wide parts for very wide tables by enabling adaptive write buffers. Add support of adaptive write buffers for encrypted disks. [#92250](https://github.com/ClickHouse/ClickHouse/pull/92250) ([Azat Khuzhin](https://github.com/azat)).
* Improved performance of full text search with text index and `sparseGrams` tokenizer by reducing the number of searched tokens in the index. [#93078](https://github.com/ClickHouse/ClickHouse/pull/93078) ([Anton Popov](https://github.com/CurtizJ)).
* Функция `isValidASCII` была оптимизирована под положительный сценарий, то есть для входных значений, полностью состоящих из символов ASCII. [#93347](https://github.com/ClickHouse/ClickHouse/pull/93347) ([Robert Schulze](https://github.com/rschu1ze)).
* The read-in-order optimization now recognizes when ORDER BY columns are constant due to WHERE conditions, enabling efficient reverse-order reads. This benefits multi-tenant queries like `WHERE tenant='42' ORDER BY tenant, event_time DESC` which can now use InReverseOrder instead of requiring a full sort.&quot;. [#94103](https://github.com/ClickHouse/ClickHouse/pull/94103) ([matanper](https://github.com/matanper)).
* Добавлен специализированный класс Enum AST для хранения параметров значений в виде пар (строка, целое число) вместо дочерних ASTLiteral для оптимизации потребления памяти. [#94178](https://github.com/ClickHouse/ClickHouse/pull/94178) ([Ilya Yatsishin](https://github.com/qoega)).
* Distributed index analysis on multiple replicas. Beneficial for shared storage and huge amount of data in cluster. This is applicable for SharedMergeTree (ClickHouse Cloud) and could be applicable for other types of MergeTree tables on a shared storage. [#86786](https://github.com/ClickHouse/ClickHouse/pull/86786) ([Azat Khuzhin](https://github.com/azat)).
* Reduce overhead of join runtime filters by disabling them in the following cases: - too many bits are set in the bloom filter - too few rows are filtered out at runtime. [#91578](https://github.com/ClickHouse/ClickHouse/pull/91578) ([Alexander Gololobov](https://github.com/davenger)).
* Используйте буфер в памяти для входных данных коррелированных подзапросов, чтобы избежать их повторного вычисления. Часть [#79890](https://github.com/ClickHouse/ClickHouse/issues/79890). [#91205](https://github.com/ClickHouse/ClickHouse/pull/91205) ([Dmitry Novik](https://github.com/novikd)).
* Allow all replicas to steal orphaned ranges in parallel replicas reading. This improves load balancing and reduces long-tail latency. [#91374](https://github.com/ClickHouse/ClickHouse/pull/91374) ([zoomxi](https://github.com/zoomxi)).
* External aggregation/sorting/join now respects query setting `temporary_files_codec` in all contexts. Fixed missing profile events for grace hash join. [#92388](https://github.com/ClickHouse/ClickHouse/pull/92388) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Make query memory usage detection for spilling to disk during aggregation/sorting more robust. [#92500](https://github.com/ClickHouse/ClickHouse/pull/92500) ([Azat Khuzhin](https://github.com/azat)).
* Estimate total rows count and NDV (number of distinct values) statistics of aggregation key columns. [#92812](https://github.com/ClickHouse/ClickHouse/pull/92812) ([Alexander Gololobov](https://github.com/davenger)).
* Оптимизировано сжатие списков постингов с помощью simdcomp. [#92871](https://github.com/ClickHouse/ClickHouse/pull/92871) ([Peng Jian](https://github.com/fastio)).
* Refactor S3Queue Ordered mode processing with buckets. This should also improve performance, reducing the number of keeper requests. [#92889](https://github.com/ClickHouse/ClickHouse/pull/92889) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Functions `mapContainsKeyLike` and `mapContainsValueLike` can now leverage a text index on `mapKeys()` or `mapValues()`, respectively. [#93049](https://github.com/ClickHouse/ClickHouse/pull/93049) ([Michael Jarrett](https://github.com/EmeraldShift)).
* Reduce memory usage on non-Linux systems (enable immediate purging of jemalloc dirty pages). [#93360](https://github.com/ClickHouse/ClickHouse/pull/93360) ([Eduard Karacharov](https://github.com/korowa)).
* Принудительно очищать арены jemalloc, если отношение размера «грязных» страниц к `max_server_memory_usage` превышает `memory_worker_purge_dirty_pages_threshold_ratio`. [#93500](https://github.com/ClickHouse/ClickHouse/pull/93500) ([Eduard Karacharov](https://github.com/korowa)).
* Снижено потребление памяти для AST. [#93601](https://github.com/ClickHouse/ClickHouse/pull/93601) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* В некоторых случаях мы наблюдали, что ClickHouse не соблюдает ограничение по памяти при чтении из таблицы. Это поведение исправлено. [#93715](https://github.com/ClickHouse/ClickHouse/pull/93715) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* По умолчанию включено расширение Keeper `CHECK_STAT` и `TRY_REMOVE`. [#93886](https://github.com/ClickHouse/ClickHouse/pull/93886) ([Mikhail Artemenko](https://github.com/Michicosun)).
* Разбирать нижнюю и верхнюю границы имён файлов, соответствующих position deletes, из записей манифеста Iceberg для более точного выбора соответствующих файлов данных. [#93980](https://github.com/ClickHouse/ClickHouse/pull/93980) ([Daniil Ivanik](https://github.com/divanik)).
* Добавлены ещё две настройки для управления максимальным количеством динамических подстолбцов в столбце JSON. Первая — настройка MergeTree `merge_max_dynamic_subcolumns_in_compact_part` (аналогично уже добавленной `merge_max_dynamic_subcolumns_in_wide_part`), которая ограничивает количество динамических подстолбцов, создаваемых при слиянии в компактную часть. Вторая — настройка на уровне запроса `max_dynamic_subcolumns_in_json_type_parsing`, которая ограничивает количество динамических подстолбцов, создаваемых при разборе данных JSON; она позволяет задать этот лимит при вставке. [#94184](https://github.com/ClickHouse/ClickHouse/pull/94184) ([Pavel Kruglov](https://github.com/Avogar)).
* Незначительно оптимизировано уплотнение JSON-столбцов для отдельных случаев. [#94247](https://github.com/ClickHouse/ClickHouse/pull/94247) ([Pavel Kruglov](https://github.com/Avogar)).
* Уменьшите размер очередей пула потоков на основе опыта эксплуатации. Добавьте явную проверку потребления памяти перед чтением любых данных из MergeTree. [#94692](https://github.com/ClickHouse/ClickHouse/pull/94692) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Make sure the scheduler would prefer MemoryWorker thread under the CPU starvation, because it protects ClickHouse process from an existential threat. [#94864](https://github.com/ClickHouse/ClickHouse/pull/94864) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Run purging of jemalloc dirty pages in a different thread from main thread of MemoryWorker. If purging is slow, it could delay updates of RSS usage which could lead to out of memory kills of the process. Introduce new config `memory_worker_purge_total_memory_threshold_ratio` to start purging dirty pages based on ratio of total memory usage. [#94902](https://github.com/ClickHouse/ClickHouse/pull/94902) ([Antonio Andelic](https://github.com/antonio2368)).

#### Улучшение \{#improvement\}

* Таблица `system.blob_storage_log` теперь доступна для Azure Blob Storage. [#93105](https://github.com/ClickHouse/ClickHouse/pull/93105) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Реализован `blob_storage_log` для Local и HDFS. Исправлена ошибка, из‑за которой `S3Queue` при логировании в `blob_storage_log` использовал не имя диска. Добавлен столбец `error_code` в `blob_storage_log`. Тестовый конфигурационный файл разделён для упрощения локального тестирования. [#93106](https://github.com/ClickHouse/ClickHouse/pull/93106) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `clickhouse-client` и `clickhouse-local` будут подсвечивать группы разрядов (тысячи, миллионы и т. д.) внутри числовых литералов при вводе. Это закрывает [#93100](https://github.com/ClickHouse/ClickHouse/issues/93100). [#93108](https://github.com/ClickHouse/ClickHouse/pull/93108) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* В `clickhouse-client` добавлена поддержка аргументов командной строки с пробелами вокруг знака равенства. Закрывает [#93077](https://github.com/ClickHouse/ClickHouse/issues/93077). [#93174](https://github.com/ClickHouse/ClickHouse/pull/93174) ([Cole Smith](https://github.com/colesmith54)).
* С параметром `<interactive_history_legacy_keymap>true</interactive_history_legacy_keymap>` CLI-клиент теперь снова использует Ctrl-R для обычного поиска, как и раньше, а Ctrl-T выполняет нечёткий поиск. [#87785](https://github.com/ClickHouse/ClickHouse/pull/87785) ([Larry Snizek](https://github.com/larry-cdn77)).
* Оператор очистки кэшей `SYSTEM DROP [...] CACHE` создавал ложное впечатление, что он отключает кэш. В ClickHouse теперь поддерживается оператор `SYSTEM CLEAR [...] CACHE`, назначение которого более очевидно. Старый синтаксис по-прежнему доступен. [#93727](https://github.com/ClickHouse/ClickHouse/pull/93727) ([Pranav Tiwari](https://github.com/pranavt84)).
* Добавлена поддержка использования нескольких столбцов в качестве первичного ключа в `EmbeddedRocksDB`. Закрывает [#32819](https://github.com/ClickHouse/ClickHouse/issues/32819). [#33917](https://github.com/ClickHouse/ClickHouse/pull/33917) ([usurai](https://github.com/usurai)).
* Теперь можно использовать неконстантный оператор IN для скаляров (запросы вида `val1 NOT IN if(cond, val2, val3)`). [#93495](https://github.com/ClickHouse/ClickHouse/pull/93495) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Не передавать заголовки `x-amz-server-side-encryption` в S3‑запросы `HeadObject`, `UploadPart` и `CompleteMultipartUpload`, поскольку они в этих запросах не поддерживаются. [#64577](https://github.com/ClickHouse/ClickHouse/pull/64577) ([Francisco J. Jurado Moreno](https://github.com/Beetelbrox)).
* Добавлен синтаксис `ALTER TABLE <table> ATTACH PART <part_name> FROM <directory_name>` для запроса `ALTER`. Он позволяет присоединять части из произвольного подкаталога в каталоге `detached/`. Это может быть полезно для присоединения частей с пользовательскими префиксами (такими как `broken-on-start`, `unexpected` и т. д.), которые были отсоединены по ошибке и которые нужно только присоединить обратно без ручного вмешательства. Ранее требовалось ручное переименование каталогов в файловой системе. [#74816](https://github.com/ClickHouse/ClickHouse/pull/74816) ([Anton Popov](https://github.com/CurtizJ)).
* Отслеживание разбиения Hive на партиции для упорядоченного режима в S3Queue. Устраняет [#71161](https://github.com/ClickHouse/ClickHouse/issues/71161). [#81040](https://github.com/ClickHouse/ClickHouse/pull/81040) ([Anton Ivashkin](https://github.com/ianton-ru)).
* Оптимизировано резервирование пространства в файловом кэше. `FileCache::collectCandidatesForEviction` будет выполняться без уникальной блокировки. [#82764](https://github.com/ClickHouse/ClickHouse/pull/82764) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Добавлена поддержка составной стратегии ротации (по размеру и времени) для серверного журнала. [#87620](https://github.com/ClickHouse/ClickHouse/pull/87620) ([Jianmei Zhang](https://github.com/zhangjmruc)).
* CLI-клиент теперь может задавать `<warnings>false</warnings>` вместо параметра командной строки `--no-warnings`. [#87783](https://github.com/ClickHouse/ClickHouse/pull/87783) ([Larry Snizek](https://github.com/larry-cdn77)).
* Добавлена поддержка агрегатной функции `avg` для аргументов типов Date, DateTime и Time. Закрывает [#82267](https://github.com/ClickHouse/ClickHouse/issues/82267). [#87845](https://github.com/ClickHouse/ClickHouse/pull/87845) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Оптимизация `use_join_disjunctions_push_down` включена по умолчанию. [#89313](https://github.com/ClickHouse/ClickHouse/pull/89313) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Добавлена поддержка большего количества движков таблиц и типов источников данных в коррелированных подзапросах. Закрывает [#80775](https://github.com/ClickHouse/ClickHouse/issues/80775). [#90175](https://github.com/ClickHouse/ClickHouse/pull/90175) ([Dmitry Novik](https://github.com/novikd)).
* Если схема параметризованного представления задана явно, она отображается. Закрыты [#88875](https://github.com/ClickHouse/ClickHouse/issues/88875), [#81385](https://github.com/ClickHouse/ClickHouse/issues/81385). [#90220](https://github.com/ClickHouse/ClickHouse/pull/90220) ([Grigorii Sokolik](https://github.com/GSokol)).
* Корректно обрабатывать разрыв в записях журнала Keeper, если эти записи предшествуют последнему зафиксированному индексу. [#90403](https://github.com/ClickHouse/ClickHouse/pull/90403) ([Antonio Andelic](https://github.com/antonio2368)).
* Улучшена настройка `min_free_disk_bytes_to_perform_insert`, чтобы она корректно работала с JBOD-томами. [#90878](https://github.com/ClickHouse/ClickHouse/pull/90878) ([Aleksandr Musorin](https://github.com/AVMusorin)).
* Реализована возможность указывать настройку `storage_class_name` в именованных коллекциях для движка таблицы `S3` и табличной функции `s3`. [#91926](https://github.com/ClickHouse/ClickHouse/pull/91926) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* Добавлена поддержка добавления вспомогательного zookeeper через `system.zookeeper`. [#92092](https://github.com/ClickHouse/ClickHouse/pull/92092) ([RinChanNOW](https://github.com/RinChanNOWWW)).
* Добавлены новые метрики для Keeper: профильные события `KeeperChangelogWrittenBytes`, `KeeperChangelogFileSyncMicroseconds`, `KeeperSnapshotWrittenBytes` и `KeeperSnapshotFileSyncMicroseconds`, а также метрики-гистограммы `KeeperBatchSizeElements` и `KeeperBatchSizeBytes`. [#92149](https://github.com/ClickHouse/ClickHouse/pull/92149) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* Добавлена новая настройка `trace_profile_events_list`, которая ограничивает трассировку `trace_profile_event` указанным списком имён событий. Это позволяет более точно собирать данные при больших нагрузках. [#92298](https://github.com/ClickHouse/ClickHouse/pull/92298) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Улучшение
* Добавить столбец `creation` (неявный/явный) в `system.data_skipping_indices`. [#92378](https://github.com/ClickHouse/ClickHouse/pull/92378) ([Raúl Marín](https://github.com/Algunenano)).
* Добавлена возможность передавать описание столбцов для динамических таблиц YTsaurus в источник словаря. [#92391](https://github.com/ClickHouse/ClickHouse/pull/92391) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* В [#63985](https://github.com/ClickHouse/ClickHouse/pull/63985) мы добавили возможность задавать все параметры, необходимые для конфигурации TLS, отдельно для каждого порта (см. [composable protocols](https://clickhouse.com/docs/operations/settings/composable-protocols)), так что больше не нужно полагаться на глобальную конфигурацию TLS. Однако реализация по-прежнему неявно требует наличия глобального конфигурационного раздела `openSSL.server`, что конфликтует со сценариями, где для разных портов нужны разные настройки TLS. Например, в развертываниях keeper-in-server нам требуются отдельные конфигурации TLS для взаимодействия между экземплярами Keeper и подключений клиентов ClickHouse. [#92457](https://github.com/ClickHouse/ClickHouse/pull/92457) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* Добавлена новая настройка `input_format_binary_max_type_complexity`, которая ограничивает общее количество узлов типов данных, декодируемых в бинарном формате, для защиты от вредоносных нагрузок. [#92519](https://github.com/ClickHouse/ClickHouse/pull/92519) ([Raufs Dunamalijevs](https://github.com/rienath)).
* Отображать выполняющиеся задачи в `system.background_schedule_pool{,_log}`. Добавлена документация. [#92587](https://github.com/ClickHouse/ClickHouse/pull/92587) ([Azat Khuzhin](https://github.com/azat)).
* Выполнять текущий запрос при поиске по Ctrl+R в клиенте, если в истории не найдено совпадений. [#92749](https://github.com/ClickHouse/ClickHouse/pull/92749) ([Azat Khuzhin](https://github.com/azat)).
* Добавлена поддержка `EXPLAIN indices = 1` в качестве псевдонима для `EXPLAIN indexes = 1`. Закрывает [#92483](https://github.com/ClickHouse/ClickHouse/issues/92483). [#92774](https://github.com/ClickHouse/ClickHouse/pull/92774) ([Pranav Tiwari](https://github.com/pranavt84)).
* Ридер Parquet теперь позволяет читать столбцы типа Tuple или Map как JSON: `select x from file(f.parquet, auto, 'x JSON')` работает, даже если тип столбца `x` в `f.parquet` — tuple или map. [#92864](https://github.com/ClickHouse/ClickHouse/pull/92864) ([Michael Kolupaev](https://github.com/al13n321)).
* Добавлена поддержка пустых кортежей в ридере Parquet. [#92868](https://github.com/ClickHouse/ClickHouse/pull/92868) ([Michael Kolupaev](https://github.com/al13n321)).
* Переход на копирование с чтением и записью для Azure Blob Storage при сбое встроенного копирования с ошибкой BadRequest (например, недопустимый список блоков). Ранее это выполнялось только при ошибке Unauthorized, которая наблюдалась при копировании BLOB-объекта в другие учетные записи хранения. Но иногда мы также видим ошибку &quot;The specified block list is invalid&quot;. Поэтому условие было обновлено, чтобы выполнять переход на чтение &amp; запись при всех сбоях встроенного копирования. [#92888](https://github.com/ClickHouse/ClickHouse/pull/92888) ([Smita Kulkarni](https://github.com/SmitaRKulkarni)).
* Исправлено ограничение частоты обращений (throttling) к конечной точке метаданных EC2 при выполнении большого количества параллельных запросов к S3 с использованием учетных данных профильной роли экземпляра EC2. Ранее каждый запрос создавал собственный `AWSInstanceProfileCredentialsProvider`, что приводило к одновременным запросам к службе метаданных EC2, которые могли вызывать тайм-ауты и ошибки `HTTP response code: 403`. Теперь провайдер учетных данных кэшируется и используется совместно всеми запросами. [#92891](https://github.com/ClickHouse/ClickHouse/pull/92891) ([Sav](https://github.com/sberss)).
* Переработана настройка `insert_select_deduplicate`, добавлена возможность сохранения обратной совместимости. [#92951](https://github.com/ClickHouse/ClickHouse/pull/92951) ([Sema Checherinda](https://github.com/CheSema)).
* Логировать фоновые задачи, выполняющиеся медленнее среднего (`background_schedule_pool_log.duration_threshold_milliseconds=30`), чтобы избежать чрезмерного логирования задач. [#92965](https://github.com/ClickHouse/ClickHouse/pull/92965) ([Azat Khuzhin](https://github.com/azat)).
* В предыдущих версиях некоторые имена функций C++ отображались некорректно (&quot;искажёнными&quot;) в `system.trace_log` и `system.symbols`, а функция `demangle` обрабатывала их некорректно. Закрывает [#93074](https://github.com/ClickHouse/ClickHouse/issues/93074). [#93075](https://github.com/ClickHouse/ClickHouse/pull/93075) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Добавлен параметр резервного копирования `backup_data_from_refreshable_materialized_view_targets` для пропуска резервного копирования экземпляров refreshable materialized view. RMV со стратегией обновления APPEND всегда резервируются. [#93076](https://github.com/ClickHouse/ClickHouse/pull/93076) ([Julia Kartseva](https://github.com/jkartseva)). [#93658](https://github.com/ClickHouse/ClickHouse/pull/93658) ([Julia Kartseva](https://github.com/jkartseva))
* Используйте минимальную отладочную информацию вместо полного её отсутствия для тяжёлых единиц трансляции, например функций. [#93079](https://github.com/ClickHouse/ClickHouse/pull/93079) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Добавлена поддержка совместимости с MinIO в AWS S3 C++ SDK за счет сопоставления кодов ошибок, специфичных для MinIO. Это изменение позволяет ClickHouse корректно обрабатывать и повторно выполнять запросы при ошибках сервера MinIO при использовании развертываний MinIO вместо AWS S3, повышая надежность для пользователей, которые запускают объектное хранилище на самостоятельно развернутых кластерах MinIO. [#93082](https://github.com/ClickHouse/ClickHouse/pull/93082) ([XiaoBinMu](https://github.com/Binnn-MX)).
* Записывать профили jemalloc с уже разрешёнными символами, что устраняет необходимость в бинарнике при генерации профилей кучи. [#93099](https://github.com/ClickHouse/ClickHouse/pull/93099) ([Azat Khuzhin](https://github.com/azat)).
* Восстановлен инструмент `clickhouse git-import` — он ломался на крупных и некорректных коммитах. См. https://presentations.clickhouse.com/2020-matemarketing/. [#93202](https://github.com/ClickHouse/ClickHouse/pull/93202) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Не показывать пароли из хранилища URL в журнале запросов. [#93245](https://github.com/ClickHouse/ClickHouse/pull/93245) ([Konstantin Vedernikov](https://github.com/scanhex12)).
* Добавлена поддержка типа данных `Geometry` для `flipCoordinates`. [#93303](https://github.com/ClickHouse/ClickHouse/pull/93303) ([Bharat Nallan](https://github.com/bharatnc)).
* Улучшен UX SYSTEM INSTRUMENT ADD/REMOVE: используются строковые литералы для имён функций, изменены все соответствующие функции и разрешено использование function&#95;name в `REMOVE`. [#93345](https://github.com/ClickHouse/ClickHouse/pull/93345) ([Pablo Marcos](https://github.com/pamarcos)).
* Добавлена новая настройка `materialize_statistics_on_merge`, которая включает или отключает материализацию статистики при слиянии. Значение по умолчанию — `1`. [#93379](https://github.com/ClickHouse/ClickHouse/pull/93379) ([Han Fei](https://github.com/hanfei1991)).
* ClickHouse теперь может парсить `SELECT` без круглых скобок вокруг запросов вида `DESCRIBE SELECT`. Закрывает [#58382](https://github.com/ClickHouse/ClickHouse/issues/58382). [#93429](https://github.com/ClickHouse/ClickHouse/pull/93429) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Добавлена рандомизация проверок корректности кэша с определённой вероятностью. [#93439](https://github.com/ClickHouse/ClickHouse/pull/93439) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Добавлена настройка `type_json_allow_duplicated_key_with_literal_and_nested_object`, разрешающая дублирующиеся пути в JSON, когда один из них является литералом, а другой — вложенным объектом, например `{"a" : 42, "a" : {"b" : 42}}`. Некоторые данные могли быть созданы до введения этого ограничения на дублирующиеся пути в https://github.com/ClickHouse/ClickHouse/pull/79317, и дальнейшие операции с такими данными теперь могут приводить к ошибкам. С этой настройкой такие старые данные по-прежнему можно использовать без ошибок. [#93604](https://github.com/ClickHouse/ClickHouse/pull/93604) ([Pavel Kruglov](https://github.com/Avogar)).
* Не выводить значения простых типов на отдельных строках в формате Pretty JSON. [#93836](https://github.com/ClickHouse/ClickHouse/pull/93836) ([Pavel Kruglov](https://github.com/Avogar)).
* Если выполняется множество команд `alter table ... modify setting ...`, возможно, что блокировку не удастся получить в течение 5 секунд. Лучше вернуть `timeout`, чем `logical error`. [#93856](https://github.com/ClickHouse/ClickHouse/pull/93856) ([Han Fei](https://github.com/hanfei1991)).
* Исключён избыточный вывод при синтаксической ошибке. До этого изменения выводился весь SQL‑скрипт, который мог содержать множество запросов. [#93876](https://github.com/ClickHouse/ClickHouse/pull/93876) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Корректно рассчитывать размер в байтах запроса `check` со статистикой в Keeper. [#93907](https://github.com/ClickHouse/ClickHouse/pull/93907) ([Mikhail Artemenko](https://github.com/Michicosun)).
* Добавлена настройка `use_hash_table_stats_for_join_reordering` для управления тем, используется ли статистика размера хеш-таблицы во время выполнения запроса при переупорядочивании соединений. Эта настройка включена по умолчанию, при этом сохраняется существующее поведение `collect_hash_table_stats_during_joins`. [#93912](https://github.com/ClickHouse/ClickHouse/pull/93912) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Пользователи теперь могут частично просматривать вложенные глобальные настройки сервера в таблице `system.server_settings` (например, `logger.level`). Это распространяется только на настройки с фиксированной структурой (без списков, перечислений, повторений и т. п.). [#94001](https://github.com/ClickHouse/ClickHouse/pull/94001) ([Hechem Selmi](https://github.com/m-selmi)).
* `QBit` теперь поддерживает сравнение на равенство. [#94078](https://github.com/ClickHouse/ClickHouse/pull/94078) ([Raufs Dunamalijevs](https://github.com/rienath)).
* Когда Keeper обнаруживает повреждённый snapshot или несогласованные журналы изменений, выбрасывать исключение вместо ручного прерывания или автоматической очистки файлов. Это должно обеспечить более безопасное поведение Keeper, предполагающее ручное вмешательство. [#94168](https://github.com/ClickHouse/ClickHouse/pull/94168) ([Antonio Andelic](https://github.com/antonio2368)).
* Исправлена проблема, при которой после ошибки `CREATE TABLE` могли оставаться остаточные данные. [#94174](https://github.com/ClickHouse/ClickHouse/pull/94174) ([Azat Khuzhin](https://github.com/azat)).
* Исправлен доступ к неинициализированной памяти (ошибка в OpenSSL), возникавший при использовании TLS-ключа, защищённого паролем. [#94182](https://github.com/ClickHouse/ClickHouse/pull/94182) ([Konstantин Bogdanov](https://github.com/thevar1able)).
* Обновлён chdig до версии [v26.1.1](https://github.com/azat/chdig/releases/tag/v26.1.1). [#94290](https://github.com/ClickHouse/ClickHouse/pull/94290) ([Azat Khuzhin](https://github.com/azat)).
* Добавлена поддержка более универсального партиционирования для упорядоченного режима S3Queue. [#94321](https://github.com/ClickHouse/ClickHouse/pull/94321) ([Bharat Nallan](https://github.com/bharatnc)).
* Добавлен псевдоним `use_statistics` для настройки `allow_statistics_optimize`. Это лучше согласуется с существующими настройками `use_primary_key` и `use_skip_indexes`. [#94366](https://github.com/ClickHouse/ClickHouse/pull/94366) ([Robert Schulze](https://github.com/rschu1ze)).
* Добавлена настройка `input_format_numbers_enum_on_conversion_error` при преобразовании из Numbers в Enums, позволяющая проверять, существует ли элемент. [#94384](https://github.com/ClickHouse/ClickHouse/pull/94384) ([Elmi Ahmadov](https://github.com/ahmadov)).
* В упорядоченном режиме S3(Azure)Queue добавлена очистка неуспешных узлов по лимитам отслеживания (ранее это выполнялось только в неупорядоченном режиме как для неуспешных, так и для обработанных узлов; теперь это также будет выполняться в упорядоченном режиме, но только для неуспешных узлов). [#94412](https://github.com/ClickHouse/ClickHouse/pull/94412) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Включено управление доступом для пользователя `default` в clickhouse-local. У пользователя по умолчанию в `clickhouse-local` отсутствовала привилегия `access_management`, из-за чего операции, такие как `DROP ROW POLICY IF EXISTS`, завершались ошибкой `ACCESS_DENIED`, хотя пользователь должен был иметь неограниченные права. [#94501](https://github.com/ClickHouse/ClickHouse/pull/94501) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Добавлена поддержка именованных коллекций для словарей и таблиц YTsaurus. [#94582](https://github.com/ClickHouse/ClickHouse/pull/94582) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* Добавлена поддержка именованных коллекций, определённых в SQL, в BACKUP/RESTORE для S3 и Azure Blob Storage. Закрывает [#94604](https://github.com/ClickHouse/ClickHouse/issues/94604). [#94605](https://github.com/ClickHouse/ClickHouse/pull/94605) ([Pablo Marcos](https://github.com/pamarcos)).
* Добавлена поддержка бакетизации по ключу партиции для S3Queue в упорядоченном режиме. [#94698](https://github.com/ClickHouse/ClickHouse/pull/94698) ([Bharat Nallan](https://github.com/bharatnc)).
* Добавлена асинхронная метрика максимальной длительности слияния. [#94825](https://github.com/ClickHouse/ClickHouse/pull/94825) ([Raúl Марин](https://github.com/Algunenano)).
* Добавлена проверка принадлежности файла перед применением позиционного удаления с использованием IcebergBitmapPositionDeleteTransform. [#94897](https://github.com/ClickHouse/ClickHouse/pull/94897) ([Yang Jiang](https://github.com/Ted-Jiang)).
* Теперь `view_duration_ms` показывает время, когда группа была активна, а не сумму длительностей потоков в ней. [#94966](https://github.com/ClickHouse/ClickHouse/pull/94966) ([Sema Checherinda](https://github.com/CheSema)).
* Убран лимит на максимальное количество поисковых токенов в функциях `hasAnyTokens` и `hasAllTokens`, который ранее был ограничен значением 64. Пример: `SELECT count() FROM table WHERE hasAllTokens(text, ['token_1', 'token_2', [...], 'token_65']]);` Запрос приводил бы к ошибке `BAD_ARGUMENTS`, потому что указано 65 поисковых токенов. В этом PR лимит полностью удалён, и тот же запрос выполняется без ошибки. [#95152](https://github.com/ClickHouse/ClickHouse/pull/95152) ([Elmi Ahmadov](https://github.com/ahmadov)).
* Добавлена настройка `input_format_numbers_enum_on_conversion_error` для преобразования из Numbers в Enums с проверкой того, существует ли элемент. Закрывает: [#56144](https://github.com/ClickHouse/ClickHouse/issues/56144). [#56240](https://github.com/ClickHouse/ClickHouse/pull/56240) ([Nikolay Degтерinsky](https://github.com/evillique)).
* Разделять ресурсы парсера формата при чтении файлов данных и файлов позиционного удаления в таблицах Iceberg, чтобы сократить количество выделений памяти. [#94701](https://github.com/ClickHouse/ClickHouse/pull/94701) ([Yang Jiang](https://github.com/Ted-Jiang)).

#### Исправление ошибки (некорректное поведение, видимое пользователю, в официальном стабильном релизе) \{#bug-fix-user-visible-misbehavior-in-an-official-stable-release\}

* Исправляет ошибку, из-за которой предопределённые обработчики запросов интерпретировали концевые пробелы как данные при выполнении вставок. [#83604](https://github.com/ClickHouse/ClickHouse/pull/83604) ([Fabian Ponce](https://github.com/FabianPonce)).
* Исправлена ошибка INCOMPATIBLE&#95;TYPE&#95;OF&#95;JOIN для хранилища Join при применении оптимизации замены внешнего соединения на внутреннее. Исправляет [#80794](https://github.com/ClickHouse/ClickHouse/issues/80794). [#84292](https://github.com/ClickHouse/ClickHouse/pull/84292) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Исправлено исключение «Invalid number of rows in Chunk», возникавшее при использовании hash join с включённым параметром `allow_experimental_join_right_table_sorting`. [#86440](https://github.com/ClickHouse/ClickHouse/pull/86440) ([yanglongwei](https://github.com/ylw510)).
* Всегда заменяйте имена файлов на хеш в MergeTree, если файловая система не различает регистр. Ранее на системах с такой файловой системой (например, macOS) это могло приводить к повреждению данных, когда несколько имён столбцов/подстолбцов отличались только регистром. [#86559](https://github.com/ClickHouse/ClickHouse/pull/86559) ([Pavel Kruglov](https://github.com/Avogar)).
* Добавлена полная проверка прав на этапе создания materialized view для базового запроса, лежащего в её основе. [#89180](https://github.com/ClickHouse/ClickHouse/pull/89180) ([pufit](https://github.com/pufit)).
* Исправлено падение функции `icebergHash` при константном аргументе. [#90335](https://github.com/ClickHouse/ClickHouse/pull/90335) ([Michael Kolupaev](https://github.com/al13n321)).
* Исправлена логическая ошибка, когда мутация без транзакции изменяет части, принадлежащие активной транзакции, которая в итоге откатывается. [#90469](https://github.com/ClickHouse/ClickHouse/pull/90469) ([Shaohua Wang](https://github.com/tiandiwonder)).
* Корректно обновлять `system.warnings` после преобразования обычной базы данных в атомарную базу. [#90473](https://github.com/ClickHouse/ClickHouse/pull/90473) ([sdk2](https://github.com/sdk2)).
* Исправлено срабатывание assert-проверки при чтении из файла Parquet, когда часть выражения **prewhere** используется в другом месте запроса. [#90635](https://github.com/ClickHouse/ClickHouse/pull/90635) ([Max Kainov](https://github.com/maxknv)).
* Исправлено падение в одноузловом кластере при чтении из Iceberg в режиме split-by-buckets. Это закрывает [#90913](https://github.com/ClickHouse/ClickHouse/issues/90913#issue-3668583963). [#91553](https://github.com/ClickHouse/ClickHouse/pull/91553) ([Konstantin Vedernikov](https://github.com/scanhex12)).
* Исправлена возможная логическая ошибка в движке Log при чтении подстолбцов. Закрывает [#91710](https://github.com/ClickHouse/ClickHouse/issues/91710). [#91711](https://github.com/ClickHouse/ClickHouse/pull/91711) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена логическая ошибка: &#39;Storage does not support transaction&#39; при выполнении ATTACH AS REPLICATED. [#91772](https://github.com/ClickHouse/ClickHouse/pull/91772) ([Shaohua Wang](https://github.com/tiandiwonder)).
* Исправлена некорректная работа рантайм-фильтров при наличии дополнительного последующего условия в LEFT ANTI JOIN. [#91824](https://github.com/ClickHouse/ClickHouse/pull/91824) ([Alexander Gololobov](https://github.com/davenger)).
* Исправляет ошибку, из-за которой применялось null-безопасное сравнение с участием типа Nothing. Закрывает [#91834](https://github.com/ClickHouse/ClickHouse/issues/91834). Закрывает [#84870](https://github.com/ClickHouse/ClickHouse/issues/84870). Закрывает [#91821](https://github.com/ClickHouse/ClickHouse/issues/91821). [#91884](https://github.com/ClickHouse/ClickHouse/pull/91884) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Исправлены ошибки декодирования DELTA&#95;BYTE&#95;ARRAY в нативном Parquet-ридере, затрагивающие строковые данные с высокой степенью повторяемости. [#91929](https://github.com/ClickHouse/ClickHouse/pull/91929) ([Daniel Muino](https://github.com/dmuino)).
* Кэшировать схему только для того файла, по которому она была выведена, при обработке globs, вместо всех файлов во время вывода схемы. Закрывает [#91745](https://github.com/ClickHouse/ClickHouse/issues/91745). [#92006](https://github.com/ClickHouse/ClickHouse/pull/92006) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена ошибка `Couldn't pack tar archive: Failed to write all bytes`, вызванная некорректным заголовком размера записи архива. Исправляет [#89075](https://github.com/ClickHouse/ClickHouse/issues/89075). [#92122](https://github.com/ClickHouse/ClickHouse/pull/92122) ([Julia Kartseva](https://github.com/jkartseva)).
* Освобождён поток запросов в `INSERT SELECT`, чтобы предотвратить закрытие HTTP‑соединения. [#92175](https://github.com/ClickHouse/ClickHouse/pull/92175) ([Sema Checherinda](https://github.com/CheSema)).
* Исправлена логическая ошибка в запросах с несколькими операторами JOIN с предложением `USING` и `join_use_nulls`. [#92251](https://github.com/ClickHouse/ClickHouse/pull/92251) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Исправлена логическая ошибка при переупорядочивании JOIN при включённом `join_use_nulls`, закрывает https://github.com/clickhouse/clickhouse/issues/90795. [#92289](https://github.com/ClickHouse/ClickHouse/pull/92289) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Исправлено неконсистентное форматирование AST для arrayElement с отрицательным литералом. Закрывает [#92288](https://github.com/ClickHouse/ClickHouse/issues/92288), [#92212](https://github.com/ClickHouse/ClickHouse/issues/92212), [#91832](https://github.com/ClickHouse/ClickHouse/issues/91832), [#91789](https://github.com/ClickHouse/ClickHouse/issues/91789), [#91735](https://github.com/ClickHouse/ClickHouse/issues/91735), [#88495](https://github.com/ClickHouse/ClickHouse/issues/88495), [#92386](https://github.com/ClickHouse/ClickHouse/issues/92386). [#92293](https://github.com/ClickHouse/ClickHouse/pull/92293) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлено возможное падение при использовании настройки `join_on_disk_max_files_to_merge`. [#92335](https://github.com/ClickHouse/ClickHouse/pull/92335) ([Bharat Nallan](https://github.com/bharatnc)).
* Связанная задача: https://github.com/ClickHouse/support-escalation/issues/6365. [#92339](https://github.com/ClickHouse/ClickHouse/pull/92339) ([Tuan Pham Anh](https://github.com/tuanpach)).
* Исправлено отсутствие проверки доступа в `SYSTEM SYNC FILE CACHE`. Закрывает [#92101](https://github.com/ClickHouse/ClickHouse/issues/92101). [#92372](https://github.com/ClickHouse/ClickHouse/pull/92372) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Исправлен проход оптимизации `count_distinct_optimization` для оконных функций и при нескольких аргументах. [#92376](https://github.com/ClickHouse/ClickHouse/pull/92376) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлена ошибка &quot;Cannot write to finalized buffer&quot; при использовании некоторых агрегатных функций с оконными функциями. Закрывает [#91415](https://github.com/ClickHouse/ClickHouse/issues/91415). [#92395](https://github.com/ClickHouse/ClickHouse/pull/92395) ([Jimmy Aguilar Mena](https://github.com/Ergus)).
* Исправлена логическая ошибка при использовании `CREATE TABLE ... AS urlCluster()` и табличного движка `Replicated`. Закрывает [#92216](https://github.com/ClickHouse/ClickHouse/issues/92216). [#92418](https://github.com/ClickHouse/ClickHouse/pull/92418) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Наследовать настройки сериализации исходной части при мутации в MergeTree. Это исправляет потенциально некорректный результат запроса к мутировавшей части после изменений в сериализации типов данных. [#92419](https://github.com/ClickHouse/ClickHouse/pull/92419) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлен потенциальный конфликт между столбцом и подстолбцом с одинаковым именем, что приводило к использованию некорректной сериализации и ошибкам выполнения запросов. Закрывает [#90219](https://github.com/ClickHouse/ClickHouse/issues/90219). Закрывает [#85161](https://github.com/ClickHouse/ClickHouse/issues/85161). [#92453](https://github.com/ClickHouse/ClickHouse/pull/92453) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена ошибка `LOGICAL_ERROR`, вызванная нежелательной модификацией плана запроса при преобразовании внешнего соединения во внутреннее. Также ослаблены требования к оптимизации, чтобы можно было применять её в случаях, когда инъективные функции применяются к ключам агрегации в операциях JOIN. [#92503](https://github.com/ClickHouse/ClickHouse/pull/92503) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* Исправлена возможная ошибка `SIZES_OF_COLUMNS_DOESNT_MATCH` при сортировке пустого столбца кортежей. Закрывает [#92422](https://github.com/ClickHouse/ClickHouse/issues/92422). [#92520](https://github.com/ClickHouse/ClickHouse/pull/92520) ([Pavel Kruglov](https://github.com/Avogar)).
* Проверка наличия несовместимых типизированных путей в типе JSON. Закрывает [#91577](https://github.com/ClickHouse/ClickHouse/issues/91577). [#92539](https://github.com/ClickHouse/ClickHouse/pull/92539) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена взаимная блокировка в SHOW CREATE DATABASE для базы данных Backup. [#92541](https://github.com/ClickHouse/ClickHouse/pull/92541) ([Azat Khuzhin](https://github.com/azat)).
* Использовать правильный код ошибки при проверке индекса гипотезы. [#92559](https://github.com/ClickHouse/ClickHouse/pull/92559) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлено разрешение динамических подстолбцов в псевдонимах столбцов в анализаторе. Ранее динамический подстолбец в псевдониме столбца оборачивался в вызов `getSubcolumn` и в некоторых случаях мог вовсе не разрешаться. Закрывает [#91434](https://github.com/ClickHouse/ClickHouse/issues/91434). [#92583](https://github.com/ClickHouse/ClickHouse/pull/92583) ([Pavel Kruglov](https://github.com/Avogar)).
* Предотвращён сбой функции tokens() при втором аргументе, равном NULL. [#92586](https://github.com/ClickHouse/ClickHouse/pull/92586) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлено потенциальное аварийное завершение работы, вызванное изменением на месте базовых константных столбцов PREWHERE. Это могло произойти при «усадке» столбца (`IColumn::shrinkToFit`) или фильтрации (`IColumn::filter`), которые могли выполняться параллельно из нескольких потоков. [#92588](https://github.com/ClickHouse/ClickHouse/pull/92588) ([Arsen Muk](https://github.com/arsenmuk)).
* Создание и материализация текстовых индексов в таблицах, содержащих очень большие части (более 4 294 967 295 строк), временно отключены. Это ограничение предотвращает некорректные результаты запросов, поскольку текущая реализация индекса пока не поддерживает настолько большие части. [#92644](https://github.com/ClickHouse/ClickHouse/pull/92644) ([Anton Popov](https://github.com/CurtizJ)).
* Исправляет логическую ошибку `Too large size (A) passed to allocator` при выполнении операций JOIN. Закрывает [#92043](https://github.com/ClickHouse/ClickHouse/issues/92043). [#92667](https://github.com/ClickHouse/ClickHouse/pull/92667) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Исправляет ошибку, из-за которой индексы `ngrambf_v1` с длиной ngram (1‑й параметр) &gt; 8 вызывали исключение. [#92672](https://github.com/ClickHouse/ClickHouse/pull/92672) ([Robert Schulze](https://github.com/rschu1ze)).
* Исправлено необработанное исключение при фоновой перезагрузке именованных коллекций при использовании хранилища ZooKeeper. Закрывает https://github.com/ClickHouse/clickhouse-private/issues/44180. [#92717](https://github.com/ClickHouse/ClickHouse/pull/92717) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Исправляет некорректную логику проверки прав доступа для подстановочных привилегий (wildcard grants). Предыдущая попытка https://github.com/ClickHouse/ClickHouse/pull/90928 устраняла критическую уязвимость, но оказалась слишком строгой, в результате чего некоторые команды `GRANT` с подстановками завершались ошибкой из‑за несвязанных с ними отзывов прав. [#92725](https://github.com/ClickHouse/ClickHouse/pull/92725) ([pufit](https://github.com/pufit)).
* Исправлена ошибка в логике пропуска данных при использовании `not match(...)` в `WHERE`, приводившая к некорректным результатам. Закрывает [#92492](https://github.com/ClickHouse/ClickHouse/issues/92492). [#92726](https://github.com/ClickHouse/ClickHouse/pull/92726) ([Nihal Z. Miaji](https://github.com/nihalzp)).
* Не пытайтесь удалять временные каталоги при запуске, если таблица MergeTree создана на диске только для чтения. [#92748](https://github.com/ClickHouse/ClickHouse/pull/92748) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлена ошибка &quot;Cannot add action to empty ExpressionActionsChain&quot; для ALTER TABLE REWRITE PARTS (v2). [#92754](https://github.com/ClickHouse/ClickHouse/pull/92754) ([Azat Khuzhin](https://github.com/azat)).
* Предотвращён сбой при чтении из отключённого `Connection`. [#92807](https://github.com/ClickHouse/ClickHouse/pull/92807) ([Raufs Dunamalijevs](https://github.com/rienath)).
* Исправлена логическая ошибка `Failed to set file processing within 100 retries` в хранилище `S3Queue` в режиме `Ordered`. Теперь она приводит только к предупреждению. Эта ошибка могла возникать до версии 25.10, если истекала сессия Keeper, однако в версиях 25.10+ она также будет только предупреждением, так как теоретически все еще возможно получить эту ошибку в случае высокой степени параллелизма обработки в режиме `Ordered`. [#92814](https://github.com/ClickHouse/ClickHouse/pull/92814) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Ранее некоторые запросы, использующие сегментацию по PK с заведомо ложным условием, завершались с ошибкой. Теперь они выполняются корректно. Требуется для https://github.com/ClickHouse/ClickHouse/pull/89313. [#92815](https://github.com/ClickHouse/ClickHouse/pull/92815) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Исправлен расчёт несжатых размеров текстовых индексов в таблице `system.parts`. [#92832](https://github.com/ClickHouse/ClickHouse/pull/92832) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлено использование первичного индекса в легковесных обновлениях, которые содержат оператор `IN` с подзапросами в предикате условия `WHERE`. [#92838](https://github.com/ClickHouse/ClickHouse/pull/92838) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлено формирование подсказки типа для пути &#39;skip&#39; в JSON. Закрывает [#92731](https://github.com/ClickHouse/ClickHouse/issues/92731). [#92842](https://github.com/ClickHouse/ClickHouse/pull/92842) ([Pavel Kruglov](https://github.com/Avogar)).
* В табличном движке S3 следует избегать кеширования ключа партиции, если используются недетерминированные функции. [#92844](https://github.com/ClickHouse/ClickHouse/pull/92844) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* Исправлена потенциальная ошибка `FILE_DOESNT_EXIST` после мутации разреженного столбца с параметром `ratio_of_defaults_for_sparse_serialization=0.0`. Закрывает [#92633](https://github.com/ClickHouse/ClickHouse/issues/92633). [#92860](https://github.com/ClickHouse/ClickHouse/pull/92860) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлен вывод схемы Parquet в старом Parquet-ридере (по умолчанию не используется), когда столбец JSON следует за столбцом Tuple. Исправлена ошибка старого Parquet-ридера (по умолчанию не используется), приводившая к сбою при обработке пустых кортежей. [#92867](https://github.com/ClickHouse/ClickHouse/pull/92867) ([Michael Kolupaev](https://github.com/al13n321)).
* Исправлена логическая ошибка при использовании нескольких `JOIN` по константному условию и включённым `join_use_nulls`, закрыт [#92640](https://github.com/ClickHouse/ClickHouse/issues/92640). [#92892](https://github.com/ClickHouse/ClickHouse/pull/92892) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Исправлена возможная ошибка `NOT_FOUND_COLUMN_IN_BLOCK` при вставке в таблицу, использующую подстолбец в выражении партиции. Закрывает [#93210](https://github.com/ClickHouse/ClickHouse/issues/93210). Закрывает [#83406](https://github.com/ClickHouse/ClickHouse/issues/83406). [#92905](https://github.com/ClickHouse/ClickHouse/pull/92905) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена ошибка `NO_SUCH_COLUMN_IN_TABLE` в движке Merge для таблиц с псевдонимами. Закрывает [#88665](https://github.com/ClickHouse/ClickHouse/issues/88665). [#92910](https://github.com/ClickHouse/ClickHouse/pull/92910) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлен случай сравнения NULL != NULL для операции full&#95;sorting&#95;join по столбцу типа LowCardinality(Nullable(T)). [#92924](https://github.com/ClickHouse/ClickHouse/pull/92924) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Исправлено несколько сбоев при слиянии текстовых индексов в таблицах `MergeTree`. [#92925](https://github.com/ClickHouse/ClickHouse/pull/92925) ([Anton Popov](https://github.com/CurtizJ)).
* Восстанавливать при необходимости обёртки LowCardinality вокруг результатов выражений Set во время агрегации TTL, чтобы предотвратить исключения при оптимизации таблицы. [#92971](https://github.com/ClickHouse/ClickHouse/pull/92971) ([Seva Potapov](https://github.com/seva-potapov)).
* Исправлена логическая ошибка при анализе индекса, когда в функции `has` используется пустой массив. Закрывает [#92906](https://github.com/ClickHouse/ClickHouse/issues/92906). [#92995](https://github.com/ClickHouse/ClickHouse/pull/92995) ([Nihал Z. Miaji](https://github.com/nihalzp)).
* Исправлено возможное зависание при завершении пула фоновых задач по расписанию (могло приводить к зависаниям сервера при его остановке). [#93008](https://github.com/ClickHouse/ClickHouse/pull/93008) ([Azat Khuzhin](https://github.com/azat)).
* Исправлена возможная ошибка FILE&#95;DOESNT&#95;EXIST после мутации разреженного столбца, если настройка `ratio_of_defaults_for_sparse_serialization` была изменена на `1.0` через `ALTER`. [#93016](https://github.com/ClickHouse/ClickHouse/pull/93016) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена ошибка в логике пропуска данных, когда в WHERE используется `not materialize(...)` или `not CAST(...)`, что приводило к некорректным результатам. Закрывает [#88536](https://github.com/ClickHouse/ClickHouse/issues/88536). [#93017](https://github.com/ClickHouse/ClickHouse/pull/93017) ([Nihал Z. Miaji](https://github.com/nihalzp)).
* Исправлено возможное использование устаревших частей из-за гонки типа TOCTOU при работе с общими частями. [#93022](https://github.com/ClickHouse/ClickHouse/pull/93022) ([Azat Khuzhin](https://github.com/azat)).
* Исправлен сбой при десериализации повреждённого агрегатного состояния `groupConcat` с смещениями, выходящими за допустимые границы. [#93028](https://github.com/ClickHouse/ClickHouse/pull/93028) ([Raufs Dunamalijevs](https://github.com/rienath)).
* Исправлена ошибка, из-за которой соединение оставалось в некорректном состоянии после предварительной отмены распределённых запросов. [#93029](https://github.com/ClickHouse/ClickHouse/pull/93029) ([Azat Khuzhin](https://github.com/azat)).
* Исправлены результаты JOIN при разрежённом столбце в качестве правого ключа соединения. Это закрывает [#92920](https://github.com/ClickHouse/ClickHouse/issues/92920). Мне удалось воспроизвести ошибку только при `set compatibility='23.3'`. Не уверен, стоит ли делать бэкпорт. [#93038](https://github.com/ClickHouse/ClickHouse/pull/93038) ([Amos Bird](https://github.com/amosbird)).
* Исправлена возможная ошибка `Cannot finalize buffer after cancellation` в `estimateCompressionRatio()`. Исправления: [#87380](https://github.com/ClickHouse/ClickHouse/issues/87380). [#93068](https://github.com/ClickHouse/ClickHouse/pull/93068) ([Azat Khuzhin](https://github.com/azat)).
* Исправлены слияния текстовых индексов, построенных на основе сложных выражений (таких, как `concat(col1, col2)`). [#93073](https://github.com/ClickHouse/ClickHouse/pull/93073) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлено применение PROJECTION, когда фильтр содержит подстолбцы. Закрывает [#92882](https://github.com/ClickHouse/ClickHouse/issues/92882). [#93141](https://github.com/ClickHouse/ClickHouse/pull/93141) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена логическая ошибка, которая в некоторых случаях возникала при добавлении runtime-фильтров JOIN в план запроса. Она была вызвана некорректным возвратом дублированных константных столбцов с одной из сторон JOIN. [#93144](https://github.com/ClickHouse/ClickHouse/pull/93144) ([Alexander Gololobov](https://github.com/davenger)).
* Специальная функция `__applyFilter`, используемая в runtime-фильтрах join, в некоторых допустимых случаях возвращала ошибку ILLEGAL&#95;TYPE&#95;OF&#95;ARGUMENT. [#93187](https://github.com/ClickHouse/ClickHouse/pull/93187) ([Alexander Gololobov](https://github.com/davenger)).
* Предотвращено схлопывание разных интерполированных столбцов в один столбец в блоке, когда интерполированные столбцы фактически являются псевдонимами одного и того же столбца. [#93197](https://github.com/ClickHouse/ClickHouse/pull/93197) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* Не добавляйте runtime-фильтр при выполнении JOIN с уже заполненной правой таблицей. [#93211](https://github.com/ClickHouse/ClickHouse/pull/93211) ([Alexander Gololobov](https://github.com/davenger)).
* Исправлена очистка постоянных наблюдений в Keeper после завершения сеанса. Это закрывает [#92480](https://github.com/ClickHouse/ClickHouse/issues/92480). [#93213](https://github.com/ClickHouse/ClickHouse/pull/93213) ([Konstantин Vedernиков](https://github.com/scanhex12)).
* Исправлен ORDER BY tuple в Iceberg. Это закрывает [#92977](https://github.com/ClickHouse/ClickHouse/issues/92977). [#93225](https://github.com/ClickHouse/ClickHouse/pull/93225) ([Konstantin Vedernikov](https://github.com/scanhex12)).
* Исправлена ошибка в настройке S3Queue `s3queue_migrate_old_metadata_to_buckets`. Закрывает [#93392](https://github.com/ClickHouse/ClickHouse/issues/93392), [#93196](https://github.com/ClickHouse/ClickHouse/issues/93196), [#81739](https://github.com/ClickHouse/ClickHouse/issues/81739). [#93232](https://github.com/ClickHouse/ClickHouse/pull/93232) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Удаляет неиспользуемые столбцы при перестроении проекций во время слияния. Это снижает использование памяти и уменьшает количество временных частей. [#93233](https://github.com/ClickHouse/ClickHouse/pull/93233) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* Исправлена ошибка удаления неиспользуемых столбцов из подзапросов при наличии скалярного коррелированного подзапроса. До исправления столбец мог быть удалён, если он использовался только в коррелированном подзапросе, из-за чего запрос завершался с ошибкой `NOT_FOUND_COLUMN_IN_BLOCK`. [#93273](https://github.com/ClickHouse/ClickHouse/pull/93273) ([Dmitry Novik](https://github.com/novikd)).
* Исправлена возможная проблема отсутствующего подстолбца в материализованном представлении при выполнении ALTER исходной таблицы. Закрывает [#93231](https://github.com/ClickHouse/ClickHouse/issues/93231). [#93276](https://github.com/ClickHouse/ClickHouse/pull/93276) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлено планирование запросов анализатором для табличного движка `Merge`, из‑за которого могла возникать ошибка ILLEGAL&#95;COLUMN для `hostName()` при слиянии локальных и удалённых/Distributed таблиц. Закрывает [#92059](https://github.com/ClickHouse/ClickHouse/issues/92059). [#93286](https://github.com/ClickHouse/ClickHouse/pull/93286) ([Jinlin](https://github.com/withlin)).
* Исправлена ситуация, когда `NOT IN` с неконстантными аргументами-массивами возвращал неверное значение, и добавлена поддержка неконстантных функций с типом `Array`. Закрывает [#14980](https://github.com/ClickHouse/ClickHouse/issues/14980). [#93314](https://github.com/ClickHouse/ClickHouse/pull/93314) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Исправлена ошибка `Not found column` при использовании оптимизации `use_top_k_dynamic_filtering`. Исправляет [#93186](https://github.com/ClickHouse/ClickHouse/issues/93186). [#93316](https://github.com/ClickHouse/ClickHouse/pull/93316) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* Исправлено перестроение текстовых индексов, созданных на основе подстолбцов. [#93326](https://github.com/ClickHouse/ClickHouse/pull/93326) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлена обработка пустого массива при передаче его вторым аргументом в функции `hasAllTokens` и `hasAnyTokens`. [#93328](https://github.com/ClickHouse/ClickHouse/pull/93328) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлена логическая ошибка при использовании runtime-фильтров в запросе с итогами по правой таблице. [#93330](https://github.com/ClickHouse/ClickHouse/pull/93330) ([Alexander Gololobov](https://github.com/davenger)).
* Сервер больше не падает, если функция `tokens` вызывается с неконстантными параметрами токенизатора (со 2-м, 3-м и 4-м параметрами), например, `SELECT tokens(NULL, 1, materialize(1))`. [#93383](https://github.com/ClickHouse/ClickHouse/pull/93383) ([Robert Schulze](https://github.com/rschu1ze)).
* Исправлена уязвимость целочисленного переполнения в десериализации состояния `groupConcat`, которая могла приводить к проблемам с безопасностью памяти при обработке специально сконструированных агрегатных состояний. [#93426](https://github.com/ClickHouse/ClickHouse/pull/93426) ([Raufs Dunamalijevs](https://github.com/rienath)).
* Исправлен анализ текстового индекса для столбцов массивов, когда в индексе нет токенов (все массивы пусты или все токены пропускаются токенизатором). [#93457](https://github.com/ClickHouse/ClickHouse/pull/93457) ([Anton Popov](https://github.com/CurtizJ)).
* Исключает использование аутентификации через OAuth в ClickHouse Client, если имя пользователя и пароль заданы в строке подключения. [#93459](https://github.com/ClickHouse/ClickHouse/pull/93459) ([Krishna Mannem](https://github.com/kcmannem)).
* Исправлена поддержка предоставляемых учетных данных Azure ADLS Gen2 в DataLakeCatalog — разбираются ключи `adls.sas-token.*` из REST-каталогов Iceberg и исправлен разбор URL-адресов ABFSS. [#93477](https://github.com/ClickHouse/ClickHouse/pull/93477) ([Karun Anantharaman](https://github.com/karunmotorq)).
* Исправлена поддержка GLOBAL IN с анализатором (ранее Set повторно создавался на удалённом узле). [#93507](https://github.com/ClickHouse/ClickHouse/pull/93507) ([Azat Khuzhin](https://github.com/azat)).
* Исправлена ошибка извлечения подстолбца при десериализации непосредственно в разреженные столбцы. [#93512](https://github.com/ClickHouse/ClickHouse/pull/93512) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлено прямое чтение из текстового индекса при дублирующихся поисковых запросах. [#93516](https://github.com/ClickHouse/ClickHouse/pull/93516) ([Anton Popov](https://github.com/CurtizJ)).
* Исправление ошибки NOT&#95;FOUND&#95;COLUMN&#95;IN&#95;BLOCK, возникающей при включённом runtime filter, если в объединённых таблицах один и тот же столбец возвращается несколько раз (например, SELECT a, a, a FROM t). [#93526](https://github.com/ClickHouse/ClickHouse/pull/93526) ([Alexander Gololobov](https://github.com/davenger)).
* Исправлена ошибка, из-за которой clickhouse-client запрашивал пароль дважды при подключении по SSH. [#93547](https://github.com/ClickHouse/ClickHouse/pull/93547) ([Isak Ellmer](https://github.com/spinojara)).
* Обеспечено корректное завершение ZooKeeper при остановке (исправлено потенциальное зависание при остановке в крайне редких случаях). [#93602](https://github.com/ClickHouse/ClickHouse/pull/93602) ([Azat Khuzhin](https://github.com/azat)).
* Исправлен LOGICAL&#95;ERROR при восстановлении ReplicatedMergeTree при гонке дедупликации. [#93612](https://github.com/ClickHouse/ClickHouse/pull/93612) ([Pablo Marcos](https://github.com/pamarcos)).
* Исправлено использование разреженного столбца для обновления TTL при прямой десериализации в разреженные столбцы в некоторых входных форматах. Это исправляет возможную логическую ошибку `Unexpected type of result TTL column`. [#93619](https://github.com/ClickHouse/ClickHouse/pull/93619) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлены случаи, когда функции индекса h3 иногда приводили к сбоям или зависанию при вызове с некорректными входными данными. [#93657](https://github.com/ClickHouse/ClickHouse/pull/93657) ([Michael Kolupaev](https://github.com/al13n321)).
* Использование индекса `ngram_bf` для данных не в кодировке UTF-8 приводило к чтению неинициализированной памяти, значения из которой могли попадать в результирующую структуру индекса. Закрывает [#92576](https://github.com/ClickHouse/ClickHouse/issues/92576). [#93663](https://github.com/ClickHouse/ClickHouse/pull/93663) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Проверьте, что размер распакованного буфера соответствует ожидаемому. [#93690](https://github.com/ClickHouse/ClickHouse/pull/93690) ([Raúl Marín](https://github.com/Algunenano)).
* Предотвращена возможность получения пользователями списка столбцов таблицы без проверки наличия разрешения `SHOW COLUMNS` при использовании движка таблиц `merge`. [#93695](https://github.com/ClickHouse/ClickHouse/pull/93695) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* Исправлена материализация пропускающих индексов, созданных на основе подстолбцов. [#93708](https://github.com/ClickHouse/ClickHouse/pull/93708) ([Anton Popov](https://github.com/CurtizJ)).
* Мы храним умные указатели `shared_ptr` на хранилища в `QueryPipeline::resources::storage_holders`, чтобы гарантировать, что объекты `IStorage` не будут уничтожены, пока существует `PipelineExecutor`. [#93746](https://github.com/ClickHouse/ClickHouse/pull/93746) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* Исправлена проблема с присоединением реплицируемых БД, когда межсерверный хост изменился после перезапуска. [#93779](https://github.com/ClickHouse/ClickHouse/pull/93779) ([Tuan Pham Anh](https://github.com/tuanpach)).
* Исправлено срабатывание assert `!read_until_position` в `ReadBufferFromS3`, возникавшее при включённом кэше. [#93809](https://github.com/ClickHouse/ClickHouse/pull/93809) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Исправлена логическая ошибка в редком случае использования пустого кортежа со столбцом `Map`. Закрывает [#93784](https://github.com/ClickHouse/ClickHouse/issues/93784). [#93814](https://github.com/ClickHouse/ClickHouse/pull/93814) ([Nihal Z. Miaji](https://github.com/nihalzp)).
* Исправлено повреждение `_part_offset` при перестроении проекций во время слияний и оптимизирована обработка проекций за счёт исключения ненужных чтений столбца `_part_offset` и пропуска лишних столбцов при вычислениях проекций. Это продолжение оптимизаций, представленных в [#93233](https://github.com/ClickHouse/ClickHouse/issues/93233). [#93827](https://github.com/ClickHouse/ClickHouse/pull/93827) ([Amos Bird](https://github.com/amosbird)).
* Удалена обработка ошибки &#39;Bad version&#39;. [#93843](https://github.com/ClickHouse/ClickHouse/pull/93843) ([Anton Ivashkin](https://github.com/ianton-ru)).
* Исправлена некорректная работа `optimize_inverse_dictionary_lookup` с распределённым запросом, когда ключ имеет знаковый целочисленный тип. Закрывает [#93259](https://github.com/ClickHouse/ClickHouse/issues/93259). [#93848](https://github.com/ClickHouse/ClickHouse/pull/93848) ([Nihal Z. Miaji](https://github.com/nihalzp)).
* Исправлена проблема, из-за которой `lag`/`lead` не работали с распределённым запросом `remote()`. Закрывает [#90014](https://github.com/ClickHouse/ClickHouse/issues/90014). [#93858](https://github.com/ClickHouse/ClickHouse/pull/93858) ([Nihal Z. Miaji](https://github.com/nihalzp)).
* Исправлена ошибка диспетчеризации системных инструментов. [#93937](https://github.com/ClickHouse/ClickHouse/pull/93937) ([Pablo Marcos](https://github.com/pamarcos)).
* В https://github.com/ClickHouse/ClickHouse/pull/89173 мы добавили дополнительное поле в структуру, которую `TraceSender` отправляет через внутренний канал. Однако размер буфера не был обновлён ([здесь](https://github.com/ClickHouse/ClickHouse/pull/89173/changes#diff-36ecfac5cde34c92c031652d8a77f0d12782cd5d43e68d6ef159e6d46a54224fL44)), поэтому мы записываем в буфер больше данных, чем `buffer_size`, что приводит к многократным сбросам. И поскольку `TraceSender::send` вызывается из разных потоков, сбросы буфера из разных потоков могут чередоваться, что нарушает инвариант, на который опирается принимающая сторона (`TraceCollector`). [#93966](https://github.com/ClickHouse/ClickHouse/pull/93966) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* Исправлено приведение типов к супертипу при операции `JOIN` в хранилище `Join` с предложением `USING`. Исправляет [#91672](https://github.com/ClickHouse/ClickHouse/issues/91672). Исправляет [#78572](https://github.com/ClickHouse/ClickHouse/issues/78572). [#94000](https://github.com/ClickHouse/ClickHouse/pull/94000) ([Dmitry Novik](https://github.com/novikd)).
* Исправлена ошибка, из-за которой FilterStep некорректно добавлялся при применении runtime-фильтра JOIN поверх таблицы Merge. [#94021](https://github.com/ClickHouse/ClickHouse/pull/94021) ([Alexander Gololobov](https://github.com/davenger)).
* Запрос `SELECT`, содержащий предикат по нескольким столбцам с пропускающими индексами bloom filter и одновременно использующий условия `OR` и `NOT`, мог возвращать несогласованные результаты. Теперь это исправлено. [#94026](https://github.com/ClickHouse/ClickHouse/pull/94026) ([Shankar Iyer](https://github.com/shankar-iyer)).
* Исправлена операция CLEAR COLUMN для столбца с зависимыми индексами. [#94057](https://github.com/ClickHouse/ClickHouse/pull/94057) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлено использование неинициализированного значения в `ReadWriteBufferFromHTTP`. [#94058](https://github.com/ClickHouse/ClickHouse/pull/94058) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлена некорректная проверка типизированных путей в JSON. Проверка была добавлена в https://github.com/ClickHouse/ClickHouse/pull/92842 и может вызывать ошибку при запуске существующих таблиц. [#94070](https://github.com/ClickHouse/ClickHouse/pull/94070) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлено падение во время анализа фильтра при наличии OUTER JOIN. Устранена проблема [#90979](https://github.com/ClickHouse/ClickHouse/issues/90979). [#94080](https://github.com/ClickHouse/ClickHouse/pull/94080) ([Dmitry Novik](https://github.com/novikd)).
* Исправлена точность вычислений `uniqTheta` при использовании агрегатных ключей типа UInt8 при параллельной агрегации (`max_threads` &gt; 1, значение по умолчанию). [#94095](https://github.com/ClickHouse/ClickHouse/pull/94095) ([Azat Khuzhin](https://github.com/azat)).
* Исправлено падение, вызванное исключением при вызове `socket.setBlocking(true)` внутри `SCOPE_EXIT`. [#94100](https://github.com/ClickHouse/ClickHouse/pull/94100) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* Исправлена потеря данных, происходившая, когда `DROP PARTITION` удалял части, созданные более поздними записями журнала в ReplicatedMergeTree. [#94123](https://github.com/ClickHouse/ClickHouse/pull/94123) ([Tuan Pham Anh](https://github.com/tuanpach)).
* Исправлен Parquet-ридер v3, некорректно обрабатывавший массивы, пересекающие границы страниц. Это происходит, например, для файлов, записанных с помощью Arrow без включения статистики страниц (page statistics) или индекса страниц (page index). Затрагивает только столбцы типа данных Array. Вероятный симптом — усечение примерно одного массива на каждые ~1 МБ данных. До этого исправления используйте следующий SETTING как обходной путь: `input_format_parquet_use_native_reader_v3 = 0`. [#94125](https://github.com/ClickHouse/ClickHouse/pull/94125) ([Michael Kolupaev](https://github.com/al13n321)).
* Исправлена проблема с чрезмерным числом watches в ReplicatedMergeTree при ожидании записи в журнал. [#94133](https://github.com/ClickHouse/ClickHouse/pull/94133) ([Azat Khuzhin](https://github.com/azat)).
* Функции `arrayShuffle`, `arrayPartialShuffle` и `arrayRandomSample` материализуют константные столбцы, чтобы разные строки получали разные результаты. [#94134](https://github.com/ClickHouse/ClickHouse/pull/94134) ([Joanna Hulboj](https://github.com/jh0x)).
* Устранена гонка данных при вычислении табличных функций в materialized views. [#94171](https://github.com/ClickHouse/ClickHouse/pull/94171) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлено разыменование `nullptr` в движках баз данных `PostgreSQL` (при некорректном запросе). Закрывает [#92887](https://github.com/ClickHouse/ClickHouse/issues/92887). [#94180](https://github.com/ClickHouse/ClickHouse/pull/94180) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлена утечка памяти в refreshable materialized views при выполнении запросов `SELECT` с несколькими подзапросами. [#94200](https://github.com/ClickHouse/ClickHouse/pull/94200) ([Antonio Andelic](https://github.com/antonio2368)).
* Устранена гонка данных между `DataPartStorageOnDiskBase::remove` и `system.parts`. Закрывает [#49076](https://github.com/ClickHouse/ClickHouse/issues/49076). [#94262](https://github.com/ClickHouse/ClickHouse/pull/94262) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Удалён некорректный спецификатор `noexcept` у оператора копирующего присваивания HashTable, который мог приводить к аварийному завершению (`std::terminate`) при исключениях, связанных с памятью. [#94275](https://github.com/ClickHouse/ClickHouse/pull/94275) ([Nikita Taranov](https://github.com/nickitat)).
* Ранее создание PROJECTION с дублирующимися столбцами в GROUP BY (например, `GROUP BY c0, c0`) и последующая вставка данных приводили к исключению `std::length_error` при включённой настройке `optimize_row_order`. Закрывает [#94065](https://github.com/ClickHouse/ClickHouse/issues/94065). [#94277](https://github.com/ClickHouse/ClickHouse/pull/94277) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлена неочевидная ошибка в клиенте ZooKeeper при подключении, приводившая к зависаниям и сбоям. [#94320](https://github.com/ClickHouse/ClickHouse/pull/94320) ([Azat Khuzhin](https://github.com/azat)).
* Исправлена ошибка, из-за которой оптимизация функций для подстолбцов не применялась к подстолбцам. [#94323](https://github.com/ClickHouse/ClickHouse/pull/94323) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлен возможный некорректный результат во вложенных операциях RIGHT JOIN при включённом `enable_lazy_columns_replication`. Ошибка приводила к тому, что все строки в реплицируемых столбцах некорректно возвращали одно и то же значение вместо своих собственных значений. Закрыт [#93891](https://github.com/ClickHouse/ClickHouse/issues/93891). [#94339](https://github.com/ClickHouse/ClickHouse/pull/94339) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Исправлено проталкивание фильтра для SEMI JOIN с использованием наборов эквивалентности. Фильтр не проталкивается, если типы аргументов изменились. Исправляет [#93264](https://github.com/ClickHouse/ClickHouse/issues/93264). [#94340](https://github.com/ClickHouse/ClickHouse/pull/94340) ([Dmitry Novik](https://github.com/novikd)).
* Исправлено использование DeltaLake CDF с движком базы данных DataLake (интеграция с каталогами Delta Lake). Закрывает [#94122](https://github.com/ClickHouse/ClickHouse/issues/94122). [#94342](https://github.com/ClickHouse/ClickHouse/pull/94342) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Исправлено некорректное значение текущей метрики `FilesystemCacheSizeLimit` в случае использования политики кэширования `SLRU`. [#94363](https://github.com/ClickHouse/ClickHouse/pull/94363) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Создание движка базы данных Backup с количеством аргументов меньше двух теперь возвращает более информативное сообщение об ошибке (`Wrong number of arguments` вместо `std::out_of_range: InlinedVector::at(size_type) const failed bounds check.`). [#94374](https://github.com/ClickHouse/ClickHouse/pull/94374) ([Robert Schulze](https://github.com/rschu1ze)).
* Игнорируются невозможные попытки отзыва глобальных привилегий на уровне базы данных для привилегий с правом дальнейшей передачи (grant option). [#94386](https://github.com/ClickHouse/ClickHouse/pull/94386) ([pufit](https://github.com/pufit)).
* Исправлено чтение разреженных смещений из компактных частей. Закрывает [#94385](https://github.com/ClickHouse/ClickHouse/issues/94385). [#94399](https://github.com/ClickHouse/ClickHouse/pull/94399) ([Pavel Kruglov](https://github.com/Avogar)).
* Не блокировать выполнение ALTER для столбцов, использующих неявные индексы, даже если используется режим `throw` у `alter_column_secondary_index_mode`. [#94425](https://github.com/ClickHouse/ClickHouse/pull/94425) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлено падение в `TCPHandler`, когда несколько вызовов `receivePacketsExpectQuery` читают `Protocol::Client::IgnoredPartUUIDs`. [#94434](https://github.com/ClickHouse/ClickHouse/pull/94434) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* Исправлена маскировка конфиденциальных данных в `system.functions`. [#94436](https://github.com/ClickHouse/ClickHouse/pull/94436) ([Vitaly Baranov](https://github.com/vitlibar)).
* Исправлено разыменование `nullptr` при отключённом `send_profile_events`. Эта возможность была недавно добавлена для Python-драйвера ClickHouse. Закрывает [#92488](https://github.com/ClickHouse/ClickHouse/issues/92488). [#94466](https://github.com/ClickHouse/ClickHouse/pull/94466) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлена несовместимость файлов .mrk текстового индекса при слияниях. [#94494](https://github.com/ClickHouse/ClickHouse/pull/94494) ([Peng Jian](https://github.com/fastio)).
* Когда `read_in_order_use_virtual_row` включён, код обращался к индексным столбцам, исходя из полного размера первичного ключа, не проверяя, был ли индекс усечён, что приводило к обращению к уже освобождённой / неинициализированной памяти. Закрывает [#85596](https://github.com/ClickHouse/ClickHouse/issues/85596). [#94500](https://github.com/ClickHouse/ClickHouse/pull/94500) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлена ошибка из-за несоответствия типов при передаче внешних таблиц в подзапросы с GLOBAL IN, если их типы — Nullable. Закрывает [#94097](https://github.com/ClickHouse/ClickHouse/issues/94097). [#94511](https://github.com/ClickHouse/ClickHouse/pull/94511) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* В предыдущих версиях запросы с несколькими индексными условиями по одному и тому же выражению могли ошибочно приводить к исключению `Not found column`. Закрывает [#60660](https://github.com/ClickHouse/ClickHouse/issues/60660). [#94515](https://github.com/ClickHouse/ClickHouse/pull/94515) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлена некорректная обработка столбца ключа соединения типа Nullable в runtime-фильтрах. [#94555](https://github.com/ClickHouse/ClickHouse/pull/94555) ([Alexander Gololobov](https://github.com/davenger)).
* Создание рабочей нагрузки внутри другой, уже используемой, больше не приводит к аварийному завершению работы. [#94599](https://github.com/ClickHouse/ClickHouse/pull/94599) ([Sergei Trifonov](https://github.com/serxa)).
* Исправлена ошибка, приводившая к сбою при оптимизации ANY LEFT JOIN, когда `isNotNull` вычисляется для отсутствующего столбца. [#94600](https://github.com/ClickHouse/ClickHouse/pull/94600) ([Molly](https://github.com/ggmolly)).
* Исправлена оценка выражений для значений по умолчанию при ссылках на другие столбцы с вычисляемыми значениями по умолчанию. [#94615](https://github.com/ClickHouse/ClickHouse/pull/94615) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлены проблемы с проверкой прав доступа при операциях BACKUP/RESTORE. [#94617](https://github.com/ClickHouse/ClickHouse/pull/94617) ([Pablo Marcos](https://github.com/pamarcos)).
* Исправлена ошибка, приводившая к сбою из-за некорректного приведения типа при типе данных `Nullable(DateTime64)`. [#94627](https://github.com/ClickHouse/ClickHouse/pull/94627) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* Исправляет ошибку, из-за которой некоторые распределённые запросы с `ORDER BY` могли возвращать столбцы `ALIAS` с перепутанными значениями (т.е. столбец `a` содержал данные столбца `b` и наоборот). [#94644](https://github.com/ClickHouse/ClickHouse/pull/94644) ([filimonov](https://github.com/filimonov)).
* Исправлена запись результатов работы keeper-bench в файл. [#94654](https://github.com/ClickHouse/ClickHouse/pull/94654) ([Antonio Andelic](https://github.com/antonio2368)).
* Исправлены некорректные оценки, вычисляемые с использованием статистики типа MinMax, при наличии в столбце отрицательных значений с плавающей запятой. [#94665](https://github.com/ClickHouse/ClickHouse/pull/94665) ([zoomxi](https://github.com/zoomxi)).
* Исправлена ошибка чтения файлов Parquet, когда ключ в map имеет тип struct. [#94670](https://github.com/ClickHouse/ClickHouse/pull/94670) ([Konstantin Vedernikov](https://github.com/scanhex12)).
* Исправлен возможный некорректный результат RIGHT JOIN при использовании сложных условий ON. Закрывает [#92913](https://github.com/ClickHouse/ClickHouse/issues/92913). [#94680](https://github.com/ClickHouse/ClickHouse/pull/94680) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Сохранять постоянную гранулярность индекса (use&#95;const&#95;adaptive&#95;granularity) после вертикальных слияний. [#94725](https://github.com/ClickHouse/ClickHouse/pull/94725) ([Azat Khuzhin](https://github.com/azat)).
* Исправлена ошибка в мутациях со скалярными подзапросами и зависимостями таблицы. Если у таблицы были зависимости (индекс или PROJECTION) по столбцу, скалярные подзапросы могли вычисляться и кэшироваться без данных, что приводило к некорректным изменениям. [#94731](https://github.com/ClickHouse/ClickHouse/pull/94731) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлен резервный механизм AsynchronousMetrics cpu&#95;pressure при возникновении ошибки. [#94827](https://github.com/ClickHouse/ClickHouse/pull/94827) ([Raúl Marín](https://github.com/Algunenano)).
* Функция `getURLHostRFC` не выполняла проверок границ перед разыменованием указателей. При передаче пустой строки в `domainRFC` происходило чтение неинициализированной памяти, что вызывало ошибки MSan. [#94851](https://github.com/ClickHouse/ClickHouse/pull/94851) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлена работа режима только чтения для зашифрованных дисков. [#94852](https://github.com/ClickHouse/ClickHouse/pull/94852) ([Azat Khuzhin](https://github.com/azat)).
* Исправлена логическая ошибка в дробном `LIMIT/OFFSET` при использовании старого анализатора с distributed таблицами. Закрывает [#94712](https://github.com/ClickHouse/ClickHouse/issues/94712). [#94999](https://github.com/ClickHouse/ClickHouse/pull/94999) ([Ahmed Gouda](https://github.com/0xgouda)).
* Исправлено падение в некоторых случаях при включённых по умолчанию runtime-фильтрах JOIN. [#95000](https://github.com/ClickHouse/ClickHouse/pull/95000) ([Alexander Gololobov](https://github.com/davenger)).
* Улучшено маскирование паролей в URL-адресах, используемых в движке таблиц `URL()` и табличной функции `url()`. [#95006](https://github.com/ClickHouse/ClickHouse/pull/95006) ([Vitaly Baranov](https://github.com/vitlibar)).
* Функция `toStartOfInterval` теперь работает так же, как `toStartOfX`, где `X` — `Day, Week, Month, Quarter, Year`, при включённой настройке `enable_extended_results_for_datetime_functions`. [#95011](https://github.com/ClickHouse/ClickHouse/pull/95011) ([Kirill Kopnev](https://github.com/Fgrtue)).
* Исправлено некорректное сравнение константных строк, не учитывавшее настройки `cast_string_to_date_time_mode`, `bool_true_representation`, `bool_false_representation` и `input_format_null_as_default`. Закрывает [#91681](https://github.com/ClickHouse/ClickHouse/issues/91681). [#95040](https://github.com/ClickHouse/ClickHouse/pull/95040) ([Nihal Z. Miaji](https://github.com/nihalzp)).
* Исправлена гонка данных в файловом кэше. [#95064](https://github.com/ClickHouse/ClickHouse/pull/95064) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлена редкая гонка данных в Parquet-ридере. [#95068](https://github.com/ClickHouse/ClickHouse/pull/95068) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлен сбой в оптимизации top K, возникавший при `LIMIT = 0`. Закрывает [#93893](https://github.com/ClickHouse/ClickHouse/issues/93893). [#95072](https://github.com/ClickHouse/ClickHouse/pull/95072) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Преобразование из DateTime/целых чисел в Time64 извлекает компонент времени суток с помощью `toTime`, который не является монотонным. Шаблон `ToDateTimeMonotonicity` ошибочно указывал, что это преобразование монотонно, что приводило к исключению &quot;Invalid binary search result in MergeTreeSetIndex&quot; в debug-сборках. [#95125](https://github.com/ClickHouse/ClickHouse/pull/95125) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Список записей файла манифеста теперь пересоздаётся только при необходимости (ранее он пересоздавался на каждой итерации). [#95162](https://github.com/ClickHouse/ClickHouse/pull/95162) ([Daniil Ivanik](https://github.com/divanik)).

#### Улучшения сборки/тестирования/упаковки \{#buildtestingpackaging-improvement\}
* Добавлен набор инструментов для профилирования выделений памяти в SQL-парсере ClickHouse с использованием возможностей профилирования кучи jemalloc. [#94072](https://github.com/ClickHouse/ClickHouse/pull/94072) ([Ilya Yatsishin](https://github.com/qoega)).
* Добавлен инструмент, упрощающий отладку выделений памяти в парсере. Он использует метрику jemalloc `stats.allocated` до и после разбора запроса в представление AST, чтобы показать, какие объекты были выделены. Также он поддерживает режим профилирования памяти, который сохраняет дамп профиля до и после разбора для построения отчетов о том, где происходили выделения. [#93523](https://github.com/ClickHouse/ClickHouse/pull/93523) ([Ilya Yatsishin](https://github.com/qoega)).
* Удалены транзитивные включения libc++. [#92523](https://github.com/ClickHouse/ClickHouse/pull/92523) ([Raúl Марín](https://github.com/Algunenano)).
* Некоторые последовательные тесты сделаны параллельными: https://github.com/ClickHouse/ClickHouse/pull/93030/changes#diff-c3a73510dae653c9bbfa24300b32f5d6ec663fd4e72cc4a3d5daa6e4342915df. [#93030](https://github.com/ClickHouse/ClickHouse/pull/93030) ([Nikita Fomichev](https://github.com/fm4v)).
* Упорядочены некоторые флаги сборки. [#93679](https://github.com/ClickHouse/ClickHouse/pull/93679) ([Raúl Марín](https://github.com/Algunenano)).
* Обновление c-ares с v1.34.5 до v1.34.6. Это исправляет уязвимость `CVE-2025-62408` в c-ares, которая не имеет отношения к ClickHouse. [#94129](https://github.com/ClickHouse/ClickHouse/pull/94129) ([Govind R Nair](https://github.com/Revertionist)).
* Переход на `curl` 8.18.0. [#94742](https://github.com/ClickHouse/ClickHouse/pull/94742) ([Konstantin Bogdanov](https://github.com/thevar1able)).