---
description: 'ClickHouse позволяет отправлять на сервер данные, необходимые для обработки
  запроса, вместе с запросом `SELECT`. Эти данные помещаются во временную таблицу и
  могут быть использованы в запросе (например, в операторах `IN`).'
sidebar_label: 'Внешние данные для обработки запросов'
sidebar_position: 130
slug: /engines/table-engines/special/external-data
title: 'Внешние данные для обработки запросов'
doc_type: 'reference'
---

# Внешние данные для обработки запросов

ClickHouse позволяет отправлять на сервер данные, необходимые для обработки запроса, вместе с запросом `SELECT`. Эти данные помещаются во временную таблицу (см. раздел «Временные таблицы») и могут использоваться в запросе (например, в операторах `IN`).

Например, если у вас есть текстовый файл с важными идентификаторами пользователей, вы можете загрузить его на сервер вместе с запросом, который выполняет фильтрацию по этому списку.

Если вам нужно выполнить несколько запросов с большим объёмом внешних данных, не используйте эту возможность. Лучше заранее загрузить данные в БД.

Внешние данные могут быть загружены с помощью клиентской программы командной строки (в неинтерактивном режиме) или через HTTP-интерфейс.

В клиенте командной строки вы можете указать раздел параметров в формате

```bash
--external --file=... [--name=...] [--format=...] [--types=...|--structure=...]
```

У вас может быть несколько таких секций — по числу передаваемых таблиц.

**–external** – Отмечает начало секции.
**–file** – Путь к файлу с дампом таблицы или -, что означает stdin.
Из stdin может быть прочитана только одна таблица.

Следующие параметры являются необязательными: **–name** – Имя таблицы. Если параметр опущен, используется &#95;data.
**–format** – Формат данных в файле. Если параметр опущен, используется TabSeparated.

Один из следующих параметров является обязательным: **–types** – Список типов столбцов, разделённых запятыми. Например: `UInt64,String`. Столбцы будут иметь имена &#95;1, &#95;2, ...
**–structure** – Структура таблицы в формате `UserID UInt64`, `URL String`. Определяет имена и типы столбцов.

Файлы, указанные в &#39;file&#39;, будут прочитаны в формате, указанном в &#39;format&#39;, с использованием типов данных, заданных в &#39;types&#39; или &#39;structure&#39;. Таблица будет загружена на сервер и доступна там как временная таблица с именем из &#39;name&#39;.

Примеры:

```bash
$ echo -ne "1\n2\n3\n" | clickhouse-client --query="SELECT count() FROM test.visits WHERE TraficSourceID IN _data" --external --file=- --types=Int8
849897
$ cat /etc/passwd | sed 's/:/\t/g' | clickhouse-client --query="SELECT shell, count() AS c FROM passwd GROUP BY shell ORDER BY c DESC" --external --file=- --name=passwd --structure='login String, unused String, uid UInt16, gid UInt16, comment String, home String, shell String'
/bin/sh 20
/bin/false      5
/bin/bash       4
/usr/sbin/nologin       1
/bin/sync       1
```

При использовании HTTP-интерфейса внешние данные передаются в формате multipart/form-data. Каждая таблица передаётся как отдельный файл. Имя таблицы берётся из имени файла. В `query_string` передаются параметры `name_format`, `name_types` и `name_structure`, где `name` — это имя таблицы, к которой относятся эти параметры. Значения параметров такие же, как при использовании клиента командной строки.

Пример:

```bash
$ cat /etc/passwd | sed 's/:/\t/g' > passwd.tsv

$ curl -F 'passwd=@passwd.tsv;' 'http://localhost:8123/?query=SELECT+shell,+count()+AS+c+FROM+passwd+GROUP+BY+shell+ORDER+BY+c+DESC&passwd_structure=login+String,+unused+String,+uid+UInt16,+gid+UInt16,+comment+String,+home+String,+shell+String'
/bin/sh 20
/bin/false      5
/bin/bash       4
/usr/sbin/nologin       1
/bin/sync       1
```

Во время распределённой обработки запросов временные таблицы отправляются на все удалённые серверы.
