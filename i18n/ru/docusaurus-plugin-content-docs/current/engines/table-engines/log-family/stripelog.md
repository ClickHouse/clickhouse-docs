---
slug: /engines/table-engines/log-family/stripelog
toc_priority: 32
toc_title: StripeLog
---


# StripeLog

Этот движок принадлежит к семейству логических движков. См. общие свойства логических движков и их различия в статье [Семейство логических движков](../../../engines/table-engines/log-family/index.md).

Используйте этот движок в сценариях, когда необходимо записывать множество таблиц с небольшим объемом данных (менее 1 миллиона строк). Например, эту таблицу можно использовать для хранения входящих пакетных данных для преобразования, где требуется атомарная обработка. 100k экземпляров этого типа таблицы жизнеспособны для сервера ClickHouse. Этот движок таблицы следует предпочесть [Log](./log.md), когда требуется большое количество таблиц. Это делается за счет снижения эффективности чтения.

## Создание таблицы {#table_engines-stripelog-creating-a-table}

``` sql
CREATE TABLE [IF NOT EXISTS] [db.]table_name [ON CLUSTER cluster]
(
    column1_name [type1] [DEFAULT|MATERIALIZED|ALIAS expr1],
    column2_name [type2] [DEFAULT|MATERIALIZED|ALIAS expr2],
    ...
) ENGINE = StripeLog
```

См. подробное описание запроса [CREATE TABLE](/sql-reference/statements/create/table).

## Запись данных {#table_engines-stripelog-writing-the-data}

Движок `StripeLog` хранит все колонки в одном файле. Для каждого запроса `INSERT` ClickHouse добавляет блок данных в конец файла таблицы, записывая колонки одну за другой.

Для каждой таблицы ClickHouse записывает файлы:

- `data.bin` — файл данных.
- `index.mrk` — файл с метками. Метки содержат смещения для каждой колонки каждого добавленного блока данных.

Движок `StripeLog` не поддерживает операции `ALTER UPDATE` и `ALTER DELETE`.

## Чтение данных {#table_engines-stripelog-reading-the-data}

Файл с метками позволяет ClickHouse параллелить чтение данных. Это означает, что запрос `SELECT` возвращает строки в непредсказуемом порядке. Используйте оператор `ORDER BY`, чтобы отсортировать строки.

## Пример использования {#table_engines-stripelog-example-of-use}

Создание таблицы:

``` sql
CREATE TABLE stripe_log_table
(
    timestamp DateTime,
    message_type String,
    message String
)
ENGINE = StripeLog
```

Вставка данных:

``` sql
INSERT INTO stripe_log_table VALUES (now(),'REGULAR','Первая регулярная сообщение')
INSERT INTO stripe_log_table VALUES (now(),'REGULAR','Вторая регулярная сообщение'),(now(),'WARNING','Первое предупреждающее сообщение')
```

Мы использовали два запроса `INSERT`, чтобы создать два блока данных внутри файла `data.bin`.

ClickHouse использует несколько потоков при выборе данных. Каждый поток читает отдельный блок данных и возвращает полученные строки независимо по мере завершения. В результате порядок блоков строк в выводе не совпадает с порядком тех же блоков во входных данных в большинстве случаев. Например:

``` sql
SELECT * FROM stripe_log_table
```

``` text
┌───────────timestamp─┬─message_type─┬─message────────────────────┐
│ 2019-01-18 14:27:32 │ REGULAR      │ Вторая регулярная сообщение │
│ 2019-01-18 14:34:53 │ WARNING      │ Первое предупреждающее сообщение  │
└─────────────────────┴──────────────┴────────────────────────────┘
┌───────────timestamp─┬─message_type─┬─message───────────────────┐
│ 2019-01-18 14:23:43 │ REGULAR      │ Первая регулярная сообщение │
└─────────────────────┴──────────────┴───────────────────────────┘
```

Сортировка результатов (по умолчанию в порядке возрастания):

``` sql
SELECT * FROM stripe_log_table ORDER BY timestamp
```

``` text
┌───────────timestamp─┬─message_type─┬─message────────────────────┐
│ 2019-01-18 14:23:43 │ REGULAR      │ Первая регулярная сообщение  │
│ 2019-01-18 14:27:32 │ REGULAR      │ Вторая регулярная сообщение │
│ 2019-01-18 14:34:53 │ WARNING      │ Первое предупреждающее сообщение  │
└─────────────────────┴──────────────┴────────────────────────────┘
```
