---
description: 'Подробности об альтернативных методах резервного копирования и восстановления'
sidebar_label: 'Альтернативные методы'
slug: /operations/backup/alternative_methods
title: 'Альтернативные методы резервного копирования и восстановления'
doc_type: 'reference'
---



# Альтернативные методы резервного копирования

ClickHouse хранит данные на диске, и существует множество способов резервного копирования дисков.
Ниже приведены некоторые альтернативные подходы, которые использовались ранее и могут подойти
для вашего сценария использования.

### Дублирование исходных данных в другом месте {#duplicating-source-data-somewhere-else}

Часто данные, загружаемые в ClickHouse, поступают через персистентную
очередь, такую как [Apache Kafka](https://kafka.apache.org). В этом случае можно настроить
дополнительный набор подписчиков, которые будут читать тот же поток данных во время его
записи в ClickHouse и сохранять его в холодном хранилище. У большинства компаний
уже есть рекомендуемое по умолчанию холодное хранилище, которым может быть объектное хранилище
или распределённая файловая система, такая как [HDFS](https://hadoop.apache.org/docs/stable/hadoop-project-dist/hadoop-hdfs/HdfsDesign.html).

### Снимки файловой системы {#filesystem-snapshots}

Некоторые локальные файловые системы предоставляют функциональность снимков (например, [ZFS](https://en.wikipedia.org/wiki/ZFS)),
но они могут быть не лучшим выбором для обслуживания активных запросов. Возможным решением
является создание дополнительных реплик с таким типом файловой системы и исключение их
из таблиц [Distributed](/engines/table-engines/special/distributed), которые используются для запросов `SELECT`.
Снимки на таких репликах будут недоступны для любых запросов, изменяющих данные.
В качестве бонуса эти реплики могут иметь специальные аппаратные конфигурации с большим
количеством дисков на сервер, что будет экономически эффективно.

Для меньших объёмов данных простой запрос `INSERT INTO ... SELECT ...` к удалённым таблицам
также может подойти.

### Манипуляции с партами {#manipulations-with-parts}

ClickHouse позволяет использовать запрос `ALTER TABLE ... FREEZE PARTITION ...` для создания
локальной копии партиций таблицы. Это реализовано с использованием жёстких ссылок на папку `/var/lib/clickhouse/shadow/`,
поэтому обычно не требует дополнительного дискового пространства для старых данных. Созданные
копии файлов не обрабатываются сервером ClickHouse, поэтому вы можете просто оставить их там:
у вас будет простая резервная копия, не требующая дополнительной внешней системы,
но она всё равно будет подвержена аппаратным сбоям. По этой причине лучше
удалённо скопировать их в другое место, а затем удалить локальные копии.
Распределённые файловые системы и объектные хранилища по-прежнему являются хорошими вариантами для этого,
но обычные подключённые файловые серверы с достаточной ёмкостью также могут подойти
(в этом случае передача будет происходить через сетевую файловую систему или, возможно, [rsync](https://en.wikipedia.org/wiki/Rsync)).
Данные можно восстановить из резервной копии с помощью запроса `ALTER TABLE ... ATTACH PARTITION ...`

Для получения дополнительной информации о запросах, связанных с манипуляциями с партициями, см.
[документацию по `ALTER`](/sql-reference/statements/alter/partition).

Для автоматизации этого подхода доступен сторонний инструмент: [clickhouse-backup](https://github.com/AlexAkulov/clickhouse-backup).
