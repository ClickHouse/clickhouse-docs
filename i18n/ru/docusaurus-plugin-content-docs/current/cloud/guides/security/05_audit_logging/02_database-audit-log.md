---
sidebar_label: 'Журнал аудита базы данных'
slug: /cloud/security/audit-logging/database-audit-log
title: 'Журнал аудита базы данных'
description: 'На этой странице описано, как просмотреть журнал аудита базы данных'
doc_type: 'guide'
keywords: ['audit logging', 'database logs', 'compliance', 'security', 'monitoring']
---



# Журнал аудита базы данных {#database-audit-log}

ClickHouse по умолчанию ведёт журналы аудита базы данных. На этой странице рассматриваются журналы, относящиеся к безопасности. Дополнительную информацию о данных, записываемых системой, см. в документации по [системным таблицам](/operations/system-tables/overview).

:::tip Хранение журналов
Информация записывается непосредственно в системные таблицы и по умолчанию хранится до 30 дней. Этот период может быть больше или меньше в зависимости от частоты слияний в системе. Пользователи могут принять дополнительные меры для более длительного хранения журналов или экспортировать их в систему управления информацией о безопасности и событиями (SIEM) для долгосрочного хранения. Подробности ниже.
:::


## Журналы событий безопасности {#security-relevant-logs}

ClickHouse регистрирует события базы данных, связанные с безопасностью, преимущественно в журналах сеансов и запросов.

Таблица [system.session_log](/operations/system-tables/session_log) регистрирует успешные и неудачные попытки входа в систему, а также местоположение попытки аутентификации. Эта информация может использоваться для выявления атак с подстановкой учетных данных или атак методом полного перебора на экземпляр ClickHouse.

Пример запроса, показывающего неудачные попытки входа

```sql
select event_time
    ,type
    ,user
    ,auth_type
    ,client_address
FROM clusterAllReplicas('default',system.session_log)
WHERE type='LoginFailure'
LIMIT 100
```

Таблица [system.query_log](/operations/system-tables/query_log) фиксирует активность запросов, выполняемых в экземпляре ClickHouse. Эта информация может быть полезна для определения того, какие запросы выполнил злоумышленник.

Пример запроса для поиска активности пользователя "compromised_account"

```sql
SELECT event_time
    ,address
    ,initial_user
    ,initial_address
    ,forwarded_for
    ,query
FROM clusterAllReplicas('default', system.query_log)
WHERE user=’compromised_account’
```


## Хранение данных логов внутри сервисов {#reatining-log-data-within-services}

Пользователи, которым требуется более длительное хранение или повышенная надежность логов, могут использовать материализованные представления для достижения этих целей. Для получения дополнительной информации о материализованных представлениях, их назначении, преимуществах и способах реализации ознакомьтесь с нашими видео и документацией по [материализованным представлениям](/materialized-views).


## Экспорт логов {#exporting-logs}

Системные логи можно записывать или экспортировать в хранилище, используя различные форматы, совместимые с SIEM-системами. Дополнительную информацию см. в документации по [табличным функциям](/sql-reference/table-functions). Наиболее распространённые методы:

- [Запись в S3](/sql-reference/table-functions/s3)
- [Запись в GCS](/sql-reference/table-functions/gcs)
- [Запись в Azure Blob Storage](/sql-reference/table-functions/azureBlobStorage)
