---
title: 'Конфигурация инфраструктуры'
slug: /cloud/reference/byoc/configurations
sidebar_label: 'Конфигурация инфраструктуры'
keywords: ['BYOC', 'cloud', 'bring your own cloud', 'infrastructure', 'configuration']
description: 'Настройка балансировщиков нагрузки, групп узлов и других инфраструктурных компонентов BYOC'
doc_type: 'reference'
---

На этой странице описаны различные варианты конфигурации инфраструктуры, доступные для вашего развертывания BYOC. Эти конфигурации позволяют настраивать сетевую инфраструктуру, безопасность и вычислительные ресурсы в соответствии с вашими конкретными требованиями.

## Балансировщики нагрузки \{#load-balancers\}

BYOC-развертывания используют **Network Load Balancers (NLB)** для управления и маршрутизации трафика к вашим сервисам ClickHouse. Вы можете выбрать между *публичными* и *приватными* конечными точками балансировщика нагрузки в зависимости от вашей сетевой модели.

| Тип балансировщика нагрузки | Выделенный VPC, управляемый ClickHouse | VPC, управляемый клиентом |
|---------------------------- |:--------------------------------------:|:-------------------------:|
| **Public NLB**             | Включен по умолчанию                    | Отключен по умолчанию     |
| **Private NLB**            | Отключен по умолчанию                   | Включен по умолчанию      |

**Public Load Balancer:**  

- Обеспечивает публичный (доступный из интернета) доступ к вашим сервисам ClickHouse.
- Обычно включен по умолчанию при использовании выделенного VPC, управляемого ClickHouse.
- Отключен по умолчанию при использовании VPC, управляемого клиентом, для повышения безопасности.

**Private Load Balancer:**  

- Обеспечивает приватный (внутренний) доступ, доступный только из ваших подключенных сетей.
- Обычно включен по умолчанию при использовании VPC, управляемого клиентом.
- Отключен по умолчанию при использовании выделенного VPC, управляемого ClickHouse.

Вы можете обратиться в **службу поддержки ClickHouse Cloud**, чтобы настроить, какие конечные точки должны быть включены, в соответствии с вашими требованиями.

### Группа безопасности частного балансировщика нагрузки для AWS \{#private-load-balancer-security-group\}

Если вы выбираете использование частного балансировщика нагрузки для своего развертывания BYOC, необходимо убедиться, что настроены соответствующие правила группы безопасности, позволяющие доступ из ваших целевых частных сетей (таких как пиринговые VPC). По умолчанию группа безопасности разрешает трафик только внутри VPC.

Чтобы настроить группу безопасности для вашего частного балансировщика нагрузки:

**Свяжитесь со службой поддержки ClickHouse**, чтобы запросить изменения во входящих правилах группы безопасности, которые разрешат трафик из ваших конкретных исходных сетей:

- **VPC Peering**: запросите правила, разрешающие трафик из диапазонов CIDR ваших пиринговых VPC.
- **PrivateLink**: изменения группы безопасности не требуются, так как трафик не регулируется группой безопасности балансировщика нагрузки.
- **Другие сетевые конфигурации**: опишите ваш сценарий, чтобы служба поддержки могла помочь соответствующим образом.

:::note
Все изменения в группах безопасности частных балансировщиков нагрузки должны выполняться службой поддержки ClickHouse. Это обеспечивает согласованность конфигурации и предотвращает конфликты в управляемой среде ClickHouse Cloud.
:::

## PrivateLink или Private Service Connect \{#privatelink-or-private-service-connect\}

Для максимальной сетевой изоляции и безопасности развертывания BYOC могут использовать **AWS PrivateLink** или **GCP Private Service Connect**. Эти варианты позволяют вашим приложениям подключаться к сервисам ClickHouse Cloud по приватному соединению без необходимости в пиринге VPC или открытии конечных точек в публичный Интернет.

Пошаговые инструкции по настройке см. в разделе [руководство по настройке частной сети (Private Networking Setup)](/cloud/reference/byoc/onboarding/network).

## Частное подключение к Kubernetes API \{#k8s-api-private-connection\}

По умолчанию endpoint сервера Kubernetes API для вашего кластера BYOC доступен из общедоступного интернета, но доступ к нему ограничен фильтрацией по IP-адресам, допускающей только IP-адреса ClickHouse NAT Gateway. Для повышения уровня безопасности вы можете ограничить сервер Kubernetes API так, чтобы он был доступен исключительно через частные сетевые подключения с использованием Tailscale.

:::note
Если вы полагаетесь исключительно на Tailscale для частного подключения, существует риск, что служба поддержки ClickHouse потеряет доступ к вашей среде в случае недоступности агента Tailscale. Это может привести к задержкам при устранении неполадок или увеличению времени реакции поддержки.
:::

**Свяжитесь со службой поддержки ClickHouse**, чтобы запросить настройку частного API endpoint.

## Группы узлов \{#node-groups\}

Группы узлов Kubernetes представляют собой наборы вычислительных экземпляров, которые предоставляют ресурсы, необходимые для запуска сервисов ClickHouse в развертывании BYOC. ClickHouse Cloud управляет этими группами узлов, автоматически выполняя их настройку и масштабирование.

### Конфигурация по умолчанию \{#default-configuration\}

BYOC-кластеры создаются с двумя основными типами групп узлов:

- **System Node Group**  
  Размещает ключевые системные рабочие нагрузки — такие как ClickHouse Operator, Istio (для service mesh), компоненты мониторинга (Prometheus, Grafana, AlertManager), cluster autoscaler и другие базовые сервисы. Эти узлы обычно используют стандартные экземпляры x86.

- **Workload Node Groups**  
  Предназначены для рабочих нагрузок с данными ClickHouse, включая серверы и службы Keeper. По умолчанию узлы для рабочих нагрузок запускаются на экземплярах на базе ARM, обеспечивая эффективный баланс между производительностью и стоимостью. Однако их также можно настроить с альтернативными профилями CPU/памяти или по запросу перевести на архитектуру x86.

### Настройка групп узлов \{#customizing-node-groups\}

Нужны специализированные ресурсы или архитектуры? Доступны следующие варианты настройки — свяжитесь со службой поддержки ClickHouse для обсуждения и реализации:

- **Выбор типа инстанса**  
  Выберите конкретные типы инстансов для удовлетворения требований по производительности, соответствию требованиям регуляторов, повышенным объёмам памяти/CPU или для использования зарезервированных ресурсов.
- **Соотношение CPU/памяти**  
  Настройте профиль вычислительных ресурсов для рабочих групп узлов в соответствии с вашими потребностями.
- **Архитектура**  
  Переключите рабочие группы узлов с ARM на x86 при необходимости.

> **Примечание:** инстансы Spot (preemptible) _не_ поддерживаются; все группы узлов BYOC по умолчанию работают на on-demand инстансах.

:::note
Все изменения по настройке и конфигурации групп узлов должны согласовываться через службу поддержки ClickHouse. Это обеспечивает совместимость, стабильность и оптимальную производительность.
:::

### Автоматическое масштабирование \{#auto-scaling\}

Группы узлов кластера автоматически масштабируются с помощью кластерного автомасштабировщика в зависимости от:

- Запросов на ресурсы и лимитов подов
- Общей емкости и загрузки кластера
- Потребностей сервиса ClickHouse в масштабировании

Ручное вмешательство не требуется. ClickHouse Cloud берет на себя управление ресурсами и масштабированием вашего развертывания на постоянной основе.