---
slug: /cloud/guides/production-readiness
sidebar_label: 'Готовность к промышленной эксплуатации'
title: 'Руководство по подготовке ClickHouse Cloud к промышленной эксплуатации'
description: 'Руководство для организаций, переходящих от быстрого запуска к корпоративным развертываниям ClickHouse Cloud, готовым к промышленной эксплуатации'
keywords: ['готовность к промышленной эксплуатации', 'корпоративный', 'saml', 'sso', 'terraform', 'мониторинг', 'резервное копирование', 'восстановление после сбоев']
doc_type: 'guide'
---

# Руководство по подготовке ClickHouse Cloud к промышленной эксплуатации {#production-readiness}

Для организаций, которые прошли руководство по быстрому старту и уже имеют активный сервис с поступающими данными

:::note[Вкратце]
Это руководство помогает перейти от быстрого старта к развертываниям ClickHouse Cloud корпоративного уровня. Вы узнаете, как:

- Организовать отдельные среды dev/staging/production для безопасного тестирования
- Интегрировать аутентификацию SAML/SSO с вашим провайдером идентификации
- Автоматизировать развертывания с помощью Terraform или Cloud API
- Подключить мониторинг к вашей инфраструктуре оповещений (Prometheus, PagerDuty)
- Проверить процедуры резервного копирования и задокументировать процессы восстановления после аварий
:::

## Введение {#introduction}

У вас уже успешно работает ClickHouse Cloud для ваших рабочих нагрузок. Теперь вам нужно довести развертывание до уровня, соответствующего корпоративным стандартам промышленной эксплуатации — будь то в результате аудита на соответствие требованиям, инцидента в продакшене из‑за непроверенного запроса или требований ИТ по интеграции с корпоративными системами.

Управляемая платформа ClickHouse Cloud берёт на себя операции с инфраструктурой, автоматическое масштабирование и обслуживание системы. Готовность к корпоративной промышленной эксплуатации требует подключения ClickHouse Cloud к вашей остальной ИТ‑среде через системы аутентификации, инфраструктуру мониторинга, инструменты автоматизации и процессы обеспечения непрерывности бизнеса.

Ваши зоны ответственности для достижения готовности к корпоративной промышленной эксплуатации:
- Организовать отдельные окружения для безопасного тестирования перед развертыванием в продакшене
- Интегрировать существующие провайдеры идентификации и системы управления доступом
- Подключить мониторинг и оповещения к вашей операционной инфраструктуре
- Внедрить практики инфраструктуры‑как‑кода для единообразного управления
- Настроить проверку резервных копий и процедуры восстановления после сбоев
- Настроить управление затратами и интеграцию с биллингом

Это руководство проведёт вас по каждой из этих областей и поможет перейти от работоспособного развертывания ClickHouse Cloud к системе, готовой для корпоративной эксплуатации.

## Стратегия окружений {#environment-strategy}

Создавайте отдельные окружения, чтобы безопасно тестировать изменения до того, как они повлияют на рабочие нагрузки в продуктиве. Большинство инцидентов в продуктиве происходит из‑за нетестированных запросов или изменений конфигурации, развернутых напрямую в продуктивных системах.

:::note
**В ClickHouse Cloud каждое окружение — это отдельный сервис.** В рамках вашей организации вы можете развернуть отдельные сервисы для продуктивного, промежуточного (staging) и тестового (development) окружений, каждый со своими вычислительными ресурсами, хранилищем и собственной конечной точкой доступа (endpoint).
:::

**Структура окружений**: Поддерживайте окружения для продуктива (боевые рабочие нагрузки), staging (валидация, эквивалентная продуктиву) и development (эксперименты отдельных разработчиков или команд).

**Тестирование**: Тестируйте запросы в staging до их развертывания в продуктив. Запросы, корректно работающие на небольших наборах данных, часто приводят к исчерпанию памяти, чрезмерной загрузке CPU или медленному выполнению на продуктивных объемах. Проверяйте изменения конфигурации, включая права пользователей, квоты и настройки сервиса, в staging — ошибки конфигурации, обнаруженные в продуктиве, немедленно приводят к операционным инцидентам.

**Размер окружений**: Подбирайте размер staging‑сервиса так, чтобы он был максимально близок к характеристикам нагрузки в продуктиве. Тестирование на существенно меньшей инфраструктуре может не выявить конфликтов за ресурсы или проблем с масштабированием. Используйте наборы данных, репрезентативные для продуктива, за счет периодического обновления данных или генерации синтетических данных. Рекомендации по выбору размера staging‑окружения и корректному масштабированию сервисов приведены в документации [Рекомендации по выбору размера и аппаратному обеспечению](/guides/sizing-and-hardware-recommendations) и [Масштабирование в ClickHouse Cloud](/manage/scaling). Эти материалы содержат практические советы по выбору объема памяти, CPU и хранилища, а также детали о вариантах вертикального и горизонтального масштабирования, которые помогут сопоставить staging‑окружение с продуктивными рабочими нагрузками.

## Частные сети {#private-networking}

[Частные сети](/cloud/security/connectivity/private-networking) в ClickHouse Cloud позволяют подключать ваши сервисы ClickHouse непосредственно к виртуальной сети в облаке, гарантируя, что данные не проходят через общедоступный интернет. Это особенно важно для организаций с жесткими требованиями по безопасности или соответствию нормативам, а также для тех, кто запускает приложения в приватных подсетях.

ClickHouse Cloud поддерживает частные сети с помощью следующих механизмов:

- [AWS PrivateLink](/manage/security/aws-privatelink): Обеспечивает безопасное подключение между вашей VPC и ClickHouse Cloud без вывода трафика в общедоступный интернет. Поддерживает кросс-региональное подключение и доступен в тарифных планах Scale и Enterprise. Настройка включает создание конечной точки PrivateLink и добавление ее в список разрешенных (allow list) вашей организации и сервиса ClickHouse Cloud. Более подробная информация и пошаговые инструкции приведены в соответствующей документации.
- [GCP Private Service Connect](/manage/security/gcp-private-service-connect) (PSC): Позволяет организовать приватный доступ к ClickHouse Cloud из вашей Google Cloud VPC. Аналогично AWS, доступен в тарифных планах Scale и Enterprise и требует явной настройки конечных точек сервиса и списков разрешенных (allow list). Подробности приведены в соответствующей документации.
- [Azure Private Link](/cloud/security/azure-privatelink): Обеспечивает приватное подключение между вашей Azure VNet и ClickHouse Cloud с поддержкой кросс-региональных соединений. Процесс настройки включает получение псевдонима подключения (connection alias), создание приватной конечной точки и обновление списков разрешенных (allow list). Подробности приведены в соответствующей документации.

Если вам нужны дополнительные технические подробности или пошаговые инструкции по настройке, в связанной документации для каждого провайдера приведены развернутые руководства.

## Корпоративная аутентификация и управление пользователями {#enterprise-authentication}

Переход от консольного управления пользователями к интеграции с корпоративной системой аутентификации является критически важным для готовности к промышленной эксплуатации.

### SSO и социальная аутентификация {#sso-authentication}

[SAML SSO](/cloud/security/saml-setup): ClickHouse Cloud уровня Enterprise поддерживает интеграцию по SAML с провайдерами идентичности, включая Okta, Azure Active Directory и Google Workspace. Настройка SAML требует координации с поддержкой ClickHouse и включает предоставление метаданных вашего IdP и настройку сопоставления атрибутов.

[Социальное SSO](/cloud/security/manage-my-account): ClickHouse Cloud также поддерживает провайдеров социальной аутентификации (Google, Microsoft, GitHub) как столь же безопасную альтернативу SAML SSO. Социальное SSO обеспечивает более быструю настройку для организаций без существующей SAML‑инфраструктуры при сохранении корпоративных стандартов безопасности.

:::note Важное ограничение
Пользователям, аутентифицированным через SAML или социальное SSO, по умолчанию назначается роль «Member», и администратор должен вручную выдать им дополнительные роли после их первого входа. Сопоставление групп с ролями и автоматическое назначение ролей в настоящее время не поддерживаются.
:::

### Проектирование системы контроля доступа {#access-control-design}

ClickHouse Cloud использует роли на уровне организации (Admin, Developer, Billing, Member) и роли на уровне сервисов/баз данных (Service Admin, Read Only, роли SQL console). Проектируйте роли вокруг должностных функций, применяя принцип наименьших привилегий:

- **Пользователи приложений**: сервисные аккаунты с конкретным доступом к базам данных и таблицам
- **Пользователи‑аналитики**: доступ только на чтение к подготовленным наборам данных и отчетным представлениям
- **Пользователи‑администраторы**: полный набор административных возможностей

Настройте квоты, лимиты и профили настроек для управления потреблением ресурсов различными пользователями и ролями. Задайте лимиты по памяти и времени выполнения, чтобы предотвратить влияние отдельных запросов на производительность системы. Отслеживайте использование ресурсов через журналы аудита, сессий и запросов, чтобы выявлять пользователей или приложения, которые часто достигают лимитов. Проводите регулярные проверки доступа, используя возможности аудита ClickHouse Cloud.

### Ограничения управления жизненным циклом пользователей {#user-lifecycle-management}

ClickHouse Cloud в настоящее время не поддерживает SCIM или автоматическое предоставление/отзыв учетных записей через провайдеров идентичности. Пользователи должны удаляться из консоли ClickHouse Cloud вручную после удаления из вашего IdP. Планируйте ручные процессы управления пользователями до появления этих возможностей.

Узнайте больше об [управлении доступом в ClickHouse Cloud](/cloud/security/cloud_access_management) и [настройке SAML SSO](/cloud/security/saml-setup).

## Инфраструктура как код и автоматизация {#infrastructure-as-code}

Управление ClickHouse Cloud с использованием подхода «инфраструктура как код» и автоматизации на основе API обеспечивает согласованность, контроль версий и воспроизводимость конфигурации развертывания.

### Terraform Provider {#terraform-provider}

Настройте провайдер ClickHouse для Terraform с помощью API-ключей, созданных в консоли ClickHouse Cloud:

```terraform
terraform {
  required_providers {
    clickhouse = {
      source  = "ClickHouse/clickhouse"
      version = "~> 2.0"
    }
  }
}

provider "clickhouse" {
  environment     = "production"
  organization_id = var.organization_id
  token_key       = var.token_key
  token_secret    = var.token_secret
}
```

Провайдер Terraform поддерживает создание сервисов, списки доступа по IP-адресам и управление пользователями. Обратите внимание, что провайдер в данный момент не поддерживает импорт уже существующих сервисов или явную настройку резервного копирования. Функции, не поддерживаемые провайдером, необходимо настраивать через консоль или через службу поддержки ClickHouse.

Подробные примеры, включая конфигурацию сервиса и управление сетевым доступом, см. в разделе [Terraform example on how to use Cloud API](/knowledgebase/terraform_example).

### Интеграция с Cloud API {#cloud-api-integration}

Организации с существующими фреймворками автоматизации могут напрямую интегрировать управление ClickHouse Cloud через Cloud API. API предоставляет программный доступ к управлению жизненным циклом сервисов, администрированию пользователей, операциям резервного копирования и получению данных мониторинга.

Распространённые варианты интеграции с API:

* Пользовательские процессы подготовки/развертывания сервисов, интегрированные с внутренними системами управления заявками
* Автоматическая настройка масштабирования на основе расписаний развертывания приложений
* Программная проверка резервных копий и формирование отчётности для процессов обеспечения соответствия требованиям
* Интеграция с существующими платформами управления инфраструктурой

Аутентификация в API использует тот же подход на основе токенов, что и Terraform. Для полного справочника по API и примеров интеграции см. документацию [ClickHouse Cloud API](/cloud/manage/api/api-overview).

## Мониторинг и операционная интеграция {#monitoring-integration}

Подключение ClickHouse Cloud к существующей мониторинговой инфраструктуре обеспечивает наблюдаемость и проактивное обнаружение проблем.

### Встроенный мониторинг {#built-in-monitoring}

ClickHouse Cloud предоставляет расширенную панель мониторинга с метриками в режиме реального времени, включая количество запросов в секунду, использование памяти, загрузку CPU и показатели по хранилищу. Доступ осуществляется через консоль Cloud в разделе Monitoring → Advanced dashboard. Создавайте настраиваемые дашборды, адаптированные под конкретный характер нагрузок или потребление ресурсов отдельными командами.

:::note Типичные пробелы в продакшн-среде
Отсутствие проактивной интеграции системы оповещений с корпоративными системами управления инцидентами и автоматизированным мониторингом затрат. Встроенные дашборды обеспечивают видимость, но для автоматизированного оповещения требуется внешняя интеграция.
:::

### Настройка продакшен-алертинга {#production-alerting}

**Встроенные возможности**: ClickHouse Cloud предоставляет уведомления о биллинговых событиях, событиях масштабирования и состоянии сервиса по электронной почте, в UI и в Slack. Настройте каналы доставки и уровни важности уведомлений в настройках уведомлений консоли.

**Интеграция с корпоративными системами**: Для продвинутого алертинга (PagerDuty, пользовательские webhooks) используйте Prometheus endpoint для экспорта метрик в существующую мониторинговую инфраструктуру:

```yaml
scrape_configs:
  - job_name: "clickhouse"
    static_configs:
      - targets: ["https://api.clickhouse.cloud/v1/organizations/<org_id>/prometheus"]
    basic_auth:
      username: <KEY_ID>
      password: <KEY_SECRET>
```

Для полноценной настройки, включая подробную конфигурацию Prometheus/Grafana и расширенные правила оповещения, см. [руководство по наблюдаемости в ClickHouse Cloud](/use-cases/observability/cloud-monitoring#prometheus).

## Обеспечение непрерывности бизнеса и интеграция со службой поддержки {#business-continuity}

Наличие процедур проверки резервных копий и интеграции со службой поддержки гарантирует, что ваше развертывание ClickHouse Cloud сможет восстанавливаться после инцидентов и получать помощь при необходимости.

### Оценка стратегии резервного копирования {#backup-strategy}

ClickHouse Cloud предоставляет автоматические резервные копии с настраиваемыми периодами хранения. Оцените вашу текущую конфигурацию резервного копирования с точки зрения требований к соответствию и восстановлению. Корпоративные клиенты с особыми требованиями к соответствию в части расположения резервных копий или шифрования могут настроить ClickHouse Cloud на хранение резервных копий в собственных облачных хранилищах (BYOB). Для настройки BYOB свяжитесь со службой поддержки ClickHouse.

### Проверка и тестирование процедур восстановления {#validate-test-recovery}

Большинство организаций обнаруживают пробелы в резервном копировании во время реальных сценариев восстановления. Введите регулярные циклы проверки для проверки целостности резервных копий и тестирования процедур восстановления до наступления инцидентов. Планируйте периодическое тестовое восстановление в непроизводственные среды, документируйте пошаговые процедуры восстановления с указанием оценок по времени, проверяйте полноту восстановленных данных и работоспособность приложения, а также тестируйте процедуры восстановления для разных сценариев отказа (удаление сервиса, повреждение данных, региональные сбои). Поддерживайте в актуальном состоянии операционные инструкции по восстановлению, доступные дежурным командам.

Тестируйте восстановление из резервных копий не реже одного раза в квартал для критически важных производственных сервисов. Организации со строгими требованиями к соответствию могут нуждаться в ежемесячных или даже еженедельных циклах проверки.

### Планирование аварийного восстановления {#disaster-recovery-planning}

Задокументируйте ваши целевые показатели времени восстановления (RTO) и точки восстановления (RPO), чтобы подтвердить, что текущая конфигурация резервного копирования удовлетворяет бизнес-требованиям. Введите регулярное расписание тестирования восстановления из резервных копий и поддерживайте в актуальном состоянии документацию по восстановлению.

**Хранение резервных копий в нескольких регионах**: организации с географическими требованиями к аварийному восстановлению могут настроить ClickHouse Cloud на экспорт резервных копий в принадлежащие клиенту хранилища в альтернативных регионах. Это обеспечивает защиту от региональных сбоев, но требует ручных процедур восстановления. Свяжитесь со службой поддержки ClickHouse, чтобы реализовать кросс-региональный экспорт резервных копий. В будущих версиях платформы будут доступны автоматизированные возможности многорегиональной репликации.

### Интеграция с поддержкой в продуктивной среде {#production-support}

Разберитесь в ожидаемых по вашему текущему уровню поддержки показателях SLA и процедурах эскалации. Создайте внутренние операционные инструкции, определяющие, когда следует привлекать службу поддержки ClickHouse, и интегрируйте эти процедуры с существующими процессами управления инцидентами.

Узнайте больше о [резервном копировании и восстановлении в ClickHouse Cloud](/cloud/manage/backups/overview) и [сервисах поддержки](/about-us/support).

## Следующие шаги {#next-steps}

После внедрения интеграций и процедур, описанных в этом руководстве, перейдите к разделу [обзор ресурсов Cloud](/cloud/get-started/cloud/resource-tour), чтобы ознакомиться с руководствами по [мониторингу](/cloud/get-started/cloud/resource-tour#monitoring), [безопасности](/cloud/get-started/cloud/resource-tour#security) и [оптимизации затрат](/cloud/get-started/cloud/resource-tour#cost-optimization).

Когда текущие [ограничения уровня сервиса](/cloud/manage/cloud-tiers) начинают влиять на вашу рабочую среду, рассмотрите варианты обновления для получения расширенных возможностей, таких как [частное сетевое подключение](/cloud/security/connectivity/private-networking), [TDE/CMEK](/cloud/security/cmek) (прозрачное шифрование данных с ключами шифрования, управляемыми клиентом) или [расширенные варианты резервного копирования](/cloud/manage/backups/configurable-backups).
