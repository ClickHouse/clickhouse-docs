---
slug: /cloud/guides/production-readiness
sidebar_label: 'Готовность к промышленной эксплуатации'
title: 'Руководство по подготовке ClickHouse Cloud к промышленной эксплуатации'
description: 'Руководство для организаций, переходящих от быстрого старта к развёртываниям ClickHouse Cloud уровня enterprise, готовым к промышленной эксплуатации'
keywords: ['готовность к промышленной эксплуатации', 'enterprise', 'saml', 'sso', 'terraform', 'monitoring', 'backup', 'disaster recovery']
doc_type: 'guide'
---



# Руководство по подготовке ClickHouse Cloud к промышленной эксплуатации {#production-readiness}

Для организаций, завершивших руководство по быстрому старту и имеющих активный сервис с поступающими данными

:::note[Коротко]
Это руководство поможет вам перейти от быстрого старта к готовым для корпоративного использования развертываниям ClickHouse Cloud. Вы узнаете, как:

- Создать отдельные окружения для разработки, тестирования и промышленной эксплуатации для безопасного тестирования
- Интегрировать аутентификацию SAML/SSO с вашим провайдером идентификации
- Автоматизировать развертывания с помощью Terraform или Cloud API
- Подключить мониторинг к вашей инфраструктуре оповещений (Prometheus, PagerDuty)
- Проверить процедуры резервного копирования и задокументировать процессы аварийного восстановления
  :::


## Введение {#introduction}

У вас успешно работает ClickHouse Cloud для ваших бизнес-задач. Теперь необходимо привести развертывание в соответствие с корпоративными производственными стандартами — будь то в связи с аудитом соответствия требованиям, производственным инцидентом из-за непроверенного запроса или требованиями ИТ-отдела по интеграции с корпоративными системами.

Управляемая платформа ClickHouse Cloud обеспечивает операции с инфраструктурой, автоматическое масштабирование и обслуживание системы. Готовность к промышленной эксплуатации на корпоративном уровне требует подключения ClickHouse Cloud к вашей ИТ-инфраструктуре через системы аутентификации, инфраструктуру мониторинга, инструменты автоматизации и процессы обеспечения непрерывности бизнеса.

Ваши задачи по обеспечению готовности к промышленной эксплуатации на корпоративном уровне:

- Создать отдельные среды для безопасного тестирования перед развертыванием в production
- Интегрироваться с существующими провайдерами идентификации и системами управления доступом
- Подключить мониторинг и оповещения к вашей операционной инфраструктуре
- Внедрить практики infrastructure-as-code для единообразного управления
- Установить процедуры проверки резервных копий и аварийного восстановления
- Настроить управление затратами и интеграцию с биллинговыми системами

Это руководство проведет вас по каждому из этих направлений, помогая перейти от работающего развертывания ClickHouse Cloud к системе, готовой для корпоративного использования.


## Стратегия управления окружениями {#environment-strategy}

Создайте отдельные окружения для безопасного тестирования изменений перед их применением к production-нагрузкам. Большинство инцидентов в production связаны с непротестированными запросами или изменениями конфигурации, развернутыми непосредственно в production-системах.

:::note
**В ClickHouse Cloud каждое окружение представляет собой отдельный сервис.** Вы создадите отдельные production-, staging- и development-сервисы в рамках вашей организации, каждый со своими вычислительными ресурсами, хранилищем и endpoint.
:::

**Структура окружений**: Поддерживайте production (реальные рабочие нагрузки), staging (валидация, эквивалентная production) и development (индивидуальные/командные эксперименты) окружения.

**Тестирование**: Тестируйте запросы в staging перед развертыванием в production. Запросы, которые работают на небольших наборах данных, часто вызывают исчерпание памяти, чрезмерное использование CPU или медленное выполнение в production-масштабе. Проверяйте изменения конфигурации, включая права пользователей, квоты и настройки сервиса, в staging — ошибки конфигурации, обнаруженные в production, создают немедленные операционные инциденты.

**Размер**: Подбирайте размер staging-сервиса так, чтобы он приближался к характеристикам production-нагрузки. Тестирование на значительно меньшей инфраструктуре может не выявить проблемы конкуренции за ресурсы или масштабирования. Используйте наборы данных, репрезентативные для production, через периодическое обновление данных или генерацию синтетических данных. Для получения рекомендаций по определению размера staging-окружения и правильному масштабированию сервисов обратитесь к документации [Sizing and hardware recommendations](/guides/sizing-and-hardware-recommendations) и [Scaling in ClickHouse Cloud](/manage/scaling). Эти ресурсы предоставляют практические советы по определению размеров памяти, CPU и хранилища, а также подробную информацию о вариантах вертикального и горизонтального масштабирования, которые помогут вам привести staging-окружение в соответствие с production-нагрузками.


## Частные сети {#private-networking}

[Частные сети](/cloud/security/connectivity/private-networking) в ClickHouse Cloud позволяют подключать сервисы ClickHouse напрямую к вашей облачной виртуальной сети, обеспечивая передачу данных в обход публичного интернета. Это необходимо для организаций со строгими требованиями к безопасности или соответствию нормативным требованиям, а также для тех, кто использует приложения в частных подсетях.

ClickHouse Cloud поддерживает частные сети с помощью следующих механизмов:

- [AWS PrivateLink](/manage/security/aws-privatelink): обеспечивает безопасное соединение между вашим VPC и ClickHouse Cloud без передачи трафика через публичный интернет. Поддерживает межрегиональное подключение и доступен в тарифных планах Scale и Enterprise. Настройка включает создание конечной точки PrivateLink и добавление её в список разрешённых для вашей организации и сервиса ClickHouse Cloud. Подробная информация и пошаговые инструкции доступны в документации.
- [GCP Private Service Connect](/manage/security/gcp-private-service-connect) (PSC): обеспечивает частный доступ к ClickHouse Cloud из вашего Google Cloud VPC. Как и в случае с AWS, доступен в тарифных планах Scale и Enterprise и требует явной настройки конечных точек сервиса и списков разрешений.
- [Azure Private Link](/cloud/security/azure-privatelink): обеспечивает частное соединение между вашей Azure VNet и ClickHouse Cloud с поддержкой межрегиональных подключений. Процесс настройки включает получение псевдонима подключения, создание частной конечной точки и обновление списков разрешений.

Если вам нужны более подробные технические сведения или пошаговые инструкции по настройке, документация по ссылкам для каждого провайдера содержит исчерпывающие руководства.


## Корпоративная аутентификация и управление пользователями {#enterprise-authentication}

Переход от управления пользователями через консоль к интеграции с корпоративной системой аутентификации необходим для готовности к промышленной эксплуатации.

### SSO и социальная аутентификация {#sso-authentication}

[SAML SSO](/cloud/security/saml-setup): ClickHouse Cloud уровня Enterprise поддерживает интеграцию SAML с провайдерами идентификации, включая Okta, Azure Active Directory и Google Workspace. Настройка SAML требует согласования со службой поддержки ClickHouse и включает предоставление метаданных вашего IdP и настройку сопоставления атрибутов.

[Social SSO](/cloud/security/manage-my-account): ClickHouse Cloud также поддерживает провайдеров социальной аутентификации (Google, Microsoft, GitHub) в качестве равноценной безопасной альтернативы SAML SSO. Social SSO обеспечивает более быструю настройку для организаций, не имеющих инфраструктуры SAML, при сохранении корпоративных стандартов безопасности.

:::note Важное ограничение
Пользователям, прошедшим аутентификацию через SAML или social SSO, по умолчанию назначается роль «Member», и дополнительные роли должны быть предоставлены администратором вручную после первого входа. Сопоставление групп с ролями и автоматическое назначение ролей в настоящее время не поддерживаются.
:::

### Проектирование управления доступом {#access-control-design}

ClickHouse Cloud использует роли на уровне организации (Admin, Developer, Billing, Member) и роли на уровне сервиса/базы данных (Service Admin, Read Only, роли SQL-консоли). Проектируйте роли в соответствии с должностными функциями, применяя принцип минимальных привилегий:

- **Пользователи приложений**: сервисные учетные записи с доступом к конкретным базам данных и таблицам
- **Пользователи-аналитики**: доступ только для чтения к курируемым наборам данных и представлениям для отчетности
- **Пользователи-администраторы**: полные административные возможности

Настройте квоты, лимиты и профили настроек для управления использованием ресурсов различными пользователями и ролями. Установите ограничения на память и время выполнения, чтобы предотвратить влияние отдельных запросов на производительность системы. Отслеживайте использование ресурсов через журналы аудита, сессий и запросов для выявления пользователей или приложений, которые часто достигают лимитов. Проводите регулярные проверки прав доступа с использованием возможностей аудита ClickHouse Cloud.

### Ограничения управления жизненным циклом пользователей {#user-lifecycle-management}

ClickHouse Cloud в настоящее время не поддерживает SCIM или автоматическое предоставление/отзыв доступа через провайдеров идентификации. Пользователи должны быть вручную удалены из консоли ClickHouse Cloud после удаления из вашего IdP. Предусмотрите процессы ручного управления пользователями до тех пор, пока эти функции не станут доступны.

Узнайте больше об [управлении доступом в Cloud](/cloud/security/cloud_access_management) и [настройке SAML SSO](/cloud/security/saml-setup).


## Инфраструктура как код и автоматизация {#infrastructure-as-code}

Управление ClickHouse Cloud с использованием подходов инфраструктуры как кода и автоматизации через API обеспечивает согласованность, контроль версий и воспроизводимость конфигурации развертывания.

### Провайдер Terraform {#terraform-provider}

Настройте провайдер Terraform для ClickHouse, используя API-ключи, созданные в консоли ClickHouse Cloud:

```terraform
terraform {
  required_providers {
    clickhouse = {
      source  = "ClickHouse/clickhouse"
      version = "~> 2.0"
    }
  }
}

provider "clickhouse" {
  environment     = "production"
  organization_id = var.organization_id
  token_key       = var.token_key
  token_secret    = var.token_secret
}
```

Провайдер Terraform поддерживает создание сервисов, списки IP-адресов для доступа и управление пользователями. Обратите внимание, что в настоящее время провайдер не поддерживает импорт существующих сервисов или явную настройку резервного копирования. Для функций, не поддерживаемых провайдером, используйте консоль или обратитесь в службу поддержки ClickHouse.

Подробные примеры, включая конфигурацию сервисов и управление сетевым доступом, см. в разделе [Пример использования Cloud API с Terraform](/knowledgebase/terraform_example).

### Интеграция с Cloud API {#cloud-api-integration}

Организации с существующими фреймворками автоматизации могут интегрировать управление ClickHouse Cloud напрямую через Cloud API. API предоставляет программный доступ к управлению жизненным циклом сервисов, администрированию пользователей, операциям резервного копирования и получению данных мониторинга.

Типичные сценарии интеграции с API:

- Пользовательские процессы создания ресурсов, интегрированные с внутренними системами тикетов
- Автоматическая настройка масштабирования на основе расписаний развертывания приложений
- Программная проверка резервных копий и формирование отчетов для процессов соответствия требованиям
- Интеграция с существующими платформами управления инфраструктурой

Аутентификация в API использует тот же подход на основе токенов, что и Terraform. Полный справочник по API и примеры интеграции см. в документации [ClickHouse Cloud API](/cloud/manage/api/api-overview).


## Мониторинг и операционная интеграция {#monitoring-integration}

Подключение ClickHouse Cloud к существующей инфраструктуре мониторинга обеспечивает прозрачность работы системы и проактивное выявление проблем.

### Встроенный мониторинг {#built-in-monitoring}

ClickHouse Cloud предоставляет расширенную панель управления с метриками в реальном времени, включая количество запросов в секунду, использование памяти, загрузку процессора и скорость операций с хранилищем. Доступ осуществляется через консоль Cloud в разделе Monitoring → Advanced dashboard. Создавайте пользовательские панели, адаптированные под конкретные паттерны нагрузки или потребление ресурсов командой.

:::note Типичные пробелы в production-окружении
Отсутствие проактивной интеграции оповещений с корпоративными системами управления инцидентами и автоматизированного мониторинга затрат. Встроенные панели обеспечивают прозрачность, но автоматические оповещения требуют внешней интеграции.
:::

### Настройка оповещений для production-окружения {#production-alerting}

**Встроенные возможности**: ClickHouse Cloud предоставляет уведомления о событиях биллинга, масштабирования и состояния сервиса через email, UI и Slack. Настройте каналы доставки и уровни важности уведомлений через параметры уведомлений в консоли.

**Корпоративная интеграция**: Для расширенных оповещений (PagerDuty, пользовательские вебхуки) используйте эндпоинт Prometheus для экспорта метрик в существующую инфраструктуру мониторинга:

```yaml
scrape_configs:
  - job_name: "clickhouse"
    static_configs:
      - targets:
          ["https://api.clickhouse.cloud/v1/organizations/<org_id>/prometheus"]
    basic_auth:
      username: <KEY_ID>
      password: <KEY_SECRET>
```

Для полной настройки, включая детальную конфигурацию Prometheus/Grafana и расширенные оповещения, см. [Руководство по наблюдаемости ClickHouse Cloud](/use-cases/observability/cloud-monitoring#prometheus).


## Непрерывность бизнеса и интеграция поддержки {#business-continuity}

Внедрение процедур проверки резервных копий и интеграция поддержки обеспечивают возможность восстановления вашего развёртывания ClickHouse Cloud после инцидентов и получение помощи при необходимости.

### Оценка стратегии резервного копирования {#backup-strategy}

ClickHouse Cloud предоставляет автоматическое резервное копирование с настраиваемыми периодами хранения. Оцените текущую конфигурацию резервного копирования на соответствие требованиям регуляторов и восстановления. Корпоративные клиенты со специфическими требованиями регуляторов относительно расположения резервных копий или шифрования могут настроить ClickHouse Cloud для хранения резервных копий в собственных облачных хранилищах (BYOB). Свяжитесь со службой поддержки ClickHouse для настройки BYOB.

### Проверка и тестирование процедур восстановления {#validate-test-recovery}

Большинство организаций обнаруживают пробелы в резервном копировании во время реальных сценариев восстановления. Установите регулярные циклы проверки для подтверждения целостности резервных копий и тестирования процедур восстановления до возникновения инцидентов. Планируйте периодические тестовые восстановления в непродуктивные среды, документируйте пошаговые процедуры восстановления с указанием временных оценок, проверяйте полноту восстановленных данных и функциональность приложений, а также тестируйте процедуры восстановления при различных сценариях сбоев (удаление сервиса, повреждение данных, региональные сбои). Поддерживайте актуальные руководства по восстановлению, доступные дежурным командам.

Тестируйте восстановление из резервных копий как минимум ежеквартально для критически важных продуктивных сервисов. Организациям со строгими требованиями регуляторов может потребоваться ежемесячная или даже еженедельная проверка.

### Планирование аварийного восстановления {#disaster-recovery-planning}

Задокументируйте целевое время восстановления (RTO) и целевую точку восстановления (RPO), чтобы убедиться, что текущая конфигурация резервного копирования соответствует бизнес-требованиям. Установите регулярные графики тестирования восстановления из резервных копий и поддерживайте актуальную документацию по восстановлению.

**Межрегиональное хранение резервных копий**: Организации с требованиями географического аварийного восстановления могут настроить ClickHouse Cloud для экспорта резервных копий в собственные хранилища клиента в альтернативных регионах. Это обеспечивает защиту от региональных сбоев, но требует ручных процедур восстановления. Свяжитесь со службой поддержки ClickHouse для реализации межрегионального экспорта резервных копий. Будущие выпуски платформы предоставят возможности автоматической многорегиональной репликации.

### Интеграция продуктивной поддержки {#production-support}

Изучите ожидания по SLA вашего текущего уровня поддержки и процедуры эскалации. Создайте внутренние руководства, определяющие, когда обращаться в службу поддержки ClickHouse, и интегрируйте эти процедуры с существующими процессами управления инцидентами.

Узнайте больше о [резервном копировании и восстановлении ClickHouse Cloud](/cloud/manage/backups/overview) и [службах поддержки](/about-us/support).


## Следующие шаги {#next-steps}

После внедрения интеграций и процедур из этого руководства перейдите к [обзору ресурсов Cloud](/cloud/get-started/cloud/resource-tour), где вы найдете руководства по [мониторингу](/cloud/get-started/cloud/resource-tour#monitoring), [безопасности](/cloud/get-started/cloud/resource-tour#security) и [оптимизации затрат](/cloud/get-started/cloud/resource-tour#cost-optimization).

Если текущие [ограничения уровня обслуживания](/cloud/manage/cloud-tiers) влияют на ваши производственные операции, рассмотрите возможность перехода на более высокий уровень для получения расширенных возможностей, таких как [частные сети](/cloud/security/connectivity/private-networking), [TDE/CMEK](/cloud/security/cmek) (прозрачное шифрование данных с использованием ключей, управляемых клиентом) или [расширенные возможности резервного копирования](/cloud/manage/backups/configurable-backups).
