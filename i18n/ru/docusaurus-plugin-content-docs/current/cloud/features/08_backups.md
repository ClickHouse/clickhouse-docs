---
sidebar_label: 'Резервные копии'
slug: /cloud/features/backups
title: 'Резервные копии'
keywords: ['резервные копии', 'резервное копирование в облаке', 'восстановление']
description: 'Обзор функций резервного копирования в ClickHouse Cloud'
doc_type: 'reference'
---

import Image from '@theme/IdealImage';
import ScalePlanFeatureBadge from '@theme/badges/ScalePlanFeatureBadge';
import EnterprisePlanFeatureBadge from '@theme/badges/EnterprisePlanFeatureBadge'
import backup_chain from '@site/static/images/cloud/manage/backup-chain.png';

Резервные копии базы данных служат страховкой, гарантируя, что при потере данных по какой-либо непредвиденной причине сервис можно восстановить до предыдущего состояния из последней успешной резервной копии.
Это сводит время простоя к минимуму и предотвращает безвозвратную потерю критически важных для бизнеса данных.


## Резервные копии {#backups}

### Как работают резервные копии в ClickHouse Cloud {#how-backups-work-in-clickhouse-cloud}

Резервные копии в ClickHouse Cloud представляют собой сочетание «полных» и «инкрементальных» резервных копий, которые образуют цепочку резервного копирования. Цепочка начинается с полной резервной копии, после чего в течение следующих запланированных интервалов времени создаются инкрементальные резервные копии, формируя последовательность. Когда цепочка резервного копирования достигает определённой длины, создаётся новая цепочка. Вся эта цепочка резервных копий затем может быть использована для восстановления данных в новый сервис при необходимости. Когда все резервные копии, входящие в определённую цепочку, выходят за пределы периода хранения, заданного для сервиса (подробнее о хранении ниже), цепочка удаляется.

На скриншоте ниже сплошные квадраты обозначают полные резервные копии, а квадраты пунктирной линией — инкрементальные резервные копии. Сплошной прямоугольник вокруг квадратов обозначает период хранения и резервные копии, которые отображаются конечному пользователю и могут быть использованы для восстановления. В приведённом ниже примере резервные копии создаются каждые 24 часа и хранятся в течение 2 дней.

В День 1 создаётся полная резервная копия для начала цепочки резервного копирования. В День 2 создаётся инкрементальная резервная копия, и у нас теперь есть полная и инкрементальная резервные копии, доступные для восстановления. К Дню 7 у нас есть одна полная резервная копия и шесть инкрементальных в цепочке, при этом две последние инкрементальные резервные копии отображаются пользователю. В День 8 создаётся новая полная резервная копия, а в День 9, когда в новой цепочке уже есть две резервные копии, предыдущая цепочка удаляется.

<Image img={backup_chain} size="lg" alt="Пример цепочки резервного копирования в ClickHouse Cloud" />

### Политика резервного копирования по умолчанию {#default-backup-policy}

В тарифах Basic, Scale и Enterprise резервные копии учитываются и тарифицируются отдельно от хранилища.
Для всех сервисов по умолчанию настроена одна ежедневная резервная копия, с возможностью настроить большее количество, начиная с тарифа Scale, на вкладке Settings консоли Cloud.
Каждая резервная копия будет храниться как минимум 24 часа.

Дополнительные сведения см. в разделе ["Просмотр и восстановление резервных копий"](/cloud/manage/backups/overview).



## Настраиваемые резервные копии {#configurable-backups}

<ScalePlanFeatureBadge feature="Configurable Backups" linking_verb_are="True"/>

ClickHouse Cloud позволяет настраивать расписание создания резервных копий для сервисов уровней **Scale** и **Enterprise**. Резервное копирование можно настраивать по следующим параметрам в зависимости от потребностей вашего бизнеса.

- **Retention (срок хранения)**: Количество дней, в течение которых каждая резервная копия будет храниться. Срок хранения может быть задан от 1 дня до 30 дней с несколькими промежуточными значениями.
- **Frequency (частота)**: Параметр частоты позволяет задать интервал времени между последовательными резервными копиями. Например, частота «каждые 12 часов» означает, что резервные копии будут выполняться с интервалом в 12 часов. Частота может варьироваться от «каждые 6 часов» до «каждые 48 часов» со следующими шагами (в часах): `6`, `8`, `12`, `16`, `20`, `24`, `36`, `48`.
- **Start Time (время начала)**: Время начала, в которое вы хотите ежедневно планировать резервное копирование. Указание времени начала подразумевает, что параметр **Frequency** по умолчанию будет равен одному запуску каждые 24 часа. ClickHouse Cloud начнет создание резервной копии в течение часа после указанного времени начала.

:::note
Пользовательское расписание переопределит политику резервного копирования по умолчанию в ClickHouse Cloud для выбранного сервиса.

В некоторых редких случаях планировщик резервного копирования может не учитывать указанный для резервных копий параметр **Start Time**. В частности, это происходит, если успешное резервное копирование было запущено менее чем за 24 часа до времени текущего запланированного резервного копирования. Это может произойти из‑за механизма повторных попыток, используемого для резервных копий. В таких случаях планировщик пропустит резервное копирование за текущий день и повторит попытку на следующий день в запланированное время.
:::

См. раздел «[Настройка расписаний резервного копирования](/cloud/manage/backups/configurable-backups)» для получения инструкций по настройке резервных копий.



## Резервное копирование в собственный bucket (BYOB) {#byob}

<EnterprisePlanFeatureBadge/>

ClickHouse Cloud позволяет экспортировать резервные копии в хранилище аккаунта вашего собственного облачного провайдера (CSP) (AWS S3, Google Cloud Storage или Azure Blob Storage).
Если вы настраиваете резервное копирование в собственный bucket, ClickHouse Cloud по-прежнему будет ежедневно создавать резервные копии в свой собственный bucket.
Это необходимо для того, чтобы у нас всегда была как минимум одна копия данных для восстановления на случай, если резервные копии в вашем bucket окажутся повреждены.
Подробности о работе резервных копий ClickHouse Cloud см. в документации по [резервным копиям](/cloud/manage/backups/overview).

В этом руководстве мы рассмотрим, как можно экспортировать резервные копии в объектные хранилища AWS, GCP и Azure, а также как восстановить эти резервные копии в вашем аккаунте в новый сервис ClickHouse Cloud.
Мы также приведём команды резервного копирования и восстановления, которые позволяют экспортировать резервные копии в ваш bucket и восстанавливать их.

:::note Резервные копии между регионами
Пользователям следует учитывать, что при любом сценарии, когда резервные копии экспортируются в
другой регион у того же облачного провайдера, будет взиматься плата за [передачу данных](/cloud/manage/network-data-transfer).

В настоящее время мы не поддерживаем межоблачные резервные копии, а также резервное копирование и восстановление для сервисов, использующих [Transparent Data Encryption (TDE)](/cloud/security/cmek#transparent-data-encryption-tde), или для регулируемых сервисов.
:::

См. ["Экспорт резервных копий в собственный облачный аккаунт"](/cloud/manage/backups/export-backups-to-own-cloud-account) для примеров полного и инкрементального резервного копирования в объектные хранилища AWS, GCP и Azure, а также для примеров восстановления из этих резервных копий.

### Варианты резервного копирования {#backup-options}

Чтобы экспортировать резервные копии в собственный облачный аккаунт, у вас есть два варианта:

<VerticalStepper headerLevel="h5">

##### Через интерфейс Cloud Console {#via-ui}

Внешние резервные копии могут быть [настроены в интерфейсе](/cloud/manage/backups/backup-restore-via-ui).
По умолчанию резервные копии будут создаваться ежедневно (как указано в [политике резервного копирования по умолчанию](/cloud/features/backups#default-backup-policy)).
Однако мы также поддерживаем [настраиваемое](/cloud/manage/backups/configurable-backups) резервное копирование в ваш собственный облачный аккаунт, что позволяет задать пользовательское расписание.
Важно отметить, что все резервные копии в ваш bucket являются полными и не связаны с какими-либо предыдущими или будущими резервными копиями.

##### С использованием SQL-команд {#using-commands}

Вы можете использовать [SQL-команды](/cloud/manage/backups/backup-restore-via-commands) для экспорта резервных копий в ваш bucket.

</VerticalStepper>

:::warning
ClickHouse Cloud не управляет жизненным циклом резервных копий в пользовательских bucket.
Клиенты несут ответственность за то, чтобы резервные копии в их bucket корректно управлялись для соблюдения требований комплаенса, а также с точки зрения управления затратами.
Если резервные копии окажутся повреждены, восстановить их будет невозможно.
:::
