---
sidebar_label: 'Резервные копии'
slug: /cloud/features/backups
title: 'Резервные копии'
keywords: ['backups', 'cloud backups', 'restore']
description: 'Обзор функций резервного копирования в ClickHouse Cloud'
doc_type: 'reference'
---

import Image from '@theme/IdealImage';
import ScalePlanFeatureBadge from '@theme/badges/ScalePlanFeatureBadge';
import EnterprisePlanFeatureBadge from '@theme/badges/EnterprisePlanFeatureBadge'
import backup_chain from '@site/static/images/cloud/manage/backup-chain.png';

Резервные копии базы данных обеспечивают дополнительный уровень защиты, гарантируя, что в случае потери данных по какой-либо непредвиденной причине сервис можно восстановить до предыдущего состояния из последней успешной резервной копии.
Это минимизирует время простоя и предотвращает безвозвратную утрату критически важных для бизнеса данных.


## Резервные копии {#backups}

### Как работают резервные копии в ClickHouse Cloud {#how-backups-work-in-clickhouse-cloud}

Резервные копии ClickHouse Cloud представляют собой комбинацию «полных» и «инкрементных» резервных копий, которые образуют цепочку резервного копирования. Цепочка начинается с полной резервной копии, после чего в течение нескольких запланированных периодов времени создаются инкрементные резервные копии, формирующие последовательность. Когда цепочка резервного копирования достигает определенной длины, начинается новая цепочка. Вся эта цепочка резервных копий может быть использована для восстановления данных в новом сервисе при необходимости. Когда все резервные копии, входящие в конкретную цепочку, выходят за пределы установленного для сервиса срока хранения (подробнее о сроке хранения ниже), цепочка удаляется.

На снимке экрана ниже квадраты со сплошной линией показывают полные резервные копии, а квадраты с пунктирной линией — инкрементные резервные копии. Прямоугольник со сплошной линией вокруг квадратов обозначает период хранения и резервные копии, видимые конечному пользователю, которые могут быть использованы для восстановления из резервной копии. В приведенном ниже сценарии резервные копии создаются каждые 24 часа и хранятся в течение 2 дней.

В День 1 создается полная резервная копия для начала цепочки резервного копирования. В День 2 создается инкрементная резервная копия, и теперь у нас есть полная и инкрементная резервные копии, доступные для восстановления. К Дню 7 у нас есть одна полная резервная копия и шесть инкрементных резервных копий в цепочке, при этом пользователю видны две последние инкрементные резервные копии. В День 8 создается новая полная резервная копия, а в День 9, когда в новой цепочке появляются две резервные копии, предыдущая цепочка удаляется.

<Image
  img={backup_chain}
  size='lg'
  alt='Пример цепочки резервного копирования в ClickHouse Cloud'
/>

### Политика резервного копирования по умолчанию {#default-backup-policy}

В тарифах Basic, Scale и Enterprise резервные копии учитываются и оплачиваются отдельно от хранилища.
Для всех сервисов по умолчанию настроено одно ежедневное резервное копирование с возможностью настройки дополнительных копий, начиная с тарифа Scale, через вкладку Settings консоли Cloud.
Каждая резервная копия хранится не менее 24 часов.

Дополнительные сведения см. в разделе [«Просмотр и восстановление резервных копий»](/cloud/manage/backups/overview).


## Настраиваемые резервные копии {#configurable-backups}

<ScalePlanFeatureBadge feature='Configurable Backups' linking_verb_are='True' />

ClickHouse Cloud позволяет настраивать расписание резервного копирования для сервисов уровней **Scale** и **Enterprise**. Резервные копии можно настроить по следующим параметрам в зависимости от ваших бизнес-потребностей.

- **Срок хранения**: Количество дней, в течение которых будет храниться каждая резервная копия. Срок хранения можно задать от 1 до 30 дней с несколькими промежуточными значениями на выбор.
- **Частота**: Частота позволяет указать временной интервал между последовательными резервными копиями. Например, частота «каждые 12 часов» означает, что резервные копии будут создаваться с интервалом в 12 часов. Частота может варьироваться от «каждые 6 часов» до «каждые 48 часов» со следующими почасовыми интервалами: `6`, `8`, `12`, `16`, `20`, `24`, `36`, `48`.
- **Время начала**: Время, когда вы хотите запланировать резервное копирование каждый день. Указание времени начала означает, что «Частота» резервного копирования по умолчанию будет установлена на один раз в 24 часа. ClickHouse Cloud запустит резервное копирование в течение часа после указанного времени начала.

:::note
Пользовательское расписание переопределит стандартную политику резервного копирования в ClickHouse Cloud для вашего сервиса.

В некоторых редких случаях планировщик резервного копирования не будет учитывать указанное **Время начала** для резервных копий. В частности, это происходит, если успешное резервное копирование было запущено менее чем за 24 часа до времени текущего запланированного резервного копирования. Это может произойти из-за механизма повторных попыток, который используется для резервного копирования. В таких случаях планировщик пропустит резервное копирование на текущий день и повторит попытку на следующий день в запланированное время.
:::

См. раздел [«Настройка расписаний резервного копирования»](/cloud/manage/backups/configurable-backups) для получения инструкций по настройке резервных копий.


## Резервные копии в собственное хранилище (BYOB) {#byob}

<EnterprisePlanFeatureBadge />

ClickHouse Cloud позволяет экспортировать резервные копии в хранилище вашего аккаунта облачного провайдера (AWS S3, Google Cloud Storage или Azure Blob Storage).
Если вы настроите резервное копирование в собственное хранилище, ClickHouse Cloud всё равно будет создавать ежедневные резервные копии в своём хранилище.
Это гарантирует наличие хотя бы одной копии данных для восстановления на случай повреждения резервных копий в вашем хранилище.
Подробнее о работе резервного копирования в ClickHouse Cloud см. в документации по [резервным копиям](/cloud/manage/backups/overview).

В этом руководстве мы рассмотрим, как экспортировать резервные копии в объектное хранилище AWS, GCP или Azure, а также как восстановить эти резервные копии в вашем аккаунте на новый сервис ClickHouse Cloud.
Мы также приводим команды резервного копирования и восстановления, которые позволяют экспортировать резервные копии в ваше хранилище и восстанавливать их.

:::note Межрегиональные резервные копии
Пользователям следует учитывать, что экспорт резервных копий в другой регион того же облачного провайдера повлечёт за собой [расходы на передачу данных](/cloud/manage/network-data-transfer).

В настоящее время мы не поддерживаем межоблачное резервное копирование, а также резервное копирование и восстановление для сервисов, использующих [прозрачное шифрование данных (TDE)](/cloud/security/cmek#transparent-data-encryption-tde), или для регулируемых сервисов.
:::

См. раздел [«Экспорт резервных копий в собственный облачный аккаунт»](/cloud/manage/backups/export-backups-to-own-cloud-account) с примерами создания полных и инкрементных резервных копий в объектное хранилище AWS, GCP, Azure, а также восстановления из этих копий.

### Варианты резервного копирования {#backup-options}

Для экспорта резервных копий в собственный облачный аккаунт доступны два варианта:

<VerticalStepper headerLevel="h5">

##### Через пользовательский интерфейс Cloud Console {#via-ui}

Внешние резервные копии можно [настроить в пользовательском интерфейсе](/cloud/manage/backups/backup-restore-via-ui).
По умолчанию резервные копии будут создаваться ежедневно (как указано в [политике резервного копирования по умолчанию](/cloud/features/backups#default-backup-policy)).
Однако мы также поддерживаем [настраиваемое](/cloud/manage/backups/configurable-backups) резервное копирование в ваш собственный облачный аккаунт, что позволяет задать пользовательское расписание.
Важно отметить, что все резервные копии в вашем хранилище являются полными копиями без связи с другими предыдущими или будущими резервными копиями.

##### Использование SQL-команд {#using-commands}

Вы можете использовать [SQL-команды](/cloud/manage/backups/backup-restore-via-commands) для экспорта резервных копий в ваше хранилище.

</VerticalStepper>

:::warning
ClickHouse Cloud не управляет жизненным циклом резервных копий в хранилищах клиентов.
Клиенты несут ответственность за надлежащее управление резервными копиями в своём хранилище для соблюдения стандартов соответствия, а также за управление затратами.
Если резервные копии повреждены, их невозможно будет восстановить.
:::
