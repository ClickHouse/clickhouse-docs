---
slug: /cloud/reference/shared-catalog
sidebar_label: 'Общий каталог'
title: 'Общий каталог и движок общей базы данных'
keywords: ['SharedCatalog', 'SharedDatabaseEngine']
description: 'Описывает компонент Shared Catalog и движок базы данных Shared в ClickHouse Cloud'
doc_type: 'reference'
---



# Общий каталог и движок общей базы данных {#shared-catalog-and-shared-database-engine}

**Доступно исключительно в ClickHouse Cloud (и облачных сервисах партнёров первой стороны)**

Shared Catalog — это облачный компонент, отвечающий за репликацию метаданных и DDL-операций баз данных и таблиц, использующих stateless-движки, между репликами в ClickHouse Cloud. Он обеспечивает согласованное и централизованное управление состоянием этих объектов, гарантируя консистентность метаданных даже в динамичных окружениях или при частичной недоступности.

Shared Catalog **не реплицирует сами таблицы**, но обеспечивает согласованное представление определений баз данных и таблиц на всех репликах путём репликации DDL-запросов и метаданных.

Он поддерживает репликацию следующих движков баз данных:

- Shared
- PostgreSQL
- MySQL
- DataLakeCatalog


## Архитектура и хранение метаданных {#architecture-and-metadata-storage}

Все метаданные и история DDL-запросов в Shared Catalog хранятся централизованно в ZooKeeper. Ничего не сохраняется на локальном диске. Такая архитектура обеспечивает:

- Согласованное состояние на всех репликах
- Отсутствие состояния у вычислительных узлов
- Быструю и надёжную инициализацию реплик


## Движок базы данных Shared {#shared-database-engine}

**Движок базы данных Shared** работает совместно с Shared Catalog для управления базами данных, таблицы которых используют **движки таблиц без сохранения состояния**, такие как `SharedMergeTree`. Эти движки таблиц не записывают постоянное состояние на диск и совместимы с динамическими вычислительными средами.

Движок базы данных Shared основан на движке базы данных Replicated и улучшает его, предлагая дополнительные гарантии и операционные преимущества.

### Основные преимущества {#key-benefits}

- **Атомарная операция CREATE TABLE ... AS SELECT**
  Создание таблицы и вставка данных выполняются атомарно — либо вся операция завершается успешно, либо таблица не создается вообще.

- **RENAME TABLE между базами данных**
  Позволяет атомарно перемещать таблицы между базами данных:

  ```sql
  RENAME TABLE db1.table TO db2.table;
  ```

- **Автоматическое восстановление таблиц с помощью UNDROP TABLE**
  Удаленные таблицы сохраняются в течение 8 часов по умолчанию и могут быть восстановлены:

  ```sql
  UNDROP TABLE my_table;
  ```

  Период хранения настраивается через параметры сервера.

- **Улучшенное разделение вычислительных ресурсов**
  В отличие от движка базы данных Replicated, который требует, чтобы все реплики были онлайн для обработки запроса DROP, Shared Catalog выполняет централизованное удаление метаданных. Это позволяет операциям завершаться успешно, даже когда некоторые реплики находятся в офлайне.

- **Автоматическая репликация метаданных**
  Shared Catalog обеспечивает автоматическую репликацию определений баз данных на все серверы при запуске. Операторам не требуется вручную настраивать или синхронизировать метаданные на новых экземплярах.

- **Централизованное версионированное состояние метаданных**
  Shared Catalog хранит единственный источник истины в ZooKeeper. При запуске реплика получает последнее состояние и применяет различия для достижения согласованности. Во время выполнения запроса система может ожидать, пока другие реплики достигнут как минимум требуемой версии метаданных для обеспечения корректности.


## Использование в ClickHouse Cloud {#usage-in-clickhouse-cloud}

Для конечных пользователей использование Shared Catalog и движка баз данных Shared не требует дополнительной настройки. Создание базы данных выполняется стандартным образом:

```sql
CREATE DATABASE my_database;
```

ClickHouse Cloud автоматически назначает движок баз данных Shared создаваемым базам данных. Любые таблицы, созданные в такой базе данных с использованием stateless-движков, автоматически получат преимущества функций репликации и координации Shared Catalog.


## Резюме {#summary}

Shared Catalog и движок баз данных Shared обеспечивают:

- Надёжную и автоматическую репликацию метаданных для stateless-движков
- Stateless-вычисления без локального сохранения метаданных
- Атомарные операции для сложных DDL-запросов
- Улучшенную поддержку эластичных, эфемерных или частично автономных вычислительных сред
- Простоту использования для пользователей ClickHouse Cloud

Эти возможности делают Shared Catalog основой для масштабируемого облачного управления метаданными в ClickHouse Cloud.
