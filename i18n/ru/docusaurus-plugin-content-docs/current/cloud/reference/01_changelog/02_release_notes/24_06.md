---
slug: /changelogs/24.6
title: 'Журнал изменений версии 24.6 для Cloud'
description: 'Журнал изменений быстрого релиза версии 24.6'
keywords: ['changelog', 'cloud']
sidebar_label: '24.6'
sidebar_position: 7
doc_type: 'changelog'
---



# Журнал изменений v24.6 для Cloud

Соответствующие изменения в сервисах ClickHouse Cloud на основе релиза v24.6.



## Обратно несовместимые изменения {#backward-incompatible-change}

- Переработана параллельная обработка в режиме `Ordered` движка `S3Queue`. Это изменение обратно несовместимо для режима Ordered, если вы использовали настройки `s3queue_processing_threads_num` или `s3queue_total_shards_num`. Настройка `s3queue_total_shards_num` удалена; ранее её можно было использовать только с `s3queue_allow_experimental_sharded_mode`, которая теперь устарела. Добавлена новая настройка — `s3queue_buckets`. [#64349](https://github.com/ClickHouse/ClickHouse/pull/64349) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Добавлены новые функции `snowflakeIDToDateTime`, `snowflakeIDToDateTime64`, `dateTimeToSnowflakeID` и `dateTime64ToSnowflakeID`. В отличие от существующих функций `snowflakeToDateTime`, `snowflakeToDateTime64`, `dateTimeToSnowflake` и `dateTime64ToSnowflake`, новые функции совместимы с функцией `generateSnowflakeID`, то есть они принимают идентификаторы Snowflake, сгенерированные `generateSnowflakeID`, и возвращают идентификаторы Snowflake того же типа, что и `generateSnowflakeID` (то есть `UInt64`). Кроме того, новые функции по умолчанию используют эпоху UNIX (то есть 1970-01-01), так же как и `generateSnowflakeID`. При необходимости можно передать другую эпоху, например эпоху Twitter/X 2010-11-04, то есть 1288834974657 мс с начала эпохи UNIX. Старые функции преобразования устарели и будут удалены после переходного периода; чтобы использовать их в любом случае, включите настройку `allow_deprecated_snowflake_conversion_functions`. [#64948](https://github.com/ClickHouse/ClickHouse/pull/64948) ([Robert Schulze](https://github.com/rschu1ze)).


## Новые возможности {#new-feature}

- Добавлена поддержка пустых кортежей. [#55061](https://github.com/ClickHouse/ClickHouse/pull/55061) ([Amos Bird](https://github.com/amosbird)).
- Добавлены функции кодирования и декодирования кривой Гильберта. [#60156](https://github.com/ClickHouse/ClickHouse/pull/60156) ([Artem Mustafin](https://github.com/Artemmm91)).
- Добавлена поддержка анализа индексов над `hilbertEncode`. [#64662](https://github.com/ClickHouse/ClickHouse/pull/64662) ([Artem Mustafin](https://github.com/Artemmm91)).
- Добавлена поддержка чтения геометрии `LINESTRING` в формате WKT с помощью функции `readWKTLineString`. [#62519](https://github.com/ClickHouse/ClickHouse/pull/62519) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
- Добавлена новая SQL-функция `generateSnowflakeID` для генерации идентификаторов Snowflake в стиле Twitter. [#63577](https://github.com/ClickHouse/ClickHouse/pull/63577) ([Danila Puzov](https://github.com/kazalika)).
- Добавлена поддержка сравнения типов `IPv4` и `IPv6` с помощью оператора `=`. [#64292](https://github.com/ClickHouse/ClickHouse/pull/64292) ([Francisco J. Jurado Moreno](https://github.com/Beetelbrox)).
- Добавлена поддержка десятичных аргументов в бинарных математических функциях (pow, atan2, max2, min2, hypot). [#64582](https://github.com/ClickHouse/ClickHouse/pull/64582) ([Mikhail Gorshkov](https://github.com/mgorshkov)).
- Добавлены SQL-функции `parseReadableSize` (вместе с вариантами `OrNull` и `OrZero`). [#64742](https://github.com/ClickHouse/ClickHouse/pull/64742) ([Francisco J. Jurado Moreno](https://github.com/Beetelbrox)).
- Добавлен виртуальный столбец `_time` для файловых хранилищ (s3/file/hdfs/url/azureBlobStorage). [#64947](https://github.com/ClickHouse/ClickHouse/pull/64947) ([Ilya Golshtein](https://github.com/ilejn)).
- Добавлены новые функции `base64URLEncode`, `base64URLDecode` и `tryBase64URLDecode`. [#64991](https://github.com/ClickHouse/ClickHouse/pull/64991) ([Mikhail Gorshkov](https://github.com/mgorshkov)).
- Добавлена новая функция `editDistanceUTF8`, которая вычисляет [расстояние редактирования](https://en.wikipedia.org/wiki/Edit_distance) между двумя UTF8-строками. [#65269](https://github.com/ClickHouse/ClickHouse/pull/65269) ([LiuNeng](https://github.com/liuneng1994)).
- Добавлена конфигурация `http_response_headers` для поддержки пользовательских заголовков ответа в пользовательских HTTP-обработчиках. [#63562](https://github.com/ClickHouse/ClickHouse/pull/63562) ([Grigorii](https://github.com/GSokol)).
- Добавлена новая табличная функция `loop` для возврата результатов запроса в бесконечном цикле. [#63452](https://github.com/ClickHouse/ClickHouse/pull/63452) ([Sariel](https://github.com/sarielwxm)). Полезна для тестирования.
- Добавлены два дополнительных столбца в `system.query_log`: `used_privileges` и `missing_privileges`. Столбец `used_privileges` содержит привилегии, которые были проверены во время выполнения запроса, а `missing_privileges` содержит отсутствующие необходимые привилегии. [#64597](https://github.com/ClickHouse/ClickHouse/pull/64597) ([Alexey Katsman](https://github.com/alexkats)).
- Добавлена настройка `output_format_pretty_display_footer_column_names`, которая при включении отображает имена столбцов в конце таблицы для длинных таблиц (по умолчанию 50 строк), при этом пороговое значение минимального количества строк контролируется параметром `output_format_pretty_display_footer_column_names_min_rows`. [#65144](https://github.com/ClickHouse/ClickHouse/pull/65144) ([Shaun Struwig](https://github.com/Blargian)).


## Повышение производительности {#performance-improvement}


* Исправлена регрессия производительности в `CROSS JOIN`, появившаяся в #60459 (24.5). #65243 (Nikita Taranov).
* Улучшена наблюдаемость повторных отправок io&#95;uring. Переименовано событие профилирования IOUringSQEsResubmits в IOUringSQEsResubmitsAsync и добавлено новое IOUringSQEsResubmitsSync. #63699 (Tomer Shafir).
* Добавлены проверки для гарантии, что все функции вызываются с колонками правильного размера. #63723 (Raúl Marín).
* Добавлена возможность менять порядок строк во время вставки для оптимизации размера без нарушения порядка, заданного `PRIMARY KEY`. Управляется настройкой `optimize_row_order` (по умолчанию выключена). [#63578](https://github.com/ClickHouse/ClickHouse/pull/63578) ([Igor Markelov](https://github.com/ElderlyPassionFruit)).
* Добавлен нативный паркетный ридер, который может напрямую считывать двоичный формат Parquet в столбцы ClickHouse. Им управляет настройка `input_format_parquet_use_native_reader` (по умолчанию отключена). [#60361](https://github.com/ClickHouse/ClickHouse/pull/60361) ([ZhiHong Zhang](https://github.com/copperybean)).
* Добавлена поддержка частичной тривиальной оптимизации `count`, когда фильтр запроса может выбирать точные диапазоны из таблиц семейства MergeTree. [#60463](https://github.com/ClickHouse/ClickHouse/pull/60463) ([Amos Bird](https://github.com/amosbird)).
* Снижено максимальное потребление памяти многопоточными `INSERT` за счёт сбора чанков из нескольких потоков в одном преобразовании. [#61047](https://github.com/ClickHouse/ClickHouse/pull/61047) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Снизить потребление памяти при использовании объектного хранилища Azure за счет фиксированного распределения памяти, избегая выделения дополнительного буфера. [#63160](https://github.com/ClickHouse/ClickHouse/pull/63160) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* Снижено количество вызовов виртуальных функций в `ColumnNullable::size`. [#60556](https://github.com/ClickHouse/ClickHouse/pull/60556) ([HappenLee](https://github.com/HappenLee)).
* Ускорена работа `splitByRegexp`, когда аргумент регулярного выражения — одиночный символ. [#62696](https://github.com/ClickHouse/ClickHouse/pull/62696) ([Robert Schulze](https://github.com/rschu1ze)).
* Ускорена агрегация по 8- и 16-битным ключам за счёт отслеживания минимального и максимального использованных значений ключей. Это позволяет сократить количество ячеек, которые нужно проверять. [#62746](https://github.com/ClickHouse/ClickHouse/pull/62746) ([Jiebin Sun](https://github.com/jiebinn)).
* Оптимизирован оператор IN для случая, когда левая часть имеет тип `LowCardinality`, а правая — набор констант. [#64060](https://github.com/ClickHouse/ClickHouse/pull/64060) ([Zhiguo Zhou](https://github.com/ZhiguoZh)).
* Использовать пул потоков для инициализации и удаления хеш-таблиц внутри `ConcurrentHashJoin`. [#64241](https://github.com/ClickHouse/ClickHouse/pull/64241) ([Nikita Taranov](https://github.com/nickitat)).
* Оптимизированы вертикальные слияния в таблицах с разрежёнными столбцами. [#64311](https://github.com/ClickHouse/ClickHouse/pull/64311) ([Anton Popov](https://github.com/CurtizJ)).
* Включена предварительная выборка данных из удалённой файловой системы во время вертикальных слияний. Это уменьшает задержку вертикальных слияний в таблицах с данными, хранящимися на удалённой файловой системе. [#64314](https://github.com/ClickHouse/ClickHouse/pull/64314) ([Anton Popov](https://github.com/CurtizJ)).
* Снижено количество лишних вызовов `isDefault` в `ColumnSparse::filter` для повышения производительности. [#64426](https://github.com/ClickHouse/ClickHouse/pull/64426) ([Jiebin Sun](https://github.com/jiebinn)).
* Ускорена работа команд keeper-client `find_super_nodes` и `find_big_family` за счёт выполнения нескольких асинхронных запросов getChildren. [#64628](https://github.com/ClickHouse/ClickHouse/pull/64628) ([Alexander Gololobov](https://github.com/davenger)).
* Улучшена работа функций `least`/`greatest` для аргументов с числовыми типами с поддержкой `NULL`. [#64668](https://github.com/ClickHouse/ClickHouse/pull/64668) ([KevinyhZou](https://github.com/KevinyhZou)).
* Разрешает объединять два последовательных шага фильтрации в плане запроса. Это улучшает оптимизацию `filter-push-down`, если условие фильтра можно протолкнуть вниз с родительского шага. [#64760](https://github.com/ClickHouse/ClickHouse/pull/64760) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* Удалена некорректная оптимизация в реализации вертикального FINAL и по умолчанию снова включён вертикальный FINAL-алгоритм. [#64783](https://github.com/ClickHouse/ClickHouse/pull/64783) ([Duc Canh Le](https://github.com/canhld94)).
* Удалены узлы `ALIAS` из выражения фильтрации. Это немного улучшает производительность запросов с `PREWHERE` (с новым анализатором). [#64793](https://github.com/ClickHouse/ClickHouse/pull/64793) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* Повторно включено кеширование сессий OpenSSL. [#65111](https://github.com/ClickHouse/ClickHouse/pull/65111) ([Robert Schulze](https://github.com/rschu1ze)).
* Добавлены настройки для отключения материализации пропускающих индексов и статистики при вставках (`materialize_skip_indexes_on_insert` и `materialize_statistics_on_insert`). [#64391](https://github.com/ClickHouse/ClickHouse/pull/64391) ([Anton Popov](https://github.com/CurtizJ)).
* Использовать выделенный объём памяти для вычисления размера группы строк и уменьшения пикового потребления памяти при записи Parquet в однопоточном режиме. [#64424](https://github.com/ClickHouse/ClickHouse/pull/64424) ([LiuNeng](https://github.com/liuneng1994)).
* Усовершенствован итератор разреженного столбца для сокращения количества вызовов `size`. [#64497](https://github.com/ClickHouse/ClickHouse/pull/64497) ([Jiebin Sun](https://github.com/jiebinn)).
* Обновлено условие использования серверного копирования при создании резервных копий в хранилище объектов Azure Blob Storage. [#64518](https://github.com/ClickHouse/ClickHouse/pull/64518) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* Оптимизировано использование памяти при вертикальных слияниях для таблиц с большим количеством индексов пропуска (`skip`-индексов). [#64580](https://github.com/ClickHouse/ClickHouse/pull/64580) ([Anton Popov](https://github.com/CurtizJ)).





## Улучшение {#improvement}


* Восстановлено прежнее поведение ClickHouse при работе с кортежами и их интерпретации в формате CSV. Это изменение по сути откатывает ClickHouse/ClickHouse#60994 и ограничивает его применение лишь несколькими настройками: output&#95;format&#95;csv&#95;serialize&#95;tuple&#95;into&#95;separate&#95;columns, input&#95;format&#95;csv&#95;deserialize&#95;separate&#95;columns&#95;into&#95;tuple и input&#95;format&#95;csv&#95;try&#95;infer&#95;strings&#95;from&#95;quoted&#95;tuples. #65170 (Nikita Mikhaylov).
* `SHOW CREATE TABLE`, выполненная для системных таблиц, теперь показывает очень удобный уникальный комментарий для каждой таблицы, объясняющий, зачем она нужна. [#63788](https://github.com/ClickHouse/ClickHouse/pull/63788) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Второй аргумент (scale) функций `round()`, `roundBankers()`, `floor()`, `ceil()` и `trunc()` теперь может быть неконстантным. [#64798](https://github.com/ClickHouse/ClickHouse/pull/64798) ([Mikhail Gorshkov](https://github.com/mgorshkov)).
* Избежана возможная взаимоблокировка во время анализа индекса MergeTree при планировании потоков в перегруженном сервисе. [#59427](https://github.com/ClickHouse/ClickHouse/pull/59427) ([Sean Haynes](https://github.com/seandhaynes)).
* Несколько небольших исправлений крайних случаев в поддержке S3 proxy и туннелировании. [#63427](https://github.com/ClickHouse/ClickHouse/pull/63427) ([Arthur Passos](https://github.com/arthurpassos)).
* Добавлены метрики для отслеживания количества каталогов, создаваемых и удаляемых хранилищем метаданных `plain_rewritable`, а также количества записей в отображении между локальными и удалёнными объектами, хранящемся в памяти. [#64175](https://github.com/ClickHouse/ClickHouse/pull/64175) ([Julia Kartseva](https://github.com/jkartseva)).
* Кэш запросов теперь рассматривает идентичные запросы с разными настройками как разные. Это повышает надежность в случаях, когда различные настройки (например, `limit` или `additional_table_filters`) влияют на результат запроса. [#64205](https://github.com/ClickHouse/ClickHouse/pull/64205) ([Robert Schulze](https://github.com/rschu1ze)).
* Добавлена поддержка нестандартного кода ошибки `QpsLimitExceeded` в объектном хранилище как повторяемой (retryable) ошибки. [#64225](https://github.com/ClickHouse/ClickHouse/pull/64225) ([Sema Checherinda](https://github.com/CheSema)).
* Добавлена новая настройка `input_format_parquet_prefer_block_bytes` для управления средним размером выходного блока (в байтах), а значение по умолчанию для `input_format_parquet_max_block_size` изменено на 65409. [#64427](https://github.com/ClickHouse/ClickHouse/pull/64427) ([LiuNeng](https://github.com/liuneng1994)).
* Настройки из пользовательского конфига не влияют на слияния и мутации для `MergeTree` поверх объектного хранилища. [#64456](https://github.com/ClickHouse/ClickHouse/pull/64456) ([alesapin](https://github.com/alesapin)).
* Добавлена поддержка нестандартного кода ошибки `TotalQpsLimitExceeded` в object storage как ошибки, для которой допускается повторный запрос. [#64520](https://github.com/ClickHouse/ClickHouse/pull/64520) ([Sema Checherinda](https://github.com/CheSema)).
* Обновлён расширенный дашборд как для открытой версии, так и для ClickHouse Cloud: добавлен график «Maximum concurrent network connections». [#64610](https://github.com/ClickHouse/ClickHouse/pull/64610) ([Thom O&#39;Connor](https://github.com/thomoco)).
* Улучшен отчет о ходе выполнения для `zeros_mt` и `generateRandom`. [#64804](https://github.com/ClickHouse/ClickHouse/pull/64804) ([Raúl Marín](https://github.com/Algunenano)).
* Добавлена асинхронная метрика `jemalloc.profile.active`, показывающая, активно ли в данный момент семплирование. Это механизм активации, дополняющий `prof.active`: оба должны быть активны, чтобы вызывающий поток выполнял семплирование. [#64842](https://github.com/ClickHouse/ClickHouse/pull/64842) ([Unalian](https://github.com/Unalian)).
* С параметра `allow_experimental_join_condition` снята пометка «важный». Эта пометка могла мешать успешному выполнению распределённых запросов в кластере со смешанными версиями. [#65008](https://github.com/ClickHouse/ClickHouse/pull/65008) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Добавлены асинхронные метрики сервера `DiskGetObjectThrottler*` и `DiskPutObjectThrottler*`, отражающие ограничение на количество запросов в секунду, задаваемое настройками диска `s3_max_get_rps` и `s3_max_put_rps`, а также текущее количество запросов, которые могут быть отправлены без срабатывания ограничения троттлинга на диске. Метрики определяются для каждого диска, для которого настроен лимит. [#65050](https://github.com/ClickHouse/ClickHouse/pull/65050) ([Sergei Trifonov](https://github.com/serxa)).
* Добавлена валидация при создании пользователя с `bcrypt_hash`. [#65242](https://github.com/ClickHouse/ClickHouse/pull/65242) ([Raúl Marín](https://github.com/Algunenano)).
* Добавлены события профилирования для количества строк, прочитанных во время и после `PREWHERE`. [#64198](https://github.com/ClickHouse/ClickHouse/pull/64198) ([Nikita Taranov](https://github.com/nickitat)).
* Вывод запроса в `EXPLAIN PLAN` с параллельными репликами. [#64298](https://github.com/ClickHouse/ClickHouse/pull/64298) ([vdimir](https://github.com/vdimir)).
* Переименовать `allow_deprecated_functions` в `allow_deprecated_error_prone_window_functions`. [#64358](https://github.com/ClickHouse/ClickHouse/pull/64358) ([Raúl Marín](https://github.com/Algunenano)).
* Учитывать настройку `max_read_buffer_size` для файловых дескрипторов также и в табличной функции `file`. [#64532](https://github.com/ClickHouse/ClickHouse/pull/64532) ([Azat Khuzhin](https://github.com/azat)).
* Отключать транзакции для неподдерживаемых хранилищ, даже для материализованных представлений. [#64918](https://github.com/ClickHouse/ClickHouse/pull/64918) ([alesapin](https://github.com/alesapin)).
* Запрещено использование предложения `QUALIFY` в старом анализаторе. Старый анализатор игнорировал `QUALIFY`, что могло приводить к неожиданному удалению данных при мутациях. [#65356](https://github.com/ClickHouse/ClickHouse/pull/65356) ([Dmitry Novik](https://github.com/novikd)).





## Исправление ошибок (видимое пользователю некорректное поведение в официальном стабильном релизе) {#bug-fix-user-visible-misbehavior-in-an-official-stable-release}

- Исправлена работа skip-индекса 'set', который не работал с IN и indexHint(). #62083 (Michael Kolupaev).
- Исправлены запросы с FINAL, которые возвращали неверный результат, когда таблица не использует адаптивную гранулярность. #62432 (Duc Canh Le).
- Добавлена поддержка выполнения функций при присваивании значения параметризованного представления. #63502 (SmitaRKulkarni).
- Исправлено отслеживание памяти для parquet. #63584 (Michael Kolupaev).
- Исправлен редкий случай отсутствия данных в результате распределённого запроса. #63691 (vdimir).
- Исправлено чтение столбцов типа Tuple(Map(LowCardinality(String), String), ...). #63956 (Anton Popov).
- Исправлено разрешение неквалифицированного сопоставления COLUMNS. Сохранён порядок входных столбцов и запрещено использование неизвестных идентификаторов. #63962 (Dmitry Novik).
- Исправлена ошибка циклических псевдонимов для циклических псевдонимов разных типов (выражение и функция). #63993 (Nikolai Kochetov).
- Это исправление использует правильно переопределённый контекст с корректным определителем для каждого отдельного представления в конвейере запроса. #64079 (pufit).
- Исправлен анализатор: устранена ошибка «Not found column» при использовании INTERPOLATE. #64096 (Yakov Olkhovskiy).
- Предотвращена ошибка LOGICAL_ERROR при CREATE TABLE as MaterializedView. #64174 (Raúl Marín).
- Кэш запросов теперь рассматривает два идентичных запроса к разным базам данных как различные. Предыдущее поведение могло использоваться для обхода отсутствующих привилегий на чтение из таблицы. #64199 (Robert Schulze).
- Исправлено возможное аварийное завершение при неперехваченном исключении в ~WriteBufferFromFileDescriptor в StatusFile. #64206 (Kruglov Pavel).
- Исправлена ошибка дублирования псевдонимов для распределённых запросов с ARRAY JOIN. #64226 (Nikolai Kochetov).
- Исправлено неожиданное поведение accurateCast при преобразовании из строки в целое число. #64255 (wudidapaopao).
- Исправлено упрощение CNF в случае, когда любая группа OR содержит взаимоисключающие атомы. #64256 (Eduard Karacharov).
- Исправлена валидация размера дерева запроса. #64377 (Dmitry Novik).
- Исправлена логическая ошибка: некорректное приведение типа для таблицы Buffer с PREWHERE. #64388 (Nikolai Kochetov).
- Исправлены запросы CREATE TABLE AS для таблиц с выражениями по умолчанию. #64455 (Anton Popov).
- Исправлено поведение optimize_read_in_order для ORDER BY ... NULLS FIRST / LAST на таблицах с nullable ключами. #64483 (Eduard Karacharov).
- Исправлены ошибки «Expression nodes list expected 1 projection names» и «Unknown expression or identifier» для запросов с псевдонимами к GLOBAL IN. #64517 (Nikolai Kochetov).
- Исправлена ошибка «Cannot find column» в распределённых запросах с константным CTE в ключе GROUP BY. #64519 (Nikolai Kochetov).
- Исправлен вывод функции formatDateTimeInJodaSyntax, когда форматтер генерирует нечётное количество символов и последний символ равен 0. Например, SELECT formatDateTimeInJodaSyntax(toDate('2012-05-29'), 'D') теперь корректно возвращает 150 вместо прежних 15. #64614 (LiuNeng).
- Агрегация не переписывается, если комбинатор -If уже используется. #64638 (Dmitry Novik).
- Исправлен вывод типа для float (в случае малого буфера, т.е. --max_read_buffer_size 1). #64641 (Azat Khuzhin).
- Исправлена ошибка, которая могла привести к неработающим TTL с выражениями. #64694 (alesapin).
- Исправлено удаление выражений WHERE и PREWHERE, которые всегда истинны (для нового анализатора). #64695 (Nikolai Kochetov).
- Исправлено избыточное исключение частей токен-ориентированными текстовыми индексами (ngrambf, full_text) при фильтрации по результату startsWith, endsWith, match, multiSearchAny. #64720 (Eduard Karacharov).
- Исправлено некорректное поведение экранирования ANSI CSI в функции UTF8::computeWidth. #64756 (Shaun Struwig).
- Исправлен случай некорректного удаления ORDER BY / LIMIT BY в подзапросах. #64766 (Raúl Marín).
- Исправлено (экспериментальное) неравное соединение с подзапросами для множеств, которые находятся в смешанных условиях соединения. #64775 (lgbo).
- Исправлено аварийное завершение в локальном кэше поверх диска plain_rewritable. #64778 (Julia Kartseva).
- Исправлена ошибка «Cannot find column» в распределённом запросе с ARRAY JOIN по вложенному столбцу. Исправляет #64755. #64801 (Nikolai Kochetov).
- Исправлена утечка памяти в политике кэша slru. #64803 (Kseniia Sumarokova).
- Исправлено возможное некорректное отслеживание памяти в нескольких типах запросов: запросы, читающие данные из S3, запросы через протокол http, асинхронные вставки. #64844 (Anton Popov).
- Исправлена ошибка несоответствия структуры блока для запросов с чтением через PREWHERE из материализованного представления, когда материализованное представление имеет столбцы других типов, чем исходная таблица. Исправляет #64611. #64855 (Nikolai Kochetov).
- Исправлено редкое аварийное завершение, когда таблица имеет TTL с подзапросом + реплицируемая база данных + параллельные реплики + анализатор. Это действительно редкий случай, но, пожалуйста, не используйте TTL с подзапросами. #64858 (alesapin).
- Исправлен запрос ALTER MODIFY COMMENT, который был сломан для параметризованных VIEW в ClickHouse/ClickHouse#54211. #65031 (Nikolay Degterinsky).
- Исправлен host_id в DatabaseReplicated, когда включён параметр cluster_secure_connection. Ранее все соединения внутри кластера, созданные DatabaseReplicated, не были защищёнными, даже если параметр был включён. #65054 (Nikolay Degterinsky).
- Исправлена ошибка «Not-ready Set» после оптимизации PREWHERE для StorageMerge. #65057 (Nikolai Kochetov).
- Предотвращена запись в финализированный буфер в файлоподобных хранилищах. #65063 (Kruglov Pavel).
- Исправлена возможная бесконечная длительность запроса в случае циклических псевдонимов. Исправляет #64849. #65081 (Nikolai Kochetov).
- Исправлена ошибка «Unknown expression identifier» для удалённых запросов с INTERPOLATE (псевдоним) (новый анализатор). Исправляет #64636. #65090 (Nikolai Kochetov).
- Исправлено выталкивание арифметических операций из агрегации. В новом анализаторе оптимизация применялась только один раз. #65104 (Dmitry Novik).
- Исправлено переписывание имён агрегатных функций в новом анализаторе. #65110 (Dmitry Novik).
- Возвращается ответ 5xx вместо 200 OK в случае тайм-аута получения при чтении (частей) тела запроса из клиентского сокета. #65118 (Julian Maicher).
- Исправлено возможное аварийное завершение для хеджированных запросов. #65206 (Azat Khuzhin).
- Исправлена ошибка в вычислении с коротким замыканием словарей Hashed и Hashed_Array, которая могла читать неинициализированное число, приводя к различным ошибкам. #65256 (jsc0218).
- Этот PR гарантирует, что тип константы (второй параметр оператора IN) всегда виден во время процесса преобразования типа оператора IN. В противном случае потеря информации о типе может привести к сбою некоторых преобразований, таких как преобразование из DateTime в Date. Исправляет (#64487). #65315 (pn).
