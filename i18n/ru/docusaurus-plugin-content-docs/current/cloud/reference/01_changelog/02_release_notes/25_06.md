---
slug: /changelogs/25.6
title: 'Журнал изменений v25.6 для Cloud'
description: 'Журнал изменений быстрого релиза v25.6'
keywords: ['changelog', 'cloud']
sidebar_label: '25.6'
sidebar_position: 2
doc_type: 'changelog'
---



## Обратно несовместимое изменение {#backward-incompatible-change}

- Функция `geoToH3()` теперь принимает входные данные в порядке (lat, lon, res) (что является стандартным порядком для геометрических функций). Пользователи, желающие сохранить устаревший порядок входных параметров (lon, lat, res), могут установить настройку `geotoh3_lon_lat_input_order = true`. [#78852](https://github.com/ClickHouse/ClickHouse/pull/78852) ([Pratima Patel](https://github.com/pratimapatel2008)).
- Индексы типа `full_text` были переименованы в `gin`. Это соответствует более привычной терминологии PostgreSQL и других баз данных. Существующие индексы типа `full_text` остаются загружаемыми, но будут выбрасывать исключение (с предложением использовать индексы `gin`) при попытке использования их в поиске. [#79024](https://github.com/ClickHouse/ClickHouse/pull/79024) ([Robert Schulze](https://github.com/rschu1ze)).
- Добавлена настройка кэша файловой системы `allow_dynamic_cache_resize`, по умолчанию `false`, для разрешения динамического изменения размера кэша файловой системы. Причина: в определенных окружениях (ClickHouse Cloud) все события масштабирования происходят через перезапуск процесса, и мы хотели бы, чтобы эта функция была явно отключена для большего контроля над поведением и в качестве меры безопасности. Этот PR отмечен как обратно несовместимый, поскольку в старых версиях динамическое изменение размера кэша работало по умолчанию без специальной настройки. [#79148](https://github.com/ClickHouse/ClickHouse/pull/79148) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Удалена поддержка устаревших типов индексов `annoy` и `usearch`. Оба были заглушками в течение длительного времени, т.е. каждая попытка использовать устаревшие индексы в любом случае возвращала ошибку. Если у вас все еще есть индексы `annoy` и `usearch`, пожалуйста, удалите их. [#79802](https://github.com/ClickHouse/ClickHouse/pull/79802) ([Robert Schulze](https://github.com/rschu1ze)). #_ Удалена серверная настройка `format_alter_commands_with_parentheses`. Настройка была введена и отключена по умолчанию в версии 24.2. Она была включена по умолчанию в версии 25.2. Поскольку нет LTS-версий, которые не поддерживают новый формат, мы можем удалить эту настройку. [#79970](https://github.com/ClickHouse/ClickHouse/pull/79970) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)). #_ Незначительное: принудительная установка серверных настроек backup_threads и restore_threads в ненулевые значения. [#80224](https://github.com/ClickHouse/ClickHouse/pull/80224) ([Raúl Marín](https://github.com/Algunenano)).
- Исправлена функция bitNot() для String, чтобы возвращать строку с нулевым завершением. [#80791](https://github.com/ClickHouse/ClickHouse/pull/80791) ([Azat Khuzhin](https://github.com/azat)).


## Новая функция {#new-feature}


* Добавлен новый параметр в `SETTINGS` таблиц MergeTree, который задает кодек сжатия по умолчанию на случай, если в запросе `CREATE` он явно не задан для соответствующих столбцов. Это закрывает [#42005](https://github.com/ClickHouse/ClickHouse/issues/42005). [#66394](https://github.com/ClickHouse/ClickHouse/pull/66394) ([gvoelfin](https://github.com/gvoelfin)).
* Продолжение для [https://github.com/ClickHouse/ClickHouse/pull/71943](https://github.com/ClickHouse/ClickHouse/pull/71943). Этот PR реализует типы данных `Time`/`Time64`. Реализованы новые типы данных: Time (HHH:MM:SS) и Time64 (HHH:MM:SS.`&lt;fractional&gt;`), несколько базовых функций приведения типов и функции для взаимодействия с другими типами данных. Также изменено имя существующей функции `toTime` на `toTimeWithFixedDate`, поскольку функция `toTime` требуется для функции приведения типов (cast). [#75735](https://github.com/ClickHouse/ClickHouse/pull/75735) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Добавлена поддержка коррелированных подзапросов в качестве аргумента выражения `EXISTS` в предложении `WHERE`. Закрывает [#72459](https://github.com/ClickHouse/ClickHouse/issues/72459). [#76078](https://github.com/ClickHouse/ClickHouse/pull/76078) ([Dmitry Novik](https://github.com/novikd)).
* Разрешена запись в таблицы движка Merge. [#77484](https://github.com/ClickHouse/ClickHouse/pull/77484) ([Anton Ivashkin](https://github.com/ianton-ru)).
* Распределённый `INSERT SELECT` для реплицируемых таблиц MergeTree теперь эффективно использует параллельные реплики для параллельного выполнения операций `INSERT`, выбирая разные данные на разных узлах и вставляя их независимо. [#78041](https://github.com/ClickHouse/ClickHouse/pull/78041) ([Igor Nikonov](https://github.com/devcrafter)).
* Добавлены функции `mapContainsValuesLike`/`mapContainsValues`/`mapExtractValuesLike` для фильтрации по значениям map и их поддержка в индексах, использующих фильтр Блума. [#78171](https://github.com/ClickHouse/ClickHouse/pull/78171) ([UnamedRus](https://github.com/UnamedRus)).
* Добавлена таблица `system.iceberg_history`. [#78244](https://github.com/ClickHouse/ClickHouse/pull/78244) ([Smita Kulkarni](https://github.com/SmitaRKulkarni)).
* Добавлено планирование слотов выполнения запросов для рабочих нагрузок, подробности см. по адресу [https://clickhouse.com/docs/operations/workload-scheduling#query&#95;scheduling](https://clickhouse.com/docs/operations/workload-scheduling#query_scheduling). [#78415](https://github.com/ClickHouse/ClickHouse/pull/78415) ([Sergei Trifonov](https://github.com/serxa)).
* Добавлены функции `getServerSetting` и `getMergeTreeSetting`. Закрывает [https://github.com/clickhouse/clickhouse/issues/78318](https://github.com/clickhouse/clickhouse/issues/78318). [#78439](https://github.com/ClickHouse/ClickHouse/pull/78439) ([NamNguyenHoai](https://github.com/NamHoaiNguyen)).
* Добавлена поддержка недопустимых значений в ограничениях настроек. [#78499](https://github.com/ClickHouse/ClickHouse/pull/78499) ([Bharat Nallan](https://github.com/bharatnc)).
* Добавлена новая настройка `iceberg_enable_version_hint`, позволяющая использовать файл `version-hint.text`. [#78594](https://github.com/ClickHouse/ClickHouse/pull/78594) ([Arnaud Briche](https://github.com/arnaudbriche)).
* Предоставляет возможность очищать выбранные таблицы в базе данных по шаблону с использованием ключевого слова `LIKE`. [#78597](https://github.com/ClickHouse/ClickHouse/pull/78597) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* `clickhouse-local` (и его короткий псевдоним `ch`) теперь неявно используют `FROM table`, когда есть входные данные для обработки. Это закрывает [#65023](https://github.com/ClickHouse/ClickHouse/issues/65023). Также в clickhouse-local включено автоопределение формата, если `--input-format` не указан и обрабатывается обычный файл. [#79085](https://github.com/ClickHouse/ClickHouse/pull/79085) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Добавлены функции [`icebergHash`](https://iceberg.apache.org/spec/#appendix-b-32-bit-hash-requirements) и [`icebergBucketTransform`](https://iceberg.apache.org/spec/#bucket-transform-details). Добавлена поддержка отсечения файлов данных в таблицах `Iceberg`, секционированных с помощью [`bucket transfom`](https://iceberg.apache.org/spec/#partitioning). [#79262](https://github.com/ClickHouse/ClickHouse/pull/79262) ([Daniil Ivanik](https://github.com/divanik)).
* Добавлена поддержка CoalescingMergeTree. Тем самым закрывается [#78869](https://github.com/ClickHouse/ClickHouse/issues/78869). [#79344](https://github.com/ClickHouse/ClickHouse/pull/79344) ([Konstantин Vedernikov](https://github.com/scanhex12)).
* Добавить функции `stringBytesUniq` и `stringBytesEntropy` для обнаружения потенциально случайных или зашифрованных данных. [#79350](https://github.com/ClickHouse/ClickHouse/pull/79350) ([Sachin Kumar Singh](https://github.com/sachinkumarsingh092)).
* Добавлена поддержка виртуального столбца `_part_starting_offset` в таблицах семейства MergeTree. Этот столбец представляет собой суммарное количество строк во всех предшествующих частях, вычисляемое при выполнении запроса на основе текущего списка частей. Накопительные значения сохраняются на протяжении всего выполнения запроса и остаются актуальными даже после отсечения частей. Соответствующая внутренняя логика была переработана для поддержки такого поведения. [#79417](https://github.com/ClickHouse/ClickHouse/pull/79417) ([Amos Bird](https://github.com/amosbird)).
* Добавлена настройка `enable_shared_storage_snapshot_in_query` для включения совместного использования одного и того же снимка хранилища всеми подзапросами в рамках одного запроса. Это обеспечивает согласованное чтение из одной и той же таблицы, даже если таблица используется несколько раз внутри запроса. [#79471](https://github.com/ClickHouse/ClickHouse/pull/79471) ([Amos Bird](https://github.com/amosbird)).
* Добавлена поддержка записи столбцов CH JSON в Parquet и чтения столбцов Parquet JSON напрямую как столбцов CH JSON. [#79649](https://github.com/ClickHouse/ClickHouse/pull/79649) ([Nihal Z. Miaji](https://github.com/nihalzp)).
* В состав ClickHouse включён пакет [`chdig`](https://github.com/azat/chdig/) — TUI-интерфейс для ClickHouse (аналог top). [#79666](https://github.com/ClickHouse/ClickHouse/pull/79666) ([Azat Khuzhin](https://github.com/azat)).
* Добавлена поддержка типа `MultiPolygon` для `pointInPolygon`. [#79773](https://github.com/ClickHouse/ClickHouse/pull/79773) ([Nihal Z. Miaji](https://github.com/nihalzp)).
* Реализована поддержка формата GeoParquet. Это закрывает [#75317](https://github.com/ClickHouse/ClickHouse/issues/75317). [#79777](https://github.com/ClickHouse/ClickHouse/pull/79777) ([Konstantin Vedernikov](https://github.com/scanhex12)).
* Добавлена поддержка выполнения запросов к таблицам Delta, доступным через локальную файловую систему, с помощью табличной функции `deltaLakeLocal`. [#79781](https://github.com/ClickHouse/ClickHouse/pull/79781) ([roykim98](https://github.com/roykim98)).
* Добавлена поддержка кодирования и декодирования в base32. [#79809](https://github.com/ClickHouse/ClickHouse/pull/79809) ([Joanna Hulboj](https://github.com/jh0x)).
* Векторный поиск в ClickHouse теперь поддерживает как предварительную, так и последующую фильтрацию и предоставляет дополнительные настройки для более точного управления. (issue [#78161](https://github.com/ClickHouse/ClickHouse/issues/78161)). [#79854](https://github.com/ClickHouse/ClickHouse/pull/79854) ([Shankar Iyer](https://github.com/shankar-iyer)).
* Добавлены вспомогательные функции для чтения формата WKB. Это частично закрывает [#43941](https://github.com/ClickHouse/ClickHouse/issues/43941). [#80139](https://github.com/ClickHouse/ClickHouse/pull/80139) ([Konstantin Vedernikov](https://github.com/scanhex12)).
* Добавлена новая настройка `cast_string_to_date_time_mode`, которая позволяет выбрать режим разбора `DateTime` при приведении из типа `String`. [#80210](https://github.com/ClickHouse/ClickHouse/pull/80210) ([Pavel Kruglov](https://github.com/Avogar)).
* Добавлены функции кодирования и декодирования форматов `Bech32` и `Bech32m` (задача [#40381](https://github.com/ClickHouse/ClickHouse/issues/40381)). [#80239](https://github.com/ClickHouse/ClickHouse/pull/80239) ([George Larionov](https://github.com/glarik)).
* Добавлена поддержка настройки `disk` для движков баз данных Atomic и Ordinary, позволяющей указывать диск для хранения файлов метаданных таблиц. [#80546](https://github.com/ClickHouse/ClickHouse/pull/80546) ([Tuan Pham Anh](https://github.com/tuanpach)).
* Вспомогательные функции для распаковки и сравнения частей MergeTree. [#80573](https://github.com/ClickHouse/ClickHouse/pull/80573) ([Mikhail Artemenko](https://github.com/Michicosun)).
* Вспомогательные функции `timeSeries*` для ускорения некоторых сценариев при работе с временными рядами: - ресемплирование данных на временную сетку с указанными начальной и конечной метками времени и шагом - вычисление функций, аналогичных PromQL: `delta`, `rate`, `idelta` и `irate`. [#80590](https://github.com/ClickHouse/ClickHouse/pull/80590) ([Alexander Gololobov](https://github.com/davenger)).
* Добавлена возможность фильтровать части, выбираемые для выполнения запросов, по диску, на котором они размещены. [#80650](https://github.com/ClickHouse/ClickHouse/pull/80650) ([tanner-bruce](https://github.com/tanner-bruce)).
* Добавлена стартовая страница со списком встроенных веб-инструментов. Она будет открываться при запросе от браузероподобного пользовательского агента. [#81129](https://github.com/ClickHouse/ClickHouse/pull/81129) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Добавлена поддержка фильтрации значений `NULL` в `arrayFirst`, `arrayFirstIndex`, `arrayLast` и `arrayLastIndex`. Исправляет проблему [#81113](https://github.com/ClickHouse/ClickHouse/issues/81113). [#81197](https://github.com/ClickHouse/ClickHouse/pull/81197) ([Lennard Eijsackers](https://github.com/Blokje5)).





## Экспериментальные возможности {#experimental-feature}

- Каталог Hive metastore для озера данных Iceberg. [#77677](https://github.com/ClickHouse/ClickHouse/pull/77677) ([Konstantin Vedernikov](https://github.com/scanhex12)).
- Поддержка явных параметров через пары ключ-значение. В настоящее время поддерживаются обязательный параметр `tokenizer` и два необязательных параметра `max_rows_per_postings_list` и `ngram_size`. [#80262](https://github.com/ClickHouse/ClickHouse/pull/80262) ([Elmi Ahmadov](https://github.com/ahmadov)).
- Экспериментальные индексы типа `gin` переименованы в `text`. Существующие индексы типа `gin` по-прежнему загружаются, но при попытке использовать их в поисковых запросах будет выброшено исключение с рекомендацией использовать индексы типа `text`. [#80855](https://github.com/ClickHouse/ClickHouse/pull/80855) ([Robert Schulze](https://github.com/rschu1ze)).


## Повышение производительности {#performance-improvement}


* Ускорена работа вторичных индексов за счет вычисления их выражений одновременно на нескольких гранулах. [#64109](https://github.com/ClickHouse/ClickHouse/pull/64109) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Добавлен порог (управляется настройкой `parallel_hash_join_threshold`) для возврата к алгоритму `hash`, когда размер правой таблицы меньше этого порога. [#76185](https://github.com/ClickHouse/ClickHouse/pull/76185) ([Nikita Taranov](https://github.com/nickitat)).
* Существующая реализация `Pipe::resize` создаёт единый узел `Resize` или `StrictResize`, вставляя его в топологию конвейера, после чего он действует как центральный узел, соединяющий все входные потоки (узлы выше по потоку) с унифицированным набором выходных потоков (узлы ниже по потоку). Такой дизайн приводит к конкуренции за `ExecutingGraph::Node::status_mutex` во время выполнения графа конвейера, особенно в средах с большим количеством ядер. Когда конвейеры масштабируются до десятков или сотен потоков, эта конкуренция приводит к следующему: [#77562](https://github.com/ClickHouse/ClickHouse/pull/77562) ([Zhiguo Zhou](https://github.com/ZhiguoZh)).
* Улучшена производительность `S3Queue`/`AzureQueue` за счёт возможности выполнять операции `INSERT` параллельно (можно включить с помощью настройки очереди `parallel_inserts=true`). Ранее `S3Queue`/`AzureQueue` могли выполнять параллельно лишь первую часть конвейера (загрузка, парсинг), а `INSERT` был однопоточным. При этом именно `INSERT` почти всегда является узким местом. Теперь производительность практически линейно масштабируется с ростом `processing_threads_num`. [#77671](https://github.com/ClickHouse/ClickHouse/pull/77671) ([Azat Khuzhin](https://github.com/azat)).
* Изменён формат компактных частей: теперь для каждого подпотока сохраняются метки, что позволяет читать отдельные подстолбцы. Старый компактный формат по-прежнему поддерживается для чтения и может быть включён для записи с помощью настройки MergeTree `write_marks_for_substreams_in_compact_parts`. По умолчанию он отключён для более безопасного обновления, так как изменяет хранение компактных частей. В одном из следующих релизов он будет включён по умолчанию. [#77940](https://github.com/ClickHouse/ClickHouse/pull/77940) ([Pavel Kruglov](https://github.com/Avogar)).
* Добавлена новая настройка `use_skip_indexes_in_final_exact_mode`. Если запрос к таблице `ReplacingMergeTree` содержит `FINAL`, чтение только диапазонов таблицы, отобранных с помощью skip-индексов, может приводить к некорректному результату. Эта настройка позволяет гарантировать корректные результаты за счёт сканирования более новых частей, которые пересекаются с диапазонами первичного ключа, возвращёнными skip-индексом. Установите 0 для отключения, 1 для включения. [#78350](https://github.com/ClickHouse/ClickHouse/pull/78350) ([Shankar Iyer](https://github.com/shankar-iyer)).
* Теперь мы используем число реплик для определения размера задачи при чтении с включёнными параллельными репликами. Это обеспечивает более равномерное распределение нагрузки между репликами, когда объём данных для чтения невелик. [#78695](https://github.com/ClickHouse/ClickHouse/pull/78695) ([Nikita Taranov](https://github.com/nickitat)).
* Добавлена возможность параллельного слияния состояний `uniqExact` на финальном этапе распределённой агрегации. [#78703](https://github.com/ClickHouse/ClickHouse/pull/78703) ([Nikita Taranov](https://github.com/nickitat)).
* Исправлена возможная деградация производительности параллельного слияния состояний `uniqExact` для агрегации по ключу. [#78724](https://github.com/ClickHouse/ClickHouse/pull/78724) ([Nikita Taranov](https://github.com/nickitat)).
  #* Заменены запросы `DELETE FROM ... WHERE 1` на `TRUNCATE`. (отменено). [#78739](https://github.com/ClickHouse/ClickHouse/pull/78739) ([Konstantin Vedernikov](https://github.com/scanhex12)).
* Уменьшено количество вызовов API List Blobs к хранилищу Azure. [#78860](https://github.com/ClickHouse/ClickHouse/pull/78860) ([Julia Kartseva](https://github.com/jkartseva)).
* Объединены условия равенства из шага плана запроса `FILTER` с условием `JOIN` там, где это возможно, чтобы их можно было использовать в качестве ключей хеш-таблицы. [#78877](https://github.com/ClickHouse/ClickHouse/pull/78877) ([Dmitry Novik](https://github.com/novikd)).
* Повышена производительность разбора путей Hive за счёт использования `extractKeyValuePairs` вместо регулярных выражений. [#79067](https://github.com/ClickHouse/ClickHouse/pull/79067) ([Arthur Passos](https://github.com/arthurpassos)).
* Повышена производительность распределённой операции `INSERT SELECT` с параллельными репликами. [#79441](https://github.com/ClickHouse/ClickHouse/pull/79441) ([Azat Khuzhin](https://github.com/azat)).
* Добавлена возможность переносить условия с подстолбцами в `PREWHERE`. [#79489](https://github.com/ClickHouse/ClickHouse/pull/79489) ([Pavel Kruglov](https://github.com/Avogar)).
* Улучшена производительность всех типов Bloom-фильтров. [#79800](https://github.com/ClickHouse/ClickHouse/pull/79800) ([Delyan Kratunov](https://github.com/dkratunov)).
* Предотвратить выполнение очистки в `LogSeriesLimiter` при каждом создании экземпляра, чтобы избежать конкуренции за блокировки и ухудшения производительности в сценариях с высокой степенью параллелизма. [#79864](https://github.com/ClickHouse/ClickHouse/pull/79864) ([filimonov](https://github.com/filimonov)).
* Включить `compile_expressions` (JIT-компилятор для фрагментов обычных выражений) по умолчанию. Это закрывает [#51264](https://github.com/ClickHouse/ClickHouse/issues/51264), [#56386](https://github.com/ClickHouse/ClickHouse/issues/56386) и [#66486](https://github.com/ClickHouse/ClickHouse/issues/66486). [#79907](https://github.com/ClickHouse/ClickHouse/pull/79907) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Ускорены запросы благодаря оптимизации тривиального `count`. [#79945](https://github.com/ClickHouse/ClickHouse/pull/79945) ([Raúl Marín](https://github.com/Algunenano)).
* Добавлен оптимальный путь в `UniqExactSet::merge`, когда один из наборов пуст. Также теперь, если левый набор (LHS) двухуровневый, а правый (RHS) одноуровневый, преобразование правого набора в двухуровневый выполняться не будет. [#79971](https://github.com/ClickHouse/ClickHouse/pull/79971) ([Nikita Taranov](https://github.com/nickitat)).
* Добавлен `__attribute__((always_inline))` к функции `convertDecimalsImpl`. [#79999](https://github.com/ClickHouse/ClickHouse/pull/79999) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* По умолчанию параметр `input_format_parquet_bloom_filter_push_down` теперь имеет значение true. Также исправлена ошибка в журнале изменений настроек. [#80058](https://github.com/ClickHouse/ClickHouse/pull/80058) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
  #* По умолчанию логирование теперь асинхронное. Вы можете отключить это, установив `<async>false</async>` внутри `<logger>`. [#80125](https://github.com/ClickHouse/ClickHouse/pull/80125) ([Raúl Marín](https://github.com/Algunenano)).
* Повышена эффективность повторного использования памяти и снижено количество страничных ошибок при использовании двухуровневых хеш-таблиц. [#80245](https://github.com/ClickHouse/ClickHouse/pull/80245) ([Jiebin Sun](https://github.com/jiebinn)).
* Избегайте ненужных обновлений и снижайте конкуренцию за блокировки в QueryConditionCache. [#80247](https://github.com/ClickHouse/ClickHouse/pull/80247) ([Jiebin Sun](https://github.com/jiebinn)).
* Небольшая оптимизация `concatenateBlocks`, которая может быть полезна для параллельного Hash join. [#80328](https://github.com/ClickHouse/ClickHouse/pull/80328) ([李扬](https://github.com/taiyang-li)).
* При выборе диапазонов меток из диапазона первичного ключа нельзя использовать двоичный поиск, если первичный ключ обёрнут функциями. Этот PR смягчает это ограничение: двоичный поиск по‑прежнему может применяться, когда первичный ключ обёрнут всегда монотонной цепочкой функций или когда в RPN присутствует элемент, который всегда истинeн. Этот PR закрывает [#45536](https://github.com/ClickHouse/ClickHouse/issues/45536). [#80597](https://github.com/ClickHouse/ClickHouse/pull/80597) ([zoomxi](https://github.com/zoomxi)).
* Улучшена скорость завершения работы движка Kafka (удалена дополнительная задержка в 3 секунды при наличии нескольких таблиц Kafka). [#80796](https://github.com/ClickHouse/ClickHouse/pull/80796) ([Azat Khuzhin](https://github.com/azat)).
* Снижено потребление памяти при асинхронных вставках и повышена производительность запросов INSERT. [#80972](https://github.com/ClickHouse/ClickHouse/pull/80972) ([Raúl Marín](https://github.com/Algunenano)).
* Не выполнять профилирование процессоров, если таблица лога отключена. [#81256](https://github.com/ClickHouse/ClickHouse/pull/81256) ([Raúl Marín](https://github.com/Algunenano)).
* Ускорена функция `toFixedString`, когда исходное значение уже полностью соответствует требуемому результату. [#81257](https://github.com/ClickHouse/ClickHouse/pull/81257) ([Raúl Marín](https://github.com/Algunenano)).
* Не обрабатывать значения квоты, если для пользователя не заданы ограничения. [#81549](https://github.com/ClickHouse/ClickHouse/pull/81549) ([Raúl Marín](https://github.com/Algunenano)).
* ProcfsMetricsProvider сделан локальным для потока (thread&#95;local), чтобы сохранять файлы открытыми между задачами. [#81576](https://github.com/ClickHouse/ClickHouse/pull/81576) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлена регрессия производительности в отслеживании памяти. [#81694](https://github.com/ClickHouse/ClickHouse/pull/81694) ([Michael Kolupaev](https://github.com/al13n321)).





## Улучшение {#improvement}


#* `clickhouse-local` теперь сохраняет базы данных после перезапуска при указании аргумента командной строки `--path`. Закрывает [#50647](https://github.com/ClickHouse/ClickHouse/issues/50647). Закрывает [#49947](https://github.com/ClickHouse/ClickHouse/issues/49947). [#71722](https://github.com/ClickHouse/ClickHouse/pull/71722) ([Alexey Milovidov](https://github.com/alexey-milovidov)).

* `EXPLAIN SYNTAX` теперь использует новый анализатор. Он возвращает абстрактное синтаксическое дерево (AST), построенное по дереву запроса. Добавлен параметр `query_tree_passes` для управления количеством проходов, выполняемых перед преобразованием дерева запроса в AST. [#74536](https://github.com/ClickHouse/ClickHouse/pull/74536) ([Vladimir Cherkasov](https://github.com/vdimir)).
  #* По умолчанию в кэше файловой системы используется политика кэширования SLRU. [#75072](https://github.com/ClickHouse/ClickHouse/pull/75072) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Переработана логика отправки данных в представления. [#77309](https://github.com/ClickHouse/ClickHouse/pull/77309) ([Sema Checherinda](https://github.com/CheSema)).
* Табличные функции для кластеров объектного хранилища (например, `s3Cluster`) теперь распределяют файлы по репликам для чтения на основе консистентного хеширования, чтобы улучшить локальность кэша. [#77326](https://github.com/ClickHouse/ClickHouse/pull/77326) ([Andrej Hoos](https://github.com/adikus)).
* Обновлять учётные данные доступа к S3 после ошибки `AuthenticationRequired`. [#77353](https://github.com/ClickHouse/ClickHouse/pull/77353) ([Vitaly Baranov](https://github.com/vitlibar)).
* Встроена конфигурация прокси в некоторые HTTP-буферы с помощью билдеров. [#77693](https://github.com/ClickHouse/ClickHouse/pull/77693) ([Arthur Passos](https://github.com/arthurpassos)).
* Добавлены метрики словарей в `system.asynchronous_metrics` - `DictionaryMaxUpdateDelay` - максимальная задержка обновления словаря (в секундах). - `DictionaryTotalFailedUpdates` - количество ошибок с момента последней успешной загрузки во всех словарях. [#78175](https://github.com/ClickHouse/ClickHouse/pull/78175) ([Vlad](https://github.com/codeworse)).
* Добавлены функции `divideOrNull`,`moduloOrNull`, `intDivOrNull`,`positiveModuloOrNull` для возврата значения NULL, если правый аргумент равен нулю. [#78276](https://github.com/ClickHouse/ClickHouse/pull/78276) ([kevinyhzou](https://github.com/KevinyhZou)).
* Функция `isIPAddressInRange` расширена для поддержки типов данных String, IPv4, IPv6, Nullable(String), Nullable(IPv4) и Nullable(IPv6). [#78364](https://github.com/ClickHouse/ClickHouse/pull/78364) ([YjyJeff](https://github.com/YjyJeff)).
* Динамическое изменение настроек пула соединений движка PostgreSQL. [#78414](https://github.com/ClickHouse/ClickHouse/pull/78414) ([Samay Sharma](https://github.com/samay-sharma)).
* Позволяет указывать `_part_offset` в обычной проекции. Это первый шаг к построению индекса проекции. Может использоваться вместе с [#58224](https://github.com/ClickHouse/ClickHouse/issues/58224) и может помочь улучшить [https://github.com/ClickHouse/ClickHouse/pull/63207](https://github.com/ClickHouse/ClickHouse/pull/63207). [#78429](https://github.com/ClickHouse/ClickHouse/pull/78429) ([Amos Bird](https://github.com/amosbird)).
* Улучшена оптимизация ключа шардинга для распределённых запросов. [#78452](https://github.com/ClickHouse/ClickHouse/pull/78452) ([fhw12345](https://github.com/fhw12345)).
* Добавлены новые столбцы (`create_query` и `source`) для `system.named_collections`. Закрыта задача [#78179](https://github.com/ClickHouse/ClickHouse/issues/78179). [#78582](https://github.com/ClickHouse/ClickHouse/pull/78582) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* Добавлено поле `condition` в системную таблицу `system.query_condition_cache`. Оно хранит условие в виде простого текста, хеш которого используется как ключ в кэше условий запроса. [#78671](https://github.com/ClickHouse/ClickHouse/pull/78671) ([Robert Schulze](https://github.com/rschu1ze)).
* Реализована логика, аналогичная перераспределению партиций (rebalance) в Kafka, для `StorageKafka2` с использованием ClickHouse Keeper. Для каждой реплики поддерживаются два типа блокировок партиций: постоянные и временные. Реплика пытается удерживать постоянные блокировки как можно дольше; в любой момент времени на реплике не более чем `all_topic_partitions / active_replicas_count` (где `all_topic_partitions` — это количество всех партиций, а `active_replicas_count` — количество активных реплик) постоянных блокировок, и если их становится больше, реплика освобождает часть партиций. Некоторые партиции удерживаются репликой временно. Максимальное количество временных блокировок на реплике изменяется динамически, чтобы дать другим репликам возможность взять некоторые партиции в постоянные блокировки. При обновлении временных блокировок реплика освобождает их все и заново пытается захватить некоторые другие партиции. [#78726](https://github.com/ClickHouse/ClickHouse/pull/78726) ([Daria Fomina](https://github.com/sinfillo)).
* Добавлены настройки таблицы для конфигурации SASL и учетных данных в табличный движок `Kafka`. Это позволяет настраивать аутентификацию на основе SASL для Kafka и совместимых с Kafka систем непосредственно в операторе `CREATE TABLE`, без необходимости использовать конфигурационные файлы или именованные коллекции. [#78810](https://github.com/ClickHouse/ClickHouse/pull/78810) ([Christoph Wurm](https://github.com/cwurm)).
* Добавлено предупреждение о базах данных, которые могли быть созданы для сохранения повреждённых таблиц. [#78841](https://github.com/ClickHouse/ClickHouse/pull/78841) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* Индексы сходства векторов теперь можно создавать для столбцов типа `BFloat16`. [#78850](https://github.com/ClickHouse/ClickHouse/pull/78850) ([Robert Schulze](https://github.com/rschu1ze)).
* Поддержка меток времени UNIX с дробной частью при разборе DateTime64 в режиме best-effort. [#78908](https://github.com/ClickHouse/ClickHouse/pull/78908) ([Pavel Kruglov](https://github.com/Avogar)).
* В хранилище DeltaLake в реализации delta-kernel исправлена обработка columnMappingMode.name, добавлены тесты для эволюции схемы. [#78921](https://github.com/ClickHouse/ClickHouse/pull/78921) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Улучшена вставка данных в столбец Variant в формате Values за счёт более качественного преобразования значений. [#78923](https://github.com/ClickHouse/ClickHouse/pull/78923) ([Pavel Kruglov](https://github.com/Avogar)).
* Добавлен виртуальный столбец `_time` в движок `S3Queue`. [#78926](https://github.com/ClickHouse/ClickHouse/pull/78926) ([Anton Ivashkin](https://github.com/ianton-ru)).
* Функция `tokens` была расширена и теперь принимает дополнительный аргумент «tokenizer», а также другие аргументы, зависящие от выбранного токенизатора. [#79001](https://github.com/ClickHouse/ClickHouse/pull/79001) ([Elmi Ahmadov](https://github.com/ahmadov)).
* Оператор `SHOW CLUSTER` теперь разворачивает макросы (если они есть) в своём аргументе. [#79006](https://github.com/ClickHouse/ClickHouse/pull/79006) ([arf42](https://github.com/arf42)).
* Хеш-функции теперь поддерживают `NULL` внутри массивов, кортежей и отображений (issues [#48365](https://github.com/ClickHouse/ClickHouse/issues/48365) и [#48623](https://github.com/ClickHouse/ClickHouse/issues/48623)). [#79008](https://github.com/ClickHouse/ClickHouse/pull/79008) ([Michael Kolupaev](https://github.com/al13n321)).
* Поддержка операции refresh в таблицах MergeTree в режиме только для чтения. [#79033](https://github.com/ClickHouse/ClickHouse/pull/79033) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
  #* Обновление cctz до 2025a. [#79043](https://github.com/ClickHouse/ClickHouse/pull/79043) ([Raúl Marín](https://github.com/Algunenano)).
* Настройки, управляющие разрывом соединения при перегрузке CPU, сделаны горячеперезагружаемыми. [#79052](https://github.com/ClickHouse/ClickHouse/pull/79052) ([Alexey Katsman](https://github.com/alexkats)).
* Так лучше с точки зрения удобства использования. [#79066](https://github.com/ClickHouse/ClickHouse/pull/79066) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Включить кэш условий запроса по умолчанию. [#79080](https://github.com/ClickHouse/ClickHouse/pull/79080) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
  #* Добавить возможность отмены действий с вкладками в веб-интерфейсе. Это закрывает [#71284](https://github.com/ClickHouse/ClickHouse/issues/71284). [#79084](https://github.com/ClickHouse/ClickHouse/pull/79084) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Удалить настройки при выполнении `recoverLostReplica` аналогично тому, как это было сделано в [https://github.com/ClickHouse/ClickHouse/pull/78637](https://github.com/ClickHouse/ClickHouse/pull/78637). [#79113](https://github.com/ClickHouse/ClickHouse/pull/79113) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Добавлены счётчики ProfileEvents ParquetReadRowGroups и ParquetPrunedRowGroups для профилирования отсечения по parquet-индексу. [#79180](https://github.com/ClickHouse/ClickHouse/pull/79180) ([flynn](https://github.com/ucasfl)).
* Добавлен префикс контейнера к путям данных, отображаемым в `system.tables` для простых дисков в Azure Blob Storage, для согласованности с S3 и GCP. [#79241](https://github.com/ClickHouse/ClickHouse/pull/79241) ([Julia Kartseva](https://github.com/jkartseva)).
* Добавлена поддержка изменения базы данных на кластере. [#79242](https://github.com/ClickHouse/ClickHouse/pull/79242) ([Tuan Pham Anh](https://github.com/tuanpach)).
* Явно пропускать пропущенные запуски сбора статистики для QueryMetricLog, иначе журналу потребуется много времени, чтобы синхронизироваться с текущим временем. [#79257](https://github.com/ClickHouse/ClickHouse/pull/79257) ([Mikhail Artemenko](https://github.com/Michicosun)).
* Добавлена возможность применять легковесные удаления на лету (с настройками `lightweight_deletes_sync = 0`, `apply_mutations_on_fly = 1`). [#79281](https://github.com/ClickHouse/ClickHouse/pull/79281) ([Anton Popov](https://github.com/CurtizJ)).
* Оптимизированы мутации `ALTER ... DELETE` для частей, в которых должны быть удалены все строки. Теперь в таких случаях вместо исходной части создаётся пустая без выполнения мутации. [#79307](https://github.com/ClickHouse/ClickHouse/pull/79307) ([Anton Popov](https://github.com/CurtizJ)).
* Небольшие оптимизации в `CHColumnToArrowColumn`. [#79308](https://github.com/ClickHouse/ClickHouse/pull/79308) ([Bharat Nallan](https://github.com/bharatnc)).
* Настройка `allow_archive_path_syntax` по ошибке была помечена как экспериментальная. Добавлен тест, предотвращающий включение экспериментальных настроек по умолчанию. [#79320](https://github.com/ClickHouse/ClickHouse/pull/79320) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Настройки кэша страниц теперь можно задавать на уровне отдельного запроса. Это необходимо для более быстрого проведения экспериментов и для возможности тонкой настройки запросов с высокой пропускной способностью и низкой задержкой. [#79337](https://github.com/ClickHouse/ClickHouse/pull/79337) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Не выводить человекочитаемые подсказки для чисел, которые выглядят как большинство 64-битных хэшей. Это закрывает [#79334](https://github.com/ClickHouse/ClickHouse/issues/79334). [#79338](https://github.com/ClickHouse/ClickHouse/pull/79338) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Если данные в формате pretty выводятся в терминал и последующий блок имеет такие же ширины столбцов, вывод может быть продолжен от предыдущего блока, «склеивая» его с предыдущим путём перемещения курсора вверх. Это закрывает [#79333](https://github.com/ClickHouse/ClickHouse/issues/79333). Эта возможность управляется новым параметром `output_format_pretty_glue_chunks`. [#79339](https://github.com/ClickHouse/ClickHouse/pull/79339) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Цвета графиков на расширенных панелях мониторинга будут вычисляться по хешу соответствующего запроса. Это облегчает запоминание и поиск нужного графика при прокрутке панели. [#79341](https://github.com/ClickHouse/ClickHouse/pull/79341) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Добавлена асинхронная метрика `FilesystemCacheCapacity` — общий объём в виртуальной файловой системе `cache`. Это полезно для глобального мониторинга инфраструктуры. [#79348](https://github.com/ClickHouse/ClickHouse/pull/79348) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Оптимизирован доступ к system.parts (чтение размеров столбцов/индексов — только при необходимости). [#79352](https://github.com/ClickHouse/ClickHouse/pull/79352) ([Azat Khuzhin](https://github.com/azat)).
* Выбирать только важные поля для запроса `'SHOW CLUSTER <name>'` вместо всех полей. [#79368](https://github.com/ClickHouse/ClickHouse/pull/79368) ([Tuan Pham Anh](https://github.com/tuanpach)).
* Добавлена возможность задавать настройки хранилища для `DatabaseCatalog`. [#79407](https://github.com/ClickHouse/ClickHouse/pull/79407) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Добавлена поддержка локального хранилища в delta kernel. [#79416](https://github.com/ClickHouse/ClickHouse/pull/79416) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Добавлена настройка на уровне запроса для включения delta-kernel-rs: `allow_experimental_delta_kernel_rs`. [#79418](https://github.com/ClickHouse/ClickHouse/pull/79418) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Исправлен возможный бесконечный цикл при перечислении объектов в хранилищах Azure Blob Storage и S3. [#79425](https://github.com/ClickHouse/ClickHouse/pull/79425) ([Alexander Gololobov](https://github.com/davenger)).
* Теперь ClickHouse также поддерживает параметры запроса в виде `param-<name>` (через дефис) наряду с `param_<name>` (через подчеркивание). Тем самым закрывается [#63093](https://github.com/ClickHouse/ClickHouse/issues/63093). [#79429](https://github.com/ClickHouse/ClickHouse/pull/79429) ([Engel Danila](https://github.com/aaaengel)).
  #* Добавлена настройка кэша файловой системы `max_size_ratio_to_total_space`. [#79460](https://github.com/ClickHouse/ClickHouse/pull/79460) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Подробное предупреждающее сообщение о скидке на трафик при копировании данных из локального хранилища в удалённый S3 при включённой проверке контрольных сумм. [#79464](https://github.com/ClickHouse/ClickHouse/pull/79464) ([VicoWu](https://github.com/VicoWu)).
* В `clickhouse-benchmark` параметр `reconnect` теперь принимает значения 0, 1 или N, определяющие поведение переподключения. [#79465](https://github.com/ClickHouse/ClickHouse/pull/79465) ([Sachin Kumar Singh](https://github.com/sachinkumarsingh092)).
* Добавлена настройка `input_format_max_block_size_bytes` для ограничения размера блоков, создаваемых во входных форматах, в байтах. Это может помочь избежать высокого потребления памяти при импорте данных, когда строки содержат очень большие значения. [#79495](https://github.com/ClickHouse/ClickHouse/pull/79495) ([Pavel Kruglov](https://github.com/Avogar)).
* Повышена производительность и снижено потребление памяти в sparseGrams. [#79517](https://github.com/ClickHouse/ClickHouse/pull/79517) ([Konstantin Vedernikov](https://github.com/scanhex12)).
* По возможности избегать дополнительного копирования блока при вставке в Compact-часть. [#79536](https://github.com/ClickHouse/ClickHouse/pull/79536) ([Pavel Kruglov](https://github.com/Avogar)).
* Включена по умолчанию реализация хранилища `DeltaLake` на основе delta-kernel. [#79541](https://github.com/ClickHouse/ClickHouse/pull/79541) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Если чтение из URL включает несколько перенаправлений, параметр `enable_url_encoding` корректно применяется ко всем перенаправлениям в цепочке. [#79563](https://github.com/ClickHouse/ClickHouse/pull/79563) ([Shankar Iyer](https://github.com/shankar-iyer)).
* Разрешено использовать `ALTER TABLE ... MOVE|REPLACE PARTITION` для таблиц на разных дисках plain&#95;rewritable. [#79566](https://github.com/ClickHouse/ClickHouse/pull/79566) ([Julia Kartseva](https://github.com/jkartseva)).
* Добавлена поддержка скалярных коррелированных подзапросов в предложении `WHERE`. Закрывает [#6697](https://github.com/ClickHouse/ClickHouse/issues/6697). [#79600](https://github.com/ClickHouse/ClickHouse/pull/79600) ([Dmitry Novik](https://github.com/novikd)).
* Ранее при `input_format_parquet_max_block_size = 0` ClickHouse зависал. Теперь эта проблема исправлена. Это закрывает [#79394](https://github.com/ClickHouse/ClickHouse/issues/79394). [#79601](https://github.com/ClickHouse/ClickHouse/pull/79601) ([abashkeev](https://github.com/abashkeev)).
* Добавлена настройка `throw_on_error` для startup&#95;scripts: когда `throw_on_error` имеет значение true, сервер не запустится, пока все запросы не завершатся успешно. По умолчанию значение `throw_on_error` — false, что сохраняет прежнее поведение. [#79732](https://github.com/ClickHouse/ClickHouse/pull/79732) ([Aleksandr Musorin](https://github.com/AVMusorin)).
* Индекс векторного сходства теперь также используется, если опорный вектор имеет тип `Array(BFloat16)`. [#79745](https://github.com/ClickHouse/ClickHouse/pull/79745) ([Shankar Iyer](https://github.com/shankar-iyer)).
* Добавлены `last_error_message`, `last_error_trace` и `query_id` в таблицу `system.error_log`. Связанная задача [#75816](https://github.com/ClickHouse/ClickHouse/issues/75816). [#79836](https://github.com/ClickHouse/ClickHouse/pull/79836) ([Andrei Tinikov](https://github.com/Dolso)).
  #* По умолчанию включена отправка отчётов о сбоях. Это можно отключить в конфигурационном файле сервера. [#79838](https://github.com/ClickHouse/ClickHouse/pull/79838) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Системная таблица `system.functions` теперь показывает, в какой версии ClickHouse функции впервые появились. [#79839](https://github.com/ClickHouse/ClickHouse/pull/79839) ([Robert Schulze](https://github.com/rschu1ze)).
* Добавлена настройка `access_control_improvements.enable_user_name_access_type`. Эта настройка позволяет включать или отключать точные выдачи привилегий (grants) для пользователей и ролей, добавленные в [https://github.com/ClickHouse/ClickHouse/pull/72246](https://github.com/ClickHouse/ClickHouse/pull/72246). Имеет смысл отключить эту настройку, если в вашем кластере есть реплики версии ниже 25.1. [#79842](https://github.com/ClickHouse/ClickHouse/pull/79842) ([pufit](https://github.com/pufit)).
* Правильная реализация метода `ASTSelectWithUnionQuery::clone()` теперь учитывает и поле `is_normalized`. Это может помочь с [#77569](https://github.com/ClickHouse/ClickHouse/issues/77569). [#79909](https://github.com/ClickHouse/ClickHouse/pull/79909) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Добавлена поддержка коррелированных подзапросов в списке проекции в простых случаях. [#79925](https://github.com/ClickHouse/ClickHouse/pull/79925) ([Dmitry Novik](https://github.com/novikd)).
* Исправлено несогласованное форматирование некоторых запросов с оператором `EXCEPT`. Если левая часть оператора EXCEPT заканчивается на `*`, отформатированный запрос теряет скобки и затем парсится как `*` с модификатором `EXCEPT`. Эти запросы находятся фаззером и вряд ли встречаются на практике. Это исправляет [#79950](https://github.com/ClickHouse/ClickHouse/issues/79950). [#79952](https://github.com/ClickHouse/ClickHouse/pull/79952) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Позволяет добавлять `http_response_headers` в любые `http_handlers`. [#79975](https://github.com/ClickHouse/ClickHouse/pull/79975) ([Andrey Zvonov](https://github.com/zvonand)).
* Небольшое улучшение разбора типа JSON за счёт использования кэша порядка десериализации вариантов. [#79984](https://github.com/ClickHouse/ClickHouse/pull/79984) ([Pavel Kruglov](https://github.com/Avogar)).
* Добавлена возможность переноса предиката `GLOBAL [NOT] IN` в секцию `PREWHERE`, если применимо. [#79996](https://github.com/ClickHouse/ClickHouse/pull/79996) ([Eduard Karacharov](https://github.com/korowa)).
* Добавлена настройка `s3_slow_all_threads_after_network_error`. [#80035](https://github.com/ClickHouse/ClickHouse/pull/80035) ([Vitaly Baranov](https://github.com/vitlibar)).
* Уровень логирования о выбранных для слияния частях был указан неверно (Information). Закрывает [#80061](https://github.com/ClickHouse/ClickHouse/issues/80061). [#80062](https://github.com/ClickHouse/ClickHouse/pull/80062) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Функция reverse теперь поддерживает тип данных Tuple. Закрывает [#80053](https://github.com/ClickHouse/ClickHouse/issues/80053). [#80083](https://github.com/ClickHouse/ClickHouse/pull/80083) ([flynn](https://github.com/ucasfl)).
* Значение по умолчанию настройки `enble_url_encoding` теперь равно `False`. [#80088](https://github.com/ClickHouse/ClickHouse/pull/80088) ([Shankar Iyer](https://github.com/shankar-iyer)).
* Этот небольшой патч исправляет [#75817](https://github.com/ClickHouse/ClickHouse/issues/75817): позволяет получать данные `auxiliary_zookeepers` из таблицы `system.zookeeper`. [#80146](https://github.com/ClickHouse/ClickHouse/pull/80146) ([Nikolay Govorov](https://github.com/mrdimidium)).
* Векторный поиск с использованием индекса векторного сходства теперь находится в статусе beta (ранее — experimental). [#80164](https://github.com/ClickHouse/ClickHouse/pull/80164) ([Robert Schulze](https://github.com/rschu1ze)).
* Добавлены асинхронные метрики для TCP-сокетов сервера. Это повышает наблюдаемость. Закрывает [#80187](https://github.com/ClickHouse/ClickHouse/issues/80187). [#80188](https://github.com/ClickHouse/ClickHouse/pull/80188) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Функция `tokens` теперь поддерживает `string` как токенизатор. [#80195](https://github.com/ClickHouse/ClickHouse/pull/80195) ([Robert Schulze](https://github.com/rschu1ze)).
* Параллельные реплики: не ждать медленных неиспользуемых реплик, если все задачи чтения уже распределены по другим репликам. [#80199](https://github.com/ClickHouse/ClickHouse/pull/80199) ([Igor Nikonov](https://github.com/devcrafter)).
* Добавлена поддержка `anylast_respect_nulls` и `any_respect_nulls` в `simpleAggregateFunction`. [#80219](https://github.com/ClickHouse/ClickHouse/pull/80219) ([Diskein](https://github.com/Diskein)).
* Удалён ненужный вызов `adjustCreateQueryForBackup()` для реплицируемых баз данных. [#80282](https://github.com/ClickHouse/ClickHouse/pull/80282) ([Vitaly Baranov](https://github.com/vitlibar)).
  #* Разрешено указывать дополнительные опции (передаваемые после `--`, например `-- --config.value='abc'`) в `clickhouse-local` без знака равенства. Закрывает [#80292](https://github.com/ClickHouse/ClickHouse/issues/80292). [#80293](https://github.com/ClickHouse/ClickHouse/pull/80293) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Подсветить метасимволы в запросах `SHOW ... LIKE`. Это закрывает [#80275](https://github.com/ClickHouse/ClickHouse/issues/80275). [#80297](https://github.com/ClickHouse/ClickHouse/pull/80297) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
  #* Сделать SQL UDF в `clickhouse-local` персистентной. Ранее созданная функция будет загружаться при запуске. Это закрывает [#80085](https://github.com/ClickHouse/ClickHouse/issues/80085). [#80300](https://github.com/ClickHouse/ClickHouse/pull/80300) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Реализована поддержка сравнения между типами `Time` и `Time64`. [#80327](https://github.com/ClickHouse/ClickHouse/pull/80327) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Исправлено описание в плане выполнения запроса для предварительного шага `DISTINCT`. [#80330](https://github.com/ClickHouse/ClickHouse/pull/80330) ([UnamedRus](https://github.com/UnamedRus)).
* Разрешено использовать именованные коллекции в ODBC/JDBC. [#80334](https://github.com/ClickHouse/ClickHouse/pull/80334) ([Andrey Zvonov](https://github.com/zvonand)).
* Включена поддержка фильтрации по нескольким проекциям, что позволяет применять более одной проекции для фильтрации на уровне парта. Это решает проблему [#55525](https://github.com/ClickHouse/ClickHouse/issues/55525). Это второй шаг к реализации индекса проекций, после [#78429](https://github.com/ClickHouse/ClickHouse/issues/78429). [#80343](https://github.com/ClickHouse/ClickHouse/pull/80343) ([Amos Bird](https://github.com/amosbird)).
* Метрики количества дисков только для чтения и повреждённых дисков. Логируется событие при запуске DiskLocalCheckThread. [#80391](https://github.com/ClickHouse/ClickHouse/pull/80391) ([VicoWu](https://github.com/VicoWu)).
* Реализована поддержка хранилища `s3_plain_rewritable` с проекциями. В предыдущих версиях метаданные объектов в S3, которые ссылались на проекции, не обновлялись при их перемещении. Закрывает [#70258](https://github.com/ClickHouse/ClickHouse/issues/70258). [#80393](https://github.com/ClickHouse/ClickHouse/pull/80393) ([Sav](https://github.com/sberss)).
* Для `parallel_replicas` используется отдельный таймаут подключения, см. настройку `parallel_replicas_connect_timeout_ms`. Ранее в качестве таймаута подключения для запросов с параллельными репликами использовались настройки `connect_timeout_with_failover_ms`/`connect_timeout_with_failover_secure_ms` (1 секунда по умолчанию). [#80421](https://github.com/ClickHouse/ClickHouse/pull/80421) ([Igor Nikonov](https://github.com/devcrafter)).
* Команда `SYSTEM UNFREEZE` больше не пытается искать части данных на дисках в режимах только для чтения (read-only) и однократной записи (write-once). Тем самым исправлена проблема [#80430](https://github.com/ClickHouse/ClickHouse/issues/80430). [#80432](https://github.com/ClickHouse/ClickHouse/pull/80432) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Изменён уровень логирования сообщения о слиянии партов с INFO на TRACE. [#80476](https://github.com/ClickHouse/ClickHouse/pull/80476) ([Hans Krutzer](https://github.com/hkrutzer)).
* Реализована «плоская» сериализация для Dynamic и JSON в формате Native, которая позволяет сериализовывать и десериализовывать данные Dynamic и JSON без использования специальных структур, таких как shared variant для Dynamic и shared data для JSON. Эту сериализацию можно включить, задав параметр `output_format_native_use_flattened_dynamic_and_json_serialization`. Она может использоваться для упрощения поддержки Dynamic и JSON в протоколе TCP в клиентах на разных языках. [#80499](https://github.com/ClickHouse/ClickHouse/pull/80499) ([Pavel Kruglov](https://github.com/Avogar)).
* Изменяет поведение по умолчанию механизма отсечения партиций для таблиц Iceberg. [#80583](https://github.com/ClickHouse/ClickHouse/pull/80583) ([Melvyn Peignon](https://github.com/melvynator)).
* Добавлены два новых события `ProfileEvents` для наблюдаемости алгоритмов поиска по индексам: `IndexBinarySearchAlgorithm` и `IndexGenericExclusionSearchAlgorithm`. [#80679](https://github.com/ClickHouse/ClickHouse/pull/80679) ([Pablo Marcos](https://github.com/pamarcos)).
* Не выводить в логах предупреждения о неподдерживаемом `MADV_POPULATE_WRITE` в старых версиях ядра (чтобы не засорять логи). [#80704](https://github.com/ClickHouse/ClickHouse/pull/80704) ([Robert Schulze](https://github.com/rschu1ze)).
* Добавлена поддержка типов Date32 и DateTime64 в TTL. [#80710](https://github.com/ClickHouse/ClickHouse/pull/80710) ([Andrey Zvonov](https://github.com/zvonand)).
* Скорректированы значения совместимости для параметра `max_merge_delayed_streams_for_parallel_write`. [#80760](https://github.com/ClickHouse/ClickHouse/pull/80760) ([Azat Khuzhin](https://github.com/azat)).
* Исправлен сбой: при попытке удалить временный файл (они используются для выгрузки временных данных на диск) в деструкторе могло быть выброшено исключение, что приводило к аварийному завершению программы. [#80776](https://github.com/ClickHouse/ClickHouse/pull/80776) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Добавить модификатор `IF EXISTS` к `SYSTEM SYNC REPLICA`. [#80810](https://github.com/ClickHouse/ClickHouse/pull/80810) ([Raúl Marín](https://github.com/Algunenano)).
* Расширено сообщение об исключении «Having zero bytes, but read range is not finished...», в `system.filesystem&#95;cache` добавлен столбец finished&#95;download&#95;time. [#80849](https://github.com/ClickHouse/ClickHouse/pull/80849) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Ранее хранилище `packed` не поддерживалось для полнотекстового индекса, поскольку идентификатор сегмента обновлялся «на лету» путём чтения и записи файла (`.gin_sid`) на диск. В случае использования packed-хранилища чтение значения из неподтверждённого файла не поддерживается, что и приводило к проблеме. [#80852](https://github.com/ClickHouse/ClickHouse/pull/80852) ([Elmi Ahmadov](https://github.com/ahmadov)).
* Добавлен раздел с алгоритмом поиска в вывод `EXPLAIN` при использовании с `indexes = 1`. В нём отображается либо «binary search», либо «generic exclusion search». [#80881](https://github.com/ClickHouse/ClickHouse/pull/80881) ([Pablo Marcos](https://github.com/pamarcos)).
* В начале 2024 года для обработчика MySQL параметр `prefer_column_name_to_alias` был жёстко задан в значение True, поскольку новый анализатор по умолчанию не был включён. Теперь это значение больше не задано жёстко. [#80916](https://github.com/ClickHouse/ClickHouse/pull/80916) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Теперь `system.iceberg_history` показывает историю для каталогов баз данных, таких как glue или iceberg rest. Также для согласованности в `system.iceberg_history` столбцы `table_name` и `database_name` переименованы в `table` и `database`. [#80975](https://github.com/ClickHouse/ClickHouse/pull/80975) ([alesapin](https://github.com/alesapin)).
* Добавлена поддержка режима только для чтения для табличной функции `merge`, чтобы при её использовании не требовалась привилегия `CREATE TEMPORARY TABLE`. [#80981](https://github.com/ClickHouse/ClickHouse/pull/80981) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* Улучшена возможность интроспекции кэшей в оперативной памяти (информация о кэшах теперь доступна в `system.metrics` вместо неполных `system.asynchronouse_metrics`). Добавлен размер кэшей в оперативной памяти (в байтах) в `dashboard.html`. `VectorSimilarityIndexCacheSize`/`IcebergMetadataFilesCacheSize` переименованы в `VectorSimilarityIndexCacheBytes`/`IcebergMetadataFilesCacheBytes`. [#81023](https://github.com/ClickHouse/ClickHouse/pull/81023) ([Azat Khuzhin](https://github.com/azat)).
* Теперь при чтении из system.rocksdb игнорируются базы данных с движками, которые не могут содержать таблицы RocksDB. [#81083](https://github.com/ClickHouse/ClickHouse/pull/81083) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* Разрешено использование `filesystem_caches` и `named_collections` в конфигурационном файле `clickhouse-local`. [#81105](https://github.com/ClickHouse/ClickHouse/pull/81105) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлена подсветка `PARTITION BY` в запросах `INSERT`. В предыдущих версиях `PARTITION BY` не подсвечивалось как ключевое слово. [#81106](https://github.com/ClickHouse/ClickHouse/pull/81106) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
  #* Два небольших улучшения в Web UI: корректная обработка запросов без вывода, таких как `CREATE`, `INSERT` (до недавнего времени такие запросы приводили к бесконечному индикатору загрузки); при двойном щелчке по таблице выполняется прокрутка к началу страницы. [#81131](https://github.com/ClickHouse/ClickHouse/pull/81131) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
  #* Обновление `c-ares` до `v1.34.5`. [#81159](https://github.com/ClickHouse/ClickHouse/pull/81159) ([Konstantин Bogdanov](https://github.com/thevar1able)).
  #* Обновление curl до версии 8.14 для устранения CVE-2025-5025 и CVE-2025-4947. [#81171](https://github.com/ClickHouse/ClickHouse/pull/81171) ([larryluogit](https://github.com/larryluogit)).
  #* Обновление libarchive до версии 3.7.9 для устранения: CVE-2024-20696 CVE-2025-25724 CVE-2024-48958 CVE-2024-57970 CVE-2025-1632 CVE-2024-48957 CVE-2024-48615. [#81174](https://github.com/ClickHouse/ClickHouse/pull/81174) ([larryluogit](https://github.com/larryluogit)).
  #* Обновление libxml2 до версии 2.14.3. [#81187](https://github.com/ClickHouse/ClickHouse/pull/81187) ([larryluogit](https://github.com/larryluogit)).
* `MemoryResidentWithoutPageCache` показывает объем физической памяти в байтах, используемой серверным процессом за вычетом userspace page cache. Это дает более точное представление о фактическом использовании памяти при задействовании userspace page cache. Когда userspace page cache отключен, это значение равно MemoryResident. [#81233](https://github.com/ClickHouse/ClickHouse/pull/81233) ([Jayme Bird](https://github.com/jaymebrd)).
* Пометить вручную записанные исключения в client, local server, keeper client и приложении disks как уже зарегистрированные, чтобы они не записывались в лог повторно. [#81271](https://github.com/ClickHouse/ClickHouse/pull/81271) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* Параметры `use_skip_indexes_if_final` и `use_skip_indexes_if_final_exact_mode` теперь по умолчанию имеют значение `True`. Запросы с оператором `FINAL` теперь будут использовать пропускающие индексы (если применимо) для предварительного отбора гранул, а также читать дополнительные гранулы, соответствующие подходящим диапазонам первичного ключа. Пользователи, которым требуется прежнее поведение с приблизительными/неточными результатами, могут установить `use_skip_indexes_if_final_exact_mode` в `False` после тщательной оценки. [#81331](https://github.com/ClickHouse/ClickHouse/pull/81331) ([Shankar Iyer](https://github.com/shankar-iyer)).
  #* Если в веб-интерфейсе имеется несколько запросов, будет выполнен тот, который находится под курсором. Продолжение [#80977](https://github.com/ClickHouse/ClickHouse/issues/80977). [#81354](https://github.com/ClickHouse/ClickHouse/pull/81354) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Этот PR устраняет проблемы с реализацией `is_strict` в проверках монотонности для функций преобразования. В настоящее время некоторые функции преобразования, такие как toFloat64(UInt32) и toDate(UInt8), ошибочно возвращают `is_strict` как false, тогда как должны возвращать true. [#81359](https://github.com/ClickHouse/ClickHouse/pull/81359) ([zoomxi](https://github.com/zoomxi)).
  #* В файловой системе с журналированием `mkdir` записывается в журнал файловой системы, который затем сбрасывается на диск. В случае медленного диска это может занимать много времени. Определённо имеет смысл вынести эту операцию за пределы области блокировки при резервировании. [#81371](https://github.com/ClickHouse/ClickHouse/pull/81371) ([Kseniia Sumarokova](https://github.com/kssenii)).
* При проверке, соответствует ли `KeyCondition` непрерывному диапазону, если ключ обёрнут цепочкой нестрогих функций, может потребоваться преобразование `Constraint::POINT` в `Constraint::RANGE`. Например, выражение `toDate(event_time) = '2025-06-03'` задаёт диапазон для `event_time`: [&#39;2025-06-03 00:00:00&#39;, &#39;2025-06-04 00:00:00&#39;). Этот PR исправляет это поведение. [#81400](https://github.com/ClickHouse/ClickHouse/pull/81400) ([zoomxi](https://github.com/zoomxi)).
  #* Используется `postgres` 16.9. [#81437](https://github.com/ClickHouse/ClickHouse/pull/81437) ([Konstantin Bogdanov](https://github.com/thevar1able)).
  #* Используется `openssl` 3.2.4. [#81438](https://github.com/ClickHouse/ClickHouse/pull/81438) ([Konstantin Bogdanov](https://github.com/thevar1able)).
  #* Используется `abseil-cpp` 2025-01-27. [#81440](https://github.com/ClickHouse/ClickHouse/pull/81440) ([Konstantin Bogdanov](https://github.com/thevar1able)).
  #* Используется `mongo-c-driver` 1.30.4. [#81449](https://github.com/ClickHouse/ClickHouse/pull/81449) ([Konstantin Bogdanov](https://github.com/thevar1able)).
  #* Используется `krb5` 1.21.3-final. [#81453](https://github.com/ClickHouse/ClickHouse/pull/81453) ([Konstantin Bogdanov](https://github.com/thevar1able)).
  #* Используется `orc` 2.1.2. [#81455](https://github.com/ClickHouse/ClickHouse/pull/81455) ([Konstantin Bogdanov](https://github.com/thevar1able)).
  #* Добавлена поддержка аргумента `--database` в `clickhouse-local`. Теперь можно переключаться на ранее созданную базу данных. Это закрывает [#44115](https://github.com/ClickHouse/ClickHouse/issues/44115). [#81465](https://github.com/ClickHouse/ClickHouse/pull/81465) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
  #* Псевдонимы `clickhouse`/`ch` будут вызывать `clickhouse-client` вместо `clickhouse-local`, если указаны `--host` или `--port`. Продолжение [#79422](https://github.com/ClickHouse/ClickHouse/issues/79422). Закрывает [#65252](https://github.com/ClickHouse/ClickHouse/issues/65252). [#81509](https://github.com/ClickHouse/ClickHouse/pull/81509) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Теперь, когда у нас есть данные о распределении времени отклика Keeper, мы можем настроить интервалы гистограммы. [#81516](https://github.com/ClickHouse/ClickHouse/pull/81516) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* Отложить чтение файлов манифестов Iceberg до первого выполнения запроса. [#81619](https://github.com/ClickHouse/ClickHouse/pull/81619) ([Daniil Ivanik](https://github.com/divanik)).
  #* Использовать `grpc` версии 1.73.0. [#81629](https://github.com/ClickHouse/ClickHouse/pull/81629) ([Konstantin Bogdanov](https://github.com/thevar1able)).
  #* Использовать `delta-kernel-rs` версии 0.12.1. [#81707](https://github.com/ClickHouse/ClickHouse/pull/81707) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* Добавлено профильное событие `PageCacheReadBytes`. [#81742](https://github.com/ClickHouse/ClickHouse/pull/81742) ([Kseniia Sumarokova](https://github.com/kssenii)).





## Исправление ошибки (видимое пользователю некорректное поведение в официальном стабильном релизе) {#bug-fix-user-visible-misbehavior-in-an-official-stable-release}


* Исправлена работа параметризованного представления с запросом `SELECT EXCEPT`. Закрывает [#49447](https://github.com/ClickHouse/ClickHouse/issues/49447). [#57380](https://github.com/ClickHouse/ClickHouse/pull/57380) ([Nikolay Degterinsky](https://github.com/evillique)).
* Analyzer: исправлено имя проекции столбца после повышения типа столбца при `JOIN`. Закрывает [#63345](https://github.com/ClickHouse/ClickHouse/issues/63345). [#63519](https://github.com/ClickHouse/ClickHouse/pull/63519) ([Dmitry Novik](https://github.com/novikd)).
* Материализованное представление может быть запущено слишком поздно, например, после таблицы Kafka, которая стримит в него данные. [#72123](https://github.com/ClickHouse/ClickHouse/pull/72123) ([Ilya Golshtein](https://github.com/ilejn)).
* Исправлена логическая ошибка при конфликте имён столбцов, когда включена настройка analyzer&#95;compatibility&#95;join&#95;using&#95;top&#95;level&#95;identifier. [#75676](https://github.com/ClickHouse/ClickHouse/pull/75676) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Исправлены редкие сбои при чтении из таблицы `MergeTree` после выполнения нескольких асинхронных (с `alter_sync = 0`) запросов `RENAME COLUMN` и `ADD COLUMN`. [#76346](https://github.com/ClickHouse/ClickHouse/pull/76346) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлена проблема с перезаписью запроса `SELECT` при создании `VIEW` с включённым анализатором. Закрывает [#75956](https://github.com/ClickHouse/ClickHouse/issues/75956). [#76356](https://github.com/ClickHouse/ClickHouse/pull/76356) ([Dmitry Novik](https://github.com/novikd)).
* Исправлено использование CTE в проталкиваемых предикатах, когда включен `allow_push_predicate_ast_for_distributed_subqueries`. Исправлены [#75647](https://github.com/ClickHouse/ClickHouse/issues/75647). Исправлены [#79672](https://github.com/ClickHouse/ClickHouse/issues/79672). [#77316](https://github.com/ClickHouse/ClickHouse/pull/77316) ([Dmitry Novik](https://github.com/novikd)).
* Исправлена проблема с применением параметра `async_insert`, полученного с сервера (через `apply_settings_from_server`), которая ранее приводила к ошибкам `Unknown packet 11 from server` на стороне клиента. [#77578](https://github.com/ClickHouse/ClickHouse/pull/77578) ([Azat Khuzhin](https://github.com/azat)).
* Исправлена проблема, из-за которой обновляемое материализованное представление в реплицированных базах данных не работало на вновь добавленных репликах. [#77774](https://github.com/ClickHouse/ClickHouse/pull/77774) ([Michael Kolupaev](https://github.com/al13n321)).
* Исправлены проблемы, из-за которых обновляемые материализованные представления нарушали работу резервного копирования. [#77893](https://github.com/ClickHouse/ClickHouse/pull/77893) ([Michael Kolupaev](https://github.com/al13n321)).
* Исправлена давняя логическая ошибка в работе `transform`. [#78247](https://github.com/ClickHouse/ClickHouse/pull/78247) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Исправляет проблему, из-за которой `SYSTEM SYNC REPLICA LIGHTWEIGHT 'foo'` сообщала об успешном завершении, даже если указанная реплика не существовала. Теперь команда корректно проверяет наличие реплики в Keeper перед попыткой синхронизации. [#78405](https://github.com/ClickHouse/ClickHouse/pull/78405) ([Jayme Bird](https://github.com/jaymebrd)).
* Исправляет некоторые случаи, когда вторичный индекс не применялся с анализатором. Исправляет [#65607](https://github.com/ClickHouse/ClickHouse/issues/65607), исправляет [#69373](https://github.com/ClickHouse/ClickHouse/issues/69373). [#78485](https://github.com/ClickHouse/ClickHouse/pull/78485) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* Исправлена выгрузка событий профилирования (`NetworkSendElapsedMicroseconds`/`NetworkSendBytes`) для протокола HTTP с включённым сжатием (погрешность не должна превышать размер буфера, обычно около 1MiB). [#78516](https://github.com/ClickHouse/ClickHouse/pull/78516) ([Azat Khuzhin](https://github.com/azat)).
  #* ```sql CREATE TABLE t0 ( key Int32, value Int32 ) ENGINE=MergeTree() PRIMARY KEY key PARTITION BY key % 2;. [#78593](https://github.com/ClickHouse/ClickHouse/pull/78593) ([Vlad](https://github.com/codeworse)).
* Исправлен анализатор, который выдавал `LOGICAL_ERROR`, когда `JOIN ... USING` содержал столбец с определением `ALIAS` — теперь возвращается корректная ошибка. [#78618](https://github.com/ClickHouse/ClickHouse/pull/78618) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* Исправлен анализатор: `CREATE VIEW ... ON CLUSTER` завершался ошибкой, если оператор SELECT содержал позиционные аргументы. [#78663](https://github.com/ClickHouse/ClickHouse/pull/78663) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* Исправлена ошибка `Block structure mismatch` в случае `INSERT SELECT` в табличную функцию с автоматическим выводом схемы, если в `SELECT` присутствуют скалярные подзапросы. [#78677](https://github.com/ClickHouse/ClickHouse/pull/78677) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* Исправлен анализатор: при `prefer_global_in_and_join=1` для таблицы Distributed в запросе SELECT функция `in` должна заменяться на `globalIn`. [#78749](https://github.com/ClickHouse/ClickHouse/pull/78749) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* Исправлены несколько типов запросов `SELECT`, которые читают из таблиц с движком `MongoDB` или используют табличную функцию `mongodb`: запросы с неявным преобразованием константного значения в условии `WHERE` (например, `WHERE datetime = '2025-03-10 00:00:00'`); запросы с `LIMIT` и `GROUP BY`. Ранее они могли возвращать неверный результат. [#78777](https://github.com/ClickHouse/ClickHouse/pull/78777) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлено преобразование между различными типами JSON. Теперь оно выполняется простым приведением типов через преобразование к типу String и обратно. Это менее эффективно, но на 100% корректно. [#78807](https://github.com/ClickHouse/ClickHouse/pull/78807) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена логическая ошибка при преобразовании типа `Dynamic` в `Interval`. [#78813](https://github.com/ClickHouse/ClickHouse/pull/78813) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлен откат столбца при ошибке разбора JSON. [#78836](https://github.com/ClickHouse/ClickHouse/pull/78836) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена ошибка «bad cast» при выполнении операции `JOIN` с использованием константного столбца‑псевдонима. [#78848](https://github.com/ClickHouse/ClickHouse/pull/78848) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Не допускается использование `PREWHERE` в материализованных представлениях над столбцами, у которых тип в представлении отличается от типа в целевой таблице. [#78889](https://github.com/ClickHouse/ClickHouse/pull/78889) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена логическая ошибка при разборе некорректных бинарных данных столбца Variant. [#78982](https://github.com/ClickHouse/ClickHouse/pull/78982) ([Pavel Kruglov](https://github.com/Avogar)).
* При установке размера пакета Parquet в 0 теперь выбрасывается исключение. Ранее при `output_format_parquet_batch_size = 0` ClickHouse зависал. Теперь это поведение исправлено. [#78991](https://github.com/ClickHouse/ClickHouse/pull/78991) ([daryawessely](https://github.com/daryawessely)).
* Исправлена десериализация дискриминаторов типа Variant с форматом basic в компактных частях. Ошибка была допущена в [https://github.com/ClickHouse/ClickHouse/pull/55518](https://github.com/ClickHouse/ClickHouse/pull/55518). [#79000](https://github.com/ClickHouse/ClickHouse/pull/79000) ([Pavel Kruglov](https://github.com/Avogar)).
* Словари типа `complex_key_ssd_cache` теперь не принимают значения 0 или отрицательные значения параметров `block_size` и `write_buffer_size` (issue [#78314](https://github.com/ClickHouse/ClickHouse/issues/78314)). [#79028](https://github.com/ClickHouse/ClickHouse/pull/79028) ([Elmi Ahmadov](https://github.com/ahmadov)).
* Избегайте использования Field для неагрегированных столбцов в SummingMergeTree. Это может привести к неожиданным ошибкам при использовании типов Dynamic/Variant в SummingMergeTree. [#79051](https://github.com/ClickHouse/ClickHouse/pull/79051) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлено чтение из материализованного представления с распределённой целевой таблицей при отличающемся заголовке в анализаторе. [#79059](https://github.com/ClickHouse/ClickHouse/pull/79059) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлен сбой в очень специфическом случае, когда функция `currentDatabase` использовалась в секциях `CONSTRAINT` в запросах с `ON CLUSTER`. Закрывает [#78100](https://github.com/ClickHouse/ClickHouse/issues/78100). [#79070](https://github.com/ClickHouse/ClickHouse/pull/79070) ([pufit](https://github.com/pufit)).
* Исправлена ошибка, из-за которой `arrayUnion()` возвращала дополнительные (некорректные) значения при пакетных вставках в таблицу. Исправляет [#75057](https://github.com/ClickHouse/ClickHouse/issues/75057). [#79079](https://github.com/ClickHouse/ClickHouse/pull/79079) ([Peter Nguyen](https://github.com/petern48)).
  #* Исправлен сбой сегментации в `OpenSSLInitializer`. Закрывает [#79092](https://github.com/ClickHouse/ClickHouse/issues/79092). [#79097](https://github.com/ClickHouse/ClickHouse/pull/79097) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* Исправлена передача внешних ролей в межсерверных запросах. [#79099](https://github.com/ClickHouse/ClickHouse/pull/79099) ([Andrey Zvonov](https://github.com/zvonand)).
* Всегда указывается префикс для S3 ListObject. [#79114](https://github.com/ClickHouse/ClickHouse/pull/79114) ([Azat Khuzhin](https://github.com/azat)).
* Исправляет ошибку, из-за которой `arrayUnion()` возвращал лишние (некорректные) значения в таблицах, в которых выполнялись пакетные вставки. Исправляет [#79157](https://github.com/ClickHouse/ClickHouse/issues/79157). [#79158](https://github.com/ClickHouse/ClickHouse/pull/79158) ([Peter Nguyen](https://github.com/petern48)).
* Исправлена логическая ошибка после проталкивания фильтра (filter pushdown). [#79164](https://github.com/ClickHouse/ClickHouse/pull/79164) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* Используйте IColumn вместо Field в SingleValueDataGeneric. Это исправляет некорректные возвращаемые значения для некоторых агрегатных функций, таких как `argMax` для типов `Dynamic/Variant/JSON`. [#79166](https://github.com/ClickHouse/ClickHouse/pull/79166) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлен движок таблиц DeltaLake при использовании реализации delta-kernel через HTTP-эндпоинты, исправлен NOSIGN. Закрывает [#78124](https://github.com/ClickHouse/ClickHouse/issues/78124). [#79203](https://github.com/ClickHouse/ClickHouse/pull/79203) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Исправление в Keeper: предотвращено срабатывание watch-событий при неудачных multi-запросах. [#79247](https://github.com/ClickHouse/ClickHouse/pull/79247) ([Antonio Andelic](https://github.com/antonio2368)).
* Запрещено использование типов Dynamic и JSON в операторе `IN`. При текущей реализации `IN` это может приводить к некорректным результатам. Корректная поддержка этих типов оператором `IN` сложна и может быть реализована в будущем. [#79282](https://github.com/ClickHouse/ClickHouse/pull/79282) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена проверка на наличие дублирующихся путей при разборе типа JSON. [#79317](https://github.com/ClickHouse/ClickHouse/pull/79317) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлены проблемы с соединением через SecureStreamSocket. [#79383](https://github.com/ClickHouse/ClickHouse/pull/79383) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* Исправлена загрузка дисков типа plain&#95;rewritable, содержащих данные. [#79439](https://github.com/ClickHouse/ClickHouse/pull/79439) ([Julia Kartseva](https://github.com/jkartseva)).
* Исправлена ошибка, приводившая к падению при обнаружении динамических подстолбцов в Wide-частях MergeTree. [#79466](https://github.com/ClickHouse/ClickHouse/pull/79466) ([Pavel Kruglov](https://github.com/Avogar)).
* Проверять длину имени таблицы только для исходных запросов `CREATE`. Не выполнять эту проверку для повторных запросов `CREATE`, чтобы избежать проблем с обратной совместимостью. [#79488](https://github.com/ClickHouse/ClickHouse/pull/79488) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* Исправлена ошибка `Block structure mismatch` в ряде случаев при работе с таблицами с разреженными столбцами. [#79491](https://github.com/ClickHouse/ClickHouse/pull/79491) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлены два случая `Logical Error: Can't set alias of * of Asterisk on alias`. [#79505](https://github.com/ClickHouse/ClickHouse/pull/79505) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлено применение настроек use&#95;native&#95;copy и allow&#95;azure&#95;native&#95;copy для Azure Blob Storage; нативное копирование теперь используется только при совпадении учётных данных, что устраняет проблему [#78964](https://github.com/ClickHouse/ClickHouse/issues/78964). [#79561](https://github.com/ClickHouse/ClickHouse/pull/79561) ([Smita Kulkarni](https://github.com/SmitaRKulkarni)).
* Исправлена ошибка использования некорректных путей при переименовании базы данных Atomic. [#79569](https://github.com/ClickHouse/ClickHouse/pull/79569) ([Tuan Pham Anh](https://github.com/tuanpach)).
* Исправлена ошибка сортировки по столбцу JSON в сочетании с другими столбцами. [#79591](https://github.com/ClickHouse/ClickHouse/pull/79591) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлено дублирование результатов при чтении через remote при отключённых `use_hedged_requests` и `allow_experimental_parallel_reading_from_replicas`. [#79599](https://github.com/ClickHouse/ClickHouse/pull/79599) ([Eduard Karacharov](https://github.com/korowa)).
* Исправлен сбой в реализации delta-kernel при использовании Unity Catalog. [#79677](https://github.com/ClickHouse/ClickHouse/pull/79677) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Добавлено раскрытие макросов для кластеров autodiscovery. [#79696](https://github.com/ClickHouse/ClickHouse/pull/79696) ([Anton Ivashkin](https://github.com/ianton-ru)).
* Исправлены логические ошибки, связанные с неизвестным происхождением столбца, возникающие при проверке столбца на коррелированность. Исправлены [#78183](https://github.com/ClickHouse/ClickHouse/issues/78183). Исправлены [#79451](https://github.com/ClickHouse/ClickHouse/issues/79451). [#79727](https://github.com/ClickHouse/ClickHouse/pull/79727) ([Dmitry Novik](https://github.com/novikd)).
* Исправлены некорректные результаты при использовании `GROUPING SETS` с `ColumnConst` и Analyzer. [#79743](https://github.com/ClickHouse/ClickHouse/pull/79743) ([Andrey Zvonov](https://github.com/zvonand)).
* Исправлено дублирование результатов локального шарда при чтении из распределённой таблицы, если локальная реплика устарела. [#79761](https://github.com/ClickHouse/ClickHouse/pull/79761) ([Eduard Karacharov](https://github.com/korowa)).
* Корректно обрабатывать неверно настроенные `page_cache_limits`. [#79805](https://github.com/ClickHouse/ClickHouse/pull/79805) ([Bharat Nallan](https://github.com/bharatnc)).
* Исправляет результат работы SQL-функции `formatDateTime`, если за спецификатором формата переменной длины (например, `%W`, то есть днём недели `Monday` `Tuesday` и т. д.) следует составной спецификатор формата (выводящий сразу несколько компонентов, например, `%D`, то есть американская дата `05/04/25`). [#79835](https://github.com/ClickHouse/ClickHouse/pull/79835) ([Robert Schulze](https://github.com/rschu1ze)).
* IcebergS3 поддерживает оптимизацию count, но IcebergS3Cluster — нет. В результате результат функции count(), возвращаемый в кластерном режиме, может быть кратен количеству реплик. [#79844](https://github.com/ClickHouse/ClickHouse/pull/79844) ([wxybear](https://github.com/wxybear)).
* Исправлен порядок сортировки значений NaN с отрицательным битом знака. [#79847](https://github.com/ClickHouse/ClickHouse/pull/79847) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* Теперь `GROUP BY ALL` не учитывает секцию `GROUPING`. [#79915](https://github.com/ClickHouse/ClickHouse/pull/79915) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Исправлена ошибка `AMBIGUOUS_COLUMN_NAME` при ленивой материализации, возникавшая в случаях, когда до применения проекции при выполнении запроса не использовался ни один столбец. Например, SELECT * FROM t ORDER BY rand() LIMIT 5. [#79926](https://github.com/ClickHouse/ClickHouse/pull/79926) ([Igor Nikonov](https://github.com/devcrafter)).
* Исправлено некорректное слияние состояний для функций `TopK` / `TopKWeighted`, которое приводило к избыточной погрешности даже при неиспользованной ёмкости. [#79939](https://github.com/ClickHouse/ClickHouse/pull/79939) ([Joel Höner](https://github.com/athre0z)).
* Пароль в запросе `CREATE DATABASE datalake ENGINE = DataLakeCatalog(\'http://catalog:8181\', \'admin\', \'password\')` теперь скрывается. [#79941](https://github.com/ClickHouse/ClickHouse/pull/79941) ([Han Fei](https://github.com/hanfei1991)).
* Теперь можно указывать псевдоним в `JOIN USING`. Используйте этот псевдоним, если столбец был переименован (например, из‑за `ARRAY JOIN`). Исправляет [#73707](https://github.com/ClickHouse/ClickHouse/issues/73707). [#79942](https://github.com/ClickHouse/ClickHouse/pull/79942) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* Учитывается параметр `readonly` для объектного хранилища `azure_blob_storage`. [#79954](https://github.com/ClickHouse/ClickHouse/pull/79954) ([Julia Kartseva](https://github.com/jkartseva)).
* Исправлены некорректные результаты запросов и сбои из‑за исчерпания памяти при использовании `match(column, '^…')` с символами, экранированными обратной косой чертой. [#79969](https://github.com/ClickHouse/ClickHouse/pull/79969) ([filimonov](https://github.com/filimonov)).
* Отключение секционирования Hive для озёр данных. Частично решает [https://github.com/issues/assigned?issue=ClickHouse%7CClickHouse%7C79937](https://github.com/issues/assigned?issue=ClickHouse%7CClickHouse%7C79937). [#80005](https://github.com/ClickHouse/ClickHouse/pull/80005) ([Daniil Ivanik](https://github.com/divanik)).
* Пропускающие индексы с лямбда-выражениями не применялись. Исправлен случай, когда функции верхнего уровня в определении индекса в точности совпадали с функциями в запросе. [#80025](https://github.com/ClickHouse/ClickHouse/pull/80025) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* Обеспечена корректная работа материализованных представлений, использующих UNION, на новых репликах. [#80037](https://github.com/ClickHouse/ClickHouse/pull/80037) ([Samay Sharma](https://github.com/samay-sharma)).
* Исправлено использование версии метаданных при присоединении парта на реплике, выполняющей команду ATTACH&#95;PART из журнала репликации. [#80038](https://github.com/ClickHouse/ClickHouse/pull/80038) ([Aleksei Filatov](https://github.com/aalexfvk)).
* Спецификатор формата `%e` в SQL-функции `parseDateTime` теперь распознаёт однозначные номера дней (например, `3`), тогда как ранее требовалось наличие ведущего пробела (например, ` 3`). Это делает его поведение совместимым с MySQL. Чтобы сохранить предыдущее поведение, установите настройку `parsedatetime_e_requires_space_padding = 1`. (issue [#78243](https://github.com/ClickHouse/ClickHouse/issues/78243)). [#80057](https://github.com/ClickHouse/ClickHouse/pull/80057) ([Robert Schulze](https://github.com/rschu1ze)).
* Имена исполняемых пользовательских функций (eUDF) не добавляются в столбец `used_functions` таблицы `system.query_log` в отличие от других функций. Этот PR добавляет имя eUDF, если eUDF использовалась в запросе. [#80073](https://github.com/ClickHouse/ClickHouse/pull/80073) ([Kyamran](https://github.com/nibblerenush)).
  #* Исправлены предупреждения `Cannot find 'kernel' in '[...]/memory.stat'` в журнале ClickHouse (задача [#77410](https://github.com/ClickHouse/ClickHouse/issues/77410)). [#80129](https://github.com/ClickHouse/ClickHouse/pull/80129) ([Robert Schulze](https://github.com/rschu1ze)).
* Исправлена логическая ошибка в формате Arrow для типа LowCardinality(FixedString). [#80156](https://github.com/ClickHouse/ClickHouse/pull/80156) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлено чтение подстолбцов из движка Merge. [#80158](https://github.com/ClickHouse/ClickHouse/pull/80158) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена ошибка сравнения числовых типов в `KeyCondition`. [#80207](https://github.com/ClickHouse/ClickHouse/pull/80207) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Исправлена ошибка AMBIGUOUS&#95;COLUMN&#95;NAME при использовании ленивой материализации в таблице с проекциями. [#80251](https://github.com/ClickHouse/ClickHouse/pull/80251) ([Igor Nikonov](https://github.com/devcrafter)).
* Исправлена некорректная оптимизация `COUNT` для фильтров по строковому префиксу вида LIKE &#39;ab&#95;c%&#39; при использовании неявных проекций. Это исправление устраняет [#80250](https://github.com/ClickHouse/ClickHouse/issues/80250). [#80261](https://github.com/ClickHouse/ClickHouse/pull/80261) ([Amos Bird](https://github.com/amosbird)).
* Исправлена некорректная сериализация вложенных числовых полей в виде строк в документах MongoDB. Снято ограничение на максимальную глубину документов из MongoDB. [#80289](https://github.com/ClickHouse/ClickHouse/pull/80289) ([Kirill Nikiforov](https://github.com/allmazz)).
* Выполнены менее строгие проверки метаданных для RMT в базе данных Replicated. Закрывает [#80296](https://github.com/ClickHouse/ClickHouse/issues/80296). [#80298](https://github.com/ClickHouse/ClickHouse/pull/80298) ([Nikolay Degterinsky](https://github.com/evillique)).
* Исправлено текстовое представление значений типов DateTime и DateTime64 для хранилища PostgreSQL. [#80301](https://github.com/ClickHouse/ClickHouse/pull/80301) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* Разрешено использование `DateTime` с часовым поясом в таблицах `StripeLog`. Это закрывает [#44120](https://github.com/ClickHouse/ClickHouse/issues/44120). [#80304](https://github.com/ClickHouse/ClickHouse/pull/80304) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Отключено проталкивание фильтра (filter-push-down) для предиката с недетерминированной функцией в случаях, когда шаг плана запроса изменяет количество строк. Исправляет [#40273](https://github.com/ClickHouse/ClickHouse/issues/40273). [#80329](https://github.com/ClickHouse/ClickHouse/pull/80329) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* Исправлены возможные логические ошибки и аварийные завершения в проекциях с подстолбцами. [#80333](https://github.com/ClickHouse/ClickHouse/pull/80333) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена ошибка `NOT_FOUND_COLUMN_IN_BLOCK`, вызванная оптимизацией проталкивания фильтра (filter push-down) на логическом шаге JOIN в случае, когда выражение `ON` не является тривиальным равенством. Исправляет [#79647](https://github.com/ClickHouse/ClickHouse/issues/79647) и [#77848](https://github.com/ClickHouse/ClickHouse/issues/77848). [#80360](https://github.com/ClickHouse/ClickHouse/pull/80360) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* Исправлены ошибки, приводившие к некорректным результатам при чтении ключей в обратном порядке в партиционированных таблицах. Это устраняет проблему [#79987](https://github.com/ClickHouse/ClickHouse/issues/79987). [#80448](https://github.com/ClickHouse/ClickHouse/pull/80448) ([Amos Bird](https://github.com/amosbird)).
* Исправлена некорректная сортировка в таблицах с ключом, допускающим значения `NULL`, при включённом `optimize_read_in_order`. [#80515](https://github.com/ClickHouse/ClickHouse/pull/80515) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* Исправлена проблема, из-за которой операция DROP для обновляемого материализованного представления зависала, если представление было приостановлено с помощью SYSTEM STOP REPLICATED VIEW. [#80543](https://github.com/ClickHouse/ClickHouse/pull/80543) ([Michael Kolupaev](https://github.com/al13n321)).
* Исправлена ошибка &#39;Cannot find column&#39; для константного кортежа в распределённом запросе. [#80596](https://github.com/ClickHouse/ClickHouse/pull/80596) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* Исправлена функция `shardNum` в распределённых таблицах при использовании `join_use_nulls`. [#80612](https://github.com/ClickHouse/ClickHouse/pull/80612) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* Исправлены некорректные результаты при чтении столбца, который присутствует только в части таблиц движка Merge. [#80643](https://github.com/ClickHouse/ClickHouse/pull/80643) ([Pavel Kruglov](https://github.com/Avogar)).
* Метка времени в таблице `iceberg_history` теперь должна быть корректной. [#80711](https://github.com/ClickHouse/ClickHouse/pull/80711) ([Melvyn Peignon](https://github.com/melvynator)).
* Исправлена обработка glob-шаблонов перечислений (enum) с одним элементом в табличных функциях для объектного хранилища. [#80716](https://github.com/ClickHouse/ClickHouse/pull/80716) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* Исправлены неверные типы результатов функций сравнения с Tuple(Dynamic) и String, приводившие к логической ошибке. [#80728](https://github.com/ClickHouse/ClickHouse/pull/80728) ([Pavel Kruglov](https://github.com/Avogar)).
* Добавлена недостающая поддержка типа данных `timestamp_ntz` для Unity Catalog. Исправляет [#79535](https://github.com/ClickHouse/ClickHouse/issues/79535), исправляет [#79875](https://github.com/ClickHouse/ClickHouse/issues/79875). [#80740](https://github.com/ClickHouse/ClickHouse/pull/80740) ([alesapin](https://github.com/alesapin)).
* Исправлена ошибка `THERE_IS_NO_COLUMN` для распределённых запросов с условием `IN` в CTE. Исправляет [#75032](https://github.com/ClickHouse/ClickHouse/issues/75032). [#80757](https://github.com/ClickHouse/ClickHouse/pull/80757) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* Исправлено чрезмерное число файлов (приводившее к избыточному использованию памяти) для внешнего `ORDER BY`. [#80777](https://github.com/ClickHouse/ClickHouse/pull/80777) ([Azat Khuzhin](https://github.com/azat)).
  #* Этот PR может закрыть [#80742](https://github.com/ClickHouse/ClickHouse/issues/80742). [#80783](https://github.com/ClickHouse/ClickHouse/pull/80783) ([zoomxi](https://github.com/zoomxi)).
  #* Исправлен сбой в Kafka из-за того, что get&#95;member&#95;id() создавал std::string из NULL (скорее всего, проблема возникала только в случае неуспешного подключения к брокеру). [#80793](https://github.com/ClickHouse/ClickHouse/pull/80793) ([Azat Khuzhin](https://github.com/azat)).
* Корректно ожидать завершения работы потребителей перед остановкой движка Kafka (активные потребители после остановки могут вызывать различные отладочные утверждения, а также продолжать читать данные у брокеров в фоновом режиме после того, как таблица была удалена/отсоединена). [#80795](https://github.com/ClickHouse/ClickHouse/pull/80795) ([Azat Khuzhin](https://github.com/azat)).
* Исправлена ошибка `NOT_FOUND_COLUMN_IN_BLOCK`, вызванная оптимизацией `predicate-push-down`. Устраняет [#80443](https://github.com/ClickHouse/ClickHouse/issues/80443). [#80834](https://github.com/ClickHouse/ClickHouse/pull/80834) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* Исправлена логическая ошибка при обработке шаблона звёздочки (*) в табличной функции при `JOIN` с `USING`. [#80894](https://github.com/ClickHouse/ClickHouse/pull/80894) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Исправлен подсчёт потребления памяти для кэша файлов метаданных Iceberg. [#80904](https://github.com/ClickHouse/ClickHouse/pull/80904) ([Azat Khuzhin](https://github.com/azat)).
* Исправлено некорректное партиционирование с ключом партиционирования, допускающим NULL. [#80913](https://github.com/ClickHouse/ClickHouse/pull/80913) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* Исправлена ошибка `Table does not exist` для распределённых запросов с проталкиванием предиката (`allow_push_predicate_ast_for_distributed_subqueries=1`), когда исходная таблица отсутствует на инициаторе запроса. Исправляет [#77281](https://github.com/ClickHouse/ClickHouse/issues/77281). [#80915](https://github.com/ClickHouse/ClickHouse/pull/80915) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* Исправлена логическая ошибка во вложенных функциях с именованными окнами. [#80926](https://github.com/ClickHouse/ClickHouse/pull/80926) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* Исправлена обработка экстремальных значений для столбцов Nullable и столбцов с плавающей запятой. [#80970](https://github.com/ClickHouse/ClickHouse/pull/80970) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* Исправлен возможный сбой при выполнении запросов к system.tables (как правило, в условиях дефицита памяти). [#80976](https://github.com/ClickHouse/ClickHouse/pull/80976) ([Azat Khuzhin](https://github.com/azat)).
* Исправлено атомарное переименование с усечением для файлов, тип сжатия которых определяется по их расширению. [#80979](https://github.com/ClickHouse/ClickHouse/pull/80979) ([Pablo Marcos](https://github.com/pamarcos)).
  #* Исправлен метод ErrorCodes::getName. [#81032](https://github.com/ClickHouse/ClickHouse/pull/81032) ([RinChanNOW](https://github.com/RinChanNOWWW)).
* Исправлена ошибка, из-за которой пользователь не мог получить список таблиц в Unity Catalog без прав на все таблицы. Теперь все таблицы корректно отображаются, а попытка чтения из таблицы с ограниченным доступом приведёт к выдаче исключения. [#81044](https://github.com/ClickHouse/ClickHouse/pull/81044) ([alesapin](https://github.com/alesapin)).
* Теперь ClickHouse будет игнорировать ошибки и неожиданные ответы от каталогов дата‑лейка в запросе `SHOW TABLES`. Исправлена проблема [#79725](https://github.com/ClickHouse/ClickHouse/issues/79725). [#81046](https://github.com/ClickHouse/ClickHouse/pull/81046) ([alesapin](https://github.com/alesapin)).
* Исправлен разбор значений `DateTime64` из целочисленных значений в `JSONExtract` и при разборе типа `JSON`. [#81050](https://github.com/ClickHouse/ClickHouse/pull/81050) ([Pavel Kruglov](https://github.com/Avogar)).
* Учтена настройка `date_time_input_format` в кэше определения схемы. [#81052](https://github.com/ClickHouse/ClickHouse/pull/81052) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлен сбой при `INSERT`, если после запуска запроса, но до отправки столбцов над таблицей была выполнена команда `DROP`. [#81053](https://github.com/ClickHouse/ClickHouse/pull/81053) ([Azat Khuzhin](https://github.com/azat)).
* Устранена ошибка использования неинициализированного значения в quantileDeterministic. [#81062](https://github.com/ClickHouse/ClickHouse/pull/81062) ([Azat Khuzhin](https://github.com/azat)).
* Исправлено управление счетчиком hardlinks для транзакций с диском `metadatastoragefromdisk`. Добавлены тесты. [#81066](https://github.com/ClickHouse/ClickHouse/pull/81066) ([Sema Checherinda](https://github.com/CheSema)).
* Имена пользовательских функций (UDF) не добавлялись в таблицу `system.query_log` в отличие от других функций. Этот PR добавляет имя UDF в один из двух столбцов `used_executable_user_defined_functions` или `used_sql_user_defined_functions`, если UDF использовалась в запросе. [#81101](https://github.com/ClickHouse/ClickHouse/pull/81101) ([Kyamran](https://github.com/nibblerenush)).
* Исправлены ошибки `Too large size ... passed to allocator` и возможные сбои при операциях вставки по протоколу HTTP с текстовыми форматами (`JSON`, `Values`, ...) при пропуске полей типа `Enum`. [#81145](https://github.com/ClickHouse/ClickHouse/pull/81145) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлена ошибка LOGICAL&#95;ERROR при наличии разреженного столбца (Sparse column) в блоке INSERT, передаваемом в не-MT материализованное представление (MV). [#81161](https://github.com/ClickHouse/ClickHouse/pull/81161) ([Azat Khuzhin](https://github.com/azat)).
* Исправлена ошибка `Unknown table expression identifier` для `distributed_product_mode_local=local` при кросс-репликации. [#81162](https://github.com/ClickHouse/ClickHouse/pull/81162) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* Исправлено некорректное кэширование количества строк в файлах Parquet после фильтрации. [#81184](https://github.com/ClickHouse/ClickHouse/pull/81184) ([Michael Kolupaev](https://github.com/al13n321)).
* Исправлена настройка параметра кэша файловой системы `max_size_to_total_space` при использовании относительного пути кэша. [#81237](https://github.com/ClickHouse/ClickHouse/pull/81237) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Исправлено падение clickhouse-local при выводе константных кортежей или значений Map в формате Parquet. [#81249](https://github.com/ClickHouse/ClickHouse/pull/81249) ([Michael Kolupaev](https://github.com/al13n321)).
* Проверять смещения массивов, получаемых по сети. [#81269](https://github.com/ClickHouse/ClickHouse/pull/81269) ([Azat Khuzhin](https://github.com/azat)).
* Исправлен частный случай запроса, выполняющего соединение (`JOIN`) пустых таблиц и использующего оконные функции. Ошибка приводила к взрывному росту числа параллельных потоков и, как следствие, к ошибкам нехватки памяти (Out Of Memory, OOM). [#81299](https://github.com/ClickHouse/ClickHouse/pull/81299) ([Alexander Gololobov](https://github.com/davenger)).
* Исправления для кластерных функций data lake (`deltaLakeCluster`, `icebergCluster` и т.д.): (1) исправлена потенциальная ошибка сегментации в `DataLakeConfiguration` при использовании функции `Cluster` со старым анализатором; (2) устранено дублирование обновлений метаданных data lake (лишние запросы к объектному хранилищу); (3) исправлен избыточный листинг в объектном хранилище, когда формат явно не указан (то же самое ранее было сделано для некластерных data lake-движков). [#81300](https://github.com/ClickHouse/ClickHouse/pull/81300) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Флаг `force_restore_data` теперь восстанавливает утерянные метаданные Keeper. [#81324](https://github.com/ClickHouse/ClickHouse/pull/81324) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлена ошибка region в delta-kernel. Исправляет [#79914](https://github.com/ClickHouse/ClickHouse/issues/79914). [#81353](https://github.com/ClickHouse/ClickHouse/pull/81353) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Отключена некорректная JIT-компиляция для divideOrNull. [#81370](https://github.com/ClickHouse/ClickHouse/pull/81370) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлена ошибка вставки, возникавшая при наличии в таблице MergeTree столбца партиции с длинным именем. [#81390](https://github.com/ClickHouse/ClickHouse/pull/81390) ([hy123q](https://github.com/haoyangqian)).
* Не хранить содержимое нескольких файлов манифестов в памяти. [#81470](https://github.com/ClickHouse/ClickHouse/pull/81470) ([Daniil Ivanik](https://github.com/divanik)).
* Исправлен потенциальный сбой при остановке фоновых пулов (`background_.*pool_size`). [#81473](https://github.com/ClickHouse/ClickHouse/pull/81473) ([Azat Khuzhin](https://github.com/azat)).
* Исправлено чтение за пределами допустимых границ в формате `Npy`, возникавшее при записи в таблицу с движком `URL`. Это устраняет [#81356](https://github.com/ClickHouse/ClickHouse/issues/81356). [#81502](https://github.com/ClickHouse/ClickHouse/pull/81502) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* В некоторых случаях Web UI может отображать `NaN%` (типичная проблема JavaScript). [#81507](https://github.com/ClickHouse/ClickHouse/pull/81507) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлена работа `DatabaseReplicated` при `database_replicated_enforce_synchronous_settings=1`. [#81564](https://github.com/ClickHouse/ClickHouse/pull/81564) ([Azat Khuzhin](https://github.com/azat)).
* Исправлен порядок сортировки для типов LowCardinality(Nullable(...)). [#81583](https://github.com/ClickHouse/ClickHouse/pull/81583) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* Сервер не должен поддерживать HTTP-соединение, если запрос не был полностью прочитан из сокета. [#81595](https://github.com/ClickHouse/ClickHouse/pull/81595) ([Sema Checherinda](https://github.com/CheSema)).
* Скалярные коррелированные подзапросы теперь возвращают результат выражения проекции с типом `Nullable`. Исправлен случай, когда коррелированный подзапрос возвращал пустой набор результатов. [#81632](https://github.com/ClickHouse/ClickHouse/pull/81632) ([Dmitry Novik](https://github.com/novikd)).
* Исправлена ошибка `Unexpected relative path for a deduplicated part` при выполнении операции `ATTACH` к `ReplicatedMergeTree`. [#81647](https://github.com/ClickHouse/ClickHouse/pull/81647) ([Azat Khuzhin](https://github.com/azat)).
* Настройка запроса `use_iceberg_partition_pruning` не будет действовать для хранилища Iceberg, поскольку для неё используется глобальный контекст, а не контекст запроса. Это не критично, так как её значение по умолчанию — true. Этот PR исправляет это. [#81673](https://github.com/ClickHouse/ClickHouse/pull/81673) ([Han Fei](https://github.com/hanfei1991)).
* Добавлена проверка значения настройки движка MergeTree `merge_max_block_size`, чтобы гарантировать, что оно не равно нулю. [#81693](https://github.com/ClickHouse/ClickHouse/pull/81693) ([Bharat Nallan](https://github.com/bharatnc)).
* Исправлены проблемы в работе `clickhouse-local`, приводившие к зависанию запросов `DROP VIEW`. [#81705](https://github.com/ClickHouse/ClickHouse/pull/81705) ([Bharat Nallan](https://github.com/bharatnc)).
* Исправлен `JOIN` с `StorageRedis` в некоторых случаях. [#81736](https://github.com/ClickHouse/ClickHouse/pull/81736) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* Исправлен сбой в `ConcurrentHashJoin` при пустом `USING ()` и включённом старом анализаторе. [#81754](https://github.com/ClickHouse/ClickHouse/pull/81754) ([Nikita Taranov](https://github.com/nickitat)).
* Исправление в Keeper: блокировка фиксации новых записей журнала, если в журнале есть некорректная запись. Ранее, если лидер некорректно применял некоторые записи журнала, он продолжал фиксировать новые, хотя ведомый узел обнаруживал несовпадение контрольной суммы и прекращал работу. [#81780](https://github.com/ClickHouse/ClickHouse/pull/81780) ([Antonio Andelic](https://github.com/antonio2368)).