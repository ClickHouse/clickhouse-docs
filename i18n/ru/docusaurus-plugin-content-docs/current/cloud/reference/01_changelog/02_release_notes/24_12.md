---
slug: /changelogs/24.12
title: 'Журнал изменений v24.12 для Cloud'
description: 'Журнал изменений быстрого релиза v24.12'
keywords: ['changelog', 'cloud']
sidebar_label: '24.12'
sidebar_position: 4
doc_type: 'changelog'
---

Список изменений в сервисах ClickHouse Cloud на базе релиза v24.12.



## Обратно несовместимые изменения {#backward-incompatible-changes}

- Функции `greatest` и `least` теперь игнорируют входные значения NULL, тогда как ранее они возвращали NULL, если один из аргументов был NULL. Например, `SELECT greatest(1, 2, NULL)` теперь возвращает 2. Это делает поведение совместимым с PostgreSQL. [#65519](https://github.com/ClickHouse/ClickHouse/pull/65519) ([kevinyhzou](https://github.com/KevinyhZou)).
- По умолчанию запрещено использование типов Variant/Dynamic в ORDER BY/GROUP BY/PARTITION BY/PRIMARY KEY, поскольку это может привести к неожиданным результатам. [#69731](https://github.com/ClickHouse/ClickHouse/pull/69731) ([Pavel Kruglov](https://github.com/Avogar)).
- Удалены системные таблицы `generate_series` и `generateSeries`. Они были добавлены по ошибке здесь: [#59390](https://github.com/ClickHouse/ClickHouse/issues/59390). [#71091](https://github.com/ClickHouse/ClickHouse/pull/71091) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Удалён `StorageExternalDistributed`. Закрывает [#70600](https://github.com/ClickHouse/ClickHouse/issues/70600). [#71176](https://github.com/ClickHouse/ClickHouse/pull/71176) ([flynn](https://github.com/ucasfl)).
- Настройки из конфигурации сервера (users.xml) теперь также применяются на клиенте. Полезно для настроек форматирования, например `date_time_output_format`. [#71178](https://github.com/ClickHouse/ClickHouse/pull/71178) ([Michael Kolupaev](https://github.com/al13n321)).
- Исправлена возможная ошибка `No such file or directory` из-за неэкранированных специальных символов в файлах для подстолбцов JSON. [#71182](https://github.com/ClickHouse/ClickHouse/pull/71182) ([Pavel Kruglov](https://github.com/Avogar)).
- Табличные движки Kafka, NATS и RabbitMQ теперь охватываются собственными привилегиями в иерархии `SOURCES`. Добавьте привилегии всем пользователям баз данных, отличным от пользователя по умолчанию, которые создают таблицы с этими типами движков. [#71250](https://github.com/ClickHouse/ClickHouse/pull/71250) ([Christoph Wurm](https://github.com/cwurm)).
- Проверка полного запроса мутации перед его выполнением (включая подзапросы). Это предотвращает случайное выполнение некорректного запроса и накопление мёртвых мутаций, которые блокируют корректные мутации. [#71300](https://github.com/ClickHouse/ClickHouse/pull/71300) ([Christoph Wurm](https://github.com/cwurm)).
- Переименована настройка кеша файловой системы `skip_download_if_exceeds_query_cache` в `filesystem_cache_skip_download_if_exceeds_per_query_cache_write_limit`. [#71578](https://github.com/ClickHouse/ClickHouse/pull/71578) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Запрещено использование типов Dynamic/Variant в функциях min/max во избежание путаницы. [#71761](https://github.com/ClickHouse/ClickHouse/pull/71761) ([Pavel Kruglov](https://github.com/Avogar)).
- Удалена поддержка аргументов `Enum`, а также `UInt128` и `UInt256` в `deltaSumTimestamp`. Удалена поддержка `Int8`, `UInt8`, `Int16` и `UInt16` для второго аргумента ("timestamp") функции `deltaSumTimestamp`. [#71790](https://github.com/ClickHouse/ClickHouse/pull/71790) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Добавлена валидация исходного запроса, когда ClickHouse используется в качестве источника для словаря. [#72548](https://github.com/ClickHouse/ClickHouse/pull/72548) ([Alexey Katsman](https://github.com/alexkats)).


## Новые возможности {#new-features}


* Реализована команда SYSTEM LOAD PRIMARY KEY для загрузки первичных индексов для всех партиций указанной таблицы или для всех таблиц, если таблица не указана. Это будет полезно для бенчмарков и для предотвращения дополнительной задержки во время выполнения запросов. [#66252](https://github.com/ClickHouse/ClickHouse/pull/66252) ([ZAWA&#95;ll](https://github.com/Zawa-ll)).
* Добавлен оператор `SYSTEM LOAD PRIMARY KEY` для загрузки первичных индексов всех партиций в указанной таблице или для всех таблиц, если таблица не указана. Это может быть полезно для бенчмаркинга и предотвращения дополнительной задержки при выполнении запросов. [#67733](https://github.com/ClickHouse/ClickHouse/pull/67733) ([ZAWA&#95;ll](https://github.com/Zawa-ll)).
* Добавлен запрос `CHECK GRANT` для проверки, выдано ли текущему пользователю/роли конкретное привилегие и существует ли соответствующая таблица/столбец в памяти. [#68885](https://github.com/ClickHouse/ClickHouse/pull/68885) ([Unalian](https://github.com/Unalian)).
* Добавлен синтаксис SQL для описания управления нагрузками и ресурсами. [https://clickhouse.com/docs/en/operations/workload-scheduling](https://clickhouse.com/docs/en/operations/workload-scheduling). [#69187](https://github.com/ClickHouse/ClickHouse/pull/69187) ([Sergei Trifonov](https://github.com/serxa)).
* Формат хранения данных [Iceberg](https://iceberg.apache.org/spec/#file-system-operations) предоставляет пользователю широкие возможности по изменению схемы таблицы. В этом pull request реализовано чтение таблицы в формате Iceberg, в которой изменены порядок столбцов, имена столбцов и простые расширения типов. [#69445](https://github.com/ClickHouse/ClickHouse/pull/69445) ([Daniil Ivanik](https://github.com/divanik)).
* Разрешить каждому методу аутентификации иметь собственный срок действия, убрав его из сущности пользователя. [#70090](https://github.com/ClickHouse/ClickHouse/pull/70090) ([Arthur Passos](https://github.com/arthurpassos)).
* Передавать внешние роли пользователей от инициатора запроса на другие узлы кластера. Полезно, когда только инициатор имеет доступ к внешнему аутентификатору (например, LDAP). [#70332](https://github.com/ClickHouse/ClickHouse/pull/70332) ([Andrey Zvonov](https://github.com/zvonand)).
* Добавлена поддержка `ALTER` столбца из типа `String` в `JSON`. Этот PR также меняет сериализацию типов `JSON` и `Dynamic` на новую версию V2. Старая версия V1 по-прежнему может использоваться при включении настройки `merge_tree_use_v1_object_and_dynamic_serialization` (её можно задействовать во время обновления, чтобы при необходимости можно было без проблем откатиться на прежнюю версию). [#70442](https://github.com/ClickHouse/ClickHouse/pull/70442) ([Pavel Kruglov](https://github.com/Avogar)).
* Добавлена функция `toUnixTimestamp64Second`, которая преобразует `DateTime64` в значение `Int64` с фиксированной точностью до секунды, что позволяет возвращать отрицательные значения, если дата раньше 00:00:00 UTC четверга, 1 января 1970 года. [#70597](https://github.com/ClickHouse/ClickHouse/pull/70597) ([zhanglistar](https://github.com/zhanglistar)).
* Добавлена новая настройка `enforce_index_structure_match_on_partition_manipulation`, позволяющая выполнять `ATTACH`, когда проекции и вторичные индексы исходной таблицы являются подмножеством проекций и вторичных индексов целевой таблицы. Закрывает [#70602](https://github.com/ClickHouse/ClickHouse/issues/70602). [#70603](https://github.com/ClickHouse/ClickHouse/pull/70603) ([zwy991114](https://github.com/zwy991114)).
* Результат работы функции `cast` отличается от Apache Spark, что приводит к расхождениям в проекте gluten, см. [https://github.com/apache/incubator-gluten/issues/7602](https://github.com/apache/incubator-gluten/issues/7602). Этот PR добавляет поддержку текстового формата вывода Spark, по умолчанию отключён. [#70957](https://github.com/ClickHouse/ClickHouse/pull/70957) ([zhanglistar](https://github.com/zhanglistar)).
* Добавлен новый тип заголовка для S3-эндпоинтов для аутентификации пользователей (`access_header`). Это позволяет задать заголовок доступа с наименьшим приоритетом, который будет переопределён значением `access_key_id` из любого другого источника (например, из схемы таблицы или именованной коллекции). [#71011](https://github.com/ClickHouse/ClickHouse/pull/71011) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* Первоначальная реализация уровней настроек. [#71145](https://github.com/ClickHouse/ClickHouse/pull/71145) ([Raúl Marín](https://github.com/Algunenano)).
* Добавлена поддержка предложения `STALENESS` в `ORDER BY` с оператором `WITH FILL`. [#71151](https://github.com/ClickHouse/ClickHouse/pull/71151) ([Mikhail Artemenko](https://github.com/Michicosun)).
* Реализован простой `CAST` из `Map`/`Tuple`/`Object` в новый `JSON` через сериализацию/десериализацию в JSON-строку. [#71320](https://github.com/ClickHouse/ClickHouse/pull/71320) ([Pavel Kruglov](https://github.com/Avogar)).
* Добавлены псевдонимы `anyRespectNulls`, `firstValueRespectNulls` и `anyValueRespectNulls` для агрегатной функции `any`. Также добавлены псевдонимы `anyLastRespectNulls` и `lastValueRespectNulls` для агрегатной функции `anyLast`. Это позволяет использовать более естественный синтаксис в стиле camelCase вместо смешанного camel-case/underscore, например: `SELECT anyLastRespectNullsStateIf` вместо `anyLast_respect_nullsStateIf`. [#71403](https://github.com/ClickHouse/ClickHouse/pull/71403) ([Peter Nguyen](https://github.com/petern48)).
* Добавлен параметр конфигурации `date_time_utc`, позволяющий форматированию JSON-логов использовать дату и время в UTC в формате RFC 3339/ISO8601. [#71560](https://github.com/ClickHouse/ClickHouse/pull/71560) ([Ali](https://github.com/xogoodnow)).
* Добавлена опция для выбора стороны `JOIN`, которая будет выступать в роли внутренней (build) таблицы в плане запроса. Это поведение управляется настройкой `query_plan_join_swap_table`, которую можно установить в значение `auto`. В этом режиме ClickHouse будет пытаться выбрать таблицу с наименьшим количеством строк. [#71577](https://github.com/ClickHouse/ClickHouse/pull/71577) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Оптимизировано использование памяти для значений гранулярности индекса, если гранулярность постоянна для парта. Добавлена возможность всегда выбирать постоянную гранулярность для парта (настройка `use_const_adaptive_granularity`), что позволяет гарантировать её оптимальное использование в памяти. Это помогает при больших нагрузках (триллионы строк в общем хранилище) избежать постоянного роста потребления памяти метаданными (значениями гранулярности индекса) парта данных. [#71786](https://github.com/ClickHouse/ClickHouse/pull/71786) ([Anton Popov](https://github.com/CurtizJ)).
* Реализован `allowed_feature_tier` как глобальный переключатель для отключения всех экспериментальных и бета‑функций. [#71841](https://github.com/ClickHouse/ClickHouse/pull/71841) ([Raúl Marín](https://github.com/Algunenano)).
* Добавлены табличные функции `iceberg[S3;HDFS;Azure]Cluster`, `deltaLakeCluster` и `hudiCluster`. [#72045](https://github.com/ClickHouse/ClickHouse/pull/72045) ([Mikhail Artemenko](https://github.com/Michicosun)).
* Добавлены конструкции синтаксиса `ALTER USER {ADD|MODIFY|DROP SETTING}`, `ALTER USER {ADD|DROP PROFILE}`, а также аналогичные конструкции для `ALTER ROLE` и `ALTER PROFILE`. [#72050](https://github.com/ClickHouse/ClickHouse/pull/72050) ([pufit](https://github.com/pufit)).
* Добавлена функция `arrayPrAUC`, вычисляющая AUC (Area Under the Curve) для кривой Precision–Recall. [#72073](https://github.com/ClickHouse/ClickHouse/pull/72073) ([Emmanuel](https://github.com/emmanuelsdias)).
* Добавлен кэш для первичного индекса таблиц `MergeTree` (можно включить настройкой таблицы `use_primary_key_cache`). Если для первичного индекса включены отложенная загрузка и кэш, он будет загружаться в кэш по требованию (аналогично mark cache), а не постоянно находиться в памяти. Добавлен предварительный прогрев первичного индекса при вставках/слияниях/загрузке кусков данных и при перезапусках таблицы (можно включить настройкой `prewarm_primary_key_cache`). [#72102](https://github.com/ClickHouse/ClickHouse/pull/72102) ([Anton Popov](https://github.com/CurtizJ)).
* Добавлена функция indexOfAssumeSorted для массивов. Оптимизирует поиск в массиве, отсортированном по неубыванию. [#72517](https://github.com/ClickHouse/ClickHouse/pull/72517) ([Eric Kurbanov](https://github.com/erickurbanov)).
* Позволяет использовать разделитель в качестве необязательного второго аргумента агрегатной функции `groupConcat`. [#72540](https://github.com/ClickHouse/ClickHouse/pull/72540) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Новая настройка `http_response_headers`, которая позволяет настраивать HTTP-заголовки ответа. Например, можно указать браузеру отобразить изображение, которое хранится в базе данных. Это закрывает [#59620](https://github.com/ClickHouse/ClickHouse/issues/59620). [#72656](https://github.com/ClickHouse/ClickHouse/pull/72656) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Добавлена функция `fromUnixTimestamp64Second`, которая преобразует Unix-метку времени типа Int64 в DateTime64. [#73146](https://github.com/ClickHouse/ClickHouse/pull/73146) ([Robert Schulze](https://github.com/rschu1ze)).





## Улучшения производительности {#performance-improvements}


* Добавлены две новые настройки `short_circuit_function_evaluation_for_nulls` и `short_circuit_function_evaluation_for_nulls_threshold`, которые позволяют выполнять функции над столбцами типа `Nullable` в «укороченном» (short‑circuit) режиме, когда доля значений NULL в блоке данных превышает заданный порог. Это означает, что функция будет выполняться только для строк с ненулевыми (не‑NULL) значениями. Настройки применяются только к функциям, которые возвращают значение NULL для строк, где хотя бы один аргумент имеет значение NULL. [#60129](https://github.com/ClickHouse/ClickHouse/pull/60129) ([李扬](https://github.com/taiyang-li)).
* Использование памяти при выполнении `clickhouse disks remove --recursive` уменьшено для дисков объектного хранилища. [#67323](https://github.com/ClickHouse/ClickHouse/pull/67323) ([Kirill](https://github.com/kirillgarbar)).
* Теперь для `join_algorithm='parallel_hash'` мы не копируем столбцы входных блоков при их распределении между потоками для параллельной обработки. [#67782](https://github.com/ClickHouse/ClickHouse/pull/67782) ([Nikita Taranov](https://github.com/nickitat)).
* Включена JIT-компиляция для большего числа выражений: `abs`/`bitCount`/`sign`/`modulo`/`pmod`/`isNull`/`isNotNull`/`assumeNotNull`/`to(U)Int*`/`toFloat*`, функций сравнения (`=`, `<`, `>`, `>=`, `<=`) и логических функций (`and`, `or`). [#70598](https://github.com/ClickHouse/ClickHouse/pull/70598) ([李扬](https://github.com/taiyang-li)).
* Теперь алгоритм `parallel_hash` будет использоваться (если применимо), когда параметр `join_algorithm` установлен в `default`. Две предыдущие альтернативы (`direct` и `hash`) по‑прежнему используются, когда `parallel_hash` не может быть применён. [#70788](https://github.com/ClickHouse/ClickHouse/pull/70788) ([Nikita Taranov](https://github.com/nickitat)).
* Оптимизирован алгоритм слияния `Replacing` для непересекающихся частей. [#70977](https://github.com/ClickHouse/ClickHouse/pull/70977) ([Anton Popov](https://github.com/CurtizJ)).
* Не перечислять отделённые части с дисков только для чтения и дисков с однократной записью в метриках и в system.detached&#95;parts. [#71086](https://github.com/ClickHouse/ClickHouse/pull/71086) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* По умолчанию не вычислять тяжёлые асинхронные метрики. Возможность была добавлена в [#40332](https://github.com/ClickHouse/ClickHouse/issues/40332), но тяжёлое фоновое задание, нужное только одному клиенту, — не лучшая идея. [#71087](https://github.com/ClickHouse/ClickHouse/pull/71087) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Улучшены производительность и точность интервала сбора `system.query_metric_log` за счёт уменьшения критической секции. [#71473](https://github.com/ClickHouse/ClickHouse/pull/71473) ([Pablo Marcos](https://github.com/pamarcos)).
* Добавлена настройка для извлечения общих подвыражений из `WHERE` и `ON` с целью уменьшения количества хеш-таблиц, используемых при соединениях. Может быть включена с помощью `optimize_extract_common_expressions = 1`. [#71537](https://github.com/ClickHouse/ClickHouse/pull/71537) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* Позволяет использовать индексы в `SELECT` для `LowCardinality(String)`. [#71598](https://github.com/ClickHouse/ClickHouse/pull/71598) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Во время выполнения запроса с параллельными репликами и включённым локальным планом анализ пропускающих индексов на рабочих узлах не выполняется. Координатор выбирает диапазоны для чтения рабочими узлами на основе анализа индексов на своей стороне (на инициаторе запроса). [#72109](https://github.com/ClickHouse/ClickHouse/pull/72109) ([Igor Nikonov](https://github.com/devcrafter)).
* Вернул оптимизацию чтения подстолбцов одиночного столбца в Compact‑частях из [https://github.com/ClickHouse/ClickHouse/pull/57631](https://github.com/ClickHouse/ClickHouse/pull/57631). Она была случайно удалена. [#72285](https://github.com/ClickHouse/ClickHouse/pull/72285) ([Pavel Kruglov](https://github.com/Avogar)).
* Ускорена сортировка столбцов `LowCardinality(String)` за счёт девиртуализации вызовов в компараторе. [#72337](https://github.com/ClickHouse/ClickHouse/pull/72337) ([Alexander Gololobov](https://github.com/davenger)).
* Оптимизирована функция argMin/argMax для некоторых простых типов данных. [#72350](https://github.com/ClickHouse/ClickHouse/pull/72350) ([alesapin](https://github.com/alesapin)).
* Оптимизировано использование разделяемых блокировок в трекере памяти для снижения конкуренции за них. [#72375](https://github.com/ClickHouse/ClickHouse/pull/72375) ([Jiebin Sun](https://github.com/jiebinn)).
* Добавлена новая настройка `use_async_executor_for_materialized_views`. Включает асинхронное и при необходимости многопоточное выполнение запроса материализованного представления, что может ускорить обработку представлений во время INSERT, но при этом потребляет больше памяти. [#72497](https://github.com/ClickHouse/ClickHouse/pull/72497) ([alesapin](https://github.com/alesapin)).
* Значения по умолчанию для настроек `max_size_to_preallocate_for_aggregation` и `max_size_to_preallocate_for_joins` были дополнительно увеличены до `10^12`, поэтому оптимизация будет срабатывать в большем числе случаев. [#72555](https://github.com/ClickHouse/ClickHouse/pull/72555) ([Nikita Taranov](https://github.com/nickitat)).
* Улучшена производительность десериализации состояний агрегатных функций (для типа данных `AggregateFunction` и в распределённых запросах). Незначительно улучшена производительность разбора формата `RowBinary`. [#72818](https://github.com/ClickHouse/ClickHouse/pull/72818) ([Anton Popov](https://github.com/CurtizJ)).





## Улучшение {#improvement}


* Функции высшего порядка с константными массивами и константными захваченными аргументами теперь возвращают константы. [#58400](https://github.com/ClickHouse/ClickHouse/pull/58400) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Оптимизация чтения в заданном порядке за счёт генерации виртуальных строк, что позволяет читать меньше данных во время сортировки слиянием; особенно полезно при наличии нескольких частей. [#62125](https://github.com/ClickHouse/ClickHouse/pull/62125) ([Shichao Jin](https://github.com/jsc0218)).
* Названия шагов плана запроса (`EXPLAIN PLAN json=1`) и процессоров конвейера (`EXPLAIN PIPELINE compact=0,graph=1`) теперь содержат уникальный идентификатор в качестве суффикса. Это позволяет сопоставлять вывод профайлера процессоров и трассировки OpenTelemetry с выводом EXPLAIN. [#63518](https://github.com/ClickHouse/ClickHouse/pull/63518) ([qhsong](https://github.com/qhsong)).
* Добавлена опция проверки существования объекта после записи в Azure Blob Storage; она управляется настройкой `check_objects_after_upload`. [#64847](https://github.com/ClickHouse/ClickHouse/pull/64847) ([Smita Kulkarni](https://github.com/SmitaRKulkarni)).
* Исправлена логика use-after-dtor в `HashTable::destroyElements`. [#65279](https://github.com/ClickHouse/ClickHouse/pull/65279) ([cangyin](https://github.com/cangyin)).
* Использовать базу данных `Atomic` по умолчанию в `clickhouse-local`. Решены пункты 1 и 5 из [#50647](https://github.com/ClickHouse/ClickHouse/issues/50647). Закрывает [#44817](https://github.com/ClickHouse/ClickHouse/issues/44817). [#68024](https://github.com/ClickHouse/ClickHouse/pull/68024) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Буфер записи нужно явно отменять или завершать. Исключения нарушают протокол HTTP, чтобы уведомить клиента об ошибке. [#68800](https://github.com/ClickHouse/ClickHouse/pull/68800) ([Sema Checherinda](https://github.com/CheSema)).
* Отчёт о работающих хостах DDLWorker за счёт создания replica&#95;dir и пометки реплик как активных в DDLWorker. [#69658](https://github.com/ClickHouse/ClickHouse/pull/69658) ([Tuan Pham Anh](https://github.com/tuanpach)).
* 1. Рефакторинг `DDLQueryStatusSource`: - Переименовать `DDLQueryStatusSource` в `DistributedQueryStatusSource` и сделать его базовым классом - Создать два подкласса `DDLOnClusterQueryStatusSource` и `ReplicatedDatabaseQueryStatusSource`, наследующихся от `DDLQueryStatusSource`, для запроса статуса задач DDL из `DDL ON CLUSTER` и реплицируемых баз данных соответственно. 2. Реализовать прекращение ожидания офлайн-хостов в `DDLOnClusterQueryStatusSource`. [#69660](https://github.com/ClickHouse/ClickHouse/pull/69660) ([Tuan Pham Anh](https://github.com/tuanpach)).
* Добавлена новая логика отмены: `CancellationChecker` проверяет таймауты для каждого запущенного запроса и останавливает их, как только таймаут истекает. [#69880](https://github.com/ClickHouse/ClickHouse/pull/69880) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Удалена настройка `allow_experimental_join_condition`, а условия соединения, отличные от равенства, теперь разрешены по умолчанию. [#69910](https://github.com/ClickHouse/ClickHouse/pull/69910) ([Vladimir Cherkasov](https://github.com/vdimir)).
* По умолчанию включён параметр `parallel_replicas_local_plan`. Построение полнофункционального локального плана на инициаторе запроса улучшает производительность параллельных реплик при меньшем потреблении ресурсов и даёт больше возможностей для оптимизации запросов. [#70171](https://github.com/ClickHouse/ClickHouse/pull/70171) ([Igor Nikonov](https://github.com/devcrafter)).
* Добавлена возможность указывать пользователя и пароль в http&#95;handlers (для `dynamic_query_handler`/`predefined_query_handler`). [#70725](https://github.com/ClickHouse/ClickHouse/pull/70725) ([Azat Khuzhin](https://github.com/azat)).
* Добавлена поддержка `ALTER TABLE ... MODIFY/RESET SETTING ...` для части настроек в хранилище S3Queue. [#70811](https://github.com/ClickHouse/ClickHouse/pull/70811) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Не вызывайте API объектного хранилища при перечислении директорий, так как это может оказаться экономически невыгодным. Вместо этого храните список имён файлов в памяти. Обратной стороной станут увеличенное начальное время загрузки и объём памяти, необходимый для хранения имён файлов. [#70823](https://github.com/ClickHouse/ClickHouse/pull/70823) ([Julia Kartseva](https://github.com/jkartseva)).
* Добавлен параметр `--threads` в `clickhouse-compressor`, позволяющий выполнять сжатие данных параллельно. [#70860](https://github.com/ClickHouse/ClickHouse/pull/70860) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Сделан настраиваемым размер истории клиента Replxx. [#71014](https://github.com/ClickHouse/ClickHouse/pull/71014) ([Jiří Kozlovský](https://github.com/jirislav)).
* Добавлена настройка `prewarm_mark_cache`, которая позволяет загружать метки в кэш меток при вставках, слияниях, загрузке кусков и при запуске таблицы. [#71053](https://github.com/ClickHouse/ClickHouse/pull/71053) ([Anton Popov](https://github.com/CurtizJ)).
* Поддержка типа Boolean в нативном считывателе Parquet. [#71055](https://github.com/ClickHouse/ClickHouse/pull/71055) ([Arthur Passos](https://github.com/arthurpassos)).
* Добавлено повторение запросов при большем числе ошибок при взаимодействии с S3, например «Malformed message». [#71088](https://github.com/ClickHouse/ClickHouse/pull/71088) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Понижен уровень логирования для некоторых сообщений о S3. [#71090](https://github.com/ClickHouse/ClickHouse/pull/71090) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Добавлена поддержка записи файлов HDFS с пробелами в имени. [#71105](https://github.com/ClickHouse/ClickHouse/pull/71105) ([exmy](https://github.com/exmy)).
* `system.session_log` вполне подходит. Это закрывает [#51760](https://github.com/ClickHouse/ClickHouse/issues/51760). [#71150](https://github.com/ClickHouse/ClickHouse/pull/71150) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлены RIGHT / FULL JOIN в запросах с параллельными репликами. Теперь RIGHT JOIN можно выполнять с параллельными репликами (чтение правой таблицы распределено). FULL JOIN нельзя распараллеливать между узлами — он выполняется локально. [#71162](https://github.com/ClickHouse/ClickHouse/pull/71162) ([Igor Nikonov](https://github.com/devcrafter)).
* Добавлены настройки, ограничивающие количество реплицированных таблиц, словарей и представлений. [#71179](https://github.com/ClickHouse/ClickHouse/pull/71179) ([Kirill](https://github.com/kirillgarbar)).
* Исправление [#71227](https://github.com/ClickHouse/ClickHouse/issues/71227). [#71286](https://github.com/ClickHouse/ClickHouse/pull/71286) ([Arthur Passos](https://github.com/arthurpassos)).
* Автоматический вывод операций `GROUP BY`/`ORDER BY` на диск в зависимости от использования памяти сервером/пользователем. Управляется настройками запроса `max_bytes_ratio_before_external_group_by`/`max_bytes_ratio_before_external_sort`. [#71406](https://github.com/ClickHouse/ClickHouse/pull/71406) ([Azat Khuzhin](https://github.com/azat)).
* В расширенную панель мониторинга добавлены дашборды по каждому хосту `Overview (host)` и `Cloud overview (host)`. [#71422](https://github.com/ClickHouse/ClickHouse/pull/71422) ([alesapin](https://github.com/alesapin)).
* Функция `translate` теперь поддерживает удаление символов, если аргумент `from` содержит больше символов, чем аргумент `to`. Пример: `SELECT translate('clickhouse', 'clickhouse', 'CLICK')` теперь возвращает `CLICK`. [#71441](https://github.com/ClickHouse/ClickHouse/pull/71441) ([shuai.xu](https://github.com/shuai-xu)).
* Добавлены новые функции `parseDateTime64`, `parseDateTime64OrNull` и `parseDateTime64OrZero`. В отличие от существующей функции `parseDateTime` (и её вариантов), они возвращают значение типа `DateTime64` вместо `DateTime`. [#71581](https://github.com/ClickHouse/ClickHouse/pull/71581) ([kevinyhzou](https://github.com/KevinyhZou)).
* Сокращён в памяти массив `index_granularity`, чтобы уменьшить объём потребляемой памяти для семейства движков таблиц MergeTree. [#71595](https://github.com/ClickHouse/ClickHouse/pull/71595) ([alesapin](https://github.com/alesapin)).
* Консольные приложения будут подсвечивать синтаксис даже для запросов, состоящих из нескольких операторов. [#71622](https://github.com/ClickHouse/ClickHouse/pull/71622) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Командные приложения при ошибках теперь возвращают ненулевые коды выхода. В предыдущих версиях приложение `disks` при ошибках возвращало ноль, а другие приложения возвращали ноль для ошибок 256 (`PARTITION_ALREADY_EXISTS`) и 512 (`SET_NON_GRANTED_ROLE`). [#71623](https://github.com/ClickHouse/ClickHouse/pull/71623) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Формат `Vertical` (который также активируется, если завершить запрос на `\G`) получил возможности форматов Pretty, такие как: - подсветка разрядов в числах; - вывод подсказки с числом в удобочитаемом виде. [#71630](https://github.com/ClickHouse/ClickHouse/pull/71630) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Добавлена возможность отключить увеличение буфера памяти для кэша файловой системы с помощью настройки `filesystem_cache_prefer_bigger_buffer_size`. [#71640](https://github.com/ClickHouse/ClickHouse/pull/71640) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Добавлена отдельная настройка `background_download_max_file_segment_size` для максимального размера сегмента файла при фоновой загрузке в кеш файловой системы. [#71648](https://github.com/ClickHouse/ClickHouse/pull/71648) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Меняет значение по умолчанию для `enable_http_compression` с 0 на 1. Закрывает [#71591](https://github.com/ClickHouse/ClickHouse/issues/71591). [#71774](https://github.com/ClickHouse/ClickHouse/pull/71774) ([Peter Nguyen](https://github.com/petern48)).
* Добавлена поддержка ALTER для преобразования типа Object в JSON. [#71784](https://github.com/ClickHouse/ClickHouse/pull/71784) ([Pavel Kruglov](https://github.com/Avogar)).
* Немного улучшен разбор типов JSON: если текущий блок для JSON-пути содержит значения нескольких типов, выполняется попытка выбрать наиболее подходящий тип, перебирая типы в специальном порядке best-effort. [#71785](https://github.com/ClickHouse/ClickHouse/pull/71785) ([Pavel Kruglov](https://github.com/Avogar)).
* Ранее чтение из `system.asynchronous_metrics` ожидало завершения параллельного обновления. Это могло занимать много времени при высокой нагрузке на систему. С этим изменением всегда можно прочитать ранее собранные значения. [#71798](https://github.com/ClickHouse/ClickHouse/pull/71798) ([Alexander Gololobov](https://github.com/davenger)).
* Установите `polling_max_timeout_ms` в 10 минут, `polling_backoff_ms` — в 30 секунд. [#71817](https://github.com/ClickHouse/ClickHouse/pull/71817) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Запросы вроде &#39;SELECT - FROM t LIMIT 1&#39; ранее загружали индексы партиций, даже если они не использовались. [#71866](https://github.com/ClickHouse/ClickHouse/pull/71866) ([Alexander Gololobov](https://github.com/davenger)).
* Allow&#95;reorder&#95;prewhere&#95;conditions по умолчанию включён при использовании старых настроек совместимости. [#71867](https://github.com/ClickHouse/ClickHouse/pull/71867) ([Raúl Marín](https://github.com/Algunenano)).
* Не увеличивать счетчик `ILLEGAL_TYPE_OF_ARGUMENT` в таблице `system.errors` при использовании функции `bitmapTransform`, если типы аргументов допустимы. [#71971](https://github.com/ClickHouse/ClickHouse/pull/71971) ([Dmitry Novik](https://github.com/novikd)).
* При получении данных напрямую из словаря с использованием Dictionary storage, табличной функции словаря или прямого запроса SELECT к самому словарю теперь достаточно иметь права `SELECT` или `dictGet` для этого словаря. Это согласуется с предыдущими попытками предотвратить обход ACL: [https://github.com/ClickHouse/ClickHouse/pull/57362](https://github.com/ClickHouse/ClickHouse/pull/57362) и [https://github.com/ClickHouse/ClickHouse/pull/65359](https://github.com/ClickHouse/ClickHouse/pull/65359). Это также делает последнюю из них обратно совместимой. [#72051](https://github.com/ClickHouse/ClickHouse/pull/72051) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* На расширенную HTML-страницу дашборда добавлен выпадающий список для выбора дашборда из таблицы `system.dashboards`. [#72081](https://github.com/ClickHouse/ClickHouse/pull/72081) ([Sergei Trifonov](https://github.com/serxa)).
* Учитывать настройку `prefer_locahost_replica` при построении плана для распределённого запроса `INSERT ... SELECT`. [#72190](https://github.com/ClickHouse/ClickHouse/pull/72190) ([filimonov](https://github.com/filimonov)).
* Проблема [описана здесь](https://github.com/ClickHouse/ClickHouse/issues/72091). Azure Iceberg Writer создаёт файлы метаданных Iceberg (а также manifest-файлы), которые нарушают спецификации. В этом PR я добавил попытку чтения метаданных формата Iceberg v1 с помощью ридера v2 (поскольку они записывают их именно так), а также добавил ошибку на случай, если соответствующие поля не созданы в manifest-файле. [#72277](https://github.com/ClickHouse/ClickHouse/pull/72277) ([Daniil Ivanik](https://github.com/divanik)).
* Перевести типы JSON/Dynamic/Variant из экспериментальных возможностей в стадию бета. [#72294](https://github.com/ClickHouse/ClickHouse/pull/72294) ([Pavel Kruglov](https://github.com/Avogar)).
* Теперь разрешено использовать `CREATE MATERIALIZED VIEW` с `UNION [ALL]` в запросе. Поведение такое же, как у материализованного представления с `JOIN`: **в качестве триггера для вставки используется только первая таблица в выражении `SELECT`**, все остальные таблицы игнорируются. [#72347](https://github.com/ClickHouse/ClickHouse/pull/72347) ([alesapin](https://github.com/alesapin)).
* Ускорена вставка в MergeTree в случае, когда во вставляемом батче все строки имеют одно и то же значение ключа партиционирования. [#72348](https://github.com/ClickHouse/ClickHouse/pull/72348) ([alesapin](https://github.com/alesapin)).
* Добавлен новый метрик MergeTreeIndexGranularityInternalArraysTotalSize в system.metrics. Этот метрик нужен для поиска инстансов с очень крупными наборами данных, подверженных проблеме высокого потребления памяти. [#72490](https://github.com/ClickHouse/ClickHouse/pull/72490) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* Теперь все варианты написания слова `Null` распознаются, когда в запросе используется `Format Null`. Ранее другие формы (например, `NULL`) не приводили к выбрасыванию исключений, но при этом формат `Null` на самом деле не применялся в этих случаях. [#72658](https://github.com/ClickHouse/ClickHouse/pull/72658) ([Nikita Taranov](https://github.com/nickitat)).
* Разрешить в наборе неизвестные значения, которых нет в Enum. Исправление [#72662](https://github.com/ClickHouse/ClickHouse/issues/72662). [#72686](https://github.com/ClickHouse/ClickHouse/pull/72686) ([zhanglistar](https://github.com/zhanglistar)).
* Добавлен столбец total&#95;bytes&#95;with&#95;inactive в system.tables для подсчёта общего объёма данных в неактивных частях. [#72690](https://github.com/ClickHouse/ClickHouse/pull/72690) ([Kai Zhu](https://github.com/nauu)).
* Добавлены настройки MergeTree в system.settings&#95;changes. [#72694](https://github.com/ClickHouse/ClickHouse/pull/72694) ([Raúl Marín](https://github.com/Algunenano)).
* Добавлена поддержка строкового оператора поиска (например, LIKE) для типа данных Enum, исправлена проблема [#72661](https://github.com/ClickHouse/ClickHouse/issues/72661). [#72732](https://github.com/ClickHouse/ClickHouse/pull/72732) ([zhanglistar](https://github.com/zhanglistar)).
* Добавлена поддержка типа JSON в функции notEmpty. [#72741](https://github.com/ClickHouse/ClickHouse/pull/72741) ([Pavel Kruglov](https://github.com/Avogar)).
* Добавлена поддержка разбора ошибки GCS S3 `AuthenticationRequired`. [#72753](https://github.com/ClickHouse/ClickHouse/pull/72753) ([Vitaly Baranov](https://github.com/vitlibar)).
* Поддержан тип Dynamic в функциях ifNull и coalesce. [#72772](https://github.com/ClickHouse/ClickHouse/pull/72772) ([Pavel Kruglov](https://github.com/Avogar)).
* Добавлены события профилирования `JoinBuildTableRowCount/JoinProbeTableRowCount/JoinResultRowCount`. [#72842](https://github.com/ClickHouse/ClickHouse/pull/72842) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Добавлена поддержка типа `Dynamic` в функциях `toFloat64`/`toUInt32` и т.п. [#72989](https://github.com/ClickHouse/ClickHouse/pull/72989) ([Pavel Kruglov](https://github.com/Avogar)).





## Исправление ошибки (видимое пользователю некорректное поведение в официальном стабильном релизе) {#bug-fix}


* Части, дедуплицированные во время запроса `ATTACH PART`, больше не застревают с префиксом `attaching_`. [#65636](https://github.com/ClickHouse/ClickHouse/pull/65636) ([Kirill](https://github.com/kirillgarbar)).
* Исправлена ошибка, из-за которой `dateTime64` терял точность в функции `IN`. [#67230](https://github.com/ClickHouse/ClickHouse/pull/67230) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Исправлена возможная логическая ошибка при использовании функций с `IGNORE/RESPECT NULLS` в `ORDER BY ... WITH FILL`, закрыта [#57609](https://github.com/ClickHouse/ClickHouse/issues/57609). [#68234](https://github.com/ClickHouse/ClickHouse/pull/68234) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Исправлены редкие логические ошибки при асинхронных вставках в формате `Native` при достижении лимита памяти. [#68965](https://github.com/ClickHouse/ClickHouse/pull/68965) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлен COMMENT в CREATE TABLE для колонки EPHEMERAL. [#70458](https://github.com/ClickHouse/ClickHouse/pull/70458) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* Исправлена логическая ошибка в `JSONExtract` при работе с `LowCardinality(Nullable)`. [#70549](https://github.com/ClickHouse/ClickHouse/pull/70549) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлено поведение в случае, когда имя таблицы слишком длинное. [#70810](https://github.com/ClickHouse/ClickHouse/pull/70810) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Добавлена возможность переопределять Content-Type с помощью пользовательских заголовков в движке URL. [#70859](https://github.com/ClickHouse/ClickHouse/pull/70859) ([Artem Iurin](https://github.com/ortyomka)).
* Исправлена логическая ошибка в `StorageS3Queue` («Cannot create a persistent node in /processed since it already exists»). [#70984](https://github.com/ClickHouse/ClickHouse/pull/70984) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Исправлена ошибка, из-за которой при использовании параметра `rebuild` в проекциях при легковесном удалении не учитывался столбец &#95;row&#95;exists. [#71089](https://github.com/ClickHouse/ClickHouse/pull/71089) ([Shichao Jin](https://github.com/jsc0218)).
* Исправлено некорректное значение в system.query&#95;metric&#95;log из-за неожиданного состояния гонки. [#71124](https://github.com/ClickHouse/ClickHouse/pull/71124) ([Pablo Marcos](https://github.com/pamarcos)).
* Исправлено несоответствие имени агрегатной функции quantileExactWeightedInterpolated. Ошибка была внесена в [https://github.com/ClickHouse/ClickHouse/pull/69619](https://github.com/ClickHouse/ClickHouse/pull/69619). cc @Algunenano. [#71168](https://github.com/ClickHouse/ClickHouse/pull/71168) ([李扬](https://github.com/taiyang-li)).
* Исправлено исключение bad&#95;weak&#95;ptr при сравнении функций с Dynamic. [#71183](https://github.com/ClickHouse/ClickHouse/pull/71183) ([Pavel Kruglov](https://github.com/Avogar)).
* Не удалять blob, если в ReplicatedMergeTree с репликацией zero-copy есть узлы, которые его используют. [#71186](https://github.com/ClickHouse/ClickHouse/pull/71186) ([Antonio Andelic](https://github.com/antonio2368)).
* Исправлено игнорирование настроек формата при использовании формата Native через HTTP и Async Inserts. [#71193](https://github.com/ClickHouse/ClickHouse/pull/71193) ([Pavel Kruglov](https://github.com/Avogar)).
* Запросы SELECT с настройкой `use_query_cache = 1` больше не отклоняются, если имя системной таблицы встречается в виде строкового литерала, например, `SELECT - FROM users WHERE name = 'system.metrics' SETTINGS use_query_cache = true;` теперь выполняется. [#71254](https://github.com/ClickHouse/ClickHouse/pull/71254) ([Robert Schulze](https://github.com/rschu1ze)).
* Исправлена ошибка, из-за которой увеличивалось потребление памяти при enable&#95;filesystem&#95;cache=1, если для диска в конфигурации хранилища не был настроен кэш. [#71261](https://github.com/ClickHouse/ClickHouse/pull/71261) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Исправлена возможная ошибка &quot;Cannot read all data&quot; при десериализации словаря LowCardinality из столбца типа Dynamic. [#71299](https://github.com/ClickHouse/ClickHouse/pull/71299) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена некорректная очистка параллельного формата вывода в клиенте. [#71304](https://github.com/ClickHouse/ClickHouse/pull/71304) ([Raúl Marín](https://github.com/Algunenano)).
* Добавлена отсутствовавшая обработка экранирования в именованных коллекциях. Без этого исправления clickhouse-server не может запуститься. [#71308](https://github.com/ClickHouse/ClickHouse/pull/71308) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* Исправлены асинхронные вставки с пустыми блоками по нативному протоколу. [#71312](https://github.com/ClickHouse/ClickHouse/pull/71312) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлено неконсistentное форматирование AST при выдаче некорректных `wildcard`-привилегий [#71309](https://github.com/ClickHouse/ClickHouse/issues/71309). [#71332](https://github.com/ClickHouse/ClickHouse/pull/71332) ([pufit](https://github.com/pufit)).
* Проверка подозрительных и экспериментальных типов в подсказках типов JSON. [#71369](https://github.com/ClickHouse/ClickHouse/pull/71369) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена ошибка `Invalid number of rows in Chunk with Variant column`. [#71388](https://github.com/ClickHouse/ClickHouse/pull/71388) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлено падение функции таблицы `mongodb` при передаче некорректных аргументов (например, `NULL`). [#71426](https://github.com/ClickHouse/ClickHouse/pull/71426) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Исправлена ошибка, вызывавшая сбой при включённом optimize&#95;rewrite&#95;array&#95;exists&#95;to&#95;has. [#71432](https://github.com/ClickHouse/ClickHouse/pull/71432) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлена ошибка NoSuchKey при откате транзакции, возникающая при неудачном создании каталога для диска palin&#95;rewritable. [#71439](https://github.com/ClickHouse/ClickHouse/pull/71439) ([Julia Kartseva](https://github.com/jkartseva)).
* Исправлено использование настройки `max_insert_delayed_streams_for_parallel_write` при вставках. Ранее она работала некорректно, что могло приводить к высокому потреблению памяти при вставках, записывающих данные в несколько партиций. [#71474](https://github.com/ClickHouse/ClickHouse/pull/71474) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлена возможная ошибка `Argument for function must be constant` (старый анализатор) в случае, когда `arrayJoin` может появиться в условии `WHERE`. Регрессия после [https://github.com/ClickHouse/ClickHouse/pull/65414](https://github.com/ClickHouse/ClickHouse/pull/65414). [#71476](https://github.com/ClickHouse/ClickHouse/pull/71476) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* Предотвращён сбой в SortCursor с 0 столбцами (старый анализатор). [#71494](https://github.com/ClickHouse/ClickHouse/pull/71494) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлена ошибка выхода значения date32 за допустимый диапазон, вызванная неинициализированными данными ORC. Для получения дополнительной информации см. [https://github.com/apache/incubator-gluten/issues/7823](https://github.com/apache/incubator-gluten/issues/7823). [#71500](https://github.com/ClickHouse/ClickHouse/pull/71500) ([李扬](https://github.com/taiyang-li)).
* Исправлен подсчёт размера столбца в широких частях для типов данных Dynamic и JSON. [#71526](https://github.com/ClickHouse/ClickHouse/pull/71526) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена работа анализатора для случая, когда запрос внутри материализованного представления использует IN с CTE. Закрывает [#65598](https://github.com/ClickHouse/ClickHouse/issues/65598). [#71538](https://github.com/ClickHouse/ClickHouse/pull/71538) ([Maksim Kita](https://github.com/kitaisreal)).
* Возвращать 0 или символ по умолчанию вместо генерации ошибки в функциях bitShift в случае выхода за допустимые границы. [#71580](https://github.com/ClickHouse/ClickHouse/pull/71580) ([Pablo Marcos](https://github.com/pamarcos)).
* Исправлены сбои сервера при использовании материализованных представлений с некоторыми движками. [#71593](https://github.com/ClickHouse/ClickHouse/pull/71593) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* `ARRAY JOIN` с вложенной структурой данных, содержащей псевдоним на константный массив, приводил к разыменованию нулевого указателя. Это закрывает [#71677](https://github.com/ClickHouse/ClickHouse/issues/71677). [#71678](https://github.com/ClickHouse/ClickHouse/pull/71678) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлена ошибка `LOGICAL_ERROR` при выполнении `ALTER` с пустым кортежем. Это исправление решает [#71647](https://github.com/ClickHouse/ClickHouse/issues/71647). [#71679](https://github.com/ClickHouse/ClickHouse/pull/71679) ([Amos Bird](https://github.com/amosbird)).
* Не преобразовывать константное множество в предикатах по столбцам партиционирования при использовании оператора NOT IN. [#71695](https://github.com/ClickHouse/ClickHouse/pull/71695) ([Eduard Karacharov](https://github.com/korowa)).
* Исправлено приведение типа (`CAST`) из `LowCardinality(Nullable)` к `Dynamic`. Ранее это могло приводить к ошибке `Bad cast from type DB::ColumnVector<int> to DB::ColumnNullable`. [#71742](https://github.com/ClickHouse/ClickHouse/pull/71742) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена ошибка (исключение) при использовании `toDayOfWeek` в условии `WHERE` с первичным ключом типа `DateTime64`. [#71849](https://github.com/ClickHouse/ClickHouse/pull/71849) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* Исправлено заполнение значений по умолчанию после разбора в разрежённые столбцы. [#71854](https://github.com/ClickHouse/ClickHouse/pull/71854) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлена ошибка функции GROUPING при использовании в качестве входного значения ALIAS в распределённой таблице, закрыт [#68602](https://github.com/ClickHouse/ClickHouse/issues/68602). [#71855](https://github.com/ClickHouse/ClickHouse/pull/71855) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Исправлены операторы SELECT с предложением `WITH TIES`, которые могли возвращать меньше строк, чем ожидалось. [#71886](https://github.com/ClickHouse/ClickHouse/pull/71886) ([wxybear](https://github.com/wxybear)).
* Исправлено исключение TOO&#95;LARGE&#95;ARRAY&#95;SIZE, возникавшее, когда столбец результата вычисления arrayWithConstant ошибочно считался выходящим за пределы ограничения на размер массива. [#71894](https://github.com/ClickHouse/ClickHouse/pull/71894) ([Udi](https://github.com/udiz)).
* `clickhouse-benchmark` сообщал некорректные метрики для запросов, выполнявшихся более одной секунды. [#71898](https://github.com/ClickHouse/ClickHouse/pull/71898) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлена гонка данных между индикатором прогресса и таблицей прогресса в clickhouse-client. Эта проблема проявляется при использовании FROM INFILE. Теперь во время выполнения запросов INSERT перехватываются нажатия клавиш для переключения отображения таблицы прогресса. [#71901](https://github.com/ClickHouse/ClickHouse/pull/71901) ([Julia Kartseva](https://github.com/jkartseva)).
* Исправлена сериализация значений типа Dynamic в форматах Pretty JSON. [#71923](https://github.com/ClickHouse/ClickHouse/pull/71923) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлен столбец rows&#95;processed в system.s3/azure&#95;queue&#95;log, работавший некорректно в 24.6. Закрывает [#69975](https://github.com/ClickHouse/ClickHouse/issues/69975). [#71946](https://github.com/ClickHouse/ClickHouse/pull/71946) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Исправлена ситуация, когда функции `s3`/`s3Cluster` могли возвращать неполный результат или выбрасывать исключение. Это происходило при использовании glob-шаблона в s3 URI (например, `pattern/*`) и наличии пустого объекта с ключом `pattern/` (такие объекты автоматически создаются в S3 Console). Также значение по умолчанию для настройки `s3_skip_empty_files` изменено с `false` на `true`. [#71947](https://github.com/ClickHouse/ClickHouse/pull/71947) ([Nikita Taranov](https://github.com/nickitat)).
* Исправлена ошибка в подсветке синтаксиса в clickhouse-client. Закрывает [#71864](https://github.com/ClickHouse/ClickHouse/issues/71864). [#71949](https://github.com/ClickHouse/ClickHouse/pull/71949) ([Nikolay Degterinsky](https://github.com/evillique)).
* Исправлена ошибка `Illegal type` для таблиц `MergeTree` с бинарной монотонной функцией в `ORDER BY`, когда первый аргумент является константой. Исправление для [#71941](https://github.com/ClickHouse/ClickHouse/issues/71941). [#71966](https://github.com/ClickHouse/ClickHouse/pull/71966) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* В EXPLAIN AST, используемом внутри подзапроса, допускаются только запросы SELECT. Другие типы запросов приводят к логической ошибке: &#39;Bad cast from type DB::ASTCreateQuery to DB::ASTSelectWithUnionQuery&#39; или `Inconsistent AST formatting`. [#71982](https://github.com/ClickHouse/ClickHouse/pull/71982) ([Pavel Kruglov](https://github.com/Avogar)).
* При вставке записи через `clickhouse-client` клиент считывает описания столбцов с сервера. Но была ошибка: мы записывали описания в неверном порядке, тогда как правильный порядок — [statistics, ttl, settings]. [#71991](https://github.com/ClickHouse/ClickHouse/pull/71991) ([Han Fei](https://github.com/hanfei1991)).
* Исправлено форматирование операторов `ALTER` с командой `MOVE PARTITION ... TO TABLE ...` при включённом параметре `format_alter_commands_with_parentheses`. [#72080](https://github.com/ClickHouse/ClickHouse/pull/72080) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* Добавлено выводимое имя формата в запрос `CREATE` в движках File/S3/URL/HDFS/Azure. Ранее имя формата определялось заново при каждом перезапуске сервера, и если указанные файлы с данными были удалены, это приводило к ошибкам во время запуска сервера. [#72108](https://github.com/ClickHouse/ClickHouse/pull/72108) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена ошибка, из-за которой `min_age_to_force_merge_on_partition_only` застревал, пытаясь снова и снова сливать один и тот же раздел, который уже был сведен к одной части, и при этом не сливал разделы, состоящие из нескольких частей. [#72209](https://github.com/ClickHouse/ClickHouse/pull/72209) ([Christoph Wurm](https://github.com/cwurm)).
* Исправлена ошибка в `SimpleSquashingChunksTransform`, приводившая в редких случаях к сбою при обработке разреженных столбцов. [#72226](https://github.com/ClickHouse/ClickHouse/pull/72226) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Исправлена гонка данных в `GraceHashJoin`, из-за которой некоторые строки могли отсутствовать в результате выполнения соединения. [#72233](https://github.com/ClickHouse/ClickHouse/pull/72233) ([Nikita Taranov](https://github.com/nickitat)).
* Исправлены запросы `ALTER DELETE` с материализованным столбцом `_block_number` (если включена настройка `enable_block_number_column`). [#72261](https://github.com/ClickHouse/ClickHouse/pull/72261) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлена гонка данных при одновременном вызове `ColumnDynamic::dumpStructure()`, например в конструкторе `ConcurrentHashJoin`. [#72278](https://github.com/ClickHouse/ClickHouse/pull/72278) ([Nikita Taranov](https://github.com/nickitat)).
* Исправлена возможная ошибка `LOGICAL_ERROR`, возникающая при наличии дублирующихся столбцов в `ORDER BY ... WITH FILL`. [#72387](https://github.com/ClickHouse/ClickHouse/pull/72387) ([Vladimir Cherkasov](https://github.com/vdimir)).
* Исправлены расхождения типов в ряде случаев после применения `optimize_functions_to_subcolumns`. [#72394](https://github.com/ClickHouse/ClickHouse/pull/72394) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлена ошибка при разборе запросов вида `BACKUP DATABASE db EXCEPT TABLES db.table`. [#72429](https://github.com/ClickHouse/ClickHouse/pull/72429) ([Konstantin Bogdanов](https://github.com/thevar1able)).
* Не допускать создание пустого Variant. [#72454](https://github.com/ClickHouse/ClickHouse/pull/72454) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлено неверное форматирование `result_part_path` в `system.merges`. [#72567](https://github.com/ClickHouse/ClickHouse/pull/72567) ([Konстантин Богданов](https://github.com/thevar1able)).
* Исправлен разбор шаблона glob с одним элементом. [#72572](https://github.com/ClickHouse/ClickHouse/pull/72572) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* Исправлена генерация запроса для сервера-подписчика в случае распределённого запроса с ARRAY JOIN. Исправление для [#69276](https://github.com/ClickHouse/ClickHouse/issues/69276). [#72608](https://github.com/ClickHouse/ClickHouse/pull/72608) ([Dmitry Novik](https://github.com/novikd)).
* Исправлена ошибка, из-за которой `DateTime64` по `DateTime64` не возвращал ничего. [#72640](https://github.com/ClickHouse/ClickHouse/pull/72640) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Исправлена ошибка «No such key» в режиме S3Queue Unordered при значении настройки `tracked_files_limit`, меньшем скорости появления файлов в S3. [#72738](https://github.com/ClickHouse/ClickHouse/pull/72738) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Удаление кеша меток может занять заметное время, если он большой. Если при этом удерживать мьютекс контекста, это блокирует многие другие операции: даже новые клиентские подключения не могут быть установлены, пока мьютекс не будет отпущен. При этом удерживать этот мьютекс на самом деле не требуется для синхронизации — достаточно иметь локальную ссылку на кеш через `shared_ptr`. [#72749](https://github.com/ClickHouse/ClickHouse/pull/72749) ([Alexander Gololobov](https://github.com/davenger)).
* Кэш PK сильно недооценивал свой размер на одном из тестовых инстансов. В частности, для колонок типа LowCardinality не учитывался размер словаря. Исправление состоит в использовании column-&gt;allocatedBytes() плюс дополнительных оценок накладных расходов для размера элемента кэша. [#72750](https://github.com/ClickHouse/ClickHouse/pull/72750) ([Alexander Gololobov](https://github.com/davenger)).
* Исправлено исключение, выбрасываемое в RemoteQueryExecutor, если пользователь не существует локально. [#72759](https://github.com/ClickHouse/ClickHouse/pull/72759) ([Andrey Zvonov](https://github.com/zvonand)).
* Исправлены мутации с материализованным столбцом `_block_number` (при включённой настройке `enable_block_number_column`). [#72854](https://github.com/ClickHouse/ClickHouse/pull/72854) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлена работа резервного копирования и восстановления с использованием обычного перезаписываемого диска в случаях, когда в резервной копии есть пустые файлы. [#72858](https://github.com/ClickHouse/ClickHouse/pull/72858) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Правильно обрабатывать отмену вставок в DistributedAsyncInsertDirectoryQueue. [#72885](https://github.com/ClickHouse/ClickHouse/pull/72885) ([Antonio Andelic](https://github.com/antonio2368)).
* Исправлен сбой при разборе некорректных данных в разрежённые столбцы (мог возникать при включённой настройке `enable_parsing_to_custom_serialization`). [#72891](https://github.com/ClickHouse/ClickHouse/pull/72891) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлена возможная авария при восстановлении из резервной копии. [#72947](https://github.com/ClickHouse/ClickHouse/pull/72947) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Исправлена ошибка в методе JOIN `parallel_hash`, которая могла проявляться при выполнении запроса со сложным условием в предложении `ON`, содержащим фильтры с неравенствами. [#72993](https://github.com/ClickHouse/ClickHouse/pull/72993) ([Nikita Taranov](https://github.com/nickitat)).
* Используйте настройки формата по умолчанию при разборе JSON, чтобы избежать некорректной десериализации. [#73043](https://github.com/ClickHouse/ClickHouse/pull/73043) ([Pavel Kruglov](https://github.com/Avogar)).
* Исправлена ошибка, приводившая к сбою транзакций при работе с неподдерживаемым хранилищем. [#73045](https://github.com/ClickHouse/ClickHouse/pull/73045) ([Raúl Marín](https://github.com/Algunenano)).
* Добавлена проверка на дублирующиеся JSON-ключи при разборе `Tuple`. Ранее это могло приводить к логической ошибке `Invalid number of rows in Chunk` во время парсинга. [#73082](https://github.com/ClickHouse/ClickHouse/pull/73082) ([Pavel Kruglov](https://github.com/Avogar)).
