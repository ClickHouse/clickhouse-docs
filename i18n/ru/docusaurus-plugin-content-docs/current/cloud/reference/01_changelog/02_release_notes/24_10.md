---
slug: /changelogs/24.10
title: 'Список изменений v24.10 для Cloud'
description: 'Список изменений быстрого релиза v24.10'
keywords: ['changelog', 'cloud']
sidebar_label: '24.10'
sidebar_position: 6
doc_type: 'changelog'
---

Актуальные изменения в сервисах ClickHouse Cloud в релизе v24.10.

## Обратно несовместимое изменение \{#backward-incompatible-change\}

- Разрешена запись `SETTINGS` перед `FORMAT` в цепочке запросов с `UNION`, когда подзапросы заключены в круглые скобки. Это закрывает [#39712](https://github.com/ClickHouse/ClickHouse/issues/39712). Изменено поведение, когда в запросе секция SETTINGS указана дважды подряд. Ближайшая секция SETTINGS будет иметь приоритет для соответствующего подзапроса. В предыдущих версиях внешняя секция SETTINGS могла получать приоритет над внутренней. [#60197](https://github.com/ClickHouse/ClickHouse/pull/60197) [#68614](https://github.com/ClickHouse/ClickHouse/pull/68614) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Пере реализован тип Dynamic. Теперь, когда достигнут лимит динамических типов данных, новые типы не приводятся к String, а сохраняются в специальной структуре данных в двоичном формате с двоично закодированным типом данных. Теперь любой тип, когда‑либо вставленный в столбец типа Dynamic, может быть прочитан из него как подстолбец. [#68132](https://github.com/ClickHouse/ClickHouse/pull/68132) ([Pavel Kruglov](https://github.com/Avogar)).
- Выражения вида `a[b].c` поддерживаются для именованных кортежей, а также именованные обращения из произвольных выражений, например `expr().name`. Это полезно для обработки JSON. Это закрывает [#54965](https://github.com/ClickHouse/ClickHouse/issues/54965). В предыдущих версиях выражение вида `expr().name` разбиралось как `tupleElement(expr(), name)`, и анализатор запроса искал столбец `name`, а не соответствующий элемент кортежа; в новой версии оно изменено на `tupleElement(expr(), 'name')`. В большинстве случаев предыдущая версия не работала, но можно представить себе очень нетипичный сценарий, когда это изменение может привести к несовместимости: если вы хранили имена элементов кортежа в столбце или алиасе, который назывался иначе, чем имя элемента кортежа: `SELECT 'b' AS a, CAST([tuple(123)] AS 'Array(Tuple(b UInt8))') AS t, t[1].a`. Маловероятно, что вы использовали такие запросы, но мы всё же должны пометить это изменение как потенциально обратно несовместимое. [#68435](https://github.com/ClickHouse/ClickHouse/pull/68435) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Когда настройка `print_pretty_type_names` включена, тип данных `Tuple` выводится в удобочитаемом виде в командах `SHOW CREATE TABLE`, функции `formatQuery`, а также в интерактивном режиме в `clickhouse-client` и `clickhouse-local`. В предыдущих версиях эта настройка применялась только к запросам `DESCRIBE` и `toTypeName`. Это закрывает [#65753](https://github.com/ClickHouse/ClickHouse/issues/65753). [#68492](https://github.com/ClickHouse/ClickHouse/pull/68492) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Перестановка условий фильтрации в секции `[PRE]WHERE` теперь по умолчанию разрешена. Её можно отключить, установив `allow_reorder_prewhere_conditions` в значение `false`. [#70657](https://github.com/ClickHouse/ClickHouse/pull/70657) ([Nikita Taranov](https://github.com/nickitat)).
- Исправлена оптимизация `optimize_functions_to_subcolumns` (ранее могла приводить к ошибке `Invalid column type for ColumnUnique::insertRangeFrom. Expected String, got LowCardinality(String)`), за счёт сохранения типа `LowCardinality` в `mapKeys`/`mapValues`. [#70716](https://github.com/ClickHouse/ClickHouse/pull/70716) ([Azat Khuzhin](https://github.com/azat)).

## Новая возможность \{#new-feature\}

* Refreshable materialized views готовы к использованию в продакшене. [#70550](https://github.com/ClickHouse/ClickHouse/pull/70550) ([Michael Kolupaev](https://github.com/al13n321)). Refreshable materialized views теперь поддерживаются в базах данных Replicated. [#60669](https://github.com/ClickHouse/ClickHouse/pull/60669) ([Michael Kolupaev](https://github.com/al13n321)).
* Функция `toStartOfInterval()` теперь имеет новую перегрузку, которая эмулирует функцию TimescaleDB `time_bucket()`, а также функцию PostgreSQL `date_bin()`. ([#55619](https://github.com/ClickHouse/ClickHouse/issues/55619)) Она позволяет выравнивать значения дат и временных меток по кратным заданному интервалу, отсчитываемым от *произвольного* начала (вместо 0000-01-01 00:00:00.000 в качестве *фиксированного* начала). Например, `SELECT toStartOfInterval(toDateTime('2023-01-01 14:45:00'), INTERVAL 1 MINUTE, toDateTime('2023-01-01 14:35:30'));` возвращает `2023-01-01 14:44:30`, что является значением, кратным минутным интервалам, отсчитываемым от точки отсчёта `2023-01-01 14:35:30`. [#56738](https://github.com/ClickHouse/ClickHouse/pull/56738) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Рефакторинг интеграции с MongoDB: миграция на новый драйвер mongocxx вместо устаревшего Poco::MongoDB, удалена поддержка устаревшего протокола, добавлена поддержка подключения по URI, всех типов MongoDB, команд WHERE и ORDER BY на стороне MongoDB, введены ограничения на выражения, не поддерживаемые MongoDB. [#63279](https://github.com/ClickHouse/ClickHouse/pull/63279) ([Kirill Nikiforov](https://github.com/allmazz)).
* Новый параметр `--progress-table` в clickhouse-client выводит таблицу с метриками, изменяющимися во время выполнения запроса; связанный с ним параметр `--enable-progress-table-toggle` позволяет переключать отображение таблицы прогресса по нажатию комбинации клавиш Ctrl+Space. [#63689](https://github.com/ClickHouse/ClickHouse/pull/63689) ([Maria Khristenko](https://github.com/mariaKhr)).
* Это позволяет предоставлять доступ к префиксам с подстановочными символами: `GRANT SELECT ON db.table_pefix_* TO user`. [#65311](https://github.com/ClickHouse/ClickHouse/pull/65311) ([pufit](https://github.com/pufit)).
* Добавлен формат JSONCompactWithProgress, где ClickHouse выводит каждую строку в виде JSON-объекта, по одному на строку, включая метаданные, данные, прогресс, итоговые значения и статистику. [#66205](https://github.com/ClickHouse/ClickHouse/pull/66205) ([Alexey Korepanov](https://github.com/alexkorep)).
* Добавлен журнал system.query&#95;metric&#95;log, который содержит историю значений использования памяти и метрик из таблицы system.events для отдельных запросов и периодически сбрасывается на диск. [#66532](https://github.com/ClickHouse/ClickHouse/pull/66532) ([Pablo Marcos](https://github.com/pamarcos)).
* Добавлена настройка `input_format_json_empty_as_default`, которая при включении интерпретирует пустые поля во входных JSON-данных как значения по умолчанию. Закрывает [#59339](https://github.com/ClickHouse/ClickHouse/issues/59339). [#66782](https://github.com/ClickHouse/ClickHouse/pull/66782) ([Alexis Arnaud](https://github.com/a-a-f)).
* Добавлены функции `overlay` и `overlayUTF8`, которые заменяют часть строки другой строкой. Пример: `SELECT overlay('Hello New York', 'Jersey', 11)` возвращает `Hello New Jersey`. [#66933](https://github.com/ClickHouse/ClickHouse/pull/66933) ([李扬](https://github.com/taiyang-li)).
* Добавлена новая команда: легковесное удаление в партиции `DELETE FROM [db.]table [ON CLUSTER cluster] [IN PARTITION partition_expr] WHERE expr;` ``` VM-114-29-tos :) select * from ads&#95;app&#95;poster&#95;ip&#95;source&#95;channel&#95;di&#95;replicated&#95;local;. [#67805](https://github.com/ClickHouse/ClickHouse/pull/67805) ([sunny](https://github.com/sunny19930321)).
* Реализовано сравнение значений типа данных `Interval`, и теперь они приводятся к наименьшему общему надтипу. [#68057](https://github.com/ClickHouse/ClickHouse/pull/68057) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Добавлена настройка create&#95;if&#95;not&#95;exists, позволяющая по умолчанию использовать поведение IF NOT EXISTS при выполнении команд CREATE. [#68164](https://github.com/ClickHouse/ClickHouse/pull/68164) ([Peter Nguyen](https://github.com/petern48)).
* Добавляет возможность читать таблицы Iceberg в Azure и локально. [#68210](https://github.com/ClickHouse/ClickHouse/pull/68210) ([Daniil Ivanik](https://github.com/divanik)).
* Добавлены агрегатные функции distinctDynamicTypes/distinctJSONPaths/distinctJSONPathsAndTypes для более удобного анализа содержимого и типов JSON-столбцов. [#68463](https://github.com/ClickHouse/ClickHouse/pull/68463) ([Pavel Kruglov](https://github.com/Avogar)).
* Записи кэша запросов теперь можно удалять по тегу. Например, запись кэша запросов, созданная запросом `SELECT 1 SETTINGS use_query_cache = true, query_cache_tag = 'abc'`, теперь может быть удалена с помощью `SYSTEM DROP QUERY CACHE TAG 'abc'` (или, разумеется, просто: `SYSTEM DROP QUERY CACHE`, что полностью очистит кэш запросов). [#68477](https://github.com/ClickHouse/ClickHouse/pull/68477) ([Michał Tabaszewski](https://github.com/pinsvin00)).
* Простой запрос SELECT можно записывать с неявным SELECT, чтобы использовать выражения как в калькуляторе, например `ch "1 + 2"`. Это поведение задаётся новым параметром `implicit_select`. [#68502](https://github.com/ClickHouse/ClickHouse/pull/68502) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Добавлена поддержка режима --copy для clickhouse local как упрощённого способа преобразования форматов [#68503](https://github.com/ClickHouse/ClickHouse/issues/68503). [#68583](https://github.com/ClickHouse/ClickHouse/pull/68583) ([Denis Hananein](https://github.com/denis-hananein)).
* Добавлена функция `ripeMD160`, которая вычисляет криптографический хеш RIPEMD-160 для строки. Пример: `SELECT hex(ripeMD160('The quick brown fox jumps over the lazy dog'))` возвращает `37F332F68DB77BD9D7EDD4969571AD671CF9DD3B`. [#68639](https://github.com/ClickHouse/ClickHouse/pull/68639) ([Dergousov Maxim](https://github.com/m7kss1)).
* Добавлен виртуальный столбец &#95;headers для табличного движка url. Закрывает [#65026](https://github.com/ClickHouse/ClickHouse/issues/65026). [#68867](https://github.com/ClickHouse/ClickHouse/pull/68867) ([flynn](https://github.com/ucasfl)).
* Добавлена таблица `system.projections` для отслеживания доступных проекций. [#68901](https://github.com/ClickHouse/ClickHouse/pull/68901) ([Jordi Villar](https://github.com/jrdi)).
* Добавлена поддержка функции `arrayUnion`. [#68989](https://github.com/ClickHouse/ClickHouse/pull/68989) ([Peter Nguyen](https://github.com/petern48)).
* Добавлена новая функция `arrayZipUnaligned` для совместимости со Spark (`arrays_zip`), которая допускает массивы разной длины и основана на исходной `arrayZip`. ``` sql SELECT arrayZipUnaligned([1], [1, 2, 3]). [#69030](https://github.com/ClickHouse/ClickHouse/pull/69030) ([李扬](https://github.com/taiyang-li)).
* Поддержана агрегатная функция `quantileExactWeightedInterpolated`, которая представляет собой интерполированную версию `quantileExactWeighted`. Некоторые могут задаться вопросом, зачем нужна новая `quantileExactWeightedInterpolated`, если у нас уже есть `quantileExactInterpolatedWeighted`. Причина в том, что новая функция более точная, чем старая. Кроме того, она нужна для совместимости со Spark в Apache Gluten. [#69619](https://github.com/ClickHouse/ClickHouse/pull/69619) ([李扬](https://github.com/taiyang-li)).
* Добавлена поддержка функции arrayElementOrNull. Она возвращает null, если индекс массива выходит за пределы или ключ в map не найден. [#69646](https://github.com/ClickHouse/ClickHouse/pull/69646) ([李扬](https://github.com/taiyang-li)).
* Добавлена поддержка типа Dynamic в большинстве функций за счёт выполнения их над внутренними типами, хранящимися в Dynamic. [#69691](https://github.com/ClickHouse/ClickHouse/pull/69691) ([Pavel Kruglov](https://github.com/Avogar)).
* Добавлен аргумент `scale` (по умолчанию: `true`) в функцию `arrayAUC`, который позволяет пропустить шаг нормализации (issue [#69609](https://github.com/ClickHouse/ClickHouse/issues/69609)). [#69717](https://github.com/ClickHouse/ClickHouse/pull/69717) ([gabrielmcg44](https://github.com/gabrielmcg44)).
* Повторно добавлена функция `RIPEMD160`, которая вычисляет криптографический хеш RIPEMD-160 для строки. Пример: `SELECT HEX(RIPEMD160('The quick brown fox jumps over the lazy dog'))` возвращает `37F332F68DB77BD9D7EDD4969571AD671CF9DD3B`. [#70087](https://github.com/ClickHouse/ClickHouse/pull/70087) ([Dergousov Maxim](https://github.com/m7kss1)).
* Разрешить кэширование файлов при чтении для движков таблиц объектного хранилища и озёр данных, используя хеш, вычисленный по ETag и пути к файлу, в качестве ключа кэша. [#70135](https://github.com/ClickHouse/ClickHouse/pull/70135) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Поддерживается чтение таблиц Iceberg из HDFS. [#70268](https://github.com/ClickHouse/ClickHouse/pull/70268) ([flynn](https://github.com/ucasfl)).
* Добавлена возможность чтения/записи типа JSON как бинарной строки в формате RowBinary при включённых настройках `input_format_binary_read_json_as_string/output_format_binary_write_json_as_string`. [#70288](https://github.com/ClickHouse/ClickHouse/pull/70288) ([Pavel Kruglov](https://github.com/Avogar)).
* Позволяет сериализовать/десериализовать столбец JSON как один столбец типа String в формате Native. Для вывода используйте настройку `output_format_native_write_json_as_string`. Для ввода используйте версию сериализации `1` перед данными столбца. [#70312](https://github.com/ClickHouse/ClickHouse/pull/70312) ([Pavel Kruglov](https://github.com/Avogar)).
* Теперь поддерживается стандартный CTE `with insert`, ранее поддерживался только `insert ... with ...`. [#70593](https://github.com/ClickHouse/ClickHouse/pull/70593) ([Shichao Jin](https://github.com/jsc0218)).