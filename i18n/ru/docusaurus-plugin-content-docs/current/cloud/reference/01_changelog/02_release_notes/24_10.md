---
slug: /changelogs/24.10
title: 'Журнал изменений v24.10 для ClickHouse Cloud'
description: 'Журнал изменений быстрого релиза v24.10'
keywords: ['changelog', 'cloud']
sidebar_label: '24.10'
sidebar_position: 5
doc_type: 'changelog'
---

Актуальные изменения для сервисов ClickHouse Cloud на основе релиза v24.10.



## Обратно несовместимые изменения {#backward-incompatible-change}

- Разрешена запись `SETTINGS` перед `FORMAT` в цепочке запросов с `UNION`, когда подзапросы находятся внутри скобок. Это закрывает [#39712](https://github.com/ClickHouse/ClickHouse/issues/39712). Изменено поведение, когда в запросе дважды указана секция SETTINGS. Ближайшая секция SETTINGS будет иметь приоритет для соответствующего подзапроса. В предыдущих версиях внешняя секция SETTINGS могла иметь приоритет над внутренней. [#60197](https://github.com/ClickHouse/ClickHouse/pull/60197)[#68614](https://github.com/ClickHouse/ClickHouse/pull/68614) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Переработан тип Dynamic. Теперь при достижении лимита динамических типов данных новые типы не приводятся к String, а сохраняются в специальной структуре данных в бинарном формате с бинарно закодированным типом данных. Теперь любой тип, когда-либо вставленный в столбец Dynamic, может быть прочитан из него как подстолбец. [#68132](https://github.com/ClickHouse/ClickHouse/pull/68132) ([Pavel Kruglov](https://github.com/Avogar)).
- Поддерживаются выражения вида `a[b].c` для именованных кортежей, а также именованные индексы из произвольных выражений, например `expr().name`. Это полезно для обработки JSON. Это закрывает [#54965](https://github.com/ClickHouse/ClickHouse/issues/54965). В предыдущих версиях выражение вида `expr().name` разбиралось как `tupleElement(expr(), name)`, и анализатор запросов искал столбец `name`, а не соответствующий элемент кортежа; в новой версии это изменено на `tupleElement(expr(), 'name')`. В большинстве случаев предыдущая версия не работала, но можно представить очень необычный сценарий, когда это изменение может привести к несовместимости: если вы хранили имена элементов кортежа в столбце или псевдониме, который был назван иначе, чем имя элемента кортежа: `SELECT 'b' AS a, CAST([tuple(123)] AS 'Array(Tuple(b UInt8))') AS t, t[1].a`. Крайне маловероятно, что вы использовали такие запросы, но мы всё равно должны отметить это изменение как потенциально обратно несовместимое. [#68435](https://github.com/ClickHouse/ClickHouse/pull/68435) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Когда включена настройка `print_pretty_type_names`, тип данных `Tuple` будет выводиться в удобочитаемом формате в операторах `SHOW CREATE TABLE`, функции `formatQuery` и в интерактивном режиме в `clickhouse-client` и `clickhouse-local`. В предыдущих версиях эта настройка применялась только к запросам `DESCRIBE` и `toTypeName`. Это закрывает [#65753](https://github.com/ClickHouse/ClickHouse/issues/65753). [#68492](https://github.com/ClickHouse/ClickHouse/pull/68492) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Переупорядочивание условий фильтрации из секции `[PRE]WHERE` теперь разрешено по умолчанию. Это можно отключить, установив `allow_reorder_prewhere_conditions` в `false`. [#70657](https://github.com/ClickHouse/ClickHouse/pull/70657) ([Nikita Taranov](https://github.com/nickitat)).
- Исправлена оптимизация `optimize_functions_to_subcolumns` (ранее могла приводить к ошибке `Invalid column type for ColumnUnique::insertRangeFrom. Expected String, got LowCardinality(String)`) путём сохранения типа `LowCardinality` в `mapKeys`/`mapValues`. [#70716](https://github.com/ClickHouse/ClickHouse/pull/70716) ([Azat Khuzhin](https://github.com/azat)).


## Новая функция {#new-feature}

- Обновляемые материализованные представления готовы к использованию в production. [#70550](https://github.com/ClickHouse/ClickHouse/pull/70550) ([Michael Kolupaev](https://github.com/al13n321)). Обновляемые материализованные представления теперь поддерживаются в реплицируемых базах данных. [#60669](https://github.com/ClickHouse/ClickHouse/pull/60669) ([Michael Kolupaev](https://github.com/al13n321)).
- Функция `toStartOfInterval()` теперь имеет новую перегрузку, которая эмулирует функцию `time_bucket()` из TimescaleDB и функцию `date_bin()` из PostgreSQL соответственно. ([#55619](https://github.com/ClickHouse/ClickHouse/issues/55619)). Это позволяет выравнивать значения даты или временной метки по кратным заданному интервалу от _произвольной_ точки отсчета (вместо фиксированной точки отсчета 0000-01-01 00:00:00.000). Например, `SELECT toStartOfInterval(toDateTime('2023-01-01 14:45:00'), INTERVAL 1 MINUTE, toDateTime('2023-01-01 14:35:30'));` возвращает `2023-01-01 14:44:30`, что является кратным интервалу в 1 минуту, начиная с точки отсчета `2023-01-01 14:35:30`. [#56738](https://github.com/ClickHouse/ClickHouse/pull/56738) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
- Интеграция с MongoDB переработана: миграция на новый драйвер mongocxx с устаревшего Poco::MongoDB, удалена поддержка устаревшего старого протокола, добавлена поддержка подключения по URI, поддержка всех типов MongoDB, поддержка операторов WHERE и ORDER BY на стороне MongoDB, ограничение для выражений, не поддерживаемых MongoDB. [#63279](https://github.com/ClickHouse/ClickHouse/pull/63279) ([Kirill Nikiforov](https://github.com/allmazz)).
- Новая опция `--progress-table` в clickhouse-client выводит таблицу с метриками, изменяющимися во время выполнения запроса; новая опция `--enable-progress-table-toggle` связана с опцией `--progress-table` и переключает отображение таблицы прогресса нажатием управляющей клавиши (пробел). [#63689](https://github.com/ClickHouse/ClickHouse/pull/63689) ([Maria Khristenko](https://github.com/mariaKhr)).
- Это позволяет предоставлять доступ к префиксам с подстановочными знаками. `GRANT SELECT ON db.table_pefix_* TO user`. [#65311](https://github.com/ClickHouse/ClickHouse/pull/65311) ([pufit](https://github.com/pufit)).
- Представлен формат JSONCompactWithProgress, в котором ClickHouse выводит каждую строку как JSON-объект, разделенный символом новой строки, включая метаданные, данные, прогресс, итоги и статистику. [#66205](https://github.com/ClickHouse/ClickHouse/pull/66205) ([Alexey Korepanov](https://github.com/alexkorep)).
- Добавлена таблица system.query_metric_log, которая содержит историю значений памяти и метрик из таблицы system.events для отдельных запросов, периодически сбрасываемую на диск. [#66532](https://github.com/ClickHouse/ClickHouse/pull/66532) ([Pablo Marcos](https://github.com/pamarcos)).
- Добавлена настройка `input_format_json_empty_as_default`, которая при включении обрабатывает пустые поля во входных данных JSON как значения по умолчанию. Закрывает [#59339](https://github.com/ClickHouse/ClickHouse/issues/59339). [#66782](https://github.com/ClickHouse/ClickHouse/pull/66782) ([Alexis Arnaud](https://github.com/a-a-f)).
- Добавлены функции `overlay` и `overlayUTF8`, которые заменяют части строки другой строкой. Пример: `SELECT overlay('Hello New York', 'Jersey', 11)` возвращает `Hello New Jersey`. [#66933](https://github.com/ClickHouse/ClickHouse/pull/66933) ([李扬](https://github.com/taiyang-li)).
- Добавлена новая команда, легковесное удаление в партиции `DELETE FROM [db.]table [ON CLUSTER cluster] [IN PARTITION partition_expr] WHERE expr;` ``` VM-114-29-tos :) select \* from ads_app_poster_ip_source_channel_di_replicated_local;. [#67805](https://github.com/ClickHouse/ClickHouse/pull/67805) ([sunny](https://github.com/sunny19930321)).
- Реализовано сравнение для значений типа данных `Interval`, теперь они преобразуются к наименьшему супертипу. [#68057](https://github.com/ClickHouse/ClickHouse/pull/68057) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
- Добавлена настройка create_if_not_exists для использования по умолчанию поведения IF NOT EXISTS в операторах CREATE. [#68164](https://github.com/ClickHouse/ClickHouse/pull/68164) ([Peter Nguyen](https://github.com/petern48)).
- Обеспечена возможность чтения таблиц Iceberg в Azure и локально. [#68210](https://github.com/ClickHouse/ClickHouse/pull/68210) ([Daniil Ivanik](https://github.com/divanik)).
- Добавлены агрегатные функции distinctDynamicTypes/distinctJSONPaths/distinctJSONPathsAndTypes для улучшенной интроспекции содержимого типа столбца JSON. [#68463](https://github.com/ClickHouse/ClickHouse/pull/68463) ([Pavel Kruglov](https://github.com/Avogar)).
- Записи кеша запросов теперь можно удалять по тегу. Например, запись кеша запросов, созданная командой `SELECT 1 SETTINGS use_query_cache = true, query_cache_tag = 'abc'`, теперь может быть удалена командой `SYSTEM DROP QUERY CACHE TAG 'abc'` (или, конечно, просто: `SYSTEM DROP QUERY CACHE`, что очистит весь кеш запросов). [#68477](https://github.com/ClickHouse/ClickHouse/pull/68477) ([Michał Tabaszewski](https://github.com/pinsvin00)).
- Простой запрос SELECT можно написать с неявным SELECT для включения выражений в стиле калькулятора, например, `ch "1 + 2"`. Это управляется новой настройкой `implicit_select`. [#68502](https://github.com/ClickHouse/ClickHouse/pull/68502) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Поддержка режима --copy для clickhouse local в качестве сокращения для преобразования форматов [#68503](https://github.com/ClickHouse/ClickHouse/issues/68503). [#68583](https://github.com/ClickHouse/ClickHouse/pull/68583) ([Denis Hananein](https://github.com/denis-hananein)).
- Добавлена функция `ripeMD160`, которая вычисляет криптографический хеш RIPEMD-160 строки. Пример: `SELECT hex(ripeMD160('The quick brown fox jumps over the lazy dog'))` возвращает `37F332F68DB77BD9D7EDD4969571AD671CF9DD3B`. [#68639](https://github.com/ClickHouse/ClickHouse/pull/68639) ([Dergousov Maxim](https://github.com/m7kss1)).
- Добавлен виртуальный столбец \_headers для движка таблиц url. Закрывает [#65026](https://github.com/ClickHouse/ClickHouse/issues/65026). [#68867](https://github.com/ClickHouse/ClickHouse/pull/68867) ([flynn](https://github.com/ucasfl)).
- Добавлена таблица `system.projections` для отслеживания доступных проекций. [#68901](https://github.com/ClickHouse/ClickHouse/pull/68901) ([Jordi Villar](https://github.com/jrdi)).
- Добавлена поддержка функции `arrayUnion`. [#68989](https://github.com/ClickHouse/ClickHouse/pull/68989) ([Peter Nguyen](https://github.com/petern48)).
- Добавлена новая функция `arrayZipUnaligned` для совместимости со Spark (arrays_zip), которая позволяет использовать несовпадающие по длине массивы на основе оригинальной функции `arrayZip`. ``` sql SELECT arrayZipUnaligned([1], [1, 2, 3]). [#69030](https://github.com/ClickHouse/ClickHouse/pull/69030) ([李扬](https://github.com/taiyang-li)).
- Поддержка агрегатной функции `quantileExactWeightedInterpolated`, которая является интерполированной версией на основе quantileExactWeighted. Некоторые могут задаться вопросом, зачем нужна новая функция `quantileExactWeightedInterpolated`, если у нас уже есть `quantileExactInterpolatedWeighted`. Причина в том, что новая функция более точная, чем старая. Кстати, она предназначена для совместимости со Spark в Apache Gluten. [#69619](https://github.com/ClickHouse/ClickHouse/pull/69619) ([李扬](https://github.com/taiyang-li)).
- Поддержка функции arrayElementOrNull. Она возвращает null, если индекс массива выходит за пределы диапазона или ключ словаря не найден. [#69646](https://github.com/ClickHouse/ClickHouse/pull/69646) ([李扬](https://github.com/taiyang-li)).
- Поддержка типа Dynamic в большинстве функций путем их выполнения на внутренних типах внутри Dynamic. [#69691](https://github.com/ClickHouse/ClickHouse/pull/69691) ([Pavel Kruglov](https://github.com/Avogar)).
- Добавлен аргумент `scale` (по умолчанию: `true`) к функции `arrayAUC`, который позволяет пропустить этап нормализации (issue [#69609](https://github.com/ClickHouse/ClickHouse/issues/69609)). [#69717](https://github.com/ClickHouse/ClickHouse/pull/69717) ([gabrielmcg44](https://github.com/gabrielmcg44)).
- Повторно добавлена функция `RIPEMD160`, которая вычисляет криптографический хеш RIPEMD-160 строки. Пример: `SELECT HEX(RIPEMD160('The quick brown fox jumps over the lazy dog'))` возвращает `37F332F68DB77BD9D7EDD4969571AD671CF9DD3B`. [#70087](https://github.com/ClickHouse/ClickHouse/pull/70087) ([Dergousov Maxim](https://github.com/m7kss1)).
- Разрешено кеширование прочитанных файлов для движков таблиц объектного хранилища и озер данных с использованием хеша из ETag + путь к файлу в качестве ключа кеша. [#70135](https://github.com/ClickHouse/ClickHouse/pull/70135) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Поддержка чтения таблиц Iceberg на HDFS. [#70268](https://github.com/ClickHouse/ClickHouse/pull/70268) ([flynn](https://github.com/ucasfl)).
- Разрешено чтение/запись типа JSON как бинарной строки в формате RowBinary с помощью настроек `input_format_binary_read_json_as_string/output_format_binary_write_json_as_string`. [#70288](https://github.com/ClickHouse/ClickHouse/pull/70288) ([Pavel Kruglov](https://github.com/Avogar)).
- Разрешена сериализация/десериализация столбца JSON как единого столбца String в формате Native. Для вывода используйте настройку `output_format_native_write_json_as_string`. Для ввода используйте версию сериализации `1` перед данными столбца. [#70312](https://github.com/ClickHouse/ClickHouse/pull/70312) ([Pavel Kruglov](https://github.com/Avogar)).
- Поддержка стандартного CTE, `with insert`, поскольку ранее поддерживался только `insert ... with ...`. [#70593](https://github.com/ClickHouse/ClickHouse/pull/70593) ([Shichao Jin](https://github.com/jsc0218)).
