---
slug: /changelogs/24.8
title: 'Журнал изменений v24.8 для Cloud'
description: 'Журнал изменений быстрого релиза v24.8'
keywords: ['changelog', 'cloud']
sidebar_label: '24.8'
sidebar_position: 6
doc_type: 'changelog'
---

Основные изменения в сервисах ClickHouse Cloud на основе релиза v24.8.



## Обратно несовместимые изменения {#backward-incompatible-change}

- Изменена бинарная сериализация типа данных Variant: добавлен компактный режим для предотвращения многократной записи одного и того же дискриминатора для гранул с единственным вариантом или только NULL-значениями. Добавлена настройка MergeTree use_compact_variant_discriminators_serialization, которая включена по умолчанию. Обратите внимание, что тип Variant всё ещё является экспериментальным, и обратно несовместимое изменение в сериализации не должно повлиять на вас, если только вы не работали со службой поддержки для досрочного включения этой функции. [#62774](https://github.com/ClickHouse/ClickHouse/pull/62774) (Kruglov Pavel).

- Запрещено использование CREATE MATERIALIZED VIEW ... ENGINE Replicated\*MergeTree POPULATE AS SELECT ... с реплицируемыми базами данных. Это конкретное изменение применимо только к пользователям, которые всё ещё используют ReplicatedMergeTree. [#63963](https://github.com/ClickHouse/ClickHouse/pull/63963) (vdimir).

- Метрика KeeperOutstandingRequets переименована в KeeperOutstandingRequests. Это исправляет опечатку, о которой сообщалось в [#66179](https://github.com/ClickHouse/ClickHouse/issues/66179). [#66206](https://github.com/ClickHouse/ClickHouse/pull/66206) (Robert Schulze).

- clickhouse-client и clickhouse-local теперь по умолчанию работают в режиме множественных запросов (вместо режима одиночного запроса). Например, clickhouse-client -q "SELECT 1; SELECT 2" теперь работает, тогда как раньше пользователям приходилось добавлять --multiquery (или -n). Переключатель --multiquery/-n стал устаревшим. Запросы INSERT в операторах с множественными запросами обрабатываются особым образом на основе их секции FORMAT: если FORMAT имеет значение VALUES (наиболее распространённый случай), конец оператора INSERT обозначается завершающей точкой с запятой ; в конце запроса. Для всех остальных FORMAT (например, CSV или JSONEachRow) конец оператора INSERT обозначается двумя символами новой строки \n\n в конце запроса. [#63898](https://github.com/ClickHouse/ClickHouse/pull/63898) (wxybear).

- В предыдущих версиях можно было использовать альтернативный синтаксис для типов данных LowCardinality, добавляя WithDictionary к имени типа данных. Это была первоначальная рабочая реализация, которая никогда не была документирована или представлена публично. Теперь она устарела. Если вы использовали этот синтаксис, вам необходимо выполнить ALTER для ваших таблиц и переименовать типы данных в LowCardinality. [#66842](https://github.com/ClickHouse/ClickHouse/pull/66842)(Alexey Milovidov).

- Исправлены логические ошибки при использовании движка Buffer с распределённой целевой таблицей. Это обратно несовместимое изменение: запросы, использующие Buffer с распределённой целевой таблицей, могут перестать работать, если таблица встречается в запросе более одного раза (например, в самосоединении). [#67015](https://github.com/vdimir) (vdimir).

- В предыдущих версиях вызов функций для случайных распределений на основе гамма-функции (таких как Chi-Squared, Student, Fisher) с отрицательными аргументами, близкими к нулю, приводил к длительным вычислениям или бесконечному циклу. В новой версии вызов этих функций с нулевыми или отрицательными аргументами будет генерировать исключение. Это закрывает [#67297](https://github.com/ClickHouse/ClickHouse/issues/67297). [#67326](https://github.com/ClickHouse/ClickHouse/pull/67326) (Alexey Milovidov).

- В предыдущих версиях arrayWithConstant могла работать медленно при генерации очень больших массивов. В новой версии размер ограничен 1 ГБ на массив. Это закрывает [#32754](https://github.com/ClickHouse/ClickHouse/issues/32754). [#67741](https://github.com/ClickHouse/ClickHouse/pull/67741) (Alexey Milovidov).

- Исправлено форматирование модификатора REPLACE (запрещено опускать скобки). [#67774](https://github.com/ClickHouse/ClickHouse/pull/67774) (Azat Khuzhin).


## Новые возможности {#new-feature}

- Расширена функция tuple для создания именованных кортежей в запросах. Добавлена функция tupleNames для извлечения имён из кортежей. [#54881](https://github.com/ClickHouse/ClickHouse/pull/54881) (Amos Bird).

- Поддержка ASOF JOIN для алгоритма full_sorting_join. Закрывает [#54493](https://github.com/ClickHouse/ClickHouse/issues/54493). [#55051](https://github.com/ClickHouse/ClickHouse/pull/55051) (vdimir).

- Добавлена новая табличная функция fuzzQuery. Эта функция позволяет модифицировать заданную строку запроса случайными вариациями. Пример: SELECT query FROM fuzzQuery('SELECT 1');. [#62103](https://github.com/ClickHouse/ClickHouse/pull/62103) (pufit).

- Добавлена новая оконная функция percent_rank. [#62747](https://github.com/ClickHouse/ClickHouse/pull/62747) (lgbo).

- Поддержка JWT-аутентификации в clickhouse-client. [#62829](https://github.com/ClickHouse/ClickHouse/pull/62829) (Konstantin Bogdanov).

- Добавлены SQL-функции changeYear, changeMonth, changeDay, changeHour, changeMinute, changeSecond. Например, SELECT changeMonth(toDate('2024-06-14'), 7) возвращает дату 2024-07-14. [#63186](https://github.com/ClickHouse/ClickHouse/pull/63186) (cucumber95).

- Добавлена таблица system.error_log, которая содержит историю значений ошибок из таблицы system.errors, периодически сбрасываемых на диск. [#65381](https://github.com/ClickHouse/ClickHouse/pull/65381) (Pablo Marcos).

- Добавлена агрегатная функция groupConcat. Примерно эквивалентна arrayStringConcat(groupArray(column), ','). Может принимать 2 параметра: строковый разделитель и количество обрабатываемых элементов. [#65451](https://github.com/ClickHouse/ClickHouse/pull/65451) (Yarik Briukhovetskyi).

- Добавлено хранилище AzureQueue. [#65458](https://github.com/ClickHouse/ClickHouse/pull/65458) (Kseniia Sumarokova).

- Добавлена новая настройка для включения/отключения записи индекса страниц в файлы parquet. [#65475](https://github.com/ClickHouse/ClickHouse/pull/65475) (lgbo).

- Автоматическое добавление символа подстановки \* в конец пути к директории при использовании табличной функции file. [#66019](https://github.com/ClickHouse/ClickHouse/pull/66019) (Zhidong (David) Guo).

- Добавлена опция --memory-usage для клиента в неинтерактивном режиме. [#66393](https://github.com/ClickHouse/ClickHouse/pull/66393) (vdimir).

- Добавлен виртуальный столбец \_etag для движка таблиц S3. Исправляет [#65312](https://github.com/ClickHouse/ClickHouse/issues/65312). [#65386](https://github.com/ClickHouse/ClickHouse/pull/65386) (skyoct)

- Этот pull request добавляет партиционирование в стиле Hive для различных движков (File, URL, S3, AzureBlobStorage, HDFS). Партиционирование в стиле Hive организует данные в партиционированные поддиректории, что обеспечивает эффективные запросы и управление большими наборами данных. В настоящее время создаются только виртуальные столбцы с соответствующими именами и данными. Последующий PR добавит соответствующую фильтрацию данных (повышение производительности). [#65997](https://github.com/ClickHouse/ClickHouse/pull/65997) (Yarik Briukhovetskyi).

- Добавлена функция printf для совместимости со Spark. [#66257](https://github.com/ClickHouse/ClickHouse/pull/66257) (李扬).

- Добавлена поддержка чтения геометрии MULTILINESTRING в формате WKT с использованием функции readWKTLineString. [#67647](https://github.com/ClickHouse/ClickHouse/pull/67647) (Jacob Reckhard).

- Добавлен механизм тегирования (пространства имён) для кеша запросов. Одинаковые запросы с разными тегами рассматриваются кешем запросов как различные. Пример: SELECT 1 SETTINGS use_query_cache = 1, query_cache_tag = 'abc' и SELECT 1 SETTINGS use_query_cache = 1, query_cache_tag = 'def' теперь создают разные записи в кеше запросов. [#68235](https://github.com/ClickHouse/ClickHouse/pull/68235)(sakulali).
