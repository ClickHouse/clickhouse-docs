---
sidebar_label: Настройка фильтров IP
slug: /cloud/security/setting-ip-filters
title: Настройка фильтров IP
---

import ip_filtering_after_provisioning from '@site/static/images/cloud/security/ip-filtering-after-provisioning.png';
import ip_filter_add_single_ip from '@site/static/images/cloud/security/ip-filter-add-single-ip.png';

## Настройка фильтров IP {#setting-ip-filters}

Списки доступа по IP фильтруют трафик к вашим услугам ClickHouse, указывая, какие адреса источников имеют право подключаться к вашей службе ClickHouse. Списки настраиваются для каждой службы. Их можно настроить во время развертывания услуги или после. Если вы не настроите список доступа по IP во время provisionинга или если вы хотите внести изменения в свой начальный список, вы можете сделать это, выбрав службу, а затем вкладку **Безопасность**.

:::important
Если вы пропустите создание списка доступа по IP для службы ClickHouse Cloud, то никакой трафик не будет разрешен к этой службе.
:::

## Подготовка {#prepare}
Перед началом соберите IP-адреса или диапазоны, которые должны быть добавлены в список доступа. Учитывайте удаленных работников, места дежурства, VPN и т. д. Интерфейс пользователя списка доступа по IP принимает отдельные адреса и нотацию CIDR.

Нотация классической маршрутизации без классов (CIDR) позволяет указывать диапазоны IP-адресов меньшего размера, чем традиционные размеры масок подсети классов A, B или C (8, 6 или 24). [ARIN](https://account.arin.net/public/cidrCalculator) и несколько других организаций предоставляют калькуляторы CIDR, если вам это нужно. Если вы хотите больше информации о нотации CIDR, пожалуйста, ознакомьтесь с [Классической маршрутизацией без классов (CIDR)](https://www.rfc-editor.org/rfc/rfc4632.html) RFC.

## Создание или изменение списка доступа по IP {#create-or-modify-an-ip-access-list}

В списке ваших услуг ClickHouse Cloud выберите службу, а затем выберите **Настройки**. В разделе **Безопасность** вы найдете список доступа по IP. Нажмите на гиперссылку, где написано: *Вы можете подключиться к этой службе из* **(откуда угодно | x конкретных местоположений)**

Появится боковая панель с опциями для настройки:

- Разрешить входящий трафик из любых источников к службе
- Разрешить доступ из конкретных местоположений к службе
- Запретить весь доступ к службе

Этот снимок экрана показывает список доступа, который разрешает трафик из диапазона IP-адресов, описанный как "Диапазон офиса в NY":

<img src={ip_filtering_after_provisioning} alt="Существующий список доступа в ClickHouse Cloud" />

### Возможные действия {#possible-actions}

1. Чтобы добавить дополнительную запись, вы можете использовать **+ Добавить новый IP**

   Этот пример добавляет один IP-адрес с описанием `Лондонский сервер`:

<img src={ip_filter_add_single_ip} alt="Добавление одного IP в список доступа в ClickHouse Cloud" />

1. Удалить существующую запись

   Нажатие на крестообразный значок (x) может удалить запись

1. Изменить существующую запись

   Прямое изменение записи

1. Переключиться на разрешение доступа **Откуда угодно**

   Это не рекомендуется, но разрешено. Мы рекомендуем, чтобы ваше приложение, построенное на основе ClickHouse, было открыто для публичного доступа, а доступ к бэкенд-службе ClickHouse Cloud ограничивался.

Чтобы применить внесенные изменения, необходимо нажать **Сохранить**.

## Проверка {#verification}

Как только вы создадите свой фильтр, подтвердите подключение из диапазона и проверьте, что соединения снаружи разрешенного диапазона отклоняются. Простая команда `curl` может быть использована для проверки:
```bash title="Попытка отклонена снаружи списка разрешенных"
curl https://<HOSTNAME>.clickhouse.cloud:8443
```
```response
curl: (35) error:02FFF036:system library:func(4095):Connection reset by peer
```
или
```response
curl: (35) LibreSSL SSL_connect: SSL_ERROR_SYSCALL in connection to HOSTNAME.clickhouse.cloud:8443
```

```bash title="Попытка разрешена изнутри списка разрешенных"
curl https://<HOSTNAME>.clickhouse.cloud:8443
```
```response
Ok.
```

## Ограничения {#limitations}

- В настоящее время списки доступа по IP поддерживают только IPv4
