---
slug: /faq/use-cases/key-value
title: 'Могу ли я использовать ClickHouse как key-value‑хранилище?'
toc_hidden: true
toc_priority: 101
description: 'Ответ на часто задаваемый вопрос о том, можно ли использовать ClickHouse как key-value‑хранилище.'
doc_type: 'reference'
keywords: ['key-value', 'модель данных', 'вариант использования', 'проектирование схемы', 'паттерн хранения данных']
---



# Могу ли я использовать ClickHouse как хранилище ключ-значение? {#can-i-use-clickhouse-as-a-key-value-storage}

Краткий ответ — **"нет"**. Нагрузка типа ключ-значение находится в числе первых позиций в списке случаев, когда <span class="text-danger">**НЕ СЛЕДУЕТ**</span> использовать ClickHouse. В конце концов, это система [OLAP](../../faq/general/olap.md), в то время как существует множество превосходных систем хранения ключ-значение.

Однако могут возникнуть ситуации, когда использование ClickHouse для запросов типа ключ-значение всё же имеет смысл. Обычно это продукты с ограниченным бюджетом, где основная нагрузка носит аналитический характер и хорошо подходит для ClickHouse, но также существует некоторый вторичный процесс, требующий паттерна ключ-значение с невысокой пропускной способностью запросов и без строгих требований к задержкам. При неограниченном бюджете вы бы установили отдельную базу данных ключ-значение для этой вторичной нагрузки, но в реальности существуют дополнительные затраты на поддержку ещё одной системы хранения (мониторинг, резервное копирование и т. д.), которых может быть желательно избежать.

Если вы решите пойти против рекомендаций и выполнять запросы типа ключ-значение к ClickHouse, вот несколько советов:

- Основная причина, по которой точечные запросы являются затратными в ClickHouse, заключается в разреженном первичном индексе основного [семейства движков таблиц MergeTree](../..//engines/table-engines/mergetree-family/mergetree.md). Этот индекс не может указывать на каждую конкретную строку данных, вместо этого он указывает на каждую N-ю строку, и системе приходится сканировать от соседней N-й строки до нужной, считывая по пути избыточные данные. В сценарии ключ-значение может быть полезно уменьшить значение N с помощью настройки `index_granularity`.
- ClickHouse хранит каждый столбец в отдельном наборе файлов, поэтому для сборки одной полной строки необходимо пройти через каждый из этих файлов. Их количество увеличивается линейно с числом столбцов, поэтому в сценарии ключ-значение может иметь смысл избегать использования множества столбцов и поместить всю полезную нагрузку в один столбец типа `String`, закодированный в каком-либо формате сериализации, таком как JSON, Protobuf или любом другом подходящем формате.
- Существует альтернативный подход, использующий движок таблиц [Join](../../engines/table-engines/special/join.md) вместо обычных таблиц `MergeTree` и функцию [joinGet](../../sql-reference/functions/other-functions.md#joinGet) для извлечения данных. Это может обеспечить лучшую производительность запросов, но может иметь некоторые проблемы с удобством использования и надёжностью. Вот [пример использования](https://github.com/ClickHouse/ClickHouse/blob/master/tests/queries/0_stateless/00800_versatile_storage_join.sql#L49-L51).
