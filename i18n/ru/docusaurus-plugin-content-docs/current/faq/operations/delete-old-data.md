---
slug: /faq/operations/delete-old-data
title: 'Можно ли удалить старые записи из таблицы ClickHouse?'
toc_hidden: true
toc_priority: 20
description: 'Эта страница отвечает на вопрос о том, можно ли удалить старые записи из таблицы ClickHouse'
doc_type: 'reference'
keywords: ['удаление данных', 'TTL', 'хранение данных', 'очистка', 'жизненный цикл данных']
---

# Можно ли удалять старые записи из таблицы ClickHouse? {#is-it-possible-to-delete-old-records-from-a-clickhouse-table}

Краткий ответ — «да». В ClickHouse есть несколько механизмов, которые позволяют освобождать дисковое пространство путём удаления старых данных. Каждый механизм предназначен для различных сценариев.

## TTL {#ttl}

ClickHouse позволяет автоматически удалять данные при наступлении определённого условия. Это условие настраивается как выражение, основанное на любых столбцах, обычно это просто статическое смещение для некоторого столбца с меткой времени.

Ключевым преимуществом этого подхода является то, что для него не требуется никакая внешняя система-триггер: как только TTL настроен, удаление данных происходит автоматически в фоновом режиме.

:::note
TTL также может использоваться не только для удаления данных в [/dev/null](https://en.wikipedia.org/wiki/Null_device), но и для их перемещения между различными системами хранения, например с SSD на HDD.
:::

Подробнее о [настройке TTL](../../engines/table-engines/mergetree-family/mergetree.md#table_engine-mergetree-ttl).

## DELETE FROM {#delete-from}

[DELETE FROM](/sql-reference/statements/delete.md) позволяет выполнять стандартные запросы DELETE в ClickHouse. Строки, отобранные условием фильтрации, помечаются как удалённые и не возвращаются в будущих результатах запросов. Очистка строк происходит асинхронно.

:::note
Оператор DELETE FROM доступен как стабильная функция, начиная с версии 23.3. В более старых версиях он является экспериментальным и должен быть включён с помощью:

```sql
SET allow_experimental_lightweight_delete = true;
```

:::

## ALTER DELETE {#alter-delete}

ALTER DELETE удаляет строки с использованием асинхронных пакетных операций. В отличие от DELETE FROM, запросы, выполняемые после ALTER DELETE и до завершения пакетных операций, будут включать строки, предназначенные для удаления. Подробности см. в документации по [ALTER DELETE](/sql-reference/statements/alter/delete.md).

`ALTER DELETE` можно использовать для гибкого удаления старых данных. Если вам нужно делать это регулярно, основным недостатком будет необходимость во внешней системе, отправляющей запрос. Также есть некоторые особенности производительности, поскольку мутации переписывают целые части, даже если требуется удалить всего одну строку.

Это наиболее распространенный подход для приведения вашей системы на основе ClickHouse в соответствие с требованиями [GDPR](https://gdpr-info.eu).

Дополнительные сведения о [мутациях](/sql-reference/statements/alter#mutations).

## DROP PARTITION {#drop-partition}

`ALTER TABLE ... DROP PARTITION` предоставляет недорогой способ удалить весь партиционный блок. Механизм не слишком гибкий и требует корректной схемы партиционирования, заданной при создании таблицы, но при этом покрывает большинство типичных сценариев. Как и в случае с мутациями, для регулярного использования его необходимо запускать из внешней системы.

Подробнее о [работе с партициями](/sql-reference/statements/alter/partition).

## TRUNCATE {#truncate}

Удаление всех данных из таблицы — довольно радикальное решение, но в некоторых случаях это может быть именно тем, что вам нужно.

Подробнее об операции [TRUNCATE таблицы](/sql-reference/statements/truncate.md).
