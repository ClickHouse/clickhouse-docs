---
slug: /about-us/history
sidebar_label: 'История ClickHouse'
sidebar_position: 40
description: 'История разработки ClickHouse'
keywords: ['history','development','Metrica']
title: 'История ClickHouse'
doc_type: 'reference'
---



# История ClickHouse {#clickhouse-history}

ClickHouse изначально был разработан для [Yandex.Metrica](https://metrica.yandex.com/) — [второй по величине платформы веб-аналитики в мире](http://w3techs.com/technologies/overview/traffic_analysis/all) — и продолжает оставаться её ключевым компонентом. Имея более 13 триллионов записей в базе данных и более 20 миллиардов событий ежедневно, ClickHouse позволяет генерировать произвольные отчёты на лету непосредственно из неагрегированных данных. В этой статье кратко описываются цели ClickHouse на ранних этапах его разработки.

Yandex.Metrica создаёт настраиваемые отчёты на лету на основе хитов и сессий с произвольными сегментами, определяемыми пользователем. Для этого часто требуется построение сложных агрегатов, таких как количество уникальных пользователей, при этом новые данные для построения отчётов поступают в режиме реального времени.

По состоянию на апрель 2014 года Yandex.Metrica отслеживала около 12 миллиардов событий (просмотров страниц и кликов) ежедневно. Все эти события необходимо было хранить для построения произвольных отчётов. Один запрос мог требовать сканирования миллионов строк за несколько сотен миллисекунд или сотен миллионов строк всего за несколько секунд.


## Использование в Yandex.Metrica и других сервисах Яндекса {#usage-in-yandex-metrica-and-other-yandex-services}

ClickHouse выполняет множество задач в Yandex.Metrica.
Его основная задача — построение отчётов в онлайн-режиме с использованием неагрегированных данных. Используется кластер из 374 серверов, которые хранят более 20,3 триллионов строк в базе данных. Объём сжатых данных составляет около 2 ПБ без учёта дубликатов и реплик. Объём несжатых данных (в формате TSV) составил бы приблизительно 17 ПБ.

ClickHouse также играет ключевую роль в следующих процессах:

- Хранение данных для Session Replay из Yandex.Metrica.
- Обработка промежуточных данных.
- Построение глобальных отчётов с помощью Analytics.
- Выполнение запросов для отладки движка Yandex.Metrica.
- Анализ логов API и пользовательского интерфейса.

В настоящее время существует несколько десятков установок ClickHouse в других сервисах и подразделениях Яндекса: поисковые вертикали, электронная коммерция, реклама, бизнес-аналитика, мобильная разработка, персональные сервисы и другие.


## Агрегированные и неагрегированные данные {#aggregated-and-non-aggregated-data}

Существует распространённое мнение, что для эффективного расчёта статистики необходимо агрегировать данные, так как это уменьшает их объём.

Однако агрегация данных имеет множество ограничений:

- Необходимо иметь заранее определённый список требуемых отчётов.
- Пользователь не может создавать произвольные отчёты.
- При агрегации по большому количеству различных ключей объём данных практически не уменьшается, поэтому агрегация бесполезна.
- Для большого количества отчётов существует слишком много вариантов агрегации (комбинаторный взрыв).
- При агрегации ключей с высокой кардинальностью (например, URL) объём данных уменьшается незначительно (менее чем в два раза).
- По этой причине объём данных при агрегации может увеличиться вместо того, чтобы уменьшиться.
- Пользователи не просматривают все отчёты, которые мы для них генерируем. Значительная часть этих вычислений оказывается бесполезной.
- Логическая целостность данных может быть нарушена при различных агрегациях.

Если не агрегировать данные и работать с неагрегированными данными, это может уменьшить объём вычислений.

Однако при агрегации значительная часть работы выполняется в офлайн-режиме и завершается относительно спокойно. В отличие от этого, онлайн-вычисления требуют максимально быстрого расчёта, так как пользователь ожидает результата.

В Yandex.Metrica существует специализированная система агрегации данных под названием Metrage, которая использовалась для большинства отчётов.
Начиная с 2009 года, Yandex.Metrica также использовала специализированную OLAP-базу данных для неагрегированных данных под названием OLAPServer, которая ранее применялась для конструктора отчётов.
OLAPServer хорошо работал с неагрегированными данными, но имел множество ограничений, которые не позволяли использовать его для всех отчётов. К ним относились отсутствие поддержки типов данных (только числа) и невозможность инкрементального обновления данных в реальном времени (это можно было делать только путём ежедневной перезаписи данных). OLAPServer — это не СУБД, а специализированная база данных.

Первоначальной целью ClickHouse было устранение ограничений OLAPServer и решение проблемы работы с неагрегированными данными для всех отчётов, но с годами он превратился в универсальную систему управления базами данных, подходящую для широкого спектра аналитических задач.
