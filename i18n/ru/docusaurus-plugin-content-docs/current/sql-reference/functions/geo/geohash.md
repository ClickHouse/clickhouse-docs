---
description: 'Документация по Geohash'
sidebar_label: 'Geohash'
slug: /sql-reference/functions/geo/geohash
title: 'Функции для работы с Geohash'
doc_type: 'reference'
---

## Geohash {#geohash}

[Geohash](https://en.wikipedia.org/wiki/Geohash) — это система геокодирования, которая разбивает поверхность Земли на ячейки сетки и кодирует каждую ячейку в короткую строку из букв и цифр. Это иерархическая структура данных, поэтому чем длиннее строка geohhash, тем точнее будет указано географическое местоположение.

Если вам нужно вручную преобразовать географические координаты в строки geohash, вы можете использовать [geohash.org](http://geohash.co/).

## geohashEncode {#geohashencode}

Кодирует широту и долготу в строку формата [geohash](#geohash).

**Синтаксис**

```sql
geohashEncode(longitude, latitude, [precision])
```

**Входные значения**

* `longitude` — Долготная часть координаты, которую нужно закодировать. Вещественное число в диапазоне `[-180°, 180°]`. [Float](../../data-types/float.md).
* `latitude` — Широтная часть координаты, которую нужно закодировать. Вещественное число в диапазоне `[-90°, 90°]`. [Float](../../data-types/float.md).
* `precision` (необязательно) — Длина результирующей закодированной строки. Значение по умолчанию — `12`. Целое число в диапазоне `[1, 12]`. [Int8](../../data-types/int-uint.md).

:::note

* Все параметры координат должны быть одного типа: либо `Float32`, либо `Float64`.
* Для параметра `precision` любое значение меньше `1` или больше `12` автоматически преобразуется в `12`.
  :::

**Возвращаемые значения**

* Буквенно-цифровая строка закодированной координаты (используется модифицированный вариант алфавита кодирования base32). [String](../../data-types/string.md).

**Пример**

Запрос:

```sql
SELECT geohashEncode(-5.60302734375, 42.593994140625, 0) AS res;
```

Результат:

```text
┌─res──────────┐
│ ezs42d000000 │
└──────────────┘
```

## geohashDecode {#geohashdecode}

Декодирует любую строку, закодированную с помощью [geohash](#geohash), в значения долготы и широты.

**Синтаксис**

```sql
geohashDecode(hash_str)
```

**Входные значения**

* `hash_str` — строка в кодировке Geohash.

**Возвращаемые значения**

* Кортеж значений `Float64` `(longitude, latitude)`, представляющих долготу и широту. [Tuple](../../data-types/tuple.md)([Float64](../../data-types/float.md))

**Пример**

```sql
SELECT geohashDecode('ezs42') AS res;
```

```text
┌─res─────────────────────────────┐
│ (-5.60302734375,42.60498046875) │
└─────────────────────────────────┘
```

## geohashesInBox {#geohashesinbox}

Возвращает массив строк, закодированных в [geohash](#geohash) с заданной точностью, которые находятся внутри заданного прямоугольника или пересекают его границы, по сути представляя собой 2D‑сетку, развёрнутую в одномерный массив.

**Синтаксис**

```sql
geohashesInBox(longitude_min, latitude_min, longitude_max, latitude_max, precision)
```

**Аргументы**

* `longitude_min` — минимальная долгота. Диапазон: `[-180°, 180°]`. [Float](../../data-types/float.md).
* `latitude_min` — минимальная широта. Диапазон: `[-90°, 90°]`. [Float](../../data-types/float.md).
* `longitude_max` — максимальная долгота. Диапазон: `[-180°, 180°]`. [Float](../../data-types/float.md).
* `latitude_max` — максимальная широта. Диапазон: `[-90°, 90°]`. [Float](../../data-types/float.md).
* `precision` — точность geohash. Диапазон: `[1, 12]`. [UInt8](../../data-types/int-uint.md).

:::note
Все параметры координат должны быть одного типа: либо `Float32`, либо `Float64`.
:::

**Возвращаемые значения**

* Массив строк geohash длины `precision`, соответствующих geohash-боксам, покрывающим заданную область; порядок элементов не гарантируется. [Array](../../data-types/array.md)([String](../../data-types/string.md)).
* `[]` — пустой массив, если минимальные значения широты и долготы не меньше соответствующих максимальных значений.

:::note
Функция генерирует исключение, если результирующий массив содержит более 10&#39;000&#39;000 элементов.
:::

**Пример**

Запрос:

```sql
SELECT geohashesInBox(24.48, 40.56, 24.785, 40.81, 4) AS thasos;
```

Результат:

```text
┌─thasos──────────────────────────────────────┐
│ ['sx1q','sx1r','sx32','sx1w','sx1x','sx38'] │
└─────────────────────────────────────────────┘
```
