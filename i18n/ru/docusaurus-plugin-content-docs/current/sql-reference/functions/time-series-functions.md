---
description: 'Документация по функциям работы с временными рядами'
sidebar_label: 'Временные ряды'
slug: /sql-reference/functions/time-series-functions
title: 'Функции работы с временными рядами'
doc_type: 'reference'
---



# Функции для работы с временными рядами

Ниже приведены функции, предназначенные для использования с агрегатными функциями `timeSeries*()`, такими как
[timeSeriesInstantRateToGrid](../aggregate-functions/reference/timeSeriesInstantRateToGrid.md),
[timeSeriesLastToGrid](../aggregate-functions/reference/timeSeriesResampleToGridWithStaleness.md)
и другими.



## timeSeriesRange {#timeSeriesRange}

Генерирует диапазон временных меток.

**Синтаксис**

```sql
timeSeriesRange(start_timestamp, end_timestamp, step)
```

**Аргументы**

- `start_timestamp` — начало диапазона.
- `end_timestamp` — конец диапазона.
- `step` — шаг диапазона в секундах.

**Возвращаемое значение**

- Возвращает диапазон временных меток `[start_timestamp, start_timestamp + step, start_timestamp + 2 * step, ..., end_timestamp]`.

**Примеры**

Запрос:

```sql
SELECT timeSeriesRange('2025-06-01 00:00:00'::DateTime64(3), '2025-06-01 00:01:00'::DateTime64(3), 30) AS rng;
```

Результат:

```text
┌────────────────────────────────────result─────────────────────────────────────────┐
│ ['2025-06-01 00:00:00.000', '2025-06-01 00:00:30.000', '2025-06-01 00:01:00.000'] │
└───────────────────────────────────────────────────────────────────────────────────┘
```

**Примечания**

- Если функция `timeSeriesRange()` вызывается с `start_timestamp`, равным `end_timestamp`,
  то она возвращает массив из одного элемента, содержащий эту временную метку: `[start_timestamp]`.
- Функция `timeSeriesRange()` аналогична функции [range](../functions/array-functions.md#range).
  Например, если тип временных меток — `DateTime64(3)` и `start_timestamp < end_timestamp`, то
  `timeSeriesRange(start_timestamp, end_timestamp, step)` возвращает тот же результат, что и следующее выражение:

```sql
range(start_timestamp::Int64, end_timestamp::Int64 + 1, step::Int64)::Array(DateTime64(3))
```


## timeSeriesFromGrid {#timeSeriesFromGrid}

Преобразует массив значений `[value1, value2, value3, ..., valueN]` в массив кортежей
`[(start_timestamp, value1), (start_timestamp + step, value2), (start_timestamp + 2 * step, value3), ..., (end_timestamp, valueN)]`.

Если некоторые из значений `[value1, value2, value3, ...]` равны `NULL`, то функция не будет копировать такие null-значения в результирующий массив,
но при этом продолжит увеличивать текущую временную метку. Например, для `[value1, NULL, value2]` функция вернёт
`[(start_timestamp, value1), (start_timestamp + 2 * step, value2)]`.

Текущая временная метка увеличивается на величину step до тех пор, пока не превысит end_timestamp. Каждая временная метка объединяется со значением
из указанного массива значений. Если количество значений не совпадает с количеством временных меток, функция выбросит исключение.

**Синтаксис**

```sql
timeSeriesFromGrid(start_timestamp, end_timestamp, step, values);
```

**Аргументы**

- `start_timestamp` — начало временной сетки.
- `end_timestamp` — конец временной сетки.
- `step` — шаг временной сетки в секундах.
- `values` — массив значений `[value1, value2, ..., valueN]`.

**Возвращаемое значение**

- Возвращает значения из исходного массива, объединённые с временными метками на регулярной временной сетке, определяемой параметрами `start_timestamp` и `step`.

**Примеры**

Запрос:

```sql
SELECT timeSeriesFromGrid('2025-06-01 00:00:00'::DateTime64(3), '2025-06-01 00:01:30.000'::DateTime64(3), 30, [10, 20, NULL, 30]) AS result;
```

Результат:

```text
┌─────────────────────────────────────────────result─────────────────────────────────────────────┐
│ [('2025-06-01 00:00:00.000',10),('2025-06-01 00:00:30.000',20),('2025-06-01 00:01:30.000',30)] │
└────────────────────────────────────────────────────────────────────────────────────────────────┘
```

**Примечание**
Функция `timeSeriesFromGrid(start_timestamp, end_timestamp, step, values)` возвращает тот же результат, что и следующее выражение:

```sql
arrayFilter(x -> x.2 IS NOT NULL, arrayZip(timeSeriesRange(start_timestamp, end_timestamp, step), values))
```

<!--
The inner content of the tags below are replaced at doc framework build time with
docs generated from system.functions. Please do not modify or remove the tags.
See: https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
-->


<!--AUTOGENERATED_START-->

## seriesDecomposeSTL {#seriesDecomposeSTL}

Введена в версии: v24.1

Разлагает данные временного ряда с помощью алгоритма STL [(Seasonal-Trend Decomposition Procedure Based on Loess)](https://www.wessa.net/download/stl.pdf) на сезонную, трендовую и остаточную компоненты.

**Синтаксис**

```sql
seriesDecomposeSTL(series, period)
```

**Аргументы**

- `series` — Массив числовых значений [`Array((U)Int8/16/32/64)`](/sql-reference/data-types/array) или [`Array(Float*)`](/sql-reference/data-types/array)
- `period` — Положительное целое число [`UInt8/16/32/64`](/sql-reference/data-types/int-uint)

**Возвращаемое значение**

Возвращает массив из четырёх массивов, где первый массив содержит сезонные компоненты, второй массив — трендовую компоненту, третий массив — остаточную компоненту, а четвёртый массив — базовую компоненту (сезонная + трендовая). [`Array(Array(Float32), Array(Float32), Array(Float32), Array(Float32))`](/sql-reference/data-types/array)

**Примеры**

**Разложение данных временного ряда с помощью STL**

```sql title=Запрос
SELECT seriesDecomposeSTL([10.1, 20.45, 40.34, 10.1, 20.45, 40.34, 10.1, 20.45, 40.34, 10.1, 20.45, 40.34, 10.1, 20.45, 40.34, 10.1, 20.45, 40.34, 10.1, 20.45, 40.34, 10.1, 20.45, 40.34], 3) AS print_0
```

```response title=Результат
┌───────────print_0──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ [[
        -13.529999, -3.1799996, 16.71,      -13.53,     -3.1799996, 16.71,      -13.53,     -3.1799996,
        16.71,      -13.530001, -3.18,      16.710001,  -13.530001, -3.1800003, 16.710001,  -13.530001,
        -3.1800003, 16.710001,  -13.530001, -3.1799994, 16.71,      -13.529999, -3.1799994, 16.709997
    ],
    [
        23.63,     23.63,     23.630003, 23.630001, 23.630001, 23.630001, 23.630001, 23.630001,
        23.630001, 23.630001, 23.630001, 23.63,     23.630001, 23.630001, 23.63,     23.630001,
        23.630001, 23.63,     23.630001, 23.630001, 23.630001, 23.630001, 23.630001, 23.630003
    ],
    [
        0, 0.0000019073486, -0.0000019073486, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.0000019073486, 0,
        0
    ],
    [
        10.1, 20.449999, 40.340004, 10.100001, 20.45, 40.34, 10.100001, 20.45, 40.34, 10.1, 20.45, 40.34,
        10.1, 20.45, 40.34, 10.1, 20.45, 40.34, 10.1, 20.45, 40.34, 10.100002, 20.45, 40.34
    ]]                                                                                                                   │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```


## seriesOutliersDetectTukey {#seriesOutliersDetectTukey}

Introduced in: v24.2

Обнаруживает выбросы в данных рядов с использованием метода [Tukey Fences](https://en.wikipedia.org/wiki/Outlier#Tukey%27s_fences).

**Синтаксис**

```sql
seriesOutliersDetectTukey(series[, min_percentile, max_percentile, K])
```

**Аргументы**

- `series` — Массив числовых значений. [`Array((UInt8/16/32/64))`](/sql-reference/data-types/array) или [`Array(Float*)`](/sql-reference/data-types/array)
- `min_percentile` — Необязательный параметр. Минимальный процентиль, используемый для вычисления межквартильного размаха [(IQR)](https://en.wikipedia.org/wiki/Interquartile_range). Значение должно находиться в диапазоне [0.02,0.98]. Значение по умолчанию — 0.25. [`Float*`](/sql-reference/data-types/float)
- `max_percentile` — Необязательный параметр. Максимальный процентиль, используемый для вычисления межквартильного размаха (IQR). Значение должно находиться в диапазоне [0.02,0.98]. Значение по умолчанию — 0.75. [`Float*`](/sql-reference/data-types/float)
- `K` — Необязательный параметр. Неотрицательное константное значение для обнаружения слабых или сильных выбросов. Значение по умолчанию — 1.5. [`Float*`](/sql-reference/data-types/float)

**Возвращаемое значение**

Возвращает массив той же длины, что и входной массив, где каждое значение представляет собой оценку возможной аномалии соответствующего элемента в ряду. Ненулевая оценка указывает на возможную аномалию. [`Array(Float32)`](/sql-reference/data-types/array)

**Примеры**

**Базовое обнаружение выбросов**

```sql title=Query
SELECT seriesOutliersDetectTukey([-3, 2, 15, 3, 5, 6, 4, 5, 12, 45, 12, 3, 3, 4, 5, 6]) AS print_0
```

```response title=Response
┌───────────print_0─────────────────┐
│[0,0,0,0,0,0,0,0,0,27,0,0,0,0,0,0] │
└───────────────────────────────────┘
```

**Обнаружение выбросов с пользовательскими параметрами**

```sql title=Query
SELECT seriesOutliersDetectTukey([-3, 2, 15, 3, 5, 6, 4.50, 5, 12, 45, 12, 3.40, 3, 4, 5, 6], 0.2, 0.8, 1.5) AS print_0
```

```response title=Response
┌─print_0──────────────────────────────┐
│ [0,0,0,0,0,0,0,0,0,19.5,0,0,0,0,0,0] │
└──────────────────────────────────────┘
```


## seriesPeriodDetectFFT {#seriesPeriodDetectFFT}

Введена в версии: v23.12

Определяет период заданного временного ряда с использованием БПФ — [быстрого преобразования Фурье](https://en.wikipedia.org/wiki/Fast_Fourier_transform)

**Синтаксис**

```sql
seriesPeriodDetectFFT(series)
```

**Аргументы**

- `series` — Массив числовых значений. [`Array((U)Int8/16/32/64)`](/sql-reference/data-types/array) или [`Array(Float*)`](/sql-reference/data-types/array)

**Возвращаемое значение**

Возвращает вещественное значение, равное периоду временного ряда. Возвращает NaN, если количество точек данных меньше четырёх. [`Float64`](/sql-reference/data-types/float)

**Примеры**

**Определение периода с простым паттерном**

```sql title=Query
SELECT seriesPeriodDetectFFT([1, 4, 6, 1, 4, 6, 1, 4, 6, 1, 4, 6, 1, 4, 6, 1, 4, 6, 1, 4, 6]) AS print_0
```

```response title=Response
┌───────────print_0──────┐
│                      3 │
└────────────────────────┘
```

**Определение периода со сложным паттерном**

```sql title=Query
SELECT seriesPeriodDetectFFT(arrayMap(x -> abs((x % 6) - 3), range(1000))) AS print_0
```

```response title=Response
┌─print_0─┐
│       6 │
└─────────┘
```


## timeSeriesFromGrid {#timeSeriesFromGrid}

Введена в версии: v25.8

Преобразует массив значений `[x1, x2, x3, ...]` в массив кортежей
`[(start_timestamp, x1), (start_timestamp + step, x2), (start_timestamp + 2 * step, x3), ...]`.

Текущая временная метка увеличивается на `step`, пока не превысит `end_timestamp`.
Если количество значений не соответствует количеству временных меток, функция генерирует исключение.

Значения NULL в `[x1, x2, x3, ...]` пропускаются, но текущая временная метка всё равно увеличивается.
Например, для `[value1, NULL, x2]` функция возвращает `[(start_timestamp, x1), (start_timestamp + 2 * step, x2)]`.

**Синтаксис**

```sql
timeSeriesFromGrid(start_timestamp, end_timestamp, step, values)
```

**Аргументы**

- `start_timestamp` — Начало временной сетки. [`DateTime64`](/sql-reference/data-types/datetime64) или [`DateTime`](/sql-reference/data-types/datetime) или [`UInt32`](/sql-reference/data-types/int-uint)
- `end_timestamp` — Конец временной сетки. [`DateTime64`](/sql-reference/data-types/datetime64) или [`DateTime`](/sql-reference/data-types/datetime) или [`UInt32`](/sql-reference/data-types/int-uint)
- `step` — Шаг временной сетки в секундах. [`Decimal64`](/sql-reference/data-types/decimal) или [`Decimal32`](/sql-reference/data-types/decimal) или [`UInt32/64`](/sql-reference/data-types/int-uint)
- `values` — Массив значений. [`Array(Float*)`](/sql-reference/data-types/array) или [`Array(Nullable(Float*))`](/sql-reference/data-types/array)

**Возвращаемое значение**

Возвращает значения из исходного массива, объединённые с временными метками на регулярной временной сетке, определяемой параметрами `start_timestamp` и `step`. [`Array(Tuple(DateTime64, Float64))`](/sql-reference/data-types/array)

**Примеры**

**Пример использования**

```sql title=Запрос
SELECT timeSeriesFromGrid('2025-06-01 00:00:00'::DateTime64(3), '2025-06-01 00:01:30.000'::DateTime64(3), 30, [10, 20, NULL, 30]) AS result;
```

```response title=Результат
┌─────────────────────────────────────────────result─────────────────────────────────────────────┐
│ [('2025-06-01 00:00:00.000',10),('2025-06-01 00:00:30.000',20),('2025-06-01 00:01:30.000',30)] │
└────────────────────────────────────────────────────────────────────────────────────────────────┘
```


## timeSeriesIdToTags {#timeSeriesIdToTags}

Введена в версии: v25.8

Находит теги, связанные с указанным идентификатором временного ряда.

**Синтаксис**

```sql
timeSeriesIdToTags(id)
```

**Аргументы**

- `id` — идентификатор временного ряда. [`UInt64`](/sql-reference/data-types/int-uint), [`UInt128`](/sql-reference/data-types/int-uint), [`UUID`](/sql-reference/data-types/uuid) или [`FixedString(16)`](/sql-reference/data-types/fixedstring)

**Возвращаемое значение**

Возвращает массив пар (tag_name, tag_value). [`Array(Tuple(String, String))`](/sql-reference/data-types/array)

**Примеры**

**Пример**

```sql title=Запрос
SELECT timeSeriesStoreTags(8374283493092, [('region', 'eu'), ('env', 'dev')], '__name__', 'http_requests_count') AS id, timeSeriesIdToTags(id)
```

```response title=Результат
8374283493092    [('__name__', ''http_requests_count''), ('env', 'dev'), ('region', 'eu')]
```


## timeSeriesIdToTagsGroup {#timeSeriesIdToTagsGroup}

Введена в версии: v25.8

Преобразует указанный идентификатор временного ряда в индекс его группы. Индексы групп — это числа 0, 1, 2, 3, связанные с каждым уникальным набором тегов в контексте выполняемого запроса.

**Синтаксис**

```sql
timeSeriesIdToTagsGroup(id)
```

**Аргументы**

- `id` — Идентификатор временного ряда. [`UInt64`](/sql-reference/data-types/int-uint) или [`UInt128`](/sql-reference/data-types/int-uint) или [`UUID`](/sql-reference/data-types/uuid) или [`FixedString(16)`](/sql-reference/data-types/fixedstring)

**Возвращаемое значение**

Возвращает индекс группы, связанный с этим набором тегов. [`UInt64`](/sql-reference/data-types/int-uint)

**Примеры**

**Пример**

```sql title=Запрос
SELECT timeSeriesStoreTags(8374283493092, [('region', 'eu'), ('env', 'dev')], '__name__', 'http_requests_count') AS id, timeSeriesIdToTagsGroup(id)
```

```response title=Результат
8374283493092    0
```


## timeSeriesRange {#timeSeriesRange}

Введена в версии: v25.8

Генерирует диапазон временных меток [start_timestamp, start_timestamp + step, start_timestamp + 2 * step, ..., end_timestamp].

Если `start_timestamp` равен `end_timestamp`, функция возвращает массив из одного элемента `[start_timestamp]`.

Функция `timeSeriesRange()` похожа на функцию [range](../functions/array-functions.md#range).

**Синтаксис**

```sql
timeSeriesRange(start_timestamp, end_timestamp, step)
```

**Аргументы**

- `start_timestamp` — начало диапазона. [`DateTime64`](/sql-reference/data-types/datetime64), [`DateTime`](/sql-reference/data-types/datetime) или [`UInt32`](/sql-reference/data-types/int-uint)
- `end_timestamp` — конец диапазона. [`DateTime64`](/sql-reference/data-types/datetime64), [`DateTime`](/sql-reference/data-types/datetime) или [`UInt32`](/sql-reference/data-types/int-uint)
- `step` — шаг диапазона в секундах. [`UInt32/64`](/sql-reference/data-types/int-uint) или [`Decimal32/64`](/sql-reference/data-types/decimal)

**Возвращаемое значение**

Возвращает диапазон временных меток. [`Array(DateTime64)`](/sql-reference/data-types/array)

**Примеры**

**Пример использования**

```sql title=Запрос
SELECT timeSeriesRange('2025-06-01 00:00:00'::DateTime64(3), '2025-06-01 00:01:00'::DateTime64(3), 30)
```

```response title=Результат
┌────────────────────────────────────result─────────────────────────────────────────┐
│ ['2025-06-01 00:00:00.000', '2025-06-01 00:00:30.000', '2025-06-01 00:01:00.000'] │
└───────────────────────────────────────────────────────────────────────────────────┘
```


## timeSeriesStoreTags {#timeSeriesStoreTags}

Введена в версии: v25.8

Сохраняет соответствие между идентификатором временного ряда и его тегами в контексте запроса, чтобы функция timeSeriesIdToTags() могла извлечь эти теги позднее.

**Синтаксис**

```sql
timeSeriesStoreTags(id, tags_array, separate_tag_name_1, separate_tag_value_1, ...)
```

**Аргументы**

- `id` — идентификатор временного ряда. [`UInt64`](/sql-reference/data-types/int-uint) или [`UInt128`](/sql-reference/data-types/int-uint) или [`UUID`](/sql-reference/data-types/uuid) или [`FixedString(16)`](/sql-reference/data-types/fixedstring)
- `tags_array` — массив пар (имя_тега, значение_тега). [`Array(Tuple(String, String))`](/sql-reference/data-types/array) или [`NULL`](/sql-reference/syntax#null)
- `separate_tag_name_i` — имя тега. [`String`](/sql-reference/data-types/string) или [`FixedString`](/sql-reference/data-types/fixedstring)
- `separate_tag_value_i` — значение тега. [`String`](/sql-reference/data-types/string) или [`FixedString`](/sql-reference/data-types/fixedstring) или [`Nullable(String)`](/sql-reference/data-types/nullable)

**Возвращаемое значение**

Возвращает первый аргумент, т.е. идентификатор временного ряда.

**Примеры**

**Пример**

```sql title=Запрос
SELECT timeSeriesStoreTags(8374283493092, [('region', 'eu'), ('env', 'dev')], '__name__', 'http_requests_count')
```

```response title=Результат
8374283493092
```


## timeSeriesTagsGroupToTags {#timeSeriesTagsGroupToTags}

Введена в версии: v25.8

Находит теги, связанные с индексом группы. Индексы групп — это числа 0, 1, 2, 3, связанные с каждым уникальным набором тегов в контексте выполняемого запроса.

**Синтаксис**

```sql
timeSeriesTagsGroupToTags(group)
```

**Аргументы**

- `group` — индекс группы, связанный с временным рядом. [`UInt64`](/sql-reference/data-types/int-uint)

**Возвращаемое значение**

Массив пар (имя_тега, значение_тега). [`Array(Tuple(String, String))`](/sql-reference/data-types/array)

**Примеры**

**Пример**

```sql title=Запрос
SELECT timeSeriesStoreTags(8374283493092, [('region', 'eu'), ('env', 'dev')], '__name__', 'http_requests_count') AS id, timeSeriesIdToTagsGroup(id) AS group, timeSeriesTagsGroupToTags(group)
```

```response title=Результат
8374283493092    0    [('__name__', ''http_requests_count''), ('env', 'dev'), ('region', 'eu')]
```

<!--AUTOGENERATED_END-->
