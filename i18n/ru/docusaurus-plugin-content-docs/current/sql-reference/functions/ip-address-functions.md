---
description: 'Документация по функциям, используемым для работы с адресами IPv4 и IPv6.'
sidebar_label: 'IP-адреса'
slug: /sql-reference/functions/ip-address-functions
title: 'Функции для работы с адресами IPv4 и IPv6'
doc_type: 'reference'
---

# Функции для работы с IP-адресами IPv4 и IPv6 {#functions-for-working-with-ipv4-and-ipv6-addresses}

{/* 
  Внутреннее содержимое приведённых ниже тегов при сборке фреймворка документации
  заменяется документацией, сгенерированной из system.functions. Пожалуйста, не изменяйте и не удаляйте эти теги.
  См.: https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
  */ }

{/*AUTOGENERATED_START*/ }

## IPv4CIDRToRange {#IPv4CIDRToRange}

Функция введена в версии: v20.1

Принимает IPv4-адрес с длиной префикса бесклассовой междоменной маршрутизации (CIDR) и возвращает диапазон адресов подсети в виде кортежа из двух значений IPv4: первого и последнего адреса в этой подсети.
Версию для IPv6 см. в [`IPv6CIDRToRange`](#IPv4CIDRToRange).

**Синтаксис**

```sql
IPv4CIDRToRange(ipv4, cidr)
```

**Аргументы**

* `ipv4` — IPv4-адрес. [`IPv4`](/sql-reference/data-types/ipv4) или [`String`](/sql-reference/data-types/string)
* `cidr` — значение CIDR. [`UInt8`](/sql-reference/data-types/int-uint)

**Возвращаемое значение**

Возвращает кортеж из двух IPv4-адресов, задающих диапазон подсети. [`Tuple(IPv4, IPv4)`](/sql-reference/data-types/tuple)

**Примеры**

**Пример использования**

```sql title=Query
SELECT IPv4CIDRToRange(toIPv4('192.168.5.2'), 16);
```

```response title=Response
┌─IPv4CIDRToRange(toIPv4('192.168.5.2'), 16)─┐
│ ('192.168.0.0','192.168.255.255')          │
└────────────────────────────────────────────┘
```

## IPv4NumToString {#IPv4NumToString}

Добавлена в версии: v1.1

Преобразует 32-битное целое число в строковое представление IPv4-адреса в десятичной точечной нотации (формат A.B.C.D).
Интерпретирует входное значение в порядке байт big-endian.

**Синтаксис**

```sql
IPv4NumToString(num)
```

**Псевдонимы**: `INET_NTOA`

**Аргументы**

* `num` — IPv4-адрес в виде числа типа UInt32. [`UInt32`](/sql-reference/data-types/int-uint)

**Возвращаемое значение**

Возвращает числовое представление MAC-адреса или `0`, если формат недопустим. [`String`](/sql-reference/data-types/string)

**Примеры**

**Пример использования**

```sql title=Query
IPv4NumToString(3232235521)
```

```response title=Response
192.168.0.1
```

## IPv4NumToStringClassC {#IPv4NumToStringClassC}

Добавлена в версии v1.1

Преобразует 32-битное целое число в строковое представление IPv4-адреса в точечной десятичной записи (формат A.B.C.D),
аналогично функции [`IPv4NumToString`](#IPv4NumToString), но с использованием `xxx` вместо последнего октета.

**Синтаксис**

```sql
IPv4NumToStringClassC(num)
```

**Аргументы**

* `num` — IPv4-адрес в виде числа UInt32. [`UInt32`](/sql-reference/data-types/int-uint)

**Возвращаемое значение**

Возвращает строку IPv4-адреса, в которой последний октет заменён на xxx. [`String`](/sql-reference/data-types/string)

**Примеры**

**Базовый пример с агрегацией**

```sql title=Query
SELECT
    IPv4NumToStringClassC(ClientIP) AS k,
    count() AS c
FROM test.hits
GROUP BY k
ORDER BY c DESC
LIMIT 10
```

```response title=Response
┌─k──────────────┬─────c─┐
│ 83.149.9.xxx   │ 26238 │
│ 217.118.81.xxx │ 26074 │
│ 213.87.129.xxx │ 25481 │
│ 83.149.8.xxx   │ 24984 │
│ 217.118.83.xxx │ 22797 │
│ 78.25.120.xxx  │ 22354 │
│ 213.87.131.xxx │ 21285 │
│ 78.25.121.xxx  │ 20887 │
│ 188.162.65.xxx │ 19694 │
│ 83.149.48.xxx  │ 17406 │
└────────────────┴───────┘
```

## IPv4StringToNum {#IPv4StringToNum}

Введена в версии v1.1

Преобразует строку IPv4-адреса в точечно-десятичной записи (формат A.B.C.D) в соответствующее 32-битное целочисленное представление (обратная функция к [`IPv4NumToString`](#IPv4NumToString)).
При некорректном формате IPv4-адреса выбрасывается исключение.

**Синтаксис**

```sql
IPv4StringToNum(string)
```

**Псевдонимы**: `INET_ATON`

**Аргументы**

* `string` — строка с IPv4-адресом. [`String`](/sql-reference/data-types/string)

**Возвращаемое значение**

Возвращает IPv4-адрес. [`UInt32`](/sql-reference/data-types/int-uint)

**Примеры**

**Пример использования**

```sql title=Query
IPv4StringToNum('192.168.0.1')
```

```response title=Response
3232235521
```

## IPv4StringToNumOrDefault {#IPv4StringToNumOrDefault}

Впервые появилась в: v22.3

Преобразует строку IPv4-адреса в точечной десятичной нотации (формат A.B.C.D) в соответствующее 32-битное целочисленное представление; если IPv4-адрес имеет некорректный формат, возвращает `0`.

**Синтаксис**

```sql
IPv4StringToNumOrDefault(string)
```

**Аргументы**

* `string` — строка с IPv4-адресом. [`String`](/sql-reference/data-types/string)

**Возвращаемое значение**

Возвращает IPv4-адрес или `0`, если адрес некорректен. [`UInt32`](/sql-reference/data-types/int-uint)

**Примеры**

**Пример с некорректным адресом**

```sql title=Query
SELECT
    IPv4StringToNumOrDefault('127.0.0.1') AS valid,
    IPv4StringToNumOrDefault('invalid') AS invalid;
```

```response title=Response
┌──────valid─┬─invalid─┐
│ 2130706433 │       0 │
└────────────┴─────────┘
```

## IPv4StringToNumOrNull {#IPv4StringToNumOrNull}

Введена в: v22.3

Преобразует 32-битное целое число в строковое представление IPv4-адреса в десятичной точечной записи (формат A.B.C.D), но если IPv4-адрес имеет некорректный формат, возвращает `NULL`.

**Синтаксис**

```sql
IPv4StringToNumOrNull(string)
```

**Аргументы**

* `string` — строка с IPv4-адресом. [`String`](/sql-reference/data-types/string)

**Возвращаемое значение**

Возвращает IPv4-адрес или `NULL`, если он некорректен. [`Nullable(UInt32)`](/sql-reference/data-types/nullable)

**Примеры**

**Пример с некорректным адресом**

```sql title=Query
SELECT
IPv4StringToNumOrNull('127.0.0.1') AS valid,
IPv4StringToNumOrNull('invalid') AS invalid;
```

```response title=Response
┌──────valid─┬─invalid─┐
│ 2130706433 │    ᴺᵁᴸᴸ │
└────────────┴─────────┘
```

## IPv4ToIPv6 {#IPv4ToIPv6}

Добавлено в версии v1.1

Интерпретирует 32-битное число в формате big endian как IPv4-адрес, который затем интерпретируется как соответствующий IPv6-адрес в формате `FixedString(16)`.

**Синтаксис**

```sql
IPv4ToIPv6(x)
```

**Аргументы**

* `x` — IPv4-адрес. [`UInt32`](/sql-reference/data-types/int-uint)

**Возвращаемое значение**

Возвращает IPv6-адрес в двоичном формате. [`FixedString(16)`](/sql-reference/data-types/fixedstring)

**Примеры**

**Пример использования**

```sql title=Query
SELECT IPv6NumToString(IPv4ToIPv6(IPv4StringToNum('192.168.0.1'))) AS addr;
```

```response title=Response
┌─addr───────────────┐
│ ::ffff:192.168.0.1 │
└────────────────────┘
```

## IPv6CIDRToRange {#IPv6CIDRToRange}

Введена в версии: v20.1

Принимает IPv6-адрес с длиной префикса бесклассовой маршрутизации между доменами (CIDR) и возвращает диапазон адресов подсети в виде кортежа из двух значений IPv6: минимального и максимального адресов в этой подсети.
Для версии для IPv4 см. [`IPv4CIDRToRange`](#IPv4CIDRToRange).

**Синтаксис**

```sql
IPv6CIDRToRange(ipv6, cidr)
```

**Аргументы**

* `ipv6` — IPv6-адрес. [`IPv6`](/sql-reference/data-types/ipv6) или [`String`](/sql-reference/data-types/string)
* `cidr` — значение CIDR. [`UInt8`](/sql-reference/data-types/int-uint)

**Возвращаемое значение**

Возвращает кортеж из двух IPv6-адресов, задающих диапазон подсети. [`Tuple(IPv6, IPv6)`](/sql-reference/data-types/tuple)

**Примеры**

**Пример использования**

```sql title=Query
SELECT IPv6CIDRToRange(toIPv6('2001:0db8:0000:85a3:0000:0000:ac1f:8001'), 32);
```

```response title=Response
┌─IPv6CIDRToRange(toIPv6('2001:0db8:0000:85a3:0000:0000:ac1f:8001'), 32)─┐
│ ('2001:db8::','2001:db8:ffff:ffff:ffff:ffff:ffff:ffff')                │
└────────────────────────────────────────────────────────────────────────┘
```

## IPv6NumToString {#IPv6NumToString}

Добавлено в версии: v1.1

Преобразует IPv6-адрес из двоичного формата (FixedString(16)) в его стандартное текстовое представление.
IPv4-адреса, сопоставленные с IPv6 (IPv4-mapped IPv6), выводятся в формате `::ffff:111.222.33.44`.

**Синтаксис**

```sql
IPv6NumToString(x)
```

**Псевдонимы**: `INET6_NTOA`

**Аргументы**

* `x` — IPv6-адрес в двоичном формате. [`FixedString(16)`](/sql-reference/data-types/fixedstring) или [`IPv6`](/sql-reference/data-types/ipv6)

**Возвращаемое значение**

Возвращает IPv6-адрес в текстовом формате. [`String`](/sql-reference/data-types/string)

**Примеры**

**Пример использования**

```sql title=Query
SELECT IPv6NumToString(toFixedString(unhex('2A0206B8000000000000000000000011'), 16)) AS addr;
```

```response title=Response
┌─addr─────────┐
│ 2a02:6b8::11 │
└──────────────┘
```

**IPv6 с анализом обращений**

```sql title=Query
SELECT
    IPv6NumToString(ClientIP6 AS k),
    count() AS c
FROM hits_all
WHERE EventDate = today() AND substring(ClientIP6, 1, 12) != unhex('00000000000000000000FFFF')
GROUP BY k
ORDER BY c DESC
LIMIT 10
```

```response title=Response
┌─IPv6NumToString(ClientIP6)──────────────┬─────c─┐
│ 2a02:2168:aaa:bbbb::2                   │ 24695 │
│ 2a02:2698:abcd:abcd:abcd:abcd:8888:5555 │ 22408 │
│ 2a02:6b8:0:fff::ff                      │ 16389 │
│ 2a01:4f8:111:6666::2                    │ 16016 │
│ 2a02:2168:888:222::1                    │ 15896 │
│ 2a01:7e00::ffff:ffff:ffff:222           │ 14774 │
│ 2a02:8109:eee:ee:eeee:eeee:eeee:eeee    │ 14443 │
│ 2a02:810b:8888:888:8888:8888:8888:8888  │ 14345 │
│ 2a02:6b8:0:444:4444:4444:4444:4444      │ 14279 │
│ 2a01:7e00::ffff:ffff:ffff:ffff          │ 13880 │
└─────────────────────────────────────────┴───────┘
```

**IPv4-адреса, отображённые в IPv6**

```sql title=Query
SELECT
    IPv6NumToString(ClientIP6 AS k),
    count() AS c
FROM hits_all
WHERE EventDate = today()
GROUP BY k
ORDER BY c DESC
LIMIT 10
```

```response title=Response
┌─IPv6NumToString(ClientIP6)─┬──────c─┐
│ ::ffff:94.26.111.111       │ 747440 │
│ ::ffff:37.143.222.4        │ 529483 │
│ ::ffff:5.166.111.99        │ 317707 │
│ ::ffff:46.38.11.77         │ 263086 │
│ ::ffff:79.105.111.111      │ 186611 │
│ ::ffff:93.92.111.88        │ 176773 │
│ ::ffff:84.53.111.33        │ 158709 │
│ ::ffff:217.118.11.22       │ 154004 │
│ ::ffff:217.118.11.33       │ 148449 │
│ ::ffff:217.118.11.44       │ 148243 │
└────────────────────────────┴────────┘
```

## IPv6StringToNum {#IPv6StringToNum}

Добавлено в версии v1.1

Преобразует IPv6-адрес из стандартного текстового представления в двоичный формат (`FixedString(16)`).
Поддерживает IPv4-отображённые IPv6-адреса в формате `::ffff:111.222.33.44.`.
Если IPv6-адрес имеет недопустимый формат, генерируется исключение.

Если входная строка содержит корректный IPv4-адрес, возвращается его эквивалент в формате IPv6.
HEX может быть в верхнем или нижнем регистре.

**Синтаксис**

```sql
IPv6StringToNum(string)
```

**Псевдонимы**: `INET6_ATON`

**Аргументы**

* `string` — строковое представление IPv6-адреса. [`String`](/sql-reference/data-types/string)

**Возвращаемое значение**

Возвращает IPv6-адрес в двоичном формате. [`FixedString(16)`](/sql-reference/data-types/fixedstring)

**Примеры**

**Базовый пример**

```sql title=Query
SELECT addr, cutIPv6(IPv6StringToNum(addr), 0, 0) FROM (SELECT ['notaddress', '127.0.0.1', '1111::ffff'] AS addr) ARRAY JOIN addr;
```

```response title=Response
┌─addr───────┬─cutIPv6(IPv6StringToNum(addr), 0, 0)─┐
│ notaddress │ ::                                   │
│ 127.0.0.1  │ ::ffff:127.0.0.1                     │
│ 1111::ffff │ 1111::ffff                           │
└────────────┴──────────────────────────────────────┘
```

## IPv6StringToNumOrDefault {#IPv6StringToNumOrDefault}

Добавлена в версии v22.3

Преобразует IPv6-адрес из его стандартного текстового представления в двоичный формат (`FixedString(16)`).
Принимает IPv4-отображённые IPv6-адреса в формате `::ffff:111.222.33.44.`.
Если IPv6-адрес имеет недопустимый формат, возвращает значение по умолчанию `::`.

**Синтаксис**

```sql
IPv6StringToNumOrDefault(string)
```

**Аргументы**

* `string` — строка с IPv6-адресом. [`String`](/sql-reference/data-types/string)

**Возвращаемое значение**

IPv6-адрес в двоичном формате или строка типа FixedString(16), заполненная нулями, если адрес недопустим. [`FixedString(16)`](/sql-reference/data-types/fixedstring)

**Примеры**

**Простой пример с недопустимым адресом**

```sql title=Query
SELECT
    IPv6NumToString(IPv6StringToNumOrDefault('2001:db8::1')) AS valid,
    IPv6NumToString(IPv6StringToNumOrDefault('invalid')) AS invalid;
```

```response title=Response
┌─valid───────┬─invalid─┐
│ 2001:db8::1 │ ::      │
└─────────────┴─────────┘
```

## IPv6StringToNumOrNull {#IPv6StringToNumOrNull}

Введена в версии v22.3.

Преобразует IPv6-адрес из его стандартного текстового представления в двоичный формат (`FixedString(16)`).
Принимает IPv4-отображённые IPv6-адреса в формате `::ffff:111.222.33.44.`.
Если IPv6-адрес имеет недопустимый формат, функция возвращает `NULL`.

**Синтаксис**

```sql
IPv6StringToNumOrNull(string)
```

**Аргументы**

* `string` — строка с IPv6-адресом. [`String`](/sql-reference/data-types/string)

**Возвращаемое значение**

Возвращает IPv6-адрес в двоичном формате или `NULL`, если адрес некорректен. [`Nullable(FixedString(16))`](/sql-reference/data-types/nullable)

**Примеры**

**Базовый пример с некорректным адресом**

```sql title=Query
SELECT
    IPv6NumToString(IPv6StringToNumOrNull('2001:db8::1')) AS valid,
    IPv6StringToNumOrNull('invalid') AS invalid;
```

```response title=Response
┌─valid───────┬─invalid─┐
│ 2001:db8::1 │    ᴺᵁᴸᴸ │
└─────────────┴─────────┘
```

## cutIPv6 {#cutIPv6}

Появилась в версии: v1.1

Принимает значение типа `FixedString(16)`, представляющее IPv6-адрес в двоичном формате.
Возвращает строку с адресом, в которой указанное количество байт удалено, в текстовом формате.

**Синтаксис**

```sql
cutIPv6(x, bytesToCutForIPv6, bytesToCutForIPv4)
```

**Аргументы**

* `x` — IPv6-адрес в двоичном формате. [`FixedString(16)`](/sql-reference/data-types/fixedstring) или [`IPv6`](/sql-reference/data-types/ipv6)
* `bytesToCutForIPv6` — Количество байт, которые нужно обрезать для IPv6. [`UInt8`](/sql-reference/data-types/int-uint)
* `bytesToCutForIPv4` — Количество байт, которые нужно обрезать для IPv4. [`UInt8`](/sql-reference/data-types/int-uint)

**Возвращаемое значение**

Возвращает строку, содержащую IPv6-адрес в текстовом формате с указанным количеством удалённых байт. [`String`](/sql-reference/data-types/string)

**Примеры**

**Пример использования**

```sql title=Query
WITH
    IPv6StringToNum('2001:0DB8:AC10:FE01:FEED:BABE:CAFE:F00D') AS ipv6,
    IPv4ToIPv6(IPv4StringToNum('192.168.0.1')) AS ipv4
SELECT
    cutIPv6(ipv6, 2, 0),
    cutIPv6(ipv4, 0, 2)
```

```response title=Response
┌─cutIPv6(ipv6, 2, 0)─────────────────┬─cutIPv6(ipv4, 0, 2)─┐
│ 2001:db8:ac10:fe01:feed:babe:cafe:0 │ ::ffff:192.168.0.0  │
└─────────────────────────────────────┴─────────────────────┘
```

## isIPAddressInRange {#isIPAddressInRange}

Функция появилась в версии v21.4.

Определяет, содержится ли IP-адрес в сети, записанной в нотации [Classless Inter-Domain Routing (CIDR)](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing).

Функция принимает IP-адреса и сети IPv4 и IPv6 в виде строк. Возвращает `0`, если версии IP-адреса и CIDR не совпадают.

**Синтаксис**

```sql
isIPAddressInRange(address, prefix)
```

**Аргументы**

* `address` — адрес IPv4 или IPv6. [`String`](/sql-reference/data-types/string)
* `prefix` — сетевой префикс IPv4 или IPv6 в записи CIDR. [`String`](/sql-reference/data-types/string)

**Возвращаемое значение**

Возвращает `1`, если версия IP-адреса и префикса в CIDR совпадают, иначе `0`. [`UInt8`](/sql-reference/data-types/int-uint)

**Примеры**

**Адрес IPv4 в диапазоне**

```sql title=Query
SELECT isIPAddressInRange('127.0.0.1', '127.0.0.0/8')
```

```response title=Response
1
```

**IPv4-адрес вне диапазона**

```sql title=Query
SELECT isIPAddressInRange('127.0.0.1', 'ffff::/16')
```

```response title=Response
0
```

**IPv6‑адрес вне диапазона**

```sql title=Query
SELECT isIPAddressInRange('::ffff:192.168.0.1', '::ffff:192.168.0.4/128')
```

```response title=Response
0
```

## isIPv4String {#isIPv4String}

Добавлена в версии: v21.1

Определяет, является ли входная строка IPv4-адресом.
Для варианта для IPv6 см. [`isIPv6String`](#isIPv6String).

**Синтаксис**

```sql
isIPv4String(string)
```

**Аргументы**

* `string` — строка с IP-адресом для проверки. [`String`](/sql-reference/data-types/string)

**Возвращаемое значение**

Возвращает `1`, если `string` — IPv4-адрес, иначе `0`. [`UInt8`](/sql-reference/data-types/int-uint)

**Примеры**

**Пример использования**

```sql title=Query
SELECT addr, isIPv4String(addr)
FROM(
SELECT ['0.0.0.0', '127.0.0.1', '::ffff:127.0.0.1'] AS addr
)
ARRAY JOIN addr;
```

```response title=Response
┌─addr─────────────┬─isIPv4String(addr)─┐
│ 0.0.0.0          │                  1 │
│ 127.0.0.1        │                  1 │
│ ::ffff:127.0.0.1 │                  0 │
└──────────────────┴────────────────────┘
```

## isIPv6String {#isIPv6String}

Введена в версии v21.1.

Определяет, является ли входная строка IPv6-адресом.
Для проверки IPv4-адресов используйте [`isIPv4String`](#isIPv4String).

**Синтаксис**

```sql
isIPv6String(string)
```

**Аргументы**

* `string` — строка с IP-адресом для проверки. [`String`](/sql-reference/data-types/string)

**Возвращаемое значение**

Возвращает `1`, если `string` содержит IPv6-адрес, иначе `0`. [`UInt8`](/sql-reference/data-types/int-uint)

**Примеры**

**Пример использования**

```sql title=Query
SELECT addr, isIPv6String(addr)
FROM(SELECT ['::', '1111::ffff', '::ffff:127.0.0.1', '127.0.0.1'] AS addr)
ARRAY JOIN addr;
```

```response title=Response
┌─addr─────────────┬─isIPv6String(addr)─┐
│ ::               │                  1 │
│ 1111::ffff       │                  1 │
│ ::ffff:127.0.0.1 │                  1 │
│ 127.0.0.1        │                  0 │
└──────────────────┴────────────────────┘
```

## toIPv4 {#toIPv4}

Впервые появилась в версии v20.1.

Преобразует строку или значение IPv4-адреса типа `UInt32` в значение типа `IPv4`.
Аналогична функциям [`IPv4StringToNum`](/sql-reference/functions/ip-address-functions#IPv4StringToNum) и [`IPv4NumToString`](/sql-reference/functions/ip-address-functions#IPv4NumToString), но поддерживает в качестве входных аргументов как строки, так и беззнаковые целые числа.

**Синтаксис**

```sql
toIPv4(x)
```

**Аргументы**

* `x` — IPv4-адрес в виде [`String`](/sql-reference/data-types/string) или [`UInt8/16/32`](/sql-reference/data-types/int-uint)

**Возвращаемое значение**

Возвращает IPv4-адрес типа [`IPv4`](/sql-reference/data-types/ipv4)

**Примеры**

**Пример использования**

```sql title=Query
SELECT toIPv4('171.225.130.45');
```

```response title=Response
┌─toIPv4('171.225.130.45')─┐
│ 171.225.130.45           │
└──────────────────────────┘
```

**Сравнение с функциями IPv4StringToNum и IPv4NumToString.**

```sql title=Query
WITH
    '171.225.130.45' AS IPv4_string
SELECT
    hex(IPv4StringToNum(IPv4_string)),
    hex(toIPv4(IPv4_string))
```

```response title=Response
┌─hex(IPv4StringToNum(IPv4_string))─┬─hex(toIPv4(IPv4_string))─┐
│ ABE1822D                          │ ABE1822D                 │
└───────────────────────────────────┴──────────────────────────┘
```

**Преобразование из целого числа**

```sql title=Query
SELECT toIPv4(2130706433);
```

```response title=Response
┌─toIPv4(2130706433)─┐
│ 127.0.0.1          │
└────────────────────┘
```

## toIPv4OrDefault {#toIPv4OrDefault}

Впервые представлена в версии v22.3.

Преобразует строку или значение IPv4 в формате `UInt32` в тип [`IPv4`](../data-types/ipv4.md).
Если IPv4-адрес имеет неверный формат, функция возвращает `0.0.0.0` (0 IPv4) или указанный IPv4-адрес по умолчанию.

**Синтаксис**

```sql
toIPv4OrDefault(string[, default])
```

**Аргументы**

* `string` — строка IP-адреса для преобразования. [`String`](/sql-reference/data-types/string)
* `default` — необязательный параметр. Значение, которое возвращается, если строка не является корректным IPv4-адресом. [`IPv4`](/sql-reference/data-types/ipv4)

**Возвращаемое значение**

Возвращает строку, преобразованную в соответствующий IPv4-адрес, или значение по умолчанию, если преобразование не удалось. [`IPv4`](/sql-reference/data-types/ipv4)

**Примеры**

**Корректные и некорректные строки IPv4**

```sql title=Query
WITH
    '192.168.1.1' AS valid_IPv4_string,
    '999.999.999.999' AS invalid_IPv4_string,
    'not_an_ip' AS malformed_string
SELECT
    toIPv4OrDefault(valid_IPv4_string) AS valid,
    toIPv4OrDefault(invalid_IPv4_string) AS default_value,
    toIPv4OrDefault(malformed_string, toIPv4('8.8.8.8')) AS provided_default;
```

```response title=Response
┌─valid─────────┬─default_value─┬─provided_default─┐
│ 192.168.1.1   │ 0.0.0.0       │ 8.8.8.8          │
└───────────────┴───────────────┴──────────────────┘
```

## toIPv4OrNull {#toIPv4OrNull}

Появилась в версии: v22.3

Преобразует входное значение в значение типа `IPv4`, но возвращает `NULL` в случае ошибки.
Аналогична [`toIPv4`](#toIPv4), но возвращает `NULL` вместо выброса исключения при ошибках преобразования.

Поддерживаемые аргументы:

* Строковые представления IPv4-адресов в точечной десятичной нотации.
* Целочисленные представления IPv4-адресов.

Неподдерживаемые аргументы (возвращают `NULL`):

* Неверные форматы IP-адресов.
* IPv6-адреса.
* Значения вне допустимого диапазона.
* Некорректные адреса.

**Синтаксис**

```sql
toIPv4OrNull(x)
```

**Аргументы**

* `x` — строковое значение или целочисленное представление IPv4-адреса. [`String`](/sql-reference/data-types/string) или [`Integer`](/sql-reference/data-types/int-uint)

**Возвращаемое значение**

Возвращает IPv4-адрес при успешном преобразовании, в противном случае `NULL`. [`IPv4`](/sql-reference/data-types/ipv4) или [`NULL`](/sql-reference/syntax#null)

**Примеры**

**Пример использования**

```sql title=Query
SELECT
    toIPv4OrNull('192.168.1.1') AS valid_ip,
    toIPv4OrNull('invalid.ip') AS invalid_ip
```

```response title=Response
┌─valid_ip────┬─invalid_ip─┐
│ 192.168.1.1 │       ᴺᵁᴸᴸ │
└─────────────┴────────────┘
```

## toIPv4OrZero {#toIPv4OrZero}

Появилась в версии: v23.1

Преобразует входное значение в тип [IPv4](../data-types/ipv4.md), но в случае ошибки возвращает нулевой IPv4-адрес.
Аналог функции [`toIPv4`](#toIPv4), но возвращает нулевой IPv4-адрес (`0.0.0.0`) вместо генерации исключения при ошибках преобразования.

Поддерживаемые аргументы:

* Строковые представления IPv4-адресов в десятичной точечной нотации.
* Целочисленные представления IPv4-адресов.

Неподдерживаемые аргументы (возвращается нулевой IPv4-адрес):

* Неверные форматы IP-адресов.
* IPv6-адреса.
* Значения вне допустимого диапазона.

**Синтаксис**

```sql
toIPv4OrZero(x)
```

**Аргументы**

* `x` — строковое или целочисленное представление IPv4-адреса. [`String`](/sql-reference/data-types/string) или [`Integer`](/sql-reference/data-types/int-uint)

**Возвращаемое значение**

Возвращает IPv4-адрес при успешном выполнении, в противном случае — нулевой IPv4-адрес (`0.0.0.0`). [`IPv4`](/sql-reference/data-types/ipv4)

**Примеры**

**Пример использования**

```sql title=Query
SELECT
    toIPv4OrZero('192.168.1.1') AS valid_ip,
    toIPv4OrZero('invalid.ip') AS invalid_ip
```

```response title=Response
┌─valid_ip────┬─invalid_ip─┐
│ 192.168.1.1 │ 0.0.0.0    │
└─────────────┴────────────┘
```

## toIPv6 {#toIPv6}

Добавлена в версии: v20.1

Преобразует строку или представление IPv6-адреса в виде `UInt128` в тип [`IPv6`](../data-types/ipv6.md).
Для строк, если IPv6-адрес имеет неверный формат, возвращает пустое значение.
Аналогична функциям [`IPv6StringToNum`](/sql-reference/functions/ip-address-functions#IPv6StringToNum) и [`IPv6NumToString`](/sql-reference/functions/ip-address-functions#IPv6NumToString), которые преобразуют IPv6-адрес в двоичный формат и обратно (т.е. `FixedString(16)`).

Если входная строка содержит корректный IPv4-адрес, возвращается эквивалентный ему IPv6-адрес.

**Синтаксис**

```sql
toIPv6(x)
```

**Аргументы**

* `x` — IP-адрес. [`String`](/sql-reference/data-types/string) или [`UInt128`](/sql-reference/data-types/int-uint)

**Возвращаемое значение**

Возвращает IPv6-адрес. [`IPv6`](/sql-reference/data-types/ipv6)

**Примеры**

**Пример использования**

```sql title=Query
WITH '2001:438:ffff::407d:1bc1' AS IPv6_string
SELECT
    hex(IPv6StringToNum(IPv6_string)),
    hex(toIPv6(IPv6_string));
```

```response title=Response
┌─hex(IPv6StringToNum(IPv6_string))─┬─hex(toIPv6(IPv6_string))─────────┐
│ 20010438FFFF000000000000407D1BC1  │ 20010438FFFF000000000000407D1BC1 │
└───────────────────────────────────┴──────────────────────────────────┘
```

**Преобразование IPv4 в IPv6**

```sql title=Query
SELECT toIPv6('127.0.0.1');
```

```response title=Response
┌─toIPv6('127.0.0.1')─┐
│ ::ffff:127.0.0.1    │
└─────────────────────┘
```

## toIPv6OrDefault {#toIPv6OrDefault}

Добавлена в версии v22.3

Преобразует строку или значение IPv6-адреса в формате `UInt128` в тип [`IPv6`](../data-types/ipv6.md).
Если IPv6-адрес имеет неверный формат, функция возвращает `::` (0 IPv6) или указанный IPv6 по умолчанию.

**Синтаксис**

```sql
toIPv6OrDefault(string[, default])
```

**Аргументы**

* `string` — строка с IP-адресом для преобразования.
* `default` — необязательный параметр. Значение, которое возвращается, если `string` имеет недопустимый формат.

**Возвращаемое значение**

Возвращает IPv6-адрес; в противном случае — `::` или указанное необязательное значение по умолчанию, если аргумент `string` имеет недопустимый формат. [`IPv6`](/sql-reference/data-types/ipv6)

**Примеры**

**Корректные и некорректные строки IPv6**

```sql title=Query
WITH
    '2001:0db8:85a3:0000:0000:8a2e:0370:7334' AS valid_IPv6_string,
    '2001:0db8:85a3::8a2e:370g:7334' AS invalid_IPv6_string,
    'not_an_ipv6' AS malformed_string
SELECT
    toIPv6OrDefault(valid_IPv6_string) AS valid,
    toIPv6OrDefault(invalid_IPv6_string) AS default_value,
    toIPv6OrDefault(malformed_string, toIPv6('::1')) AS provided_default;
```

```response title=Response
┌─valid──────────────────────────────────┬─default_value─┬─provided_default─┐
│ 2001:db8:85a3::8a2e:370:7334           │ ::            │ ::1              │
└────────────────────────────────────────┴───────────────┴──────────────────┘
```

## toIPv6OrNull {#toIPv6OrNull}

Впервые появилась в версии v22.3.

Преобразует входное значение в значение типа `IPv6`, но в случае ошибки возвращает `NULL`.
Аналогична [`toIPv6`](#toIPv6), но возвращает `NULL` вместо выброса исключения при ошибках преобразования.

Поддерживаемые аргументы:

* Строковые представления IPv6-адресов в стандартной нотации.
* Строковые представления IPv4-адресов (преобразуются в IPv4-mapped IPv6).
* Бинарные представления IPv6-адресов.

Неподдерживаемые аргументы (возвращают `NULL`):

* Некорректные форматы IP-адресов.
* Некорректные IPv6-адреса.
* Значения вне допустимого диапазона.
* Некорректная нотация.

**Синтаксис**

```sql
toIPv6OrNull(x)
```

**Аргументы**

* `x` — строковое представление IPv6- или IPv4-адреса. [`String`](/sql-reference/data-types/string)

**Возвращаемое значение**

Возвращает IPv6-адрес в случае успешного преобразования, в противном случае — `NULL`. [`IPv6`](/sql-reference/data-types/ipv6) или [`NULL`](/sql-reference/syntax#null)

**Примеры**

**Пример использования**

```sql title=Query
SELECT
    toIPv6OrNull('2001:0db8:85a3:0000:0000:8a2e:0370:7334') AS valid_ipv6,
    toIPv6OrNull('invalid::ip') AS invalid_ipv6
```

```response title=Response
┌─valid_ipv6──────────────────────────┬─invalid_ipv6─┐
│ 2001:db8:85a3::8a2e:370:7334        │         ᴺᵁᴸᴸ │
└─────────────────────────────────────┴──────────────┘
```

## toIPv6OrZero {#toIPv6OrZero}

Добавлена в версии: v23.1

Преобразует входное значение в значение типа [IPv6](../data-types/ipv6.md), но в случае ошибки возвращает нулевой IPv6-адрес.
Аналог [`toIPv6`](#toIPv6), но вместо выбрасывания исключения при ошибках преобразования возвращает нулевой IPv6-адрес (`::`).

Поддерживаемые аргументы:

* Строковые представления IPv6-адресов в стандартной нотации.
* Строковые представления IPv4-адресов (преобразуются в IPv4-mapped IPv6).
* Бинарные представления IPv6-адресов.

Неподдерживаемые аргументы (возвращают нулевой IPv6-адрес):

* Неверные форматы IP-адресов.
* Некорректно сформированные IPv6-адреса.
* Значения вне допустимого диапазона.

**Синтаксис**

```sql
toIPv6OrZero(x)
```

**Аргументы**

* `x` — Строковое представление адреса IPv6 или IPv4. [`String`](/sql-reference/data-types/string)

**Возвращаемое значение**

Возвращает IPv6-адрес в случае успешного выполнения, в противном случае — нулевой IPv6-адрес (`::`). [`IPv6`](/sql-reference/data-types/ipv6)

**Примеры**

**Пример использования**

```sql title=Query
SELECT
    toIPv6OrZero('2001:0db8:85a3:0000:0000:8a2e:0370:7334') AS valid_ipv6,
    toIPv6OrZero('invalid::ip') AS invalid_ipv6
```

```response title=Response
┌─valid_ipv6──────────────────────────┬─invalid_ipv6─┐
│ 2001:db8:85a3::8a2e:370:7334        │ ::           │
└─────────────────────────────────────┴──────────────┘
```

{/*AUTOGENERATED_END*/ }
