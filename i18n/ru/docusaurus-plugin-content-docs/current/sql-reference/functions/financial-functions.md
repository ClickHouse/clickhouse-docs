---
description: 'Документация по финансовым функциям'
sidebar_label: 'Финансы'
slug: /sql-reference/functions/financial-functions
title: 'Финансовые функции'
keywords: ['Финансы', 'норма доходности', 'чистая приведённая стоимость']
doc_type: 'reference'
---

# Финансовые функции {#financial-functions}

:::note
Приведённая ниже документация сгенерирована из системной таблицы `system.functions`
:::

{/* 
  Содержимое расположенных ниже тегов заменяется во время сборки фреймворка документации
  документацией, сгенерированной из system.functions. Пожалуйста, не изменяйте и не удаляйте эти теги.
  См.: https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
  */ }

{/*AUTOGENERATED_START*/ }

## financialInternalRateOfReturn {#financialInternalRateOfReturn}

Добавлена в: v25.7

Вычисляет внутреннюю норму доходности (IRR) для ряда денежных потоков, возникающих через равные промежутки времени.
IRR — это ставка дисконтирования, при которой чистая приведённая стоимость (NPV) равна нулю.

IRR определяется как решение следующего уравнения:

$$
\sum&#95;{i=0}^n \frac{cashflow_i}{(1 + irr)^i} = 0
$$

**Синтаксис**

```sql
financialInternalRateOfReturn(cashflows[, guess])
```

**Аргументы**

* `cashflows` — массив денежных потоков. Каждое значение представляет платёж (отрицательное значение) или доход (положительное значение). [`Array(Int8/16/32/64)`](/sql-reference/data-types/array) или [`Array(Float*)`](/sql-reference/data-types/array)
* `[, guess]` — необязательное начальное приближение (константа) для внутренней нормы доходности (по умолчанию 0.1). [`Float*`](/sql-reference/data-types/float)

**Возвращаемое значение**

Возвращает внутреннюю норму доходности или `NaN`, если вычисление не может сойтись, входной массив пуст или содержит только один элемент, все денежные потоки равны нулю либо происходят другие ошибки вычисления. [`Float64`](/sql-reference/data-types/float)

**Примеры**

**simple&#95;example**

```sql title=Query
SELECT financialInternalRateOfReturn([-100, 39, 59, 55, 20])
```

```response title=Response
0.2809484211599611
```

**simple_example_with_guess**

```sql title=Query
SELECT financialInternalRateOfReturn([-100, 39, 59, 55, 20], 0.1)
```

```response title=Response
0.2809484211599611
```



## financialInternalRateOfReturnExtended {#financialInternalRateOfReturnExtended}

Introduced in: v25.7


Calculates the Extended Internal Rate of Return (XIRR) for a series of cash flows occurring at irregular intervals. XIRR is the discount rate at which the net present value (NPV) of all cash flows equals zero.

XIRR attempts to solve the following equation (example for `ACT_365F`):

$$
\sum_{i=0}^n \frac{cashflow_i}{(1 + rate)^{(date_i - date_0)/365}} = 0
$$

Arrays should be sorted by date in ascending order. Dates need to be unique.
    

**Syntax**

```sql
financialInternalRateOfReturnExtended(cashflow, date [, guess, daycount])
```

**Arguments**

- `cashflow` — An array of cash flows corresponding to the dates in second param. [`Array(Int8/16/32/64)`](/sql-reference/data-types/array) or [`Array(Float*)`](/sql-reference/data-types/array)
- `date` — A sorted array of unique dates corresponding to the cash flows. [`Array(Date)`](/sql-reference/data-types/array) or [`Array(Date32)`](/sql-reference/data-types/array)
- `[, guess]` — Optional. Initial guess (constant value) for the XIRR calculation. [`Float*`](/sql-reference/data-types/float)
- `[, daycount]` — 
Optional day count convention (default 'ACT_365F'). Supported values:
- 'ACT_365F' - Actual/365 Fixed: Uses actual number of days between dates divided by 365
- 'ACT_365_25' - Actual/365.25: Uses actual number of days between dates divided by 365.25
             [`String`](/sql-reference/data-types/string)


**Returned value**

Returns the XIRR value. If the calculation cannot be performed, it returns NaN. [`Float64`](/sql-reference/data-types/float)

**Examples**

**simple_example**

```sql title=Запрос
SELECT financialInternalRateOfReturnExtended([-10000, 5750, 4250, 3250], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')])
```

```response title=Ответ
0.6342972615260243
```

**simple_example_with_guess**

```sql title=Запрос
SELECT financialInternalRateOfReturnExtended([-10000, 5750, 4250, 3250], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')], 0.5)
```

```response title=Ответ
0.6342972615260243
```

**simple_example_daycount**

```sql title=Запрос
SELECT round(financialInternalRateOfReturnExtended([100000, -110000], [toDate('2020-01-01'), toDate('2021-01-01')], 0.1, 'ACT_365_25'), 6) AS xirr_365_25
```

```response title=Ответ
0.099785
```



## financialNetPresentValue {#financialNetPresentValue}

Introduced in: v25.7


Calculates the Net Present Value (NPV) of a series of cash flows assuming equal time intervals between each cash flow.

Default variant (`start_from_zero` = true):

$$
\sum_{i=0}^{N-1} \frac{values_i}{(1 + rate)^i}
$$

Excel-compatible variant (`start_from_zero` = false):

$$
\sum_{i=1}^{N} \frac{values_i}{(1 + rate)^i}
$$
    

**Syntax**

```sql
financialNetPresentValue(rate, cashflows[, start_from_zero])
```

**Arguments**

- `rate` — The discount rate to apply. [`Float*`](/sql-reference/data-types/float)
- `cashflows` — Array of cash flows. Each value represents a payment (negative value) or income (positive value). [`Array(Int8/16/32/64)`](/sql-reference/data-types/array) or [`Array(Float*)`](/sql-reference/data-types/array)
- `[, start_from_zero]` — Optional boolean parameter indicating whether to start the NPV calculation from period `0` (true) or period `1` (false, Excel-compatible). Default: true. [`Bool`](/sql-reference/data-types/boolean)


**Returned value**

Returns the net present value as a Float64 value. [`Float64`](/sql-reference/data-types/float)

**Examples**

**default_calculation**

```sql title=Query
SELECT financialNetPresentValue(0.08, [-40000., 5000., 8000., 12000., 30000.])
```

```response title=Response
3065.2226681795255
```

**excel_compatible_calculation**

```sql title=Query
SELECT financialNetPresentValue(0.08, [-40000., 5000., 8000., 12000., 30000.], false)
```

```response title=Response
2838.1691372032656
```



## financialNetPresentValueExtended {#financialNetPresentValueExtended}

Introduced in: v25.7


Calculates the Extended Net Present Value (XNPV) for a series of cash flows occurring at irregular intervals. XNPV considers the specific timing of each cash flow when calculating present value.

XNPV equation for `ACT_365F`:

$$
XNPV=\sum_{i=1}^n \frac{cashflow_i}{(1 + rate)^{(date_i - date_0)/365}}
$$

Arrays should be sorted by date in ascending order. Dates need to be unique.
    

**Syntax**

```sql
financialNetPresentValueExtended(rate, cashflows, dates[, daycount])
```

**Arguments**

- `rate` — The discount rate to apply. [`Float*`](/sql-reference/data-types/float)
- `cashflows` — Array of cash flows. Each value represents a payment (negative value) or income (positive value). Must contain at least one positive and one negative value. [`Array(Int8/16/32/64)`](/sql-reference/data-types/array) or [`Array(Float*)`](/sql-reference/data-types/array)
- `dates` — Array of dates corresponding to each cash flow. Must have the same size as cashflows array. [`Array(Date)`](/sql-reference/data-types/array) or [`Array(Date32)`](/sql-reference/data-types/array)
- `[, daycount]` — Optional day count convention. Supported values: `'ACT_365F'` (default) — Actual/365 Fixed, `'ACT_365_25'` — Actual/365.25. [`String`](/sql-reference/data-types/string)


**Returned value**

Returns the net present value as a Float64 value. [`Float64`](/sql-reference/data-types/float)

**Examples**

**Basic usage**

```sql title=Запрос
SELECT financialNetPresentValueExtended(0.1, [-10000., 5750., 4250., 3250.], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')])
```

```response title=Ответ
2506.579458169746
```

**Using different day count convention**

```sql title=Запрос
SELECT financialNetPresentValueExtended(0.1, [-10000., 5750., 4250., 3250.], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')], 'ACT_365_25')
```

```response title=Ответ
2507.067268742502
```

<!--AUTOGENERATED_END-->

## Связанные ресурсы {#related-resources}

- [Видео о финансовых функциях в ClickHouse](https://www.youtube.com/watch?v=BePLPVa0w_o)
