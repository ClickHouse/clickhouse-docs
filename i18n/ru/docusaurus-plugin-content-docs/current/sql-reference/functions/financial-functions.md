---
description: 'Документация по финансовым функциям'
sidebar_label: 'Финансы'
slug: /sql-reference/functions/financial-functions
title: 'Финансовые функции'
keywords: ['Финансы', 'норма доходности', 'чистая приведённая стоимость']
doc_type: 'reference'
---



# Финансовые функции

:::note
Приведённая ниже документация сгенерирована из системной таблицы `system.functions`
:::

{/* 
  Содержимое расположенных ниже тегов заменяется во время сборки фреймворка документации
  документацией, сгенерированной из system.functions. Пожалуйста, не изменяйте и не удаляйте эти теги.
  См.: https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
  */ }


{/*AUTOGENERATED_START*/ }

## financialInternalRateOfReturn

Добавлена в: v25.7

Вычисляет внутреннюю норму доходности (IRR) для ряда денежных потоков, возникающих через равные промежутки времени.
IRR — это ставка дисконтирования, при которой чистая приведённая стоимость (NPV) равна нулю.

IRR определяется как решение следующего уравнения:

$$
\sum&#95;{i=0}^n \frac{cashflow_i}{(1 + irr)^i} = 0
$$

**Синтаксис**

```sql
financialInternalRateOfReturn(cashflows[, guess])
```

**Аргументы**

* `cashflows` — массив денежных потоков. Каждое значение представляет платёж (отрицательное значение) или доход (положительное значение). [`Array(Int8/16/32/64)`](/sql-reference/data-types/array) или [`Array(Float*)`](/sql-reference/data-types/array)
* `[, guess]` — необязательное начальное приближение (константа) для внутренней нормы доходности (по умолчанию 0.1). [`Float*`](/sql-reference/data-types/float)

**Возвращаемое значение**

Возвращает внутреннюю норму доходности или `NaN`, если вычисление не может сойтись, входной массив пуст или содержит только один элемент, все денежные потоки равны нулю либо происходят другие ошибки вычисления. [`Float64`](/sql-reference/data-types/float)

**Примеры**

**simple&#95;example**

```sql title=Query
SELECT financialInternalRateOfReturn([-100, 39, 59, 55, 20])
```

```response title=Response
0.2809484211599611
```

**simple&#95;example&#95;with&#95;guess**

```sql title=Query
SELECT financialInternalRateOfReturn([-100, 39, 59, 55, 20], 0.1)
```

```response title=Response
0.2809484211599611
```


## financialInternalRateOfReturnExtended {#financialInternalRateOfReturnExtended}

Введена в версии: v25.7

Вычисляет расширенную внутреннюю норму доходности (XIRR) для серии денежных потоков с нерегулярными интервалами. XIRR — это ставка дисконтирования, при которой чистая приведённая стоимость (NPV) всех денежных потоков равна нулю.

XIRR решает следующее уравнение (пример для `ACT_365F`):

$$
\sum_{i=0}^n \frac{cashflow_i}{(1 + rate)^{(date_i - date_0)/365}} = 0
$$

Массивы должны быть отсортированы по датам в порядке возрастания. Даты должны быть уникальными.

**Синтаксис**

```sql
financialInternalRateOfReturnExtended(cashflow, date [, guess, daycount])
```

**Аргументы**

- `cashflow` — Массив денежных потоков, соответствующих датам во втором параметре. [`Array(Int8/16/32/64)`](/sql-reference/data-types/array) или [`Array(Float*)`](/sql-reference/data-types/array)
- `date` — Отсортированный массив уникальных дат, соответствующих денежным потокам. [`Array(Date)`](/sql-reference/data-types/array) или [`Array(Date32)`](/sql-reference/data-types/array)
- `[, guess]` — Необязательный параметр. Начальное приближение (константа) для вычисления XIRR. [`Float*`](/sql-reference/data-types/float)
- `[, daycount]` —
  Необязательный параметр. Соглашение о подсчёте дней (по умолчанию 'ACT_365F'). Поддерживаемые значения:
- 'ACT_365F' - Actual/365 Fixed: использует фактическое количество дней между датами, делённое на 365
- 'ACT_365_25' - Actual/365.25: использует фактическое количество дней между датами, делённое на 365.25
  [`String`](/sql-reference/data-types/string)

**Возвращаемое значение**

Возвращает значение XIRR. Если вычисление невозможно, возвращает NaN. [`Float64`](/sql-reference/data-types/float)

**Примеры**

**simple_example**

```sql title=Запрос
SELECT financialInternalRateOfReturnExtended([-10000, 5750, 4250, 3250], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')])
```

```response title=Ответ
0.6342972615260243
```

**simple_example_with_guess**

```sql title=Запрос
SELECT financialInternalRateOfReturnExtended([-10000, 5750, 4250, 3250], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')], 0.5)
```

```response title=Ответ
0.6342972615260243
```

**simple_example_daycount**

```sql title=Запрос
SELECT round(financialInternalRateOfReturnExtended([100000, -110000], [toDate('2020-01-01'), toDate('2021-01-01')], 0.1, 'ACT_365_25'), 6) AS xirr_365_25
```

```response title=Ответ
0.099785
```


## financialNetPresentValue

Появилась в версии: v25.7

Вычисляет чистую приведённую стоимость (Net Present Value, NPV) ряда денежных потоков при условии равных временных интервалов между каждым денежным потоком.

Вариант по умолчанию (`start_from_zero` = true):

$$
\sum&#95;{i=0}^{N-1} \frac{values_i}{(1 + rate)^i}
$$

Вариант, совместимый с Excel (`start_from_zero` = false):

$$
\sum&#95;{i=1}^{N} \frac{values_i}{(1 + rate)^i}
$$

**Синтаксис**

```sql
financialNetPresentValue(rate, cashflows[, start_from_zero])
```

**Аргументы**

* `rate` — Ставка дисконтирования, которая будет применена. [`Float*`](/sql-reference/data-types/float)
* `cashflows` — Массив денежных потоков. Каждое значение представляет собой платеж (отрицательное значение) или доход (положительное значение). [`Array(Int8/16/32/64)`](/sql-reference/data-types/array) или [`Array(Float*)`](/sql-reference/data-types/array)
* `[, start_from_zero]` — Необязательный логический параметр, определяющий, начинать ли расчет NPV с периода `0` (true) или с периода `1` (false, как в Excel). Значение по умолчанию: true. [`Bool`](/sql-reference/data-types/boolean)

**Возвращаемое значение**

Возвращает чистую приведенную стоимость в виде значения типа Float64. [`Float64`](/sql-reference/data-types/float)

**Примеры**

**default&#95;calculation**

```sql title=Query
SELECT financialNetPresentValue(0.08, [-40000., 5000., 8000., 12000., 30000.])
```

```response title=Response
3065.2226681795255
```

**excel&#95;compatible&#95;calculation**

```sql title=Query
SELECT financialNetPresentValue(0.08, [-40000., 5000., 8000., 12000., 30000.], false)
```

```response title=Response
2838.1691372032656
```


## financialNetPresentValueExtended {#financialNetPresentValueExtended}

Введена в версии: v25.7

Вычисляет расширенную чистую приведённую стоимость (XNPV) для серии денежных потоков, происходящих через нерегулярные интервалы. XNPV учитывает конкретное время каждого денежного потока при расчёте приведённой стоимости.

Уравнение XNPV для `ACT_365F`:

$$
XNPV=\sum_{i=1}^n \frac{cashflow_i}{(1 + rate)^{(date_i - date_0)/365}}
$$

Массивы должны быть отсортированы по дате в порядке возрастания. Даты должны быть уникальными.

**Синтаксис**

```sql
financialNetPresentValueExtended(rate, cashflows, dates[, daycount])
```

**Аргументы**

- `rate` — Применяемая ставка дисконтирования. [`Float*`](/sql-reference/data-types/float)
- `cashflows` — Массив денежных потоков. Каждое значение представляет платёж (отрицательное значение) или доход (положительное значение). Должен содержать как минимум одно положительное и одно отрицательное значение. [`Array(Int8/16/32/64)`](/sql-reference/data-types/array) или [`Array(Float*)`](/sql-reference/data-types/array)
- `dates` — Массив дат, соответствующих каждому денежному потоку. Должен иметь тот же размер, что и массив cashflows. [`Array(Date)`](/sql-reference/data-types/array) или [`Array(Date32)`](/sql-reference/data-types/array)
- `[, daycount]` — Необязательное соглашение о подсчёте дней. Поддерживаемые значения: `'ACT_365F'` (по умолчанию) — Actual/365 Fixed, `'ACT_365_25'` — Actual/365.25. [`String`](/sql-reference/data-types/string)

**Возвращаемое значение**

Возвращает чистую приведённую стоимость в виде значения Float64. [`Float64`](/sql-reference/data-types/float)

**Примеры**

**Базовое использование**

```sql title=Запрос
SELECT financialNetPresentValueExtended(0.1, [-10000., 5750., 4250., 3250.], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')])
```

```response title=Ответ
2506.579458169746
```

**Использование другого соглашения о подсчёте дней**

```sql title=Запрос
SELECT financialNetPresentValueExtended(0.1, [-10000., 5750., 4250., 3250.], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')], 'ACT_365_25')
```

```response title=Ответ
2507.067268742502
```

<!--AUTOGENERATED_END-->


## Связанные ресурсы {#related-resources}

- [Видео о финансовых функциях в ClickHouse](https://www.youtube.com/watch?v=BePLPVa0w_o)
