---
description: 'Документация по типу данных QBit в ClickHouse, который позволяет выполнять тонкую квантизацию для приближённого векторного поиска'
keywords: ['qbit', 'тип данных']
sidebar_label: 'QBit'
sidebar_position: 64
slug: /sql-reference/data-types/qbit
title: 'Тип данных QBit'
doc_type: 'reference'
---

import ExperimentalBadge from '@theme/badges/ExperimentalBadge';

<ExperimentalBadge />

Тип данных `QBit` реорганизует хранение векторов для более быстрого приближённого поиска. Вместо хранения элементов каждого вектора вместе он группирует одинаковые позиции двоичных разрядов по всем векторам.
Это позволяет хранить векторы с полной точностью и при этом выбирать нужный уровень тонкой квантизации во время поиска: считывать меньше бит для снижения объёма ввода-вывода и ускорения вычислений или больше бит для повышения точности. Вы получаете преимущества в скорости за счёт сокращения передачи данных и вычислений благодаря квантизации, при этом все исходные данные остаются доступными при необходимости.

:::note
Тип данных `QBit` и связанные с ним функции расстояния в настоящее время являются экспериментальными.
Чтобы их включить, сначала выполните `SET allow_experimental_qbit_type = 1`.
Если вы столкнётесь с проблемами, пожалуйста, создайте задачу в [репозитории ClickHouse](https://github.com/clickhouse/clickhouse/issues).
:::

Чтобы объявить столбец типа `QBit`, используйте следующий синтаксис:

```sql
имя_столбца QBit(тип_элемента, размерность)
```

* `element_type` – тип каждого элемента вектора. Допустимые типы — `BFloat16`, `Float32` и `Float64`
* `dimension` – число элементов в каждом векторе


## Создание QBit {#creating-qbit}

Использование типа `QBit` при определении столбца таблицы:

```sql
CREATE TABLE test (id UInt32, vec QBit(Float32, 8)) ENGINE = Memory;
INSERT INTO test VALUES (1, [1, 2, 3, 4, 5, 6, 7, 8]), (2, [9, 10, 11, 12, 13, 14, 15, 16]);
SELECT vec FROM test ORDER BY id;
```

```text
┌─vec──────────────────────┐
│ [1,2,3,4,5,6,7,8]        │
│ [9,10,11,12,13,14,15,16] │
└──────────────────────────┘
```


## Подстолбцы QBit {#qbit-subcolumns}

`QBit` реализует механизм доступа к подстолбцам, позволяющий обращаться к отдельным битовым плоскостям хранимых векторов. Доступ к каждой битовой позиции осуществляется с помощью синтаксиса `.N`, где `N` — номер битовой позиции:

```sql
CREATE TABLE test (id UInt32, vec QBit(Float32, 8)) ENGINE = Memory;
INSERT INTO test VALUES (1, [0, 0, 0, 0, 0, 0, 0, 0]);
INSERT INTO test VALUES (1, [-0, -0, -0, -0, -0, -0, -0, -0]);
SELECT bin(vec.1) FROM test;
```

```text
┌─bin(tupleElement(vec, 1))─┐
│ 00000000                  │
│ 11111111                  │
└───────────────────────────┘
```

Количество доступных подстолбцов зависит от типа элемента:

- `BFloat16`: 16 подстолбцов (1-16)
- `Float32`: 32 подстолбца (1-32)
- `Float64`: 64 подстолбца (1-64)


## Функции векторного поиска {#vector-search-functions}

Функции расстояния для поиска по векторному сходству, использующие тип данных `QBit`:

- [`L2DistanceTransposed`](../functions/distance-functions.md#L2DistanceTransposed)
