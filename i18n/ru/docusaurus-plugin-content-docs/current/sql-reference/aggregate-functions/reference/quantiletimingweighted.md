---
slug: /sql-reference/aggregate-functions/reference/quantiletimingweighted
sidebar_position: 181
title: 'quantileTimingWeighted'
description: 'С заданной точностью вычисляет квантиль числовой последовательности данных в зависимости от веса каждого элемента последовательности.'
---


# quantileTimingWeighted

С заданной точностью вычисляет [квантиль](https://en.wikipedia.org/wiki/Quantile) числовой последовательности данных в зависимости от веса каждого элемента последовательности.

Результат является детерминированным (не зависит от порядка обработки запроса). Функция оптимизирована для работы с последовательностями, которые описывают распределения, такие как время загрузки веб-страниц или время отклика бэкенда.

При использовании нескольких функций `quantile*` с разными уровнями в запросе, внутренние состояния не объединяются (то есть, запрос работает менее эффективно, чем мог бы). В этом случае используйте функцию [quantiles](../../../sql-reference/aggregate-functions/reference/quantiles.md#quantiles).

**Синтаксис**

``` sql
quantileTimingWeighted(level)(expr, weight)
```

Псевдоним: `medianTimingWeighted`.

**Аргументы**

- `level` — Уровень квантиля. Необязательный параметр. Константа с плавающей запятой от 0 до 1. Рекомендуется использовать значение `level` в диапазоне `[0.01, 0.99]`. Значение по умолчанию: 0.5. При `level=0.5` функция вычисляет [медиану](https://en.wikipedia.org/wiki/Median).

- `expr` — [Выражение](/sql-reference/syntax#expressions) над значениями колонки, возвращающее число типа [Float\*](../../../sql-reference/data-types/float.md).

        - Если на функцию переданы отрицательные значения, поведение не определено.
        - Если значение больше 30,000 (время загрузки страницы более 30 секунд), оно считается равным 30,000.

- `weight` — Колонка с весами элементов последовательности. Вес — это количество вхождений значения.

**Точность**

Расчет является точным, если:

- Общее количество значений не превышает 5670.
- Общее количество значений превышает 5670, но время загрузки страницы составляет менее 1024 мс.

В противном случае результат вычисления округляется до ближайшего кратного 16 мс.

:::note    
Для вычисления квантилей времени загрузки страницы эта функция более эффективна и точна, чем [quantile](/sql-reference/aggregate-functions/reference/quantile).
:::

**Возвращаемое значение**

- Квантиль указанного уровня.

Тип: `Float32`.

:::note    
Если функции не передаются значения (при использовании `quantileTimingIf`), возвращается [NaN](/sql-reference/data-types/float#nan-and-inf). Это нужно для различия случаев, которые приводят к нулю. См. примечания по сортировке значений `NaN` в [ORDER BY clause](/sql-reference/statements/select/order-by).
:::

**Пример**

Исходная таблица:

``` text
┌─response_time─┬─weight─┐
│            68 │      1 │
│           104 │      2 │
│           112 │      3 │
│           126 │      2 │
│           138 │      1 │
│           162 │      1 │
└───────────────┴────────┘
```

Запрос:

``` sql
SELECT quantileTimingWeighted(response_time, weight) FROM t
```

Результат:

``` text
┌─quantileTimingWeighted(response_time, weight)─┐
│                                           112 │
└───────────────────────────────────────────────┘
```


# quantilesTimingWeighted

Так же, как `quantileTimingWeighted`, но принимает несколько параметров с уровнями квантиля и возвращает массив, заполненный значениями этих квантилей.

**Пример**

Исходная таблица:

``` text
┌─response_time─┬─weight─┐
│            68 │      1 │
│           104 │      2 │
│           112 │      3 │
│           126 │      2 │
│           138 │      1 │
│           162 │      1 │
└───────────────┴────────┘
```

Запрос:

``` sql
SELECT quantilesTimingWeighted(0,5, 0.99)(response_time, weight) FROM t
```

Результат:

``` text
┌─quantilesTimingWeighted(0.5, 0.99)(response_time, weight)─┐
│ [112,162]                                                 │
└───────────────────────────────────────────────────────────┘
```

**См. также**

- [median](/sql-reference/aggregate-functions/reference/median)
- [quantiles](../../../sql-reference/aggregate-functions/reference/quantiles.md#quantiles)
