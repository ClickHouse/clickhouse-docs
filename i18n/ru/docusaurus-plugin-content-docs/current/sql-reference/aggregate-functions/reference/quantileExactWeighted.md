---
description: 'Точно вычисляет квантиль по числовой последовательности данных с учётом веса каждого элемента.'
slug: /sql-reference/aggregate-functions/reference/quantileexactweighted
title: 'quantileExactWeighted'
doc_type: 'reference'
---

{/*AUTOGENERATED_START*/ }

## quantileExactWeighted \{#quantileExactWeighted\}

Введена в версии v1.1

Точно вычисляет [квантиль](https://en.wikipedia.org/wiki/Quantile) числовой последовательности данных с учётом веса каждого элемента.

Для получения точного значения все переданные значения объединяются в массив, который затем частично сортируется.
Каждое значение учитывается с его весом, как если бы оно присутствовало `weight` раз.
В алгоритме используется хеш-таблица.
Благодаря этому, если передаваемые значения часто повторяются, функция потребляет меньше RAM, чем [`quantileExact`](/sql-reference/aggregate-functions/reference/quantileexact#quantileexact).
Вы можете использовать эту функцию вместо `quantileExact` и указать вес 1.

При использовании нескольких функций `quantile*` с разными уровнями в запросе их внутренние состояния не объединяются (то есть запрос работает менее эффективно, чем мог бы).
В этом случае используйте функцию [quantiles](/sql-reference/aggregate-functions/reference/quantiles#quantiles).

**Синтаксис**

```sql
quantileExactWeighted(level)(expr, weight)
```

**Псевдонимы**: `medianExactWeighted`

**Параметры**

* `level` — Необязательный параметр. Уровень квантиля. Константа с плавающей запятой от 0 до 1. Рекомендуется использовать значение `level` в диапазоне `[0.01, 0.99]`. Значение по умолчанию: 0.5. При `level=0.5` функция вычисляет медиану. [`Float*`](/sql-reference/data-types/float)

**Аргументы**

* `expr` — Выражение над значениями в столбце, результатом которого являются значения числовых типов данных, Date или DateTime. [`(U)Int*`](/sql-reference/data-types/int-uint) или [`Float*`](/sql-reference/data-types/float) или [`Decimal*`](/sql-reference/data-types/decimal) или [`Date`](/sql-reference/data-types/date) или [`DateTime`](/sql-reference/data-types/datetime)
* `weight` — Столбец с весами элементов последовательности. Вес — это количество вхождений значения. [`UInt*`](/sql-reference/data-types/int-uint)

**Возвращаемое значение**

Квантиль указанного уровня. [`Float64`](/sql-reference/data-types/float) или [`Date`](/sql-reference/data-types/date) или [`DateTime`](/sql-reference/data-types/datetime)

**Примеры**

**Вычисление точного взвешенного квантиля**

```sql title=Query
CREATE TABLE t (
    n Int32,
    val Int32
) ENGINE = Memory;

-- Insert the sample data
INSERT INTO t VALUES
(0, 3),
(1, 2),
(2, 1),
(5, 4);

SELECT quantileExactWeighted(n, val) FROM t;
```

```response title=Response
┌─quantileExactWeighted(n, val)─┐
│                             1 │
└───────────────────────────────┘
```

{/*AUTOGENERATED_END*/ }

**См. также**

* [median](/sql-reference/aggregate-functions/reference/median)
* [quantiles](/sql-reference/aggregate-functions/reference/quantiles)
