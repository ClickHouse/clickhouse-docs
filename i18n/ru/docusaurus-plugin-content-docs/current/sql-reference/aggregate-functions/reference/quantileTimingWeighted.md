---
description: 'С заданной точностью вычисляет квантиль числовой последовательности данных с учётом веса каждого значения.'
slug: /sql-reference/aggregate-functions/reference/quantiletimingweighted
title: 'quantileTimingWeighted'
doc_type: 'reference'
---

{/*AUTOGENERATED_START*/ }

## quantileTimingWeighted \{#quantileTimingWeighted\}

Появилась в версии: v1.1

С заданной точностью вычисляет [квантиль](https://en.wikipedia.org/wiki/Quantile) числовой последовательности данных с учётом веса каждого элемента последовательности.

Результат является детерминированным (не зависит от порядка обработки запроса). Функция оптимизирована для работы с последовательностями, описывающими распределения, такие как время загрузки веб‑страниц или время ответа бэкенда.

При использовании нескольких функций `quantile*` с разными уровнями в одном запросе их внутренние состояния не объединяются (то есть запрос работает менее эффективно, чем мог бы). В этом случае используйте функцию [`quantiles`](/sql-reference/aggregate-functions/reference/quantiles#quantiles).

**Точность**

Вычисление является точным, если:

* Общее количество значений не превышает 5670.
* Общее количество значений превышает 5670, но время загрузки страницы меньше 1024 мс.

В противном случае результат вычисления округляется до ближайшего кратного 16 мс.

:::note
Для вычисления квантилей времени загрузки страниц эта функция более эффективна и точна, чем [`quantile`](/sql-reference/aggregate-functions/reference/quantile).
:::

:::note
Если функции не передано ни одного значения (при использовании `quantileTimingIf`), возвращается [NaN](/sql-reference/data-types/float#nan-and-inf). Это позволяет отличать такие случаи от случаев с результатом, равным нулю. См. заметки о сортировке значений `NaN` в разделе [предложение ORDER BY](/sql-reference/statements/select/order-by).
:::

**Синтаксис**

```sql
quantileTimingWeighted(level)(expr, weight)
```

**Псевдонимы**: `medianTimingWeighted`

**Параметры**

* `level` — Необязательный параметр. Уровень квантиля. Константное число с плавающей запятой от 0 до 1. Рекомендуется использовать значение `level` в диапазоне `[0.01, 0.99]`. Значение по умолчанию: 0.5. При `level=0.5` функция вычисляет медиану. [`Float*`](/sql-reference/data-types/float)

**Аргументы**

* `expr` — Выражение по значениям столбца, возвращающее число типа Float*. Если в функцию передаются отрицательные значения, поведение не определено. Если значение больше 30 000 (время загрузки страницы более 30 секунд), считается, что оно равно 30 000. [`Float*`](/sql-reference/data-types/float)
* `weight` — Столбец с весами элементов последовательности. Вес — это количество вхождений значения. [`UInt*`](/sql-reference/data-types/int-uint)

**Возвращаемое значение**

Квантиль указанного уровня. [`Float32`](/sql-reference/data-types/float)

**Примеры**

**Вычисление взвешенного квантиля времени**

```sql title=Query
CREATE TABLE t (response_time UInt32, weight UInt32) ENGINE = Memory;
INSERT INTO t VALUES (68, 1), (104, 2), (112, 3), (126, 2), (138, 1), (162, 1);

SELECT quantileTimingWeighted(response_time, weight) FROM t;
```

```response title=Response
┌─quantileTimingWeighted(response_time, weight)─┐
│                                           112 │
└───────────────────────────────────────────────┘
```

{/*AUTOGENERATED_END*/ }
