---
description: 'Вычисляет приближённый квантиль последовательности числовых данных с использованием алгоритма t-digest.'
slug: /sql-reference/aggregate-functions/reference/quantiletdigestweighted
title: 'quantileTDigestWeighted'
doc_type: 'reference'
---

{/*AUTOGENERATED_START*/ }

## quantileTDigestWeighted \{#quantileTDigestWeighted\}

Введена в: v20.1

Вычисляет приближенный [квантиль](https://en.wikipedia.org/wiki/Quantile) числовой последовательности с использованием алгоритма [t-digest](https://github.com/tdunning/t-digest/blob/master/docs/t-digest-paper/histo.pdf).
Функция учитывает вес каждого элемента последовательности.

Максимальная погрешность составляет 1%.
Потребление памяти — `log(n)`, где `n` — количество значений.

Производительность функции ниже, чем у [`quantile`](/sql-reference/aggregate-functions/reference/quantile) или [`quantileTiming`](/sql-reference/aggregate-functions/reference/quantiletiming).
С точки зрения соотношения размера State к точности эта функция значительно лучше, чем `quantile`.

Результат зависит от порядка выполнения запроса и недетерминирован.

При использовании нескольких функций `quantile*` с разными уровнями в одном запросе внутренние состояния не объединяются (то есть запрос работает менее эффективно, чем мог бы).
В этом случае используйте функцию [`quantiles`](/sql-reference/aggregate-functions/reference/quantiles#quantiles).

:::note
Использование `quantileTDigestWeighted` [не рекомендуется для очень маленьких наборов данных](https://github.com/tdunning/t-digest/issues/167#issuecomment-828650275) и может приводить к значительной погрешности.
В этом случае рассмотрите возможность использования [`quantileTDigest`](/sql-reference/aggregate-functions/reference/quantiletdigest) вместо нее.
:::

**Синтаксис**

```sql
quantileTDigestWeighted(level)(expr, weight)
```

**Псевдонимы**: `medianTDigestWeighted`

**Параметры**

* `level` — Необязательный параметр. Уровень квантиля. Константное число с плавающей запятой от 0 до 1. Рекомендуется использовать значение `level` в диапазоне `[0.01, 0.99]`. Значение по умолчанию: 0.5. При `level=0.5` функция вычисляет медиану. [`Float*`](/sql-reference/data-types/float)

**Аргументы**

* `expr` — Выражение над значениями столбца, результатом которого являются числовые типы данных, Date или DateTime. [`(U)Int*`](/sql-reference/data-types/int-uint) или [`Float*`](/sql-reference/data-types/float) или [`Decimal*`](/sql-reference/data-types/decimal) или [`Date`](/sql-reference/data-types/date) или [`DateTime`](/sql-reference/data-types/datetime)
* `weight` — Столбец с весами элементов последовательности. Вес — это количество вхождений значения. [`UInt*`](/sql-reference/data-types/int-uint)

**Возвращаемое значение**

Приближённый квантиль указанного уровня. [`Float64`](/sql-reference/data-types/float) или [`Date`](/sql-reference/data-types/date) или [`DateTime`](/sql-reference/data-types/datetime)

**Примеры**

**Вычисление взвешенного квантиля с t-digest**

```sql title=Query
SELECT quantileTDigestWeighted(number, 1) FROM numbers(10);
```

```response title=Response
┌─quantileTDigestWeighted(number, 1)─┐
│                                4.5 │
└────────────────────────────────────┘
```

{/*AUTOGENERATED_END*/ }

**См. также**

* [median](/sql-reference/aggregate-functions/reference/median)
* [quantiles](../../../sql-reference/aggregate-functions/reference/quantiles.md)
