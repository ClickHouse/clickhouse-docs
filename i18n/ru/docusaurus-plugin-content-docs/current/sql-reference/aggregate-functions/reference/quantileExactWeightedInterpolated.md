---
description: 'Вычисляет квантиль последовательности числовых данных с использованием линейной интерполяции с учётом веса каждого элемента.'
slug: /sql-reference/aggregate-functions/reference/quantileExactWeightedInterpolated
title: 'quantileExactWeightedInterpolated'
doc_type: 'reference'
---

{/*AUTOGENERATED_START*/ }

## quantileExactWeightedInterpolated \{#quantileExactWeightedInterpolated\}

Добавлена в: v24.10

Вычисляет [квантиль](https://en.wikipedia.org/wiki/Quantile) числовой последовательности данных с использованием линейной интерполяции с учётом веса каждого элемента.

Чтобы получить интерполированное значение, все переданные значения объединяются в массив и сортируются по соответствующим весам.
Далее интерполяция квантилей выполняется с использованием [метода взвешенного перцентиля](https://en.wikipedia.org/wiki/Percentile#The_weighted_percentile_method): строится кумулятивное распределение на основе весов, после чего на основе весов и значений выполняется линейная интерполяция для вычисления квантилей.

При использовании нескольких функций `quantile*` с разными уровнями в запросе их внутренние состояния не объединяются (то есть запрос работает менее эффективно, чем мог бы).
В этом случае используйте функцию [quantiles](/sql-reference/aggregate-functions/reference/quantiles#quantiles).

Мы настоятельно рекомендуем использовать `quantileExactWeightedInterpolated` вместо `quantileInterpolatedWeighted`, потому что `quantileExactWeightedInterpolated` более точен, чем `quantileInterpolatedWeighted`.
См. пример ниже для более подробной иллюстрации.

**Синтаксис**

```sql
quantileExactWeightedInterpolated(level)(expr, weight)
```

**Псевдонимы**: `medianExactWeightedInterpolated`

**Параметры**

* `level` — Необязательный параметр. Уровень квантиля. Константное число с плавающей запятой от 0 до 1. Рекомендуется использовать значение `level` в диапазоне `[0.01, 0.99]`. Значение по умолчанию: 0.5. При `level=0.5` функция вычисляет медиану. [`Float*`](/sql-reference/data-types/float)

**Аргументы**

* `expr` — Выражение над значениями столбца, результатом которого являются числовые типы данных, Date или DateTime. [`(U)Int*`](/sql-reference/data-types/int-uint) или [`Float*`](/sql-reference/data-types/float) или [`Decimal*`](/sql-reference/data-types/decimal) или [`Date`](/sql-reference/data-types/date) или [`DateTime`](/sql-reference/data-types/datetime)
* `weight` — Столбец с весами элементов последовательности. Вес — это количество вхождений значения. [`UInt*`](/sql-reference/data-types/int-uint)

**Возвращаемое значение**

Квантиль указанного уровня. [`Float64`](/sql-reference/data-types/float) или [`Date`](/sql-reference/data-types/date) или [`DateTime`](/sql-reference/data-types/datetime)

**Примеры**

**Вычисление точного взвешенного интерполированного квантиля**

```sql title=Query
SELECT quantileExactWeightedInterpolated(n, val) FROM t;
```

```response title=Response
┌─quantileExactWeightedInterpolated(n, val)─┐
│                                       1.5 │
└───────────────────────────────────────────┘
```

**Используйте quantileExactWeightedInterpolated вместо quantileInterpolatedWeighted**

```sql title=Query
SELECT
    quantileExactWeightedInterpolated(0.99)(number, 1),
    quantile(0.99)(number),
    quantileInterpolatedWeighted(0.99)(number, 1)
FROM numbers(9)
```

```response title=Response
┌─quantileExactWeightedInterpolated(0.99)(number, 1)─┬─quantile(0.99)(number)─┬─quantileInterpolatedWeighted(0.99)(number, 1)─┐
│                                               7.92 │                   7.92 │                                             8 │
└────────────────────────────────────────────────────┴────────────────────────┴───────────────────────────────────────────────┘
```

{/*AUTOGENERATED_END*/ }

**См. также**

* [median](/sql-reference/aggregate-functions/reference/median)
* [quantiles](../../../sql-reference/aggregate-functions/reference/quantiles.md)
