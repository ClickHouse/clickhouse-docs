---
slug: /sql-reference/aggregate-functions/reference/stochasticlinearregression
sidebar_position: 192
title: 'stochasticLinearRegression'
description: 'Эта функция реализует стохастическую линейную регрессию. Она поддерживает пользовательские параметры для скорости обучения, коэффициента L2 регуляризации, размера мини-партии и имеет несколько методов для обновления весов (Адам, простой SGD, Моментум, Нестерова.)'
---


# stochasticLinearRegression {#agg_functions_stochasticlinearregression_parameters}

Эта функция реализует стохастическую линейную регрессию. Она поддерживает пользовательские параметры для скорости обучения, коэффициента L2 регуляризации, размера мини-партии и имеет несколько методов для обновления весов ([Адам](https://en.wikipedia.org/wiki/Stochastic_gradient_descent#Adam) (используется по умолчанию), [простой SGD](https://en.wikipedia.org/wiki/Stochastic_gradient_descent), [Моментум](https://en.wikipedia.org/wiki/Stochastic_gradient_descent#Momentum) и [Нестерова](https://mipt.ru/upload/medialibrary/d7e/41-91.pdf)).

### Параметры {#parameters}

Существует 4 настраиваемых параметра. Они передаются функции по порядку, но нет необходимости передавать все четыре — будут использоваться значения по умолчанию, однако для хорошей модели требуется некоторое тонкое настраивание параметров.

``` text
stochasticLinearRegression(0.00001, 0.1, 15, 'Adam')
```

1.  `скорость обучения` — это коэффициент длины шага, когда выполняется шаг градиентного спуска. Слишком большая скорость обучения может вызвать бесконечные веса модели. По умолчанию `0.00001`.
2.  `коэффициент L2 регуляризации`, который может помочь предотвратить переобучение. По умолчанию `0.1`.
3.  `размер мини-партии` устанавливает количество элементов, для которых будут вычисляться и суммироваться градиенты для выполнения одного шага градиентного спуска. Чистый стохастический спуск использует один элемент, однако наличие небольших пакетов (около 10 элементов) делает шаги градиента более стабильными. По умолчанию `15`.
4.  `метод обновления весов`, они: `Adam` (по умолчанию), `SGD`, `Momentum` и `Nesterov`. `Momentum` и `Nesterov` требуют немного больше вычислений и памяти, однако они оказываются полезными с точки зрения скорости сходимости и стабильности стохастических методов градиента.

### Использование {#usage}

`stochasticLinearRegression` используется в два этапа: настройка модели и прогнозирование на новых данных. Чтобы настроить модель и сохранить её состояние для дальнейшего использования, мы используем комбинирующий оператор `-State`, который сохраняет состояние (например, веса модели).
Для прогнозирования мы используем функцию [evalMLMethod](/sql-reference/functions/machine-learning-functions#evalmlmethod), которая принимает состояние в качестве аргумента, а также признаки для прогнозирования.

<a name="stochasticlinearregression-usage-fitting"></a>

**1.** Настройка

Такой запрос может быть использован.

``` sql
CREATE TABLE IF NOT EXISTS train_data
(
    param1 Float64,
    param2 Float64,
    target Float64
) ENGINE = Memory;

CREATE TABLE your_model ENGINE = Memory AS SELECT
stochasticLinearRegressionState(0.1, 0.0, 5, 'SGD')(target, param1, param2)
AS state FROM train_data;
```

Здесь нам также нужно вставить данные в таблицу `train_data`. Количество параметров не фиксировано, оно зависит только от количества аргументов, переданных в `linearRegressionState`. Все они должны быть числовыми значениями.
Обратите внимание, что колонка с целевым значением (которое мы хотели бы научиться предсказывать) вставляется в качестве первого аргумента.

**2.** Прогнозирование

После сохранения состояния в таблице мы можем использовать его несколько раз для прогнозирования или даже объединять с другими состояниями и создавать новые, ещё лучшие модели.

``` sql
WITH (SELECT state FROM your_model) AS model SELECT
evalMLMethod(model, param1, param2) FROM test_data
```

Этот запрос вернёт колонку предсказанных значений. Обратите внимание, что первый аргумент функции `evalMLMethod` — это объект `AggregateFunctionState`, следующие — это колонки признаков.

`test_data` — это таблица, подобная `train_data`, но может не содержать целевое значение.

### Примечания {#notes}

1.  Чтобы объединить две модели, пользователь может создать такой запрос:
    `sql  SELECT state1 + state2 FROM your_models`
    где таблица `your_models` содержит обе модели. Этот запрос вернёт новый объект `AggregateFunctionState`.

2.  Пользователь может получить веса созданной модели для собственных нужд, не сохраняя модель, если сопоставляющий оператор `-State` не используется.
    `sql  SELECT stochasticLinearRegression(0.01)(target, param1, param2) FROM train_data`
    Такой запрос настроит модель и вернёт её веса — первыми являются веса, соответствующие параметрам модели, последним является смещение. Таким образом, в примере выше запрос вернёт колонку с 3 значениями.

**См. также**

- [stochasticLogisticRegression](/sql-reference/aggregate-functions/reference/stochasticlogisticregression)
- [Различия между линейной и логистической регрессией](https://stackoverflow.com/questions/12146914/what-is-the-difference-between-linear-regression-and-logistic-regression)
