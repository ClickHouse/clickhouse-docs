---
description: 'quantilesGK работает аналогично функции quantileGK, но позволяет рассчитывать квантили на разных уровнях одновременно и возвращает массив.'
slug: /sql-reference/aggregate-functions/reference/quantilesGK
title: 'quantilesGK'
doc_type: 'reference'
---

{/*AUTOGENERATED_START*/ }

## quantilesGK \{#quantilesGK\}

Появилась в версии: v23.4

Вычисляет несколько [квантилей](https://en.wikipedia.org/wiki/Quantile) числовой последовательности данных на разных уровнях одновременно, используя алгоритм [Greenwald-Khanna](http://infolab.stanford.edu/~datar/courses/cs361a/papers/quantiles.pdf).

Эта функция работает аналогично [`quantileGK`](/sql-reference/aggregate-functions/reference/quantileGK), но позволяет вычислять несколько уровней квантилей за один проход, что эффективнее, чем вызывать отдельные функции квантилей.

Алгоритм Greenwald-Khanna — это алгоритм для вычисления квантилей на потоке данных высокоэффективным образом.
Его предложили Michael Greenwald и Sanjeev Khanna в 2001 году.
Алгоритм является очень эффективным, требуя только O(log n) памяти и O(log log n) времени на элемент (где n — размер входных данных).
Он также обладает высокой точностью, обеспечивая приближённые значения квантилей с контролируемой точностью.

**Синтаксис**

```sql
quantilesGK(accuracy, level1, level2, ...)(expr)
```

**Параметры**

* `accuracy` — Точность квантилей. Положительное целое константное число. Более высокое значение точности означает меньшую погрешность. Например, если аргумент `accuracy` имеет значение 100, вычисленные квантили будут иметь погрешность не более 1% с высокой вероятностью. Существует компромисс между точностью вычисленных квантилей и вычислительной сложностью алгоритма. [`UInt*`](/sql-reference/data-types/int-uint)
* `level` — Уровни квантилей. Одно или несколько константных чисел с плавающей запятой от 0 до 1. [`Float*`](/sql-reference/data-types/float)

**Аргументы**

* `expr` — Выражение над значениями столбца, результатом которого являются числовые типы данных, Date или DateTime. [`(U)Int*`](/sql-reference/data-types/int-uint) или [`Float*`](/sql-reference/data-types/float) или [`Decimal*`](/sql-reference/data-types/decimal) или [`Date`](/sql-reference/data-types/date) или [`DateTime`](/sql-reference/data-types/datetime)

**Возвращаемое значение**

Массив квантилей заданных уровней в том же порядке, в котором были заданы уровни. [`Array(Float64)`](/sql-reference/data-types/array) или [`Array(Date)`](/sql-reference/data-types/array) или [`Array(DateTime)`](/sql-reference/data-types/array)

**Примеры**

**Вычисление нескольких квантилей с помощью алгоритма GK**

```sql title=Query
SELECT quantilesGK(1, 0.25, 0.5, 0.75)(number + 1) FROM numbers(1000);
```

```response title=Response
┌─quantilesGK(1, 0.25, 0.5, 0.75)(plus(number, 1))─┐
│ [1, 1, 1]                                        │
└──────────────────────────────────────────────────┘
```

**Квантили с более высокой точностью**

```sql title=Query
SELECT quantilesGK(100, 0.25, 0.5, 0.75)(number + 1) FROM numbers(1000);
```

```response title=Response
┌─quantilesGK(100, 0.25, 0.5, 0.75)(plus(number, 1))─┐
│ [251, 498, 741]                                    │
└────────────────────────────────────────────────────┘
```

{/*AUTOGENERATED_END*/ }
