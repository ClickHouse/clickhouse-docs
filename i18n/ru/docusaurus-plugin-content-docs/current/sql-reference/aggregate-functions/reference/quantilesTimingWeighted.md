---
description: 'С заданной точностью вычисляет квантиль числовой последовательности с учетом веса каждого ее элемента.'
slug: /sql-reference/aggregate-functions/reference/quantilestimingweighted
title: 'quantilesTimingWeighted'
doc_type: 'reference'
---

{/*AUTOGENERATED_START*/ }

## quantilesTimingWeighted \{#quantilesTimingWeighted\}

Введено в: v1.1

Вычисляет несколько [квантилей](https://en.wikipedia.org/wiki/Quantile) числовой последовательности данных на разных уровнях одновременно с заданной точностью, с учётом веса каждого элемента последовательности.

Эта функция эквивалентна [`quantileTimingWeighted`](/sql-reference/aggregate-functions/reference/quantiletimingweighted), но позволяет вычислять несколько уровней квантилей за один проход, что эффективнее, чем отдельные вызовы функций квантилей.

Результат детерминирован (не зависит от порядка обработки запроса). Функция оптимизирована для работы с последовательностями, описывающими распределения, такие как время загрузки веб‑страниц или время отклика бэкенда.

**Точность**

Вычисление является точным, если:

* Общее количество значений не превышает 5670.
* Общее количество значений превышает 5670, но время загрузки страницы меньше 1024 мс.

В противном случае результат вычисления округляется до ближайшего значения, кратного 16 мс.

:::note
Для вычисления квантилей времени загрузки страниц эта функция более эффективна и точна, чем [`quantiles`](/sql-reference/aggregate-functions/reference/quantiles).
:::

**Синтаксис**

```sql
quantilesTimingWeighted(level1, level2, ...)(expr, weight)
```

**Параметры**

* `level` — уровни квантилей. Одно или несколько константных чисел с плавающей запятой от 0 до 1. Рекомендуется использовать значения `level` в диапазоне `[0.01, 0.99]`. [`Float*`](/sql-reference/data-types/float)

**Аргументы**

* `expr` — выражение над значениями столбца, которое возвращает число типа Float*. Если функции передаются отрицательные значения, поведение не определено. Если значение больше 30 000 (время загрузки страницы более 30 секунд), оно принимается равным 30 000. [`Float*`](/sql-reference/data-types/float)
* `weight` — столбец с весами элементов последовательности. Вес — это количество вхождений значения. [`UInt*`](/sql-reference/data-types/int-uint)

**Возвращаемое значение**

Массив квантилей указанных уровней в том же порядке, в котором были заданы уровни. [`Array(Float32)`](/sql-reference/data-types/array)

**Примеры**

**Вычисление нескольких взвешенных квантилей таймингов**

```sql title=Query
SELECT quantilesTimingWeighted(0.5, 0.99)(response_time, weight) FROM t;
```

```response title=Response
┌─quantilesTimingWeighted(0.5, 0.99)(response_time, weight)─┐
│ [112, 162]                                                │
└───────────────────────────────────────────────────────────┘
```

{/*AUTOGENERATED_END*/ }

**См. также**

* [median](/sql-reference/aggregate-functions/reference/median)
* [quantiles](../../../sql-reference/aggregate-functions/reference/quantiles.md)
