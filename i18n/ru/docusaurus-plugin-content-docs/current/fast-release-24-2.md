---
slug: /whats-new/changelog/24.2-fast-release
title: Changelog v24.2
description: Журнал изменений быстрого релиза v24.2
keywords: [журнал изменений]
---
### Тег выпуска ClickHouse: 24.2.2.15987 {#clickhouse-release-tag-242215987}
#### Несовместимое изменение {#backward-incompatible-change}
* Проверять подозрительные/экспериментальные типы в вложенных типах. Ранее такие типы (кроме JSON) в вложенных типах, таких как Array/Tuple/Map, не проверялись. [#59385](https://github.com/ClickHouse/ClickHouse/pull/59385) ([Kruglov Pavel](https://github.com/Avogar)).
* Клаузула сортировки `ORDER BY ALL` (введенная в v23.12) заменена на `ORDER BY *`. Предыдущий синтаксис был слишком подвержен ошибкам для таблиц с колонкой `all`. [#59450](https://github.com/ClickHouse/ClickHouse/pull/59450) ([Robert Schulze](https://github.com/rschu1ze)).
* Добавлена проверка на количество потоков и размеры блоков. [#60138](https://github.com/ClickHouse/ClickHouse/pull/60138) ([Raúl Marín](https://github.com/Algunenano)).
* Отклонять входящие запросы INSERT в случае, если настройки уровня запроса `async_insert` и `deduplicate_blocks_in_dependent_materialized_views` включены одновременно. Это поведение контролируется настройкой `throw_if_deduplication_in_dependent_materialized_views_enabled_with_async_insert` и включено по умолчанию. Это продолжение [#59699](https://github.com/ClickHouse/ClickHouse/pull/59699), необходимого для разблокировки [#59915](https://github.com/ClickHouse/ClickHouse/pull/59915). [#60888](https://github.com/ClickHouse/ClickHouse/pull/60888) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Утилита `clickhouse-copier` перемещена в отдельный репозиторий на GitHub: https://github.com/ClickHouse/copier. Она больше не включена в пакет, но по-прежнему доступна для загрузки отдельно. Это закрывает: [#60734](https://github.com/ClickHouse/ClickHouse/issues/60734) Это закрывает: [#60540](https://github.com/ClickHouse/ClickHouse/issues/60540) Это закрывает: [#60250](https://github.com/ClickHouse/ClickHouse/issues/60250) Это закрывает: [#52917](https://github.com/ClickHouse/ClickHouse/issues/52917) Это закрывает: [#51140](https://github.com/ClickHouse/ClickHouse/issues/51140) Это закрывает: [#47517](https://github.com/ClickHouse/ClickHouse/issues/47517) Это закрывает: [#47189](https://github.com/ClickHouse/ClickHouse/issues/47189) Это закрывает: [#46598](https://github.com/ClickHouse/ClickHouse/issues/46598) Это закрывает: [#40257](https://github.com/ClickHouse/ClickHouse/issues/40257) Это закрывает: [#36504](https://github.com/ClickHouse/ClickHouse/issues/36504) Это закрывает: [#35485](https://github.com/ClickHouse/ClickHouse/issues/35485) Это закрывает: [#33702](https://github.com/ClickHouse/ClickHouse/issues/33702) Это закрывает: [#26702](https://github.com/ClickHouse/ClickHouse/issues/26702) ### Запись документации для изменений, касающихся пользователей. [#61058](https://github.com/ClickHouse/ClickHouse/pull/61058) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Для повышения совместимости с MySQL функция `locate` теперь принимает аргументы `(needle, haystack[, start_pos])` по умолчанию. Предыдущее поведение `(haystack, needle, [, start_pos])` можно восстановить, установив `function_locate_has_mysql_compatible_argument_order = 0`. [#61092](https://github.com/ClickHouse/ClickHouse/pull/61092) ([Robert Schulze](https://github.com/rschu1ze)).
* Устаревшие данные в памяти были объявлены устаревшими с версии 23.5 и не поддерживались с версии 23.10. Теперь оставшийся код удалён. Продолжение [#55186](https://github.com/ClickHouse/ClickHouse/issues/55186) и [#45409](https://github.com/ClickHouse/ClickHouse/issues/45409). Скорее всего, вы не использовали данные в памяти, поскольку они были доступны только до версии 23.5 и только при их ручном включении, задав соответствующие SETTINGS для таблицы MergeTree. Чтобы проверить, есть ли у вас данные в памяти, выполните следующий запрос: `SELECT part_type, count() FROM system.parts GROUP BY part_type ORDER BY part_type`. Чтобы отключить использование данных в памяти, выполните `ALTER TABLE ... MODIFY SETTING min_bytes_for_compact_part = DEFAULT, min_rows_for_compact_part = DEFAULT`. Перед обновлением со старых релизов ClickHouse сначала проверьте, чтобы у вас не было данных в памяти. Если есть данные в памяти, сначала отключите их, затем подождите, пока не останется данных в памяти, и продолжите обновление. [#61127](https://github.com/ClickHouse/ClickHouse/pull/61127) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Запретить `SimpleAggregateFunction` в `ORDER BY` таблиц `MergeTree` (так же как и `AggregateFunction`, но они запрещены, потому что их нельзя сравнивать) по умолчанию (используйте `allow_suspicious_primary_key`, чтобы разрешить их). [#61399](https://github.com/ClickHouse/ClickHouse/pull/61399) ([Azat Khuzhin](https://github.com/azat)).
* ClickHouse позволяет произвольные двоичные данные в типе данных String, который обычно является UTF-8. Parquet/ORC/Arrow Strings поддерживают только UTF-8. Поэтому вы можете выбрать, какой тип данных Arrow использовать для типа данных ClickHouse String - String или Binary. Это контролируется настройками `output_format_parquet_string_as_string`, `output_format_orc_string_as_string`, `output_format_arrow_string_as_string`. Хотя Binary было бы более корректным и совместимым, использование String по умолчанию будет соответствовать ожиданиям пользователей в большинстве случаев. Parquet/ORC/Arrow поддерживают множество методов сжатия, включая lz4 и zstd. ClickHouse поддерживает все методы сжатия. Некоторые менее продвинутые инструменты не поддерживают более быстрый метод сжатия `lz4`, поэтому мы устанавливаем `zstd` по умолчанию. Это контролируется настройками `output_format_parquet_compression_method`, `output_format_orc_compression_method` и `output_format_arrow_compression_method`. Мы изменили значение по умолчанию для Parquet и ORC на `zstd`, но не для Arrow (это подчеркивается как для низкоуровневого использования). [#61817](https://github.com/ClickHouse/ClickHouse/pull/61817) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправление проблемы безопасности с материализованными представлениями, которое позволяло пользователю вставлять в таблицу без необходимых прав. Исправление проверяет, есть ли у пользователя разрешение на вставку не только в материализованное представление, но и во все подлежащие таблицы. Это означает, что некоторые запросы, которые раньше работали, теперь могут завершиться ошибкой из-за недостатка привилегий. Чтобы решить эту проблему, релиз вводит новую функцию SQL-безопасности для представлений [https://clickhouse.com/docs/sql-reference/statements/create/view#sql_security](/sql-reference/statements/create/view#sql_security). [#54901](https://github.com/ClickHouse/ClickHouse/pull/54901) ([pufit](https://github.com/pufit))
#### Новая функция {#new-feature}
* Режим поддержки Topk/topkweighed, который возвращает количество значений и его ошибку. [#54508](https://github.com/ClickHouse/ClickHouse/pull/54508) ([UnamedRus](https://github.com/UnamedRus)).
* Добавлен новый синтаксис, позволяющий указать пользователя-определителя в представлении/материализованном представлении. Это позволяет выполнять выборки/вставки из представлений без явных разрешений для подлежащих таблиц. [#54901](https://github.com/ClickHouse/ClickHouse/pull/54901) ([pufit](https://github.com/pufit)).
* Реализована автоматическая конверсия таблиц Merge Tree различных типов в реплицированный движок. Создайте пустой файл `convert_to_replicated` в директории данных таблицы (`/clickhouse/store/xxx/xxxyyyyy-yyyy-yyyy-yyyy-yyyyyyyyyyyy/`), и эта таблица будет автоматически конвертирована при следующем запуске сервера. [#57798](https://github.com/ClickHouse/ClickHouse/pull/57798) ([Kirill](https://github.com/kirillgarbar)).
* Добавлена функция таблицы `mergeTreeIndex`. Она представляет содержимое индекса и файлов меток таблиц `MergeTree`. Она может использоваться для интроспекции. Синтаксис: `mergeTreeIndex(database, table, [with_marks = true])`, где `database.table` - это существующая таблица с движком `MergeTree`. [#58140](https://github.com/ClickHouse/ClickHouse/pull/58140) ([Anton Popov](https://github.com/CurtizJ)).
* Попробуйте автоматически определить формат файла во время вывода схемы, если он неизвестен в движках `file/s3/hdfs/url/azureBlobStorage`. Закрывает [#50576](https://github.com/ClickHouse/ClickHouse/issues/50576). [#59092](https://github.com/ClickHouse/ClickHouse/pull/59092) ([Kruglov Pavel](https://github.com/Avogar)).
* Добавлена функция generate_series как таблица. Эта функция генерирует таблицу с арифметической прогрессией с натуральными числами. [#59390](https://github.com/ClickHouse/ClickHouse/pull/59390) ([divanik](https://github.com/divanik)).
* Добавлен запрос `ALTER TABLE table FORGET PARTITION partition`, который удаляет узлы ZooKeeper, относящиеся к пустой партиции. [#59507](https://github.com/ClickHouse/ClickHouse/pull/59507) ([Sergei Trifonov](https://github.com/serxa)).
* Поддержка чтения и записи резервных копий как tar-архивов. [#59535](https://github.com/ClickHouse/ClickHouse/pull/59535) ([josh-hildred](https://github.com/josh-hildred)).
* Предоставляет новую агрегирующую функцию ‘groupArrayIntersect’. Продолжение: [#49862](https://github.com/ClickHouse/ClickHouse/issues/49862). [#59598](https://github.com/ClickHouse/ClickHouse/pull/59598) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Реализована таблица system.dns_cache, которая может быть полезна для отладки проблем с DNS. [#59856](https://github.com/ClickHouse/ClickHouse/pull/59856) ([Kirill Nikiforov](https://github.com/allmazz)).
* Реализована поддержка ведер S3Express. [#59965](https://github.com/ClickHouse/ClickHouse/pull/59965) ([Nikita Taranov](https://github.com/nickitat)).
* Кодек `LZ4HC` примет новый уровень 2, который быстрее, чем предыдущий минимальный уровень 3, за счет меньшего сжатия. В предыдущих версиях `LZ4HC(2)` и менее было то же самое, что и `LZ4HC(3)`. Автор: [Cyan4973](https://github.com/Cyan4973). [#60090](https://github.com/ClickHouse/ClickHouse/pull/60090) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Реализована таблица system.dns_cache, которая может быть полезна для отладки проблем с DNS. Новая серверная настройка dns_cache_max_size. [#60257](https://github.com/ClickHouse/ClickHouse/pull/60257) ([Kirill Nikiforov](https://github.com/allmazz)).
* Добавлена функция `toMillisecond`, которая возвращает миллисекундную компоненту для значений типов `DateTime` или `DateTime64`. [#60281](https://github.com/ClickHouse/ClickHouse/pull/60281) ([Shaun Struwig](https://github.com/Blargian)).
* Поддержка однопараметрической версии для функции таблицы merge, как `merge(['db_name', ] 'tables_regexp')`. [#60372](https://github.com/ClickHouse/ClickHouse/pull/60372) ([豪肥肥](https://github.com/HowePa)).
* Сделать все названия форматов нечувствительными к регистру, такие как Tsv, или TSV, или tsv, или даже rowbinary. [#60420](https://github.com/ClickHouse/ClickHouse/pull/60420) ([豪肥肥](https://github.com/HowePa)).
* Добавлен новый синтаксис, позволяющий указать пользователя-определителя в представлении/материализованном представлении. Это позволяет выполнять выборки/вставки из представлений без явных разрешений для подлежащих таблиц. [#60439](https://github.com/ClickHouse/ClickHouse/pull/60439) ([pufit](https://github.com/pufit)).
* Добавить четыре свойства к `StorageMemory` (memory-engine) `min_bytes_to_keep, max_bytes_to_keep, min_rows_to_keep` и `max_rows_to_keep` - Добавить тесты для отражения новых изменений - Обновить документацию `memory.md` - Добавить свойство таблицы `context` к `MemorySink`, чтобы обеспечить доступ к пределам параметров таблицы. [#60612](https://github.com/ClickHouse/ClickHouse/pull/60612) ([Jake Bamrah](https://github.com/JakeBamrah)).
* Добавлена функция `toMillisecond`, которая возвращает миллисекундную компоненту для значений типов `DateTime` или `DateTime64`. [#60649](https://github.com/ClickHouse/ClickHouse/pull/60649) ([Robert Schulze](https://github.com/rschu1ze)).
* Отдельные лимиты на количество ожидающих и выполняющихся запросов. Добавлена новая серверная настройка `max_waiting_queries`, которая ограничивает количество запросов, ожидающих из-за `async_load_databases`. Существующие лимиты на количество выполняющихся запросов больше не учитывают ожидающие запросы. [#61053](https://github.com/ClickHouse/ClickHouse/pull/61053) ([Sergei Trifonov](https://github.com/serxa)).
* Добавить поддержку `ATTACH PARTITION ALL`. [#61107](https://github.com/ClickHouse/ClickHouse/pull/61107) ([Kirill Nikiforov](https://github.com/allmazz)).
#### Улучшение производительности {#performance-improvement}
* Устранение аггрегаторов min/max/any/anyLast ключей GROUP BY в разделе SELECT. [#52230](https://github.com/ClickHouse/ClickHouse/pull/52230) ([JackyWoo](https://github.com/JackyWoo)).
* Улучшение производительности сериализованного метода агрегации при вовлечении нескольких [nullable] колонок. Это общая версия [#51399](https://github.com/ClickHouse/ClickHouse/issues/51399), которая не идет на компромисс с целостностью абстракции. [#55809](https://github.com/ClickHouse/ClickHouse/pull/55809) ([Amos Bird](https://github.com/amosbird)).
* Ленивая сборка выходных данных соединения, чтобы улучшить производительность ALL-соединения. [#58278](https://github.com/ClickHouse/ClickHouse/pull/58278) ([LiuNeng](https://github.com/liuneng1994)).
* Улучшения агрегационных функций ArgMin / ArgMax / any / anyLast / anyHeavy, а также запросов `ORDER BY {u8/u16/u32/u64/i8/i16/u32/i64) LIMIT 1`. [#58640](https://github.com/ClickHouse/ClickHouse/pull/58640) ([Raúl Marín](https://github.com/Algunenano)).
* Оптимизация производительности sum/avg в зависимости от типа bigint и big decimal, сокращая ветвления. [#59504](https://github.com/ClickHouse/ClickHouse/pull/59504) ([李扬](https://github.com/taiyang-li)).
* Улучшение производительности SELECT-ов с активными мутациями. [#59531](https://github.com/ClickHouse/ClickHouse/pull/59531) ([Azat Khuzhin](https://github.com/azat)).
* Тривиальная оптимизация фильтра по колонкам. Избежать фильтрованных колонок, чей базовый тип данных не является числом, отфильтрованным с `result_size_hint = -1`. Пиковая память может быть уменьшена до 44% от первоначального в некоторых случаях. [#59698](https://github.com/ClickHouse/ClickHouse/pull/59698) ([李扬](https://github.com/taiyang-li)).
* Первичный ключ будет использовать меньшее количество памяти. [#60049](https://github.com/ClickHouse/ClickHouse/pull/60049) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Улучшение использования памяти для первичного ключа и некоторых других операций. [#60050](https://github.com/ClickHouse/ClickHouse/pull/60050) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Первичные ключи таблиц будут загружаться в память лениво при первом доступе. Это контролируется новой настройкой MergeTree `primary_key_lazy_load`, которая включена по умолчанию. Это дает несколько преимуществ: - он не будет загружен для неиспользуемых таблиц; - если памяти недостаточно, исключение будет выброшено при первом использовании вместо запуска сервера. Это имеет несколько недостатков: - задержка загрузки первичного ключа будет оплачена при первом запросе, а не до приема подключений; это теоретически может привести к проблеме громкого стада. Это закрывает [#11188](https://github.com/ClickHouse/ClickHouse/issues/11188). [#60093](https://github.com/ClickHouse/ClickHouse/pull/60093) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Векторизованная функция `dotProduct`, которая полезна для векторного поиска. [#60202](https://github.com/ClickHouse/ClickHouse/pull/60202) ([Robert Schulze](https://github.com/rschu1ze)).
* Если первичный ключ таблицы состоит в основном из бесполезных колонок, не храните их в памяти. Это контролируется новой настройкой `primary_key_ratio_of_unique_prefix_values_to_skip_suffix_columns` со значением `0.9` по умолчанию, что означает: для составного первичного ключа, если колонка изменяет свое значение как минимум в 0.9 из всех случаев, последующие колонки после нее не будут загружены. [#60255](https://github.com/ClickHouse/ClickHouse/pull/60255) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Выполняйте функцию multiIf по колонкам, когда базовый тип результата - число. [#60384](https://github.com/ClickHouse/ClickHouse/pull/60384) ([李扬](https://github.com/taiyang-li)).
* Как показано на рисунке 1, замена "&&" на "&" может сгенерировать SIMD код. ![image](https://github.com/ClickHouse/ClickHouse/assets/26588299/a5a72ac4-6dc6-4d52-835a-4f512e55f0b9) Рисунок 1. Код, скомпилированный из '&&' (слева) и '&' (справа). [#60498](https://github.com/ClickHouse/ClickHouse/pull/60498) ([Zhiguo Zhou](https://github.com/ZhiguoZh)).
* Более быстрые (почти в 2 раза) мьютексы (были медленнее из-за ThreadFuzzer). [#60823](https://github.com/ClickHouse/ClickHouse/pull/60823) ([Azat Khuzhin](https://github.com/azat)).
* Переместите очистку соединений из подготовки в работу и очищайте несколько соединений параллельно. [#60845](https://github.com/ClickHouse/ClickHouse/pull/60845) ([lizhuoyu5](https://github.com/lzydmxy)).
* Оптимизация insertManyFrom для nullable number или nullable string. [#60846](https://github.com/ClickHouse/ClickHouse/pull/60846) ([李扬](https://github.com/taiyang-li)).
* Оптимизирована функция `dotProduct`, чтобы избежать ненужных и затратных копий памяти. [#60928](https://github.com/ClickHouse/ClickHouse/pull/60928) ([Robert Schulze](https://github.com/rschu1ze)).
* Операции с кэшем файловой системы будут меньше страдать от соревнования за блокировки. [#61066](https://github.com/ClickHouse/ClickHouse/pull/61066) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Оптимизация ColumnString::replicate и предотвращение оптимизации memcpySmallAllowReadWriteOverflow15Impl в встроенный memcpy. Закрыть [#61074](https://github.com/ClickHouse/ClickHouse/issues/61074). ColumnString::replicate ускоряется в 2.46 раз на x86-64. [#61075](https://github.com/ClickHouse/ClickHouse/pull/61075) ([李扬](https://github.com/taiyang-li)).
* 30 раз быстрее печать для 256-битных целых чисел. [#61100](https://github.com/ClickHouse/ClickHouse/pull/61100) ([Raúl Marín](https://github.com/Algunenano)).
* Если запрос с синтаксической ошибкой содержал сопоставитель COLUMNS с регулярным выражением, регулярное выражение компилировалось каждый раз во время обратной проверки парсера, вместо того чтобы компилироваться один раз. Это была фундаментальная ошибка. Скомпилированное regexp было помещено в AST. Но буква A в AST означает "абстрактный", что означает, что он не должен содержать тяжелых объектов. Части AST могут быть созданы и отброшены во время парсинга, включая большое количество обратных проверок. Это приводит к медлительности на стороне парсинга и, следовательно, позволяет DoS пользователю с правами только на чтение. Но основная проблема заключается в том, что это мешает прогрессу в фуззерах. [#61543](https://github.com/ClickHouse/ClickHouse/pull/61543) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
```yaml
title: 'Улучшения'
sidebar_label: 'Улучшения'
keywords: ['ClickHouse', 'обновления', 'новости']
description: 'Перечисление улучшений и изменений в ClickHouse.'
```

#### Improvement {#improvement}
* При выполнении запроса `MODIFY COLUMN` для материализованных представлений проверьте структуру внутренней таблицы, чтобы убедиться, что каждая колонка существует. [#47427](https://github.com/ClickHouse/ClickHouse/pull/47427) ([sunny](https://github.com/sunny19930321)).
* Добавлена таблица `system.keywords`, которая содержит все ключевые слова парсера. В основном это необходимо и будет использоваться для более качественной проверки и подсветки синтаксиса. [#51808](https://github.com/ClickHouse/ClickHouse/pull/51808) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Добавлена поддержка параметризованного представления с анализатором, чтобы не анализировать создание параметризованного представления. Рефакторинг существующей логики параметризованного представления для того, чтобы не анализировать создание параметризованного представления. [#54211](https://github.com/ClickHouse/ClickHouse/pull/54211) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* Обычный движок базы данных устарел. Вы получите предупреждение в `clickhouse-client`, если ваш сервер его использует. Это закрывает [#52229](https://github.com/ClickHouse/ClickHouse/issues/52229). [#56942](https://github.com/ClickHouse/ClickHouse/pull/56942) ([shabroo](https://github.com/shabroo)).
* Все блокировки с нулевой копией, связанные с таблицей, должны быть удалены при ее удалении. Директория, содержащая эти блокировки, также должна быть удалена. [#57575](https://github.com/ClickHouse/ClickHouse/pull/57575) ([Sema Checherinda](https://github.com/CheSema)).
* Добавлена возможность короткого замыкания для функции `dictGetOrDefault`. Закрывает [#52098](https://github.com/ClickHouse/ClickHouse/issues/52098). [#57767](https://github.com/ClickHouse/ClickHouse/pull/57767) ([jsc0218](https://github.com/jsc0218)).
* Разрешено объявление enum в структуре внешней таблицы. [#57857](https://github.com/ClickHouse/ClickHouse/pull/57857) ([Duc Canh Le](https://github.com/canhld94)).
* Теперь запуск `ALTER COLUMN MATERIALIZE` на колонке с выражением `DEFAULT` или `MATERIALIZED` записывает правильные значения: значение по умолчанию для существующих частей с значением по умолчанию или не-значение по умолчанию для существующих частей с не-значением по умолчанию. Ранее значение по умолчанию записывалось для всех существующих частей. [#58023](https://github.com/ClickHouse/ClickHouse/pull/58023) ([Duc Canh Le](https://github.com/canhld94)).
* Включена логика обратного отката (например, экспоненциальная). Это обеспечит возможность уменьшения использования процессора, памяти и размеров журналов. [#58036](https://github.com/ClickHouse/ClickHouse/pull/58036) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* Учитывайте легковесные удаленные строки при выборе частей для слияния. [#58223](https://github.com/ClickHouse/ClickHouse/pull/58223) ([Zhuo Qiu](https://github.com/jewelzqiu)).
* Разрешите определять `volume_priority` в `storage_configuration`. [#58533](https://github.com/ClickHouse/ClickHouse/pull/58533) ([Andrey Zvonov](https://github.com/zvonand)).
* Добавлена поддержка типа Date32 в кодеке T64. [#58738](https://github.com/ClickHouse/ClickHouse/pull/58738) ([Hongbin Ma](https://github.com/binmahone)).
* Этот PR делает http/https соединения повторно используемыми для всех случаев использования. Даже когда ответ 3xx или 4xx. [#58845](https://github.com/ClickHouse/ClickHouse/pull/58845) ([Sema Checherinda](https://github.com/CheSema)).
* Добавлены комментарии для колонок в нескольких системных таблицах. Продолжение https://github.com/ClickHouse/ClickHouse/pull/58356. [#59016](https://github.com/ClickHouse/ClickHouse/pull/59016) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Теперь мы можем использовать виртуальные колонки в `PREWHERE`. Это полезно для не-константных виртуальных колонок, таких как `_part_offset`. [#59033](https://github.com/ClickHouse/ClickHouse/pull/59033) ([Amos Bird](https://github.com/amosbird)).
* Настройки для распределенного движка таблицы теперь могут быть указаны в конфигурационном файле сервера (аналогично настройкам MergeTree), например: ``` <distributed> <flush_on_detach>false</flush_on_detach> </distributed> ```. [#59291](https://github.com/ClickHouse/ClickHouse/pull/59291) ([Azat Khuzhin](https://github.com/azat)).
* Улучшение Keeper: кэшировать только определенное количество журналов в памяти, контролируемое `latest_logs_cache_size_threshold` и `commit_logs_cache_size_threshold`. [#59460](https://github.com/ClickHouse/ClickHouse/pull/59460) ([Antonio Andelic](https://github.com/antonio2368)).
* Вместо использования постоянного ключа теперь объектное хранилище генерирует ключ для определения возможности удаления объектов. [#59495](https://github.com/ClickHouse/ClickHouse/pull/59495) ([Sema Checherinda](https://github.com/CheSema)).
* Не интерпретируйте числа с плавающей запятой в экспоненциальной нотации по умолчанию. Добавьте настройку `input_format_try_infer_exponent_floats`, которая восстановит предыдущее поведение (отключено по умолчанию). Закрывает [#59476](https://github.com/ClickHouse/ClickHouse/issues/59476). [#59500](https://github.com/ClickHouse/ClickHouse/pull/59500) ([Kruglov Pavel](https://github.com/Avogar)).
* Разрешите операции изменения окружить скобками. Эмиссия скобок может контролироваться конфигурацией `format_alter_operations_with_parentheses`. По умолчанию в отформатированных запросах скобки эмитируются, поскольку мы храним отформатированные операции изменения в некоторых местах как метаданные (например: мутации). Новый синтаксис уточняет некоторые запросы, где операции изменения заканчиваются в списке. Например: `ALTER TABLE x MODIFY TTL date GROUP BY a, b, DROP COLUMN c` не может быть правильно разобран с помощью старого синтаксиса. В новом синтаксисе запрос `ALTER TABLE x (MODIFY TTL date GROUP BY a, b), (DROP COLUMN c)` очевиден. Более старые версии не могут читать новый синтаксис, поэтому использование нового синтаксиса может вызвать проблемы, если новые и старые версии ClickHouse использованы в одном кластере. [#59532](https://github.com/ClickHouse/ClickHouse/pull/59532) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* Увеличена версия Intel QPL (используется кодеком `DEFLATE_QPL`) с v1.3.1 до v1.4.0. Также исправлена ошибка в механизме таймаута опроса, так как мы заметили, что в некоторых случаях таймаут не будет работать должным образом. Если таймаут происходит, IAA и CPU могут обрабатывать буфер одновременно. До настоящего времени нам стоит убедиться, что статус кодека IAA не QPL_STS_BEING_PROCESSED, затем откатиться на SW кодек. [#59551](https://github.com/ClickHouse/ClickHouse/pull/59551) ([jasperzhu](https://github.com/jinjunzh)).
* Добавьте позиционное чтение в libhdfs3. Если вы хотите вызвать позиционное чтение в libhdfs3, используйте функцию `hdfsPread` в hdfs.h следующим образом: `tSize hdfsPread(hdfsFS fs, hdfsFile file, void * buffer, tSize length, tOffset position);`. [#59624](https://github.com/ClickHouse/ClickHouse/pull/59624) ([M1eyu](https://github.com/M1eyu2018)).
* Проверьте на переполнение стека в парсерах, даже если пользователь неправильно настроил настройку `max_parser_depth` на очень высокое значение. Это закрывает [#59622](https://github.com/ClickHouse/ClickHouse/issues/59622). [#59697](https://github.com/ClickHouse/ClickHouse/pull/59697) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Упрощено поведение создания именованных коллекций в хранилище Kafka для xml и sql. [#59710](https://github.com/ClickHouse/ClickHouse/pull/59710) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* Разрешите uuid в `replica_path`, если `CREATE TABLE` явно его имеет. [#59908](https://github.com/ClickHouse/ClickHouse/pull/59908) ([Azat Khuzhin](https://github.com/azat)).
* Добавьте колонку `metadata_version` таблицы `ReplicatedMergeTree` в системной таблице `system.tables`. [#59942](https://github.com/ClickHouse/ClickHouse/pull/59942) ([Maksim Kita](https://github.com/kitaisreal)).
* Улучшение Keeper: добавьте попытки при сбоях для операций, связанных с диском. [#59980](https://github.com/ClickHouse/ClickHouse/pull/59980) ([Antonio Andelic](https://github.com/antonio2368)).
* Добавлен новый параметр конфигурации `backups.remove_backup_files_after_failure`: ``` <clickhouse> <backups> <remove_backup_files_after_failure>true</remove_backup_files_after_failure> </backups> </clickhouse> ```. [#60002](https://github.com/ClickHouse/ClickHouse/pull/60002) ([Vitaly Baranov](https://github.com/vitlibar)).
* Используйте несколько потоков при чтении метаданных таблиц из резервной копии во время выполнения команды RESTORE. [#60040](https://github.com/ClickHouse/ClickHouse/pull/60040) ([Vitaly Baranov](https://github.com/vitlibar)).
* Теперь, если `StorageBuffer` имеет более 1 шард (`num_layers` > 1), фоновая выгрузка будет происходить одновременно для всех шардов в нескольких потоках. [#60111](https://github.com/ClickHouse/ClickHouse/pull/60111) ([alesapin](https://github.com/alesapin)).
* Поддержка указания пользователей для конкретных настроек S3 в конфигурации с использованием ключа `user`. [#60144](https://github.com/ClickHouse/ClickHouse/pull/60144) ([Antonio Andelic](https://github.com/antonio2368)).
* Копирование файла S3 в GCP с запасным решением на случай, если GCP вернул `Internal Error` с кодом HTTP ошибки `GATEWAY_TIMEOUT`. [#60164](https://github.com/ClickHouse/ClickHouse/pull/60164) ([Maksim Kita](https://github.com/kitaisreal)).
* Разрешите "local" в качестве типа объектного хранения вместо "local_blob_storage". [#60165](https://github.com/ClickHouse/ClickHouse/pull/60165) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Реализовано оператор сравнения для значений Variant и правильное вставка Field в колонку Variant. Не позволяйте создавать тип `Variant` с похожими типами варианта по умолчанию (разрешено под настройкой `allow_suspicious_variant_types`). Закрывает [#59996](https://github.com/ClickHouse/ClickHouse/issues/59996). Закрывает [#59850](https://github.com/ClickHouse/ClickHouse/issues/59850). [#60198](https://github.com/ClickHouse/ClickHouse/pull/60198) ([Kruglov Pavel](https://github.com/Avogar)).
* Улучшена общая удобство использования виртуальных колонок. Теперь разрешено использовать виртуальные колонки в `PREWHERE` (это полезно для не-константных виртуальных колонок, таких как `_part_offset`). Теперь встроенная документация доступна для виртуальных колонок в виде комментариев к колонке в запросе `DESCRIBE` с включенной настройкой `describe_include_virtual_columns`. [#60205](https://github.com/ClickHouse/ClickHouse/pull/60205) ([Anton Popov](https://github.com/CurtizJ)).
* Краткое замыкание выполнения для `ULIDStringToDateTime`. [#60211](https://github.com/ClickHouse/ClickHouse/pull/60211) ([Juan Madurga](https://github.com/jlmadurga)).
* Добавлена колонка `query_id` для таблиц `system.backups` и `system.backup_log`. Добавлен стек вызовов ошибки в колонку `error`. [#60220](https://github.com/ClickHouse/ClickHouse/pull/60220) ([Maksim Kita](https://github.com/kitaisreal)).
* Параллельная выгрузка ожидающих блоков INSERT распределенного движка при `DETACH`/выключении сервера и `SYSTEM FLUSH DISTRIBUTED` (Параллелизм будет работать только если у вас есть много-дисковая политика для таблицы (как и все в распределенном движке сейчас)). [#60225](https://github.com/ClickHouse/ClickHouse/pull/60225) ([Azat Khuzhin](https://github.com/azat)).
* Настройка фильтра некорректна в `joinRightColumnsSwitchNullability`, разрешите [#59625](https://github.com/ClickHouse/ClickHouse/issues/59625). [#60259](https://github.com/ClickHouse/ClickHouse/pull/60259) ([lgbo](https://github.com/lgbo-ustc)).
* Добавьте настройку для принудительного чтения через кэш для слияний. [#60308](https://github.com/ClickHouse/ClickHouse/pull/60308) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Проблема [#57598](https://github.com/ClickHouse/ClickHouse/issues/57598) упоминает о варианте поведения в отношении обработки транзакций. Выполненный `COMMIT/ROLLBACK`, когда транзакция неактивна, сообщается как ошибка, в отличие от поведения MySQL. [#60338](https://github.com/ClickHouse/ClickHouse/pull/60338) ([PapaToemmsn](https://github.com/PapaToemmsn)).
* Добавлен режим `none_only_active` для настройки `distributed_ddl_output_mode`. [#60340](https://github.com/ClickHouse/ClickHouse/pull/60340) ([Alexander Tokmakov](https://github.com/tavplubix)).
* Соединения через порт MySQL теперь автоматически запускаются с настройкой `prefer_column_name_to_alias = 1`, чтобы поддерживать QuickSight "из коробки". Также настройки `mysql_map_string_to_text_in_show_columns` и `mysql_map_fixed_string_to_text_in_show_columns` теперь включены по умолчанию, также влияя только на соединения MySQL. Это повышает совместимость с большим количеством BI инструментов. [#60365](https://github.com/ClickHouse/ClickHouse/pull/60365) ([Robert Schulze](https://github.com/rschu1ze)).
* Когда формат вывода является форматом Pretty и блок состоит из единственного числового значения, превышающего один миллион, читаемое число будет распечатано справа от таблицы. например: ``` ┌──────count()─┐ │ 233765663884 │ -- 233.77 миллиарда └──────────────┘ ```. [#60379](https://github.com/ClickHouse/ClickHouse/pull/60379) ([rogeryk](https://github.com/rogeryk)).
* Разрешите настраивать обработчики HTTP перенаправления для `clickhouse-server`. Например, вы можете сделать так, чтобы `/` перенаправляло на интерфейс Play. [#60390](https://github.com/ClickHouse/ClickHouse/pull/60390) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Расширенная панель управления имеет немного лучшие цвета для многослойных графиков. [#60391](https://github.com/ClickHouse/ClickHouse/pull/60391) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлена гонка в коде JavaScript, ведущая к дублированию графиков один над другим. [#60392](https://github.com/ClickHouse/ClickHouse/pull/60392) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Проверьте на переполнение стека в парсерах, даже если пользователь неправильно настроил настройку `max_parser_depth` на очень высокое значение. Это закрывает [#59622](https://github.com/ClickHouse/ClickHouse/issues/59622). [#60434](https://github.com/ClickHouse/ClickHouse/pull/60434) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Функция `substring` теперь имеет новый псевдоним `byteSlice`. [#60494](https://github.com/ClickHouse/ClickHouse/pull/60494) ([Robert Schulze](https://github.com/rschu1ze)).
* Переименована настройка сервера `dns_cache_max_size` в `dns_cache_max_entries` для уменьшения неоднозначности. [#60500](https://github.com/ClickHouse/ClickHouse/pull/60500) ([Kirill Nikiforov](https://github.com/allmazz)).
* `SHOW INDEX | INDEXES | INDICES | KEYS` больше не сортирует по колонкам первичного ключа (что было неинтуитивно). [#60514](https://github.com/ClickHouse/ClickHouse/pull/60514) ([Robert Schulze](https://github.com/rschu1ze)).
* Улучшение Keeper: прерывание во время запуска, если обнаружен неверный снимок, чтобы избежать потери данных. [#60537](https://github.com/ClickHouse/ClickHouse/pull/60537) ([Antonio Andelic](https://github.com/antonio2368)).
* Добавлено чтение разбиения MergeTree на пересекающиеся и не пересекающиеся инъекции сбоев с помощью настройки `merge_tree_read_split_ranges_into_intersecting_and_non_intersecting_fault_probability`. [#60548](https://github.com/ClickHouse/ClickHouse/pull/60548) ([Maksim Kita](https://github.com/kitaisreal)).
* Расширенная панель управления теперь имеет элементы управления, всегда видимые при прокрутке. Это позволяет добавлять новый график, не прокручивая вверх. [#60692](https://github.com/ClickHouse/ClickHouse/pull/60692) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Типы строк и Enums могут использоваться в одном контексте, например: массивы, запросы UNION, условные выражения. Это закрывает [#60726](https://github.com/ClickHouse/ClickHouse/issues/60726). [#60727](https://github.com/ClickHouse/ClickHouse/pull/60727) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Обновлена tzdata до 2024a. [#60768](https://github.com/ClickHouse/ClickHouse/pull/60768) ([Raúl Marín](https://github.com/Algunenano)).
* Поддержка файлов без расширения формата в файловой базе данных. [#60795](https://github.com/ClickHouse/ClickHouse/pull/60795) ([Kruglov Pavel](https://github.com/Avogar)).
* Улучшение Keeper: поддержка `leadership_expiry_ms` в настройках Keeper. [#60806](https://github.com/ClickHouse/ClickHouse/pull/60806) ([Brokenice0415](https://github.com/Brokenice0415)).
* Всегда интерпретируйте экспоненциальные числа в форматах JSON независимо от настройки `input_format_try_infer_exponent_floats`. Добавьте настройку `input_format_json_use_string_type_for_ambiguous_paths_in_named_tuples_inference_from_objects`, которая позволяет использовать строковый тип для неоднозначных путей вместо исключения во время вывода кортежей из JSON объектов. [#60808](https://github.com/ClickHouse/ClickHouse/pull/60808) ([Kruglov Pavel](https://github.com/Avogar)).
* Добавьте флаг для SMJ, чтобы считать null самым большим/маленьким. Таким образом, поведение может быть совместимо с другими SQL системами, как Apache Spark. [#60896](https://github.com/ClickHouse/ClickHouse/pull/60896) ([loudongfeng](https://github.com/loudongfeng)).
* Версия Clickhouse была добавлена в метаданные docker. Закрывает [#54224](https://github.com/ClickHouse/ClickHouse/issues/54224). [#60949](https://github.com/ClickHouse/ClickHouse/pull/60949) ([Nikolay Monkov](https://github.com/nikmonkov)).
* Добавлена настройка `parallel_replicas_allow_in_with_subquery = 1`, которая разрешает подзапросы для IN работать с параллельными репликами. [#60950](https://github.com/ClickHouse/ClickHouse/pull/60950) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* DNSResolver перемешивает набор разрешенных IP-адресов. [#60965](https://github.com/ClickHouse/ClickHouse/pull/60965) ([Sema Checherinda](https://github.com/CheSema)).
* Поддержка определения формата вывода по расширению файла в `clickhouse-client` и `clickhouse-local`. [#61036](https://github.com/ClickHouse/ClickHouse/pull/61036) ([豪肥肥](https://github.com/HowePa)).
* Периодически проверяйте обновление лимита памяти. [#61049](https://github.com/ClickHouse/ClickHouse/pull/61049) ([Han Fei](https://github.com/hanfei1991)).
* Включить профилирование процессоров (время, затраченное на общие и выходные байты для сортировки, агрегации и т.д.) по умолчанию. [#61096](https://github.com/ClickHouse/ClickHouse/pull/61096) ([Azat Khuzhin](https://github.com/azat)).
* Добавьте функцию `toUInt128OrZero`, которая была пропущена по ошибке (ошибка связана с https://github.com/ClickHouse/ClickHouse/pull/945). Совместимые псевдонимы `FROM_UNIXTIME` и `DATE_FORMAT` (они не являются родными для ClickHouse и существуют только для совместимости с MySQL) были сделаны нечувствительными к регистру, как и ожидается для псевдонимов SQL. [#61114](https://github.com/ClickHouse/ClickHouse/pull/61114) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Улучшения проверок доступа, позволяющие аннулировать неполученные права, если целевой пользователь также не имеет аннулирующих прав. Пример: ```sql GRANT SELECT ON *.* TO user1; REVOKE SELECT ON system.* FROM user1;. [#61115](https://github.com/ClickHouse/ClickHouse/pull/61115) ([pufit](https://github.com/pufit)).
* Исправлена ошибка в предыдущей оптимизации: https://github.com/ClickHouse/ClickHouse/pull/59698: убраны break, чтобы убедиться, что первая отфильтрованная колонка имеет минимальный размер cc @jsc0218. [#61145](https://github.com/ClickHouse/ClickHouse/pull/61145) ([李扬](https://github.com/taiyang-li)).
* Исправлена функция `has()` с колонкой `Nullable` (исправляет [#60214](https://github.com/ClickHouse/ClickHouse/issues/60214)). [#61249](https://github.com/ClickHouse/ClickHouse/pull/61249) ([Mikhail Koviazin](https://github.com/mkmkme)).
* Теперь можно указать атрибут `merge="true"` в замещениях конфигурации для поддеревьев `<include from_zk="/path" merge="true">`. Если этот атрибут указан, ClickHouse объединит поддерево с существующей конфигурацией, в противном случае поведение по умолчанию — добавление нового содержимого к конфигурации. [#61299](https://github.com/ClickHouse/ClickHouse/pull/61299) ([alesapin](https://github.com/alesapin)).
* Добавьте асинхронные метрики для отображения виртуальной памяти: VMMaxMapCount и VMNumMaps. Закрывает [#60662](https://github.com/ClickHouse/ClickHouse/issues/60662). [#61354](https://github.com/ClickHouse/ClickHouse/pull/61354) ([Tuan Pham Anh](https://github.com/tuanpavn)).
* Используйте настройку `temporary_files_codec` во всех местах, где мы создаем временные данные, например, внешней сортировке в памяти и внешней группировке в памяти. Ранее это работало только в алгоритме JOIN `partial_merge`. [#61456](https://github.com/ClickHouse/ClickHouse/pull/61456) ([Maksim Kita](https://github.com/kitaisreal)).
* Удалите дублирующую проверку `containing_part.empty()`, она уже проверяется здесь: https://github.com/ClickHouse/ClickHouse/blob/1296dac3c7e47670872c15e3f5e58f869e0bd2f2/src/Storages/MergeTree/MergeTreeData.cpp#L6141. [#61467](https://github.com/ClickHouse/ClickHouse/pull/61467) ([William Schoeffel](https://github.com/wiledusc)).
* Добавьте новую настройку `max_parser_backtracks`, которая позволяет ограничить сложность парсинга запросов. [#61502](https://github.com/ClickHouse/ClickHouse/pull/61502) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Меньше конфликтов во время динамического изменения размера кэша файловой системы. [#61524](https://github.com/ClickHouse/ClickHouse/pull/61524) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Запрещен шардированный режим очереди StorageS3, так как он будет переписан. [#61537](https://github.com/ClickHouse/ClickHouse/pull/61537) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Исправлена ошибка: с `use_leagcy_max_level` на `use_legacy_max_level`. [#61545](https://github.com/ClickHouse/ClickHouse/pull/61545) ([William Schoeffel](https://github.com/wiledusc)).
* Удалены некоторые дублирующие записи в `blob_storage_log`. [#61622](https://github.com/ClickHouse/ClickHouse/pull/61622) ([YenchangChan](https://github.com/YenchangChan)).
* Добавлена функция `current_user` как псевдоним совместимости для MySQL. [#61770](https://github.com/ClickHouse/ClickHouse/pull/61770) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Используйте управляемую идентификацию для ввода-вывода резервных копий при использовании Azure Blob Storage. Добавьте настройку, чтобы предотвратить ClickHouse от попытки создать несуществующий контейнер, для чего требуются права на уровне учетной записи хранения. [#61785](https://github.com/ClickHouse/ClickHouse/pull/61785) ([Daniel Pozo Escalona](https://github.com/danipozo)).
* В предыдущей версии некоторые числа в форматов Pretty не были достаточно красивыми. [#61794](https://github.com/ClickHouse/ClickHouse/pull/61794) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Долгое значение в форматах Pretty не будет обрезано, если оно является единственным значением в результирующем наборе, например, в результате запроса `SHOW CREATE TABLE`. [#61795](https://github.com/ClickHouse/ClickHouse/pull/61795) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Аналогично `clickhouse-local`, `clickhouse-client` примет опцию `--output-format` как синоним к опции `--format`. Это закрывает [#59848](https://github.com/ClickHouse/ClickHouse/issues/59848). [#61797](https://github.com/ClickHouse/ClickHouse/pull/61797) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Если стандартный вывод — это терминал, и формат вывода не задан, `clickhouse-client` и аналогичные инструменты будут использовать `PrettyCompact` по умолчанию, аналогично интерактивному режиму. `clickhouse-client` и `clickhouse-local` будут обрабатывать аргументы командной строки для входных и выходных форматов в едином формате. Это закрывает [#61272](https://github.com/ClickHouse/ClickHouse/issues/61272). [#61800](https://github.com/ClickHouse/ClickHouse/pull/61800) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Группы цифр с подчеркиванием в форматах Pretty для лучшей читаемости. Это контролируется новой настройкой `output_format_pretty_highlight_digit_groups`. [#61802](https://github.com/ClickHouse/ClickHouse/pull/61802) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
```
#### Исправление ошибок (видимое поведение пользователя в официальном стабильном релизе) {#bug-fix-user-visible-misbehavior-in-an-official-stable-release}

* Исправлена ошибка с `intDiv` для десятичных аргументов [#59243](https://github.com/ClickHouse/ClickHouse/pull/59243) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Исправлено_kql_проблема_обнаруженная_wingfuzz [#59626](https://github.com/ClickHouse/ClickHouse/pull/59626) ([Yong Wang](https://github.com/kashwy)).
* Исправлена ошибка "Чтение за последним смещением" для AsynchronousBoundedReadBuffer [#59630](https://github.com/ClickHouse/ClickHouse/pull/59630) ([Vitaly Baranov](https://github.com/vitlibar)).
* rabbitmq: исправлено отсутствие подтвержденных и неподтвержденных сообщений [#59775](https://github.com/ClickHouse/ClickHouse/pull/59775) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Исправлено выполнение функции над const и LowCardinality с GROUP BY const для анализатора [#59986](https://github.com/ClickHouse/ClickHouse/pull/59986) ([Azat Khuzhin](https://github.com/azat)).
* Исправлено преобразование масштаба для DateTime64 [#60004](https://github.com/ClickHouse/ClickHouse/pull/60004) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Исправлено INSERT в SQLite с одинарной кавычкой (путем экранирования одинарных кавычек кавычкой вместо обратной косой черты) [#60015](https://github.com/ClickHouse/ClickHouse/pull/60015) ([Azat Khuzhin](https://github.com/azat)).
* Исправлено optimize_uniq_to_count, удаляющее псевдоним колонки [#60026](https://github.com/ClickHouse/ClickHouse/pull/60026) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлено finished_mutations_to_keep=0 для MergeTree (как говорится в документации, 0 сохраняет всё) [#60031](https://github.com/ClickHouse/ClickHouse/pull/60031) ([Azat Khuzhin](https://github.com/azat)).
* Исправлена возможная ошибка из таблицы s3queue при удалении [#60036](https://github.com/ClickHouse/ClickHouse/pull/60036) ([Kseniia Sumarokova](https://github.com/kssenii)).
* PartsSplitter недействительные диапазоны для одной и той же части [#60041](https://github.com/ClickHouse/ClickHouse/pull/60041) ([Maksim Kita](https://github.com/kitaisreal)).
* Использовать max_query_size из контекста в DDLLogEntry вместо закодированного 4096 [#60083](https://github.com/ClickHouse/ClickHouse/pull/60083) ([Kruglov Pavel](https://github.com/Avogar)).
* Исправлено несоответствующее форматирование запросов [#60095](https://github.com/ClickHouse/ClickHouse/pull/60095) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлено несоответствующее форматирование explain в подзапросах [#60102](https://github.com/ClickHouse/ClickHouse/pull/60102) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлена ошибка в cosineDistance с Nullable [#60150](https://github.com/ClickHouse/ClickHouse/pull/60150) ([Raúl Marín](https://github.com/Algunenano)).
* Разрешить приведение bool в строковом представлении к истинным bool [#60160](https://github.com/ClickHouse/ClickHouse/pull/60160) ([Robert Schulze](https://github.com/rschu1ze)).
* Исправлено system.s3queue_log [#60166](https://github.com/ClickHouse/ClickHouse/pull/60166) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Исправлено arrayReduce с именем агрегатной функции nullable [#60188](https://github.com/ClickHouse/ClickHouse/pull/60188) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлено выполнение действий во время предварительной фильтрации (PK, обрезка партиций) [#60196](https://github.com/ClickHouse/ClickHouse/pull/60196) ([Azat Khuzhin](https://github.com/azat)).
* Скрыть конфиденциальную информацию для s3queue [#60233](https://github.com/ClickHouse/ClickHouse/pull/60233) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Отменить "Заменить `ORDER BY ALL` на `ORDER BY *`" [#60248](https://github.com/ClickHouse/ClickHouse/pull/60248) ([Robert Schulze](https://github.com/rschu1ze)).
* Azure Blob Storage: Исправлены проблемы с конечной точкой и префиксом [#60251](https://github.com/ClickHouse/ClickHouse/pull/60251) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* Исправлены коды исключений http. [#60252](https://github.com/ClickHouse/ClickHouse/pull/60252) ([Austin Kothig](https://github.com/kothiga)).
* Исправлена ошибка кэша LRUResource (кэш Hive) [#60262](https://github.com/ClickHouse/ClickHouse/pull/60262) ([shanfengp](https://github.com/Aed-p)).
* s3queue: исправлена ошибка (также исправляет ненадежный тест_storage_s3_queue/test.py::test_shards_distributed) [#60282](https://github.com/ClickHouse/ClickHouse/pull/60282) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Исправлено использование неинициализированного значения и недействительный результат в хеширующих функциях с IPv6 [#60359](https://github.com/ClickHouse/ClickHouse/pull/60359) ([Kruglov Pavel](https://github.com/Avogar)).
* Принудительная переанализирование, если изменились параллельные реплики [#60362](https://github.com/ClickHouse/ClickHouse/pull/60362) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлено использование простого типа метаданных с новой опцией конфигурации дисков [#60396](https://github.com/ClickHouse/ClickHouse/pull/60396) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Не разрешить устанавливать max_parallel_replicas в 0, так как это не имеет смысла [#60430](https://github.com/ClickHouse/ClickHouse/pull/60430) ([Kruglov Pavel](https://github.com/Avogar)).
* Попробуйте исправить логическую ошибку 'Невозможно захватить колонку, так как она имеет несовместимый тип' в mapContainsKeyLike [#60451](https://github.com/ClickHouse/ClickHouse/pull/60451) ([Kruglov Pavel](https://github.com/Avogar)).
* Исправлено OptimizeDateOrDateTimeConverterWithPreimageVisitor с null аргументами [#60453](https://github.com/ClickHouse/ClickHouse/pull/60453) ([Raúl Marín](https://github.com/Algunenano)).
* Попробуйте избежать вычисления скалярных подзапросов для CREATE TABLE. [#60464](https://github.com/ClickHouse/ClickHouse/pull/60464) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* Слияние [#59674](https://github.com/ClickHouse/ClickHouse/issues/59674). [#60470](https://github.com/ClickHouse/ClickHouse/pull/60470) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Правильная проверка ключей в s3Cluster [#60477](https://github.com/ClickHouse/ClickHouse/pull/60477) ([Antonio Andelic](https://github.com/antonio2368)).
* Исправлена взаимная блокировка в параллельном разборе, когда пропускается много строк из-за ошибок [#60516](https://github.com/ClickHouse/ClickHouse/pull/60516) ([Kruglov Pavel](https://github.com/Avogar)).
* Исправление_max_query_size_for_kql_compound_operator: [#60534](https://github.com/ClickHouse/ClickHouse/pull/60534) ([Yong Wang](https://github.com/kashwy)).
* Исправление Keeper: добавьте таймауты при ожидании журналов подтверждения [#60544](https://github.com/ClickHouse/ClickHouse/pull/60544) ([Antonio Andelic](https://github.com/antonio2368)).
* Уменьшите количество считываемых строк из `system.numbers` [#60546](https://github.com/ClickHouse/ClickHouse/pull/60546) ([JackyWoo](https://github.com/JackyWoo)).
* Не выводите подсказки чисел для типов даты [#60577](https://github.com/ClickHouse/ClickHouse/pull/60577) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлено чтение из MergeTree с недетерминированными функциями в фильтре [#60586](https://github.com/ClickHouse/ClickHouse/pull/60586) ([Kruglov Pavel](https://github.com/Avogar)).
* Исправлена логическая ошибка по неправильному типу значения настройки совместимости [#60596](https://github.com/ClickHouse/ClickHouse/pull/60596) ([Kruglov Pavel](https://github.com/Avogar)).
* Исправлено несоответствие состояний агрегатных функций в смешанных кластерах x86-64 / ARM [#60610](https://github.com/ClickHouse/ClickHouse/pull/60610) ([Harry Lee](https://github.com/HarryLeeIBM)).
* исправление(prql): надежный обработчик паники [#60615](https://github.com/ClickHouse/ClickHouse/pull/60615) ([Maximilian Roos](https://github.com/max-sixty)).
* Исправлено `intDiv` для целых и даты аргументов [#60672](https://github.com/ClickHouse/ClickHouse/pull/60672) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Исправлено: расширить CTE в alter modify запросе [#60682](https://github.com/ClickHouse/ClickHouse/pull/60682) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* Исправлено system.parts для не Atomic/Ordinary систем баз данных (т.е. Memory) [#60689](https://github.com/ClickHouse/ClickHouse/pull/60689) ([Azat Khuzhin](https://github.com/azat)).
* Исправлено "Недействительное определение хранилища в файле метаданных" для параметризованных представлений [#60708](https://github.com/ClickHouse/ClickHouse/pull/60708) ([Azat Khuzhin](https://github.com/azat)).
* Исправлен переполнение буфера в CompressionCodecMultiple [#60731](https://github.com/ClickHouse/ClickHouse/pull/60731) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Удалены бессмыслицы из SQL/JSON [#60738](https://github.com/ClickHouse/ClickHouse/pull/60738) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Удалена неправильная проверка очистки в агрегатной функции quantileGK [#60740](https://github.com/ClickHouse/ClickHouse/pull/60740) ([李扬](https://github.com/taiyang-li)).
* Исправлена ошибка insert-select + insert_deduplication_token, установив потоки равными 1 [#60745](https://github.com/ClickHouse/ClickHouse/pull/60745) ([Jordi Villar](https://github.com/jrdi)).
* Запретить установку пользовательских заголовков метаданных для неподдерживаемых операций загрузки нескольких частей [#60748](https://github.com/ClickHouse/ClickHouse/pull/60748) ([Francisco J. Jurado Moreno](https://github.com/Beetelbrox)).
* Исправлено toStartOfInterval [#60763](https://github.com/ClickHouse/ClickHouse/pull/60763) ([Andrey Zvonov](https://github.com/zvonand)).
* Исправлен сбой в arrayEnumerateRanked [#60764](https://github.com/ClickHouse/ClickHouse/pull/60764) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлен сбой при использовании input() в INSERT SELECT JOIN [#60765](https://github.com/ClickHouse/ClickHouse/pull/60765) ([Kruglov Pavel](https://github.com/Avogar)).
* Исправлен сбой с различным значением allow_experimental_analyzer в подзапросах [#60770](https://github.com/ClickHouse/ClickHouse/pull/60770) ([Dmitry Novik](https://github.com/novikd)).
* Удалена рекурсия при чтении из S3 [#60849](https://github.com/ClickHouse/ClickHouse/pull/60849) ([Antonio Andelic](https://github.com/antonio2368)).
* Исправлена возможная зависание на ошибке в HashedDictionaryParallelLoader [#60926](https://github.com/ClickHouse/ClickHouse/pull/60926) ([vdimir](https://github.com/vdimir)).
* Исправлено асинхронное RESTORE с реплицированной базе данных [#60934](https://github.com/ClickHouse/ClickHouse/pull/60934) ([Antonio Andelic](https://github.com/antonio2368)).
* Исправлена взаимная блокировка в асинхронных вставках в таблицы `Log` через нативный протокол [#61055](https://github.com/ClickHouse/ClickHouse/pull/61055) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлено ленивое выполнение аргумента по умолчанию в dictGetOrDefault для RangeHashedDictionary [#61196](https://github.com/ClickHouse/ClickHouse/pull/61196) ([Kruglov Pavel](https://github.com/Avogar)).
* Исправлено несколько ошибок в groupArraySorted [#61203](https://github.com/ClickHouse/ClickHouse/pull/61203) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлено переопределение Keeper для самостоятельного двоичного файла [#61233](https://github.com/ClickHouse/ClickHouse/pull/61233) ([Antonio Andelic](https://github.com/antonio2368)).
* Исправлено использование session_token в S3 engine [#61234](https://github.com/ClickHouse/ClickHouse/pull/61234) ([Kruglov Pavel](https://github.com/Avogar)).
* Исправлен возможный неправильный результат агрегатной функции `uniqExact` [#61257](https://github.com/ClickHouse/ClickHouse/pull/61257) ([Anton Popov](https://github.com/CurtizJ)).
* Исправлены ошибки в show database [#61269](https://github.com/ClickHouse/ClickHouse/pull/61269) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлена логическая ошибка в RabbitMQ storage с MATERIALIZED колонками [#61320](https://github.com/ClickHouse/ClickHouse/pull/61320) ([vdimir](https://github.com/vdimir)).
* Исправлено CREATE OR REPLACE DICTIONARY [#61356](https://github.com/ClickHouse/ClickHouse/pull/61356) ([Vitaly Baranov](https://github.com/vitlibar)).
* Исправлен запрос ATTACH с внешним ON CLUSTER [#61365](https://github.com/ClickHouse/ClickHouse/pull/61365) ([Nikolay Degterinsky](https://github.com/evillique)).
* исправлена проблема разбиения DAG действий [#61458](https://github.com/ClickHouse/ClickHouse/pull/61458) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлено завершение неудачного RESTORE [#61466](https://github.com/ClickHouse/ClickHouse/pull/61466) ([Vitaly Baranov](https://github.com/vitlibar)).
* Правильно отключить async_insert_use_adaptive_busy_timeout с настройками совместимости [#61468](https://github.com/ClickHouse/ClickHouse/pull/61468) ([Raúl Marín](https://github.com/Algunenano)).
* Разрешить установку в пуле восстановления [#61475](https://github.com/ClickHouse/ClickHouse/pull/61475) ([Nikita Taranov](https://github.com/nickitat)).
* Исправлена ошибка при чтении system.parts с использованием UUID (проблема 61220). [#61479](https://github.com/ClickHouse/ClickHouse/pull/61479) ([Dan Wu](https://github.com/wudanzy)).
* Исправлен сбой в представлении окна [#61526](https://github.com/ClickHouse/ClickHouse/pull/61526) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Исправлено `repeat` с ненативными целыми числами [#61527](https://github.com/ClickHouse/ClickHouse/pull/61527) ([Antonio Andelic](https://github.com/antonio2368)).
* Исправлен клиентский аргумент `-s` [#61530](https://github.com/ClickHouse/ClickHouse/pull/61530) ([Mikhail f. Shiryaev](https://github.com/Felixoid)).
* Исправлен сбой в arrayPartialReverseSort [#61539](https://github.com/ClickHouse/ClickHouse/pull/61539) ([Raúl Marín](https://github.com/Algunenano)).
* Исправлен поиск строки с фиксированной позицией [#61547](https://github.com/ClickHouse/ClickHouse/pull/61547) ([Antonio Andelic](https://github.com/antonio2368)).
* Исправлено использование addDays, вызывающее ошибку при использовании datetime64 [#61561](https://github.com/ClickHouse/ClickHouse/pull/61561) ([Shuai li](https://github.com/loneylee)).
* Исправлено `system.part_log` для асинхронной вставки с дедупликацией [#61620](https://github.com/ClickHouse/ClickHouse/pull/61620) ([Antonio Andelic](https://github.com/antonio2368)).
* Исправлено состояние "Не готово" для system.parts. [#61666](https://github.com/ClickHouse/ClickHouse/pull/61666) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
