import mysql_1 from '@site/static/images/_snippets/mysql1.png';
import mysql_2 from '@site/static/images/_snippets/mysql2.png';
import mysql_3 from '@site/static/images/_snippets/mysql3.png';
import mysql_4 from '@site/static/images/_snippets/mysql4.png';
import mysql_5 from '@site/static/images/_snippets/mysql5.png';
import Image from '@theme/IdealImage';
import {VerticalStepper} from "@clickhouse/click-ui/bundled";

<VerticalStepper headerLevel="h4">

#### Выберите `Подключить ваше приложение` {#select-connect-your-app}

После создания вашего сервиса ClickHouse Cloud, на экране `Подключить ваше приложение`, выберите MySQL из выпадающего меню.

<Image size="lg" img={mysql_1} alt="Экран учетных данных ClickHouse Cloud, показывающий выпадающий список выбора интерфейса MySQL" border />

#### Включите MySQL интерфейс {#enable-mysql-interface}

Переключите переключатель, чтобы включить MySQL интерфейс для этого конкретного сервиса.
Это откроет порт `3306` для этого сервиса и предложит вам экран подключения MySQL, который включает ваше уникальное имя пользователя MySQL.

<Image size="lg" img={mysql_2} alt="Переключатель включения MySQL интерфейса ClickHouse Cloud и детали подключения" border />

В качестве альтернативы, чтобы включить MySQL интерфейс для существующего сервиса:

#### Выберите `Подключить` {#select-connect}

Убедитесь, что ваш сервис находится в состоянии `Работает`, затем нажмите на сервис, для которого хотите включить MySQL интерфейс.
Выберите "Подключить" в левом меню:

<Image size="lg" img={mysql_3} alt="Экран подключения сервиса ClickHouse Cloud с выделенным вариантом Подключить" border />

#### Выберите `MySQL` {#choose-mysql}

Выберите `MySQL` из выпадающего меню `Подключиться с`.

<Image size="md" img={mysql_4} alt="Экран подключения ClickHouse Cloud, показывающий выбор опции MySQL" border />

#### Включите MySQL интерфейс {#enable-mysql-interface}

Переключите переключатель, чтобы включить MySQL интерфейс для этого конкретного сервиса.
Это откроет порт `3306` для этого сервиса и предложит вам экран подключения MySQL, который включает ваше уникальное имя пользователя MySQL.

</VerticalStepper>

<Image size="md" img={mysql_5} alt="Экран подключения ClickHouse Cloud с включенным MySQL интерфейсом и показанными деталями подключения" border />

## Создание учетной записи MySQL только для чтения в ClickHouse Cloud {#creating-multiple-mysql-users-in-clickhouse-cloud}

ClickHouse Cloud автоматически создает пользователя `mysql4<subdomain>`, который имеет тот же пароль, что и пользователь по умолчанию.
Часть `<subdomain>` соответствует первой части вашего имени хоста ClickHouse Cloud.

Этот формат имени пользователя необходим для совместимости с инструментами, которые устанавливают безопасные соединения, но не включают данные [SNI (Server Name Indication)](https://www.cloudflare.com/learning/ssl/what-is-sni) в своём TLS рукопожатии.
Без информации SNI система не может выполнять надлежащую внутреннюю маршрутизацию, поэтому подсказка субдомена, встроенная в имя пользователя, предоставляет необходимую информацию для маршрутизации.
Клиентская консоль MySQL является примером инструмента, который требует этого.

:::tip
Рекомендуется создать нового пользователя MySQL только для чтения.
:::

:::note
Для имени хоста ClickHouse Cloud, например, `foobar.us-east1.aws.clickhouse.cloud`, часть `<subdomain>` равна `foobar`, и имя кастомного пользователя MySQL может выглядеть как `mysql4foobar_team1`.
:::

<VerticalStepper headerLevel="h4">

#### Создайте профиль настроек только для чтения {#create-a-custom-settings-user}

Создайте [профиль настроек](/sql-reference/statements/create/settings-profile), который будет применяться к вашему пользователю только для чтения, установив настройку `readonly` в `1`:

```sql
CREATE SETTINGS PROFILE readonly_profile SETTINGS readonly = 1
```

#### Создайте нового пользователя MySQL только для чтения {#create-a-readonly-mysql-user}

[Создайте пользователя](/sql-reference/statements/create/user) с именем в следующем формате:

```sql
mysql4<subdomain>_<username>
```

Примените профиль `readonly_profile` к новому пользователю и убедитесь, что пароль имеет двойной формат SHA1. Например:

```sql
CREATE USER mysql4foobar_readonly
IDENTIFIED WITH double_sha1_password BY 'YourPassword42$'
SETTINGS PROFILE 'readonly_profile';
```

#### Предоставьте новому пользователю разрешения на доступ к необходимым таблицам {#grant-the-new-user-the-necessary-permissions}

[Предоставьте](/sql-reference/statements/grant) новому пользователю необходимые разрешения для взаимодействия с желаемыми таблицами или базами данных.
Например, если вы хотите предоставить доступ только к `system.query_log`:

```sql
GRANT SELECT ON system.query_log TO mysql4foobar_readonly;
```

:::note
Для пользователя только для чтения убедитесь, что вы предоставляете только разрешения `SELECT` для таблиц, к которым хотите получить доступ.
:::

Новосозданный пользователь может быть использован для подключения к вашему сервису ClickHouse Cloud с MySQL интерфейсом.

</VerticalStepper>

### Устранение неполадок с несколькими пользователями MySQL в ClickHouse Cloud {#troubleshooting-multiple-mysql-users-in-clickhouse-cloud}

Если вы создали нового пользователя MySQL и видите следующую ошибку при подключении через MySQL CLI клиент:

```
ERROR 2013 (HY000): Lost connection to MySQL server at 'reading authorization packet', system error: 54
```

В этом случае убедитесь, что имя пользователя следует формату `mysql4<subdomain>_<username>`, как описано ([выше](#creating-multiple-mysql-users-in-clickhouse-cloud)).