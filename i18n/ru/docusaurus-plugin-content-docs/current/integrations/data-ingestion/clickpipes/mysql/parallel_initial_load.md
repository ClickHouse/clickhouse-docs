---
'title': 'Параллельный снимок в MySQL ClickPipe'
'description': 'Документация для объяснения параллельного снимка в MySQL ClickPipe'
'slug': '/integrations/clickpipes/mysql/parallel_initial_load'
'sidebar_label': 'Как работает параллельный снимок'
'doc_type': 'guide'
---
import snapshot_params from '@site/static/images/integrations/data-ingestion/clickpipes/mysql/snapshot_params.png'
import partition_key from '@site/static/images/integrations/data-ingestion/clickpipes/mysql/partition_key.png'
import Image from '@theme/IdealImage';

Этот документ объясняет параллелизацию снимка/начальной загрузки в MySQL ClickPipe и обсуждает параметры снимка, которые можно использовать для его управления.

## Обзор {#overview-mysql-snapshot}

Начальная загрузка — это первая фаза CDC ClickPipe, где ClickPipe синхронизирует исторические данные таблиц из исходной базы данных в ClickHouse, прежде чем начать CDC. В большинстве случаев разработчики делают это в однопоточном режиме. Тем не менее, MySQL ClickPipe может параллелизировать этот процесс, что может значительно ускорить начальную загрузку.

### Колонка ключа партиции {#key-mysql-snapshot}

После активации флага функции вы должны увидеть следующую настройку в выборщике таблиц ClickPipe (как при создании, так и при редактировании ClickPipe):
<Image img={partition_key} alt="Колонка ключа партиции" size="md"/>

MySQL ClickPipe использует колонку вашей исходной таблицы для логического разделения исходных таблиц на партиции. Эта колонка называется **колонка ключа партиции**. Она используется для деления исходной таблицы на партиции, которые затем могут обрабатываться параллельно ClickPipe.

:::warning
Колонка ключа партиции должна быть индексирована в исходной таблице, чтобы обеспечить хороший прирост производительности. Это можно проверить, выполнив команду `SHOW INDEX FROM <table_name>` в MySQL.
:::

### Логическое партиционирование {#logical-partitioning-mysql-snapshot}

Давайте поговорим о следующих настройках:

<Image img={snapshot_params} alt="Параметры снимка" size="md"/>

#### Количество строк снимка на партицию {#numrows-mysql-snapshot}
Эта настройка управляет тем, сколько строк составляет партицию. ClickPipe будет читать исходную таблицу кусками такого размера, и куски обрабатываются параллельно на основе установленного уровня параллелизации начальной загрузки. Значение по умолчанию — 100,000 строк на партицию.

#### Параллелизация начальной загрузки {#parallelism-mysql-snapshot}
Эта настройка управляет тем, сколько партиций обрабатывается параллельно. Значение по умолчанию — 4, что означает, что ClickPipe будет читать 4 партиции исходной таблицы параллельно. Это число можно увеличить, чтобы ускорить начальную загрузку, но рекомендуется оставлять его на разумном уровне в зависимости от характеристик вашего исходного экземпляра, чтобы избежать перегрузки исходной базы данных. ClickPipe автоматически настроит количество партиций на основе размера исходной таблицы и количества строк на партицию.

#### Количество таблиц в параллельном режиме {#tables-parallel-mysql-snapshot}
Эта настройка не совсем связана с параллельным снимком, но управляет тем, сколько таблиц обрабатывается параллельно во время начальной загрузки. Значение по умолчанию — 1. Обратите внимание, что это выше уровня параллелизации партиций, поэтому если у вас 4 партиции и 2 таблицы, ClickPipe будет читать 8 партиций параллельно.

### Мониторинг параллельного снимка в MySQL {#monitoring-parallel-mysql-snapshot}
Вы можете выполнить команду **SHOW processlist** в MySQL, чтобы увидеть параллельный снимок в действии. ClickPipe создаст несколько подключений к исходной базе данных, каждое из которых будет читать другую партицию исходной таблицы. Если вы видите **SELECT** запросы с различными диапазонами, это означает, что ClickPipe читает исходные таблицы. Вы также можете увидеть COUNT(*) и запрос на партиционирование здесь.

### Ограничения {#limitations-parallel-mysql-snapshot}
- Параметры снимка не могут быть изменены после создания канала. Если вы хотите их изменить, вам придется создать новый ClickPipe.
- При добавлении таблиц в существующий ClickPipe вы не можете изменить параметры снимка. ClickPipe будет использовать существующие параметры для новых таблиц.
- Колонка ключа партиции не должна содержать `NULL`, так как они будут пропускаться логикой партиционирования.