---
title: 'Параллельный снимок в MySQL ClickPipe'
description: 'Документация, объясняющая работу параллельного снимка в MySQL ClickPipe'
slug: /integrations/clickpipes/mysql/parallel_initial_load
sidebar_label: 'Как работает параллельный снимок'
doc_type: 'guide'
keywords: ['clickpipes', 'mysql', 'cdc', 'data ingestion', 'real-time sync']
---

import snapshot_params from '@site/static/images/integrations/data-ingestion/clickpipes/mysql/snapshot_params.png'
import partition_key from '@site/static/images/integrations/data-ingestion/clickpipes/mysql/partition_key.png'
import Image from '@theme/IdealImage';

В этом документе объясняется, как работает параллельная начальная загрузка (snapshot) в MySQL ClickPipe, а также описываются параметры snapshot, с помощью которых можно её настраивать.


## Обзор {#overview-mysql-snapshot}

Начальная загрузка — это первая фаза CDC ClickPipe, во время которой ClickPipe синхронизирует исторические данные таблиц из исходной базы данных в ClickHouse перед запуском CDC. Часто разработчики выполняют это в однопоточном режиме.
Однако MySQL ClickPipe может распараллелить этот процесс, что значительно ускоряет начальную загрузку.

### Колонка ключа партиционирования {#key-mysql-snapshot}

После включения флага функции вы увидите следующую настройку в селекторе таблиц ClickPipe (как при создании, так и при редактировании ClickPipe):

<Image img={partition_key} alt='Колонка ключа партиционирования' size='md' />

MySQL ClickPipe использует колонку исходной таблицы для логического партиционирования исходных таблиц. Эта колонка называется **колонкой ключа партиционирования**. Она используется для разделения исходной таблицы на партиции, которые затем могут обрабатываться параллельно в ClickPipe.

:::warning
Колонка ключа партиционирования должна быть проиндексирована в исходной таблице для достижения значительного прироста производительности. Это можно проверить, выполнив `SHOW INDEX FROM <table_name>` в MySQL.
:::

### Логическое партиционирование {#logical-partitioning-mysql-snapshot}

Рассмотрим следующие настройки:

<Image img={snapshot_params} alt='Параметры снимка' size='md' />

#### Количество строк на партицию снимка {#numrows-mysql-snapshot}

Эта настройка определяет, сколько строк составляют партицию. ClickPipe будет читать исходную таблицу фрагментами такого размера, и фрагменты обрабатываются параллельно в соответствии с установленным уровнем параллелизма начальной загрузки. Значение по умолчанию — 100 000 строк на партицию.

#### Параллелизм начальной загрузки {#parallelism-mysql-snapshot}

Эта настройка определяет, сколько партиций обрабатывается параллельно. Значение по умолчанию — 4, что означает, что ClickPipe будет читать 4 партиции исходной таблицы параллельно. Это значение можно увеличить для ускорения начальной загрузки, но рекомендуется устанавливать разумное значение в зависимости от характеристик вашего исходного экземпляра, чтобы избежать перегрузки исходной базы данных. ClickPipe автоматически настроит количество партиций на основе размера исходной таблицы и количества строк на партицию.

#### Количество таблиц снимка в параллельном режиме {#tables-parallel-mysql-snapshot}

Эта настройка не связана напрямую с параллельным снимком, но определяет, сколько таблиц обрабатывается параллельно во время начальной загрузки. Значение по умолчанию — 1. Обратите внимание, что это дополнительно к параллелизму партиций, поэтому если у вас 4 партиции и 2 таблицы, ClickPipe будет читать 8 партиций параллельно.

### Мониторинг параллельного снимка в MySQL {#monitoring-parallel-mysql-snapshot}

Вы можете выполнить **SHOW processlist** в MySQL, чтобы увидеть параллельный снимок в действии. ClickPipe создаст несколько соединений с исходной базой данных, каждое из которых читает разную партицию исходной таблицы. Если вы видите запросы **SELECT** с разными диапазонами, это означает, что ClickPipe читает исходные таблицы. Здесь также можно увидеть запросы COUNT(\*) и партиционирования.

### Ограничения {#limitations-parallel-mysql-snapshot}

- Параметры снимка нельзя изменить после создания пайпа. Если вы хотите их изменить, вам придется создать новый ClickPipe.
- При добавлении таблиц в существующий ClickPipe вы не можете изменить параметры снимка. ClickPipe будет использовать существующие параметры для новых таблиц.
- Колонка ключа партиционирования не должна содержать значения `NULL`, так как они пропускаются логикой партиционирования.
