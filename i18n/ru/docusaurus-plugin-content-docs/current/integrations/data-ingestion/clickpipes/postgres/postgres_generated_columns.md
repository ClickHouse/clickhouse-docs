---
title: 'Сгенерированные столбцы в Postgres: подводные камни и рекомендации'
slug: /integrations/clickpipes/postgres/generated_columns
description: 'Страница, описывающая важные аспекты, которые следует учитывать при использовании сгенерированных столбцов PostgreSQL в таблицах, реплицируемых в другие системы'
doc_type: 'guide'
keywords: ['clickpipes', 'postgresql', 'cdc', 'data ingestion', 'real-time sync']
---

При использовании сгенерированных столбцов PostgreSQL в таблицах, которые участвуют в репликации, необходимо учитывать ряд важных моментов. Эти подводные камни могут повлиять на процесс репликации и согласованность данных в целевых системах.



## Проблема с генерируемыми столбцами {#the-problem-with-generated-columns}

1. **Не публикуются через `pgoutput`:** Генерируемые столбцы не публикуются через плагин логической репликации `pgoutput`. Это означает, что при репликации данных из PostgreSQL в другую систему значения генерируемых столбцов не включаются в поток репликации.

2. **Проблемы с первичными ключами:** Если генерируемый столбец входит в состав первичного ключа, это может вызвать проблемы с дедупликацией на стороне приёмника. Поскольку значения генерируемых столбцов не реплицируются, система-приёмник не будет располагать необходимой информацией для корректной идентификации и дедупликации строк.

3. **Проблемы с изменениями схемы**: Если вы добавляете генерируемый столбец в таблицу, которая уже реплицируется, новый столбец не будет заполнен на стороне приёмника, поскольку Postgres не предоставляет RelationMessage для нового столбца. Если затем вы добавите новый негенерируемый столбец в ту же таблицу, ClickPipe при попытке согласовать схему не сможет найти генерируемый столбец на стороне приёмника, что приведёт к сбою процесса репликации.


## Рекомендации {#best-practices}

Для обхода этих ограничений рекомендуется следовать следующим практикам:

1. **Пересоздание генерируемых столбцов на целевой системе:** Вместо того чтобы полагаться на процесс репликации для обработки генерируемых столбцов, рекомендуется пересоздавать эти столбцы на целевой системе с помощью таких инструментов, как dbt (data build tool), или других механизмов трансформации данных.

2. **Избегайте использования генерируемых столбцов в первичных ключах:** При проектировании таблиц, которые будут реплицироваться, рекомендуется избегать включения генерируемых столбцов в первичный ключ.


## Предстоящие улучшения интерфейса {#upcoming-improvements-to-ui}

В следующих версиях мы планируем добавить в интерфейс возможности, которые помогут пользователям:

1. **Определять таблицы с генерируемыми столбцами:** В интерфейсе появится функция для определения таблиц, содержащих генерируемые столбцы. Это позволит пользователям понять, какие таблицы подвержены данной проблеме.

2. **Документация и лучшие практики:** Интерфейс будет содержать рекомендации по использованию генерируемых столбцов в реплицируемых таблицах, включая советы по предотвращению типичных ошибок.
