---
title: 'Управление синхронизацией ClickPipe для Postgres'
description: 'Документация по управлению синхронизацией ClickPipe для Postgres'
slug: /integrations/clickpipes/postgres/sync_control
sidebar_label: 'Управление синхронизацией'
keywords: ['sync control', 'postgres', 'clickpipes', 'batch size', 'sync interval']
doc_type: 'guide'
---

import edit_sync_button from '@site/static/images/integrations/data-ingestion/clickpipes/postgres/edit_sync_button.png'
import create_sync_settings from '@site/static/images/integrations/data-ingestion/clickpipes/postgres/create_sync_settings.png'
import edit_sync_settings from '@site/static/images/integrations/data-ingestion/clickpipes/postgres/sync_settings_edit.png'
import cdc_syncs from '@site/static/images/integrations/data-ingestion/clickpipes/postgres/cdc_syncs.png'
import Image from '@theme/IdealImage';

В этом документе описывается, как управлять синхронизацией Postgres ClickPipe, когда ClickPipe работает в **режиме CDC (Running)**.


## Обзор {#overview}

Архитектура Database ClickPipes состоит из двух параллельных процессов — извлечения данных из исходной базы данных и отправки в целевую базу данных. Процесс извлечения управляется конфигурацией синхронизации, которая определяет, как часто следует извлекать данные и какой объем данных следует извлекать за один раз. Под «за один раз» мы подразумеваем один пакет — поскольку ClickPipe извлекает и отправляет данные пакетами.

Существует два основных способа управления синхронизацией Postgres ClickPipe. ClickPipe начнет отправку данных, когда сработает одна из следующих настроек.

### Интервал синхронизации {#interval}

Интервал синхронизации канала — это промежуток времени (в секундах), в течение которого ClickPipe будет извлекать записи из исходной базы данных. Время отправки данных в ClickHouse не включается в этот интервал.

По умолчанию — **1 минута**.
Интервал синхронизации может быть установлен на любое положительное целое значение, но рекомендуется устанавливать его не менее 10 секунд.

### Размер пакета извлечения {#batch-size}

Размер пакета извлечения — это количество записей, которые ClickPipe извлечет из исходной базы данных за один пакет. Под записями понимаются операции вставки, обновления и удаления, выполненные в таблицах, которые являются частью канала.

По умолчанию — **100 000** записей.
Безопасный максимум — 10 миллионов.

### Исключение: долговыполняющиеся транзакции в источнике {#transactions}

Когда в исходной базе данных выполняется транзакция, ClickPipe ожидает получения COMMIT транзакции, прежде чем продолжить работу. Это **переопределяет** как интервал синхронизации, так и размер пакета извлечения.

### Настройка параметров синхронизации {#configuring}

Вы можете установить интервал синхронизации и размер пакета извлечения при создании ClickPipe или редактировании существующего.
При создании ClickPipe эти параметры отображаются на втором шаге мастера создания, как показано ниже:

<Image img={create_sync_settings} alt='Создание параметров синхронизации' size='md' />

При редактировании существующего ClickPipe перейдите на вкладку **Settings** канала, приостановите канал, а затем нажмите **Configure**:

<Image img={edit_sync_button} alt='Кнопка редактирования синхронизации' size='md' />

Откроется боковая панель с параметрами синхронизации, где вы можете изменить интервал синхронизации и размер пакета извлечения:

<Image img={edit_sync_settings} alt='Редактирование параметров синхронизации' size='md' />

### Настройка параметров синхронизации для управления ростом слота репликации {#tweaking}

Рассмотрим, как использовать эти параметры для управления большим слотом репликации канала CDC.
Время отправки в ClickHouse не масштабируется линейно со временем извлечения из исходной базы данных. Это можно использовать для уменьшения размера большого слота репликации.
Увеличив как интервал синхронизации, так и размер пакета извлечения, ClickPipe извлечет большой объем данных из исходной базы данных за один раз, а затем отправит их в ClickHouse.

### Мониторинг поведения управления синхронизацией {#monitoring}

Вы можете увидеть, сколько времени занимает каждый пакет, в таблице **CDC Syncs** на вкладке **Metrics** ClickPipe. Обратите внимание, что длительность здесь включает время отправки, а также, если нет входящих строк, ClickPipe ожидает, и время ожидания также включается в длительность.

<Image img={cdc_syncs} alt='Таблица синхронизаций CDC' size='md' />
