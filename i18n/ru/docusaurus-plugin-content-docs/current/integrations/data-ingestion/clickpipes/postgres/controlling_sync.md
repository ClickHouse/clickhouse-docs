---
title: 'Управление синхронизацией Postgres ClickPipe'
description: 'Документация по управлению синхронизацией Postgres ClickPipe'
slug: /integrations/clickpipes/postgres/sync_control
sidebar_label: 'Управление синхронизацией'
keywords: ['управление синхронизацией', 'postgres', 'clickpipes', 'размер пакета', 'интервал синхронизации']
doc_type: 'guide'
integration:
  - support_level: 'core'
  - category: 'clickpipes'
---

import edit_sync_button from '@site/static/images/integrations/data-ingestion/clickpipes/postgres/edit_sync_button.png'
import create_sync_settings from '@site/static/images/integrations/data-ingestion/clickpipes/postgres/create_sync_settings.png'
import edit_sync_settings from '@site/static/images/integrations/data-ingestion/clickpipes/postgres/sync_settings_edit.png'
import cdc_syncs from '@site/static/images/integrations/data-ingestion/clickpipes/postgres/cdc_syncs.png'
import Image from '@theme/IdealImage';

В этом документе описывается, как управлять синхронизацией в Postgres ClickPipe, когда ClickPipe работает в режиме **CDC (Running)**.

## Обзор \\{#overview\\}

Архитектура Database ClickPipes состоит из двух параллельных процессов — забора данных из исходной базы данных и отправки их в целевую базу данных. Процесс забора управляется конфигурацией синхронизации, которая определяет, как часто должны забираться данные и какой объём данных забирать за один раз. Под «за один раз» мы понимаем один батч, поскольку ClickPipe забирает и отправляет данные пакетами (батчами).

Существуют два основных способа управления синхронизацией Postgres ClickPipe. ClickPipe начнёт отправку, когда сработает одна из приведённых ниже настроек.

### Интервал синхронизации \\{#interval\\}

Интервал синхронизации конвейера — это период времени (в секундах), в течение которого ClickPipe будет забирать записи из исходной базы данных. Время, необходимое для отправки уже полученных данных в ClickHouse, в этот интервал не входит.

Значение по умолчанию — **1 минута**.
Интервал синхронизации можно задать любым положительным целым числом, но рекомендуется устанавливать его не менее чем 10 секунд.

### Размер батча вытягивания \\{#batch-size\\}

Размер батча вытягивания — это количество записей, которые ClickPipe заберёт из исходной базы данных за один батч. Под записями понимаются `INSERT`, `UPDATE` и `DELETE`, выполненные над таблицами, входящими в конвейер.

Значение по умолчанию — **100 000** записей.
Безопасный максимум — 10 миллионов.

### Исключение: длительные транзакции на источнике \\{#transactions\\}

Когда транзакция выполняется в исходной базе данных, ClickPipe ждёт получения `COMMIT` этой транзакции, прежде чем продолжить работу. Это поведение **переопределяет** и интервал синхронизации, и размер батча вытягивания.

### Настройка параметров синхронизации \\{#configuring\\}

Вы можете задать интервал синхронизации и размер батча вытягивания при создании ClickPipe или при редактировании существующего конвейера.
При создании ClickPipe они появляются на втором шаге мастера создания, как показано ниже:

<Image img={create_sync_settings} alt="Создание настроек синхронизации" size="md"/>

При редактировании существующего ClickPipe перейдите на вкладку **Settings** конвейера, приостановите конвейер и затем нажмите **Configure** здесь:

<Image img={edit_sync_button} alt="Кнопка редактирования синхронизации" size="md"/>

Откроется выезжающая панель с настройками синхронизации, где вы можете изменить интервал синхронизации и размер батча вытягивания:

<Image img={edit_sync_settings} alt="Редактирование настроек синхронизации" size="md"/>

### Тонкая настройка параметров синхронизации для ограничения роста replication slot \\{#tweaking\\}

Рассмотрим, как использовать эти настройки для работы с большим слотом репликации (replication slot) конвейера CDC.
Время отправки данных в ClickHouse не масштабируется линейно относительно времени вытягивания данных из исходной базы данных. Это можно использовать для уменьшения размера такого слота репликации.
Увеличив и интервал синхронизации, и размер батча вытягивания, ClickPipe заберёт большой объём данных из исходной базы данных за один проход, а затем отправит его в ClickHouse.

### Мониторинг поведения управления синхронизацией \\{#monitoring\\}

Вы можете увидеть, сколько времени занимает каждый батч, в таблице **CDC Syncs** на вкладке **Metrics** соответствующего ClickPipe. Обратите внимание, что указанная длительность включает время отправки, а также, если нет входящих строк, ClickPipe ждёт, и время ожидания также включается в длительность.

<Image img={cdc_syncs} alt="Таблица CDC Syncs" size="md"/>