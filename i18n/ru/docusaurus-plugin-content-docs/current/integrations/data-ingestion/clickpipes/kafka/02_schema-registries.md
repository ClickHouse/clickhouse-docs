---
sidebar_label: 'Интеграция с реестром схем'
description: 'Как интегрировать ClickPipes с реестром схем для управления схемами'
slug: /integrations/clickpipes/kafka/schema-registries
sidebar_position: 1
title: 'Реестры схем для Kafka ClickPipe'
doc_type: 'guide'
keywords: ['schema registries', 'kafka', 'clickpipes', 'avro', 'confluent']
---



# Реестры схем {#schema-registries}

ClickPipes поддерживает реестры схем для потоков данных в формате Avro.


## Поддерживаемые реестры схем для Kafka ClickPipes {#supported-schema-registries}

Поддерживаются реестры схем, совместимые по API с Confluent Schema Registry. К ним относятся:

- Confluent Schema Registry
- Redpanda Schema Registry

ClickPipes пока не поддерживает AWS Glue Schema Registry и Azure Schema Registry. Если вам необходима поддержка этих реестров схем, [свяжитесь с нашей командой](https://clickhouse.com/company/contact?loc=clickpipes).


## Конфигурация {#schema-registry-configuration}

ClickPipes с данными Avro требует реестр схем. Его можно настроить одним из трёх способов:

1. Указать полный путь к субъекту схемы (например, `https://registry.example.com/subjects/events`)
   - При необходимости можно указать конкретную версию, добавив `/versions/[version]` к URL (в противном случае ClickPipes получит последнюю версию).
2. Указать полный путь к идентификатору схемы (например, `https://registry.example.com/schemas/ids/1000`)
3. Указать корневой URL реестра схем (например, `https://registry.example.com`)


## Как это работает {#how-schema-registries-work}

ClickPipes динамически получает и применяет Avro-схему из настроенного реестра схем.

- Если в сообщении содержится идентификатор схемы, он будет использован для получения схемы.
- Если в сообщении отсутствует идентификатор схемы, для получения схемы будет использован идентификатор схемы или имя субъекта, указанные в конфигурации ClickPipe.
- Если сообщение записано без встроенного идентификатора схемы и в конфигурации ClickPipe не указан идентификатор схемы или имя субъекта, схема не будет получена, а сообщение будет пропущено с ошибкой `SOURCE_SCHEMA_ERROR`, записанной в таблицу ошибок ClickPipes.
- Если сообщение не соответствует схеме, оно будет пропущено с ошибкой `DATA_PARSING_ERROR`, записанной в таблицу ошибок ClickPipes.


## Сопоставление схем {#schema-mapping}

При сопоставлении полученной схемы Avro с целевой таблицей ClickHouse применяются следующие правила:

- Если схема Avro содержит поле, которое не включено в сопоставление с целевой таблицей ClickHouse, это поле игнорируется.
- Если в схеме Avro отсутствует поле, определённое в сопоставлении с целевой таблицей ClickHouse, столбец ClickHouse будет заполнен «нулевым» значением, таким как 0 или пустая строка. Обратите внимание, что выражения DEFAULT в настоящее время не вычисляются при вставках через ClickPipes (это временное ограничение, которое будет устранено после обновления обработки значений по умолчанию на сервере ClickHouse).
- Если поле схемы Avro и столбец ClickHouse несовместимы, вставка соответствующей строки/сообщения завершится ошибкой, которая будет зафиксирована в таблице ошибок ClickPipes. Обратите внимание, что поддерживается ряд неявных преобразований (например, между числовыми типами), но не все (например, поле записи Avro невозможно вставить в столбец ClickHouse типа Int32).
