---
sidebar_label: 'Вставка локальных файлов'
sidebar_position: 2
---


# Вставка локальных файлов

Вы можете использовать `clickhouse-client` для потоковой передачи локальных файлов в ваш сервис ClickHouse. Это позволяет вам предварительно обрабатывать данные с помощью многих мощных и удобных функций ClickHouse. Рассмотрим пример...

1. Предположим, у нас есть файл TSV с именем `comments.tsv`, который содержит некоторые комментарии Hacker News, а строка заголовка содержит названия колонок. Вам нужно указать [формат входных данных](/interfaces/formats), когда вы вставляете данные, который в нашем случае будет `TabSeparatedWithNames`:

```text
id	type	author	timestamp	comment	children
19464423	comment	adrianmonk	2019-03-22 16:58:19	"Это сравнение яблок и апельсинов с самого начала. Существуют расходы на безопасность, связанные с популяциями в тюрьмах. Вам нужны сотрудники, объекты, оборудование и т. д., чтобы управлять поведением заключенных (предотвращать драки и т. д.) и не допускать их побегов. У этих двух фактов разные задачи, и, конечно, у них разные расходы.<p>Это все равно что сказать, что холодильник дороже микроволновки. Это ничего не значит, потому что они выполняют разные функции."	[]
19464461	comment	sneakernets	2019-03-22 17:01:10	"Потому что наука так надежна, что в данный момент это все равно что бить мертвую лошадь.<p>Но с антивакцинаторами это все равно что сказать кому-то, что красное яблоко, которое ты держишь, красное, однако они настаивают на том, что оно зеленое. С такими людьми невозможно обсуждать «достоинства»."	[19464582]
19465288	comment	derefr	2019-03-22 18:15:21	"Потому что мы говорим о жаргоне бэкенд-развертывания и операций терминах «веб-сайт» и «веб-приложение», а не об их общем использовании. Слова могут иметь точные жаргонные значения <i>которые разные</i> в различных дисциплинах. Здесь люди из отрасли, как правило, ставят черту: веб<i>сайт</i> — это то, что вы можете развернуть, например, в ведре S3, и оно будет полностью функциональным, без каких-либо других зависимостей, которые вам нужно поддерживать. <i>Веб-приложение</i> — это то, что <i>имеет</i> такие зависимости, которые вам необходимо настроить и поддерживать — например, уровень базы данных.<p>Но даже игнорируя это, я также определяю эти термины таким образом из-за префикса «веб». Веб-приложение - это не «приложение в вебе», а скорее «приложение, работающее на вебе». Полностью автономный SPA JavaScript, который просто <i>рассматривается через</i> веб, <i>не является</i> веб-приложением. Это просто программа, która работает в браузере, так же, как Flash или ActiveX или Java апплет — это программа, которая работает в браузере. (Является ли Flash-игра «веб-игрой»? Обычно это считается <i>браузерной игрой</i>, но это не одно и то же.)<p>У нас уже есть термин для того, чем являются {Flash, ActiveX, Java} апплеты: приложения. Автономные SPA JavaScript тоже просто приложения. Нам не нужно добавлять префикс «веб»; это бессмысленно здесь. Во всех этих случаях, если бы вы взяли точно такую же программу и запихнули ее в оболочку Electron вместо того, чтобы извлечь ее в ведре с доменным фронтом S3, она явно не была бы «веб-приложением» в любом смысле. Ваш SPA был бы просто «JavaScript <i>приложением</i>, которое использует DOM браузера в качестве своего графического инструмента». Ну, это также верно до того, как вы поместите его в оболочку Electron.<p>Итак, «веб-приложение» тогда имеет конкретное значение, выходящее за рамки «приложения». Вам нужно что-то дополнительное. Это что-то дополнительное — это бэкенд, с которым ваш браузер, управляемый логикой приложения, взаимодействует <i>через веб</i>. Это то, что делает приложение «веб-приложением». (Это определение намеренно охватывает как динамический HTML, рендеримый на сервере, так и рендеримые на клиенте JavaScript SPA приложения. Вам не нужен фронтенд <i>приложение</i>; вам просто нужен <i>веб-бэкенд</i>, с которым что-то взаимодействует. Этим «чем-то» может быть напрямую браузер, щелкая по ссылкам и отправляя формы; или это может быть JavaScript фронтенд, используя AJAX.)<p>«Веб-сайт» тогда — это «веб-приложение» без части «приложения». Если в вышеописанном определении ясно, что такое «приложение», и что такое «веб-приложение», то вы можете вычесть одно из другого, чтобы получить определение «веб-не-приложения». Это веб-сайт: что-то, работающее на веб-бэкенде, что не выполняет никаких действий приложения. Если мы решим, что «действия приложения» в основном «хранение состояния», то «сайт» — это «приложение» без постоянного состояния.<p>И поскольку определение «веб» здесь касается бэкенда, то отличие между «веб-приложением» и «веб-сайтом» (веб-не-приложением) вероятно определяется свойствами бэкенда. Так что различие касается способности веб-бэкенда хранить состояние. Таким образом, «веб-сайт» — это «веб-приложение», где бэкенд не выполняет никаких действий приложения — т. е. не хранит состояние."	[]
19465534	comment	bduerst	2019-03-22 18:36:40	"Apple включено: <a href=""https:&#x2F;&#x2F;www.theguardian.com&#x2F;commentisfree&#x2F;2018&#x2F;mar&#x2F;04&#x2F;apple-users-icloud-services-personal-data-china-cybersecurity-law-privacy"" rel=""nofollow"">https:&#x2F;&#x2F;www.theguardian.com&#x2F;commentisfree&#x2F;2018&#x2F;mar&#x2F;04&#x2F;apple-...</a>"	[]
19466269	comment	CalChris	2019-03-22 19:55:13	"&gt; У него тот же процессор A12 ... с 3 ГБ оперативной памяти на <i>системе-на-чипе</i><p>На самом деле это <i>упакованный в упаковку</i>. LPDDR4X DRAM приклеен (хорошо, переплавлен) на задней стороне A12 Bionic.<p><a href=""https:&#x2F;&#x2F;www.techinsights.com&#x2F;about-techinsights&#x2F;overview&#x2F;blog&#x2F;apple-iphone-xs-teardown&#x2F;"" rel=""nofollow"">https:&#x2F;&#x2F;www.techinsights.com&#x2F;about-techinsights&#x2F;overview&#x2F;blo...</a><p><a href=""https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Package_on_package"" rel=""nofollow"">https:&#x2F;&#x2F;en.wikipedia.org&#x2F;wiki&#x2F;Package_on_package</a>"	[19468341]
19466980	comment	onetimemanytime	2019-03-22 21:07:25	"&gt;&gt;<i>Безумие в том, что вы не можете взять землю, на которой стоит автоприцеп, и построить на ней студию.</i><p>яблоки и апельсины. Разрешение на строительство студии делает это здание легитимным, фактически навсегда. Автоприцеп могут исключить с помощью нового закона или просто, обеспечивая соблюдение действующих законов."	[]
19467048	comment	karambahh	2019-03-22 21:15:41	"Думаю, вы сравниваете яблоки с апельсинами.<p> Если вы забираете парковочное место для другого использования (например, для строительства жилья для семей или приюта для животных), то вы не лишаете автомобиль ничего, это дорогой, крупный кусок металла и он не обладает сознанием.<p>В следующий раз вы скажете, что depriving car owners from the practicality of parking their vehicles anywhere they like. Я полностью согласен, чтобы лишить владельцев автомобилей этого удобства, чтобы позволить человеку иметь крышу над головой. (говоря из личного опыта, так как всего несколько минут назад мне пришлось припарковать свою машину в 1 км от дома, потому что город сейчас строит жилье и ограничил парковочное пространство поблизости)<p>Некоторые могут сказать, что стыдно помогать животным, пока люди страдают. Это точно такое же мышление, как «мы не можем позволить больше мигрантов, нам нужно заботиться о наших «своих» бездомных людях».<p>Это ложная дихотомия. Неравенство в западных обществах все больше и больше растет. Моя попытка сделать свою часть несущественна. Мое пожертвование на человеческие или животные нужды — это небольшая трещина в горах неравенства, на которых мы живем...<p>Наконец, полностью анекдотическая точка зрения: я несколько раз наблюдал, как чрезвычайно бедные люди выходят из своих путей, чтобы показать солидарность животным или людям. Я также наблюдал много богатых людей, жалующихся на то, что бедные беспокоят их только своим присутствием, чье богатство стало прямым следствием эксплуатации тех самых бедных."	[19467512]
```

2. Давайте создадим таблицу для наших данных Hacker News:

```sql
CREATE TABLE hackernews (
    id UInt32,
    type String,
    author String,
    timestamp DateTime,
    comment String,
    children Array(UInt32),
    tokens Array(String)
)
ENGINE = MergeTree
ORDER BY toYYYYMMDD(timestamp)
```

3. Мы хотим привести к нижнему регистру колонку `author`, что легко сделать с помощью [`lower` функции](/sql-reference/functions/string-functions#lower). Мы также хотим разбить строку `comment` на токены и сохранить результат в колонке `tokens`, что можно сделать с помощью [`extractAll` функции](/sql-reference/functions/string-search-functions#extractall). Все это можно сделать в одной команде `clickhouse-client` — обратите внимание, как файл `comments.tsv` передается в `clickhouse-client` с помощью оператора `<`:

```bash
clickhouse-client \
    --host avw5r4qs3y.us-east-2.aws.clickhouse.cloud \
    --secure \
    --port 9440 \
    --password Myp@ssw0rd \
    --query "
    INSERT INTO hackernews
    SELECT
        id,
	   	type,
   		lower(author),
		timestamp,
		comment,
		children,
		extractAll(comment, '\\w+') as tokens
    FROM input('id UInt32, type String, author String, timestamp DateTime, comment String, children Array(UInt32)')
    FORMAT TabSeparatedWithNames
" < comments.tsv
```

:::note
Функция `input` полезна здесь, поскольку позволяет нам преобразовывать данные в процессе вставки в таблицу `hackernews`. Аргументом для `input` является формат входных сырых данных, и вы увидите это во многих других функциях таблицы (где вы указываете схему для входящих данных).
:::

4. Вот и все! Данные загружены в ClickHouse:

```sql
SELECT *
FROM hackernews
LIMIT 7
```

Результат:

```response
│  488 │ comment │ mynameishere │ 2007-02-22 14:48:18 │ "Жалко. Javascript в браузере и Ajax это оба отвратительные ухищрения, заставляющие программистов делать всякие унизительные вещи. И результатом являются -- всячина с html. Java, несмотря на свои недостатки, довольно чиста, когда запускается в среде апплета. Она имеет каждое преимущество над JITBAJAX, кроме проблем с установкой и тяжелым процессом загрузки. Yahoo игры, кажется, единственная успешная история апплета. Конечно, в свое время не тривиальные апплеты обычно были слишком большими для диалпольных счетов, которые у людей были. По меньшей мере это поменялось." │ [454927] │ ['Это','слишком','плохо','Javascript','в','браузере','и','Ajax','оба','отвратительные','хакерские','заставляющие','программистов','делать','все','всякие','стыдные','вещи','И','результат','это','всевозможные','всякие','трюки','Java','несмотря','на','свои','недостатки','довольно','чистая','когда','работает','в','среде','апплета','Она','имеет','каждое','преимущество','перед','JITBAJAX','кроме','проблем','с','установкой','и','тяжелым','процессом','загрузки','Yahoo','игры','кажется','каждая','буквально','единственная','история','успеха','апплета','Конечно','назад','в','день','не','тривиальные','апплеты','склонялись','быть','слишком','большими','для','телефонных','счетов','которые','люди','имели','По','меньшей','мере','это','поменялось'] │
│  575 │ comment │ leoc         │ 2007-02-23 00:09:49 │ "Я не могу найти ссылку сейчас, но я *думаю*, я только что прочитал что-то, что предполагает, что процесс установки апплета Apollo будет включать диалог подтверждения «установить это приложение?» затем загрузку около 30 секунд или около того. Если так, то Apollo менее многообещающий, чем я надеялся. Такой тип установки может быть низкосложным по стандартам настольных приложений, но не сравним с легкостью, с которой можно запустить браузерное AJAX или Flash приложение. (Подумайте, как легко использовать maps.google.com в первый раз.)<p>Напротив, это по крайней мере будет то, что приложения Apollo будут работать ненадежно по умолчанию, и что уже установленное приложение будет запускаться автоматически каждый раз, когда вы перенесете браузер на URL, с которого вы его скачали?" │ [455071] │ ['Я','не','могу','найти','ссылку','сейчас','но','я','думаю','я','только','что','прочитал','что-то','что','предполагает','что','процесс','установки','для','апплета','Apollo','будет','включены','диалог','подтверждения','34','установить','это','приложение','34','подтверждение','диалог','затем','загрузка','в','30','секунд','или','около','тысяч','отключить','т.е.','что','Apollo','меньше','многообещающий','чем','я','надеялся','Что','такое','поступление','может','приблизиться','по','низкому','фактору','стандартам','десктопного','приложения','но','это','не','сравнимо','с','легкостью','начала','браузера','основанного','AJAX','или','Flash','приложение','Подумайте','о','том','насколько','легко','с','использовать','maps.google.com','в','первый','раз','p','Конечно','это','будет','по','крайней','мере','что','приложения','Apollo','будут','работать','нон-тревожными','по','умолчанию','и','что','уже','установленное','приложение','будет','запускаться','автоматически','каждый','раз','когда','вы','берете','броузер','на','URL','вы','скачивали','его','с'] │
│ 3110 │ comment │ davidw       │ 2007-03-09 09:19:58 │ "Мне очень интересно это tsumobi, поскольку это в основном точно такое же, как Hecl ( http://www.hecl.org ). Я примерно так же забросил эту идею для зарабатывания денег на ней, считая, что преимущество заключалось только в том, чтобы иметь возможность разрабатывать приложения намного быстрее. Я смог протестировать ShopList ( http://shoplist.dedasys.com ) за считанные минуты с ее помощью, например.<p>Редактировать: Кстати, мне определенно было бы интересно пообщаться с ребятами из Tsumobi. Это хорошая идея - возможно, есть элементы, которые можно повторно использовать из / добавить к Hecl, который является открытым исходным кодом под очень либеральной лицензией, что означает, что вы можете взять его и включить даже в «коммерческие» приложения.<p>Я действительно думаю, что «общие» элементы в такое пространство должны быть либо бесплатными, либо с открытым исходным кодом (думайте о браузерах, html, JavaScript, java апплетах и т.д.), и что это не то, где деньги." │ [3147]   │ ['Мне','очень','интересно','это','tsumobi','поскольку','это','в','основном','точно','то','же','самое','как','Hecl','это','http','www','hecl','org','Я','также','в основном','так','же','забросил','это','как','идею','за','зарабатывание','любых','денег','с','нем','непосредственно','в','потому','что','преимущество','было','просто','чтобы','иметь','возможность','разрабатывать','программы','в','много','быстрее','Я','смог','прототипировать','ShopList','http','shoplist','dedasys','com','за','несколько','минут','с','ним','например','p','Редактировать','Кстати','Я','определенно','был','заинтересован','в','общении','с','Tsumobi','ребятами','Это','хорошая','идея','возможно','есть','элементы','в','общем','которые','можно','переиспользовать','из','добавленных','к пробпету','Hecl','который','является','открытым','исходным','кодом','по','очень','либеральной','лицензии','что','означает','что','вы можете взять его и включить только в «коммерческих» приложениях','p','Я','действительно','думаю','что','эти','общие','части','в','такой','плоскости','должны','востребоваться','либо','бесплатными','либо','с','открытым','исходным','кодом','думайте','о','броузерах','html','javascript','java','applets','и','что','это','не','где','деньги'] │
│ 4016 │ comment │ mynameishere │ 2007-03-13 22:56:53 │ "http://www.tigerdirect.com/applications/SearchTools/item-details.asp?EdpNo=2853515&CatId=2511<p>Против<p>http://store.apple.com/1-800-MY-APPLE/WebObjects/AppleStore?family=MacBookPro<p>Это сопоставимые системы, но Apple имеет, как я и говорил, примерно 800 долларов сверху. На самом деле, самый дешевый macbook pro стоит столько же, сколько и высококачественный Toshiba. Если вы зарабатываете хорошие деньги, это не проблема. Но когда девушка в кафе спрашивает меня, какое компьютере ей стоит приобрести, чтобы соответствовать ее минимальному заработку, я фактически отказываюсь рекомендовать Apple." │ []       │ ['http','www','tigerdirect','com','applications','SearchTools','item','details','asp','EdpNo','2853515','CatId','2511','p','Против','p','http','store','apple','com','1','800','MY','APPLE','WebObjects','AppleStore','family','MacBookPro','p','Это','сопоставимые','системы','но','Apple','имеет','как я и говорил','примерно','800','долларов','сверху','На самом деле','самый дешевый','macbook','pro','стоит','столько же','как','и','высококачественный','Toshiba','Если','вы','зарабатываете','хорошие','деньги','это','не','проблема','Но','когда','девушка','в','кafe','спрашивает','меня','какое','компьютере','ей','стоит','приобрести','чтобы','соответствовать','ее','минимальному','заработку','я','фактически','отказываюсь','рекомендовать','Apple'] │
│ 4568 │ comment │ jwecker      │ 2007-03-16 13:08:04 │ Я знаю это чувство. То же чувство, которое у меня было раньше, когда люди все еще писали Java апплеты. Может быть, обычный пользователь этого не чувствует — возможно, это программист в нас, который знает, что между мной и браузером есть большой слой...                 │ []       │ ['Я','знаю','это','чувство','То','же','чувство','которое','у меня','было','тогда','когда','люди','все еще','писали','java','applets','Может быть','обычный','пользователь','не','чувствует','это','может быть','это','программист','в','нас','зная','что','между','мной','и','браузером','есть','большой','слой','работающий','между','мной','и','браузером'] │
│ 4900 │ comment │ lupin_sansei │ 2007-03-19 00:26:30 │ "Суть AJAX заключается в получении Javascript-сообщения с сервером без перезагрузки страницы. Хотя XmlHttpRequest наиболее удобен, раньше были другие способы сделать это, такие как <p>- загрузка 1 пиксельного изображения и отправка данных в cookie изображения<p>- загрузка данных сервером через крошечный фрейм, который содержал XML или java-скрипт либо<p>- использование java апплета для получения данных от имени javascript" │ []       │ ['Суть','AJAX','заключается','в','получении','Javascript','с','сервером','без','перезагрузки','страницы','Хотя','XmlHttpRequest','является','самым','удобным','было','другие','методы','сделать','это','до','XmlHttpRequest','такие','как','p','загрузка','1','пиксельного','изображения','и','отправка','данных','в','cookie','изображения','p','загрузка','данных','сервером','через','крошечный','фрейм','который','содержал','XML','или','javascipt','данные','p','Использование','java','апплета','чтобы','получить','данные','от','имени','javascript'] │
│ 5102 │ comment │ staunch      │ 2007-03-20 02:42:47 │ "Ну, это именно тот вид вещей, который не очень очевиден. Кажется, что как только вы становитесь богатым, возникают новые правила, по которым вам нужно жить. Очень жаль, что всем пришлось переучиваться на эти вещи из-за того, что несколько «плохих яблок» могут контролировать свою зависть.<p>Очень приятно услышать, что это где-то в вашей очереди эссе. Я постараюсь не разбогатеть, прежде чем вы напишете это, чтобы иметь представление о том, чего ожидать :-)" │ []       │ ['Ну','это','именно','тот','вид','вещей','которые','не','очень','очевидны','Кажется','что','как','только','вы','становитесь','богатым','возникает','новый','набор','правил','по','которым','вам','нужно','жить','Очень','жаль','что','всем','пришлось','переучиваться','на','эти','вещи','из-за','того','что','несколько','плохих','яблок','могут','контролировать','свою','зависть','p','Очень','приятно','услышать','что','это','где-то','в','вашей','очереди','эссе','Я','постараюсь','не','разбогатеть','прежде','чем','вы','напишете','это','чтобы','иметь','некий','опыт','о','том','чего','ожидать'] │
```

5. Еще один вариант - использовать инструмент `cat`, чтобы передать файл в `clickhouse-client`. Например, следующая команда дает такой же результат, как и использование оператора `<`:

```bash
cat comments.tsv | clickhouse-client \
    --host avw5r4qs3y.us-east-2.aws.clickhouse.cloud \
    --secure \
    --port 9440 \
    --password Myp@ssw0rd \
    --query "
    INSERT INTO hackernews
    SELECT
        id,
	   	type,
   		lower(author),
		timestamp,
		comment,
		children,
		extractAll(comment, '\\w+') as tokens
    FROM input('id UInt32, type String, author String, timestamp DateTime, comment String, children Array(UInt32)')
    FORMAT TabSeparatedWithNames
"
```

Посетите [страницу документации о `clickhouse-client`](/interfaces/cli) для получения подробной информации о том, как установить `clickhouse-client` на вашу локальную операционную систему.

## Связанный контент {#related-content}

- Блог: [Получение данных в ClickHouse - Часть 1](https://clickhouse.com/blog/getting-data-into-clickhouse-part-1)
- Блог: [Исследование огромных реальных наборов данных: 100+ лет метеорологических записей в ClickHouse](https://clickhouse.com/blog/real-world-data-noaa-climate-data)
