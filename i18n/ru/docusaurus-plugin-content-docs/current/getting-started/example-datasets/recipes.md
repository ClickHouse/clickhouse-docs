---
description: "Набор данных RecipeNLG, содержащий 2.2 миллиона рецептов"
slug: /getting-started/example-datasets/recipes
sidebar_label: Набор данных рецептов
title: "Набор данных рецептов"
---

Набор данных RecipeNLG доступен для загрузки [здесь](https://recipenlg.cs.put.poznan.pl/dataset). Он содержит 2.2 миллиона рецептов. Размер составляет чуть меньше 1 ГБ.
## Загрузка и распаковка набора данных {#download-and-unpack-the-dataset}

1. Перейдите на страницу загрузки [https://recipenlg.cs.put.poznan.pl/dataset](https://recipenlg.cs.put.poznan.pl/dataset).
2. Примите Условия и положения и загрузите ZIP-файл.
3. Опционально: Используйте команду `md5sum dataset.zip`, чтобы проверить целостность ZIP-файла; он должен совпадать с `3a168dfd0912bb034225619b3586ce76`.
4. Распакуйте ZIP-файл с помощью команды `unzip dataset.zip`. Вы получите файл `full_dataset.csv` в директории `dataset`.
## Создание таблицы {#create-a-table}

Запустите `clickhouse-client` и выполните следующий запрос CREATE:

``` sql
CREATE TABLE recipes
(
    title String,
    ingredients Array(String),
    directions Array(String),
    link String,
    source LowCardinality(String),
    NER Array(String)
) ENGINE = MergeTree ORDER BY title;
```
## Вставка данных {#insert-the-data}

Выполните следующую команду:

``` bash
clickhouse-client --query "
    INSERT INTO recipes
    SELECT
        title,
        JSONExtract(ingredients, 'Array(String)'),
        JSONExtract(directions, 'Array(String)'),
        link,
        source,
        JSONExtract(NER, 'Array(String)')
    FROM input('num UInt32, title String, ingredients String, directions String, link String, source LowCardinality(String), NER String')
    FORMAT CSVWithNames
" --input_format_with_names_use_header 0 --format_csv_allow_single_quote 0 --input_format_allow_errors_num 10 < full_dataset.csv
```

Это пример того, как разобрать пользовательский CSV, так как он требует нескольких настроек.

Объяснение:
- Набор данных в формате CSV, но требует некоторой предобработки при вставке; мы используем табличную функцию [input](../../sql-reference/table-functions/input.md) для выполнения предобработки;
- Структура CSV-файла указана в аргументе табличной функции `input`;
- Поле `num` (номер строки) ненужное - мы извлекаем его из файла и игнорируем;
- Мы используем `FORMAT CSVWithNames`, но заголовок в CSV будет проигнорирован (параметр командной строки `--input_format_with_names_use_header 0`), потому что заголовок не содержит имени для первого поля;
- Файл использует только двойные кавычки для обрамления CSV-строк; некоторые строки не обрамлены двойными кавычками, и одинарная кавычка не должна восприниматься как обрамление строки - поэтому мы также добавляем параметр `--format_csv_allow_single_quote 0`;
- Некоторые строки из CSV не могут быть разобраны, потому что они содержат последовательность `\M/` в начале значения; единственное значение, начинающееся с обратной косой черты в CSV, может быть `\N`, которое интерпретируется как SQL NULL. Мы добавляем параметр `--input_format_allow_errors_num 10`, и до десяти поврежденных записей могут быть пропущены;
- В массивы входят ингредиенты, направления и поля NER; эти массивы представлены в необычной форме: они сериализованы в строку как JSON и затем размещены в CSV - мы разбираем их как String, а затем используем функцию [JSONExtract](../../sql-reference/functions/json-functions.md), чтобы преобразовать их в Array.
## Проверка вставленных данных {#validate-the-inserted-data}

Проверив количество строк:

Запрос:

``` sql
SELECT count() FROM recipes;
```

Результат:

``` text
┌─count()─┐
│ 2231142 │
└─────────┘
```
## Примеры запросов {#example-queries}
### Топ компонентов по количеству рецептов: {#top-components-by-the-number-of-recipes}

В этом примере мы учимся использовать функцию [arrayJoin](../../sql-reference/functions/array-join.md), чтобы расширить массив в набор строк.

Запрос:

``` sql
SELECT
    arrayJoin(NER) AS k,
    count() AS c
FROM recipes
GROUP BY k
ORDER BY c DESC
LIMIT 50
```

Результат:

``` text
┌─k────────────────────┬──────c─┐
│ salt                 │ 890741 │
│ sugar                │ 620027 │
│ butter               │ 493823 │
│ flour                │ 466110 │
│ eggs                 │ 401276 │
│ onion                │ 372469 │
│ garlic               │ 358364 │
│ milk                 │ 346769 │
│ water                │ 326092 │
│ vanilla              │ 270381 │
│ olive oil            │ 197877 │
│ pepper               │ 179305 │
│ brown sugar          │ 174447 │
│ tomatoes             │ 163933 │
│ egg                  │ 160507 │
│ baking powder        │ 148277 │
│ lemon juice          │ 146414 │
│ Salt                 │ 122558 │
│ cinnamon             │ 117927 │
│ sour cream           │ 116682 │
│ cream cheese         │ 114423 │
│ margarine            │ 112742 │
│ celery               │ 112676 │
│ baking soda          │ 110690 │
│ parsley              │ 102151 │
│ chicken              │ 101505 │
│ onions               │  98903 │
│ vegetable oil        │  91395 │
│ oil                  │  85600 │
│ mayonnaise           │  84822 │
│ pecans               │  79741 │
│ nuts                 │  78471 │
│ potatoes             │  75820 │
│ carrots              │  75458 │
│ pineapple            │  74345 │
│ soy sauce            │  70355 │
│ black pepper         │  69064 │
│ thyme                │  68429 │
│ mustard              │  65948 │
│ chicken broth        │  65112 │
│ bacon                │  64956 │
│ honey                │  64626 │
│ oregano              │  64077 │
│ ground beef          │  64068 │
│ unsalted butter      │  63848 │
│ mushrooms            │  61465 │
│ Worcestershire sauce │  59328 │
│ cornstarch           │  58476 │
│ green pepper         │  58388 │
│ Cheddar cheese       │  58354 │
└──────────────────────┴────────┘

50 строк в наборе. Время выполнения: 0.112 сек. Обработано 2.23 миллиона строк, 361.57 МБ (19.99 миллионов строк/с., 3.24 ГБ/с.)
```
### Самые Сложные Рецепты с Клубникой {#the-most-complex-recipes-with-strawberry}

``` sql
SELECT
    title,
    length(NER),
    length(directions)
FROM recipes
WHERE has(NER, 'strawberry')
ORDER BY length(directions) DESC
LIMIT 10
```

Результат:

``` text
┌─title────────────────────────────────────────────────────────────┬─length(NER)─┬─length(directions)─┐
│ Шоколадно-Клубнично-Апельсиновый свадебный торт                │          24 │                126 │
│ Клубничный творожный крамбл                                   │          19 │                 47 │
│ Мороженое в стиле Шарлотты                                    │          11 │                 45 │
│ Греховно вкусный шоколадный торт с миллионом слоев, с клубникой │          31 │                 45 │
│ Сладкие ягоды с бузинным шербетом                             │          24 │                 44 │
│ Шоколадно-Клубничный муссовый торт                           │          15 │                 42 │
│ Шарлотка с ревенем и клубникой                                │          20 │                 42 │
│ Тарт с клубникой и ванилью от шефа Джои                      │           7 │                 37 │
│ Торт-сандэй по старинному рецепту                             │          17 │                 37 │
│ Торт из арбуза                                               │          16 │                 36 │
└──────────────────────────────────────────────────────────────────┴─────────────┴────────────────────┘

10 строк в наборе. Время выполнения: 0.215 сек. Обработано 2.23 миллиона строк, 1.48 ГБ (10.35 миллиона строк/с., 6.86 ГБ/с.)
```

В этом примере мы используем [has](../../sql-reference/functions/array-functions.md#hasarr-elem) функцию для фильтрации по элементам массива и сортируем по количеству направлений.

Есть свадебный торт, для которого требуется целых 126 шагов для приготовления! Покажем эти инструкции:

Запрос:

``` sql
SELECT arrayJoin(directions)
FROM recipes
WHERE title = 'Шоколадно-Клубнично-Апельсиновый свадебный торт'
```

Результат:

``` text
┌─arrayJoin(directions)───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ Установите 1 решетку в центр и 1 решетку в нижнюю треть духовки и разогрейте до 350F.                                                                                           │
│ Смажьте маслом одну форму для торта диаметром 5 дюймов с высотой сторон 2 дюйма, одну форму для торта диаметром 8 дюймов с высотой сторон 2 дюйма и одну форму для торта диаметром 12 дюймов с высотой сторон 2 дюйма.   │
│ Обсыпьте формы мукой; выстелите дно пергаментной бумагой.                                                                                                                         │
│ В небольшой тяжелой кастрюле соедините 1/3 стакана апельсинового сока и 2 унции несладкого шоколада.                                                                                    │
│ Помешивайте смесь на среднем огне до тех пор, пока шоколад не растает.                                                                                                                    │
│ Снимите с огня.                                                                                                                                                           │
│ Постепенно смешайте 1 2/3 стакана апельсинового сока.                                                                                                                                   │
│ Просейте 3 стакана муки, 2/3 стакана какао-порошка, 2 чайные ложки разрыхлителя, 1 чайную ложку соли и 1/2 чайной ложки соды в среднюю миску.                                                 │
│ С помощью электрического миксера взбейте 1 стакан (2 палочки) масла и 3 стакана сахара в большой миске, пока смесь не станет однородной (она будет выглядеть зернистой).                                                 │
│ Добавьте 4 яйца по одному, взбивая, чтобы объединить после каждого добавления.                                                                                                                       │
│ Вмешайте 1 столовую ложку апельсиновой цедры и 1 столовую ложку ванильного экстракта.                                                                                                          │
│ Поочередно добавляйте сухие ингредиенты и апельсиновую смесь в 3 добавления, тщательно перемешивая после каждого.                                                            │
│ Добавьте 1 стакан шоколадных чипсов.                                                                                                                                               │
│ Переложите 1 стакан плюс 2 столовые ложки теста в подготовленную форму диаметром 5 дюймов, 3 стакана теста в подготовленную форму диаметром 8 дюймов и оставшееся тесто (примерно 6 стаканов) в форму диаметром 12 дюймов.                   │
│ Разместите формы диаметром 5 и 8 дюймов на центральной решетке духовки.                                                                                                                        │
│ Положите форму диаметром 12 дюймов на нижнюю решетку духовки.                                                                                                                                    │
│ Выпекайте торты, пока тестер, вставленный в центр, не выйдет чистым, примерно 35 минут.                                                                                             │
│ Переложите торты в формах на решетки и полностью остудите.                                                                                                                        │
│ Отметьте круг диаметром 4 дюйма на одном круглом картоне диаметром 6 дюймов.                                                                                                    │
│ Вырежьте отмеченный круг.                                                                                                                                                      │
│ Отметьте круг диаметром 7 дюймов на одном круглом картоне диаметром 8 дюймов.                                                                                                    │
│ Вырежьте отмеченный круг.                                                                                                                                                      │
│ Отметьте круг диаметром 11 дюймов на одном круглом картоне диаметром 12 дюймов.                                                                                                  │
│ Вырежьте отмеченный круг.                                                                                                                                                      │
│ Округлите стороны коржа диаметром 5 дюймов, чтобы освободить.                                                                                                                                  │
│ Положите 4-дюймовую картонку сверху формы.                                                                                                                                            │
│ Удерживайте картон и форму вместе; переверните торт на картон.                                                                                                              │
│ Снимите пергамент. Оберните торты в фольгу на картоне.                                                                                                                     │
│ Повторите переворачивание, снятие пергамента и обертывание тортов в фольгу, используя 7-дюймовый картон для 8-дюймового торта и 11-дюймовый картон для 12-дюймового торта.                        │
│ Используя оставшиеся ингредиенты, приготовьте еще 1 партию теста и выпекайте 3 дополнительных слоя торта, как описано выше.                                                               │
│ Остудите торты в формах.                                                                                                                                                         │
│ Плотно накройте торты в формах фольгой.                                                                                                                                      │
│ (Можно подготовить заранее.                                                                                                                                                     │
│ Оставьте при комнатной температуре до 1 дня или заверните все слои торта в два слоя и заморозьте до 1 недели.                                                                           │
│ Дайте слоям торта достичь комнатной температуры перед использованием.)                                                                                                                        │
│ Положите первый 12-дюймовый торт на его картон на рабочей поверхности.                                                                                                                  │
│ Нанесите 2 3/4 стакана ганаша на верх торта и до краев.                                                                                                         │
│ Нанесите 2/3 стакана варенья на ганаш, оставляя 1/2 дюйма шоколадной границы по краям.                                                                                                 │
│ Распределите 1 3/4 стакана белого шоколадного крема по варенью ложками.                                                                                                             │
│ Аккуратно распределите крем по варенью, оставляя 1/2 дюйма шоколадной границы по краям.                                                                                                 │
│ Обсыпьте немного какао-порошка вторую картонку диаметром 12 дюймов.                                                                                                                        │
│ Округлите стороны второго 12-дюймового торта, чтобы освободить.                                                                                                                          │
│ Положите картон, стороной с какао вниз, на форму.                                                                                                                                 │
│ Переверните торт на картон.                                                                                                                                               │
│ Снимите пергамент.                                                                                                                                                         │
│ Аккуратно сдвиньте торт с картона на начинку первого 12-дюймового торта.                                                                                                  │
│ Поставьте в холодильник.                                                                                                                                                                │
│ Положите первый 8-дюймовый торт на его картон на рабочей поверхности.                                                                                                                   │
│ Нанесите 1 стакан ганаша на верх до краев.                                                                                                                          │
│ Нанесите 1/4 стакана варенья, оставляя 1/2 дюйма шоколадной границы по краям.                                                                                                         │
│ Распределите 1 стакан белого шоколадного крема по варенью ложками.                                                                                                                  │
│ Аккуратно распределите крем по варенью, оставляя 1/2 дюйма шоколадной границы по краям.                                                                                                 │
│ Обсыпьте немного какао на второй картон диаметром 8 дюймов.                                                                                                                                │
│ Округлите стороны второго 8-дюймового торта, чтобы освободить.                                                                                                                           │
│ Положите картон, стороной с какао вниз, на форму.                                                                                                                                 │
│ Переверните торт на картон.                                                                                                                                               │
│ Снимите пергамент.                                                                                                                                                         │
│ Сдвиньте торт с картона на начинку первого 8-дюймового торта.                                                                                                             │
│ Поставьте в холодильник.                                                                                                                                                                │
│ Положите первый 5-дюймовый торт на его картон на рабочей поверхности.                                                                                                                   │
│ Нанесите 1/2 стакана ганаша на верх и до краев.                                                                                                            │
│ Нанесите 2 столовые ложки варенья, оставляя 1/2 дюйма шоколадной границы по краям.                                                                                                   │
│ Распределите 1/3 стакана белого шоколадного крема по варенью ложками.                                                                                                                │
│ Аккуратно распределите крем по варенью, оставляя 1/2 дюйма шоколадной границы по краям.                                                                                                 │
│ Обсыпьте немного какао на второй картон диаметром 6 дюймов.                                                                                                                                     │
│ Округлите стороны второго 5-дюймового торта, чтобы освободить.                                                                                                                           │
│ Положите картон, стороной с какао вниз, на форму.                                                                                                                                 │
│ Переверните торт на картон.                                                                                                                                               │
│ Снимите пергамент.                                                                                                                                                         │
│ Сдвиньте торт с картона на начинку первого 5-дюймового торта.                                                                                                             │
│ Охладите все торты 1 час, чтобы начинка затвердела.                                                                                                                                      │
│ Положите 12-дюймовый многоярусный торт на его картон на вращающемся подставке.                                                                                                         │
│ Нанесите 2 2/3 стакана крема на верх и стороны торта в качестве первого слоя.                                                                                                      │
│ Поставьте торт в холодильник.                                                                                                                                                           │
│ Положите 8-дюймовый многоярусный торт на его картон на подставке для торта.                                                                                                                    │
│ Нанесите 1 1/4 стакана крема на верх и стороны торта в качестве первого слоя.                                                                                                      │
│ Поставьте торт в холодильник.                                                                                                                                                           │
│ Положите 5-дюймовый многоярусный торт на его картон на подставке для торта.                                                                                                                    │
│ Нанесите 3/4 стакана крема на верх и стороны торта в качестве первого слоя.                                                                                                         │
│ Поставьте торты в холодильник, пока первый слой крема не застынет, примерно 1 час.                                                                                                      │
│ (Торты можно приготовить до этого момента за 1 день; закройте и храните в холодильнике.)                                                                                            │
│ Приготовьте вторую порцию крема, используя оставшиеся ингредиенты и следуя инструкциям для первой порции.                                                            │
│ Наполните 2 стакана крема кондитерским мешком с маленькой звездочкой.                                                                                                           │
│ Положите 12-дюймовый торт на его картон на большой плоской тарелке.                                                                                                                  │
│ Положите тарелку на подставку для торта.                                                                                                                                                │
│ С помощью шпателя распределите 2 1/2 стакана крема на верх и стороны торта; разгладьте верх.                                                                                     │
│ Используя заполненный кондитерский мешок, сделайте декоративный бордюр вокруг верхнего края торта.                                                                                                    │
│ Поставьте торт на тарелке в холодильник.                                                                                                                                                │
│ Положите 8-дюймовый торт на его картон на подставке для торта.                                                                                                                           │
│ Используя шпатель, распределите 1 1/2 стакана крема на верх и стороны торта; разгладьте верх.                                                                                     │
│ Используя кондитерский мешок, сделайте декоративный бордюр вокруг верхнего края торта.                                                                                                           │
│ Поставьте торт в холодильник на его картон.                                                                                                                                          │
│ Положите 5-дюймовый торт на его картон на подставке для торта.                                                                                                                           │
│ Используя шпатель, распределите 3/4 стакана крема на верх и стороны торта; разгладьте верх.                                                                                        │
│ Используя кондитерский мешок, сделайте декоративный бордюр вокруг верхнего края торта, при необходимости добавляя больше крема в мешок.                                                             │
│ Храните все торты в холодильнике, пока крем не застынет, примерно 2 часа.                                                                                                             │
│ (Можно приготовить за 2 дня.                                                                                                                                              │
│ Накройте loosely; храните в холодильнике.)                                                                                                                                          │
│ Положите 12-дюймовый торт на тарелку на рабочей поверхности.                                                                                                                              │
│ Вставьте 1 деревянный штырь прямо вниз в центр торта.                                                                                              │
│ Отметьте штырь на 1/4 дюйма выше верхушки крема.                                                                                                                                  │
│ Удалите штырь и отрежьте ножом с зубцами на отмеченной точке.                                                                                                                   │
│ Нарежьте 4 дополнительных штыря той же длины.                                                                                                                                           │
│ Вставьте 1 отрезанный штырь обратно в центр торта.                                                                                                                                 │
│ Вставьте оставшиеся 4 отрезанных штыря в торт, расположив 3 1/2 дюйма от краев торта и равномерно размещая.                                                                 │
│ Положите 8-дюймовый торт на его картон на рабочей поверхности.                                                                                                                         │
│ Вставьте 1 штырь прямо вниз в центр торта.                                                                                                     │
│ Отметьте штырь на 1/4 дюйма выше верхушки крема.                                                                                                                                  │
│ Удалите штырь и отрежьте ножом с зубцами на отмеченной точке.                                                                                                                   │
│ Нарежьте 3 дополнительных штыря той же длины.                                                                                                                                           │
│ Вставьте 1 отрезанный штырь обратно в центр торта.                                                                                                                                 │
│ Вставьте оставшиеся 3 отрезанных штыря в торт, расположив 2 1/2 дюйма от краев и равномерно размещая.                                                                      │
│ Используя большой металлический шпатель для помощи, положите 8-дюймовый торт на его картон на штырях в 12-дюймовом торте, аккуратно выровняв по центру.                                                      │
│ Аккуратно положите 5-дюймовый торт на его картон на штырях в 8-дюймовом торте, аккуратно выровняв по центру.                                                                                  │
│ Используя Citrus stripper, нарежьте длинные полоски апельсиновой корки с апельсинов.                                                                                                         │
│ Нарежьте полоски на длинные сегменты.                                                                                                                                              │
│ Чтобы сделать спирали из апельсиновой корки, оберните сегмент корки вокруг ручки деревянной ложки; аккуратно сдвиньте корку с ручки, чтобы корка сохраняла спиралевидную форму.                                   │
│ Украсить торт спиралями из апельсиновой корки, листьями плюща или мяты и несколькими ягодами.                                                                                                  │
│ (Собранный торт можно приготовить заранее до 8 часов.                                                                                                                            │
│ Оставьте стоять при прохладной комнатной температуре.)                                                                                                                                        │
│ Удалите верхние и средние ярусы торта.                                                                                                                                           │
│ Удалите штыри из тортов.                                                                                                                                                   │
│ Нарежьте верхние и средние торты на куски.                                                                                                                                       │
│ Чтобы нарезать 12-дюймовый торт: начиная с 3 дюймов из края и вставляя нож прямо вниз, нарежьте с верхней части до нижней, чтобы сделать круг диаметром 6 дюймов в центре торта. │
│ Нарежьте наружную часть торта на куски; нарежьте внутреннюю часть на куски и подавайте с клубникой.                                                                           │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

126 строк в наборе. Время выполнения: 0.011 сек. Обработано 8.19 тысячи строк, 5.34 МБ (737.75 тысяч строк/с., 480.59 МБ/с.)
```
### Онлайн Песочница {#online-playground}

Данные также доступны в [Онлайн Песочнице](https://sql.clickhouse.com?query_id=HQXNQZE26Z1QWYP9KC76ML).
