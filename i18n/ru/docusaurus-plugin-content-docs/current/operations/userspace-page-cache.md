---
description: 'механизм кэширования, предназначенный для размещения данных в памяти пользовательского процесса вместо использования кэша страниц ОС.'
sidebar_label: 'Кэш страниц в пространстве пользователя'
sidebar_position: 65
slug: /operations/userspace-page-cache
title: 'Кэш страниц в пространстве пользователя'
doc_type: 'reference'
---



# Кэш страниц в пользовательском пространстве



## Обзор {#overview}

> Кэш страниц в пользовательском пространстве — это новый механизм кэширования, который позволяет кэшировать
> данные в памяти процесса, не полагаясь на кэш страниц операционной системы.

ClickHouse уже предлагает [кэш файловой системы](/docs/operations/storing-data)
для кэширования данных поверх удалённого объектного хранилища, такого как Amazon S3, Google
Cloud Storage (GCS) или Azure Blob Storage. Кэш страниц в пользовательском пространстве предназначен
для ускорения доступа к удалённым данным в случаях, когда стандартное кэширование ОС работает недостаточно эффективно.

Он отличается от кэша файловой системы следующим образом:

| Кэш файловой системы                                    | Кэш страниц в пользовательском пространстве |
| ------------------------------------------------------- | ------------------------------------------- |
| Записывает данные в локальную файловую систему          | Хранится только в памяти                    |
| Занимает дисковое пространство (также может быть настроен на tmpfs) | Не зависит от файловой системы              |
| Сохраняется при перезапуске сервера                     | Не сохраняется при перезапуске сервера      |
| Не отображается в использовании памяти сервера          | Отображается в использовании памяти сервера |
| Подходит как для дисковых систем, так и для размещения в памяти (кэш страниц ОС) | **Подходит для бездисковых серверов**       |


## Настройки конфигурации и использование {#configuration-settings-and-usage}

### Использование {#usage}

Чтобы включить кеш страниц в пространстве пользователя, сначала настройте его на сервере:

```bash
cat config.d/page_cache.yaml
page_cache_max_size: 100G
```

:::note
Кеш страниц в пространстве пользователя будет использовать до указанного объема памяти, но
этот объем памяти не резервируется. Память будет освобождена, когда она потребуется
для других нужд сервера.
:::

Затем включите его использование на уровне запроса:

```sql
SET use_page_cache_for_disks_without_file_cache=1;
```

### Настройки {#settings}

| Настройка                                               | Описание                                                                                                                                                                                                                                                                                                               | По умолчанию |
| ------------------------------------------------------- | ---------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ----------- |
| `use_page_cache_for_disks_without_file_cache`           | Использовать кеш страниц в пространстве пользователя для удаленных дисков, для которых не включен кеш файловой системы.                                                                                                                                                                                                | `0`         |
| `use_page_cache_with_distributed_cache`                 | Использовать кеш страниц в пространстве пользователя при использовании распределенного кеша.                                                                                                                                                                                                                           | `0`         |
| `read_from_page_cache_if_exists_otherwise_bypass_cache` | Использовать кеш страниц в пространстве пользователя в пассивном режиме, аналогично [`read_from_filesystem_cache_if_exists_otherwise_bypass_cache`](/docs/operations/settings/settings#read_from_filesystem_cache_if_exists_otherwise_bypass_cache).                                                                    | `0`         |
| `page_cache_inject_eviction`                            | Кеш страниц в пространстве пользователя будет иногда случайным образом инвалидировать некоторые страницы. Предназначено для тестирования.                                                                                                                                                                              | `0`         |
| `page_cache_block_size`                                 | Размер блоков файлов для хранения в кеше страниц в пространстве пользователя, в байтах. Все операции чтения, проходящие через кеш, будут округлены до значения, кратного этому размеру.                                                                                                                                | `1048576`   |
| `page_cache_history_window_ms`                          | Задержка перед тем, как освобожденная память может быть использована кешем страниц в пространстве пользователя.                                                                                                                                                                                                        | `1000`      |
| `page_cache_policy`                                     | Название политики кеша страниц в пространстве пользователя.                                                                                                                                                                                                                                                            | `SLRU`      |
| `page_cache_size_ratio`                                 | Размер защищенной очереди в кеше страниц в пространстве пользователя относительно общего размера кеша.                                                                                                                                                                                                                 | `0.5`       |
| `page_cache_min_size`                                   | Минимальный размер кеша страниц в пространстве пользователя.                                                                                                                                                                                                                                                           | `104857600` |
| `page_cache_max_size`                                   | Максимальный размер кеша страниц в пространстве пользователя. Установите значение 0, чтобы отключить кеш. Если значение больше page_cache_min_size, размер кеша будет непрерывно корректироваться в этом диапазоне, чтобы использовать большую часть доступной памяти, сохраняя при этом общее использование памяти ниже предела (`max_server_memory_usage`\[`_to_ram_ratio`\]). | `0`         |
| `page_cache_free_memory_ratio`                          | Доля лимита памяти, которую необходимо держать свободной от кеша страниц в пространстве пользователя. Аналогично настройке min_free_kbytes в Linux.                                                                                                                                                                    | `0.15`      |
| `page_cache_lookahead_blocks`                           | При промахе кеша страниц в пространстве пользователя считывать до указанного количества последовательных блоков одновременно из базового хранилища, если они также отсутствуют в кеше. Каждый блок имеет размер page_cache_block_size байт.                                                                             | `16`        |
| `page_cache_shards`                                     | Разделить кеш страниц в пространстве пользователя на указанное количество сегментов для уменьшения конкуренции за мьютексы. Экспериментальная функция, вероятно, не улучшит производительность.                                                                                                                         | `4`         |


## Связанный контент {#related-content}

- [Кеш файловой системы](/docs/operations/storing-data)
- [Вебинар о релизе ClickHouse v25.3](https://www.youtube.com/live/iCKEzp0_Z2Q?feature=shared&t=1320)
