---
description: 'Ограничения TCP-соединений.'
sidebar_label: 'Ограничения TCP-соединений'
slug: /operations/settings/tcp-connection-limits
title: 'Ограничения TCP-соединений'
doc_type: 'reference'
---



# Ограничения на количество TCP-соединений



## Обзор {#overview}

TCP-соединение с ClickHouse (например, через [клиент командной строки](https://clickhouse.com/docs/interfaces/cli))
может автоматически разрываться после определённого количества запросов или по истечении заданного времени.
После разрыва соединения автоматическое переподключение не происходит (если только оно не инициировано чем-то другим,
например, отправкой нового запроса в клиенте командной строки).

Ограничения соединения включаются путём установки серверных настроек
`tcp_close_connection_after_queries_num` (для ограничения по количеству запросов)
или `tcp_close_connection_after_queries_seconds` (для ограничения по длительности) в значение больше 0.
Если включены оба ограничения, соединение закрывается при достижении любого из них первым.

При достижении ограничения и разрыве соединения клиент получает
исключение `TCP_CONNECTION_LIMIT_REACHED`, при этом **запрос, вызвавший разрыв соединения, не обрабатывается**.


## Ограничения на запросы {#query-limits}

Если параметр `tcp_close_connection_after_queries_num` установлен в значение N, то соединение позволяет выполнить N успешных запросов. При выполнении запроса N + 1 клиент отключается.

Каждый обработанный запрос учитывается в ограничении на количество запросов. Поэтому при подключении клиента командной строки может автоматически выполняться начальный системный запрос предупреждений, который также учитывается в этом ограничении.

Когда TCP-соединение простаивает (т. е. не обрабатывало запросы в течение некоторого времени, указанного в настройке сеанса `poll_interval`), счётчик обработанных запросов сбрасывается в 0. Это означает, что общее количество запросов в одном соединении может превысить значение `tcp_close_connection_after_queries_num`, если происходит простой.


## Ограничения по длительности {#duration-limits}

Длительность соединения измеряется с момента подключения клиента.
Клиент отключается при первом запросе после истечения `tcp_close_connection_after_queries_seconds` секунд.
