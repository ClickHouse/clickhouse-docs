---
description: 'Документация по ClickHouse Obfuscator'
slug: /operations/utilities/clickhouse-obfuscator
title: 'clickhouse-obfuscator'
doc_type: 'reference'
---

Простая утилита для обфускации данных таблиц.

Она считывает входную таблицу и создает выходную таблицу, которая сохраняет некоторые свойства исходных данных, но содержит другие значения.
Это позволяет публиковать данные, почти идентичные боевым, для использования в бенчмарках.

Она спроектирована для сохранения следующих свойств данных:

- кардинальности значений (количества различных значений) для каждого столбца и каждой комбинации столбцов;
- условных кардинальностей: количества различных значений одного столбца при условии значения другого столбца;
- распределений вероятностей абсолютного значения целых чисел; знака целых чисел со знаком; порядка и знака для чисел с плавающей запятой;
- распределений вероятностей длины строк;
- вероятности нулевых значений чисел; пустых строк и массивов, `NULL`-ов;

- коэффициента сжатия данных при сжатии кодеками семейства LZ77 и энтропийными кодеками;
- непрерывности (величины разности) значений времени по всей таблице; непрерывности значений с плавающей запятой;
- дата-компоненты значений `DateTime`;

- корректности строк как UTF-8;
- естественного вида строковых значений.

Большинство свойств, перечисленных выше, подходят для тестирования производительности:

чтение данных, фильтрация, агрегация и сортировка будут выполняться почти с той же скоростью,
что и на исходных данных, благодаря сохраненным кардинальностям, порядкам величин, коэффициентам сжатия и т. д.

Утилита работает детерминированно: вы задаете значение seed, и преобразование определяется входными данными и этим seed.
Некоторые преобразования взаимно-однозначны и могут быть обращены, поэтому вам нужно использовать достаточно большой seed и хранить его в секрете.

Для преобразования данных используются некоторые криптографические примитивы, но с криптографической точки зрения это делается некорректно, поэтому не стоит считать результат безопасным, если только у вас нет других оснований. Результат может сохранять некоторые данные, которые вы не хотите публиковать.

Утилита всегда оставляет числа 0, 1, -1, даты, длины массивов и флаги null в точности как в исходных данных.
Например, у вас есть столбец `IsMobile` в таблице со значениями 0 и 1. В преобразованных данных он будет иметь те же значения.

Таким образом, пользователь сможет посчитать точное соотношение мобильного трафика.

Рассмотрим еще один пример. Когда в вашей таблице есть приватные данные, такие как email пользователя, и вы не хотите публиковать ни одного реального адреса.
Если таблица достаточно большая, содержит множество различных email-адресов, и ни один email не имеет значительно большей частоты, чем остальные, то все данные будут анонимизированы. Но если в столбце имеется небольшое количество различных значений, некоторые из них могут быть воспроизведены.
Вам следует ознакомиться с принципом работы алгоритма этой утилиты и тонко настроить ее параметры командной строки.

Эта утилита хорошо работает только при хотя бы умеренном объеме данных (не менее нескольких тысяч строк).