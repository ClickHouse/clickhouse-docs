---
slug: /use-cases/observability/clickstack/alerts
title: 'Поиск в ClickStack'
sidebar_label: 'Оповещения'
pagination_prev: null
pagination_next: null
description: 'Оповещения в ClickStack'
doc_type: 'guide'
keywords: ['ClickStack', 'наблюдаемость', 'оповещения', 'поиск-оповещений', 'уведомления', 'пороговые-значения', 'slack', 'email', 'pagerduty', 'мониторинг-ошибок', 'мониторинг-производительности', 'пользовательские-события']
---

import Image from '@theme/IdealImage';
import search_alert from '@site/static/images/use-cases/observability/search_alert.png';
import edit_chart_alert from '@site/static/images/use-cases/observability/edit_chart_alert.png';
import add_chart_alert from '@site/static/images/use-cases/observability/add_chart_alert.png';
import create_chart_alert from '@site/static/images/use-cases/observability/create_chart_alert.png';
import alerts_search_view from '@site/static/images/use-cases/observability/alerts_search_view.png';
import add_new_webhook from '@site/static/images/use-cases/observability/add_new_webhook.png';
import add_webhook_dialog from '@site/static/images/use-cases/observability/add_webhook_dialog.png';
import manage_alerts from '@site/static/images/use-cases/observability/manage_alerts.png';
import alerts_view from '@site/static/images/use-cases/observability/alerts_view.png';
import multiple_search_alerts from '@site/static/images/use-cases/observability/multiple_search_alerts.png';
import remove_chart_alert from '@site/static/images/use-cases/observability/remove_chart_alert.png';


## Оповещения в ClickStack {#alerting-in-clickstack}

ClickStack включает встроенную поддержку оповещений, что позволяет командам обнаруживать проблемы и реагировать на них в режиме реального времени по данным журналов, метрик и трассировок.

Оповещения можно создавать непосредственно в интерфейсе HyperDX и интегрировать с популярными системами уведомлений, такими как Slack и PagerDuty.

Система оповещений работает со всеми данными ClickStack, помогая отслеживать состояние системы, выявлять регрессии производительности и мониторить ключевые бизнес-события.


## Типы оповещений {#types-of-alerts}

ClickStack поддерживает два взаимодополняющих способа создания оповещений: **оповещения по результатам поиска** и **оповещения по графикам дашборда**. После создания оповещение привязывается либо к поиску, либо к графику.

### 1. Оповещения по результатам поиска {#search-alerts}

Оповещения по результатам поиска позволяют отправлять уведомления на основе результатов сохраненного поиска. Они помогают обнаруживать случаи, когда определенные события или паттерны происходят чаще (или реже), чем ожидалось.

Оповещение срабатывает, когда количество совпадающих результатов в заданном временном окне превышает или опускается ниже указанного порогового значения.

Чтобы создать оповещение по результатам поиска:

<VerticalStepper headerLevel="h4">

Для создания оповещения поиск должен быть сохранен. Пользователи могут создать оповещение для существующего сохраненного поиска или сохранить поиск в процессе создания оповещения. В примере ниже предполагается, что поиск не сохранен.

#### Откройте диалоговое окно создания оповещения {#open-dialog}

Начните с ввода [поиска](/use-cases/observability/clickstack/search) и нажмите кнопку `Alerts` в правом верхнем углу страницы `Search`.

<Image img={alerts_search_view} alt='Alerts search view' size='lg' />

#### Создайте оповещение {#create-the-alert}

На панели создания оповещения вы можете:

- Назначить имя сохраненному поиску, связанному с оповещением.
- Установить пороговое значение и указать, сколько раз оно должно быть достигнуто в течение заданного периода. Пороговые значения также могут использоваться как верхние или нижние границы. Период также определяет, как часто срабатывает оповещение.
- Указать значение `grouped by`. Это позволяет применить к поиску агрегацию, например по `ServiceName`, что дает возможность запускать несколько оповещений на основе одного поиска.
- Выбрать webhook-адресат для уведомлений. Вы можете добавить новый webhook непосредственно из этого представления. Подробности см. в разделе [Добавление webhook](#add-webhook).

Перед сохранением ClickStack визуализирует пороговое условие, чтобы вы могли убедиться, что оно будет работать как ожидается.

<Image img={search_alert} alt='Search alerts' size='lg' />

</VerticalStepper>

Обратите внимание, что к поиску можно добавить несколько оповещений. Если повторить описанный выше процесс, пользователи увидят текущие оповещения в виде вкладок в верхней части диалогового окна редактирования оповещения, причем каждому оповещению присвоен номер.

<Image img={multiple_search_alerts} alt='Multiple alerts' size='md' />

### 2. Оповещения по графикам дашборда {#dashboard-alerts}

Оповещения дашборда расширяют функциональность оповещений на графики.

Вы можете создать оповещение на основе графика непосредственно из сохраненного дашборда, используя полные SQL-агрегации и функции ClickHouse для расширенных вычислений.

Когда метрика пересекает заданное пороговое значение, оповещение срабатывает автоматически, позволяя вам отслеживать KPI, задержки или другие ключевые метрики с течением времени.

:::note
Для создания оповещения для визуализации на дашборде дашборд должен быть сохранен.
:::

Чтобы добавить оповещение дашборда:

<VerticalStepper headerLevel="h4">

Оповещения можно создавать в процессе создания графика, при добавлении графика на дашборд или добавлять к существующим графикам. В примере ниже предполагается, что график уже существует на дашборде.

#### Откройте диалоговое окно редактирования графика {#open-chart-dialog}

Откройте меню конфигурации графика и выберите кнопку оповещения. Это откроет диалоговое окно редактирования графика.

<Image img={edit_chart_alert} alt='Edit chart alert' size='lg' />

#### Добавьте оповещение {#add-chart-alert}

Выберите **Add Alert**.

<Image img={add_chart_alert} alt='Add alert to chart' size='lg' />

#### Определите условия оповещения {#define-alert-conditions}

Определите условие (`>=`, `<`), пороговое значение, длительность и webhook. Длительность также определяет, как часто срабатывает оповещение.

<Image img={create_chart_alert} alt='Create alert for chart' size='lg' />

Вы можете добавить новый webhook непосредственно из этого представления. Подробности см. в разделе [Добавление webhook](#add-webhook).

</VerticalStepper>


## Добавление вебхука {#add-webhook}

При создании оповещения пользователи могут использовать существующий вебхук или создать новый. После создания вебхук будет доступен для повторного использования в других оповещениях.

Вебхук можно создать для различных типов сервисов, включая Slack и PagerDuty, а также для универсальных целей.

Например, рассмотрим создание оповещения для графика ниже. Перед указанием вебхука пользователь может выбрать `Add New Webhook`.

<Image img={add_new_webhook} alt='Добавить новый вебхук' size='lg' />

Откроется диалоговое окно создания вебхука, в котором пользователи могут создать новый вебхук:

<Image img={add_webhook_dialog} alt='Создание вебхука' size='md' />

Имя вебхука является обязательным, описание — необязательным. Другие настройки, которые необходимо заполнить, зависят от типа сервиса.

Обратите внимание, что в ClickStack Open Source и ClickStack Cloud доступны различные типы сервисов. См. раздел [Интеграции типов сервисов](#integrations).

### Интеграции типов сервисов {#integrations}

Оповещения ClickStack поддерживают готовую интеграцию со следующими типами сервисов:

- **Slack**: отправка уведомлений напрямую в канал через вебхук или API.
- **PagerDuty**: маршрутизация инцидентов для дежурных команд через API PagerDuty.
- **Webhook**: подключение оповещений к любой пользовательской системе или рабочему процессу через универсальный вебхук.

:::note Интеграции только для ClickHouse Cloud
Интеграции Slack API и PagerDuty поддерживаются только в ClickHouse Cloud.
:::

В зависимости от типа сервиса пользователям необходимо предоставить различные данные. А именно:

**Slack (URL вебхука)**

- URL вебхука. Например: `https://hooks.slack.com/services/<unique_path>`. Подробнее см. в [документации Slack](https://docs.slack.dev/messaging/sending-messages-using-incoming-webhooks/).

**Slack (API)**

- Токен бота Slack. Подробнее см. в [документации Slack](https://docs.slack.dev/authentication/tokens/#bot/).

**PagerDuty API**

- Ключ интеграции PagerDuty. Подробнее см. в [документации PagerDuty](https://support.pagerduty.com/main/docs/api-access-keys).

**Универсальный**

- URL вебхука
- Заголовки вебхука (необязательно)
- Тело вебхука (необязательно). Тело в настоящее время поддерживает переменные шаблона `{{title}}`, `{{body}}` и `{{link}}`.


## Управление оповещениями {#managing-alerts}

Оповещениями можно централизованно управлять через панель оповещений в левой части интерфейса HyperDX.

<Image img={manage_alerts} alt='Управление оповещениями' size='lg' />

В этом представлении пользователи могут видеть все оповещения, которые были созданы и в настоящее время активны в ClickStack.

<Image img={alerts_view} alt='Представление оповещений' size='lg' />

Это представление также отображает историю проверки оповещений. Оповещения проверяются через повторяющиеся временные интервалы (определяемые периодом/длительностью, заданными при создании оповещения). При каждой проверке HyperDX запрашивает ваши данные, чтобы определить, выполняется ли условие оповещения:

- **Красная полоса**: пороговое условие было выполнено во время этой проверки, и оповещение сработало (уведомление отправлено)
- **Зелёная полоса**: оповещение было проверено, но пороговое условие не было выполнено (уведомление не отправлено)

Каждая проверка независима — оповещение проверяет данные для данного временного окна и срабатывает только в том случае, если условие истинно в этот момент.

В приведённом выше примере первое оповещение срабатывало при каждой проверке, что указывает на постоянную проблему. Второе оповещение показывает решённую проблему — оно сработало дважды изначально (красные полосы), затем при последующих проверках пороговое условие больше не выполнялось (зелёные полосы).

Нажатие на оповещение переводит вас к графику или поиску, к которому привязано оповещение.

### Удаление оповещения {#deleting-alerts}

Чтобы удалить оповещение, откройте диалоговое окно редактирования для связанного поиска или графика, затем выберите **Remove Alert**.
В приведённом ниже примере кнопка `Remove Alert` удалит оповещение из графика.

<Image img={remove_chart_alert} alt='Удаление оповещения графика' size='lg' />


## Распространённые сценарии оповещений {#common-alert-scenarios}

Ниже приведены несколько распространённых сценариев оповещений, для которых можно использовать HyperDX:

**Ошибки:** Рекомендуется настроить оповещения для сохранённых поисковых запросов по умолчанию
`All Error Events` и `HTTP Status >= 400`, чтобы получать уведомления при
возникновении чрезмерного количества ошибок.

**Медленные операции:** Можно настроить поиск медленных операций (например,
`duration:>5000`) и затем настроить оповещение при возникновении слишком большого количества медленных операций.

**Пользовательские события:** Также можно настроить оповещения для команд, работающих с клиентами, чтобы
получать уведомления при регистрации новых пользователей или выполнении критически важных действий пользователя.
