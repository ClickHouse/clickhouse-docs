---
slug: /use-cases/observability/clickstack/alerts
title: 'Поиск с ClickStack'
sidebar_label: 'Оповещения'
pagination_prev: null
pagination_next: null
description: 'Оповещения с ClickStack'
doc_type: 'guide'
keywords: ['ClickStack', 'наблюдаемость', 'оповещения', 'поиск-оповещений', 'уведомления', 'пороги', 'slack', 'email', 'pagerduty', 'мониторинг-ошибок', 'мониторинг-производительности', 'пользовательские-события']
---

import Image from '@theme/IdealImage';
import search_alert from '@site/static/images/use-cases/observability/search_alert.png';
import edit_chart_alert from '@site/static/images/use-cases/observability/edit_chart_alert.png';
import add_chart_alert from '@site/static/images/use-cases/observability/add_chart_alert.png';
import create_chart_alert from '@site/static/images/use-cases/observability/create_chart_alert.png';
import alerts_search_view from '@site/static/images/use-cases/observability/alerts_search_view.png';
import add_new_webhook from '@site/static/images/use-cases/observability/add_new_webhook.png';
import add_webhook_dialog from '@site/static/images/use-cases/observability/add_webhook_dialog.png';
import manage_alerts from '@site/static/images/use-cases/observability/manage_alerts.png';
import alerts_view from '@site/static/images/use-cases/observability/alerts_view.png';
import multiple_search_alerts from '@site/static/images/use-cases/observability/multiple_search_alerts.png';
import remove_chart_alert from '@site/static/images/use-cases/observability/remove_chart_alert.png';


## Оповещения в ClickStack \\{#alerting-in-clickstack\\}

ClickStack включает встроенную поддержку оповещений, позволяя командам в реальном времени выявлять проблемы в логах, метриках и трейсах и оперативно на них реагировать.

Оповещения могут создаваться напрямую в интерфейсе HyperDX и интегрироваться с популярными системами уведомлений, такими как Slack и PagerDuty.

Механизм оповещений бесшовно работает со всеми вашими данными в ClickStack, помогая отслеживать состояние системы, выявлять регрессии производительности и мониторить ключевые бизнес-события.

## Типы оповещений \\{#types-of-alerts\\}

ClickStack поддерживает два взаимодополняющих способа создания оповещений: **оповещения по поиску (Search alerts)** и **оповещения по графикам дашборда (Dashboard chart alerts)**. После создания оповещение привязывается либо к поисковому запросу, либо к графику.

### 1. Оповещения по поиску \\{#search-alerts\\}

Оповещения по поиску позволяют запускать уведомления на основе результатов сохранённого поиска. Они помогают обнаруживать, когда определённые события или паттерны начинают происходить чаще (или реже), чем ожидается.

Оповещение срабатывает, когда количество совпадающих результатов в заданном временном окне превышает или становится ниже указанного порогового значения.

Чтобы создать оповещение по поиску:

<VerticalStepper headerLevel="h4">

Чтобы для поиска можно было создать оповещение, поиск должен быть сохранён. Пользователи могут либо создать оповещение для уже существующего сохранённого поиска, либо сохранить поиск в процессе создания оповещения. В примере ниже предполагается, что поиск не сохранён.

#### Откройте диалоговое окно создания оповещения \\{#open-dialog\\}

Сначала выполните [поиск](/use-cases/observability/clickstack/search) и нажмите кнопку `Alerts` в правом верхнем углу страницы `Search`.

<Image img={alerts_search_view} alt="Окно поиска с оповещениями" size="lg"/>

#### Создайте оповещение \\{#create-the-alert\\}

В панели создания оповещения вы можете:

- Задать имя сохранённому поиску, с которым связано оповещение.
- Настроить порог и указать, сколько раз он должен быть достигнут в течение заданного периода. Порог также можно использовать в качестве верхней или нижней границы. Указанный здесь период также определяет частоту срабатывания оповещения.
- Указать значение для `grouped by`. Это позволяет применить к поиску агрегацию, например по `ServiceName`, что даёт возможность запускать несколько оповещений от одного и того же поиска.
- Выбрать webhook-адрес для уведомлений. Вы можете добавить новый webhook прямо из этого окна. Подробнее см. в разделе [Добавление webhook](#add-webhook).

Перед сохранением ClickStack визуализирует условие срабатывания по порогу, чтобы вы могли убедиться, что оно будет работать ожидаемым образом.

<Image img={search_alert} alt="Оповещения по поиску" size="lg"/>

</VerticalStepper>

Обратите внимание, что к одному поиску можно добавить несколько оповещений. Если повторить описанный выше процесс, пользователи увидят текущие оповещения в виде вкладок в верхней части диалогового окна редактирования оповещения, при этом каждому оповещению будет присвоен номер.

<Image img={multiple_search_alerts} alt="Несколько оповещений" size="md"/>

### 2. Оповещения для графиков на дашборде \\{#dashboard-alerts\\}

Оповещения дашборда распространяют систему оповещений на графики.

Вы можете создать оповещение на основе графика напрямую из сохранённого дашборда, используя полноценные SQL-агрегации и функции ClickHouse для продвинутых вычислений.

Когда метрика пересекает заданный порог, оповещение срабатывает автоматически, что позволяет отслеживать KPI, задержки или другие ключевые метрики в динамике.

:::note
Чтобы для визуализации на дашборде можно было создать оповещение, дашборд должен быть сохранён.
:::

Чтобы добавить оповещение дашборда:

<VerticalStepper headerLevel="h4">

Оповещения можно создавать при создании графика, при добавлении графика на дашборд или добавлять к уже существующим графикам. В примере ниже предполагается, что график уже есть на дашборде.

#### Откройте диалог редактирования графика \\{#open-chart-dialog\\}

Откройте меню настроек графика и выберите кнопку оповещения. Откроется диалоговое окно редактирования графика.

<Image img={edit_chart_alert} alt="Редактирование оповещения для графика" size="lg"/>

#### Добавьте оповещение \\{#add-chart-alert\\}

Выберите **Add Alert**.

<Image img={add_chart_alert} alt="Добавить оповещение к графику" size="lg"/>

#### Задайте условия срабатывания оповещения \\{#define-alert-conditions\\}

Укажите условие (`>=`, `<`), порог, продолжительность и webhook. Здесь продолжительность также определяет, как часто будет срабатывать оповещение.

<Image img={create_chart_alert} alt="Создать оповещение для графика" size="lg"/>

Вы можете добавить новый webhook прямо с этого экрана. Подробности см. в разделе [Добавление webhook](#add-webhook).

</VerticalStepper>

## Добавление вебхука \\{#add-webhook\\}

При создании оповещения пользователи могут либо использовать существующий вебхук, либо создать новый. После создания вебхук будет доступен для повторного использования в других оповещениях.

Вебхук можно создать для разных типов сервисов, включая Slack и PagerDuty, а также для универсальных целей.

Например, рассмотрим создание оповещения для приведённого ниже графика. Перед указанием вебхука пользователь может выбрать `Add New Webhook`.

<Image img={add_new_webhook} alt="Добавить новый вебхук" size="lg"/>

Откроется диалог создания вебхука, где пользователи могут создать новый вебхук:

<Image img={add_webhook_dialog} alt="Создание вебхука" size="md"/>

Имя вебхука является обязательным, описание — необязательным. Остальные настройки, которые необходимо заполнить, зависят от типа сервиса.

Обратите внимание, что доступные типы сервисов различаются между ClickStack Open Source и ClickStack Cloud. См. раздел [Интеграции по типу сервиса](#integrations).

### Интеграции по типу сервиса \\{#integrations\\}

Оповещения ClickStack по умолчанию интегрируются со следующими типами сервисов:

- **Slack**: отправка уведомлений напрямую в канал через webhook или API.
- **PagerDuty**: маршрутизация инцидентов для дежурных команд через PagerDuty API.
- **Webhook**: подключение оповещений к любой пользовательской системе или рабочему процессу через универсальный webhook.

:::note Интеграции только для ClickHouse Cloud
Интеграции через Slack API и PagerDuty поддерживаются только в ClickHouse Cloud.
:::

В зависимости от типа сервиса вам потребуется указать разные параметры. В частности:

**Slack (Webhook URL)**

- URL вебхука. Например: `https://hooks.slack.com/services/<unique_path>`. Подробности см. в [документации Slack](https://docs.slack.dev/messaging/sending-messages-using-incoming-webhooks/).

**Slack (API)**

- Токен бота Slack. Подробности см. в [документации Slack](https://docs.slack.dev/authentication/tokens/#bot/).

**PagerDuty API**

- Ключ интеграции PagerDuty. Подробности см. в [документации PagerDuty](https://support.pagerduty.com/main/docs/api-access-keys).

**Generic**

- URL вебхука
- Заголовки вебхука (необязательно)
- Тело вебхука (необязательно). В теле на данный момент поддерживаются переменные шаблона `{{title}}`, `{{body}}` и `{{link}}`.

## Управление оповещениями \\{#managing-alerts\\}

Оповещениями можно централизованно управлять через панель оповещений слева в интерфейсе HyperDX.

<Image img={manage_alerts} alt="Управление оповещениями" size="lg"/>

В этом представлении пользователи могут видеть все оповещения, которые были созданы и в данный момент активны в ClickStack.

<Image img={alerts_view} alt="Просмотр оповещений" size="lg"/>

В этом представлении также отображается история проверок оповещений. Оповещения проверяются через регулярные промежутки времени (интервал определяется периодом/длительностью, заданными при создании оповещения). Во время каждой проверки HyperDX выполняет запрос к вашим данным, чтобы определить, выполнено ли условие оповещения:

- **Красная полоса**: пороговое условие было выполнено во время этой проверки, и оповещение сработало (уведомление отправлено)
- **Зелёная полоса**: оповещение было проверено, но пороговое условие не было выполнено (уведомление не отправлено)

Каждая проверка независима — оповещение анализирует данные за соответствующий временной интервал и срабатывает только в том случае, если условие истинно в этот момент.

В приведённом выше примере первое оповещение срабатывало при каждой проверке, что указывает на постоянную проблему. Второе оповещение показывает уже решённую проблему: оно сработало два раза вначале (красные полосы), затем при последующих проверках пороговое условие больше не выполнялось (зелёные полосы).

При нажатии на оповещение вы переходите к диаграмме или поисковому запросу, с которыми связано это оповещение.

### Удаление оповещения \\{#deleting-alerts\\}

Чтобы удалить оповещение, откройте диалог редактирования соответствующего поиска или графика, затем нажмите **Remove Alert**.
В примере ниже кнопка `Remove Alert` удалит оповещение с графика.

<Image img={remove_chart_alert} alt="Удаление оповещения с графика" size="lg"/>

## Типичные сценарии оповещений \\{#common-alert-scenarios\\}

Ниже приведены несколько распространённых сценариев оповещений, для которых вы можете использовать HyperDX:

**Ошибки:** Рекомендуем настроить оповещения для стандартных
сохранённых запросов `All Error Events` и `HTTP Status >= 400`, чтобы получать уведомления,
когда возникает слишком много ошибок.

**Медленные операции:** Вы можете настроить поиск медленных операций (например,
`duration:>5000`), а затем включить оповещения, когда происходит слишком много
таких операций.

**Пользовательские события:** Вы также можете настроить оповещения для команд,
работающих с клиентами, чтобы они получали уведомления, когда регистрируются
новые пользователи или выполняется критически важное действие пользователя.