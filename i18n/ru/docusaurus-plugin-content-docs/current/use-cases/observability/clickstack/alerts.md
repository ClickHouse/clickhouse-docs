---
slug: /use-cases/observability/clickstack/alerts
title: 'Поиск с помощью ClickStack'
sidebar_label: 'Оповещения'
pagination_prev: null
pagination_next: null
description: 'Оповещения с ClickStack'
doc_type: 'guide'
keywords: ['ClickStack', 'наблюдаемость', 'оповещения', 'поисковые оповещения', 'уведомления', 'пороги', 'Slack', 'Email', 'PagerDuty', 'мониторинг ошибок', 'мониторинг производительности', 'пользовательские события']
---

import Image from '@theme/IdealImage';
import search_alert from '@site/static/images/use-cases/observability/search_alert.png';
import edit_chart_alert from '@site/static/images/use-cases/observability/edit_chart_alert.png';
import add_chart_alert from '@site/static/images/use-cases/observability/add_chart_alert.png';
import create_chart_alert from '@site/static/images/use-cases/observability/create_chart_alert.png';
import alerts_search_view from '@site/static/images/use-cases/observability/alerts_search_view.png';
import add_new_webhook from '@site/static/images/use-cases/observability/add_new_webhook.png';
import add_webhook_dialog from '@site/static/images/use-cases/observability/add_webhook_dialog.png';
import manage_alerts from '@site/static/images/use-cases/observability/manage_alerts.png';
import alerts_view from '@site/static/images/use-cases/observability/alerts_view.png';
import multiple_search_alerts from '@site/static/images/use-cases/observability/multiple_search_alerts.png';
import remove_chart_alert from '@site/static/images/use-cases/observability/remove_chart_alert.png';


## Оповещения в ClickStack {#alerting-in-clickstack}

ClickStack включает встроенную поддержку оповещений, позволяя командам в режиме реального времени обнаруживать и устранять проблемы в логах, метриках и трейсах.

Оповещения можно создавать непосредственно в интерфейсе HyperDX и интегрировать с популярными системами уведомлений, такими как Slack и PagerDuty.

Механизм оповещений бесшовно работает со всеми вашими данными в ClickStack, помогая отслеживать состояние системы, выявлять деградацию производительности и контролировать ключевые бизнес-события.



## Типы оповещений {#types-of-alerts}

ClickStack поддерживает два взаимодополняющих способа создания оповещений: **поисковые оповещения** и **оповещения для графиков на дашборде**. После создания оповещение привязывается либо к поиску, либо к графику.

### 1. Поисковые оповещения {#search-alerts}

Поисковые оповещения позволяют отправлять уведомления на основе результатов сохранённого поиска. Они помогают обнаруживать, когда определённые события или закономерности начинают происходить чаще (или реже), чем ожидается.

Оповещение срабатывает, когда количество совпадающих результатов в заданном временном окне превышает или опускается ниже указанного порога.

Чтобы создать поисковое оповещение:

<VerticalStepper headerLevel="h4">

Чтобы для поиска было создано оповещение, поиск должен быть сохранён. Пользователи могут либо создать оповещение для уже существующего сохранённого поиска, либо сохранить поиск в процессе создания оповещения. В примере ниже предполагается, что поиск ещё не сохранён.

#### Откройте диалог создания оповещения {#open-dialog}

Начните с ввода [поискового запроса](/use-cases/observability/clickstack/search) и нажатия кнопки `Alerts` в правом верхнем углу страницы `Search`.

<Image img={alerts_search_view} alt="Вид поиска с оповещениями" size="lg"/>

#### Создайте оповещение {#create-the-alert}

В панели создания оповещения вы можете:

- Задать имя сохранённому поиску, связанному с оповещением.
- Установить порог и указать, сколько раз он должен быть достигнут в заданный период. Пороговые значения также могут использоваться как верхние или нижние границы. Этот период также будет определять, как часто срабатывает оповещение.
- Указать поле для группировки (`grouped by`). Это позволяет применить к поиску агрегацию, например по `ServiceName`, что даёт возможность запускать несколько оповещений на основе одного и того же поиска.
- Выбрать вебхук как место назначения для уведомлений. Вы можете добавить новый вебхук непосредственно из этого окна. Подробнее см. раздел [Добавление вебхука](#add-webhook).

Перед сохранением ClickStack визуализирует пороговое условие, чтобы вы могли убедиться, что оно будет работать ожидаемым образом.

<Image img={search_alert} alt="Поисковые оповещения" size="lg"/>

</VerticalStepper>

Обратите внимание, что к одному поиску можно добавить несколько оповещений. Если вышеописанный процесс повторить, пользователи увидят текущие оповещения в виде вкладок в верхней части диалога редактирования оповещения, при этом каждому оповещению будет присвоен номер.

<Image img={multiple_search_alerts} alt="Несколько оповещений" size="md"/>

### 2. Оповещения для графиков на дашборде {#dashboard-alerts}

Оповещения для дашбордов расширяют возможности оповещений на графики.

Вы можете создать оповещение на основе графика непосредственно из сохранённого дашборда, используя полноценные SQL-агрегации и функции ClickHouse для сложных вычислений.

Когда метрика пересекает заданный порог, оповещение срабатывает автоматически, позволяя отслеживать KPI, задержки или другие ключевые метрики во времени.

:::note
Чтобы для визуализации на дашборде было создано оповещение, дашборд должен быть сохранён.
:::

Чтобы добавить оповещение для дашборда:

<VerticalStepper headerLevel="h4">

Оповещения можно создавать в процессе создания графика, при добавлении графика на дашборд или добавлять к уже существующим графикам. В примере ниже предполагается, что график уже существует на дашборде.

#### Откройте диалог редактирования графика {#open-chart-dialog}

Откройте меню конфигурации графика и выберите кнопку оповещения. Появится диалог редактирования графика.

<Image img={edit_chart_alert} alt="Редактирование оповещения для графика" size="lg"/>

#### Добавьте оповещение {#add-chart-alert}

Выберите **Add Alert**.

<Image img={add_chart_alert} alt="Добавление оповещения к графику" size="lg"/>

#### Задайте условия оповещения {#define-alert-conditions}

Определите условие (`>=`, `<`), порог, длительность и вебхук. Эта длительность также будет определять, как часто срабатывает оповещение.

<Image img={create_chart_alert} alt="Создание оповещения для графика" size="lg"/>

Вы можете добавить новый вебхук непосредственно из этого окна. Подробнее см. раздел [Добавление вебхука](#add-webhook).

</VerticalStepper>



## Добавление webhook {#add-webhook}

При создании алерта пользователь может либо использовать существующий webhook, либо создать новый. После создания webhook будет доступен для повторного использования в других алертах.

Webhook можно создать для различных типов сервисов, включая Slack и PagerDuty, а также для универсальных (generic) назначений.

Например, рассмотрим создание алерта для графика ниже. Перед указанием webhook пользователь может выбрать `Add New Webhook`.

<Image img={add_new_webhook} alt="Добавление нового webhook" size="lg"/>

Откроется диалог создания webhook, в котором пользователи могут создать новый webhook:

<Image img={add_webhook_dialog} alt="Создание webhook" size="md"/>

Имя webhook является обязательным, тогда как описание — необязательно. Остальные обязательные настройки зависят от типа сервиса.

Обратите внимание, что доступные типы сервисов различаются между ClickStack Open Source и ClickStack Cloud. См. раздел [Интеграции типов сервисов](#integrations).

### Интеграции типов сервисов {#integrations}

Алерты ClickStack из коробки интегрируются со следующими типами сервисов:

- **Slack**: отправка уведомлений напрямую в канал через webhook или API.
- **PagerDuty**: маршрутизация инцидентов для дежурных команд через PagerDuty API.
- **Webhook**: подключение алертов к любой пользовательской системе или рабочему процессу через универсальный webhook.

:::note Интеграции, доступные только в ClickHouse Cloud
Интеграции через Slack API и PagerDuty поддерживаются только в ClickHouse Cloud.
:::

В зависимости от типа сервиса пользователям потребуется указать разные данные. В частности:

**Slack (Webhook URL)**

- Webhook URL. Например: `https://hooks.slack.com/services/<unique_path>`. Дополнительную информацию см. в [документации Slack](https://docs.slack.dev/messaging/sending-messages-using-incoming-webhooks/).

**Slack (API)**

- Токен бота Slack. Дополнительную информацию см. в [документации Slack](https://docs.slack.dev/authentication/tokens/#bot/).

**PagerDuty API**

- Интеграционный ключ PagerDuty. Дополнительную информацию см. в [документации PagerDuty](https://support.pagerduty.com/main/docs/api-access-keys).

**Generic**

- Webhook URL
- Заголовки webhook (опционально)
- Тело webhook (опционально). Тело в данный момент поддерживает шаблонные переменные `{{title}}`, `{{body}}` и `{{link}}`.



## Управление оповещениями {#managing-alerts}

Оповещениями можно централизованно управлять через панель оповещений в левой части интерфейса HyperDX.

<Image img={manage_alerts} alt="Управление оповещениями" size="lg"/>

На этом экране пользователи видят все оповещения, которые были созданы и в данный момент активны в ClickStack.

<Image img={alerts_view} alt="Представление оповещений" size="lg"/>

Здесь также отображается история проверок оповещений. Оповещения проверяются через регулярные интервалы времени (определяются периодом/длительностью, заданными при создании оповещения). Во время каждой проверки HyperDX выполняет запрос к вашим данным, чтобы проверить, выполнено ли условие оповещения:

- **Красная полоса**: пороговое условие было выполнено во время этой проверки, и оповещение сработало (уведомление отправлено)
- **Зелёная полоса**: оповещение было проверено, но пороговое условие не было выполнено (уведомление не отправлено)

Каждая проверка независима: оповещение проверяет данные за своё временное окно и срабатывает только в том случае, если условие истинно в этот момент.

В приведённом выше примере первое оповещение срабатывало при каждой проверке, что указывает на постоянную проблему. Второе оповещение показывает уже решённую проблему: оно дважды сработало вначале (красные полосы), затем при последующих проверках пороговое условие больше не выполнялось (зелёные полосы).

Щелчок на оповещении переводит вас к диаграмме или поисковому запросу, с которым связано это оповещение.

### Удаление оповещения {#deleting-alerts}

Чтобы удалить оповещение, откройте диалог редактирования связанного поиска или диаграммы, затем выберите **Remove Alert**.
В примере ниже кнопка `Remove Alert` удалит оповещение с диаграммы.

<Image img={remove_chart_alert} alt="Удаление оповещения с диаграммы" size="lg"/>



## Типовые сценарии оповещений {#common-alert-scenarios}

Вот несколько типовых сценариев оповещений, для которых вы можете использовать HyperDX:

**Ошибки:** Рекомендуем настроить оповещения для сохранённых поисковых запросов по умолчанию
`All Error Events` и `HTTP Status >= 400`, чтобы получать уведомления, когда
количество ошибок превышает допустимый порог.

**Медленные операции:** Вы можете настроить поиск медленных операций (например,
`duration:>5000`), а затем создать оповещение на случаи, когда таких медленных
операций становится слишком много.

**Пользовательские события:** Вы также можете настроить оповещения для команд,
работающих с клиентами, чтобы они получали уведомления, когда регистрируются
новые пользователи или выполняется критически важное пользовательское действие.
