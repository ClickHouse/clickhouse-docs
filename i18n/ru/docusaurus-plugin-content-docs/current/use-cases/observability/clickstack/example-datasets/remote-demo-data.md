---
slug: /use-cases/observability/clickstack/getting-started/remote-demo-data
title: 'Удалённый демонстрационный набор данных'
sidebar_position: 2
pagination_prev: null
pagination_next: null
description: 'Начало работы с ClickStack и удалённым демонстрационным набором данных'
doc_type: 'guide'
keywords: ['clickstack', 'пример данных', 'демонстрационный набор данных', 'логи', 'наблюдаемость']
---

import Image from '@theme/IdealImage';
import demo_connection from '@site/static/images/use-cases/observability/hyperdx-demo/demo_connection.png';
import edit_demo_connection from '@site/static/images/use-cases/observability/hyperdx-demo/edit_demo_connection.png';
import edit_demo_source from '@site/static/images/use-cases/observability/hyperdx-demo/edit_demo_source.png';
import step_2 from '@site/static/images/use-cases/observability/hyperdx-demo/step_2.png';
import step_3 from '@site/static/images/use-cases/observability/hyperdx-demo/step_3.png';
import step_4 from '@site/static/images/use-cases/observability/hyperdx-demo/step_4.png';
import step_5 from '@site/static/images/use-cases/observability/hyperdx-demo/step_5.png';
import step_6 from '@site/static/images/use-cases/observability/hyperdx-demo/step_6.png';
import step_7 from '@site/static/images/use-cases/observability/hyperdx-demo/step_7.png';
import step_8 from '@site/static/images/use-cases/observability/hyperdx-demo/step_8.png';
import step_9 from '@site/static/images/use-cases/observability/hyperdx-demo/step_9.png';
import step_10 from '@site/static/images/use-cases/observability/hyperdx-demo/step_10.png';
import step_11 from '@site/static/images/use-cases/observability/hyperdx-demo/step_11.png';
import step_12 from '@site/static/images/use-cases/observability/hyperdx-demo/step_12.png';
import step_13 from '@site/static/images/use-cases/observability/hyperdx-demo/step_13.png';
import step_14 from '@site/static/images/use-cases/observability/hyperdx-demo/step_14.png';
import step_15 from '@site/static/images/use-cases/observability/hyperdx-demo/step_15.png';
import step_16 from '@site/static/images/use-cases/observability/hyperdx-demo/step_16.png';
import step_17 from '@site/static/images/use-cases/observability/hyperdx-demo/step_17.png';
import step_18 from '@site/static/images/use-cases/observability/hyperdx-demo/step_18.png';
import step_19 from '@site/static/images/use-cases/observability/hyperdx-demo/step_19.png';
import step_20 from '@site/static/images/use-cases/observability/hyperdx-demo/step_20.png';
import step_21 from '@site/static/images/use-cases/observability/hyperdx-demo/step_21.png';
import step_22 from '@site/static/images/use-cases/observability/hyperdx-demo/step_22.png';
import step_23 from '@site/static/images/use-cases/observability/hyperdx-demo/step_23.png';
import step_24 from '@site/static/images/use-cases/observability/hyperdx-demo/step_24.png';
import demo_sources from '@site/static/images/use-cases/observability/hyperdx-demo//demo_sources.png';
import edit_connection from '@site/static/images/use-cases/observability/edit_connection.png';
import DemoArchitecture from '@site/docs/use-cases/observability/clickstack/example-datasets/_snippets/_demo.md';

**В данном руководстве предполагается, что вы развернули ClickStack, используя [инструкции для образа «всё-в-одном»](/use-cases/observability/clickstack/getting-started) или [режим Local Mode Only](/use-cases/observability/clickstack/deployment/local-mode-only), и завершили первоначальное создание пользователя. В качестве альтернативы вы можете пропустить всю локальную настройку и просто подключиться к нашему размещённому демо ClickStack [play-clickstack.clickhouse.com](https://play-clickstack.clickhouse.com), которое использует этот набор данных.**

В этом руководстве используется пример набора данных, размещённый в общедоступной песочнице ClickHouse по адресу [sql.clickhouse.com](https://sql.clickhpouse.com), к которой вы можете подключиться из своего локального развертывания ClickStack.

:::warning Не поддерживается для HyperDX в ClickHouse Cloud
Удалённые базы данных не поддерживаются, когда HyperDX развёрнут в ClickHouse Cloud. Соответственно, этот набор данных не поддерживается.
:::


Он содержит примерно 40 часов данных, полученных из ClickHouse-версии официального демо OpenTelemetry (OTel). Данные каждую ночь воспроизводятся заново с метками времени, приведёнными к текущему временному интервалу, что позволяет пользователям исследовать поведение системы с помощью журналов, трассировок и метрик, интегрированных в HyperDX.

:::note Вариации данных
Поскольку набор данных каждый день воспроизводится с полуночи, конкретные визуализации могут отличаться в зависимости от того, когда вы просматриваете демо.
:::



## Демонстрационный сценарий {#demo-scenario}

В этой демонстрации мы исследуем инцидент, связанный с интернет-магазином, который продает телескопы и сопутствующие аксессуары.

Служба поддержки клиентов сообщила, что пользователи сталкиваются с проблемами при завершении оплаты на этапе оформления заказа. Проблема была передана на расследование команде SRE (Site Reliability Engineering).

Используя HyperDX, команда SRE проанализирует журналы, трассировки и метрики, чтобы диагностировать и устранить проблему, а затем изучит данные пользовательских сессий, чтобы подтвердить, соответствуют ли сделанные выводы фактическому поведению пользователей.



## Демо OpenTelemetry {#otel-demo}

В этом демо используется [форк официального демо OpenTelemetry](https://github.com/ClickHouse/opentelemetry-demo), поддерживаемый ClickStack.

<DemoArchitecture/>



## Демонстрационные шаги {#demo-steps}

**Мы инструментировали эту демонстрацию с помощью [SDK ClickStack](/use-cases/observability/clickstack/sdks), развернув сервисы в Kubernetes, из которых также были собраны метрики и логи.**

<VerticalStepper headerLevel="h3">

### Подключение к демонстрационному серверу {#connect-to-the-demo-server}

:::note Режим «только локальный»
Этот шаг можно пропустить, если вы нажали `Connect to Demo Server` при развертывании в локальном режиме. Если используется этот режим, источники будут иметь префикс `Demo_`, например `Demo_Logs`.
:::

Перейдите в `Team Settings` и нажмите `Edit` для `Local Connection`:

<Image img={edit_connection} alt='Редактировать подключение' size='lg' />

Переименуйте подключение в `Demo` и заполните следующую форму следующими параметрами подключения для демонстрационного сервера:

- `Connection Name`: `Demo`
- `Host`: `https://sql-clickhouse.clickhouse.com`
- `Username`: `otel_demo`
- `Password`: Оставьте пустым

<Image img={edit_demo_connection} alt='Редактировать подключение демо' size='lg' />

### Настройка источников {#modify-sources}

:::note Режим «только локальный»
Этот шаг можно пропустить, если вы нажали `Connect to Demo Server` при развертывании в локальном режиме. Если используется этот режим, источники будут иметь префикс `Demo_`, например `Demo_Logs`.
:::

Прокрутите вверх до `Sources` и измените каждый из источников — `Logs`, `Traces`, `Metrics` и `Sessions` — чтобы использовать базу данных `otel_v2`.

<Image img={edit_demo_source} alt='Изменить источник демо' size='lg' />

:::note
Возможно, потребуется обновить страницу, чтобы убедиться, что полный список баз данных отображается в каждом источнике.
:::

### Настройка временного интервала {#adjust-the-timeframe}

Настройте временной диапазон, чтобы отобразить все данные за предыдущие `1 day`, используя селектор времени в правом верхнем углу.

<Image img={step_2} alt='Шаг 2' size='lg' />

Вы можете заметить небольшую разницу в количестве ошибок в обзорной столбчатой диаграмме с небольшим увеличением красного цвета в нескольких последовательных столбцах.

:::note
Расположение столбцов будет отличаться в зависимости от времени запроса набора данных.
:::

### Фильтрация по ошибкам {#filter-to-errors}

Чтобы выделить случаи ошибок, используйте фильтр `SeverityText` и выберите `error`, чтобы отобразить только записи уровня ошибки.

Ошибка должна стать более заметной:

<Image img={step_3} alt='Шаг 3' size='lg' />

### Определение шаблонов ошибок {#identify-error-patterns}

С помощью функции кластеризации HyperDX вы можете автоматически выявлять ошибки и группировать их в значимые шаблоны. Это ускоряет анализ при работе с большими объемами логов и трассировок. Чтобы использовать её, выберите `Event Patterns` в меню `Analysis Mode` на левой панели.

Кластеры ошибок выявляют проблемы, связанные с неудачными платежами, включая именованный шаблон `Failed to place order`. Дополнительные кластеры также указывают на проблемы со списанием средств с карт и переполненными кэшами.

<Image img={step_4} alt='Шаг 4' size='lg' />

Обратите внимание, что эти кластеры ошибок, вероятно, происходят из разных сервисов.

### Исследование шаблона ошибки {#explore-error-pattern}

Нажмите на наиболее очевидный кластер ошибок, который коррелирует с нашей сообщенной проблемой завершения платежей пользователями: `Failed to place order`.

Это отобразит список всех случаев этой ошибки, связанных с сервисом `frontend`:

<Image img={step_5} alt='Шаг 5' size='lg' />

Выберите любую из получившихся ошибок. Метаданные логов отобразятся в деталях. Просмотр `Overview` и `Column Values` указывает на проблему со списанием средств с карт из-за кэша:

`failed to charge card: could not charge the card: rpc error: code = Unknown desc = Visa cache full: cannot add new item.`

<Image img={step_6} alt='Шаг 6' size='lg' />

### Исследование инфраструктуры {#explore-the-infrastructure}

Мы выявили ошибку, связанную с кэшем, которая, вероятно, вызывает сбои платежей. Нам все еще нужно определить источник этой проблемы в нашей микросервисной архитектуре.

Учитывая проблему с кэшем, логично исследовать базовую инфраструктуру — возможно, у нас проблема с памятью в связанных подах? В ClickStack логи и метрики объединены и отображаются в контексте, что упрощает быстрое выявление коренной причины.

Выберите вкладку `Infrastructure`, чтобы просмотреть метрики, связанные с базовыми подами сервиса `frontend`, и расширьте временной интервал до `1d`:

<Image img={step_7} alt='Шаг 7' size='lg' />


Похоже, что проблема не связана с инфраструктурой — ни одна метрика заметно не изменилась за рассматриваемый период: ни до, ни после возникновения ошибки. Закройте вкладку инфраструктуры.

### Исследование трейса {#explore-a-trace}

В ClickStack трейсы также автоматически коррелируются как с логами, так и с метриками. Давайте исследуем трейс, связанный с выбранным логом, чтобы определить сервис, отвечающий за ошибку.

Выберите `Trace`, чтобы визуализировать соответствующий трейс. Прокрутив представление вниз, мы можем увидеть, как HyperDX визуализирует распределённый трейс по микросервисам, соединяя спаны в каждом сервисе. Платёж явно затрагивает несколько микросервисов, включая те, которые выполняют оформление заказа и конвертацию валют.

<Image img={step_8} alt="Step 8" size="lg"/>

Прокрутив представление до конца вниз, мы видим, что сервис `payment` вызывает ошибку, которая затем распространяется обратно вверх по цепочке вызовов. 

<Image img={step_9} alt="Step 9" size="lg"/>

### Поиск по трейсам {#searching-traces} 

Мы установили, что пользователи не могут завершить покупки из-за проблемы с кэшем в сервисе `payment`. Давайте изучим трейсы для этого сервиса подробнее, чтобы попытаться лучше понять первопричину.

Переключитесь в основное представление поиска, выбрав `Search`. Переключите источник данных на `Traces` и выберите представление `Results table`. **Убедитесь, что интервал времени по‑прежнему охватывает последние сутки.**

<Image img={step_10} alt="Step 10" size="lg"/>

В этом представлении показываются все трейсы за последние сутки. Мы знаем, что проблема возникает в нашем сервисе `payment`, поэтому примените фильтр `payment` к полю `ServiceName`.

<Image img={step_11} alt="Step 11" size="lg"/>

Если мы применим кластеризацию событий к трейсам, выбрав `Event Patterns`, мы сразу увидим нашу проблему с кэшем в сервисе `payment`.

<Image img={step_12} alt="Step 12" size="lg"/>

### Исследование инфраструктуры для трейса {#explore-infrastructure-for-a-trace}

Переключитесь в представление результатов, нажав `Results table`. Отфильтруйте ошибки, используя фильтр `StatusCode` и значение `Error`. 

<Image img={step_13} alt="Step 13" size="lg"/>

Выберите ошибку `Error: Visa cache full: cannot add new item.`, переключитесь на вкладку `Infrastructure` и расширьте интервал времени до `1d`.

<Image img={step_14} alt="Step 14" size="lg"/>

Коррелируя трейсы с метриками, мы видим, что в сервисе `payment` возросли потребление памяти и CPU, а затем упали до `0` (мы можем связать это с перезапуском пода), что указывает на то, что проблема с кэшем вызвала проблемы с ресурсами. Можно ожидать, что это повлияло на время завершения платежей.

### Event Deltas для более быстрого разрешения инцидента {#event-deltas-for-faster-resolution} 

Event Deltas помогают выявлять аномалии, связывая изменения в производительности или уровне ошибок с конкретными подмножествами данных — это упрощает быструю локализацию первопричины. 

Хотя мы знаем, что в сервисе `payment` есть проблема с кэшем, приводящая к увеличению потребления ресурсов, мы ещё не до конца определили первопричину.

Вернитесь в представление таблицы результатов и выберите период времени, содержащий ошибки, чтобы сузить набор данных. Убедитесь, что вы выбрали несколько часов до появления ошибок и, по возможности, после (проблема может всё ещё проявляться):

<Image img={step_15} alt="Step 15" size="lg"/>

Удалите фильтр по ошибкам и выберите `Event Deltas` в левом меню `Analysis Mode`.

<Image img={step_16} alt="Step 16" size="lg"/>

Верхняя панель показывает распределение времён выполнения, где цвета обозначают плотность событий (количество спанов). Подмножества событий вне основной концентрации обычно представляют наибольший интерес для анализа.

Если мы выберем события с длительностью более `200ms` и применим фильтр `Filter by selection`, можно ограничить анализ более медленными событиями:

<Image img={step_17} alt="Step 17" size="lg"/>

После выполнения анализа над этим подмножеством данных мы видим, что большинство всплесков задержек связаны с транзакциями `visa`.

### Использование графиков для дополнительного контекста {#using-charts-for-more-context}

В ClickStack мы можем строить графики по любым числовым значениям из логов, трейсов или метрик для получения дополнительного контекста. 

Мы установили:

- Проблема связана с сервисом `payment`
- Кэш заполнен
- Это вызвало увеличение потребления ресурсов
- Проблема помешала успешному завершению платежей по картам Visa — или, по крайней мере, привела к значительному увеличению времени их выполнения.

<br/>

Выберите `Chart Explorer` в левом меню. Заполните следующие значения, чтобы построить график времени, затрачиваемого на завершение платежей, по типу графика:



- `Источник данных`: `Traces`
- `Метрика`: `Maximum`
- `SQL Column`: `Duration`
- `Where`: `ServiceName: payment`
- `Период`: `Последние сутки`

<br />

Щёлкните `▶️`, чтобы увидеть, как со временем ухудшалась производительность платежей.

<Image img={step_18} alt='Шаг 18' size='lg' />

Если установить для `Group By` значение `SpanAttributes['app.payment.card_type']` (просто введите `card` для автодополнения), мы увидим, как производительность сервиса для транзакций Visa ухудшалась по сравнению с Mastercard:

<Image img={step_19} alt='Шаг 19' size='lg' />

Обратите внимание, что после возникновения ошибки ответы приходят с временем `0s`.

### Изучение метрик для дополнительного контекста {#exploring-metrics-for-more-context}

Наконец, отобразим размер кэша как метрику, чтобы увидеть, как он изменялся со временем и получить дополнительный контекст.

Укажите следующие значения:

- `Источник данных`: `Metrics`
- `Метрика`: `Maximum`
- `SQL Column`: `visa_validation_cache.size (gauge)` (просто введите `cache` для автодополнения)
- `Where`: `ServiceName: payment`
- `Group By`: `<empty>`

Мы видим, как размер кэша увеличивался в течение 4–5 часов (вероятно, после развертывания ПО), пока не достиг максимального значения `100,000`. В `Sample Matched Events` видно, что наши ошибки коррелируют с достижением этим кэшем данного предела; после этого его размер фиксируется как `0`, а время ответов также становится `0s`.

<Image img={step_20} alt='Шаг 20' size='lg' />

Подводя итог, изучив логи, трейсы и, наконец, метрики, мы пришли к следующим выводам:

- Проблема связана с сервисом платежей
- Изменение поведения сервиса, вероятно из‑за развертывания, привело к медленному росту кэша Visa в течение 4–5 часов, пока его размер не достиг `100,000`.
- Это вызвало рост потребления ресурсов по мере увеличения размера кэша — вероятно, из‑за неудачной реализации.
- По мере роста кэша производительность платежей Visa ухудшалась.
- Достигнув максимального размера, кэш начал отклонять платежи и сообщать о своём размере как `0`.

### Использование сеансов {#using-sessions}

Сеансы позволяют воспроизвести пользовательский опыт, предоставляя наглядное представление о том, как произошла ошибка с точки зрения пользователя. Хотя их обычно не используют для диагностики первопричин, они ценны для подтверждения проблем, о которых сообщили в службу поддержки, и могут служить отправной точкой для более глубокого расследования.

В HyperDX сеансы связаны с трейсами и логами, что обеспечивает полный обзор первопричины.

Например, если команда поддержки предоставляет адрес электронной почты пользователя, у которого возникла проблема с платежом, `Braulio.Roberts23@hotmail.com`, часто эффективнее начать с его сеанса, а не с прямого поиска по логам или трейсам.

Перейдите на вкладку `Client Sessions` в левом меню, затем убедитесь, что источник данных установлен на `Sessions`, а период — на `Последние сутки`:

<Image img={step_21} alt='Шаг 21' size='lg' />

Найдите `SpanAttributes.userEmail: Braulio`, чтобы найти сеанс нашего клиента. После выбора сеанса слева будут показаны события браузера и связанные спаны для сеанса клиента, а справа — воспроизведённый пользовательский опыт в браузере:

<Image img={step_22} alt='Шаг 22' size='lg' />

### Воспроизведение сеансов {#replaying-sessions}

Сеансы можно воспроизводить, нажимая кнопку ▶️. Переключение между `Highlighted` и `All Events` позволяет задавать различную степень детализации спанов, при этом первый режим подсвечивает ключевые события и ошибки.

Если пролистать список спанов до конца, мы увидим ошибку `500`, связанную с `/api/checkout`. Нажав кнопку ▶️ для этого конкретного спана, мы переместим воспроизведение к этой точке сеанса и сможем подтвердить опыт клиента: платёж, по‑видимому, просто не проходит, при этом никакая ошибка не отображается.

<Image img={step_23} alt='Шаг 23' size='lg' />

Выбрав этот спан, мы можем подтвердить, что причина — внутренняя ошибка. Щёлкнув вкладку `Trace` и пролистав связанные спаны, мы убеждаемся, что клиент действительно пострадал от нашей проблемы с кэшем.

<Image img={step_24} alt='Шаг 24' size='lg' />

</VerticalStepper>

В этой демонстрации рассматривается реальный инцидент с неудавшимися платежами в e-commerce‑приложении и показывается, как ClickStack помогает выявлять первопричины с помощью объединённых логов, трейсов, метрик и повторов сеансов. Изучите наши [другие руководства по началу работы](/use-cases/observability/clickstack/sample-datasets), чтобы глубже погрузиться в отдельные возможности.
