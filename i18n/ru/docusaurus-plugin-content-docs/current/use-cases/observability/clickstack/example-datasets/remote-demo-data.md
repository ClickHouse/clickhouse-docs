---
'slug': '/use-cases/observability/clickstack/getting-started/remote-demo-data'
'title': 'Удаленный демонстрационный набор данных'
'sidebar_position': 2
'pagination_prev': null
'pagination_next': null
'description': 'Начало работы с ClickStack и удаленным демонстрационным набором данных'
'doc_type': 'guide'
---
import Image from '@theme/IdealImage';
import demo_connection from '@site/static/images/use-cases/observability/hyperdx-demo/demo_connection.png';
import edit_demo_connection from '@site/static/images/use-cases/observability/hyperdx-demo/edit_demo_connection.png';
import edit_demo_source from '@site/static/images/use-cases/observability/hyperdx-demo/edit_demo_source.png';
import step_2 from '@site/static/images/use-cases/observability/hyperdx-demo/step_2.png';
import step_3 from '@site/static/images/use-cases/observability/hyperdx-demo/step_3.png';
import step_4 from '@site/static/images/use-cases/observability/hyperdx-demo/step_4.png';
import step_5 from '@site/static/images/use-cases/observability/hyperdx-demo/step_5.png';
import step_6 from '@site/static/images/use-cases/observability/hyperdx-demo/step_6.png';
import step_7 from '@site/static/images/use-cases/observability/hyperdx-demo/step_7.png';
import step_8 from '@site/static/images/use-cases/observability/hyperdx-demo/step_8.png';
import step_9 from '@site/static/images/use-cases/observability/hyperdx-demo/step_9.png';
import step_10 from '@site/static/images/use-cases/observability/hyperdx-demo/step_10.png';
import step_11 from '@site/static/images/use-cases/observability/hyperdx-demo/step_11.png';
import step_12 from '@site/static/images/use-cases/observability/hyperdx-demo/step_12.png';
import step_13 from '@site/static/images/use-cases/observability/hyperdx-demo/step_13.png';
import step_14 from '@site/static/images/use-cases/observability/hyperdx-demo/step_14.png';
import step_15 from '@site/static/images/use-cases/observability/hyperdx-demo/step_15.png';
import step_16 from '@site/static/images/use-cases/observability/hyperdx-demo/step_16.png';
import step_17 from '@site/static/images/use-cases/observability/hyperdx-demo/step_17.png';
import step_18 from '@site/static/images/use-cases/observability/hyperdx-demo/step_18.png';
import step_19 from '@site/static/images/use-cases/observability/hyperdx-demo/step_19.png';
import step_20 from '@site/static/images/use-cases/observability/hyperdx-demo/step_20.png';
import step_21 from '@site/static/images/use-cases/observability/hyperdx-demo/step_21.png';
import step_22 from '@site/static/images/use-cases/observability/hyperdx-demo/step_22.png';
import step_23 from '@site/static/images/use-cases/observability/hyperdx-demo/step_23.png';
import step_24 from '@site/static/images/use-cases/observability/hyperdx-demo/step_24.png';
import demo_sources from '@site/static/images/use-cases/observability/hyperdx-demo//demo_sources.png';
import edit_connection from '@site/static/images/use-cases/observability/edit_connection.png';
import DemoArchitecture from '@site/i18n/ru/docusaurus-plugin-content-docs/current/use-cases/observability/clickstack/example-datasets/_snippets/_demo.md';

**Следующее руководство предполагает, что вы развернули ClickStack, используя [инструкции для образа "все в одном"](/use-cases/observability/clickstack/getting-started) или [только локальный режим](/use-cases/observability/clickstack/deployment/local-mode-only) и завершили создание начальных пользователей. В качестве альтернативы пользователи могут пропустить всю локальную настройку и просто подключиться к нашему хостингу ClickStack демо по адресу [play-clickstack.clickhouse.com](https://play-clickstack.clickhouse.com), который использует этот набор данных.**

Это руководство использует выборочный набор данных, размещенный на публичном playground ClickHouse по адресу [sql.clickhouse.com](https://sql.clickhouse.com), к которому вы можете подключиться из вашего локального развертывания ClickStack.

:::warning Не поддерживается с HyperDX в ClickHouse Cloud
Удаленные базы данных не поддерживаются, когда HyperDX размещен в ClickHouse Cloud. Поэтому этот набор данных не поддерживается.
:::

Он содержит примерно 40 часов данных, захваченных из версии ClickHouse официальной демонстрации OpenTelemetry (OTel). Данные воспроизводятся каждую ночь с подправленными временными метками до текущего временного окна, позволяя пользователям исследовать поведение системы с помощью интегрированных логов, трассировок и метрик HyperDX.

:::note Вариации данных
Поскольку набор данных воспроизводится с полуночи каждый день, точные визуализации могут варьироваться в зависимости от того, когда вы исследуете демо.
:::

## Сценарий демо {#demo-scenario}

В этом демонстрационном примере мы исследуем инцидент, связанный с веб-сайтом электронной торговли, который продает телескопы и сопутствующие аксессуары.

Служба поддержки клиентов сообщила, что пользователи испытывают проблемы с завершением платежей на этапе оформления заказа. Проблема была передана команде по обеспечению надежности сайта (SRE) для расследования.

Используя HyperDX, команда SRE проанализирует логи, трассировки и метрики, чтобы диагностировать и решить проблему, а затем просмотреть данные сессий, чтобы подтвердить, соответствуют ли их выводы фактическому поведению пользователей.

## Демонстрация OpenTelemetry {#otel-demo}

Этот демо использует [форк, поддерживаемый ClickStack](https://github.com/ClickHouse/opentelemetry-demo), официальной демонстрации OpenTelemetry.

<DemoArchitecture/>

## Этапы демо {#demo-steps}

**Мы инструментировали это демо с помощью [ClickStack SDKs](/use-cases/observability/clickstack/sdks), развернув службы в Kubernetes, из которых также были собраны метрики и логи.**

<VerticalStepper headerLevel="h3">

### Подключение к демо-серверу {#connect-to-the-demo-server}

:::note Только режим локальной работы
Этот шаг можно пропустить, если вы нажали `Подключиться к демо-серверу` при развертывании в локальном режиме. Если вы используете этот режим, источники будут иметь префикс `Demo_`, например, `Demo_Logs`
:::

Перейдите в `Настройки команды` и нажмите `Редактировать` для `Локального подключения`:

<Image img={edit_connection} alt="Edit Connection" size="lg"/>

Переименуйте соединение в `Demo` и заполните последующую форму следующими данными для подключения к демо-серверу:

- `Имя подключения`: `Demo`
- `Хост`: `https://sql-clickhouse.clickhouse.com`
- `Имя пользователя`: `otel_demo`
- `Пароль`: Оставьте пустым

<Image img={edit_demo_connection} alt="Edit Demo Connection" size="lg"/>

### Изменение источников {#modify-sources}

:::note Только режим локальной работы
Этот шаг можно пропустить, если вы нажали `Подключиться к демо-серверу` при развертывании в локальном режиме. Если вы используете этот режим, источники будут иметь префикс `Demo_`, например, `Demo_Logs`
:::

Прокрутите вверх до `Источников` и измените каждый из источников - `Логи`, `Трассировки`, `Метрики` и `Сессии` - чтобы использовать базу данных `otel_v2`.

<Image img={edit_demo_source} alt="Edit Demo Source" size="lg"/>

:::note
Возможно, вам потребуется обновить страницу, чтобы убедиться, что полный список баз данных отображается в каждом источнике.
:::

### Настройка временного интервала {#adjust-the-timeframe}

Настройте время, чтобы показать все данные за предыдущие `1 день` с помощью селектора времени в верхнем правом углу.

<Image img={step_2} alt="Step 2" size="lg"/>

Вы можете заметить небольшую разницу в количестве ошибок в сводном гистограмме, с небольшим увеличением красного в нескольких последовательных столбцах.

:::note
Расположение столбцов будет отличаться в зависимости от того, когда вы запрашиваете набор данных.
:::

### Фильтрация по ошибкам {#filter-to-errors}

Чтобы выделить случаи ошибок, используйте фильтр `SeverityText` и выберите `error`, чтобы отобразить только записи уровня ошибки.

Ошибка должна быть более очевидной:

<Image img={step_3} alt="Step 3" size="lg"/>

### Определение паттернов ошибок {#identify-error-patterns}

С помощью функции кластеризации HyperDX вы можете автоматически идентифицировать ошибки и группировать их в осмысленные паттерны. Это ускоряет анализ для пользователей при работе с большими объемами логов и трассировок. Чтобы использовать это, выберите `Паттерны событий` в меню `Режим анализа` на левой панели.

Кластеры ошибок показывают проблемы, связанные с неудачными платежами, включая наименованный паттерн `Не удалось оформить заказ`. Дополнительные кластеры также указывают на проблемы с зарядкой карт и полными кэшами.

<Image img={step_4} alt="Step 4" size="lg"/>

Обратите внимание, что эти кластеры ошибок, вероятно, происходят из разных служб.

### Исследование паттерна ошибки {#explore-error-pattern}

Нажмите на наиболее очевидные кластеры ошибок, которые коррелируют с нашей сообщенной проблемой завершения платежей: `Не удалось оформить заказ`.

Это отобразит список всех случаев этой ошибки, связанных со службой `frontend`:

<Image img={step_5} alt="Step 5" size="lg"/>

Выберите любую из полученных ошибок. Метаданные логов будут показаны в деталях. Проходя через `Обзор` и `Значения столбцов`, можно заметить проблему с зарядкой карт из-за кэша:

`не удалось зарядить карту: не удалось зарядить карту: ошибка rpc: код = Unknown desc = Кэш Visa переполнен: не удается добавить новый элемент.`

<Image img={step_6} alt="Step 6" size="lg"/>

### Исследование инфраструктуры {#explore-the-infrastructure}

Мы идентифицировали ошибку, связанную с кэшем, которая, вероятно, вызывает сбои платежей. Нам все еще нужно определить, откуда эта проблема происходит в нашей микросервисной архитектуре.

Учитывая проблему с кэшем, имеет смысл исследовать основную инфраструктуру - возможно, у нас есть проблемы с памятью в связанных подах? В ClickStack логи и метрики объединены и отображаются в контексте, что позволяет быстрее найти коренную причину.

Выберите вкладку `Инфраструктура`, чтобы просмотреть метрики, связанные с подами для службы `frontend`, и увеличьте временной диапазон до `1d`:

<Image img={step_7} alt="Step 7" size="lg"/>

Проблема, похоже, не связана с инфраструктурой - ни одна из метрик не изменилась существенно за этот период времени: ни до, ни после ошибки. Закройте вкладку инфраструктуры.

### Исследование трассировки {#explore-a-trace}

В ClickStack трассировки также автоматически коррелируются как с логами, так и с метриками. Давайте исследуем трассировку, связанную с нашим выбранным логом, чтобы идентифицировать ответственную службу.

Выберите `Трасировка`, чтобы визуализировать соответствующую трассировку. Прокручивая вниз через последующий вид, мы можем увидеть, как HyperDX визуализирует распределенную трассировку через микросервисы, соединяя промежутки в каждой службе. Платеж явно включает несколько микросервисов, включая те, которые обрабатывают оформление заказов и конверсии валюты.

<Image img={step_8} alt="Step 8" size="lg"/>

Прокручивая к низу вида, мы можем увидеть, что служба `payment` вызывает ошибку, которая затем передается обратно по последовательности вызовов.

<Image img={step_9} alt="Step 9" size="lg"/>

### Поиск трассировок {#searching-traces} 

Мы установили, что пользователи не могут завершить покупки из-за проблемы с кэшем в службе платежей. Давайте подробнее изучим трассировки для этой службы, чтобы узнать больше о коренной причине.

Переключитесь на основной вид Поиска, выбрав `Поиск`. Переключите источник данных для `Трассировок` и выберите вид `Таблица результатов`. **Убедитесь, что временной диапазон все еще составляет за последний день.**

<Image img={step_10} alt="Step 10" size="lg"/>

Этот вид показывает все трассировки за последний день. Мы знаем, что проблема исходит из нашей службы платежей, поэтому примените фильтр `payment` к `ServiceName`.

<Image img={step_11} alt="Step 11" size="lg"/>

Если мы применим кластеризацию событий к трассировкам, выбрав `Паттерны событий`, мы сможем сразу увидеть нашу проблему с кэшем в службе `payment`.

<Image img={step_12} alt="Step 12" size="lg"/>

### Исследование инфраструктуры для трасировки {#explore-infrastructure-for-a-trace}

Переключитесь на вид результатов, нажав на `Таблица результатов`. Отфильтруйте ошибки, используя фильтр `StatusCode` и значение `Error`. 

<Image img={step_13} alt="Step 13" size="lg"/>

Выберите ошибку `Error: Кэш Visa переполнен: не удается добавить новый элемент.`, переключитесь на вкладку `Инфраструктура` и увеличьте временной диапазон до `1d`.

<Image img={step_14} alt="Step 14" size="lg"/>

Сопоставляя трассировки с метриками, мы можем увидеть, что память и CPU возросли вместе со службой `payment` до обрушения до `0` (мы можем отнести это к перезапуску пода) - что указывает на то, что проблема с кэшем вызвала проблемы с ресурсами. Мы можем ожидать, что это повлияло на время завершения платежей.

### Дельты событий для более быстрого разрешения {#event-deltas-for-faster-resolution} 

Дельты событий помогают выявить аномалии, приписывая изменения в производительности или уровне ошибок к конкретным подмножествам данных, что упрощает быстрое обнаружение коренной причины. 

Хотя мы знаем, что служба `payment` имеет проблему с кэшем, что вызывает увеличение потребления ресурсов, мы еще не полностью идентифицировали коренную причину.

Вернитесь к виду таблицы результатов и выберите временной период, содержащий ошибки, чтобы ограничить данные. Убедитесь, что вы выбрали несколько часов слева от ошибок и после, если это возможно (проблема может все еще проявляться):

<Image img={step_15} alt="Step 15" size="lg"/>

Удалите фильтр ошибок и выберите `Дельты событий` из левого меню `Режим анализа`.

<Image img={step_16} alt="Step 16" size="lg"/>

В верхней панели отображается распределение временных интервалов, с цветами, указывающими плотность событий (количество промежутков). Подмножество событий, находящееся вне основной концентрации, обычно стоит исследовать.

Если мы выберем события с длительностью более `200ms` и применим фильтр `Фильтровать по выбору`, мы можем ограничить наш анализ более медленными событиями:

<Image img={step_17} alt="Step 17" size="lg"/>

С анализом, проведенным на подмножестве данных, мы можем видеть, что большинство всплесков производительности связано с транзакциями `visa`.

### Использование графиков для большего контекста {#using-charts-for-more-context}

В ClickStack мы можем строить графики для любого числового значения из логов, трассировок или метрик для получения большей ясности. 

Мы установили:

- Наша проблема заключается в службе платежей
- Кэш переполнен
- Это вызвало увеличение потребления ресурсов
- Проблема препятствовала завершению платежей по Visa - или, по крайней мере, заставила их долго завершаться.

<br/>

Выберите `Обозреватель графиков` в левом меню. Заполните следующие значения для построения графика времени завершения платежей по типу графика:

- `Источник данных`: `Трассировки`
- `Метрика`: `Максимум`
- `SQL Колонка`: `Продолжительность`
- `Где`: `ServiceName: payment`
- `Временной диапазон`: `За последние 1 день`

<br/>

Нажатие `▶️` покажет, как производительность платежей ухудшалась с течением времени. 

<Image img={step_18} alt="Step 18" size="lg"/>

Если мы установим `Group By` на `SpanAttributes['app.payment.card_type']` (просто напишите `card` для автозаполнения), мы увидим, как ухудшилась производительность службы для транзакций Visa относительно Mastercard:

<Image img={step_19} alt="Step 19" size="lg"/>

Обратите внимание, что после того, как произошла ошибка, ответы возвращаются за `0s`.

### Исследование метрик для большего контекста {#exploring-metrics-for-more-context}

Наконец, давайте отобразим размер кэша как метрику, чтобы увидеть, как он вел себя во времени, тем самым давая нам больше контекста.

Заполните следующие значения:

- `Источник данных`: `Метрики`
- `Метрика`: `Максимум`
- `SQL Колонка`: `visa_validation_cache.size (gauge)` (просто напишите `cache` для автозаполнения)
- `Где`: `ServiceName: payment`
- `Group By`: `<empty>`

Мы можем увидеть, как размер кэша увеличивался в течение 4-5 часов (скорее всего, после развертывания программного обеспечения), прежде чем достичь максимального размера в `100,000`. Из `Sample Matched Events` мы можем увидеть, что наши ошибки коррелируют с достижением кэшем этого предела, и после этого его размер фиксируется как `0`, а ответы также возвращаются за `0s`.

<Image img={step_20} alt="Step 20" size="lg"/>

В итоге, исследуя логи, трассировки и, наконец, метрики, мы пришли к заключению:

- Наша проблема заключается в службе платежей
- Изменение поведения службы, вероятно, из-за развертывания, привело к медленному увеличению размера кэша Visa в течение 4-5 часов - достижение максимального размера в `100,000`.
- Это вызвало увеличение потребления ресурсов по мере увеличения размера кэша - вероятно, из-за плохой реализации
- По мере роста кэша производительность платежей Visa ухудшалась
- Достигнув максимального размера, кэш отклонял платежи и сообщал о себе как о размере `0`.

### Использование сессий {#using-sessions} 

Сессии позволяют нам воспроизвести пользовательский опыт, предлагая визуальный отчет о том, как произошла ошибка с точки зрения пользователя. Хотя они не используются для диагностики коренных причин, они полезны для подтверждения проблем, сообщенных в службу поддержки клиентов, и могут служить отправной точкой для более глубокого расследования.

В HyperDX сессии связаны с трассировками и логами, предоставляя полный обзор коренной причины.

Например, если команда поддержки предоставляет адрес электронной почты пользователя, который столкнулся с проблемой платежа `Braulio.Roberts23@hotmail.com` - обычно более эффективно начать с их сессии, чем сразу искать логи или трассировки.

Перейдите на вкладку `Клиентские сессии` в левом меню, убедившись, что источник данных установлен на `Сессии`, а временной период выбран на `За последние 1 день`:

<Image img={step_21} alt="Step 21" size="lg"/>

Поиск по `SpanAttributes.userEmail: Braulio` позволит найти сессию нашего клиента. Выбор сессии покажет события браузера и связанные промежутки для сессии клиента слева, с повторным отображением пользовательского опыта браузера справа:

<Image img={step_22} alt="Step 22" size="lg"/>

### Воспроизведение сессий {#replaying-sessions} 

Сессии могут быть воспроизведены, нажав кнопку ▶️. Переключение между `Выделенными` и `Все события` позволяет варьировать уровень детализации промежутков, при этом первое выделяет ключевые события и ошибки. 

Если мы прокручиваем вниз до конца промежутков, мы можем увидеть ошибку `500`, связанную с `/api/checkout`. Нажатие кнопки ▶️ для этого конкретного промежутка перемещает воспроизведение в эту точку в сессии, позволяя нам подтвердить опыт клиента - платеж, кажется, просто не работает, никакая ошибка не отображается.

<Image img={step_23} alt="Step 23" size="lg"/>

Выбирая промежуток, мы можем подтвердить, что это вызвано внутренней ошибкой. Нажимая на вкладку `Трассировка` и прокручивая через связанные промежутки, мы можем подтвердить, что клиент действительно стал жертвой нашей проблемы с кэшем.

<Image img={step_24} alt="Step 24" size="lg"/>

</VerticalStepper>

Это демонстрационное руководство проводит через реальный инцидент, связанный с неудачными платежами в приложении электронной торговли, показывая, как ClickStack помогает выявлять коренные причины через объединенные логи, трассировки, метрики и воспроизведения сессий - изучите наши [другие руководства по началу работы](/use-cases/observability/clickstack/sample-datasets), чтобы глубже погрузиться в конкретные функции.