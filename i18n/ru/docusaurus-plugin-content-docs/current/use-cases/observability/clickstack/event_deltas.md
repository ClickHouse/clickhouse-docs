---
'slug': '/use-cases/observability/clickstack/event_deltas'
'title': 'Событийные делы с ClickStack'
'sidebar_label': 'Событийные делы'
'pagination_prev': null
'pagination_next': null
'description': 'Событийные делы с ClickStack'
'doc_type': 'guide'
---
import Image from '@theme/IdealImage';
import event_deltas from '@site/static/images/use-cases/observability/hyperdx-demo/step_17.png';
import event_deltas_no_selected from '@site/static/images/use-cases/observability/event_deltas_no_selected.png';
import event_deltas_highlighted from '@site/static/images/use-cases/observability/event_deltas_highlighted.png';
import event_deltas_selected from '@site/static/images/use-cases/observability/event_deltas_selected.png';
import event_deltas_issue from '@site/static/images/use-cases/observability/event_deltas_issue.png';
import event_deltas_outliers from '@site/static/images/use-cases/observability/event_deltas_outliers.png';
import event_deltas_separation from '@site/static/images/use-cases/observability/event_deltas_separation.png';
import event_deltas_inappropriate from '@site/static/images/use-cases/observability/event_deltas_inappropriate.png';

Event Deltas в ClickStack - это функция, ориентированная на трассировки, которая автоматически анализирует свойства трассировок, чтобы выявить, что изменилось, когда производительность снизилась. Сравнивая распределения задержки нормальных и медленных трассировок в корпусе, ClickStack выделяет, какие атрибуты имеют наибольшее отношение к различию - будь то новая версия развертывания, конкретная конечная точка или определенный идентификатор пользователя.

Вместо того чтобы вручную просматривать данные трассировок, Event Deltas выявляют ключевые свойства, определяющие различия в задержке между двумя подмножествами данных, что значительно упрощает диагностику регрессий и нахождение коренных причин. Эта функция позволяет вам визуализировать исходные трассировки и сразу же увидеть факторы, влияющие на изменения производительности, ускоряя реагирование на инциденты и снижая среднее время до разрешения.

<Image img={event_deltas} alt="Event Deltas" size="lg"/>

## Использование Event Deltas {#using-event-deltas}

Event Deltas доступны напрямую через панель **Поиск** в ClickStack при выборе источника типа `Trace`.

В верхнем левом углу выберите режим **Анализ** и выберите **Event Deltas** (при этом источник должен быть `Trace`), чтобы переключиться с обычной таблицы результатов, которая отображает промежутки в виде строк.

<Image img={event_deltas_no_selected} alt="Event Deltas not selected" size="lg"/>

Этот вид отображает распределение промежутков во времени, показывая, как задержка варьируется в зависимости от объема. Вертикальная ось представляет задержку, в то время как цветовое отображение указывает на плотность трассировок в данной точке, где более яркие желтые области соответствуют более высокой концентрации трассировок. С помощью этой визуализации пользователи могут быстро увидеть, как промежутки распределяются по задержке и количеству, что упрощает выявление сдвигов или аномалий в производительности.

<Image img={event_deltas_highlighted} alt="Event Deltas highlighted" size="lg"/>

Пользователи могут затем выбрать область визуализации - желательно с более высокими промежутками по длительности и достаточной плотностью, после чего выбрать **Фильтровать по выбору**. Это обозначает «выбросы» для анализа. Event Deltas затем определят столбцы и ключевые значения, наиболее связанные с этими промежутками в этом подмножестве выбросов по сравнению с остальной частью набора данных. Сосредоточив внимание на областях с значительными выбросами, ClickStack выделяет уникальные значения, которые отличают это подмножество от общего корпуса, выявляя атрибуты, наиболее связанные с наблюдаемыми различиями в производительности.

<Image img={event_deltas_selected} alt="Event Deltas selected" size="lg"/>

Для каждого столбца ClickStack определяет значения, которые сильно смещены в сторону выбранного подмножества выбросов. Иными словами, когда значение появляется в столбце, если оно встречается преимущественно в выбросах, а не в общем наборе данных (включения), оно выделяется как значительное. Столбцы с наибольшим смещением перечислены в первую очередь, выявляя атрибуты, наиболее сильно связанные с аномальными промежутками и отличающимися от базового поведения.

<Image img={event_deltas_outliers} alt="Event Deltas outliers" size="lg"/>

Рассмотрим пример выше, где столбец `SpanAttributes.app.payment.card_type` был выделен. Здесь анализ Event Deltas показывает, что `29%` включений используют MasterCard, при этом среди выбросов - `0%`, а `100%` выбросов используют Visa, по сравнению с `71%` включений. Это предполагает, что тип карты Visa сильно связан с аномальными, высокозадерженными трассировками, в то время как MasterCard встречается только в нормальном подмножестве.

<Image img={event_deltas_issue} alt="Event Deltas issue" size="lg"/>

Напротив, значения, исключительно связанные с включениями, тоже могут быть интересными. В примере выше ошибка `Visa Cash Full` встречается исключительно в включениях и полностью отсутствует среди выбросов. Когда это происходит, задержка всегда менее приблизительно 50 миллисекунд, что предполагает, что эта ошибка связана с низкими задержками.

## Как работают Event Deltas {#how-event-deltas-work}

Event Deltas работают, выполняя два запроса: один для выбранной области выбросов и один для области включений. Каждый запрос ограничен соответствующей длительностью и временным окном. Затем проверяется выборка событий из обоих наборов результатов, и идентифицируются столбцы, для которых высокая концентрация значений встречается преимущественно в выбросах. Столбцы, для которых 100% значения встречается только в подмножестве выбросов, показываются первыми, выделяя атрибуты, наиболее ответственные за наблюдаемые различия.

## Рекомендации {#recommendations}

Event Deltas работают лучше всего, когда анализ сосредоточен на конкретной службе. Задержка между несколькими службами может сильно варьироваться, что затрудняет определение столбцов и значений, наиболее ответственных за выбросы. Перед активацией Event Deltas отфильтруйте промежутки до набора, где распределение задержек ожидается как схожее. Ориентируйтесь на анализ наборов, где широкая вариация задержек не ожидается для наиболее полезных инсайтов, избегая случаев, когда это является нормой (например, две разные службы).

При выборе области пользователи должны стремиться к подмножествам, в которых есть четкое распределение медленных и быстрых длительностей, позволяя более высокозадержанным промежуткам быть четко выделенными для анализа. Например, примите во внимание выделенную область ниже, которая четко захватывает набор более медленных промежутков для анализа.

<Image img={event_deltas_separation} alt="Event Deltas Separation" size="lg"/>

Напротив, следующий набор данных трудно проанализировать полезным образом с помощью Event Deltas.

<Image img={event_deltas_inappropriate} alt="Event Deltas Poor separation" size="lg"/>