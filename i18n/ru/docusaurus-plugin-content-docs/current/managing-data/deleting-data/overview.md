---
slug: /deletes/overview
title: Обзор удаления
description: Как удалять данные в ClickHouse
keywords: ['удаление', 'усечь', 'удалить', 'легкое удаление']
---

Существует несколько способов удаления данных в ClickHouse, каждый из которых имеет свои преимущества и характеристики производительности. Вы должны выбрать подходящий метод в зависимости от вашей модели данных и объема данных, который вы собираетесь удалить.

| Метод | Синтаксис | Когда использовать |
| --- | --- | --- |
| [Легкое удаление](/guides/developer/lightweight-delete) | `DELETE FROM [table]` | Используйте при удалении небольших объемов данных. Строки сразу исключаются из всех последующих запросов `SELECT`, но изначально просто отмечаются как удаленные, а не удаляются с диска. |
| [Удаление с помощью мутации](/sql-reference/statements/alter/delete) | `ALTER TABLE [table] DELETE` | Используйте, когда данные должны быть немедленно удалены с диска (например, для соблюдения нормативных требований). Отрицательно влияет на производительность `SELECT`. |
| [Усечь таблицу](/sql-reference/statements/truncate) | `TRUNCATE TABLE [db.table]` | Эффективно удаляет все данные из таблицы. |
| [Удалить партицию](/sql-reference/statements/alter/partition#drop-partitionpart) | `DROP PARTITION` | Эффективно удаляет все данные из партиции. |

Вот краткое резюме различных способов удаления данных в ClickHouse:

## Легкие удаления {#lightweight-deletes}

Легкие удаления позволяют строкам быть немедленно отмеченными как удаленные, таким образом они могут быть автоматически исключены из всех последующих запросов `SELECT`. Последующее удаление этих удаленных строк происходит во время естественных циклов слияния и, следовательно, требует меньше I/O. В результате возможно, что в течение неопределенного времени данные фактически не удаляются из хранения и только отмечаются как удаленные. Если вам необходимо гарантировать, что данные удалены, рассмотрите вышеупомянутую команду мутации.

```sql
-- удалить все данные за 2018 год с помощью мутации. Не рекомендуется.
DELETE FROM posts WHERE toYear(CreationDate) = 2018
```

Удаление больших объемов данных с помощью легкого оператора `DELETE` также может отрицательно сказаться на производительности запросов `SELECT`. Команда также несовместима с таблицами с проекциями.

Обратите внимание, что мутация используется в операции для [отметки удаленных строк](/sql-reference/statements/delete#how-lightweight-deletes-work-internally-in-clickhouse) (добавляя колонку `_row_exists`), тем самым требуя некоторого I/O.

В целом, легкие удаления должны предпочтаться мутациям, если существование удаленных данных на диске может быть терпимо (например, в случаях, не связанных с соблюдением норм). Этот подход все равно следует избегать, если все данные должны быть удалены.

Читайте больше о [легких удалениях](/guides/developer/lightweight-delete).

## Удаления с помощью мутаций {#delete-mutations}

Удаления с помощью мутаций могут быть выданы через команду `ALTER TABLE … DELETE`, например:

```sql
-- удалить все данные за 2018 год с помощью мутации. Не рекомендуется.
ALTER TABLE posts DELETE WHERE toYear(CreationDate) = 2018
```

Эти операции могут выполняться либо синхронно (по умолчанию, если не реплицированы), либо асинхронно (определяется настройкой [mutations_sync](/operations/settings/settings#mutations_sync)). Эти операции требуют большого объема I/O, переписывая все части, соответствующие выражению `WHERE`. Процесс не является атомарным - части заменяются измененными частями, как только они становятся готовыми, и запрос `SELECT`, который начинает выполняться во время мутации, будет видеть данные из частей, которые уже были изменены, вместе с данными из частей, которые еще не были изменены. Пользователи могут отслеживать состояние прогресса через таблицу [systems.mutations](/operations/system-tables/mutations#monitoring-mutations). Эти операции требуют интенсивного I/O и должны использоваться экономно, так как они могут повлиять на производительность `SELECT` кластера.

Читайте больше о [удалениях с помощью мутаций](/sql-reference/statements/alter/delete).

## Усечь таблицу {#truncate-table}

Если все данные в таблице необходимо удалить, используйте команду `TRUNCATE TABLE`, показанную ниже. Это легкая операция.

```sql
TRUNCATE TABLE posts
```

Читайте больше о [TRUNCATE TABLE](/sql-reference/statements/truncate).

## Удалить партицию {#drop-partition}

Если вы указали пользовательский ключ партиционирования для ваших данных, партиции могут быть эффективно удалены. Избегайте партиционирования с высокой кардинальностью.

```sql
ALTER TABLE posts (DROP PARTITION '2008')
```

Читайте больше о [DROP PARTITION](/sql-reference/statements/alter/partition).

## Дополнительные ресурсы {#more-resources}

- [Обработка обновлений и удалений в ClickHouse](https://clickhouse.com/blog/handling-updates-and-deletes-in-clickhouse)
