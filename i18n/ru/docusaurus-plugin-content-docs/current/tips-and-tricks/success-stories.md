---
sidebar_position: 1
slug: /community-wisdom/creative-use-cases
sidebar_label: 'Истории успеха'
doc_type: 'guide'
keywords: [
  'нестандартные сценарии использования ClickHouse',
  'истории успеха ClickHouse',
  'нестандартное использование баз данных',
  'ограничение скорости в ClickHouse',
  'приложения аналитических баз данных',
  'мобильная аналитика в ClickHouse',
  'аналитика для клиентов',
  'инновации в области баз данных',
  'приложения реального времени на ClickHouse',
  'альтернативные решения для баз данных',
  'нарушение устоявшихся принципов работы с базами данных',
  'истории успеха в продакшене'
]
title: 'Уроки — креативные сценарии использования'
description: 'Найдите решения наиболее распространённых проблем ClickHouse, включая медленные запросы, ошибки, связанные с памятью, проблемы с подключением и конфигурацией.'
---



# Истории успеха {#breaking-the-rules}

_Это руководство является частью сборника материалов, полученных на встречах сообщества. Больше практических решений и идей можно найти, [выбрав конкретную проблему](./community-wisdom.md)._
_Нужны советы по отладке проблем в production? Ознакомьтесь с руководством сообщества [Практики отладки](./debugging-insights.md)._

Эти истории показывают, как компании добились успеха, используя ClickHouse для решения своих задач. Некоторые из них бросили вызов традиционным категориям баз данных и доказали, что иногда «неподходящий» инструмент оказывается именно тем правильным решением.


## ClickHouse как система ограничения частоты запросов {#clickhouse-rate-limiter}

Когда Craigslist потребовалось добавить ограничение частоты запросов первого уровня для защиты своих пользователей, они столкнулись с тем же выбором, что и любая инженерная команда — следовать общепринятой практике и использовать Redis или попробовать что-то другое. Брэд Лхотски, работавший в Craigslist, знал, что Redis был стандартным выбором — практически каждое руководство и пример по ограничению частоты запросов в интернете использует Redis не без оснований. Он обладает богатым набором примитивов для операций ограничения частоты запросов, устоявшимися паттернами и проверенной репутацией. Но опыт Craigslist с Redis не соответствовал учебным примерам. _«Наш опыт работы с Redis не похож на то, что вы видели в кино... мы столкнулись с множеством странных проблем обслуживания, когда перезагружаем узел в кластере Redis и какой-то всплеск задержки бьёт по фронтенду»._ Для небольшой команды, которая ценит простоту обслуживания, эти операционные трудности становились реальной проблемой.

Поэтому, когда к Брэду обратились с требованиями по ограничению частоты запросов, он выбрал другой подход: _«Я спросил своего начальника: "Что ты думаешь об этой идее? Может, я попробую это с ClickHouse?"»_ Идея была нестандартной — использовать аналитическую базу данных для задачи, которая обычно решается на уровне кэширования, — но она отвечала их основным требованиям: отказоустойчивость с открытым доступом, отсутствие штрафов по задержке и безопасность обслуживания для небольшой команды. Решение использовало существующую инфраструктуру, где журналы доступа уже поступали в ClickHouse через Kafka. Вместо поддержки отдельного кластера Redis они могли анализировать паттерны запросов непосредственно из данных журналов доступа и внедрять правила ограничения частоты запросов в существующий ACL API. Подход означал немного большую задержку по сравнению с Redis, который _«как бы жульничает, создавая этот набор данных заранее»_, вместо выполнения агрегирующих запросов в реальном времени, но запросы всё равно завершались менее чем за 100 миллисекунд.

**Ключевые результаты:**

- Значительное улучшение по сравнению с инфраструктурой Redis
- Встроенный TTL для автоматической очистки устранил накладные расходы на обслуживание
- Гибкость SQL позволила создавать сложные правила ограничения частоты запросов помимо простых счётчиков
- Использование существующего конвейера данных вместо требования отдельной инфраструктуры


## ClickHouse для клиентской аналитики {#customer-analytics}

Когда ServiceNow потребовалось модернизировать платформу мобильной аналитики, они столкнулись с простым вопросом: _«Зачем заменять то, что работает?»_ Амир Ваза из ServiceNow знал, что их существующая система надёжна, но требования клиентов росли быстрее, чем система могла их обрабатывать. _«Мотивация для замены существующей надёжной модели на самом деле исходит от продуктовой команды»_, — объяснил Амир. ServiceNow предлагала мобильную аналитику как часть своего решения для веб-приложений, мобильных устройств и чат-ботов, но клиенты хотели аналитической гибкости, выходящей за рамки предварительно агрегированных данных.

Их предыдущая система использовала около 30 различных таблиц с предварительно агрегированными данными, сегментированными по фиксированным измерениям: приложение, версия приложения и платформа. Для пользовательских свойств — пар ключ-значение, которые могли отправлять клиенты, — они создавали отдельные счётчики для каждой группы. Этот подход обеспечивал быструю работу дашбордов, но имел существенное ограничение. _«Хотя это отлично подходит для быстрой детализации значений, упомянутое ограничение приводит к значительной потере аналитического контекста»_, — отметил Амир. Клиенты не могли выполнять сложный анализ пути клиента или задавать вопросы вроде «сколько сеансов началось с поискового запроса 'research RSA token'» и затем анализировать, что эти пользователи делали дальше. Предварительно агрегированная структура разрушала последовательный контекст, необходимый для многоэтапного анализа, и каждое новое аналитическое измерение требовало инженерной работы для предварительной агрегации и хранения.

Поэтому, когда ограничения стали очевидны, ServiceNow перешла на ClickHouse и полностью устранила эти ограничения предварительных вычислений. Вместо того чтобы заранее вычислять каждую переменную, они разбили метаданные на точки данных и загрузили всё напрямую в ClickHouse. Они использовали очередь асинхронных вставок ClickHouse, которую Амир назвал _«действительно потрясающей»_, для эффективной обработки поступающих данных. Такой подход позволил клиентам создавать собственные сегменты, свободно срезать данные по любым измерениям и выполнять сложный анализ пути клиента, который ранее был невозможен.

**Ключевые результаты:**

- Динамическая сегментация по любым измерениям без предварительных вычислений
- Стал возможен сложный анализ пути клиента
- Клиенты получили возможность создавать собственные сегменты и свободно срезать данные
- Устранены инженерные узкие места для новых аналитических требований


## Видеоматериалы {#video-sources}

- **[Нарушая правила — создание ограничителя скорости с помощью ClickHouse](https://www.youtube.com/watch?v=wRwqrbUjRe4)** - Brad Lhotsky (Craigslist)
- **[ClickHouse как аналитическое решение в ServiceNow](https://www.youtube.com/watch?v=b4Pmpx3iRK4)** - Amir Vaza (ServiceNow)

_Эти истории демонстрируют, как пересмотр традиционных представлений о базах данных может привести к прорывным решениям, расширяющим возможности аналитических баз данных._
