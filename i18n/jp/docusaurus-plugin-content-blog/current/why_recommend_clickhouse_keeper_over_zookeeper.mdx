---
date: 2023-06-07
title: なぜ ZooKeeper より ClickHouse Keeper が推奨されるのか？
description: ClickHouse Keeper は、ディスク使用量の削減、高速な復旧、メモリ消費の低減といった機能により ZooKeeper を上回り、ClickHouse クラスターでより高いパフォーマンスを発揮します。
tags: ['コアデータの基本概念']
keywords: ['ClickHouse Keeper', 'ZooKeeper']
---

{frontMatter.description}

{/* 切り捨て */}

***

## 質問 \{#question\}

ClickHouse Keeper は、データレプリケーションおよび分散 DDL クエリの実行のためのコーディネーションシステムを提供します。ClickHouse Keeper は ZooKeeper と互換性がありますが、ZooKeeper の代わりに ClickHouse Keeper を使用すべき理由は、一見しただけでは分かりにくいかもしれません。この記事では、Keeper のいくつかの利点について説明します。

## 回答 \{#answer\}

[ClickHouse Cloud](https://console.clickhouse.cloud/) では、マルチテナント環境で数千のサービスを大規模に運用するために `clickhouse-keeper` を使用しています。私たちは、Java ベースの ZooKeeper 実装への依存を取り除くために Keeper を設計・実装しました。ClickHouse Keeper は、ZooKeeper の多くのよく知られた欠点を解消し、さらに次のような改善を行っています。

* より優れた圧縮により、スナップショットとログが消費するディスク容量が大幅に少ない
* デフォルトのパケットおよびノードデータサイズに制限がない（ZooKeeper では 1 MB）
* `zxid` のオーバーフロー問題がない（ZooKeeper では 20 億トランザクションごとに再起動を強いられる）
* より優れた分散コンセンサスプロトコルを使用しているため、ネットワーク分断後のリカバリが高速
* 同じデータ量に対して、より少ないメモリで動作する
* セットアップが容易であり、JVM のヒープサイズやカスタムガーベジコレクション実装を指定する必要がない
* プロトコル内のいくつかのカスタムコマンドにより、`ReplicatedMergeTree` テーブルでの操作が高速化される
* Jepsen テストによるより広範なテストカバレッジ

さらに、ClickHouse Support は、ZooKeeper ではなく `clickhouse-keeper` を使用している環境では、クラスタに関する問題が大幅に減少していることを確認しています。

ClickHouse Keeper の構成と実行方法の詳細については、[Keeper のドキュメントページ](https://clickhouse.com/docs/guides/sre/keeper/clickhouse-keeper) を参照してください。