---
date: 2025-01-16
title: デフォルトユーザーを削除するには
description: "ClickHouse Server 実行時のデフォルトユーザーの削除方法について説明します。"
tags: ['サーバー管理']
words: ['デフォルトユーザーの削除', 'ClickHouse Server']
---

{frontMatter.description}

{/* 省略 */}

## デフォルトユーザーの削除 \{#removing-the-default-user\}

:::note
このガイドは ClickHouse Cloud には適用されません。
:::

このガイドでは、ClickHouse Server から `default` ユーザーを削除する方法を説明します。

そのためには、次の内容の YAML ファイル（`remove_default_user.yaml` と呼ぶことにします）を作成します。

```yaml
users:
  default:
    "@remove": remove
```

このファイルの場所は、ClickHouse をどのような方法でインストールしたかによって異なります。

## 実行ファイルを直接実行する場合 \{#running-the-executable-directly\}

ClickHouse を直接実行する場合（`clickhouse server`）、ファイルを `config.d` ディレクトリ配下に配置する必要があります。

ClickHouse サーバーを実行するとき:

```
ClickHouse サーバー
```

ログに次の行が出力されます。

```
{} <Debug> ConfigProcessor: 設定ファイル 'config.d/remove_default_user.yaml' をマージ中。
```

この状態では、`clickhouse client` を使って接続することはできません:

```
ClickHouse client version 24.11.1.2557 (official build).
localhost:9000 にユーザー default として接続中。
ユーザーのパスワード (default):
localhost:9000 にユーザー default として接続中。
Code: 516. DB::Exception: Received from localhost:9000. DB::Exception: default: 認証失敗: パスワードが正しくないか、該当する名前のユーザーが存在しません。
```

## Docker またはインストール環境 \{#docker-or-installed\}

Docker で ClickHouse を実行している場合、またはマシンにインストールしている場合は、そのファイルを `/etc/clickhouse-server/users.d` ディレクトリ配下に配置する必要があります。

したがって、Docker で実行している場合は、先ほど作成した `config.d` ディレクトリを `/etc/clickhouse-server/users.d` にマウントできます。

```bash
docker run \
  -v ./config.d:/etc/clickhouse-server/users.d \
  -p 8123:8123 -p9000:9000 \
  clickhouse/clickhouse-server:24.12
```

```
設定ファイル '/etc/clickhouse-server/config.d/docker_related_config.xml' をマージしています。
トレースログを /var/log/clickhouse-server/clickhouse-server.log に記録しています。
エラーログを /var/log/clickhouse-server/clickhouse-server.err.log に記録しています。
```

次に、サーバーログを検索し、それが記録されていることを確認します。

```bash
docker ps --format "table {{.ID}}\t{{.Image}}\t{{.Names}}\t{{.Command}}"
```

```text
CONTAINER ID   IMAGE                                NAMES               COMMAND
383e8ed89431   clickhouse/clickhouse-server:24.12   trusting_rosalind   "/entrypoint.sh"
```

```
docker exec -it trusting_rosalind grep "users\.d" /var/log/clickhouse-server/clickhouse-server.log
```

次の行が表示されます。

```text
{} <Debug> ConfigProcessor: 設定ファイル '/etc/clickhouse-server/users.d/remove_default_user.yaml' をマージしています。
```
