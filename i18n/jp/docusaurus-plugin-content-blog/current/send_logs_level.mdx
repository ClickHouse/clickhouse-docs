---
date: 2023-03-01
title: "クライアント側でクエリのサーバーログを取得する"
description: "`send_logs_level` クライアント設定を使用して、ログ設定が異なる場合でもクライアント側でサーバーログを取得する方法を学びます。"
tags: ['サーバー管理']
keywords: ['サーバーログ']
---

{frontMatter.description}

{/* 省略 */}


## クライアント側でクエリのサーバーログを取得する方法

クライアントは `send_logs_level` クライアント設定を行うことで、サーバーで設定されているログレベルとは異なるレベルのサーバーログも閲覧できます。

たとえば、クライアントが次のように実行するとします。

```sql
SET send_logs_level = 'trace';
```

サーバーのログレベルが info に設定されていても、クライアントは trace ログを受信します。

`send_logs_level` を使用して `Distributed` テーブルへの行の挿入を監視するのは、有用な使い方の 1 つです。

* `SET send_logs_level = 'trace';` を実行して `clickhouse-client` でログを有効にする
* `INSERT` クエリを実行する
* `Distributed` テーブルへの INSERT は、デフォルトでは非同期です。データはまずローカルのバッファとしてディスクに書き込まれ、その後バックグラウンドでリモートサーバーへ送信されます。
* クエリ処理に参加しているすべてのノードからログが送信されます（分散トレーシング）

分散 INSERT のステータスを確認するには、[`system.distribution_queue` テーブル](https://clickhouse.com/docs/operations/system-tables/distribution_queue/)を参照します。このテーブルには、シャードに送信されるキューに入っているローカルファイルに関する情報が含まれています。これらのローカルファイルには、非同期モードで `Distributed` テーブルに新しいデータを挿入することで作成された新しいパーツが含まれます。
