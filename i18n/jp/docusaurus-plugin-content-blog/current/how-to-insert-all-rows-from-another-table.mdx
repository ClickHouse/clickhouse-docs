---
title: あるテーブルのすべての行を別のテーブルへ挿入する方法
description: "1つのテーブルのすべての行を別のテーブルに挿入する方法に関するナレッジベース記事。"
date: 2024-12-17
tags: ['データインジェスト']
keywords: ['テーブルからのINSERT']
---

{frontMatter.description}

{/* 省略 */}

## はじめに \{#introduction\}

あるテーブルから別のテーブルへ、すべてのデータを再取り込みする必要がある場合があります。

たとえば、ステージングテーブルから本番テーブルにデータを再取り込みしたいことがあるかもしれません。この記事では、`INSERT INTO` ステートメントを使用してこれを実行する方法を説明します。

## 例 \{#example\}

以下は、その仕組みとテスト方法を示す簡単な例です。

* サンプルデータベースを作成します

```sql
CREATE DATABASE db1;
```

* サンプルテーブルを作成

```sql
CREATE TABLE db1.source_table
(
    city VARCHAR,
    country VARCHAR,
    continent VARCHAR
)
engine = MergeTree()
ORDER BY continent;
```

* ソーステーブルにデータを挿入します

```sql
INSERT INTO db1.source_table (city, country, continent)
VALUES
    ('New York', 'USA', 'North America'),
    ('Tokyo', 'Japan', 'Asia'),
    ('Berlin', 'Germany', 'Europe'),
    ('Paris', 'France', 'Europe'),
    ('Cairo', 'Egypt', 'Africa'),
    ('Sydney', 'Australia', 'Australia');
```

* ソーステーブルの行数を確認する

```sql
SELECT COUNT(*) FROM db1.source_table;
```

```text
┌─count()─┐
│      6  │
└─────────┘
```

* ソーステーブルと同じ構造の新しいテーブルを作成します。

```sql
CREATE TABLE db1.target_table AS db1.source_table;
```

* ソーステーブルの全行をターゲットテーブルに挿入します。

```sql
INSERT INTO db1.target_table SELECT * FROM db1.source_table;
```

* 対象テーブルの行数を確認する

```sql
SELECT COUNT(*) FROM db1.target_table;
```

```text
┌─count()─┐
│      6  │
└─────────┘
```

新しいテーブルの構造を変更したい場合は、まず元のテーブルの構造を表示して確認できます。

```sql
SHOW CREATE TABLE db1.source_table;
```

次に、変更後の構造で新しいテーブルを作成します。ここでは、ターゲットテーブルに新しい列 `population` を追加します。

```sql
CREATE TABLE db1.target_table_population
(
    `city` String,
    `country` String,
    `continent` String,
    `population` UInt16,
)
ENGINE = MergeTree
ORDER BY continent;
```

* ソーステーブルからターゲットテーブルへ、追加された新しい列も含めてすべての行を挿入します。`population` フィールドは、すべての行で 0 に設定します。

```sql
INSERT INTO db1.target_table_population (city, country, continent, population)
SELECT city, country, continent, 0 FROM db1.source_table;
```

* 対象テーブルのデータを確認します

```sql
SELECT * FROM db1.target_table_population LIMIT 3;
```

```text
┌─都市──────┬─国────────┬─大陸───────────┬─人口───────┐
│ New York  │ USA       │ North America  │          0 │
│ Tokyo     │ Japan     │ Asia           │          0 │
│ Berlin    │ Germany   │ Europe         │          0 │
└───────────┴───────────┴────────────────┴────────────┘
```
