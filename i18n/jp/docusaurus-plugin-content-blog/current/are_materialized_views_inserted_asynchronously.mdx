---
title: マテリアライズドビューへの挿入は同期的に実行されますか？
description: この記事では、マテリアライズドビューへの挿入が同期的に行われるかどうかを解説します
date: 2023-03-01
tags: ['データモデリング']
keywords: ['マテリアライズドビュー']
---

{frontMatter.description}

{/* 省略 */}

## マテリアライズドビューへの挿入は同期的に行われますか？ \{#are-materialized-views-inserted-synchronously\}

**質問:** あるソーステーブルに新しい行が挿入されると、その新しい行はそのソーステーブルに紐づくすべてのマテリアライズドビューにも送られます。マテリアライズドビューへの挿入は同期的に実行されますか？つまり、サーバーからクライアントへ挿入成功が通知された時点で、すべてのマテリアライズドビューが完全に更新され、クエリに利用可能になっていることを意味しますか？

**回答:**

1. `INSERT` が成功した場合、データはテーブルおよびそのすべてのマテリアライズドビューに挿入されます。
2. マテリアライズドビューに関しては、その挿入処理はアトミックではありません。`INSERT` が進行中のタイミングによっては、並行して動作しているクライアントから中間状態が見える可能性があります。つまり、データがメインテーブルには挿入されているがマテリアライズドビューにはまだ反映されていない、あるいはその逆といった状態です。
3. [async inserts](https://clickhouse.com/docs/optimize/asynchronous-inserts/) を使用している場合、それらはデータを収集し、内部的には通常の挿入を実行し、クライアントには通常の挿入と同じ種類の応答を返します。クライアントが、デフォルトどおり `wait_for_async_insert` オプション付きの async insert から成功応答を受け取った場合、そのデータはテーブルおよびそのすべてのマテリアライズドビューに挿入されています。

**質問:** 連鎖（カスケード）したマテリアライズドビューの場合はどうなりますか？

**回答:**
同じルールが適用されます。成功応答を伴う `INSERT` は、チェーン内のすべてのマテリアライズドビューにデータが挿入されたことを意味します。挿入はアトミックではありません。