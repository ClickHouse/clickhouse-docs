---
title: ClickHouse のスレッド数を増やす方法
description: "`max_thread_pool_size`、`thread_pool_queue_size`、`max_thread_pool_free_size` などの設定を調整して、ClickHouse のグローバルスレッドプールを構成する方法を説明します。"
date: 2023-03-01
tags: ['パフォーマンスと最適化']
keywords: ['利用可能なスレッド数']
---

{frontMatter.description}

{/* 切り捨て */}

## ClickHouse のスレッド数を増やす \{#increasing-the-number-of-threads-in-clickhouse\}

ClickHouse は、クエリの処理やマージ・ミューテーションなどのバックグラウンド処理を行うために、**Global Thread pool** からスレッドを使用します。クエリを処理するためのアイドルスレッドが存在しない場合、プール内に新しいスレッドが作成されます。

グローバルスレッドプールの最大サイズは `max_thread_pool_size` 設定で決まり、デフォルトは 10,000 です。この値は設定ファイルで変更でき、ここでは 20,000 に設定しています。

```xml
<max_thread_pool_size>20000</max_thread_pool_size>
```

`max_thread_pool_size` を変更する場合は、`thread_pool_queue_size` も同じ値に変更することを推奨します。`thread_pool_queue_size` は、グローバルスレッドプールにスケジュールできるジョブの最大数を指定する設定です。

```xml
<thread_pool_queue_size>20000</thread_pool_queue_size>
```

サーバーにアイドル状態のスレッドが多数ある場合は、`max_thread_pool_free_size` 設定を使用してリソースを解放することもできます。デフォルト値は 1,000 であり、これはグローバルスレッドプールに保持されるアイドルスレッド数が最大 1,000 であることを意味します。次の例では、この値を 2,000 に増やします。

```xml
<max_thread_pool_free_size>2000</max_thread_pool_free_size>
```

上記の設定や Global Thread pool に影響するその他の設定の詳細については、[ドキュメント](https://clickhouse.com/docs/operations/server-configuration-parameters/settings#max-thread-pool-size)を参照してください。
