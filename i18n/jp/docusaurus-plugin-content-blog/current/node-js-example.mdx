---
title: NodeJS ã§ @clickhouse/client ã‚’ä½¿ã†æ–¹æ³•
description: "Node.js ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³ã§ @clickhouse/client ã‚’ä½¿ã£ã¦ ClickHouse ã¨é€£æºã—ã€ã‚¯ã‚¨ãƒªã‚’å®Ÿè¡Œã™ã‚‹æ–¹æ³•ã‚’è§£èª¬ã—ã¾ã™ã€‚"
date: 2023-11-22
tags: ['Language Clients']
keywords: ['NodeJS']
---

{frontMatter.description}

{/* åˆ‡ã‚Šæ¨ã¦ */}

## NodeJS ã¨ @clickhouse/client ã‚’ä½¿ã† \{#use-nodejs-with-clickhouseclient\}

ã“ã‚Œã¯åŸºæœ¬çš„ãªã‚³ãƒ¼ãƒ‰ä¾‹ã‚’å«ã‚€ `main.ts` ãƒ•ã‚¡ã‚¤ãƒ«ã§ã™ã€‚

`Package.json`ï¼ˆ`./` ç›´ä¸‹ã«é…ç½®ã—ã¾ã™ï¼‰:

```json
{
  "name": "ã‚·ãƒ³ãƒ—ãƒ«ãªClickHouseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã®ä¾‹",
  "version": "1.0.0",
  "main": "main.js",
  "license": "MIT",
  "devDependencies": {
    "typescript": "^5.3.2"
  },
  "dependencies": {
    "@clickhouse/client": "^0.2.6"
  }
}
```

`Main.ts`ï¼ˆ`./src` ä»¥ä¸‹ã«é…ç½®ï¼‰:

```ts
import { ClickHouseClient, createClient } from '@clickhouse/client'; // or '@clickhouse/client-web'

interface ClickHouseResultSet<T> {
  meta: Meta[];
  data: T[];
  rows: number;
  statistics: Statistics;
}

interface Statistics {
  elapsed: number;
  rows_read: number;
  bytes_read: number;
}

interface Meta {
  name: string;
  type: string;
}

interface Count {
  c: number;
}

//`host`ã€`username`ã€`password`ã€`database`ãªã©ã®ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆæ¥ç¶šãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿ã‚’
//å¿…è¦ã«å¿œã˜ã¦ç½®ãæ›ãˆã¦ãã ã•ã„ã€‚

const initClickHouseClient = async (): Promise<ClickHouseClient> => {
  const client = createClient({
    host: 'https://FQDN.aws.clickhouse.cloud',
    username: 'default',
    password: 'password',
    database: 'default',
    application: `pingpong`,
  });

  console.log('ClickHouse pingå®Ÿè¡Œä¸­');
  if (!(await client.ping())) {
    throw new Error('ClickHouseã¸ã®pingã«å¤±æ•—ã—ã¾ã—ãŸ');
  }
  console.log('ClickHouse pongå—ä¿¡å®Œäº†');
  return client;
};

const main = async () => {
  console.log('ClickHouseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’åˆæœŸåŒ–ä¸­');
  const client = await initClickHouseClient();

  const row = await client.query({
    query: `SELECT count() AS c FROM system.tables WHERE database='system'`,
  });

  const jsonRow: ClickHouseResultSet<Count> = await row.json();

  console.log(`${jsonRow.data[0].c}å€‹ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ`);

  await client.close();
  console.log(`ğŸ‘‹`);
};

main();
```

ãƒ‘ãƒƒã‚±ãƒ¼ã‚¸ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹ã«ã¯ã€`./` ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã§ `yarn` ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```
$ yarn
yarn install v1.22.19
[1/4] ğŸ”  Resolving packages...
[2/4] ğŸšš  Fetching packages...
[3/4] ğŸ”—  Linking dependencies...
[4/4] ğŸ”¨  Building fresh packages...
âœ¨  Done in 0.14s.
```

`./` ã«ã‚ã‚‹ `main.ts` ã®ã‚³ãƒ¼ãƒ‰ã‚’æ¬¡ã®ã‚³ãƒãƒ³ãƒ‰ã§å®Ÿè¡Œã—ã¾ã™ï¼š`

```
$ npx ts-node src/main.ts
```

æ¬¡ã®ã‚ˆã†ã«å‡ºåŠ›ã•ã‚Œã¾ã™ï¼š

```
ClickHouseã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆã‚’åˆæœŸåŒ–ã—ã¦ã„ã¾ã™
ClickHouse ping
ClickHouse pong!
120å€‹ã®ã‚·ã‚¹ãƒ†ãƒ ãƒ†ãƒ¼ãƒ–ãƒ«ãŒè¦‹ã¤ã‹ã‚Šã¾ã—ãŸ!
ğŸ‘‹
```
