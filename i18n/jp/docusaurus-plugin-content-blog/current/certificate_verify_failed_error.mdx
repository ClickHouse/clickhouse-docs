---
title: ClickHouse における SSL 証明書検証エラーの解決
description: SSL 例外 CERTIFICATE_VERIFY_FAILED エラーを解消する方法を説明します。
date: 2023-05-02
tags: ['セキュリティと認証', 'エラーと例外']
keywords: ['エラー', 'SSL 証明書', '210']
---

{frontMatter.description}

{/* 途中省略 */}


## ClickHouse におけるコード 210 の SSL 証明書検証エラーの解決 \{#resolving-ssl-certificate-verify-error-in-clickhouse\}

このエラーは通常、次のように報告されます。

`Code: 210. DB::NetException: SSL Exception: error:1000007d:SSL routines:OPENSSL_internal:CERTIFICATE_VERIFY_FAILED`

## エラーの原因 \{#cause-of-the-error\}

このエラーは、`clickhouse-client` を使用して ClickHouse サーバーへの接続を試みている際に発生します。エラーの原因は次のいずれかです。

- クライアント設定ファイル `config.xml` に、マシンの CA デフォルトストアにあるルート証明書が含まれていない
- 自己署名証明書または内部 CA 証明書が適切に設定されていない

## 解決策

内部 CA または自己署名 CA を使用する場合は、クライアントディレクトリ（例: `/etc/clickhouse-client`）内の `config.xml` で CA ルート証明書を設定し、デフォルトの場所から読み込まれるデフォルトのルート CA 証明書を無効にします。

以下は設定例です。

```xml
<openSSL>
    <client>
        <loadDefaultCAFile>false</loadDefaultCAFile>
        <caConfig>/etc/clickhouse-server/certs/marsnet_ca.crt</caConfig>
        <cacheSessions>true</cacheSessions>
        <disableProtocols>sslv2,sslv3</disableProtocols>
        <preferServerCiphers>true</preferServerCiphers>
        <invalidCertificateHandler>
            <name>RejectCertificateHandler</name>
        </invalidCertificateHandler>
    </client>
</openSSL>
```


## 追加リソース \{#additional-resources\}

[https://clickhouse.com/docs/interfaces/cli/#configuration_files](https://clickhouse.com/docs/interfaces/cli/#configuration_files) を参照してください