---
sidebar_label: 'バックアップ'
slug: /cloud/features/backups
title: 'バックアップ'
keywords: ['backups', 'cloud backups', 'restore']
description: 'ClickHouse Cloud のバックアップ機能の概要'
doc_type: 'reference'
---

import Image from '@theme/IdealImage';
import ScalePlanFeatureBadge from '@theme/badges/ScalePlanFeatureBadge';
import EnterprisePlanFeatureBadge from '@theme/badges/EnterprisePlanFeatureBadge'
import backup_chain from '@site/static/images/cloud/manage/backup-chain.png';

データベースのバックアップは、予期せぬ理由でデータが失われた場合でも、直近の正常に完了したバックアップ時点までサービスを復元できるようにすることで、安全網として機能します。
これによりダウンタイムを最小限に抑え、ビジネスクリティカルなデータが恒久的に失われることを防ぎます。


## バックアップ {#backups}

### ClickHouse Cloudでのバックアップの仕組み {#how-backups-work-in-clickhouse-cloud}

ClickHouse Cloudのバックアップは、「フル」バックアップと「増分」バックアップを組み合わせてバックアップチェーンを構成します。チェーンはフルバックアップから始まり、その後、スケジュールされた複数の期間にわたって増分バックアップが取得され、バックアップのシーケンスが作成されます。バックアップチェーンが一定の長さに達すると、新しいチェーンが開始されます。このバックアップチェーン全体を使用して、必要に応じて新しいサービスにデータを復元できます。特定のチェーンに含まれるすべてのバックアップが、サービスに設定された保持期間を過ぎると（保持期間の詳細は後述）、そのチェーンは破棄されます。

以下のスクリーンショットでは、実線の四角がフルバックアップを、点線の四角が増分バックアップを示しています。四角を囲む実線の長方形は、保持期間とエンドユーザーに表示されるバックアップを表しており、これらはバックアップの復元に使用できます。以下のシナリオでは、バックアップは24時間ごとに取得され、2日間保持されます。

1日目に、バックアップチェーンを開始するためにフルバックアップが取得されます。2日目に増分バックアップが取得され、復元に使用できるフルバックアップと増分バックアップが利用可能になります。7日目までに、チェーン内に1つのフルバックアップと6つの増分バックアップがあり、最新の2つの増分バックアップがユーザーに表示されます。8日目に新しいフルバックアップが取得され、9日目に新しいチェーンに2つのバックアップが揃うと、以前のチェーンは破棄されます。

<Image
  img={backup_chain}
  size='lg'
  alt='ClickHouse Cloudでのバックアップチェーンの例'
/>

### デフォルトのバックアップポリシー {#default-backup-policy}

Basic、Scale、Enterpriseの各ティアでは、バックアップはストレージとは別に計測され、課金されます。
すべてのサービスはデフォルトで1日1回のバックアップに設定されており、Scaleティア以降では、Cloudコンソールの設定タブから追加のバックアップを構成できます。
各バックアップは最低24時間保持されます。

詳細については、[「バックアップの確認と復元」](/cloud/manage/backups/overview)を参照してください。


## 設定可能なバックアップ {#configurable-backups}

<ScalePlanFeatureBadge feature='Configurable Backups' linking_verb_are='True' />

ClickHouse Cloudでは、**Scale**および**Enterprise**ティアサービスのバックアップスケジュールを設定できます。バックアップは、ビジネスニーズに応じて以下の項目で設定可能です。

- **保持期間**: 各バックアップが保持される日数。保持期間は最短1日、最長30日まで指定でき、その間の複数の値から選択できます。
- **頻度**: 連続するバックアップ間の時間間隔を指定します。例えば、「12時間ごと」という頻度は、バックアップが12時間間隔で実行されることを意味します。頻度は「6時間ごと」から「48時間ごと」まで、次の時間単位で設定できます：`6`、`8`、`12`、`16`、`20`、`24`、`36`、`48`。
- **開始時刻**: 毎日バックアップを実行する開始時刻。開始時刻を指定すると、バックアップの「頻度」はデフォルトで24時間ごとに1回となります。ClickHouse Cloudは、指定された開始時刻から1時間以内にバックアップを開始します。

:::note
カスタムスケジュールは、対象サービスのClickHouse Cloudにおけるデフォルトのバックアップポリシーを上書きします。

まれなケースでは、バックアップスケジューラーがバックアップに指定された**開始時刻**を遵守しない場合があります。具体的には、現在スケジュールされているバックアップの時刻から24時間未満の時点で成功したバックアップがトリガーされた場合に発生します。これは、バックアップに対して実装されている再試行メカニズムによって発生する可能性があります。このような場合、スケジューラーは当日のバックアップをスキップし、翌日のスケジュールされた時刻にバックアップを再試行します。
:::

バックアップを設定する手順については、[「バックアップスケジュールの設定」](/cloud/manage/backups/configurable-backups)を参照してください。


## Bring Your Own Bucket (BYOB) バックアップ {#byob}

<EnterprisePlanFeatureBadge />

ClickHouse Cloudでは、お客様独自のクラウドサービスプロバイダー（CSP）アカウントストレージ（AWS S3、Google Cloud Storage、またはAzure Blob Storage）へバックアップをエクスポートできます。
お客様独自のバケットへのバックアップを設定した場合でも、ClickHouse Cloudは独自のバケットへの日次バックアップを引き続き実行します。
これは、お客様のバケット内のバックアップが破損した場合に備えて、復元可能なデータのコピーを少なくとも1つ確保するためです。
ClickHouse Cloudのバックアップの仕組みの詳細については、[バックアップ](/cloud/manage/backups/overview)のドキュメントを参照してください。

このガイドでは、AWS、GCP、Azureのオブジェクトストレージへバックアップをエクスポートする方法、およびお客様のアカウント内でこれらのバックアップを新しいClickHouse Cloudサービスに復元する方法について説明します。
また、お客様のバケットへバックアップをエクスポートし、それらを復元するためのバックアップ/復元コマンドも紹介します。

:::note リージョン間バックアップ
同一クラウドプロバイダー内の異なるリージョンへバックアップをエクスポートする場合、[データ転送](/cloud/manage/network-data-transfer)料金が発生することにご注意ください。

現在、クラウド間バックアップ、[透過的データ暗号化（TDE）](/cloud/security/cmek#transparent-data-encryption-tde)を利用しているサービスや規制対象サービスのバックアップ/復元はサポートしていません。
:::

AWS、GCP、Azureのオブジェクトストレージへの完全バックアップおよび増分バックアップの取得方法、ならびにバックアップからの復元方法の例については、[「お客様独自のクラウドアカウントへのバックアップのエクスポート」](/cloud/manage/backups/export-backups-to-own-cloud-account)を参照してください。

### バックアップオプション {#backup-options}

お客様独自のクラウドアカウントへバックアップをエクスポートするには、2つのオプションがあります：

<VerticalStepper headerLevel="h5">

##### Cloud Console UI経由 {#via-ui}

外部バックアップは[UI上で設定](/cloud/manage/backups/backup-restore-via-ui)できます。
デフォルトでは、バックアップは日次で実行されます（[デフォルトバックアップポリシー](/cloud/features/backups#default-backup-policy)で指定されている通り）。
ただし、お客様独自のクラウドアカウントへの[設定可能な](/cloud/manage/backups/configurable-backups)バックアップもサポートしており、カスタムスケジュールの設定が可能です。
お客様のバケットへのすべてのバックアップは完全バックアップであり、他の過去または将来のバックアップとの関連性はないことに注意してください。

##### SQLコマンドの使用 {#using-commands}

[SQLコマンド](/cloud/manage/backups/backup-restore-via-commands)を使用して、お客様のバケットへバックアップをエクスポートできます。

</VerticalStepper>

:::warning
ClickHouse Cloudは、お客様のバケット内のバックアップのライフサイクルを管理しません。
お客様は、コンプライアンス基準の遵守およびコスト管理のために、バケット内のバックアップが適切に管理されていることを確認する責任があります。
バックアップが破損している場合、復元することはできません。
:::
