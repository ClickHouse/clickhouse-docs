---
slug: /cloud/reference/shared-catalog
sidebar_label: '共有カタログ'
title: '共有カタログと共有データベースエンジン'
keywords: ['SharedCatalog', 'SharedDatabaseEngine']
description: 'ClickHouse Cloud における Shared Catalog コンポーネントおよび Shared データベースエンジンについて説明します'
doc_type: 'reference'
---



# 共有カタログと共有データベースエンジン {#shared-catalog-and-shared-database-engine}

**ClickHouse Cloud（およびファーストパーティパートナークラウドサービス）専用**

共有カタログは、ClickHouse Cloudにおいて、ステートレスエンジンを使用するデータベースとテーブルのメタデータおよびDDL操作をレプリカ間で複製するクラウドネイティブコンポーネントです。これらのオブジェクトに対して一貫性のある集中的な状態管理を実現し、動的環境や部分的にオフラインの環境においてもメタデータの整合性を保証します。

共有カタログは**テーブル自体を複製するものではありません**が、DDLクエリとメタデータを複製することで、すべてのレプリカがデータベースおよびテーブル定義の一貫したビューを持つことを保証します。

以下のデータベースエンジンの複製をサポートしています：

- Shared
- PostgreSQL
- MySQL
- DataLakeCatalog


## アーキテクチャとメタデータストレージ {#architecture-and-metadata-storage}

Shared CatalogのすべてのメタデータとDDLクエリ履歴は、ZooKeeperに集中管理されます。ローカルディスクには一切永続化されません。このアーキテクチャにより、以下が保証されます:

- すべてのレプリカ間での状態の一貫性
- コンピュートノードのステートレス性
- 高速かつ信頼性の高いレプリカのブートストラップ


## Sharedデータベースエンジン {#shared-database-engine}

**Sharedデータベースエンジン**は、Shared Catalogと連携して、`SharedMergeTree`などの**ステートレステーブルエンジン**を使用するテーブルを持つデータベースを管理します。これらのテーブルエンジンは永続的な状態をディスクに書き込まないため、動的なコンピュート環境に適しています。

Sharedデータベースエンジンは、Replicatedデータベースエンジンの動作を基盤として構築され、改善を加えることで、追加の保証と運用上の利点を提供します。

### 主な利点 {#key-benefits}

- **アトミックなCREATE TABLE ... AS SELECT**
  テーブルの作成とデータの挿入がアトミックに実行されます。操作全体が完了するか、テーブルが全く作成されないかのいずれかになります。

- **データベース間でのRENAME TABLE**
  データベース間でテーブルをアトミックに移動できます:

  ```sql
  RENAME TABLE db1.table TO db2.table;
  ```

- **UNDROP TABLEによる自動テーブル復旧**
  削除されたテーブルはデフォルトで8時間保持され、復元可能です:

  ```sql
  UNDROP TABLE my_table;
  ```

  保持期間はサーバー設定で変更できます。

- **コンピュート間の分離の改善**
  DROPクエリを処理するために全てのレプリカがオンラインである必要があるReplicatedデータベースエンジンとは異なり、Shared Catalogは集中管理されたメタデータ削除を実行します。これにより、一部のレプリカがオフラインの場合でも操作を成功させることができます。

- **自動メタデータレプリケーション**
  Shared Catalogは、起動時にデータベース定義が全てのサーバーに自動的にレプリケートされることを保証します。オペレーターは新しいインスタンスでメタデータを手動で構成または同期する必要がありません。

- **集中管理されたバージョン管理メタデータ状態**
  Shared CatalogはZooKeeperに単一の信頼できる情報源を保存します。レプリカが起動すると、最新の状態を取得し、差分を適用して一貫性を実現します。クエリ実行時には、システムは正確性を保証するために、他のレプリカが少なくとも必要なバージョンのメタデータに到達するまで待機することができます。


## ClickHouse Cloudでの使用 {#usage-in-clickhouse-cloud}

エンドユーザーにとって、Shared CatalogとSharedデータベースエンジンの使用に追加の設定は不要です。データベースの作成方法は従来と同じです:

```sql
CREATE DATABASE my_database;
```

ClickHouse Cloudは自動的にデータベースにSharedデータベースエンジンを割り当てます。ステートレスエンジンを使用してこのようなデータベース内に作成されたテーブルは、Shared Catalogのレプリケーションおよびコーディネーション機能を自動的に利用できます。


## 概要 {#summary}

Shared CatalogとSharedデータベースエンジンは以下の機能を提供します:

- ステートレスエンジン向けの信頼性の高い自動メタデータレプリケーション
- ローカルメタデータの永続化が不要なステートレスコンピュート
- 複雑なDDLに対するアトミック操作
- 弾力性のある環境、一時的な環境、または部分的にオフラインのコンピュート環境に対する強化されたサポート
- ClickHouse Cloudユーザー向けのシームレスな利用体験

これらの機能により、Shared CatalogはClickHouse Cloudにおけるスケーラブルでクラウドネイティブなメタデータ管理の基盤となります。
