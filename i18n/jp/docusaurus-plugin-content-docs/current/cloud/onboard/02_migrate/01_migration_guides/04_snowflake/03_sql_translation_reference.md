---
sidebar_label: 'SQL 変換リファレンス'
slug: /migrations/snowflake-translation-reference
description: 'SQL 変換リファレンス'
keywords: ['Snowflake']
title: 'Snowflake から ClickHouse への移行'
show_related_blogs: true
doc_type: 'guide'
---



# Snowflake SQL 変換ガイド



## データ型 {#data-types}

### 数値型 {#numerics}

ClickHouseとSnowflake間でデータを移行するユーザーは、ClickHouseが数値型の宣言においてより細かい精度を提供していることにすぐに気付くでしょう。例えば、Snowflakeは数値型としてNumber型を提供しています。これは、ユーザーが精度(総桁数)とスケール(小数点以下の桁数)を最大38桁まで指定する必要があります。整数の宣言はNumberと同義であり、単に固定された精度とスケールを定義するもので、範囲は同じです。この利便性が可能なのは、精度の変更(整数の場合スケールは0)がSnowflakeのディスク上のデータサイズに影響を与えないためです。書き込み時にマイクロパーティションレベルで数値範囲に必要な最小バイト数が使用されます。ただし、スケールはストレージ容量に影響を与え、圧縮によって相殺されます。`Float64`型は、精度を犠牲にしてより広い値の範囲を提供します。

これに対してClickHouseは、浮動小数点数と整数に対して複数の符号付きおよび符号なし精度を提供しています。これにより、ClickHouseユーザーは整数に必要な精度を明示的に指定し、ストレージとメモリのオーバーヘッドを最適化できます。SnowflakeのNumber型に相当するDecimal型は、76桁で2倍の精度とスケールを提供します。同様の`Float64`値に加えて、ClickHouseは精度がそれほど重要でなく圧縮が最優先される場合のために`Float32`も提供しています。

### 文字列型 {#strings}

ClickHouseとSnowflakeは、文字列データの保存に対照的なアプローチを取っています。Snowflakeの`VARCHAR`はUTF-8のUnicode文字を保持し、ユーザーが最大長を指定できます。この長さはストレージやパフォーマンスに影響を与えず、文字列の保存には常に最小バイト数が使用されます。むしろ下流のツールに有用な制約のみを提供します。`Text`や`NChar`などの他の型は、単にこの型のエイリアスです。対照的にClickHouseは、すべての[文字列データを生バイトとして](/sql-reference/data-types/string)`String`型で保存し(長さの指定は不要)、エンコーディングはユーザーに委ねます。異なるエンコーディングに対応した[クエリ時関数](/sql-reference/functions/string-functions#lengthUTF8)を利用できます。その理由については、["Opaque data argument"](https://utf8everywhere.org/#cookie)を参照してください。したがって、ClickHouseの`String`は、実装においてSnowflakeのBinary型により近いものです。[Snowflake](https://docs.snowflake.com/en/sql-reference/collation)と[ClickHouse](/sql-reference/statements/select/order-by#collation-support)の両方が「照合順序」をサポートしており、ユーザーは文字列のソートと比較方法を上書きできます。

### 半構造化型 {#semi-structured-data}

Snowflakeは、半構造化データに対して`VARIANT`、`OBJECT`、`ARRAY`型をサポートしています。

ClickHouseは、同等の[`Variant`](/sql-reference/data-types/variant)、`Object`(現在はネイティブ`JSON`型に置き換えられ非推奨)、[`Array`](/sql-reference/data-types/array)型を提供しています。さらに、ClickHouseには[`JSON`](/sql-reference/data-types/newjson)型があり、これは現在非推奨となった`Object('json')`型を置き換えるもので、[他のネイティブJSON型と比較して](https://jsonbench.com/)特にパフォーマンスとストレージ効率に優れています。

ClickHouseは、[`Nested`](/sql-reference/data-types/nested-data-structures/nested)型を介して名前付き[`Tuple`](/sql-reference/data-types/tuple)とTupleの配列もサポートしており、ユーザーがネストされた構造を明示的にマッピングできます。これにより、階層全体にコーデックと型の最適化を適用できます。これはSnowflakeとは異なり、Snowflakeでは外側のオブジェクトに`OBJECT`、`VARIANT`、`ARRAY`型を使用する必要があり、[明示的な内部型指定](https://docs.snowflake.com/en/sql-reference/data-types-semistructured#characteristics-of-an-object)が許可されていません。この内部型指定により、ClickHouseではネストされた数値に対するクエリも簡素化され、キャストする必要がなく、インデックス定義で使用できます。

ClickHouseでは、コーデックと最適化された型をサブ構造にも適用できます。これにより、ネストされた構造での圧縮が優れたままであり、フラット化されたデータと同等であるという追加の利点が得られます。対照的に、サブ構造に特定の型を適用できないため、Snowflakeは[最適な圧縮を実現するためにデータをフラット化すること](https://docs.snowflake.com/en/user-guide/semistructured-considerations#storing-semi-structured-data-in-a-variant-column-vs-flattening-the-nested-structure)を推奨しています。Snowflakeはまた、これらのデータ型に対して[サイズ制限を課しています](https://docs.snowflake.com/en/user-guide/semistructured-considerations#data-size-limitations)。


### 型リファレンス {#type-reference}


| Snowflake                                                                                                                                                                                                                                                                                                                                                                                                                                                                       | ClickHouse                                                                                                                            | 注記                                                                                                                                                                                                                                                 |   |
| ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | ------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | - |
| [`NUMBER`](https://docs.snowflake.com/en/sql-reference/data-types-numeric)                                                                                                                                                                                                                                                                                                                                                                                                      | [`Decimal`](/sql-reference/data-types/decimal)                                                                                        | ClickHouse は Snowflake と比べて、精度およびスケールを 2 倍の 76 桁までサポートします（Snowflake は 38 桁）。                                                                                                                                                                       |   |
| [`FLOAT`, `FLOAT4`, `FLOAT8`](https://docs.snowflake.com/en/sql-reference/data-types-numeric#data-types-for-floating-point-numbers)                                                                                                                                                                                                                                                                                                                                             | [`Float32`, `Float64`](/sql-reference/data-types/float)                                                                               | Snowflake の浮動小数点数型はすべて 64 ビットです。                                                                                                                                                                                                                   |   |
| [`VARCHAR`](https://docs.snowflake.com/en/sql-reference/data-types-text#varchar)                                                                                                                                                                                                                                                                                                                                                                                                | [`String`](/sql-reference/data-types/string)                                                                                          |                                                                                                                                                                                                                                                    |   |
| [`BINARY`](https://docs.snowflake.com/en/sql-reference/data-types-text#binary)                                                                                                                                                                                                                                                                                                                                                                                                  | [`String`](/sql-reference/data-types/string)                                                                                          |                                                                                                                                                                                                                                                    |   |
| [`BOOLEAN`](https://docs.snowflake.com/en/sql-reference/data-types-logical)                                                                                                                                                                                                                                                                                                                                                                                                     | [`Bool`](/sql-reference/data-types/boolean)                                                                                           |                                                                                                                                                                                                                                                    |   |
| [`DATE`](https://docs.snowflake.com/en/sql-reference/data-types-datetime#date)                                                                                                                                                                                                                                                                                                                                                                                                  | [`Date`](/sql-reference/data-types/date), [`Date32`](/sql-reference/data-types/date32)                                                | Snowflake の `DATE` は ClickHouse よりも広い日付範囲を扱えます。たとえば、ClickHouse の `Date32` 型の最小値は `1900-01-01`、`Date` 型の最小値は `1970-01-01` です。ClickHouse の `Date` は、よりコスト効率の高い 2 バイトのストレージを提供します。                                                                    |   |
| [`TIME(N)`](https://docs.snowflake.com/en/sql-reference/data-types-datetime#time)                                                                                                                                                                                                                                                                                                                                                                                               | 直接に対応する型はありませんが、[`DateTime`](/sql-reference/data-types/datetime) および [`DateTime64(N)`](/sql-reference/data-types/datetime64) で表現できます。 | `DateTime64` も同じ精度の概念を採用しています。                                                                                                                                                                                                                     |   |
| [`TIMESTAMP`](https://docs.snowflake.com/en/sql-reference/data-types-datetime#timestamp) - [`TIMESTAMP_LTZ`](https://docs.snowflake.com/en/sql-reference/data-types-datetime#timestamp-ltz-timestamp-ntz-timestamp-tz), [`TIMESTAMP_NTZ`](https://docs.snowflake.com/en/sql-reference/data-types-datetime#timestamp-ltz-timestamp-ntz-timestamp-tz), [`TIMESTAMP_TZ`](https://docs.snowflake.com/en/sql-reference/data-types-datetime#timestamp-ltz-timestamp-ntz-timestamp-tz) | [`DateTime`](/sql-reference/data-types/datetime) と [`DateTime64`](/sql-reference/data-types/datetime64)                               | `DateTime` と `DateTime64` には、列に対してオプションの TZ パラメータを定義できます。指定されていない場合は、サーバーのタイムゾーンが使用されます。さらに、クライアント用には `--use_client_time_zone` パラメータも利用できます。                                                                                                       |   |
| [`VARIANT`](https://docs.snowflake.com/en/sql-reference/data-types-semistructured#variant)                                                                                                                                                                                                                                                                                                                                                                                      | [`JSON`, `Tuple`, `Nested`](/interfaces/formats)                                                                                      | ClickHouse における `JSON` 型は実験的な機能です。この型は挿入時に列のデータ型を推論します。代替案として、`Tuple`、`Nested`、`Array` を使用して、明示的に型を指定した構造を構築することもできます。                                                                                                                             |   |
| [`OBJECT`](https://docs.snowflake.com/en/sql-reference/data-types-semistructured#object)                                                                                                                                                                                                                                                                                                                                                                                        | [`Tuple`, `Map`, `JSON`](/interfaces/formats)                                                                                         | `OBJECT` と `Map` はどちらも、キーが `String` の場合の ClickHouse における `JSON` 型に相当します。ClickHouse では値の型は一貫しており、厳密に型付けされている必要がありますが、Snowflake では `VARIANT` が使用されます。これは、キーごとに値の型が異なり得ることを意味します。ClickHouse で同様のことが必要な場合は、`Tuple` を用いて階層を明示的に定義するか、`JSON` 型を利用してください。 |   |
| [`ARRAY`](https://docs.snowflake.com/en/sql-reference/data-types-semistructured#array)                                                                                                                                                                                                                                                                                                                                                                                          | [`Array`](/sql-reference/data-types/array), [`Nested`](/sql-reference/data-types/nested-data-structures/nested)                       | Snowflake の `ARRAY` は、要素にスーパータイプである `VARIANT` を使用します。対照的に、ClickHouse ではこれらの要素は厳密に型付けされています。                                                                                                                                                        |   |
| [`GEOGRAPHY`](https://docs.snowflake.com/en/sql-reference/data-types-geospatial#geography-data-type)                                                                                                                                                                                                                                                                                                                                                                            | [`Point`, `Ring`, `Polygon`, `MultiPolygon`](/sql-reference/data-types/geo)                                                           | Snowflake では座標系 (WGS 84) が強制されますが、ClickHouse では座標系はクエリ時に適用されます。                                                                                                                                                                                    |   |
| [`GEOMETRY`](https://docs.snowflake.com/en/sql-reference/data-types-geospatial#geometry-data-type)                                                                                                                                                                                                                                                                                                                                                                              | [`Point`, `Ring`, `Polygon`, `MultiPolygon`](/sql-reference/data-types/geo)                                                           |                                                                                                                                                                                                                                                    |   |



| ClickHouse Type   | 説明                                                                                                 |
|-------------------|-----------------------------------------------------------------------------------------------------|
| `IPv4` and `IPv6` | IP 固有の型であり、Snowflake よりも効率的にデータを保存できる可能性があります。                    |
| `FixedString`     | バイト長を固定にできる型で、ハッシュ値の保持に有用です。                                            |
| `LowCardinality`  | 任意の型を辞書エンコードできる型です。カーディナリティが 10 万未満と想定される場合に有用です。     |
| `Enum`            | 名前付き値を 8 ビットまたは 16 ビットの範囲で効率的にエンコードできます。                          |
| `UUID`            | UUID を効率的に保存するための型です。                                                               |
| `Array(Float32)`  | ベクトルは `Array` 型の `Float32` として表現でき、対応する距離関数も利用できます。                  |

最後に、ClickHouse では中間的な
[集約関数の状態](/sql-reference/data-types/aggregatefunction) を保存できるという、ユニークな機能を提供しています。この
状態は実装依存ですが、集約結果を保存しておき、後から（対応するマージ関数を用いて）クエリすることができます。通常、この
機能はマテリアライズドビュー経由で利用され、以下で示すように、挿入されたデータに対するクエリの増分結果を保存することで、
最小限のストレージコストで特定のクエリのパフォーマンスを向上させることができます（詳細はこちらを参照してください）。
