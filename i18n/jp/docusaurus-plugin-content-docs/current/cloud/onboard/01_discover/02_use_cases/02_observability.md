---
slug: /cloud/get-started/cloud/use-cases/observability
title: 'オブザーバビリティ'
description: 'ClickHouse Cloud を使用して、分散アプリケーションにおけるオブザーバビリティ、モニタリング、ログ収集、およびシステム性能分析を行う'
keywords: ['use cases', 'observability']
sidebar_label: 'Observability'
doc_type: 'guide'
---

<iframe width="758" height="426" src="https://www.youtube.com/embed/eKlZoT6hPwI?si=Wyrft2T04E1v8US6" title="YouTube video player" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

現代のソフトウェアシステムは複雑です。マイクロサービス、クラウドインフラストラクチャ、
分散システムの登場により、アプリケーション内部で何が起きているのかを把握することが
ますます難しくなっています。問題が発生したときには、チームはすばやく原因と発生箇所を
突き止める必要があります。

そこで重要になるのがオブザーバビリティです。これは単純なシステム監視から進化し、
システムの挙動を総合的に理解するためのアプローチへと発展してきました。しかし、
効果的なオブザーバビリティを実現することは容易ではなく、技術的な概念だけでなく
組織的な課題についての理解も求められます。



## オブザーバビリティとは？ {#what-is-observability}

オブザーバビリティとは、システムの出力を調査することで、その内部状態を理解することです。
ソフトウェアシステムにおいては、アプリケーションとインフラストラクチャが生成するデータを通じて、内部で何が起きているかを把握することを意味します。

この分野は大きく進化しており、2つの異なる世代のオブザーバビリティアプローチを通じて理解することができます。

第一世代は、オブザーバビリティ1.0とも呼ばれ、メトリクス、ログ、トレースという従来の「3つの柱」アプローチを中心に構築されていました。このアプローチでは、異なる種類のテレメトリに対して複数のツールとデータストアが必要でした。エンジニアは測定対象を事前に定義することを強いられることが多く、複数のシステムを維持するためのコストと複雑さが増大していました。

現代のオブザーバビリティ、すなわちオブザーバビリティ2.0は、根本的に異なるアプローチを採用しています。これは、システム内の各作業単位（例：HTTPリクエストとレスポンス）に対して、幅広い構造化イベントを収集することに基づいています。このアプローチでは、ユーザーID、リクエストID、Gitコミットハッシュ、インスタンスID、Kubernetesポッド名、特定のルートパラメータ、ベンダートランザクションIDなど、高カーディナリティデータをキャプチャします。経験則として、システムの動作を理解するのに役立つ可能性があれば、メタデータを追加します。

この豊富なデータ収集により、メトリクスを事前に定義することなく、データを動的にスライスおよび分析することが可能になります。チームは、この基盤データからメトリクス、トレース、その他の可視化を導出でき、計装を最初に追加した時点では想定されていなかったシステム動作に関する複雑な質問に答えることができます。

しかし、現代のオブザーバビリティ機能の実装には課題があります。組織は、多様なシステムとテクノロジー全体でこの豊富なテレメトリデータを収集、処理、エクスポートするための信頼性の高い方法を必要としています。現代のアプローチは従来の境界を超えて進化していますが、オブザーバビリティの基本的な構成要素を理解することは依然として重要です。


## オブザーバビリティの3つの柱 {#three-pillars-of-observability}

オブザーバビリティがどのように進化し、実際にどのように機能するかをより深く理解するために、オブザーバビリティの3つの柱であるログ、メトリクス、トレースについて見ていきましょう。

現代のオブザーバビリティはこれらを個別の関心事として扱うことを超えて進化していますが、システム動作のさまざまな側面を理解するための基本的な概念であることに変わりはありません。

1. **ログ** - システム内で発生する個別のイベントのテキストベースの記録。
   特定の発生事象、エラー、状態変化に関する詳細なコンテキストを提供します。
2. **メトリクス** - 時系列で収集される数値測定値。カウンター、ゲージ、ヒストグラムなどが含まれ、システムパフォーマンス、リソース使用状況、ビジネスKPIの追跡に役立ちます。
3. **トレース** - 分散システムを通過するリクエストの経路を追跡する記録。
   サービス間の関係を理解し、パフォーマンスのボトルネックを特定するのに役立ちます。

これらの柱により、チームはシステムの監視、トラブルシューティング、最適化を行うことができます。
しかし、真の価値は、3つの柱すべてにわたってデータを効果的に収集、分析、相関させ、システム動作に関する有意義な洞察を得る方法を理解することから生まれます。


## オブザーバビリティの利点 {#the-benefits-of-observability}

オブザーバビリティの技術的側面（ログ、メトリクス、トレース）は十分に理解されていますが、ビジネス上の利点も同様に重要です。

Charity Majors、Liz Fong-Jones、George Mirandaによる著書["Observability Engineering"](https://clickhouse.com/engineering-resources/observability#:~:text=Observability%20Engineering)
（O'Reilly、2022年）では、業界調査と実例に基づくフィードバックから、適切なオブザーバビリティプラクティスを実装することで組織が期待できる4つの主要なビジネス上の利点を特定しています。
これらの利点を見ていきましょう：

### 増分収益の向上 {#higher-incremental-revenue}

著者らは、チームの稼働時間とパフォーマンスの向上を支援するオブザーバビリティツールが、コード品質の向上を通じて増分収益の増加につながると指摘しています。
これは以下のような形で現れます：

1. 顧客体験の向上：迅速な問題解決とサービス劣化の防止により、顧客満足度と定着率が向上します
2. システム信頼性の向上：稼働時間の改善により、トランザクションの成功率が高まり、ビジネス機会の損失が減少します
3. パフォーマンスの強化：パフォーマンスボトルネックを特定して最適化する能力により、顧客のエンゲージメントを維持する応答性の高いサービスを提供できます
4. 競争優位性：包括的な監視と迅速な問題解決を通じて高いサービス品質を維持できる組織は、競合他社に対して優位性を獲得できます

### インシデント対応の迅速化によるコスト削減 {#cost-savings-from-faster-incident-response}

オブザーバビリティの最も即効性のある利点の1つは、問題の検出と解決の迅速化による人件費の削減です。これは以下から得られます：

- 平均検出時間（MTTD）と平均解決時間（MTTR）の短縮
- クエリ応答時間の改善による、より迅速な調査の実現
- パフォーマンスボトルネックのより迅速な特定
- オンコール時間の削減
- 不要なロールバックに費やされるリソースの削減

これは実際に確認できます - [trip.comはClickHouseでオブザーバビリティシステムを構築](trip.com built their observability system with ClickHouse)し、以前のソリューションと比較して4～30倍高速なクエリ速度を達成し、クエリの90%が300ミリ秒未満で完了することで、迅速な問題調査を可能にしました。

### インシデント回避によるコスト削減 {#cost-savings-from-incidents-avoided}

オブザーバビリティは問題をより迅速に解決するだけでなく、問題を完全に防止することにも役立ちます。
著者らは、チームが以下の方法で重大な問題を防止できると強調しています：

- 潜在的な問題が重大化する前に特定する
- パターンを分析して再発問題を防止する
- 異なる条件下でのシステム動作を理解する
- パフォーマンスボトルネックに積極的に対処する
- システム改善についてデータ駆動型の意思決定を行う

ClickHouseの[独自のオブザーバビリティプラットフォームであるLogHouse](https://clickhouse.com/blog/building-a-logging-platform-with-clickhouse-and-saving-millions-over-datadog)は、これを実証しています。すべてのクラスタにわたる履歴パターンの検索をコアエンジニアに提供し、再発問題の防止に役立っています。

### 従業員離職率の低下によるコスト削減 {#cost-savings-from-decreased-employee-churn}

最も見過ごされがちな利点の1つは、チームの満足度と定着率への影響です。
著者らは、オブザーバビリティが以下をもたらすと強調しています：

- より優れたツールによる職務満足度の向上
- 未解決の問題の減少による開発者の燃え尽き症候群の軽減
- シグナル対ノイズ比の改善によるアラート疲労の軽減
- より優れたインシデント管理によるオンコールストレスの低減
- システム信頼性に対するチームの信頼の向上

これは実際に確認できます - [FastlyがClickHouseに移行](https://clickhouse.com/videos/scaling-graphite-with-clickhouse)した際、エンジニアたちはクエリパフォーマンスの向上に驚き、次のように述べています：

> 「信じられませんでした。実際に何度か戻って、正しくクエリを実行しているか確認する必要がありました...結果が返ってくるのが速すぎます。
> 理解できません。」

著者らが強調するように、これらの利点の具体的な尺度はツールと実装によって異なる可能性がありますが、堅牢なオブザーバビリティプラクティスを採用する組織全体でこれらの基本的な改善が期待できます。重要なのは、これらの利点を最大化するために適切なツールを効果的に選択し実装することです。

これらの利点を達成するには、いくつかの重要なハードルを克服する必要があります。オブザーバビリティの価値を理解している組織でさえ、実装には予期しない複雑さと課題が伴い、慎重に対処する必要があることが少なくありません。


## オブザーバビリティ実装における課題 {#challenges-in-implementing-observability}

組織内でオブザーバビリティを実装することは、システムのパフォーマンスと信頼性に関するより深い洞察を得るための変革的なステップです。しかし、この取り組みには課題が伴います。組織がオブザーバビリティの潜在能力を最大限に活用しようとする際、進捗を妨げるさまざまな障害に直面します。それらのいくつかを見ていきましょう。

### データ量とスケーラビリティ {#data-volume-and-scalability}

オブザーバビリティ実装における主要な障壁の一つは、現代のシステムが生成する膨大な量のテレメトリデータとそのスケーラビリティを管理することです。組織が成長するにつれて、監視が必要なデータも増加し、大規模なデータ取り込みとリアルタイム分析を効率的に処理できるソリューションが必要となります。

### 既存システムとの統合 {#integration-with-existing-systems}

既存システムとの統合は、もう一つの重要な課題です。多くの組織は多様な技術を持つ異種混在環境で運用しているため、オブザーバビリティツールが現在のインフラストラクチャとシームレスに統合することが不可欠です。オープン標準はこの統合を促進する上で重要な役割を果たし、相互運用性を確保し、多様な技術スタック全体にオブザーバビリティソリューションを展開する際の複雑さを軽減します。

### スキルギャップ {#skill-gaps}

スキルギャップもオブザーバビリティの成功的な実装を妨げる可能性があります。高度なオブザーバビリティソリューションへの移行には、データ分析や特定のツールに関する専門知識が必要となることが多くあります。チームはこれらのギャップを埋め、オブザーバビリティプラットフォームの機能を最大限に活用するために、トレーニングや人材採用に投資する必要があるかもしれません。

### コスト管理 {#cost-management}

コスト管理は重要な課題です。オブザーバビリティソリューションは、特に大規模になると高額になる可能性があります。組織はこれらのツールのコストと提供される価値のバランスを取り、従来のアプローチと比較して大幅なコスト削減を実現する費用対効果の高いソリューションを求める必要があります。

### データ保持とストレージ {#data-retention-and-storage}

データ保持とストレージ管理は追加の課題をもたらします。パフォーマンスや洞察を損なうことなく、オブザーバビリティデータをどのくらいの期間保持するかを決定するには、慎重な計画と、データのアクセス性を維持しながらストレージ要件を削減する効率的なストレージソリューションが必要です。

### 標準化とベンダーロックイン {#standardization-and-vendor-lock-in}

標準化を確保し、ベンダーロックインを回避することは、オブザーバビリティソリューションにおける柔軟性と適応性を維持するために不可欠です。オープン標準に準拠することで、組織は特定のベンダーに縛られることを防ぎ、オブザーバビリティスタックがニーズに応じて進化できることを保証できます。

### セキュリティとコンプライアンス {#security-and-compliance}

セキュリティとコンプライアンスの考慮事項は、特にオブザーバビリティシステム内で機密データを扱う場合に重要です。組織は、オブザーバビリティソリューションが関連する規制に準拠し、機密情報を効果的に保護することを確保する必要があります。

これらの課題は、組織のニーズを効果的に満たすオブザーバビリティソリューションを実装する際の戦略的計画と情報に基づいた意思決定の重要性を示しています。

これらの課題に対処するために、組織はオブザーバビリティを実装するための体系的なアプローチが必要です。標準的なオブザーバビリティパイプラインは、テレメトリデータを効果的に収集、処理、分析するためのフレームワークを提供するように進化してきました。この進化の最も初期かつ影響力のある例の一つは、2013年のTwitterの経験から生まれました。
