---
slug: /cloud/get-started/cloud/use-cases/observability
title: 'オブザーバビリティ'
description: '分散アプリケーションにおけるオブザーバビリティ、モニタリング、ログ収集、およびシステムパフォーマンス分析に ClickHouse Cloud を利用する'
keywords: ['use cases', 'オブザーバビリティ']
sidebar_label: 'オブザーバビリティ'
doc_type: 'guide'
---

<iframe width="758" height="426" src="https://www.youtube.com/embed/eKlZoT6hPwI?si=Wyrft2T04E1v8US6" title="YouTube 動画プレーヤー" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

現代のソフトウェアシステムは複雑です。マイクロサービス、クラウドインフラストラクチャ、
分散システムの登場により、アプリケーション内部で何が起きているのかを把握することは
これまで以上に難しくなっています。問題が発生したとき、チームはすばやく「どこで」「なぜ」
起きているのかを知る必要があります。

ここで重要になるのがオブザーバビリティです。オブザーバビリティは、単純なシステムモニタリングから
システムの振る舞いを理解するための包括的なアプローチへと進化してきました。しかし、
効果的なオブザーバビリティを実現するのは容易ではなく、技術的な概念だけでなく、
組織的な課題についての理解も必要になります。

## オブザーバビリティとは何か？ {#what-is-observability}

オブザーバビリティとは、システムが出力する情報を調べることで、その内部状態を理解することです。
ソフトウェアシステムでは、アプリケーションやインフラストラクチャが生成するデータを通じて、
内部で何が起きているのかを理解することを意味します。

この分野は大きく発展してきており、2つの異なる世代のオブザーバビリティ手法として理解できます。

第一世代は、しばしば Observability 1.0 と呼ばれ、メトリクス、ログ、トレースという
従来の「3つの柱」のアプローチを中心に構築されました。このアプローチでは、種類の異なる
テレメトリごとに複数のツールやデータストアが必要でした。エンジニアは事前に何を計測したいかを
定義せざるを得ず、複数のシステムを維持するコストと複雑さが増大しました。

モダンなオブザーバビリティ、すなわち Observability 2.0 は、根本的に異なるアプローチを取ります。
これは、システム内の各ユニット・オブ・ワーク（例：HTTP リクエストとレスポンス）ごとに、
幅広く、構造化されたイベントを収集することを基盤としています。このアプローチでは、
ユーザー ID、リクエスト ID、Git コミットハッシュ、インスタンス ID、Kubernetes ポッド名、
特定のルートパラメータ、ベンダーのトランザクション ID など、高カーディナリティなデータを捕捉します。
経験則としては、システムの挙動の理解に役立つ可能性があるメタデータは追加する、というものです。

この豊富なデータ収集により、メトリクスを事前定義することなく、データを動的に絞り込み・切り分けることが
可能になります。チームは、この基盤データからメトリクス、トレース、その他の可視化を導出できるため、
計装を最初に追加した時点では想定していなかったような、システムの振る舞いに関する複雑な問いにも
答えられるようになります。

しかし、モダンなオブザーバビリティ機能を実装することには課題もあります。
組織は、このリッチなテレメトリデータを多様なシステムや技術スタック全体で収集・処理・エクスポートするための
信頼できる手段を必要とします。モダンなアプローチは従来の境界を超えて進化してきましたが、
オブザーバビリティの基本的な構成要素を理解することは依然として極めて重要です。

## オブザーバビリティの3つの柱 {#three-pillars-of-observability}

オブザーバビリティがどのように進化し、実際にどのように機能するのかをより深く理解するために、
オブザーバビリティの3つの柱である logs、metrics、traces を見ていきます。

現代的なオブザーバビリティでは、これらを単なる個別の要素として扱う段階はすでに超えていますが、
システムの振る舞いの異なる側面を理解するうえでの基本的な概念であることに変わりはありません。

1. **Logs** - システム内で発生する個々のイベントを表すテキストベースの記録。
特定の事象やエラー、状態変化に関する詳細なコンテキストを提供します。
2. **Metrics** - 時間の経過とともに収集される数値としての測定値。
カウンター、ゲージ、ヒストグラムなどが含まれ、システムパフォーマンス、リソース使用状況、ビジネスKPIの把握に役立ちます。
3. **Traces** - 分散システム内をリクエストがどのように流れていくかを追跡する記録。
サービス間の関係性を理解し、パフォーマンスボトルネックを特定するのに役立ちます。

これらの柱により、チームはシステムの監視、トラブルシューティング、最適化を行うことができます。
しかし、真価が発揮されるのは、この3つの柱すべてにまたがってデータを効果的に収集・分析し、
さらに相関付けることでシステムの振る舞いに関する有益な洞察を得られるようになったときです。

## オブザーバビリティの利点 {#the-benefits-of-observability}

オブザーバビリティの技術的な側面 ― ログ、メトリクス、トレース ― はよく理解されていますが、
ビジネス上の利点も同様に重要な検討事項です。

著書『[Observability Engineering](https://clickhouse.com/engineering-resources/observability#:~:text=Observability%20Engineering)』
（O'Reilly, 2022）において、Charity Majors、Liz Fong-Jones、George Miranda は、
業界調査と現場からのフィードバックに基づき、適切なオブザーバビリティ実践によって
組織が期待できる 4 つの主要なビジネス上の利点を特定しています。
それでは、これらの利点を見ていきましょう。

### より大きな増分収益 {#higher-incremental-revenue}

著者らは、稼働時間とパフォーマンスの向上を支援するオブザーバビリティツールが、コード品質の改善を通じて増分収益の向上につながると指摘しています。
これは次のような形で表れます。

1. 顧客体験の向上: 問題の迅速な解決とサービス劣化の防止により、顧客満足度と継続利用率が向上する
2. システム信頼性の向上: 高い稼働時間は、より多くの成功したトランザクションと、失われるビジネス機会の減少につながる
3. パフォーマンスの強化: パフォーマンスボトルネックを特定して最適化することで、顧客のエンゲージメントを維持できる応答性の高いサービスを保てる
4. 競争上の優位性: 包括的なモニタリングと迅速な問題解決によって高いサービス品質を維持できる組織は、多くの場合、競合他社に対して優位に立てる

### インシデント対応の高速化によるコスト削減 {#cost-savings-from-faster-incident-response}

オブザーバビリティの最も即効性のあるメリットの 1 つは、問題の検知と解決を高速化することで人的コストを削減できる点です。これは次のような要因によって実現されます。

* 平均検知時間 (MTTD) と平均復旧時間 (MTTR) の短縮
* クエリ応答時間の改善による、より迅速な調査の実現
* パフォーマンスボトルネックの迅速な特定
* オンコール対応に費やす時間の削減
* 不要なロールバックに浪費されるリソースの削減

この効果は実際にも確認されています。たとえば、[trip.com は ClickHouse を用いてオブザーバビリティシステムを構築](trip.com built their observability system with ClickHouse)し、従来のソリューションと比べてクエリ速度を 4～30 倍に高速化し、90% のクエリを 300 ms 未満で完了させることで、インシデントの迅速な調査を実現しました。

### インシデント回避によるコスト削減 {#cost-savings-from-incidents-avoided}

オブザーバビリティは、問題の解決を早めるだけでなく、問題そのものを完全に防ぐことにも貢献します。
著者らは、チームが次のような方法で重大な問題を未然に防げることを強調しています。

* 重大化する前に潜在的な問題を特定する
* パターンを分析して再発する問題を防ぐ
* さまざまな条件下でのシステム挙動を理解する
* 性能ボトルネックに事前に対処する
* システム改善についてデータに基づいて意思決定を行う

ClickHouse の[自社オブザーバビリティプラットフォームである LogHouse](https://clickhouse.com/blog/building-a-logging-platform-with-clickhouse-and-saving-millions-over-datadog)は、
その一例です。LogHouse によって、コアエンジニアはすべてのクラスタにわたる過去のパターンを検索でき、
問題の再発防止に役立てています。

### 従業員離職率低下によるコスト削減 {#cost-savings-from-decreased-employee-churn}

最も見落とされがちなメリットの 1 つが、チームの満足度と定着率への影響です。
著者たちは、オブザーバビリティが次のような効果をもたらすことを強調しています。

* より優れたツールによる仕事への満足度の向上
* 未解決の問題が減ることによる開発者の燃え尽き（バーンアウト）の軽減
* シグナルとノイズの比率の改善によるアラート疲れの軽減
* インシデント管理の改善によるオンコール時のストレス低減
* システム信頼性に対するチームの自信向上

これは実際にも確認されています。たとえば [Fastly が ClickHouse に移行したとき](https://clickhouse.com/videos/scaling-graphite-with-clickhouse)、
エンジニアたちはクエリ性能の向上に驚き、次のように述べています。

> "I couldn't believe it. I actually had to go back a couple of times just to
> make sure that I was querying it properly... this is coming back too fast.
> This doesn't make sense."

著者たちが強調しているとおり、これらのメリットの具体的な測定指標は、
利用するツールや実装方法によって異なる場合がありますが、このような根本的な改善は、
堅牢なオブザーバビリティの実践を採用した組織全般で期待できます。重要なのは、
こうしたメリットを最大化するために、適切なツールを選定し、効果的に実装することです。

これらのメリットを実現するには、いくつかの重要なハードルを乗り越える必要があります。
オブザーバビリティの価値を理解している組織であっても、
実装の段階で想定外の複雑さや課題に直面し、それらを慎重に乗り切らなければならないことがよくあります。

## オブザーバビリティ実装時の課題 {#challenges-in-implementing-observability}

組織内でオブザーバビリティを実装することは、システムのパフォーマンスと信頼性をより深く把握するための大きな転換点となります。しかし、この取り組みには課題も伴います。組織がオブザーバビリティの可能性を最大限に引き出そうとする過程では、前進を妨げるさまざまな障害に直面します。ここでは、そのいくつかを見ていきます。

### データ量とスケーラビリティ {#data-volume-and-scalability}

オブザーバビリティを実装する際の主な課題の 1 つは、モダンなシステムが生成する
テレメトリーデータの膨大なデータ量とスケーラビリティを管理することです。組織が
成長するにつれて監視すべきデータも増加するため、大規模なデータのインジェストと
リアルタイム分析を効率的に処理できるソリューションが必要になります。

### 既存システムとの統合 {#integration-with-existing-systems}

既存システムとの統合は、もう一つの大きな課題です。多くの
組織はさまざまな技術が混在する異種混在環境で運用しており、
オブザーバビリティツールが現在のインフラとシームレスに
統合できることが不可欠です。オープンな標準仕様は、この統合を促進し、
相互運用性を確保するとともに、多様な技術スタックにまたがって
オブザーバビリティソリューションをデプロイする際の複雑さを軽減するうえで
重要な役割を果たします。

### スキルギャップ {#skill-gaps}

スキルギャップも、オブザーバビリティの導入を妨げる要因となり得ます。高度なオブザーバビリティソリューションへの移行には、多くの場合、データ分析や特定のツールに関する専門知識が求められます。チームは、こうしたギャップを埋めてオブザーバビリティプラットフォームの機能を最大限に活用するために、トレーニングへの投資や新たな人材の採用が必要になる場合があります。

### コスト管理 {#cost-management}

オブザーバビリティソリューションは、特にスケールするとコストがかさみがちになるため、コスト管理は極めて重要です。組織は、これらのツールがもたらす価値とのバランスを取りつつ、従来型の手法と比べて大幅なコスト削減を実現できる、費用対効果の高いソリューションを模索する必要があります。

### データ保持とストレージ {#data-retention-and-storage}

データ保持とストレージ管理には、追加の課題が伴います。パフォーマンスやインサイトを損なうことなく、オブザーバビリティデータをどのくらいの期間保持するかを決定するには、慎重な計画と、ストレージ要件を削減しつつデータのアクセス性を維持できる効率的なストレージソリューションが必要です。

### 標準化とベンダーロックイン {#standardization-and-vendor-lock-in}

標準化を徹底し、ベンダーロックインを回避することは、オブザーバビリティソリューションの柔軟性と適応性を維持するうえで極めて重要です。オープン標準に準拠することで、組織は特定のベンダーに縛られることを防ぎ、自社のニーズに応じてオブザーバビリティスタックを発展させていくことができます。

### セキュリティとコンプライアンス {#security-and-compliance}

特にオブザーバビリティシステム内で機密データを扱う場合、セキュリティと
コンプライアンスに関する検討事項は依然として極めて重要です。組織は、自らの
オブザーバビリティソリューションが関連する規制を順守し、機密情報を
効果的に保護していることを確実にしなければなりません。

これらの課題は、組織のニーズを効果的に満たすオブザーバビリティソリューションを
実装するうえで、戦略的な計画と十分な情報に基づく意思決定の重要性を
強調しています。

これらの課題に対処するためには、組織はオブザーバビリティを実装するための
よく体系化されたアプローチを取る必要があります。標準的な
オブザーバビリティパイプラインは進化し、テレメトリーデータを効果的に収集・処理・
分析するためのフレームワークを提供するようになりました。この進化における
最も初期かつ影響力の大きい例のひとつが、2013年の Twitter の事例です。