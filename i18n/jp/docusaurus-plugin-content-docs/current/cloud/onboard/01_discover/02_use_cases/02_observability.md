---
slug: /cloud/get-started/cloud/use-cases/observability
title: '可観測性'
description: '分散アプリケーションにおける可観測性、モニタリング、ログ収集、およびシステム性能分析に ClickHouse Cloud を活用する'
keywords: ['ユースケース', '可観測性']
sidebar_label: '可観測性'
doc_type: 'guide'
---

<iframe width="758" height="426" src="https://www.youtube.com/embed/eKlZoT6hPwI?si=Wyrft2T04E1v8US6" title="YouTube 動画プレーヤー" frameborder="0" allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" referrerpolicy="strict-origin-when-cross-origin" allowfullscreen></iframe>

現代のソフトウェアシステムは複雑です。マイクロサービスやクラウドインフラストラクチャ、
分散システムなどの普及により、アプリケーション内部で何が起きているのかを
把握することがますます難しくなっています。問題が発生したとき、チームはどこでなぜそれが起きているのかを
すばやく特定する必要があります。

ここで重要になるのが可観測性です。可観測性は、単純なシステムモニタリングから発展し、
システムの振る舞いを理解するための包括的なアプローチへと進化してきました。しかし、
効果的な可観測性を実装することは容易ではなく、技術的な概念だけでなく、
組織的な課題についての理解も必要となります。



## オブザーバビリティとは何か {#what-is-observability}

オブザーバビリティとは、システムが出力する情報を調べることで、その内部状態を把握することです。
ソフトウェアシステムにおいては、アプリケーションやインフラストラクチャが生成するデータを通じて、その内部で何が起きているかを理解することを意味します。

この分野は大きく進化しており、オブザーバビリティのアプローチは 2 つの異なる世代として捉えることができます。

第一世代は、しばしば Observability 1.0 と呼ばれ、メトリクス・ログ・トレースという従来の「三本柱」アプローチを中心に構築されていました。
このアプローチでは、種類の異なるテレメトリごとに複数のツールやデータストアが必要でした。
また、計測したい内容を事前に定義することをエンジニアに強いるため、複数のシステムを維持するコストや複雑性が増大していました。

モダンなオブザーバビリティ、すなわち Observability 2.0 は、根本的に異なるアプローチを取ります。
これは、システム内の各作業単位（例：HTTP リクエストとレスポンス）ごとに、広範で構造化されたイベントを収集することを基盤としています。
このアプローチでは、ユーザー ID、リクエスト ID、Git コミットハッシュ、インスタンス ID、Kubernetes ポッド名、特定のルートパラメータ、ベンダーのトランザクション ID など、高カーディナリティなデータを取得します。
経験則としては、システムの挙動理解に役立ちそうなメタデータであれば追加する、という考え方になります。

この豊富なデータ収集により、メトリクスを事前定義することなく、データを動的にスライス＆ダイスできるようになります。
チームはこの基盤データからメトリクスやトレース、その他の可視化を導出できるため、計装を最初に追加した時点では想定していなかったようなシステム挙動に関する複雑な問いにも答えられるようになります。

しかし、モダンなオブザーバビリティ機能を実装することには、依然として課題があります。
組織は、多様なシステムや技術にまたがって、この豊富なテレメトリデータを確実に収集・処理・エクスポートする手段を必要としています。
モダンなアプローチは従来の境界を超えて進化している一方で、オブザーバビリティの基本的な構成要素を理解することは依然として重要です。



## オブザーバビリティの3つの柱 {#three-pillars-of-observability}

オブザーバビリティがどのように発展し、実際にどのように機能するかをよりよく理解するために、
オブザーバビリティの3つの柱である logs、metrics、traces を見ていきます。

近年のオブザーバビリティでは、これらを別個の関心事として扱う段階からは進化していますが、
システムの振る舞いのさまざまな側面を理解するうえでの基礎的な概念であることに変わりはありません。

1. **Logs** - システム内で発生する個々のイベントをテキスト形式で記録したもの。
特定の事象、エラー、状態変化に関する詳細なコンテキストを提供します。
2. **Metrics** - 時間の経過とともに収集される数値指標。
カウンター、ゲージ、ヒストグラムなどが含まれ、システム性能、リソース使用状況、ビジネスKPIの追跡に役立ちます。
3. **Traces** - 分散システム内を流れていくリクエストの経路を追跡する記録。
サービス間の関係を理解し、パフォーマンスボトルネックを特定するのに役立ちます。

これらの柱により、チームはシステムを監視し、トラブルシュートし、最適化できます。
ただし、真価を発揮するのは、3つの柱すべてにわたるデータを効果的に収集・分析し、
相関付けることで、システムの振る舞いに関する意味のある洞察を得られるようになったときです。



## オブザーバビリティのメリット {#the-benefits-of-observability}

オブザーバビリティの技術的な側面 ― ログ・メトリクス・トレース ― は
よく理解されていますが、ビジネス面でのメリットも同様に重要です。

書籍「[Observability Engineering](https://clickhouse.com/engineering-resources/observability#:~:text=Observability%20Engineering)」
（O'Reilly, 2022）において、Charity Majors、Liz Fong-Jones、George Miranda は、
業界調査と経験的なフィードバックに基づき、適切なオブザーバビリティ実践を
導入した組織が期待できる、4つの主要なビジネス上のメリットを特定しています。
以下でこれらのメリットを見ていきます。

### 増分収益の向上 {#higher-incremental-revenue}

著者たちは、稼働時間とパフォーマンスの改善を支援するオブザーバビリティツールが、
コード品質の向上を通じて増分収益の増加につながると指摘しています。
これは次のような形で現れます。

1. 顧客体験の向上: 問題の迅速な解決とサービス劣化の防止により、
   顧客満足度と継続利用が高まる
2. システム信頼性の向上: 稼働時間の向上は、成功するトランザクションの増加と
   機会損失の減少につながる
3. パフォーマンスの強化: パフォーマンスボトルネックを特定・最適化できることで、
   応答性の高いサービスを維持し、ユーザーのエンゲージメントを保てる
4. 競争優位性: 包括的な監視と迅速な障害解決により高いサービス品質を維持できる
   組織は、競合他社に対して優位に立てることが多い

### インシデント対応の高速化によるコスト削減 {#cost-savings-from-faster-incident-response}

オブザーバビリティの最も即効性のあるメリットの一つは、
問題の検知と解決の高速化による人件費の削減です。これは次の要因によります。

* 平均検知時間 (MTTD) と平均復旧時間 (MTTR) の短縮
* クエリ応答時間の改善による、より迅速な調査
* パフォーマンスボトルネックの早期特定
* オンコールに費やす時間の削減
* 不要なロールバックに費やされるリソースの削減

これは実際の事例でも確認できます。[trip.com は ClickHouse を用いてオブザーバビリティシステムを構築し](trip.com built their observability system with ClickHouse)、
従来のソリューションと比べてクエリ速度を 4〜30 倍に向上させ、クエリの 90% を
300ms 未満で完了させることで、迅速な問題調査を可能にしました。

### インシデント回避によるコスト削減 {#cost-savings-from-incidents-avoided}

オブザーバビリティは問題解決を早めるだけではなく、問題自体を未然に防ぎます。
著者たちは、チームが次のような形で重大インシデントを防止できる点を強調しています。

* 重大化する前の潜在的な問題の特定
* パターン分析による再発インシデントの防止
* 異なる条件下でのシステム挙動の理解
* パフォーマンスボトルネックへのプロアクティブな対応
* システム改善に関するデータ駆動型の意思決定

ClickHouse の[自社オブザーバビリティプラットフォームである LogHouse](https://clickhouse.com/blog/building-a-logging-platform-with-clickhouse-and-saving-millions-over-datadog)
は、その一例です。これによりコアエンジニアは、すべてのクラスタにわたる履歴パターンを検索でき、
再発インシデントの防止に役立てています。

### 従業員離職率の低下によるコスト削減 {#cost-savings-from-decreased-employee-churn}

最も見落とされがちなメリットの一つが、チームの満足度と定着率への影響です。
著者たちは、オブザーバビリティによって次のような効果が得られることを指摘しています。

* 優れたツールによる仕事満足度の向上
* 未解決問題の減少による開発者のバーンアウトの軽減
* より良いシグナル対ノイズ比によるアラート疲れの軽減
* インシデント対応の改善によるオンコールのストレス軽減
* システム信頼性に対するチームの自信向上

これも実例から確認できます。[Fastly が ClickHouse に移行した際](https://clickhouse.com/videos/scaling-graphite-with-clickhouse)、
エンジニアたちはクエリパフォーマンスの改善に驚嘆し、次のように述べています。

> 「信じられませんでした。本当に正しくクエリしているのか確認するために、
> 実際に何度か戻ってやり直さなければなりませんでした……戻りが速すぎる。
> 速すぎて理解できませんでした。」

著者たちが強調しているように、これらのメリットの具体的な測定値は、
利用するツールや実装によって異なる可能性がありますが、
堅牢なオブザーバビリティプラクティスを採用する組織全般において、
これらの基本的な改善は期待できます。
重要なのは、これらのメリットを最大化するために、適切なツールを選定し、
効果的に実装することです。

こうしたメリットを得るためには、いくつかの大きなハードルを乗り越える必要があります。
オブザーバビリティの価値を理解している組織であっても、
実装の段階で予期せぬ複雑さや課題に直面し、それらを慎重に乗り越えていく必要があります。



## オブザーバビリティ導入における課題 {#challenges-in-implementing-observability}

組織内にオブザーバビリティを実装することは、システムのパフォーマンスと信頼性に対する
より深い洞察を得るための大きな転換点となる取り組みです。しかし、この取り組みには課題も伴います。
組織がオブザーバビリティの潜在能力を最大限に活用しようとする中で、進捗を妨げかねない
さまざまな障害に直面します。ここでは、代表的な課題をいくつか見ていきます。

### データ量とスケーラビリティ {#data-volume-and-scalability}

オブザーバビリティを導入する際の主な障害のひとつは、現代のシステムが生成する
テレメトリデータの膨大な量と、そのスケーラビリティを管理することです。組織が成長するに
つれ、監視すべきデータも増加し、大規模なデータのインジェストとリアルタイム分析を
効率的に処理できるソリューションが必要になります。

### 既存システムとの統合 {#integration-with-existing-systems}

既存システムとの統合も大きな課題となります。多くの組織は多様なテクノロジーが混在する
異種混在環境で運用しているため、オブザーバビリティツールが現在のインフラストラクチャと
シームレスに統合できることが不可欠です。オープン標準はこの統合を促進し、
相互運用性を確保するとともに、さまざまな技術スタック全体にオブザーバビリティソリューションを
デプロイする際の複雑さを軽減するうえで重要な役割を果たします。

### スキルギャップ {#skill-gaps}

スキルギャップも、オブザーバビリティの導入を妨げる要因になり得ます。高度な
オブザーバビリティソリューションへの移行には、多くの場合、データ分析や特定ツールに関する
専門的な知識が求められます。チームはこれらのギャップを埋めて、オブザーバビリティ
プラットフォームの機能を十分に引き出すために、トレーニングへの投資や人材採用が必要になる
場合があります。

### コスト管理 {#cost-management}

コスト管理も重要です。特に大規模な環境では、オブザーバビリティソリューションのコストが
高額になる可能性があります。組織は、これらのツールが提供する価値とコストのバランスを
取る必要があり、従来のアプローチと比べて大きなコスト削減を実現できる、費用対効果の高い
ソリューションを検討しなければなりません。

### データ保持とストレージ {#data-retention-and-storage}

データ保持およびストレージ管理も追加の課題です。パフォーマンスやインサイトを損なうことなく、
オブザーバビリティデータをどの程度の期間保持するかを決定するには、慎重な計画と、
データのアクセス性を維持しつつストレージ要件を削減できる効率的なストレージソリューションが
必要です。

### 標準化とベンダーロックイン {#standardization-and-vendor-lock-in}

標準化を確保し、ベンダーロックインを回避することは、オブザーバビリティソリューションにおける
柔軟性と適応性を維持するうえで極めて重要です。オープン標準に準拠することで、
組織は特定ベンダーへの固定化を防ぎ、自社のニーズに合わせてオブザーバビリティスタックを
進化させられるようにできます。

### セキュリティとコンプライアンス {#security-and-compliance}

特にオブザーバビリティシステム内で機微なデータを扱う場合、セキュリティとコンプライアンスは
依然として重要な検討事項です。組織は、自社のオブザーバビリティソリューションが関連する
規制に準拠し、機微情報を効果的に保護できるようにする必要があります。

これらの課題は、組織のニーズを効果的に満たすオブザーバビリティソリューションを導入する
うえで、戦略的な計画と十分な情報に基づく意思決定が重要であることを示しています。

これらの課題に対処するには、組織はオブザーバビリティを導入するための、体系立てられた
アプローチが必要です。標準的なオブザーバビリティパイプラインは進化を続けており、
テレメトリデータを効果的に収集・処理・分析するためのフレームワークを提供します。
この進化の最初期かつ最も影響力のある例のひとつが、2013 年における Twitter の取り組みです。
