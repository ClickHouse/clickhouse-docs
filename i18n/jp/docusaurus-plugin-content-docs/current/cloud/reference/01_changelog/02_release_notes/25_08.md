---
slug: /changelogs/25.8
title: 'v25.8 クラウド向け変更履歴'
description: 'v25.8 早期リリース版の変更履歴'
keywords: ['changelog', 'cloud']
sidebar_label: '25.8'
sidebar_position: 1
doc_type: 'changelog'
---



## 後方互換性のない変更 {#backward-incompatible-changes}

### JSONおよびデータフォーマットの変更 {#json-and-data-format-changes}

- JSONフォーマットにおいて、64ビット整数の引用符付けをデフォルトで無効化しました。[#74079](https://github.com/ClickHouse/ClickHouse/pull/74079) ([Pavel Kruglov](https://github.com/Avogar))。
- JSONにおいて、異なる型の値を持つ配列に対して、無名の`Tuple`の代わりに`Array(Dynamic)`を推論するようになりました。以前の動作を使用するには、設定[`input_format_json_infer_array_of_dynamic_from_array_of_different_types`](/operations/settings/formats#input_format_json_infer_array_of_dynamic_from_array_of_different_types)を無効にしてください。[#80859](https://github.com/ClickHouse/ClickHouse/pull/80859) ([Pavel Kruglov](https://github.com/Avogar))。
- Parquet出力フォーマットにおいて、`Enum`型の値をデフォルトで`ENUM`論理型を持つ`BYTE_ARRAY`として書き込むようになりました。[#84169](https://github.com/ClickHouse/ClickHouse/pull/84169) ([Pavel Kruglov](https://github.com/Avogar))。

### ストレージとパーティショニング {#storage-and-partitioning}

- Hiveパーティションスタイルの書き込みのサポートを追加し、読み取り実装をリファクタリングしました(Hiveパーティションカラムは仮想カラムではなくなりました)。[#76802](https://github.com/ClickHouse/ClickHouse/pull/76802) ([Arthur Passos](https://github.com/arthurpassos))。
- MergeTree設定[`write_marks_for_substreams_in_compact_parts`](/operations/settings/merge-tree-settings#write_marks_for_substreams_in_compact_parts)をデフォルトで有効化しました。これにより、新しく作成されたCompactパートからのサブカラム読み取りのパフォーマンスが大幅に向上します。バージョン25.5未満のサーバーは、新しいCompactパートを読み取ることができません。[#84171](https://github.com/ClickHouse/ClickHouse/pull/84171) ([Pavel Kruglov](https://github.com/Avogar))。
- SummingMergeTreeにおいて、合計対象として明示的にリストされたカラムに対する`RENAME COLUMN`または`DROP COLUMN`を禁止しました。[#81836](https://github.com/ClickHouse/ClickHouse/issues/81836)をクローズします。[#82821](https://github.com/ClickHouse/ClickHouse/pull/82821) ([Alexey Milovidov](https://github.com/alexey-milovidov))。

### 関数の機能強化 {#function-enhancements}

- [`extractKeyValuePairs`](/sql-reference/functions/tuple-map-functions#extractkeyvaluepairs)関数に新しい引数`unexpected_quoting_character_strategy`を導入しました。これは、`quoting_character`が予期せず見つかった場合の動作を制御します。詳細については、[`extractKeyValuePairs`](/sql-reference/functions/tuple-map-functions#extractkeyvaluepairs)のドキュメントを参照してください。[#80657](https://github.com/ClickHouse/ClickHouse/pull/80657) ([Arthur Passos](https://github.com/arthurpassos))。
- 以前は、[`countMatches`](/sql-reference/functions/string-search-functions#countMatches)関数は、パターンが空のマッチを受け入れる場合でも、最初の空のマッチでカウントを停止していました。この問題を解決するため、`countMatches`は空のマッチが発生した際に1文字進めることで実行を継続するようになりました。以前の動作を維持したいユーザーは、設定`count_matches_stop_at_empty_match`を有効にすることができます。[#81676](https://github.com/ClickHouse/ClickHouse/pull/81676) ([Elmi Ahmadov](https://github.com/ahmadov))。

### データ型の改善 {#data-type-improvements}

- `Decimal`から`Float32`への変換の精度を向上させました。`Decimal`から`BFloat16`への変換を実装しました。[#82660](https://github.com/ClickHouse/ClickHouse/issues/82660)をクローズします。[#82823](https://github.com/ClickHouse/ClickHouse/pull/82823) ([Alexey Milovidov](https://github.com/alexey-milovidov))。

### パフォーマンスとリソース管理 {#performance-and-resource-management}


- 以前は、`BACKUP`クエリ、マージ、ミューテーションは、ローカル(`max_local_read_bandwidth_for_server`および`max_local_write_bandwidth_for_server`)およびリモート(`max_remote_read_network_bandwidth_for_server`および`max_remote_write_network_bandwidth_for_server`)トラフィックに対してサーバー全体のスロットラーを使用せず、専用のサーバー設定(`max_backup_bandwidth_for_server`、`max_mutations_bandwidth_for_server`、`max_merges_bandwidth_for_server`)によってのみスロットリングされていました。現在は、両方のタイプのスロットラーを同時に使用します。[#81753](https://github.com/ClickHouse/ClickHouse/pull/81753) ([Sergei Trifonov](https://github.com/serxa))。
- 新しい設定[`cluster_function_process_archive_on_multiple_nodes`](/operations/settings/settings#cluster_function_process_archive_on_multiple_nodes)が追加されました。この設定をtrue(デフォルト)に設定すると、クラスター関数でのアーカイブ処理のパフォーマンスが向上します。以前のバージョンでアーカイブを使用したクラスター関数を使用している場合、互換性を保ち、25.7+へのアップグレード時のエラーを回避するために、`false`に設定する必要があります。[#82355](https://github.com/ClickHouse/ClickHouse/pull/82355) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 以前の[`concurrent_threads_scheduler`](/operations/server-configuration-parameters/settings#concurrent_threads_scheduler)のデフォルト値は`round_robin`でしたが、多数のシングルスレッドクエリ(例:`INSERT`)が存在する場合に不公平であることが判明しました。この変更により、より安全な代替手段である`fair_round_robin`スケジューラーがデフォルトになります。[#84747](https://github.com/ClickHouse/ClickHouse/pull/84747) ([Sergei Trifonov](https://github.com/serxa))。
- 遅延マテリアライゼーションは、アナライザーを使用する場合にのみ有効になります。これは、アナライザーなしでのメンテナンスを回避するためであり、アナライザーなしでは問題が発生する可能性があります(例えば、条件内で`indexHint()`を使用する場合)。[#83791](https://github.com/ClickHouse/ClickHouse/pull/83791) ([Igor Nikonov](https://github.com/devcrafter))。

### スキーマとSQL構文 {#schema-and-sql-syntax}

- 挿入可能な列を持たないテーブルの作成を禁止します。[#81835](https://github.com/ClickHouse/ClickHouse/pull/81835) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。
- デフォルト式内でドットを含む識別子が複合識別子として解析されないようにするため、バッククォートで囲むことを必須とします。[#83162](https://github.com/ClickHouse/ClickHouse/pull/83162) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。
- PostgreSQL形式のヒアドキュメント構文をサポートします:`$tag$ string contents... $tag$`(ドル引用符付き文字列リテラルとも呼ばれます)。以前のバージョンでは、タグに対する制限が少なく、句読点や空白を含む任意の文字を含めることができました。これにより、ドル文字で始まる識別子との解析の曖昧さが生じます。一方、PostgreSQLではタグに単語文字のみを許可しています。この問題を解決するため、ヒアドキュメントタグには単語文字のみを含めるように制限しました。[#84731](https://github.com/ClickHouse/ClickHouse/issues/84731)をクローズします。[#84846](https://github.com/ClickHouse/ClickHouse/pull/84846) ([Alexey Milovidov](https://github.com/alexey-milovidov))。

### セキュリティと権限 {#security-and-permissions}

- `SYSTEM RESTART REPLICAS`は、`SHOW TABLES`の権限を持つデータベース内のレプリカのみを再起動します。以前は、このクエリによって、そのデータベースへのアクセス権がない場合でも、Lazyデータベース内のテーブルが起動され、これらのテーブルが同時に削除されている間に問題が発生していました。[#83321](https://github.com/ClickHouse/ClickHouse/pull/83321) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 関数`azureBlobStorage`、`deltaLakeAzure`、`icebergAzure`が更新され、`AZURE`権限を適切に検証するようになりました。すべてのクラスターバリアント関数(`-Cluster`関数)は、対応する非クラスター版に対して権限を検証するようになりました。さらに、`icebergLocal`および`deltaLakeLocal`関数は、`FILE`権限チェックを実施するようになりました。[#84938](https://github.com/ClickHouse/ClickHouse/pull/84938) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov


## 新機能 {#new-feature}

### データ型 {#data-types}

- 新しいデータ型を追加: [`Time`](/sql-reference/data-types/time) `([H]HH:MM:SS)` および [`Time64`](/sql-reference/data-types/time64) `([H]HH:MM:SS[.fractional])`、ならびに基本的なキャスト関数と他のデータ型との連携用関数。レガシー関数 `ToTime` との互換性のための設定を追加しました。[#81217](https://github.com/ClickHouse/ClickHouse/pull/81217) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。

### 関数 {#functions}


* [`NumericIndexedVector`](/sql-reference/functions/numeric-indexed-vector-functions) を追加しました。これはビットスライス方式の Roaring Bitmap 圧縮を基盤とする新しいベクター型データ構造であり、構築、分析、および要素単位の算術演算のための 20 を超える関数とともに提供されます。スパースデータに対するストレージ使用量を削減し、結合、フィルタ、集約を高速化できます。[#70582](https://github.com/ClickHouse/ClickHouse/issues/70582) および T. Xiong と Y. Wang による VLDB 2024 の論文「[Large-Scale Metric Computation in Online Controlled Experiment Platform](https://arxiv.org/abs/2405.08411)」を実装しています。[#74193](https://github.com/ClickHouse/ClickHouse/pull/74193)（[FriendLey](https://github.com/FriendLey)）。
* 次の財務関数を追加しました：[`financialInternalRateOfReturnExtended`](/sql-reference/functions/financial-functions#financialInternalRateOfReturnExtended)（`XIRR`）、[`financialInternalRateOfReturn`](/sql-reference/functions/financial-functions#financialInternalRateOfReturn)（`IRR`）、[`financialNetPresentValueExtended`](/sql-reference/functions/financial-functions#financialNetPresentValueExtended)（`XNPV`）、[`financialNetPresentValue`](/sql-reference/functions/financial-functions#financialNetPresentValue)（`NPV`）。[#81599](https://github.com/ClickHouse/ClickHouse/pull/81599)（[Joanna Hulboj](https://github.com/jh0x)）。
* 2 つのポリゴンが交差しているかを判定するための地理空間関数 [`polygonIntersectsCartesian`](/sql-reference/functions/geo/polygons#polygonsintersectcartesian) および [`polygonIntersectsSpherical`](/sql-reference/functions/geo/polygons#polygonsintersectspherical) を追加しました。 [#81882](https://github.com/ClickHouse/ClickHouse/pull/81882)（[Paul Lamb](https://github.com/plamb)）。
* [`lag`](/sql-reference/window-functions/lag) および [`lead`](/sql-reference/window-functions/lead) ウィンドウ関数をサポートしました。[#9887](https://github.com/ClickHouse/ClickHouse/issues/9887) をクローズしました。[#82108](https://github.com/ClickHouse/ClickHouse/pull/82108)（[Dmitry Novik](https://github.com/novikd)）。
* sRGB と OkLCH のカラー空間間で色を相互変換するための関数 [`colorSRGBToOkLCH`](/sql-reference/functions/other-functions#colorSRGBToOKLCH) および [`colorOkLCHToSRGB`](/sql-reference/functions/other-functions#colorOKLCHToSRGB) を追加しました。 [#83679](https://github.com/ClickHouse/ClickHouse/pull/83679) ([Fgrtue](https://github.com/Fgrtue))。
* ユーザーは、[`JSONExtractCaseInsensitive`](/sql-reference/functions/json-functions#JSONExtractCaseInsensitive)（およびその他の `JSONExtract` のバリアント）を使用して、大文字・小文字を区別しない JSON キーのルックアップを実行できるようになりました。 [#83770](https://github.com/ClickHouse/ClickHouse/pull/83770)（[Alistair Evans](https://github.com/alistairjevans)）。
* 新しい関数 [`nowInBlock64`](/sql-reference/functions/date-time-functions#nowInBlock64) を追加しました。 [#84178](https://github.com/ClickHouse/ClickHouse/pull/84178) ([Halersson Paris](https://github.com/halersson))。
* DateTime 値を UUIDv7 に変換する関数 [`dateTimeToUUIDv7`](/sql-reference/functions/uuid-functions#dateTimeToUUIDv7) を追加しました。使用例: `SELECT dateTimeToUUIDv7(toDateTime('2025-08-15 18:57:56'))` は `0198af18-8320-7a7d-abd3-358db23b9d5c` を返します。 [#84319](https://github.com/ClickHouse/ClickHouse/pull/84319)（[samradovich](https://github.com/samradovich)）。
* 開始タイムスタンプ、終了タイムスタンプ、およびステップで定義される時間グリッド上にデータを再サンプリングするための集約関数 [`timeSeriesDerivToGrid`](/sql-reference/aggregate-functions/reference/timeSeriesDerivToGrid) と [`timeSeriesPredictLinearToGrid`](/sql-reference/aggregate-functions/reference/timeSeriesPredictLinearToGrid) を追加し、それぞれ PromQL の `deriv` および `predict_linear` に相当する値を計算します。 [#84328](https://github.com/ClickHouse/ClickHouse/pull/84328)（[Stephen Chi](https://github.com/stephchi0)）。
* [`timeSeriesRange`](/sql-reference/functions/time-series-functions#timeSeriesRange) 関数と [`timeSeriesFromGrid`](/sql-reference/functions/time-series-functions#timeSeriesFromGrid) 関数を追加しました。 [#85435](https://github.com/ClickHouse/ClickHouse/pull/85435) ([Vitaly Baranov](https://github.com/vitlibar))。

### システムテーブル {#system-tables}

- Kafkaなどのエンジンから受信したエラーメッセージを保持するための[`system.dead_letter_queue`](/operations/system-tables/dead_letter_queue)テーブルを追加しました。[#68873](https://github.com/ClickHouse/ClickHouse/pull/68873) ([Ilya Golshtein](https://github.com/ilejn))。
- ZooKeeper接続の履歴情報を保存するための[`system.zookeeper_connection_log`](/operations/system-tables/zookeeper_connection_log)システムテーブルを追加しました。[#79494](https://github.com/ClickHouse/ClickHouse/pull/79494) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
- 利用可能なコーデックを確認するための新しいシステムテーブル[`system.codecs`](/operations/system-tables/codecs)を追加しました。(issue [#81525](https://github.com/ClickHouse/ClickHouse/issues/81525))。[#81600](https://github.com/ClickHouse/ClickHouse/pull/81600) ([Jimmy Aguilar Mena](https://github.com/Ergus))。
- `system.completions`テーブルを導入しました。Closes [#81889](https://github.com/ClickHouse/ClickHouse/issues/81889)。[#83833](https://github.com/ClickHouse/ClickHouse/pull/83833) ([|2ustam](https://github.com/RuS2m))。

### IcebergとDeltaLake {#iceberg-and-deltalake}

- Icebergスキーマ進化における複合型をサポートしました。[#73714](https://github.com/ClickHouse/ClickHouse/pull/73714) ([scanhex12](https://github.com/scanhex12))。
- `insert`クエリに対するIceberg書き込みを導入しました。[#82692](https://github.com/ClickHouse/ClickHouse/pull/82692) ([scanhex12](https://github.com/scanhex12))。
- Icebergテーブルエンジンの位置指定削除をサポートしました。[#83094](https://github.com/ClickHouse/ClickHouse/pull/83094) ([Daniil Ivanik](https://github.com/divanik))。
- フィールドIDによるIcebergデータファイルの読み取りをサポートしました。Closes [#83065](https://github.com/ClickHouse/ClickHouse/issues/83065)。[#83653](https://github.com/ClickHouse/ClickHouse/pull/83653) ([scanhex12](https://github.com/scanhex12))。
- テーブル作成時のIceberg書き込みをサポートしました。Closes [#83927](https://github.com/ClickHouse/ClickHouse/issues/83927)。[#83983](https://github.com/ClickHouse/ClickHouse/pull/83983) ([scanhex12](https://github.com/scanhex12))。
- Glueカタログへの書き込みをサポートしました。[#84136](https://github.com/ClickHouse/ClickHouse/pull/84136) ([scanhex12](https://github.com/scanhex12))。
- Iceberg RESTカタログへの書き込みをサポートしました。[#84684](https://github.com/ClickHouse/ClickHouse/pull/84684) ([scanhex12](https://github.com/scanhex12))。
- すべてのIceberg位置削除ファイルをデータファイルにマージします。これによりIcebergストレージ内のParquetファイルの数とサイズが削減されます。構文: `OPTIMIZE TABLE table_name`。[#85250](https://github.com/ClickHouse/ClickHouse/pull/85250) ([scanhex12](https://github.com/scanhex12))。
- Icebergの`DROP TABLE`をサポートしました(REST/Glueカタログからの削除 + テーブルに関するメタデータの削除)。[#85395](https://github.com/ClickHouse/ClickHouse/pull/85395) ([scanhex12](https://github.com/scanhex12))。
- merge-on-read形式のIcebergに対する`ALTER DELETE`ミューテーションをサポートしました。[#85549](https://github.com/ClickHouse/ClickHouse/pull/85549) ([scanhex12](https://github.com/scanhex12))。
- DeltaLakeへの書き込みをサポートしました。Closes [#79603](https://github.com/ClickHouse/ClickHouse/issues/79603)。[#85564](https://github.com/ClickHouse/ClickHouse/pull/85564) ([Kseniia Sumarokova](https://github.com/kssenii))。
- min-maxプルーニングのためにメタデータ(マニフェストエントリ)により多くのIceberg統計情報(列サイズ、下限と上限)を書き込むようにしました。[#85746](https://github.com/ClickHouse/ClickHouse/pull/85746) ([scanhex12](https://github.com/scanhex12))。
- 単純型に対するIcebergでの列の追加/削除/変更をサポートしました。[#85769](https://github.com/ClickHouse/ClickHouse/pull/85769) ([scanhex12](https://github.com/scanhex12))。


### MergeTreeとストレージ {#mergetree-and-storage}

- すべてのテーブルで`_table`仮想カラムがサポートされるようになりました(Merge型テーブルのみではなくなりました)。[#63665](https://github.com/ClickHouse/ClickHouse/pull/63665) ([Xiaozhe Yu](https://github.com/wudidapaopao))。
- `Float32`および`Float64`型のカラムに対して、非可逆でありながら誤差範囲が制限された圧縮コーデックとしてSZ3を追加しました。[#67161](https://github.com/ClickHouse/ClickHouse/pull/67161) ([scanhex12](https://github.com/scanhex12))。
- `MergeTree`ファミリーテーブルに対する軽量更新のサポートを追加しました。軽量更新は新しい構文で使用できます:`UPDATE <table> SET col1 = val1, col2 = val2, ... WHERE <condition>`。軽量更新を介した軽量削除の実装を追加しました。これは`lightweight_delete_mode = 'lightweight_update'`を設定することで有効化できます。[#82004](https://github.com/ClickHouse/ClickHouse/pull/82004) ([Anton Popov](https://github.com/CurtizJ))。
- MergeTreeファミリーテーブルで`_part_granule_offset`仮想カラムをサポートしました。このカラムは、各行がデータパート内で属するグラニュール/マークのゼロベースのインデックスを示します。これは[#79572](https://github.com/ClickHouse/ClickHouse/issues/79572)に対応しています。[#82341](https://github.com/ClickHouse/ClickHouse/pull/82341) ([Amos Bird](https://github.com/amosbird))。

### プロトコルとクライアントのサポート {#protocol-and-client-support}

- [`arrowflight`](/engines/table-engines/integrations/arrowflight)テーブルエンジンを追加することで、[ArrowFlight RPC](https://arrow.apache.org/docs/format/Flight.html)プロトコルのサポートを実装しました。[#74184](https://github.com/ClickHouse/ClickHouse/pull/74184) ([zakr600](https://github.com/zakr600))。
- PostgreSQLプロトコルの`COPY`コマンドのサポートを追加しました。[#74344](https://github.com/ClickHouse/ClickHouse/pull/74344) ([scanhex12](https://github.com/scanhex12))。
- mysqlプロトコル用のC#クライアントをサポートしました。これにより[#83992](https://github.com/ClickHouse/ClickHouse/issues/83992)がクローズされます。[#84397](https://github.com/ClickHouse/ClickHouse/pull/84397) ([scanhex12](https://github.com/scanhex12))。
- `mysql_port`および`postgresql_port`に対してセキュア接続を強制するようにしました。[#82962](https://github.com/ClickHouse/ClickHouse/pull/82962) ([Shaohua Wang](https://github.com/tiandiwonder))。

### SQLとクエリ機能 {#sql-and-query-features}

- `DESCRIBE (SELECT ...)`に加えて`DESCRIBE SELECT`をサポートしました。[#82947](https://github.com/ClickHouse/ClickHouse/pull/82947) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- `USE DATABASE {name}`の記述をサポートしました。[#81307](https://github.com/ClickHouse/ClickHouse/pull/81307) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- 並列レプリカに対してプロジェクションからの読み取りが実装されました。プロジェクションサポートが有効かどうかを制御するための新しい設定[`parallel_replicas_support_projection`](/operations/settings/settings#parallel_replicas_support_projection)が追加されました。実装を簡素化するため、プロジェクションのサポートは`parallel_replicas_local_plan`がアクティブな場合にのみ有効になります。[#82807](https://github.com/ClickHouse/ClickHouse/pull/82807) ([zoomxi](https://github.com/zoomxi))。

### フォーマット {#formats}

- `format_schema`のソースを定義する[`format_schema_source`](/operations/settings/formats#format_schema_source)設定を追加しました。[#80874](https://github.com/ClickHouse/ClickHouse/pull/80874) ([Tuan Pham Anh](https://github.com/tuanpach))。
- 新しい出力フォーマットとして`Hash`を追加しました。これは結果のすべてのカラムと行に対して単一のハッシュ値を計算します。これは、例えばデータ転送がボトルネックとなるユースケースにおいて、結果の「フィンガープリント」を計算するのに有用です。例:`SELECT arrayJoin(['abc', 'def']), 42 FORMAT Hash`は`e5f9e676db098fdb9530d2059d8c23ef`を返します。[#84607](https://github.com/ClickHouse/ClickHouse/pull/84607) ([Robert Schulze](https://github.com/rschu1ze))。


### サーバー設定とワークロード管理 {#server-configuration-and-workload-management}

- サーバー設定[`cpu_slot_preemption`](/operations/server-configuration-parameters/settings#cpu_slot_preemption)は、ワークロードに対するプリエンプティブCPUスケジューリングを有効にし、ワークロード間でのCPU時間の最大最小公平割り当てを保証します。CPU制限のための新しいワークロード設定が追加されました:`max_cpus`、`max_cpu_share`、`max_burst_cpu_seconds`。[#80879](https://github.com/ClickHouse/ClickHouse/pull/80879) ([Sergei Trifonov](https://github.com/serxa))。
- ワークロード設定[`max_waiting_queries`](/operations/server-configuration-parameters/settings#max_waiting_queries)がサポートされるようになりました。これはクエリキューのサイズを制限するために使用できます。制限に達した場合、以降のすべてのクエリは`SERVER_OVERLOADED`エラーで終了されます。[#81250](https://github.com/ClickHouse/ClickHouse/pull/81250) ([Oleg Doronin](https://github.com/dorooleg))。
- 設定されたクエリ数または時間閾値の後にTCP接続を切断します。[#68000](https://github.com/ClickHouse/ClickHouse/issues/68000)を解決します。[#81472](https://github.com/ClickHouse/ClickHouse/pull/81472) ([Kenny Sun](https://github.com/hwabis))。

### クラウドストレージ {#cloud-storage}

- `AzureBlobStorage`に`extra_credentials`を追加し、`client_id`と`tenant_id`による認証を可能にしました。[#84235](https://github.com/ClickHouse/ClickHouse/pull/84235) ([Pablo Marcos](https://github.com/pamarcos))。

### Keeper {#keeper}

- Keeper Multiクエリで任意のウォッチを設定する機能を追加しました。[#84964](https://github.com/ClickHouse/ClickHouse/pull/84964) ([Mikhail Artemenko](https://github.com/Michicosun))。
- 部分的に集約されたメトリクスをサポートしました。[#85328](https://github.com/ClickHouse/ClickHouse/pull/85328) ([Mikhail Artemenko](https://github.com/Michicosun))。


## 実験的機能 {#experimental-features}

### テーブルエンジンとテーブル関数 {#table-engines-and-table-functions}

- Ytsaurusテーブルエンジンとテーブル関数を追加しました。[#77606](https://github.com/ClickHouse/ClickHouse/pull/77606) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。

### テキストインデックスの改善 {#text-index-improvements}

- テキストインデックスを検索するための汎用ツールである`searchAny`および`searchAll`関数を追加しました。[#80641](https://github.com/ClickHouse/ClickHouse/pull/80641) ([Elmi Ahmadov](https://github.com/ahmadov))。
- テキストインデックスが`string`トークナイザーをサポートするようになりました。[#81752](https://github.com/ClickHouse/ClickHouse/pull/81752) ([Elmi Ahmadov](https://github.com/ahmadov))。
- `text`インデックスのデフォルトインデックス粒度値を64に変更しました。これにより、内部ベンチマークにおける平均的なテストクエリの期待パフォーマンスが向上します。[#82162](https://github.com/ClickHouse/ClickHouse/pull/82162) ([Jimmy Aguilar Mena](https://github.com/Ergus))。
- 256ビットビットマップは状態の出力ラベルを順序付けて格納しますが、出力状態はハッシュテーブルに現れる順序でディスクに保存されます。そのため、ディスクから読み取る際にラベルが誤った次の状態を指す可能性がありました。この問題を修正しました。[#82783](https://github.com/ClickHouse/ClickHouse/pull/82783) ([Elmi Ahmadov](https://github.com/ahmadov))。
- 現在、FSTツリーは非圧縮でディスクに保存されています。これにより、ディスクへの書き込みおよびディスクからの読み取り時にパフォーマンス低下やI/O帯域幅の増加が発生する可能性があります。この問題に対処しました。[#83093](https://github.com/ClickHouse/ClickHouse/pull/83093) ([Elmi Ahmadov](https://github.com/ahmadov))。

### 機能成熟度の更新 {#feature-maturity-updates}

- カタログをベータ版に移行しました。[#85848](https://github.com/ClickHouse/ClickHouse/pull/85848) ([Melvyn Peignon](https://github.com/melvynator))。
- 軽量更新が実験的段階からベータ段階に移行しました。[#85952](https://github.com/ClickHouse/ClickHouse/pull/85952) ([Anton Popov](https://github.com/CurtizJ))。


## パフォーマンスの改善 {#performance-improvements}

### クエリ実行と集約 {#query-execution-and-aggregation}

- `-If`集約関数コンビネータの軽微な最適化。[#78454](https://github.com/ClickHouse/ClickHouse/pull/78454) ([李扬](https://github.com/taiyang-li)).
- メモリ効率の良い集約中に一部のバケットを順不同で送信できる新しいロジックを追加(設定[`enable_producing_buckets_out_of_order_in_aggregation`](/operations/settings/settings#enable_producing_buckets_out_of_order_in_aggregation)で制御、デフォルトで有効)。一部の集約バケットのマージに他のバケットよりも大幅に時間がかかる場合、イニシエータがその間により高いバケットIDのバケットをマージできるようにすることでパフォーマンスが向上します。欠点は、メモリ使用量が増加する可能性があることです(ただし、大きな影響はないはずです)。[#80179](https://github.com/ClickHouse/ClickHouse/pull/80179) ([Nikita Taranov](https://github.com/nickitat)).
- `TOTALS`ステップ後のパイプラインをマルチスレッド化。[#80331](https://github.com/ClickHouse/ClickHouse/pull/80331) ([UnamedRus](https://github.com/UnamedRus)).
- 集約クエリが`NOT NULL`カラムに対する単一の`COUNT()`関数のみを含む場合、ハッシュテーブルのプローブ中に集約ロジックが完全にインライン化されます。これにより、集約状態の割り当てと維持が不要になり、メモリ使用量とCPUオーバーヘッドが大幅に削減されます。これは[#81982](https://github.com/ClickHouse/ClickHouse/issues/81982)を部分的に解決します。[#82104](https://github.com/ClickHouse/ClickHouse/pull/82104) ([Amos Bird](https://github.com/amosbird)).
- 複数の文字列または数値カラムでグループ化する際に、シリアル化されたキーをカラム単位で計算。[#83884](https://github.com/ClickHouse/ClickHouse/pull/83884) ([李扬](https://github.com/taiyang-li)).
- `-If`コンビネータ用の`addManyDefaults`を実装。[#83870](https://github.com/ClickHouse/ClickHouse/pull/83870) ([Raúl Marín](https://github.com/Algunenano)).

### JOIN最適化 {#join-optimizations}


- 新しい設定 [`min_joined_block_size_rows`](/operations/settings/settings#min_joined_block_size_rows) を追加しました（`min_joined_block_size_bytes` に類似、デフォルトは 65409）。この設定は、JOIN の入力および出力ブロックの最小ブロックサイズ（行数）を制御します（結合アルゴリズムがサポートしている場合）。小さなブロックは統合されます。[#81886](https://github.com/ClickHouse/ClickHouse/pull/81886) ([Nikita Taranov](https://github.com/nickitat))。
- `HashJoin` のパフォーマンスを最適化しました。キー列が1つのみの典型的なケースにおいて、ハッシュマップに対する追加のループを削除し、また `null_map` と `join_mask` のチェックが常に `true`/`false` である場合にそれらを省略しました。[#82308](https://github.com/ClickHouse/ClickHouse/pull/82308) ([Nikita Taranov](https://github.com/nickitat))。
- [#82308](https://github.com/ClickHouse/ClickHouse/issues/82308) の `null_map` と `JoinMask` の最適化を、複数の選言を持つ JOIN のケースに適用しました。また、`KnownRowsHolder` データ構造も最適化しました。[#83041](https://github.com/ClickHouse/ClickHouse/pull/83041) ([Nikita Taranov](https://github.com/nickitat))。
- 結合フラグに対してシンプルな `std::vector<std::atomic_bool>` を使用することで、フラグへの各アクセス時のハッシュ計算を回避しました。[#83043](https://github.com/ClickHouse/ClickHouse/pull/83043) ([Nikita Taranov](https://github.com/nickitat))。
- ハッシュ JOIN のメインループの外側で `max_joined_block_rows` を処理するようにしました。ALL JOIN のパフォーマンスがわずかに向上します。[#83216](https://github.com/ClickHouse/ClickHouse/pull/83216) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- `HashJoin` が `lazy` 出力モードを使用する場合、結果列のメモリを事前に割り当てないようにしました。特にマッチ数が少ない場合、事前割り当ては最適ではありません。さらに、結合完了後に正確なマッチ数がわかるため、より正確に事前割り当てを行うことができます。[#83304](https://github.com/ClickHouse/ClickHouse/pull/83304) ([Nikita Taranov](https://github.com/nickitat))。
- 右側が結合キー列によって関数的に決定される場合（すべての行が一意の結合キー値を持つ場合）、すべての `LEFT/INNER` JOIN は自動的に `RightAny` に変換されます。[#84010](https://github.com/ClickHouse/ClickHouse/pull/84010) ([Nikita Taranov](https://github.com/nickitat))。
- `Join` モードでのパッチパーツ適用のパフォーマンスを改善しました。[#85040](https://github.com/ClickHouse/ClickHouse/pull/85040) ([Anton Popov](https://github.com/CurtizJ))。

### 分散クエリの改善 {#distributed-query-improvements}


- ネットワーク接続に関連付けられた単一スレッドではなく、パイプラインスレッドへブロックの圧縮・展開およびシリアライズ・デシリアライズをオフロードするオプションを導入しました。`enable_parallel_blocks_marshalling`設定で制御されます。イニシエーターとリモートノード間で大量のデータを転送する分散クエリの高速化が期待できます。[#78694](https://github.com/ClickHouse/ClickHouse/pull/78694) ([Nikita Taranov](https://github.com/nickitat))。
- 並列分散`INSERT SELECT`がデフォルトで有効になり、各シャードで`INSERT SELECT`が独立して実行されるモードになりました。`parallel_distributed_insert_select`設定を参照してください。[#80425](https://github.com/ClickHouse/ClickHouse/pull/80425) ([Igor Nikonov](https://github.com/devcrafter))。
- ネイティブプロトコルでログとプロファイルイベントを圧縮します。100以上のレプリカを持つクラスターでは、非圧縮のプロファイルイベントは1〜10 MB/秒を消費し、低速なインターネット接続ではプログレスバーの動作が遅くなります。[#82533](https://github.com/ClickHouse/ClickHouse/issues/82533)をクローズします。[#82535](https://github.com/ClickHouse/ClickHouse/pull/82535) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 並列分散`INSERT SELECT`がデフォルトで有効になり、各シャードでINSERT SELECTが独立して実行されるモードになりました。`parallel_distributed_insert_select`設定を参照してください。[#83040](https://github.com/ClickHouse/ClickHouse/pull/83040) ([Igor Nikonov](https://github.com/devcrafter))。
- 並列レプリカの最小タスクサイズの計算を修正しました。[#84752](https://github.com/ClickHouse/ClickHouse/pull/84752) ([Nikita Taranov](https://github.com/nickitat))。

### インデックスの改善 {#index-improvements}

- ベクトル類似性インデックスを使用したベクトル検索クエリは、ストレージ読み取りの削減とCPU使用率の低下により、より低いレイテンシで完了します。[#79103](https://github.com/ClickHouse/ClickHouse/pull/79103) ([Shankar Iyer](https://github.com/shankar-iyer))。
- `filterPartsByQueryConditionCache`で`merge_tree_min_{rows,bytes}_for_seek`を尊重し、インデックスによるフィルタリングを行う他のメソッドと整合させました。[#80312](https://github.com/ClickHouse/ClickHouse/pull/80312) ([李扬](https://github.com/taiyang-li))。
- より高い粒度のmin-maxインデックスを最初に処理します。[#75381](https://github.com/ClickHouse/ClickHouse/issues/75381)をクローズします。[#83798](https://github.com/ClickHouse/ClickHouse/pull/83798) ([Maruth Goyal](https://github.com/maruthgoyal))。
- ブルームフィルターインデックスが、`column`が`Array`型でない場合の`has([c1, c2, ...], column)`のような条件で使用されるようになりました。これにより、このようなクエリのパフォーマンスが向上し、`IN`演算子と同等の効率が得られます。[#83945](https://github.com/ClickHouse/ClickHouse/pull/83945) ([Doron David](https://github.com/dorki))。
- ファイルサイズの昇順でインデックスを処理します。最終的なインデックスの順序付けでは、minmaxインデックスとベクトルインデックス(それぞれ単純性と選択性による)が優先され、その後に小さなインデックスが続きます。minmax/ベクトルインデックス内でも、より小さなインデックスが優先されます。[#84094](https://github.com/ClickHouse/ClickHouse/pull/84094) ([Maruth Goyal](https://github.com/maruthgoyal))。
- 以前は、テキストインデックスデータが複数のセグメントに分割されていました(各セグメントのサイズはデフォルトで256 MiB)。これによりテキストインデックス構築時のメモリ消費量は削減される可能性がありますが、ディスク上の必要容量が増加し、クエリ応答時間が長くなります。[#84590](https://github.com/ClickHouse/ClickHouse/pull/84590) ([Elmi Ahmadov](https://github.com/ahmadov))。

### サブクエリの最適化 {#subquery-optimizations}


- 等価クラスを使用して冗長な`JOIN`操作を削除することで、相関サブクエリの生成プランを最適化します。すべての相関列に対して等価な式が存在する場合、`query_plan_correlated_subqueries_use_substitution`設定が有効であれば`CROSS JOIN`は生成されません。[#82435](https://github.com/ClickHouse/ClickHouse/pull/82435) ([Dmitry Novik](https://github.com/novikd))。
- 相関サブクエリが関数`EXISTS`の引数として使用される場合、必要な列のみを読み取ります。[#82443](https://github.com/ClickHouse/ClickHouse/pull/82443) ([Dmitry Novik](https://github.com/novikd))。

### Azure Blob Storageの改善 {#azure-blob-storage-improvements}

- [`azureBlobStorage`](/engines/table-engines/integrations/azureBlobStorage)テーブルエンジンは、スロットリングを回避するために、可能な場合にマネージドID認証トークンをキャッシュして再利用するようになりました。[#79860](https://github.com/ClickHouse/ClickHouse/pull/79860) ([Nick Blakely](https://github.com/niblak))。
- Azure Blob Storage用のcurl HTTPクライアントをpoco HTTPクライアントに置き換えました。S3の設定を反映した複数の設定をこれらのクライアントに導入しました。AzureとS3の両方に積極的な接続タイムアウトを導入しました。Azureプロファイルイベントとメトリクスへのイントロスペクションを改善しました。新しいクライアントはデフォルトで有効になっており、Azure Blob Storage上のコールドクエリに対して大幅に優れたレイテンシを提供します。古い`Curl`クライアントは`azure_sdk_use_native_client=false`を設定することで元に戻すことができます。[#83294](https://github.com/ClickHouse/ClickHouse/pull/83294) ([alesapin](https://github.com/alesapin))。

### ストレージエンジンの改善 {#storage-engine-improvements}

- RedisおよびKeeperMapストレージのキーによるフィルタを修正しました。[#81833](https://github.com/ClickHouse/ClickHouse/pull/81833) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。
- `ATTACH PARTITION`がすべてのキャッシュの削除を引き起こさなくなりました。[#82377](https://github.com/ClickHouse/ClickHouse/pull/82377) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 高い同時負荷でのロック競合を減らすために、ストレージスナップショットデータの作成中にロックを保持しないようにしました。[#83510](https://github.com/ClickHouse/ClickHouse/pull/83510) ([Duc Canh Le](https://github.com/canhld94))。
- 一時パーツの削除には時間がかかる場合があり(特にS3の場合)、現在は`MergeTreeBackgroundExecutor`でグローバルロックを保持しながら実行しています。接続の喪失によりすべてのテーブルを再起動する必要があり、バックグラウンドタスクの完了を待つ場合、テーブルが1時間も読み取り専用モードで停止する可能性があります。しかし、`cancel`を呼び出すためにこのロックは必要ないようです。[#84311](https://github.com/ClickHouse/ClickHouse/pull/84311) ([Alexander Tokmakov](https://github.com/tavplubix))。

### フォーマットの改善 {#format-improvements}

- 新しいparquetリーダーの実装。一般的に高速で、ページレベルのフィルタプッシュダウンと`PREWHERE`をサポートします。現在は実験的機能です。有効にするには`input_format_parquet_use_native_reader_v3`設定を使用してください。[#82789](https://github.com/ClickHouse/ClickHouse/pull/82789) ([Michael Kolupaev](https://github.com/al13n321))。
- 解析エラーが発生しない場合にシリアライザを再利用することで、ProtobufSingle入力フォーマットのパフォーマンスを改善しました。[#83613](https://github.com/ClickHouse/ClickHouse/pull/83613) ([Eduard Karacharov](https://github.com/korowa))。

### データ型とシリアライゼーションの最適化 {#data-type-and-serialization-optimizations}

- MergeTreeの共有データに対する新しいシリアライゼーションを実装することで、MergeTreeの共有データからの`JSON`サブカラムの読み取りパフォーマンスを大幅に改善しました。[#83777](https://github.com/ClickHouse/ClickHouse/pull/83777) ([Pavel Kruglov](https://github.com/Avogar))。
- コードを簡素化することで文字列のデシリアライゼーションを最適化しました。[#38564](https://github.com/ClickHouse/ClickHouse/issues/38564)をクローズします。[#84561](https://github.com/ClickHouse/ClickHouse/pull/84561) ([Alexey Milovidov](https://github.com/alexey-milovidov))。

### パイプラインと実行の改善 {#pipeline-and-execution-improvements}


- パイプライン構築時のポートヘッダーにおけるメモリコピーを最小化しました。元の[PR](https://github.com/ClickHouse/ClickHouse/pull/70105)は[heymind](https://github.com/heymind)によるものです。[#83381](https://github.com/ClickHouse/ClickHouse/pull/83381) ([Raúl Marín](https://github.com/Algunenano))。
- パイプライン構築のパフォーマンスを向上させました。[#83631](https://github.com/ClickHouse/ClickHouse/pull/83631) ([Raúl Marín](https://github.com/Algunenano))。
- MergeTreeReadersChain::getSampleBlockを最適化しました。[#83875](https://github.com/ClickHouse/ClickHouse/pull/83875) ([Raúl Marín](https://github.com/Algunenano))。
- 単一行を返すためだけにマテリアライゼーションを行う場合における定数のマテリアライゼーションを最適化しました。[#85071](https://github.com/ClickHouse/ClickHouse/pull/85071) ([Alexey Milovidov](https://github.com/alexey-milovidov))。

### メモリとリソースの最適化 {#memory-and-resource-optimizations}

- パフォーマンスを向上させるためにjemallocの設定を調整しました。[#81807](https://github.com/ClickHouse/ClickHouse/pull/81807) ([Antonio Andelic](https://github.com/antonio2368))。
- フォルスシェアリングを削減するためにProfileEventsのCounterにアライメントを追加しました。[#82697](https://github.com/ClickHouse/ClickHouse/pull/82697) ([Jiebin Sun](https://github.com/jiebinn))。
- CompressedReadBufferBase::readCompressedDataにおける不要なmemcpy呼び出しを削減しました。[#83986](https://github.com/ClickHouse/ClickHouse/pull/83986) ([Raúl Marín](https://github.com/Algunenano))。

### クエリ計画と解析 {#query-planning-and-analysis}

- QueryTreeHashを高速化しました。[#82617](https://github.com/ClickHouse/ClickHouse/pull/82617) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。

### ログ記録の改善 {#logging-improvements}

- 非同期ログ記録を導入しました。[#82516](https://github.com/ClickHouse/ClickHouse/pull/82516) ([Raúl Marín](https://github.com/Algunenano))。

### 関数の最適化 {#function-optimizations}

- 一時データを削除することで`largestTriangleThreeBuckets`を最適化しました。[#84479](https://github.com/ClickHouse/ClickHouse/pull/84479) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 多数の文字列処理関数の実装を最適化し、簡素化しました。いくつかの関数の誤ったドキュメントを修正しました。注意: String列およびString列を含む複合型に対する`byteSize`の出力が、空文字列あたり9バイトから8バイトに変更されました。これは期待される動作です。[#85063](https://github.com/ClickHouse/ClickHouse/pull/85063) ([Alexey Milovidov](https://github.com/alexey-milovidov))。

### Keeperの改善 {#keeper-improvements}

- rocksdbの初期ロードによりKeeperを改善しました。[#83390](https://github.com/ClickHouse/ClickHouse/pull/83390) ([Antonio Andelic](https://github.com/antonio2368))。

### データレイクの改善 {#data-lake-improvements}

- delta-kernel-rsバックエンドによる並列ファイル処理を改善しました。[#85642](https://github.com/ClickHouse/ClickHouse/pull/85642) ([Azat Khuzhin](https://github.com/azat))。


## 改善 {#improvements}

### アクセス制御とセキュリティ {#access-control-and-security}

- ソース用に2つの新しいアクセスタイプ `READ` と `WRITE` を導入し、ソースに関連する以前のすべてのアクセスタイプを非推奨としました。以前は `GRANT S3 ON *.* TO user` でしたが、現在は `GRANT READ, WRITE ON S3 TO user` となります。これにより、ソースの `READ` と `WRITE` の権限を分離することも可能になります。例: `GRANT READ ON * TO user`、`GRANT WRITE ON S3 TO user`。この機能は `access_control_improvements.enable_read_write_grants` 設定で制御され、デフォルトでは無効になっています。[#73659](https://github.com/ClickHouse/ClickHouse/pull/73659) ([pufit](https://github.com/pufit))。
- `CREATE USER` クエリでユーザー名にパラメータを使用できるようになりました。[#81387](https://github.com/ClickHouse/ClickHouse/pull/81387) ([Diskein](https://github.com/Diskein))。
- コアダンプから機密データを除外します。2つのアロケータを追加しました: AWSライブラリ互換の `AwsNodumpMemoryManager` とSTL互換の `JemallocNodumpSTLAllocator`。両方ともJemallocアロケータのラッパーです。Jemallocのエクステントフックとmadviseを使用して、メモリページを「ダンプしない」としてマークします。S3認証情報、ユーザー認証情報、および一部のクエリデータに使用されます。[#82441](https://github.com/ClickHouse/ClickHouse/pull/82441) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
- 一時ユーザーによって作成されたビューは、実際のユーザーのコピーを保存するようになり、一時ユーザーが削除された後も無効化されなくなりました。[#84763](https://github.com/ClickHouse/ClickHouse/pull/84763) ([pufit](https://github.com/pufit))。
- 外部認証のforward_headersを大文字小文字を区別せずにマッチングします。[#84737](https://github.com/ClickHouse/ClickHouse/pull/84737) ([ingodwerust](https://github.com/ingodwerust))。
- `system.grants` に `parameter` カラムを追加し、`GRANT READ/WRITE` のソースタイプと `GRANT TABLE ENGINE` のテーブルエンジンを判別できるようにしました。[#85643](https://github.com/ClickHouse/ClickHouse/pull/85643) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。

### バックアップとリストア {#backup-and-restore}

- PostgreSQL、MySQL、DataLakeデータベースのバックアップを許可します。このようなデータベースのバックアップは、定義のみを保存し、内部のデータは保存しません。[#79982](https://github.com/ClickHouse/ClickHouse/pull/79982) ([Nikolay Degterinsky](https://github.com/evillique))。
- バックアップファイルの書き込みに関するすべてのログメッセージをTRACEに設定します。[#82907](https://github.com/ClickHouse/ClickHouse/pull/82907) ([Hans Krutzer](https://github.com/hkrutzer))。
- バックアップおよびリストア操作中に使用されるS3リトライバックオフ戦略を設定するために、[`backup_restore_s3_retry_initial_backoff_ms`](/operations/settings/settings#backup_restore_s3_retry_initial_backoff_ms)、[`backup_restore_s3_retry_max_backoff_ms`](/operations/settings/settings#backup_restore_s3_retry_max_backoff_ms)、[`backup_restore_s3_retry_jitter_factor`](/operations/settings/settings#backup_restore_s3_retry_jitter_factor) を導入しました。[#84421](https://github.com/ClickHouse/ClickHouse/pull/84421) ([Julia Kartseva](https://github.com/jkartseva))。
- 新しい [`backup_slow_all_threads_after_retryable_s3_error`](/operations/settings/settings#backup_slow_all_threads_after_retryable_s3_error) 設定を導入し、`SlowDown` などのエラーによって引き起こされるリトライストーム中にS3への負荷を軽減します。単一のリトライ可能なエラーが観測されると、すべてのスレッドを減速させます。[#84854](https://github.com/ClickHouse/ClickHouse/pull/84854) ([Julia Kartseva](https://github.com/jkartseva))。

### データ整合性と検証 {#data-integrity-and-validation}


- パートをコミットする直前に、一貫性のあるchecksum.txtファイルを検証します。[#76625](https://github.com/ClickHouse/ClickHouse/pull/76625) ([Sema Checherinda](https://github.com/CheSema))。
- 現在不完全なデータミューテーションの影響を受けているカラムの名前を変更する場合、`RENAME COLUMN` alterミューテーションの開始を禁止します。[#81823](https://github.com/ClickHouse/ClickHouse/pull/81823) ([Mikhail Artemenko](https://github.com/Michicosun))。
- ミューテーションスナップショットは、可視パートのスナップショットから構築されるようになりました。スナップショットで使用されるミューテーションカウンターも、含まれるミューテーションから再計算されます。[#82945](https://github.com/ClickHouse/ClickHouse/pull/82945) ([Mikhail Artemenko](https://github.com/Michicosun))。
- パートのプレフィックスとサフィックスを解析し、非定数カラムのカバレッジをチェックする機能を追加しました。[#83377](https://github.com/ClickHouse/ClickHouse/pull/83377) ([Mikhail Artemenko](https://github.com/Michicosun))。

### Icebergテーブルエンジン {#iceberg-table-engine}

- Icebergテーブルエンジンの位置削除をサポートしました。[#80237](https://github.com/ClickHouse/ClickHouse/pull/80237) ([YanghongZhong](https://github.com/yahoNanJing))。
- ClickHouseはIceberg用の圧縮された`metadata.json`ファイルをサポートするようになりました。修正: [#70874](https://github.com/ClickHouse/ClickHouse/issues/70874)。[#81451](https://github.com/ClickHouse/ClickHouse/pull/81451) ([alesapin](https://github.com/alesapin))。
- 複合型のフィールドIDによるIceberg読み取りを修正しました。[#84821](https://github.com/ClickHouse/ClickHouse/pull/84821) ([scanhex12](https://github.com/scanhex12))。
- pyicebergから読み取るためのIceberg書き込みをサポートしました。[#84466](https://github.com/ClickHouse/ClickHouse/pull/84466) ([scanhex12](https://github.com/scanhex12))。
- データレイクテーブルエンジンにスナップショットバージョンを追加しました。[#84659](https://github.com/ClickHouse/ClickHouse/pull/84659) ([Pete Hampton](https://github.com/pjhampton))。
- Icebergでのversion-hintファイルの書き込みをサポートしました。これにより解決: [#85097](https://github.com/ClickHouse/ClickHouse/issues/85097)。[#85130](https://github.com/ClickHouse/ClickHouse/pull/85130) ([scanhex12](https://github.com/scanhex12))。
- [`iceberg_metadata_compression_method`](/operations/settings/settings#iceberg_metadata_compression_method)設定を介して圧縮された`.metadata.json`ファイルをサポートしました。すべてのClickHouse圧縮方式をサポートします。これにより解決: [#84895](https://github.com/ClickHouse/ClickHouse/issues/84895)。[#85196](https://github.com/ClickHouse/ClickHouse/pull/85196) ([scanhex12](https://github.com/scanhex12))。
- Iceberg位置削除ファイルのメモリ使用量を最適化しました。すべての削除ファイルデータをメモリにロードする代わりに、Parquet削除ファイルから現在の行グループのみをRAMに保持します。これにより、大規模な位置削除ファイルを扱う際のメモリ消費量が大幅に削減されます。[#85329](https://github.com/ClickHouse/ClickHouse/pull/85329) ([scanhex12](https://github.com/scanhex12))。
- 各データファイルのオブジェクトを明示的に保存せずに、Icebergテーブルからオブジェクトを非同期で反復処理できるようにしました。[#85369](https://github.com/ClickHouse/ClickHouse/pull/85369) ([Daniil Ivanik](https://github.com/divanik))。
- Iceberg等価削除をサポートしました。[#85843](https://github.com/ClickHouse/ClickHouse/pull/85843) ([Han Fei](https://github.com/hanfei1991))。

### DeltaLakeテーブルエンジン {#deltalake-table-engine}


- `DeltaLake`テーブルエンジンの改善: delta-kernel-rsに`ExpressionVisitor` APIが実装され、このPRでパーティションカラム式の変換に適用されます(これにより、以前のコードで使用されていたdelta-kernel-rs内の古い非推奨の方法が置き換えられます)。将来的には、この`ExpressionVisitor`により統計ベースのプルーニングやdelta-lake固有の機能の実装も可能になります。さらに、この変更の目的は`DeltaLakeCluster`テーブルエンジンでのパーティションプルーニングをサポートすることです(解析された式の結果であるActionsDAGは、データパスと共にイニシエーターからシリアライズされて送信されます。これは、プルーニングに必要なこの種の情報が、イニシエーターのみが実行するデータファイルリスティングのメタ情報としてのみ利用可能であり、各読み取りサーバー上のデータに適用される必要があるためです)。[#81136](https://github.com/ClickHouse/ClickHouse/pull/81136) ([Kseniia Sumarokova](https://github.com/kssenii))。
- データレイククラスター関数でのパーティションプルーニングを修正。[#82131](https://github.com/ClickHouse/ClickHouse/pull/82131) ([Kseniia Sumarokova](https://github.com/kssenii))。
- DeltaLakeClusterテーブル関数でのパーティション化されたデータの読み取りを修正。このPRでは、クラスター関数のプロトコルバージョンが増加し、イニシエーターからレプリカへ追加情報を送信できるようになります。この追加情報には、パーティションカラムの解析に必要なdelta-kernel変換式が含まれます(将来的には生成カラムなどの他の情報も含まれます)。[#82132](https://github.com/ClickHouse/ClickHouse/pull/82132) ([Kseniia Sumarokova](https://github.com/kssenii))。
- データベースDatalakeがより分かりやすい例外をスローするようになりました。修正: [#81211](https://github.com/ClickHouse/ClickHouse/issues/81211)。[#82304](https://github.com/ClickHouse/ClickHouse/pull/82304) ([alesapin](https://github.com/alesapin))。
- ストレージ`DeltaLake`に内部`delta-kernel-rs`フィルタリング(統計とパーティションプルーニング)を実装。[#84006](https://github.com/ClickHouse/ClickHouse/pull/84006) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 設定[`delta_lake_enable_expression_visitor_logging`](/operations/settings/settings#delta_lake_enable_expression_visitor_logging)を追加し、デバッグ時にテストログレベルでも冗長になる可能性があるexpression visitorログを無効化できるようにしました。[#84315](https://github.com/ClickHouse/ClickHouse/pull/84315) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 設定[`delta_lake_snapshot_version`](/operations/settings/settings#delta_lake_snapshot_version)を追加し、テーブルエンジン`DeltaLake`で特定のスナップショットバージョンを読み取れるようにしました。[#85295](https://github.com/ClickHouse/ClickHouse/pull/85295) ([Kseniia Sumarokova](https://github.com/kssenii))。

### データレイク統合 {#data-lake-integration}

- 非同期リクエストによりデータカタログ内のテーブルリスティングを高速化。[#81084](https://github.com/ClickHouse/ClickHouse/pull/81084) ([alesapin](https://github.com/alesapin))。
- Glueカタログで`TimestampTZ`をサポート。これにより以下が解決されます: [#81654](https://github.com/ClickHouse/ClickHouse/issues/81654)。[#83132](https://github.com/ClickHouse/ClickHouse/pull/83132) ([scanhex12](https://github.com/scanhex12))。
- FormatParserGroupを2つの独立した構造体に分割しました。1つ目は共有計算とIOリソースを担当し、2つ目は共有フィルターリソース(フィルターActionDag、KeyCondition)を担当します。これは、異なるスレッドによるこれらの構造体のより柔軟な共有使用を実現するために行われました。[#83997](https://github.com/ClickHouse/ClickHouse/pull/83997) ([Daniil Ivanik](https://github.com/divanik))。
- azure設定に不足していた`partition_columns_in_data_file`を追加。[#85373](https://github.com/ClickHouse/ClickHouse/pull/85373) ([Arthur Passos](https://github.com/arthurpassos))。
- system.tablesへのデータレイクテーブルの追加を管理するshow_data_lake_catalogs_in_system_tablesフラグを追加。これにより以下が解決されます: [#85384](https://github.com/ClickHouse/ClickHouse/issues/85384)。[#85411](https://github.com/ClickHouse/ClickHouse/pull/85411) ([Smita Kulkarni](https://github.com/SmitaRKulkarni))。

### S3とオブジェクトストレージ {#s3-and-object-storage}


- データベースディスクとしてサポートするため、`s3_plain_rewritable`に`moveFile`および`replaceFile`メソッドを実装しました。[#79424](https://github.com/ClickHouse/ClickHouse/pull/79424) ([Tuan Pham Anh](https://github.com/tuanpach))。
- `max_remote_read_network_bandwidth_for_server`および`max_remote_write_network_bandwidth_for_server`のスロットリングに関する問題を回避するため、S3の読み取りおよび書き込みリクエストは(S3リクエスト全体ではなく)HTTPソケットレベルでスロットリングされるようになりました。[#81837](https://github.com/ClickHouse/ClickHouse/pull/81837) ([Sergei Trifonov](https://github.com/serxa))。
- `s3_slow_all_threads_after_network_error`設定が有効な場合、S3リトライメカニズムにジッターを導入しました。[#81849](https://github.com/ClickHouse/ClickHouse/pull/81849) ([zoomxi](https://github.com/zoomxi))。
- 明示的に指定されたIAMロールを使用したAWS S3認証を実装しました。GCS向けのOAuthを実装しました。これらの機能は最近までClickHouse Cloudでのみ利用可能でしたが、現在はオープンソース化されています。オブジェクトストレージの接続パラメータのシリアライゼーションなど、一部のインターフェースを同期しました。[#84011](https://github.com/ClickHouse/ClickHouse/pull/84011) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 外部集約/ソートに任意のストレージポリシー(S3などのオブジェクトストレージ)を使用できるようになりました。[#84734](https://github.com/ClickHouse/ClickHouse/pull/84734) ([Azat Khuzhin](https://github.com/azat))。
- 削除されたすべてのオブジェクトを収集し、単一のオブジェクトストレージ削除操作を実行するようにしました。[#85316](https://github.com/ClickHouse/ClickHouse/pull/85316) ([Mikhail Artemenko](https://github.com/Michicosun))。

### S3Queueテーブルエンジン {#s3queue-table-engine}

- S3Queueテーブルエンジンの`keeper_path`設定で`{uuid}`などのマクロが使用できるようになりました。[#82463](https://github.com/ClickHouse/ClickHouse/pull/82463) ([Nikolay Degterinsky](https://github.com/evillique))。
- S3Queueテーブルエンジンを使用するテーブルでストリーミングを無効にする新しいサーバー設定`s3queue_disable_streaming`を追加しました。この設定はサーバーを再起動せずに変更可能です。[#82515](https://github.com/ClickHouse/ClickHouse/pull/82515) ([Kseniia Sumarokova](https://github.com/kssenii))。
- `system.s3queue_log`に`commit_time`、`commit_id`カラムを追加しました。[#83016](https://github.com/ClickHouse/ClickHouse/pull/83016) ([Kseniia Sumarokova](https://github.com/kssenii))。
- s3queueシャットダウンプロセスのログを追加しました。[#83163](https://github.com/ClickHouse/ClickHouse/pull/83163) ([Kseniia Sumarokova](https://github.com/kssenii))。
- サーバーシャットダウン時に、テーブルをシャットダウンする前にS3(Azure等)Queueストリーミングをシャットダウンするようにしました。[#83530](https://github.com/ClickHouse/ClickHouse/pull/83530) ([Kseniia Sumarokova](https://github.com/kssenii))。
- `S3Queue`テーブルレベルでマテリアライズドビュー挿入設定の変更をサポートしました。新しい`S3Queue`レベル設定として`min_insert_block_size_rows_for_materialized_views`および`min_insert_block_size_bytes_for_materialized_views`を追加しました。デフォルトではプロファイルレベルの設定が使用され、`S3Queue`レベルの設定がそれらを上書きします。[#83971](https://github.com/ClickHouse/ClickHouse/pull/83971) ([Kseniia Sumarokova](https://github.com/kssenii))。
- S3Queue順序付きモードの修正:シャットダウンが呼び出された場合、より早く終了するようにしました。[#84463](https://github.com/ClickHouse/ClickHouse/pull/84463) ([Kseniia Sumarokova](https://github.com/kssenii))。

### Kafka統合 {#kafka-integration}


- StorageKafka2において、以前にコミットされたオフセットに依存することを避けるため、消費されたメッセージを手動でカウントします。[#81662](https://github.com/ClickHouse/ClickHouse/pull/81662) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
- `StorageKafka2`を[`system.kafka_consumers`](/operations/system-tables/kafka_consumers)に統合します。[#82652](https://github.com/ClickHouse/ClickHouse/pull/82652) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。

### ClickHouse Keeperの改善 {#clickhouse-keeper-improvements}

- Keeperの改善: changelogファイルをバックグラウンドスレッドでディスク間で移動します。以前は、changelogを別のディスクに移動すると、移動が完了するまでKeeperがグローバルにブロックされていました。これにより、移動が長時間の操作である場合(例: S3ディスクへの移動)、パフォーマンスが低下していました。[#82485](https://github.com/ClickHouse/ClickHouse/pull/82485) ([Antonio Andelic](https://github.com/antonio2368))。
- Keeperの改善: 新しい設定`keeper_server.cleanup_old_and_ignore_new_acl`を追加します。有効にすると、すべてのノードのACLがクリアされ、新しいリクエストのACLは無視されます。ノードからACLを完全に削除することが目的の場合、新しいスナップショットが作成されるまで設定を有効にしておくことが重要です。[#82496](https://github.com/ClickHouse/ClickHouse/pull/82496) ([Antonio Andelic](https://github.com/antonio2368))。
- Keeperの改善: world:anyone ACLの特定の権限をサポートします。[#82755](https://github.com/ClickHouse/ClickHouse/pull/82755) ([Antonio Andelic](https://github.com/antonio2368))。
- 設定でパスに対する追加のKeeper ACLを指定するサポートを追加します。特定のパスに追加のACLを追加する場合は、`zookeeper.path_acls`の下の設定で定義します。[#82898](https://github.com/ClickHouse/ClickHouse/pull/82898) ([Antonio Andelic](https://github.com/antonio2368))。
- Keeperがソフトメモリ制限により書き込みを拒否した際のProfileEventを追加します。[#82963](https://github.com/ClickHouse/ClickHouse/pull/82963) ([Xander Garbett](https://github.com/Garbett1))。
- Keeperで`create_if_not_exists`、`check_not_exists`、`remove_recursive`の機能フラグをデフォルトで有効にし、新しいタイプのリクエストを可能にします。[#83488](https://github.com/ClickHouse/ClickHouse/pull/83488) ([Antonio Andelic](https://github.com/antonio2368))。
- `apply_to_children`設定を使用して、特定のKeeperノードに追加のACLを適用するサポートを追加します。[#84137](https://github.com/ClickHouse/ClickHouse/pull/84137) ([Antonio Andelic](https://github.com/antonio2368))。
- KeeperClientに`get_acl`コマンドを追加します。[#84641](https://github.com/ClickHouse/ClickHouse/pull/84641) ([Antonio Andelic](https://github.com/antonio2368))。
- Keeperに4LW `lgrq`を追加し、受信したリクエストのリクエストログ記録を切り替えます。[#84719](https://github.com/ClickHouse/ClickHouse/pull/84719) ([Antonio Andelic](https://github.com/antonio2368))。
- Keeperのストレージロックの競合を削減します。[#84732](https://github.com/ClickHouse/ClickHouse/pull/84732) ([Antonio Andelic](https://github.com/antonio2368))。
- `encrypt_decrypt`ツールが暗号化されたZooKeeper接続をサポートするようになりました。[#84764](https://github.com/ClickHouse/ClickHouse/pull/84764) ([Roman Vasin](https://github.com/rvasin))。
- `keeper_server.coordination_settings.latest_logs_cache_entry_count_threshold`と`keeper_server.coordination_settings.commit_logs_cache_entry_count_threshold`を使用して、エントリ数によってKeeperログエントリキャッシュサイズを制限します。[#84877](https://github.com/ClickHouse/ClickHouse/pull/84877) ([Antonio Andelic](https://github.com/antonio2368))。

### JSONおよびDynamic型 {#json-and-dynamic-types}


- Wide パートに `columns_substreams.txt` ファイルを追加し、パートに格納されているすべてのサブストリームを追跡します。これにより、JSON および Dynamic 型の動的ストリームを追跡でき、動的ストリームのリストを取得するためにこれらのカラムのサンプルを読み取る必要がなくなります(例: カラムサイズの計算)。また、すべての動的ストリームが `system.parts_columns` に反映されるようになりました。[#81091](https://github.com/ClickHouse/ClickHouse/pull/81091) ([Pavel Kruglov](https://github.com/Avogar))。
- JSON および Dynamic カラムでの `ALTER UPDATE` を許可します。[#82419](https://github.com/ClickHouse/ClickHouse/pull/82419) ([Pavel Kruglov](https://github.com/Avogar))。
- ユーザーは JSON 型内で `Time` および `Time64` 型を使用できるようになりました。[#83784](https://github.com/ClickHouse/ClickHouse/pull/83784) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- JSON 型の解析中に JSON キー内のドットをエスケープするための設定 `json_type_escape_dots_in_keys` を追加しました。この設定はデフォルトで無効になっています。[#84207](https://github.com/ClickHouse/ClickHouse/pull/84207) ([Pavel Kruglov](https://github.com/Avogar))。

### Parquet および ORC フォーマット {#parquet-and-orc-formats}

- ORC 圧縮ブロックサイズを設定する設定を導入し、デフォルト値を 64KB から 256KB に更新して、Spark または Hive との一貫性を保ちます。[#80602](https://github.com/ClickHouse/ClickHouse/pull/80602) ([李扬](https://github.com/taiyang-li))。
- [仕様](https://github.com/apache/parquet-format/blob/master/LogicalTypes.md#enum)に従って、Parquet の enum をバイト配列として書き込むことをサポートします。詳細は後ほど記載します。[#81090](https://github.com/ClickHouse/ClickHouse/pull/81090) ([Arthur Passos](https://github.com/arthurpassos))。
- 出力フォーマットとして geoparquet の書き込みをサポートします。[#81784](https://github.com/ClickHouse/ClickHouse/pull/81784) ([scanhex12](https://github.com/scanhex12))。

### 分散クエリと並列レプリカ {#distributed-queries-and-parallel-replicas}

- 新しい設定 enable_add_distinct_to_in_subqueries が導入されました。有効にすると、ClickHouse は分散クエリの IN 句内のサブクエリに自動的に DISTINCT を追加します。これにより、シャード間で転送される一時テーブルのサイズを大幅に削減し、ネットワーク効率を向上させることができます。注意: これはトレードオフです。ネットワーク転送は削減されますが、各ノードで追加のマージ(重複排除)作業が必要になります。ネットワーク転送がボトルネックであり、マージコストが許容できる場合にこの設定を有効にしてください。[#81908](https://github.com/ClickHouse/ClickHouse/pull/81908) ([fhw12345](https://github.com/fhw12345))。
- `address_expression` 引数でクラスタが提供されている場合、並列レプリカを使用した `remote-()` テーブル関数のサポートを追加しました。また、[#73295](https://github.com/ClickHouse/ClickHouse/issues/73295) を修正しました。[#82904](https://github.com/ClickHouse/ClickHouse/pull/82904) ([Igor Nikonov](https://github.com/devcrafter))。
- 並列レプリカを使用した結合は、結合論理ステップを使用するようになりました。並列レプリカを使用した結合クエリで問題が発生した場合は、`SET query_plan_use_new_logical_join_step=0` を試して、問題を報告してください。[#83801](https://github.com/ClickHouse/ClickHouse/pull/83801) ([Vladimir Cherkasov](https://github.com/vdimir))。

### 設定と構成 {#settings-and-configuration}


- 設定 `allow_experimental_join_condition` を廃止としてマークしました。[#80566](https://github.com/ClickHouse/ClickHouse/pull/80566) ([Vladimir Cherkasov](https://github.com/vdimir))。
- 全体およびユーザーごとのネットワークスロットラーがリセットされないようになり、`max_network_bandwidth_for_all_users` および `max_network_bandwidth_for_all_users` の制限が超過されないことを保証します。[#81729](https://github.com/ClickHouse/ClickHouse/pull/81729) ([Sergei Trifonov](https://github.com/serxa))。
- `optimize_rewrite_regexp_functions` 設定(デフォルトで有効)を導入しました。これにより、特定の正規表現パターンが検出された場合に、オプティマイザが特定の `replaceRegexpAll`、`replaceRegexpOne`、および `extract` 呼び出しをより単純で効率的な形式に書き換えることができます。(issue [#81981](https://github.com/ClickHouse/ClickHouse/issues/81981))。[#81992](https://github.com/ClickHouse/ClickHouse/pull/81992) ([Amos Bird](https://github.com/amosbird))。
- listen_backlog(デフォルトで4096)に基づいて、TCPサーバーキュー(デフォルトで64)を調整しました。[#82045](https://github.com/ClickHouse/ClickHouse/pull/82045) ([Azat Khuzhin](https://github.com/azat))。
- サーバーを再起動せずに `max_local_read_bandwidth_for_server` および `max_local_write_bandwidth_for_server` を動的に再読み込みする機能を追加しました。[#82083](https://github.com/ClickHouse/ClickHouse/pull/82083) ([Kai Zhu](https://github.com/nauu))。
- ベクトル類似性インデックスを使用するために有効にする必要がある設定 `enable_vector_similarity_index` を導入しました。既存の設定 `allow_experimental_vector_similarity_index` は現在廃止されています。必要な場合は引き続き機能します。[#83459](https://github.com/ClickHouse/ClickHouse/pull/83459) ([Robert Schulze](https://github.com/rschu1ze))。
- 重いカラムを持つJOINのメモリ使用量を制限するために、`max_joined_block_size_rows` に加えて [`max_joined_block_size_bytes`](/operations/settings/settings#max_joined_block_size_bytes) を追加しました。[#83869](https://github.com/ClickHouse/ClickHouse/pull/83869) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- cluster_function_process_archive_on_multiple_nodes の互換性を修正しました。[#83968](https://github.com/ClickHouse/ClickHouse/pull/83968) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 相関サブクエリのサポートをデフォルトで有効にしました。[#85107](https://github.com/ClickHouse/ClickHouse/pull/85107) ([Dmitry Novik](https://github.com/novikd))。
- DatabaseReplicatedSettings のデフォルト値を定義する `database_replicated` 設定を追加しました。Replicated DB の作成クエリに設定が存在しない場合、この設定の値が使用されます。[#85127](https://github.com/ClickHouse/ClickHouse/pull/85127) ([Tuan Pham Anh](https://github.com/tuanpach))。
- `s3` または `s3Cluster` テーブルエンジン/関数でキー値引数を許可しました。例えば `s3('url', CSV, structure = 'a Int32', compression_method = 'gzip')` のように使用できます。[#85134](https://github.com/ClickHouse/ClickHouse/pull/85134) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 非相関の `EXISTS` をスカラーサブクエリとして実行します。これにより、スカラーサブクエリキャッシュの使用と結果の定数畳み込みが可能になり、インデックスに有用です。互換性のために、新しい設定 `execute_exists_as_scalar_subquery=1` が追加されました。[#85481](https://github.com/ClickHouse/ClickHouse/pull/85481) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- 複合識別子のより多くのケースの解決をサポートしました。特に、旧アナライザとの `ARRAY JOIN` の互換性が向上します。古い動作を維持するために、新しい設定 `analyzer_compatibility_allow_compound_identifiers_in_unflatten_nested` を導入しました。[#85492](https://github.com/ClickHouse/ClickHouse/pull/85492) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。

### システムテーブルと可観測性 {#system-tables-and-observability}


- ClickHouseの非同期メトリクスにプレッシャーメトリクスを追加しました。[#80779](https://github.com/ClickHouse/ClickHouse/pull/80779) ([Xander Garbett](https://github.com/Garbett1))。
- マークキャッシュからの退避を追跡するためのメトリクス`MarkCacheEvictedBytes`、`MarkCacheEvictedMarks`、`MarkCacheEvictedFiles`を追加しました。(issue [#60989](https://github.com/ClickHouse/ClickHouse/issues/60989))。[#80799](https://github.com/ClickHouse/ClickHouse/pull/80799) ([Shivji Kumar Jha](https://github.com/shiv4289))。
- `system.formats`テーブルに、HTTPコンテンツタイプやスキーマ推論の機能など、フォーマットに関する拡張情報が含まれるようになりました。[#81505](https://github.com/ClickHouse/ClickHouse/pull/81505) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `TRUNCATE TABLE system.warnings`を使用して`system.warnings`テーブルからすべての警告をクリアするサポートを追加しました。[#82087](https://github.com/ClickHouse/ClickHouse/pull/82087) ([Vladimir Cherkasov](https://github.com/vdimir))。
- `system.licenses`にRustクレートのライセンスを一覧表示するようにしました。[#82440](https://github.com/ClickHouse/ClickHouse/pull/82440) ([Raúl Marín](https://github.com/Algunenano))。
- 統計情報を使用して、例えば`(a < 1 and a > 0) or b = 3`のような複雑なCNF/DNFを推定するようにしました。[#82663](https://github.com/ClickHouse/ClickHouse/pull/82663) ([Han Fei](https://github.com/hanfei1991))。
- 場合によっては、メトリクスに複数の次元を持たせる必要があります。例えば、単一のカウンターではなく、エラーコード別に失敗したマージやミューテーションをカウントするなどです。[#83030](https://github.com/ClickHouse/ClickHouse/pull/83030) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
- `MergeParts`エントリのpart_logプロファイルイベントに、プロセスリソースメトリクス(`UserTimeMicroseconds`、`SystemTimeMicroseconds`、`RealTimeMicroseconds`など)を追加しました。[#83460](https://github.com/ClickHouse/ClickHouse/pull/83460) ([Vladimir Cherkasov](https://github.com/vdimir))。
- Cgroupレベルとシステム全体のメトリクスがまとめて報告されるようになりました。Cgroupレベルのメトリクスは`CGroup<Metric>`という名前で、OSレベルのメトリクス(procfsから収集)は`OS<Metric>`という名前になります。[#84317](https://github.com/ClickHouse/ClickHouse/pull/84317) ([Nikita Taranov](https://github.com/nickitat))。
- 可観測性を向上させるため、キュータイプとインスタンスIDでラベル付けされた、並行制限付きキューのサイズを監視するための次元メトリクスを追加しました。[#84675](https://github.com/ClickHouse/ClickHouse/pull/84675) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
- [`system.columns`](/operations/system-tables/columns)テーブルで、既存の`name`カラムのエイリアスとして`column`が提供されるようになりました。[#84695](https://github.com/ClickHouse/ClickHouse/pull/84695) ([Yunchi Pang](https://github.com/yunchipang))。
- `system.errors`にフォーマット文字列カラムを追加しました。このカラムは、アラートルールで同じエラータイプごとにグループ化するために必要です。[#84776](https://github.com/ClickHouse/ClickHouse/pull/84776) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
- Async Logの制限を調整可能にし、イントロスペクションを追加しました。[#85105](https://github.com/ClickHouse/ClickHouse/pull/85105) ([Raúl Marín](https://github.com/Algunenano))。
- system.columnsのテーブルカラムサイズを取得する際に`UNKNOWN_DATABASE`を無視するようにしました。[#85632](https://github.com/ClickHouse/ClickHouse/pull/85632) ([Azat Khuzhin](https://github.com/azat))。

### データベースエンジン {#database-engines}

### システムおよび内部改善 {#system-and-internal-improvements}


- 読み取り専用リモートディスクを持つデータベースのアタッチを、テーブルUUIDをDatabaseCatalogに手動で追加することで修正しました。[#82670](https://github.com/ClickHouse/ClickHouse/pull/82670) ([Tuan Pham Anh](https://github.com/tuanpach))。
- `distributed_ddl_output_mode='*_only_active'`の場合のDDLタスク処理を改善し、`max_replication_lag_to_enqueue`を超えるレプリケーション遅延を持つ新規または復旧したレプリカを待機しないようにしました。これにより、初期化または復旧後に新しいレプリカがアクティブになったものの大量のレプリケーションログが蓄積されている場合に発生する`DDL task is not finished on some hosts`エラーを回避できます。また、レプリケーションログが`max_replication_lag_to_enqueue`を下回るまで待機する`SYSTEM SYNC DATABASE REPLICA STRICT`クエリを実装しました。[#83302](https://github.com/ClickHouse/ClickHouse/pull/83302) ([Alexander Tokmakov](https://github.com/tavplubix))。
- SystemLogsのシャットダウン順序を通常テーブルの後(通常テーブルの前ではなく、システムテーブルの前)に変更しました。[#83134](https://github.com/ClickHouse/ClickHouse/pull/83134) ([Kseniia Sumarokova](https://github.com/kssenii))。
- レプリケートされたデータベース設定用のサーバー設定`logs_to_keep`を追加し、レプリケートされたデータベースのデフォルト`logs_to_keep`パラメータを設定できるようにしました。低い値はZooKeeperノード数を削減し(特に多数のデータベースがある場合に有益)、高い値は長期間のダウンタイム後に欠落したレプリカが追いつくことを可能にします。[#84183](https://github.com/ClickHouse/ClickHouse/pull/84183) ([Alexey Khatskevich](https://github.com/Khatskevich))。
- レプリケートされたデータベース設定`max_retries_before_automatic_recovery`のデフォルト値を10に変更し、一部のケースでより高速な復旧を可能にしました。[#84369](https://github.com/ClickHouse/ClickHouse/pull/84369) ([Alexander Tokmakov](https://github.com/tavplubix))。
- レプリケートされたデータベースにおける非追記型のリフレッシュ可能なマテリアライズドビューのDDL操作を、古い一時テーブルの作成と名前変更をスキップすることで最適化しました。[#84858](https://github.com/ClickHouse/ClickHouse/pull/84858) ([Tuan Pham Anh](https://github.com/tuanpach))。

### レプリケーションと同期 {#replication-and-synchronization}

### システムおよび内部改善 {#systemandinternalimprovements}

- `SYSTEM RESTART REPLICA`を改善し、ZooKeeper接続の問題が発生した際にテーブル作成を再試行することで、テーブルが忘れられることを防ぎます。[#82616](https://github.com/ClickHouse/ClickHouse/pull/82616) ([Nikolay Degterinsky](https://github.com/evillique))。
- `ReplicatedMergeTree::executeMetadataAlter`にUUID検証を追加し、StorageIDの取得と`IDatabase::alterTable`の呼び出しの間にテーブルが交換された場合の誤ったテーブル定義を防ぎます。[#82666](https://github.com/ClickHouse/ClickHouse/pull/82666) ([Nikolay Degterinsky](https://github.com/evillique))。
- 実験的なゼロコピーレプリケーションに関連する実験的な`send_metadata`ロジックを削除しました。このコードは一度も使用されず、サポートされておらず、おそらく破損しており、その機能を検証するテストもありませんでした。[#82508](https://github.com/ClickHouse/ClickHouse/pull/82508) ([alesapin](https://github.com/alesapin))。
- `remote_fs_zero_copy_zookeeper_path`でのマクロ展開のサポートを追加しました。[#85437](https://github.com/ClickHouse/ClickHouse/pull/85437) ([Mikhail Koviazin](https://github.com/mkmkme))。

### 関数と式 {#functions-and-expressions}


* 関数 `addressToSymbol` および `system.symbols` テーブルでは、仮想メモリアドレスではなくファイルオフセットが使用されるようになります。 [#81896](https://github.com/ClickHouse/ClickHouse/pull/81896) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 名前付きタプルのスーパータイプを導出する際に、要素名を可能な限り保持するようにしました。[#81345](https://github.com/ClickHouse/ClickHouse/pull/81345) ([lgbo](https://github.com/lgbo-ustc)).
* 同一カラムに対して、ウィンドウごとに異なる照合順序を使用できるようにしました。 [#82877](https://github.com/ClickHouse/ClickHouse/pull/82877) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* データ型を WKB 形式に書き込む関数を追加。 [#82935](https://github.com/ClickHouse/ClickHouse/pull/82935) ([scanhex12](https://github.com/scanhex12)).
* `Time` および `Time64` 型の値を MM:SS、M:SS、SS、または S 形式として解釈できるようにしました。 [#83299](https://github.com/ClickHouse/ClickHouse/pull/83299) ([Yarik Briukhovetskyi](https://github.com/yariks5s))
* 関数 `reinterpret()` は、`T` が固定長データ型である場合の `Array(T)` 型への変換をサポートするようになりました（issue [#82621](https://github.com/ClickHouse/ClickHouse/issues/82621)）。 [#83399](https://github.com/ClickHouse/ClickHouse/pull/83399)（[Shankar Iyer](https://github.com/shankar-iyer)）。
* `structureToProtobufSchema` 関数と `structureToCapnProtoSchema` 関数を、改行ではなくゼロ終端バイトを正しく追加するように修正し、出力中の改行欠落を防ぐとともに、ゼロバイトに依存する関数（`logTrace`、`demangle`、`extractURLParameter`、`toStringCutToZero`、`encrypt`/`decrypt` など）でのバッファオーバーフロー発生の可能性を防止しました。 [#85062](https://github.com/ClickHouse/ClickHouse/issues/85062) をクローズ。 [#85063](https://github.com/ClickHouse/ClickHouse/pull/85063)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* ゼロバイトを含む文字列の処理をサポートするように、`regexp_tree` 辞書レイアウトを修正しました。 [#85063](https://github.com/ClickHouse/ClickHouse/pull/85063) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `Values` フォーマット、または行末に改行を含まないその他のフォーマットで呼び出された場合に、出力の末尾の文字を誤って切り捨てていた `formatRowNoNewline` 関数を修正しました。 [#85063](https://github.com/ClickHouse/ClickHouse/pull/85063) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* `stem` 関数における例外安全性上の不具合を修正しました。この不具合により、まれなケースでメモリリークが発生する可能性がありました。 [#85063](https://github.com/ClickHouse/ClickHouse/pull/85063) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* `FixedString` 型の引数に対する `initcap` 関数を修正し、ブロック内で前の文字列が単語文字で終わっている場合でも、各文字列の先頭を単語の開始位置として正しく認識できるようにしました。 [#85063](https://github.com/ClickHouse/ClickHouse/pull/85063) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 初期化されていないメモリが漏えいするおそれのあった Apache `ORC` フォーマットのセキュリティ脆弱性を修正しました。 [#85063](https://github.com/ClickHouse/ClickHouse/pull/85063) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `replaceRegexpAll` とそのエイリアス `REGEXP_REPLACE` の動作を変更し、直前の一致で文字列全体がマッチしていた場合でも（例：`^a*|a*$` や `^|.*`）、文字列末尾での空マッチを許可するようにしました。これにより JavaScript、Perl、Python、PHP、Ruby のセマンティクスと整合しますが、PostgreSQL とは異なります。 [#85063](https://github.com/ClickHouse/ClickHouse/pull/85063) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 多くの文字列処理関数の実装を最適化および簡素化しました。いくつかの関数についての誤ったドキュメントを修正しました。注意: String 型カラムおよび String 型カラムを含む複合型に対する `byteSize` の出力が、空文字列 1 つあたり 9 バイトから 8 バイトに変更されましたが、これは期待される動作です。 [#85063](https://github.com/ClickHouse/ClickHouse/pull/85063) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 関数 `timeSeries*ToGrid()` でステップ値 0 を許可します。これは [https://github.com/ClickHouse/ClickHouse/pull/75036](https://github.com/ClickHouse/ClickHouse/pull/75036) の第`3`部です。[#85390](https://github.com/ClickHouse/ClickHouse/pull/85390)（[Vitaly Baranov](https://github.com/vitlibar)）。
* 関数 `nested` が内部配列をサポートするようになりました。[#85719](https://github.com/ClickHouse/ClickHouse/pull/85719) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。

### MergeTreeの改善 {#mergetree-improvements}

- オンザフライで更新される列やパッチパーツに依存するスキップインデックスを、より細かい粒度で無効化します。現在、スキップインデックスはオンザフライミューテーションまたはパッチパーツの影響を受けるパーツでのみ使用されなくなりました。以前は、これらのインデックスはすべてのパーツで無効化されていました。[#84241](https://github.com/ClickHouse/ClickHouse/pull/84241) ([Anton Popov](https://github.com/CurtizJ))。
- MergeTree設定`search_orphaned_parts_drives`を追加し、ローカルメタデータを持つディスクなど、パーツを検索する範囲を制限できるようにしました。[#84710](https://github.com/ClickHouse/ClickHouse/pull/84710) ([Ilya Golshtein](https://github.com/ilejn))。
- `WHERE`に対する`read_in_order_use_virtual_row`の欠落していたサポートを追加しました。これにより、`PREWHERE`に完全にプッシュダウンされなかったフィルタを持つクエリで、より多くのパーツの読み取りをスキップできるようになります。[#84835](https://github.com/ClickHouse/ClickHouse/pull/84835) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- MergeTreeにおける「コンパクト」Variant識別子のシリアライゼーションの使用を修正しました。以前は、使用可能な場合でも一部のケースで使用されていませんでした。[#84141](https://github.com/ClickHouse/ClickHouse/pull/84141) ([Pavel Kruglov](https://github.com/Avogar))。
- パッチパーツ内の非圧縮バイト総量に対する制限(テーブル設定[`max_uncompressed_bytes_in_patches`](/operations/settings/merge-tree-settings#max_uncompressed_bytes_in_patches))を追加しました。これにより、軽量更新後の`SELECT`クエリの大幅な速度低下を防ぎ、軽量更新の誤用の可能性を防止します。[#85641](https://github.com/ClickHouse/ClickHouse/pull/85641) ([Anton Popov](https://github.com/CurtizJ))。

### キャッシュとメモリ管理 {#cache-and-memory-management}

- ファイルシステムキャッシュの論理エラーを修正しました:「ゼロバイトであるが範囲が完了していない」。[#81868](https://github.com/ClickHouse/ClickHouse/pull/81868) ([Kseniia Sumarokova](https://github.com/kssenii))。
- キャッシュの局所性を向上させるためにランデブーハッシュを追加しました。[#82511](https://github.com/ClickHouse/ClickHouse/pull/82511) ([Anton Ivashkin](https://github.com/ianton-ru))。
- ファイルシステムキャッシュの動的リサイズ機能をリファクタリングしました。内部検査のためのログを追加しました。[#82556](https://github.com/ClickHouse/ClickHouse/pull/82556) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 実行可能なユーザー定義関数のクエリメモリトラッキングのオーバーヘッドを削減しました。[#83929](https://github.com/ClickHouse/ClickHouse/pull/83929) ([Eduard Karacharov](https://github.com/korowa))。
- 外部ライブラリによって行われるすべてのメモリ割り当てが、ClickHouseのメモリトラッカーから可視化され、適切に計上されるようになりました。これにより、特定のクエリで報告されるメモリ使用量が「増加」したり、`MEMORY_LIMIT_EXCEEDED`によるエラーが発生する可能性があります。[#84082](https://github.com/ClickHouse/ClickHouse/pull/84082) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- 暗号化された名前付きコレクションのencrypted_bufferに必要な最小限のメモリを割り当てるようにしました。[#84432](https://github.com/ClickHouse/ClickHouse/pull/84432) ([Pablo Marcos](https://github.com/pamarcos))。

### ベクトル類似度インデックス {#vector-similarity-index}

- `NumericIndexedVector`で`nan`と`inf`を使用できないようにしました。[#82239](https://github.com/ClickHouse/ClickHouse/issues/82239)およびその他の問題を修正しました。[#82681](https://github.com/ClickHouse/ClickHouse/pull/82681) ([Raufs Dunamalijevs](https://github.com/rienath))。
- ベクトル類似度インデックスがバイナリ量子化をサポートするようになりました。バイナリ量子化により、メモリ消費量が大幅に削減され、ベクトルインデックスの構築プロセスが高速化されます(距離計算の高速化による)。また、既存の設定`vector_search_postfilter_multiplier`は廃止され、より汎用的な設定`vector_search_index_fetch_multiplier`に置き換えられました。[#85024](https://github.com/ClickHouse/ClickHouse/pull/85024) ([Shankar Iyer](https://github.com/shankar-iyer))。
- ベクトル類似度インデックスを使用した近似ベクトル検索が正式版(GA)になりました。[#85888](https://github.com/ClickHouse/ClickHouse/pull/85888) ([Robert Schulze](https://github.com/rschu1ze))。


### エラー処理とメッセージ {#error-handling-and-messages}

- Connectionヘッダーはヘッダーの末尾に送信されます。接続を保持すべきかどうかが判明した時点で送信されます。[#81951](https://github.com/ClickHouse/ClickHouse/pull/81951) ([Sema Checherinda](https://github.com/CheSema))。
- 以前のバージョンでは、IPv4を使用した集約関数の状態の乗算が適切なエラーコードではなく論理エラーを生成していました。解決: [#82817](https://github.com/ClickHouse/ClickHouse/issues/82817)。[#82818](https://github.com/ClickHouse/ClickHouse/pull/82818) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `AsynchronousMetrics`のエラー処理を改善しました。`/sys/block`ディレクトリが存在するがアクセスできない場合、サーバーはブロックデバイスの監視なしで起動します。解決: [#79229](https://github.com/ClickHouse/ClickHouse/issues/79229)。[#83115](https://github.com/ClickHouse/ClickHouse/pull/83115) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 不正なSELECT文を持つマテリアライズドビューを使用した`INSERT`の依存関係チェックが正しくなく、ユーザーが明確な説明を含む意味のあるエラーではなく、不明瞭な`std::exception`を受け取る可能性がありました。この問題は修正されました。修正: [#82889](https://github.com/ClickHouse/ClickHouse/issues/82889)。[#83190](https://github.com/ClickHouse/ClickHouse/pull/83190) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- 例外メッセージに非常に長い式アクションの説明を出力しないようにしました。解決: [#83164](https://github.com/ClickHouse/ClickHouse/issues/83164)。[#83350](https://github.com/ClickHouse/ClickHouse/pull/83350) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ストレージがシャットダウンしている際、`getStatus`は`ErrorCodes::ABORTED`例外をスローします。以前はこれによりSELECTクエリが失敗していましたが、現在は`ErrorCodes::ABORTED`例外をキャッチして意図的に無視するようにしました。[#83435](https://github.com/ClickHouse/ClickHouse/pull/83435) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
- プロジェクションの読み込みと追加に関する特定の状況における例外メッセージを読みやすくしました。[#83728](https://github.com/ClickHouse/ClickHouse/pull/83728) ([Robert Schulze](https://github.com/rschu1ze))。
- 閉じられた接続からの読み取りを防ぐため、EOFをチェックする前に接続がキャンセルされているかどうかを確認するようにしました。修正: [#83893](https://github.com/ClickHouse/ClickHouse/issues/83893)。[#84227](https://github.com/ClickHouse/ClickHouse/pull/84227) ([Raufs Dunamalijevs](https://github.com/rienath))。
- 内部チェックを簡素化することで、クライアント接続に対するサーバーシャットダウン処理を改善しました。[#84312](https://github.com/ClickHouse/ClickHouse/pull/84312) ([Raufs Dunamalijevs](https://github.com/rienath))。
- UDF実行中の低レベルエラーは、現在エラーコード`UDF_EXECUTION_FAILED`で失敗するようになりました。以前は異なるエラーコードが返される可能性がありました。[#84547](https://github.com/ClickHouse/ClickHouse/pull/84547) ([Xu Jia](https://github.com/XuJia0210))。

### SQLフォーマットの改善 {#sql-formatting-improvements}


- `CREATE DICTIONARY`のフォーマットの不整合を修正しました。[#82105](https://github.com/ClickHouse/ClickHouse/issues/82105)を解決します。[#82829](https://github.com/ClickHouse/ClickHouse/pull/82829) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `materialize`関数を含む場合の`TTL`のフォーマットの不整合を修正しました。[#82828](https://github.com/ClickHouse/ClickHouse/issues/82828)を解決します。[#82831](https://github.com/ClickHouse/ClickHouse/pull/82831) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- INTO OUTFILEなどの出力オプションを含む場合のサブクエリ内の`EXPLAIN AST`のフォーマットの不整合を修正しました。[#82826](https://github.com/ClickHouse/ClickHouse/issues/82826)を解決します。[#82840](https://github.com/ClickHouse/ClickHouse/pull/82840) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- エイリアスが許可されていないコンテキストにおいて、エイリアスを持つ括弧付き式のフォーマットの不整合を修正しました。[#82836](https://github.com/ClickHouse/ClickHouse/issues/82836)を解決します。[#82837](https://github.com/ClickHouse/ClickHouse/issues/82837)を解決します。[#82867](https://github.com/ClickHouse/ClickHouse/pull/82867) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- クエリパラメータを使用したCREATE USERのフォーマットを修正しました(例:`CREATE USER {username:Identifier} IDENTIFIED WITH no_password`)。[#84376](https://github.com/ClickHouse/ClickHouse/pull/84376) ([Azat Khuzhin](https://github.com/azat))。
- CREATE DICTIONARYクエリにおいて、パラメータを持つカラム(例:Decimal(8))の後の末尾カンマの解析を修正しました。[#85586](https://github.com/ClickHouse/ClickHouse/issues/85586)を解決します。[#85653](https://github.com/ClickHouse/ClickHouse/pull/85653) ([Nikolay Degterinsky](https://github.com/evillique))。

### 外部統合 {#external-integrations}

- 名前付きコレクションを使用する際のODBCとJDBCのパラメータ名を統一しました。[#83410](https://github.com/ClickHouse/ClickHouse/pull/83410) ([Andrey Zvonov](https://github.com/zvonand))。
- MongoDB:文字列から数値型への暗黙的な解析。以前は、ClickHouseテーブルの数値カラムに対してMongoDBソースから文字列値を受け取った場合、例外がスローされていました。現在は、エンジンが文字列から数値を自動的に解析するようになりました。[#81167](https://github.com/ClickHouse/ClickHouse/issues/81167)を解決します。[#84069](https://github.com/ClickHouse/ClickHouse/pull/84069) ([Kirill Nikiforov](https://github.com/allmazz))。
- サポートされていないアーキテクチャで`simdjson`を許可しました(以前は`CANNOT_ALLOCATE_MEMORY`エラーが発生していました)。[#84966](https://github.com/ClickHouse/ClickHouse/pull/84966) ([Azat Khuzhin](https://github.com/azat))。

### その他の改善 {#miscellaneous-improvements}


- Ytsaurusテーブルエンジンおよびテーブル関数を追加しました。[#77606](https://github.com/ClickHouse/ClickHouse/pull/77606) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。
- HashJoin::needUsedFlagsForPerRightTableRowを改善し、クロス結合に対してfalseを返すようにしました。[#82379](https://github.com/ClickHouse/ClickHouse/pull/82379) ([lgbo](https://github.com/lgbo-ustc))。
- マップ型カラムをタプルの配列として書き込み/読み取りできるようにしました。[#82408](https://github.com/ClickHouse/ClickHouse/pull/82408) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。
- このPRは取り消されました。[#82884](https://github.com/ClickHouse/ClickHouse/pull/82884) ([Mithun p](https://github.com/mithunputhusseri))。
- 非同期ログ: キューに保持されるエントリの最大数を制限しました。[#83214](https://github.com/ClickHouse/ClickHouse/pull/83214) ([Raúl Marín](https://github.com/Algunenano))。
- JSON入力フォーマットでDate/Date32を整数として有効にしました。[#83597](https://github.com/ClickHouse/ClickHouse/pull/83597) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。
- ブルームフィルタインデックス(通常、ngram、トークン)のサポートを改善し、第1引数が定数配列(集合)で第2引数がインデックス付きカラム(部分集合)の場合に利用できるようにし、より効率的なクエリ実行を可能にしました。[#84700](https://github.com/ClickHouse/ClickHouse/pull/84700) ([Doron David](https://github.com/dorki))。
- KeyValueストレージのプライマリキー(例: EmbeddedRocksDB、KeeperMap)に対して`IN` / `GLOBAL IN`フィルタをプッシュダウンする際に、集合値の型キャストを許可しました。[#84515](https://github.com/ClickHouse/ClickHouse/pull/84515) ([Eduard Karacharov](https://github.com/korowa))。
- 並列レプリカ読み取りにおいて、インデックス解析の結果が空の範囲となる場合のフルスキャンを排除しました。[#84971](https://github.com/ClickHouse/ClickHouse/pull/84971) ([Eduard Karacharov](https://github.com/korowa))。
- ローカルホストで統合テストを実行する際に発生する可能性のある一連の問題を修正しました。[#82135](https://github.com/ClickHouse/ClickHouse/pull/82135) ([Oleg Doronin](https://github.com/dorooleg))。
- 古いデプロイメントに対してtrace_log.symbolizeをデフォルトで有効にしました。[#85456](https://github.com/ClickHouse/ClickHouse/pull/85456) ([Azat Khuzhin](https://github.com/azat))。

#### バグ修正(公式安定版リリースにおけるユーザーに見える不具合) {#bug-fixes}

### パフォーマンス最適化 {#performance-optimizations}

- 25.5のhttps://github.com/ClickHouse/ClickHouse/pull/79051で導入されたSummingMergeTreeのパフォーマンス低下を修正しました。[#82130](https://github.com/ClickHouse/ClickHouse/pull/82130) ([Pavel Kruglov](https://github.com/Avogar))。
- アナライザが有効な場合に、セカンダリクエリが常にVIEWからすべてのカラムを読み取ることによるパフォーマンス低下を修正しました。修正内容: [#81718](https://github.com/ClickHouse/ClickHouse/issues/81718)。[#83036](https://github.com/ClickHouse/ClickHouse/pull/83036) ([Dmitry Novik](https://github.com/novikd))。
- 依存関係のないテーブル作成時に循環依存をチェックしないようにしました。これにより、https://github.com/ClickHouse/ClickHouse/pull/65405で導入された、数千のテーブルを作成するユースケースのパフォーマンス低下を修正しました。[#83077](https://github.com/ClickHouse/ClickHouse/pull/83077) ([Pavel Kruglov](https://github.com/Avogar))。
- `DISTINCT`ウィンドウ集約を線形時間で実行できるようにし、`sumDistinct`のバグを修正しました。クローズ: [#79792](https://github.com/ClickHouse/ClickHouse/issues/79792)。クローズ: [#52253](https://github.com/ClickHouse/ClickHouse/issues/52253)。[#79859](https://github.com/ClickHouse/ClickHouse/pull/79859) ([Nihal Z. Miaji](https://github.com/nihalzp))。

### クエリ実行の修正 {#query-execution-fixes}


* `ORDER BY ... LIMIT BY ... LIMIT N` を組み合わせたクエリにおいて、ORDER BY が PartialSorting として実行される場合、カウンタ `rows_before_limit_at_least` は、ソート処理で消費された行数ではなく、LIMIT 句で消費された行数を反映するようになりました。 [#78999](https://github.com/ClickHouse/ClickHouse/pull/78999) ([Eduard Karacharov](https://github.com/korowa))。
* `<=>` 演算子と Join ストレージエンジンに関する論理エラーを修正し、クエリが正しいエラーコードを返すようになりました。 [#80165](https://github.com/ClickHouse/ClickHouse/pull/80165) ([Vladimir Cherkasov](https://github.com/vdimir)).
* `remote` 関数ファミリーと併用した際に発生する `loop` 関数のクラッシュを修正しました。`loop(remote(...))` で `LIMIT` 句が正しく適用されるようにしました。 [#80299](https://github.com/ClickHouse/ClickHouse/pull/80299) ([Julia Kartseva](https://github.com/jkartseva)).
* `to_utc_timestamp` および `from_utc_timestamp` 関数が、Unix エポック（1970-01-01）より前および最大日時（2106-02-07 06:28:15）より後の日付を扱う際の不正な動作を修正しました。これらの関数は、値をそれぞれエポック開始時刻および最大日時に正しく切り詰めるようになりました。 [#80498](https://github.com/ClickHouse/ClickHouse/pull/80498) ([Surya Kant Ranjan](https://github.com/iit2009046))。
* `transform_null_in=1` のときに、左側の引数が NULL でサブクエリ結果が非 Nullable 型である場合の `IN` の実行を修正しました。 [#81584](https://github.com/ClickHouse/ClickHouse/pull/81584) ([Pavel Kruglov](https://github.com/Avogar)).
* スカラー相関サブクエリ処理中に必要なカラムが読み込まれない問題を修正しました。[#81716](https://github.com/ClickHouse/ClickHouse/issues/81716) を解決。[#81805](https://github.com/ClickHouse/ClickHouse/pull/81805)（[Dmitry Novik](https://github.com/novikd)）。
* クエリで定数エイリアス列のみが使用されている場合のフィルタの解析を修正しました。 [#79448](https://github.com/ClickHouse/ClickHouse/issues/79448) を修正しました。 [#82037](https://github.com/ClickHouse/ClickHouse/pull/82037)（[Dmitry Novik](https://github.com/novikd)）。
* `WHERE` 句および `IndexSet` 使用時に `arrayJoin` を含むクエリで発生する `Not found column` エラーを修正しました。 [#82113](https://github.com/ClickHouse/ClickHouse/pull/82113) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* CTE の定義が同じ名前の別のテーブル式を参照している場合に発生する `TOO_DEEP_SUBQUERIES` 例外を修正。 [#83413](https://github.com/ClickHouse/ClickHouse/pull/83413) ([Dmitry Novik](https://github.com/novikd)).
* `WHERE ... IN (<subquery>)` 句を含むクエリで、クエリ条件キャッシュ（設定 `use_query_condition_cache`）が有効な場合に誤った結果が返される問題を修正しました。 [#83445](https://github.com/ClickHouse/ClickHouse/pull/83445) ([LB7666](https://github.com/acking-you)).
* `UNION ALL` を伴う `INSERT SELECT` が、ある特定のケースでヌルポインタの逆参照を引き起こす可能性がありました。これにより [#83618](https://github.com/ClickHouse/ClickHouse/issues/83618) が解決されました。 [#83643](https://github.com/ClickHouse/ClickHouse/pull/83643) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 相関列を含む行ポリシー式の解析中に発生する `LOGICAL_ERROR` を修正。[#82618](https://github.com/ClickHouse/ClickHouse/pull/82618)（[Dmitry Novik](https://github.com/novikd)）。
* クエリ条件キャッシュを再帰CTEと併用した際に誤った結果が返される不具合を修正しました（issue [#81506](https://github.com/ClickHouse/ClickHouse/issues/81506)）。[#84026](https://github.com/ClickHouse/ClickHouse/pull/84026)（[zhongyuankai](https://github.com/zhongyuankai)）。
* 不正な `WINDOW` 定義に対する無限再帰的な解析を修正しました。 [#83131](https://github.com/ClickHouse/ClickHouse/issues/83131) を解決します。 [#84242](https://github.com/ClickHouse/ClickHouse/pull/84242)（[Dmitry Novik](https://github.com/novikd)）。
* `additional_table_filters expression` 設定内の `IN (subquery)` における `Not-ready Set` の問題を修正しました。 [#85210](https://github.com/ClickHouse/ClickHouse/pull/85210) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* `optimize_syntax_fuse_functions` が有効な場合に発生する重複サブクエリに起因する論理エラーを修正し、[#75511](https://github.com/ClickHouse/ClickHouse/issues/75511) をクローズ。 [#83300](https://github.com/ClickHouse/ClickHouse/pull/83300)（[Vladimir Cherkasov](https://github.com/vdimir)）。

### IcebergおよびDataLakeの修正 {#iceberg-and-datalake-fixes}

- RESTカタログ経由でIcebergテーブルをクエリする際のメタデータ解決を修正しました。... [#80562](https://github.com/ClickHouse/ClickHouse/pull/80562) ([Saurabh Kumar Ojha](https://github.com/saurabhojha)).
- Icebergのデータ競合を修正しました。 [#82088](https://github.com/ClickHouse/ClickHouse/pull/82088) ([Azat Khuzhin](https://github.com/azat)).
- Icebergの「Context has expired」エラーを修正しました。 [#82146](https://github.com/ClickHouse/ClickHouse/pull/82146) ([Azat Khuzhin](https://github.com/azat)).
- スキーマ進化後、ClickHouseがGlueカタログからIcebergテーブルを読み取れるようになりました。修正: [#81272](https://github.com/ClickHouse/ClickHouse/issues/81272). [#82301](https://github.com/ClickHouse/ClickHouse/pull/82301) ([alesapin](https://github.com/alesapin)).
- Icebergのデータ競合を修正しました。 [#82841](https://github.com/ClickHouse/ClickHouse/pull/82841) ([Azat Khuzhin](https://github.com/azat)).
- Iceberg配列要素とIcebergマップ値、およびそれらのすべてのネストされたサブフィールドに対する境界ベースのファイルプルーニングを無効化しました。 [#83520](https://github.com/ClickHouse/ClickHouse/pull/83520) ([Daniil Ivanik](https://github.com/divanik)).
- 複合型に対するIceberg書き込みを修正しました。 [#85330](https://github.com/ClickHouse/ClickHouse/pull/85330) ([scanhex12](https://github.com/scanhex12)).
- 複合型に対する下限値と上限値の書き込みはサポートされていません。 [#85332](https://github.com/ClickHouse/ClickHouse/pull/85332) ([scanhex12](https://github.com/scanhex12)).
- Icebergのフィールドのnull許容性を修正しました。 [#85977](https://github.com/ClickHouse/ClickHouse/pull/85977) ([scanhex12](https://github.com/scanhex12)).
- 空のIceberg削除ファイルを作成しなくなりました。 [#86061](https://github.com/ClickHouse/ClickHouse/pull/86061) ([scanhex12](https://github.com/scanhex12)).
- Iceberg書き込み時のメタデータタイムスタンプを更新しました。 [#85711](https://github.com/ClickHouse/ClickHouse/pull/85711) ([scanhex12](https://github.com/scanhex12)).
- Sparkが位置削除ファイルを読み取れない問題を修正しました。 [#85762](https://github.com/ClickHouse/ClickHouse/pull/85762) ([scanhex12](https://github.com/scanhex12)).
- マニフェストファイルからスキーマを取得することを停止し、各スナップショットに対して関連するスキーマを独立して保存するようになりました。各データファイルの関連スキーマを対応するスナップショットから推論します。以前の動作は、既存ステータスを持つマニフェストファイルエントリに対するIceberg仕様に違反していました。 [#84588](https://github.com/ClickHouse/ClickHouse/pull/84588) ([Daniil Ivanik](https://github.com/divanik)).
- Icebergは、SELECTクエリ間で関連するスナップショットバージョンをキャッシュしようとせず、常にスナップショットを正確に解決するようになりました。以前のIcebergスナップショットのキャッシュ試行は、タイムトラベルを使用したIcebergテーブルの使用に問題を引き起こしていました。 [#85038](https://github.com/ClickHouse/ClickHouse/pull/85038) ([Daniil Ivanik](https://github.com/divanik)).
- RESTカタログ経由でIcebergテーブルをクエリする際のメタデータ解決を修正しました。... [#85531](https://github.com/ClickHouse/ClickHouse/pull/85531) ([Saurabh Kumar Ojha](https://github.com/saurabhojha)).
- icebergS3ClusterおよびicebergAzureClusterテーブル関数におけるシークレットマスキングを修正しました。 [#85658](https://github.com/ClickHouse/ClickHouse/pull/85658) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).

### DeltaLakeの修正 {#deltalake-fixes}


- ストレージ`DeltaLake`のdelta-kernelにおけるカラムプルーニングを修正しました。[#84543](https://github.com/ClickHouse/ClickHouse/issues/84543)をクローズします。[#84745](https://github.com/ClickHouse/ClickHouse/pull/84745) ([Kseniia Sumarokova](https://github.com/kssenii))。
- ストレージDeltaLakeのdelta-kernelにおける認証情報の更新を実装しました。[#84751](https://github.com/ClickHouse/ClickHouse/pull/84751) ([Kseniia Sumarokova](https://github.com/kssenii))。
- delta-kernel実装におけるセグメンテーション違反を修正しました。[#85160](https://github.com/ClickHouse/ClickHouse/pull/85160) ([Kseniia Sumarokova](https://github.com/kssenii))。
- `DeltaLake`エンジンのdelta-kernel実装における競合状態を修正しました。[#85221](https://github.com/ClickHouse/ClickHouse/pull/85221) ([Kseniia Sumarokova](https://github.com/kssenii))。
- `DeltaLake`エンジンにおいて、delta-kernelが無効化されている場合のパーティション化されたデータの読み取りを修正しました。この問題は25.7で発生していました(https://github.com/ClickHouse/ClickHouse/pull/81136)。[#85223](https://github.com/ClickHouse/ClickHouse/pull/85223) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 互換性のため、`allow_experimental_delta_kernel_rs`の25.5以前の値を`false`に変更しました。[#84587](https://github.com/ClickHouse/ClickHouse/pull/84587) ([Kseniia Sumarokova](https://github.com/kssenii))。
- delta lakeのキャッシュからのカウント読み取りを修正しました。[#85704](https://github.com/ClickHouse/ClickHouse/pull/85704) ([Kseniia Sumarokova](https://github.com/kssenii))。

### TTLとMergeTreeの修正 {#ttl-and-mergetree-fixes}

- TTLによって行が削減される際にmin-maxインデックスを再計算し、`minmax_count_projection`などそれに依存するアルゴリズムの正確性を保証するようにしました。これにより[#77091](https://github.com/ClickHouse/ClickHouse/issues/77091)が解決されます。[#77166](https://github.com/ClickHouse/ClickHouse/pull/77166) ([Amos Bird](https://github.com/amosbird))。
- TTL更新時のTTL GROUP BYにおける誤ったTTL再計算を修正しました。[#81222](https://github.com/ClickHouse/ClickHouse/pull/81222) ([Evgeniy Ulasik](https://github.com/H0uston))。
- TTL式で辞書が使用されている場合のマージ中の「Context has expired」エラーを修正しました。[#81690](https://github.com/ClickHouse/ClickHouse/pull/81690) ([Azat Khuzhin](https://github.com/azat))。
- TTLのGROUP BYとSETで同じカラムを使用した場合のLOGICAL_ERRORとそれに続くクラッシュを修正しました。[#82054](https://github.com/ClickHouse/ClickHouse/pull/82054) ([Pablo Marcos](https://github.com/pamarcos))。
- MergeTreeは、テーブルからすべてのTTLが削除された場合、TTLに関連する処理を一切行わないようになりました。[#84441](https://github.com/ClickHouse/ClickHouse/pull/84441) ([alesapin](https://github.com/alesapin))。
- `ALTER MODIFY ORDER BY`がソートキー内のTTLカラムを検証しない問題を修正しました。`ALTER`操作中に`ORDER BY`句でTTLカラムが使用された場合、適切に拒否されるようになり、テーブルの破損を防ぎます。[#84536](https://github.com/ClickHouse/ClickHouse/pull/84536) ([xiaohuanlin](https://github.com/xiaohuanlin))。

### プロジェクションの修正 {#projection-fixes}


- カラム型がNullableに変更された際のマテリアライズプロジェクション実行時の論理エラーを修正しました。[#80741](https://github.com/ClickHouse/ClickHouse/pull/80741) ([Pavel Kruglov](https://github.com/Avogar))。
- `enable_shared_storage_snapshot_in_query = 1`の場合における`mergeTreeProjection`テーブル関数での親メタデータの不正な使用を修正しました。これは[#82634](https://github.com/ClickHouse/ClickHouse/issues/82634)に対応するものです。[#82638](https://github.com/ClickHouse/ClickHouse/pull/82638) ([Amos Bird](https://github.com/amosbird))。
- テーブルにプロジェクションがあり、`lightweight_mutation_projection_mode = 'rebuild'`が設定されている状態で、ユーザーがテーブル内の任意のブロックから全行を削除する軽量削除を実行した際に発生する稀なClickHouseクラッシュを修正しました。[#84158](https://github.com/ClickHouse/ClickHouse/pull/84158) ([alesapin](https://github.com/alesapin))。
- 破損したプロジェクションを持つパーツのバックアップを修正しました。[#85362](https://github.com/ClickHouse/ClickHouse/pull/85362) ([Antonio Andelic](https://github.com/antonio2368))。
- 安定化されるまで、リリースにおいてプロジェクション内での`_part_offset`カラムの使用を禁止しました。[#85372](https://github.com/ClickHouse/ClickHouse/pull/85372) ([Sema Checherinda](https://github.com/CheSema))。

### パラレルレプリカの修正 {#parallel-replicas-fixes}

- パラレルレプリカで実行される一部のクエリにおいて、順序読み取り最適化がイニシエーター上では適用されるがリモートノード上では適用されない場合がありました。これにより、パラレルレプリカコーディネーター(イニシエーター上)とリモートノードで異なる読み取りモードが使用され、論理エラーとなっていました。[#80652](https://github.com/ClickHouse/ClickHouse/pull/80652) ([Igor Nikonov](https://github.com/devcrafter))。
- サブクエリに`FINAL`が含まれる場合、パラレルレプリカを無効化しました[#81401](https://github.com/ClickHouse/ClickHouse/issues/81401)。[#83455](https://github.com/ClickHouse/ClickHouse/pull/83455) ([zoomxi](https://github.com/zoomxi))。
- パラレルレプリカを使用し、複数のINNER結合の後にRIGHT結合が続くクエリにおける`LOGICAL_ERROR`を修正しました。このようなクエリではパラレルレプリカを使用しないようにしました。[#84299](https://github.com/ClickHouse/ClickHouse/pull/84299) ([Vladimir Cherkasov](https://github.com/vdimir))。
- 逆順読み取り最適化を使用するパラレルレプリカを含むクエリが不正な結果を生成する可能性がある問題を修正しました。[#85406](https://github.com/ClickHouse/ClickHouse/pull/85406) ([Igor Nikonov](https://github.com/devcrafter))。

### 認証とセキュリティ {#authentication-and-security}


- ログ/query_logにおける名前付きコレクション値の非表示を修正しました。[#82405](https://github.com/ClickHouse/ClickHouse/issues/82405)を解決します。[#82510](https://github.com/ClickHouse/ClickHouse/pull/82510) ([Kseniia Sumarokova](https://github.com/kssenii))。
- SCRAM_SHA256_PASSWORD型のASTから解析する際に、認証データのソルトを設定するようにしました。[#82888](https://github.com/ClickHouse/ClickHouse/pull/82888) ([Tuan Pham Anh](https://github.com/tuanpach))。
- Avroスキーマレジストリの認証情報をマスクし、ユーザーやログに表示されないようにしました。[#83713](https://github.com/ClickHouse/ClickHouse/pull/83713) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
- `REVOKE S3 ON system.*`を実行すると`*.*`のS3権限が取り消される不正な動作を修正しました。[#83417](https://github.com/ClickHouse/ClickHouse/issues/83417)を修正します。[#83420](https://github.com/ClickHouse/ClickHouse/pull/83420) ([pufit](https://github.com/pufit))。
- サーバー設定`allow_no_password`が0に変更された後、`no_password`で作成されたユーザーがログインを試みた際にサーバーがクラッシュする問題を修正しました。[#84426](https://github.com/ClickHouse/ClickHouse/pull/84426) ([Shankar Iyer](https://github.com/shankar-iyer))。
- JWTで識別されるユーザーを作成しようとした際のエラーメッセージを改善しました。[#85072](https://github.com/ClickHouse/ClickHouse/pull/85072) ([Konstantin Bogdanov](https://github.com/thevar1able))。
- `deltaLakeAzure`、`deltaLakeCluster`、`icebergS3Cluster`、`icebergAzureCluster`の認証情報をマスクするようにしました。[#85889](https://github.com/ClickHouse/ClickHouse/pull/85889) ([Julian Maicher](https://github.com/jmaicher))。
- [#79963](https://github.com/ClickHouse/ClickHouse/pull/79963)で導入されたバグを修正しました。定義者を持つマテリアライズドビューに挿入する際、権限チェックは定義者の権限を使用する必要があります。[#79951](https://github.com/ClickHouse/ClickHouse/issues/79951)を修正します。[#83502](https://github.com/ClickHouse/ClickHouse/pull/83502) ([pufit](https://github.com/pufit))。

### バックアップとリストアの修正 {#backup-and-restore-fixes}

- 空の`Memory`テーブルのバックアップを修正し、`BACKUP_ENTRY_NOT_FOUND`エラーでバックアップのリストアが失敗する問題を解決しました。[#82791](https://github.com/ClickHouse/ClickHouse/pull/82791) ([Julia Kartseva](https://github.com/jkartseva))。
- 読み取り専用ディスクでバックアップをリストアする際の誤解を招くエラーメッセージを修正しました。[#83051](https://github.com/ClickHouse/ClickHouse/pull/83051) ([Julia Kartseva](https://github.com/jkartseva))。
- 接続問題の後に不要な内部バックアップが開始される問題を修正しました。[#84755](https://github.com/ClickHouse/ClickHouse/pull/84755) ([Vitaly Baranov](https://github.com/vitlibar))。

### ウィンドウ関数と集約関数 {#window-and-aggregate-functions}

- マージ中に例外が発生した場合の`Aggregator`のクラッシュの可能性を修正しました。[#81450](https://github.com/ClickHouse/ClickHouse/pull/81450) ([Nikita Taranov](https://github.com/nickitat))。
- マージ中に例外が発生した場合の`Aggregator`のクラッシュの可能性を修正しました。[#82022](https://github.com/ClickHouse/ClickHouse/pull/82022) ([Nikita Taranov](https://github.com/nickitat))。
- arraySimilarityのコピーペーストエラーを修正し、UInt32およびInt32の重みの使用を禁止しました。テストとドキュメントを更新しました。[#82103](https://github.com/ClickHouse/ClickHouse/pull/82103) ([Mikhail f. Shiryaev](https://github.com/Felixoid))。
- 大きな数値に適用した際に発生する`numericIndexedVectorPointwiseAdd`、`numericIndexedVectorPointwiseSubtract`、`numericIndexedVectorPointwiseMultiply`、`numericIndexedVectorPointwiseDivide`関数のオーバーフローを修正しました。[#82165](https://github.com/ClickHouse/ClickHouse/pull/82165) ([Raufs Dunamalijevs](https://github.com/rienath))。

### Parquetおよびファイル形式の修正 {#parquet-and-file-format-fixes}


- Parquetブルームフィルタが`WHERE function(key) IN (...)`のような条件を`WHERE key IN (...)`であるかのように誤って適用する問題を修正しました。[#81255](https://github.com/ClickHouse/ClickHouse/pull/81255) ([Michael Kolupaev](https://github.com/al13n321))。
- ParquetライターがDecimal型に対して誤った統計情報(最小値/最大値)を出力する問題を修正しました。[#83754](https://github.com/ClickHouse/ClickHouse/pull/83754) ([Michael Kolupaev](https://github.com/al13n321))。
- 空要素の場合における`groupArraySample`/`groupArrayLast`のデシリアライゼーションを修正しました(入力が空の場合、デシリアライゼーションがバイナリの一部をスキップする可能性があり、これによりデータ読み取り時の破損やTCPプロトコルでのUNKNOWN_PACKET_FROM_SERVERが発生する可能性がありました)。この問題は数値型および日時型には影響しません。[#82763](https://github.com/ClickHouse/ClickHouse/pull/82763) ([Pedro Ferreira](https://github.com/PedroTadim))。
- RowBinary形式でNULL値を持つJSONパスの書き込みを修正しました。[#83923](https://github.com/ClickHouse/ClickHouse/pull/83923) ([Pavel Kruglov](https://github.com/Avogar))。

### JOINの修正 {#join-fixes}

- `Merge`ストレージを持つテーブルとのJOIN式を含むクエリにおけるフィルタ変更を修正しました。[#82092](https://github.com/ClickHouse/ClickHouse/issues/82092)を修正します。[#82950](https://github.com/ClickHouse/ClickHouse/pull/82950) ([Dmitry Novik](https://github.com/novikd))。
- キーバリューストレージが型キャストされたキーで結合された場合のクラッシュを修正しました。[#82497](https://github.com/ClickHouse/ClickHouse/pull/82497) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。
- 複数のJOINを含むクエリでマッチャーを解決する際の論理エラーを修正しました。[#81969](https://github.com/ClickHouse/ClickHouse/issues/81969)をクローズします。[#82421](https://github.com/ClickHouse/ClickHouse/pull/82421) ([Vladimir Cherkasov](https://github.com/vdimir))。
- 等価演算子のオペランドが異なる型を持つ場合、または定数を参照する場合におけるJOIN条件へのフィルタマージを修正しました。[#83432](https://github.com/ClickHouse/ClickHouse/issues/83432)を修正します。[#84145](https://github.com/ClickHouse/ClickHouse/pull/84145) ([Dmitry Novik](https://github.com/novikd))。
- 列の一方が`LowCardinality`でもう一方が定数である場合に、不等条件でJOINを実行する際の論理エラー`Expected single dictionary argument for function`を修正しました。[#81779](https://github.com/ClickHouse/ClickHouse/issues/81779)をクローズします。[#84019](https://github.com/ClickHouse/ClickHouse/pull/84019) ([Alexey Milovidov](https://github.com/alexey-milovidov))。

### レプリケートされたデータベースの修正 {#replicated-database-fixes}


- DDLWorkerおよびDatabaseReplicatedDDLWorkerのmarkReplicasActiveを修正しました。[#81395](https://github.com/ClickHouse/ClickHouse/pull/81395) ([Tuan Pham Anh](https://github.com/tuanpach))。
- `DatabaseReplicated::getClusterImpl`を修正しました。`hosts`の最初の要素(または複数の要素)が`id == DROPPED_MARK`を持ち、同じシャードに他の要素が存在しない場合、`shards`の最初の要素が空のベクトルとなり、`std::out_of_range`が発生する問題を解決しました。[#82093](https://github.com/ClickHouse/ClickHouse/pull/82093) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
- 非同期テーブル読み込みジョブの数を追跡するようにしました。実行中のジョブが存在する場合、`TransactionLog::removeOldEntries`で`tail_ptr`を更新しないようにしました。[#82824](https://github.com/ClickHouse/ClickHouse/pull/82824) ([Tuan Pham Anh](https://github.com/tuanpach))。
- MergeTreeテーブルが`add_minmax_index_for_numeric_columns=1`または`add_minmax_index_for_string_columns=1`で作成され、その後ALTER操作中にインデックスが実体化された場合に、新しいレプリカでReplicatedデータベースが正しく初期化されない問題を修正しました。[#83751](https://github.com/ClickHouse/ClickHouse/pull/83751) ([Nikolay Degterinsky](https://github.com/evillique))。
- DEFINERが削除された場合に、Replicatedデータベースの新しいレプリカでRMVが作成されない問題を修正しました。[#85327](https://github.com/ClickHouse/ClickHouse/pull/85327) ([Nikolay Degterinsky](https://github.com/evillique))。
- メタデータファイルの移動に長時間かかる場合のレプリケートされたデータベースの復旧を修正しました。[#85177](https://github.com/ClickHouse/ClickHouse/pull/85177) ([Tuan Pham Anh](https://github.com/tuanpach))。
- Keeper内のデータベースメタデータを復元した後、Replicatedデータベースを強制的に復旧するようにしました。[#85960](https://github.com/ClickHouse/ClickHouse/pull/85960) ([Tuan Pham Anh](https://github.com/tuanpach))。
- `Replicated`データベースの復旧におけるバグを修正しました。テーブル名に`%`記号が含まれている場合、復旧中に異なる名前でテーブルが再作成される可能性がありました。[#85987](https://github.com/ClickHouse/ClickHouse/pull/85987) ([Alexander Tokmakov](https://github.com/tavplubix))。
- DDLワーカーがレプリカセットから古いホストをクリーンアップするようになりました。これによりZooKeeperに保存されるメタデータの量が削減されます。[#88154](https://github.com/ClickHouse/ClickHouse/pull/88154) ([alesapin](https://github.com/alesapin))。

### 軽量更新の修正 {#lightweight-updates-fixes}

- `ReplacingMergeTree`および`CollapsingMergeTree`エンジンを使用するテーブルの軽量更新を修正しました。[#84851](https://github.com/ClickHouse/ClickHouse/pull/84851) ([Anton Popov](https://github.com/CurtizJ))。
- テーブル内のすべての列を更新する軽量更新における論理エラーを修正しました。[#84380](https://github.com/ClickHouse/ClickHouse/pull/84380) ([Anton Popov](https://github.com/CurtizJ))。
- バージョン25.7未満のサーバーで作成された`ReplicatedMergeTree`エンジンを使用するテーブルの軽量更新を修正しました。[#84933](https://github.com/ClickHouse/ClickHouse/pull/84933) ([Anton Popov](https://github.com/CurtizJ))。
- `ALTER TABLE ... REPLACE PARTITION`クエリを実行した後の、非レプリケート`MergeTree`エンジンを使用するテーブルの軽量更新を修正しました。[#84941](https://github.com/ClickHouse/ClickHouse/pull/84941) ([Anton Popov](https://github.com/CurtizJ))。
- `ReplicatedMergeTree`におけるパッチパーツのクリーンアップを修正しました。以前は、パッチパーツを実体化するマージまたはミューテーションされたパーツが別のレプリカからダウンロードされるまで、軽量更新の結果がレプリカ上で一時的に表示されない場合がありました。[#85121](https://github.com/ClickHouse/ClickHouse/pull/85121) ([Anton Popov](https://github.com/CurtizJ))。

### S3とオブジェクトストレージの修正 {#s3-and-object-storage-fixes}


- S3テーブル関数のシークレットマスキングにおける引数検証を修正し、`LOGICAL_ERROR`の発生を防止しました。[#80620](https://github.com/ClickHouse/ClickHouse/issues/80620)をクローズ。[#82056](https://github.com/ClickHouse/ClickHouse/pull/82056) ([Vladimir Cherkasov](https://github.com/vdimir))。
- サーバーがメモリ負荷下にある場合のリモートクエリにおけるデッドロックの可能性を修正しました。[#82160](https://github.com/ClickHouse/ClickHouse/pull/82160) ([Kirill](https://github.com/kirillgarbar))。
- AWS ECSトークンに有効期限を追加し、再読み込みを可能にしました。[#82422](https://github.com/ClickHouse/ClickHouse/pull/82422) ([Konstantin Bogdanov](https://github.com/thevar1able))。
- 外部テーブルエンジンにおけるキャッシュバッファの境界アライメント無効化を修正しました。https://github.com/ClickHouse/ClickHouse/pull/81868 で破損していました。[#82493](https://github.com/ClickHouse/ClickHouse/pull/82493) ([Kseniia Sumarokova](https://github.com/kssenii))。
- S3クライアントの`no_sign_request`を修正しました。これを使用してS3リクエストの署名を明示的に回避できます。また、エンドポイントベースの設定を使用して特定のエンドポイントに対して定義することもできます。[#83379](https://github.com/ClickHouse/ClickHouse/pull/83379) ([Antonio Andelic](https://github.com/antonio2368))。
- s3Cluster()からレプリケートされたMergeTreeへのINSERT SELECT実行時に、利用不可能なノードをスキップするようにしました。[#83676](https://github.com/ClickHouse/ClickHouse/pull/83676) ([Igor Nikonov](https://github.com/devcrafter))。
- S3リクエストレート低速化の早期リターン条件を修正しました。再試行可能なエラーによりすべてのスレッドが一時停止された場合に低速化動作を有効にするには、s3_slow_all_threads_after_network_errorまたはbackup_slow_all_threads_after_retryable_s3_errorのいずれかがtrueである必要があります(両方が必要ではなくなりました)。[#85505](https://github.com/ClickHouse/ClickHouse/pull/85505) ([Julia Kartseva](https://github.com/jkartseva))。
- Distributedテーブルまたはリモートテーブル関数を介してオブジェクトストレージ関数から読み取る際の論理エラーを修正しました。修正: [#84658](https://github.com/ClickHouse/ClickHouse/issues/84658)、修正 [#85173](https://github.com/ClickHouse/ClickHouse/issues/85173)、修正 [#52022](https://github.com/ClickHouse/ClickHouse/issues/52022)。[#85359](https://github.com/ClickHouse/ClickHouse/pull/85359) ([alesapin](https://github.com/alesapin))。
- S3Queueの「Table is already registered」という論理エラーを修正しました。[#84433](https://github.com/ClickHouse/ClickHouse/issues/84433)をクローズ。https://github.com/ClickHouse/ClickHouse/pull/83530 以降に破損していました。[#84677](https://github.com/ClickHouse/ClickHouse/pull/84677) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 大きな設定値がS3Queueテーブルとレプリカの再起動を破損させる問題を修正しました。[#86074](https://github.com/ClickHouse/ClickHouse/pull/86074) ([Nikolay Degterinsky](https://github.com/evillique))。

### Dynamic型とVariant型の修正 {#dynamicandvarianttypefixes}

- パース失敗時のDynamic列のロールバックを修正しました。[#82169](https://github.com/ClickHouse/ClickHouse/pull/82169) ([Pavel Kruglov](https://github.com/Avogar))。
- UNIONにおけるVariant型のクラッシュの可能性を修正しました。[#83295](https://github.com/ClickHouse/ClickHouse/pull/83295) ([Pavel Kruglov](https://github.com/Avogar))。
- 遅延マテリアライゼーションを使用したVariant列の読み取りを修正しました。[#84400](https://github.com/ClickHouse/ClickHouse/pull/84400) ([Pavel Kruglov](https://github.com/Avogar))。
- 既存のテーブルからの読み取り時に、デフォルト/マテリアライズ式の実行において実験的/疑わしい型の検証を行わないようにしました。[#81618](https://github.com/ClickHouse/ClickHouse/pull/81618) ([Pavel Kruglov](https://github.com/Avogar))。

### Keeperの修正 {#keeper-fixes}


- Keeperの修正: セッション終了時にエフェメラルノードが削除される際、総ウォッチ数を正しく更新するようにしました。[#83583](https://github.com/ClickHouse/ClickHouse/pull/83583) ([Antonio Andelic](https://github.com/antonio2368))。
- Keeperのchangelogへの順序不整合な書き込みを修正しました。以前は、changelogへの処理中の書き込みが存在する可能性がありましたが、ロールバックによって宛先ファイルの同時変更が発生する可能性がありました。これにより、ログの不整合やデータ損失の可能性がありました。[#84434](https://github.com/ClickHouse/ClickHouse/pull/84434) ([Antonio Andelic](https://github.com/antonio2368))。
- rocksdbストレージを使用するkeeperのメモリリークを修正しました(イテレータが破棄されていませんでした)。[#84523](https://github.com/ClickHouse/ClickHouse/pull/84523) ([Azat Khuzhin](https://github.com/azat))。
- Keeperの設定`rotate_log_storage_interval = 0`がClickHouseをクラッシュさせる問題を修正しました。(issue [#83975](https://github.com/ClickHouse/ClickHouse/issues/83975))。[#84637](https://github.com/ClickHouse/ClickHouse/pull/84637) ([George Larionov](https://github.com/george-larionov))。
- Keeperが返す総ウォッチ数を修正しました。[#84890](https://github.com/ClickHouse/ClickHouse/pull/84890) ([Antonio Andelic](https://github.com/antonio2368))。
- RefreshTaskで'view'からzookeeperを取得する際に'mutex'をロックするようにしました。[#84699](https://github.com/ClickHouse/ClickHouse/pull/84699) ([Tuan Pham Anh](https://github.com/tuanpach))。

### インデックスの修正 {#indexing-fixes}

- 選択肢と非リテラルの最初の選択肢を含む正規表現を使用したtoken/ngramインデックスでのフィルタリングにおいて、過剰なグラニュールスキップを修正しました。[#79373](https://github.com/ClickHouse/ClickHouse/pull/79373) ([Eduard Karacharov](https://github.com/korowa))。
- 設定`use_skip_indexes_if_final_exact_mode`の実装(25.6で導入)が、`MergeTree`エンジンの設定やデータ分布によって関連する候補範囲の選択に失敗する可能性がありました。この問題は解決されました。[#82667](https://github.com/ClickHouse/ClickHouse/pull/82667) ([Shankar Iyer](https://github.com/shankar-iyer))。
- 設定`use_skip_indexes_if_final_exact_mode`の最適化(25.6で導入)が、`MergeTree`エンジンの設定やデータ分布によって関連する候補範囲の選択に失敗する可能性がありました。この問題は解決されました。[#82879](https://github.com/ClickHouse/ClickHouse/pull/82879) ([Shankar Iyer](https://github.com/shankar-iyer))。
- 以前は、`set`インデックスがグラニュールがフィルタを通過したかどうかをチェックする際に`Nullable`カラムを考慮していませんでした(issue [#75485](https://github.com/ClickHouse/ClickHouse/issues/75485))。[#84305](https://github.com/ClickHouse/ClickHouse/pull/84305) ([Elmi Ahmadov](https://github.com/ahmadov))。
- `MinMax`インデックスの評価中に、nan値との比較が正しい範囲を使用していませんでした。[#84386](https://github.com/ClickHouse/ClickHouse/pull/84386) ([Elmi Ahmadov](https://github.com/ahmadov))。
- `ngram`および`no_op`トークナイザーが、空の入力トークンに対して(実験的な)テキストインデックスをクラッシュさせなくなりました。[#84849](https://github.com/ClickHouse/ClickHouse/pull/84849) ([Robert Schulze](https://github.com/rschu1ze))。

### マテリアライズドビューの修正 {#materialized-view-fixes}


- マテリアライズドビューがINSERTクエリを見逃す原因となるテーブル依存関係のバグを修正しました。[#82222](https://github.com/ClickHouse/ClickHouse/pull/82222) ([Nikolay Degterinsky](https://github.com/evillique))。
- https://github.com/ClickHouse/ClickHouse/pull/79963 以降、マテリアライズドビューでのサブカラムの使用が破損し、ユーザーが `Not found column X in block` というエラーを受け取る可能性がありました。この動作を修正しました。これにより以下が修正されます: [#82784](https://github.com/ClickHouse/ClickHouse/issues/82784)。[#83221](https://github.com/ClickHouse/ClickHouse/pull/83221) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- 型が異なる場合のマテリアライズドビューにおけるillegal_type_of_argumentを修正しました。[#85135](https://github.com/ClickHouse/ClickHouse/pull/85135) ([Sema Checherinda](https://github.com/CheSema))。

### Azureおよびクラウドストレージの修正 {#azure-and-cloud-storage-fixes}

- AzureBlobStorageにおいて、ネイティブコピーでは認証方法を比較しますが、その際に例外が発生した場合、読み取りとコピー(つまり非ネイティブコピー)にフォールバックするようにコードを更新しました。[#82693](https://github.com/ClickHouse/ClickHouse/pull/82693) ([Smita Kulkarni](https://github.com/SmitaRKulkarni))。
- `AzureIteratorAsync`における二重解放を修正しました。[#85064](https://github.com/ClickHouse/ClickHouse/pull/85064) ([Nikita Taranov](https://github.com/nickitat))。

### クラッシュと安定性の修正 {#crash-and-stability-fixes}

- user_idが空の場合があるため、セッション終了時のログ記録における潜在的なクラッシュを修正しました。[#82513](https://github.com/ClickHouse/ClickHouse/pull/82513) ([Bharat Nallan](https://github.com/bharatnc))。
- 不正な`INSERT`後に接続が切断状態のまま残ることによるクライアントのクラッシュを修正しました。[#83253](https://github.com/ClickHouse/ClickHouse/pull/83253) ([Azat Khuzhin](https://github.com/azat))。
- 空のカラムを持つブロックのサイズを計算する際のクラッシュを修正しました。[#83271](https://github.com/ClickHouse/ClickHouse/pull/83271) ([Raúl Marín](https://github.com/Algunenano))。
- CPUスケジューリングが有効な状態で負荷がかかっている際に、'max_threads=1'設定のクエリで発生する可能性のあるクラッシュを修正しました。[#83387](https://github.com/ClickHouse/ClickHouse/pull/83387) ([Fan Ziqi](https://github.com/f2quantum))。
- `zoutofmemory`をハードウェアエラーとして扱うようにしました。そうしないと論理エラーがスローされます。https://github.com/clickhouse/clickhouse-core-incidents/issues/877 を参照してください。[#84420](https://github.com/ClickHouse/ClickHouse/pull/84420) ([Han Fei](https://github.com/hanfei1991))。
- `BackgroundSchedulePool`のシャットダウン中に発生する可能性のある中断(タスクからのスレッド結合による)およびハング(ユニットテストにおける)を修正しました。[#83769](https://github.com/ClickHouse/ClickHouse/pull/83769) ([Azat Khuzhin](https://github.com/azat))。
- バックグラウンドキャンセルチェッカースレッドによって引き起こされるデッドロックを修正しました。[#84203](https://github.com/ClickHouse/ClickHouse/pull/84203) ([Antonio Andelic](https://github.com/antonio2368))。
- ライブラリブリッジのクリーンアップ中の再帰的なコンテキストロックによるシャットダウン時のデッドロックを修正しました。[#83824](https://github.com/ClickHouse/ClickHouse/pull/83824) ([Azat Khuzhin](https://github.com/azat))。
- 不正な`INSERT`後に接続が切断状態のまま残ることによるクライアントのクラッシュを修正しました。[#83842](https://github.com/ClickHouse/ClickHouse/pull/83842) ([Azat Khuzhin](https://github.com/azat))。
- 文字列のデシリアライゼーション中に`MEMORY_LIMIT_EXCEEDED`が発生した場合の未定義動作(クラッシュ)の可能性を修正しました。[#85440](https://github.com/ClickHouse/ClickHouse/pull/85440) ([Azat Khuzhin](https://github.com/azat))。
- `log_comment`または`insert_deduplication_token`設定を変更する非同期挿入における稀なクラッシュを修正しました。[#85540](https://github.com/ClickHouse/ClickHouse/pull/85540) ([Anton Popov](https://github.com/CurtizJ))。

### Glueおよびカタログの修正 {#glue-and-catalog-fixes}


- Glueカタログ統合のバグを修正しました。ClickHouseは、一部のサブカラムにdecimal型を含むネストされたデータ型を持つテーブルを読み取れるようになりました。例:`map<string, decimal(9, 2)>`。修正 [#81301](https://github.com/ClickHouse/ClickHouse/issues/81301)。[#82114](https://github.com/ClickHouse/ClickHouse/pull/82114) ([alesapin](https://github.com/alesapin))。
- ClickHouseは、テーブルタイプが小文字で指定されているGlueカタログのテーブルを読み取れるようになりました。[#84316](https://github.com/ClickHouse/ClickHouse/pull/84316) ([alesapin](https://github.com/alesapin))。
- Unityカタログは、非Deltaテーブルの場合、異常なデータ型を持つスキーマを無視するようになりました。修正 [#85699](https://github.com/ClickHouse/ClickHouse/issues/85699)。[#85950](https://github.com/ClickHouse/ClickHouse/pull/85950) ([alesapin](https://github.com/alesapin))。

### 関数の修正 {#function-fixes}

- 関数`trim{Left,Right,Both}`は、`FixedString(N)`型の入力文字列をサポートするようになりました。例えば、`SELECT trimBoth(toFixedString('abc', 3), 'ac')`が動作するようになりました。[#82691](https://github.com/ClickHouse/ClickHouse/pull/82691) ([Robert Schulze](https://github.com/rschu1ze))。
- 関数`trim`がすべて定数の入力で呼び出された場合、定数の出力文字列を生成するようになりました(バグ [#78796](https://github.com/ClickHouse/ClickHouse/issues/78796))。[#82900](https://github.com/ClickHouse/ClickHouse/pull/82900) ([Robert Schulze](https://github.com/rschu1ze))。
- フォーマッタ`%f`が可変サイズのフォーマッタ(例:`%M`)と一緒に使用された場合の関数`formatDateTime`の誤った出力を修正しました。[#83020](https://github.com/ClickHouse/ClickHouse/pull/83020) ([Robert Schulze](https://github.com/rschu1ze))。
- `CASE`関数における`NULL`引数のバグを修正しました。[#82436](https://github.com/ClickHouse/ClickHouse/pull/82436) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- `lowCardinalityKeys`関数で共有辞書の無関係な部分を使用しないようにしました。[#83118](https://github.com/ClickHouse/ClickHouse/pull/83118) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 定数引数と非定数引数が混在する場合のcolorSRGBToOKLCH/colorOKLCHToSRGBを修正しました。[#83906](https://github.com/ClickHouse/ClickHouse/pull/83906) ([Azat Khuzhin](https://github.com/azat))。
- `array()`関数における空のタプルの誤った構築を修正しました。これにより [#84202](https://github.com/ClickHouse/ClickHouse/issues/84202) が修正されます。[#84297](https://github.com/ClickHouse/ClickHouse/pull/84297) ([Amos Bird](https://github.com/amosbird))。
- Bech32エンコードおよびデコードが誤って動作するバグを修正しました。このバグは、テストに使用されたアルゴリズムのオンライン実装が同じ問題を抱えていたため、当初は検出されませんでした。[#84257](https://github.com/ClickHouse/ClickHouse/pull/84257) ([George Larionov](https://github.com/george-larionov))。

### 分散クエリの修正 {#distributed-query-fixes}


- `LIMIT`を伴う並列分散`INSERT SELECT`が許可されていましたが、これは正しくなく、ターゲットテーブルでデータの重複が発生します。[#84477](https://github.com/ClickHouse/ClickHouse/pull/84477) ([Igor Nikonov](https://github.com/devcrafter))。
- `JOIN`またはサブクエリが存在する場合、テーブル関数をそのクラスタ代替に置き換えないようにしました。[#84335](https://github.com/ClickHouse/ClickHouse/pull/84335) ([Konstantin Bogdanov](https://github.com/thevar1able))。
- クラッシュを回避するため、分散コンテキストで相関サブクエリが使用されているかどうかのチェックを追加しました。修正: [#82205](https://github.com/ClickHouse/ClickHouse/issues/82205)。[#85030](https://github.com/ClickHouse/ClickHouse/pull/85030) ([Dmitry Novik](https://github.com/novikd))。
- `*Cluster`関数のインジケータとして`distributed_depth`を使用することは正しくなく、データの重複が発生する可能性があります。代わりに`client_info.collaborate_with_initiator`を使用します。[#85734](https://github.com/ClickHouse/ClickHouse/pull/85734) ([Konstantin Bogdanov](https://github.com/thevar1able))。
- `Distributed`宛先テーブルを使用する並列分散`INSERT SELECT`において、`WITH`ステートメントからのグローバル定数をサポートしました。以前は、クエリが`Unknown expression identifier`エラーをスローする可能性がありました。[#85811](https://github.com/ClickHouse/ClickHouse/pull/85811) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- `DatabaseReplicated`で`CREATE ... AS (SELECT * FROM s3Cluster(...))`を試みた際の論理エラーを修正しました。[#85904](https://github.com/ClickHouse/ClickHouse/pull/85904) ([Konstantin Bogdanov](https://github.com/thevar1able))。
- Distributedテーブルの`ALTER`時にsharding_keyのチェックを追加しました。以前は、不正な`ALTER`がテーブル定義を破壊し、サーバーの再起動が必要になっていました。[#86015](https://github.com/ClickHouse/ClickHouse/pull/86015) ([Nikolay Degterinsky](https://github.com/evillique))。

### メトリクスと監視の修正 {#metrics-and-monitoring-fixes}

- 非同期メトリクス設定`asynchronous_metrics_update_period_s`および`asynchronous_heavy_metrics_update_period_s`の検証を修正しました。[#82310](https://github.com/ClickHouse/ClickHouse/pull/82310) ([Bharat Nallan](https://github.com/bharatnc))。
- `IndexUncompressedCacheBytes`/`IndexUncompressedCacheCells`/`IndexMarkCacheBytes`/`IndexMarkCacheFiles`メトリクスを修正しました(以前は`Cache`プレフィックスなしのメトリクスに含まれていました)。[#83730](https://github.com/ClickHouse/ClickHouse/pull/83730) ([Azat Khuzhin](https://github.com/azat))。
- QueryMetricLogの`LOGICAL_ERROR`を修正しました: Mutexは`NULL`にできません。[#82979](https://github.com/ClickHouse/ClickHouse/pull/82979) ([Pablo Marcos](https://github.com/pamarcos))。
- 不正なメトリクスKafkaAssignedPartitionsおよびKafkaConsumersWithAssignmentを修正しました。[#85494](https://github.com/ClickHouse/ClickHouse/pull/85494) ([Ilya Golshtein](https://github.com/ilejn))。
- `PREWHERE`(明示的または自動)が使用された場合に処理バイト統計が過小評価される問題を修正しました。[#85495](https://github.com/ClickHouse/ClickHouse/pull/85495) ([Michael Kolupaev](https://github.com/al13n321))。
- バックグラウンドスケジュールプールおよびエグゼキュータからのメモリトラッキングのずれを修正しました。[#84946](https://github.com/ClickHouse/ClickHouse/pull/84946) ([Azat Khuzhin](https://github.com/azat))。

### データ型と変換の修正 {#data-type-and-conversion-fixes}


- Time型の解析時にmsanの問題が発生するケースを修正しました。これにより以下の問題が解決されます: [#82477](https://github.com/ClickHouse/ClickHouse/issues/82477)。[#82514](https://github.com/ClickHouse/ClickHouse/pull/82514) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- `LowCardinality(Float32|Float64|BFloat16)`型におけるNaN値のソートを修正しました。[#83786](https://github.com/ClickHouse/ClickHouse/pull/83786) ([Pervakov Grigorii](https://github.com/GrigoryPervakov))。
- `Date`から`DateTime64`へのキャスト時に大きな値(\>2106-02-07)がオーバーフローする問題を修正しました。[#83982](https://github.com/ClickHouse/ClickHouse/pull/83982) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- 負のTime値をテーブルに暗黙的に読み込む際の問題を修正し、ドキュメントの混乱を解消しました。[#83091](https://github.com/ClickHouse/ClickHouse/pull/83091) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- `DoubleDelta`コーデックは数値型のカラムにのみ適用できるようになりました。特に`FixedString`カラムは`DoubleDelta`を使用して圧縮できなくなりました(修正: [#80220](https://github.com/ClickHouse/ClickHouse/issues/80220))。[#84383](https://github.com/ClickHouse/ClickHouse/pull/84383) ([Jimmy Aguilar Mena](https://github.com/Ergus))。
- JSON数値をDecimal型に変換する際の`JSONExtract`における精度損失を修正しました。数値JSON値は正確な10進数表現を保持し、浮動小数点の丸め誤差を回避するようになりました。[#85665](https://github.com/ClickHouse/ClickHouse/pull/85665) ([ssive7b](https://github.com/ssive7b))。

### メモリとリソース管理 {#memory-and-resource-management}

- `max_untracked_memory`周辺の不正確なメモリ処理を修正しました。[#83607](https://github.com/ClickHouse/ClickHouse/pull/83607) ([Azat Khuzhin](https://github.com/azat))。
- クエリ間で`async_read_counters`を共有しないようにしました。[#83423](https://github.com/ClickHouse/ClickHouse/pull/83423) ([Azat Khuzhin](https://github.com/azat))。
- 一時データストレージとして使用される際に発生する可能性があったファイルキャッシュの初期化エラーを修正しました。[#83539](https://github.com/ClickHouse/ClickHouse/pull/83539) ([Bharat Nallan](https://github.com/bharatnc))。
- `filesystem_prefetches_limit`を常に適用するようにしました(`MergeTreePrefetchedReadPool`からのみではなく)。[#83999](https://github.com/ClickHouse/ClickHouse/pull/83999) ([Azat Khuzhin](https://github.com/azat))。

### 設定に関する修正 {#configuration-and-settings-fixes}


- URI経由で設定を渡す際、最後の値が採用されます。[#82137](https://github.com/ClickHouse/ClickHouse/pull/82137) ([Sema Checherinda](https://github.com/CheSema))。
- クライアントにおけるデータ競合を修正(グローバルコンテキストを使用しないことにより)し、`session_timezone`のオーバーライドを修正しました(以前は`session_timezone`が`users.xml`やクライアントオプションで空でない値に設定され、クエリコンテキストで空に設定された場合、`users.xml`の値が使用されていましたが、これは誤りでした。現在はクエリコンテキストが常にグローバルコンテキストよりも優先されます)。[#82444](https://github.com/ClickHouse/ClickHouse/pull/82444) ([Azat Khuzhin](https://github.com/azat))。
- サーバー操作が停止しないように、`threadpool_writer_pool_size`をゼロに設定することを禁止しました。[#82532](https://github.com/ClickHouse/ClickHouse/pull/82532) ([Bharat Nallan](https://github.com/bharatnc))。
- 設定`role_cache_expiration_time_seconds`の構成における軽微な整数オーバーフローを解決しました(issue [#83374](https://github.com/ClickHouse/ClickHouse/issues/83374))。[#83461](https://github.com/ClickHouse/ClickHouse/pull/83461) ([wushap](https://github.com/wushap))。
- 論理エラーを引き起こす可能性があるため、max_insert_block_sizeにゼロ値を設定することを禁止しました。[#83688](https://github.com/ClickHouse/ClickHouse/pull/83688) ([Bharat Nallan](https://github.com/bharatnc))。
- block_size_bytes=0の場合の`estimateCompressionRatio()`における無限ループを修正しました。[#83704](https://github.com/ClickHouse/ClickHouse/pull/83704) ([Azat Khuzhin](https://github.com/azat))。
- multipartを使用したHTTPの場合、`date_time_input_format`のようなパラメータが無視されていました。[#85570](https://github.com/ClickHouse/ClickHouse/pull/85570) ([Sema Checherinda](https://github.com/CheSema))。

### MongoDBの修正 {#mongodb-fixes}

- 以前は、`MongoDB`テーブルエンジン定義の`host:port`引数にパスコンポーネントを含めることができ、それは暗黙的に無視されていました。MongoDB統合はそのようなテーブルの読み込みを拒否します。この修正により、`MongoDB`エンジンが5つの引数を持つ場合、_そのようなテーブルの読み込みを許可し、パスコンポーネントを無視_し、引数からデータベース名を使用します。_注意:_ この修正は、新しく作成されたテーブルや`mongo`テーブル関数を使用したクエリ、辞書ソース、名前付きコレクションには適用されません。[#81942](https://github.com/ClickHouse/ClickHouse/pull/81942) ([Vladimir Cherkasov](https://github.com/vdimir))。

### その他の修正 {#miscellaneous-fixes}


* 以前のバージョンでは、`/js` へのリクエストに対してサーバーが不要なコンテンツを返していました。この変更により [#61890](https://github.com/ClickHouse/ClickHouse/issues/61890) が解決されました。[#81895](https://github.com/ClickHouse/ClickHouse/pull/81895)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 必要に応じて（例えば名前に `-` のような特殊文字が含まれている場合など）、データベース名とテーブル名にバッククォートを追加するように `InterpreterInsertQuery::extendQueryLogElemImpl` を修正しました。 [#81528](https://github.com/ClickHouse/ClickHouse/pull/81528) ([Ilia Shvyrialkin](https://github.com/Harzu)).
* サジェスションスレッドとメインクライアントスレッドの間で発生し得るデータ競合を修正。 [#82233](https://github.com/ClickHouse/ClickHouse/pull/82233) ([Azat Khuzhin](https://github.com/azat)).
* union/intersect/except&#95;default&#95;mode の書き換え処理における例外安全性を修正。[#82664](https://github.com/ClickHouse/ClickHouse/issues/82664) をクローズ。[#82820](https://github.com/ClickHouse/ClickHouse/pull/82820)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* キャッシュ機能を持たない Database 実装を使用している場合、対応するテーブルのメタデータは、カラムが返されて参照が無効になった後に削除されます。 [#82939](https://github.com/ClickHouse/ClickHouse/pull/82939) ([buyval01](https://github.com/buyval01)).
* JSONEachRowWithProgress での onprogress 呼び出しが、ファイナライゼーションと同期されるようになりました。 [#83879](https://github.com/ClickHouse/ClickHouse/pull/83879) ([Sema Checherinda](https://github.com/CheSema)).
* `MATERIALIZE COLUMN` クエリにより `checksums.txt` に想定外のファイルが記録され、最終的にデータパーツが detached 状態になる可能性があるまれなバグを修正。[#84007](https://github.com/ClickHouse/ClickHouse/pull/84007) ([alesapin](https://github.com/alesapin))。
* パーツの定期的なリフレッシュ処理での例外処理を適切に行うようにしました。 [#84083](https://github.com/ClickHouse/ClickHouse/pull/84083) ([Azat Khuzhin](https://github.com/azat)).
* クエリ内での boolean リテラルと整数リテラル間のカラム名の競合を防ぐため、boolean リテラルのカラム名生成で &quot;1&quot;/&quot;0&quot; ではなく &quot;true&quot;/&quot;false&quot; を使用するように修正しました。 [#84945](https://github.com/ClickHouse/ClickHouse/pull/84945) ([xiaohuanlin](https://github.com/xiaohuanlin)).
* Merge テーブルエンジンにおけるソートの不正確さを招く可能性のある問題を修正しました。 [#85025](https://github.com/ClickHouse/ClickHouse/pull/85025) ([Xiaozhe Yu](https://github.com/wudidapaopao)).
* DiskEncrypted 向けに不足していた API を実装。 [#85028](https://github.com/ClickHouse/ClickHouse/pull/85028) ([Azat Khuzhin](https://github.com/azat)).
* 名前の衝突が発生する場合に、新しいアナライザーが `WITH` 句内で外側のエイリアスを参照できるようにする後方互換性のための設定を導入しました。 [#82700](https://github.com/ClickHouse/ClickHouse/issues/82700) を修正します。 [#83797](https://github.com/ClickHouse/ClickHouse/pull/83797)（[Dmitry Novik](https://github.com/novikd)）。
* analyzer を有効化している場合に、`remote` テーブル関数の `view(...)` 引数内で任意のテーブルを参照できるようにしました。[#78717](https://github.com/ClickHouse/ClickHouse/issues/78717) を修正しました。[#79377](https://github.com/ClickHouse/ClickHouse/issues/79377) を修正しました。[#83844](https://github.com/ClickHouse/ClickHouse/pull/83844)（[Dmitry Novik](https://github.com/novikd)）。
* `plain_rewritable`/`plain` メタデータタイプに対する append 方式での書き込みを修正しました。これらは MergeTree の実験的トランザクションで使用されていますが、以前は単に無視されていました。[#83695](https://github.com/ClickHouse/ClickHouse/pull/83695) ([Tuan Pham Anh](https://github.com/tuanpach))。
* `IAccessStorage` におけるロガーの使用方法を修正。[#84365](https://github.com/ClickHouse/ClickHouse/pull/84365)（[Konstantin Bogdanov](https://github.com/thevar1able)）。
* データレイクでの仮想カラムを用いたファイルプルーニングを修正。 [#84520](https://github.com/ClickHouse/ClickHouse/pull/84520) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 遅延しているリモートソースをクエリした際にベクターの範囲外アクセスが発生する可能性があった問題を修正。 [#84820](https://github.com/ClickHouse/ClickHouse/pull/84820) ([George Larionov](https://github.com/george-larionov)).
* オブジェクトキューエンジンで、すべての設定がテーブルメタデータに正しく保存されるように修正。[#84860](https://github.com/ClickHouse/ClickHouse/pull/84860) ([Antonio Andelic](https://github.com/antonio2368)).
* 遅延カラムを外部ソートと併用した場合に発生する `CORRUPTED_DATA` エラーを修正しました。 [#84738](https://github.com/ClickHouse/ClickHouse/pull/84738) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* `SYSTEM DROP REPLICA` クエリの実行中に不要な `getStatus()` 呼び出しを削除しました。バックグラウンドでテーブルがドロップされている際に `Shutdown for storage is called` 例外がスローされる問題を修正しました。[#85220](https://github.com/ClickHouse/ClickHouse/pull/85220) ([Nikolay Degterinsky](https://github.com/evillique))。
* `CREATE OR REPLACE` および `RENAME` クエリに、不足していたテーブル名の長さチェックを追加しました。 [#85326](https://github.com/ClickHouse/ClickHouse/pull/85326) ([Michael Kolupaev](https://github.com/al13n321)).
* JSON に対する `ALTER UPDATE` 実行時に発生していたクラッシュおよびデータ破損を修正しました。 [#85383](https://github.com/ClickHouse/ClickHouse/pull/85383) ([Pavel Kruglov](https://github.com/Avogar)).
* 長い文字列を扱う際に発生していた CoalescingMergeTree のセグメンテーションフォールトを修正しました。これにより [#84582](https://github.com/ClickHouse/ClickHouse/issues/84582) が解決されました。[#85709](https://github.com/ClickHouse/ClickHouse/pull/85709)（[scanhex12](https://github.com/scanhex12)）。
* 非同期ロギングのリファクタリング後に send&#95;logs&#95;source&#95;regexp を修正。 [#85105](https://github.com/ClickHouse/ClickHouse/issues/85105)、[#85797](https://github.com/ClickHouse/ClickHouse/pull/85797)（[Azat Khuzhin](https://github.com/azat)）。
* `MEMORY_LIMIT_EXCEEDED` エラー時に、update&#95;field を持つディクショナリで発生しうる不整合を修正しました。 [#85807](https://github.com/ClickHouse/ClickHouse/pull/85807) ([Azat Khuzhin](https://github.com/azat)).
* `url()` テーブル関数が発行する HTTP リクエストについて、標準以外のポートにアクセスする際に Host ヘッダーにポート番号が正しく含まれるように修正しました。これにより、開発環境で一般的な、カスタムポートで稼働する MinIO などの S3 互換サービスに対して署名付き URL を使用する場合の認証エラーが解消されます。(Fixes [#85898](https://github.com/ClickHouse/ClickHouse/issues/85898))。 [#85921](https://github.com/ClickHouse/ClickHouse/pull/85921) ([Tom Quist](https://github.com/tomquist)).
