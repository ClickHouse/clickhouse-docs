---
slug: /changelogs/24.10
title: 'v24.10 Cloud 向け変更履歴'
description: 'v24.10 クイックリリース版の変更履歴'
keywords: ['changelog', 'cloud']
sidebar_label: '24.10'
sidebar_position: 5
doc_type: 'changelog'
---

v24.10 リリースに基づく ClickHouse Cloud サービス向けの主な変更点。



## 後方互換性のない変更 {#backward-incompatible-change}

- サブクエリが括弧内にある場合、`UNION`を使用したクエリチェーンにおいて`FORMAT`の前に`SETTINGS`を記述できるようになりました。これにより[#39712](https://github.com/ClickHouse/ClickHouse/issues/39712)が解決されます。クエリにSETTINGS句が連続して2回指定されている場合の動作が変更されました。最も近いSETTINGS句が対応するサブクエリに対して優先されます。以前のバージョンでは、最も外側のSETTINGS句が内側のものよりも優先される可能性がありました。[#60197](https://github.com/ClickHouse/ClickHouse/pull/60197)[#68614](https://github.com/ClickHouse/ClickHouse/pull/68614) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- Dynamic型を再実装しました。動的データ型の上限に達した場合、新しい型はStringにキャストされず、バイナリエンコードされたデータ型を持つ特別なデータ構造にバイナリ形式で格納されます。これにより、Dynamic列に挿入されたすべての型をサブカラムとして読み取ることができるようになりました。[#68132](https://github.com/ClickHouse/ClickHouse/pull/68132) ([Pavel Kruglov](https://github.com/Avogar))。
- 名前付きタプルに対して`a[b].c`のような式がサポートされ、任意の式からの名前付き添字(例:`expr().name`)も使用できるようになりました。これはJSON処理に有用です。これにより[#54965](https://github.com/ClickHouse/ClickHouse/issues/54965)が解決されます。以前のバージョンでは、`expr().name`形式の式は`tupleElement(expr(), name)`として解析され、クエリアナライザは対応するタプル要素ではなく`name`という列を検索していました。新しいバージョンでは、これが`tupleElement(expr(), 'name')`に変更されました。ほとんどの場合、以前のバージョンは機能していませんでしたが、この変更が非互換性につながる可能性のある非常に特殊なシナリオを想定することは可能です。タプル要素の名前を、タプル要素の名前とは異なる名前の列またはエイリアスに格納していた場合です:`SELECT 'b' AS a, CAST([tuple(123)] AS 'Array(Tuple(b UInt8))') AS t, t[1].a`。このようなクエリを使用していた可能性は非常に低いですが、この変更を潜在的に後方互換性がないものとしてマークする必要があります。[#68435](https://github.com/ClickHouse/ClickHouse/pull/68435) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 設定`print_pretty_type_names`が有効な場合、`SHOW CREATE TABLE`ステートメント、`formatQuery`関数、および`clickhouse-client`と`clickhouse-local`の対話モードにおいて、`Tuple`データ型が整形された形式で出力されます。以前のバージョンでは、この設定は`DESCRIBE`クエリと`toTypeName`にのみ適用されていました。これにより[#65753](https://github.com/ClickHouse/ClickHouse/issues/65753)が解決されます。[#68492](https://github.com/ClickHouse/ClickHouse/pull/68492) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `[PRE]WHERE`句のフィルタ条件の並べ替えがデフォルトで許可されるようになりました。`allow_reorder_prewhere_conditions`を`false`に設定することで無効にできます。[#70657](https://github.com/ClickHouse/ClickHouse/pull/70657) ([Nikita Taranov](https://github.com/nickitat))。
- `optimize_functions_to_subcolumns`最適化を修正しました(以前は`Invalid column type for ColumnUnique::insertRangeFrom. Expected String, got LowCardinality(String)`エラーが発生する可能性がありました)。`mapKeys`/`mapValues`において`LowCardinality`型を保持することで対応しています。[#70716](https://github.com/ClickHouse/ClickHouse/pull/70716) ([Azat Khuzhin](https://github.com/azat))。


## 新機能 {#new-feature}

- リフレッシュ可能なマテリアライズドビューがプロダクション対応になりました。[#70550](https://github.com/ClickHouse/ClickHouse/pull/70550) ([Michael Kolupaev](https://github.com/al13n321))。リフレッシュ可能なマテリアライズドビューがレプリケートデータベースでサポートされるようになりました。[#60669](https://github.com/ClickHouse/ClickHouse/pull/60669) ([Michael Kolupaev](https://github.com/al13n321))。
- 関数`toStartOfInterval()`に、TimescaleDBの`time_bucket()`関数、およびPostgreSQLの`date_bin()`関数をエミュレートする新しいオーバーロードが追加されました。([#55619](https://github.com/ClickHouse/ClickHouse/issues/55619))。これにより、日付またはタイムスタンプ値を、_固定_起点である0000-01-01 00:00:00.000ではなく、_任意_の起点から指定された間隔の倍数に揃えることができます。例えば、`SELECT toStartOfInterval(toDateTime('2023-01-01 14:45:00'), INTERVAL 1 MINUTE, toDateTime('2023-01-01 14:35:30'));`は`2023-01-01 14:44:30`を返します。これは起点`2023-01-01 14:35:30`から始まる1分間隔の倍数です。[#56738](https://github.com/ClickHouse/ClickHouse/pull/56738) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- MongoDB統合がリファクタリングされました:非推奨のPoco::MongoDBから新しいドライバmongocxxへの移行、非推奨の旧プロトコルのサポート削除、URIによる接続のサポート、すべてのMongoDBタイプのサポート、MongoDB側でのWHEREおよびORDER BY文のサポート、MongoDBでサポートされていない式の制限。[#63279](https://github.com/ClickHouse/ClickHouse/pull/63279) ([Kirill Nikiforov](https://github.com/allmazz))。
- clickhouse-clientに新しい`--progress-table`オプションが追加され、クエリ実行中に変化するメトリクスを含むテーブルを出力します。新しい`--enable-progress-table-toggle`は`--progress-table`オプションに関連付けられており、制御キー(スペース)を押すことで進捗テーブルの表示を切り替えます。[#63689](https://github.com/ClickHouse/ClickHouse/pull/63689) ([Maria Khristenko](https://github.com/mariaKhr))。
- ワイルドカードプレフィックスへのアクセス権限を付与できるようになりました。`GRANT SELECT ON db.table_pefix_* TO user`。[#65311](https://github.com/ClickHouse/ClickHouse/pull/65311) ([pufit](https://github.com/pufit))。
- JSONCompactWithProgress形式が導入され、ClickHouseが各行をメタデータ、データ、進捗、合計、統計を含む改行区切りのJSONオブジェクトとして出力します。[#66205](https://github.com/ClickHouse/ClickHouse/pull/66205) ([Alexey Korepanov](https://github.com/alexkorep))。
- system.query_metric_logが追加され、個々のクエリに対するsystem.eventsテーブルからのメモリおよびメトリクス値の履歴が含まれ、定期的にディスクにフラッシュされます。[#66532](https://github.com/ClickHouse/ClickHouse/pull/66532) ([Pablo Marcos](https://github.com/pamarcos))。
- `input_format_json_empty_as_default`設定が追加され、有効にすると、JSON入力の空フィールドをデフォルト値として扱います。[#59339](https://github.com/ClickHouse/ClickHouse/issues/59339)をクローズします。[#66782](https://github.com/ClickHouse/ClickHouse/pull/66782) ([Alexis Arnaud](https://github.com/a-a-f))。
- 文字列の一部を別の文字列で置き換える関数`overlay`および`overlayUTF8`が追加されました。例:`SELECT overlay('Hello New York', 'Jersey', 11)`は`Hello New Jersey`を返します。[#66933](https://github.com/ClickHouse/ClickHouse/pull/66933) ([李扬](https://github.com/taiyang-li))。
- 新しいコマンド、パーティション内軽量削除が追加されました。`DELETE FROM [db.]table [ON CLUSTER cluster] [IN PARTITION partition_expr] WHERE expr;` ``` VM-114-29-tos :) select \* from ads_app_poster_ip_source_channel_di_replicated_local;。[#67805](https://github.com/ClickHouse/ClickHouse/pull/67805) ([sunny](https://github.com/sunny19930321))。
- `Interval`データ型値の比較が実装され、最小の上位型に変換されるようになりました。[#68057](https://github.com/ClickHouse/ClickHouse/pull/68057) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- CREATE文でIF NOT EXISTS動作をデフォルトにするcreate_if_not_exists設定が追加されました。[#68164](https://github.com/ClickHouse/ClickHouse/pull/68164) ([Peter Nguyen](https://github.com/petern48))。
- AzureおよびローカルでIcebergテーブルを読み取ることが可能になりました。[#68210](https://github.com/ClickHouse/ClickHouse/pull/68210) ([Daniil Ivanik](https://github.com/divanik))。
- JSON列型コンテンツのより良いイントロスペクションのために、集約関数distinctDynamicTypes/distinctJSONPaths/distinctJSONPathsAndTypesが追加されました。[#68463](https://github.com/ClickHouse/ClickHouse/pull/68463) ([Pavel Kruglov](https://github.com/Avogar))。
- クエリキャッシュエントリをタグで削除できるようになりました。例えば、`SELECT 1 SETTINGS use_query_cache = true, query_cache_tag = 'abc'`で作成されたクエリキャッシュエントリは、`SYSTEM DROP QUERY CACHE TAG 'abc'`で削除できます(もちろん、`SYSTEM DROP QUERY CACHE`でクエリキャッシュ全体をクリアすることもできます)。[#68477](https://github.com/ClickHouse/ClickHouse/pull/68477) ([Michał Tabaszewski](https://github.com/pinsvin00))。
- 単純なSELECTクエリを暗黙的なSELECTで記述して、計算機スタイルの式を有効にできます。例:`ch "1 + 2"`。これは新しい設定`implicit_select`で制御されます。[#68502](https://github.com/ClickHouse/ClickHouse/pull/68502) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- clickhouse localで形式変換のショートカットとして--copyモードをサポートします[#68503](https://github.com/ClickHouse/ClickHouse/issues/68503)。[#68583](https://github.com/ClickHouse/ClickHouse/pull/68583) ([Denis Hananein](https://github.com/denis-hananein))。
- 文字列のRIPEMD-160暗号化ハッシュを計算する`ripeMD160`関数が追加されました。例:`SELECT hex(ripeMD160('The quick brown fox jumps over the lazy dog'))`は`37F332F68DB77BD9D7EDD4969571AD671CF9DD3B`を返します。[#68639](https://github.com/ClickHouse/ClickHouse/pull/68639) ([Dergousov Maxim](https://github.com/m7kss1))。
- urlテーブルエンジンに仮想列\_headersが追加されました。[#65026](https://github.com/ClickHouse/ClickHouse/issues/65026)をクローズします。[#68867](https://github.com/ClickHouse/ClickHouse/pull/68867) ([flynn](https://github.com/ucasfl))。
- 利用可能なプロジェクションを追跡するために`system.projections`テーブルが追加されました。[#68901](https://github.com/ClickHouse/ClickHouse/pull/68901) ([Jordi Villar](https://github.com/jrdi))。
- `arrayUnion`関数のサポートが追加されました。[#68989](https://github.com/ClickHouse/ClickHouse/pull/68989) ([Peter Nguyen](https://github.com/petern48))。
- spark互換性(arrays_zip)のために新しい関数`arrayZipUnaligned`が追加され、元の`arrayZip`に基づいて整列していない配列を許可します。``` sql SELECT arrayZipUnaligned([1], [1, 2, 3])。[#69030](https://github.com/ClickHouse/ClickHouse/pull/69030) ([李扬](https://github.com/taiyang-li))。
- quantileExactWeightedに基づく補間バージョンである集約関数`quantileExactWeightedInterpolated`をサポートします。既に`quantileExactInterpolatedWeighted`があるのに、なぜ新しい`quantileExactWeightedInterpolated`が必要なのか疑問に思う人もいるかもしれません。理由は、新しいものの方が古いものよりも正確だからです。ちなみに、これはApache Glutenでのspark互換性のためです。[#69619](https://github.com/ClickHouse/ClickHouse/pull/69619) ([李扬](https://github.com/taiyang-li))。
- 関数arrayElementOrNullをサポートします。配列インデックスが範囲外の場合、またはマップキーが見つからない場合にnullを返します。[#69646](https://github.com/ClickHouse/ClickHouse/pull/69646) ([李扬](https://github.com/taiyang-li))。
- Dynamic内部の内部型で実行することにより、ほとんどの関数でDynamic型をサポートします。[#69691](https://github.com/ClickHouse/ClickHouse/pull/69691) ([Pavel Kruglov](https://github.com/Avogar))。
- 関数`arrayAUC`に引数`scale`(デフォルト:`true`)が追加され、正規化ステップをスキップできるようになりました(issue [#69609](https://github.com/ClickHouse/ClickHouse/issues/69609))。[#69717](https://github.com/ClickHouse/ClickHouse/pull/69717) ([gabrielmcg44](https://github.com/gabrielmcg44))。
- 文字列のRIPEMD-160暗号化ハッシュを計算する`RIPEMD160`関数が再追加されました。例:`SELECT HEX(RIPEMD160('The quick brown fox jumps over the lazy dog'))`は`37F332F68DB77BD9D7EDD4969571AD671CF9DD3B`を返します。[#70087](https://github.com/ClickHouse/ClickHouse/pull/70087) ([Dergousov Maxim](https://github.com/m7kss1))。
- ETag + ファイルパスからのハッシュをキャッシュキーとして使用して、オブジェクトストレージテーブルエンジンおよびデータレイクの読み取りファイルをキャッシュできるようになりました。[#70135](https://github.com/ClickHouse/ClickHouse/pull/70135) ([Kseniia Sumarokova](https://github.com/kssenii))。
- HDFS上のIcebergテーブルの読み取りをサポートします。[#70268](https://github.com/ClickHouse/ClickHouse/pull/70268) ([flynn](https://github.com/ucasfl))。
- 設定`input_format_binary_read_json_as_string/output_format_binary_write_json_as_string`の下で、RowBinary形式でJSON型をバイナリ文字列として読み書きできるようになりました。[#70288](https://github.com/ClickHouse/ClickHouse/pull/70288) ([Pavel Kruglov](https://github.com/Avogar))。
- Native形式でJSON列を単一のString列としてシリアライズ/デシリアライズできるようになりました。出力には設定`output_format_native_write_json_as_string`を使用します。入力には、列データの前にシリアライゼーションバージョン`1`を使用します。[#70312](https://github.com/ClickHouse/ClickHouse/pull/70312) ([Pavel Kruglov](https://github.com/Avogar))。
- 標準CTE、`with insert`をサポートします。以前は`insert ... with ...`のみをサポートしていました。[#70593](https://github.com/ClickHouse/ClickHouse/pull/70593) ([Shichao Jin](https://github.com/jsc0218))。
