---
slug: /changelogs/24.5
title: 'v24.5 Cloud 向け変更履歴'
description: 'v24.5 の高速リリース版変更履歴'
keywords: ['changelog', 'cloud']
sidebar_label: '24.5'
sidebar_position: 8
doc_type: 'changelog'
---



# V24.5 Cloud 向け変更履歴

v24.5 リリースに基づく ClickHouse Cloud サービス向けの関連変更点。



## 破壊的変更 {#breaking-changes}

- system.zookeeperテーブルにおいて、期間がマイクロ秒単位の精度であることを反映するため、カラム名をduration_msからduration_microsecondsに変更しました。[#60774](https://github.com/ClickHouse/ClickHouse/pull/60774) (Duc Canh Le)。

- max_parallel_replicasを0に設定することは意味がないため、許可しないようにしました。0に設定すると予期しない論理エラーが発生する可能性があります。Closes #60140。[#61201](https://github.com/ClickHouse/ClickHouse/pull/61201) (Kruglov Pavel)。

- INSERT WATCHクエリ(実験的なLIVE VIEW機能の一部)のサポートを削除しました。[#62382](https://github.com/ClickHouse/ClickHouse/pull/62382) (Alexey Milovidov)。

- neighbor、runningAccumulate、runningDifferenceStartingWithFirstValue、runningDifference関数の使用は非推奨となりました(エラーが発生しやすいため)。代わりに適切なウィンドウ関数を使用してください。これらを再度有効にするには、allow_deprecated_error_prone_window_functions=1を設定してください。[#63132](https://github.com/ClickHouse/ClickHouse/pull/63132) (Nikita Taranov)。


## 後方互換性のない変更 {#backward-incompatible-changes}

- 新しいClickHouseバージョンでは、すべての引数がFloat64の場合、geoDistance、greatCircleDistance、greatCircleAngle関数は内部計算と戻り値の型に64ビット倍精度浮動小数点データ型を使用します。これにより#58476が解決されます。以前のバージョンでは、これらの関数は常にFloat32を使用していました。geo_distance_returns_float64_on_float64_argumentsをfalseに設定するか、compatibilityを24.2以前に設定することで、以前の動作に戻すことができます。[#61848](https://github.com/ClickHouse/ClickHouse/pull/61848) (Alexey Milovidov)。

- 列数が多い場合でも、多くのデータベースやテーブルにSHOW TABLESが許可されていない場合、system.columnsからのクエリはより高速に動作します。以前のバージョンでは、対応するテーブルにSHOW TABLESを許可せずに個別の列にSHOW COLUMNSを許可した場合、system.columnsテーブルはこれらの列を表示していましたが、新しいバージョンではテーブル全体をスキップします。クエリを遅くしていたトレースログメッセージ「Access granted」と「Access denied」を削除しました。[#63439](https://github.com/ClickHouse/ClickHouse/pull/63439) (Alexey Milovidov)。

- largestTriangleThreeBucketsのクラッシュを修正しました。これによりこの関数の動作が変更され、提供された系列内のNaNを無視するようになります。そのため、結果セットは以前のバージョンと異なる場合があります。[#62646](https://github.com/ClickHouse/ClickHouse/pull/62646) (Raúl Marín)。


## 新機能 {#new-features}

- 新しいアナライザーが新規サービスでデフォルトで有効になりました。

- `drop table a,b,c;` のように複数のテーブルを同時に削除できるようになりました。[#58705](https://github.com/ClickHouse/ClickHouse/pull/58705) (zhongyuankai)。

- 設定 `input_format_tsv_crlf_end_of_line` を使用して、TSV形式でCRLFを解析できるようになりました。Closes #56257。[#59747](https://github.com/ClickHouse/ClickHouse/pull/59747) (Shaun Struwig)。

- テーブルエンジンに対する権限付与が可能になりました。既存ユーザーの動作には影響しません。[#60117](https://github.com/ClickHouse/ClickHouse/pull/60117) (jsc0218)。

- `application/x-www-form-urlencoded` 形式で単一レコードを読み書きするためのFormフォーマットが追加されました。[#60199](https://github.com/ClickHouse/ClickHouse/pull/60199) (Shaun Struwig)。

- CROSS JOINで圧縮が可能になりました。[#60459](https://github.com/ClickHouse/ClickHouse/pull/60459) (p1rattttt)。

- 省略されたフィールドに対してNULL値を強制する新しい設定 `input_format_force_null_for_omitted_fields` が追加されました。[#60887](https://github.com/ClickHouse/ClickHouse/pull/60887) (Constantine Peresypkin)。

- 左右両方のテーブルの列を含む不等条件でのJOINをサポートしました。例: `t1.y < t2.y`。有効にするには、`SET allow_experimental_join_condition = 1` を実行してください。[#60920](https://github.com/ClickHouse/ClickHouse/pull/60920) (lgbo)。

- 新しい関数 `getClientHTTPHeader` が追加されました。Closes #54665。Co-authored with @lingtaolf。[#61820](https://github.com/ClickHouse/ClickHouse/pull/61820) (Alexey Milovidov)。

- 利便性のため、`SELECT * FROM numbers()` が `SELECT * FROM system.numbers` と同様に制限なしで動作するようになりました。[#61969](https://github.com/ClickHouse/ClickHouse/pull/61969) (YenchangChan)。

- `ALTER MODIFY SETTING` を使用したメモリテーブル設定の変更がサポートされました。例: `ALTER TABLE memory MODIFY SETTING min_rows_to_keep = 100, max_rows_to_keep = 1000;`。[#62039](https://github.com/ClickHouse/ClickHouse/pull/62039) (zhongyuankai)。

- アナライザーが再帰的CTEをサポートしました。[#62074](https://github.com/ClickHouse/ClickHouse/pull/62074) (Maksim Kita)。

- 以前はS3ストレージとS3テーブル関数がアーカイブファイルからの選択をサポートしていませんでした。S3内のアーカイブ内のファイルを反復処理できるソリューションが実装されました。[#62259](https://github.com/ClickHouse/ClickHouse/pull/62259) (Daniil Ivanik)。

- 条件関数 `clamp` のサポートが追加されました。[#62377](https://github.com/ClickHouse/ClickHouse/pull/62377) (skyoct)。

- npy出力フォーマットが追加されました。[#62430](https://github.com/ClickHouse/ClickHouse/pull/62430) (豪肥肥)。

- アナライザーがQUALIFY句をサポートしました。Closes #47819。[#62619](https://github.com/ClickHouse/ClickHouse/pull/62619) (Maksim Kita)。

- HTTPインターフェースに `role` クエリパラメータが追加されました。これは `SET ROLE x` と同様に動作し、ステートメント実行前にロールを適用します。これにより、複数のステートメントが許可されておらず、`SET ROLE x` とステートメント自体を同時に送信できないというHTTPインターフェースの制限を克服できます。`?role=x&role=y` のように複数のロールを設定することも可能で、これは `SET ROLE x, y` と同等です。[#62669](https://github.com/ClickHouse/ClickHouse/pull/62669) (Serge Klochkov)。

- `SYSTEM UNLOAD PRIMARY KEY` が追加されました。[#62738](https://github.com/ClickHouse/ClickHouse/pull/62738) (Pablo Marcos)。


* バージョン 7 の UUID、すなわちランダム成分を持つタイムスタンプベースの UUID を生成するために、モノトニシティとパフォーマンスのトレードオフが異なる SQL 関数 generateUUIDv7、generateUUIDv7ThreadMonotonic、generateUUIDv7NonMonotonic を追加しました。また、UUID からバイト列を抽出する新しい関数 UUIDToNum と、バージョン 7 の UUID からタイムスタンプ成分を抽出する新しい関数 UUIDv7ToDateTime を追加しました。 [#62852](https://github.com/ClickHouse/ClickHouse/pull/62852) (Alexey Petrunyaka)。

* Raw を TSVRaw の同義語として追加しました。 [#63394](https://github.com/ClickHouse/ClickHouse/pull/63394) (Unalian)。

* サイズが制限を超えた場合に、一時ファイルを用いてクロスジョインを実行できるようにしました。 [#63432](https://github.com/ClickHouse/ClickHouse/pull/63432) (p1rattttt)。



## パフォーマンスの改善 {#performance-improvements}

- INSERT時に新しく作成されたプロジェクションブロックのマージをスキップします。[#59405](https://github.com/ClickHouse/ClickHouse/pull/59405) (Nikita Taranov)。

- SELECT時のミューテーションのオーバーヘッドを削減します(v2)。[#60856](https://github.com/ClickHouse/ClickHouse/pull/60856) (Azat Khuzhin)。

- 等価集合を使用したJOINフィルタプッシュダウンの改善。[#61216](https://github.com/ClickHouse/ClickHouse/pull/61216) (Maksim Kita)。

- 単一値の最適化のための新しいアナライザパスを追加します。[#61564](https://github.com/ClickHouse/ClickHouse/pull/61564) (LiuNeng)。

- 入力文字列がすべてASCII文字の場合、文字列関数XXXUTF8を'asciily'処理します。apache/doris#29799に着想を得ています。全体的に1.07倍から1.62倍の高速化を実現します。一部のケースではピークメモリ使用量が減少していることに注意してください。[#61632](https://github.com/ClickHouse/ClickHouse/pull/61632) (李扬)。

- 高速Parquetエンコーダをデフォルトで有効化しました(output_format_parquet_use_custom_encoder)。[#62088](https://github.com/ClickHouse/ClickHouse/pull/62088) (Michael Kolupaev)。

- 必要なフィールドがすべて読み込まれた時点で残りのフィールドをスキップすることで、JSONEachRowRowInputFormatを改善します。[#62210](https://github.com/ClickHouse/ClickHouse/pull/62210) (lgbo)。

- 関数splitByCharとsplitByRegexpが大幅に高速化されました。[#62392](https://github.com/ClickHouse/ClickHouse/pull/62392) (李扬)。

- file/s3/hdfs/url/...テーブル関数のファイルからの単純なinsert selectを改善します。並列パース時に使用するスレッド数を制御するための個別のmax_parsing_threads設定を追加します。[#62404](https://github.com/ClickHouse/ClickHouse/pull/62404) (Kruglov Pavel)。

- azure_allow_parallel_part_upload設定により管理されるAzureBlobStorageの並列書き込みバッファをサポートします。[#62534](https://github.com/ClickHouse/ClickHouse/pull/62534) (SmitaRKulkarni)。

- 関数to_utc_timestampとfrom_utc_timestampが約2倍高速化されました。[#62583](https://github.com/ClickHouse/ClickHouse/pull/62583) (KevinyhZou)。

- 関数parseDateTimeOrNull、parseDateTimeOrZero、parseDateTimeInJodaSyntaxOrNull、parseDateTimeInJodaSyntaxOrZeroは、入力にパース不可能な値が多く含まれる場合に大幅に高速化されました(10倍から1000倍)。[#62634](https://github.com/ClickHouse/ClickHouse/pull/62634) (LiuNeng)。

- 失敗時にIPごとに1つのレコードのみを保持するようにHostResolverの動作を変更します。[#62652](https://github.com/ClickHouse/ClickHouse/pull/62652) (Anton Ivashkin)。

- メモリ使用量を制御し、多数のカラムがある場合のマージ時のソートを2倍高速化するための新しい設定prefer_merge_sort_block_bytesを追加します。[#62904](https://github.com/ClickHouse/ClickHouse/pull/62904) (LiuNeng)。

- JOIN後のフィルタが常にデフォルト値をフィルタリングする場合、QueryPlanがOUTER JOINをINNER JOINに変換する最適化を行います。この最適化はquery_plan_convert_outer_join_to_inner_join設定で制御でき、デフォルトで有効になっています。[#62907](https://github.com/ClickHouse/ClickHouse/pull/62907) (Maksim Kita)。

- optimize_rewrite_sum_if_to_count_ifをデフォルトで有効化します。[#62929](https://github.com/ClickHouse/ClickHouse/pull/62929) (Raúl Marín)。

- 新しいアナライザのマイクロ最適化。[#63429](https://github.com/ClickHouse/ClickHouse/pull/63429) (Raúl Marín)。

- DateTimeとDateTime64を比較する場合にインデックス解析が機能するようになります。これにより#63441がクローズされます。[#63443](https://github.com/ClickHouse/ClickHouse/pull/63443) (Alexey Milovidov)。

- ガベージを削除することで、set型のインデックスを若干高速化します(約1.5倍)。[#64098](https://github.com/ClickHouse/ClickHouse/pull/64098) (Alexey Milovidov)。


# 改善点

* `optimize_monotonous_functions_in_order_by` 設定を削除しました。今後は no-op になるためです。 [#63004](https://github.com/ClickHouse/ClickHouse/pull/63004) (Raúl Marín)。

* `Map` で、キーとして `Float32`、`Float64`、`Array(T)`、`Map(K,V)`、`Tuple(T1, T2, ...)` を使用できるようになりました。#54537 をクローズ。 [#59318](https://github.com/ClickHouse/ClickHouse/pull/59318) (李扬)。

* S3 と同様に、AzureBlobStorage 向けの非同期 `WriteBuffer` を追加しました。 [#59929](https://github.com/ClickHouse/ClickHouse/pull/59929) (SmitaRKulkarni)。

* 枠線を保持したまま列幅を変更できる複数行文字列をサポートしました。 [#59940](https://github.com/ClickHouse/ClickHouse/pull/59940) (Volodyachan)。

* RabbitMQ が破損したメッセージに対して `nack` を返すようにしました。#45350 をクローズ。 [#60312](https://github.com/ClickHouse/ClickHouse/pull/60312) (Kseniia Sumarokova)。

* 関数 `toStartOfInterval(..., INTERVAL ... WEEK)` が週の最初の曜日をどれとして扱うかに影響する `first_day_of_week` 設定を追加しました。これにより、デフォルトで週の最初の曜日を日曜日とする `toStartOfWeek` 関数との一貫性が保たれます。 [#60598](https://github.com/ClickHouse/ClickHouse/pull/60598) (Jordi Villar)。

* 挿入時に割り当てられた、ブロック内での元の行番号を保存する永続的な仮想列 `_block_offset` を追加しました。列 `_block_offset` の永続化は、`enable_block_offset_column` 設定を有効にすることでオンにできます。パーツの最小ブロック番号またはミューテーションバージョンのいずれかを含む仮想列 `column_part_data_version` を追加しました。永続的な仮想列 `_block_number` は、もはや実験的機能とは見なされません。 [#60676](https://github.com/ClickHouse/ClickHouse/pull/60676) (Anton Popov)。

* 関数 `date_diff` と `age` は、結果をマイクロ秒精度ではなくナノ秒精度で計算するようになりました。また、`unit` パラメータの値として、ナノ秒（`nanosecond` / `nanoseconds` / `ns`）を指定できるようになりました。 [#61409](https://github.com/ClickHouse/ClickHouse/pull/61409) (Austin Kothig)。

* マージ中に、ワイドパーツに対しては `marks` が読み込まれないようになりました。 [#61551](https://github.com/ClickHouse/ClickHouse/pull/61551) (Anton Popov)。

* `output_format_pretty_row_numbers` をデフォルトで有効化しました。ユーザビリティの観点でより優れています。 [#61791](https://github.com/ClickHouse/ClickHouse/pull/61791) (Alexey Milovidov)。

* `system.zeros`、`system.zeros_mt`（`system.numbers` および `system.numbers_mt` ではすでに動作していました）、および `generateRandom` テーブル関数に対する `LIMIT` を含む単純なクエリでも、プログレスバーが動作するようになりました。おまけとして、総レコード数が `max_rows_to_read` 制限を超える場合は、より早いタイミングで例外をスローするようになりました。これにより #58183 がクローズされました。 [#61823](https://github.com/ClickHouse/ClickHouse/pull/61823) (Alexey Milovidov)。

* `TRUNCATE ALL TABLES` を追加しました。 [#61862](https://github.com/ClickHouse/ClickHouse/pull/61862) (豪肥肥)。

* `input_format_json_throw_on_bad_escape_sequence` 設定を追加しました。これを無効にすると、不正なエスケープシーケンスを JSON 入力フォーマット内に保存できるようになります。 [#61889](https://github.com/ClickHouse/ClickHouse/pull/61889) (Kruglov Pavel)。

* 警告メッセージ内の文法を "a" から "the" に修正しました。Atomic エンジンは 1 つしか存在しないため、「to a new Atomic engine」ではなく「to the new Atomic engine」であるべきです。 [#61952](https://github.com/ClickHouse/ClickHouse/pull/61952) (shabroo)。

* クォーラム挿入トランザクションの取り消し時に発生する `logical-error` を修正しました。 [#61953](https://github.com/ClickHouse/ClickHouse/pull/61953) (Han Fei)。

* Apache Arrow スキーマから `Nullable` なカラム型を自動推論するようになりました。 [#61984](https://github.com/ClickHouse/ClickHouse/pull/61984) (Maksim Kita)。

* 集約中に、集約状態の並列マージをキャンセルできるようにしました（例: `uniqExact`）。 [#61992](https://github.com/ClickHouse/ClickHouse/pull/61992) (Maksim Kita)。

* `INVALIDATE_QUERY` を持つ辞書ソースが、起動時に二度再読み込みされないようになりました。 [#62050](https://github.com/ClickHouse/ClickHouse/pull/62050) (vdimir)。



* ReplicatedMergeTree に対する OPTIMIZE FINAL は、現在アクティブなマージが完了するまで待機してから、最終マージのスケジュールを再試行するようになりました。これにより、通常の MergeTree の動作により近づきます。 [#62067](https://github.com/ClickHouse/ClickHouse/pull/62067) (Nikita Taranov).

* Hive のテキストファイルからデータを読み取る際、これまでは Hive テキストファイルの最初の行を使用して入力フィールド数のリサイズを行っていました。このとき、最初の行のフィールド数が Hive テーブルの定義と一致しない場合があります。たとえば Hive テーブルが test_tbl(a Int32, b Int32, c Int32) のように 3 カラムで定義されている一方で、テキストファイルの最初の行に 2 フィールドしかない場合、この状況では入力フィールド数が 2 にリサイズされます。その後の行でテキストファイルに 3 フィールドが存在しても、3 つ目のフィールドは読み取られず、デフォルト値 0 が設定されてしまい、これは正しくありません。 [#62086](https://github.com/ClickHouse/ClickHouse/pull/62086) (KevinyhZou).

* クライアントで入力中のシンタックスハイライトは、（これまでは lexer レベルで動作していましたが）構文レベルで動作するようになりました。 [#62123](https://github.com/ClickHouse/ClickHouse/pull/62123) (Alexey Milovidov).

* プライマリキーを含むブール式の後ろに冗長な = 1 または = 0 が付加された場合に、プライマリインデックスが使用されない問題を修正しました。たとえば、`SELECT * FROM <table> WHERE <primary-key> IN (<value>) = 1` および `SELECT * FROM <table> WHERE <primary-key> NOT IN (<value>) = 0` は、プライマリインデックスを利用できるにもかかわらず、どちらもテーブル全体をスキャンしていました。 [#62142](https://github.com/ClickHouse/ClickHouse/pull/62142) (josh-hildred).

* 設定 lightweight_deletes_sync を追加しました（デフォルト値: 2 - すべてのレプリカが同期的に完了するまで待機）。これは mutations_sync 設定と似ていますが、lightweight delete の動作のみに影響します。 [#62195](https://github.com/ClickHouse/ClickHouse/pull/62195) (Anton Popov).

* カスタム設定の値をパースする際に、boolean と integer を区別するようにしました: SET custom_a = true; SET custom_b = 1;. [#62206](https://github.com/ClickHouse/ClickHouse/pull/62206) (Vitaly Baranov).

* AWS PrivateLink インターフェイスエンドポイント経由での S3 アクセスをサポートしました。#60021、#31074、#53761 をクローズしました。 [#62208](https://github.com/ClickHouse/ClickHouse/pull/62208) (Arthur Passos).

* クライアントはサーバーにヘッダー 'Keep-Alive: timeout=X' を送信する必要があります。クライアントがサーバーからそのヘッダーを含むレスポンスを受信した場合、クライアントはサーバーからの値を使用する必要があります。また、接続クローズ時の競合を避けるために、クライアントは有効期限が近い接続を使用しない方が望ましいです。 [#62249](https://github.com/ClickHouse/ClickHouse/pull/62249) (Sema Checherinda).

* date_trunc にナノ秒、マイクロ秒、ミリ秒の単位を追加しました。 [#62335](https://github.com/ClickHouse/ClickHouse/pull/62335) (Misz606).

* クエリキャッシュは、system テーブル（system.*、information_schema.*、INFORMATION_SCHEMA.*）に対するクエリ結果をキャッシュしないようになりました。 [#62376](https://github.com/ClickHouse/ClickHouse/pull/62376) (Robert Schulze).

* MOVE PARTITION TO TABLE クエリは、パーツ数の上限を超えないようにするため、遅延させるか、TOO_MANY_PARTS 例外をスローする場合があります。INSERT クエリと同じ設定および制限（max_parts_in_total、parts_to_delay_insert、parts_to_throw_insert、inactive_parts_to_throw_insert、inactive_parts_to_delay_insert、max_avg_part_size_for_too_many_parts、min_delay_to_insert_ms、max_delay_to_insert 設定）が適用されます。 [#62420](https://github.com/ClickHouse/ClickHouse/pull/62420) (Sergei Trifonov).

* transform が常に最初にマッチした値を返すようにしました。 [#62518](https://github.com/ClickHouse/ClickHouse/pull/62518) (Raúl Marín).

* RESTORE の実行中にテーブルの DEFAULT 式を評価しないようにしました。 [#62601](https://github.com/ClickHouse/ClickHouse/pull/62601) (Vitaly Baranov).

* HTTP リクエストで、異なる認証スキームを持つ quota key を許可しました。 [#62842](https://github.com/ClickHouse/ClickHouse/pull/62842) (Kseniia Sumarokova).



* user の valid_until に達したらセッションを閉じるようにしました。 [#63046](https://github.com/ClickHouse/ClickHouse/pull/63046) (Konstantin Bogdanov)。
