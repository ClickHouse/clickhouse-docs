---
slug: /changelogs/24.5
title: 'v24.5 ClickHouse Cloud 向けチェンジログ'
description: 'v24.5 の高速リリース版チェンジログ'
keywords: ['changelog', 'cloud']
sidebar_label: '24.5'
sidebar_position: 8
doc_type: 'changelog'
---



# V24.5 Cloud 向け変更履歴

v24.5 リリースに基づく、ClickHouse Cloud サービスに関連する変更点です。



## 破壊的変更 {#breaking-changes}

- system.zookeeperテーブルにおいて、期間がマイクロ秒単位の解像度であることを反映するため、カラム名をduration_msからduration_microsecondsに変更しました。[#60774](https://github.com/ClickHouse/ClickHouse/pull/60774) (Duc Canh Le)。

- max_parallel_replicasを0に設定することは意味がないため、許可しないようにしました。0に設定すると予期しない論理エラーが発生する可能性があります。Closes #60140。[#61201](https://github.com/ClickHouse/ClickHouse/pull/61201) (Kruglov Pavel)。

- INSERT WATCHクエリ(実験的なLIVE VIEW機能の一部)のサポートを削除しました。[#62382](https://github.com/ClickHouse/ClickHouse/pull/62382) (Alexey Milovidov)。

- 関数neighbor、runningAccumulate、runningDifferenceStartingWithFirstValue、runningDifferenceの使用は非推奨となりました(エラーが発生しやすいため)。代わりに適切なウィンドウ関数を使用してください。これらを再度有効にするには、allow_deprecated_error_prone_window_functions=1を設定してください。[#63132](https://github.com/ClickHouse/ClickHouse/pull/63132) (Nikita Taranov)。


## 後方互換性のない変更 {#backward-incompatible-changes}

- 新しいClickHouseバージョンでは、すべての引数がFloat64の場合、geoDistance、greatCircleDistance、greatCircleAngle関数は内部計算と戻り値の型に64ビット倍精度浮動小数点データ型を使用します。これにより#58476が解決されます。以前のバージョンでは、これらの関数は常にFloat32を使用していました。geo_distance_returns_float64_on_float64_argumentsをfalseに設定するか、compatibilityを24.2以前に設定することで、以前の動作に戻すことができます。[#61848](https://github.com/ClickHouse/ClickHouse/pull/61848) (Alexey Milovidov)。

- system.columnsからのクエリは、列数が多い場合でも、多くのデータベースやテーブルにSHOW TABLESが付与されていない場合、より高速に動作します。以前のバージョンでは、対応するテーブルにSHOW TABLESを付与せずに個別の列にSHOW COLUMNSを付与した場合、system.columnsテーブルはこれらの列を表示していましたが、新しいバージョンではテーブル全体をスキップします。クエリを遅延させていたトレースログメッセージ「Access granted」と「Access denied」を削除しました。[#63439](https://github.com/ClickHouse/ClickHouse/pull/63439) (Alexey Milovidov)。

- largestTriangleThreeBucketsのクラッシュを修正しました。これにより、この関数の動作が変更され、提供された系列内のNaNを無視するようになります。そのため、結果セットは以前のバージョンと異なる場合があります。[#62646](https://github.com/ClickHouse/ClickHouse/pull/62646) (Raúl Marín)。


## 新機能 {#new-features}

- 新しいアナライザーは、新規サービスでデフォルトで有効になっています。

- `drop table a,b,c;` のように、複数のテーブルを同時に削除できるようになりました。[#58705](https://github.com/ClickHouse/ClickHouse/pull/58705) (zhongyuankai)。

- `input_format_tsv_crlf_end_of_line` 設定を使用して、TSV形式でCRLFを解析できるようになりました。Closes #56257。[#59747](https://github.com/ClickHouse/ClickHouse/pull/59747) (Shaun Struwig)。

- テーブルエンジンに対する権限付与が可能になりました。既存ユーザーの動作には影響しません。[#60117](https://github.com/ClickHouse/ClickHouse/pull/60117) (jsc0218)。

- `application/x-www-form-urlencoded` 形式で単一レコードを読み書きするためのFormフォーマットを追加しました。[#60199](https://github.com/ClickHouse/ClickHouse/pull/60199) (Shaun Struwig)。

- CROSS JOINでの圧縮が可能になりました。[#60459](https://github.com/ClickHouse/ClickHouse/pull/60459) (p1rattttt)。

- 省略されたフィールドにNULL値を強制する新しい設定 `input_format_force_null_for_omitted_fields` を追加しました。[#60887](https://github.com/ClickHouse/ClickHouse/pull/60887) (Constantine Peresypkin)。

- 左右両方のテーブルの列を含む不等条件での結合をサポートしました。例: `t1.y < t2.y`。有効にするには、`SET allow_experimental_join_condition = 1` を実行してください。[#60920](https://github.com/ClickHouse/ClickHouse/pull/60920) (lgbo)。

- 新しい関数 `getClientHTTPHeader` を追加しました。This closes #54665。Co-authored with @lingtaolf。[#61820](https://github.com/ClickHouse/ClickHouse/pull/61820) (Alexey Milovidov)。

- 利便性のため、`SELECT * FROM numbers()` は `SELECT * FROM system.numbers` と同じように動作します - 制限なしで実行されます。[#61969](https://github.com/ClickHouse/ClickHouse/pull/61969) (YenchangChan)。

- `ALTER MODIFY SETTING` を使用したメモリテーブル設定の変更がサポートされるようになりました。`ALTER TABLE memory MODIFY SETTING min_rows_to_keep = 100, max_rows_to_keep = 1000;`。[#62039](https://github.com/ClickHouse/ClickHouse/pull/62039) (zhongyuankai)。

- アナライザーが再帰的CTEをサポートしました。[#62074](https://github.com/ClickHouse/ClickHouse/pull/62074) (Maksim Kita)。

- 以前は、s3ストレージとs3テーブル関数はアーカイブファイルからの選択をサポートしていませんでした。S3内のアーカイブ内のファイルを反復処理できるソリューションを作成しました。[#62259](https://github.com/ClickHouse/ClickHouse/pull/62259) (Daniil Ivanik)。

- 条件関数 `clamp` のサポートを追加しました。[#62377](https://github.com/ClickHouse/ClickHouse/pull/62377) (skyoct)。

- npy出力フォーマットを追加しました。[#62430](https://github.com/ClickHouse/ClickHouse/pull/62430) (豪肥肥)。

- アナライザーがQUALIFY句をサポートしました。Closes #47819。[#62619](https://github.com/ClickHouse/ClickHouse/pull/62619) (Maksim Kita)。

- HTTPインターフェースに `role` クエリパラメータを追加しました。これは `SET ROLE x` と同様に動作し、ステートメント実行前にロールを適用します。これにより、HTTPインターフェースの制限(複数のステートメントが許可されておらず、`SET ROLE x` とステートメント自体を同時に送信できない)を克服できます。この方法で複数のロールを設定することも可能です。例: `?role=x&role=y` は `SET ROLE x, y` と同等です。[#62669](https://github.com/ClickHouse/ClickHouse/pull/62669) (Serge Klochkov)。

- `SYSTEM UNLOAD PRIMARY KEY` を追加しました。[#62738](https://github.com/ClickHouse/ClickHouse/pull/62738) (Pablo Marcos)。


* バージョン 7 UUID（タイムスタンプベースでランダム成分を持つ UUID、いわゆる timestamp-based UUID）を生成するための SQL 関数 `generateUUIDv7`、`generateUUIDv7ThreadMonotonic`、`generateUUIDv7NonMonotonic`（単調性とパフォーマンスに関する異なるトレードオフを提供）を追加しました。さらに、UUID からバイト列を抽出する新しい関数 `UUIDToNum` と、バージョン 7 UUID からタイムスタンプ部分を抽出する新しい関数 `UUIDv7ToDateTime` を追加しました。 [#62852](https://github.com/ClickHouse/ClickHouse/pull/62852) (Alexey Petrunyaka)。

* `TSVRaw` の同義語として `Raw` を追加しました。 [#63394](https://github.com/ClickHouse/ClickHouse/pull/63394) (Unalian)。

* サイズが制限を超えた場合に、一時ファイル上で cross join を実行できるようにしました。 [#63432](https://github.com/ClickHouse/ClickHouse/pull/63432) (p1rattttt)。



## パフォーマンスの改善 {#performance-improvements}

- INSERT時に新しく作成されたプロジェクションブロックのマージをスキップします。[#59405](https://github.com/ClickHouse/ClickHouse/pull/59405) (Nikita Taranov)。

- SELECT時のミューテーションのオーバーヘッドを削減します（v2）。[#60856](https://github.com/ClickHouse/ClickHouse/pull/60856) (Azat Khuzhin)。

- 等価集合を使用したJOINフィルタプッシュダウンの改善。[#61216](https://github.com/ClickHouse/ClickHouse/pull/61216) (Maksim Kita)。

- 単一値の最適化のための新しいアナライザパスを追加します。[#61564](https://github.com/ClickHouse/ClickHouse/pull/61564) (LiuNeng)。

- 入力文字列がすべてASCII文字の場合、文字列関数XXXUTF8を「ASCII的に」処理します。apache/doris#29799に着想を得ています。全体的に1.07倍～1.62倍の高速化を実現します。一部のケースではピークメモリ使用量が減少していることに注意してください。[#61632](https://github.com/ClickHouse/ClickHouse/pull/61632) (李扬)。

- 高速Parquetエンコーダをデフォルトで有効化しました（output_format_parquet_use_custom_encoder）。[#62088](https://github.com/ClickHouse/ClickHouse/pull/62088) (Michael Kolupaev)。

- 必要なフィールドがすべて読み取られた際に残りのフィールドをすべてスキップすることで、JSONEachRowRowInputFormatを改善します。[#62210](https://github.com/ClickHouse/ClickHouse/pull/62210) (lgbo)。

- 関数splitByCharとsplitByRegexpが大幅に高速化されました。[#62392](https://github.com/ClickHouse/ClickHouse/pull/62392) (李扬)。

- file/s3/hdfs/url/...テーブル関数のファイルからの単純なinsert selectを改善します。並列解析で使用されるスレッド数を制御するための個別のmax_parsing_threads設定を追加します。[#62404](https://github.com/ClickHouse/ClickHouse/pull/62404) (Kruglov Pavel)。

- azure_allow_parallel_part_upload設定によって管理されるAzureBlobStorageの並列書き込みバッファをサポートします。[#62534](https://github.com/ClickHouse/ClickHouse/pull/62534) (SmitaRKulkarni)。

- 関数to_utc_timestampとfrom_utc_timestampが約2倍高速化されました。[#62583](https://github.com/ClickHouse/ClickHouse/pull/62583) (KevinyhZou)。

- 関数parseDateTimeOrNull、parseDateTimeOrZero、parseDateTimeInJodaSyntaxOrNull、parseDateTimeInJodaSyntaxOrZeroは、入力に解析不可能な値が多く含まれる場合に大幅に高速化されました（10倍～1000倍）。[#62634](https://github.com/ClickHouse/ClickHouse/pull/62634) (LiuNeng)。

- 失敗時にIPごとに1つのレコードのみを保持するようにHostResolverの動作を変更します。[#62652](https://github.com/ClickHouse/ClickHouse/pull/62652) (Anton Ivashkin)。

- メモリ使用量を制御し、多数の列がある場合のマージ時のソートを2倍高速化するための新しい設定prefer_merge_sort_block_bytesを追加します。[#62904](https://github.com/ClickHouse/ClickHouse/pull/62904) (LiuNeng)。

- JOIN後のフィルタが常にデフォルト値をフィルタリングする場合、QueryPlanがOUTER JOINをINNER JOINに変換する最適化を行います。この最適化はquery_plan_convert_outer_join_to_inner_join設定で制御でき、デフォルトで有効になっています。[#62907](https://github.com/ClickHouse/ClickHouse/pull/62907) (Maksim Kita)。

- optimize_rewrite_sum_if_to_count_ifをデフォルトで有効化します。[#62929](https://github.com/ClickHouse/ClickHouse/pull/62929) (Raúl Marín)。

- 新しいアナライザのマイクロ最適化。[#63429](https://github.com/ClickHouse/ClickHouse/pull/63429) (Raúl Marín)。

- DateTimeがDateTime64と比較される場合にインデックス解析が機能するようになります。これにより#63441が解決されます。[#63443](https://github.com/ClickHouse/ClickHouse/pull/63443) (Alexey Milovidov)。

- ガベージを削除することで、set型のインデックスを若干高速化します（約1.5倍）。[#64098](https://github.com/ClickHouse/ClickHouse/pull/64098) (Alexey Milovidov)。


# 改善点

* `optimize_monotonous_functions_in_order_by` 設定を削除しました。これは実質的に何もしない設定になりつつあります。 [#63004](https://github.com/ClickHouse/ClickHouse/pull/63004) (Raúl Marín)。

* `Map` 型で、キーとして `Float32`、`Float64`、`Array(T)`、`Map(K,V)`、`Tuple(T1, T2, ...)` を使用できるようになりました。#54537 をクローズ。 [#59318](https://github.com/ClickHouse/ClickHouse/pull/59318) (李扬)。

* S3 と同様に、AzureBlobStorage 向けの非同期 `WriteBuffer` を追加しました。 [#59929](https://github.com/ClickHouse/ClickHouse/pull/59929) (SmitaRKulkarni)。

* 枠線の保持および列幅の変更に対応した複数行文字列を追加しました。 [#59940](https://github.com/ClickHouse/ClickHouse/pull/59940) (Volodyachan)。

* RabbitMQ が破損したメッセージに対して `nack` を返すようにしました。#45350 をクローズ。 [#60312](https://github.com/ClickHouse/ClickHouse/pull/60312) (Kseniia Sumarokova)。

* 関数 `toStartOfInterval(..., INTERVAL ... WEEK)` が週の最初の日として扱う曜日に影響する `first_day_of_week` 設定を追加しました。これにより、週の最初の曜日としてデフォルトで日曜日を用いる `toStartOfWeek` 関数との一貫性を保つことができます。 [#60598](https://github.com/ClickHouse/ClickHouse/pull/60598) (Jordi Villar)。

* 挿入時に割り当てられたブロック内の元の行番号を保持する永続的な仮想カラム `_block_offset` を追加しました。カラム `_block_offset` の永続化は `enable_block_offset_column` 設定で有効化できます。パーツの最小ブロック番号またはミューテーションバージョンのいずれかを保持する仮想カラム `column_part_data_version` を追加しました。永続的な仮想カラム `_block_number` は、もはや実験的機能とはみなされません。 [#60676](https://github.com/ClickHouse/ClickHouse/pull/60676) (Anton Popov)。

* 関数 `date_diff` と `age` は、結果をマイクロ秒精度ではなくナノ秒精度で計算するようになりました。また、単位パラメータの値としてナノ秒（`nanosecond`、`nanoseconds`、`ns`）を指定できるようになりました。 [#61409](https://github.com/ClickHouse/ClickHouse/pull/61409) (Austin Kothig)。

* マージ処理の際、ワイドパーツについてはマークがロードされなくなりました。 [#61551](https://github.com/ClickHouse/ClickHouse/pull/61551) (Anton Popov)。

* `output_format_pretty_row_numbers` をデフォルトで有効化しました。ユーザビリティが向上します。 [#61791](https://github.com/ClickHouse/ClickHouse/pull/61791) (Alexey Milovidov)。

* `system.zeros`、`system.zeros_mt`（すでに `system.numbers` および `system.numbers_mt` では動作しています）、および `generateRandom` テーブル関数に対する `LIMIT` 付きの単純なクエリでも、プログレスバーが動作するようになりました。おまけとして、総レコード数が `max_rows_to_read` 制限を超える場合、より早い段階で例外をスローするようになりました。これにより #58183 が解決されます。 [#61823](https://github.com/ClickHouse/ClickHouse/pull/61823) (Alexey Milovidov)。

* `TRUNCATE ALL TABLES` を追加しました。 [#61862](https://github.com/ClickHouse/ClickHouse/pull/61862) (豪肥肥)。

* `input_format_json_throw_on_bad_escape_sequence` 設定を追加しました。これを無効にすると、JSON 入力フォーマット中の不正なエスケープシーケンスをそのまま保存できます。 [#61889](https://github.com/ClickHouse/ClickHouse/pull/61889) (Kruglov Pavel)。

* 警告メッセージ内の文言を "a" から "the" に修正しました。`Atomic` エンジンは 1 つしかないため、「to a new Atomic engine」ではなく「to the new Atomic engine」であるべきです。 [#61952](https://github.com/ClickHouse/ClickHouse/pull/61952) (shabroo)。

* クォーラムインサートトランザクションの取り消し時に発生していた `logical-error` を修正しました。 [#61953](https://github.com/ClickHouse/ClickHouse/pull/61953) (Han Fei)。

* Apache Arrow スキーマから `Nullable` カラム型を自動推論するようになりました。 [#61984](https://github.com/ClickHouse/ClickHouse/pull/61984) (Maksim Kita)。

* 集約処理中に、集約状態の並列マージをキャンセルできるようになりました（例: `uniqExact`）。 [#61992](https://github.com/ClickHouse/ClickHouse/pull/61992) (Maksim Kita)。

* `INVALIDATE_QUERY` を持つ辞書ソースが、起動時に 2 回リロードされないようになりました。 [#62050](https://github.com/ClickHouse/ClickHouse/pull/62050) (vdimir)。



* ReplicatedMergeTree に対する OPTIMIZE FINAL は、現在アクティブなマージが完了するまで待機した後、最終マージのスケジューリングを再試行するようになりました。これにより、通常の MergeTree の動作により近づきます。 [#62067](https://github.com/ClickHouse/ClickHouse/pull/62067) (Nikita Taranov).

* Hive テキストファイルからデータを読み込む際、これまでは Hive テキストファイルの最初の行を使用して入力フィールド数をリサイズしていましたが、最初の行のフィールド数が Hive テーブルで定義されたフィールド数と一致しない場合がありました。例えば、Hive テーブルが test_tbl(a Int32, b Int32, c Int32) のように 3 列で定義されているにもかかわらず、テキストファイルの最初の行に 2 フィールドしかない場合、この状況では入力フィールド数は 2 にリサイズされます。その後、テキストファイルの次の行に 3 フィールドが存在すると、3 番目のフィールドは正しく読み取られず、デフォルト値の 0 に設定されてしまい、これは誤りです。 [#62086](https://github.com/ClickHouse/ClickHouse/pull/62086) (KevinyhZou).

* クライアントで入力中の構文ハイライトが、構文レベルで動作するようになりました（以前は字句解析レベルで動作していました）。 [#62123](https://github.com/ClickHouse/ClickHouse/pull/62123) (Alexey Milovidov).

* 主キーを含むブール式の後に冗長な = 1 または = 0 が追加された場合に、プライマリインデックスが使用されない問題を修正しました。例えば、`SELECT * FROM <table> WHERE <primary-key> IN (<value>) = 1` および `SELECT * FROM <table> WHERE <primary-key> NOT IN (<value>) = 0` は、プライマリインデックスを使用できるにもかかわらず、どちらもテーブル全体スキャンを実行していました。 [#62142](https://github.com/ClickHouse/ClickHouse/pull/62142) (josh-hildred).

* 設定 `lightweight_deletes_sync`（デフォルト値: 2 - すべてのレプリカを同期的に待機）を追加しました。これは `mutations_sync` 設定に似ていますが、`lightweight deletes` の動作のみに影響します。 [#62195](https://github.com/ClickHouse/ClickHouse/pull/62195) (Anton Popov).

* カスタム設定の値をパースする際に、ブール値と整数値を区別するようにしました: `SET custom_a = true; SET custom_b = 1;`. [#62206](https://github.com/ClickHouse/ClickHouse/pull/62206) (Vitaly Baranov).

* AWS PrivateLink インターフェイスエンドポイント経由での S3 アクセスをサポートしました。#60021、#31074、#53761 をクローズしました。 [#62208](https://github.com/ClickHouse/ClickHouse/pull/62208) (Arthur Passos).

* クライアントはサーバーに対してヘッダー 'Keep-Alive: timeout=X' を送信する必要があります。クライアントがサーバーからそのヘッダーを含むレスポンスを受信した場合、クライアントはサーバーから送られた値を使用する必要があります。また、接続クローズの競合を回避するため、クライアント側では有効期限が近い接続を使用しない方が望ましいです。 [#62249](https://github.com/ClickHouse/ClickHouse/pull/62249) (Sema Checherinda).

* `date_trunc` に対してナノ秒・マイクロ秒・ミリ秒の単位を追加しました。 [#62335](https://github.com/ClickHouse/ClickHouse/pull/62335) (Misz606).

* クエリキャッシュは、system テーブルに対するクエリ結果（`system.*`, `information_schema.*`, `INFORMATION_SCHEMA.*`）をキャッシュしないようになりました。 [#62376](https://github.com/ClickHouse/ClickHouse/pull/62376) (Robert Schulze).

* `MOVE PARTITION TO TABLE` クエリは、パーツ数の上限を超えないように、遅延されるか、`TOO_MANY_PARTS` 例外をスローする場合があります。同じ設定および制限が `INSERT` クエリと同様に適用されます（`max_parts_in_total`, `parts_to_delay_insert`, `parts_to_throw_insert`, `inactive_parts_to_throw_insert`, `inactive_parts_to_delay_insert`, `max_avg_part_size_for_too_many_parts`, `min_delay_to_insert_ms`, `max_delay_to_insert` 設定を参照してください）。 [#62420](https://github.com/ClickHouse/ClickHouse/pull/62420) (Sergei Trifonov).

* `transform` が常に最初にマッチした値を返すようにしました。 [#62518](https://github.com/ClickHouse/ClickHouse/pull/62518) (Raúl Marín).

* `RESTORE` を実行する際に、テーブルの `DEFAULT` 式を評価しないようにしました。 [#62601](https://github.com/ClickHouse/ClickHouse/pull/62601) (Vitaly Baranov).

* HTTP リクエストで、異なる認証スキームのクォータキーを許可しました。 [#62842](https://github.com/ClickHouse/ClickHouse/pull/62842) (Kseniia Sumarokova).



* ユーザーの `valid_until` に到達した場合、セッションを終了するようにしました。 [#63046](https://github.com/ClickHouse/ClickHouse/pull/63046) (Konstantin Bogdanov)。
