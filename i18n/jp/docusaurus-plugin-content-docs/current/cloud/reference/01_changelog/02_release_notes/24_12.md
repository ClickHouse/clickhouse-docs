---
slug: /changelogs/24.12
title: 'v24.12 Cloud 向け更新履歴'
description: 'v24.12 の高速リリース更新履歴'
keywords: ['changelog', 'cloud']
sidebar_label: '24.12'
sidebar_position: 4
doc_type: 'changelog'
---

v24.12 リリースに基づく ClickHouse Cloud サービス向けの主な変更点。



## 後方互換性のない変更 {#backward-incompatible-changes}

- 関数 `greatest` および `least` は、NULL入力値を無視するようになりました。以前は、引数の1つがNULLの場合にNULLを返していました。例えば、`SELECT greatest(1, 2, NULL)` は現在2を返します。これにより、PostgreSQLと互換性のある動作になります。[#65519](https://github.com/ClickHouse/ClickHouse/pull/65519) ([kevinyhzou](https://github.com/KevinyhZou))。
- 予期しない結果につながる可能性があるため、デフォルトでは ORDER BY/GROUP BY/PARTITION BY/PRIMARY KEY において Variant/Dynamic 型を許可しないようになりました。[#69731](https://github.com/ClickHouse/ClickHouse/pull/69731) ([Pavel Kruglov](https://github.com/Avogar))。
- システムテーブル `generate_series` および `generateSeries` を削除しました。これらは誤ってここで追加されたものです: [#59390](https://github.com/ClickHouse/ClickHouse/issues/59390)。[#71091](https://github.com/ClickHouse/ClickHouse/pull/71091) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `StorageExternalDistributed` を削除しました。クローズ [#70600](https://github.com/ClickHouse/ClickHouse/issues/70600)。[#71176](https://github.com/ClickHouse/ClickHouse/pull/71176) ([flynn](https://github.com/ucasfl))。
- サーバー設定(users.xml)の設定がクライアントにも適用されるようになりました。フォーマット設定(例: `date_time_output_format`)に有用です。[#71178](https://github.com/ClickHouse/ClickHouse/pull/71178) ([Michael Kolupaev](https://github.com/al13n321))。
- JSONサブカラムのファイルにおいてエスケープされていない特殊記号による `No such file or directory` エラーの可能性を修正しました。[#71182](https://github.com/ClickHouse/ClickHouse/pull/71182) ([Pavel Kruglov](https://github.com/Avogar))。
- テーブルエンジン Kafka、NATS、RabbitMQ は、`SOURCES` 階層内で独自の権限によってカバーされるようになりました。これらのエンジンタイプでテーブルを作成するデフォルト以外のデータベースユーザーに権限を追加してください。[#71250](https://github.com/ClickHouse/ClickHouse/pull/71250) ([Christoph Wurm](https://github.com/cwurm))。
- ミューテーションクエリを実行する前に、完全なクエリ(サブクエリを含む)をチェックするようになりました。これにより、無効なクエリを誤って実行し、有効なミューテーションをブロックするデッドミューテーションが蓄積されることを防ぎます。[#71300](https://github.com/ClickHouse/ClickHouse/pull/71300) ([Christoph Wurm](https://github.com/cwurm))。
- ファイルシステムキャッシュ設定 `skip_download_if_exceeds_query_cache` を `filesystem_cache_skip_download_if_exceeds_per_query_cache_write_limit` に名称変更しました。[#71578](https://github.com/ClickHouse/ClickHouse/pull/71578) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 混乱を避けるため、min/max関数において Dynamic/Variant 型を禁止しました。[#71761](https://github.com/ClickHouse/ClickHouse/pull/71761) ([Pavel Kruglov](https://github.com/Avogar))。
- `deltaSumTimestamp` における `Enum` および `UInt128`、`UInt256` 引数のサポートを削除しました。`deltaSumTimestamp` の第2引数("timestamp")における `Int8`、`UInt8`、`Int16`、`UInt16` のサポートを削除しました。[#71790](https://github.com/ClickHouse/ClickHouse/pull/71790) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ClickHouseがディクショナリのソースとして使用される場合に、ソースクエリの検証を追加しました。[#72548](https://github.com/ClickHouse/ClickHouse/pull/72548) ([Alexey Katsman](https://github.com/alexkats))。


## 新機能 {#new-features}


* 指定されたテーブル、またはテーブルが指定されていない場合はすべてのテーブルのすべてのパーツに対して、プライマリキーインデックスをロードするための `SYSTEM LOAD PRIMARY KEY` コマンドを実装しました。これはベンチマークに役立ち、クエリ実行時の追加レイテンシを防ぐのに有用です。 [#66252](https://github.com/ClickHouse/ClickHouse/pull/66252) ([ZAWA&#95;ll](https://github.com/Zawa-ll)).
* `SYSTEM LOAD PRIMARY KEY` ステートメントを追加し、指定したテーブル内のすべてのパーツのプライマリインデックス、またはテーブルを指定しない場合はすべてのテーブルのプライマリインデックスをロードできるようにしました。これはベンチマークに有用であり、クエリ実行時の追加レイテンシを防ぐのにも役立ちます。 [#67733](https://github.com/ClickHouse/ClickHouse/pull/67733) ([ZAWA&#95;ll](https://github.com/Zawa-ll)).
* 現在のユーザー/ロールに特定の権限が付与されているか、および対応するテーブル/カラムがメモリ内に存在するかを確認するための `CHECK GRANT` クエリを追加しました。 [#68885](https://github.com/ClickHouse/ClickHouse/pull/68885) ([Unalian](https://github.com/Unalian)).
* ワークロードおよびリソース管理を定義するための SQL 構文を追加しました。 [https://clickhouse.com/docs/en/operations/workload-scheduling](https://clickhouse.com/docs/en/operations/workload-scheduling)。 [#69187](https://github.com/ClickHouse/ClickHouse/pull/69187) ([Sergei Trifonov](https://github.com/serxa))。
* [Iceberg データストレージ](https://iceberg.apache.org/spec/#file-system-operations) フォーマットは、テーブルスキーマを変更するための多様なオプションをユーザーに提供します。このプルリクエストでは、カラムの順序やカラム名、単純な型の拡張が変更されている Iceberg フォーマットのテーブルを読み取る機能が実装されました。 [#69445](https://github.com/ClickHouse/ClickHouse/pull/69445) ([Daniil Ivanik](https://github.com/divanik))。
* 各認証メソッドごとに有効期限を個別に設定できるようにし、ユーザーエンティティからは削除しました。 [#70090](https://github.com/ClickHouse/ClickHouse/pull/70090) ([Arthur Passos](https://github.com/arthurpassos)).
* クエリの発行元からクラスタ内の他ノードへ外部ユーザーロールをプッシュできるようにしました。外部認証基盤（LDAP など）へのアクセス権を発行元だけが持つ場合に便利です。 [#70332](https://github.com/ClickHouse/ClickHouse/pull/70332) ([Andrey Zvonov](https://github.com/zvonand)).
* String から JSON への ALTER をサポートしました。この PR では、JSON および Dynamic 型のシリアライゼーションも新バージョンである V2 に変更しています。古いバージョンの V1 も、設定 `merge_tree_use_v1_object_and_dynamic_serialization` を有効にすることで引き続き使用できます（アップグレード時に、問題なくバージョンをロールバックできるようにするために利用できます）。[#70442](https://github.com/ClickHouse/ClickHouse/pull/70442)（[Pavel Kruglov](https://github.com/Avogar)）。
* `DateTime64` を秒単位の固定精度を持つ `Int64` 値に変換する関数 `toUnixTimestamp64Second` を追加しました。これにより、日時が 1970 年 1 月 1 日 木曜日 00:00:00 UTC より前の場合に負の値を返せるようになりました。 [#70597](https://github.com/ClickHouse/ClickHouse/pull/70597) ([zhanglistar](https://github.com/zhanglistar))。
* 新しい設定 `enforce_index_structure_match_on_partition_manipulation` を追加し、ソーステーブルのプロジェクションとセカンダリインデックスがターゲットテーブル側のものの部分集合である場合に `ATTACH` を許可するようにしました。 [#70602](https://github.com/ClickHouse/ClickHouse/issues/70602) をクローズ。 [#70603](https://github.com/ClickHouse/ClickHouse/pull/70603) ([zwy991114](https://github.com/zwy991114))。
* `cast` 関数の出力が Apache Spark と異なるため、gluten プロジェクトに差異が生じています。詳しくは [https://github.com/apache/incubator-gluten/issues/7602](https://github.com/apache/incubator-gluten/issues/7602) を参照してください。この PR では Spark のテキスト出力フォーマットをサポートする機能を追加しましたが、デフォルトでは無効化されています。[#70957](https://github.com/ClickHouse/ClickHouse/pull/70957)（[zhanglistar](https://github.com/zhanglistar)）。
* ユーザー認証用の S3 エンドポイント向けに、新しいヘッダータイプ（`access_header`）を追加しました。これにより、最も優先度の低いアクセスヘッダーを取得し、他の任意のソース（たとえばテーブルスキーマや名前付きコレクション）から提供される `access_key_id` で上書きできるようになります。 [#71011](https://github.com/ClickHouse/ClickHouse/pull/71011) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* 設定階層の初期実装。 [#71145](https://github.com/ClickHouse/ClickHouse/pull/71145) ([Raúl Marín](https://github.com/Algunenano)).
* `fill` 演算子を伴う `ORDER BY` で `STALENESS` 句をサポートしました。 [#71151](https://github.com/ClickHouse/ClickHouse/pull/71151) ([Mikhail Artemenko](https://github.com/Michicosun)).
* JSON 文字列とのシリアライズ／デシリアライズを通じて、Map/Tuple/Object から新しい JSON への単純な CAST を実装しました。 [#71320](https://github.com/ClickHouse/ClickHouse/pull/71320) ([Pavel Kruglov](https://github.com/Avogar)).
* 集約関数 `any` に対してエイリアス `anyRespectNulls`、`firstValueRespectNulls`、`anyValueRespectNulls` を追加しました。また、集約関数 `anyLast` に対してエイリアス `anyLastRespectNulls` と `lastValueRespectNulls` を追加しました。これにより、例えば `anyLast_respect_nullsStateIf` の代わりに `SELECT anyLastRespectNullsStateIf` のように、アンダースコアを含まないキャメルケースのみの、より自然な構文を使用できるようになりました。 [#71403](https://github.com/ClickHouse/ClickHouse/pull/71403) ([Peter Nguyen](https://github.com/petern48))。
* `date_time_utc` 設定パラメータを追加し、JSON ログフォーマットで RFC 3339/ISO8601 形式の UTC 日時をサポートできるようにしました。 [#71560](https://github.com/ClickHouse/ClickHouse/pull/71560) ([Ali](https://github.com/xogoodnow)).
* クエリプランにおいて、結合のどちらの側をインナー（ビルド）テーブルとして扱うかを選択できるオプションを追加しました。これは `query_plan_join_swap_table` によって制御され、`auto` に設定できます。このモードでは、ClickHouse は行数が最も少ないテーブルを選択しようとします。 [#71577](https://github.com/ClickHouse/ClickHouse/pull/71577) ([Vladimir Cherkasov](https://github.com/vdimir))。
* パーツ内のグラニュラリティが一定である場合、そのインデックスグラニュラリティ値のメモリ使用量を最適化しました。パーツに対して常に一定のグラニュラリティを選択できるようにする設定（`use_const_adaptive_granularity`）を追加し、メモリ上で常に最適化された状態を維持できるようにしました。これにより、大規模なワークロード（共有ストレージ上で数兆行規模）において、データパーツのメタデータ（インデックスグラニュラリティ値）によるメモリ使用量が継続的に増加することを防ぐのに役立ちます。 [#71786](https://github.com/ClickHouse/ClickHouse/pull/71786) ([Anton Popov](https://github.com/CurtizJ)).
* `allowed_feature_tier` をグローバルスイッチとして実装し、すべての experimental / beta 機能を無効化しました。 [#71841](https://github.com/ClickHouse/ClickHouse/pull/71841) ([Raúl Marín](https://github.com/Algunenano)).
* `iceberg[S3;HDFS;Azure]Cluster`、`deltaLakeCluster`、`hudiCluster` テーブル関数を追加。[#72045](https://github.com/ClickHouse/ClickHouse/pull/72045)（[Mikhail Artemenko](https://github.com/Michicosun)）。
* `ALTER USER {ADD|MODIFY|DROP SETTING}` および `ALTER USER {ADD|DROP PROFILE}` の構文を追加し、同様の構文を `ALTER ROLE` と `ALTER PROFILE` にも追加しました。 [#72050](https://github.com/ClickHouse/ClickHouse/pull/72050) ([pufit](https://github.com/pufit)).
* `arrayPrAUC` 関数を追加しました。この関数は Precision-Recall 曲線における AUC（Area Under the Curve）を計算します。 [#72073](https://github.com/ClickHouse/ClickHouse/pull/72073) ([Emmanuel](https://github.com/emmanuelsdias))。
* `MergeTree` テーブルのプライマリインデックス用キャッシュを追加しました（テーブル設定 `use_primary_key_cache` で有効化可能）。プライマリインデックスに対して遅延ロードとキャッシュが有効になっている場合、プライマリインデックスはメモリに常駐し続けるのではなく、マークキャッシュと同様にオンデマンドでキャッシュにロードされるようになりました。データパーツの insert/merge/fetch 時およびテーブルの再起動時に、プライマリインデックスをプリウォームする機能を追加しました（設定 `prewarm_primary_key_cache` で有効化可能）。 [#72102](https://github.com/ClickHouse/ClickHouse/pull/72102) ([Anton Popov](https://github.com/CurtizJ)).
* 配列型向けに `indexOfAssumeSorted` 関数を追加しました。非減少順にソートされた配列での検索を最適化します。 [#72517](https://github.com/ClickHouse/ClickHouse/pull/72517) ([Eric Kurbanov](https://github.com/erickurbanov))。
* 集約関数 `groupConcat` で、区切り文字を省略可能な第2引数として指定できるようになりました。 [#72540](https://github.com/ClickHouse/ClickHouse/pull/72540) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 新しい設定 `http_response_headers` により、HTTP レスポンスヘッダーをカスタマイズできるようになりました。たとえば、データベースに保存されている画像をブラウザに表示させることができます。これにより [#59620](https://github.com/ClickHouse/ClickHouse/issues/59620) がクローズされました。 [#72656](https://github.com/ClickHouse/ClickHouse/pull/72656)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* Int64 の Unix タイムスタンプ値を DateTime64 に変換する関数 `fromUnixTimestamp64Second` を追加しました。 [#73146](https://github.com/ClickHouse/ClickHouse/pull/73146) ([Robert Schulze](https://github.com/rschu1ze)).





## パフォーマンスの改善 {#performance-improvements}


* `Nullable` 列に対して、データブロック内の NULL 値の比率が指定したしきい値を超えた場合に、ショートサーキット方式で関数を実行できるようにする 2 つの新しい設定 `short_circuit_function_evaluation_for_nulls` と `short_circuit_function_evaluation_for_nulls_threshold` を追加しました。これは、関数が非 NULL 値を持つ行に対してのみ実行されることを意味します。この挙動は、少なくとも 1 つの引数が NULL の行に対して NULL を返す関数にのみ適用されます。 [#60129](https://github.com/ClickHouse/ClickHouse/pull/60129) ([李扬](https://github.com/taiyang-li))。
* オブジェクトストレージディスクにおける `clickhouse disks remove --recursive` のメモリ使用量が削減されました。 [#67323](https://github.com/ClickHouse/ClickHouse/pull/67323) ([Kirill](https://github.com/kirillgarbar)).
* `join_algorithm='parallel_hash'` で並列処理のために入力ブロックをスレッド間で分配する際、入力ブロックの列をコピーしないようにしました。 [#67782](https://github.com/ClickHouse/ClickHouse/pull/67782) ([Nikita Taranov](https://github.com/nickitat)).
* より多くの式に対して JIT コンパイルを有効化: `abs`/`bitCount`/`sign`/`modulo`/`pmod`/`isNull`/`isNotNull`/`assumeNotNull`/`to(U)Int*`/`toFloat*`、比較関数（`=`, `<`, `>`, `>=`, `<=`）、論理関数（`and`, `or`）。 [#70598](https://github.com/ClickHouse/ClickHouse/pull/70598) ([李扬](https://github.com/taiyang-li)).
* `join_algorithm` 設定が `default` の場合（適用可能な場合）は、`parallel_hash` アルゴリズムが使用されるようになりました。`parallel_hash` が使用できない場合には、従来の 2 つの選択肢（`direct` および `hash`）が引き続き利用されます。 [#70788](https://github.com/ClickHouse/ClickHouse/pull/70788) ([Nikita Taranov](https://github.com/nickitat))。
* 交差しないパーツに対して `Replacing` マージアルゴリズムを最適化しました。 [#70977](https://github.com/ClickHouse/ClickHouse/pull/70977) ([Anton Popov](https://github.com/CurtizJ))。
* metrics および system.detached&#95;parts において、readonly および write-once ディスク上の detached parts を一覧表示しないようにしました。 [#71086](https://github.com/ClickHouse/ClickHouse/pull/71086) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 重い非同期メトリクスはデフォルトでは計算しないようにしました。この機能は [#40332](https://github.com/ClickHouse/ClickHouse/issues/40332) で導入されましたが、特定の 1 人の顧客にしか必要とされない重いバックグラウンドジョブを持つのは望ましくありません。[#71087](https://github.com/ClickHouse/ClickHouse/pull/71087)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* クリティカルセクションを短縮することで、system.query&#95;metric&#95;log の収集間隔における性能と精度を改善しました。 [#71473](https://github.com/ClickHouse/ClickHouse/pull/71473) ([Pablo Marcos](https://github.com/pamarcos))。
* `WHERE` と `ON` の式から共通部分式を抽出し、結合時に使用されるハッシュテーブルの数を削減するオプションを追加しました。`optimize_extract_common_expressions = 1` で有効化できます。[#71537](https://github.com/ClickHouse/ClickHouse/pull/71537) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
* `LowCardinality(String)` を含む `SELECT` でインデックスを使用できるようになりました。 [#71598](https://github.com/ClickHouse/ClickHouse/pull/71598) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 並列レプリカとローカルプランが有効な状態でクエリを実行する際、ワーカー側ではスキップインデックスの解析を行わないようにしました。コーディネーターは、自身の側（クエリのイニシエーター）で実行したインデックス解析に基づいて、ワーカーが読み取るレンジを選択します。 [#72109](https://github.com/ClickHouse/ClickHouse/pull/72109) ([Igor Nikonov](https://github.com/devcrafter))。
* [https://github.com/ClickHouse/ClickHouse/pull/57631](https://github.com/ClickHouse/ClickHouse/pull/57631) で導入された、Compact パーツにおける単一カラムのサブカラム読み取りの最適化を復元しました。これは誤って削除されていました。 [#72285](https://github.com/ClickHouse/ClickHouse/pull/72285)（[Pavel Kruglov](https://github.com/Avogar)）。
* コンパレータ内の呼び出しをデバーチャライゼーションすることで、`LowCardinality(String)` 列のソートを高速化しました。 [#72337](https://github.com/ClickHouse/ClickHouse/pull/72337) ([Alexander Gololobov](https://github.com/davenger))。
* いくつかの簡単なデータ型に対して `argMin` / `argMax` 関数を最適化しました。 [#72350](https://github.com/ClickHouse/ClickHouse/pull/72350) ([alesapin](https://github.com/alesapin))。
* メモリトラッカーで共有ロックを使用することでロック競合を減らし、ロック処理を最適化しました。 [#72375](https://github.com/ClickHouse/ClickHouse/pull/72375) ([Jiebin Sun](https://github.com/jiebinn)).
* 新しい設定 `use_async_executor_for_materialized_views` を追加。マテリアライズドビューのクエリ実行に非同期かつマルチスレッドの実行を使用でき、INSERT 時のビュー処理を高速化できる一方で、より多くのメモリを消費する可能性がある。 [#72497](https://github.com/ClickHouse/ClickHouse/pull/72497) ([alesapin](https://github.com/alesapin)).
* 設定 `max_size_to_preallocate_for_aggregation` と `max_size_to_preallocate_for_joins` のデフォルト値が `10^12` にさらに引き上げられ、これによりこの最適化が適用されるケースが増えました。 [#72555](https://github.com/ClickHouse/ClickHouse/pull/72555) ([Nikita Taranov](https://github.com/nickitat)).
* 集約関数の状態（データ型 `AggregateFunction` および分散クエリ内）のデシリアライズ処理のパフォーマンスを改善しました。`RowBinary` 形式のパース処理のパフォーマンスもわずかに向上しました。 [#72818](https://github.com/ClickHouse/ClickHouse/pull/72818) ([Anton Popov](https://github.com/CurtizJ)).





## 改善 {#improvement}


* 定数配列と定数としてキャプチャされた引数を持つ高階関数は、定数を返します。 [#58400](https://github.com/ClickHouse/ClickHouse/pull/58400) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 仮想行を生成することで読み込み順序を最適化し、特に複数のパーツが存在する場合のマージソート時に読み取るデータ量を削減します。 [#62125](https://github.com/ClickHouse/ClickHouse/pull/62125) ([Shichao Jin](https://github.com/jsc0218)).
* クエリプランのステップ名（`EXPLAIN PLAN json=1`）およびパイプラインプロセッサ名（`EXPLAIN PIPELINE compact=0,graph=1`）に、一意の ID がサフィックスとして付与されるようになりました。これにより、processors profiler の出力や OpenTelemetry のトレースを、EXPLAIN の出力と対応付けることができます。 [#63518](https://github.com/ClickHouse/ClickHouse/pull/63518) ([qhsong](https://github.com/qhsong)).
* Azure Blob Storage への書き込み後にオブジェクトの存在を確認するオプションを追加しました。これは `check_objects_after_upload` の設定で制御できます。 [#64847](https://github.com/ClickHouse/ClickHouse/pull/64847) ([Smita Kulkarni](https://github.com/SmitaRKulkarni)).
* HashTable destroyElements における use-after-dtor ロジックを修正。 [#65279](https://github.com/ClickHouse/ClickHouse/pull/65279) ([cangyin](https://github.com/cangyin)).
* `clickhouse-local` でデフォルトのデータベースとして `Atomic` を使用するようにしました。 [#50647](https://github.com/ClickHouse/ClickHouse/issues/50647) の項目 1 と 5 に対応しました。 [#44817](https://github.com/ClickHouse/ClickHouse/issues/44817) をクローズしました。 [#68024](https://github.com/ClickHouse/ClickHouse/pull/68024)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 書き込みバッファは明示的にキャンセルまたは確定する必要があります。クライアントにエラーを通知するため、例外発生時には HTTP プロトコルを意図的に破ります。 [#68800](https://github.com/ClickHouse/ClickHouse/pull/68800) ([Sema Checherinda](https://github.com/CheSema)).
* `replica_dir` を作成し、DDLWorker 内でレプリカをアクティブとしてマークすることで、稼働中の DDLWorker ホストを報告するようにしました。 [#69658](https://github.com/ClickHouse/ClickHouse/pull/69658) ([Tuan Pham Anh](https://github.com/tuanpach))。
* 1. `DDLQueryStatusSource` をリファクタリング: - `DDLQueryStatusSource` を `DistributedQueryStatusSource` にリネームし、ベースクラスにする - 2 つのサブクラス `DDLOnClusterQueryStatusSource` と `ReplicatedDatabaseQueryStatusSource` を `DDLQueryStatusSource` から派生させて作成し、それぞれ `DDL On Cluster` およびレプリケーテッドデータベースから DDL タスクのステータスを取得できるようにする。2. `DDLOnClusterQueryStatusSource` でオフラインホストの待機を中断できるようにする。[#69660](https://github.com/ClickHouse/ClickHouse/pull/69660) ([Tuan Pham Anh](https://github.com/tuanpach)).
* 新しいキャンセルロジックを追加しました。`CancellationChecker` は、開始されたすべてのクエリのタイムアウトを監視し、タイムアウトに達したクエリを停止します。 [#69880](https://github.com/ClickHouse/ClickHouse/pull/69880) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* `allow_experimental_join_condition` 設定を削除し、非等値条件をデフォルトで許可するようにしました。 [#69910](https://github.com/ClickHouse/ClickHouse/pull/69910) ([Vladimir Cherkasov](https://github.com/vdimir))。
* `parallel_replicas_local_plan` をデフォルトで有効化。クエリイニシエーター側で完全なローカルプランを構築することで、リソース消費を抑えつつ並列レプリカのパフォーマンスを向上させ、さらなるクエリ最適化を適用できるようにします。 [#70171](https://github.com/ClickHouse/ClickHouse/pull/70171) ([Igor Nikonov](https://github.com/devcrafter))。
* http&#95;handlers（`dynamic_query_handler`/`predefined_query_handler`）でユーザー名とパスワードを設定できるようにした。 [#70725](https://github.com/ClickHouse/ClickHouse/pull/70725) ([Azat Khuzhin](https://github.com/azat)).
* ストレージ S3Queue で、一部の設定に対して `ALTER TABLE ... MODIFY/RESET SETTING ...` をサポート。 [#70811](https://github.com/ClickHouse/ClickHouse/pull/70811) ([Kseniia Sumarokova](https://github.com/kssenii)).
* ディレクトリを一覧表示する際にオブジェクトストレージ API を呼び出さないでください。コスト効率が悪くなる可能性があります。代わりに、ファイル名の一覧をメモリ上に保存してください。この場合のトレードオフは、初回の読み込み時間と、ファイル名を保存するために必要なメモリ量の増加です。 [#70823](https://github.com/ClickHouse/ClickHouse/pull/70823) ([Julia Kartseva](https://github.com/jkartseva)).
* `clickhouse-compressor` に `--threads` パラメータを追加し、データを並列に圧縮できるようにしました。 [#70860](https://github.com/ClickHouse/ClickHouse/pull/70860) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* Replxx クライアントの履歴サイズを設定可能にしました。 [#71014](https://github.com/ClickHouse/ClickHouse/pull/71014) ([Jiří Kozlovský](https://github.com/jirislav))。
* `prewarm_mark_cache` 設定を追加しました。この設定を有効にすると、挿入、マージ、パーツのフェッチ時、およびテーブルの起動時に、マークがマークキャッシュにロードされます。 [#71053](https://github.com/ClickHouse/ClickHouse/pull/71053) ([Anton Popov](https://github.com/CurtizJ)).
* Parquet ネイティブリーダーでの Boolean 型サポート。 [#71055](https://github.com/ClickHouse/ClickHouse/pull/71055) ([Arthur Passos](https://github.com/arthurpassos))。
* S3 とやり取りする際に、「Malformed message」など、より多くの種類のエラーで再試行を行うようにしました。 [#71088](https://github.com/ClickHouse/ClickHouse/pull/71088) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* S3 に関する一部メッセージのログレベルを引き下げました。[#71090](https://github.com/ClickHouse/ClickHouse/pull/71090)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* スペースを含む HDFS ファイルへの書き込みをサポートしました。 [#71105](https://github.com/ClickHouse/ClickHouse/pull/71105) ([exmy](https://github.com/exmy))。
* `system.session_log` は十分に問題ありません。これにより [#51760](https://github.com/ClickHouse/ClickHouse/issues/51760) がクローズされました。 [#71150](https://github.com/ClickHouse/ClickHouse/pull/71150) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 並列レプリカを用いるクエリでの RIGHT / FULL 結合の動作を修正しました。これにより、RIGHT 結合は並列レプリカで実行できるようになり（右側テーブルの読み取りが分散されます）、FULL 結合はノード間で並列化できないため、各ノードでローカルに実行されます。 [#71162](https://github.com/ClickHouse/ClickHouse/pull/71162) ([Igor Nikonov](https://github.com/devcrafter))。
* レプリケートテーブル、ディクショナリ、およびビューの数を制限する設定を追加しました。 [#71179](https://github.com/ClickHouse/ClickHouse/pull/71179) ([Kirill](https://github.com/kirillgarbar)).
* [#71227](https://github.com/ClickHouse/ClickHouse/issues/71227) を修正。[#71286](https://github.com/ClickHouse/ClickHouse/pull/71286)（[Arthur Passos](https://github.com/arthurpassos)）。
* サーバー/ユーザーのメモリ使用量に応じて、`GROUP BY`/`ORDER BY` を自動的にディスクにスピルします。`max_bytes_ratio_before_external_group_by`/`max_bytes_ratio_before_external_sort` クエリ設定で制御されます。[#71406](https://github.com/ClickHouse/ClickHouse/pull/71406)（[Azat Khuzhin](https://github.com/azat) による）。
* ホスト単位のダッシュボード `Overview (host)` と `Cloud overview (host)` を高度なダッシュボードに追加しました。 [#71422](https://github.com/ClickHouse/ClickHouse/pull/71422) ([alesapin](https://github.com/alesapin))。
* 関数 `translate` は、`from` 引数に含まれる文字数が `to` 引数より多い場合に、文字の削除もサポートするようになりました。例: `SELECT translate('clickhouse', 'clickhouse', 'CLICK')` は、現在 `CLICK` を返します。 [#71441](https://github.com/ClickHouse/ClickHouse/pull/71441) ([shuai.xu](https://github.com/shuai-xu)).
* 新しい関数 `parseDateTime64`、`parseDateTime64OrNull`、`parseDateTime64OrZero` が追加されました。既存の関数 `parseDateTime`（およびそのバリアント）と比べて、これらは `DateTime` 型ではなく `DateTime64` 型の値を返します。 [#71581](https://github.com/ClickHouse/ClickHouse/pull/71581) ([kevinyhzou](https://github.com/KevinyhZou)).
* MergeTree テーブルエンジンファミリーのメモリフットプリントを削減するため、メモリ上の index&#95;granularity 配列を必要最小限のサイズに縮小しました。 [#71595](https://github.com/ClickHouse/ClickHouse/pull/71595) ([alesapin](https://github.com/alesapin)).
* コマンドラインアプリケーションで、マルチステートメントに対しても構文がハイライトされるようになりました。 [#71622](https://github.com/ClickHouse/ClickHouse/pull/71622) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* コマンドラインアプリケーションは、エラー発生時にゼロ以外の終了コードを返すようになりました。以前のバージョンでは、`disks` アプリケーションはエラー発生時でもゼロを返し、他のアプリケーションもエラー 256（`PARTITION_ALREADY_EXISTS`）および 512（`SET_NON_GRANTED_ROLE`）の際にゼロを返していました。[#71623](https://github.com/ClickHouse/ClickHouse/pull/71623)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `Vertical` フォーマット（クエリの末尾を `\G` で終わらせた場合にも有効になります）は、次のような Pretty フォーマットの機能を備えています：- 数値の3桁ごとの区切りをハイライト表示する。- 読みやすい形式の数値チップを表示する。[#71630](https://github.com/ClickHouse/ClickHouse/pull/71630)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `filesystem_cache_prefer_bigger_buffer_size` 設定により、ファイルシステムキャッシュでのメモリバッファサイズ拡張を無効化できるようにしました。 [#71640](https://github.com/ClickHouse/ClickHouse/pull/71640) ([Kseniia Sumarokova](https://github.com/kssenii)).
* ファイルシステムキャッシュにおけるバックグラウンドダウンロードの最大ファイルセグメントサイズを指定するための、個別の設定 `background_download_max_file_segment_size` を追加しました。 [#71648](https://github.com/ClickHouse/ClickHouse/pull/71648) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `enable_http_compression` のデフォルト値を 0 から 1 に変更します。[#71591](https://github.com/ClickHouse/ClickHouse/issues/71591) をクローズします。[#71774](https://github.com/ClickHouse/ClickHouse/pull/71774)（[Peter Nguyen](https://github.com/petern48)）。
* Object から JSON への ALTER をサポートしました。 [#71784](https://github.com/ClickHouse/ClickHouse/pull/71784) ([Pavel Kruglov](https://github.com/Avogar)).
* JSON 型のパースがわずかに改善されました。JSON パスに対応する現在のブロックに複数の型の値が含まれている場合、あらかじめ定義されたベストエフォートの優先順で型を試し、最適な型を選択するようになりました。 [#71785](https://github.com/ClickHouse/ClickHouse/pull/71785) ([Pavel Kruglov](https://github.com/Avogar))。
* 以前は、`system.asynchronous_metrics` からの読み取りは、並行して実行中の更新処理の完了を待っていました。システムが高負荷の状態では、これに長い時間がかかる場合があります。この変更により、すでに収集済みの値を常に読み取れるようになりました。 [#71798](https://github.com/ClickHouse/ClickHouse/pull/71798) ([Alexander Gololobov](https://github.com/davenger)).
* `polling_max_timeout_ms` を 10 分、`polling_backoff_ms` を 30 秒に設定します。 [#71817](https://github.com/ClickHouse/ClickHouse/pull/71817) ([Kseniia Sumarokova](https://github.com/kssenii))。
* &#39;SELECT - FROM t LIMIT 1&#39; のようなクエリは、実際には使用されない場合でもパートインデックスを読み込んでいました。[#71866](https://github.com/ClickHouse/ClickHouse/pull/71866)（[Alexander Gololobov](https://github.com/davenger)）。
* 古い互換性設定では、allow&#95;reorder&#95;prewhere&#95;conditions がデフォルトで有効になっています。 [#71867](https://github.com/ClickHouse/ClickHouse/pull/71867) ([Raúl Marín](https://github.com/Algunenano))。
* `bitmapTransform` 関数を使用し、かつ引数の型が有効な場合には、`system.errors` テーブル内の `ILLEGAL_TYPE_OF_ARGUMENT` カウンタをインクリメントしないようにしました。 [#71971](https://github.com/ClickHouse/ClickHouse/pull/71971) ([Dmitry Novik](https://github.com/novikd))。
* Dictionary storage、dictionary table function、もしくは辞書自体に対する直接の `SELECT` によって辞書からデータを取得する場合、その辞書に対する `SELECT` 権限または `dictGet` 権限のいずれかを持っていれば十分になりました。これは、ACL の回避を防止しようとした以前の試み（[https://github.com/ClickHouse/ClickHouse/pull/57362](https://github.com/ClickHouse/ClickHouse/pull/57362) および [https://github.com/ClickHouse/ClickHouse/pull/65359](https://github.com/ClickHouse/ClickHouse/pull/65359)）と整合しており、後者との後方互換性も確保します。[#72051](https://github.com/ClickHouse/ClickHouse/pull/72051)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 高度なダッシュボードの HTML ページに、`system.dashboards` テーブル内のダッシュボードを選択できるドロップダウンセレクターを追加しました。 [#72081](https://github.com/ClickHouse/ClickHouse/pull/72081) ([Sergei Trifonov](https://github.com/serxa)).
* 分散テーブルに対する `INSERT ... SELECT` のプランを構築する際に `prefer_locahost_replica` を考慮するようにしました。 [#72190](https://github.com/ClickHouse/ClickHouse/pull/72190) ([filimonov](https://github.com/filimonov)).
* この問題については[こちらで説明されています](https://github.com/ClickHouse/ClickHouse/issues/72091)。Azure Iceberg Writer は、仕様に違反する Iceberg メタデータファイル（およびマニフェストファイル）を作成します。この PR では、v2 リーダーで v1 Iceberg フォーマットのメタデータを読み取る試みを追加し（そのような形式で書かれているため）、さらにマニフェストファイル内に対応するフィールドが作成されていない場合にエラーを出すようにしました。[#72277](https://github.com/ClickHouse/ClickHouse/pull/72277)（[Daniil Ivanik](https://github.com/divanik)）。
* JSON/Dynamic/Variant 型を experimental 機能から beta 機能に移行しました。 [#72294](https://github.com/ClickHouse/ClickHouse/pull/72294) ([Pavel Kruglov](https://github.com/Avogar)).
* クエリ内で `UNION [ALL]` を使用した `CREATE MATERIALIZED VIEW` が可能になりました。動作は `JOIN` を使用したマテリアライズドビューと同様で、**`SELECT` 式内の最初のテーブルだけが挿入のトリガーとして機能し、他のすべてのテーブルは無視されます**。 [#72347](https://github.com/ClickHouse/ClickHouse/pull/72347) ([alesapin](https://github.com/alesapin))。
* 挿入バッチ内のパーティションキーが単一の値である場合に、MergeTree への挿入を高速化しました。 [#72348](https://github.com/ClickHouse/ClickHouse/pull/72348) ([alesapin](https://github.com/alesapin)).
* 新しい `MergeTreeIndexGranularityInternalArraysTotalSize` メトリクスを `system.metrics` に追加しました。このメトリクスは、大規模なデータセットを持ち、高いメモリ使用量の問題が発生しやすいインスタンスを特定するために必要です。 [#72490](https://github.com/ClickHouse/ClickHouse/pull/72490) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* クエリで `Format Null` を使用する場合、`Null` という単語のあらゆる表記ゆれが認識されるようになりました。以前は他の表記（例: `NULL`）でも例外はスローされませんでしたが、その一方で、そのような場合にフォーマット `Null` は実際には使用されていませんでした。 [#72658](https://github.com/ClickHouse/ClickHouse/pull/72658) ([Nikita Taranov](https://github.com/nickitat)).
* Enum に存在しない未知の値を set 内で許可するようにしました。[#72662](https://github.com/ClickHouse/ClickHouse/issues/72662) を修正。[#72686](https://github.com/ClickHouse/ClickHouse/pull/72686)（[zhanglistar](https://github.com/zhanglistar)）。
* 非アクティブなパーツの合計バイト数をカウントするために、`system.tables` に `total_bytes_with_inactive` を追加しました。 [#72690](https://github.com/ClickHouse/ClickHouse/pull/72690) ([Kai Zhu](https://github.com/nauu))。
* MergeTreeSettings を system.settings&#95;changes に追加しました。[#72694](https://github.com/ClickHouse/ClickHouse/pull/72694)（[Raúl Marín](https://github.com/Algunenano)）。
* Enum データ型に対する文字列検索演算子（例: LIKE）のサポートを追加し、[#72661](https://github.com/ClickHouse/ClickHouse/issues/72661) を修正しました。 [#72732](https://github.com/ClickHouse/ClickHouse/pull/72732)（[zhanglistar](https://github.com/zhanglistar)）。
* `notEmpty` 関数で `JSON` 型をサポートしました。 [#72741](https://github.com/ClickHouse/ClickHouse/pull/72741) ([Pavel Kruglov](https://github.com/Avogar))。
* GCS S3 エラー `AuthenticationRequired` の解析をサポートしました。[#72753](https://github.com/ClickHouse/ClickHouse/pull/72753)（[Vitaly Baranov](https://github.com/vitlibar)）。
* `ifNull` および `coalesce` 関数で `Dynamic` 型をサポート。 [#72772](https://github.com/ClickHouse/ClickHouse/pull/72772) ([Pavel Kruglov](https://github.com/Avogar)).
* `JoinBuildTableRowCount/JoinProbeTableRowCount/JoinResultRowCount` プロファイルイベントを追加しました。 [#72842](https://github.com/ClickHouse/ClickHouse/pull/72842) ([Vladimir Cherkasov](https://github.com/vdimir)).
* toFloat64/toUInt32 などの関数で Dynamic 型をサポートしました。 [#72989](https://github.com/ClickHouse/ClickHouse/pull/72989) ([Pavel Kruglov](https://github.com/Avogar)).





## バグ修正（公式安定版リリースにおけるユーザーが確認可能な不具合） {#bug-fix}


* `ATTACH PART` クエリ中に重複排除されたパーツが、`attaching_` プレフィックスが付いたまま残り続けることがなくなりました。 [#65636](https://github.com/ClickHouse/ClickHouse/pull/65636) ([Kirill](https://github.com/kirillgarbar)).
* `IN` 関数で DateTime64 型が精度を失う不具合を修正。 [#67230](https://github.com/ClickHouse/ClickHouse/pull/67230) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* `ORDER BY ... WITH FILL` 内で `IGNORE/RESPECT NULLS` を使用した場合に発生しうる論理エラーを修正し、[#57609](https://github.com/ClickHouse/ClickHouse/issues/57609) をクローズしました。[#68234](https://github.com/ClickHouse/ClickHouse/pull/68234)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* メモリ制限に達した場合に、`Native` フォーマットでの非同期挿入でまれに発生していた論理エラーを修正しました。 [#68965](https://github.com/ClickHouse/ClickHouse/pull/68965) ([Anton Popov](https://github.com/CurtizJ)).
* EPHEMERAL 列の `CREATE TABLE` における `COMMENT` を修正しました。 [#70458](https://github.com/ClickHouse/ClickHouse/pull/70458) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* LowCardinality(Nullable) を使用する JSONExtract の論理エラーを修正。 [#70549](https://github.com/ClickHouse/ClickHouse/pull/70549) ([Pavel Kruglov](https://github.com/Avogar))。
* テーブル名が長すぎる場合の挙動を修正しました。 [#70810](https://github.com/ClickHouse/ClickHouse/pull/70810) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* URL エンジンで、ユーザー指定ヘッダーによって Content-Type を上書きできる機能を追加しました。 [#70859](https://github.com/ClickHouse/ClickHouse/pull/70859) ([Artem Iurin](https://github.com/ortyomka)).
* `StorageS3Queue` の論理エラー「/processed に永続ノードを作成できません。すでに存在しています」を修正。[#70984](https://github.com/ClickHouse/ClickHouse/pull/70984)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* projection の lightweight delete の rebuild オプションで `_row_exists` 列が考慮されていなかったバグを修正。 [#71089](https://github.com/ClickHouse/ClickHouse/pull/71089) ([Shichao Jin](https://github.com/jsc0218)).
* 予期しないレースコンディションにより `system.query_metric_log` に誤った値が記録される問題を修正しました。 [#71124](https://github.com/ClickHouse/ClickHouse/pull/71124) ([Pablo Marcos](https://github.com/pamarcos)).
* quantileExactWeightedInterpolated の集計関数名の不整合を修正しました。このバグは [https://github.com/ClickHouse/ClickHouse/pull/69619](https://github.com/ClickHouse/ClickHouse/pull/69619) で発生しました。cc @Algunenano。[#71168](https://github.com/ClickHouse/ClickHouse/pull/71168)（[李扬](https://github.com/taiyang-li)）。
* 関数の比較において Dynamic の使用時に発生する bad&#95;weak&#95;ptr 例外を修正しました。 [#71183](https://github.com/ClickHouse/ClickHouse/pull/71183) ([Pavel Kruglov](https://github.com/Avogar)).
* ReplicatedMergeTree でゼロコピー複製を使用しているノードが存在する場合は、BLOB を削除しないようにしました。 [#71186](https://github.com/ClickHouse/ClickHouse/pull/71186) ([Antonio Andelic](https://github.com/antonio2368))。
* HTTP および Async Inserts 経由の Native フォーマットでフォーマット設定が無視される問題を修正しました。 [#71193](https://github.com/ClickHouse/ClickHouse/pull/71193) ([Pavel Kruglov](https://github.com/Avogar)).
* `use_query_cache = 1` が設定された SELECT クエリで、システムテーブル名がリテラルとして現れる場合でも、クエリが拒否されなくなりました。たとえば、`SELECT - FROM users WHERE name = 'system.metrics' SETTINGS use_query_cache = true;` が実行可能になりました。 [#71254](https://github.com/ClickHouse/ClickHouse/pull/71254) ([Robert Schulze](https://github.com/rschu1ze))。
* enable&#95;filesystem&#95;cache=1 が有効化されているにもかかわらず、storage configuration 内のディスクに cache configuration が存在しない場合に、メモリ使用量が増加してしまうバグを修正しました。 [#71261](https://github.com/ClickHouse/ClickHouse/pull/71261) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Dynamic カラムから LowCardinality 辞書をデシリアライズする際に発生しうる「Cannot read all data」エラーを修正。 [#71299](https://github.com/ClickHouse/ClickHouse/pull/71299) ([Pavel Kruglov](https://github.com/Avogar))。
* クライアントにおける並列出力フォーマットのクリーンアップが不完全だった問題を修正。 [#71304](https://github.com/ClickHouse/ClickHouse/pull/71304) ([Raúl Marín](https://github.com/Algunenano))。
* 名前付きコレクションで不足していたアンエスケープ処理を追加しました。この修正がないと clickhouse-server は起動できません。 [#71308](https://github.com/ClickHouse/ClickHouse/pull/71308) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* ネイティブプロトコル経由で、空ブロックを伴う非同期挿入を修正しました。 [#71312](https://github.com/ClickHouse/ClickHouse/pull/71312) ([Anton Popov](https://github.com/CurtizJ)).
* 誤ったワイルドカード権限の付与時に発生する AST フォーマットの不整合を修正 [#71309](https://github.com/ClickHouse/ClickHouse/issues/71309)。 [#71332](https://github.com/ClickHouse/ClickHouse/pull/71332) ([pufit](https://github.com/pufit))。
* JSON 型ヒント内の疑わしい型および実験的な型を検査するようにしました。 [#71369](https://github.com/ClickHouse/ClickHouse/pull/71369) ([Pavel Kruglov](https://github.com/Avogar)).
* Variant カラムを含む Chunk における行数不正エラーを修正。 [#71388](https://github.com/ClickHouse/ClickHouse/pull/71388) ([Pavel Kruglov](https://github.com/Avogar))。
* 誤った引数（例: `NULL`）を渡した場合に `mongodb` テーブル関数がクラッシュする不具合を修正。[#71426](https://github.com/ClickHouse/ClickHouse/pull/71426)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* optimize&#95;rewrite&#95;array&#95;exists&#95;to&#95;has で発生するクラッシュを修正。 [#71432](https://github.com/ClickHouse/ClickHouse/pull/71432) ([Raúl Marín](https://github.com/Algunenano)).
* palin&#95;rewritable ディスクでディレクトリの作成に失敗した際のトランザクションロールバック中に発生する NoSuchKey エラーを修正。 [#71439](https://github.com/ClickHouse/ClickHouse/pull/71439) ([Julia Kartseva](https://github.com/jkartseva)).
* 挿入時における `max_insert_delayed_streams_for_parallel_write` 設定の扱いを修正しました。以前は誤った動作をしており、複数パーティションにデータを書き込む挿入でメモリ使用量が増大する可能性がありました。 [#71474](https://github.com/ClickHouse/ClickHouse/pull/71474) ([Anton Popov](https://github.com/CurtizJ)).
* `arrayJoin` が `WHERE` 句内に現れる可能性がある場合に発生しうる `Argument for function must be constant`（旧アナライザー）のエラーを修正しました。[https://github.com/ClickHouse/ClickHouse/pull/65414](https://github.com/ClickHouse/ClickHouse/pull/65414) によるリグレッションです。[#71476](https://github.com/ClickHouse/ClickHouse/pull/71476)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* SortCursor における列数 0 の場合のクラッシュを防止（旧アナライザー）。[#71494](https://github.com/ClickHouse/ClickHouse/pull/71494)（[Raúl Marín](https://github.com/Algunenano)）。
* 初期化されていない ORC データが原因で発生する Date32 の範囲外エラーを修正しました。詳細については [https://github.com/apache/incubator-gluten/issues/7823](https://github.com/apache/incubator-gluten/issues/7823) を参照してください。 [#71500](https://github.com/ClickHouse/ClickHouse/pull/71500)（[李扬](https://github.com/taiyang-li)）。
* Dynamic 型および JSON 型に対して、ワイドパートにおけるカラムサイズのカウント処理を修正しました。 [#71526](https://github.com/ClickHouse/ClickHouse/pull/71526) ([Pavel Kruglov](https://github.com/Avogar)).
* マテリアライズドビュー内のクエリが CTE とともに IN を使用している場合における Analyzer の不具合を修正。[#65598](https://github.com/ClickHouse/ClickHouse/issues/65598) をクローズ。[#71538](https://github.com/ClickHouse/ClickHouse/pull/71538)（[Maksim Kita](https://github.com/kitaisreal)）。
* 範囲外の場合にエラーをスローする代わりに、`bitShift` 関数が 0 またはデフォルトの文字を返すようにしました。 [#71580](https://github.com/ClickHouse/ClickHouse/pull/71580) ([Pablo Marcos](https://github.com/pamarcos))。
* 特定のエンジンを使用したマテリアライズドビューで発生していたサーバークラッシュを修正しました。 [#71593](https://github.com/ClickHouse/ClickHouse/pull/71593) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* 定数配列へのエイリアスを含むネストされたデータ構造に対する array join により、ヌルポインタのデリファレンスが発生していました。これにより [#71677](https://github.com/ClickHouse/ClickHouse/issues/71677) が解決されました。[#71678](https://github.com/ClickHouse/ClickHouse/pull/71678)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 空のタプルを使った ALTER 実行時に発生する LOGICAL&#95;ERROR を修正しました。これにより [#71647](https://github.com/ClickHouse/ClickHouse/issues/71647) が解決されます。 [#71679](https://github.com/ClickHouse/ClickHouse/pull/71679)（[Amos Bird](https://github.com/amosbird)）。
* `NOT IN` 演算子を使用している場合、パーティション列に対する述語内の定数集合を変換しないようにしました。 [#71695](https://github.com/ClickHouse/ClickHouse/pull/71695) ([Eduard Karacharov](https://github.com/korowa)).
* LowCardinality(Nullable) から Dynamic への CAST を修正しました。以前は `Bad cast from type DB::ColumnVector<int> to DB::ColumnNullable` というエラーが発生する可能性がありました。 [#71742](https://github.com/ClickHouse/ClickHouse/pull/71742) ([Pavel Kruglov](https://github.com/Avogar)).
* DateTime64 型の主キーに対する WHERE 条件で `toDayOfWeek` を使用した際に発生する例外を修正しました。 [#71849](https://github.com/ClickHouse/ClickHouse/pull/71849) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* スパースカラムへのパース後のデフォルト値の補完処理を修正しました。 [#71854](https://github.com/ClickHouse/ClickHouse/pull/71854) ([Anton Popov](https://github.com/CurtizJ)).
* 分散テーブルで入力が ALIAS の場合に発生する GROUPING 関数のエラーを修正し、[#68602](https://github.com/ClickHouse/ClickHouse/issues/68602) をクローズ。[#71855](https://github.com/ClickHouse/ClickHouse/pull/71855)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* `WITH TIES` 句を使用する `SELECT` 文で、十分な行数が返らない場合がある問題を修正しました。 [#71886](https://github.com/ClickHouse/ClickHouse/pull/71886) ([wxybear](https://github.com/wxybear)).
* arrayWithConstant の評価時に、あるカラムが配列サイズの上限を超えていると誤って判定され、その結果発生していた TOO&#95;LARGE&#95;ARRAY&#95;SIZE 例外を修正しました。 [#71894](https://github.com/ClickHouse/ClickHouse/pull/71894) ([Udi](https://github.com/udiz)).
* `clickhouse-benchmark` は、1 秒を超えるクエリに対して誤ったメトリクスを報告していました。[#71898](https://github.com/ClickHouse/ClickHouse/pull/71898) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* clickhouse-client における進捗インジケーターと進捗テーブル間のデータ競合を修正しました。この問題は FROM INFILE が使用される場合に発生します。INSERT クエリの実行中にキーストロークを取得し、進捗テーブルの表示を切り替えられるようにしました。 [#71901](https://github.com/ClickHouse/ClickHouse/pull/71901) ([Julia Kartseva](https://github.com/jkartseva)).
* Pretty JSON フォーマットにおける Dynamic 値のシリアライズ処理を修正。 [#71923](https://github.com/ClickHouse/ClickHouse/pull/71923) ([Pavel Kruglov](https://github.com/Avogar)).
* 24.6 で不具合が発生していた system.s3/azure&#95;queue&#95;log の rows&#95;processed 列を修正。[#69975](https://github.com/ClickHouse/ClickHouse/issues/69975) をクローズ。[#71946](https://github.com/ClickHouse/ClickHouse/pull/71946)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* `s3` / `s3Cluster` 関数が不完全な結果を返したり、例外をスローしたりする可能性があった問題を修正しました。これは、s3 URI でグロブパターン（`pattern/*` のような）を使用し、かつキー `pattern/` を持つ空オブジェクトが存在している必要がある場合（そのようなオブジェクトは S3 コンソールによって自動的に作成されます）に発生していました。また、設定 `s3_skip_empty_files` のデフォルト値を `false` から `true` に変更しました。 [#71947](https://github.com/ClickHouse/ClickHouse/pull/71947) ([Nikita Taranov](https://github.com/nickitat))。
* clickhouse-client の構文ハイライトで発生していたクラッシュを修正。[#71864](https://github.com/ClickHouse/ClickHouse/issues/71864) をクローズ。 [#71949](https://github.com/ClickHouse/ClickHouse/pull/71949)（[Nikolay Degterinsky](https://github.com/evillique)）。
* `ORDER BY` で最初の引数が定数となるバイナリ単調関数を使用した `MergeTree` テーブルで発生する `Illegal type` エラーを修正。[#71941](https://github.com/ClickHouse/ClickHouse/issues/71941) を修正。[#71966](https://github.com/ClickHouse/ClickHouse/pull/71966)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* サブクエリ内で使用される EXPLAIN AST では SELECT クエリのみを許可します。その他のタイプのクエリを使用すると、論理エラー &#39;Bad cast from type DB::ASTCreateQuery to DB::ASTSelectWithUnionQuery&#39; または `Inconsistent AST formatting` が発生します。 [#71982](https://github.com/ClickHouse/ClickHouse/pull/71982) ([Pavel Kruglov](https://github.com/Avogar))。
* `clickhouse-client` でレコードを挿入する際、クライアントはサーバーからカラム定義を読み取ります。しかし、記述の順序を誤って書き出してしまうバグがありました。本来は [statistics, ttl, settings] の順序であるべきです。 [#71991](https://github.com/ClickHouse/ClickHouse/pull/71991) ([Han Fei](https://github.com/hanfei1991)).
* `format_alter_commands_with_parentheses` が有効な場合に、`MOVE PARTITION ... TO TABLE ...` ALTER コマンドのフォーマットを修正しました。 [#72080](https://github.com/ClickHouse/ClickHouse/pull/72080) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
* File/S3/URL/HDFS/Azure エンジンの `CREATE` クエリに、推論されたフォーマット名を含めるようにしました。以前はサーバーが再起動されるたびにフォーマット名を推論しており、指定されたデータファイルが削除されていると、サーバー起動時にエラーが発生していました。[#72108](https://github.com/ClickHouse/ClickHouse/pull/72108)（[Pavel Kruglov](https://github.com/Avogar)）。
* `min_age_to_force_merge_on_partition_only` が、すでに 1 パートにマージ済みの同じパーティションを繰り返しマージしようとして処理が停止し、複数パートを持つパーティションをマージしない不具合を修正しました。 [#72209](https://github.com/ClickHouse/ClickHouse/pull/72209) ([Christoph Wurm](https://github.com/cwurm)).
* 疎なカラムを処理する際にまれに発生していた `SimpleSquashingChunksTransform` のクラッシュを修正しました。 [#72226](https://github.com/ClickHouse/ClickHouse/pull/72226) ([Vladimir Cherkasov](https://github.com/vdimir)).
* `GraceHashJoin` におけるデータレースを修正しました。この不具合により、結合結果から一部の行が欠落する可能性がありました。 [#72233](https://github.com/ClickHouse/ClickHouse/pull/72233) ([Nikita Taranov](https://github.com/nickitat)).
* マテリアライズドされた `_block_number` 列（`enable_block_number_column` 設定が有効な場合）を使用する `ALTER DELETE` クエリの問題を修正しました。 [#72261](https://github.com/ClickHouse/ClickHouse/pull/72261) ([Anton Popov](https://github.com/CurtizJ)).
* `ColumnDynamic::dumpStructure()` が、たとえば `ConcurrentHashJoin` のコンストラクタ内などで同時に呼び出された場合に発生するデータレースを修正しました。 [#72278](https://github.com/ClickHouse/ClickHouse/pull/72278) ([Nikita Taranov](https://github.com/nickitat))。
* `ORDER BY ... WITH FILL` における重複列が原因で発生しうる `LOGICAL_ERROR` を修正。 [#72387](https://github.com/ClickHouse/ClickHouse/pull/72387) ([Vladimir Cherkasov](https://github.com/vdimir)).
* `optimize_functions_to_subcolumns` 適用後に、いくつかのケースで発生していた型の不一致を修正しました。 [#72394](https://github.com/ClickHouse/ClickHouse/pull/72394) ([Anton Popov](https://github.com/CurtizJ))。
* `BACKUP DATABASE db EXCEPT TABLES db.table` クエリのパース時に発生していたエラーを修正しました。 [#72429](https://github.com/ClickHouse/ClickHouse/pull/72429) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 空の Variant を作成できないようにしました。 [#72454](https://github.com/ClickHouse/ClickHouse/pull/72454) ([Pavel Kruglov](https://github.com/Avogar))。
* `system.merges` における `result_part_path` の無効なフォーマットを修正しました。 [#72567](https://github.com/ClickHouse/ClickHouse/pull/72567) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 1 要素のみを持つ glob のパースを修正。 [#72572](https://github.com/ClickHouse/ClickHouse/pull/72572) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* ARRAY JOIN を含む分散クエリにおいて、フォロワーサーバー用のクエリ生成を修正。 [#69276](https://github.com/ClickHouse/ClickHouse/issues/69276) を修正。 [#72608](https://github.com/ClickHouse/ClickHouse/pull/72608)（[Dmitry Novik](https://github.com/novikd)）。
* DateTime64 が DateTime64 で何も返さないバグを修正しました。 [#72640](https://github.com/ClickHouse/ClickHouse/pull/72640) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* S3Queue の Unordered モードで、`tracked_files_limit` 設定値が S3 ファイルの出現頻度より小さい場合に発生する「No such key」エラーを修正しました。 [#72738](https://github.com/ClickHouse/ClickHouse/pull/72738) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `mark cache` の削除は、そのサイズが大きい場合には、かなりの時間がかかることがあります。この処理の間 `context mutex` を保持し続けると、多くの他の処理がブロックされてしまい、新しいクライアント接続でさえ、この `mutex` が解放されるまで確立できません。また、同期のためにこの `mutex` を保持しておく必要は実際にはなく、`shared ptr` を通じてキャッシュへのローカル参照を持っていれば十分です。 [#72749](https://github.com/ClickHouse/ClickHouse/pull/72749) ([Alexander Gololobov](https://github.com/davenger))。
* あるテストインスタンスで、PK キャッシュが自身のサイズを大きく過小評価していました。特に、LowCardinality 列ではディクショナリのサイズが計上されていませんでした。修正としては、column-&gt;allocatedBytes() に、キャッシュエントリサイズ向けの追加のオーバーヘッド見積もりを加えて使用するようにしました。 [#72750](https://github.com/ClickHouse/ClickHouse/pull/72750) ([Alexander Gololobov](https://github.com/davenger))。
* ローカルにユーザーが存在しない場合に `RemoteQueryExecutor` でスローされる例外を修正。 [#72759](https://github.com/ClickHouse/ClickHouse/pull/72759) ([Andrey Zvonov](https://github.com/zvonand))。
* `enable_block_number_column` 設定が有効な場合に、マテリアライズされた `_block_number` カラムに対するミューテーションの問題を修正しました。 [#72854](https://github.com/ClickHouse/ClickHouse/pull/72854) ([Anton Popov](https://github.com/CurtizJ)).
* バックアップに空のファイルが含まれている場合に、プレーンな書き換え可能ディスクでのバックアップ／リストア処理が正しく動作するよう修正。 [#72858](https://github.com/ClickHouse/ClickHouse/pull/72858) ([Kseniia Sumarokova](https://github.com/kssenii)).
* DistributedAsyncInsertDirectoryQueue において、挿入のキャンセルが正しく行われるようにしました。 [#72885](https://github.com/ClickHouse/ClickHouse/pull/72885) ([Antonio Andelic](https://github.com/antonio2368)).
* 誤ったデータをスパースカラムにパースする際に発生していたクラッシュを修正しました（設定 `enable_parsing_to_custom_serialization` が有効な場合に発生する可能性があります）。 [#72891](https://github.com/ClickHouse/ClickHouse/pull/72891) ([Anton Popov](https://github.com/CurtizJ)).
* バックアップ復元中に発生する可能性のあるクラッシュを修正。 [#72947](https://github.com/ClickHouse/ClickHouse/pull/72947) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `ON` 句に不等号フィルターを含む複雑な条件がある場合に発生する可能性があった `parallel_hash` JOIN メソッドのバグを修正しました。 [#72993](https://github.com/ClickHouse/ClickHouse/pull/72993) ([Nikita Taranov](https://github.com/nickitat)).
* JSON のパース時にはデフォルトのフォーマット設定を使用して、デシリアライズの不具合を回避します。 [#73043](https://github.com/ClickHouse/ClickHouse/pull/73043) ([Pavel Kruglov](https://github.com/Avogar)).
* サポートされていないストレージを使用するトランザクションで発生していたクラッシュを修正。 [#73045](https://github.com/ClickHouse/ClickHouse/pull/73045) ([Raúl Marín](https://github.com/Algunenano)).
* Tuple のパース時に重複した JSON キーをチェックするようにしました。以前は、パース中に論理エラー `Invalid number of rows in Chunk` を引き起こす可能性がありました。[#73082](https://github.com/ClickHouse/ClickHouse/pull/73082)（[Pavel Kruglov](https://github.com/Avogar)）。
