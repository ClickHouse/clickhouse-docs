---
slug: /changelogs/24.12
title: 'v24.12 Cloud 向け変更履歴'
description: 'v24.12 の高速リリース向け変更履歴'
keywords: ['changelog', 'cloud']
sidebar_label: '24.12'
sidebar_position: 4
doc_type: 'changelog'
---

v24.12 リリースに基づく ClickHouse Cloud サービス向けの主な変更点。



## 後方互換性のない変更 {#backward-incompatible-changes}

- 関数`greatest`と`least`は、NULL入力値を無視するようになりました。以前は、引数の1つがNULLの場合にNULLを返していました。例えば、`SELECT greatest(1, 2, NULL)`は現在2を返します。この動作によりPostgreSQLとの互換性が確保されます。[#65519](https://github.com/ClickHouse/ClickHouse/pull/65519) ([kevinyhzou](https://github.com/KevinyhZou))。
- 予期しない結果につながる可能性があるため、デフォルトではORDER BY/GROUP BY/PARTITION BY/PRIMARY KEYでVariant/Dynamic型を許可しないようにしました。[#69731](https://github.com/ClickHouse/ClickHouse/pull/69731) ([Pavel Kruglov](https://github.com/Avogar))。
- システムテーブル`generate_series`と`generateSeries`を削除しました。これらは誤って追加されたものです:[#59390](https://github.com/ClickHouse/ClickHouse/issues/59390)。[#71091](https://github.com/ClickHouse/ClickHouse/pull/71091) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `StorageExternalDistributed`を削除しました。クローズ[#70600](https://github.com/ClickHouse/ClickHouse/issues/70600)。[#71176](https://github.com/ClickHouse/ClickHouse/pull/71176) ([flynn](https://github.com/ucasfl))。
- サーバー設定(users.xml)の設定がクライアントにも適用されるようになりました。フォーマット設定(例:`date_time_output_format`)に有用です。[#71178](https://github.com/ClickHouse/ClickHouse/pull/71178) ([Michael Kolupaev](https://github.com/al13n321))。
- JSONサブカラムのファイル内でエスケープされていない特殊記号による`No such file or directory`エラーの可能性を修正しました。[#71182](https://github.com/ClickHouse/ClickHouse/pull/71182) ([Pavel Kruglov](https://github.com/Avogar))。
- テーブルエンジンKafka、NATS、RabbitMQは、`SOURCES`階層内で独自の権限でカバーされるようになりました。これらのエンジンタイプでテーブルを作成するデフォルト以外のデータベースユーザーに権限を追加してください。[#71250](https://github.com/ClickHouse/ClickHouse/pull/71250) ([Christoph Wurm](https://github.com/cwurm))。
- 実行前にミューテーションクエリ全体(サブクエリを含む)をチェックするようにしました。これにより、無効なクエリを誤って実行し、有効なミューテーションをブロックするデッドミューテーションが蓄積されることを防ぎます。[#71300](https://github.com/ClickHouse/ClickHouse/pull/71300) ([Christoph Wurm](https://github.com/cwurm))。
- ファイルシステムキャッシュ設定`skip_download_if_exceeds_query_cache`を`filesystem_cache_skip_download_if_exceeds_per_query_cache_write_limit`に名前変更しました。[#71578](https://github.com/ClickHouse/ClickHouse/pull/71578) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 混乱を避けるため、min/max関数でDynamic/Variant型を禁止しました。[#71761](https://github.com/ClickHouse/ClickHouse/pull/71761) ([Pavel Kruglov](https://github.com/Avogar))。
- `deltaSumTimestamp`における`Enum`、`UInt128`、`UInt256`引数のサポートを削除しました。`deltaSumTimestamp`の第2引数("timestamp")の`Int8`、`UInt8`、`Int16`、`UInt16`のサポートを削除しました。[#71790](https://github.com/ClickHouse/ClickHouse/pull/71790) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ClickHouseがディクショナリのソースとして使用される場合のソースクエリ検証を追加しました。[#72548](https://github.com/ClickHouse/ClickHouse/pull/72548) ([Alexey Katsman](https://github.com/alexkats))。


## 新機能 {#new-features}


* 指定したテーブル内のすべてのパーツ、またはテーブルを指定しなかった場合はすべてのテーブルに対してプライマリインデックスをロードする `SYSTEM LOAD PRIMARY KEY` コマンドを実装しました。これはベンチマークの実施に役立ち、クエリ実行時の追加レイテンシーを防ぐのに有用です。 [#66252](https://github.com/ClickHouse/ClickHouse/pull/66252) ([ZAWA&#95;ll](https://github.com/Zawa-ll)).
* 指定したテーブルのすべてのパーツのプライマリインデックス、またはテーブルを指定しない場合はすべてのテーブルのプライマリインデックスをロードするステートメント `SYSTEM LOAD PRIMARY KEY` を追加しました。これは、ベンチマークやクエリ実行時の追加レイテンシーを防ぐのに役立ちます。 [#67733](https://github.com/ClickHouse/ClickHouse/pull/67733) ([ZAWA&#95;ll](https://github.com/Zawa-ll)).
* `CHECK GRANT` クエリを追加し、現在のユーザーまたはロールに特定の権限が付与されているかどうか、および対応するテーブル／列がメモリ内に存在するかどうかを確認できるようにしました。 [#68885](https://github.com/ClickHouse/ClickHouse/pull/68885) ([Unalian](https://github.com/Unalian))。
* ワークロードおよびリソース管理を定義するための SQL 構文を追加しました。 [https://clickhouse.com/docs/en/operations/workload-scheduling](https://clickhouse.com/docs/en/operations/workload-scheduling)。 [#69187](https://github.com/ClickHouse/ClickHouse/pull/69187)（[Sergei Trifonov](https://github.com/serxa)）。
* [Iceberg データストレージフォーマット](https://iceberg.apache.org/spec/#file-system-operations) は、テーブルのスキーマを変更するための多様なオプションをユーザーに提供します。このプルリクエストでは、列の順序、列名、および単純な型の拡張が変更された Iceberg フォーマットのテーブルを読み込む機能が実装されました。 [#69445](https://github.com/ClickHouse/ClickHouse/pull/69445) ([Daniil Ivanik](https://github.com/divanik))。
* 各認証方式ごとに有効期限を個別に設定できるようにし、ユーザーエンティティから有効期限を削除しました。 [#70090](https://github.com/ClickHouse/ClickHouse/pull/70090) ([Arthur Passos](https://github.com/arthurpassos)).
* クエリ発行元からクラスタ内の他のノードへ外部ユーザーロールをプッシュできるようにしました。外部認証基盤（LDAP など）にアクセスできるのが発行元のみである場合に有用です。 [#70332](https://github.com/ClickHouse/ClickHouse/pull/70332) ([Andrey Zvonov](https://github.com/zvonand)).
* String から JSON への ALTER をサポートしました。この PR では、JSON 型および Dynamic 型のシリアル化を新バージョンの V2 に変更しています。旧バージョンの V1 も、設定 `merge_tree_use_v1_object_and_dynamic_serialization` を有効にすることで引き続き使用できます（アップグレード時に、問題なくバージョンをロールバックできるようにするために利用できます）。[#70442](https://github.com/ClickHouse/ClickHouse/pull/70442)（[Pavel Kruglov](https://github.com/Avogar)）。
* `DateTime64` を秒精度で固定された `Int64` 値に変換する `toUnixTimestamp64Second` 関数を追加しました。これにより、日時が 1970 年 1 月 1 日木曜日 00:00:00 UTC より前の場合に、負の値を返せるようになりました。 [#70597](https://github.com/ClickHouse/ClickHouse/pull/70597) ([zhanglistar](https://github.com/zhanglistar)).
* 新しい設定項目 `enforce_index_structure_match_on_partition_manipulation` を追加し、ソーステーブルのプロジェクションとセカンダリインデックスがターゲットテーブルのそれらの部分集合となっている場合に `ATTACH` を許可するようにしました。[#70602](https://github.com/ClickHouse/ClickHouse/issues/70602) をクローズ。[#70603](https://github.com/ClickHouse/ClickHouse/pull/70603) ([zwy991114](https://github.com/zwy991114))。
* 関数 `cast` の出力が Apache Spark と異なるため、Gluten プロジェクトに差分が生じています。詳細は [https://github.com/apache/incubator-gluten/issues/7602](https://github.com/apache/incubator-gluten/issues/7602) を参照してください。この PR では Spark のテキスト出力形式をサポートする機能を追加しましたが、デフォルトでは無効になっています。 [#70957](https://github.com/ClickHouse/ClickHouse/pull/70957) ([zhanglistar](https://github.com/zhanglistar))。
* ユーザー認証用の S3 エンドポイント向けに、新しいヘッダー種別（`access_header`）を追加しました。これにより、最も低い優先度でアクセスヘッダーを取得でき、その値は他の任意のソース（たとえばテーブルスキーマや名前付きコレクション）から提供される `access_key_id` によって上書きされます。 [#71011](https://github.com/ClickHouse/ClickHouse/pull/71011) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。
* 設定階層の初期実装。 [#71145](https://github.com/ClickHouse/ClickHouse/pull/71145) ([Raúl Marín](https://github.com/Algunenano))
* `fill` 演算子を使用した `ORDER BY` に `staleness` 句のサポートを追加しました。 [#71151](https://github.com/ClickHouse/ClickHouse/pull/71151) ([Mikhail Artemenko](https://github.com/Michicosun))。
* JSON 文字列とのシリアライズ／デシリアライズを通じて、Map/Tuple/Object から新しい JSON 型への単純な CAST を実装。 [#71320](https://github.com/ClickHouse/ClickHouse/pull/71320) ([Pavel Kruglov](https://github.com/Avogar))。
* 集約関数 `any` に対して、エイリアス `anyRespectNulls`、`firstValueRespectNulls`、`anyValueRespectNulls` を追加しました。また、集約関数 `anyLast` に対して、エイリアス `anyLastRespectNulls` と `lastValueRespectNulls` を追加しました。これにより、例えば `anyLast_respect_nullsStateIf` ではなく `SELECT anyLastRespectNullsStateIf` のような、キャメルケースのみからなるより自然な構文を使用できるようになりました。[#71403](https://github.com/ClickHouse/ClickHouse/pull/71403)（[Peter Nguyen](https://github.com/petern48)）。
* JSON ログのフォーマットで RFC 3339/ISO8601 形式の UTC 日時をサポートするための設定パラメータ `date_time_utc` を追加しました。 [#71560](https://github.com/ClickHouse/ClickHouse/pull/71560) ([Ali](https://github.com/xogoodnow)).
* クエリプラン上で、どちらの結合側をインナー（ビルド）テーブルとして扱うかを選択できるオプションを追加しました。これは `query_plan_join_swap_table` によって制御され、`auto` に設定できます。このモードでは、ClickHouse は行数が最も少ないテーブルを選択するよう試みます。 [#71577](https://github.com/ClickHouse/ClickHouse/pull/71577) ([Vladimir Cherkasov](https://github.com/vdimir))。
* パートのグラニュラリティが一定の場合に、インデックスグラニュラリティ値のメモリ使用量を最適化しました。常にパートに対して一定のグラニュラリティを選択できるようにする機能（設定 `use_const_adaptive_granularity`）を追加し、メモリ上で常に最適化された状態を保てるようにしました。これにより、大規模なワークロード（共有ストレージ上の数兆行）において、データパートのメタデータ（インデックスグラニュラリティ値）によるメモリ使用量の継続的な増加を防ぐことができます。 [#71786](https://github.com/ClickHouse/ClickHouse/pull/71786) ([Anton Popov](https://github.com/CurtizJ)).
* `allowed_feature_tier` をグローバルスイッチとして実装し、すべての実験的機能／ベータ機能を無効化できるようにしました。 [#71841](https://github.com/ClickHouse/ClickHouse/pull/71841) ([Raúl Marín](https://github.com/Algunenano)).
* `iceberg[S3;HDFS;Azure]Cluster`、`deltaLakeCluster`、`hudiCluster` テーブル関数を追加しました。 [#72045](https://github.com/ClickHouse/ClickHouse/pull/72045) ([Mikhail Artemenko](https://github.com/Michicosun)).
* `ALTER USER {ADD|MODIFY|DROP SETTING}` および `ALTER USER {ADD|DROP PROFILE}` の構文を追加し、`ALTER ROLE` と `ALTER PROFILE` にも同様の構文を追加しました。 [#72050](https://github.com/ClickHouse/ClickHouse/pull/72050) ([pufit](https://github.com/pufit)).
* `arrayPrAUC` 関数を追加しました。Precision-Recall 曲線に対する AUC（Area Under the Curve、曲線下面積）を計算します。 [#72073](https://github.com/ClickHouse/ClickHouse/pull/72073) ([Emmanuel](https://github.com/emmanuelsdias))。
* `MergeTree` テーブルのプライマリキーインデックスにキャッシュを追加しました（テーブル設定 `use_primary_key_cache` で有効化可能）。プライマリキーインデックスに対してレイジーロードとキャッシュが有効化されている場合は、常にメモリ上に保持するのではなく、（マークキャッシュと同様に）必要なときにキャッシュへロードされるようになります。データパーツの insert/merge/fetch 時およびテーブルの再起動時にプライマリキーインデックスを事前ウォームアップする機能を追加しました（設定 `prewarm_primary_key_cache` で有効化可能）。[#72102](https://github.com/ClickHouse/ClickHouse/pull/72102) ([Anton Popov](https://github.com/CurtizJ))。
* 配列型向けに `indexOfAssumeSorted` 関数を追加しました。昇順（非減少）でソートされた配列に対する検索を最適化します。 [#72517](https://github.com/ClickHouse/ClickHouse/pull/72517) ([Eric Kurbanov](https://github.com/erickurbanov))。
* 集約関数 `groupConcat` の第 2 引数として、任意の区切り文字を指定できるようになりました。 [#72540](https://github.com/ClickHouse/ClickHouse/pull/72540) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 新しい設定 `http_response_headers` により、HTTP レスポンスヘッダーをカスタマイズできるようになりました。たとえば、データベースに保存されている画像をブラウザに表示させることができます。これにより [#59620](https://github.com/ClickHouse/ClickHouse/issues/59620) がクローズされました。 [#72656](https://github.com/ClickHouse/ClickHouse/pull/72656) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* Int64 の Unix タイムスタンプ値を DateTime64 に変換する関数 `fromUnixTimestamp64Second` を追加。[#73146](https://github.com/ClickHouse/ClickHouse/pull/73146) ([Robert Schulze](https://github.com/rschu1ze)).





## パフォーマンスの向上 {#performance-improvements}


* `short_circuit_function_evaluation_for_nulls` と `short_circuit_function_evaluation_for_nulls_threshold` という 2 つの新しい設定を追加しました。これらにより、データブロック内の NULL 値の割合が指定された閾値を超えた場合、`Nullable` 列に対する関数をショートサーキット方式で実行できます。つまり、関数は NULL 以外の値を持つ行に対してのみ実行されます。この挙動は、少なくとも 1 つの引数が NULL の行に対しては NULL 値を返す関数にのみ適用されます。[#60129](https://github.com/ClickHouse/ClickHouse/pull/60129)（[李扬](https://github.com/taiyang-li)）。
* オブジェクトストレージディスクに対する `clickhouse disks remove --recursive` コマンドのメモリ使用量を削減しました。 [#67323](https://github.com/ClickHouse/ClickHouse/pull/67323) ([Kirill](https://github.com/kirillgarbar))。
* `join_algorithm='parallel_hash'` の並列処理のためにスレッド間で分配する際に、入力ブロックのカラムをコピーしないようにしました。 [#67782](https://github.com/ClickHouse/ClickHouse/pull/67782) ([Nikita Taranov](https://github.com/nickitat)).
* より多くの式に対して JIT コンパイルを有効化: `abs`/`bitCount`/`sign`/`modulo`/`pmod`/`isNull`/`isNotNull`/`assumeNotNull`/`to(U)Int*`/`toFloat*`、比較関数（`=`, `<`, `>`, `>=`, `<=`）、論理関数（`and`, `or`）。 [#70598](https://github.com/ClickHouse/ClickHouse/pull/70598) ([李扬](https://github.com/taiyang-li)).
* 今後は、`join_algorithm` 設定が `default` に設定されている場合、（該当する場合には）`parallel_hash` アルゴリズムが使用されます。`parallel_hash` が使用できない場合には、これまでの 2 つの代替手段（`direct` と `hash`）が引き続き候補として使用されます。 [#70788](https://github.com/ClickHouse/ClickHouse/pull/70788) ([Nikita Taranov](https://github.com/nickitat))。
* 互いに交差しないパーツに対する `Replacing` マージアルゴリズムを最適化しました。 [#70977](https://github.com/ClickHouse/ClickHouse/pull/70977) ([Anton Popov](https://github.com/CurtizJ)).
* メトリクスおよび system.detached&#95;parts に、readonly ディスクおよび write-once ディスク上の detached parts を含めないようにしました。 [#71086](https://github.com/ClickHouse/ClickHouse/pull/71086) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* デフォルトでは負荷の高い非同期メトリクスを計算しないようにしました。この機能は [#40332](https://github.com/ClickHouse/ClickHouse/issues/40332) で導入されましたが、単一の顧客にしか必要とされない重いバックグラウンドジョブを持つのは適切ではありません。[#71087](https://github.com/ClickHouse/ClickHouse/pull/71087)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* system.query&#95;metric&#95;log の収集間隔に関するクリティカルセクションを短縮することで、パフォーマンスと精度を向上させました。 [#71473](https://github.com/ClickHouse/ClickHouse/pull/71473) ([Pablo Marcos](https://github.com/pamarcos)).
* `WHERE` 式および `ON` 式から共通の式を抽出して、結合時に使用されるハッシュテーブルの数を削減するオプションを追加しました。`optimize_extract_common_expressions = 1` で有効にできます。[#71537](https://github.com/ClickHouse/ClickHouse/pull/71537)（[János Benjamin Antal](https://github.com/antaljanosbenjamin)）。
* `LowCardinality(String)` を使用する `SELECT` でインデックスを使用できるようにしました。 [#71598](https://github.com/ClickHouse/ClickHouse/pull/71598) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 並列レプリカとローカルプランが有効な状態でクエリを実行する際、ワーカー側ではスキップインデックスの解析を行わないようにしました。コーディネーターは、自身側（クエリの発行元）でのインデックス解析に基づいて、ワーカーが読み取る範囲を選択します。 [#72109](https://github.com/ClickHouse/ClickHouse/pull/72109) ([Igor Nikonov](https://github.com/devcrafter))。
* Compact パーツにおける単一カラムのサブカラム読み出しの最適化を、[https://github.com/ClickHouse/ClickHouse/pull/57631](https://github.com/ClickHouse/ClickHouse/pull/57631) から再導入しました。これは誤って削除されていました。 [#72285](https://github.com/ClickHouse/ClickHouse/pull/72285) ([Pavel Kruglov](https://github.com/Avogar))。
* コンパレータ内の仮想関数呼び出しを除去することで、`LowCardinality(String)` 列のソートを高速化しました。 [#72337](https://github.com/ClickHouse/ClickHouse/pull/72337) ([Alexander Gololobov](https://github.com/davenger))。
* いくつかの単純なデータ型に対して `argMin` / `argMax` 関数を最適化しました。 [#72350](https://github.com/ClickHouse/ClickHouse/pull/72350) ([alesapin](https://github.com/alesapin))。
* メモリトラッカーで共有ロックを使用することでロック処理を最適化し、ロック競合を軽減しました。 [#72375](https://github.com/ClickHouse/ClickHouse/pull/72375) ([Jiebin Sun](https://github.com/jiebinn)).
* 新しい設定 `use_async_executor_for_materialized_views` を追加しました。マテリアライズドビューのクエリを非同期で（場合によってはマルチスレッドで）実行し、INSERT 時のビュー処理を高速化できる一方で、より多くのメモリを消費する可能性があります。 [#72497](https://github.com/ClickHouse/ClickHouse/pull/72497) ([alesapin](https://github.com/alesapin))。
* 設定 `max_size_to_preallocate_for_aggregation`、`max_size_to_preallocate_for_joins` のデフォルト値が `10^12` までさらに引き上げられ、これにより最適化が適用されるケースが増えました。 [#72555](https://github.com/ClickHouse/ClickHouse/pull/72555) ([Nikita Taranov](https://github.com/nickitat))。
* 集約関数の状態（データ型 `AggregateFunction` および分散クエリでの利用）のデシリアライズ処理の性能を改善しました。`RowBinary` フォーマットの解析性能もわずかに改善しました。 [#72818](https://github.com/ClickHouse/ClickHouse/pull/72818) ([Anton Popov](https://github.com/CurtizJ)).





## 改善 {#improvement}


* 定数配列およびキャプチャされた引数が定数である高階関数は、定数を返すようになりました。 [#58400](https://github.com/ClickHouse/ClickHouse/pull/58400) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 仮想行を生成することで順序読み込みを最適化し、マージソート時に読み込むデータ量を削減。特に複数のパーツが存在する場合に有効。[#62125](https://github.com/ClickHouse/ClickHouse/pull/62125)（[Shichao Jin](https://github.com/jsc0218)）。
* クエリプランのステップ名（`EXPLAIN PLAN json=1`）およびパイプラインプロセッサ名（`EXPLAIN PIPELINE compact=0,graph=1`）に、一意のIDがサフィックスとして付与されるようになりました。これにより、processors profiler の出力や OpenTelemetry のトレースを、EXPLAIN の出力と対応付けることができます。 [#63518](https://github.com/ClickHouse/ClickHouse/pull/63518) ([qhsong](https://github.com/qhsong))。
* Azure Blob Storage への書き込み後にオブジェクトが存在するかを確認するオプションを追加しました。この動作は `check_objects_after_upload` を設定することで制御できます。 [#64847](https://github.com/ClickHouse/ClickHouse/pull/64847) ([Smita Kulkarni](https://github.com/SmitaRKulkarni))。
* HashTable::destroyElements における use-after-dtor のロジックを修正。 [#65279](https://github.com/ClickHouse/ClickHouse/pull/65279) ([cangyin](https://github.com/cangyin))。
* `clickhouse-local` でデフォルトのデータベースとして `Atomic` を使用します。 [#50647](https://github.com/ClickHouse/ClickHouse/issues/50647) の項目 1 および 5 に対応します。 [#44817](https://github.com/ClickHouse/ClickHouse/issues/44817) をクローズします。 [#68024](https://github.com/ClickHouse/ClickHouse/pull/68024)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 書き込みバッファは、明示的にキャンセルまたはファイナライズする必要があります。例外は、エラーをクライアントに通知するために、HTTP プロトコルに反する形で動作します。 [#68800](https://github.com/ClickHouse/ClickHouse/pull/68800) ([Sema Checherinda](https://github.com/CheSema)).
* replica&#95;dir を作成し、DDLWorker 内でレプリカをアクティブとしてマークすることで、稼働中の DDLWorker ホストを報告できるようにしました。 [#69658](https://github.com/ClickHouse/ClickHouse/pull/69658) ([Tuan Pham Anh](https://github.com/tuanpach)).
* 1. `DDLQueryStatusSource` をリファクタリングする: - `DDLQueryStatusSource` を `DistributedQueryStatusSource` にリネームし、ベースクラスとして定義する - `DDLOnClusterQueryStatusSource` と `ReplicatedDatabaseQueryStatusSource` の 2 つのサブクラスを `DDLQueryStatusSource` から派生させて、それぞれ `DDL ON CLUSTER` およびレプリケーテッドデータベースから DDL タスクのステータスを問い合わせられるようにする。 2. `DDLOnClusterQueryStatusSource` でオフラインホストの待機中止をサポートする。[#69660](https://github.com/ClickHouse/ClickHouse/pull/69660) ([Tuan Pham Anh](https://github.com/tuanpach))。
* 新しいキャンセルロジックを追加: `CancellationChecker` は開始されたすべてのクエリのタイムアウトを監視し、タイムアウトに達した時点でクエリを停止します。 [#69880](https://github.com/ClickHouse/ClickHouse/pull/69880) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* `allow_experimental_join_condition` 設定を削除し、デフォルトで非等値条件を許可します。 [#69910](https://github.com/ClickHouse/ClickHouse/pull/69910) ([Vladimir Cherkasov](https://github.com/vdimir))。
* `parallel_replicas_local_plan` をデフォルトで有効化しました。クエリ発行元ノード上で本格的なローカルプランを構築することで、リソース消費を抑えつつ並列レプリカの性能を向上させ、さらに多くのクエリ最適化を適用できるようにします。 [#70171](https://github.com/ClickHouse/ClickHouse/pull/70171) ([Igor Nikonov](https://github.com/devcrafter))。
* http&#95;handlers（`dynamic_query_handler`/`predefined_query_handler`）でユーザー名/パスワードを設定できる機能を追加しました。 [#70725](https://github.com/ClickHouse/ClickHouse/pull/70725) ([Azat Khuzhin](https://github.com/azat)).
* storage S3Queue において、特定の設定に対して `ALTER TABLE ... MODIFY/RESET SETTING ...` が使用可能になりました。 [#70811](https://github.com/ClickHouse/ClickHouse/pull/70811) ([Kseniia Sumarokova](https://github.com/kssenii))。
* ディレクトリ一覧を取得する際にオブジェクトストレージの API を呼び出すことは避けてください。コスト効率が悪くなる可能性があります。代わりに、ファイル名の一覧をメモリ上に保持してください。この場合のトレードオフは、初期読み込み時間の増加と、ファイル名を保持するために必要なメモリ量の増加です。 [#70823](https://github.com/ClickHouse/ClickHouse/pull/70823) ([Julia Kartseva](https://github.com/jkartseva)).
* `clickhouse-compressor` に `--threads` パラメーターを追加し、データを並列に圧縮できるようにしました。 [#70860](https://github.com/ClickHouse/ClickHouse/pull/70860) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* Replxx クライアントの履歴サイズを設定できるようにしました。 [#71014](https://github.com/ClickHouse/ClickHouse/pull/71014) ([Jiří Kozlovský](https://github.com/jirislav)).
* `prewarm_mark_cache` 設定を追加しました。この設定を有効にすると、テーブルへの挿入、マージ、パーツのフェッチ、およびテーブルの起動時に、マークが mark cache に読み込まれます。 [#71053](https://github.com/ClickHouse/ClickHouse/pull/71053) ([Anton Popov](https://github.com/CurtizJ)).
* Parquet ネイティブリーダーでの Boolean 型サポート。 [#71055](https://github.com/ClickHouse/ClickHouse/pull/71055) ([Arthur Passos](https://github.com/arthurpassos))。
* S3 とやり取りする際に、&quot;Malformed message&quot; など、より多くの種類のエラーで再試行するようにしました。 [#71088](https://github.com/ClickHouse/ClickHouse/pull/71088) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* S3 関連メッセージの一部についてログレベルを下げました。 [#71090](https://github.com/ClickHouse/ClickHouse/pull/71090) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* スペースを含む名前の HDFS ファイルへの書き込みをサポートしました。 [#71105](https://github.com/ClickHouse/ClickHouse/pull/71105) ([exmy](https://github.com/exmy)).
* `system.session_log` で問題ありません。これにより [#51760](https://github.com/ClickHouse/ClickHouse/issues/51760) がクローズされました。[#71150](https://github.com/ClickHouse/ClickHouse/pull/71150) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 並列レプリカを使用するクエリにおける RIGHT / FULL JOIN の動作を修正しました。これにより、RIGHT JOIN は並列レプリカで実行できるようになり（右側テーブルの読み取りが分散されます）。一方、FULL JOIN はノード間で並列化できず、ローカルでのみ実行されます。 [#71162](https://github.com/ClickHouse/ClickHouse/pull/71162) ([Igor Nikonov](https://github.com/devcrafter))。
* レプリケートテーブル、辞書、ビューの数を制限するための設定を追加しました。 [#71179](https://github.com/ClickHouse/ClickHouse/pull/71179) ([Kirill](https://github.com/kirillgarbar)).
* [#71227](https://github.com/ClickHouse/ClickHouse/issues/71227) を修正。 [#71286](https://github.com/ClickHouse/ClickHouse/pull/71286)（[Arthur Passos](https://github.com/arthurpassos)）。
* サーバー／ユーザーのメモリ使用量に応じて、`GROUP BY`／`ORDER BY` を自動的にディスクへの書き出しに切り替えます。`max_bytes_ratio_before_external_group_by`／`max_bytes_ratio_before_external_sort` クエリ設定で制御できます。[#71406](https://github.com/ClickHouse/ClickHouse/pull/71406)（[Azat Khuzhin](https://github.com/azat)）。
* ホストごとのダッシュボード `Overview (host)` および `Cloud overview (host)` を高度なダッシュボードに追加しました。 [#71422](https://github.com/ClickHouse/ClickHouse/pull/71422) ([alesapin](https://github.com/alesapin))。
* `from` 引数に含まれる文字数が `to` 引数より多い場合に、文字の削除もサポートするように `translate` 関数が拡張されました。例: `SELECT translate('clickhouse', 'clickhouse', 'CLICK')` は、現在 `CLICK` を返します。 [#71441](https://github.com/ClickHouse/ClickHouse/pull/71441) ([shuai.xu](https://github.com/shuai-xu)).
* 新しい関数 `parseDateTime64`、`parseDateTime64OrNull`、`parseDateTime64OrZero` を追加しました。既存の関数 `parseDateTime`（およびその派生関数）とは異なり、これらは `DateTime` 型ではなく `DateTime64` 型の値を返します。 [#71581](https://github.com/ClickHouse/ClickHouse/pull/71581) ([kevinyhzou](https://github.com/KevinyhZou))。
* MergeTree テーブルエンジンファミリーでのメモリフットプリント削減のため、メモリ上の index&#95;granularity 配列を縮小するようにしました。 [#71595](https://github.com/ClickHouse/ClickHouse/pull/71595) ([alesapin](https://github.com/alesapin)).
* コマンドラインアプリケーションで、複数ステートメントでも構文が強調表示されるようになりました。 [#71622](https://github.com/ClickHouse/ClickHouse/pull/71622) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* コマンドラインアプリケーションは、エラー発生時に 0 以外の終了コードを返すようになりました。以前のバージョンでは、`disks` アプリケーションはエラー時にも終了コード 0 を返しており、他のアプリケーションもエラーコード 256 (`PARTITION_ALREADY_EXISTS`) および 512 (`SET_NON_GRANTED_ROLE`) の場合に終了コード 0 を返していました。 [#71623](https://github.com/ClickHouse/ClickHouse/pull/71623) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* `Vertical` フォーマット（クエリの末尾を `\G` で終わらせた場合にも有効になります）は、数値の桁区切りをハイライト表示したり、読みやすい数値のツールチップを表示するなど、Pretty フォーマットの機能を備えています。 [#71630](https://github.com/ClickHouse/ClickHouse/pull/71630) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* `filesystem_cache_prefer_bigger_buffer_size` 設定により、ファイルシステムキャッシュのメモリバッファサイズの増加を無効化できるようにしました。 [#71640](https://github.com/ClickHouse/ClickHouse/pull/71640) ([Kseniia Sumarokova](https://github.com/kssenii)).
* ファイルシステムキャッシュでのバックグラウンドダウンロードの最大ファイルセグメントサイズ用に、個別の設定 `background_download_max_file_segment_size` を追加しました。 [#71648](https://github.com/ClickHouse/ClickHouse/pull/71648) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `enable_http_compression` のデフォルト値を 0 から 1 に変更します。[#71591](https://github.com/ClickHouse/ClickHouse/issues/71591) をクローズします。 [#71774](https://github.com/ClickHouse/ClickHouse/pull/71774)（[Peter Nguyen](https://github.com/petern48)）。
* Object から JSON への ALTER 操作をサポート。 [#71784](https://github.com/ClickHouse/ClickHouse/pull/71784) ([Pavel Kruglov](https://github.com/Avogar)).
* JSON 型のパースをわずかに改善: JSON パスに対応する現在のブロックに複数の型の値が含まれている場合、あらかじめ定義されたベストエフォート順で型を試すことで、最適な型を選択するようにしました。 [#71785](https://github.com/ClickHouse/ClickHouse/pull/71785) ([Pavel Kruglov](https://github.com/Avogar)).
* 以前は `system.asynchronous_metrics` から読み取る際、並行して実行中の更新処理が完了するまで待機していました。システムに高負荷がかかっている場合、この処理に長時間かかる可能性がありました。この変更により、これまでに収集された値を常に読み取れるようになりました。 [#71798](https://github.com/ClickHouse/ClickHouse/pull/71798) ([Alexander Gololobov](https://github.com/davenger)).
* `polling_max_timeout_ms` を10分、`polling_backoff_ms` を30秒に設定しました。[#71817](https://github.com/ClickHouse/ClickHouse/pull/71817) ([Kseniia Sumarokova](https://github.com/kssenii))。
* &#39;SELECT - FROM t LIMIT 1&#39; のようなクエリでは、実際には利用されないにもかかわらずパートインデックスがロードされていました。 [#71866](https://github.com/ClickHouse/ClickHouse/pull/71866) ([Alexander Gololobov](https://github.com/davenger)).
* 古い互換性設定では、Allow&#95;reorder&#95;prewhere&#95;conditions はデフォルトでオンになっています。 [#71867](https://github.com/ClickHouse/ClickHouse/pull/71867) ([Raúl Marín](https://github.com/Algunenano)).
* `bitmapTransform` 関数が使用され、かつ引数の型が有効な場合には、`system.errors` テーブル内の `ILLEGAL_TYPE_OF_ARGUMENT` カウンターをインクリメントしないようにしました。 [#71971](https://github.com/ClickHouse/ClickHouse/pull/71971) ([Dmitry Novik](https://github.com/novikd))。
* `Dictionary` ストレージ、辞書テーブル関数、または辞書自体に対する直接の `SELECT` によって辞書からデータを取得する場合、その辞書に対する `SELECT` 権限または `dictGet` 権限のいずれかがあれば十分になりました。これは ACL の回避を防ぐこれまでの試み（[https://github.com/ClickHouse/ClickHouse/pull/57362](https://github.com/ClickHouse/ClickHouse/pull/57362)、[https://github.com/ClickHouse/ClickHouse/pull/65359](https://github.com/ClickHouse/ClickHouse/pull/65359)）と整合しており、後者との後方互換性も確保します。 [#72051](https://github.com/ClickHouse/ClickHouse/pull/72051)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 高度なダッシュボードの HTML ページに、`system.dashboards` テーブルからダッシュボードを選択するためのドロップダウンセレクターを追加しました。 [#72081](https://github.com/ClickHouse/ClickHouse/pull/72081) ([Sergei Trifonov](https://github.com/serxa)).
* 分散 `INSERT ... SELECT` のプランを構築する際に `prefer_locahost_replica` を考慮するようにしました。 [#72190](https://github.com/ClickHouse/ClickHouse/pull/72190) ([filimonov](https://github.com/filimonov)).
* この問題については[こちらで説明されています](https://github.com/ClickHouse/ClickHouse/issues/72091)。Azure Iceberg Writer は仕様に反する Iceberg メタデータファイル（およびマニフェストファイル）を作成します。この PR では、v2 リーダーで v1 Iceberg フォーマットのメタデータを読み取る試みを追加し（向こうがそのような形式で書き出しているため）、さらに、マニフェストファイル内に対応するフィールドが作成されていない場合にエラーを発生させるようにしました。[#72277](https://github.com/ClickHouse/ClickHouse/pull/72277)（[Daniil Ivanik](https://github.com/divanik)）。
* JSON/Dynamic/Variant 型を実験的機能からベータ機能へ移行しました。 [#72294](https://github.com/ClickHouse/ClickHouse/pull/72294) ([Pavel Kruglov](https://github.com/Avogar)).
* クエリ内で `UNION [ALL]` を使用した `CREATE MATERIALIZED VIEW` が可能になりました。動作は `JOIN` を使用したマテリアライズドビューと同じで、**`SELECT` 式内の最初のテーブルだけが INSERT のトリガーとして機能し、他のすべてのテーブルは無視されます**。 [#72347](https://github.com/ClickHouse/ClickHouse/pull/72347) ([alesapin](https://github.com/alesapin))。
* 挿入バッチ内のパーティションキーの値が単一である場合に、MergeTree への挿入を高速化しました。 [#72348](https://github.com/ClickHouse/ClickHouse/pull/72348) ([alesapin](https://github.com/alesapin))。
* 新しい MergeTreeIndexGranularityInternalArraysTotalSize メトリクスを system.metrics に追加します。このメトリクスは、大規模なデータセットを持ち、高いメモリ使用量の問題が発生しやすいインスタンスを特定するために必要です。 [#72490](https://github.com/ClickHouse/ClickHouse/pull/72490) ([Miсhael Stetsyuk](https://github.com/mstetsyuk))。
* クエリで `Format Null` を使用する場合、`Null` という単語のあらゆる表記が認識されるようになりました。以前は、他の表記（例: `NULL`）でも例外はスローされませんでしたが、その一方で、それらの場合には実際には `Null` フォーマットは使用されていませんでした。 [#72658](https://github.com/ClickHouse/ClickHouse/pull/72658) ([Nikita Taranov](https://github.com/nickitat))。
* Enum に存在しない Set 内の未知の値を許可できるようにしました。[#72662](https://github.com/ClickHouse/ClickHouse/issues/72662) を修正。[#72686](https://github.com/ClickHouse/ClickHouse/pull/72686)（[zhanglistar](https://github.com/zhanglistar)）。
* `system.tables` に `total&#95;bytes&#95;with&#95;inactive` が追加され、非アクティブなパーツの合計バイト数をカウントできるようになりました。 [#72690](https://github.com/ClickHouse/ClickHouse/pull/72690) ([Kai Zhu](https://github.com/nauu)).
* MergeTreeSettings を system.settings&#95;changes に追加しました。 [#72694](https://github.com/ClickHouse/ClickHouse/pull/72694) ([Raúl Marín](https://github.com/Algunenano))。
* Enum データ型で文字列検索演算子（例: LIKE）をサポートし、[#72661](https://github.com/ClickHouse/ClickHouse/issues/72661) を修正しました。 [#72732](https://github.com/ClickHouse/ClickHouse/pull/72732)（[zhanglistar](https://github.com/zhanglistar)）。
* `notEmpty` 関数に `JSON` 型のサポートを追加しました。 [#72741](https://github.com/ClickHouse/ClickHouse/pull/72741) ([Pavel Kruglov](https://github.com/Avogar))。
* GCS S3 エラー `AuthenticationRequired` の解析をサポート。 [#72753](https://github.com/ClickHouse/ClickHouse/pull/72753) ([Vitaly Baranov](https://github.com/vitlibar)).
* 関数 `ifNull` および `coalesce` に Dynamic 型のサポートを追加しました。 [#72772](https://github.com/ClickHouse/ClickHouse/pull/72772) ([Pavel Kruglov](https://github.com/Avogar)).
* `JoinBuildTableRowCount/JoinProbeTableRowCount/JoinResultRowCount` プロファイルイベントを追加しました。 [#72842](https://github.com/ClickHouse/ClickHouse/pull/72842) ([Vladimir Cherkasov](https://github.com/vdimir))。
* 関数 toFloat64/toUInt32 などで Dynamic をサポート [#72989](https://github.com/ClickHouse/ClickHouse/pull/72989)（[Pavel Kruglov](https://github.com/Avogar)）。





## バグ修正（公式安定版リリースにおけるユーザーに見える不具合） {#bug-fix}


* `ATTACH PART` クエリの実行中に重複排除されたパーツが、`attaching_` プレフィックスが付いたまま残ることはなくなりました。 [#65636](https://github.com/ClickHouse/ClickHouse/pull/65636) ([Kirill](https://github.com/kirillgarbar)).
* `IN` 関数で `DateTime64` の精度が失われるバグを修正。[#67230](https://github.com/ClickHouse/ClickHouse/pull/67230)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* `ORDER BY ... WITH FILL` 内で `IGNORE/RESPECT NULLS` を伴う関数を使用した際に発生する可能性のある論理エラーを修正し、[#57609](https://github.com/ClickHouse/ClickHouse/issues/57609) をクローズしました。 [#68234](https://github.com/ClickHouse/ClickHouse/pull/68234) ([Vladimir Cherkasov](https://github.com/vdimir))。
* メモリ制限に達した場合に、`Native` 形式での非同期挿入でまれに発生していた論理エラーを修正しました。 [#68965](https://github.com/ClickHouse/ClickHouse/pull/68965) ([Anton Popov](https://github.com/CurtizJ)).
* EPHEMERAL 列の CREATE TABLE 文の COMMENT を修正。 [#70458](https://github.com/ClickHouse/ClickHouse/pull/70458) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* `JSONExtract` で LowCardinality(Nullable) を使用した場合の論理エラーを修正。 [#70549](https://github.com/ClickHouse/ClickHouse/pull/70549) ([Pavel Kruglov](https://github.com/Avogar)).
* テーブル名が長すぎる場合の挙動を修正しました。 [#70810](https://github.com/ClickHouse/ClickHouse/pull/70810) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* URL エンジンでユーザー指定ヘッダーにより Content-Type を上書きできるようにした。[#70859](https://github.com/ClickHouse/ClickHouse/pull/70859)（[Artem Iurin](https://github.com/ortyomka)）。
* `StorageS3Queue` における「/processed には既に存在するため永続ノードを作成できません」という論理エラーを修正。 [#70984](https://github.com/ClickHouse/ClickHouse/pull/70984) ([Kseniia Sumarokova](https://github.com/kssenii))。
* projection の lightweight delete の rebuild オプションで `_row_exists` 列が考慮されていなかったバグを修正しました。 [#71089](https://github.com/ClickHouse/ClickHouse/pull/71089) ([Shichao Jin](https://github.com/jsc0218)).
* 予期しないレースコンディションにより `system.query_metric_log` に誤った値が記録されてしまう問題を修正。 [#71124](https://github.com/ClickHouse/ClickHouse/pull/71124) ([Pablo Marcos](https://github.com/pamarcos))。
* quantileExactWeightedInterpolated の集約関数名の不整合を修正しました。このバグは [https://github.com/ClickHouse/ClickHouse/pull/69619](https://github.com/ClickHouse/ClickHouse/pull/69619) で導入されました。cc @Algunenano。[#71168](https://github.com/ClickHouse/ClickHouse/pull/71168)（[李扬](https://github.com/taiyang-li)）。
* Dynamic を使用した関数比較時に発生する bad&#95;weak&#95;ptr 例外を修正。[#71183](https://github.com/ClickHouse/ClickHouse/pull/71183) ([Pavel Kruglov](https://github.com/Avogar))。
* Zero-copy レプリケーションを使用する ReplicatedMergeTree で、その blob を使用中のノードが存在する場合は、blob を削除しないようにしました。 [#71186](https://github.com/ClickHouse/ClickHouse/pull/71186) ([Antonio Andelic](https://github.com/antonio2368)).
* HTTP および Async Inserts 経由の Native フォーマットで `format` 設定が無視されていた問題を修正。 [#71193](https://github.com/ClickHouse/ClickHouse/pull/71193) ([Pavel Kruglov](https://github.com/Avogar)).
* `use_query_cache = 1` の設定で実行される SELECT クエリは、システムテーブル名がリテラルとして現れても、もはや拒否されなくなりました。例えば、`SELECT - FROM users WHERE name = 'system.metrics' SETTINGS use_query_cache = true;` は現在は正常に動作します。 [#71254](https://github.com/ClickHouse/ClickHouse/pull/71254) ([Robert Schulze](https://github.com/rschu1ze))。
* enable&#95;filesystem&#95;cache=1 を有効にした場合に、ストレージ構成内のディスクにキャッシュ設定が存在しないとメモリ使用量が増加するバグを修正しました。 [#71261](https://github.com/ClickHouse/ClickHouse/pull/71261) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Dynamic列から LowCardinality 辞書をデシリアライズする際に発生する可能性のある「Cannot read all data」エラーを修正。 [#71299](https://github.com/ClickHouse/ClickHouse/pull/71299) ([Pavel Kruglov](https://github.com/Avogar)).
* クライアントの並列出力フォーマットにおけるクリーンアップ漏れを修正。 [#71304](https://github.com/ClickHouse/ClickHouse/pull/71304) ([Raúl Marín](https://github.com/Algunenano))。
* 名前付きコレクションで欠けていたアンエスケープ処理を追加しました。この修正がないと clickhouse-server は起動しません。 [#71308](https://github.com/ClickHouse/ClickHouse/pull/71308) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* ネイティブプロトコルで空ブロックの非同期挿入を修正。 [#71312](https://github.com/ClickHouse/ClickHouse/pull/71312) ([Anton Popov](https://github.com/CurtizJ)).
* 誤ったワイルドカード権限を付与した場合に発生する AST フォーマットの不整合を修正しました [#71309](https://github.com/ClickHouse/ClickHouse/issues/71309)。 [#71332](https://github.com/ClickHouse/ClickHouse/pull/71332) ([pufit](https://github.com/pufit))。
* JSON 型ヒントにおける疑わしい型および実験的な型を検査する。[#71369](https://github.com/ClickHouse/ClickHouse/pull/71369) ([Pavel Kruglov](https://github.com/Avogar))。
* Variant カラムを含む Chunk で発生する「Invalid number of rows in Chunk」エラーを修正しました。 [#71388](https://github.com/ClickHouse/ClickHouse/pull/71388) ([Pavel Kruglov](https://github.com/Avogar)).
* 不正な引数（例：`NULL`）を渡した際に `mongodb` テーブル関数が異常終了する問題を修正しました。 [#71426](https://github.com/ClickHouse/ClickHouse/pull/71426) ([Vladimir Cherkasov](https://github.com/vdimir)).
* optimize&#95;rewrite&#95;array&#95;exists&#95;to&#95;has 使用時にクラッシュする問題を修正。 [#71432](https://github.com/ClickHouse/ClickHouse/pull/71432) ([Raúl Marín](https://github.com/Algunenano))。
* palin&#95;rewritable ディスクでディレクトリの作成に失敗した場合にトランザクションのロールバック中に発生していた NoSuchKey エラーを修正。 [#71439](https://github.com/ClickHouse/ClickHouse/pull/71439) ([Julia Kartseva](https://github.com/jkartseva)).
* 挿入時における設定 `max_insert_delayed_streams_for_parallel_write` の使用方法を修正しました。以前は正しく動作しておらず、複数のパーティションにデータを書き込む挿入でメモリ使用量の増大を招く可能性がありました。[#71474](https://github.com/ClickHouse/ClickHouse/pull/71474) ([Anton Popov](https://github.com/CurtizJ))。
* `arrayJoin` が `WHERE` 条件内に現れる可能性がある場合に発生し得る `Argument for function must be constant`（旧アナライザ）エラーを修正。 [https://github.com/ClickHouse/ClickHouse/pull/65414](https://github.com/ClickHouse/ClickHouse/pull/65414) によるリグレッション。 [#71476](https://github.com/ClickHouse/ClickHouse/pull/71476)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 0 列の SortCursor で発生するクラッシュを防止（旧アナライザ）。[#71494](https://github.com/ClickHouse/ClickHouse/pull/71494)（[Raúl Marín](https://github.com/Algunenano)）。
* 未初期化の ORC データに起因する date32 の範囲外エラーを修正しました。詳細については [https://github.com/apache/incubator-gluten/issues/7823](https://github.com/apache/incubator-gluten/issues/7823) を参照してください。 [#71500](https://github.com/ClickHouse/ClickHouse/pull/71500)（[李扬](https://github.com/taiyang-li)）。
* Dynamic および JSON 型に対して、ワイドパートにおける列サイズのカウントを修正。 [#71526](https://github.com/ClickHouse/ClickHouse/pull/71526) ([Pavel Kruglov](https://github.com/Avogar)).
* マテリアライズドビュー内のクエリで CTE と組み合わせて `IN` を使用している場合における Analyzer の修正。 [#65598](https://github.com/ClickHouse/ClickHouse/issues/65598) をクローズ。 [#71538](https://github.com/ClickHouse/ClickHouse/pull/71538)（[Maksim Kita](https://github.com/kitaisreal)）。
* 範囲外となった場合にエラーをスローする代わりに、`bitShift` 関数で 0 または既定の文字を返すようにしました。 [#71580](https://github.com/ClickHouse/ClickHouse/pull/71580) ([Pablo Marcos](https://github.com/pamarcos))。
* 特定のエンジンを用いたマテリアライズドビューで発生するサーバークラッシュを修正。 [#71593](https://github.com/ClickHouse/ClickHouse/pull/71593) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* 定数配列へのエイリアスを含む入れ子のデータ構造に対する ARRAY JOIN により、ヌルポインタ参照が発生する問題がありました。これにより [#71677](https://github.com/ClickHouse/ClickHouse/issues/71677) がクローズされました。[#71678](https://github.com/ClickHouse/ClickHouse/pull/71678)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 空のタプルで ALTER を実行した際に発生する LOGICAL&#95;ERROR を修正しました。これにより [#71647](https://github.com/ClickHouse/ClickHouse/issues/71647) が解決されます。 [#71679](https://github.com/ClickHouse/ClickHouse/pull/71679) ([Amos Bird](https://github.com/amosbird))。
* NOT IN 演算子の場合、パーティション列に対する述語での定数集合の変換を行わないようにしました。 [#71695](https://github.com/ClickHouse/ClickHouse/pull/71695) ([Eduard Karacharov](https://github.com/korowa)).
* LowCardinality(Nullable) から Dynamic への CAST を修正しました。以前は `Bad cast from type DB::ColumnVector<int> to DB::ColumnNullable` というエラーが発生することがありました。 [#71742](https://github.com/ClickHouse/ClickHouse/pull/71742) ([Pavel Kruglov](https://github.com/Avogar))。
* DateTime64 型のプライマリキーを持つテーブルに対する WHERE 句での `toDayOfWeek` による例外を修正しました。 [#71849](https://github.com/ClickHouse/ClickHouse/pull/71849) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 疎な列への解析後にデフォルト値を補完する処理を修正。 [#71854](https://github.com/ClickHouse/ClickHouse/pull/71854) ([Anton Popov](https://github.com/CurtizJ)).
* 分散テーブルで入力が ALIAS の場合に `GROUPING` 関数で発生していたエラーを修正しました。 [#68602](https://github.com/ClickHouse/ClickHouse/issues/68602)。 [#71855](https://github.com/ClickHouse/ClickHouse/pull/71855) ([Vladimir Cherkasov](https://github.com/vdimir))。
* `WITH TIES` 句を使用する `SELECT` 文が、十分な行数を返さない場合がある問題を修正しました。 [#71886](https://github.com/ClickHouse/ClickHouse/pull/71886) ([wxybear](https://github.com/wxybear)).
* `arrayWithConstant` の評価時に、列が配列サイズの上限を超えていると誤って判断されて発生する `TOO_LARGE_ARRAY_SIZE` 例外を修正しました。 [#71894](https://github.com/ClickHouse/ClickHouse/pull/71894) ([Udi](https://github.com/udiz)).
* `clickhouse-benchmark` は、1 秒を超える時間がかかるクエリに対して誤ったメトリクスを報告していました。 [#71898](https://github.com/ClickHouse/ClickHouse/pull/71898) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* clickhouse-client における進捗インジケーターと進捗テーブル間のデータ競合を修正しました。この問題は FROM INFILE が使用される場合に発生します。INSERT クエリ実行中のキーストロークを捕捉して、進捗テーブルの表示を切り替えられるようにしました。[#71901](https://github.com/ClickHouse/ClickHouse/pull/71901) ([Julia Kartseva](https://github.com/jkartseva))。
* Pretty JSON フォーマットにおける Dynamic 値のシリアル化を修正。 [#71923](https://github.com/ClickHouse/ClickHouse/pull/71923) ([Pavel Kruglov](https://github.com/Avogar)).
* 24.6 で不正になっていた system.s3/azure&#95;queue&#95;log の rows&#95;processed 列を修正。Closes [#69975](https://github.com/ClickHouse/ClickHouse/issues/69975). [#71946](https://github.com/ClickHouse/ClickHouse/pull/71946) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `s3` / `s3Cluster` 関数が不完全な結果を返したり、例外をスローしたりする可能性があった問題を修正しました。これは、s3 URI にグロブパターン（`pattern/*` のようなもの）を使用し、かつキー `pattern/` を持つ空のオブジェクトが存在している場合（そのようなオブジェクトは S3 コンソールによって自動的に作成されます）に発生していました。また、設定 `s3_skip_empty_files` のデフォルト値を `false` から `true` に変更しました。 [#71947](https://github.com/ClickHouse/ClickHouse/pull/71947) ([Nikita Taranov](https://github.com/nickitat)).
* clickhouse-client のシンタックスハイライト機能で発生していたクラッシュを修正しました。[#71864](https://github.com/ClickHouse/ClickHouse/issues/71864) をクローズ。[#71949](https://github.com/ClickHouse/ClickHouse/pull/71949) ([Nikolay Degterinsky](https://github.com/evillique))。
* `ORDER BY` でバイナリ単調関数を使用する `MergeTree` テーブルにおいて、最初の引数が定数の場合に発生する `Illegal type` エラーを修正。[#71941](https://github.com/ClickHouse/ClickHouse/issues/71941) を解決。[#71966](https://github.com/ClickHouse/ClickHouse/pull/71966)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* サブクエリ内で使用される EXPLAIN AST では SELECT クエリのみを許可します。その他の種類のクエリは、論理エラー &#39;Bad cast from type DB::ASTCreateQuery to DB::ASTSelectWithUnionQuery&#39; または `Inconsistent AST formatting` を引き起こします。 [#71982](https://github.com/ClickHouse/ClickHouse/pull/71982) ([Pavel Kruglov](https://github.com/Avogar)).
* `clickhouse-client` でレコードを挿入する際、クライアントはサーバーからカラム定義を読み取ります。ただし、列の定義情報を誤った順序で書き出してしまうバグがありました。本来は `[statistics, ttl, settings]` の順序であるべきです。 [#71991](https://github.com/ClickHouse/ClickHouse/pull/71991) ([Han Fei](https://github.com/hanfei1991)).
* `format_alter_commands_with_parentheses` が有効な場合の `MOVE PARTITION ... TO TABLE ...` ALTER コマンドの書式を修正しました。 [#72080](https://github.com/ClickHouse/ClickHouse/pull/72080) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* File/S3/URL/HDFS/Azure エンジンの `CREATE` クエリに、推論されたフォーマット名を追加しました。以前は、サーバーを再起動するたびにフォーマット名が再推論され、指定されたデータファイルが削除されていると、サーバー起動時にエラーが発生していました。 [#72108](https://github.com/ClickHouse/ClickHouse/pull/72108) ([Pavel Kruglov](https://github.com/Avogar)).
* `min_age_to_force_merge_on_partition_only` が、すでに単一パートへマージ済みの同一パーティションを繰り返しマージしようとしてスタックし、複数パートを持つパーティションをマージしない不具合を修正しました。 [#72209](https://github.com/ClickHouse/ClickHouse/pull/72209) ([Christoph Wurm](https://github.com/cwurm))。
* 疎なカラムを処理する際にまれに発生していた `SimpleSquashingChunksTransform` のクラッシュを修正しました。 [#72226](https://github.com/ClickHouse/ClickHouse/pull/72226) ([Vladimir Cherkasov](https://github.com/vdimir)).
* `GraceHashJoin` におけるデータレースを修正しました。その結果、結合結果から一部の行が欠落する場合がありました。 [#72233](https://github.com/ClickHouse/ClickHouse/pull/72233) ([Nikita Taranov](https://github.com/nickitat)).
* 設定 `enable_block_number_column` が有効な場合にマテリアライズされる `_block_number` 列を使用する `ALTER DELETE` クエリを修正しました。 [#72261](https://github.com/ClickHouse/ClickHouse/pull/72261) ([Anton Popov](https://github.com/CurtizJ)).
* `ColumnDynamic::dumpStructure()` が、例えば `ConcurrentHashJoin` のコンストラクタ内で同時に呼び出されたときに発生していたデータレースを修正しました。 [#72278](https://github.com/ClickHouse/ClickHouse/pull/72278) ([Nikita Taranov](https://github.com/nickitat)).
* `ORDER BY ... WITH FILL` での重複カラムにより `LOGICAL_ERROR` が発生する可能性がある問題を修正。 [#72387](https://github.com/ClickHouse/ClickHouse/pull/72387) ([Vladimir Cherkasov](https://github.com/vdimir))。
* `optimize_functions_to_subcolumns` を適用した後に、いくつかのケースで発生していた型の不一致を修正しました。 [#72394](https://github.com/ClickHouse/ClickHouse/pull/72394) ([Anton Popov](https://github.com/CurtizJ)).
* `BACKUP DATABASE db EXCEPT TABLES db.table` クエリのパース時に発生していたエラーを修正しました。 [#72429](https://github.com/ClickHouse/ClickHouse/pull/72429) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 空の Variant を作成できないようにしました。 [#72454](https://github.com/ClickHouse/ClickHouse/pull/72454) ([Pavel Kruglov](https://github.com/Avogar)).
* `system.merges` における `result_part_path` の不正な形式を修正。 [#72567](https://github.com/ClickHouse/ClickHouse/pull/72567) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* 1 要素のみの glob のパースを修正。 [#72572](https://github.com/ClickHouse/ClickHouse/pull/72572) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* ARRAY JOIN を含む分散クエリにおいて、フォロワーサーバーでのクエリ生成を修正しました。[#69276](https://github.com/ClickHouse/ClickHouse/issues/69276) を修正します。[#72608](https://github.com/ClickHouse/ClickHouse/pull/72608)（[Dmitry Novik](https://github.com/novikd)）。
* DateTime64 in DateTime64 が何も返さなくなる不具合を修正しました。 [#72640](https://github.com/ClickHouse/ClickHouse/pull/72640) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* S3Queue の Unordered モードで、`tracked_files_limit` の設定値が S3 ファイルの出現頻度より小さい場合に発生する「No such key」エラーを修正しました。 [#72738](https://github.com/ClickHouse/ClickHouse/pull/72738) ([Kseniia Sumarokova](https://github.com/kssenii)).
* マークキャッシュが大きい場合、それを削除する処理には無視できない時間がかかる可能性があります。この間コンテキストの mutex を保持したままにすると、多くの他の処理がブロックされ、新しいクライアント接続でさえ mutex が解放されるまで確立できなくなります。さらに、同期のためにこの mutex を保持しておく必要は実際にはなく、`shared ptr` 経由でキャッシュへのローカル参照を保持していれば十分です。 [#72749](https://github.com/ClickHouse/ClickHouse/pull/72749) ([Alexander Gololobov](https://github.com/davenger))。
* あるテスト用インスタンスの 1 つで、PK キャッシュが実際のサイズを大きく過小評価していました。特に、LowCardinality カラムでは辞書のサイズが含まれていませんでした。修正としては、`column-&gt;allocatedBytes()` に加え、キャッシュエントリサイズ向けのオーバーヘッドも見積もって利用するようにしました。[#72750](https://github.com/ClickHouse/ClickHouse/pull/72750)（[Alexander Gololobov](https://github.com/davenger)）。
* `RemoteQueryExecutor` でローカルにユーザーが存在しない場合に例外がスローされる問題を修正。 [#72759](https://github.com/ClickHouse/ClickHouse/pull/72759) ([Andrey Zvonov](https://github.com/zvonand))。
* `enable_block_number_column` 設定が有効な場合にマテリアライズされる `_block_number` 列を使用するミューテーションを修正。 [#72854](https://github.com/ClickHouse/ClickHouse/pull/72854) ([Anton Popov](https://github.com/CurtizJ)).
* バックアップに空のファイルが含まれている場合の、プレーンな書き換え可能ディスク使用時のバックアップ／リストアを修正。 [#72858](https://github.com/ClickHouse/ClickHouse/pull/72858) ([Kseniia Sumarokova](https://github.com/kssenii)).
* DistributedAsyncInsertDirectoryQueue における挿入のキャンセルを正しく行うようにしました。 [#72885](https://github.com/ClickHouse/ClickHouse/pull/72885) ([Antonio Andelic](https://github.com/antonio2368)).
* スパースカラムに対して不正なデータをパースした際にクラッシュする不具合を修正しました（設定 `enable_parsing_to_custom_serialization` が有効な場合に発生する可能性があります）。 [#72891](https://github.com/ClickHouse/ClickHouse/pull/72891) ([Anton Popov](https://github.com/CurtizJ)).
* バックアップ復元中に発生し得るクラッシュを修正。 [#72947](https://github.com/ClickHouse/ClickHouse/pull/72947) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `ON` 句に不等号フィルタを含む複雑な条件を指定したクエリで発生する可能性があった `parallel_hash` JOIN メソッドのバグを修正しました。 [#72993](https://github.com/ClickHouse/ClickHouse/pull/72993) ([Nikita Taranov](https://github.com/nickitat)).
* JSON をパースする際はデフォルトのフォーマット設定を使用し、デシリアライズの失敗を防ぎます。 [#73043](https://github.com/ClickHouse/ClickHouse/pull/73043) ([Pavel Kruglov](https://github.com/Avogar)).
* サポートされていないストレージを使用するトランザクションでのクラッシュを修正。 [#73045](https://github.com/ClickHouse/ClickHouse/pull/73045) ([Raúl Marín](https://github.com/Algunenano)).
* Tuple のパース時に重複した JSON キーをチェックするようにしました。以前は、パース中に論理エラー `Invalid number of rows in Chunk` につながる可能性がありました。 [#73082](https://github.com/ClickHouse/ClickHouse/pull/73082) ([Pavel Kruglov](https://github.com/Avogar)).
