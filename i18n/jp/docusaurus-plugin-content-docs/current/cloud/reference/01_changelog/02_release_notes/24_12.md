---
slug: /changelogs/24.12
title: 'v24.12 Cloud 向け変更履歴'
description: 'v24.12 高速リリースの変更履歴'
keywords: ['changelog', 'cloud']
sidebar_label: '24.12'
sidebar_position: 4
doc_type: 'changelog'
---

v24.12 リリースに基づく ClickHouse Cloud サービス向けの主な変更点。



## 後方互換性のない変更 {#backward-incompatible-changes}

- 関数 `greatest` および `least` は、NULL入力値を無視するようになりました。以前は、引数の1つがNULLの場合にNULLを返していました。例えば、`SELECT greatest(1, 2, NULL)` は現在2を返します。これにより、PostgreSQLと互換性のある動作になります。[#65519](https://github.com/ClickHouse/ClickHouse/pull/65519) ([kevinyhzou](https://github.com/KevinyhZou))。
- 予期しない結果につながる可能性があるため、デフォルトでは ORDER BY/GROUP BY/PARTITION BY/PRIMARY KEY において Variant/Dynamic 型を許可しないようになりました。[#69731](https://github.com/ClickHouse/ClickHouse/pull/69731) ([Pavel Kruglov](https://github.com/Avogar))。
- システムテーブル `generate_series` および `generateSeries` を削除しました。これらは誤ってここで追加されたものです: [#59390](https://github.com/ClickHouse/ClickHouse/issues/59390)。[#71091](https://github.com/ClickHouse/ClickHouse/pull/71091) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `StorageExternalDistributed` を削除しました。クローズ [#70600](https://github.com/ClickHouse/ClickHouse/issues/70600)。[#71176](https://github.com/ClickHouse/ClickHouse/pull/71176) ([flynn](https://github.com/ucasfl))。
- サーバー設定(users.xml)の設定がクライアントにも適用されるようになりました。フォーマット設定(例: `date_time_output_format`)に有用です。[#71178](https://github.com/ClickHouse/ClickHouse/pull/71178) ([Michael Kolupaev](https://github.com/al13n321))。
- JSONサブカラムのファイル内でエスケープされていない特殊記号による `No such file or directory` エラーの可能性を修正しました。[#71182](https://github.com/ClickHouse/ClickHouse/pull/71182) ([Pavel Kruglov](https://github.com/Avogar))。
- テーブルエンジン Kafka、NATS、RabbitMQ は、`SOURCES` 階層内で独自の権限でカバーされるようになりました。これらのエンジンタイプでテーブルを作成するデフォルト以外のデータベースユーザーに権限を追加してください。[#71250](https://github.com/ClickHouse/ClickHouse/pull/71250) ([Christoph Wurm](https://github.com/cwurm))。
- 実行前にミューテーションクエリ全体(サブクエリを含む)をチェックするようになりました。これにより、無効なクエリを誤って実行し、有効なミューテーションをブロックするデッドミューテーションが蓄積されることを防ぎます。[#71300](https://github.com/ClickHouse/ClickHouse/pull/71300) ([Christoph Wurm](https://github.com/cwurm))。
- ファイルシステムキャッシュ設定 `skip_download_if_exceeds_query_cache` を `filesystem_cache_skip_download_if_exceeds_per_query_cache_write_limit` に名称変更しました。[#71578](https://github.com/ClickHouse/ClickHouse/pull/71578) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 混乱を避けるため、min/max関数でのDynamic/Variant型を禁止しました。[#71761](https://github.com/ClickHouse/ClickHouse/pull/71761) ([Pavel Kruglov](https://github.com/Avogar))。
- `deltaSumTimestamp` における `Enum`、`UInt128`、`UInt256` 引数のサポートを削除しました。`deltaSumTimestamp` の第2引数("timestamp")の `Int8`、`UInt8`、`Int16`、`UInt16` のサポートを削除しました。[#71790](https://github.com/ClickHouse/ClickHouse/pull/71790) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ClickHouseがディクショナリのソースとして使用される場合のソースクエリ検証を追加しました。[#72548](https://github.com/ClickHouse/ClickHouse/pull/72548) ([Alexey Katsman](https://github.com/alexkats))。


## 新機能 {#new-features}


* `SYSTEM LOAD PRIMARY KEY` コマンドを実装し、指定したテーブルのすべてのパーツ、またはテーブルを指定しない場合はすべてのテーブルについて、プライマリインデックスをロードできるようにしました。これにより、ベンチマークの実行や、クエリ実行時の追加レイテンシの発生防止に役立ちます。 [#66252](https://github.com/ClickHouse/ClickHouse/pull/66252) ([ZAWA&#95;ll](https://github.com/Zawa-ll)).
* 指定したテーブル内のすべてのパーツ、またはテーブルを指定しなかった場合はすべてのテーブルのプライマリインデックスを読み込むためのステートメント `SYSTEM LOAD PRIMARY KEY` を追加しました。これはベンチマーク用途や、クエリ実行時の追加レイテンシーを防ぐのに役立ちます。 [#67733](https://github.com/ClickHouse/ClickHouse/pull/67733) ([ZAWA&#95;ll](https://github.com/Zawa-ll))。
* `CHECK GRANT` クエリを追加し、現在のユーザー/ロールに特定の権限が付与されているかどうか、また対応するテーブル/カラムがメモリ上に存在するかどうかを確認できるようにしました。 [#68885](https://github.com/ClickHouse/ClickHouse/pull/68885) ([Unalian](https://github.com/Unalian)).
* ワークロードおよびリソース管理を表現するための SQL 構文を追加しました。 [https://clickhouse.com/docs/en/operations/workload-scheduling](https://clickhouse.com/docs/en/operations/workload-scheduling)。 [#69187](https://github.com/ClickHouse/ClickHouse/pull/69187) ([Sergei Trifonov](https://github.com/serxa))。
* [Iceberg データストレージ](https://iceberg.apache.org/spec/#file-system-operations) フォーマットは、テーブルのスキーマを変更するための多彩なオプションをユーザーに提供します。このプルリクエストでは、カラムの順序やカラム名、単純な型の拡張が変更された Iceberg フォーマットのテーブルを読み取る機能が実装されています。 [#69445](https://github.com/ClickHouse/ClickHouse/pull/69445) ([Daniil Ivanik](https://github.com/divanik))。
* 各認証方法ごとに個別の有効期限を設定できるようにし、ユーザーエンティティからは削除しました。 [#70090](https://github.com/ClickHouse/ClickHouse/pull/70090) ([Arthur Passos](https://github.com/arthurpassos)).
* クエリの発行元からクラスタ内の他ノードへ外部ユーザーロールをプッシュできるようにしました。外部認証基盤（例: LDAP）にアクセスできるのが発行元のみの場合に有用です。 [#70332](https://github.com/ClickHouse/ClickHouse/pull/70332) ([Andrey Zvonov](https://github.com/zvonand)).
* String から JSON への `ALTER` をサポートしました。この PR では、JSON 型および Dynamic 型のシリアル化も新しいバージョン V2 に変更しています。以前のバージョン V1 は、設定 `merge_tree_use_v1_object_and_dynamic_serialization` を有効にすることで引き続き利用できます（アップグレード時に、問題なくバージョンをロールバックできるようにするために使用できます）。[#70442](https://github.com/ClickHouse/ClickHouse/pull/70442) ([Pavel Kruglov](https://github.com/Avogar))。
* `DateTime64` を固定の秒精度を持つ `Int64` 値に変換する関数 `toUnixTimestamp64Second` を追加しました。これにより、日付が 1970 年 1 月 1 日 木曜日 00:00:00 UTC より前の場合に負の値を返せるようになりました。 [#70597](https://github.com/ClickHouse/ClickHouse/pull/70597) ([zhanglistar](https://github.com/zhanglistar)).
* 新しい設定 `enforce_index_structure_match_on_partition_manipulation` を追加し、ソーステーブルのプロジェクションとセカンダリインデックスがターゲットテーブルのそれらの部分集合である場合に `ATTACH` を許可するようにしました。[#70602](https://github.com/ClickHouse/ClickHouse/issues/70602) をクローズしました。 [#70603](https://github.com/ClickHouse/ClickHouse/pull/70603)（[zwy991114](https://github.com/zwy991114)）。
* 関数 `cast` の出力が Apache Spark と異なるため、gluten プロジェクトとの間で差異が生じています。詳細は [https://github.com/apache/incubator-gluten/issues/7602](https://github.com/apache/incubator-gluten/issues/7602) を参照してください。この PR では Spark のテキスト出力形式のサポート機能を追加しましたが、デフォルトでは無効になっています。 [#70957](https://github.com/ClickHouse/ClickHouse/pull/70957) ([zhanglistar](https://github.com/zhanglistar))。
* S3 エンドポイントのユーザー認証用に新しいヘッダータイプ（`access_header`）を追加しました。これにより、優先度が最も低いアクセスヘッダーを取得でき、テーブルスキーマや名前付きコレクションなど、他の任意のソースから指定された `access_key_id` によって上書きされます。 [#71011](https://github.com/ClickHouse/ClickHouse/pull/71011) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。
* 設定階層の初期実装。 [#71145](https://github.com/ClickHouse/ClickHouse/pull/71145) ([Raúl Marín](https://github.com/Algunenano)).
* `WITH FILL` 演算子を伴う `ORDER BY` で `staleness` 句をサポートしました。 [#71151](https://github.com/ClickHouse/ClickHouse/pull/71151) ([Mikhail Artemenko](https://github.com/Michicosun)).
* JSON 文字列とのシリアル化／デシリアル化を通じて、Map/Tuple/Object から新しい JSON への単純な CAST を実装。 [#71320](https://github.com/ClickHouse/ClickHouse/pull/71320) ([Pavel Kruglov](https://github.com/Avogar)).
* 集約関数 `any` に対して、エイリアス `anyRespectNulls`、`firstValueRespectNulls`、`anyValueRespectNulls` を追加しました。また、集約関数 `anyLast` に対して、エイリアス `anyLastRespectNulls` と `lastValueRespectNulls` を追加しました。これにより、`anyLast_respect_nullsStateIf` ではなく `SELECT anyLastRespectNullsStateIf` のように、アンダースコア混在ではない、キャメルケースのみのより自然な構文を使用できるようになります。 [#71403](https://github.com/ClickHouse/ClickHouse/pull/71403) ([Peter Nguyen](https://github.com/petern48))。
* `date_time_utc` という設定パラメータを追加し、JSON ログのフォーマットで RFC 3339/ISO8601 形式の UTC 日時をサポートできるようにしました。 [#71560](https://github.com/ClickHouse/ClickHouse/pull/71560) ([Ali](https://github.com/xogoodnow))。
* クエリプランにおいて、どちらの結合側をインナー（ビルド）テーブルとして扱うかを選択できるオプションを追加しました。これは `query_plan_join_swap_table` で制御され、`auto` に設定できます。このモードでは、ClickHouse は行数が最も少ないテーブルを選択しようとします。 [#71577](https://github.com/ClickHouse/ClickHouse/pull/71577) ([Vladimir Cherkasov](https://github.com/vdimir))。
* パーツ内のグラニュラリティが一定である場合、そのインデックスグラニュラリティ値のメモリ使用量を最適化しました。パーツに対して常に一定のグラニュラリティを選択できるようにする設定（`use_const_adaptive_granularity`）を追加し、これによりメモリ上で常に最適な状態を保ちやすくなります。これにより、大規模なワークロード（共有ストレージ上の数兆行）において、データパーツのメタデータ（インデックスグラニュラリティ値）によるメモリ使用量が継続的に増加することを防ぐのに役立ちます。 [#71786](https://github.com/ClickHouse/ClickHouse/pull/71786) ([Anton Popov](https://github.com/CurtizJ)).
* `allowed_feature_tier` をグローバルスイッチとして実装し、すべての実験的機能およびベータ機能を無効化できるようにしました。 [#71841](https://github.com/ClickHouse/ClickHouse/pull/71841) ([Raúl Marín](https://github.com/Algunenano)).
* `iceberg[S3;HDFS;Azure]Cluster`、`deltaLakeCluster`、`hudiCluster` テーブル関数を追加しました。 [#72045](https://github.com/ClickHouse/ClickHouse/pull/72045) ([Mikhail Artemenko](https://github.com/Michicosun)).
* `ALTER USER {ADD|MODIFY|DROP SETTING}`、`ALTER USER {ADD|DROP PROFILE}` の構文を追加しました。同様の構文を `ALTER ROLE` および `ALTER PROFILE` にも追加しました。 [#72050](https://github.com/ClickHouse/ClickHouse/pull/72050) ([pufit](https://github.com/pufit)).
* Precision-Recall 曲線に対する AUC（Area Under the Curve）を計算する `arrayPrAUC` 関数を追加しました。 [#72073](https://github.com/ClickHouse/ClickHouse/pull/72073) ([Emmanuel](https://github.com/emmanuelsdias)).
* `MergeTree` テーブルのプライマリインデックス用キャッシュを追加しました（テーブル設定 `use_primary_key_cache` で有効化可能）。プライマリインデックスに対して lazy load とキャッシュが有効になっている場合は、常にメモリ上に保持するのではなく、必要に応じて（mark cache と同様に）キャッシュへロードされるようになりました。データパーツの挿入／マージ／フェッチ時、およびテーブルの再起動時にプライマリインデックスをプリウォームする機能を追加しました（設定 `prewarm_primary_key_cache` で有効化可能）。[#72102](https://github.com/ClickHouse/ClickHouse/pull/72102)（[Anton Popov](https://github.com/CurtizJ)）。
* 配列型に `indexOfAssumeSorted` 関数を追加しました。非減少順にソートされた配列に対する検索を最適化します。 [#72517](https://github.com/ClickHouse/ClickHouse/pull/72517) ([Eric Kurbanov](https://github.com/erickurbanov)).
* 集約関数 `groupConcat` の第 2 引数として、区切り文字を任意で指定できるようになりました。 [#72540](https://github.com/ClickHouse/ClickHouse/pull/72540) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* 新しい設定 `http_response_headers` により、HTTP レスポンスヘッダーをカスタマイズできるようになりました。たとえば、データベースに保存されている画像をブラウザに表示させるよう指定できます。これにより [#59620](https://github.com/ClickHouse/ClickHouse/issues/59620) がクローズされました。 [#72656](https://github.com/ClickHouse/ClickHouse/pull/72656) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* `Int64` の Unix タイムスタンプ値を `DateTime64` に変換する関数 `fromUnixTimestamp64Second` を追加しました。 [#73146](https://github.com/ClickHouse/ClickHouse/pull/73146) ([Robert Schulze](https://github.com/rschu1ze))。





## パフォーマンスの向上 {#performance-improvements}


* `Nullable` 列に対して、データブロック内の NULL 値の割合が指定された閾値を超えた場合に、ショートサーキット方式で関数を実行できるようにする 2 つの新しい設定 `short_circuit_function_evaluation_for_nulls` と `short_circuit_function_evaluation_for_nulls_threshold` を追加しました。これは、関数が非 NULL 値を持つ行に対してのみ実行されることを意味します。この挙動は、少なくとも 1 つの引数が NULL の行に対して NULL 値を返す関数にのみ適用されます。 [#60129](https://github.com/ClickHouse/ClickHouse/pull/60129) ([李扬](https://github.com/taiyang-li)).
* オブジェクトストレージディスクに対する `clickhouse disks remove --recursive` のメモリ使用量が削減されました。 [#67323](https://github.com/ClickHouse/ClickHouse/pull/67323) ([Kirill](https://github.com/kirillgarbar))。
* `join_algorithm='parallel_hash'` の場合、並列処理のためにスレッド間で分配する際に、入力ブロックのカラムをコピーしないようにしました。 [#67782](https://github.com/ClickHouse/ClickHouse/pull/67782) ([Nikita Taranov](https://github.com/nickitat))。
* より多くの式に対して JIT コンパイルを有効化しました: `abs`/`bitCount`/`sign`/`modulo`/`pmod`/`isNull`/`isNotNull`/`assumeNotNull`/`to(U)Int*`/`toFloat*`、比較関数（`=`, `<`, `>`, `>=`, `<=`）、論理関数（`and`, `or`）。 [#70598](https://github.com/ClickHouse/ClickHouse/pull/70598) ([李扬](https://github.com/taiyang-li)).
* `join_algorithm` 設定が `default` の場合は、該当するときに `parallel_hash` アルゴリズムが使用されるようになりました。`parallel_hash` が使用できない場合には、従来の 2 つの方式（`direct` と `hash`）が引き続き利用されます。 [#70788](https://github.com/ClickHouse/ClickHouse/pull/70788) ([Nikita Taranov](https://github.com/nickitat))。
* 交差しないパーツに対する `Replacing` マージアルゴリズムを最適化しました。 [#70977](https://github.com/ClickHouse/ClickHouse/pull/70977) ([Anton Popov](https://github.com/CurtizJ)).
* metrics および system.detached&#95;parts に readonly ディスクおよび write-once ディスク上の detached parts を含めて列挙しないようにしました。 [#71086](https://github.com/ClickHouse/ClickHouse/pull/71086) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 重い非同期メトリクスをデフォルトでは計算しないようにしました。この機能は [#40332](https://github.com/ClickHouse/ClickHouse/issues/40332) で導入されましたが、単一の顧客のためだけに必要とされる重いバックグラウンドジョブを走らせるのは望ましくありません。[#71087](https://github.com/ClickHouse/ClickHouse/pull/71087)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* system.query&#95;metric&#95;log の収集間隔におけるクリティカルセクションを短縮することで、性能と精度を改善しました。 [#71473](https://github.com/ClickHouse/ClickHouse/pull/71473) ([Pablo Marcos](https://github.com/pamarcos))。
* `WHERE` および `ON` 句の式から共通部分式を抽出し、結合時に使用されるハッシュテーブルの数を削減するオプションを追加しました。`optimize_extract_common_expressions = 1` で有効にできます。 [#71537](https://github.com/ClickHouse/ClickHouse/pull/71537) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
* `LowCardinality(String)` を含む `SELECT` でインデックスを使用できるようにしました。 [#71598](https://github.com/ClickHouse/ClickHouse/pull/71598) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Parallel Replicas を使用したクエリ実行時に local plan が有効な場合、worker では skip index の解析を行いません。coordinator は、自身側（クエリ initiator）での index 解析に基づいて、worker が読み取る range を選択します。 [#72109](https://github.com/ClickHouse/ClickHouse/pull/72109) ([Igor Nikonov](https://github.com/devcrafter)).
* [https://github.com/ClickHouse/ClickHouse/pull/57631](https://github.com/ClickHouse/ClickHouse/pull/57631) で導入された、Compact パーツにおける単一カラムのサブカラム読み取り最適化を復元しました。これは誤って削除されていました。 [#72285](https://github.com/ClickHouse/ClickHouse/pull/72285) ([Pavel Kruglov](https://github.com/Avogar))。
* コンパレータ内の呼び出しを非仮想化することで、`LowCardinality(String)` 列のソートを高速化しました。 [#72337](https://github.com/ClickHouse/ClickHouse/pull/72337) ([Alexander Gololobov](https://github.com/davenger)).
* 一部の単純なデータ型に対して `argMin`/`argMax` 関数を最適化しました。 [#72350](https://github.com/ClickHouse/ClickHouse/pull/72350) ([alesapin](https://github.com/alesapin))。
* メモリトラッカーで共有ロックを用いたロック処理の最適化により、ロック競合を軽減しました。 [#72375](https://github.com/ClickHouse/ClickHouse/pull/72375) ([Jiebin Sun](https://github.com/jiebinn))。
* 新しい設定 `use_async_executor_for_materialized_views` を追加。マテリアライズドビューのクエリを非同期かつ場合によってはマルチスレッドで実行し、INSERT 時のビュー処理を高速化できますが、その分より多くのメモリを消費する可能性があります。 [#72497](https://github.com/ClickHouse/ClickHouse/pull/72497) ([alesapin](https://github.com/alesapin))。
* 設定 `max_size_to_preallocate_for_aggregation` と `max_size_to_preallocate_for_joins` のデフォルト値が `10^12` までさらに引き上げられたため、この最適化がより多くのケースで適用されるようになりました。 [#72555](https://github.com/ClickHouse/ClickHouse/pull/72555) ([Nikita Taranov](https://github.com/nickitat))。
* 集約関数の状態（データ型 `AggregateFunction` および分散クエリ内）のデシリアライズ性能を改善しました。フォーマット `RowBinary` のパース性能もわずかに改善しました。 [#72818](https://github.com/ClickHouse/ClickHouse/pull/72818) ([Anton Popov](https://github.com/CurtizJ)).





## 改善 {#improvement}


* 定数配列および定数としてキャプチャされた引数を持つ高階関数は、定数を返すようになりました。 [#58400](https://github.com/ClickHouse/ClickHouse/pull/58400) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 仮想行を生成することで読み取り順序を最適化し、特に複数のパーツが存在する場合のマージソート時に読み取るデータ量を削減できるようにしました。 [#62125](https://github.com/ClickHouse/ClickHouse/pull/62125) ([Shichao Jin](https://github.com/jsc0218)).
* クエリプランのステップ名（`EXPLAIN PLAN json=1`）およびパイプラインのプロセッサ名（`EXPLAIN PIPELINE compact=0,graph=1`）には、一意の ID がサフィックスとして付与されるようになりました。これにより、processors profiler の出力や OpenTelemetry のトレースを、EXPLAIN の出力と対応付けることができます。 [#63518](https://github.com/ClickHouse/ClickHouse/pull/63518) ([qhsong](https://github.com/qhsong)).
* Azure Blob Storage への書き込み後にオブジェクトの存在を確認するオプションを追加しました。これは `check_objects_after_upload` の設定で制御できます。 [#64847](https://github.com/ClickHouse/ClickHouse/pull/64847) ([Smita Kulkarni](https://github.com/SmitaRKulkarni)).
* HashTable の destroyElements における use-after-dtor 処理ロジックを修正。 [#65279](https://github.com/ClickHouse/ClickHouse/pull/65279) ([cangyin](https://github.com/cangyin)).
* `clickhouse-local` でデフォルトとして `Atomic` データベースを使用するようにしました。[#50647](https://github.com/ClickHouse/ClickHouse/issues/50647) の項目 1 と 5 に対応。[#44817](https://github.com/ClickHouse/ClickHouse/issues/44817) をクローズ。[#68024](https://github.com/ClickHouse/ClickHouse/pull/68024)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 書き込みバッファは明示的にキャンセルまたは確定する必要があります。例外が発生した場合は、クライアントにエラーを知らせるために HTTP プロトコルをあえて破ります。 [#68800](https://github.com/ClickHouse/ClickHouse/pull/68800) ([Sema Checherinda](https://github.com/CheSema)).
* replica&#95;dir を作成し、DDLWorker 内でレプリカをアクティブとしてマークすることで、DDLWorker を実行しているホストを報告するようにしました。 [#69658](https://github.com/ClickHouse/ClickHouse/pull/69658) ([Tuan Pham Anh](https://github.com/tuanpach)).
* 1. `DDLQueryStatusSource` のリファクタリング: - `DDLQueryStatusSource` を `DistributedQueryStatusSource` に名称変更し、ベースクラスとする - ベースクラス `DistributedQueryStatusSource` から派生した 2つのサブクラス `DDLOnClusterQueryStatusSource` と `ReplicatedDatabaseQueryStatusSource` を作成し、それぞれ DDL On Cluster と Replicated データベースから DDL タスクのステータスを取得できるようにする。2. `DDLOnClusterQueryStatusSource` でオフラインホストの待機を中断できるようにする。[#69660](https://github.com/ClickHouse/ClickHouse/pull/69660) ([Tuan Pham Anh](https://github.com/tuanpach))。
* 新しいキャンセルロジックを追加しました。`CancellationChecker` は開始されたすべてのクエリのタイムアウトを監視し、タイムアウトに達したクエリを停止します。 [#69880](https://github.com/ClickHouse/ClickHouse/pull/69880) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* `allow_experimental_join_condition` 設定を削除し、非等値条件をデフォルトで許可するようにしました。 [#69910](https://github.com/ClickHouse/ClickHouse/pull/69910) ([Vladimir Cherkasov](https://github.com/vdimir))。
* `parallel_replicas_local_plan` をデフォルトで有効化しました。クエリのイニシエーター側で完全なローカルプランを構築することで、リソース消費を抑えながら `parallel_replicas` のパフォーマンスを向上させ、より多くのクエリ最適化を適用できるようにしました。 [#70171](https://github.com/ClickHouse/ClickHouse/pull/70171) ([Igor Nikonov](https://github.com/devcrafter))。
* http&#95;handlers（`dynamic_query_handler`/`predefined_query_handler`）でユーザー名とパスワードを設定できるようにしました。 [#70725](https://github.com/ClickHouse/ClickHouse/pull/70725) ([Azat Khuzhin](https://github.com/azat)).
* ストレージ S3Queue で、特定の設定に対する `ALTER TABLE ... MODIFY/RESET SETTING ...` をサポートしました。 [#70811](https://github.com/ClickHouse/ClickHouse/pull/70811) ([Kseniia Sumarokova](https://github.com/kssenii))。
* ディレクトリを一覧表示する際にオブジェクトストレージの API を呼び出さないでください。コスト効率が悪くなる可能性があります。代わりに、ファイル名の一覧をメモリ内に保持してください。この場合のトレードオフとして、初期ロード時間とファイル名を保存するために必要なメモリが増加します。 [#70823](https://github.com/ClickHouse/ClickHouse/pull/70823) ([Julia Kartseva](https://github.com/jkartseva)).
* `clickhouse-compressor` に `--threads` パラメーターを追加し、データを並列に圧縮できるようにしました。 [#70860](https://github.com/ClickHouse/ClickHouse/pull/70860) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Replxx クライアントの履歴サイズを設定可能にしました。 [#71014](https://github.com/ClickHouse/ClickHouse/pull/71014) ([Jiří Kozlovský](https://github.com/jirislav)).
* `prewarm_mark_cache` 設定を追加しました。これにより、挿入、マージ、パーツのフェッチ時およびテーブルの起動時に、マークをマークキャッシュにロードできるようになります。 [#71053](https://github.com/ClickHouse/ClickHouse/pull/71053) ([Anton Popov](https://github.com/CurtizJ)).
* Parquet ネイティブリーダーでの Boolean サポートを追加。 [#71055](https://github.com/ClickHouse/ClickHouse/pull/71055) ([Arthur Passos](https://github.com/arthurpassos)).
* S3 とやり取りする際に、`"Malformed message"` など、より多くの種類のエラーでリトライを行うようにしました。 [#71088](https://github.com/ClickHouse/ClickHouse/pull/71088) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* S3 に関する一部のメッセージのログレベルを下げました。 [#71090](https://github.com/ClickHouse/ClickHouse/pull/71090) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* スペースを含む hdfs ファイルへの書き込みをサポートしました。 [#71105](https://github.com/ClickHouse/ClickHouse/pull/71105) ([exmy](https://github.com/exmy)).
* `system.session_log` は十分良好です。これにより [#51760](https://github.com/ClickHouse/ClickHouse/issues/51760) がクローズされました。[#71150](https://github.com/ClickHouse/ClickHouse/pull/71150)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 並列レプリカを用いたクエリでの RIGHT / FULL JOIN を修正しました。これにより、RIGHT JOIN は並列レプリカで実行可能になり（右側テーブルの読み取りが分散されます）、FULL JOIN はノード間で並列化できないためローカルで実行されます。 [#71162](https://github.com/ClickHouse/ClickHouse/pull/71162) ([Igor Nikonov](https://github.com/devcrafter))。
* レプリケーテッドテーブル、ディクショナリ、ビューの数を制限する設定を追加しました。 [#71179](https://github.com/ClickHouse/ClickHouse/pull/71179) ([Kirill](https://github.com/kirillgarbar)).
* [#71227](https://github.com/ClickHouse/ClickHouse/issues/71227) を修正。[#71286](https://github.com/ClickHouse/ClickHouse/pull/71286)（[Arthur Passos](https://github.com/arthurpassos)）。
* サーバー/ユーザーのメモリ使用量に応じて、`GROUP BY`/`ORDER BY` を自動的にディスクにスピルします。`max_bytes_ratio_before_external_group_by`/`max_bytes_ratio_before_external_sort` クエリ設定で制御できます。[#71406](https://github.com/ClickHouse/ClickHouse/pull/71406)（[Azat Khuzhin](https://github.com/azat)）。
* ホスト単位のダッシュボード `Overview (host)` と `Cloud overview (host)` を高度なダッシュボードに追加しました。 [#71422](https://github.com/ClickHouse/ClickHouse/pull/71422) ([alesapin](https://github.com/alesapin)).
* 関数 `translate` は、`from` 引数に含まれる文字が `to` 引数より多い場合に、余分な文字を削除できるようになりました。例: `SELECT translate('clickhouse', 'clickhouse', 'CLICK')` は、現在 `CLICK` を返します。 [#71441](https://github.com/ClickHouse/ClickHouse/pull/71441) ([shuai.xu](https://github.com/shuai-xu))。
* 新しい関数 `parseDateTime64`、`parseDateTime64OrNull`、`parseDateTime64OrZero` を追加しました。既存の関数 `parseDateTime`（およびそのバリアント）と比べて、これらは `DateTime` 型ではなく `DateTime64` 型の値を返します。 [#71581](https://github.com/ClickHouse/ClickHouse/pull/71581) ([kevinyhzou](https://github.com/KevinyhZou))。
* MergeTree テーブルエンジンファミリーのメモリフットプリントを削減するために、メモリ上の index&#95;granularity 配列を縮小してサイズを最適化しました。 [#71595](https://github.com/ClickHouse/ClickHouse/pull/71595) ([alesapin](https://github.com/alesapin)).
* コマンドラインアプリケーションで、マルチステートメントに対しても構文ハイライトが行われるようになりました。 [#71622](https://github.com/ClickHouse/ClickHouse/pull/71622) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* コマンドラインアプリケーションは、エラー発生時にゼロ以外の終了コードを返すようになります。以前のバージョンでは、`disks` アプリケーションはエラー時にもゼロを返しており、他のアプリケーションも、エラー 256（`PARTITION_ALREADY_EXISTS`）および 512（`SET_NON_GRANTED_ROLE`）についてはゼロを返していました。 [#71623](https://github.com/ClickHouse/ClickHouse/pull/71623) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `Vertical` フォーマット（クエリの末尾を `\G` で終わらせた場合にも有効になります）に、次のような Pretty フォーマットの機能が追加されました: - 数値の3桁ごとのグループをハイライト表示する機能 - 読みやすい数値のヒントを表示する機能。 [#71630](https://github.com/ClickHouse/ClickHouse/pull/71630) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 設定 `filesystem_cache_prefer_bigger_buffer_size` により、ファイルシステムキャッシュのメモリバッファサイズ拡張を無効化できるようにしました。 [#71640](https://github.com/ClickHouse/ClickHouse/pull/71640) ([Kseniia Sumarokova](https://github.com/kssenii)).
* ファイルシステムキャッシュにおけるバックグラウンドダウンロード時の最大ファイルセグメントサイズを指定する、個別の設定 `background_download_max_file_segment_size` を追加しました。 [#71648](https://github.com/ClickHouse/ClickHouse/pull/71648) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `enable_http_compression` のデフォルト値を 0 から 1 に変更します。[#71591](https://github.com/ClickHouse/ClickHouse/issues/71591) をクローズします。 [#71774](https://github.com/ClickHouse/ClickHouse/pull/71774)（[Peter Nguyen](https://github.com/petern48)）。
* Object から JSON への ALTER をサポートしました。 [#71784](https://github.com/ClickHouse/ClickHouse/pull/71784) ([Pavel Kruglov](https://github.com/Avogar))。
* JSON 型のパースをわずかに改善: JSON パスの現在のブロックに複数の型の値が含まれている場合、専用のベストエフォート順で各型を試し、最適な型を選択するようにしました。 [#71785](https://github.com/ClickHouse/ClickHouse/pull/71785) ([Pavel Kruglov](https://github.com/Avogar)).
* 以前は `system.asynchronous_metrics` から読み取る際、同時に実行中の更新処理が完了するまで待機していました。システムに高い負荷がかかっている場合、この処理には長時間かかることがあります。この変更により、すでに収集済みの値を常に読み取れるようになりました。 [#71798](https://github.com/ClickHouse/ClickHouse/pull/71798) ([Alexander Gololobov](https://github.com/davenger)).
* `polling_max_timeout_ms` を 10 分、`polling_backoff_ms` を 30 秒に設定。 [#71817](https://github.com/ClickHouse/ClickHouse/pull/71817) ([Kseniia Sumarokova](https://github.com/kssenii))。
* `SELECT - FROM t LIMIT 1` のようなクエリでは、実際には使用されないにもかかわらず、part index が読み込まれていました。 [#71866](https://github.com/ClickHouse/ClickHouse/pull/71866) ([Alexander Gololobov](https://github.com/davenger)).
* 古い互換性設定では Allow&#95;reorder&#95;prewhere&#95;conditions がデフォルトで有効です。 [#71867](https://github.com/ClickHouse/ClickHouse/pull/71867) ([Raúl Marín](https://github.com/Algunenano)).
* `bitmapTransform` 関数を使用し、かつ引数の型が有効な場合には、`system.errors` テーブル内の `ILLEGAL_TYPE_OF_ARGUMENT` カウンターがインクリメントされないようにしました。 [#71971](https://github.com/ClickHouse/ClickHouse/pull/71971) ([Dmitry Novik](https://github.com/novikd)).
* Dictionary storage、dictionary table function、またはその dictionary 自体に対して直接 `SELECT` して辞書からデータを取得する場合、その辞書に対する `SELECT` 権限または `dictGet` 権限のいずれかがあれば十分になりました。これは、ACL バイパスを防ぐこれまでの取り組みである [https://github.com/ClickHouse/ClickHouse/pull/57362](https://github.com/ClickHouse/ClickHouse/pull/57362) および [https://github.com/ClickHouse/ClickHouse/pull/65359](https://github.com/ClickHouse/ClickHouse/pull/65359) と整合しています。また、後者との後方互換性も確保します。[#72051](https://github.com/ClickHouse/ClickHouse/pull/72051)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* 高度なダッシュボードの HTML ページに、`system.dashboards` テーブル内のダッシュボードを選択するためのドロップダウンセレクターを追加しました。 [#72081](https://github.com/ClickHouse/ClickHouse/pull/72081) ([Sergei Trifonov](https://github.com/serxa)).
* 分散テーブルに対する `INSERT ... SELECT` のプランを構築する際に、`prefer_locahost_replica` 設定を考慮するようにしました。 [#72190](https://github.com/ClickHouse/ClickHouse/pull/72190) ([filimonov](https://github.com/filimonov)).
* この問題については[こちらで説明されています](https://github.com/ClickHouse/ClickHouse/issues/72091)。Azure Iceberg Writer は仕様に反する Iceberg メタデータファイル（およびマニフェストファイル）を作成します。この PR では、v2 リーダーで v1 Iceberg 形式のメタデータを読み取ろうとする処理を追加しました（彼らがそのような形式で書き出しているため）ほか、マニフェストファイル内に対応するフィールドが作成されていない場合にエラーとなるようにしました。[#72277](https://github.com/ClickHouse/ClickHouse/pull/72277)（[Daniil Ivanik](https://github.com/divanik)）。
* JSON/Dynamic/Variant 型を実験的機能からベータ機能へ移行しました。 [#72294](https://github.com/ClickHouse/ClickHouse/pull/72294) ([Pavel Kruglov](https://github.com/Avogar)).
* クエリ内で `UNION [ALL]` を使用した `CREATE MATERIALIZED VIEW` が可能になりました。動作は `JOIN` を用いたマテリアライズドビューと同様で、**`SELECT` 式内の最初のテーブルだけが挿入のトリガーとして機能し、その他のテーブルはすべて無視されます**。 [#72347](https://github.com/ClickHouse/ClickHouse/pull/72347) ([alesapin](https://github.com/alesapin)).
* 挿入バッチ内のパーティションキーが単一の値である場合に、MergeTree への挿入を高速化。 [#72348](https://github.com/ClickHouse/ClickHouse/pull/72348) ([alesapin](https://github.com/alesapin))。
* 新しい `MergeTreeIndexGranularityInternalArraysTotalSize` メトリクスを `system.metrics` に追加しました。このメトリクスは、大規模なデータセットを持ち、高いメモリ使用量の問題が発生しやすいインスタンスを特定するために必要です。 [#72490](https://github.com/ClickHouse/ClickHouse/pull/72490) ([Miсhael Stetsyuk](https://github.com/mstetsyuk)).
* クエリで `Format Null` を使用する場合、単語 `Null` のあらゆる表記揺れが認識されるようになりました。以前は他の表記（例：`NULL`）でも例外はスローされませんでしたが、その場合でも実際にはフォーマット `Null` は使用されていませんでした。 [#72658](https://github.com/ClickHouse/ClickHouse/pull/72658) ([Nikita Taranov](https://github.com/nickitat)).
* Enum に存在しない未知の値を set で許可するようにしました。[#72662](https://github.com/ClickHouse/ClickHouse/issues/72662) を修正。[#72686](https://github.com/ClickHouse/ClickHouse/pull/72686)（[zhanglistar](https://github.com/zhanglistar)）。
* 非アクティブなパーツの合計バイト数をカウントできるように、`system.tables` に `total_bytes_with_inactive` を追加しました。 [#72690](https://github.com/ClickHouse/ClickHouse/pull/72690) ([Kai Zhu](https://github.com/nauu))。
* MergeTreeSettings を system.settings&#95;changes に追加しました。 [#72694](https://github.com/ClickHouse/ClickHouse/pull/72694) ([Raúl Marín](https://github.com/Algunenano)).
* Enum データ型に対して文字列検索演算子（例: LIKE）のサポートを追加し、[#72661](https://github.com/ClickHouse/ClickHouse/issues/72661) を修正しました。[#72732](https://github.com/ClickHouse/ClickHouse/pull/72732)（[zhanglistar](https://github.com/zhanglistar)）。
* `notEmpty` 関数で `JSON` 型をサポートしました。 [#72741](https://github.com/ClickHouse/ClickHouse/pull/72741) ([Pavel Kruglov](https://github.com/Avogar))。
* GCS S3 エラー `AuthenticationRequired` の解析をサポート。 [#72753](https://github.com/ClickHouse/ClickHouse/pull/72753) ([Vitaly Baranov](https://github.com/vitlibar)).
* `ifNull` と `coalesce` 関数で Dynamic 型をサポートしました。 [#72772](https://github.com/ClickHouse/ClickHouse/pull/72772) ([Pavel Kruglov](https://github.com/Avogar))。
* `JoinBuildTableRowCount/JoinProbeTableRowCount/JoinResultRowCount` のプロファイルイベントを追加しました。 [#72842](https://github.com/ClickHouse/ClickHouse/pull/72842) ([Vladimir Cherkasov](https://github.com/vdimir)).
* 関数 toFloat64/toUInt32 などで Dynamic 型をサポートしました。 [#72989](https://github.com/ClickHouse/ClickHouse/pull/72989) ([Pavel Kruglov](https://github.com/Avogar)).





## バグ修正（公式安定版リリースにおけるユーザーに見える不具合） {#bug-fix}


* `ATTACH PART` クエリの実行中に重複排除されたパーツが、`attaching_` という接頭辞が付いた状態のまま残り続けることはなくなりました。 [#65636](https://github.com/ClickHouse/ClickHouse/pull/65636) ([Kirill](https://github.com/kirillgarbar)).
* `IN` 関数で DateTime64 の精度が失われるバグを修正。[#67230](https://github.com/ClickHouse/ClickHouse/pull/67230) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* `ORDER BY ... WITH FILL` で `IGNORE/RESPECT NULLS` を使用した際に発生しうる論理エラーを修正しました。[#57609](https://github.com/ClickHouse/ClickHouse/issues/57609) をクローズ。[#68234](https://github.com/ClickHouse/ClickHouse/pull/68234)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* メモリ制限に達した場合に、`Native` フォーマットでの非同期挿入で発生するまれな論理エラーを修正しました。 [#68965](https://github.com/ClickHouse/ClickHouse/pull/68965) ([Anton Popov](https://github.com/CurtizJ)).
* EPHEMERAL カラムに対する `CREATE TABLE` の `COMMENT` を修正。 [#70458](https://github.com/ClickHouse/ClickHouse/pull/70458) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* LowCardinality(Nullable) を用いた JSONExtract の論理エラーを修正しました。 [#70549](https://github.com/ClickHouse/ClickHouse/pull/70549) ([Pavel Kruglov](https://github.com/Avogar))。
* テーブル名が長すぎる場合の挙動を修正。 [#70810](https://github.com/ClickHouse/ClickHouse/pull/70810) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* URL エンジンで、ユーザー指定のヘッダーによって Content-Type を上書きできるようにしました。 [#70859](https://github.com/ClickHouse/ClickHouse/pull/70859) ([Artem Iurin](https://github.com/ortyomka)).
* `StorageS3Queue` の論理エラー「/processed にはすでに永続ノードが存在するため作成できません」を修正しました。 [#70984](https://github.com/ClickHouse/ClickHouse/pull/70984) ([Kseniia Sumarokova](https://github.com/kssenii))。
* projection の lightweight delete の rebuild オプションで &#95;row&#95;exists 列が考慮されていなかったバグを修正。 [#71089](https://github.com/ClickHouse/ClickHouse/pull/71089) ([Shichao Jin](https://github.com/jsc0218)).
* 予期しないレースコンディションにより `system.query_metric_log` に誤った値が記録される問題を修正。 [#71124](https://github.com/ClickHouse/ClickHouse/pull/71124) ([Pablo Marcos](https://github.com/pamarcos)).
* `quantileExactWeightedInterpolated` の集約関数名の不整合を修正しました。このバグは [https://github.com/ClickHouse/ClickHouse/pull/69619](https://github.com/ClickHouse/ClickHouse/pull/69619) で発生しました。cc @Algunenano。 [#71168](https://github.com/ClickHouse/ClickHouse/pull/71168) ([李扬](https://github.com/taiyang-li))。
* 関数比較で Dynamic を使用した際に発生する bad&#95;weak&#95;ptr 例外を修正。 [#71183](https://github.com/ClickHouse/ClickHouse/pull/71183) ([Pavel Kruglov](https://github.com/Avogar)).
* zero-copy レプリケーションを使用する ReplicatedMergeTree で、ノードが使用中の blob を削除しないようにしました。 [#71186](https://github.com/ClickHouse/ClickHouse/pull/71186) ([Antonio Andelic](https://github.com/antonio2368)).
* HTTP および Async Inserts 経由の Native フォーマットで `format` 設定が無視される問題を修正しました。 [#71193](https://github.com/ClickHouse/ClickHouse/pull/71193) ([Pavel Kruglov](https://github.com/Avogar)).
* 設定 `use_query_cache = 1` を指定して実行される SELECT クエリで、システムテーブル名がリテラルとして現れていても拒否されなくなりました。例えば、`SELECT - FROM users WHERE name = 'system.metrics' SETTINGS use_query_cache = true;` は、現在は問題なく動作します。 [#71254](https://github.com/ClickHouse/ClickHouse/pull/71254) ([Robert Schulze](https://github.com/rschu1ze)).
* enable&#95;filesystem&#95;cache=1 が有効で、storage configuration 内の disk に cache 設定がない場合にメモリ使用量が増加してしまう不具合を修正。 [#71261](https://github.com/ClickHouse/ClickHouse/pull/71261) ([Kseniia Sumarokova](https://github.com/kssenii))。
* Dynamic column から LowCardinality 辞書をデシリアライズする際に発生する可能性のある &quot;Cannot read all data&quot; エラーを修正。 [#71299](https://github.com/ClickHouse/ClickHouse/pull/71299) ([Pavel Kruglov](https://github.com/Avogar)).
* クライアントにおける parallel output format の不完全なクリーンアップ処理を修正。 [#71304](https://github.com/ClickHouse/ClickHouse/pull/71304) ([Raúl Marín](https://github.com/Algunenano)).
* named collection に不足していたアンエスケープ処理を追加しました。この修正がない場合、clickhouse-server は起動できません。[#71308](https://github.com/ClickHouse/ClickHouse/pull/71308) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* ネイティブプロトコル経由の空ブロックを伴う非同期挿入を修正しました。 [#71312](https://github.com/ClickHouse/ClickHouse/pull/71312) ([Anton Popov](https://github.com/CurtizJ)).
* 誤ったワイルドカード権限を付与した場合に発生する AST フォーマットの不整合を修正 [#71309](https://github.com/ClickHouse/ClickHouse/issues/71309)。[#71332](https://github.com/ClickHouse/ClickHouse/pull/71332)（[pufit](https://github.com/pufit)）。
* JSON 型ヒント内の不審な型および実験的な型をチェック。 [#71369](https://github.com/ClickHouse/ClickHouse/pull/71369) ([Pavel Kruglov](https://github.com/Avogar)).
* Variant カラムを含む Chunk における「Invalid number of rows」エラーを修正。 [#71388](https://github.com/ClickHouse/ClickHouse/pull/71388) ([Pavel Kruglov](https://github.com/Avogar)).
* 誤った引数（例：`NULL`）を渡した際に `mongodb` テーブル関数がクラッシュする不具合を修正。[#71426](https://github.com/ClickHouse/ClickHouse/pull/71426)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* optimize&#95;rewrite&#95;array&#95;exists&#95;to&#95;has によって発生するクラッシュを修正。 [#71432](https://github.com/ClickHouse/ClickHouse/pull/71432) ([Raúl Marín](https://github.com/Algunenano)).
* `palin&#95;rewritable` ディスクでディレクトリの作成に失敗した際、トランザクションのロールバック中に発生する `NoSuchKey` エラーを修正。 [#71439](https://github.com/ClickHouse/ClickHouse/pull/71439) ([Julia Kartseva](https://github.com/jkartseva)).
* 挿入時における設定 `max_insert_delayed_streams_for_parallel_write` の扱いを修正しました。以前は正しく動作しておらず、複数のパーティションにデータを書き込む挿入でメモリ使用量が増大する可能性がありました。 [#71474](https://github.com/ClickHouse/ClickHouse/pull/71474) ([Anton Popov](https://github.com/CurtizJ)).
* `WHERE` 条件内に `arrayJoin` が現れうる場合に、旧アナライザーで `Argument for function must be constant` というエラーが発生する可能性のあった問題を修正しました。[https://github.com/ClickHouse/ClickHouse/pull/65414](https://github.com/ClickHouse/ClickHouse/pull/65414) によるリグレッションです。[#71476](https://github.com/ClickHouse/ClickHouse/pull/71476)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 0 列の `SortCursor`（旧アナライザー）でクラッシュが発生しないようにしました。 [#71494](https://github.com/ClickHouse/ClickHouse/pull/71494) ([Raúl Marín](https://github.com/Algunenano)).
* 初期化されていない ORC データが原因で発生する date32 の範囲外エラーを修正しました。詳細については [https://github.com/apache/incubator-gluten/issues/7823](https://github.com/apache/incubator-gluten/issues/7823) を参照してください。 [#71500](https://github.com/ClickHouse/ClickHouse/pull/71500)（[李扬](https://github.com/taiyang-li)）。
* Dynamic 型および JSON 型に対して、ワイドパートでのカラムサイズの集計処理を修正しました。 [#71526](https://github.com/ClickHouse/ClickHouse/pull/71526) ([Pavel Kruglov](https://github.com/Avogar)).
* マテリアライズドビュー内のクエリが CTE とともに `IN` を使用する場合の Analyzer の不具合を修正。 [#65598](https://github.com/ClickHouse/ClickHouse/issues/65598) をクローズ。 [#71538](https://github.com/ClickHouse/ClickHouse/pull/71538)（[Maksim Kita](https://github.com/kitaisreal)）。
* bitShift 関数で範囲外となった場合にエラーをスローする代わりに、0 またはデフォルトの文字を返すようにしました。 [#71580](https://github.com/ClickHouse/ClickHouse/pull/71580) ([Pablo Marcos](https://github.com/pamarcos))。
* 特定のエンジンでマテリアライズドビューを使用した際に発生するサーバークラッシュを修正。 [#71593](https://github.com/ClickHouse/ClickHouse/pull/71593) ([Pervakov Grigorii](https://github.com/GrigoryPervakov)).
* 入れ子になったデータ構造に対する `ARRAY JOIN` で、その中に定数配列へのエイリアスが含まれている場合に、ヌルポインタのデリファレンスが発生していました。これにより [#71677](https://github.com/ClickHouse/ClickHouse/issues/71677) が修正されました。[#71678](https://github.com/ClickHouse/ClickHouse/pull/71678)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 空のタプルを指定した `ALTER` 実行時に発生する `LOGICAL_ERROR` を修正しました。これにより [#71647](https://github.com/ClickHouse/ClickHouse/issues/71647) が解決されます。 [#71679](https://github.com/ClickHouse/ClickHouse/pull/71679)（[Amos Bird](https://github.com/amosbird)）。
* `NOT IN` 演算子を使用している場合、パーティション列に対する述語内の定数集合を変換しないようにしました。 [#71695](https://github.com/ClickHouse/ClickHouse/pull/71695) ([Eduard Karacharov](https://github.com/korowa))。
* LowCardinality(Nullable) から Dynamic への `CAST` を修正しました。以前は `Bad cast from type DB::ColumnVector<int> to DB::ColumnNullable` というエラーが発生する可能性がありました。[#71742](https://github.com/ClickHouse/ClickHouse/pull/71742)（[Pavel Kruglov](https://github.com/Avogar)）。
* DateTime64 型のプライマリキーに対する WHERE 句での `toDayOfWeek` による例外を修正。 [#71849](https://github.com/ClickHouse/ClickHouse/pull/71849) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* スパースカラムへのパース後に、デフォルト値が正しく補完されるよう修正しました。 [#71854](https://github.com/ClickHouse/ClickHouse/pull/71854) ([Anton Popov](https://github.com/CurtizJ)).
* 分散テーブルで入力が ALIAS の場合に発生する GROUPING 関数のエラーを修正し、[#68602](https://github.com/ClickHouse/ClickHouse/issues/68602) をクローズしました。[#71855](https://github.com/ClickHouse/ClickHouse/pull/71855)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* `WITH TIES` 句を使用する SELECT 文で、必要な行数が返らない可能性があった問題を修正しました。 [#71886](https://github.com/ClickHouse/ClickHouse/pull/71886) ([wxybear](https://github.com/wxybear)).
* arrayWithConstant の評価時に、あるカラムが配列サイズの上限を超えていると誤判定されてしまい、その結果発生していた TOO&#95;LARGE&#95;ARRAY&#95;SIZE 例外を修正しました。 [#71894](https://github.com/ClickHouse/ClickHouse/pull/71894) ([Udi](https://github.com/udiz)).
* `clickhouse-benchmark` が、1 秒を超えるクエリに対して誤ったメトリクスを報告していました。 [#71898](https://github.com/ClickHouse/ClickHouse/pull/71898) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* clickhouse-client における進行状況インジケーターと進行状況テーブル間のデータレースを修正しました。この問題は FROM INFILE が使用されている場合に発生します。INSERT クエリの実行中にキーストロークをフックし、進行状況テーブルの表示を切り替えられるようにしました。 [#71901](https://github.com/ClickHouse/ClickHouse/pull/71901) ([Julia Kartseva](https://github.com/jkartseva)).
* PrettyJSON フォーマットにおける Dynamic 値のシリアル化を修正。 [#71923](https://github.com/ClickHouse/ClickHouse/pull/71923) ([Pavel Kruglov](https://github.com/Avogar))。
* 24.6 で壊れていた system.s3/azure&#95;queue&#95;log の rows&#95;processed 列を修正しました。 [#69975](https://github.com/ClickHouse/ClickHouse/issues/69975) をクローズします。 [#71946](https://github.com/ClickHouse/ClickHouse/pull/71946) ([Kseniia Sumarokova](https://github.com/kssenii))。
* `s3`/`s3Cluster` 関数が不完全な結果を返したり、例外をスローしたりする可能性があったケースを修正しました。これは、S3 URI でグロブパターン（`pattern/*` のようなもの）を使用し、かつキー `pattern/` を持つ空オブジェクトが存在している必要がある場合（そのようなオブジェクトは S3 Console によって自動的に作成されます）に関連する問題でした。さらに、設定 `s3_skip_empty_files` のデフォルト値が `false` から `true` に変更されました。 [#71947](https://github.com/ClickHouse/ClickHouse/pull/71947) ([Nikita Taranov](https://github.com/nickitat))。
* clickhouse-client の構文ハイライトで発生していたクラッシュを修正。[#71864](https://github.com/ClickHouse/ClickHouse/issues/71864) をクローズ。[#71949](https://github.com/ClickHouse/ClickHouse/pull/71949)（[Nikolay Degterinsky](https://github.com/evillique)）。
* `ORDER BY` で最初の引数が定数である場合の、`MergeTree` テーブルにおけるバイナリ単調関数に対する `Illegal type` エラーを修正します。 [#71941](https://github.com/ClickHouse/ClickHouse/issues/71941) を修正。 [#71966](https://github.com/ClickHouse/ClickHouse/pull/71966)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* サブクエリ内で使用される EXPLAIN AST では SELECT クエリのみを許可します。他の種類のクエリを使用すると、論理エラー: &#39;Bad cast from type DB::ASTCreateQuery to DB::ASTSelectWithUnionQuery&#39; または `Inconsistent AST formatting` が発生します。 [#71982](https://github.com/ClickHouse/ClickHouse/pull/71982) ([Pavel Kruglov](https://github.com/Avogar))。
* `clickhouse-client` でレコードを挿入する際、クライアントはサーバーからカラムの定義情報を読み取ります。しかし、その情報を書き込む順序が誤っているバグがありました。本来は [statistics, ttl, settings] の順序であるべきです。[#71991](https://github.com/ClickHouse/ClickHouse/pull/71991)（[Han Fei](https://github.com/hanfei1991)）。
* `format_alter_commands_with_parentheses` が有効な場合の `MOVE PARTITION ... TO TABLE ...` ALTER コマンドの書式を修正しました。 [#72080](https://github.com/ClickHouse/ClickHouse/pull/72080) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* File/S3/URL/HDFS/Azure エンジンの CREATE クエリに、推論されたフォーマット名を追加しました。以前は、サーバーの再起動のたびにフォーマット名が再推論され、指定されたデータファイルが削除されていると、サーバー起動時にエラーが発生していました。 [#72108](https://github.com/ClickHouse/ClickHouse/pull/72108) ([Pavel Kruglov](https://github.com/Avogar)).
* `min_age_to_force_merge_on_partition_only` が、すでに単一パーツにマージ済みの同一パーティションを繰り返しマージしようとして行き詰まり、複数パーツを持つパーティションをマージしないという不具合を修正しました。 [#72209](https://github.com/ClickHouse/ClickHouse/pull/72209) ([Christoph Wurm](https://github.com/cwurm)).
* 疎なカラムを処理する際にまれに発生していた `SimpleSquashingChunksTransform` のクラッシュを修正しました。[#72226](https://github.com/ClickHouse/ClickHouse/pull/72226)（[Vladimir Cherkasov](https://github.com/vdimir)）。
* `GraceHashJoin` におけるデータレースを修正しました。この不具合により、結合結果から一部の行が欠落する可能性がありました。 [#72233](https://github.com/ClickHouse/ClickHouse/pull/72233) ([Nikita Taranov](https://github.com/nickitat))。
* マテリアライズされた `_block_number` 列（設定 `enable_block_number_column` が有効な場合）を使う `ALTER DELETE` クエリの不具合を修正しました。 [#72261](https://github.com/ClickHouse/ClickHouse/pull/72261) ([Anton Popov](https://github.com/CurtizJ)).
* `ColumnDynamic::dumpStructure()` が同時に呼び出された場合（例: `ConcurrentHashJoin` のコンストラクタ内）に発生していたデータレースを修正しました。 [#72278](https://github.com/ClickHouse/ClickHouse/pull/72278) ([Nikita Taranov](https://github.com/nickitat)).
* `ORDER BY ... WITH FILL` で列が重複している場合に発生する可能性のある `LOGICAL_ERROR` を修正しました。 [#72387](https://github.com/ClickHouse/ClickHouse/pull/72387) ([Vladimir Cherkasov](https://github.com/vdimir)).
* `optimize_functions_to_subcolumns` を適用した後に、いくつかのケースで発生していた型の不一致を修正しました。 [#72394](https://github.com/ClickHouse/ClickHouse/pull/72394) ([Anton Popov](https://github.com/CurtizJ)).
* `BACKUP DATABASE db EXCEPT TABLES db.table` クエリのパースに失敗していた問題を修正しました。 [#72429](https://github.com/ClickHouse/ClickHouse/pull/72429) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 空の Variant を作成できないようにしました。 [#72454](https://github.com/ClickHouse/ClickHouse/pull/72454) ([Pavel Kruglov](https://github.com/Avogar)).
* `system.merges` における `result_part_path` の無効なフォーマットを修正しました。 [#72567](https://github.com/ClickHouse/ClickHouse/pull/72567) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 1 要素のみからなる `glob` のパースを修正。 [#72572](https://github.com/ClickHouse/ClickHouse/pull/72572) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* ARRAY JOIN を含む分散クエリにおいて、フォロワーサーバー向けのクエリ生成を修正。[#69276](https://github.com/ClickHouse/ClickHouse/issues/69276) を修正。[#72608](https://github.com/ClickHouse/ClickHouse/pull/72608)（[Dmitry Novik](https://github.com/novikd)）。
* `DateTime64` から `DateTime64` への変換で結果が返らなくなるバグを修正しました。 [#72640](https://github.com/ClickHouse/ClickHouse/pull/72640) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* `tracked_files_limit` の設定値が S3 ファイルの出現頻度よりも小さい場合に、S3Queue の Unordered モードで発生する「No such key」エラーを修正。 [#72738](https://github.com/ClickHouse/ClickHouse/pull/72738) ([Kseniia Sumarokova](https://github.com/kssenii)).
* mark cache の削除は、そのサイズが大きい場合、はっきり分かるほど時間がかかることがあります。この処理の間コンテキスト用の mutex を保持していると、多くのほかの処理がブロックされ、新しいクライアント接続でさえ、その mutex が解放されるまで確立できません。ただし、同期のためにこの mutex を保持しておく必要は実際にはなく、`shared ptr` を介してキャッシュへのローカル参照を持っていれば十分です。 [#72749](https://github.com/ClickHouse/ClickHouse/pull/72749) ([Alexander Gololobov](https://github.com/davenger))。
* あるテストインスタンスで、PK キャッシュが自身のサイズを大きく過小評価していました。特に、LowCardinality カラムではディクショナリのサイズが計算に含まれていませんでした。修正としては、`column-&gt;allocatedBytes()` を使用し、さらにキャッシュエントリサイズ向けにいくつかのオーバーヘッドを加味して見積もるようにしました。 [#72750](https://github.com/ClickHouse/ClickHouse/pull/72750) ([Alexander Gololobov](https://github.com/davenger))。
* ユーザーがローカルに存在しない場合に `RemoteQueryExecutor` でスローされる例外を修正しました。 [#72759](https://github.com/ClickHouse/ClickHouse/pull/72759) ([Andrey Zvonov](https://github.com/zvonand))。
* マテリアライズされた `_block_number` カラム（`enable_block_number_column` 設定が有効な場合）を使用する mutation の問題を修正しました。[#72854](https://github.com/ClickHouse/ClickHouse/pull/72854) ([Anton Popov](https://github.com/CurtizJ))。
* バックアップ内に空のファイルが存在する場合に、plain rewritable disk を用いたバックアップ／リストア処理が正しく動作しない問題を修正しました。 [#72858](https://github.com/ClickHouse/ClickHouse/pull/72858) ([Kseniia Sumarokova](https://github.com/kssenii)).
* DistributedAsyncInsertDirectoryQueue における挿入のキャンセル処理を適切に行うよう修正。 [#72885](https://github.com/ClickHouse/ClickHouse/pull/72885) ([Antonio Andelic](https://github.com/antonio2368)).
* 不正なデータをスパースカラムへパースする際に発生していたクラッシュを修正しました（設定 `enable_parsing_to_custom_serialization` が有効な場合に発生する可能性があります）。 [#72891](https://github.com/ClickHouse/ClickHouse/pull/72891) ([Anton Popov](https://github.com/CurtizJ)).
* バックアップ復元中に発生する可能性のあるクラッシュを修正。 [#72947](https://github.com/ClickHouse/ClickHouse/pull/72947) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `ON` 句に不等号フィルターを含む複雑な条件があるクエリで発生する可能性があった `parallel_hash` JOIN メソッドのバグを修正しました。 [#72993](https://github.com/ClickHouse/ClickHouse/pull/72993) ([Nikita Taranov](https://github.com/nickitat)).
* JSON のパース時にはデフォルトのフォーマット設定を使用し、不正なデシリアライズを避けます。 [#73043](https://github.com/ClickHouse/ClickHouse/pull/73043) ([Pavel Kruglov](https://github.com/Avogar)).
* サポートされていないストレージを使用するトランザクションで発生していたクラッシュを修正。 [#73045](https://github.com/ClickHouse/ClickHouse/pull/73045) ([Raúl Marín](https://github.com/Algunenano)).
* `Tuple` のパース中に重複した JSON キーをチェックするようにしました。以前は、これが原因でパース時に論理エラー `Invalid number of rows in Chunk` が発生する可能性がありました。 [#73082](https://github.com/ClickHouse/ClickHouse/pull/73082) ([Pavel Kruglov](https://github.com/Avogar)).
