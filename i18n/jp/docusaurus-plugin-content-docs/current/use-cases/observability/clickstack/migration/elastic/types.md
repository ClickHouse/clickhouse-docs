---
slug: /use-cases/observability/clickstack/migration/elastic/types
title: '型マッピング'
pagination_prev: null
pagination_next: null
sidebar_label: '型'
sidebar_position: 2
description: 'ClickHouse と Elasticsearch における型マッピング'
show_related_blogs: true
keywords: ['JSON', 'Codecs']
doc_type: 'reference'
---

Elasticsearch と ClickHouse は幅広いデータ型をサポートしていますが、基盤となるストレージおよびクエリモデルは根本的に異なります。このセクションでは、一般的に使用される Elasticsearch のフィールド型を、可能な場合にはそれに相当する ClickHouse の型に対応付けるとともに、移行の指針となる背景情報を提供します。等価な型が存在しない場合は、代替案や注意事項をコメント内に記載します。



| **Elasticsearch のタイプ**             | **ClickHouse での同等機能**                                                                                                                                                                                                                                                                        | **コメント**                                                                                                                                                                                                                                                                                                 |
| ---------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `boolean`                          | [`UInt8`](/sql-reference/data-types/int-uint)  または [`Bool`](/sql-reference/data-types/boolean)                                                                                                                                                                                               | ClickHouse のより新しいバージョンでは、`Boolean` 型は `UInt8` 型のエイリアスとしてサポートされています。                                                                                                                                                                                                                                      |
| `keyword`                          | [`String`](/sql-reference/data-types/string)                                                                                                                                                                                                                                                 | 完全一致でのフィルター、グループ化、ソートに使用されます。                                                                                                                                                                                                                                                                            |
| `text`                             | [`String`](/sql-reference/data-types/string)                                                                                                                                                                                                                                                 | ClickHouse では全文検索機能に制限があり、トークナイズ処理には `tokens` などの関数と配列関数を組み合わせたカスタムロジックが必要です。                                                                                                                                                                                                                            |
| `long`                             | [`Int64`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                                | 64ビット符号付き整数。                                                                                                                                                                                                                                                                                             |
| `integer`                          | [`Int32`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                                | 32 ビット符号付き整数。                                                                                                                                                                                                                                                                                            |
| `short`                            | [`Int16`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                                | 16 ビット符号付き整数。                                                                                                                                                                                                                                                                                            |
| `byte`                             | [`Int8`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                                 | 8ビット符号付き整数。                                                                                                                                                                                                                                                                                              |
| `unsigned_long`                    | [`UInt64`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                               | 符号なし 64 ビット整数。                                                                                                                                                                                                                                                                                           |
| `double`                           | [`Float64`](/sql-reference/data-types/float)                                                                                                                                                                                                                                                 | 64ビット浮動小数点数。                                                                                                                                                                                                                                                                                             |
| `float`                            | [`Float32`](/sql-reference/data-types/float)                                                                                                                                                                                                                                                 | 32ビット浮動小数点数。                                                                                                                                                                                                                                                                                             |
| `half_float`                       | [`Float32`](/sql-reference/data-types/float) または [`BFloat16`](/sql-reference/data-types/float)                                                                                                                                                                                               | 最も近い相当型です。ClickHouse には 16 ビット浮動小数点型がありません。ClickHouse には `BFloat16` がありますが、これは Half-float IEEE-754 とは異なります。half-float は範囲が狭い代わりに精度が高く、bfloat16 は精度を犠牲にして範囲を広げているため、機械学習ワークロードにより適しています。                                                                                                                  |
| `scaled_float`                     | [`Decimal(x, y)`](/sql-reference/data-types/decimal)                                                                                                                                                                                                                                         | 固定小数点数を格納します。                                                                                                                                                                                                                                                                                            |
| `date`                             | [`DateTime`](/sql-reference/data-types/datetime)                                                                                                                                                                                                                                             | 秒精度の等価な日付型です。                                                                                                                                                                                                                                                                                            |
| `date_nanos`                       | [`DateTime64`](/sql-reference/data-types/datetime64)                                                                                                                                                                                                                                         | ClickHouse は `DateTime64(9)` 型によりナノ秒精度をサポートしています。                                                                                                                                                                                                                                                        |
| `binary`                           | [`String`](/sql-reference/data-types/string), [`FixedString(N)`](/sql-reference/data-types/fixedstring)                                                                                                                                                                                      | バイナリフィールドは Base64 デコードする必要があります。                                                                                                                                                                                                                                                                         |
| `ip`                               | [`IPv4`](/sql-reference/data-types/ipv4), [`IPv6`](/sql-reference/data-types/ipv6)                                                                                                                                                                                                           | ネイティブな `IPv4` および `IPv6` 型を利用可能。                                                                                                                                                                                                                                                                         |
| `object`                           | [`Nested`](/sql-reference/data-types/nested-data-structures/nested), [`Map`](/sql-reference/data-types/map), [`Tuple`](/sql-reference/data-types/tuple), [`JSON`](/sql-reference/data-types/newjson)                                                                                         | ClickHouse は、[`Nested`](/sql-reference/data-types/nested-data-structures/nested) や [`JSON`](/sql-reference/data-types/newjson) を使用して JSON ライクなオブジェクトを表現できます。                                                                                                                                             |
| `flattened`                        | [`String`](/sql-reference/data-types/string)                                                                                                                                                                                                                                                 | Elasticsearch における flattened 型は、JSON オブジェクト全体を 1 つのフィールドとして保存し、詳細なマッピングを定義しなくてもネストされたキーに柔軟かつスキーマレスにアクセスできるようにします。ClickHouse では、類似の機能は String 型を用いて実現できますが、その場合の処理はマテリアライズドビューで実行する必要があります。                                                                                                               |
| `nested`                           | [`Nested`](/sql-reference/data-types/nested-data-structures/nested)                                                                                                                                                                                                                          | ClickHouse の `Nested` カラムは、ユーザーが `flatten_nested=0` を指定している場合、グループ化されたサブフィールドに対して同様の意味的な挙動を提供します。                                                                                                                                                                                                        |
| `join`                             | 該当なし                                                                                                                                                                                                                                                                                         | 親子関係という直接的な概念はありません。ClickHouse ではテーブル間の結合がサポートされているため不要です。                                                                                                                                                                                                                                               |
| `alias`                            | [`Alias`](/sql-reference/statements/create/table#alias) 列修飾子                                                                                                                                                                                                                                 | エイリアスはフィールド修飾子によって[サポートされています](/sql-reference/statements/create/table#alias)。エイリアスには関数を適用できます。例: `size String ALIAS formatReadableSize(size_bytes)`                                                                                                                                                      |
| `range` 型（`*_range`）               | [`Tuple(start, end)`](/sql-reference/data-types/tuple) または [`Array(T)`](/sql-reference/data-types/array)                                                                                                                                                                                     | ClickHouse にはネイティブな range 型はありませんが、数値や日付の範囲は [`Tuple(start, end)`](/sql-reference/data-types/tuple) や [`Array`](/sql-reference/data-types/array) 構造で表現できます。IP アドレス範囲（`ip_range`）については、CIDR 値を `String` 型として保存し、`isIPAddressInRange()` などの関数で判定します。また、効率的なフィルタリングのために、`ip_trie` ベースのルックアップ辞書の利用も検討してください。 |
| `aggregate_metric_double`          | [`AggregateFunction(...)`](/sql-reference/data-types/aggregatefunction) と [`SimpleAggregateFunction(...)`](/sql-reference/data-types/simpleaggregatefunction)                                                                                                                                | 集約関数の状態とマテリアライズドビューを使用して、事前集計済みメトリクスをモデル化します。すべての集約関数は集約関数の状態をサポートしています。                                                                                                                                                                                                                                 |
| `histogram`                        | [`Tuple(Array(Float64), Array(UInt64))`](/sql-reference/data-types/tuple)                                                                                                                                                                                                                    | 配列やカスタムスキーマを使用して、バケットとカウントを手動で定義します。                                                                                                                                                                                                                                                                     |
| `annotated-text`                   | [`String`](/sql-reference/data-types/string)                                                                                                                                                                                                                                                 | エンティティ対応検索やアノテーション向けの組み込みサポートはありません。                                                                                                                                                                                                                                                                     |
| `completion`, `search_as_you_type` | 該当なし                                                                                                                                                                                                                                                                                         | ネイティブのオートコンプリートやサジェスト用エンジンはありません。`String` と [検索関数](/sql-reference/functions/string-search-functions) を使用して再現できます。                                                                                                                                                                                        |
| `semantic_text`                    | 該当なし                                                                                                                                                                                                                                                                                         | ネイティブなセマンティック検索はサポートされていません。埋め込みを生成し、ベクター検索を利用してください。                                                                                                                                                                                                                                                    |
| `token_count`                      | [`Int32`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                                | インジェスト時に、`length(tokens())` 関数などを用いてトークン数を手動で計算するために使用します（例: マテリアライズド列で使用）。                                                                                                                                                                                                                              |
| `dense_vector`                     | [`Array(Float32)`](/sql-reference/data-types/array)                                                                                                                                                                                                                                          | 埋め込みの保存には配列を使用する                                                                                                                                                                                                                                                                                         |
| `sparse_vector`                    | [`Map(UInt32, Float32)`](/sql-reference/data-types/map)                                                                                                                                                                                                                                      | マップを使ってスパースベクトルを表現します。ネイティブなスパースベクトルのサポートはありません。                                                                                                                                                                                                                                                         |
| `rank_feature` / `rank_features`   | [`Float32`](/sql-reference/data-types/float), [`Array(Float32)`](/sql-reference/data-types/array)                                                                                                                                                                                            | クエリ時のネイティブなブースト機能はありませんが、スコアリングロジック内で手動実装することは可能です。                                                                                                                                                                                                                                                      |
| `geo_point`                        | [`Tuple(Float64, Float64)`](/sql-reference/data-types/tuple) または [`Point`](/sql-reference/data-types/geo#point)                                                                                                                                                                              | (緯度、経度) を表すタプルを使用します。[`Point`](/sql-reference/data-types/geo#point) は ClickHouse の型として利用可能です。                                                                                                                                                                                                            |
| `geo_shape`, `shape`               | [`Ring`](/sql-reference/data-types/geo#ring), [`LineString`](/sql-reference/data-types/geo#linestring), [`MultiLineString`](/sql-reference/data-types/geo#multilinestring), [`Polygon`](/sql-reference/data-types/geo#polygon), [`MultiPolygon`](/sql-reference/data-types/geo#multipolygon) | ジオシェイプと空間インデックスをネイティブにサポート。                                                                                                                                                                                                                                                                              |
| `percolator`                       | 該当なし                                                                                                                                                                                                                                                                                         | クエリ自体をインデックス化するという概念はありません。代わりに標準的な SQL とインクリメンタルなマテリアライズドビューを使用してください。                                                                                                                                                                                                                                  |
| `version`                          | [`String`](/sql-reference/data-types/string)                                                                                                                                                                                                                                                 | ClickHouse にはネイティブなバージョン型はありません。バージョンは文字列として保存し、必要に応じてカスタム UDF を使用してセマンティックな比較を行ってください。レンジクエリが必要な場合は、数値形式に正規化することを検討してください。                                                                                                                                                                              |



### Notes {#notes}

- **Arrays**: Elasticsearch では、すべてのフィールドがネイティブに配列をサポートします。ClickHouse では、配列は（`Array(String)` のように）明示的に定義する必要がありますが、その利点として `an_array[1]` のように特定の位置を直接参照してクエリできます。
- **Multi-fields**: Elasticsearch では、[同じフィールドを複数の方法でインデックス化](https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/multi-fields#_multi_fields_with_multiple_analyzers)（例: `text` と `keyword` の両方）できます。ClickHouse では、このパターンは別々のカラムまたはビューとしてモデリングする必要があります。
- **Map と JSON 型** - ClickHouse では、[`Map`](/sql-reference/data-types/map) 型が `resourceAttributes` や `logAttributes` のような動的なキーと値の構造をモデリングするためによく使われます。この型は、実行時に任意のキーを追加できるため、Elasticsearch の JSON オブジェクトと同様に、スキーマレスなインジェストを柔軟に実現できます。ただし、考慮すべき重要な制約があります:

  - **値の型の一貫性**: ClickHouse の [`Map`](/sql-reference/data-types/map) カラムは一貫した値の型（例: `Map(String, String)`）を持つ必要があります。型変換を行わない限り、混合型の値はサポートされません。
  - **パフォーマンスコスト**: [`Map`](/sql-reference/data-types/map) 内の任意のキーにアクセスするには、マップ全体をメモリに読み込む必要があり、パフォーマンス面で最適でない場合があります。
  - **サブカラムなし**: JSON と異なり、[`Map`](/sql-reference/data-types/map) 内のキーは真のサブカラムとして表現されないため、ClickHouse が効率的にインデックス化・圧縮・クエリする能力が制限されます。

  これらの制約により、ClickStack は [`Map`](/sql-reference/data-types/map) から ClickHouse が強化した [`JSON`](/sql-reference/data-types/newjson) 型への移行を進めています。[`JSON`](/sql-reference/data-types/newjson) 型は、`Map` の多くの欠点に対処しています:

  - **真のカラムナストレージ**: 各 JSON パスがサブカラムとして保存されるため、高効率な圧縮、フィルタリング、およびベクトル化されたクエリ実行が可能になります。
  - **混合型のサポート**: 異なるデータ型（整数、文字列、配列など）が、型変換や型の統一なしに同じパスの下に共存できます。
  - **ファイルシステムのスケーラビリティ**: 動的キー（`max_dynamic_paths`）および型（`max_dynamic_types`）に対する内部制限により、高カーディナリティなキー集合であっても、ディスク上のカラムファイルの爆発的な増加を防ぎます。
  - **高密度ストレージ**: `null` や欠損値はスパースに保存され、不要なオーバーヘッドを回避します。

    [`JSON`](/sql-reference/data-types/newjson) 型は特にオブザーバビリティ系のワークロードに適しており、スキーマレスなインジェストの柔軟性と、ネイティブな ClickHouse 型のパフォーマンスおよびスケーラビリティを両立します。そのため、動的な属性フィールドにおける [`Map`](/sql-reference/data-types/map) の理想的な代替となります。

    JSON 型の詳細については、[JSON guide](https://clickhouse.com/docs/integrations/data-formats/json/overview) および ["How we built a new powerful JSON data type for ClickHouse"](https://clickhouse.com/blog/a-new-powerful-json-data-type-for-clickhouse) を参照することをお勧めします。
