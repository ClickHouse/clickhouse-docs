---
slug: /use-cases/observability/clickstack/migration/elastic/types
title: 'マッピングタイプ'
pagination_prev: null
pagination_next: null
sidebar_label: 'タイプ'
sidebar_position: 2
description: 'ClickHouse と Elasticsearch におけるマッピングタイプ'
show_related_blogs: true
keywords: ['JSON', 'Codecs']
doc_type: 'reference'
---

Elasticsearch と ClickHouse は幅広いデータ型をサポートしていますが、その基盤となるストレージおよびクエリモデルは本質的に異なります。このセクションでは、一般的に使用される Elasticsearch のフィールド型を、可能な場合には ClickHouse における同等の型へマッピングし、あわせて移行の指針となる背景情報を提供します。等価な型が存在しない場合には、代替案や注意事項をコメントとして記載します。



| **Elasticsearch タイプ**              | **ClickHouse における同等機能**                                                                                                                                                                                                                                                                      | **コメント**                                                                                                                                                                                                                                                                                           |
| ---------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------- |
| `boolean`                          | [`UInt8`](/sql-reference/data-types/int-uint) または [`Bool`](/sql-reference/data-types/boolean)                                                                                                                                                                                                | ClickHouse のより新しいバージョンでは、`Boolean` は `UInt8` のエイリアスとしてサポートされています。                                                                                                                                                                                                                                  |
| `keyword`                          | [`String`](/sql-reference/data-types/string)                                                                                                                                                                                                                                                 | 完全一致に基づくフィルタリング、グルーピング、ソートに使用します。                                                                                                                                                                                                                                                                  |
| `text`                             | [`String`](/sql-reference/data-types/string)                                                                                                                                                                                                                                                 | ClickHouse における全文検索は制限があり、`tokens` などの関数と配列関数を組み合わせてトークン化用のカスタムロジックを実装する必要があります。                                                                                                                                                                                                                   |
| `long`                             | [`Int64`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                                | 64ビット符号付き整数。                                                                                                                                                                                                                                                                                       |
| `integer`                          | [`Int32`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                                | 32 ビット符号付き整数。                                                                                                                                                                                                                                                                                      |
| `short`                            | [`Int16`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                                | 16 ビット符号付き整数。                                                                                                                                                                                                                                                                                      |
| `byte`                             | [`Int8`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                                 | 8ビット符号付き整数。                                                                                                                                                                                                                                                                                        |
| `unsigned_long`                    | [`UInt64`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                               | 符号なし 64 ビット整数。                                                                                                                                                                                                                                                                                     |
| `double`                           | [`Float64`](/sql-reference/data-types/float)                                                                                                                                                                                                                                                 | 64ビット浮動小数点数。                                                                                                                                                                                                                                                                                       |
| `float`                            | [`Float32`](/sql-reference/data-types/float)                                                                                                                                                                                                                                                 | 32ビット浮動小数点数。                                                                                                                                                                                                                                                                                       |
| `half_float`                       | [`Float32`](/sql-reference/data-types/float) または [`BFloat16`](/sql-reference/data-types/float)                                                                                                                                                                                               | 最も近い同等の型です。ClickHouse には 16 ビットの float 型はありません。ClickHouse には `BFloat16` 型がありますが、これは IEEE 754 の half-float とは異なります。half-float は範囲が狭い代わりにより高い精度を提供しますが、bfloat16 は精度を犠牲にしてより広い範囲を扱えるため、機械学習ワークロードにより適しています。                                                                                           |
| `scaled_float`                     | [`Decimal(x, y)`](/sql-reference/data-types/decimal)                                                                                                                                                                                                                                         | 固定小数点数値を格納します。                                                                                                                                                                                                                                                                                     |
| `date`                             | [`DateTime`](/sql-reference/data-types/datetime)                                                                                                                                                                                                                                             | 秒精度を持つ等価な日付型。                                                                                                                                                                                                                                                                                      |
| `date_nanos`                       | [`DateTime64`](/sql-reference/data-types/datetime64)                                                                                                                                                                                                                                         | ClickHouse は `DateTime64(9)` によるナノ秒精度をサポートします。                                                                                                                                                                                                                                                     |
| `binary`                           | [`String`](/sql-reference/data-types/string), [`FixedString(N)`](/sql-reference/data-types/fixedstring)                                                                                                                                                                                      | バイナリフィールドには base64 デコードが必要です。                                                                                                                                                                                                                                                                      |
| `ip`                               | [`IPv4`](/sql-reference/data-types/ipv4), [`IPv6`](/sql-reference/data-types/ipv6)                                                                                                                                                                                                           | ネイティブな `IPv4` 型および `IPv6` 型を利用可能。                                                                                                                                                                                                                                                                  |
| `object`                           | [`Nested`](/sql-reference/data-types/nested-data-structures/nested), [`Map`](/sql-reference/data-types/map), [`Tuple`](/sql-reference/data-types/tuple), [`JSON`](/sql-reference/data-types/newjson)                                                                                         | ClickHouse では、[`Nested`](/sql-reference/data-types/nested-data-structures/nested) や [`JSON`](/sql-reference/data-types/newjson) を使用して、JSON のようなオブジェクトをモデリングできます。                                                                                                                                   |
| `flattened`                        | [`String`](/sql-reference/data-types/string)                                                                                                                                                                                                                                                 | Elasticsearch の flattened 型は、完全な JSON オブジェクトを単一のフィールドとして格納し、完全なマッピングを定義しなくても、ネストされたキーへ柔軟かつスキーマレスにアクセスできるようにします。ClickHouse では、同様の機能を `String` 型を用いて実現できますが、その場合、処理はマテリアライズドビュー内で行う必要があります。                                                                                                          |
| `nested`                           | [`Nested`](/sql-reference/data-types/nested-data-structures/nested)                                                                                                                                                                                                                          | ClickHouse の `Nested` 列は、ユーザーが `flatten_nested=0` を使用することを前提として、グループ化されたサブフィールドに対して同様のセマンティクスを提供します。                                                                                                                                                                                               |
| `join`                             | 該当なし                                                                                                                                                                                                                                                                                         | 親子関係という直接的な概念はありません。ClickHouse ではテーブル間の結合（JOIN）がサポートされているため、そのような概念は不要です。                                                                                                                                                                                                                          |
| `alias`                            | [`Alias`](/sql-reference/statements/create/table#alias) 列修飾子                                                                                                                                                                                                                                 | エイリアスはフィールド修飾子によって[サポートされています](/sql-reference/statements/create/table#alias)。これらのエイリアスには関数を適用できます。例: `size String ALIAS formatReadableSize(size_bytes)`                                                                                                                                            |
| `range` 型 (`*_range`)              | [`Tuple(start, end)`](/sql-reference/data-types/tuple) または [`Array(T)`](/sql-reference/data-types/array)                                                                                                                                                                                     | ClickHouse にはネイティブな範囲型はありませんが、数値および日付の範囲は [`Tuple(start, end)`](/sql-reference/data-types/tuple) や [`Array`](/sql-reference/data-types/array) 構造で表現できます。IP 範囲（`ip_range`）については、CIDR 値を `String` として保存し、`isIPAddressInRange()` などの関数で評価します。あるいは、効率的なフィルタリングのために `ip_trie` ベースのルックアップ辞書の利用を検討してください。 |
| `aggregate_metric_double`          | [`AggregateFunction(...)`](/sql-reference/data-types/aggregatefunction) および [`SimpleAggregateFunction(...)`](/sql-reference/data-types/simpleaggregatefunction)                                                                                                                              | 集約関数状態とマテリアライズドビューを使用して、あらかじめ集約されたメトリクスをモデリングします。すべての集約関数は集約状態をサポートします。                                                                                                                                                                                                                            |
| `histogram`                        | [`Tuple(Array(Float64), Array(UInt64))`](/sql-reference/data-types/tuple)                                                                                                                                                                                                                    | 配列またはカスタムスキーマを使用して、バケットとカウントを手動で表現します。                                                                                                                                                                                                                                                             |
| `annotated-text`                   | [`String`](/sql-reference/data-types/string)                                                                                                                                                                                                                                                 | エンティティを考慮した検索やアノテーションに対する組み込みサポートはありません。                                                                                                                                                                                                                                                           |
| `completion`, `search_as_you_type` | 該当なし                                                                                                                                                                                                                                                                                         | ネイティブのオートコンプリートやサジェストエンジンはありませんが、`String` 型と[検索関数](/sql-reference/functions/string-search-functions)を組み合わせることで同様の機能を実装できます。                                                                                                                                                                        |
| `semantic_text`                    | 該当なし                                                                                                                                                                                                                                                                                         | ネイティブのセマンティック検索機能はありません。埋め込みを生成し、ベクトル検索を利用してください。                                                                                                                                                                                                                                                  |
| `token_count`                      | [`Int32`](/sql-reference/data-types/int-uint)                                                                                                                                                                                                                                                | 取り込み時に `length(tokens())` 関数などを使ってトークン数を手動で計算するために使用（マテリアライズド列との併用も可能）                                                                                                                                                                                                                             |
| `dense_vector`                     | [`Array(Float32)`](/sql-reference/data-types/array)                                                                                                                                                                                                                                          | 埋め込みベクトルの保存には配列を使用する                                                                                                                                                                                                                                                                               |
| `sparse_vector`                    | [`Map(UInt32, Float32)`](/sql-reference/data-types/map)                                                                                                                                                                                                                                      | Map を使って疎ベクトルをシミュレートします。ネイティブな疎ベクトルのサポートはありません。                                                                                                                                                                                                                                                    |
| `rank_feature` / `rank_features`   | [`Float32`](/sql-reference/data-types/float), [`Array(Float32)`](/sql-reference/data-types/array)                                                                                                                                                                                            | クエリ実行時のブースティングをネイティブにはサポートしないが、スコアリングロジックで手動実装できる。                                                                                                                                                                                                                                                 |
| `geo_point`                        | [`Tuple(Float64, Float64)`](/sql-reference/data-types/tuple) または [`Point`](/sql-reference/data-types/geo#point)                                                                                                                                                                              | (緯度、経度) のタプルを使用します。[`Point`](/sql-reference/data-types/geo#point) は ClickHouse で利用可能なデータ型です。                                                                                                                                                                                                       |
| `geo_shape`, `shape`               | [`Ring`](/sql-reference/data-types/geo#ring), [`LineString`](/sql-reference/data-types/geo#linestring), [`MultiLineString`](/sql-reference/data-types/geo#multilinestring), [`Polygon`](/sql-reference/data-types/geo#polygon), [`MultiPolygon`](/sql-reference/data-types/geo#multipolygon) | ジオメトリと空間インデックスをネイティブサポート。                                                                                                                                                                                                                                                                          |
| `percolator`                       | 該当なし                                                                                                                                                                                                                                                                                         | クエリに対するインデックスという概念はありません。代わりに標準的な SQL と Incremental Materialized Views を使用してください。                                                                                                                                                                                                                  |
| `version`                          | [`String`](/sql-reference/data-types/string)                                                                                                                                                                                                                                                 | ClickHouse にはバージョンを表すネイティブなデータ型はありません。バージョンは文字列として保存し、必要に応じてセマンティック（意味的）な比較を行うために独自の UDF を使用してください。範囲クエリが必要な場合は、数値形式に正規化することを検討してください。                                                                                                                                                             |

### 注意事項 {#notes}

- **配列**: Elasticsearchでは、すべてのフィールドがネイティブに配列をサポートしています。ClickHouseでは、配列を明示的に定義する必要があります(例:`Array(String)`)が、特定の位置にアクセスしてクエリを実行できるという利点があります(例:`an_array[1]`)。
- **マルチフィールド**: Elasticsearchでは、[同じフィールドを複数の方法でインデックス化](https://www.elastic.co/docs/reference/elasticsearch/mapping-reference/multi-fields#_multi_fields_with_multiple_analyzers)できます(例:`text`と`keyword`の両方)。ClickHouseでは、このパターンは別々のカラムまたはビューを使用してモデル化する必要があります。
- **MapとJSON型** - ClickHouseでは、[`Map`](/sql-reference/data-types/map)型は`resourceAttributes`や`logAttributes`などの動的なキーバリュー構造をモデル化するために一般的に使用されます。この型は、実行時に任意のキーを追加できるようにすることで、柔軟なスキーマレス取り込みを可能にします。これはElasticsearchのJSONオブジェクトと本質的に類似しています。ただし、考慮すべき重要な制限があります:
  - **統一された値の型**: ClickHouseの[`Map`](/sql-reference/data-types/map)カラムは、一貫した値の型を持つ必要があります(例:`Map(String, String)`)。型強制なしでは、混合型の値はサポートされません。
  - **パフォーマンスコスト**: [`Map`](/sql-reference/data-types/map)内の任意のキーにアクセスするには、マップ全体をメモリにロードする必要があり、パフォーマンス上最適ではない場合があります。
  - **サブカラムなし**: JSONとは異なり、[`Map`](/sql-reference/data-types/map)内のキーは真のサブカラムとして表現されないため、ClickHouseのインデックス化、圧縮、効率的なクエリ実行の能力が制限されます。

  これらの制限により、ClickStackは[`Map`](/sql-reference/data-types/map)から、ClickHouseの強化された[`JSON`](/sql-reference/data-types/newjson)型への移行を進めています。[`JSON`](/sql-reference/data-types/newjson)型は、`Map`の多くの欠点に対処します:
  - **真のカラムナストレージ**: 各JSONパスはサブカラムとして保存され、効率的な圧縮、フィルタリング、ベクトル化されたクエリ実行が可能になります。
  - **混合型のサポート**: 異なるデータ型(例:整数、文字列、配列)が、型強制や型統一なしで同じパスの下に共存できます。
  - **ファイルシステムのスケーラビリティ**: 動的キー(`max_dynamic_paths`)と型(`max_dynamic_types`)の内部制限により、高カーディナリティのキーセットでも、ディスク上のカラムファイルの爆発的増加を防ぎます。
  - **高密度ストレージ**: nullや欠損値は疎に保存され、不要なオーバーヘッドを回避します。

    [`JSON`](/sql-reference/data-types/newjson)型は、特に可観測性ワークロードに適しており、スキーマレス取り込みの柔軟性とネイティブClickHouse型のパフォーマンスおよびスケーラビリティを提供します。これにより、動的属性フィールドにおける[`Map`](/sql-reference/data-types/map)の理想的な代替となります。

    JSON型の詳細については、[JSONガイド](https://clickhouse.com/docs/integrations/data-formats/json/overview)および["How we built a new powerful JSON data type for ClickHouse"](https://clickhouse.com/blog/a-new-powerful-json-data-type-for-clickhouse)を参照することをお勧めします。
