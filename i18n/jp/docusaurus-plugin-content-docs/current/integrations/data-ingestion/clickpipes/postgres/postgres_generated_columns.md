---
title: 'Postgres 生成列: 注意点とベストプラクティス'
slug: /integrations/clickpipes/postgres/generated_columns
description: 'PostgreSQL の生成列をレプリケーション対象のテーブルで使用する際に考慮すべき重要なポイントを説明するページ'
doc_type: 'guide'
keywords: ['clickpipes', 'postgresql', 'cdc', 'data ingestion', 'real-time sync']
---

レプリケーション対象のテーブルで PostgreSQL の生成列を使用する場合、いくつか重要な点を考慮する必要があります。これらの注意点は、レプリケーション処理や宛先システムにおけるデータ整合性に影響を及ぼす可能性があります。



## 生成カラムの問題 {#the-problem-with-generated-columns}

1. **`pgoutput`経由で公開されない:** 生成カラムは`pgoutput`論理レプリケーションプラグインを通じて公開されません。つまり、PostgreSQLから別のシステムへデータをレプリケートする際、生成カラムの値はレプリケーションストリームに含まれません。

2. **主キーに関する問題:** 生成カラムが主キーの一部である場合、レプリケーション先で重複排除の問題が発生する可能性があります。生成カラムの値はレプリケートされないため、レプリケーション先システムは行を適切に識別し重複排除するために必要な情報を持ちません。

3. **スキーマ変更に関する問題:** すでにレプリケートされているテーブルに生成カラムを追加した場合、新しいカラムはレプリケーション先に反映されません。これはPostgreSQLが新しいカラムに対するRelationMessageを提供しないためです。その後、同じテーブルに新しい非生成カラムを追加すると、ClickPipeがスキーマの調整を試みる際に、レプリケーション先で生成カラムを見つけることができず、レプリケーションプロセスが失敗します。


## ベストプラクティス {#best-practices}

これらの制限を回避するには、以下のベストプラクティスを考慮してください：

1. **レプリケーション先で生成カラムを再作成する：** レプリケーションプロセスに生成カラムの処理を任せるのではなく、dbt（data build tool）などのツールやその他のデータ変換メカニズムを使用して、レプリケーション先でこれらのカラムを再作成することを推奨します。

2. **プライマリキーに生成カラムを使用しない：** レプリケーション対象となるテーブルを設計する際は、プライマリキーの一部として生成カラムを含めないようにしてください。


## UIの今後の改善予定 {#upcoming-improvements-to-ui}

今後のバージョンでは、ユーザーをサポートするために以下の機能を持つUIを追加する予定です：

1. **生成カラムを含むテーブルの識別：** 生成カラムを含むテーブルを識別する機能をUIに追加します。これにより、どのテーブルがこの問題の影響を受けるかをユーザーが把握できるようになります。

2. **ドキュメントとベストプラクティス：** レプリケートされたテーブルで生成カラムを使用する際のベストプラクティスをUIに含め、一般的な落とし穴を回避する方法についてのガイダンスを提供します。
