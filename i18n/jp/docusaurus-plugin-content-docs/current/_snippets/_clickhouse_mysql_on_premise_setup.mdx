MySQL インターフェイスを有効にした状態で ClickHouse サーバーをセットアップする方法については、[公式ドキュメント](/interfaces/mysql) を参照してください。

サーバーの `config.xml` にエントリを追加することに加えて

```xml
<clickhouse>
    <mysql_port>9004</mysql_port>
</clickhouse>
```

MySQL インターフェイスを使用するユーザーには、
[Double SHA1 password encryption](/operations/settings/settings-users#user-namepassword)
を使用することが*必須*です。

シェルから Double SHA1 で暗号化されたランダムなパスワードを生成するには、次のようにします。

```shell
PASSWORD=$(base64 < /dev/urandom | head -c16); echo "$PASSWORD"; echo -n "$PASSWORD" | sha1sum | tr -d '-' | xxd -r -p | sha1sum | tr -d '-'
```

出力は次のようになります：

```
LZOQYnqQN4L/T6L0
fbc958cc745a82188a51f30de69eebfc67c40ee4
```

最初の行は生成されたパスワードで、2行目は ClickHouse を構成する際に使用できるハッシュ値です。

以下は、生成されたハッシュを使用する `mysql_user` の設定例です。

`/etc/clickhouse-server/users.d/mysql_user.xml`

```xml
<users>
    <mysql_user>
        <password_double_sha1_hex>fbc958cc745a82188a51f30de69eebfc67c40ee4</password_double_sha1_hex>
        <networks>
            <ip>::/0</ip>
        </networks>
        <profile>default</profile>
        <quota>default</quota>
    </mysql_user>
</users>
```

`password_double_sha1_hex` エントリを、独自に生成した Double SHA1 ハッシュ値に置き換えてください。

さらに、`SHOW [FULL] COLUMNS` クエリ結果で ClickHouse の型ではなく MySQL ネイティブの型を表示するために、
`use_mysql_types_in_show_columns` を使用することが推奨されます。これにより、MySQL コネクタ経由で接続する際に
BI ツールがデータベーススキーマを適切に把握できるようになります。

例:

`/etc/clickhouse-server/users.d/mysql_user.xml`

```xml
<profiles>
    <default>
        <use_mysql_types_in_show_columns>1</use_mysql_types_in_show_columns>
    </default>
</profiles>
```

または、デフォルトプロファイルではなく別のプロファイルに割り当てます。

`mysql` バイナリが利用可能であれば、コマンドラインから接続をテストできます。
上記のサンプルのユーザー名（`mysql_user`）とパスワード（`LZOQYnqQN4L/T6L0`）を使用する場合、実行するコマンドは次のとおりです。

```bash
mysql --protocol tcp -h localhost -u mysql_user -P 9004 --password=LZOQYnqQN4L/T6L0
```

```
mysql> show databases;
+--------------------+
| name               |
+--------------------+
| INFORMATION_SCHEMA |
| default            |
| information_schema |
| system             |
+--------------------+
4 rows in set (0.00 sec)
Read 4 rows, 603.00 B in 0.00156 sec., 2564 rows/sec., 377.48 KiB/sec.
```

最後に、ClickHouse Server が目的の IP アドレスで待ち受けるように設定します。たとえば、`config.xml` で次の設定のコメントアウトを解除すると、すべてのアドレスで待ち受けるようになります。

```bash
<listen_host>::</listen_host> 
```
