---
description: 'Clickhouse Obfuscator のドキュメント'
slug: /operations/utilities/clickhouse-obfuscator
title: 'clickhouse-obfuscator'
doc_type: 'reference'
---

テーブルデータを難読化するためのシンプルなツールです。

入力テーブルを読み込み、入力のいくつかの性質は保持しつつも、異なるデータを含む出力テーブルを生成します。
これにより、ベンチマーク用途でほぼ本番同等のデータを公開することができます。

このツールは、データの以下の性質を保持するように設計されています:

- すべての列および列の組に対する値の基数（異なる値の数）;
- 条件付き基数: ある列の値に条件を課したときの、別の列の異なる値の数;
- 整数の絶対値の確率分布、有符号整数の符号、浮動小数点数の指数部と符号;
- 文字列長の確率分布;
- 数値のゼロ値、空文字列および空配列、`NULL` の確率;

- LZ77 およびエントロピー系コーデックで圧縮したときのデータ圧縮率;
- テーブル全体における時刻値の連続性（差分の大きさ）、浮動小数点値の連続性;
- `DateTime` 値の日付成分;

- 文字列値の UTF-8 妥当性;
- 文字列値が自然に見えること。

上記の特性の多くはパフォーマンス テストに有効です。

基数、値の大きさ、圧縮率などが維持されるため、データの読み取り、フィルタリング、集約、およびソートは、
元のデータとほぼ同じ速度で動作します。

このツールは決定論的に動作します。シード値を指定すると、変換は入力データとシードによって一意に決まります。
一対一で逆変換可能な変換もあるため、大きなシード値を用い、それを秘匿しておく必要があります。

データを変換するためにいくつかの暗号プリミティブを使用しますが、暗号学的な観点からは厳密な処理にはなっていません。
そのため、他に根拠がない限り、結果が安全であるとは見なさないでください。結果には、公開したくない一部のデータが残る可能性があります。

このツールは、0, 1, -1 の数値、日付、配列長、null フラグを、常に元のデータとまったく同じまま残します。
たとえば、テーブルに 0 と 1 の値を持つ `IsMobile` 列がある場合、変換後のデータでも同じ値のままです。

したがって、ユーザーはモバイルトラフィックの正確な比率を算出できます。

別の例を挙げます。テーブルにユーザーのメールアドレスのようなプライベートデータがあり、単一のメールアドレスも公開したくないとします。
テーブルが十分に大きく、多数の異なるメールアドレスを含み、かつ特定のメールアドレスだけが他と比べて極端に高頻度で出現しない場合は、すべてのデータが匿名化されます。しかし、列内の異なる値の数が少ない場合は、その一部が再現されてしまう可能性があります。
このツールの動作アルゴリズムを理解したうえで、コマンドラインパラメータを細かく調整する必要があります。

このツールが適切に動作するのは、少なくともある程度の量のデータ（少なくとも数千行）がある場合のみです。