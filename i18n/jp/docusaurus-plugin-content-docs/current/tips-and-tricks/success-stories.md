---
sidebar_position: 1
slug: /community-wisdom/creative-use-cases
sidebar_label: '成功事例'
doc_type: 'guide'
keywords: [
  'clickhouse 創造的なユースケース',
  'clickhouse 成功事例',
  '型破りなデータベース利用法',
  'clickhouse レート制限',
  '分析データベースのアプリケーション',
  'clickhouse モバイル分析',
  '顧客向け分析',
  'データベースイノベーション',
  'clickhouse リアルタイムアプリケーション',
  '代替データベースソリューション',
  'データベースの常識を打ち破る',
  '本番環境での成功事例'
]
title: 'レッスン - 創造的なユースケース'
description: '低速なクエリ、メモリエラー、接続トラブル、設定の問題など、代表的な ClickHouse の課題に対する解決策を見つけることができます。'
---



# 成功事例 {#breaking-the-rules}

_本ガイドは、コミュニティミートアップから得られた知見をまとめたコレクションの一部です。実際のソリューションや洞察については、[特定の問題別に参照](./community-wisdom.md)してください。_
_本番環境での問題のデバッグに関するヒントが必要ですか？[デバッグインサイト](./debugging-insights.md)コミュニティガイドをご確認ください。_

これらの事例は、企業がClickHouseを活用してユースケースで成功を収めた方法を紹介しています。中には従来のデータベースの常識に挑戦し、時には「不適切」とされるツールがまさに最適なソリューションになることを証明した事例もあります。


## レート制限機能としてのClickHouse {#clickhouse-rate-limiter}

Craigslistがユーザーを保護するために第一層のレート制限を追加する必要に迫られた際、あらゆるエンジニアリングチームが直面する同じ決断に直面しました。従来の常識に従ってRedisを使用するか、それとも別の選択肢を探るかという決断です。Craigslistで働くBrad Lhotskyは、Redisが標準的な選択肢であることを知っていました。オンライン上のほぼすべてのレート制限のチュートリアルや例がRedisを使用しているのには十分な理由があります。Redisはレート制限操作のための豊富なプリミティブ、確立されたパターン、そして実績のある稼働実績を持っています。しかし、CraigslistにおけるRedisの運用経験は教科書的な例とは一致していませんでした。_「Redisに関する我々の経験は、映画で見るようなものではありません。Redisクラスタのノードを再起動すると、フロントエンドにレイテンシのスパイクが発生するといった、奇妙なメンテナンス上の問題に数多く直面してきました」_メンテナンスのシンプルさを重視する小規模なチームにとって、これらの運用上の問題は深刻な課題となっていました。

そのため、Bradがレート制限の要件を提示された際、彼は異なるアプローチを取りました。_「上司に『このアイデアについてどう思いますか？ClickHouseで試してみてもいいでしょうか?』と尋ねました」_このアイデアは型破りなものでした。通常はキャッシング層の問題として扱われるものに分析データベースを使用するというものです。しかし、これは彼らの中核的な要件に対応していました。フェイルオープン、レイテンシペナルティの回避、そして小規模チームにとってメンテナンスが安全であることです。このソリューションは、アクセスログがすでにKafka経由でClickHouseに流れ込んでいる既存のインフラストラクチャを活用しました。別個のRedisクラスタを維持する代わりに、アクセスログデータから直接リクエストパターンを分析し、既存のACL APIにレート制限ルールを注入することができました。このアプローチはRedisよりもわずかにレイテンシが高くなることを意味していました。Redisは_「データセットを事前にインスタンス化することで、ある種のズルをしている」_のであり、リアルタイムの集計クエリを実行しているわけではありません。それでも、クエリは100ミリ秒未満で完了しました。

**主な成果:**

- Redisインフラストラクチャに対する劇的な改善
- 自動クリーンアップのための組み込みTTLによりメンテナンスオーバーヘッドを排除
- SQLの柔軟性により、単純なカウンタを超えた複雑なレート制限ルールを実現
- 別個のインフラストラクチャを必要とせず、既存のデータパイプラインを活用


## 顧客分析のためのClickHouse {#customer-analytics}

ServiceNowがモバイル分析プラットフォームのアップグレードを必要とした際、シンプルな疑問に直面しました。_「なぜ機能しているものを置き換える必要があるのか?」_ ServiceNowのAmir Vazaは、既存のシステムが信頼性の高いものであることを理解していましたが、顧客の要求がシステムの処理能力を超えて増大していました。_「既存の信頼性の高いモデルを置き換える動機は、実際には製品側から来ています」_ とAmirは説明しました。ServiceNowはウェブ、モバイル、チャットボット向けのソリューションの一部としてモバイル分析を提供していましたが、顧客は事前集計されたデータの枠を超えた分析の柔軟性を求めていました。

以前のシステムは、アプリケーション、アプリバージョン、プラットフォームという固定ディメンションでセグメント化された事前集計データを持つ約30の異なるテーブルを使用していました。顧客が送信できるキーと値のペアであるカスタムプロパティについては、各グループごとに個別のカウンターを作成していました。このアプローチは高速なダッシュボードパフォーマンスを実現しましたが、大きな制限がありました。_「これは迅速な値の内訳には優れていますが、先ほど述べた制限により分析コンテキストが大幅に失われます」_ とAmirは指摘しました。顧客は複雑な顧客ジャーニー分析を実行したり、「『research RSA token』という検索語で開始されたセッションはいくつあるか」といった質問をして、それらのユーザーが次に何をしたかを分析することができませんでした。事前集計された構造は、複数ステップの分析に必要な順序コンテキストを破壊し、新しい分析ディメンションを追加するたびに事前集計と保存のためのエンジニアリング作業が必要でした。

そのため、制限が明確になった時点で、ServiceNowはClickHouseに移行し、これらの事前計算の制約を完全に排除しました。すべての変数を事前に計算する代わりに、メタデータをデータポイントに分解し、すべてを直接ClickHouseに挿入しました。データ取り込みを効率的に処理するために、ClickHouseの非同期挿入キューを使用しました。Amirはこれを _「本当に素晴らしい」_ と評しました。このアプローチにより、顧客は独自のセグメントを作成し、任意のディメンションでデータを自由にスライスし、以前は不可能だった複雑な顧客ジャーニー分析を実行できるようになりました。

**主な成果:**

- 事前計算なしで任意のディメンションにわたる動的セグメンテーション
- 複雑な顧客ジャーニー分析が可能に
- 顧客が独自のセグメントを作成し、データを自由にスライス可能に
- 新しい分析要件に対するエンジニアリングのボトルネックが解消


## 動画リソース {#video-sources}

- **[Breaking the Rules - ClickHouseでレートリミッターを構築する](https://www.youtube.com/watch?v=wRwqrbUjRe4)** - Brad Lhotsky (Craigslist)
- **[ServiceNowにおける分析ソリューションとしてのClickHouse](https://www.youtube.com/watch?v=b4Pmpx3iRK4)** - Amir Vaza (ServiceNow)

_これらの事例は、従来のデータベースの常識に疑問を投げかけることで、分析データベースで実現可能なことを再定義する画期的なソリューションにつながることを示しています。_
