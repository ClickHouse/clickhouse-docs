---
sidebar_position: 1
slug: /community-wisdom/creative-use-cases
sidebar_label: '成功事例'
doc_type: 'guide'
keywords: [
  'clickhouse creative use cases',
  'clickhouse success stories',
  'unconventional database uses',
  'clickhouse rate limiting',
  'analytics database applications',
  'clickhouse mobile analytics',
  'customer-facing analytics',
  'database innovation',
  'clickhouse real-time applications',
  'alternative database solutions',
  'breaking database conventions',
  'production success stories'
]
title: 'レッスン - クリエイティブなユースケース'
description: '遅いクエリ、メモリエラー、接続の問題、設定の問題など、最も一般的な ClickHouse の問題に対する解決策を見つけることができます。'
---



# 成功事例 {#breaking-the-rules}

_このガイドは、コミュニティミートアップで得られた知見をまとめたコレクションの一部です。実際のソリューションや洞察については、[特定の問題別に参照](./community-wisdom.md)できます。_
_本番環境での問題のデバッグに関するヒントが必要ですか？[デバッグインサイト](./debugging-insights.md)コミュニティガイドをご覧ください。_

これらの事例は、企業がClickHouseを活用してユースケースで成功を収めた方法を紹介しています。中には従来のデータベースカテゴリの常識に挑戦し、時には「不適切」とされるツールがまさに最適なソリューションになることを証明した事例もあります。


## レート制限機構としてのClickHouse {#clickhouse-rate-limiter}

Craigslistがユーザーを保護するために第一層のレート制限を追加する必要に迫られた際、あらゆるエンジニアリングチームが直面する同じ選択に直面しました。従来の定石に従ってRedisを使用するか、それとも別の方法を探るか、という選択です。Craigslistでエンジニアとして働くBrad Lhotskyは、Redisが標準的な選択肢であることを知っていました。オンライン上のほぼすべてのレート制限のチュートリアルや例がRedisを使用しているのには、それなりの理由があります。Redisはレート制限操作のための豊富なプリミティブ、確立されたパターン、そして実績のある稼働実績を持っています。しかし、CraigslistのRedisでの経験は、教科書的な例とは一致していませんでした。_「Redisでの私たちの経験は、映画で見るようなものではありません...Redisクラスタのノードを再起動すると、フロントエンドにレイテンシのスパイクが発生するといった、奇妙な保守上の問題に数多く遭遇してきました。」_ 保守のシンプルさを重視する小規模なチームにとって、これらの運用上の問題は深刻な課題となっていました。

そこで、Bradがレート制限の要件を提示された際、彼は異なるアプローチを取りました。_「上司に『このアイデアをどう思いますか？ClickHouseで試してみてもいいでしょうか？』と尋ねました。」_ このアイデアは型破りなものでした。通常はキャッシング層の問題として扱われるものに分析データベースを使用するというものです。しかし、これは彼らの中核的な要件を満たしていました。フェイルオープン、レイテンシペナルティの回避、そして小規模チームにとって保守が安全であることです。このソリューションは、アクセスログがすでにKafka経由でClickHouseに流れ込んでいる既存のインフラストラクチャを活用しました。別個のRedisクラスタを保守する代わりに、アクセスログデータから直接リクエストパターンを分析し、既存のACL APIにレート制限ルールを注入することができました。このアプローチは、Redisよりもわずかにレイテンシが高くなることを意味していました。Redisは_「データセットを事前にインスタンス化することで、ある種のズルをしている」_のであり、リアルタイムの集計クエリを実行しているわけではありません。それでも、クエリは100ミリ秒未満で完了しました。

**主な成果:**

- Redisインフラストラクチャに対する劇的な改善
- 自動クリーンアップのための組み込みTTLにより保守オーバーヘッドを削減
- SQLの柔軟性により、単純なカウンタを超えた複雑なレート制限ルールを実現
- 別個のインフラストラクチャを必要とせず、既存のデータパイプラインを活用


## 顧客分析のためのClickHouse {#customer-analytics}

ServiceNowがモバイル分析プラットフォームのアップグレードを必要としたとき、シンプルな疑問に直面しました。_「なぜ機能しているものを置き換える必要があるのか?」_ ServiceNowのAmir Vazaは、既存のシステムが信頼性の高いものであることを知っていましたが、顧客の要求は既存システムが対応できる範囲を超えて成長していました。_「既存の信頼性の高いモデルを置き換える動機は、実際には製品側の要求から来ています」_ とAmirは説明しました。ServiceNowはWeb、モバイル、チャットボット向けソリューションの一部としてモバイル分析を提供していましたが、顧客は事前集計データの枠を超えた分析の柔軟性を求めていました。

以前のシステムは、アプリケーション、アプリバージョン、プラットフォームという固定されたディメンションで分割された事前集計データを持つ約30の異なるテーブルを使用していました。顧客が送信できるキーと値のペアであるカスタムプロパティについては、各グループごとに個別のカウンターを作成していました。このアプローチは高速なダッシュボードパフォーマンスを実現しましたが、大きな制限がありました。_「これは迅速な値の内訳には優れていますが、この制限により、分析コンテキストの多くが失われてしまいます」_ とAmirは指摘しました。顧客は複雑な顧客ジャーニー分析を実行したり、「『research RSA token』という検索語で開始されたセッションはいくつあるか」といった質問をして、それらのユーザーが次に何をしたかを分析したりすることができませんでした。事前集計された構造は、複数ステップの分析に必要な順序コンテキストを破壊し、新しい分析ディメンションを追加するたびにエンジニアリング作業による事前集計と保存が必要でした。

そのため、制限が明らかになったとき、ServiceNowはClickHouseに移行し、これらの事前計算の制約を完全に排除しました。すべての変数を事前に計算する代わりに、メタデータをデータポイントに分解し、すべてを直接ClickHouseに挿入しました。データ取り込みを効率的に処理するために、ClickHouseの非同期挿入キューを使用しました。Amirはこれを _「本当に素晴らしい」_ と評しました。このアプローチにより、顧客は独自のセグメントを作成し、任意のディメンションでデータを自由に分割し、以前は不可能だった複雑な顧客ジャーニー分析を実行できるようになりました。

**主な成果:**

- 事前計算なしで任意のディメンションにわたる動的セグメンテーション
- 複雑な顧客ジャーニー分析が可能に
- 顧客が独自のセグメントを作成し、データを自由に分割できるように
- 新しい分析要件に対するエンジニアリングのボトルネックが解消


## 動画リソース {#video-sources}

- **[Breaking the Rules - ClickHouseでレートリミッターを構築する](https://www.youtube.com/watch?v=wRwqrbUjRe4)** - Brad Lhotsky (Craigslist)
- **[ServiceNowにおける分析ソリューションとしてのClickHouse](https://www.youtube.com/watch?v=b4Pmpx3iRK4)** - Amir Vaza (ServiceNow)

_これらの事例は、従来のデータベースの常識に疑問を投げかけることで、分析データベースで実現可能なことを再定義する画期的なソリューションにつながることを示しています。_
