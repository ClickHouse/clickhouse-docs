---
slug: /whats-new/changelog/2017
sidebar_position: 10
sidebar_label: "2017"
title: "2017年の変更履歴"
description: "2017年の変更履歴"
doc_type: "changelog"
keywords:
  [
    "ClickHouse 2017",
    "changelog 2017",
    "リリースノート",
    "バージョン履歴",
    "初期リリース"
  ]
---

### ClickHouse Release 1.1.54327, 2017-12-21 {#clickhouse-release-1-1-54327-2017-12-21}

このリリースには、前回のリリース1.1.54318のバグ修正が含まれています:

- レプリケーションにおける競合状態によりデータ損失が発生する可能性があるバグを修正しました。この問題はバージョン1.1.54310および1.1.54318に影響します。これらのバージョンのいずれかをReplicatedテーブルで使用している場合は、更新を強く推奨します。この問題は、`Part ... from own log does not exist.`のような警告メッセージとしてログに表示されます。ログにこれらのメッセージが表示されない場合でも、この問題は関連性があります。

### ClickHouse Release 1.1.54318, 2017-11-30 {#clickhouse-release-1-1-54318-2017-11-30}

このリリースには、前回のリリース1.1.54310のバグ修正が含まれています:

- SummingMergeTreeエンジンでのマージ中に発生する誤った行削除を修正
- 非レプリケーションMergeTreeエンジンでのメモリリークを修正
- MergeTreeエンジンでの頻繁な挿入によるパフォーマンス低下を修正
- レプリケーションキューが停止する問題を修正
- サーバーログのローテーションとアーカイブを修正

### ClickHouse Release 1.1.54310, 2017-11-01 {#clickhouse-release-1-1-54310-2017-11-01}

#### 新機能: {#new-features}

- MergeTreeファミリーのテーブルエンジン向けのカスタムパーティショニングキー。
- [Kafka](/engines/table-engines/integrations/kafka)テーブルエンジン。
- [CatBoost](https://yandex.com/dev/catboost/)モデルの読み込みと、ClickHouseに保存されたデータへの適用のサポートを追加。
- UTCからの非整数オフセットを持つタイムゾーンのサポートを追加。
- 時間間隔での算術演算のサポートを追加。
- DateおよびDateTime型の値の範囲を2105年まで拡張。
- `CREATE MATERIALIZED VIEW x TO y`クエリを追加(マテリアライズドビューのデータを保存する既存のテーブルを指定)。
- 引数なしの`ATTACH TABLE`クエリを追加。
- SummingMergeTreeテーブルで名前が-Mapで終わるNested列の処理ロジックをsumMap集約関数に抽出。これらの列を明示的に指定できるようになりました。
- IPトライ辞書の最大サイズを128Mエントリに増加。
- getSizeOfEnumType関数を追加。
- sumWithOverflow集約関数を追加。
- Cap'n Proto入力フォーマットのサポートを追加。
- zstdアルゴリズムを使用する際に圧縮レベルをカスタマイズできるようになりました。

#### 後方互換性のない変更: {#backward-incompatible-changes}

- Memory以外のエンジンでの一時テーブルの作成は許可されません。
- ViewまたはMaterializedViewエンジンでのテーブルの明示的な作成は許可されません。
- テーブル作成時に、サンプリングキー式がプライマリキーに含まれていることを検証する新しいチェックが追加されました。

#### バグ修正: {#bug-fixes}

- Distributedテーブルへの同期挿入時のハングアップを修正。
- Replicatedテーブルでのパーツの非アトミックな追加と削除を修正。
- マテリアライズドビューに挿入されたデータが不要な重複排除の対象にならないように修正。
- ローカルレプリカが遅延し、リモートレプリカが利用できないDistributedテーブルへのクエリ実行がエラーにならないように修正。
- 一時テーブルを作成するために`default`データベースへのアクセス権限が不要になりました。
- 引数なしでArray型を指定した際のクラッシュを修正。
- サーバーログを含むディスクボリュームが満杯の場合のハングアップを修正。
- Unixエポックの最初の週におけるtoRelativeWeekNum関数のオーバーフローを修正。

#### ビルドの改善: {#build-improvements}

- 複数のサードパーティライブラリ(特にPoco)を更新し、gitサブモジュールに変換。

### ClickHouse Release 1.1.54304, 2017-10-19 {#clickhouse-release-1-1-54304-2017-10-19}

#### 新機能: {#new-features-1}

- ネイティブプロトコルでのTLSサポート(有効にするには、`config.xml`で`tcp_ssl_port`を設定)。

#### バグ修正: {#bug-fixes-1}


- レプリケートテーブルの`ALTER`が可能な限り早く実行を開始するようになりました。
- `preferred_block_size_bytes=0`の設定でデータを読み取る際のクラッシュを修正しました。
- `Page Down`キーを押した際の`clickhouse-client`のクラッシュを修正しました。
- `GLOBAL IN`と`UNION ALL`を含む特定の複雑なクエリの正しい解釈を実装しました。
- `FREEZE PARTITION`が常にアトミックに動作するようになりました。
- 空のPOSTリクエストがコード411のレスポンスを返すようになりました。
- `CAST(1 AS Nullable(UInt8))`のような式の解釈エラーを修正しました。
- `MergeTree`テーブルから`Array(Nullable(String))`カラムを読み取る際のエラーを修正しました。
- `SELECT dummy AS dummy, dummy AS b`のようなクエリを解析する際のクラッシュを修正しました。
- 無効な`users.xml`でもユーザーが正しく更新されるようになりました。
- 実行可能ディクショナリがゼロ以外のレスポンスコードを返した場合の正しい処理を実装しました。

### ClickHouse リリース 1.1.54292, 2017-09-20 {#clickhouse-release-1-1-54292-2017-09-20}

#### 新機能: {#new-features-2}

- 座標平面上の座標を扱うための`pointInPolygon`関数を追加しました。
- `SummingMergeTree`と同様に、配列の合計を計算するための`sumMap`集約関数を追加しました。
- `trunc`関数を追加しました。丸め関数(`round`、`floor`、`ceil`、`roundToExp2`)のパフォーマンスを改善し、動作ロジックを修正しました。小数と負の数に対する`roundToExp2`関数のロジックを変更しました。
- ClickHouseの実行ファイルがlibcバージョンへの依存度が低くなりました。同じClickHouse実行ファイルが幅広いLinuxシステムで動作します。コンパイル済みクエリを使用する場合(デフォルトでは使用されない`compile = 1`設定)には、依然として依存関係が存在します。
- クエリの動的コンパイルに必要な時間を短縮しました。

#### バグ修正: {#bug-fixes-2}

- `part ... intersects previous part`メッセージが時々発生し、レプリカの整合性が低下するエラーを修正しました。
- シャットダウン時にZooKeeperが利用できない場合にサーバーがロックアップする原因となったエラーを修正しました。
- レプリカの復元時の過剰なログ出力を削除しました。
- UNION ALLの実装におけるエラーを修正しました。
- ブロック内の最初のカラムがArray型である場合に発生するconcat関数のエラーを修正しました。
- system.mergesテーブルで進行状況が正しく表示されるようになりました。

### ClickHouse リリース 1.1.54289, 2017-09-13 {#clickhouse-release-1-1-54289-2017-09-13}

#### 新機能: {#new-features-3}

- サーバー管理用の`SYSTEM`クエリ: `SYSTEM RELOAD DICTIONARY`、`SYSTEM RELOAD DICTIONARIES`、`SYSTEM DROP DNS CACHE`、`SYSTEM SHUTDOWN`、`SYSTEM KILL`。
- 配列を扱うための関数を追加しました: `concat`、`arraySlice`、`arrayPushBack`、`arrayPushFront`、`arrayPopBack`、`arrayPopFront`。
- ZooKeeper設定に`root`と`identity`パラメータを追加しました。これにより、同じZooKeeperクラスタ上で個別のユーザーを分離できます。
- 集約関数`groupBitAnd`、`groupBitOr`、`groupBitXor`を追加しました(互換性のため、`BIT_AND`、`BIT_OR`、`BIT_XOR`という名前でも利用可能です)。
- ファイルシステム内のソケットを指定することで、外部ディクショナリをMySQLから読み込めるようになりました。
- SSL経由でMySQLから外部ディクショナリを読み込めるようになりました(`ssl_cert`、`ssl_key`、`ssl_ca`パラメータ)。
- ユーザーごとのクエリの全体的な帯域幅使用を制限する`max_network_bandwidth_for_user`設定を追加しました。
- 一時テーブルに対する`DROP TABLE`のサポートを追加しました。
- `CSV`および`JSONEachRow`形式からUnixタイムスタンプ形式の`DateTime`値を読み取るサポートを追加しました。
- 分散クエリにおいて遅延しているレプリカがデフォルトで除外されるようになりました(デフォルトの閾値は5分です)。
- ALTER中にFIFOロックが使用されます: ALTERクエリが継続的に実行されているクエリによって無期限にブロックされることはありません。
- 設定ファイルで`umask`を設定するオプションを追加しました。
- `DISTINCT`を含むクエリのパフォーマンスを改善しました。

#### バグ修正: {#bug-fixes-3}


- ZooKeeperにおける古いノードの削除プロセスを改善しました。以前は、挿入が非常に頻繁に発生する場合に古いノードが削除されないことがあり、サーバーのシャットダウンが遅くなるなどの問題が発生していました。
- ZooKeeperへの接続時にホストを選択する際のランダム化処理を修正しました。
- レプリカがlocalhostの場合に、分散クエリで遅延しているレプリカが除外されない問題を修正しました。
- `Nested`構造の要素に対して`ALTER MODIFY`を実行した後、`ReplicatedMergeTree`テーブルのデータパートが破損する可能性があったエラーを修正しました。
- SELECTクエリが「ハング」する可能性があったエラーを修正しました。
- 分散DDLクエリを改善しました。
- `CREATE TABLE ... AS <materialized view>`クエリを修正しました。
- `Buffer`テーブルに対する`ALTER ... CLEAR COLUMN IN PARTITION`クエリでのデッドロックを解決しました。
- `JSONEachRow`および`TSKV`フォーマットを使用する際の`Enum`の無効なデフォルト値(最小値ではなく0)を修正しました。
- `executable`ソースを持つディクショナリを使用する際にゾンビプロセスが発生する問題を解決しました。
- HEADクエリでのセグメンテーション違反を修正しました。

#### ClickHouseの開発とアセンブルのワークフロー改善: {#improved-workflow-for-developing-and-assembling-clickhouse}

- `pbuilder`を使用してClickHouseをビルドできるようになりました。
- Linux上でのビルドにおいて、`libstdc++`の代わりに`libc++`を使用できるようになりました。
- 静的コード解析ツール(`Coverage`、`clang-tidy`、`cppcheck`)の使用手順を追加しました。

#### アップグレード時の注意事項: {#please-note-when-upgrading}

- MergeTree設定の`max_bytes_to_merge_at_max_space_in_pool`(マージするデータパートの最大合計サイズ、バイト単位)のデフォルト値が高くなりました。100 GiBから150 GiBに増加しています。これにより、サーバーのアップグレード後に大規模なマージが実行され、ディスクサブシステムへの負荷が増加する可能性があります。サーバーで利用可能な空き容量が実行中のマージの合計量の2倍未満の場合、小さなデータパートのマージを含む他のすべてのマージが停止します。その結果、INSERTクエリは「Merges are processing significantly slower than inserts.」というメッセージで失敗します。`SELECT * FROM system.merges`クエリを使用して状況を監視してください。`system.metrics`テーブルまたはGraphiteで`DiskSpaceReservedForMerge`メトリックを確認することもできます。大規模なマージが完了すると問題は自動的に解決されるため、何もする必要はありません。これが受け入れられない場合は、`max_bytes_to_merge_at_max_space_in_pool`設定の以前の値を復元できます。これを行うには、config.xmlの`<merge_tree>`セクションに移動し、`<merge_tree>``<max_bytes_to_merge_at_max_space_in_pool>107374182400</max_bytes_to_merge_at_max_space_in_pool>`を設定してサーバーを再起動してください。

### ClickHouse リリース 1.1.54284, 2017-08-29 {#clickhouse-release-1-1-54284-2017-08-29}

- これは以前の1.1.54282リリースのバグ修正リリースです。ZooKeeperのpartsディレクトリにおけるリークを修正しました。

### ClickHouse リリース 1.1.54282, 2017-08-23 {#clickhouse-release-1-1-54282-2017-08-23}

このリリースには、以前のリリース1.1.54276のバグ修正が含まれています:

- Distributedテーブルへの挿入時の`DB::Exception: Assertion violation: !_path.empty()`を修正しました。
- 入力データが';'で始まる場合のRowBinaryフォーマットでの挿入時のパース処理を修正しました。
- 特定の集約関数(例: `groupArray()`)の実行時コンパイル中のエラーを修正しました。

### ClickHouse リリース 1.1.54276, 2017-08-16 {#clickhouse-release-1-1-54276-2017-08-16}

#### 新機能: {#new-features-4}


- SELECTクエリにオプションのWITHセクションを追加しました。クエリ例: `WITH 1+1 AS a SELECT a, a*a`
- Distributedテーブルで同期的にINSERTを実行できるようになりました。すべてのシャードにデータが保存された後にのみOKが返されます。この機能はinsert_distributed_sync=1設定で有効化されます。
- 16バイト識別子を扱うためのUUIDデータ型を追加しました。
- Tableauとの互換性のため、CHAR、FLOATおよびその他の型のエイリアスを追加しました。
- 時刻を数値に変換するための関数toYYYYMM、toYYYYMMDD、toYYYYMMDDhhmmssを追加しました。
- クラスタ化されたDDLクエリでサーバーを識別するために、IPアドレス(ホスト名と併用)を使用できるようになりました。
- `substring(str, pos, len)`関数で非定数引数と負のオフセットのサポートを追加しました。
- `groupArray(max_size)(column)`集約関数にmax_sizeパラメータを追加し、パフォーマンスを最適化しました。

#### 主な変更点: {#main-changes}

- セキュリティの改善: すべてのサーバーファイルが0640パーミッションで作成されるようになりました(`<umask>`設定パラメータで変更可能)。
- 無効な構文を持つクエリのエラーメッセージを改善しました。
- MergeTreeデータの大きなセクションをマージする際のメモリ消費量を大幅に削減し、パフォーマンスを向上させました。
- ReplacingMergeTreeエンジンのデータマージのパフォーマンスを大幅に向上させました。
- 複数のソースインサートを結合することで、Distributedテーブルからの非同期インサートのパフォーマンスを向上させました。この機能を有効にするには、distributed_directory_monitor_batch_inserts=1設定を使用してください。

#### 後方互換性のない変更: {#backward-incompatible-changes-1}

- 配列に対する`groupArray(array_column)`関数の集約状態のバイナリ形式を変更しました。

#### 変更の完全なリスト: {#complete-list-of-changes}

- JSON形式でnanおよびinf値を出力できるようにする`output_format_json_quote_denormals`設定を追加しました。
- Distributedテーブルから読み取る際のストリーム割り当てを最適化しました。
- 値が変更されない場合、読み取り専用モードで設定を構成できるようになりました。
- preferred_block_size_bytes設定で指定されたブロックサイズの制限を満たすために、MergeTreeエンジンの非整数グラニュールを取得する機能を追加しました。目的は、大きなカラムを持つテーブルからクエリを処理する際のRAM消費量を削減し、キャッシュの局所性を向上させることです。
- `toStartOfHour(x) op constexpr`のような条件に対して、`toStartOfHour(x)`のような式を含むインデックスを効率的に使用できるようになりました。
- MergeTreeエンジンの新しい設定を追加しました(config.xmlのmerge_treeセクション):
  - replicated_deduplication_window_secondsは、Replicatedテーブルでのインサートの重複排除に許可される秒数を設定します。
  - cleanup_delay_periodは、古いデータを削除するクリーンアップを開始する頻度を設定します。
  - replicated_can_become_leaderは、レプリカがリーダーになること(およびマージの割り当て)を防ぐことができます。
- ZooKeeperから古いデータを削除するクリーンアップを高速化しました。
- クラスタ化されたDDLクエリに対する複数の改善と修正を行いました。特に注目すべきは、クラスタ内のサーバーからの応答を待つ時間を制限する新しい設定distributed_ddl_task_timeoutです。すべてのホストでDDLリクエストが実行されていない場合、応答にはタイムアウトエラーが含まれ、リクエストは非同期モードで実行されます。
- サーバーログでのスタックトレースの表示を改善しました。
- 圧縮方法に「none」値を追加しました。
- config.xmlで複数のdictionaries_configセクションを使用できるようになりました。
- ファイルシステム内のソケットを通じてMySQLに接続できるようになりました。
- system.partsテーブルに、マークのサイズに関する情報をバイト単位で示す新しいカラムが追加されました。

#### バグ修正: {#bug-fixes-4}


- Mergeテーブルを使用した分散テーブルで、`_table`フィールドに条件を持つSELECTクエリが正しく動作するようになりました。
- データパーツのチェック時にReplicatedMergeTreeで発生する稀な競合状態を修正しました。
- サーバー起動時の「リーダー選出」でフリーズする可能性があった問題を修正しました。
- データソースのローカルレプリカを使用する際にmax_replica_delay_for_distributed_queries設定が無視されていた問題を修正しました。
- 存在しないカラムをクリアしようとした際の`ALTER TABLE CLEAR COLUMN IN PARTITION`の不正な動作を修正しました。
- 空の配列または文字列を使用した際のmultiIf関数の例外を修正しました。
- Native形式のデシリアライズ時の過剰なメモリ割り当てを修正しました。
- Trie辞書の不正な自動更新を修正しました。
- SAMPLEを使用した際のMergeテーブルからのGROUP BY句を含むクエリ実行時の例外を修正しました。
- distributed_aggregation_memory_efficient=1を使用した際のGROUP BYのクラッシュを修正しました。
- INおよびJOINの右側でdatabase.tableを指定できるようになりました。
- 並列集計で過剰なスレッドが使用されていた問題を修正しました。
- FixedString引数を使用した際の「if」関数の動作を修正しました。
- 重みが0のシャードに対する分散テーブルからのSELECTが正しく動作していなかった問題を修正しました。
- `CREATE VIEW IF EXISTS`の実行でクラッシュしなくなりました。
- input_format_skip_unknown_fields=1が設定され、負の数値が存在する場合の不正な動作を修正しました。
- 辞書に無効なデータが存在する場合の`dictGetHierarchy()`関数の無限ループを修正しました。
- INまたはJOIN句にサブクエリを含む分散クエリとMergeテーブルを実行した際の`Syntax error: unexpected (...)`エラーを修正しました。
- DictionaryテーブルからのSELECTクエリの不正な解釈を修正しました。
- 20億を超える要素を持つINおよびJOIN句で配列を使用した際の「Cannot mremap」エラーを修正しました。
- MySQLをソースとする辞書のフェイルオーバーを修正しました。

#### ClickHouseの開発とアセンブルのワークフロー改善: {#improved-workflow-for-developing-and-assembling-clickhouse-1}

- Arcadiaでビルドをアセンブルできるようになりました。
- gcc 7を使用してClickHouseをコンパイルできるようになりました。
- ccache+distccを使用した並列ビルドが高速化されました。

### ClickHouseリリース 1.1.54245, 2017-07-04 {#clickhouse-release-1-1-54245-2017-07-04}

#### 新機能: {#new-features-5}

- 分散DDL（例:`CREATE TABLE ON CLUSTER`）
- レプリケートされたクエリ`ALTER TABLE CLEAR COLUMN IN PARTITION`
- Dictionaryテーブル用エンジン（テーブル形式での辞書データへのアクセス）
- Dictionaryデータベースエンジン（このタイプのデータベースは、接続されたすべての外部辞書に対してDictionaryテーブルを自動的に利用可能にします）
- ソースにリクエストを送信することで辞書の更新を確認できるようになりました。
- 修飾されたカラム名
- 二重引用符を使用した識別子の引用
- HTTPインターフェースでのセッション
- レプリケートされたテーブルに対するOPTIMIZEクエリがリーダー以外でも実行できるようになりました。

#### 後方互換性のない変更: {#backward-incompatible-changes-2}

- SET GLOBALを削除しました。

#### マイナーな変更: {#minor-changes}

- アラートがトリガーされた後、ログに完全なスタックトレースが出力されるようになりました。
- 起動時の破損/余分なデータパーツ数の検証を緩和しました（誤検出が多すぎたため）。

#### バグ修正: {#bug-fixes-5}

- 分散テーブルへの挿入時の不良接続の「スタック」を修正しました。
- 分散テーブルを参照するMergeテーブルからのクエリでGLOBAL INが動作するようになりました。
- Google Compute Engine仮想マシンで不正なコア数が検出されていた問題を修正しました。
- キャッシュされた外部辞書の実行可能ソースの動作方法を変更しました。
- null文字を含む文字列の比較を修正しました。
- Float32主キーフィールドと定数の比較を修正しました。
- 以前は、フィールドサイズの不正な推定により過剰に大きな割り当てが発生する可能性がありました。
- ALTERを使用してテーブルに追加されたNullableカラムをクエリした際のクラッシュを修正しました。
- 行数がLIMITより少ない場合のNullableカラムによるソート時のクラッシュを修正しました。
- 定数値のみで構成されるORDER BYサブクエリを修正しました。
- 以前は、DROP TABLEの失敗後にレプリケートされたテーブルが無効な状態のままになる可能性がありました。
- 空の結果を持つスカラーサブクエリのエイリアスが失われなくなりました。
- コンパイルを使用したクエリが、.soファイルが破損してもエラーで失敗しなくなりました。
