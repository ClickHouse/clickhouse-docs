---
slug: /whats-new/changelog/2023
sidebar_position: 4
sidebar_label: "2023"
title: "2023年の変更履歴"
description: "2023年の変更履歴"
keywords:
  [
    "ClickHouse 2023",
    "changelog 2023",
    "リリースノート",
    "バージョン履歴",
    "パフォーマンス改善"
  ]
doc_type: "changelog"
---

### 目次 {#table-of-contents}

**[ClickHouse release v23.12, 2023-12-28](#2312)**<br/>
**[ClickHouse release v23.11, 2023-12-06](#2311)**<br/>
**[ClickHouse release v23.10, 2023-11-02](#2310)**<br/>
**[ClickHouse release v23.9, 2023-09-28](#239)**<br/>
**[ClickHouse release v23.8 LTS, 2023-08-31](#238)**<br/>
**[ClickHouse release v23.7, 2023-07-27](#237)**<br/>
**[ClickHouse release v23.6, 2023-06-30](#236)**<br/>
**[ClickHouse release v23.5, 2023-06-08](#235)**<br/>
**[ClickHouse release v23.4, 2023-04-26](#234)**<br/>
**[ClickHouse release v23.3 LTS, 2023-03-30](#233)**<br/>
**[ClickHouse release v23.2, 2023-02-23](#232)**<br/>
**[ClickHouse release v23.1, 2023-01-25](#231)**<br/>
**[2022年の変更履歴](/whats-new/changelog/2022/)**<br/>

### <a id="2312"></a> ClickHouse release 23.12, 2023-12-28 {#2312}

#### 後方互換性のない変更 {#backward-incompatible-change}

- TTL式における非決定的関数のチェックを修正しました。以前は、一部のケースで非決定的関数を含むTTL式を作成できましたが、これは後に未定義の動作を引き起こす可能性がありました。これにより[#37250](https://github.com/ClickHouse/ClickHouse/issues/37250)が修正されます。デフォルトでは、テーブルのいずれのカラムにも依存しないTTL式を禁止します。`SET allow_suspicious_ttl_expressions = 1`または`SET compatibility = '23.11'`により再度許可できます。[#37286](https://github.com/ClickHouse/ClickHouse/issues/37286)をクローズします。[#51858](https://github.com/ClickHouse/ClickHouse/pull/51858) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- MergeTree設定の`clean_deleted_rows`は非推奨となり、効果がなくなりました。`OPTIMIZE`の`CLEANUP`キーワードはデフォルトでは許可されません(`allow_experimental_replacing_merge_with_cleanup`設定で有効化できます)。[#58267](https://github.com/ClickHouse/ClickHouse/pull/58267) ([Alexander Tokmakov](https://github.com/tavplubix))。これにより[#57930](https://github.com/ClickHouse/ClickHouse/issues/57930)が修正されます。[#54988](https://github.com/ClickHouse/ClickHouse/issues/54988)をクローズします。[#54570](https://github.com/ClickHouse/ClickHouse/issues/54570)をクローズします。[#50346](https://github.com/ClickHouse/ClickHouse/issues/50346)をクローズします。[#47579](https://github.com/ClickHouse/ClickHouse/issues/47579)をクローズします。この機能は適切ではないため削除する必要があります。他に選択肢がないため、可能な限り早急に削除する必要があります。[#57932](https://github.com/ClickHouse/ClickHouse/pull/57932) ([Alexey Milovidov](https://github.com/alexey-milovidov))。


#### 新機能 {#new-feature}

- [#33919](https://github.com/ClickHouse/ClickHouse/issues/33919)でリクエストされていたリフレッシュ可能なマテリアライズドビューを実装しました。[#56946](https://github.com/ClickHouse/ClickHouse/pull/56946) ([Michael Kolupaev](https://github.com/al13n321), [Michael Guzov](https://github.com/koloshmet))。
- `PASTE JOIN`を導入しました。これにより、`ON`句なしで行番号のみでテーブルを結合できます。例: `SELECT * FROM (SELECT number AS a FROM numbers(2)) AS t1 PASTE JOIN (SELECT number AS a FROM numbers(2) ORDER BY a DESC) AS t2`。[#57995](https://github.com/ClickHouse/ClickHouse/pull/57995) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- `ORDER BY`句で`ALL`の指定がサポートされるようになりました。これにより、ClickHouseは`SELECT`句内のすべての列でソートします。例: `SELECT col1, col2 FROM tab WHERE [...] ORDER BY ALL`。[#57875](https://github.com/ClickHouse/ClickHouse/pull/57875) ([zhongyuankai](https://github.com/zhongyuankai))。
- 新しいミューテーションコマンド`ALTER TABLE <table> APPLY DELETED MASK`を追加しました。これにより、軽量削除によって書き込まれたマスクの適用を強制し、削除済みとマークされた行をディスクから削除できます。[#57433](https://github.com/ClickHouse/ClickHouse/pull/57433) ([Anton Popov](https://github.com/CurtizJ))。
- ハンドラー`/binary`により、ClickHouseバイナリ内のシンボルをビジュアルビューアーで表示できます。[#58211](https://github.com/ClickHouse/ClickHouse/pull/58211) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- Sqids (https://sqids.org/)を生成する新しいSQL関数`sqid`を追加しました。例: `SELECT sqid(125, 126)`。[#57512](https://github.com/ClickHouse/ClickHouse/pull/57512) ([Robert Schulze](https://github.com/rschu1ze))。
- FFTを使用して時系列の周期を検出する新しい関数`seriesPeriodDetectFFT`を追加しました。[#57574](https://github.com/ClickHouse/ClickHouse/pull/57574) ([Bhavna Jindal](https://github.com/bhavnajindal))。
- Keeperがトラフィックを受け入れる準備ができているかを確認するためのHTTPエンドポイントを追加しました。[#55876](https://github.com/ClickHouse/ClickHouse/pull/55876) ([Konstantin Bogdanov](https://github.com/thevar1able))。
- スキーマ推論に'union'モードを追加しました。このモードでは、結果のテーブルスキーマはすべてのファイルスキーマの和集合になります(各ファイルからスキーマが推論されます)。スキーマ推論のモードは、`schema_inference_mode`設定で制御され、`default`と`union`の2つの値が指定可能です。[#55428](https://github.com/ClickHouse/ClickHouse/issues/55428)をクローズします。[#55892](https://github.com/ClickHouse/ClickHouse/pull/55892) ([Kruglov Pavel](https://github.com/Avogar))。
- CSV形式の文字列から数値を推論できる新しい設定`input_format_csv_try_infer_numbers_from_strings`を追加しました。[#56455](https://github.com/ClickHouse/ClickHouse/issues/56455)をクローズします。[#56859](https://github.com/ClickHouse/ClickHouse/pull/56859) ([Kruglov Pavel](https://github.com/Avogar))。
- データベースまたはテーブルの数が設定可能な閾値を超えた場合、ユーザーに警告を表示します。[#57375](https://github.com/ClickHouse/ClickHouse/pull/57375) ([凌涛](https://github.com/lingtaolf))。
- `HASHED_ARRAY`(および`COMPLEX_KEY_HASHED_ARRAY`)レイアウトのディクショナリが、`HASHED`と同様に`SHARDS`をサポートするようになりました。[#57544](https://github.com/ClickHouse/ClickHouse/pull/57544) ([vdimir](https://github.com/vdimir))。
- プライマリキーの合計バイト数とメモリ内に割り当てられたプライマリキーの合計バイト数の非同期メトリクスを追加しました。[#57551](https://github.com/ClickHouse/ClickHouse/pull/57551) ([Bharat Nallan](https://github.com/bharatnc))。
- `SHA512_256`関数を追加しました。[#57645](https://github.com/ClickHouse/ClickHouse/pull/57645) ([Bharat Nallan](https://github.com/bharatnc))。
- `formatReadableSize`のエイリアスとして`FORMAT_BYTES`を追加しました。[#57592](https://github.com/ClickHouse/ClickHouse/pull/57592) ([Bharat Nallan](https://github.com/bharatnc))。
- `s3`テーブル関数にオプションのセッショントークンを渡せるようになりました。[#57850](https://github.com/ClickHouse/ClickHouse/pull/57850) ([Shani Elharrar](https://github.com/shanielh))。
- 新しい設定`http_make_head_request`を導入しました。これをオフにすると、URLテーブルエンジンはファイルサイズを決定するためのHEADリクエストを実行しません。これは、非効率的、誤設定、または機能が不十分なHTTPサーバーをサポートするために必要です。[#54602](https://github.com/ClickHouse/ClickHouse/pull/54602) ([Fionera](https://github.com/fionera))。
- インデックス(非プライマリキー)定義でALIASカラムを参照できるようになりました(issue [#55650](https://github.com/ClickHouse/ClickHouse/issues/55650))。例: `CREATE TABLE tab(col UInt32, col_alias ALIAS col + 1, INDEX idx (col_alias) TYPE minmax) ENGINE = MergeTree ORDER BY col;`。[#57546](https://github.com/ClickHouse/ClickHouse/pull/57546) ([Robert Schulze](https://github.com/rschu1ze))。
- S3ディスクが読み取り専用であることを指定するために使用できる新しい設定`readonly`を追加しました。これは、基盤となるS3バケットへの読み取り専用アクセスを持ちながら、`s3_plain`タイプのディスク上にテーブルを作成する場合に便利です。[#57977](https://github.com/ClickHouse/ClickHouse/pull/57977) ([Pengyuan Bian](https://github.com/bianpengyuan))。
- MergeTreeテーブルのプライマリキー分析が、仮想カラム`_part_offset`(オプションで`_part`と共に)を含む述語に適用されるようになりました。この機能は、特殊なセカンダリインデックスとして機能します。[#58224](https://github.com/ClickHouse/ClickHouse/pull/58224) ([Amos Bird](https://github.com/amosbird))。





#### パフォーマンス改善 {#performance-improvement}

- FINAL処理中にMergeTreeテーブルから非交差パーツ範囲を抽出します。これにより、これらの非交差パーツ範囲に対する追加のFINALロジックを回避できます。同じプライマリキーを持つ重複値の量が少ない場合、パフォーマンスはFINALなしの場合とほぼ同じになります。`do_not_merge_across_partitions_select_final`設定が有効な場合、MergeTree FINALの読み取りパフォーマンスが向上します。[#58120](https://github.com/ClickHouse/ClickHouse/pull/58120) ([Maksim Kita](https://github.com/kitaisreal))。
- s3ディスク間のコピーを、バッファを経由したコピーではなくs3サーバーサイドコピーを使用して行うようにしました。`BACKUP/RESTORE`操作と`clickhouse-disks copy`コマンドが改善されます。[#56744](https://github.com/ClickHouse/ClickHouse/pull/56744) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。
- Hash JOINが`max_joined_block_size_rows`設定を尊重し、`ALL JOIN`に対して大きなブロックを生成しないようにしました。[#56996](https://github.com/ClickHouse/ClickHouse/pull/56996) ([vdimir](https://github.com/vdimir))。
- 集約用のメモリをより早く解放します。これにより、不要な外部集約を回避できる可能性があります。[#57691](https://github.com/ClickHouse/ClickHouse/pull/57691) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- 文字列シリアライゼーションのパフォーマンスを改善しました。[#57717](https://github.com/ClickHouse/ClickHouse/pull/57717) ([Maksim Kita](https://github.com/kitaisreal))。
- `Merge`エンジンテーブルに対する自明なカウント最適化をサポートしました。[#57867](https://github.com/ClickHouse/ClickHouse/pull/57867) ([skyoct](https://github.com/skyoct))。
- 一部のケースで集約を最適化しました。[#57872](https://github.com/ClickHouse/ClickHouse/pull/57872) ([Anton Popov](https://github.com/CurtizJ))。
- `hasAny`関数が全文スキップインデックスを活用できるようになりました。[#57878](https://github.com/ClickHouse/ClickHouse/pull/57878) ([Jpnock](https://github.com/Jpnock))。
- 関数`if(cond, then, else)`(およびそのエイリアス`cond ? then : else`)が、分岐なし評価を使用するように最適化されました。[#57885](https://github.com/ClickHouse/ClickHouse/pull/57885) ([zhanglistar](https://github.com/zhanglistar))。
- パーティションキー式がプライマリキー式の列のみを含む場合、MergeTreeが`do_not_merge_across_partitions_select_final`設定を自動的に導出するようにしました。[#58218](https://github.com/ClickHouse/ClickHouse/pull/58218) ([Maksim Kita](https://github.com/kitaisreal))。
- ネイティブ型に対する`MIN`と`MAX`を高速化しました。[#58231](https://github.com/ClickHouse/ClickHouse/pull/58231) ([Raúl Marín](https://github.com/Algunenano))。
- ファイルシステムキャッシュに対する`SLRU`キャッシュポリシーを実装しました。[#57076](https://github.com/ClickHouse/ClickHouse/pull/57076) ([Kseniia Sumarokova](https://github.com/kssenii))。
- バックグラウンドフェッチのエンドポイントあたりの接続数の制限が`15`から`background_fetches_pool_size`設定の値に引き上げられました。- MergeTreeレベルの設定`replicated_max_parallel_fetches_for_host`は廃止されました - MergeTreeレベルの設定`replicated_fetches_http_connection_timeout`、`replicated_fetches_http_send_timeout`、`replicated_fetches_http_receive_timeout`はサーバーレベルに移動されました。- 設定`keep_alive_timeout`がサーバーレベル設定のリストに追加されました。[#57523](https://github.com/ClickHouse/ClickHouse/pull/57523) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- `system.filesystem_cache`のクエリをメモリ集約的でないようにしました。[#57687](https://github.com/ClickHouse/ClickHouse/pull/57687) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 文字列デシリアライゼーション時のメモリ使用量を削減しました。[#57787](https://github.com/ClickHouse/ClickHouse/pull/57787) ([Maksim Kita](https://github.com/kitaisreal))。
- Enumのコンストラクタをより効率的にしました - Enumが大量の値を持つ場合に有効です。[#57887](https://github.com/ClickHouse/ClickHouse/pull/57887) ([Duc Canh Le](https://github.com/canhld94))。
- ファイルシステムキャッシュからの読み取りの改善: 常に`pread`メソッドを使用するようにしました。[#57970](https://github.com/ClickHouse/ClickHouse/pull/57970) ([Nikita Taranov](https://github.com/nickitat))。
- 論理式オプティマイザにおけるAND notEqualsチェーンの最適化を追加しました。この最適化は実験的なAnalyzerが有効な場合にのみ利用可能です。[#58214](https://github.com/ClickHouse/ClickHouse/pull/58214) ([Kevin Mingtarja](https://github.com/kevinmingtarja))。





#### 改善 {#improvement}

- Support for soft memory limit in Keeper. It will refuse requests if the memory usage is close to the maximum. [#57271](https://github.com/ClickHouse/ClickHouse/pull/57271) ([Han Fei](https://github.com/hanfei1991)). [#57699](https://github.com/ClickHouse/ClickHouse/pull/57699) ([Han Fei](https://github.com/hanfei1991)).
- Make inserts into distributed tables handle updated cluster configuration properly. When the list of cluster nodes is dynamically updated, the Directory Monitor of the distribution table will update it. [#42826](https://github.com/ClickHouse/ClickHouse/pull/42826) ([zhongyuankai](https://github.com/zhongyuankai)).
- Do not allow creating a replicated table with inconsistent merge parameters. [#56833](https://github.com/ClickHouse/ClickHouse/pull/56833) ([Duc Canh Le](https://github.com/canhld94)).
- Show uncompressed size in `system.tables`. [#56618](https://github.com/ClickHouse/ClickHouse/issues/56618). [#57186](https://github.com/ClickHouse/ClickHouse/pull/57186) ([Chen Lixiang](https://github.com/chenlx0)).
- Add `skip_unavailable_shards` as a setting for `Distributed` tables that is similar to the corresponding query-level setting. Closes [#43666](https://github.com/ClickHouse/ClickHouse/issues/43666). [#57218](https://github.com/ClickHouse/ClickHouse/pull/57218) ([Gagan Goel](https://github.com/tntnatbry)).
- The function `substring` (aliases: `substr`, `mid`) can now be used with `Enum` types. Previously, the first function argument had to be a value of type `String` or `FixedString`. This improves compatibility with 3rd party tools such as Tableau via MySQL interface. [#57277](https://github.com/ClickHouse/ClickHouse/pull/57277) ([Serge Klochkov](https://github.com/slvrtrn)).
- Function `format` now supports arbitrary argument types (instead of only `String` and `FixedString` arguments). This is important to calculate `SELECT format('The {0} to all questions is {1}', 'answer', 42)`. [#57549](https://github.com/ClickHouse/ClickHouse/pull/57549) ([Robert Schulze](https://github.com/rschu1ze)).
- Allows to use the `date_trunc` function with a case-insensitive first argument. Both cases are now supported: `SELECT date_trunc('day', now())` and `SELECT date_trunc('DAY', now())`. [#57624](https://github.com/ClickHouse/ClickHouse/pull/57624) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
- Better hints when a table doesn't exist. [#57342](https://github.com/ClickHouse/ClickHouse/pull/57342) ([Bharat Nallan](https://github.com/bharatnc)).
- Allow to overwrite `max_partition_size_to_drop` and `max_table_size_to_drop` server settings in query time. [#57452](https://github.com/ClickHouse/ClickHouse/pull/57452) ([Jordi Villar](https://github.com/jrdi)).
- Slightly better inference of unnamed tupes in JSON formats. [#57751](https://github.com/ClickHouse/ClickHouse/pull/57751) ([Kruglov Pavel](https://github.com/Avogar)).
- Add support for read-only flag when connecting to Keeper (fixes [#53749](https://github.com/ClickHouse/ClickHouse/issues/53749)). [#57479](https://github.com/ClickHouse/ClickHouse/pull/57479) ([Mikhail Koviazin](https://github.com/mkmkme)).
- Fix possible distributed sends stuck due to "No such file or directory" (during recovering a batch from disk). Fix possible issues with `error_count` from `system.distribution_queue` (in case of `distributed_directory_monitor_max_sleep_time_ms` >5min). Introduce profile event to track async INSERT failures - `DistributedAsyncInsertionFailures`. [#57480](https://github.com/ClickHouse/ClickHouse/pull/57480) ([Azat Khuzhin](https://github.com/azat)).
- Support PostgreSQL generated columns and default column values in `MaterializedPostgreSQL` (experimental feature). Closes [#40449](https://github.com/ClickHouse/ClickHouse/issues/40449). [#57568](https://github.com/ClickHouse/ClickHouse/pull/57568) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Allow to apply some filesystem cache config settings changes without server restart. [#57578](https://github.com/ClickHouse/ClickHouse/pull/57578) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Properly handling PostgreSQL table structure with empty array. [#57618](https://github.com/ClickHouse/ClickHouse/pull/57618) ([Mike Kot](https://github.com/myrrc)).
- Expose the total number of errors occurred since last server restart as a `ClickHouseErrorMetric_ALL` metric. [#57627](https://github.com/ClickHouse/ClickHouse/pull/57627) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
- Allow nodes in the configuration file with `from_env`/`from_zk` reference and non empty element with replace=1. [#57628](https://github.com/ClickHouse/ClickHouse/pull/57628) ([Azat Khuzhin](https://github.com/azat)).
- A table function `fuzzJSON` which allows generating a lot of malformed JSON for fuzzing. [#57646](https://github.com/ClickHouse/ClickHouse/pull/57646) ([Julia Kartseva](https://github.com/jkartseva)).
- Allow IPv6 to UInt128 conversion and binary arithmetic. [#57707](https://github.com/ClickHouse/ClickHouse/pull/57707) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- Add a setting for `async inserts deduplication cache` - how long we wait for cache update. Deprecate setting `async_block_ids_cache_min_update_interval_ms`. Now cache is updated only in case of conflicts. [#57743](https://github.com/ClickHouse/ClickHouse/pull/57743) ([alesapin](https://github.com/alesapin)).
- `sleep()` function now can be cancelled with `KILL QUERY`. [#57746](https://github.com/ClickHouse/ClickHouse/pull/57746) ([Vitaly Baranov](https://github.com/vitlibar)).
- Forbid `CREATE TABLE ... AS SELECT` queries for `Replicated` table engines in the experimental `Replicated` database because they are not supported. Reference [#35408](https://github.com/ClickHouse/ClickHouse/issues/35408). [#57796](https://github.com/ClickHouse/ClickHouse/pull/57796) ([Nikolay Degterinsky](https://github.com/evillique)).
- Fix and improve transforming queries for external databases, to recursively obtain all compatible predicates. [#57888](https://github.com/ClickHouse/ClickHouse/pull/57888) ([flynn](https://github.com/ucasfl)).
- Support dynamic reloading of the filesystem cache size. Closes [#57866](https://github.com/ClickHouse/ClickHouse/issues/57866). [#57897](https://github.com/ClickHouse/ClickHouse/pull/57897) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Correctly support `system.stack_trace` for threads with blocked SIGRTMIN (these threads can exist in low-quality external libraries such as Apache rdkafka). [#57907](https://github.com/ClickHouse/ClickHouse/pull/57907) ([Azat Khuzhin](https://github.com/azat)). Aand also send signal to the threads only if it is not blocked to avoid waiting `storage_system_stack_trace_pipe_read_timeout_ms` when it does not make any sense. [#58136](https://github.com/ClickHouse/ClickHouse/pull/58136) ([Azat Khuzhin](https://github.com/azat)).
- Tolerate keeper failures in the quorum inserts' check. [#57986](https://github.com/ClickHouse/ClickHouse/pull/57986) ([Raúl Marín](https://github.com/Algunenano)).
- Add max/peak RSS (`MemoryResidentMax`) into system.asynchronous_metrics. [#58095](https://github.com/ClickHouse/ClickHouse/pull/58095) ([Azat Khuzhin](https://github.com/azat)).
- This PR allows users to use s3-style links (`https://` and `s3://`) without mentioning region if it's not default. Also find the correct region if the user mentioned the wrong one. [#58148](https://github.com/ClickHouse/ClickHouse/pull/58148) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
- `clickhouse-format --obfuscate` will know about Settings, MergeTreeSettings, and time zones and keep their names unchanged. [#58179](https://github.com/ClickHouse/ClickHouse/pull/58179) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Added explicit `finalize()` function in `ZipArchiveWriter`. Simplify too complicated code in `ZipArchiveWriter`. This fixes [#58074](https://github.com/ClickHouse/ClickHouse/issues/58074). [#58202](https://github.com/ClickHouse/ClickHouse/pull/58202) ([Vitaly Baranov](https://github.com/vitlibar)).
- Make caches with the same path use the same cache objects. This behaviour existed before, but was broken in 23.4. If such caches with the same path have different set of cache settings, an exception will be thrown, that this is not allowed. [#58264](https://github.com/ClickHouse/ClickHouse/pull/58264) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Parallel replicas (experimental feature): friendly settings [#57542](https://github.com/ClickHouse/ClickHouse/pull/57542) ([Igor Nikonov](https://github.com/devcrafter)).
- Parallel replicas (experimental feature): announcement response handling improvement [#57749](https://github.com/ClickHouse/ClickHouse/pull/57749) ([Igor Nikonov](https://github.com/devcrafter)).
- Parallel replicas (experimental feature): give more respect to `min_number_of_marks` in `ParallelReplicasReadingCoordinator` [#57763](https://github.com/ClickHouse/ClickHouse/pull/57763) ([Nikita Taranov](https://github.com/nickitat)).
- Parallel replicas (experimental feature): disable parallel replicas with IN (subquery) [#58133](https://github.com/ClickHouse/ClickHouse/pull/58133) ([Igor Nikonov](https://github.com/devcrafter)).
- Parallel replicas (experimental feature): add profile event 'ParallelReplicasUsedCount' [#58173](https://github.com/ClickHouse/ClickHouse/pull/58173) ([Igor Nikonov](https://github.com/devcrafter)).
- Non POST requests such as HEAD will be readonly similar to GET. [#58060](https://github.com/ClickHouse/ClickHouse/pull/58060) ([San](https://github.com/santrancisco)).
- Add `bytes_uncompressed` column to `system.part_log` [#58167](https://github.com/ClickHouse/ClickHouse/pull/58167) ([Jordi Villar](https://github.com/jrdi)).
- Add base backup name to `system.backups` and `system.backup_log` tables [#58178](https://github.com/ClickHouse/ClickHouse/pull/58178) ([Pradeep Chhetri](https://github.com/chhetripradeep)).
- Add support for specifying query parameters in the command line in clickhouse-local [#58210](https://github.com/ClickHouse/ClickHouse/pull/58210) ([Pradeep Chhetri](https://github.com/chhetripradeep)).

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement}

- より多くの設定をランダム化 [#39663](https://github.com/ClickHouse/ClickHouse/pull/39663) ([Anton Popov](https://github.com/CurtizJ))。
- CIで無効化された最適化をランダム化 [#57315](https://github.com/ClickHouse/ClickHouse/pull/57315) ([Raúl Marín](https://github.com/Algunenano))。
- macOS上でAzure関連のテーブルエンジン/関数の使用を許可。[#51866](https://github.com/ClickHouse/ClickHouse/pull/51866) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ClickHouse Fast TestがGLibcの代わりにMuslを使用するように変更。[#57711](https://github.com/ClickHouse/ClickHouse/pull/57711) ([Alexey Milovidov](https://github.com/alexey-milovidov))。完全静的なMuslビルドはCIからダウンロード可能。
- すべてのコミットでClickBenchを実行。これにより[#57708](https://github.com/ClickHouse/ClickHouse/issues/57708)がクローズ。[#57712](https://github.com/ClickHouse/ClickHouse/pull/57712) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 外部ライブラリから有害なC/POSIX `select`関数の使用を削除。[#57467](https://github.com/ClickHouse/ClickHouse/pull/57467) ([Igor Nikonov](https://github.com/devcrafter))。
- ClickHouse Cloudでのみ利用可能な設定を、利便性のためオープンソース版ClickHouseビルドにも追加。[#57638](https://github.com/ClickHouse/ClickHouse/pull/57638) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。


#### バグ修正（公式安定版リリースにおけるユーザーに影響する不具合） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release}

- TTL GROUP BYにおけるソート順序が破損する可能性を修正 [#49103](https://github.com/ClickHouse/ClickHouse/pull/49103) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- 修正: `lttb`バケット戦略を分割し、最初と最後のバケットには単一のポイントのみを含むように変更 [#57003](https://github.com/ClickHouse/ClickHouse/pull/57003) ([FFish](https://github.com/wxybear))。
- エラー後の同期中に`Template`フォーマットで発生する可能性のあるデッドロックを修正 [#57004](https://github.com/ClickHouse/ClickHouse/pull/57004) ([Kruglov Pavel](https://github.com/Avogar))。
- 多数のエラーをスキップしながらファイルを解析する際の早期停止を修正 [#57006](https://github.com/ClickHouse/ClickHouse/pull/57006) ([Kruglov Pavel](https://github.com/Avogar))。
- `dictionary`テーブル関数を介した辞書のACLバイパスを防止 [#57362](https://github.com/ClickHouse/ClickHouse/pull/57362) ([Salvatore Mesoraca](https://github.com/aiven-sal))。
- Fuzzerによって発見された「non-ready set」エラーの別のケースを修正。[#57423](https://github.com/ClickHouse/ClickHouse/pull/57423) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- PostgreSQLの`array_ndims`使用に関するいくつかの問題を修正。[#57436](https://github.com/ClickHouse/ClickHouse/pull/57436) ([Ryan Jacobs](https://github.com/ryanmjacobs))。
- 書き込みロックタイムアウト後のRWLockの不整合を修正 [#57454](https://github.com/ClickHouse/ClickHouse/pull/57454) ([Vitaly Baranov](https://github.com/vitlibar))。書き込みロックタイムアウト後のRWLockの不整合を修正（再度） [#57733](https://github.com/ClickHouse/ClickHouse/pull/57733) ([Vitaly Baranov](https://github.com/vitlibar))。
- 修正: ビューチェーンへのプッシュを構築する際にエフェメラルカラムを除外しないように変更 [#57461](https://github.com/ClickHouse/ClickHouse/pull/57461) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
- MaterializedPostgreSQL（実験的機能の問題）: 問題 [#41922](https://github.com/ClickHouse/ClickHouse/issues/41922) を修正し、[#41923](https://github.com/ClickHouse/ClickHouse/issues/41923) のテストを追加 [#57515](https://github.com/ClickHouse/ClickHouse/pull/57515) ([Kseniia Sumarokova](https://github.com/kssenii))。
- レプリケートされたアクセスエンティティの管理のためのgrant/revokeクエリにおけるON CLUSTER句を無視。[#57538](https://github.com/ClickHouse/ClickHouse/pull/57538) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。
- clickhouse-localでのクラッシュを修正 [#57553](https://github.com/ClickHouse/ClickHouse/pull/57553) ([Nikolay Degterinsky](https://github.com/evillique))。
- Hash JOINの修正。[#57564](https://github.com/ClickHouse/ClickHouse/pull/57564) ([vdimir](https://github.com/vdimir))。
- PostgreSQLソースで発生する可能性のあるエラーを修正 [#57567](https://github.com/ClickHouse/ClickHouse/pull/57567) ([Kseniia Sumarokova](https://github.com/kssenii))。
- ネストされたLowCardinalityに対するHash JOINでの型補正を修正。[#57614](https://github.com/ClickHouse/ClickHouse/pull/57614) ([vdimir](https://github.com/vdimir))。
- `system.stack_trace`からの並列読み取りを正しく禁止することでハングを回避。[#57641](https://github.com/ClickHouse/ClickHouse/pull/57641) ([Azat Khuzhin](https://github.com/azat))。
- `any(...) RESPECT NULL`を使用したスパースカラムの集約におけるエラーを修正 [#57710](https://github.com/ClickHouse/ClickHouse/pull/57710) ([Azat Khuzhin](https://github.com/azat))。
- 単項演算子の解析を修正 [#57713](https://github.com/ClickHouse/ClickHouse/pull/57713) ([Nikolay Degterinsky](https://github.com/evillique))。
- 実験的なテーブルエンジン`MaterializedPostgreSQL`の依存関係読み込みを修正。[#57754](https://github.com/ClickHouse/ClickHouse/pull/57754) ([Kseniia Sumarokova](https://github.com/kssenii))。
- BACKUP/RESTORE ON CLUSTERにおける切断されたノードの再試行を修正 [#57764](https://github.com/ClickHouse/ClickHouse/pull/57764) ([Vitaly Baranov](https://github.com/vitlibar))。
- 部分的にマテリアライズされたプロジェクションの場合の外部集約の結果を修正 [#57790](https://github.com/ClickHouse/ClickHouse/pull/57790) ([Anton Popov](https://github.com/CurtizJ))。
- `*Map`コンビネータを使用した集約関数でのマージを修正 [#57795](https://github.com/ClickHouse/ClickHouse/pull/57795) ([Anton Popov](https://github.com/CurtizJ))。
- バグがあるため`system.kafka_consumers`を無効化。[#57822](https://github.com/ClickHouse/ClickHouse/pull/57822) ([Azat Khuzhin](https://github.com/azat))。
- Merge JOINにおけるLowCardinalityキーのサポートを修正。[#57827](https://github.com/ClickHouse/ClickHouse/pull/57827) ([vdimir](https://github.com/vdimir))。
- サンプルブロックに関連する`InterpreterCreateQuery`の修正。[#57855](https://github.com/ClickHouse/ClickHouse/pull/57855) ([Maksim Kita](https://github.com/kitaisreal))。
- PostgreSQLからの名前付きコレクションに対して`addresses_expr`が無視されていた問題を修正。[#57874](https://github.com/ClickHouse/ClickHouse/pull/57874) ([joelynch](https://github.com/joelynch))。
- BLAKE3（Rust）における無効なメモリアクセスを修正 [#57876](https://github.com/ClickHouse/ClickHouse/pull/57876) ([Raúl Marín](https://github.com/Algunenano))。その後、より良い[メモリ安全性](https://www.memorysafety.org/)のためにRustからC++に書き直された。[#57994](https://github.com/ClickHouse/ClickHouse/pull/57994) ([Raúl Marín](https://github.com/Algunenano))。
- `CREATE INDEX`における関数名を正規化 [#57906](https://github.com/ClickHouse/ClickHouse/pull/57906) ([Alexander Tokmakov](https://github.com/tavplubix))。
- 最初のリクエストが発生する前の利用不可能なレプリカの処理を修正 [#57933](https://github.com/ClickHouse/ClickHouse/pull/57933) ([Nikita Taranov](https://github.com/nickitat))。
- リテラルエイリアスの誤分類を修正 [#57988](https://github.com/ClickHouse/ClickHouse/pull/57988) ([Chen768959](https://github.com/Chen768959))。
- Keeperにおける無効な前処理を修正 [#58069](https://github.com/ClickHouse/ClickHouse/pull/58069) ([Antonio Andelic](https://github.com/antonio2368))。
- `UTF32Encoding`に関連する`Poco`ライブラリでの整数オーバーフローを修正 [#58073](https://github.com/ClickHouse/ClickHouse/pull/58073) ([Andrey Fedotov](https://github.com/anfedotoff))。
- 大きな整数値を持つスカラーサブクエリが存在する場合の並列レプリカ（実験的機能）を修正 [#58118](https://github.com/ClickHouse/ClickHouse/pull/58118) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 範囲外の`DateTime`に対する`accurateCastOrNull`を修正 [#58139](https://github.com/ClickHouse/ClickHouse/pull/58139) ([Andrey Zvonov](https://github.com/zvonand))。
- MergeTreeのワイドパートからサブカラムを読み取る際に発生する可能性のある`PARAMETER_OUT_OF_BOUND`エラーを修正 [#58175](https://github.com/ClickHouse/ClickHouse/pull/58175) ([Kruglov Pavel](https://github.com/Avogar))。
- 膨大な数のサブクエリを持つCREATE VIEWの速度低下を修正 [#58220](https://github.com/ClickHouse/ClickHouse/pull/58220) ([Tao Wang](https://github.com/wangtZJU))。
- JSONCompactEachRowの並列解析を修正 [#58181](https://github.com/ClickHouse/ClickHouse/pull/58181) ([Alexey Milovidov](https://github.com/alexey-milovidov))。[#58250](https://github.com/ClickHouse/ClickHouse/pull/58250) ([Kruglov Pavel](https://github.com/Avogar))。

### <a id="2311"></a> ClickHouse release 23.11, 2023-12-06 {#2311}

#### 後方互換性のない変更 {#backward-incompatible-change-1}

- デフォルトのClickHouseサーバー設定ファイルでは、`default`ユーザーに対して`access_management`(SQLクエリによるユーザー操作)と`named_collection_control`(SQLクエリによる名前付きコレクションの操作)がデフォルトで有効になりました。これにより[#56482](https://github.com/ClickHouse/ClickHouse/issues/56482)が解決されます。[#56619](https://github.com/ClickHouse/ClickHouse/pull/56619) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ウィンドウ関数の`RESPECT NULLS`/`IGNORE NULLS`に関する複数の改善が行われました。これらの修飾子を持つ集約関数として使用し、その状態を保存している場合、互換性がなくなる可能性があります。[#57189](https://github.com/ClickHouse/ClickHouse/pull/57189) ([Raúl Marín](https://github.com/Algunenano))。
- 最適化`optimize_move_functions_out_of_any`を削除しました。[#57190](https://github.com/ClickHouse/ClickHouse/pull/57190) ([Raúl Marín](https://github.com/Algunenano))。
- 関数`parseDateTime`のフォーマッタ`%l`/`%k`/`%c`は、先頭のゼロなしで時間/月を解析できるようになりました。例えば、`select parseDateTime('2023-11-26 8:14', '%F %k:%i')`が動作するようになりました。2桁を必要とする以前の動作に戻すには、`parsedatetime_parse_without_leading_zeros = 0`を設定してください。関数`formatDateTime`も先頭のゼロなしで時間/月を出力できるようになりました。これは設定`formatdatetime_format_without_leading_zeros`で制御されますが、既存のユースケースを壊さないようにデフォルトではオフになっています。[#55872](https://github.com/ClickHouse/ClickHouse/pull/55872) ([Azat Khuzhin](https://github.com/azat))。
- 集約関数`avgWeighted`を`Decimal`型の引数で使用できなくなりました。回避策: 引数を`Float64`に変換してください。これにより[#43928](https://github.com/ClickHouse/ClickHouse/issues/43928)が解決されます。これにより[#31768](https://github.com/ClickHouse/ClickHouse/issues/31768)が解決されます。これにより[#56435](https://github.com/ClickHouse/ClickHouse/issues/56435)が解決されます。`Decimal`引数を使用してマテリアライズドビューまたはプロジェクション内でこの関数を使用している場合は、support@clickhouse.comにお問い合わせください。集約関数`sumMap`のエラーを修正し、約1.5〜2倍遅くなりました。この関数はいずれにせよ使い物にならないため、問題ありません。これにより[#54955](https://github.com/ClickHouse/ClickHouse/issues/54955)が解決されます。これにより[#53134](https://github.com/ClickHouse/ClickHouse/issues/53134)が解決されます。これにより[#55148](https://github.com/ClickHouse/ClickHouse/issues/55148)が解決されます。関数`groupArraySample`のバグを修正しました - クエリ内で複数の集約状態が生成される場合に同じ乱数シードを使用していました。[#56350](https://github.com/ClickHouse/ClickHouse/pull/56350) ([Alexey Milovidov](https://github.com/alexey-milovidov))。


#### 新機能 {#new-feature-1}

- データベースとテーブルの非同期読み込みを行うサーバー設定 `async_load_databases` を追加しました。サーバーの起動時間を短縮します。`Ordinary`、`Atomic`、`Replicated` エンジンを使用するデータベースに適用されます。これらのテーブルはメタデータを非同期で読み込みます。テーブルへのクエリは読み込みジョブの優先度を上げ、完了を待機します。イントロスペクション用の新しいテーブル `system.asynchronous_loader` を追加しました。[#49351](https://github.com/ClickHouse/ClickHouse/pull/49351) ([Sergei Trifonov](https://github.com/serxa))。
- システムテーブル `blob_storage_log` を追加しました。S3およびその他のオブジェクトストレージに書き込まれたすべてのデータの監査が可能になります。[#52918](https://github.com/ClickHouse/ClickHouse/pull/52918) ([vdimir](https://github.com/vdimir))。
- 統計を使用してprewhere条件をより適切に順序付けします。[#53240](https://github.com/ClickHouse/ClickHouse/pull/53240) ([Han Fei](https://github.com/hanfei1991))。
- Keeperプロトコルでの圧縮のサポートを追加しました。ClickHouse側では、`zookeeper` セクション内の `use_compression` フラグを使用して有効にできます。ClickHouse Keeperのみが圧縮をサポートしており、Apache ZooKeeperはサポートしていないことに注意してください。[#49507](https://github.com/ClickHouse/ClickHouse/issues/49507) を解決します。[#54957](https://github.com/ClickHouse/ClickHouse/pull/54957) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
- 機能 `storage_metadata_write_full_object_key` を導入しました。`true` に設定すると、メタデータファイルが新しい形式で書き込まれます。この形式では、ClickHouseはメタデータファイルに完全なリモートオブジェクトキーを保存し、より優れた柔軟性と最適化を可能にします。[#55566](https://github.com/ClickHouse/ClickHouse/pull/55566) ([Sema Checherinda](https://github.com/CheSema))。
- 名前付きコレクションのフィールドが上書きされないように保護する新しい設定と構文を追加しました。これは、悪意のあるユーザーがシークレットへの不正アクセスを取得することを防ぐためのものです。[#55782](https://github.com/ClickHouse/ClickHouse/pull/55782) ([Salvatore Mesoraca](https://github.com/aiven-sal))。
- すべてのシステムログテーブルに `hostname` カラムを追加しました。システムテーブルをレプリケート、共有、または分散する場合に便利です。[#55894](https://github.com/ClickHouse/ClickHouse/pull/55894) ([Bharat Nallan](https://github.com/bharatnc))。
- `CHECK ALL TABLES` クエリを追加しました。[#56022](https://github.com/ClickHouse/ClickHouse/pull/56022) ([vdimir](https://github.com/vdimir))。
- MySQLの `FROM_DAYS` に類似した関数 `fromDaysSinceYearZero` を追加しました。例: `SELECT fromDaysSinceYearZero(739136)` は `2023-09-08` を返します。[#56088](https://github.com/ClickHouse/ClickHouse/pull/56088) ([Joanna Hulboj](https://github.com/jh0x))。
- ClickHouseを使用せずにバックアップを表示し、そこから情報を抽出するための外部Pythonツールを追加しました。[#56268](https://github.com/ClickHouse/ClickHouse/pull/56268) ([Vitaly Baranov](https://github.com/vitlibar))。
- `preferred_optimize_projection_name` という新しい設定を実装しました。空でない文字列に設定されている場合、すべての候補から選択する代わりに、可能であれば指定されたプロジェクションが使用されます。[#56309](https://github.com/ClickHouse/ClickHouse/pull/56309) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- リーダーシップの譲渡/辞任のための4文字コマンドを追加しました (https://github.com/ClickHouse/ClickHouse/issues/56352)。[#56354](https://github.com/ClickHouse/ClickHouse/pull/56354) ([Pradeep Chhetri](https://github.com/chhetripradeep))。[#56620](https://github.com/ClickHouse/ClickHouse/pull/56620) ([Pradeep Chhetri](https://github.com/chhetripradeep))。
- 入力配列からk個の要素のサンプルを返す新しいSQL関数 `arrayRandomSample(arr, k)` を追加しました。以前は、同様の機能は、例えば `SELECT arrayReduce('groupArraySample(3)', range(10))` のような、より不便な構文でのみ実現できました。[#56416](https://github.com/ClickHouse/ClickHouse/pull/56416) ([Robert Schulze](https://github.com/rschu1ze))。
- `.npy` ファイルで使用する `Float16` 型データのサポートを追加しました。[#56344](https://github.com/ClickHouse/ClickHouse/issues/56344) をクローズします。[#56424](https://github.com/ClickHouse/ClickHouse/pull/56424) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- Tableau Onlineとのより良い互換性のために、システムビュー `information_schema.statistics` を追加しました。[#56425](https://github.com/ClickHouse/ClickHouse/pull/56425) ([Serge Klochkov](https://github.com/slvrtrn))。
- バイナリのイントロスペクションに役立つ `system.symbols` テーブルを追加しました。[#56548](https://github.com/ClickHouse/ClickHouse/pull/56548) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 設定可能なダッシュボード。チャート用のクエリは、デフォルトで新しい `system.dashboards` テーブルを使用するクエリを使用して読み込まれるようになりました。[#56771](https://github.com/ClickHouse/ClickHouse/pull/56771) ([Sergei Trifonov](https://github.com/serxa))。
- `fileCluster` テーブル関数を導入しました。共有ファイルシステム（NFSなど）を `user_files` ディレクトリにマウントする場合に便利です。[#56868](https://github.com/ClickHouse/ClickHouse/pull/56868) ([Andrey Zvonov](https://github.com/zvonand))。
- `s3/file/hdfs/url/azureBlobStorage` エンジンに、ファイルサイズをバイト単位で示す仮想カラム `_size` を追加しました。[#57126](https://github.com/ClickHouse/ClickHouse/pull/57126) ([Kruglov Pavel](https://github.com/Avogar))。
- Prometheusエンドポイントから、最後の再起動以降にサーバーで発生した各エラーコードのエラー数を公開します。[#57209](https://github.com/ClickHouse/ClickHouse/pull/57209) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- ClickHouse keeperは、実行中のアベイラビリティゾーンを `/keeper/availability-zone` パスで報告します。これは `<availability_zone><value>us-west-1a</value></availability_zone>` を介して設定できます。[#56715](https://github.com/ClickHouse/ClickHouse/pull/56715) ([Jianfei Hu](https://github.com/incfly))。
- ALTER materialized_view MODIFY QUERYを非実験的にし、`allow_experimental_alter_materialized_view_structure` 設定を非推奨にしました。[#15206](https://github.com/ClickHouse/ClickHouse/issues/15206) を修正します。[#57311](https://github.com/ClickHouse/ClickHouse/pull/57311) ([alesapin](https://github.com/alesapin))。
- 設定 `join_algorithm` は指定された順序を尊重します [#51745](https://github.com/ClickHouse/ClickHouse/pull/51745) ([vdimir](https://github.com/vdimir))。
- Protobuf形式で[よく知られたProtobuf型](https://protobuf.dev/reference/protobuf/google.protobuf/)のサポートを追加しました。[#56741](https://github.com/ClickHouse/ClickHouse/pull/56741) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。





#### パフォーマンス改善 {#performance-improvement-1}

- S3との通信における適応的タイムアウト。最初の試行は低い送信および受信タイムアウトで実行されます。[#56314](https://github.com/ClickHouse/ClickHouse/pull/56314) ([Sema Checherinda](https://github.com/CheSema))。
- `max_concurrent_queries`のデフォルト値を100から1000に増加。これは、データの送受信が遅い接続クライアントが多数存在し、サーバーがCPUによって制限されない場合、またはCPUコア数が100を超える場合に有効です。また、デフォルトで同時実行制御を有効にし、クエリ処理スレッドの総数をCPUコア数の2倍に設定します。これにより、非常に多数の同時実行クエリが発生するシナリオでパフォーマンスが向上します。[#46927](https://github.com/ClickHouse/ClickHouse/pull/46927) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ウィンドウ関数の並列評価をサポート。[#34688](https://github.com/ClickHouse/ClickHouse/issues/34688)を修正。[#39631](https://github.com/ClickHouse/ClickHouse/pull/39631) ([Dmitry Novik](https://github.com/novikd))。
- `Numbers`テーブルエンジン（`system.numbers`テーブルの）は、テーブルのインデックスのように、条件を分析して必要なデータのサブセットを生成するようになりました。[#50909](https://github.com/ClickHouse/ClickHouse/pull/50909) ([JackyWoo](https://github.com/JackyWoo))。
- `Merge`テーブルエンジンにおける`IN (...)`条件によるフィルタリングのパフォーマンスを改善。[#54905](https://github.com/ClickHouse/ClickHouse/pull/54905) ([Nikita Taranov](https://github.com/nickitat))。
- ファイルシステムキャッシュが満杯で大規模な読み取りが発生する場合の改善。[#55158](https://github.com/ClickHouse/ClickHouse/pull/55158) ([Kseniia Sumarokova](https://github.com/kssenii))。
- ファイルの過度な走査を回避するため、S3のチェックサムを無効にする機能を追加（これは設定`s3_disable_checksum`で制御されます）。[#55559](https://github.com/ClickHouse/ClickHouse/pull/55559) ([Azat Khuzhin](https://github.com/azat))。
- データがページキャッシュにある場合、リモートテーブルから同期的に読み取るようになりました（ローカルテーブルと同様）。これはより高速で、スレッドプール内での同期を必要とせず、ローカルFS上での`seek`を躊躇せず、CPU待機時間を削減します。[#55841](https://github.com/ClickHouse/ClickHouse/pull/55841) ([Nikita Taranov](https://github.com/nickitat))。
- `map`、`arrayElement`から値を取得する際の最適化。約30%の高速化をもたらします。- 予約メモリの削減 - `resize`呼び出しの削減。[#55957](https://github.com/ClickHouse/ClickHouse/pull/55957) ([lgbo](https://github.com/lgbo-ustc))。
- AVX-512による多段階フィルタリングの最適化。ICXデバイス（Intel Xeon Platinum 8380 CPU、80コア、160スレッド）上でのOnTimeデータセットのパフォーマンス実験により、この変更がクエリQ2、Q3、Q4、Q5、Q6のQPSにそれぞれ7.4%、5.9%、4.7%、3.0%、4.6%の改善をもたらし、他のクエリには影響を与えないことが示されました。[#56079](https://github.com/ClickHouse/ClickHouse/pull/56079) ([Zhiguo Zhou](https://github.com/ZhiguoZh))。
- クエリプロファイラ内でビジー状態のスレッド数を制限。それ以上のスレッドがある場合、プロファイリングをスキップします。[#56105](https://github.com/ClickHouse/ClickHouse/pull/56105) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ウィンドウ関数における仮想関数呼び出しの量を削減。[#56120](https://github.com/ClickHouse/ClickHouse/pull/56120) ([Maksim Kita](https://github.com/kitaisreal))。
- ORCデータ形式で再帰的なTupleフィールドプルーニングを許可し、スキャンを高速化。[#56122](https://github.com/ClickHouse/ClickHouse/pull/56122) ([李扬](https://github.com/taiyang-li))。
- `Npy`データ形式の簡易カウント最適化：`select count() from 'data.npy'`のようなクエリは、結果のキャッシュにより大幅に高速化されます。[#56304](https://github.com/ClickHouse/ClickHouse/pull/56304) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- 集約と多数のストリームを含むクエリは、プラン構築時のメモリ使用量が削減されます。[#57074](https://github.com/ClickHouse/ClickHouse/pull/57074) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ProcessListへのアクセスを最適化することで、多数のユーザーと高度に同時実行されるクエリ（>2000 QPS）のユースケースにおけるクエリ実行パフォーマンスを改善。[#57106](https://github.com/ClickHouse/ClickHouse/pull/57106) ([Andrej Hoos](https://github.com/adikus))。
- array joinの簡易改善、一部の中間結果を再利用。[#57183](https://github.com/ClickHouse/ClickHouse/pull/57183) ([李扬](https://github.com/taiyang-li))。
- スタックアンワインドが遅いケースがありました。もうありません。[#57221](https://github.com/ClickHouse/ClickHouse/pull/57221) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `max_streams = 1`の場合、外部ストレージからの読み取りにデフォルトの読み取りプールを使用するようになりました。読み取りプリフェッチが有効な場合に有益です。[#57334](https://github.com/ClickHouse/ClickHouse/pull/57334) ([Nikita Taranov](https://github.com/nickitat))。
- Keeperの改善：ログの前処理を遅延させることで、起動時のメモリ使用量を改善。[#55660](https://github.com/ClickHouse/ClickHouse/pull/55660) ([Antonio Andelic](https://github.com/antonio2368))。
- `File`および`HDFS`ストレージのglobマッチングのパフォーマンスを改善。[#56141](https://github.com/ClickHouse/ClickHouse/pull/56141) ([Andrey Zvonov](https://github.com/zvonand))。
- 実験的な全文インデックスのポスティングリストが圧縮され、サイズが10〜30%削減されます。[#56226](https://github.com/ClickHouse/ClickHouse/pull/56226) ([Harry Lee](https://github.com/HarryLeeIBM))。
- バックアップにおける`BackupEntriesCollector`の並列化。[#56312](https://github.com/ClickHouse/ClickHouse/pull/56312) ([Kseniia Sumarokova](https://github.com/kssenii))。





#### 改善 {#improvement-1}

- Add a new `MergeTree` setting `add_implicit_sign_column_constraint_for_collapsing_engine` (disabled by default). When enabled, it adds an implicit CHECK constraint for `CollapsingMergeTree` tables that restricts the value of the `Sign` column to be only -1 or 1. [#56701](https://github.com/ClickHouse/ClickHouse/issues/56701). [#56986](https://github.com/ClickHouse/ClickHouse/pull/56986) ([Kevin Mingtarja](https://github.com/kevinmingtarja)).
- Enable adding new disk to storage configuration without restart. [#56367](https://github.com/ClickHouse/ClickHouse/pull/56367) ([Duc Canh Le](https://github.com/canhld94)).
- Support creating and materializing index in the same alter query, also support "modify TTL" and "materialize TTL" in the same query. Closes [#55651](https://github.com/ClickHouse/ClickHouse/issues/55651). [#56331](https://github.com/ClickHouse/ClickHouse/pull/56331) ([flynn](https://github.com/ucasfl)).
- Add a new table function named `fuzzJSON` with rows containing perturbed versions of the source JSON string with random variations. [#56490](https://github.com/ClickHouse/ClickHouse/pull/56490) ([Julia Kartseva](https://github.com/jkartseva)).
- Engine `Merge` filters the records according to the row policies of the underlying tables, so you don't have to create another row policy on a `Merge` table. [#50209](https://github.com/ClickHouse/ClickHouse/pull/50209) ([Ilya Golshtein](https://github.com/ilejn)).
- Add a setting `max_execution_time_leaf` to limit the execution time on shard for distributed query, and `timeout_overflow_mode_leaf` to control the behaviour if timeout happens. [#51823](https://github.com/ClickHouse/ClickHouse/pull/51823) ([Duc Canh Le](https://github.com/canhld94)).
- Add ClickHouse setting to disable tunneling for HTTPS requests over HTTP proxy. [#55033](https://github.com/ClickHouse/ClickHouse/pull/55033) ([Arthur Passos](https://github.com/arthurpassos)).
- Set `background_fetches_pool_size` to 16, background_schedule_pool_size to 512 that is better for production usage with frequent small insertions. [#54327](https://github.com/ClickHouse/ClickHouse/pull/54327) ([Denny Crane](https://github.com/den-crane)).
- While read data from a csv format file, and at end of line is `\r` , which not followed by `\n`, then we will enconter the exception as follows `Cannot parse CSV format: found \r (CR) not followed by \n (LF). Line must end by \n (LF) or \r\n (CR LF) or \n\r.` In clickhouse, the csv end of line must be `\n` or `\r\n` or `\n\r`, so the `\r` must be followed by `\n`, but in some situation, the csv input data is abnormal, like above, `\r` is at end of line. [#54340](https://github.com/ClickHouse/ClickHouse/pull/54340) ([KevinyhZou](https://github.com/KevinyhZou)).
- Update Arrow library to release-13.0.0 that supports new encodings. Closes [#44505](https://github.com/ClickHouse/ClickHouse/issues/44505). [#54800](https://github.com/ClickHouse/ClickHouse/pull/54800) ([Kruglov Pavel](https://github.com/Avogar)).
- Improve performance of ON CLUSTER queries by removing heavy system calls to get all network interfaces when looking for local ip address in the DDL entry hosts list. [#54909](https://github.com/ClickHouse/ClickHouse/pull/54909) ([Duc Canh Le](https://github.com/canhld94)).
- Fixed accounting of memory allocated before attaching a thread to a query or a user. [#56089](https://github.com/ClickHouse/ClickHouse/pull/56089) ([Nikita Taranov](https://github.com/nickitat)).
- Add support for `LARGE_LIST` in Apache Arrow formats. [#56118](https://github.com/ClickHouse/ClickHouse/pull/56118) ([edef](https://github.com/edef1c)).
- Allow manual compaction of `EmbeddedRocksDB` via `OPTIMIZE` query. [#56225](https://github.com/ClickHouse/ClickHouse/pull/56225) ([Azat Khuzhin](https://github.com/azat)).
- Add ability to specify BlockBasedTableOptions for `EmbeddedRocksDB` tables. [#56264](https://github.com/ClickHouse/ClickHouse/pull/56264) ([Azat Khuzhin](https://github.com/azat)).
- `SHOW COLUMNS` now displays MySQL's equivalent data type name when the connection was made through the MySQL protocol. Previously, this was the case when setting `use_mysql_types_in_show_columns = 1`. The setting is retained but made obsolete. [#56277](https://github.com/ClickHouse/ClickHouse/pull/56277) ([Robert Schulze](https://github.com/rschu1ze)).
- Fixed possible `The local set of parts of table doesn't look like the set of parts in ZooKeeper` error if server was restarted just after `TRUNCATE` or `DROP PARTITION`. [#56282](https://github.com/ClickHouse/ClickHouse/pull/56282) ([Alexander Tokmakov](https://github.com/tavplubix)).
- Fixed handling of non-const query strings in functions `formatQuery`/ `formatQuerySingleLine`. Also added `OrNull` variants of both functions that return a NULL when a query cannot be parsed instead of throwing an exception. [#56327](https://github.com/ClickHouse/ClickHouse/pull/56327) ([Robert Schulze](https://github.com/rschu1ze)).
- Allow backup of materialized view with dropped inner table instead of failing the backup. [#56387](https://github.com/ClickHouse/ClickHouse/pull/56387) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Queries to `system.replicas` initiate requests to ZooKeeper when certain columns are queried. When there are thousands of tables these requests might produce a considerable load on ZooKeeper. If there are multiple simultaneous queries to `system.replicas` they do same requests multiple times. The change is to "deduplicate" requests from concurrent queries. [#56420](https://github.com/ClickHouse/ClickHouse/pull/56420) ([Alexander Gololobov](https://github.com/davenger)).
- Fix translation to MySQL compatible query for querying external databases. [#56456](https://github.com/ClickHouse/ClickHouse/pull/56456) ([flynn](https://github.com/ucasfl)).
- Add support for backing up and restoring tables using `KeeperMap` engine. [#56460](https://github.com/ClickHouse/ClickHouse/pull/56460) ([Antonio Andelic](https://github.com/antonio2368)).
- 404 response for CompleteMultipartUpload has to be rechecked. Operation could be done on server even if client got timeout or other network errors. The next retry of CompleteMultipartUpload receives 404 response. If the object key exists that operation is considered as successful. [#56475](https://github.com/ClickHouse/ClickHouse/pull/56475) ([Sema Checherinda](https://github.com/CheSema)).
- Enable the HTTP OPTIONS method by default - it simplifies requesting ClickHouse from a web browser. [#56483](https://github.com/ClickHouse/ClickHouse/pull/56483) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- The value for `dns_max_consecutive_failures` was changed by mistake in [#46550](https://github.com/ClickHouse/ClickHouse/issues/46550) - this is reverted and adjusted to a better value. Also, increased the HTTP keep-alive timeout to a reasonable value from production. [#56485](https://github.com/ClickHouse/ClickHouse/pull/56485) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Load base backups lazily (a base backup won't be loaded until it's needed). Also add some log message and profile events for backups. [#56516](https://github.com/ClickHouse/ClickHouse/pull/56516) ([Vitaly Baranov](https://github.com/vitlibar)).
- Setting `query_cache_store_results_of_queries_with_nondeterministic_functions` (with values `false` or `true`) was marked obsolete. It was replaced by setting `query_cache_nondeterministic_function_handling`, a three-valued enum that controls how the query cache handles queries with non-deterministic functions: a) throw an exception (default behavior), b) save the non-deterministic query result regardless, or c) ignore, i.e. don't throw an exception and don't cache the result. [#56519](https://github.com/ClickHouse/ClickHouse/pull/56519) ([Robert Schulze](https://github.com/rschu1ze)).
- Rewrite equality with `is null` check in JOIN ON section. Experimental _Analyzer only_. [#56538](https://github.com/ClickHouse/ClickHouse/pull/56538) ([vdimir](https://github.com/vdimir)).
- Function`concat` now supports arbitrary argument types (instead of only String and FixedString arguments). This makes it behave more similar to MySQL `concat` implementation. For example, `SELECT concat('ab', 42)` now returns `ab42`. [#56540](https://github.com/ClickHouse/ClickHouse/pull/56540) ([Serge Klochkov](https://github.com/slvrtrn)).
- Allow getting cache configuration from 'named_collection' section in config or from SQL created named collections. [#56541](https://github.com/ClickHouse/ClickHouse/pull/56541) ([Kseniia Sumarokova](https://github.com/kssenii)).
- PostgreSQL database engine: Make the removal of outdated tables less aggressive with unsuccessful postgres connection. [#56609](https://github.com/ClickHouse/ClickHouse/pull/56609) ([jsc0218](https://github.com/jsc0218)).
- It took too much time to connnect to PG when URL is not right, so the relevant query stucks there and get cancelled. [#56648](https://github.com/ClickHouse/ClickHouse/pull/56648) ([jsc0218](https://github.com/jsc0218)).
- Keeper improvement: disable compressed logs by default in Keeper. [#56763](https://github.com/ClickHouse/ClickHouse/pull/56763) ([Antonio Andelic](https://github.com/antonio2368)).
- Add config setting `wait_dictionaries_load_at_startup`. [#56782](https://github.com/ClickHouse/ClickHouse/pull/56782) ([Vitaly Baranov](https://github.com/vitlibar)).
- There was a potential vulnerability in previous ClickHouse versions: if a user has connected and unsuccessfully tried to authenticate with the "interserver secret" method, the server didn't terminate the connection immediately but continued to receive and ignore the leftover packets from the client. While these packets are ignored, they are still parsed, and if they use a compression method with another known vulnerability, it will lead to exploitation of it without authentication. This issue was found with [ClickHouse Bug Bounty Program](https://github.com/ClickHouse/ClickHouse/issues/38986) by https://twitter.com/malacupa. [#56794](https://github.com/ClickHouse/ClickHouse/pull/56794) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Fetching a part waits when that part is fully committed on remote replica. It is better not send part in PreActive state. In case of zero copy this is mandatory restriction. [#56808](https://github.com/ClickHouse/ClickHouse/pull/56808) ([Sema Checherinda](https://github.com/CheSema)).
- Fix possible postgresql logical replication conversion error when using experimental `MaterializedPostgreSQL`. [#53721](https://github.com/ClickHouse/ClickHouse/pull/53721) ([takakawa](https://github.com/takakawa)).
- Implement user-level setting `alter_move_to_space_execute_async` which allow to execute queries `ALTER TABLE ... MOVE PARTITION|PART TO DISK|VOLUME` asynchronously. The size of pool for background executions is controlled by `background_move_pool_size`. Default behavior is synchronous execution. Fixes [#47643](https://github.com/ClickHouse/ClickHouse/issues/47643). [#56809](https://github.com/ClickHouse/ClickHouse/pull/56809) ([alesapin](https://github.com/alesapin)).
- Able to filter by engine when scanning system.tables, avoid unnecessary (potentially time-consuming) connection. [#56813](https://github.com/ClickHouse/ClickHouse/pull/56813) ([jsc0218](https://github.com/jsc0218)).
- Show `total_bytes` and `total_rows` in system tables for RocksDB storage. [#56816](https://github.com/ClickHouse/ClickHouse/pull/56816) ([Aleksandr Musorin](https://github.com/AVMusorin)).
- Allow basic commands in ALTER for TEMPORARY tables. [#56892](https://github.com/ClickHouse/ClickHouse/pull/56892) ([Sergey](https://github.com/icuken)).
- LZ4 compression. Buffer compressed block in a rare case when out buffer capacity is not enough for writing compressed block directly to out's buffer. [#56938](https://github.com/ClickHouse/ClickHouse/pull/56938) ([Sema Checherinda](https://github.com/CheSema)).
- Add metrics for the number of queued jobs, which is useful for the IO thread pool. [#56958](https://github.com/ClickHouse/ClickHouse/pull/56958) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Add a setting for PostgreSQL table engine setting in the config file. Added a check for the setting Added documentation around the additional setting. [#56959](https://github.com/ClickHouse/ClickHouse/pull/56959) ([Peignon Melvyn](https://github.com/melvynator)).
- Function `concat` can now be called with a single argument, e.g., `SELECT concat('abc')`. This makes its behavior more consistent with MySQL's concat implementation. [#57000](https://github.com/ClickHouse/ClickHouse/pull/57000) ([Serge Klochkov](https://github.com/slvrtrn)).
- Signs all `x-amz-*` headers as required by AWS S3 docs. [#57001](https://github.com/ClickHouse/ClickHouse/pull/57001) ([Arthur Passos](https://github.com/arthurpassos)).
- Function `fromDaysSinceYearZero` (alias: `FROM_DAYS`) can now be used with unsigned and signed integer types (previously, it had to be an unsigned integer). This improve compatibility with 3rd party tools such as Tableau Online. [#57002](https://github.com/ClickHouse/ClickHouse/pull/57002) ([Serge Klochkov](https://github.com/slvrtrn)).
- Add `system.s3queue_log` to default config. [#57036](https://github.com/ClickHouse/ClickHouse/pull/57036) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Change the default for `wait_dictionaries_load_at_startup` to true, and use this setting only if `dictionaries_lazy_load` is false. [#57133](https://github.com/ClickHouse/ClickHouse/pull/57133) ([Vitaly Baranov](https://github.com/vitlibar)).
- Check dictionary source type on creation even if `dictionaries_lazy_load` is enabled. [#57134](https://github.com/ClickHouse/ClickHouse/pull/57134) ([Vitaly Baranov](https://github.com/vitlibar)).
- Plan-level optimizations can now be enabled/disabled individually. Previously, it was only possible to disable them all. The setting which previously did that (`query_plan_enable_optimizations`) is retained and can still be used to disable all optimizations. [#57152](https://github.com/ClickHouse/ClickHouse/pull/57152) ([Robert Schulze](https://github.com/rschu1ze)).
- The server's exit code will correspond to the exception code. For example, if the server cannot start due to memory limit, it will exit with the code 241 = MEMORY_LIMIT_EXCEEDED. In previous versions, the exit code for exceptions was always 70 = Poco::Util::ExitCode::EXIT_SOFTWARE. [#57153](https://github.com/ClickHouse/ClickHouse/pull/57153) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Do not demangle and symbolize stack frames from `functional` C++ header. [#57201](https://github.com/ClickHouse/ClickHouse/pull/57201) ([Mike Kot](https://github.com/myrrc)).
- HTTP server page `/dashboard` now supports charts with multiple lines. [#57236](https://github.com/ClickHouse/ClickHouse/pull/57236) ([Sergei Trifonov](https://github.com/serxa)).
- The `max_memory_usage_in_client` command line option supports a string value with a suffix (K, M, G, etc). Closes [#56879](https://github.com/ClickHouse/ClickHouse/issues/56879). [#57273](https://github.com/ClickHouse/ClickHouse/pull/57273) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
- Bumped Intel QPL (used by codec `DEFLATE_QPL`) from v1.2.0 to v1.3.1 . Also fixed a bug in case of BOF (Block On Fault) = 0, changed to handle page faults by falling back to SW path. [#57291](https://github.com/ClickHouse/ClickHouse/pull/57291) ([jasperzhu](https://github.com/jinjunzh)).
- Increase default `replicated_deduplication_window` of MergeTree settings from 100 to 1k. [#57335](https://github.com/ClickHouse/ClickHouse/pull/57335) ([sichenzhao](https://github.com/sichenzhao)).
- Stop using `INCONSISTENT_METADATA_FOR_BACKUP` that much. If possible prefer to continue scanning instead of stopping and starting the scanning for backup from the beginning. [#57385](https://github.com/ClickHouse/ClickHouse/pull/57385) ([Vitaly Baranov](https://github.com/vitlibar)).





#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-1}

- SQLLogicテストを追加しました。[#56078](https://github.com/ClickHouse/ClickHouse/pull/56078) ([Han Fei](https://github.com/hanfei1991))。
- 使いやすさのため、`clickhouse-local`と`clickhouse-client`を短縮名(`ch`、`chl`、`chc`)で利用可能にしました。[#56634](https://github.com/ClickHouse/ClickHouse/pull/56634) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 外部ライブラリから未使用のコードを削除することで、ビルドサイズをさらに最適化しました。[#56786](https://github.com/ClickHouse/ClickHouse/pull/56786) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 大きなトランスレーションユニットが存在しないことを自動的にチェックする機能を追加しました。[#56559](https://github.com/ClickHouse/ClickHouse/pull/56559) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- シングルバイナリ配布のサイズを削減しました。これにより[#55181](https://github.com/ClickHouse/ClickHouse/issues/55181)が解決されます。[#56617](https://github.com/ClickHouse/ClickHouse/pull/56617) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 各ビルド後のすべてのトランスレーションユニットとバイナリファイルのサイズに関する情報が、ClickHouse CloudのCIデータベースに送信されるようになりました。これにより[#56107](https://github.com/ClickHouse/ClickHouse/issues/56107)が解決されます。[#56636](https://github.com/ClickHouse/ClickHouse/pull/56636) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- "Apache Arrow"ライブラリの特定のファイル(Arrow形式の解析など、必須ではない用途にのみ使用)が、ビルドキャッシュに関係なく常に再ビルドされていました。この問題を修正しました。[#56657](https://github.com/ClickHouse/ClickHouse/pull/56657) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- バージョンに関する自動生成されたソースファイルに依存するトランスレーションユニットの再コンパイルを回避するようにしました。[#56660](https://github.com/ClickHouse/ClickHouse/pull/56660) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- リンカー呼び出しのトレースデータが、ClickHouse CloudのCIデータベースに送信されるようになりました。[#56725](https://github.com/ClickHouse/ClickHouse/pull/56725) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- clickhouseバイナリにDWARF 5デバッグシンボルを使用するようにしました(以前はDWARF 4)。[#56770](https://github.com/ClickHouse/ClickHouse/pull/56770) ([Michael Kolupaev](https://github.com/al13n321))。
- 新しいビルドオプション`SANITIZE_COVERAGE`を追加しました。これを有効にすると、カバレッジを追跡するためにコードが計装されます。収集された情報は、ClickHouse内で次の方法で利用できます:(1) 前回のカバレッジリセット後にコード内で見つかった一意のアドレスの配列を返す新しい関数`coverage`、(2) 蓄積されたデータをリセットする`SYSTEM RESET COVERAGE`クエリ。これにより、差分コードカバレッジを含む、異なるテストのカバレッジを比較できるようになります。[#20539](https://github.com/ClickHouse/ClickHouse/issues/20539)の続きです。[#56102](https://github.com/ClickHouse/ClickHouse/pull/56102) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- スタックを収集する際に、一部のスタックフレームが解決されない場合があります。そのような場合、生のアドレスが役立つ可能性があります。[#56267](https://github.com/ClickHouse/ClickHouse/pull/56267) ([Alexander Gololobov](https://github.com/davenger))。
- `libssh`を無効にするオプションを追加しました。[#56333](https://github.com/ClickHouse/ClickHouse/pull/56333) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- CI内のS3テストでtemporary_data_in_cacheを有効にしました。[#48425](https://github.com/ClickHouse/ClickHouse/pull/48425) ([vdimir](https://github.com/vdimir))。
- CI内のclickhouse-clientの最大メモリ使用量を`1G`に設定しました。[#56873](https://github.com/ClickHouse/ClickHouse/pull/56873) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。





#### バグ修正（公式安定版リリースにおけるユーザーに影響する不具合） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-1}

- Fix exerimental Analyzer - insertion from select with subquery referencing insertion table should process only insertion block. [#50857](https://github.com/ClickHouse/ClickHouse/pull/50857) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- Fix a bug in `str_to_map` function. [#56423](https://github.com/ClickHouse/ClickHouse/pull/56423) ([Arthur Passos](https://github.com/arthurpassos)).
- Keeper `reconfig`: add timeout before yielding/taking leadership [#53481](https://github.com/ClickHouse/ClickHouse/pull/53481) ([Mike Kot](https://github.com/myrrc)).
- Fix incorrect header in grace hash join and filter pushdown [#53922](https://github.com/ClickHouse/ClickHouse/pull/53922) ([vdimir](https://github.com/vdimir)).
- Select from system tables when table based on table function. [#55540](https://github.com/ClickHouse/ClickHouse/pull/55540) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
- RFC: Fix "Cannot find column X in source stream" for Distributed queries with LIMIT BY [#55836](https://github.com/ClickHouse/ClickHouse/pull/55836) ([Azat Khuzhin](https://github.com/azat)).
- Fix 'Cannot read from file:' while running client in a background [#55976](https://github.com/ClickHouse/ClickHouse/pull/55976) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix clickhouse-local exit on bad send_logs_level setting [#55994](https://github.com/ClickHouse/ClickHouse/pull/55994) ([Kruglov Pavel](https://github.com/Avogar)).
- Bug fix explain ast with parameterized view [#56004](https://github.com/ClickHouse/ClickHouse/pull/56004) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
- Fix a crash during table loading on startup [#56232](https://github.com/ClickHouse/ClickHouse/pull/56232) ([Nikolay Degterinsky](https://github.com/evillique)).
- Fix ClickHouse-sourced dictionaries with an explicit query [#56236](https://github.com/ClickHouse/ClickHouse/pull/56236) ([Nikolay Degterinsky](https://github.com/evillique)).
- Fix segfault in signal handler for Keeper [#56266](https://github.com/ClickHouse/ClickHouse/pull/56266) ([Antonio Andelic](https://github.com/antonio2368)).
- Fix incomplete query result for UNION in view() function. [#56274](https://github.com/ClickHouse/ClickHouse/pull/56274) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
- Fix inconsistency of "cast('0' as DateTime64(3))" and "cast('0' as Nullable(DateTime64(3)))" [#56286](https://github.com/ClickHouse/ClickHouse/pull/56286) ([李扬](https://github.com/taiyang-li)).
- Fix rare race condition related to Memory allocation failure [#56303](https://github.com/ClickHouse/ClickHouse/pull/56303) ([alesapin](https://github.com/alesapin)).
- Fix restore from backup with `flatten_nested` and `data_type_default_nullable` [#56306](https://github.com/ClickHouse/ClickHouse/pull/56306) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Fix crash in case of adding a column with type Object(JSON) [#56307](https://github.com/ClickHouse/ClickHouse/pull/56307) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
- Fix crash in filterPushDown [#56380](https://github.com/ClickHouse/ClickHouse/pull/56380) ([vdimir](https://github.com/vdimir)).
- Fix restore from backup with mat view and dropped source table [#56383](https://github.com/ClickHouse/ClickHouse/pull/56383) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Fix segfault during Kerberos initialization [#56401](https://github.com/ClickHouse/ClickHouse/pull/56401) ([Nikolay Degterinsky](https://github.com/evillique)).
- Fix buffer overflow in T64 [#56434](https://github.com/ClickHouse/ClickHouse/pull/56434) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Fix nullable primary key in final (2) [#56452](https://github.com/ClickHouse/ClickHouse/pull/56452) ([Amos Bird](https://github.com/amosbird)).
- Fix ON CLUSTER queries without database on initial node [#56484](https://github.com/ClickHouse/ClickHouse/pull/56484) ([Nikolay Degterinsky](https://github.com/evillique)).
- Fix startup failure due to TTL dependency [#56489](https://github.com/ClickHouse/ClickHouse/pull/56489) ([Nikolay Degterinsky](https://github.com/evillique)).
- Fix ALTER COMMENT queries ON CLUSTER [#56491](https://github.com/ClickHouse/ClickHouse/pull/56491) ([Nikolay Degterinsky](https://github.com/evillique)).
- Fix ALTER COLUMN with ALIAS [#56493](https://github.com/ClickHouse/ClickHouse/pull/56493) ([Nikolay Degterinsky](https://github.com/evillique)).
- Fix empty NAMED COLLECTIONs [#56494](https://github.com/ClickHouse/ClickHouse/pull/56494) ([Nikolay Degterinsky](https://github.com/evillique)).
- Fix two cases of projection analysis. [#56502](https://github.com/ClickHouse/ClickHouse/pull/56502) ([Amos Bird](https://github.com/amosbird)).
- Fix handling of aliases in query cache [#56545](https://github.com/ClickHouse/ClickHouse/pull/56545) ([Robert Schulze](https://github.com/rschu1ze)).
- Fix conversion from `Nullable(Enum)` to `Nullable(String)` [#56644](https://github.com/ClickHouse/ClickHouse/pull/56644) ([Nikolay Degterinsky](https://github.com/evillique)).
- More reliable log handling in Keeper [#56670](https://github.com/ClickHouse/ClickHouse/pull/56670) ([Antonio Andelic](https://github.com/antonio2368)).
- Fix configuration merge for nodes with substitution attributes [#56694](https://github.com/ClickHouse/ClickHouse/pull/56694) ([Konstantin Bogdanov](https://github.com/thevar1able)).
- Fix duplicate usage of table function input(). [#56695](https://github.com/ClickHouse/ClickHouse/pull/56695) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
- Fix: RabbitMQ OpenSSL dynamic loading issue [#56703](https://github.com/ClickHouse/ClickHouse/pull/56703) ([Igor Nikonov](https://github.com/devcrafter)).
- Fix crash in GCD codec in case when zeros present in data [#56704](https://github.com/ClickHouse/ClickHouse/pull/56704) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
- Fix 'mutex lock failed: Invalid argument' in clickhouse-local during insert into function [#56710](https://github.com/ClickHouse/ClickHouse/pull/56710) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix Date text parsing in optimistic path [#56765](https://github.com/ClickHouse/ClickHouse/pull/56765) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix crash in FPC codec [#56795](https://github.com/ClickHouse/ClickHouse/pull/56795) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- DatabaseReplicated: fix DDL query timeout after recovering a replica [#56796](https://github.com/ClickHouse/ClickHouse/pull/56796) ([Alexander Tokmakov](https://github.com/tavplubix)).
- Fix incorrect nullable columns reporting in MySQL binary protocol [#56799](https://github.com/ClickHouse/ClickHouse/pull/56799) ([Serge Klochkov](https://github.com/slvrtrn)).
- Support Iceberg metadata files for metastore tables [#56810](https://github.com/ClickHouse/ClickHouse/pull/56810) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix TSAN report under transform [#56817](https://github.com/ClickHouse/ClickHouse/pull/56817) ([Raúl Marín](https://github.com/Algunenano)).
- Fix SET query and SETTINGS formatting [#56825](https://github.com/ClickHouse/ClickHouse/pull/56825) ([Nikolay Degterinsky](https://github.com/evillique)).
- Fix failure to start due to table dependency in joinGet [#56828](https://github.com/ClickHouse/ClickHouse/pull/56828) ([Nikolay Degterinsky](https://github.com/evillique)).
- Fix flattening existing Nested columns during ADD COLUMN [#56830](https://github.com/ClickHouse/ClickHouse/pull/56830) ([Nikolay Degterinsky](https://github.com/evillique)).
- Fix allow cr end of line for csv [#56901](https://github.com/ClickHouse/ClickHouse/pull/56901) ([KevinyhZou](https://github.com/KevinyhZou)).
- Fix `tryBase64Decode` with invalid input [#56913](https://github.com/ClickHouse/ClickHouse/pull/56913) ([Robert Schulze](https://github.com/rschu1ze)).
- Fix generating deep nested columns in CapnProto/Protobuf schemas [#56941](https://github.com/ClickHouse/ClickHouse/pull/56941) ([Kruglov Pavel](https://github.com/Avogar)).
- Prevent incompatible ALTER of projection columns [#56948](https://github.com/ClickHouse/ClickHouse/pull/56948) ([Amos Bird](https://github.com/amosbird)).
- Fix sqlite file path validation [#56984](https://github.com/ClickHouse/ClickHouse/pull/56984) ([San](https://github.com/santrancisco)).
- S3Queue: fix metadata reference increment [#56990](https://github.com/ClickHouse/ClickHouse/pull/56990) ([Kseniia Sumarokova](https://github.com/kssenii)).
- S3Queue minor fix [#56999](https://github.com/ClickHouse/ClickHouse/pull/56999) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Fix file path validation for DatabaseFileSystem [#57029](https://github.com/ClickHouse/ClickHouse/pull/57029) ([San](https://github.com/santrancisco)).
- Fix `fuzzBits` with `ARRAY JOIN` [#57033](https://github.com/ClickHouse/ClickHouse/pull/57033) ([Antonio Andelic](https://github.com/antonio2368)).
- Fix Nullptr dereference in partial merge join with joined_subquery_re... [#57048](https://github.com/ClickHouse/ClickHouse/pull/57048) ([vdimir](https://github.com/vdimir)).
- Fix race condition in RemoteSource [#57052](https://github.com/ClickHouse/ClickHouse/pull/57052) ([Raúl Marín](https://github.com/Algunenano)).
- Implement `bitHammingDistance` for big integers [#57073](https://github.com/ClickHouse/ClickHouse/pull/57073) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- S3-style links bug fix [#57075](https://github.com/ClickHouse/ClickHouse/pull/57075) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
- Fix JSON_QUERY function with multiple numeric paths [#57096](https://github.com/ClickHouse/ClickHouse/pull/57096) ([KevinyhZou](https://github.com/KevinyhZou)).
- Fix buffer overflow in Gorilla codec [#57107](https://github.com/ClickHouse/ClickHouse/pull/57107) ([Nikolay Degterinsky](https://github.com/evillique)).
- Close interserver connection on any exception before authentication [#57142](https://github.com/ClickHouse/ClickHouse/pull/57142) ([Antonio Andelic](https://github.com/antonio2368)).
- Fix segfault after ALTER UPDATE with Nullable MATERIALIZED column [#57147](https://github.com/ClickHouse/ClickHouse/pull/57147) ([Nikolay Degterinsky](https://github.com/evillique)).
- Fix incorrect JOIN plan optimization with partially materialized normal projection [#57196](https://github.com/ClickHouse/ClickHouse/pull/57196) ([Amos Bird](https://github.com/amosbird)).
- Ignore comments when comparing column descriptions [#57259](https://github.com/ClickHouse/ClickHouse/pull/57259) ([Antonio Andelic](https://github.com/antonio2368)).
- Fix `ReadonlyReplica` metric for all cases [#57267](https://github.com/ClickHouse/ClickHouse/pull/57267) ([Antonio Andelic](https://github.com/antonio2368)).
- Background merges correctly use temporary data storage in the cache [#57275](https://github.com/ClickHouse/ClickHouse/pull/57275) ([vdimir](https://github.com/vdimir)).
- Keeper fix for changelog and snapshots [#57299](https://github.com/ClickHouse/ClickHouse/pull/57299) ([Antonio Andelic](https://github.com/antonio2368)).
- Ignore finished ON CLUSTER tasks if hostname changed [#57339](https://github.com/ClickHouse/ClickHouse/pull/57339) ([Alexander Tokmakov](https://github.com/tavplubix)).
- MergeTree mutations reuse source part index granularity [#57352](https://github.com/ClickHouse/ClickHouse/pull/57352) ([Maksim Kita](https://github.com/kitaisreal)).
- FS cache: add a limit for background download [#57424](https://github.com/ClickHouse/ClickHouse/pull/57424) ([Kseniia Sumarokova](https://github.com/kssenii)).

### <a id="2310"></a> ClickHouse release 23.10, 2023-11-02 {#2310}

#### 後方互換性のない変更 {#backward-incompatible-change-2}

- 破損したデータパーツを自動的に削除するオプションは廃止されました。これにより [#55174](https://github.com/ClickHouse/ClickHouse/issues/55174) がクローズされます。[#55184](https://github.com/ClickHouse/ClickHouse/pull/55184) ([Alexey Milovidov](https://github.com/alexey-milovidov))。[#55557](https://github.com/ClickHouse/ClickHouse/pull/55557) ([Jihyuk Bok](https://github.com/tomahawk28))。
- 廃止されたインメモリデータパーツは、先行書き込みログから読み取ることができなくなりました。以前にインメモリパーツを設定していた場合は、アップグレード前に削除する必要があります。[#55186](https://github.com/ClickHouse/ClickHouse/pull/55186) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- Meilisearchとの統合を削除しました。理由: 旧バージョン0.18とのみ互換性がありました。最近のバージョンのMeilisearchはプロトコルが変更され、動作しなくなりました。注: 復元にご協力いただける場合は歓迎いたします。[#55189](https://github.com/ClickHouse/ClickHouse/pull/55189) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ディレクトリモニターの概念をバックグラウンドINSERTに名称変更しました。すべての設定 `*directory_monitor*` は `distributed_background_insert*` に名称変更されました。_後方互換性は維持されます_（旧設定はエイリアスとして追加されているため）。[#55978](https://github.com/ClickHouse/ClickHouse/pull/55978) ([Azat Khuzhin](https://github.com/azat))。
- クライアント側で設定された `send_timeout` をサーバー側の `receive_timeout` として解釈しないようになり、その逆も同様です。[#56035](https://github.com/ClickHouse/ClickHouse/pull/56035) ([Azat Khuzhin](https://github.com/azat))。
- 異なる単位の時間間隔の比較は例外をスローするようになりました。これにより [#55942](https://github.com/ClickHouse/ClickHouse/issues/55942) がクローズされます。単位に関係なく基礎となる数値が比較されていた以前の動作に依存していた可能性があります。[#56090](https://github.com/ClickHouse/ClickHouse/pull/56090) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 実験的な `S3Queue` テーブルエンジンを完全に書き直しました: ZooKeeperに情報を保持する方法を変更し、ZooKeeperへのリクエストを削減できるようにしました。状態が変更されないことがわかっている場合にZooKeeper状態のキャッシュを追加し、S3からのポーリングプロセスを改善して負荷を軽減しました。追跡ファイルのTTLと最大値の維持方法を変更し、現在はバックグラウンドプロセスになっています。`system.s3queue` および `system.s3queue_log` テーブルを追加しました。[#54998](https://github.com/ClickHouse/ClickHouse/issues/54998) をクローズします。[#54422](https://github.com/ClickHouse/ClickHouse/pull/54422) ([Kseniia Sumarokova](https://github.com/kssenii))。
- HTTPエンドポイント上の任意のパスは、`/query` エンドポイントへのリクエストとして解釈されなくなりました。[#55521](https://github.com/ClickHouse/ClickHouse/pull/55521) ([Konstantin Bogdanov](https://github.com/thevar1able))。


#### 新機能 {#new-feature-2}

- 関数 `arrayFold(accumulator, x1, ..., xn -> expression, initial, array1, ..., arrayn)` を追加しました。この関数は、同じ要素数を持つ複数の配列にラムダ関数を適用し、結果をアキュムレータに収集します。[#49794](https://github.com/ClickHouse/ClickHouse/pull/49794) ([Lirikl](https://github.com/Lirikl))。
- `Npy` 形式をサポートしました。`SELECT * FROM file('example_array.npy', Npy)`。[#55982](https://github.com/ClickHouse/ClickHouse/pull/55982) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- テーブルのキーに空間充填曲線が含まれている場合(例: `ORDER BY mortonEncode(x, y)`)、その引数に対する条件(例: `x >= 10 AND x <= 20 AND y >= 20 AND y <= 30`)をインデックス作成に使用できるようになりました。この解析を有効または無効にするための設定 `analyze_index_with_space_filling_curves` が追加されました。これにより [#41195](https://github.com/ClickHouse/ClickHouse/issue/41195) が解決されます。[#4538](https://github.com/ClickHouse/ClickHouse/pull/4538) の続き。[#6286](https://github.com/ClickHouse/ClickHouse/pull/6286) の続き。[#28130](https://github.com/ClickHouse/ClickHouse/pull/28130) の続き。[#41753](https://github.com/ClickHouse/ClickHouse/pull/#41753) の続き。[#55642](https://github.com/ClickHouse/ClickHouse/pull/55642) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `force_optimize_projection_name` という新しい設定が追加されました。この設定はプロジェクション名を引数として受け取ります。値が空でない文字列に設定されている場合、ClickHouseはこのプロジェクションがクエリで少なくとも一度使用されていることを確認します。[#55331](https://github.com/ClickHouse/ClickHouse/issues/55331) が解決されます。[#56134](https://github.com/ClickHouse/ClickHouse/pull/56134) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- ネイティブプロトコル経由での外部データを使用した非同期挿入をサポートしました。以前は、データがクエリにインライン化されている場合にのみ機能していました。[#54730](https://github.com/ClickHouse/ClickHouse/pull/54730) ([Anton Popov](https://github.com/CurtizJ))。
- 可視化のためのデータダウンサンプリングに [Largest-Triangle-Three-Buckets](https://skemman.is/bitstream/1946/15343/3/SS_MSthesis.pdf) アルゴリズムを使用する集約関数 `lttb` を追加しました。[#53145](https://github.com/ClickHouse/ClickHouse/pull/53145) ([Sinan](https://github.com/sinsinan))。
- クエリ `CHECK TABLE` のパフォーマンスと使いやすさが向上しました(進行状況の更新送信、キャンセル可能)。`CHECK TABLE ... PART 'part_name'` による特定のパートのチェックをサポートしました。[#53404](https://github.com/ClickHouse/ClickHouse/pull/53404) ([vdimir](https://github.com/vdimir))。
- 関数 `jsonMergePatch` を追加しました。文字列としてJSONデータを扱う際に、これらの文字列(JSONオブジェクト)をマージして、単一のJSONオブジェクトを含む単一の文字列を形成する方法を提供します。[#54364](https://github.com/ClickHouse/ClickHouse/pull/54364) ([Memo](https://github.com/Joeywzr))。
- Kusto Query Language方言サポートの第2部。[フェーズ1の実装](https://github.com/ClickHouse/ClickHouse/pull/37961)がマージされました。[#42510](https://github.com/ClickHouse/ClickHouse/pull/42510) ([larryluogit](https://github.com/larryluogit))。
- 新しいSQL関数 `arrayRandomSample(arr, k)` を追加しました。この関数は入力配列からk個の要素のサンプルを返します。同様の機能は以前、より不便な構文(例: "SELECT arrayReduce('groupArraySample(3)', range(10))")でのみ実現できました。[#54391](https://github.com/ClickHouse/ClickHouse/pull/54391) ([itayisraelov](https://github.com/itayisraelov))。
- 最小値/最大値のみで集約できる `-ArgMin`/`-ArgMax` 集約コンビネータを導入しました。使用例は [#54818](https://github.com/ClickHouse/ClickHouse/issues/54818) で確認できます。このPRではコンビネータを専用フォルダに再編成しました。[#54947](https://github.com/ClickHouse/ClickHouse/pull/54947) ([Amos Bird](https://github.com/amosbird))。
- `SYSTEM DROP SCHEMA FORMAT CACHE [FOR Protobuf]` でProtobuf形式のキャッシュを削除できるようになりました。[#55064](https://github.com/ClickHouse/ClickHouse/pull/55064) ([Aleksandr Musorin](https://github.com/AVMusorin))。
- 外部HTTP Basic認証機能を追加しました。[#55199](https://github.com/ClickHouse/ClickHouse/pull/55199) ([Aleksei Filatov](https://github.com/aalexfvk))。
- 符号なし整数のバイトを反転する関数 `byteSwap` を追加しました。これは、IPv4のように内部的に符号なし整数として表現される型の値を反転する際に特に有用です。[#55211](https://github.com/ClickHouse/ClickHouse/pull/55211) ([Priyansh Agrawal](https://github.com/Priyansh121096))。
- SQLクエリ文字列のフォーマット版(複数行にまたがる可能性あり)を返す関数 `formatQuery` を追加しました。また、同じ処理を行いますが返される文字列に改行を含まない関数 `formatQuerySingleLine` も追加しました。[#55239](https://github.com/ClickHouse/ClickHouse/pull/55239) ([Salvatore Mesoraca](https://github.com/aiven-sal))。
- ELF実行可能ファイル/ライブラリ/オブジェクトファイルからデバッグシンボルを読み取る `DWARF` 入力形式を追加しました。[#55450](https://github.com/ClickHouse/ClickHouse/pull/55450) ([Michael Kolupaev](https://github.com/al13n321))。
- RabbitMQ、NATS、FileLogエンジンで解析されなかったレコードとエラーを保存できるようになりました。ClickHouseが新しいレコードの解析に失敗した際に入力される仮想カラム `_error` と `_raw_message`(NATSとRabbitMQ用)、`_raw_record`(FileLog用)を追加しました。この動作は、`kafka_handle_error_mode` と同様に、NATSの場合は `nats_handle_error_mode`、RabbitMQの場合は `rabbitmq_handle_error_mode`、FileLogの場合は `handle_error_mode` というストレージ設定で制御されます。`default` に設定されている場合、ClickHouseがレコードの解析に失敗すると例外がスローされます。`stream` に設定されている場合、エラーと生のレコードが仮想カラムに保存されます。[#36035](https://github.com/ClickHouse/ClickHouse/issues/36035) が解決されます。[#55477](https://github.com/ClickHouse/ClickHouse/pull/55477) ([Kruglov Pavel](https://github.com/Avogar))。
- Keeperクライアントの改善: 特定のパス配下のすべての子ノード数を返す `get_all_children_number command` を追加しました。[#55485](https://github.com/ClickHouse/ClickHouse/pull/55485) ([guoxiaolong](https://github.com/guoxiaolongzte))。
- Keeperクライアントの改善: パス配下の直接の子ノード数を返す `get_direct_children_number` コマンドを追加しました。[#55898](https://github.com/ClickHouse/ClickHouse/pull/55898) ([xuzifu666](https://github.com/xuzifu666))。
- 既存のステートメント `SHOW SETTINGS` のより簡潔なバージョンである `SHOW SETTING setting_name` ステートメントを追加しました。[#55979](https://github.com/ClickHouse/ClickHouse/pull/55979) ([Maksim Kita](https://github.com/kitaisreal))。
- `system.parts_columns` テーブルに `substreams` と `filenames` フィールドを追加しました。[#55108](https://github.com/ClickHouse/ClickHouse/pull/55108) ([Anton Popov](https://github.com/CurtizJ))。
- `SHOW MERGES` クエリのサポートを追加しました。[#55815](https://github.com/ClickHouse/ClickHouse/pull/55815) ([megao](https://github.com/jetgm))。
- デフォルトの `ORDER BY ()` のための設定 `create_table_empty_primary_key_by_default` を導入しました。[#55899](https://github.com/ClickHouse/ClickHouse/pull/55899) ([Srikanth Chekuri](https://github.com/srikanthccv))。





#### パフォーマンス改善 {#performance-improvement-2}

- ウィンドウ関数の評価後にストリーム数を保持し、並列ストリーム処理を可能にするオプション `query_plan_preserve_num_streams_after_window_functions` を追加しました。[#50771](https://github.com/ClickHouse/ClickHouse/pull/50771) ([frinkr](https://github.com/frinkr))。
- データが小さい場合により多くのストリームを解放するようにしました。[#53867](https://github.com/ClickHouse/ClickHouse/pull/53867) ([Jiebin Sun](https://github.com/jiebinn))。
- シリアライゼーション前にRoaringBitmapsを最適化するようにしました。[#55044](https://github.com/ClickHouse/ClickHouse/pull/55044) ([UnamedRus](https://github.com/UnamedRus))。
- 転置インデックスのポスティングリストが、内部ビットマップに対して可能な限り最小の表現を使用するように最適化されました。データの反復性に応じて、転置インデックスの領域消費量が大幅に削減される可能性があります。[#55069](https://github.com/ClickHouse/ClickHouse/pull/55069) ([Harry Lee](https://github.com/HarryLeeIBM))。
- Contextロックの競合を修正し、多数の短時間実行される同時クエリのパフォーマンスが大幅に向上しました。[#55121](https://github.com/ClickHouse/ClickHouse/pull/55121) ([Maksim Kita](https://github.com/kitaisreal))。
- 転置インデックスの作成パフォーマンスを30%向上させました。これは `std::unordered_map` を `absl::flat_hash_map` に置き換えることで実現されました。[#55210](https://github.com/ClickHouse/ClickHouse/pull/55210) ([Harry Lee](https://github.com/HarryLeeIBM))。
- ORCフィルタプッシュダウン(行グループレベル)をサポートしました。[#55330](https://github.com/ClickHouse/ClickHouse/pull/55330) ([李扬](https://github.com/taiyang-li))。
- 多数の一時ファイルを使用する外部集約のパフォーマンスを改善しました。[#55489](https://github.com/ClickHouse/ClickHouse/pull/55489) ([Maksim Kita](https://github.com/kitaisreal))。
- セカンダリインデックスのマークキャッシュにデフォルトで適切なサイズを設定し、マークの繰り返しロードを回避するようにしました。[#55654](https://github.com/ClickHouse/ClickHouse/pull/55654) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- スキップインデックスの読み取り時に不要なインデックスグラニュールの再構築を回避するようにしました。これにより [#55653](https://github.com/ClickHouse/ClickHouse/issues/55653#issuecomment-1763766009) に対処しました。[#55683](https://github.com/ClickHouse/ClickHouse/pull/55683) ([Amos Bird](https://github.com/amosbird))。
- 実行中にセット内のCAST関数をキャッシュし、セット要素の型がカラム型と完全に一致しない場合の `IN` 関数のパフォーマンスを向上させました。[#55712](https://github.com/ClickHouse/ClickHouse/pull/55712) ([Duc Canh Le](https://github.com/canhld94))。
- `ColumnVector::insertMany` および `ColumnVector::insertManyFrom` のパフォーマンスを改善しました。[#55714](https://github.com/ClickHouse/ClickHouse/pull/55714) ([frinkr](https://github.com/frinkr))。
- 次の行のキー位置を予測し比較を削減することで、Mapの添字操作を最適化しました。[#55929](https://github.com/ClickHouse/ClickHouse/pull/55929) ([lgbo](https://github.com/lgbo-ustc))。
- Parquetでの構造体フィールドのプルーニングをサポートしました(以前のバージョンでは一部のケースで動作しませんでした)。[#56117](https://github.com/ClickHouse/ClickHouse/pull/56117) ([lgbo](https://github.com/lgbo-ustc))。
- 読み取る行数の推定に基づいて、クエリ実行で使用される並列レプリカの数を調整する機能を追加しました。[#51692](https://github.com/ClickHouse/ClickHouse/pull/51692) ([Raúl Marín](https://github.com/Algunenano))。
- 多数の一時ファイルが生成された場合の外部集約のメモリ消費量を最適化しました。[#54798](https://github.com/ClickHouse/ClickHouse/pull/54798) ([Nikita Taranov](https://github.com/nickitat))。
- `async_socket_for_remote` モード(デフォルト)で実行される分散クエリが `max_threads` 制限を尊重するようになりました。以前は、一部のクエリが過剰なスレッド(`max_distributed_connections` まで)を作成し、サーバーのパフォーマンス問題を引き起こす可能性がありました。[#53504](https://github.com/ClickHouse/ClickHouse/pull/53504) ([filimonov](https://github.com/filimonov))。
- Zookeeper分散DDLキューからDDLを実行する際に、スキップ可能なエントリをキャッシュするようにしました。[#54828](https://github.com/ClickHouse/ClickHouse/pull/54828) ([Duc Canh Le](https://github.com/canhld94))。
- 実験的な転置インデックスは、一致が多すぎるトークン(つまりポスティングリスト内の行ID)を保存しないようになりました。これにより領域が節約され、シーケンシャルスキャンが同等以上に高速な場合に非効率的なインデックス検索を回避できます。トークンを保存しないタイミングを制御していた以前のヒューリスティック(インデックス定義に渡される `density` パラメータ)は、ユーザーにとって混乱を招くものでした。パラメータ `max_rows_per_postings_list`(デフォルト: 64k)に基づくはるかにシンプルなヒューリスティックが導入され、ポスティングリスト内の行IDの最大許容数を直接制御できるようになりました。[#55616](https://github.com/ClickHouse/ClickHouse/pull/55616) ([Harry Lee](https://github.com/HarryLeeIBM))。
- `EmbeddedRocksDB` テーブルへの書き込みパフォーマンスを改善しました。[#55732](https://github.com/ClickHouse/ClickHouse/pull/55732) ([Duc Canh Le](https://github.com/canhld94))。
- パーティション内に多数のパート(1000以上)がある場合のClickHouseの全体的な回復力を向上させました。これにより `TOO_MANY_PARTS` エラーの数が減少する可能性があります。[#55526](https://github.com/ClickHouse/ClickHouse/pull/55526) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- 階層型ディクショナリのロード時のメモリ消費量を削減しました。[#55838](https://github.com/ClickHouse/ClickHouse/pull/55838) ([Nikita Taranov](https://github.com/nickitat))。
- すべてのディクショナリが設定 `dictionary_use_async_executor` をサポートするようになりました。[#55839](https://github.com/ClickHouse/ClickHouse/pull/55839) ([vdimir](https://github.com/vdimir))。
- AggregateFunctionTopKGenericDataのデシリアライゼーション時の過剰なメモリ使用を防止しました。[#55947](https://github.com/ClickHouse/ClickHouse/pull/55947) ([Raúl Marín](https://github.com/Algunenano))。
- 多数のウォッチを持つKeeperでは、AsyncMetricsスレッドが `DB::KeeperStorage::getSessionsWithWatchesCount` で顕著な時間CPUを100%消費する可能性がありました。修正により、重い `watches` および `list_watches` セットの走査を回避するようにしました。[#56054](https://github.com/ClickHouse/ClickHouse/pull/56054) ([Alexander Gololobov](https://github.com/davenger))。
- ストレージEmbeddedRocksDBに対して `count` 近似を使用する設定 `optimize_trivial_approximate_count_query` を追加しました。StorageJoinに対して簡易カウントを有効にしました。[#55806](https://github.com/ClickHouse/ClickHouse/pull/55806) ([Duc Canh Le](https://github.com/canhld94))。





#### 改善 {#improvement-2}

- Functions `toDayOfWeek` (MySQL alias: `DAYOFWEEK`), `toYearWeek` (`YEARWEEK`) and `toWeek` (`WEEK`) now supports `String` arguments. This makes its behavior consistent with MySQL's behavior. [#55589](https://github.com/ClickHouse/ClickHouse/pull/55589) ([Robert Schulze](https://github.com/rschu1ze)).
- Introduced setting `date_time_overflow_behavior` with possible values `ignore`, `throw`, `saturate` that controls the overflow behavior when converting from Date, Date32, DateTime64, Integer or Float to Date, Date32, DateTime or DateTime64. [#55696](https://github.com/ClickHouse/ClickHouse/pull/55696) ([Andrey Zvonov](https://github.com/zvonand)).
- Implement query parameters support for `ALTER TABLE ... ACTION PARTITION [ID] {parameter_name:ParameterType}`. Merges [#49516](https://github.com/ClickHouse/ClickHouse/issues/49516). Closes [#49449](https://github.com/ClickHouse/ClickHouse/issues/49449). [#55604](https://github.com/ClickHouse/ClickHouse/pull/55604) ([alesapin](https://github.com/alesapin)).
- Print processor ids in a prettier manner in EXPLAIN. [#48852](https://github.com/ClickHouse/ClickHouse/pull/48852) ([Vlad Seliverstov](https://github.com/behebot)).
- Creating a direct dictionary with a lifetime field will be rejected at create time (as the lifetime does not make sense for direct dictionaries). Fixes: [#27861](https://github.com/ClickHouse/ClickHouse/issues/27861). [#49043](https://github.com/ClickHouse/ClickHouse/pull/49043) ([Rory Crispin](https://github.com/RoryCrispin)).
- Allow parameters in queries with partitions like `ALTER TABLE t DROP PARTITION`. Closes [#49449](https://github.com/ClickHouse/ClickHouse/issues/49449). [#49516](https://github.com/ClickHouse/ClickHouse/pull/49516) ([Nikolay Degterinsky](https://github.com/evillique)).
- Add a new column `xid` for `system.zookeeper_connection`. [#50702](https://github.com/ClickHouse/ClickHouse/pull/50702) ([helifu](https://github.com/helifu)).
- Display the correct server settings in `system.server_settings` after configuration reload. [#53774](https://github.com/ClickHouse/ClickHouse/pull/53774) ([helifu](https://github.com/helifu)).
- Add support for mathematical minus `−` character in queries, similar to `-`. [#54100](https://github.com/ClickHouse/ClickHouse/pull/54100) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Add replica groups to the experimental `Replicated` database engine. Closes [#53620](https://github.com/ClickHouse/ClickHouse/issues/53620). [#54421](https://github.com/ClickHouse/ClickHouse/pull/54421) ([Nikolay Degterinsky](https://github.com/evillique)).
- It is better to retry retriable s3 errors than totally fail the query. Set bigger value to the s3_retry_attempts by default. [#54770](https://github.com/ClickHouse/ClickHouse/pull/54770) ([Sema Checherinda](https://github.com/CheSema)).
- Add load balancing mode `hostname_levenshtein_distance`. [#54826](https://github.com/ClickHouse/ClickHouse/pull/54826) ([JackyWoo](https://github.com/JackyWoo)).
- Improve hiding secrets in logs. [#55089](https://github.com/ClickHouse/ClickHouse/pull/55089) ([Vitaly Baranov](https://github.com/vitlibar)).
- For now the projection analysis will be performed only on top of query plan. The setting `query_plan_optimize_projection` became obsolete (it was enabled by default long time ago). [#55112](https://github.com/ClickHouse/ClickHouse/pull/55112) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
- When function `untuple` is now called on a tuple with named elements and itself has an alias (e.g. `select untuple(tuple(1)::Tuple(element_alias Int)) AS untuple_alias`), then the result column name is now generated from the untuple alias and the tuple element alias (in the example: "untuple_alias.element_alias"). [#55123](https://github.com/ClickHouse/ClickHouse/pull/55123) ([garcher22](https://github.com/garcher22)).
- Added setting `describe_include_virtual_columns`, which allows to include virtual columns of table into result of `DESCRIBE` query. Added setting `describe_compact_output`. If it is set to `true`, `DESCRIBE` query returns only names and types of columns without extra information. [#55129](https://github.com/ClickHouse/ClickHouse/pull/55129) ([Anton Popov](https://github.com/CurtizJ)).
- Sometimes `OPTIMIZE` with `optimize_throw_if_noop=1` may fail with an error `unknown reason` while the real cause of it - different projections in different parts. This behavior is fixed. [#55130](https://github.com/ClickHouse/ClickHouse/pull/55130) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
- Allow to have several `MaterializedPostgreSQL` tables following the same Postgres table. By default this behaviour is not enabled (for compatibility, because it is a backward-incompatible change), but can be turned on with setting `materialized_postgresql_use_unique_replication_consumer_identifier`. Closes [#54918](https://github.com/ClickHouse/ClickHouse/issues/54918). [#55145](https://github.com/ClickHouse/ClickHouse/pull/55145) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Allow to parse negative `DateTime64` and `DateTime` with fractional part from short strings. [#55146](https://github.com/ClickHouse/ClickHouse/pull/55146) ([Andrey Zvonov](https://github.com/zvonand)).
- To improve compatibility with MySQL, 1. `information_schema.tables` now includes the new field `table_rows`, and 2. `information_schema.columns` now includes the new field `extra`. [#55215](https://github.com/ClickHouse/ClickHouse/pull/55215) ([Robert Schulze](https://github.com/rschu1ze)).
- Clickhouse-client won't show "0 rows in set" if it is zero and if exception was thrown. [#55240](https://github.com/ClickHouse/ClickHouse/pull/55240) ([Salvatore Mesoraca](https://github.com/aiven-sal)).
- Support rename table without keyword `TABLE` like `RENAME db.t1 to db.t2`. [#55373](https://github.com/ClickHouse/ClickHouse/pull/55373) ([凌涛](https://github.com/lingtaolf)).
- Add `internal_replication` to `system.clusters`. [#55377](https://github.com/ClickHouse/ClickHouse/pull/55377) ([Konstantin Morozov](https://github.com/k-morozov)).
- Select remote proxy resolver based on request protocol, add proxy feature docs and remove `DB::ProxyConfiguration::Protocol::ANY`. [#55430](https://github.com/ClickHouse/ClickHouse/pull/55430) ([Arthur Passos](https://github.com/arthurpassos)).
- Avoid retrying keeper operations on INSERT after table shutdown. [#55519](https://github.com/ClickHouse/ClickHouse/pull/55519) ([Azat Khuzhin](https://github.com/azat)).
- `SHOW COLUMNS` now correctly reports type `FixedString` as `BLOB` if setting `use_mysql_types_in_show_columns` is on. Also added two new settings, `mysql_map_string_to_text_in_show_columns` and `mysql_map_fixed_string_to_text_in_show_columns` to switch the output for types `String` and `FixedString` as `TEXT` or `BLOB`. [#55617](https://github.com/ClickHouse/ClickHouse/pull/55617) ([Serge Klochkov](https://github.com/slvrtrn)).
- During ReplicatedMergeTree tables startup clickhouse server checks set of parts for unexpected parts (exists locally, but not in zookeeper). All unexpected parts move to detached directory and instead of them server tries to restore some ancestor (covered) parts. Now server tries to restore closest ancestors instead of random covered parts. [#55645](https://github.com/ClickHouse/ClickHouse/pull/55645) ([alesapin](https://github.com/alesapin)).
- The advanced dashboard now supports draggable charts on touch devices. This closes [#54206](https://github.com/ClickHouse/ClickHouse/issues/54206). [#55649](https://github.com/ClickHouse/ClickHouse/pull/55649) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Use the default query format if declared when outputting exception with `http_write_exception_in_output_format`. [#55739](https://github.com/ClickHouse/ClickHouse/pull/55739) ([Raúl Marín](https://github.com/Algunenano)).
- Provide a better message for common MATERIALIZED VIEW pitfalls. [#55826](https://github.com/ClickHouse/ClickHouse/pull/55826) ([Raúl Marín](https://github.com/Algunenano)).
- If you dropped the current database, you will still be able to run some queries in `clickhouse-local` and switch to another database. This makes the behavior consistent with `clickhouse-client`. This closes [#55834](https://github.com/ClickHouse/ClickHouse/issues/55834). [#55853](https://github.com/ClickHouse/ClickHouse/pull/55853) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Functions `(add|subtract)(Year|Quarter|Month|Week|Day|Hour|Minute|Second|Millisecond|Microsecond|Nanosecond)` now support string-encoded date arguments, e.g. `SELECT addDays('2023-10-22', 1)`. This increases compatibility with MySQL and is needed by Tableau Online. [#55869](https://github.com/ClickHouse/ClickHouse/pull/55869) ([Robert Schulze](https://github.com/rschu1ze)).
- The setting `apply_deleted_mask` when disabled allows to read rows that where marked as deleted by lightweight DELETE queries. This is useful for debugging. [#55952](https://github.com/ClickHouse/ClickHouse/pull/55952) ([Alexander Gololobov](https://github.com/davenger)).
- Allow skipping `null` values when serailizing Tuple to json objects, which makes it possible to keep compatibility with Spark's `to_json` function, which is also useful for gluten. [#55956](https://github.com/ClickHouse/ClickHouse/pull/55956) ([李扬](https://github.com/taiyang-li)).
- Functions `(add|sub)Date` now support string-encoded date arguments, e.g. `SELECT addDate('2023-10-22 11:12:13', INTERVAL 5 MINUTE)`. The same support for string-encoded date arguments is added to the plus and minus operators, e.g. `SELECT '2023-10-23' + INTERVAL 1 DAY`. This increases compatibility with MySQL and is needed by Tableau Online. [#55960](https://github.com/ClickHouse/ClickHouse/pull/55960) ([Robert Schulze](https://github.com/rschu1ze)).
- Allow unquoted strings with CR (`\r`) in CSV format. Closes [#39930](https://github.com/ClickHouse/ClickHouse/issues/39930). [#56046](https://github.com/ClickHouse/ClickHouse/pull/56046) ([Kruglov Pavel](https://github.com/Avogar)).
- Allow to run `clickhouse-keeper` using embedded config. [#56086](https://github.com/ClickHouse/ClickHouse/pull/56086) ([Maksim Kita](https://github.com/kitaisreal)).
- Set limit of the maximum configuration value for `queued.min.messages` to avoid problem with start fetching data with Kafka. [#56121](https://github.com/ClickHouse/ClickHouse/pull/56121) ([Stas Morozov](https://github.com/r3b-fish)).
- Fixed a typo in SQL function `minSampleSizeContinous` (renamed `minSampleSizeContinuous`). Old name is preserved for backward compatibility. This closes: [#56139](https://github.com/ClickHouse/ClickHouse/issues/56139). [#56143](https://github.com/ClickHouse/ClickHouse/pull/56143) ([Dorota Szeremeta](https://github.com/orotaday)).
- Print path for broken parts on disk before shutting down the server. Before this change if a part is corrupted on disk and server cannot start, it was almost impossible to understand which part is broken. This is fixed. [#56181](https://github.com/ClickHouse/ClickHouse/pull/56181) ([Duc Canh Le](https://github.com/canhld94)).

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-2}

- Dockerのデータベースが既に初期化されている場合、以降の起動時に再度初期化する必要はありません。これにより、データベースが1000回の試行以内にロードできない場合に発生する無限コンテナ再起動の問題を解決できる可能性があります(非常に大規模なデータベースやマルチノード構成に関連)。[#50724](https://github.com/ClickHouse/ClickHouse/pull/50724) ([Alexander Nikolaev](https://github.com/AlexNik))。
- サブモジュールを含むソースコードのリソースがDarwin専用ビルドタスクで構築されます。これにより、サブモジュールをチェックアウトせずにClickHouseをビルドできます。[#51435](https://github.com/ClickHouse/ClickHouse/pull/51435) ([Ilya Yatsishin](https://github.com/qoega))。
- AVXシリーズの命令をグローバルに有効化してClickHouseをビルドする際にエラーが発生していました(これは推奨されません)。原因は、snappyが`SNAPPY_HAVE_X86_CRC32`を有効化していないためです。[#55049](https://github.com/ClickHouse/ClickHouse/pull/55049) ([monchickey](https://github.com/monchickey))。
- `clickhouse-server`パッケージからスタンドアロンの`clickhouse-keeper`を起動する際の問題を解決しました。[#55226](https://github.com/ClickHouse/ClickHouse/pull/55226) ([Mikhail f. Shiryaev](https://github.com/Felixoid))。
- テストにおいて、RabbitMQのバージョンを3.12.6に更新しました。RabbitMQテストのログ収集を改善しました。[#55424](https://github.com/ClickHouse/ClickHouse/pull/55424) ([Ilya Yatsishin](https://github.com/qoega))。
- 機能テストを修正するため、opensslとboringsslのエラーメッセージの差異を修正しました。[#55975](https://github.com/ClickHouse/ClickHouse/pull/55975) ([MeenaRenganathan22](https://github.com/MeenaRenganathan22))。
- apache datasketchesにアップストリームリポジトリを使用します。[#55787](https://github.com/ClickHouse/ClickHouse/pull/55787) ([Nikita Taranov](https://github.com/nickitat))。


#### バグ修正（公式安定版リリースにおけるユーザーに影響する不具合） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-2}

- Skip hardlinking inverted index files in mutation [#47663](https://github.com/ClickHouse/ClickHouse/pull/47663) ([cangyin](https://github.com/cangyin)).
- Fixed bug of `match` function (regex) with pattern containing alternation produces incorrect key condition. Closes #53222. [#54696](https://github.com/ClickHouse/ClickHouse/pull/54696) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- Fix 'Cannot find column' in read-in-order optimization with ARRAY JOIN [#51746](https://github.com/ClickHouse/ClickHouse/pull/51746) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
- Support missed experimental `Object(Nullable(json))` subcolumns in query. [#54052](https://github.com/ClickHouse/ClickHouse/pull/54052) ([zps](https://github.com/VanDarkholme7)).
- Re-add fix for `accurateCastOrNull` [#54629](https://github.com/ClickHouse/ClickHouse/pull/54629) ([Salvatore Mesoraca](https://github.com/aiven-sal)).
- Fix detecting `DEFAULT` for columns of a Distributed table created without AS [#55060](https://github.com/ClickHouse/ClickHouse/pull/55060) ([Vitaly Baranov](https://github.com/vitlibar)).
- Proper cleanup in case of exception in ctor of ShellCommandSource [#55103](https://github.com/ClickHouse/ClickHouse/pull/55103) ([Alexander Gololobov](https://github.com/davenger)).
- Fix deadlock in LDAP assigned role update [#55119](https://github.com/ClickHouse/ClickHouse/pull/55119) ([Julian Maicher](https://github.com/jmaicher)).
- Suppress error statistics update for internal exceptions [#55128](https://github.com/ClickHouse/ClickHouse/pull/55128) ([Robert Schulze](https://github.com/rschu1ze)).
- Fix deadlock in backups [#55132](https://github.com/ClickHouse/ClickHouse/pull/55132) ([alesapin](https://github.com/alesapin)).
- Fix storage Iceberg files retrieval [#55144](https://github.com/ClickHouse/ClickHouse/pull/55144) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Fix partition pruning of extra columns in set. [#55172](https://github.com/ClickHouse/ClickHouse/pull/55172) ([Amos Bird](https://github.com/amosbird)).
- Fix recalculation of skip indexes in ALTER UPDATE queries when table has adaptive granularity [#55202](https://github.com/ClickHouse/ClickHouse/pull/55202) ([Duc Canh Le](https://github.com/canhld94)).
- Fix for background download in fs cache [#55252](https://github.com/ClickHouse/ClickHouse/pull/55252) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Avoid possible memory leaks in compressors in case of missing buffer finalization [#55262](https://github.com/ClickHouse/ClickHouse/pull/55262) ([Azat Khuzhin](https://github.com/azat)).
- Fix functions execution over sparse columns [#55275](https://github.com/ClickHouse/ClickHouse/pull/55275) ([Azat Khuzhin](https://github.com/azat)).
- Fix incorrect merging of Nested for SELECT FINAL FROM SummingMergeTree [#55276](https://github.com/ClickHouse/ClickHouse/pull/55276) ([Azat Khuzhin](https://github.com/azat)).
- Fix bug with inability to drop detached partition in replicated merge tree on top of S3 without zero copy [#55309](https://github.com/ClickHouse/ClickHouse/pull/55309) ([alesapin](https://github.com/alesapin)).
- Fix a crash in MergeSortingPartialResultTransform (due to zero chunks after `remerge`) [#55335](https://github.com/ClickHouse/ClickHouse/pull/55335) ([Azat Khuzhin](https://github.com/azat)).
- Fix data-race in CreatingSetsTransform (on errors) due to throwing shared exception [#55338](https://github.com/ClickHouse/ClickHouse/pull/55338) ([Azat Khuzhin](https://github.com/azat)).
- Fix trash optimization (up to a certain extent) [#55353](https://github.com/ClickHouse/ClickHouse/pull/55353) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Fix leak in StorageHDFS [#55370](https://github.com/ClickHouse/ClickHouse/pull/55370) ([Azat Khuzhin](https://github.com/azat)).
- Fix parsing of arrays in cast operator [#55417](https://github.com/ClickHouse/ClickHouse/pull/55417) ([Anton Popov](https://github.com/CurtizJ)).
- Fix filtering by virtual columns with OR filter in query [#55418](https://github.com/ClickHouse/ClickHouse/pull/55418) ([Azat Khuzhin](https://github.com/azat)).
- Fix MongoDB connection issues [#55419](https://github.com/ClickHouse/ClickHouse/pull/55419) ([Nikolay Degterinsky](https://github.com/evillique)).
- Fix MySQL interface boolean representation [#55427](https://github.com/ClickHouse/ClickHouse/pull/55427) ([Serge Klochkov](https://github.com/slvrtrn)).
- Fix MySQL text protocol DateTime formatting and LowCardinality(Nullable(T)) types reporting [#55479](https://github.com/ClickHouse/ClickHouse/pull/55479) ([Serge Klochkov](https://github.com/slvrtrn)).
- Make `use_mysql_types_in_show_columns` affect only `SHOW COLUMNS` [#55481](https://github.com/ClickHouse/ClickHouse/pull/55481) ([Robert Schulze](https://github.com/rschu1ze)).
- Fix stack symbolizer parsing `DW_FORM_ref_addr` incorrectly and sometimes crashing [#55483](https://github.com/ClickHouse/ClickHouse/pull/55483) ([Michael Kolupaev](https://github.com/al13n321)).
- Destroy fiber in case of exception in cancelBefore in AsyncTaskExecutor [#55516](https://github.com/ClickHouse/ClickHouse/pull/55516) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix Query Parameters not working with custom HTTP handlers [#55521](https://github.com/ClickHouse/ClickHouse/pull/55521) ([Konstantin Bogdanov](https://github.com/thevar1able)).
- Fix checking of non handled data for Values format [#55527](https://github.com/ClickHouse/ClickHouse/pull/55527) ([Azat Khuzhin](https://github.com/azat)).
- Fix 'Invalid cursor state' in odbc interacting with MS SQL Server [#55558](https://github.com/ClickHouse/ClickHouse/pull/55558) ([vdimir](https://github.com/vdimir)).
- Fix max execution time and 'break' overflow mode [#55577](https://github.com/ClickHouse/ClickHouse/pull/55577) ([Alexander Gololobov](https://github.com/davenger)).
- Fix crash in QueryNormalizer with cyclic aliases [#55602](https://github.com/ClickHouse/ClickHouse/pull/55602) ([vdimir](https://github.com/vdimir)).
- Disable wrong optimization and add a test [#55609](https://github.com/ClickHouse/ClickHouse/pull/55609) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Merging [#52352](https://github.com/ClickHouse/ClickHouse/issues/52352) [#55621](https://github.com/ClickHouse/ClickHouse/pull/55621) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Add a test to avoid incorrect decimal sorting [#55662](https://github.com/ClickHouse/ClickHouse/pull/55662) ([Amos Bird](https://github.com/amosbird)).
- Fix progress bar for s3 and azure Cluster functions with url without globs [#55666](https://github.com/ClickHouse/ClickHouse/pull/55666) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix filtering by virtual columns with OR filter in query (resubmit) [#55678](https://github.com/ClickHouse/ClickHouse/pull/55678) ([Azat Khuzhin](https://github.com/azat)).
- Fixes and improvements for Iceberg storage [#55695](https://github.com/ClickHouse/ClickHouse/pull/55695) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix data race in CreatingSetsTransform (v2) [#55786](https://github.com/ClickHouse/ClickHouse/pull/55786) ([Azat Khuzhin](https://github.com/azat)).
- Throw exception when parsing illegal string as float if precise_float_parsing is true [#55861](https://github.com/ClickHouse/ClickHouse/pull/55861) ([李扬](https://github.com/taiyang-li)).
- Disable predicate pushdown if the CTE contains stateful functions [#55871](https://github.com/ClickHouse/ClickHouse/pull/55871) ([Raúl Marín](https://github.com/Algunenano)).
- Fix normalize ASTSelectWithUnionQuery, as it was stripping `FORMAT` from the query [#55887](https://github.com/ClickHouse/ClickHouse/pull/55887) ([flynn](https://github.com/ucasfl)).
- Try to fix possible segfault in Native ORC input format [#55891](https://github.com/ClickHouse/ClickHouse/pull/55891) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix window functions in case of sparse columns. [#55895](https://github.com/ClickHouse/ClickHouse/pull/55895) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
- fix: StorageNull supports subcolumns [#55912](https://github.com/ClickHouse/ClickHouse/pull/55912) ([FFish](https://github.com/wxybear)).
- Do not write retriable errors for Replicated mutate/merge into error log [#55944](https://github.com/ClickHouse/ClickHouse/pull/55944) ([Azat Khuzhin](https://github.com/azat)).
- Fix `SHOW DATABASES LIMIT <N>` [#55962](https://github.com/ClickHouse/ClickHouse/pull/55962) ([Raúl Marín](https://github.com/Algunenano)).
- Fix autogenerated Protobuf schema with fields with underscore [#55974](https://github.com/ClickHouse/ClickHouse/pull/55974) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix dateTime64ToSnowflake64() with non-default scale [#55983](https://github.com/ClickHouse/ClickHouse/pull/55983) ([Robert Schulze](https://github.com/rschu1ze)).
- Fix output/input of Arrow dictionary column [#55989](https://github.com/ClickHouse/ClickHouse/pull/55989) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix fetching schema from schema registry in AvroConfluent [#55991](https://github.com/ClickHouse/ClickHouse/pull/55991) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix 'Block structure mismatch' on concurrent ALTER and INSERTs in Buffer table [#55995](https://github.com/ClickHouse/ClickHouse/pull/55995) ([Michael Kolupaev](https://github.com/al13n321)).
- Fix incorrect free space accounting for least_used JBOD policy [#56030](https://github.com/ClickHouse/ClickHouse/pull/56030) ([Azat Khuzhin](https://github.com/azat)).
- Fix missing scalar issue when evaluating subqueries inside table functions [#56057](https://github.com/ClickHouse/ClickHouse/pull/56057) ([Amos Bird](https://github.com/amosbird)).
- Fix wrong query result when http_write_exception_in_output_format=1 [#56135](https://github.com/ClickHouse/ClickHouse/pull/56135) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix schema cache for fallback JSON->JSONEachRow with changed settings [#56172](https://github.com/ClickHouse/ClickHouse/pull/56172) ([Kruglov Pavel](https://github.com/Avogar)).
- Add error handler to odbc-bridge [#56185](https://github.com/ClickHouse/ClickHouse/pull/56185) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).

### <a id="239"></a> ClickHouse リリース 23.9, 2023-09-28 {#239}

#### 後方互換性のない変更 {#backward-incompatible-change-3}

- デフォルトの Prometheus ハンドラから `status_info` 設定オプションとディクショナリのステータスを削除しました。[#54090](https://github.com/ClickHouse/ClickHouse/pull/54090) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 実験的なパーツメタデータキャッシュをコードベースから削除しました。[#54215](https://github.com/ClickHouse/ClickHouse/pull/54215) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `input_format_json_try_infer_numbers_from_strings` 設定をデフォルトで無効化しました。これにより、サンプルデータに数値のように見える文字列が含まれている場合に発生する可能性のある解析エラーを回避するため、JSON 形式において文字列から数値を推測しないようになります。[#55099](https://github.com/ClickHouse/ClickHouse/pull/55099) ([Kruglov Pavel](https://github.com/Avogar))。


#### 新機能 {#new-feature-3}

- JSON形式からのスキーマ推論を改善: 1) `input_format_json_try_infer_named_tuples_from_objects`設定により、JSON形式において実験的なJSON型を使用せずにJSONオブジェクトから名前付きTupleを推論できるようになりました。以前は実験的なJSON型なしではJSONオブジェクトをStringまたはMapとしてのみ推論できましたが、現在は名前付きTupleを推論できます。結果として得られるTuple型には、スキーマ推論中にデータサンプルで読み取られたオブジェクトのすべてのキーが含まれます。これは、疎なオブジェクトを含まない構造化されたJSONデータを読み取る際に有用です。この設定はデフォルトで有効になっています。2) `input_format_json_read_arrays_as_strings`設定により、JSON配列をString型のカラムに解析できるようになりました。これは、異なる型の値を持つ配列を読み取る際に役立ちます。3) `input_format_json_infer_incomplete_types_as_strings`設定により、サンプルデータ内の不明な型(`null`/`[]`/`{}`)を持つJSONキーにString型を使用できるようになりました。現在、JSON形式では任意の値をStringカラムに読み取ることができ、不明な型にString型を使用することで、スキーマ推論中に`Cannot determine type for column 'column_name' by first 25000 rows of data, most likely this column contains only Nulls or empty Arrays/Maps`というエラーを回避でき、データが正常に読み取られます。[#54427](https://github.com/ClickHouse/ClickHouse/pull/54427) ([Kruglov Pavel](https://github.com/Avogar))。
- リモートディスクのIOスケジューリングサポートを追加しました。ディスクタイプ`s3`、`s3_plain`、`hdfs`、`azure_blob_storage`のストレージ設定に、リソース名を保持する`read_resource`および`write_resource`要素を含めることができるようになりました。これらのリソースのスケジューリングポリシーは、別のサーバー設定セクション`resources`で設定できます。クエリは`workload`設定を使用してマークし、サーバー設定セクション`workload_classifiers`を使用して分類することで、多様なリソーススケジューリング目標を達成できます。詳細は[ドキュメント](/operations/workload-scheduling)を参照してください。[#47009](https://github.com/ClickHouse/ClickHouse/pull/47009) ([Sergei Trifonov](https://github.com/serxa))。「bandwidth_limit」IOスケジューリングノードタイプを追加しました。このノードを通過するトラフィックに対して`max_speed`および`max_burst`制約を指定できます。[#54618](https://github.com/ClickHouse/ClickHouse/pull/54618) ([Sergei Trifonov](https://github.com/serxa))。
- SSHキーに基づく新しい認証タイプを追加しました。これはネイティブTCPプロトコルでのみ機能します。[#41109](https://github.com/ClickHouse/ClickHouse/pull/41109) ([George Gamezardashvili](https://github.com/InfJoker))。
- MergeTreeテーブルに新しいカラム`_block_number`を追加しました。[#44532](https://github.com/ClickHouse/ClickHouse/issues/44532)。[#47532](https://github.com/ClickHouse/ClickHouse/pull/47532) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
- `DROP TABLE`クエリに`IF EMPTY`句を追加しました。[#48915](https://github.com/ClickHouse/ClickHouse/pull/48915) ([Pavel Novitskiy](https://github.com/pnovitskiy))。
- SQL関数`toString(datetime, timezone)`および`formatDateTime(datetime, format, timezone)`が、非定数のタイムゾーン引数をサポートするようになりました。[#53680](https://github.com/ClickHouse/ClickHouse/pull/53680) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- `ALTER TABLE MODIFY COMMENT`のサポートを追加しました。注意: 類似の機能が以前に外部コントリビューターによって追加されましたが、その機能はまったく動作せず、ユーザーを混乱させるだけでした。これにより[#36377](https://github.com/ClickHouse/ClickHouse/issues/36377)が解決されます。[#51304](https://github.com/ClickHouse/ClickHouse/pull/51304) ([Alexey Milovidov](https://github.com/alexey-milovidov))。注意: このコマンドはレプリカ間で伝播されないため、テーブルのレプリカは異なるコメントを持つ可能性があります。
- 新しいデータ圧縮コーデックとして`GCD`(最大公約数)を追加しました。このコーデックはすべてのカラム値のGCDを計算し、各値をGCDで除算します。GCDコーデックはデータ準備コーデック(DeltaやDoubleDeltaと同様)であり、単独では使用できません。整数、小数、日付/時刻型のデータで動作します。GCDコーデックの実用的な使用例は、GCDの倍数で変化(増加/減少)するカラム値です。例: 24 - 28 - 16 - 24 - 8 - 24(GCD = 4と仮定)。[#53149](https://github.com/ClickHouse/ClickHouse/pull/53149) ([Alexander Nam](https://github.com/seshWCS))。
- 2つの新しい型エイリアス`DECIMAL(P)`(`DECIMAL(P, 0)`のショートカット)および`DECIMAL`(`DECIMAL(10, 0)`のショートカット)を追加しました。これによりClickHouseはMySQLのSQL方言とより互換性が高くなります。[#53328](https://github.com/ClickHouse/ClickHouse/pull/53328) ([Val Doroshchuk](https://github.com/valbok))。
- すべての`BACKUP`および`RESTORE`操作を追跡するための新しいシステムログテーブル`backup_log`を追加しました。[#53638](https://github.com/ClickHouse/ClickHouse/pull/53638) ([Victor Krasnov](https://github.com/sirvickr))。
- フォーマット設定`output_format_markdown_escape_special_characters`(デフォルト: false)を追加しました。この設定は、`Markdown`出力フォーマットにおいて`!`、`#`、`$`などの特殊文字をエスケープする(つまりバックスラッシュで接頭辞を付ける)かどうかを制御します。[#53860](https://github.com/ClickHouse/ClickHouse/pull/53860) ([irenjj](https://github.com/irenjj))。
- 関数`decodeHTMLComponent`を追加しました。[#54097](https://github.com/ClickHouse/ClickHouse/pull/54097) ([Bharat Nallan](https://github.com/bharatnc))。
- query_logテーブルに`peak_threads_usage`を追加しました。[#54335](https://github.com/ClickHouse/ClickHouse/pull/54335) ([Alexey Gerasimchuck](https://github.com/Demilivor))。
- clickhouse-clientに`SHOW FUNCTIONS`サポートを追加しました。[#54337](https://github.com/ClickHouse/ClickHouse/pull/54337) ([Julia Kartseva](https://github.com/wat-ze-hex))。
- エイリアス`TO_DAYS`(MySQLとの互換性のため)を持つ関数`toDaysSinceYearZero`を追加しました。この関数は`0001-01-01`(先発グレゴリオ暦)からの経過日数を返します。[#54479](https://github.com/ClickHouse/ClickHouse/pull/54479) ([Robert Schulze](https://github.com/rschu1ze))。関数`toDaysSinceYearZero`が`DateTime`および`DateTime64`型の引数をサポートするようになりました。[#54856](https://github.com/ClickHouse/ClickHouse/pull/54856) ([Serge Klochkov](https://github.com/slvrtrn))。
- 関数`YYYYMMDDtoDate`、`YYYYMMDDtoDate32`、`YYYYMMDDhhmmssToDateTime`、`YYYYMMDDhhmmssToDateTime64`を追加しました。これらは整数としてエンコードされた日付または日時(例: 20230911)をネイティブの日付または日時に変換します。そのため、既存の関数`YYYYMMDDToDate`、`YYYYMMDDToDateTime`、`YYYYMMDDhhmmddToDateTime`、`YYYYMMDDhhmmddToDateTime64`の逆の機能を提供します。[#54509](https://github.com/ClickHouse/ClickHouse/pull/54509) ([Quanfa Fu](https://github.com/dentiscalprum)) ([Robert Schulze](https://github.com/rschu1ze))。
- `byteHammingDistance`、`editDistance`を含む複数の文字列距離関数を追加しました。[#54935](https://github.com/ClickHouse/ClickHouse/pull/54935) ([flynn](https://github.com/ucasfl))。
- `VALID UNTIL datetime`句を使用して、ユーザー資格情報の有効期限日と、オプションで時刻を指定できるようになりました。[#51261](https://github.com/ClickHouse/ClickHouse/pull/51261) ([Nikolay Degterinsky](https://github.com/evillique))。
- テーブル関数`s3`、`gcs`、`oss`でS3スタイルのURLを使用できるようになりました。URLは自動的にHTTPに変換されます。例: `'s3://clickhouse-public-datasets/hits.csv'`は`'https://clickhouse-public-datasets.s3.amazonaws.com/hits.csv'`に変換されます。[#54931](https://github.com/ClickHouse/ClickHouse/pull/54931) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- Tuple/Maps/Arraysのような深くネストされた型を見やすく表示するための新しい設定`print_pretty_type_names`を追加しました。[#55095](https://github.com/ClickHouse/ClickHouse/pull/55095) ([Kruglov Pavel](https://github.com/Avogar))。





#### パフォーマンス改善 {#performance-improvement-3}

- デフォルトでプリフェッチを有効にすることで、S3からの読み取りを高速化しました。[#53709](https://github.com/ClickHouse/ClickHouse/pull/53709) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- FINALを使用するクエリで不要な場合、孤立したパートでPKおよびバージョン列を暗黙的に読み取らないようにしました。[#53919](https://github.com/ClickHouse/ClickHouse/pull/53919) ([Duc Canh Le](https://github.com/canhld94))。
- 定数キーによるグループ化を最適化しました。https://github.com/ClickHouse/ClickHouse/pull/53529 以降、`_file/_path`によるグループ化を使用するクエリが最適化されます。[#53549](https://github.com/ClickHouse/ClickHouse/pull/53549) ([Kruglov Pavel](https://github.com/Avogar))。
- `Decimal`列のソートパフォーマンスを改善しました。ORDER BYに`Decimal`列が含まれる場合の`MergeTree`への挿入パフォーマンスを改善しました。データが既にソート済みまたはほぼソート済みの場合のソートパフォーマンスを改善しました。[#35961](https://github.com/ClickHouse/ClickHouse/pull/35961) ([Maksim Kita](https://github.com/kitaisreal))。
- 大規模なクエリ解析のパフォーマンスを改善しました。[#51224](https://github.com/ClickHouse/ClickHouse/issues/51224)を修正しました。[#51469](https://github.com/ClickHouse/ClickHouse/pull/51469) ([frinkr](https://github.com/frinkr))。
- GROUP BYを含むサブクエリから選択される場合、`COUNT(DISTINCT ...)`および各種`uniq`バリアントを`count`に書き換える最適化を実装しました。[#52082](https://github.com/ClickHouse/ClickHouse/pull/52082) [#52645](https://github.com/ClickHouse/ClickHouse/pull/52645) ([JackyWoo](https://github.com/JackyWoo))。
- `mmap/mremap/munmap`への手動呼び出しを削除し、すべての処理を`jemalloc`に委譲することで、パフォーマンスがわずかに向上しました。[#52792](https://github.com/ClickHouse/ClickHouse/pull/52792) ([Nikita Taranov](https://github.com/nickitat))。
- NATSを使用する際の高いCPU消費を修正しました。[#54399](https://github.com/ClickHouse/ClickHouse/pull/54399) ([Vasilev Pyotr](https://github.com/vahpetr))。
- datetime引数を使用した`toString`の実行に個別の命令を使用しているため、非datetime引数のパフォーマンスをわずかに改善し、コードの一部をよりクリーンにすることができました。[#53680](https://github.com/ClickHouse/ClickHouse/issues/53680)のフォローアップです。[#54443](https://github.com/ClickHouse/ClickHouse/pull/54443) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- json要素を`std::stringstream`にシリアライズする代わりに、このPRではシリアライズ結果を`ColumnString`に直接格納するようにしました。[#54613](https://github.com/ClickHouse/ClickHouse/pull/54613) ([lgbo](https://github.com/lgbo-ustc))。
- テーブルがビューの背後にある場合に、MergeTreeテーブルから対応する順序でデータを読み取るためのORDER BY最適化を有効にしました。[#54628](https://github.com/ClickHouse/ClickHouse/pull/54628) ([Vitaly Baranov](https://github.com/vitlibar))。
- `GeneratorJSONPath`を再利用し、複数の共有ポインタを削除することで、JSON SQL関数を改善しました。[#54735](https://github.com/ClickHouse/ClickHouse/pull/54735) ([lgbo](https://github.com/lgbo-ustc))。
- Keeperはパフォーマンス向上のためにフラッシュリクエストをバッチ処理するようにしました。[#53049](https://github.com/ClickHouse/ClickHouse/pull/53049) ([Antonio Andelic](https://github.com/antonio2368))。
- `INFILE 'glob_expression'`の場合、`clickhouse-client`がファイルを並列処理するようになりました。[#54218](https://github.com/ClickHouse/ClickHouse/issues/54218)をクローズしました。[#54533](https://github.com/ClickHouse/ClickHouse/pull/54533) ([Max K.](https://github.com/mkaynov))。
- 主キー列の型が`IN`関数の右辺の列型と異なる場合でも、IN関数で主キーを使用できるようにしました。例: `SELECT id FROM test_table WHERE id IN (SELECT '5')`。[#48936](https://github.com/ClickHouse/ClickHouse/issues/48936)をクローズしました。[#54544](https://github.com/ClickHouse/ClickHouse/pull/54544) ([Maksim Kita](https://github.com/kitaisreal))。
- Hash JOINは、利用可能な最大メモリ(`max_bytes_in_join`で設定)の半分を消費する内部バッファを縮小するようにしました。[#54584](https://github.com/ClickHouse/ClickHouse/pull/54584) ([vdimir](https://github.com/vdimir))。
- OOMの可能性を回避するため、array joinで`max_block_size`を尊重するようにしました。[#54290](https://github.com/ClickHouse/ClickHouse/issues/54290)をクローズしました。[#54664](https://github.com/ClickHouse/ClickHouse/pull/54664) ([李扬](https://github.com/taiyang-li))。
- `s3`テーブル関数でHTTP接続を再利用するようにしました。[#54812](https://github.com/ClickHouse/ClickHouse/pull/54812) ([Michael Kolupaev](https://github.com/al13n321))。
- `MergeTreeRangeReader::Stream::ceilRowsToCompleteGranules`の線形探索を二分探索に置き換えました。[#54869](https://github.com/ClickHouse/ClickHouse/pull/54869) ([usurai](https://github.com/usurai))。

#### 実験的機能 {#experimental-feature}

- `Annoy`インデックスの作成を、設定`max_threads_for_annoy_index_creation`を使用して並列化できるようになりました。[#54047](https://github.com/ClickHouse/ClickHouse/pull/54047) ([Robert Schulze](https://github.com/rschu1ze)).
- 分散テーブル上の並列レプリカが、すべてのレプリカから読み取りを行わないようになりました [#54199](https://github.com/ClickHouse/ClickHouse/pull/54199) ([Igor Nikonov](https://github.com/devcrafter)).


#### 改善 {#improvement-3}

- Allow to replace long names of files of columns in `MergeTree` data parts to hashes of names. It helps to avoid `File name too long` error in some cases. [#50612](https://github.com/ClickHouse/ClickHouse/pull/50612) ([Anton Popov](https://github.com/CurtizJ)).
- Parse data in `JSON` format as `JSONEachRow` if failed to parse metadata. It will allow to read files with `.json` extension even if real format is JSONEachRow. Closes [#45740](https://github.com/ClickHouse/ClickHouse/issues/45740). [#54405](https://github.com/ClickHouse/ClickHouse/pull/54405) ([Kruglov Pavel](https://github.com/Avogar)).
- Output valid JSON/XML on excetpion during HTTP query execution. Add setting `http_write_exception_in_output_format` to enable/disable this behaviour (enabled by default). [#52853](https://github.com/ClickHouse/ClickHouse/pull/52853) ([Kruglov Pavel](https://github.com/Avogar)).
- View `information_schema.tables` now has a new field `data_length` which shows the approximate size of the data on disk. Required to run queries generated by Amazon QuickSight. [#55037](https://github.com/ClickHouse/ClickHouse/pull/55037) ([Robert Schulze](https://github.com/rschu1ze)).
- The MySQL interface gained a minimal implementation of prepared statements, just enough to allow a connection from Tableau Online to ClickHouse via the MySQL connector. [#54115](https://github.com/ClickHouse/ClickHouse/pull/54115) ([Serge Klochkov](https://github.com/slvrtrn)). Please note: the prepared statements implementation is pretty minimal, we do not support arguments binding yet, it is not required in this particular Tableau online use case. It will be implemented as a follow-up if necessary after extensive testing of Tableau Online in case we discover issues.
- Support case-insensitive and dot-all matching modes in `regexp_tree` dictionaries. [#50906](https://github.com/ClickHouse/ClickHouse/pull/50906) ([Johann Gan](https://github.com/johanngan)).
- Keeper improvement: Add a `createIfNotExists` Keeper command. [#48855](https://github.com/ClickHouse/ClickHouse/pull/48855) ([Konstantin Bogdanov](https://github.com/thevar1able)).
- More precise integer type inference, fix [#51236](https://github.com/ClickHouse/ClickHouse/issues/51236). [#53003](https://github.com/ClickHouse/ClickHouse/pull/53003) ([Chen768959](https://github.com/Chen768959)).
- Introduced resolving of charsets in the string literals for MaterializedMySQL. [#53220](https://github.com/ClickHouse/ClickHouse/pull/53220) ([Val Doroshchuk](https://github.com/valbok)).
- Fix a subtle issue with a rarely used `EmbeddedRocksDB` table engine in an extremely rare scenario: sometimes the `EmbeddedRocksDB` table engine does not close files correctly in NFS after running `DROP TABLE`. [#53502](https://github.com/ClickHouse/ClickHouse/pull/53502) ([Mingliang Pan](https://github.com/liangliangpan)).
- `RESTORE TABLE ON CLUSTER` must create replicated tables with a matching UUID on hosts. Otherwise the macro `{uuid}` in ZooKeeper path can't work correctly after RESTORE. This PR implements that. [#53765](https://github.com/ClickHouse/ClickHouse/pull/53765) ([Vitaly Baranov](https://github.com/vitlibar)).
- Added restore setting `restore_broken_parts_as_detached`: if it's true the RESTORE process won't stop on broken parts while restoring, instead all the broken parts will be copied to the `detached` folder with the prefix `broken-from-backup'. If it's false the RESTORE process will stop on the first broken part (if any). The default value is false. [#53877](https://github.com/ClickHouse/ClickHouse/pull/53877) ([Vitaly Baranov](https://github.com/vitlibar)).
- Add `elapsed_ns` field to HTTP headers X-ClickHouse-Progress and X-ClickHouse-Summary. [#54179](https://github.com/ClickHouse/ClickHouse/pull/54179) ([joelynch](https://github.com/joelynch)).
- Implementation of `reconfig` (https://github.com/ClickHouse/ClickHouse/pull/49450), `sync`, and `exists` commands for keeper-client. [#54201](https://github.com/ClickHouse/ClickHouse/pull/54201) ([pufit](https://github.com/pufit)).
- `clickhouse-local` and `clickhouse-client` now allow to specify the `--query` parameter multiple times, e.g. `./clickhouse-client --query "SELECT 1" --query "SELECT 2"`. This syntax is slightly more intuitive than `./clickhouse-client --multiquery "SELECT  1;S ELECT 2"`, a bit easier to script (e.g. `queries.push_back('--query "$q"')`) and more consistent with the behavior of existing parameter `--queries-file` (e.g. `./clickhouse client --queries-file queries1.sql --queries-file queries2.sql`). [#54249](https://github.com/ClickHouse/ClickHouse/pull/54249) ([Robert Schulze](https://github.com/rschu1ze)).
- Add sub-second precision to `formatReadableTimeDelta`. [#54250](https://github.com/ClickHouse/ClickHouse/pull/54250) ([Andrey Zvonov](https://github.com/zvonand)).
- Enable `allow_remove_stale_moving_parts` by default. [#54260](https://github.com/ClickHouse/ClickHouse/pull/54260) ([vdimir](https://github.com/vdimir)).
- Fix using count from cache and improve progress bar for reading from archives. [#54271](https://github.com/ClickHouse/ClickHouse/pull/54271) ([Kruglov Pavel](https://github.com/Avogar)).
- Add support for S3 credentials using SSO. To define a profile to be used with SSO, set `AWS_PROFILE` environment variable. [#54347](https://github.com/ClickHouse/ClickHouse/pull/54347) ([Antonio Andelic](https://github.com/antonio2368)).
- Support NULL as default for nested types Array/Tuple/Map for input formats. Closes [#51100](https://github.com/ClickHouse/ClickHouse/issues/51100). [#54351](https://github.com/ClickHouse/ClickHouse/pull/54351) ([Kruglov Pavel](https://github.com/Avogar)).
- Allow reading some unusual configuration of chunks from Arrow/Parquet formats. [#54370](https://github.com/ClickHouse/ClickHouse/pull/54370) ([Arthur Passos](https://github.com/arthurpassos)).
- Add `STD` alias to `stddevPop` function for MySQL compatibility. Closes [#54274](https://github.com/ClickHouse/ClickHouse/issues/54274). [#54382](https://github.com/ClickHouse/ClickHouse/pull/54382) ([Nikolay Degterinsky](https://github.com/evillique)).
- Add `addDate` function for compatibility with MySQL and `subDate` for consistency. Reference [#54275](https://github.com/ClickHouse/ClickHouse/issues/54275). [#54400](https://github.com/ClickHouse/ClickHouse/pull/54400) ([Nikolay Degterinsky](https://github.com/evillique)).
- Add `modification_time` into `system.detached_parts`. [#54506](https://github.com/ClickHouse/ClickHouse/pull/54506) ([Azat Khuzhin](https://github.com/azat)).
- Added a setting `splitby_max_substrings_includes_remaining_string` which controls if functions "splitBy\*()" with argument "max_substring" > 0 include the remaining string (if any) in the result array (Python/Spark semantics) or not. The default behavior does not change. [#54518](https://github.com/ClickHouse/ClickHouse/pull/54518) ([Robert Schulze](https://github.com/rschu1ze)).
- Better integer types inference for `Int64`/`UInt64` fields. Continuation of [#53003](https://github.com/ClickHouse/ClickHouse/pull/53003). Now it works also for nested types like Arrays of Arrays and for functions like `map/tuple`. Issue: [#51236](https://github.com/ClickHouse/ClickHouse/issues/51236). [#54553](https://github.com/ClickHouse/ClickHouse/pull/54553) ([Kruglov Pavel](https://github.com/Avogar)).
- Added array operations for multiplying, dividing and modulo on scalar. Works in each way, for example `5 * [5, 5]` and `[5, 5] * 5` - both cases are possible. [#54608](https://github.com/ClickHouse/ClickHouse/pull/54608) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
- Add optional `version` argument to `rm` command in `keeper-client` to support safer deletes. [#54708](https://github.com/ClickHouse/ClickHouse/pull/54708) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
- Disable killing the server by systemd (that may lead to data loss when using Buffer tables). [#54744](https://github.com/ClickHouse/ClickHouse/pull/54744) ([Azat Khuzhin](https://github.com/azat)).
- Added field `is_deterministic` to system table `system.functions` which indicates whether the result of a function is stable between two invocations (given exactly the same inputs) or not. [#54766](https://github.com/ClickHouse/ClickHouse/pull/54766) [#55035](https://github.com/ClickHouse/ClickHouse/pull/55035) ([Robert Schulze](https://github.com/rschu1ze)).
- Made the views in schema `information_schema` more compatible with the equivalent views in MySQL (i.e. modified and extended them) up to a point where Tableau Online is able to connect to ClickHouse. More specifically: 1. The type of field `information_schema.tables.table_type` changed from Enum8 to String. 2. Added fields `table_comment` and `table_collation` to view `information_schema.table`. 3. Added views `information_schema.key_column_usage` and `referential_constraints`. 4. Replaced uppercase aliases in `information_schema` views with concrete uppercase columns. [#54773](https://github.com/ClickHouse/ClickHouse/pull/54773) ([Serge Klochkov](https://github.com/slvrtrn)).
- The query cache now returns an error if the user tries to cache the result of a query with a non-deterministic function such as `now`, `randomString` and `dictGet`. Compared to the previous behavior (silently don't cache the result), this reduces confusion and surprise for users. [#54801](https://github.com/ClickHouse/ClickHouse/pull/54801) ([Robert Schulze](https://github.com/rschu1ze)).
- Forbid special columns like materialized/ephemeral/alias for `file`/`s3`/`url`/... storages, fix insert into ephemeral columns from files. Closes [#53477](https://github.com/ClickHouse/ClickHouse/issues/53477). [#54803](https://github.com/ClickHouse/ClickHouse/pull/54803) ([Kruglov Pavel](https://github.com/Avogar)).
- More configurable collecting metadata for backup. [#54804](https://github.com/ClickHouse/ClickHouse/pull/54804) ([Vitaly Baranov](https://github.com/vitlibar)).
- `clickhouse-local`'s log file (if enabled with --server_logs_file flag) will now prefix each line with timestamp, thread id, etc, just like `clickhouse-server`. [#54807](https://github.com/ClickHouse/ClickHouse/pull/54807) ([Michael Kolupaev](https://github.com/al13n321)).
- Field `is_obsolete` in the `system.merge_tree_settings` table - it is now 1 for obsolete merge tree settings. Previously, only the description indicated that the setting is obsolete. [#54837](https://github.com/ClickHouse/ClickHouse/pull/54837) ([Robert Schulze](https://github.com/rschu1ze)).
- Make it possible to use plural when using interval literals. `INTERVAL 2 HOURS` should be equivalent to `INTERVAL 2 HOUR`. [#54860](https://github.com/ClickHouse/ClickHouse/pull/54860) ([Jordi Villar](https://github.com/jrdi)).
- Always allow the creation of a projection with `Nullable` PK. This fixes [#54814](https://github.com/ClickHouse/ClickHouse/issues/54814). [#54895](https://github.com/ClickHouse/ClickHouse/pull/54895) ([Amos Bird](https://github.com/amosbird)).
- Retry backup's S3 operations after connection reset failure. [#54900](https://github.com/ClickHouse/ClickHouse/pull/54900) ([Vitaly Baranov](https://github.com/vitlibar)).
- Make the exception message exact in case of the maximum value of a settings is less than the minimum value. [#54925](https://github.com/ClickHouse/ClickHouse/pull/54925) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
- `LIKE`, `match`, and other regular expressions matching functions now allow matching with patterns containing non-UTF-8 substrings by falling back to binary matching. Example: you can use `string LIKE '\xFE\xFF%'` to detect BOM. This closes [#54486](https://github.com/ClickHouse/ClickHouse/issues/54486). [#54942](https://github.com/ClickHouse/ClickHouse/pull/54942) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Added `ContextLockWaitMicroseconds` profile event. [#55029](https://github.com/ClickHouse/ClickHouse/pull/55029) ([Maksim Kita](https://github.com/kitaisreal)).
- The Keeper dynamically adjusts log levels. [#50372](https://github.com/ClickHouse/ClickHouse/pull/50372) ([helifu](https://github.com/helifu)).
- Added function `timestamp` for compatibility with MySQL. Closes [#54275](https://github.com/ClickHouse/ClickHouse/issues/54275). [#54639](https://github.com/ClickHouse/ClickHouse/pull/54639) ([Nikolay Degterinsky](https://github.com/evillique)).

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-3}

- ClickHouseの公式ビルドおよび継続的インテグレーションビルドのコンパイラをClang 16から17にバージョンアップしました。[#53831](https://github.com/ClickHouse/ClickHouse/pull/53831) ([Robert Schulze](https://github.com/rschu1ze))。
- ルックアップ用のTLDデータ(`tldLookup.generated.cpp`)を再生成しました。[#54269](https://github.com/ClickHouse/ClickHouse/pull/54269) ([Bharat Nallan](https://github.com/bharatnc))。
- 冗長な`clickhouse-keeper-client`シンボリックリンクを削除しました。[#54587](https://github.com/ClickHouse/ClickHouse/pull/54587) ([Tomas Barton](https://github.com/deric))。
- bashの解決に`/usr/bin/env`を使用するようにしました。これによりNix OSをサポートします。[#54603](https://github.com/ClickHouse/ClickHouse/pull/54603) ([Fionera](https://github.com/fionera))。
- CMakeに、DWARFコールグラフを使用せずに`perf record`を実行するために必要な`PROFILE_CPU`オプションを追加しました。[#54917](https://github.com/ClickHouse/ClickHouse/pull/54917) ([Maksim Kita](https://github.com/kitaisreal))。
- リンカーがLLD以外の場合、致命的エラーで停止するようにしました。[#55036](https://github.com/ClickHouse/ClickHouse/pull/55036) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- base64値を処理(エンコード/デコード)するライブラリをTurbo-Base64からaklomp-base64に置き換えました。両方ともx86とARMでSIMDアクセラレーションされていますが、1. 後者のライセンス(BSD-2)がClickHouseにとってより好ましく、Turbo64はその後GPL-3に切り替わりました、2. GitHubスター数が多いaklomp-base64の方が将来性があると思われます、3. aklomp-base64はやや優れたAPI(主観的ではありますが)を持っています、4. aklomp-base64ではバグ(スレッドセーフでない初期化など)を回避するためのハックが不要です。注意: aklomp-base64はパディングなしのbase64値を拒否しますが、Turbo-Base64はベストエフォートベースでデコードします。RFC-4648ではパディングが必須かどうかは明示されていませんが、コンテキストによってはこれが認識すべき動作変更となる可能性があります。[#54119](https://github.com/ClickHouse/ClickHouse/pull/54119) ([Mikhail Koviazin](https://github.com/mkmkme))。


#### バグ修正（公式安定版リリースにおけるユーザーに影響する不具合） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-3}

- Fix REPLACE/MOVE PARTITION with zero-copy replication (note: "zero-copy replication" is an experimental feature) [#54193](https://github.com/ClickHouse/ClickHouse/pull/54193) ([Alexander Tokmakov](https://github.com/tavplubix)).
- Fix zero copy locks with hardlinks (note: "zero-copy replication" is an experimental feature) [#54859](https://github.com/ClickHouse/ClickHouse/pull/54859) ([Alexander Tokmakov](https://github.com/tavplubix)).
- Fix zero copy garbage (note: "zero-copy replication" is an experimental feature) [#54550](https://github.com/ClickHouse/ClickHouse/pull/54550) ([Alexander Tokmakov](https://github.com/tavplubix)).
- Pass HTTP retry timeout as milliseconds (it was incorrect before). [#54438](https://github.com/ClickHouse/ClickHouse/pull/54438) ([Duc Canh Le](https://github.com/canhld94)).
- Fix misleading error message in OUTFILE with `CapnProto`/`Protobuf` [#52870](https://github.com/ClickHouse/ClickHouse/pull/52870) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix summary reporting with parallel replicas with LIMIT [#53050](https://github.com/ClickHouse/ClickHouse/pull/53050) ([Raúl Marín](https://github.com/Algunenano)).
- Fix throttling of BACKUPs from/to S3 (in case native copy was not used) and in some other places as well [#53336](https://github.com/ClickHouse/ClickHouse/pull/53336) ([Azat Khuzhin](https://github.com/azat)).
- Fix IO throttling during copying whole directories [#53338](https://github.com/ClickHouse/ClickHouse/pull/53338) ([Azat Khuzhin](https://github.com/azat)).
- Fix: moved to prewhere condition actions can lose column [#53492](https://github.com/ClickHouse/ClickHouse/pull/53492) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- Fixed internal error when replacing with byte-equal parts [#53735](https://github.com/ClickHouse/ClickHouse/pull/53735) ([Pedro Riera](https://github.com/priera)).
- Fix: require columns participating in interpolate expression [#53754](https://github.com/ClickHouse/ClickHouse/pull/53754) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- Fix cluster discovery initialization + setting up fail points in config [#54113](https://github.com/ClickHouse/ClickHouse/pull/54113) ([vdimir](https://github.com/vdimir)).
- Fix issues in `accurateCastOrNull` [#54136](https://github.com/ClickHouse/ClickHouse/pull/54136) ([Salvatore Mesoraca](https://github.com/aiven-sal)).
- Fix nullable primary key with the FINAL modifier [#54164](https://github.com/ClickHouse/ClickHouse/pull/54164) ([Amos Bird](https://github.com/amosbird)).
- Fixed error that prevented insertion in replicated materialized view of new data in presence of duplicated data. [#54184](https://github.com/ClickHouse/ClickHouse/pull/54184) ([Pedro Riera](https://github.com/priera)).
- Fix: allow `IPv6` for bloom filter [#54200](https://github.com/ClickHouse/ClickHouse/pull/54200) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- fix possible type mismatch with `IPv4` [#54212](https://github.com/ClickHouse/ClickHouse/pull/54212) ([Bharat Nallan](https://github.com/bharatnc)).
- Fix `system.data_skipping_indices` for recreated indices [#54225](https://github.com/ClickHouse/ClickHouse/pull/54225) ([Artur Malchanau](https://github.com/Hexta)).
- fix name clash for multiple join rewriter v2 [#54240](https://github.com/ClickHouse/ClickHouse/pull/54240) ([Tao Wang](https://github.com/wangtZJU)).
- Fix unexpected errors in `system.errors` after join [#54306](https://github.com/ClickHouse/ClickHouse/pull/54306) ([vdimir](https://github.com/vdimir)).
- Fix `isZeroOrNull(NULL)` [#54316](https://github.com/ClickHouse/ClickHouse/pull/54316) ([flynn](https://github.com/ucasfl)).
- Fix: parallel replicas over distributed with `prefer_localhost_replica` = 1 [#54334](https://github.com/ClickHouse/ClickHouse/pull/54334) ([Igor Nikonov](https://github.com/devcrafter)).
- Fix logical error in vertical merge + replacing merge tree + optimize cleanup [#54368](https://github.com/ClickHouse/ClickHouse/pull/54368) ([alesapin](https://github.com/alesapin)).
- Fix possible error `URI contains invalid characters` in the `s3` table function [#54373](https://github.com/ClickHouse/ClickHouse/pull/54373) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix segfault in AST optimization of `arrayExists` function [#54379](https://github.com/ClickHouse/ClickHouse/pull/54379) ([Nikolay Degterinsky](https://github.com/evillique)).
- Check for overflow before addition in `analysisOfVariance` function [#54385](https://github.com/ClickHouse/ClickHouse/pull/54385) ([Antonio Andelic](https://github.com/antonio2368)).
- Reproduce and fix the bug in removeSharedRecursive [#54430](https://github.com/ClickHouse/ClickHouse/pull/54430) ([Sema Checherinda](https://github.com/CheSema)).
- Fix possible incorrect result with SimpleAggregateFunction in PREWHERE and FINAL [#54436](https://github.com/ClickHouse/ClickHouse/pull/54436) ([Azat Khuzhin](https://github.com/azat)).
- Fix filtering parts with indexHint for non analyzer [#54449](https://github.com/ClickHouse/ClickHouse/pull/54449) ([Azat Khuzhin](https://github.com/azat)).
- Fix aggregate projections with normalized states [#54480](https://github.com/ClickHouse/ClickHouse/pull/54480) ([Amos Bird](https://github.com/amosbird)).
- `clickhouse-local`: something for multiquery parameter [#54498](https://github.com/ClickHouse/ClickHouse/pull/54498) ([CuiShuoGuo](https://github.com/bakam412)).
- `clickhouse-local` supports `--database` command line argument [#54503](https://github.com/ClickHouse/ClickHouse/pull/54503) ([vdimir](https://github.com/vdimir)).
- Fix possible parsing error in `-WithNames` formats with disabled `input_format_with_names_use_header` [#54513](https://github.com/ClickHouse/ClickHouse/pull/54513) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix rare case of CHECKSUM_DOESNT_MATCH error [#54549](https://github.com/ClickHouse/ClickHouse/pull/54549) ([alesapin](https://github.com/alesapin)).
- Fix sorting of UNION ALL of already sorted results [#54564](https://github.com/ClickHouse/ClickHouse/pull/54564) ([Vitaly Baranov](https://github.com/vitlibar)).
- Fix snapshot install in Keeper [#54572](https://github.com/ClickHouse/ClickHouse/pull/54572) ([Antonio Andelic](https://github.com/antonio2368)).
- Fix race in `ColumnUnique` [#54575](https://github.com/ClickHouse/ClickHouse/pull/54575) ([Nikita Taranov](https://github.com/nickitat)).
- Annoy/Usearch index: Fix LOGICAL_ERROR during build-up with default values [#54600](https://github.com/ClickHouse/ClickHouse/pull/54600) ([Robert Schulze](https://github.com/rschu1ze)).
- Fix serialization of `ColumnDecimal` [#54601](https://github.com/ClickHouse/ClickHouse/pull/54601) ([Nikita Taranov](https://github.com/nickitat)).
- Fix schema inference for \*Cluster functions for column names with spaces [#54635](https://github.com/ClickHouse/ClickHouse/pull/54635) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix using structure from insertion tables in case of defaults and explicit insert columns [#54655](https://github.com/ClickHouse/ClickHouse/pull/54655) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix: avoid using regex match, possibly containing alternation, as a key condition. [#54696](https://github.com/ClickHouse/ClickHouse/pull/54696) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- Fix ReplacingMergeTree with vertical merge and cleanup [#54706](https://github.com/ClickHouse/ClickHouse/pull/54706) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
- Fix virtual columns having incorrect values after ORDER BY [#54811](https://github.com/ClickHouse/ClickHouse/pull/54811) ([Michael Kolupaev](https://github.com/al13n321)).
- Fix filtering parts with indexHint for non analyzer [#54825](https://github.com/ClickHouse/ClickHouse/pull/54825) [#54449](https://github.com/ClickHouse/ClickHouse/pull/54449) ([Azat Khuzhin](https://github.com/azat)).
- Fix Keeper segfault during shutdown [#54841](https://github.com/ClickHouse/ClickHouse/pull/54841) ([Antonio Andelic](https://github.com/antonio2368)).
- Fix `Invalid number of rows in Chunk` in MaterializedPostgreSQL [#54844](https://github.com/ClickHouse/ClickHouse/pull/54844) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Move obsolete format settings to separate section [#54855](https://github.com/ClickHouse/ClickHouse/pull/54855) ([Kruglov Pavel](https://github.com/Avogar)).
- Rebuild `minmax_count_projection` when partition key gets modified [#54943](https://github.com/ClickHouse/ClickHouse/pull/54943) ([Amos Bird](https://github.com/amosbird)).
- Fix bad cast to `ColumnVector<Int128>` in function `if` [#55019](https://github.com/ClickHouse/ClickHouse/pull/55019) ([Kruglov Pavel](https://github.com/Avogar)).
- Prevent attaching parts from tables with different projections or indices [#55062](https://github.com/ClickHouse/ClickHouse/pull/55062) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
- Store NULL in scalar result map for empty subquery result [#52240](https://github.com/ClickHouse/ClickHouse/pull/52240) ([vdimir](https://github.com/vdimir)).
- Fix `FINAL` produces invalid read ranges in a rare case [#54934](https://github.com/ClickHouse/ClickHouse/pull/54934) ([Nikita Taranov](https://github.com/nickitat)).
- Fix: insert quorum w/o keeper retries [#55026](https://github.com/ClickHouse/ClickHouse/pull/55026) ([Igor Nikonov](https://github.com/devcrafter)).
- Fix simple state with nullable [#55030](https://github.com/ClickHouse/ClickHouse/pull/55030) ([Pedro Riera](https://github.com/priera)).

### <a id="238"></a> ClickHouse リリース 23.8 LTS, 2023-08-31 {#238}

#### 後方互換性のない変更 {#backward-incompatible-change-4}

- 動的ディスクに名前が含まれる場合、ディスク関数の引数で `disk = disk(name = 'disk_name'`, ...)` として指定する必要があります。以前のバージョンでは `disk = disk_<disk_name>(...)` として指定できましたが、サポートされなくなりました。[#52820](https://github.com/ClickHouse/ClickHouse/pull/52820) ([Kseniia Sumarokova](https://github.com/kssenii))。
- `clickhouse-benchmark` は `--concurrency` に1より大きい値を指定して呼び出された場合、並列で接続を確立します。以前は、ヨーロッパから米国への1000の同時接続で実行すると使用できませんでした。高レイテンシ接続のQPSを正しく計算します。後方互換性のない変更: `clickhouse-benchmark` のJSON出力オプションが削除されました。このオプションを使用していた場合は、回避策として `system.query_log` からJSON形式でデータを抽出できます。[#53293](https://github.com/ClickHouse/ClickHouse/pull/53293) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `system.text_log` から `microseconds` カラムが削除され、`system.metric_log` から `milliseconds` カラムが削除されました。これらは `event_time_microseconds` カラムの存在により冗長であるためです。[#53601](https://github.com/ClickHouse/ClickHouse/pull/53601) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- メタデータキャッシュ機能を非推奨にします。これは実験的機能であり、使用されたことがありません。この機能は危険です: [#51182](https://github.com/ClickHouse/ClickHouse/issues/51182)。`system.merge_tree_metadata_cache` システムテーブルを削除します。メタデータキャッシュはこのバージョンではまだ利用可能ですが、まもなく削除されます。これにより [#39197](https://github.com/ClickHouse/ClickHouse/issues/39197) がクローズされます。[#51303](https://github.com/ClickHouse/ClickHouse/pull/51303) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- TLS接続における3DESのサポートを無効化します。[#52893](https://github.com/ClickHouse/ClickHouse/pull/52893) ([Kenji Noguchi](https://github.com/knoguchi))。


#### 新機能 {#new-feature-4}

- zip/7z/tarアーカイブからの直接インポート。例: `file('*.zip :: *.csv')`。[#50321](https://github.com/ClickHouse/ClickHouse/pull/50321) ([nikitakeba](https://github.com/nikitakeba))。
- `trace_type = 'MemorySample'`の場合に`system.trace_log`へ`ptr`カラムを追加。このカラムにはアロケーションのアドレスが含まれます。割り当てられたが解放されていないメモリを含むフレームグラフを構築できる`flameGraph`関数を追加。[#38391](https://github.com/ClickHouse/ClickHouse/issues/38391)の再実装。[#45322](https://github.com/ClickHouse/ClickHouse/pull/45322) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- テーブル関数`azureBlobStorageCluster`を追加。サポートされる機能セットはテーブル関数`s3Cluster`と非常に類似しています。[#50795](https://github.com/ClickHouse/ClickHouse/pull/50795) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
- issue [#50808](https://github.com/ClickHouse/ClickHouse/issues/50808)でテーブル名なしで`cluster`、`clusterAllReplicas`、`remote`、`remoteSecure`の使用を許可。[#50848](https://github.com/ClickHouse/ClickHouse/pull/50848) ([Yangkuan Liu](https://github.com/LiuYangkuan))。
- Kafkaコンシューマーを監視するためのシステムテーブル。[#50999](https://github.com/ClickHouse/ClickHouse/pull/50999) ([Ilya Golshtein](https://github.com/ilejn))。
- `max_sessions_for_user`設定を追加。[#51724](https://github.com/ClickHouse/ClickHouse/pull/51724) ([Alexey Gerasimchuck](https://github.com/Demilivor))。
- Sparkの`to_utc_timestamp/from_utc_timestamp`と同じ動作をする新しい関数`toUTCTimestamp/fromUTCTimestamp`。[#52117](https://github.com/ClickHouse/ClickHouse/pull/52117) ([KevinyhZou](https://github.com/KevinyhZou))。
- ClickHouseテーブル構造をCapnProto/Protobuf形式スキーマに変換する新しい関数`structureToCapnProtoSchema`/`structureToProtobufSchema`を追加。テーブル構造から自動生成されたスキーマを使用して、外部形式スキーマなしでCapnProto/Protobuf形式でデータを入出力可能(設定`format_capn_proto_use_autogenerated_schema`/`format_protobuf_use_autogenerated_schema`で制御)。設定`output_format_schema`を使用して入出力時に自動生成されたスキーマをエクスポート可能。[#52278](https://github.com/ClickHouse/ClickHouse/pull/52278) ([Kruglov Pavel](https://github.com/Avogar))。
- `system.query_log`の新しいフィールド`query_cache_usage`は、クエリキャッシュが使用されたかどうか、およびどのように使用されたかを表示します。[#52384](https://github.com/ClickHouse/ClickHouse/pull/52384) ([Robert Schulze](https://github.com/rschu1ze))。
- 新しい関数`startsWithUTF8`と`endsWithUTF8`を追加。[#52555](https://github.com/ClickHouse/ClickHouse/pull/52555) ([李扬](https://github.com/taiyang-li))。
- TSV/CustomSeparated/JSONCompactEachRowで可変数のカラムを許可し、スキーマ推論が可変数のカラムで動作するようにしました。設定`input_format_tsv_allow_variable_number_of_columns`、`input_format_custom_allow_variable_number_of_columns`、`input_format_json_compact_allow_variable_number_of_columns`を追加。[#52692](https://github.com/ClickHouse/ClickHouse/pull/52692) ([Kruglov Pavel](https://github.com/Avogar))。
- `SYSTEM STOP/START PULLING REPLICATION LOG`クエリを追加(`ReplicatedMergeTree`のテスト用)。[#52881](https://github.com/ClickHouse/ClickHouse/pull/52881) ([Alexander Tokmakov](https://github.com/tavplubix))。
- イニシエーター上のミューテーションで定数非決定的関数の実行を許可。[#53129](https://github.com/ClickHouse/ClickHouse/pull/53129) ([Anton Popov](https://github.com/CurtizJ))。
- データを読み取らず、`system.one`のように型`UInt8`と値`0`を持つカラム`dummy`を含む単一行を常に返す入力形式`One`を追加。`_file/_path`仮想カラムと組み合わせて使用することで、データを読み取らずにfile/s3/url/hdfs/等のテーブル関数でファイルをリストできます。[#53209](https://github.com/ClickHouse/ClickHouse/pull/53209) ([Kruglov Pavel](https://github.com/Avogar))。
- `tupleConcat`関数を追加。[#52759](https://github.com/ClickHouse/ClickHouse/issues/52759)をクローズ。[#53239](https://github.com/ClickHouse/ClickHouse/pull/53239) ([Nikolay Degterinsky](https://github.com/evillique))。
- `TRUNCATE DATABASE`操作をサポート。[#53261](https://github.com/ClickHouse/ClickHouse/pull/53261) ([Bharat Nallan](https://github.com/bharatnc))。
- プライマリキー処理に使用されるスレッド数を制限する`max_threads_for_indexes`設定を追加。[#53313](https://github.com/ClickHouse/ClickHouse/pull/53313) ([jorisgio](https://github.com/jorisgio))。
- SipHashキー付き関数を再追加。[#53525](https://github.com/ClickHouse/ClickHouse/pull/53525) ([Salvatore Mesoraca](https://github.com/aiven-sal))。
- ([#52755](https://github.com/ClickHouse/ClickHouse/issues/52755)、[#52895](https://github.com/ClickHouse/ClickHouse/issues/52895)) 関数`arrayRotateLeft`、`arrayRotateRight`、`arrayShiftLeft`、`arrayShiftRight`を追加。[#53557](https://github.com/ClickHouse/ClickHouse/pull/53557) ([Mikhail Koviazin](https://github.com/mkmkme))。
- `system.clusters`にclusterのエイリアスとしてカラム`name`を追加。[#53605](https://github.com/ClickHouse/ClickHouse/pull/53605) ([irenjj](https://github.com/irenjj))。
- 高度なダッシュボードで一括編集(保存/読み込み)が可能になりました。[#53608](https://github.com/ClickHouse/ClickHouse/pull/53608) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 高度なダッシュボードにチャートを最大化して移動するオプションが追加されました。[#53622](https://github.com/ClickHouse/ClickHouse/pull/53622) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 配列の加算と減算のサポートを追加: `[5,2] + [1,7]`。要素ごとの乗算と引数のスカラー積の混同を避けるため、除算と乗算は実装されていません。[#49939](https://github.com/ClickHouse/ClickHouse/issues/49939)をクローズ。[#52625](https://github.com/ClickHouse/ClickHouse/pull/52625) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
- テーブル名として文字列リテラルのサポートを追加。[#52178](https://github.com/ClickHouse/ClickHouse/issues/52178)をクローズ。[#52635](https://github.com/ClickHouse/ClickHouse/pull/52635) ([hendrik-m](https://github.com/hendrik-m))。

#### 実験的機能 {#experimental-feature-1}

- S3からのストリーミングデータインポート用の新しいテーブルエンジン`S3Queue`を追加しました。[#37012](https://github.com/ClickHouse/ClickHouse/issues/37012)をクローズします。[#49086](https://github.com/ClickHouse/ClickHouse/pull/49086) ([s-kat](https://github.com/s-kat))。まだ使用できる状態ではありません。使用しないでください。
- 分散テーブルにおけるレプリカからの並列読み取りを有効化しました。[#49708](https://github.com/ClickHouse/ClickHouse/issues/49708)に関連します。[#53005](https://github.com/ClickHouse/ClickHouse/pull/53005) ([Igor Nikonov](https://github.com/devcrafter))。
- 近似近傍探索手法としてHNSWの実験的サポートを追加しました。[#53447](https://github.com/ClickHouse/ClickHouse/pull/53447) ([Davit Vardanyan](https://github.com/davvard))。これは現在、実装作業を継続している開発者を対象としています。使用しないでください。


#### パフォーマンス改善 {#performance-improvement-4}

- Parquetフィルタプッシュダウン。Parquetファイルの読み取り時に、WHERE条件と各カラムの最小値/最大値に基づいて行グループ(ファイルのチャンク)がスキップされます。特に、ファイルが特定のカラムでおおよそソートされている場合、そのカラムの狭い範囲でフィルタリングするクエリが大幅に高速化されます。[#52951](https://github.com/ClickHouse/ClickHouse/pull/52951) ([Michael Kolupaev](https://github.com/al13n321))。
- Parquetで小さな行グループをまとめてバッチ処理することで読み取りを最適化。[#53069](https://github.com/ClickHouse/ClickHouse/issues/53069)を解決。[#53281](https://github.com/ClickHouse/ClickHouse/pull/53281) ([Kruglov Pavel](https://github.com/Avogar))。
- ほとんどの入力フォーマットでファイルからのカウントを最適化。[#44334](https://github.com/ClickHouse/ClickHouse/issues/44334)を解決。[#53637](https://github.com/ClickHouse/ClickHouse/pull/53637) ([Kruglov Pavel](https://github.com/Avogar))。
- `url`/`file`/`hdfs`テーブル関数で読み取り前にファイル/パスによるフィルタを使用。[#53529](https://github.com/ClickHouse/ClickHouse/pull/53529) ([Kruglov Pavel](https://github.com/Avogar))。
- AArch64、PowerPC、SystemZ、RISC-V向けのJITコンパイルを有効化。[#38217](https://github.com/ClickHouse/ClickHouse/pull/38217) ([Maksim Kita](https://github.com/kitaisreal))。
- `countDistinctIf`を`count_distinct_implementation`で書き換えるための設定`rewrite_count_distinct_if_with_count_distinct_implementation`を追加。[#30642](https://github.com/ClickHouse/ClickHouse/issues/30642)を解決。[#46051](https://github.com/ClickHouse/ClickHouse/pull/46051) ([flynn](https://github.com/ucasfl))。
- マージ前の変換を並列化することで、`uniq`および`uniqExact`集約関数の状態のマージを高速化。[#50748](https://github.com/ClickHouse/ClickHouse/pull/50748) ([Jiebin Sun](https://github.com/jiebinn))。
- 大量の可変長キーを使用する際のnullable文字列キーの集約パフォーマンスを最適化。[#51399](https://github.com/ClickHouse/ClickHouse/pull/51399) ([LiuNeng](https://github.com/liuneng1994))。
- 事前イメージを使用した時間フィルタ最適化のためのパスをAnalyzerに追加。ICXデバイス(Intel Xeon Platinum 8380 CPU、80コア、160スレッド)でのSSBのパフォーマンス実験により、実験的アナライザーを有効にした場合、この変更が幾何平均QPSに8.5%の改善をもたらすことが示されています。[#52091](https://github.com/ClickHouse/ClickHouse/pull/52091) ([Zhiguo Zhou](https://github.com/ZhiguoZh))。
- `uniqExact`(COUNT DISTINCT)関数ですべてのハッシュセットが単一レベルの場合、マージを最適化。[#52973](https://github.com/ClickHouse/ClickHouse/pull/52973) ([Jiebin Sun](https://github.com/jiebinn))。
- `Join`テーブルエンジン: すべてのカラムを含むハッシュ結合データ構造を複製しないように変更。[#53046](https://github.com/ClickHouse/ClickHouse/pull/53046) ([Duc Canh Le](https://github.com/canhld94))。
- パフォーマンスを向上させるため、「apache arrow」ライブラリを使用せずにネイティブ`ORC`入力フォーマットを実装。[#53324](https://github.com/ClickHouse/ClickHouse/pull/53324) ([李扬](https://github.com/taiyang-li))。
- ダッシュボードはサーバーにデータの圧縮を指示します。これは低速なインターネット接続で大きな時間枠を扱う際に有用です。例えば、86400ポイントを持つ1つのチャートは、非圧縮で1.5 MB、`br`で圧縮すると60 KBになります。[#53569](https://github.com/ClickHouse/ClickHouse/pull/53569) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- BACKUPおよびRESTORE操作のためのスレッドプールの利用を改善。[#53649](https://github.com/ClickHouse/ClickHouse/pull/53649) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- 起動時にファイルシステムキャッシュメタデータを並列でロード。`load_metadata_threads`(デフォルト: 1)キャッシュ設定で構成。[#52037](https://github.com/ClickHouse/ClickHouse/issues/52037)に関連。[#52943](https://github.com/ClickHouse/ClickHouse/pull/52943) ([Kseniia Sumarokova](https://github.com/kssenii))。
- `move_primary_key_columns_to_end_of_prewhere`を改善。[#53337](https://github.com/ClickHouse/ClickHouse/pull/53337) ([Han Fei](https://github.com/hanfei1991))。
- ClickHouse Keeperとのやり取りを最適化。以前は、呼び出し側が同じウォッチコールバックを複数回登録できました。その場合、各エントリがメモリを消費し、同じコールバックが複数回呼び出されるため、あまり意味がありませんでした。これを回避するために、呼び出し側は同じウォッチを複数回追加しないロジックを持つ必要がありました。この変更により、ウォッチコールバックがshared_ptrを介して渡される場合、この重複排除が内部的に行われます。[#53452](https://github.com/ClickHouse/ClickHouse/pull/53452) ([Alexander Gololobov](https://github.com/davenger))。
- file/s3/url/hdfs/azure関数でのカウントのために、ファイル内の行数をキャッシュ。キャッシュは`use_cache_for_count_from_files`設定で有効/無効にできます(デフォルトで有効)。https://github.com/ClickHouse/ClickHouse/pull/53637の続き。[#53692](https://github.com/ClickHouse/ClickHouse/pull/53692) ([Kruglov Pavel](https://github.com/Avogar))。
- より慎重なスレッド管理により、大量のファイルに対するS3テーブル関数の速度が25%以上向上します。[#53668](https://github.com/ClickHouse/ClickHouse/pull/53668) ([pufit](https://github.com/pufit))。





#### 改善 {#improvement-4}

- Add `stderr_reaction` configuration/setting to control the reaction (none, log or throw) when external command stderr has data. This helps make debugging external command easier. [#43210](https://github.com/ClickHouse/ClickHouse/pull/43210) ([Amos Bird](https://github.com/amosbird)).
- Add `partition` column to the `system part_log` and merge table. [#48990](https://github.com/ClickHouse/ClickHouse/pull/48990) ([Jianfei Hu](https://github.com/incfly)).
- The sizes of the (index) uncompressed/mark, mmap and query caches can now be configured dynamically at runtime (without server restart). [#51446](https://github.com/ClickHouse/ClickHouse/pull/51446) ([Robert Schulze](https://github.com/rschu1ze)).
- If a dictionary is created with a complex key, automatically choose the "complex key" layout variant. [#49587](https://github.com/ClickHouse/ClickHouse/pull/49587) ([xiebin](https://github.com/xbthink)).
- Add setting `use_concurrency_control` for better testing of the new concurrency control feature. [#49618](https://github.com/ClickHouse/ClickHouse/pull/49618) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Added suggestions for mistyped names for databases and tables. [#49801](https://github.com/ClickHouse/ClickHouse/pull/49801) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
- While read small files from HDFS by Gluten, we found that it will cost more times when compare to directly query by Spark. And we did something with that. [#50063](https://github.com/ClickHouse/ClickHouse/pull/50063) ([KevinyhZou](https://github.com/KevinyhZou)).
- There were too many worthless error logs after session expiration, which we didn't like. [#50171](https://github.com/ClickHouse/ClickHouse/pull/50171) ([helifu](https://github.com/helifu)).
- Introduce fallback ZooKeeper sessions which are time-bound. Fixed `index` column in system.zookeeper_connection for DNS addresses. [#50424](https://github.com/ClickHouse/ClickHouse/pull/50424) ([Anton Kozlov](https://github.com/tonickkozlov)).
- Add ability to log when max_partitions_per_insert_block is reached. [#50948](https://github.com/ClickHouse/ClickHouse/pull/50948) ([Sean Haynes](https://github.com/seandhaynes)).
- Added a bunch of custom commands to clickhouse-keeper-client (mostly to make ClickHouse debugging easier). [#51117](https://github.com/ClickHouse/ClickHouse/pull/51117) ([pufit](https://github.com/pufit)).
- Updated check for connection string in `azureBlobStorage` table function as connection string with "sas" does not always begin with the default endpoint and updated connection URL to include "sas" token after adding Azure's container to URL. [#51141](https://github.com/ClickHouse/ClickHouse/pull/51141) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
- Fix description for filtering sets in the `full_sorting_merge` JOIN algorithm. [#51329](https://github.com/ClickHouse/ClickHouse/pull/51329) ([Tanay Tummalapalli](https://github.com/ttanay)).
- Fixed memory consumption in `Aggregator` when `max_block_size` is huge. [#51566](https://github.com/ClickHouse/ClickHouse/pull/51566) ([Nikita Taranov](https://github.com/nickitat)).
- Add `SYSTEM SYNC FILESYSTEM CACHE` command. It will compare in-memory state of filesystem cache with what it has on disk and fix in-memory state if needed. This is only needed if you are making manual interventions in on-disk data, which is highly discouraged. [#51622](https://github.com/ClickHouse/ClickHouse/pull/51622) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Attempt to create a generic proxy resolver for CH while keeping backwards compatibility with existing S3 storage conf proxy resolver. [#51749](https://github.com/ClickHouse/ClickHouse/pull/51749) ([Arthur Passos](https://github.com/arthurpassos)).
- Support reading tuple subcolumns from file/s3/hdfs/url/azureBlobStorage table functions. [#51806](https://github.com/ClickHouse/ClickHouse/pull/51806) ([Kruglov Pavel](https://github.com/Avogar)).
- Function `arrayIntersect` now returns the values in the order, corresponding to the first argument. Closes [#27622](https://github.com/ClickHouse/ClickHouse/issues/27622). [#51850](https://github.com/ClickHouse/ClickHouse/pull/51850) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
- Add new queries, which allow to create/drop of access entities in specified access storage or move access entities from one access storage to another. [#51912](https://github.com/ClickHouse/ClickHouse/pull/51912) ([pufit](https://github.com/pufit)).
- Make `ALTER TABLE FREEZE` queries not replicated in the Replicated database engine. [#52064](https://github.com/ClickHouse/ClickHouse/pull/52064) ([Mike Kot](https://github.com/myrrc)).
- Added possibility to flush system tables on unexpected shutdown. [#52174](https://github.com/ClickHouse/ClickHouse/pull/52174) ([Alexey Gerasimchuck](https://github.com/Demilivor)).
- Fix the case when `s3` table function refused to work with pre-signed URLs. close [#50846](https://github.com/ClickHouse/ClickHouse/issues/50846). [#52310](https://github.com/ClickHouse/ClickHouse/pull/52310) ([chen](https://github.com/xiedeyantu)).
- Add column `name` as an alias to `event` and `metric` in the `system.events` and `system.metrics` tables. Closes [#51257](https://github.com/ClickHouse/ClickHouse/issues/51257). [#52315](https://github.com/ClickHouse/ClickHouse/pull/52315) ([chen](https://github.com/xiedeyantu)).
- Added support of syntax `CREATE UNIQUE INDEX` in parser as a no-op for better SQL compatibility. `UNIQUE` index is not supported. Set `create_index_ignore_unique = 1` to ignore UNIQUE keyword in queries. [#52320](https://github.com/ClickHouse/ClickHouse/pull/52320) ([Ilya Yatsishin](https://github.com/qoega)).
- Add support of predefined macro (`{database}` and `{table}`) in some Kafka engine settings: topic, consumer, client_id, etc. [#52386](https://github.com/ClickHouse/ClickHouse/pull/52386) ([Yury Bogomolov](https://github.com/ybogo)).
- Disable updating the filesystem cache during backup/restore. Filesystem cache must not be updated during backup/restore, it seems it just slows down the process without any profit (because the BACKUP command can read a lot of data and it's no use to put all the data to the filesystem cache and immediately evict it). [#52402](https://github.com/ClickHouse/ClickHouse/pull/52402) ([Vitaly Baranov](https://github.com/vitlibar)).
- The configuration of S3 endpoint allow using it from the root, and append '/' automatically if needed. [#47809](https://github.com/ClickHouse/ClickHouse/issues/47809). [#52600](https://github.com/ClickHouse/ClickHouse/pull/52600) ([xiaolei565](https://github.com/xiaolei565)).
- For clickhouse-local allow positional options and populate global UDF settings (user_scripts_path and user_defined_executable_functions_config). [#52643](https://github.com/ClickHouse/ClickHouse/pull/52643) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- `system.asynchronous_metrics` now includes metrics "QueryCacheEntries" and "QueryCacheBytes" to inspect the query cache. [#52650](https://github.com/ClickHouse/ClickHouse/pull/52650) ([Robert Schulze](https://github.com/rschu1ze)).
- Added possibility to use `s3_storage_class` parameter in the `SETTINGS` clause of the `BACKUP` statement for backups to S3. [#52658](https://github.com/ClickHouse/ClickHouse/pull/52658) ([Roman Vasin](https://github.com/rvasin)).
- Add utility `print-backup-info.py` which parses a backup metadata file and prints information about the backup. [#52690](https://github.com/ClickHouse/ClickHouse/pull/52690) ([Vitaly Baranov](https://github.com/vitlibar)).
- Closes [#49510](https://github.com/ClickHouse/ClickHouse/issues/49510). Currently we have database and table names case-sensitive, but BI tools query `information_schema` sometimes in lowercase, sometimes in uppercase. For this reason we have `information_schema` database, containing lowercase tables, such as `information_schema.tables` and `INFORMATION_SCHEMA` database, containing uppercase tables, such as `INFORMATION_SCHEMA.TABLES`. But some tools are querying `INFORMATION_SCHEMA.tables` and `information_schema.TABLES`. The proposed solution is to duplicate both lowercase and uppercase tables in lowercase and uppercase `information_schema` database. [#52695](https://github.com/ClickHouse/ClickHouse/pull/52695) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
- Query`CHECK TABLE` has better performance and usability (sends progress updates, cancellable). [#52745](https://github.com/ClickHouse/ClickHouse/pull/52745) ([vdimir](https://github.com/vdimir)).
- Add support for `modulo`, `intDiv`, `intDivOrZero` for tuples by distributing them across tuple's elements. [#52758](https://github.com/ClickHouse/ClickHouse/pull/52758) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- Search for default `yaml` and `yml` configs in clickhouse-client after `xml`. [#52767](https://github.com/ClickHouse/ClickHouse/pull/52767) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- When merging into non-'clickhouse' rooted configuration, configs with different root node name just bypassed without exception. [#52770](https://github.com/ClickHouse/ClickHouse/pull/52770) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- Now it's possible to specify min (`memory_profiler_sample_min_allocation_size`) and max (`memory_profiler_sample_max_allocation_size`) size for allocations to be tracked with sampling memory profiler. [#52779](https://github.com/ClickHouse/ClickHouse/pull/52779) ([alesapin](https://github.com/alesapin)).
- Add `precise_float_parsing` setting to switch float parsing methods (fast/precise). [#52791](https://github.com/ClickHouse/ClickHouse/pull/52791) ([Andrey Zvonov](https://github.com/zvonand)).
- Use the same default paths for `clickhouse-keeper` (symlink) as for `clickhouse-keeper` (executable). [#52861](https://github.com/ClickHouse/ClickHouse/pull/52861) ([Vitaly Baranov](https://github.com/vitlibar)).
- Improve error message for table function `remote`. Closes [#40220](https://github.com/ClickHouse/ClickHouse/issues/40220). [#52959](https://github.com/ClickHouse/ClickHouse/pull/52959) ([jiyoungyoooo](https://github.com/jiyoungyoooo)).
- Added the possibility to specify custom storage policy in the `SETTINGS` clause of `RESTORE` queries. [#52970](https://github.com/ClickHouse/ClickHouse/pull/52970) ([Victor Krasnov](https://github.com/sirvickr)).
- Add the ability to throttle the S3 requests on backup operations (`BACKUP` and `RESTORE` commands now honor `s3_max_[get/put]_[rps/burst]`). [#52974](https://github.com/ClickHouse/ClickHouse/pull/52974) ([Daniel Pozo Escalona](https://github.com/danipozo)).
- Add settings to ignore ON CLUSTER clause in queries for management of replicated user-defined functions or access control entities with replicated storage. [#52975](https://github.com/ClickHouse/ClickHouse/pull/52975) ([Aleksei Filatov](https://github.com/aalexfvk)).
- EXPLAIN actions for JOIN step. [#53006](https://github.com/ClickHouse/ClickHouse/pull/53006) ([Maksim Kita](https://github.com/kitaisreal)).
- Make `hasTokenOrNull` and `hasTokenCaseInsensitiveOrNull` return null for empty needles. [#53059](https://github.com/ClickHouse/ClickHouse/pull/53059) ([ltrk2](https://github.com/ltrk2)).
- Allow to restrict allowed paths for filesystem caches. Mainly useful for dynamic disks. If in server config `filesystem_caches_path` is specified, all filesystem caches' paths will be restricted to this directory. E.g. if the `path` in cache config is relative - it will be put in `filesystem_caches_path`; if `path` in cache config is absolute, it will be required to lie inside `filesystem_caches_path`. If `filesystem_caches_path` is not specified in config, then behaviour will be the same as in earlier versions. [#53124](https://github.com/ClickHouse/ClickHouse/pull/53124) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Added a bunch of custom commands (mostly to make ClickHouse debugging easier). [#53127](https://github.com/ClickHouse/ClickHouse/pull/53127) ([pufit](https://github.com/pufit)).
- Add diagnostic info about file name during schema inference - it helps when you process multiple files with globs. [#53135](https://github.com/ClickHouse/ClickHouse/pull/53135) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Client will load suggestions using the main connection if the second connection is not allowed to create a session. [#53177](https://github.com/ClickHouse/ClickHouse/pull/53177) ([Alexey Gerasimchuck](https://github.com/Demilivor)).
- Add EXCEPT clause to `SYSTEM STOP/START LISTEN QUERIES [ALL/DEFAULT/CUSTOM]` query, for example `SYSTEM STOP LISTEN QUERIES ALL EXCEPT TCP, HTTP`. [#53280](https://github.com/ClickHouse/ClickHouse/pull/53280) ([Nikolay Degterinsky](https://github.com/evillique)).
- Change the default of `max_concurrent_queries` from 100 to 1000. It's ok to have many concurrent queries if they are not heavy, and mostly waiting for the network. Note: don't confuse concurrent queries and QPS: for example, ClickHouse server can do tens of thousands of QPS with less than 100 concurrent queries. [#53285](https://github.com/ClickHouse/ClickHouse/pull/53285) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Limit number of concurrent background partition optimize merges. [#53405](https://github.com/ClickHouse/ClickHouse/pull/53405) ([Duc Canh Le](https://github.com/canhld94)).
- Added a setting `allow_moving_table_directory_to_trash` that allows to ignore `Directory for table data already exists` error when replicating/recovering a `Replicated` database. [#53425](https://github.com/ClickHouse/ClickHouse/pull/53425) ([Alexander Tokmakov](https://github.com/tavplubix)).
- If server settings `asynchronous_metrics_update_period_s` and `asynchronous_heavy_metrics_update_period_s` are misconfigured to 0, it will now fail gracefully instead of terminating the application. [#53428](https://github.com/ClickHouse/ClickHouse/pull/53428) ([Robert Schulze](https://github.com/rschu1ze)).
- The ClickHouse server now respects memory limits changed via cgroups when reloading its configuration. [#53455](https://github.com/ClickHouse/ClickHouse/pull/53455) ([Robert Schulze](https://github.com/rschu1ze)).
- Add ability to turn off flush of Distributed tables on `DETACH`, `DROP`, or server shutdown. [#53501](https://github.com/ClickHouse/ClickHouse/pull/53501) ([Azat Khuzhin](https://github.com/azat)).
- The `domainRFC` function now supports IPv6 in square brackets. [#53506](https://github.com/ClickHouse/ClickHouse/pull/53506) ([Chen768959](https://github.com/Chen768959)).
- Use longer timeout for S3 CopyObject requests, which are used in backups. [#53533](https://github.com/ClickHouse/ClickHouse/pull/53533) ([Michael Kolupaev](https://github.com/al13n321)).
- Added server setting `aggregate_function_group_array_max_element_size`. This setting is used to limit array size for `groupArray` function at serialization. The default value is `16777215`. [#53550](https://github.com/ClickHouse/ClickHouse/pull/53550) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
- `SCHEMA` was added as alias for `DATABASE` to improve MySQL compatibility. [#53587](https://github.com/ClickHouse/ClickHouse/pull/53587) ([Daniël van Eeden](https://github.com/dveeden)).
- Add asynchronous metrics about tables in the system database. For example, `TotalBytesOfMergeTreeTablesSystem`. This closes [#53603](https://github.com/ClickHouse/ClickHouse/issues/53603). [#53604](https://github.com/ClickHouse/ClickHouse/pull/53604) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- SQL editor in the Play UI and Dashboard will not use Grammarly. [#53614](https://github.com/ClickHouse/ClickHouse/pull/53614) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- As expert-level settings, it is now possible to (1) configure the size_ratio (i.e. the relative size of the protected queue) of the [index] mark/uncompressed caches, (2) configure the cache policy of the index mark and index uncompressed caches. [#53657](https://github.com/ClickHouse/ClickHouse/pull/53657) ([Robert Schulze](https://github.com/rschu1ze)).
- Added client info validation to the query packet in TCPHandler. [#53673](https://github.com/ClickHouse/ClickHouse/pull/53673) ([Alexey Gerasimchuck](https://github.com/Demilivor)).
- Retry loading parts in case of network errors while interaction with Microsoft Azure. [#53750](https://github.com/ClickHouse/ClickHouse/pull/53750) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
- Stacktrace for exceptions, Materailized view exceptions are propagated. [#53766](https://github.com/ClickHouse/ClickHouse/pull/53766) ([Ilya Golshtein](https://github.com/ilejn)).
- If no hostname or port were specified, keeper client will try to search for a connection string in the ClickHouse's config.xml. [#53769](https://github.com/ClickHouse/ClickHouse/pull/53769) ([pufit](https://github.com/pufit)).
- Add profile event `PartsLockMicroseconds` which shows the amount of microseconds we hold the data parts lock in MergeTree table engine family. [#53797](https://github.com/ClickHouse/ClickHouse/pull/53797) ([alesapin](https://github.com/alesapin)).
- Make reconnect limit in RAFT limits configurable for keeper. This configuration can help to make keeper to rebuild connection with peers quicker if the current connection is broken. [#53817](https://github.com/ClickHouse/ClickHouse/pull/53817) ([Pengyuan Bian](https://github.com/bianpengyuan)).
- Ignore foreign keys in tables definition to improve compatibility with MySQL, so a user wouldn't need to rewrite his SQL of the foreign key part, ref [#53380](https://github.com/ClickHouse/ClickHouse/issues/53380). [#53864](https://github.com/ClickHouse/ClickHouse/pull/53864) ([jsc0218](https://github.com/jsc0218)).





#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-4}

- ClickHouseバイナリのシンボルを動的リンカーに公開しないようにしました。これにより[#43933](https://github.com/ClickHouse/ClickHouse/issues/43933)が修正される可能性があります。[#47475](https://github.com/ClickHouse/ClickHouse/pull/47475) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- clickhouse-serverパッケージに`clickhouse-keeper-client`シンボリックリンクを追加しました。[#51882](https://github.com/ClickHouse/ClickHouse/pull/51882) ([Mikhail f. Shiryaev](https://github.com/Felixoid))。
- SQL 2016準拠をレポートするため、CIにhttps://github.com/elliotchance/sqltestを追加しました。[#52293](https://github.com/ClickHouse/ClickHouse/pull/52293) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- PRQLを0.9.3にアップグレードしました。[#53060](https://github.com/ClickHouse/ClickHouse/pull/53060) ([Maximilian Roos](https://github.com/max-sixty))。
- CIチェックのシステムテーブルをClickHouse Cloudにエクスポートするようにしました。[#53086](https://github.com/ClickHouse/ClickHouse/pull/53086) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- コンパイラのプロファイルデータ(`-ftime-trace`)をClickHouse Cloudにアップロードするようにしました。[#53100](https://github.com/ClickHouse/ClickHouse/pull/53100) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- DebugビルドとTidyビルドを高速化しました。[#53178](https://github.com/ClickHouse/ClickHouse/pull/53178) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 大量の不要なコードを削除することでビルドを高速化しました。頻繁にインクルードされるヘッダーの1つがboostによって汚染されていました。[#53180](https://github.com/ClickHouse/ClickHouse/pull/53180) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- さらに多くの不要なコードを削除しました。[#53182](https://github.com/ClickHouse/ClickHouse/pull/53182) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 関数`arrayAUC`が重いC++テンプレートを使用していたため、それらを廃止しました。[#53183](https://github.com/ClickHouse/ClickHouse/pull/53183) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 一部の翻訳単位がccacheに関係なく常に再ビルドされていました。原因を特定し修正しました。[#53184](https://github.com/ClickHouse/ClickHouse/pull/53184) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- コンパイラのプロファイルデータ(`-ftime-trace`)をClickHouse Cloudにアップロードするようにしました。これは[#53100](https://github.com/ClickHouse/ClickHouse/issues/53100)の後の2回目の試みです。[#53213](https://github.com/ClickHouse/ClickHouse/pull/53213) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ステートフルテストのCIログをClickHouse Cloudにエクスポートするようにしました。[#53351](https://github.com/ClickHouse/ClickHouse/pull/53351) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ストレステストのCIログをエクスポートするようにしました。[#53353](https://github.com/ClickHouse/ClickHouse/pull/53353) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ファザーのCIログをエクスポートするようにしました。[#53354](https://github.com/ClickHouse/ClickHouse/pull/53354) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `clickhouse start`コマンドで環境パラメータを保持するようにしました。修正: [#51962](https://github.com/ClickHouse/ClickHouse/issues/51962)。[#53418](https://github.com/ClickHouse/ClickHouse/pull/53418) ([Mikhail f. Shiryaev](https://github.com/Felixoid))。
- [#53418](https://github.com/ClickHouse/ClickHouse/issues/53418)のフォローアップです。install_check.pyの小さな改善を行い、`init.d start`でメインプロセスに適切なENVパラメータが渡されることを確認するテストを追加しました。[#53457](https://github.com/ClickHouse/ClickHouse/pull/53457) ([Mikhail f. Shiryaev](https://github.com/Felixoid))。
- 潜在的な重複を防ぐため、CMakeのファイル管理を再編成しました。例えば、`indexHint.cpp`は`dbms_sources`と`clickhouse_functions_sources`の両方で重複していました。[#53621](https://github.com/ClickHouse/ClickHouse/pull/53621) ([Amos Bird](https://github.com/amosbird))。
- snappyを1.1.10にアップグレードしました。[#53672](https://github.com/ClickHouse/ClickHouse/pull/53672) ([李扬](https://github.com/taiyang-li))。
- 一部の依存関係を整理し、重複を削除することでcmakeビルドをわずかに改善しました。各コミットには変更内容の簡単な説明が含まれています。[#53759](https://github.com/ClickHouse/ClickHouse/pull/53759) ([Amos Bird](https://github.com/amosbird))。





#### バグ修正（公式安定版リリースにおけるユーザーに影響する不具合） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-4}

- Do not reset (experimental) Annoy index during build-up with more than one mark [#51325](https://github.com/ClickHouse/ClickHouse/pull/51325) ([Tian Xinhui](https://github.com/xinhuitian)).
- Fix usage of temporary directories during RESTORE [#51493](https://github.com/ClickHouse/ClickHouse/pull/51493) ([Azat Khuzhin](https://github.com/azat)).
- Fix binary arithmetic for Nullable(IPv4) [#51642](https://github.com/ClickHouse/ClickHouse/pull/51642) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- Support IPv4 and IPv6 data types as dictionary attributes [#51756](https://github.com/ClickHouse/ClickHouse/pull/51756) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- A fix for checksum of compress marks [#51777](https://github.com/ClickHouse/ClickHouse/pull/51777) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
- Fix mistakenly comma parsing as part of datetime in CSV best effort parsing [#51950](https://github.com/ClickHouse/ClickHouse/pull/51950) ([Kruglov Pavel](https://github.com/Avogar)).
- Don't throw exception when executable UDF has parameters [#51961](https://github.com/ClickHouse/ClickHouse/pull/51961) ([Nikita Taranov](https://github.com/nickitat)).
- Fix recalculation of skip indexes and projections in `ALTER DELETE` queries [#52530](https://github.com/ClickHouse/ClickHouse/pull/52530) ([Anton Popov](https://github.com/CurtizJ)).
- MaterializedMySQL: Fix the infinite loop in ReadBuffer::read [#52621](https://github.com/ClickHouse/ClickHouse/pull/52621) ([Val Doroshchuk](https://github.com/valbok)).
- Load suggestion only with `clickhouse` dialect [#52628](https://github.com/ClickHouse/ClickHouse/pull/52628) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
- Init and destroy ares channel on demand. [#52634](https://github.com/ClickHouse/ClickHouse/pull/52634) ([Arthur Passos](https://github.com/arthurpassos)).
- Fix filtering by virtual columns with OR expression [#52653](https://github.com/ClickHouse/ClickHouse/pull/52653) ([Azat Khuzhin](https://github.com/azat)).
- Fix crash in function `tuple` with one sparse column argument [#52659](https://github.com/ClickHouse/ClickHouse/pull/52659) ([Anton Popov](https://github.com/CurtizJ)).
- Fix named collections on cluster [#52687](https://github.com/ClickHouse/ClickHouse/pull/52687) ([Al Korgun](https://github.com/alkorgun)).
- Fix reading of unnecessary column in case of multistage `PREWHERE` [#52689](https://github.com/ClickHouse/ClickHouse/pull/52689) ([Anton Popov](https://github.com/CurtizJ)).
- Fix unexpected sort result on multi columns with nulls first direction [#52761](https://github.com/ClickHouse/ClickHouse/pull/52761) ([copperybean](https://github.com/copperybean)).
- Fix data race in Keeper reconfiguration [#52804](https://github.com/ClickHouse/ClickHouse/pull/52804) ([Antonio Andelic](https://github.com/antonio2368)).
- Fix sorting of sparse columns with large limit [#52827](https://github.com/ClickHouse/ClickHouse/pull/52827) ([Anton Popov](https://github.com/CurtizJ)).
- clickhouse-keeper: fix implementation of server with poll. [#52833](https://github.com/ClickHouse/ClickHouse/pull/52833) ([Andy Fiddaman](https://github.com/citrus-it)).
- Make regexp analyzer recognize named capturing groups [#52840](https://github.com/ClickHouse/ClickHouse/pull/52840) ([Han Fei](https://github.com/hanfei1991)).
- Fix possible assert in `~PushingAsyncPipelineExecutor` in clickhouse-local [#52862](https://github.com/ClickHouse/ClickHouse/pull/52862) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix reading of empty `Nested(Array(LowCardinality(...)))` [#52949](https://github.com/ClickHouse/ClickHouse/pull/52949) ([Anton Popov](https://github.com/CurtizJ)).
- Added new tests for session_log and fixed the inconsistency between login and logout. [#52958](https://github.com/ClickHouse/ClickHouse/pull/52958) ([Alexey Gerasimchuck](https://github.com/Demilivor)).
- Fix password leak in show create mysql table [#52962](https://github.com/ClickHouse/ClickHouse/pull/52962) ([Duc Canh Le](https://github.com/canhld94)).
- Convert sparse column format to full in CreateSetAndFilterOnTheFlyStep [#53000](https://github.com/ClickHouse/ClickHouse/pull/53000) ([vdimir](https://github.com/vdimir)).
- Fix rare race condition with empty key prefix directory deletion in fs cache [#53055](https://github.com/ClickHouse/ClickHouse/pull/53055) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Fix ZstdDeflatingWriteBuffer truncating the output sometimes [#53064](https://github.com/ClickHouse/ClickHouse/pull/53064) ([Michael Kolupaev](https://github.com/al13n321)).
- Fix query_id in part_log with async flush queries [#53103](https://github.com/ClickHouse/ClickHouse/pull/53103) ([Raúl Marín](https://github.com/Algunenano)).
- Fix possible error from cache "Read unexpected size" [#53121](https://github.com/ClickHouse/ClickHouse/pull/53121) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Disable the new parquet encoder [#53130](https://github.com/ClickHouse/ClickHouse/pull/53130) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Fix "Not-ready Set" exception [#53162](https://github.com/ClickHouse/ClickHouse/pull/53162) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
- Fix character escaping in the PostgreSQL engine [#53250](https://github.com/ClickHouse/ClickHouse/pull/53250) ([Nikolay Degterinsky](https://github.com/evillique)).
- Experimental session_log table: Added new tests for session_log and fixed the inconsistency between login and logout. [#53255](https://github.com/ClickHouse/ClickHouse/pull/53255) ([Alexey Gerasimchuck](https://github.com/Demilivor)). Fixed inconsistency between login success and logout [#53302](https://github.com/ClickHouse/ClickHouse/pull/53302) ([Alexey Gerasimchuck](https://github.com/Demilivor)).
- Fix adding sub-second intervals to DateTime [#53309](https://github.com/ClickHouse/ClickHouse/pull/53309) ([Michael Kolupaev](https://github.com/al13n321)).
- Fix "Context has expired" error in dictionaries [#53342](https://github.com/ClickHouse/ClickHouse/pull/53342) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Fix incorrect normal projection AST format [#53347](https://github.com/ClickHouse/ClickHouse/pull/53347) ([Amos Bird](https://github.com/amosbird)).
- Forbid use_structure_from_insertion_table_in_table_functions when execute Scalar [#53348](https://github.com/ClickHouse/ClickHouse/pull/53348) ([flynn](https://github.com/ucasfl)).
- Fix loading lazy database during system.table select query [#53372](https://github.com/ClickHouse/ClickHouse/pull/53372) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
- Fixed system.data_skipping_indices for MaterializedMySQL [#53381](https://github.com/ClickHouse/ClickHouse/pull/53381) ([Filipp Ozinov](https://github.com/bakwc)).
- Fix processing single carriage return in TSV file segmentation engine [#53407](https://github.com/ClickHouse/ClickHouse/pull/53407) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix `Context has expired` error properly [#53433](https://github.com/ClickHouse/ClickHouse/pull/53433) ([Michael Kolupaev](https://github.com/al13n321)).
- Fix `timeout_overflow_mode` when having subquery in the rhs of IN [#53439](https://github.com/ClickHouse/ClickHouse/pull/53439) ([Duc Canh Le](https://github.com/canhld94)).
- Fix an unexpected behavior in [#53152](https://github.com/ClickHouse/ClickHouse/issues/53152) [#53440](https://github.com/ClickHouse/ClickHouse/pull/53440) ([Zhiguo Zhou](https://github.com/ZhiguoZh)).
- Fix JSON_QUERY Function parse error while path is all number [#53470](https://github.com/ClickHouse/ClickHouse/pull/53470) ([KevinyhZou](https://github.com/KevinyhZou)).
- Fix wrong columns order for queries with parallel FINAL. [#53489](https://github.com/ClickHouse/ClickHouse/pull/53489) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
- Fixed SELECTing from ReplacingMergeTree with do_not_merge_across_partitions_select_final [#53511](https://github.com/ClickHouse/ClickHouse/pull/53511) ([Vasily Nemkov](https://github.com/Enmk)).
- Flush async insert queue first on shutdown [#53547](https://github.com/ClickHouse/ClickHouse/pull/53547) ([joelynch](https://github.com/joelynch)).
- Fix crash in join on sparse columna [#53548](https://github.com/ClickHouse/ClickHouse/pull/53548) ([vdimir](https://github.com/vdimir)).
- Fix possible UB in Set skipping index for functions with incorrect args [#53559](https://github.com/ClickHouse/ClickHouse/pull/53559) ([Azat Khuzhin](https://github.com/azat)).
- Fix possible UB in inverted indexes (experimental feature) [#53560](https://github.com/ClickHouse/ClickHouse/pull/53560) ([Azat Khuzhin](https://github.com/azat)).
- Fix: interpolate expression takes source column instead of same name aliased from select expression. [#53572](https://github.com/ClickHouse/ClickHouse/pull/53572) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- Fix number of dropped granules in EXPLAIN PLAN index=1 [#53616](https://github.com/ClickHouse/ClickHouse/pull/53616) ([wangxiaobo](https://github.com/wzb5212)).
- Correctly handle totals and extremes with `DelayedSource` [#53644](https://github.com/ClickHouse/ClickHouse/pull/53644) ([Antonio Andelic](https://github.com/antonio2368)).
- Prepared set cache in mutation pipeline stuck [#53645](https://github.com/ClickHouse/ClickHouse/pull/53645) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
- Fix bug on mutations with subcolumns of type JSON in predicates of UPDATE and DELETE queries. [#53677](https://github.com/ClickHouse/ClickHouse/pull/53677) ([VanDarkholme7](https://github.com/VanDarkholme7)).
- Fix filter pushdown for full_sorting_merge join [#53699](https://github.com/ClickHouse/ClickHouse/pull/53699) ([vdimir](https://github.com/vdimir)).
- Try to fix bug with `NULL::LowCardinality(Nullable(...)) NOT IN` [#53706](https://github.com/ClickHouse/ClickHouse/pull/53706) ([Andrey Zvonov](https://github.com/zvonand)).
- Fix: sorted distinct with sparse columns [#53711](https://github.com/ClickHouse/ClickHouse/pull/53711) ([Igor Nikonov](https://github.com/devcrafter)).
- `transform`: correctly handle default column with multiple rows [#53742](https://github.com/ClickHouse/ClickHouse/pull/53742) ([Salvatore Mesoraca](https://github.com/aiven-sal)).
- Fix fuzzer crash in parseDateTime [#53764](https://github.com/ClickHouse/ClickHouse/pull/53764) ([Robert Schulze](https://github.com/rschu1ze)).
- MaterializedPostgreSQL: fix uncaught exception in getCreateTableQueryImpl [#53832](https://github.com/ClickHouse/ClickHouse/pull/53832) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Fix possible segfault while using PostgreSQL engine [#53847](https://github.com/ClickHouse/ClickHouse/pull/53847) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Fix named_collection_admin alias [#54066](https://github.com/ClickHouse/ClickHouse/pull/54066) ([Kseniia Sumarokova](https://github.com/kssenii)).

### <a id="237"></a> ClickHouseリリース23.7、2023-07-27 {#237}

#### 後方互換性のない変更 {#backward-incompatible-change-5}

- `NAMED COLLECTION`アクセスタイプ(エイリアス`USE NAMED COLLECTION`、`NAMED COLLECTION USAGE`)を追加しました。このPRは後方互換性がありません。このアクセスタイプはデフォルトで無効になっているためです(親アクセスタイプ`NAMED COLLECTION ADMIN`もデフォルトで無効になっているため)。[#50277](https://github.com/ClickHouse/ClickHouse/issues/50277)で提案されました。権限を付与するには`GRANT NAMED COLLECTION ON collection_name TO user`または`GRANT NAMED COLLECTION ON * TO user`を使用します。これらの権限を付与するには、設定で`named_collection_admin`が必要です(以前は`named_collection_control`という名前でしたが、エイリアスとして残ります)。[#50625](https://github.com/ClickHouse/ClickHouse/pull/50625) ([Kseniia Sumarokova](https://github.com/kssenii))。
- `system.parts`のカラム名`last_removal_attemp_time`のタイプミスを修正しました。現在は`last_removal_attempt_time`という名前になっています。[#52104](https://github.com/ClickHouse/ClickHouse/pull/52104) ([filimonov](https://github.com/filimonov))。
- distributed_ddl_entry_format_versionのバージョンをデフォルトで5に引き上げました(opentelemetryとinitial_query_iddのパススルーを有効化)。これにより、_ダウングレード_後に分散DDLの既存エントリを処理できなくなります(ただし、通常はそのような未処理エントリは存在しないはずです)。[#52128](https://github.com/ClickHouse/ClickHouse/pull/52128) ([Azat Khuzhin](https://github.com/azat))。
- 通常のメタデータをチェックするのと同じ方法でプロジェクションメタデータをチェックするようにしました。この変更により、無効なプロジェクションを持つテーブルが存在する場合、サーバーの起動が妨げられる可能性があります。例えば、PKで位置指定カラムを作成したプロジェクション(例:`projection p (select * order by 1, 4)`)は、テーブルPKでは許可されておらず、挿入/マージ中にクラッシュを引き起こす可能性があります。更新前にそのようなプロジェクションを削除してください。[#52353](https://github.com/ClickHouse/ClickHouse/issues/52353)を修正しました。[#52361](https://github.com/ClickHouse/ClickHouse/pull/52361) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- バグのため、実験的機能`hashid`を削除しました。実装の品質は当初から疑問視されており、実験的ステータスを脱することができませんでした。これにより[#52406](https://github.com/ClickHouse/ClickHouse/issues/52406)がクローズされます。[#52449](https://github.com/ClickHouse/ClickHouse/pull/52449) ([Alexey Milovidov](https://github.com/alexey-milovidov))。


#### 新機能 {#new-feature-5}

- 複数のデータベースを1つに統合する`Overlay`データベースエンジンを追加しました。ファイルシステム内のディレクトリを、フォーマットと構造が自動検出される暗黙的に利用可能なテーブルのセットとして表現する`Filesystem`データベースエンジンを追加しました。新しい`S3`データベースエンジンにより、プレフィックスをテーブルのセットとして表現することで、S3ストレージと読み取り専用で対話できるようになりました。新しい`HDFS`データベースエンジンにより、同様の方法でHDFSストレージと対話できるようになりました。[#48821](https://github.com/ClickHouse/ClickHouse/pull/48821) ([alekseygolub](https://github.com/alekseygolub))。
- Keeperにおいて、スナップショットとログを保存するための外部ディスクのサポートを追加しました。[#50098](https://github.com/ClickHouse/ClickHouse/pull/50098) ([Antonio Andelic](https://github.com/antonio2368))。
- 複数ディレクトリ選択(`{}`)グロブのサポートを追加しました。[#50559](https://github.com/ClickHouse/ClickHouse/pull/50559) ([Andrey Zvonov](https://github.com/zvonand))。
- Kafkaコネクタが、URLエンコードされた認証情報を使用したベーシック認証により、スキーマレジストリからAvroスキーマを取得できるようになりました。[#49664](https://github.com/ClickHouse/ClickHouse/pull/49664) ([Ilya Golshtein](https://github.com/ilejn))。
- 2つの配列間のJaccard類似度を計算する`arrayJaccardIndex`関数を追加しました。[#50076](https://github.com/ClickHouse/ClickHouse/pull/50076) ([FFFFFFFHHHHHHH](https://github.com/FFFFFFFHHHHHHH))。
- `system.settings`および類似のテーブルに`is_obsolete`カラムを追加しました。解決: [#50819](https://github.com/ClickHouse/ClickHouse/issues/50819)。[#50826](https://github.com/ClickHouse/ClickHouse/pull/50826) ([flynn](https://github.com/ucasfl))。
- 設定ファイル内の暗号化要素のサポートを実装しました。設定ファイルのリーフ要素で暗号化されたテキストを使用できるようになりました。テキストは`<encryption_codecs>`セクションの暗号化コーデックを使用して暗号化されます。[#50986](https://github.com/ClickHouse/ClickHouse/pull/50986) ([Roman Vasin](https://github.com/rvasin))。
- Grace Hash Joinアルゴリズムが、FULLおよびRIGHT JOINに適用可能になりました。[#49483](https://github.com/ClickHouse/ClickHouse/issues/49483)。[#51013](https://github.com/ClickHouse/ClickHouse/pull/51013) ([lgbo](https://github.com/lgbo-ustc))。
- より適切な終了のための`SYSTEM STOP LISTEN`クエリを追加しました。解決: [#47972](https://github.com/ClickHouse/ClickHouse/issues/47972)。[#51016](https://github.com/ClickHouse/ClickHouse/pull/51016) ([Nikolay Degterinsky](https://github.com/evillique))。
- `input_format_csv_allow_variable_number_of_columns`オプションを追加しました。[#51273](https://github.com/ClickHouse/ClickHouse/pull/51273) ([Dmitry Kardymon](https://github.com/kardymonds))。
- さらなる機能追加: SparkやMySQLと同様の`substring_index`関数を追加しました。[#51472](https://github.com/ClickHouse/ClickHouse/pull/51472) ([李扬](https://github.com/taiyang-li))。
- jemallocビンの統計情報を表示するシステムテーブル`jemalloc_bins`を追加しました。例: `SELECT *, size * (nmalloc - ndalloc) AS allocated_bytes FROM system.jemalloc_bins WHERE allocated_bytes > 0 ORDER BY allocated_bytes DESC LIMIT 10`。ご活用ください。[#51674](https://github.com/ClickHouse/ClickHouse/pull/51674) ([Alexander Gololobov](https://github.com/davenger))。
- 各カラムの前に、カラムのデフォルト値を使用するためのフラグとして追加のバイトを持つ`RowBinaryWithDefaults`フォーマットを追加しました。解決: [#50854](https://github.com/ClickHouse/ClickHouse/issues/50854)。[#51695](https://github.com/ClickHouse/ClickHouse/pull/51695) ([Kruglov Pavel](https://github.com/Avogar))。
- `default_temporary_table_engine`設定を追加しました。`default_table_engine`と同様ですが、一時テーブル用です。[#51292](https://github.com/ClickHouse/ClickHouse/issues/51292)。[#51708](https://github.com/ClickHouse/ClickHouse/pull/51708) ([velavokr](https://github.com/velavokr))。
- 各単語の最初の文字を大文字に、残りを小文字に変換する新しい`initcap` / `initcapUTF8`関数を追加しました。[#51735](https://github.com/ClickHouse/ClickHouse/pull/51735) ([Dmitry Kardymon](https://github.com/kardymonds))。
- テーブル作成時に、カラム定義内で`PRIMARY KEY`構文がサポートされるようになりました。カラムは定義された順序でプライマリインデックスに追加されます。[#51881](https://github.com/ClickHouse/ClickHouse/pull/51881) ([Ilya Yatsishin](https://github.com/qoega))。
- ログおよびエラーログファイル名に日付と時刻のフォーマット指定子を使用できるようになりました。設定ファイル(`log`および`errorlog`タグ)またはコマンドライン引数(`--log-file`および`--errorlog-file`)のいずれかで指定できます。[#51945](https://github.com/ClickHouse/ClickHouse/pull/51945) ([Victor Krasnov](https://github.com/sirvickr))。
- HTTPヘッダーにピークメモリ使用量の統計情報を追加しました。[#51946](https://github.com/ClickHouse/ClickHouse/pull/51946) ([Dmitry Kardymon](https://github.com/kardymonds))。
- 文字列内の部分列をマッチングする新しい`hasSubsequence`関数(`CaseInsensitive`および`UTF8`バージョンを含む)を追加しました。[#52050](https://github.com/ClickHouse/ClickHouse/pull/52050) ([Dmitry Kardymon](https://github.com/kardymonds))。
- PostgreSQL互換性のため、`groupArray`のエイリアスとして`array_agg`を追加しました。解決: [#52100](https://github.com/ClickHouse/ClickHouse/issues/52100)。### ユーザー向け変更のドキュメントエントリ。[#52135](https://github.com/ClickHouse/ClickHouse/pull/52135) ([flynn](https://github.com/ucasfl))。
- `any`集約関数の互換性エイリアスとして`any_value`を追加しました。解決: [#52140](https://github.com/ClickHouse/ClickHouse/issues/52140)。[#52147](https://github.com/ClickHouse/ClickHouse/pull/52147) ([flynn](https://github.com/ucasfl))。
- BigQuery互換性のため、集約関数`array_concat_agg`を追加しました。これは`groupArrayArray`のエイリアスです。解決: [#52139](https://github.com/ClickHouse/ClickHouse/issues/52139)。[#52149](https://github.com/ClickHouse/ClickHouse/pull/52149) ([flynn](https://github.com/ucasfl))。
- `length`のエイリアスとして`OCTET_LENGTH`を追加しました。解決: [#52153](https://github.com/ClickHouse/ClickHouse/issues/52153)。[#52176](https://github.com/ClickHouse/ClickHouse/pull/52176) ([FFFFFFFHHHHHHH](https://github.com/FFFFFFFHHHHHHH))。
- 複数行の文字列から最初の行を抽出する`firstLine`関数を追加しました。これにより解決: [#51172](https://github.com/ClickHouse/ClickHouse/issues/51172)。[#52209](https://github.com/ClickHouse/ClickHouse/pull/52209) ([Mikhail Koviazin](https://github.com/mkmkme))。
- `Interval`データ型のKQLスタイルフォーマットを実装しました。これは`Kusto`クエリ言語との互換性のためにのみ必要です。[#45671](https://github.com/ClickHouse/ClickHouse/pull/45671) ([ltrk2](https://github.com/ltrk2))。
- すべての保留中の非同期挿入を宛先テーブルにフラッシュする`SYSTEM FLUSH ASYNC INSERT QUEUE`クエリを追加しました。グレースフルシャットダウン時に非同期挿入のキューをフラッシュするかどうかを決定するサーバー側設定`async_insert_queue_flush_on_shutdown`(デフォルトは`true`)を追加しました。設定`async_insert_threads`はサーバー側設定になりました。[#49160](https://github.com/ClickHouse/ClickHouse/pull/49160) ([Anton Popov](https://github.com/CurtizJ))。
- PostgreSQL互換性のため、エイリアス`current_database`と新しい関数`current_schemas`を追加しました。[#51076](https://github.com/ClickHouse/ClickHouse/pull/51076) ([Pedro Riera](https://github.com/priera))。
- 関数`today`(`curdate`/`current_date`という名前で利用可能)および`now`(`current_timestamp`)のエイリアスを追加しました。[#52106](https://github.com/ClickHouse/ClickHouse/pull/52106) ([Lloyd-Pottiger](https://github.com/Lloyd-Pottiger))。
- 非同期挿入における`async_deduplication_token`のサポートを追加しました。[#52136](https://github.com/ClickHouse/ClickHouse/pull/52136) ([Han Fei](https://github.com/hanfei1991))。
- URLエンジンにおいてURI内のパスのデコード/エンコードを無効化できる新しい設定`disable_url_encoding`を追加しました。[#52337](https://github.com/ClickHouse/ClickHouse/pull/52337) ([Kruglov Pavel](https://github.com/Avogar))。





#### パフォーマンス改善 {#performance-improvement-5}

- スパースシリアライゼーション形式の自動選択をデフォルトで有効化しました。これによりパフォーマンスが向上します。この形式はバージョン22.1以降でサポートされています。この変更後、22.1より古いバージョンへのダウングレードができない可能性があります。ダウングレードには`ratio_of_defaults_for_sparse_serialization=0.9375`の設定が必要になる場合があります [55153](https://github.com/ClickHouse/ClickHouse/issues/55153)。MergeTreeテーブルに`ratio_of_defaults_for_sparse_serialization = 1`設定を指定することで、スパースシリアライゼーション形式の使用を無効化できます。[#49631](https://github.com/ClickHouse/ClickHouse/pull/49631) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `move_all_conditions_to_prewhere`および`enable_multiple_prewhere_read_steps`設定をデフォルトで有効化しました。[#46365](https://github.com/ClickHouse/ClickHouse/pull/46365) ([Alexander Gololobov](https://github.com/davenger))。
- アロケータのチューニングにより一部のクエリのパフォーマンスを改善しました。[#46416](https://github.com/ClickHouse/ClickHouse/pull/46416) ([Azat Khuzhin](https://github.com/azat))。
- `MergeTreeReadPool`と同様に、`MergeTreePrefetchedReadPool`で固定サイズタスクを使用するようになりました。また、S3リクエストに対してコネクションプールを使用するようになりました。[#49732](https://github.com/ClickHouse/ClickHouse/pull/49732) ([Nikita Taranov](https://github.com/nickitat))。
- 結合の右側へのプッシュダウンを強化しました。[#50532](https://github.com/ClickHouse/ClickHouse/pull/50532) ([Nikita Taranov](https://github.com/nickitat))。
- ハッシュテーブルのサイズを事前確保することでgrace_hash結合を改善しました(再投稿)。[#50875](https://github.com/ClickHouse/ClickHouse/pull/50875) ([lgbo](https://github.com/lgbo-ustc))。
- `OpenedFileCache`でのロック待機が顕著になることがありました。競合を回避するため、複数のサブマップ(それぞれが独自のロックを持つ)にシャーディングしました。[#51341](https://github.com/ClickHouse/ClickHouse/pull/51341) ([Nikita Taranov](https://github.com/nickitat))。
- プライマリキー列を含む条件をPREWHEREチェーンの末尾に移動しました。PK列を含む条件はPK分析で使用される可能性が高く、PREWHEREフィルタリングにはあまり貢献しないという考えに基づいています。[#51958](https://github.com/ClickHouse/ClickHouse/pull/51958) ([Alexander Gololobov](https://github.com/davenger))。
- SipHashのインライン化により、String型に対する`COUNT(DISTINCT)`を高速化しました。ICXデバイス(Intel Xeon Platinum 8380 CPU、80コア、160スレッド)での_OnTime_のパフォーマンス実験では、この変更によりクエリ_Q8_のQPSが_11.6%_向上し、他のクエリには影響がないことが示されました。[#52036](https://github.com/ClickHouse/ClickHouse/pull/52036) ([Zhiguo Zhou](https://github.com/ZhiguoZh))。
- `allow_vertical_merges_from_compact_to_wide_parts`をデフォルトで有効化しました。これによりマージ中のメモリ使用量が削減されます。[#52295](https://github.com/ClickHouse/ClickHouse/pull/52295) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- プライマリキーを無効化する不正なプロジェクション分析を修正しました。この問題は`query_plan_optimize_primary_key = 1, query_plan_optimize_projection = 1`の場合にのみ発生します。これにより [#48823](https://github.com/ClickHouse/ClickHouse/issues/48823) が修正されます。これにより [#51173](https://github.com/ClickHouse/ClickHouse/issues/51173) が修正されます。[#52308](https://github.com/ClickHouse/ClickHouse/pull/52308) ([Amos Bird](https://github.com/amosbird))。
- `FileCache::loadMetadata`でのシステムコール数を削減しました - これによりファイルシステムキャッシュが設定されている場合のサーバー起動が高速化されます。[#52435](https://github.com/ClickHouse/ClickHouse/pull/52435) ([Raúl Marín](https://github.com/Algunenano))。
- 残りのデータをバックグラウンドでダウンロードすることで、ファイルセグメントサイズの厳密な下限を設定できるようにしました。ファイルセグメントの最小サイズ(実際のファイルサイズがそれより大きい場合)は、キャッシュ設定`boundary_alignment`で設定され、デフォルトは`4Mi`です。バックグラウンドスレッド数は、キャッシュ設定`background_download_threads`で設定され、デフォルトは`2`です。また、このPRで`max_file_segment_size`を`8Mi`から`32Mi`に増加しました。[#51000](https://github.com/ClickHouse/ClickHouse/pull/51000) ([Kseniia Sumarokova](https://github.com/kssenii))。
- S3のデフォルトタイムアウトを30秒から3秒に、その他のHTTPのデフォルトタイムアウトを180秒から30秒に短縮しました。[#51171](https://github.com/ClickHouse/ClickHouse/pull/51171) ([Michael Kolupaev](https://github.com/al13n321))。
- 新しい設定`merge_tree_determine_task_size_by_prewhere_columns`を追加しました。`true`に設定すると、読み取りタスクサイズの決定には`PREWHERE`セクションの列のサイズのみが考慮されます。それ以外の場合は、クエリのすべての列が考慮されます。[#52606](https://github.com/ClickHouse/ClickHouse/pull/52606) ([Nikita Taranov](https://github.com/nickitat))。





#### 改善 {#improvement-5}

- Use read_bytes/total_bytes_to_read for progress bar in s3/file/url/... table functions for better progress indication. [#51286](https://github.com/ClickHouse/ClickHouse/pull/51286) ([Kruglov Pavel](https://github.com/Avogar)).
- Introduce a table setting `wait_for_unique_parts_send_before_shutdown_ms` which specify the amount of time replica will wait before closing interserver handler for replicated sends. Also fix inconsistency with shutdown of tables and interserver handlers: now server shutdown tables first and only after it shut down interserver handlers. [#51851](https://github.com/ClickHouse/ClickHouse/pull/51851) ([alesapin](https://github.com/alesapin)).
- Allow SQL standard `FETCH` without `OFFSET`. See https://antonz.org/sql-fetch/. [#51293](https://github.com/ClickHouse/ClickHouse/pull/51293) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Allow filtering HTTP headers for the URL/S3 table functions with the new `http_forbid_headers` section in config. Both exact matching and regexp filters are available. [#51038](https://github.com/ClickHouse/ClickHouse/pull/51038) ([Nikolay Degterinsky](https://github.com/evillique)).
- Don't show messages about `16 EiB` free space in logs, as they don't make sense. This closes [#49320](https://github.com/ClickHouse/ClickHouse/issues/49320). [#49342](https://github.com/ClickHouse/ClickHouse/pull/49342) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Properly check the limit for the `sleepEachRow` function. Add a setting `function_sleep_max_microseconds_per_block`. This is needed for generic query fuzzer. [#49343](https://github.com/ClickHouse/ClickHouse/pull/49343) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Fix two issues in `geoHash` functions. [#50066](https://github.com/ClickHouse/ClickHouse/pull/50066) ([李扬](https://github.com/taiyang-li)).
- Log async insert flush queries into `system.query_log`. [#51160](https://github.com/ClickHouse/ClickHouse/pull/51160) ([Raúl Marín](https://github.com/Algunenano)).
- Functions `date_diff` and `age` now support millisecond/microsecond unit and work with microsecond precision. [#51291](https://github.com/ClickHouse/ClickHouse/pull/51291) ([Dmitry Kardymon](https://github.com/kardymonds)).
- Improve parsing of path in clickhouse-keeper-client. [#51359](https://github.com/ClickHouse/ClickHouse/pull/51359) ([Azat Khuzhin](https://github.com/azat)).
- A third-party product depending on ClickHouse (Gluten: a Plugin to Double Spark SQL's Performance) had a bug. This fix avoids heap overflow in that third-party product while reading from HDFS. [#51386](https://github.com/ClickHouse/ClickHouse/pull/51386) ([李扬](https://github.com/taiyang-li)).
- Add ability to disable native copy for S3 (setting for BACKUP/RESTORE `allow_s3_native_copy`, and `s3_allow_native_copy` for `s3`/`s3_plain` disks). [#51448](https://github.com/ClickHouse/ClickHouse/pull/51448) ([Azat Khuzhin](https://github.com/azat)).
- Add column `primary_key_size` to `system.parts` table to show compressed primary key size on disk. Closes [#51400](https://github.com/ClickHouse/ClickHouse/issues/51400). [#51496](https://github.com/ClickHouse/ClickHouse/pull/51496) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
- Allow running `clickhouse-local` without procfs, without home directory existing, and without name resolution plugins from glibc. [#51518](https://github.com/ClickHouse/ClickHouse/pull/51518) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Add placeholder `%a` for rull filename in rename_files_after_processing setting. [#51603](https://github.com/ClickHouse/ClickHouse/pull/51603) ([Kruglov Pavel](https://github.com/Avogar)).
- Add column `modification_time` into `system.parts_columns`. [#51685](https://github.com/ClickHouse/ClickHouse/pull/51685) ([Azat Khuzhin](https://github.com/azat)).
- Add new setting `input_format_csv_use_default_on_bad_values` to CSV format that allows to insert default value when parsing of a single field failed. [#51716](https://github.com/ClickHouse/ClickHouse/pull/51716) ([KevinyhZou](https://github.com/KevinyhZou)).
- Added a crash log flush to the disk after the unexpected crash. [#51720](https://github.com/ClickHouse/ClickHouse/pull/51720) ([Alexey Gerasimchuck](https://github.com/Demilivor)).
- Fix behavior in dashboard page where errors unrelated to authentication are not shown. Also fix 'overlapping' chart behavior. [#51744](https://github.com/ClickHouse/ClickHouse/pull/51744) ([Zach Naimon](https://github.com/ArctypeZach)).
- Allow UUID to UInt128 conversion. [#51765](https://github.com/ClickHouse/ClickHouse/pull/51765) ([Dmitry Kardymon](https://github.com/kardymonds)).
- Added support for function `range` of Nullable arguments. [#51767](https://github.com/ClickHouse/ClickHouse/pull/51767) ([Dmitry Kardymon](https://github.com/kardymonds)).
- Convert condition like `toyear(x) = c` to `c1 <= x < c2`. [#51795](https://github.com/ClickHouse/ClickHouse/pull/51795) ([Han Fei](https://github.com/hanfei1991)).
- Improve MySQL compatibility of the statement `SHOW INDEX`. [#51796](https://github.com/ClickHouse/ClickHouse/pull/51796) ([Robert Schulze](https://github.com/rschu1ze)).
- Fix `use_structure_from_insertion_table_in_table_functions` does not work with `MATERIALIZED` and `ALIAS` columns. Closes [#51817](https://github.com/ClickHouse/ClickHouse/issues/51817). Closes [#51019](https://github.com/ClickHouse/ClickHouse/issues/51019). [#51825](https://github.com/ClickHouse/ClickHouse/pull/51825) ([flynn](https://github.com/ucasfl)).
- Cache dictionary now requests only unique keys from source. Closes [#51762](https://github.com/ClickHouse/ClickHouse/issues/51762). [#51853](https://github.com/ClickHouse/ClickHouse/pull/51853) ([Maksim Kita](https://github.com/kitaisreal)).
- Fixed the case when settings were not applied for EXPLAIN query when FORMAT was provided. [#51859](https://github.com/ClickHouse/ClickHouse/pull/51859) ([Nikita Taranov](https://github.com/nickitat)).
- Allow SETTINGS before FORMAT in DESCRIBE TABLE query for compatibility with SELECT query. Closes [#51544](https://github.com/ClickHouse/ClickHouse/issues/51544). [#51899](https://github.com/ClickHouse/ClickHouse/pull/51899) ([Nikolay Degterinsky](https://github.com/evillique)).
- Var-Int encoded integers (e.g. used by the native protocol) can now use the full 64-bit range. 3rd party clients are advised to update their var-int code accordingly. [#51905](https://github.com/ClickHouse/ClickHouse/pull/51905) ([Robert Schulze](https://github.com/rschu1ze)).
- Update certificates when they change without the need to manually SYSTEM RELOAD CONFIG. [#52030](https://github.com/ClickHouse/ClickHouse/pull/52030) ([Mike Kot](https://github.com/myrrc)).
- Added `allow_create_index_without_type` setting that allow to ignore `ADD INDEX` queries without specified `TYPE`. Standard SQL queries will just succeed without changing table schema. [#52056](https://github.com/ClickHouse/ClickHouse/pull/52056) ([Ilya Yatsishin](https://github.com/qoega)).
- Log messages are written to the `system.text_log` from the server startup. [#52113](https://github.com/ClickHouse/ClickHouse/pull/52113) ([Dmitry Kardymon](https://github.com/kardymonds)).
- In cases where the HTTP endpoint has multiple IP addresses and the first of them is unreachable, a timeout exception was thrown. Made session creation with handling all resolved endpoints. [#52116](https://github.com/ClickHouse/ClickHouse/pull/52116) ([Aleksei Filatov](https://github.com/aalexfvk)).
- Avro input format now supports Union even if it contains only a single type. Closes [#52131](https://github.com/ClickHouse/ClickHouse/issues/52131). [#52137](https://github.com/ClickHouse/ClickHouse/pull/52137) ([flynn](https://github.com/ucasfl)).
- Add setting `optimize_use_implicit_projections` to disable implicit projections (currently only `min_max_count` projection). [#52152](https://github.com/ClickHouse/ClickHouse/pull/52152) ([Amos Bird](https://github.com/amosbird)).
- It was possible to use the function `hasToken` for infinite loop. Now this possibility is removed. This closes [#52156](https://github.com/ClickHouse/ClickHouse/issues/52156). [#52160](https://github.com/ClickHouse/ClickHouse/pull/52160) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Create ZK ancestors optimistically. [#52195](https://github.com/ClickHouse/ClickHouse/pull/52195) ([Raúl Marín](https://github.com/Algunenano)).
- Fix [#50582](https://github.com/ClickHouse/ClickHouse/issues/50582). Avoid the `Not found column ... in block` error in some cases of reading in-order and constants. [#52259](https://github.com/ClickHouse/ClickHouse/pull/52259) ([Chen768959](https://github.com/Chen768959)).
- Check whether S2 geo primitives are invalid as early as possible on ClickHouse side. This closes: [#27090](https://github.com/ClickHouse/ClickHouse/issues/27090). [#52260](https://github.com/ClickHouse/ClickHouse/pull/52260) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
- Add back missing projection QueryAccessInfo when `query_plan_optimize_projection = 1`. This fixes [#50183](https://github.com/ClickHouse/ClickHouse/issues/50183) . This fixes [#50093](https://github.com/ClickHouse/ClickHouse/issues/50093). [#52327](https://github.com/ClickHouse/ClickHouse/pull/52327) ([Amos Bird](https://github.com/amosbird)).
- When `ZooKeeperRetriesControl` rethrows an error, it's more useful to see its original stack trace, not the one from `ZooKeeperRetriesControl` itself. [#52347](https://github.com/ClickHouse/ClickHouse/pull/52347) ([Vitaly Baranov](https://github.com/vitlibar)).
- Wait for zero copy replication lock even if some disks don't support it. [#52376](https://github.com/ClickHouse/ClickHouse/pull/52376) ([Raúl Marín](https://github.com/Algunenano)).
- Now interserver port will be closed only after tables are shut down. [#52498](https://github.com/ClickHouse/ClickHouse/pull/52498) ([alesapin](https://github.com/alesapin)).

#### 実験的機能 {#experimental-feature-2}

- Parquetファイルの書き込みが10倍高速化され、マルチスレッド対応になりました。読み込みとほぼ同等の速度です。[#49367](https://github.com/ClickHouse/ClickHouse/pull/49367) ([Michael Kolupaev](https://github.com/al13n321))。この機能は設定`output_format_parquet_use_custom_encoder`で制御されますが、機能が完全ではないためデフォルトでは無効になっています。
- クエリ言語として[PRQL](https://prql-lang.org/)のサポートを追加しました。[#50686](https://github.com/ClickHouse/ClickHouse/pull/50686) ([János Benjamin Antal](https://github.com/antaljanosbenjamin))。
- カスタムディスクにディスク名を追加できるようになりました。以前はカスタムディスクは内部生成されたディスク名を使用していましたが、現在は`disk = disk_<name>(...)`の形式で指定可能です(例: ディスク名は`name`になります)。[#51552](https://github.com/ClickHouse/ClickHouse/pull/51552) ([Kseniia Sumarokova](https://github.com/kssenii))。この構文は本リリースで変更される可能性があります。
- (実験的なMaterializedMySQL) 切断後に`mysqlxx::Pool::Entry`が使用された際のクラッシュを修正しました。[#52063](https://github.com/ClickHouse/ClickHouse/pull/52063) ([Val Doroshchuk](https://github.com/valbok))。
- (実験的なMaterializedMySQL) MaterializedMySQLで`CREATE TABLE ... AS SELECT`がサポートされるようになりました。[#52067](https://github.com/ClickHouse/ClickHouse/pull/52067) ([Val Doroshchuk](https://github.com/valbok))。
- (実験的なMaterializedMySQL) MaterializedMySQLでテキスト型からUTF-8への自動変換を導入しました。[#52084](https://github.com/ClickHouse/ClickHouse/pull/52084) ([Val Doroshchuk](https://github.com/valbok))。
- (実験的なMaterializedMySQL) MaterializedMySQLのDDLでクォートなしのUTF-8文字列がサポートされるようになりました。[#52318](https://github.com/ClickHouse/ClickHouse/pull/52318) ([Val Doroshchuk](https://github.com/valbok))。
- (実験的なMaterializedMySQL) MaterializedMySQLでダブルクォートで囲まれたコメントがサポートされるようになりました。[#52355](https://github.com/ClickHouse/ClickHouse/pull/52355) ([Val Doroshchuk](https://github.com/valbok))。
- Intel QPLをv1.1.0からv1.2.0にアップグレードしました。Intel accel-configをv3.5からv4.0にアップグレードしました。IAAアクセラレータにおいてDevice IOTLBミスが大きなパフォーマンス影響を与える問題を修正しました。[#52180](https://github.com/ClickHouse/ClickHouse/pull/52180) ([jasperzhu](https://github.com/jinjunzh))。
- `session_timezone`設定(バージョン23.6で新規追加)が実験的機能に降格されました。[#52445](https://github.com/ClickHouse/ClickHouse/pull/52445) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ClickHouse KeeperでZooKeeperの`reconfig`コマンドをサポートし、`keeper_server.enable_reconfiguration`設定で有効化できる段階的な再構成に対応しました。サーバーの追加、削除、およびサーバー優先度の変更をサポートします。[#49450](https://github.com/ClickHouse/ClickHouse/pull/49450) ([Mike Kot](https://github.com/myrrc))。この機能は不完全である可能性があります。


#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-5}

- CIにLinux RISC-V 64向けの実験的なClickHouseビルドを追加しました。[#31398](https://github.com/ClickHouse/ClickHouse/pull/31398) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- Analyzerを有効にした統合テストチェックを追加しました。[#50926](https://github.com/ClickHouse/ClickHouse/pull/50926) [#52210](https://github.com/ClickHouse/ClickHouse/pull/52210) ([Dmitry Novik](https://github.com/novikd))。
- Rustの再現可能なビルドを実装しました。[#52395](https://github.com/ClickHouse/ClickHouse/pull/52395) ([Azat Khuzhin](https://github.com/azat))。
- Cargoの依存関係を更新しました。[#51721](https://github.com/ClickHouse/ClickHouse/pull/51721) ([Raúl Marín](https://github.com/Algunenano))。
- 関数`CHColumnToArrowColumn::fillArrowArrayWithArrayColumnData`をnull許容配列で動作するようにしました。これはClickHouseでは使用できませんが、Glutenに必要です。[#52112](https://github.com/ClickHouse/ClickHouse/pull/52112) ([李扬](https://github.com/taiyang-li))。
- CCTZライブラリをmasterに更新しましたが、ユーザーに影響する変更はありません。[#52124](https://github.com/ClickHouse/ClickHouse/pull/52124) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `system.licenses`テーブルにハードフォークされたライブラリPocoが含まれるようになりました。これにより[#52066](https://github.com/ClickHouse/ClickHouse/issues/52066)が解決されます。[#52127](https://github.com/ClickHouse/ClickHouse/pull/52127) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 不適切な句読点がないことを確認します:カンマの前の空白(`Hello, world`ではなく`Hello ,world`のような)。[#52549](https://github.com/ClickHouse/ClickHouse/pull/52549) ([Alexey Milovidov](https://github.com/alexey-milovidov))。


#### バグ修正（公式安定版リリースにおけるユーザーに影響する不具合） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-5}

- MaterializedPostgreSQLのsyncTablesを修正 [#49698](https://github.com/ClickHouse/ClickHouse/pull/49698) ([Kseniia Sumarokova](https://github.com/kssenii)).
- optimize_aggregators_of_group_by_keysを使用したプロジェクションを修正 [#49709](https://github.com/ClickHouse/ClickHouse/pull/49709) ([Amos Bird](https://github.com/amosbird)).
- JOINを使用したoptimize_skip_unused_shardsを修正 [#51037](https://github.com/ClickHouse/ClickHouse/pull/51037) ([Azat Khuzhin](https://github.com/azat)).
- 小数部を持つ負のdatetime64でのformatDateTime()を修正 [#51290](https://github.com/ClickHouse/ClickHouse/pull/51290) ([Dmitry Kardymon](https://github.com/kardymonds)).
- `hasToken*`関数が完全に誤っていた問題を修正。[#43358](https://github.com/ClickHouse/ClickHouse/issues/43358)のテストを追加 [#51378](https://github.com/ClickHouse/ClickHouse/pull/51378) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- ソート前に関数を移動する最適化を修正 [#51481](https://github.com/ClickHouse/ClickHouse/pull/51481) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
- FINALのPipe::unitePipesにおけるBlock構造の不一致を修正 [#51492](https://github.com/ClickHouse/ClickHouse/pull/51492) ([Nikita Taranov](https://github.com/nickitat)).
- 全シャードでウェイトがゼロのクラスタでのSIGSEGVを修正(INSERT INTO FUNCTION clusterAllReplicas()を修正) [#51545](https://github.com/ClickHouse/ClickHouse/pull/51545) ([Azat Khuzhin](https://github.com/azat)).
- ヘッジリクエストのタイムアウトを修正 [#51582](https://github.com/ClickHouse/ClickHouse/pull/51582) ([Azat Khuzhin](https://github.com/azat)).
- NULLを使用したANTI結合での論理エラーを修正 [#51601](https://github.com/ClickHouse/ClickHouse/pull/51601) ([vdimir](https://github.com/vdimir)).
- 'IN'条件をPREWHEREに移動する際の修正 [#51610](https://github.com/ClickHouse/ClickHouse/pull/51610) ([Alexander Gololobov](https://github.com/davenger)).
- ASOF/ANTI結合にPredicateExpressionsOptimizerを適用しないように修正 [#51633](https://github.com/ClickHouse/ClickHouse/pull/51633) ([vdimir](https://github.com/vdimir)).
- マージアルゴリズムを使用したReplicatedMergeTreeの重複排除を伴う非同期挿入を修正 [#51676](https://github.com/ClickHouse/ClickHouse/pull/51676) ([Antonio Andelic](https://github.com/antonio2368)).
- `parseSipHashKey`での空のカラムからの読み取りを修正 [#51804](https://github.com/ClickHouse/ClickHouse/pull/51804) ([Nikita Taranov](https://github.com/nickitat)).
- 無効なEmbeddedRocksdbテーブル作成時のセグメンテーション違反を修正 [#51847](https://github.com/ClickHouse/ClickHouse/pull/51847) ([Duc Canh Le](https://github.com/canhld94)).
- MongoDBテーブルへの挿入を修正 [#51876](https://github.com/ClickHouse/ClickHouse/pull/51876) ([Nikolay Degterinsky](https://github.com/evillique)).
- DatabaseCatalogシャットダウン時のデッドロックを修正 [#51908](https://github.com/ClickHouse/ClickHouse/pull/51908) ([Alexander Tokmakov](https://github.com/tavplubix)).
- サブクエリ演算子のエラーを修正 [#51922](https://github.com/ClickHouse/ClickHouse/pull/51922) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- 複数のIPを持つホストへの非同期接続を修正 [#51934](https://github.com/ClickHouse/ClickHouse/pull/51934) ([Kruglov Pavel](https://github.com/Avogar)).
- ActionsDAG::merge後に入力を削除しないように修正 [#51947](https://github.com/ClickHouse/ClickHouse/pull/51947) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
- `execute`ではなく`RemoveManyObjectStorageOperation::finalize`で参照カウントをチェックするように修正 [#51954](https://github.com/ClickHouse/ClickHouse/pull/51954) ([vdimir](https://github.com/vdimir)).
- パラメトリックUDFを許可 [#51964](https://github.com/ClickHouse/ClickHouse/pull/51964) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- 2283-12-31以降の日付に対するtoDateTime64()の小さな修正 [#52130](https://github.com/ClickHouse/ClickHouse/pull/52130) ([Andrey Zvonov](https://github.com/zvonand)).
- WINDOW関数のタプルによるORDER BYを修正 [#52145](https://github.com/ClickHouse/ClickHouse/pull/52145) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- 集約式に単調関数が含まれる場合の誤ったプロジェクション分析を修正 [#52151](https://github.com/ClickHouse/ClickHouse/pull/52151) ([Amos Bird](https://github.com/amosbird)).
- `groupArrayMoving`関数のエラーを修正 [#52161](https://github.com/ClickHouse/ClickHouse/pull/52161) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- 範囲ディクショナリのダイレクト結合を無効化 [#52187](https://github.com/ClickHouse/ClickHouse/pull/52187) ([Duc Canh Le](https://github.com/canhld94)).
- スティッキーミューテーションテスト(および極めて稀な競合状態)を修正 [#52197](https://github.com/ClickHouse/ClickHouse/pull/52197) ([alesapin](https://github.com/alesapin)).
- Webディスクでの競合状態を修正 [#52211](https://github.com/ClickHouse/ClickHouse/pull/52211) ([Kseniia Sumarokova](https://github.com/kssenii)).
- サーバーからの未知のパケットに対するConnection::setAsyncCallbackでのデータ競合を修正 [#52219](https://github.com/ClickHouse/ClickHouse/pull/52219) ([Kruglov Pavel](https://github.com/Avogar)).
- 起動時の一時データ削除を修正し、テストを追加 [#52275](https://github.com/ClickHouse/ClickHouse/pull/52275) ([vdimir](https://github.com/vdimir)).
- NULL許容カラムをカウントする際にminmax_countプロジェクションを使用しないように修正 [#52297](https://github.com/ClickHouse/ClickHouse/pull/52297) ([Amos Bird](https://github.com/amosbird)).
- MergeTree/ReplicatedMergeTreeがログエントリにサーバータイムゾーンを使用するように修正 [#52325](https://github.com/ClickHouse/ClickHouse/pull/52325) ([Azat Khuzhin](https://github.com/azat)).
- CTEと複数回使用を伴うパラメータ化ビューを修正 [#52328](https://github.com/ClickHouse/ClickHouse/pull/52328) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
- 時間間隔の式テンプレートを無効化 [#52335](https://github.com/ClickHouse/ClickHouse/pull/52335) ([Alexander Tokmakov](https://github.com/tavplubix)).
- Keeperの`apply_snapshot`を修正 [#52358](https://github.com/ClickHouse/ClickHouse/pull/52358) ([Antonio Andelic](https://github.com/antonio2368)).
- build-osx.mdを更新 [#52377](https://github.com/ClickHouse/ClickHouse/pull/52377) ([AlexBykovski](https://github.com/AlexBykovski)).
- 空のneedleとカラムhaystackでの`countSubstrings`のハングを修正 [#52409](https://github.com/ClickHouse/ClickHouse/pull/52409) ([Sergei Trifonov](https://github.com/serxa)).
- マージテーブルでの通常のプロジェクションを修正 [#52432](https://github.com/ClickHouse/ClickHouse/pull/52432) ([Amos Bird](https://github.com/amosbird)).
- Aggregatorでの二重解放の可能性を修正 [#52439](https://github.com/ClickHouse/ClickHouse/pull/52439) ([Nikita Taranov](https://github.com/nickitat)).
- Bufferエンジンへの挿入を修正 [#52440](https://github.com/ClickHouse/ClickHouse/pull/52440) ([Vasily Nemkov](https://github.com/Enmk)).
- AnyHashの実装が非準拠であった問題を修正 [#52448](https://github.com/ClickHouse/ClickHouse/pull/52448) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- OptimizedRegularExpressionで再帰深度をチェックするように修正 [#52451](https://github.com/ClickHouse/ClickHouse/pull/52451) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- DatabaseReplicated::startupTables()/canExecuteReplicatedMetadataAlter()のデータ競合を修正 [#52490](https://github.com/ClickHouse/ClickHouse/pull/52490) ([Azat Khuzhin](https://github.com/azat)).
- `transform`関数での中断を修正 [#52513](https://github.com/ClickHouse/ClickHouse/pull/52513) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- プロジェクション削除後の軽量削除を修正 [#52517](https://github.com/ClickHouse/ClickHouse/pull/52517) ([Anton Popov](https://github.com/CurtizJ)).
- 「接続をドレインできません: 最初にキャンセルしてください」という可能性のあるエラーを修正 [#52585](https://github.com/ClickHouse/ClickHouse/pull/52585) ([Kruglov Pavel](https://github.com/Avogar)).

### <a id="236"></a> ClickHouse リリース 23.6, 2023-06-29 {#236}

#### 後方互換性のない変更 {#backward-incompatible-change-6}

- fsキャッシュの`do_not_evict_index_and_mark_files`機能を削除しました。この機能は状況を悪化させるだけでした。[#51253](https://github.com/ClickHouse/ClickHouse/pull/51253) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 実験的なLIVE VIEWに対するALTERサポートを削除しました。[#51287](https://github.com/ClickHouse/ClickHouse/pull/51287) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `http_max_field_value_size`と`http_max_field_name_size`のデフォルト値を128 KiBに減少させました。[#51163](https://github.com/ClickHouse/ClickHouse/pull/51163) ([Mikhail f. Shiryaev](https://github.com/Felixoid))。
- CPUに関連するCGroupsメトリクスは、使いやすさ向上のため`CGroupMaxCPU`という1つのメトリクスに置き換えられました。`Normalized` CPU使用率メトリクスは、設定されている場合、総CPU数ではなくCGroupsの制限に対して正規化されます。これにより[#50836](https://github.com/ClickHouse/ClickHouse/issues/50836)が解決されます。[#50835](https://github.com/ClickHouse/ClickHouse/pull/50835) ([Alexey Milovidov](https://github.com/alexey-milovidov))。


#### 新機能 {#new-feature-6}

- `transform`関数および値マッチングを伴う`CASE`がすべてのデータ型をサポートするようになりました。これにより[#29730](https://github.com/ClickHouse/ClickHouse/issues/29730)、[#32387](https://github.com/ClickHouse/ClickHouse/issues/32387)、[#50827](https://github.com/ClickHouse/ClickHouse/issues/50827)、[#31336](https://github.com/ClickHouse/ClickHouse/issues/31336)、[#40493](https://github.com/ClickHouse/ClickHouse/issues/40493)が解決されました。[#51351](https://github.com/ClickHouse/ClickHouse/pull/51351) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- オプション`--rename_files_after_processing <pattern>`が追加されました。これにより[#34207](https://github.com/ClickHouse/ClickHouse/issues/34207)が解決されました。[#49626](https://github.com/ClickHouse/ClickHouse/pull/49626) ([alekseygolub](https://github.com/alekseygolub))。
- `INTO OUTFILE`句で`TRUNCATE`修飾子がサポートされるようになりました。ファイルが存在する場合、`INTO OUTFILE`には`APPEND`または`TRUNCATE`の使用が推奨されます。[#50950](https://github.com/ClickHouse/ClickHouse/pull/50950) ([alekar](https://github.com/alekar))。
- テーブルエンジン`Redis`とテーブル関数`redis`が追加されました。これにより外部Redisサーバーへのクエリが可能になります。[#50150](https://github.com/ClickHouse/ClickHouse/pull/50150) ([JackyWoo](https://github.com/JackyWoo))。
- file/s3/url/hdfsテーブル関数において、設定`s3_skip_empty_files`、`hdfs_skip_empty_files`、`engine_file_skip_empty_files`、`engine_url_skip_empty_files`を使用して空のファイルをスキップできるようになりました。[#50364](https://github.com/ClickHouse/ClickHouse/pull/50364) ([Kruglov Pavel](https://github.com/Avogar))。
- MySQL互換ポート経由でクライアントが接続されている場合に、`SHOW COLUMNS` SQLステートメントでMySQL相当の型を表示するための新しい設定`use_mysql_types_in_show_columns`が追加されました。[#49577](https://github.com/ClickHouse/ClickHouse/pull/49577) ([Thomas Panetti](https://github.com/tpanetti))。
- clickhouse-clientは、`--host`、`--port`、`--user`などの代わりに接続文字列で呼び出せるようになりました。[#50689](https://github.com/ClickHouse/ClickHouse/pull/50689) ([Alexey Gerasimchuck](https://github.com/Demilivor))。
- 設定`session_timezone`が追加されました。これは明示的に指定されていない場合にセッションのデフォルトタイムゾーンとして使用されます。[#44149](https://github.com/ClickHouse/ClickHouse/pull/44149) ([Andrey Zvonov](https://github.com/zvonand))。
- コーデックDEFLATE_QPLは、設定`allow_experimental_codecs`の代わりにサーバー設定`enable_deflate_qpl_codec`(デフォルト: false)で制御されるようになりました。これによりDEFLATE_QPLは非実験的機能となります。[#50775](https://github.com/ClickHouse/ClickHouse/pull/50775) ([Robert Schulze](https://github.com/rschu1ze))。


#### パフォーマンス改善 {#performance-improvement-6}

- `ReplicatedMergeTree`におけるマージ選択とクリーンアップタスクのスケジューリングを改善しました。マージまたはクリーンアップするものがない場合、タスクが過度に頻繁に実行されることがなくなります。設定`max_merge_selecting_sleep_ms`、`merge_selecting_sleep_slowdown_factor`、`max_cleanup_delay_period`、`cleanup_thread_preferred_points_per_iteration`を追加しました。これにより[#31919](https://github.com/ClickHouse/ClickHouse/issues/31919)がクローズされるはずです。[#50107](https://github.com/ClickHouse/ClickHouse/pull/50107) ([Alexander Tokmakov](https://github.com/tavplubix))。
- クロスジョインを通じたフィルタプッシュダウンを実装しました。[#50605](https://github.com/ClickHouse/ClickHouse/pull/50605) ([Han Fei](https://github.com/hanfei1991))。
- グローバルオブジェクトの代わりにスレッドローカルのtimer_idを使用することで、QueryProfiler有効時のパフォーマンスを改善しました。[#48778](https://github.com/ClickHouse/ClickHouse/pull/48778) ([Jiebin Sun](https://github.com/jiebinn))。
- パフォーマンス向上のためにCapnProto入出力フォーマットを書き直しました。カラム名とCapnProtoフィールドを大文字小文字を区別せずにマッピングし、ネストされた構造体フィールドの読み書きを修正しました。[#49752](https://github.com/ClickHouse/ClickHouse/pull/49752) ([Kruglov Pavel](https://github.com/Avogar))。
- 並列スレッドに対するParquet書き込みパフォーマンスを最適化しました。[#50102](https://github.com/ClickHouse/ClickHouse/pull/50102) ([Hongbin Ma](https://github.com/binmahone))。
- MATERIALIZED VIEWと単一ブロックのみのストレージの処理において`parallelize_output_from_storages`を無効化しました。[#50214](https://github.com/ClickHouse/ClickHouse/pull/50214) ([Azat Khuzhin](https://github.com/azat))。
- PR [#46558](https://github.com/ClickHouse/ClickHouse/pull/46558)をマージしました。ブロックが既にソート済みの場合、ソート中のブロック並べ替えを回避します。[#50697](https://github.com/ClickHouse/ClickHouse/pull/50697) ([Alexey Milovidov](https://github.com/alexey-milovidov), [Maksim Kita](https://github.com/kitaisreal))。
- system.zookeeperテーブルからの読み取りを高速化するため、ZooKeeperへの複数のリストリクエストを並列実行するようにしました。[#51042](https://github.com/ClickHouse/ClickHouse/pull/51042) ([Alexander Gololobov](https://github.com/davenger))。
- タイムゾーン用のDateTimeルックアップテーブルの初期化を高速化しました。これにより、特にデバッグビルドにおいて処理が重いため、clickhouse-clientの起動/接続時間が短縮されます。[#51347](https://github.com/ClickHouse/ClickHouse/pull/51347) ([Alexander Gololobov](https://github.com/davenger))。
- 同期的なHEADリクエストによるデータレイクの遅延を修正しました(多数のファイルがある場合のIceberg/Deltalake/Hudiの遅延に関連)。[#50976](https://github.com/ClickHouse/ClickHouse/pull/50976) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 右側のGLOBAL JOINテーブルからすべてのカラムを読み取らないようにしました。[#50721](https://github.com/ClickHouse/ClickHouse/pull/50721) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。

#### 実験的機能 {#experimental-feature-3}

- アナライザーでの並列レプリカをサポートしました。[#50441](https://github.com/ClickHouse/ClickHouse/pull/50441) ([Raúl Marín](https://github.com/Algunenano))。
- ゼロコピーレプリケーションの場合に、レプリカ間で負荷をより均等に分散するため、大規模なマージ/ミューテーション実行前にランダムなスリープを追加しました。[#51282](https://github.com/ClickHouse/ClickHouse/pull/51282) ([alesapin](https://github.com/alesapin))。
- `Replicated`データベースが単一のシャードのみを持ち、基盤となるテーブルが`ReplicatedMergeTree`である場合、`ALTER PARTITION`クエリとミューテーションをレプリケートしないようにしました。[#51049](https://github.com/ClickHouse/ClickHouse/pull/51049) ([Alexander Tokmakov](https://github.com/tavplubix))。


#### 改善 {#improvement-6}

- 「パーツが多すぎる」のしきい値をより現代的な値に緩和しました。長時間実行される挿入クエリ中にバックプレッシャーを返すようにしました。[#50856](https://github.com/ClickHouse/ClickHouse/pull/50856) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- CIDR ::ffff:0:0/96（IPv4マップアドレス）に対してIPv6からIPv4アドレスへのキャストを許可しました。[#49759](https://github.com/ClickHouse/ClickHouse/pull/49759) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
- MongoDBプロトコルを更新し、MongoDB 5.1以降のバージョンをサポートしました。旧プロトコル（&lt;3.6）を使用するバージョンのサポートは維持されています。次の問題を解決: [#45621](https://github.com/ClickHouse/ClickHouse/issues/45621)、[#49879](https://github.com/ClickHouse/ClickHouse/issues/49879)。[#50061](https://github.com/ClickHouse/ClickHouse/pull/50061) ([Nikolay Degterinsky](https://github.com/evillique))。
- スキーマ推論で読み取るバイト数を制限する設定`input_format_max_bytes_to_read_for_schema_inference`を追加しました。次の問題を解決: [#50577](https://github.com/ClickHouse/ClickHouse/issues/50577)。[#50592](https://github.com/ClickHouse/ClickHouse/pull/50592) ([Kruglov Pavel](https://github.com/Avogar))。
- スキーマ推論で設定`input_format_null_as_default`を考慮するようにしました。[#50602](https://github.com/ClickHouse/ClickHouse/pull/50602) ([Kruglov Pavel](https://github.com/Avogar))。
- CSV/TSV/CustomSeparated形式で、設定`input_format_csv_skip_trailing_empty_lines`、`input_format_tsv_skip_trailing_empty_lines`、`input_format_custom_skip_trailing_empty_lines`を使用して末尾の空行をスキップできるようにしました（デフォルトでは無効）。次の問題を解決: [#49315](https://github.com/ClickHouse/ClickHouse/issues/49315)。[#50635](https://github.com/ClickHouse/ClickHouse/pull/50635) ([Kruglov Pavel](https://github.com/Avogar))。
- 関数「toDateOrDefault|OrNull」および「accuateCast[OrDefault|OrNull]」が数値引数を正しく解析するようになりました。[#50709](https://github.com/ClickHouse/ClickHouse/pull/50709) ([Dmitry Kardymon](https://github.com/kardymonds))。
- 空白文字または`\t`をフィールド区切り文字とするCSVをサポートしました。これらの区切り文字はSparkでサポートされています。[#50712](https://github.com/ClickHouse/ClickHouse/pull/50712) ([KevinyhZou](https://github.com/KevinyhZou))。
- 設定`number_of_mutations_to_delay`および`number_of_mutations_to_throw`がデフォルトで有効になり、それぞれ500と1000の値が設定されました。[#50726](https://github.com/ClickHouse/ClickHouse/pull/50726) ([Anton Popov](https://github.com/CurtizJ))。
- ダッシュボードが欠損値を正しく表示するようになりました。次の問題を解決: [#50831](https://github.com/ClickHouse/ClickHouse/issues/50831)。[#50832](https://github.com/ClickHouse/ClickHouse/pull/50832) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 関数`parseDateTimeBestEffort*`および`parseDateTime64BestEffort*`でsyslogタイムスタンプ形式の日付と時刻の引数を使用できるようにしました。[#50925](https://github.com/ClickHouse/ClickHouse/pull/50925) ([Victor Krasnov](https://github.com/sirvickr))。
- clickhouse-clientのコマンドラインパラメータ「--password」は1回のみ指定できるようになりました。[#50966](https://github.com/ClickHouse/ClickHouse/pull/50966) ([Alexey Gerasimchuck](https://github.com/Demilivor))。
- クラスタ上でのバックアップ中にパーツの同一性を確認するために、`system.parts`の`hash_of_all_files`を使用するようにしました。[#50997](https://github.com/ClickHouse/ClickHouse/pull/50997) ([Vitaly Baranov](https://github.com/vitlibar))。
- システムテーブルzookeeper_connectionのconnected_timeは接続が確立された時刻を識別し（標準形式）、session_uptime_elapsed_secondsが追加され、確立された接続セッションの継続時間（秒単位）を示します。[#51026](https://github.com/ClickHouse/ClickHouse/pull/51026) ([郭小龙](https://github.com/guoxiaolongzte))。
- file/s3/hdfs/urlテーブル関数のプログレスバーを改善しました。ソースデータからのチャンクサイズを使用し、各スレッドで増分的な合計サイズカウントを使用します。\*Cluster関数のプログレスバーを修正しました。次の問題を解決: [#47250](https://github.com/ClickHouse/ClickHouse/issues/47250)。[#51088](https://github.com/ClickHouse/ClickHouse/pull/51088) ([Kruglov Pavel](https://github.com/Avogar))。
- より良いプログレスバーのために、TCPプロトコルのProgressパケットにtotal_bytes_to_readを追加しました。[#51158](https://github.com/ClickHouse/ClickHouse/pull/51158) ([Kruglov Pavel](https://github.com/Avogar))。
- ファイルシステムキャッシュを持つディスク上のデータパーツのチェックを改善しました。[#51164](https://github.com/ClickHouse/ClickHouse/pull/51164) ([Anton Popov](https://github.com/CurtizJ))。
- fsキャッシュのcurrent_elements_numが時々正しくない問題を修正しました。[#51242](https://github.com/ClickHouse/ClickHouse/pull/51242) ([Kseniia Sumarokova](https://github.com/kssenii))。

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-6}

- スタンドアロンkeeperバイナリに埋め込みkeeper-clientを追加しました。[#50964](https://github.com/ClickHouse/ClickHouse/pull/50964) ([pufit](https://github.com/pufit))。
- 最新のLZ4バージョンが使用されるようになりました。[#50621](https://github.com/ClickHouse/ClickHouse/pull/50621) ([Nikita Taranov](https://github.com/nickitat))。
- ClickHouseサーバーは致命的エラー発生時に変更された設定のリストを出力するようになりました。これにより[#51137](https://github.com/ClickHouse/ClickHouse/issues/51137)が解決されます。[#51138](https://github.com/ClickHouse/ClickHouse/pull/51138) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- clang-17でのClickHouseのビルドが可能になりました。[#51300](https://github.com/ClickHouse/ClickHouse/pull/51300) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- [SQLancer](https://github.com/sqlancer/sqlancer)チェックは、それによって検出されたバグが修正されたため、安定していると見なされます。今後、SQLancerチェックの失敗はチェック失敗ステータスとして報告されます。[#51340](https://github.com/ClickHouse/ClickHouse/pull/51340) ([Ilya Yatsishin](https://github.com/qoega))。
- Dockerfile内の巨大な`RUN`を小さな条件付きに分割しました。必要なツールを同じ`RUN`レイヤーでオンデマンドでインストールし、その後削除します。OSのアップグレードは最初に一度だけ実行します。署名されたリポジトリをチェックする最新の方法を使用します。古いdockerバージョンの問題に対処するため、ベースリポジトリをubuntu:20.04にダウングレードしました。golangの脆弱性に対処するため、golangバージョンをアップグレードしました。[#51504](https://github.com/ClickHouse/ClickHouse/pull/51504) ([Mikhail f. Shiryaev](https://github.com/Felixoid))。

#### バグ修正（公式安定版リリースにおけるユーザーから見える不具合） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-6}


* 実行可能ディクショナリのロード状況を正しく報告するようにしました [#48775](https://github.com/ClickHouse/ClickHouse/pull/48775) ([Anton Kozlov](https://github.com/tonickkozlov)).
* スキップインデックスおよびプロジェクションのミューテーションの適正化 [#50104](https://github.com/ClickHouse/ClickHouse/pull/50104) ([Amos Bird](https://github.com/amosbird))。
* 可動部分のクリーンアップ [#50489](https://github.com/ClickHouse/ClickHouse/pull/50489) ([vdimir](https://github.com/vdimir)).
* 集約関数における IP 型のハッシュの後方互換性を修正 [#50551](https://github.com/ClickHouse/ClickHouse/pull/50551)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* Log ファミリーのテーブルが `TRUNCATE` 後に誤った行数を返す問題を修正 [#50585](https://github.com/ClickHouse/ClickHouse/pull/50585)（[flynn](https://github.com/ucasfl)）。
* `uniqExact` の並列マージ時のバグを修正 [#50590](https://github.com/ClickHouse/ClickHouse/pull/50590) ([Nikita Taranov](https://github.com/nickitat))。
* 最近の grace hash join の変更を元に戻す [#50699](https://github.com/ClickHouse/ClickHouse/pull/50699) ([vdimir](https://github.com/vdimir))。
* クエリキャッシュ: `ColumnConst` から `ColumnVector<char8_t>` への不正なキャストの修正を試みる [#50704](https://github.com/ClickHouse/ClickHouse/pull/50704) ([Robert Schulze](https://github.com/rschu1ze)).
* 未知の操作を含むログを Keeper に保存しないようにしました [#50751](https://github.com/ClickHouse/ClickHouse/pull/50751) ([Antonio Andelic](https://github.com/antonio2368))。
* DateTime64 用 SummingMergeTree サポート [#50797](https://github.com/ClickHouse/ClickHouse/pull/50797) ([Jordi Villar](https://github.com/jrdi))。
* 非定数タイムゾーン向けの互換性設定を追加 [#50834](https://github.com/ClickHouse/ClickHouse/pull/50834) ([Robert Schulze](https://github.com/rschu1ze))。
* キャッシュエントリ内の LDAP パラメーターのハッシュ処理を修正 [#50865](https://github.com/ClickHouse/ClickHouse/pull/50865) ([Julian Maicher](https://github.com/jmaicher)).
* Parquet 形式で、例外を投げるのではなく、`String` からビッグ整数をパースするフォールバックを行うように変更 [#50873](https://github.com/ClickHouse/ClickHouse/pull/50873) （[Kruglov Pavel](https://github.com/Avogar)）。
* バックアップの書き込み中にロックファイルを過度にチェックしてしまう問題を修正 [#50889](https://github.com/ClickHouse/ClickHouse/pull/50889) ([Vitaly Baranov](https://github.com/vitlibar))。
* read-in-order が有効な場合は projection を適用しないようにしました。 [#50923](https://github.com/ClickHouse/ClickHouse/pull/50923) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
* Azure Blob Storage イテレーターにおけるレースコンディションを修正 [#50936](https://github.com/ClickHouse/ClickHouse/pull/50936) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
* `CreatingSets` における誤った `sort_description` の伝播を修正しました [#50955](https://github.com/ClickHouse/ClickHouse/pull/50955)（[Nikita Taranov](https://github.com/nickitat)）。
* Iceberg v2 のオプションメタデータの解析を修正 [#50974](https://github.com/ClickHouse/ClickHouse/pull/50974) ([Kseniia Sumarokova](https://github.com/kssenii))。
* MaterializedMySQL: 空のテーブルのオーバーライドで括弧を保持 [#50977](https://github.com/ClickHouse/ClickHouse/pull/50977) ([Val Doroshchuk](https://github.com/valbok)).
* BackupCoordinationStageSync::setError() のクラッシュを修正 [#51012](https://github.com/ClickHouse/ClickHouse/pull/51012) ([Vitaly Baranov](https://github.com/vitlibar))。
* ColumnLowCardinality の辞書における、微妙に不具合のあったコピーオンライト動作を修正 [#51064](https://github.com/ClickHouse/ClickHouse/pull/51064) ([Michael Kolupaev](https://github.com/al13n321)).
* 安全な IV を生成 [#51086](https://github.com/ClickHouse/ClickHouse/pull/51086)（[Salvatore Mesoraca](https://github.com/aiven-sal)）。
* サブクエリを含む SELECT に対して機能していなかったクエリキャッシュを修正 [#51132](https://github.com/ClickHouse/ClickHouse/pull/51132)（[Robert Schulze](https://github.com/rschu1ze)）。
* 定数の `Nullable` 比較における `Set` インデックスの不具合を修正。 [#51205](https://github.com/ClickHouse/ClickHouse/pull/51205) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* s3 および s3Cluster 関数で発生するクラッシュを修正 [#51209](https://github.com/ClickHouse/ClickHouse/pull/51209) ([Nikolay Degterinsky](https://github.com/evillique))。
* コンパイル済み式で発生するクラッシュを修正 [#51231](https://github.com/ClickHouse/ClickHouse/pull/51231) ([LiuNeng](https://github.com/liuneng1994))。
* URL 切り替え時の StorageURL における use-after-free を修正 [#51260](https://github.com/ClickHouse/ClickHouse/pull/51260) ([Michael Kolupaev](https://github.com/al13n321)).
* パラメータ化ビューに対するチェックを更新 [#51272](https://github.com/ClickHouse/ClickHouse/pull/51272)（[SmitaRKulkarni](https://github.com/SmitaRKulkarni)）。
* 同一ファイルをバックアップに複数回書き込んでしまう不具合を修正 [#51299](https://github.com/ClickHouse/ClickHouse/pull/51299)（[Vitaly Baranov](https://github.com/vitlibar)）。
* ActionsDAG におけるファザーによる不具合を修正 [#51301](https://github.com/ClickHouse/ClickHouse/pull/51301) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 関数 `transform` から不要な処理を削除しました [#51350](https://github.com/ClickHouse/ClickHouse/pull/51350)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。

### <a id="235"></a> ClickHouse release 23.5, 2023-06-08 {#235}

#### アップグレード時の注意事項 {#upgrade-notes}

- マークとプライマリキーをデフォルトで圧縮します。これによりコールドクエリの実行時間が大幅に短縮されます。アップグレード時の注意事項: 圧縮されたマークとプライマリキーのサポートはバージョン22.9で追加されました。圧縮されたマークまたはプライマリキーを有効にした場合、またはデフォルトで圧縮されたマークまたはプライマリキーが有効になっているバージョン23.5以降をインストールした場合、バージョン22.8以前にダウングレードすることはできません。サーバー設定ファイルの`<merge_tree>`セクションで`compress_marks`および`compress_primary_key`設定を指定することで、圧縮されたマークまたはプライマリキーを明示的に無効にすることもできます。**アップグレード時の注意事項:** バージョン22.9より前からアップグレードする場合は、すべてのレプリカを一度にアップグレードするか、アップグレード前に圧縮を無効にするか、圧縮されたマークがサポートされているがデフォルトでは有効になっていない中間バージョン(23.3など)を経由してアップグレードする必要があります。[#42587](https://github.com/ClickHouse/ClickHouse/pull/42587) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ローカルオブジェクトストレージをS3オブジェクトストレージと一貫して動作するようにし、追記の問題を修正し([#48465](https://github.com/ClickHouse/ClickHouse/issues/48465)をクローズ)、独立したストレージとして設定可能にします。ローカルオブジェクトストレージ上のキャッシュが以前のバージョンと互換性がないため、この変更には後方互換性がありません。[#48791](https://github.com/ClickHouse/ClickHouse/pull/48791) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 実験的機能「インメモリデータパート」は削除されました。データ形式は引き続きサポートされますが、設定は無効となり、代わりにコンパクトパートまたはワイドパートが使用されます。これにより[#45409](https://github.com/ClickHouse/ClickHouse/issues/45409)がクローズされます。[#49429](https://github.com/ClickHouse/ClickHouse/pull/49429) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 設定`parallelize_output_from_storages`および`input_format_parquet_preserve_order`のデフォルト値を変更しました。これによりClickHouseはファイル(CSVやParquetなど)から読み取る際に行を並べ替えることができ、多くの場合でパフォーマンスが大幅に向上します。順序を保持する従来の動作に戻すには、`parallelize_output_from_storages = 0`、`input_format_parquet_preserve_order = 1`を使用してください。[#49479](https://github.com/ClickHouse/ClickHouse/pull/49479) ([Michael Kolupaev](https://github.com/al13n321))。
- プロジェクションを本番環境対応にします。SELECTクエリでプロジェクションが選択されるかどうかを制御する`optimize_use_projections`設定を追加します。設定`allow_experimental_projection_optimization`は廃止され、何も行いません。[#49719](https://github.com/ClickHouse/ClickHouse/pull/49719) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `joinGet`を非決定的としてマークします(`dictGet`と同様)。これにより、追加の設定なしでミューテーションで使用できるようになります。[#49843](https://github.com/ClickHouse/ClickHouse/pull/49843) ([Azat Khuzhin](https://github.com/azat))。
- 「`groupArray`の戻り値はnullableにできない」という変更を取り消します(`Nullable`型に対する`groupArray`/`groupArrayLast`/`groupArraySample`のバイナリ互換性の破損により、`TOO_LARGE_ARRAY_SIZE`または`CANNOT_READ_ALL_DATA`が発生する可能性があるため)。[#49971](https://github.com/ClickHouse/ClickHouse/pull/49971) ([Azat Khuzhin](https://github.com/azat))。
- 設定`enable_memory_bound_merging_of_aggregation_results`はデフォルトで有効になっています。バージョン22.12より前からアップデートする場合は、アップデートが完了するまでこのフラグを`false`に設定することを推奨します。[#50319](https://github.com/ClickHouse/ClickHouse/pull/50319) ([Nikita Taranov](https://github.com/nickitat))。


#### 新機能 {#new-feature-7}

- ストレージエンジンAzureBlobStorageとazureBlobStorageテーブル関数を追加しました。サポートされる機能セットはストレージ/テーブル関数S3と非常に類似しています [#50604] (https://github.com/ClickHouse/ClickHouse/pull/50604) ([alesapin](https://github.com/alesapin)) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni).
- ネイティブClickHouse Keeper CLIクライアントを追加しました。`clickhouse keeper-client`として利用可能です [#47414](https://github.com/ClickHouse/ClickHouse/pull/47414) ([pufit](https://github.com/pufit)).
- `urlCluster`テーブル関数を追加しました。すべての*Clusterテーブル関数をリファクタリングしてコードの重複を削減しました。すべての可能な*Cluster関数シグネチャと名前付きコレクションに対してスキーマ推論が機能するようにしました。解決: [#38499](https://github.com/ClickHouse/ClickHouse/issues/38499). [#45427](https://github.com/ClickHouse/ClickHouse/pull/45427) ([attack204](https://github.com/attack204)), Pavel Kruglov.
- クエリキャッシュが本番ワークロードで使用できるようになりました。[#47977](https://github.com/ClickHouse/ClickHouse/pull/47977) ([Robert Schulze](https://github.com/rschu1ze)). クエリキャッシュがtotalsおよびextremesモディファイアを含むクエリをサポートするようになりました。[#48853](https://github.com/ClickHouse/ClickHouse/pull/48853) ([Robert Schulze](https://github.com/rschu1ze)). 後方互換性のため`allow_experimental_query_cache`設定を廃止扱いにしました。これはhttps://github.com/ClickHouse/ClickHouse/pull/47977で削除されました。[#49934](https://github.com/ClickHouse/ClickHouse/pull/49934) ([Timur Solodovnikov](https://github.com/tsolodov)).
- 地理データ型（`Point`、`Ring`、`Polygon`、`MultiPolygon`）が本番環境対応になりました。[#50022](https://github.com/ClickHouse/ClickHouse/pull/50022) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- PostgreSQL、MySQL、MeiliSearch、SQLiteテーブルエンジンにスキーマ推論を追加しました。解決: [#49972](https://github.com/ClickHouse/ClickHouse/issues/49972). [#50000](https://github.com/ClickHouse/ClickHouse/pull/50000) ([Nikolay Degterinsky](https://github.com/evillique)).
- `CREATE USER u IDENTIFIED BY 'p'`のようなクエリにおけるパスワードタイプは、サーバーの`config.xml`内の`default_password_type`設定に従って自動的に設定されるようになりました。解決: [#42915](https://github.com/ClickHouse/ClickHouse/issues/42915). [#44674](https://github.com/ClickHouse/ClickHouse/pull/44674) ([Nikolay Degterinsky](https://github.com/evillique)).
- bcryptパスワード認証タイプを追加しました。解決: [#34599](https://github.com/ClickHouse/ClickHouse/issues/34599). [#44905](https://github.com/ClickHouse/ClickHouse/pull/44905) ([Nikolay Degterinsky](https://github.com/evillique)).
- 新しいキーワード`INTO OUTFILE 'file.txt' APPEND`を導入しました。[#48880](https://github.com/ClickHouse/ClickHouse/pull/48880) ([alekar](https://github.com/alekar)).
- Keeper接続に関する情報を表示する`system.zookeeper_connection`テーブルを追加しました。[#45245](https://github.com/ClickHouse/ClickHouse/pull/45245) ([mateng915](https://github.com/mateng0915)).
- ランダムなテーブル構造を生成する新しい関数`generateRandomStructure`を追加しました。テーブル関数`generateRandom`と組み合わせて使用できます。[#47409](https://github.com/ClickHouse/ClickHouse/pull/47409) ([Kruglov Pavel](https://github.com/Avogar)).
- `ELSE`ブランチなしの`CASE`の使用を許可し、より多くの型を扱えるように`transform`を拡張しました。また、decimal型が他の数値型と混在した場合にtransform()が誤った結果を返す問題を修正しました。[#48300](https://github.com/ClickHouse/ClickHouse/pull/48300) ([Salvatore Mesoraca](https://github.com/aiven-sal)). これにより#2655、#9596、#38666が解決されます。
- S3テーブルに[KMSキーを使用したサーバーサイド暗号化](https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingKMSEncryption.html)を追加し、S3ディスクに`header`設定を追加しました。解決: [#48723](https://github.com/ClickHouse/ClickHouse/issues/48723). [#48724](https://github.com/ClickHouse/ClickHouse/pull/48724) ([Johann Gan](https://github.com/johanngan)).
- バックグラウンドタスク（マージとミューテーション）用のMemoryTrackerを追加しました。マージとミューテーションのソフトメモリ制限を表す`merges_mutations_memory_usage_soft_limit`および`merges_mutations_memory_usage_to_ram_ratio`設定を導入しました。この制限に達すると、ClickHouseは新しいマージまたはミューテーションタスクをスケジュールしません。また、バックグラウンドタスクの現在のメモリ使用量を監視できるように`MergesMutationsMemoryTracking`メトリックを導入しました。再提出: [#46089](https://github.com/ClickHouse/ClickHouse/issues/46089). 解決: [#48774](https://github.com/ClickHouse/ClickHouse/issues/48774). [#48787](https://github.com/ClickHouse/ClickHouse/pull/48787) ([Dmitry Novik](https://github.com/novikd)).
- 関数`dotProduct`が配列に対応しました。[#49050](https://github.com/ClickHouse/ClickHouse/pull/49050) ([FFFFFFFHHHHHHH](https://github.com/FFFFFFFHHHHHHH)).
- MySQLとの互換性を向上させるため、`SHOW INDEX`ステートメントをサポートしました。[#49158](https://github.com/ClickHouse/ClickHouse/pull/49158) ([Robert Schulze](https://github.com/rschu1ze)).
- テーブル関数`url`に仮想カラム`_file`および`_path`のサポートを追加しました。- テーブル関数`url`のエラーメッセージを改善しました。- 解決: [#49231](https://github.com/ClickHouse/ClickHouse/issues/49231) - 解決: [#49232](https://github.com/ClickHouse/ClickHouse/issues/49232). [#49356](https://github.com/ClickHouse/ClickHouse/pull/49356) ([Ziyi Tan](https://github.com/Ziy1-Tan)).
- users.xmlファイルに`grants`フィールドを追加し、ユーザーに対する権限を指定できるようにしました。[#49381](https://github.com/ClickHouse/ClickHouse/pull/49381) ([pufit](https://github.com/pufit)).
- grace hash joinアルゴリズムを使用したfull/right joinをサポートしました。[#49483](https://github.com/ClickHouse/ClickHouse/pull/49483) ([lgbo](https://github.com/lgbo-ustc)).
- `WITH FILL`モディファイアがソートプレフィックスによるグループ化フィルを行います。`use_with_fill_by_sorting_prefix`設定で制御されます（デフォルトで有効）。関連: [#33203](https://github.com/ClickHouse/ClickHouse/issues/33203)#issuecomment-1418736794. [#49503](https://github.com/ClickHouse/ClickHouse/pull/49503) ([Igor Nikonov](https://github.com/devcrafter)).
- Clickhouse-clientが"--query"（または"-q"）が存在しない場合に"--multiquery"の後にクエリを受け付けるようになりました。例: clickhouse-client --multiquery "select 1; select 2;"。[#49870](https://github.com/ClickHouse/ClickHouse/pull/49870) ([Alexey Gerasimchuk](https://github.com/Demilivor)).
- レプリカからHelloパケットを受信するための個別の`handshake_timeout`を追加しました。解決: [#48854](https://github.com/ClickHouse/ClickHouse/issues/48854). [#49948](https://github.com/ClickHouse/ClickHouse/pull/49948) ([Kruglov Pavel](https://github.com/Avogar)).
- 指定された回数だけスペースを繰り返す関数"space"を追加しました。[#50103](https://github.com/ClickHouse/ClickHouse/pull/50103) ([Robert Schulze](https://github.com/rschu1ze)).
- --input_format_csv_trim_whitespacesオプションを追加しました。[#50215](https://github.com/ClickHouse/ClickHouse/pull/50215) ([Alexey Gerasimchuk](https://github.com/Demilivor)).
- regexp tree辞書の`dictGetAll`関数が複数のマッチから値を配列として返せるようにしました。解決: [#50254](https://github.com/ClickHouse/ClickHouse/issues/50254). [#50255](https://github.com/ClickHouse/ClickHouse/pull/50255) ([Johann Gan](https://github.com/johanngan)).
- 日付または日時を最も近い土曜日または日曜日に丸める`toLastDayOfWeek`関数を追加しました。[#50315](https://github.com/ClickHouse/ClickHouse/pull/50315) ([Victor Krasnov](https://github.com/sirvickr)).
- `ignore_data_skipping_indices`を指定してスキップインデックスを無視する機能を追加しました。[#50329](https://github.com/ClickHouse/ClickHouse/pull/50329) ([Boris Kuschel](https://github.com/bkuschel)).
- ユーザーレベルでメモリ情報とProfileEventsを表示する`system.user_processes`テーブルと`SHOW USER PROCESSES`クエリを追加しました。[#50492](https://github.com/ClickHouse/ClickHouse/pull/50492) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
- テーブル、データベース、テーブル関数、辞書のシークレットを表示するためのサーバーおよびフォーマット設定`display_secrets_in_show_and_select`を追加しました。どのユーザーがシークレットを表示できるかを制御する権限`displaySecretsInShowAndSelect`を追加しました。[#46528](https://github.com/ClickHouse/ClickHouse/pull/46528) ([Mike Kot](https://github.com/myrrc)).
- DATABASEに属するすべてのテーブルに対してROW POLICYを設定できるようにしました。[#47640](https://github.com/ClickHouse/ClickHouse/pull/47640) ([Ilya Golshtein](https://github.com/ilejn)).





#### パフォーマンス改善 {#performance-improvement-7}

- マークとプライマリキーをデフォルトで圧縮します。これによりコールドクエリの時間が大幅に短縮されます。アップグレード時の注意: 圧縮マークとプライマリキーのサポートはバージョン22.9で追加されました。圧縮マークまたはプライマリキーを有効にした場合、またはデフォルトで圧縮マークまたはプライマリキーが有効になっているバージョン23.5以降をインストールした場合、バージョン22.8以前へのダウングレードはできません。サーバー設定ファイルの`<merge_tree>`セクションで`compress_marks`および`compress_primary_key`設定を指定することで、圧縮マークまたはプライマリキーを明示的に無効化することもできます。[#42587](https://github.com/ClickHouse/ClickHouse/pull/42587) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 新しい設定s3_max_inflight_parts_for_one_fileは、1つのファイルのスコープ内でマルチパートアップロードリクエストによって同時にロードされるパーツの上限を設定します。[#49961](https://github.com/ClickHouse/ClickHouse/pull/49961) ([Sema Checherinda](https://github.com/CheSema))。
- 複数のファイルから読み取る際、各ファイルの並列解析スレッド数を削減します。[#42192](https://github.com/ClickHouse/ClickHouse/issues/42192)を解決します。[#46661](https://github.com/ClickHouse/ClickHouse/pull/46661) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
- 通常の読み取りよりも少ないグラニュールを読み取る場合にのみ、集約プロジェクションを使用します。これは、クエリがテーブルのプライマリキーにヒットするがプロジェクションにはヒットしない場合に役立ちます。[#49150](https://github.com/ClickHouse/ClickHouse/issues/49150)を修正します。[#49417](https://github.com/ClickHouse/ClickHouse/pull/49417) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- 何も挿入されていない場合、`ANY`ハッシュ結合でブロックを保存しません。[#48633](https://github.com/ClickHouse/ClickHouse/pull/48633) ([vdimir](https://github.com/vdimir))。
- JITコンパイル時の集約コンビネータ`-If`を修正し、集約関数のJITコンパイルを有効にします。[#48120](https://github.com/ClickHouse/ClickHouse/issues/48120)をクローズします。[#49083](https://github.com/ClickHouse/ClickHouse/pull/49083) ([Igor Nikonov](https://github.com/devcrafter))。
- リモートテーブルからの読み取りでは、タスクスティーリングを機能させるために、より小さなタスク(パート全体を読み取る代わりに)を使用します。タスクサイズは読み取る列のサイズによって決定されます。s3からの読み取りには常に1MBバッファを使用します。キャッシュセグメントの境界は1MBに整列されるため、小さなタスクでも適切なサイズを持ちます。これにより断片化も防止されます。[#49287](https://github.com/ClickHouse/ClickHouse/pull/49287) ([Nikita Taranov](https://github.com/nickitat))。
- 導入された設定: - `merge_max_block_size_bytes`はバックグラウンド操作で使用されるメモリ量を制限します。- `vertical_merge_algorithm_min_bytes_to_activate`は垂直マージを有効化するための追加条件を設定します。[#49313](https://github.com/ClickHouse/ClickHouse/pull/49313) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- ローカルファイルシステムからの読み取り用の読み取りバッファのデフォルトサイズが、わずかに改善された値に変更されました。また、2つの新しい設定が導入されました: `max_read_buffer_size_local_fs`と`max_read_buffer_size_remote_fs`。[#49321](https://github.com/ClickHouse/ClickHouse/pull/49321) ([Nikita Taranov](https://github.com/nickitat))。
- `SPARSE_HASHED`/`HASHED`ディクショナリのメモリ使用量と速度を改善します(例: `SPARSE_HASHED`は現在2.6倍少ないメモリを消費し、約2倍高速です)。[#49380](https://github.com/ClickHouse/ClickHouse/pull/49380) ([Azat Khuzhin](https://github.com/azat))。
- 適切な場合に`LowCardinality`を適用することで、`system.query_log`および`system.query_thread_log`テーブルを最適化します。これらのテーブルに対するクエリが高速化されます。[#49530](https://github.com/ClickHouse/ClickHouse/pull/49530) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ローカル`Parquet`ファイルの読み取り時のパフォーマンスが向上します(並列読み取りによる)。[#49539](https://github.com/ClickHouse/ClickHouse/pull/49539) ([Michael Kolupaev](https://github.com/al13n321))。
- 特定のシナリオ、特に小さな左テーブルと大きな右テーブルを結合する場合に、`RIGHT/FULL JOIN`のパフォーマンスを最大2倍改善します。[#49585](https://github.com/ClickHouse/ClickHouse/pull/49585) ([lgbo](https://github.com/lgbo-ustc))。
- RustのLTOを有効にすることで、BLAKE3のパフォーマンスを11%改善します。[#49600](https://github.com/ClickHouse/ClickHouse/pull/49600) ([Azat Khuzhin](https://github.com/azat))。現在、C++と同等のパフォーマンスです。
- `system.opentelemetry_span_log`の構造を最適化します。適切な場所で`LowCardinality`を使用します。このテーブルは一般的に非効率的ですが(共通属性に対してもMapデータ型を使用しています)、わずかに改善されます。[#49647](https://github.com/ClickHouse/ClickHouse/pull/49647) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `grace_hash`結合でハッシュテーブルのサイズを事前に確保しようとします。[#49816](https://github.com/ClickHouse/ClickHouse/pull/49816) ([lgbo](https://github.com/lgbo-ustc))。
- `uniqExactIf`状態の並列マージ。[#49885](https://github.com/ClickHouse/ClickHouse/issues/49885)をクローズします。[#50285](https://github.com/ClickHouse/ClickHouse/pull/50285) ([flynn](https://github.com/ucasfl))。
- Keeperの改善: Keeperに`CheckNotExists`リクエストを追加し、レプリケートされたテーブルのパフォーマンスを向上させます。[#48897](https://github.com/ClickHouse/ClickHouse/pull/48897) ([Antonio Andelic](https://github.com/antonio2368))。
- Keeperのパフォーマンス改善: 処理中に同じリクエストを2回シリアライズすることを回避します。大きなリクエストのデシリアライゼーション結果をキャッシュします。新しい調整設定`min_request_size_for_cache`によって制御されます。[#49004](https://github.com/ClickHouse/ClickHouse/pull/49004) ([Antonio Andelic](https://github.com/antonio2368))。
- マージするパーツを選択する際、多くのパーティションにマージするものがない場合の`List` ZooKeeperリクエストの数を削減しました。[#49637](https://github.com/ClickHouse/ClickHouse/pull/49637) ([Alexander Tokmakov](https://github.com/tavplubix))。
- FSキャッシュのロック機構を再設計 [#44985](https://github.com/ClickHouse/ClickHouse/pull/44985) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 自明なカウント最適化が可能な場合、純粋な並列レプリカを無効にします。[#50594](https://github.com/ClickHouse/ClickHouse/pull/50594) ([Raúl Marín](https://github.com/Algunenano))。
- Icebergスキーマ推論において、すべてのキーに対してHEADリクエストを送信せず、データ読み取りに使用されるキーに対してのみ送信します。[#50203](https://github.com/ClickHouse/ClickHouse/pull/50203) ([Kruglov Pavel](https://github.com/Avogar))。
- 設定`enable_memory_bound_merging_of_aggregation_results`がデフォルトで有効になりました。[#50319](https://github.com/ClickHouse/ClickHouse/pull/50319) ([Nikita Taranov](https://github.com/nickitat))。

#### 実験的機能 {#experimental-feature-4}

- `DEFLATE_QPL`コーデックの最小SIMDバージョンをSSE 4.2に引き下げました。[qplのドキュメント変更](https://github.com/intel/qpl/commit/3f8f5cea27739f5261e8fd577dc233ffe88bf679) - Intel® QPLはランタイムカーネルディスパッチャとcpuidチェックを利用して、利用可能な最適な実装(sse/avx2/avx512)を選択します - 最新のアップストリームqplに合わせて、ClickHouseでのqplビルド用のcmakefileを再構成しました。[#49811](https://github.com/ClickHouse/ClickHouse/pull/49811) ([jasperzhu](https://github.com/jinjunzh))。
- 純粋なパラレルレプリカを使用したJOINの初期サポートを追加しました。[#49544](https://github.com/ClickHouse/ClickHouse/pull/49544) ([Raúl Marín](https://github.com/Algunenano))。
- 「ゼロコピーレプリケーション」における`Outdated`パーツ削除の並列性を向上させました。[#49630](https://github.com/ClickHouse/ClickHouse/pull/49630) ([Alexander Tokmakov](https://github.com/tavplubix))。
- パラレルレプリカ: 1) `parallel_replicas_for_non_replicated_merge_tree`設定が無効化された非レプリケーテッドストレージでパラレルレプリカを使用する際の`NOT_FOUND_COLUMN_IN_BLOCK`エラーを修正しました 2) `allow_experimental_parallel_reading_from_replicas`は3つの値を取るようになりました - 0、1、2。0 - 無効、1 - 有効(失敗時(FINALまたはJOINの場合)は静かに無効化)、2 - 有効(失敗時は例外をスロー)。3) SELECTクエリでFINAL修飾子が使用され、パラレルレプリカが有効な場合、`allow_experimental_parallel_reading_from_replicas`が1に設定されていればClickHouseはそれらを無効化しようとし、そうでなければ例外をスローします。[#50195](https://github.com/ClickHouse/ClickHouse/pull/50195) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- パラレルレプリカが有効な場合、利用不可能なサーバーは常にスキップされます(この動作は`skip_unavailable_shards`設定で制御され、デフォルトで有効であり、無効化のみ可能です)。これにより解決: [#48565](https://github.com/ClickHouse/ClickHouse/issues/48565)。[#50293](https://github.com/ClickHouse/ClickHouse/pull/50293) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。


#### 改善 {#improvement-7}

- The `BACKUP` command will not decrypt data from encrypted disks while making a backup. Instead the data will be stored in a backup in encrypted form. Such backups can be restored only to an encrypted disk with the same (or extended) list of encryption keys. [#48896](https://github.com/ClickHouse/ClickHouse/pull/48896) ([Vitaly Baranov](https://github.com/vitlibar)).
- Added possibility to use temporary tables in FROM part of ATTACH PARTITION FROM and REPLACE PARTITION FROM. [#49436](https://github.com/ClickHouse/ClickHouse/pull/49436) ([Roman Vasin](https://github.com/rvasin)).
- Added setting `async_insert` for `MergeTree` tables. It has the same meaning as query-level setting `async_insert` and enables asynchronous inserts for specific table. Note: it doesn't take effect for insert queries from `clickhouse-client`, use query-level setting in that case. [#49122](https://github.com/ClickHouse/ClickHouse/pull/49122) ([Anton Popov](https://github.com/CurtizJ)).
- Add support for size suffixes in quota creation statement parameters. [#49087](https://github.com/ClickHouse/ClickHouse/pull/49087) ([Eridanus](https://github.com/Eridanus117)).
- Extend `first_value` and `last_value` to accept NULL. [#46467](https://github.com/ClickHouse/ClickHouse/pull/46467) ([lgbo](https://github.com/lgbo-ustc)).
- Add alias `str_to_map` and `mapFromString` for `extractKeyValuePairs`. closes https://github.com/clickhouse/clickhouse/issues/47185. [#49466](https://github.com/ClickHouse/ClickHouse/pull/49466) ([flynn](https://github.com/ucasfl)).
- Add support for CGroup version 2 for asynchronous metrics about the memory usage and availability. This closes [#37983](https://github.com/ClickHouse/ClickHouse/issues/37983). [#45999](https://github.com/ClickHouse/ClickHouse/pull/45999) ([sichenzhao](https://github.com/sichenzhao)).
- Cluster table functions should always skip unavailable shards. close [#46314](https://github.com/ClickHouse/ClickHouse/issues/46314). [#46765](https://github.com/ClickHouse/ClickHouse/pull/46765) ([zk_kiger](https://github.com/zk-kiger)).
- Allow CSV file to contain empty columns in its header. [#47496](https://github.com/ClickHouse/ClickHouse/pull/47496) ([你不要过来啊](https://github.com/iiiuwioajdks)).
- Add Google Cloud Storage S3 compatible table function `gcs`. Like the `oss` and `cosn` functions, it is just an alias over the `s3` table function, and it does not bring any new features. [#47815](https://github.com/ClickHouse/ClickHouse/pull/47815) ([Kuba Kaflik](https://github.com/jkaflik)).
- Add ability to use strict parts size for S3 (compatibility with CloudFlare R2 S3 Storage). [#48492](https://github.com/ClickHouse/ClickHouse/pull/48492) ([Azat Khuzhin](https://github.com/azat)).
- Added new columns with info about `Replicated` database replicas to `system.clusters`: `database_shard_name`, `database_replica_name`, `is_active`. Added an optional `FROM SHARD` clause to `SYSTEM DROP DATABASE REPLICA` query. [#48548](https://github.com/ClickHouse/ClickHouse/pull/48548) ([Alexander Tokmakov](https://github.com/tavplubix)).
- Add a new column `zookeeper_name` in system.replicas, to indicate on which (auxiliary) zookeeper cluster the replicated table's metadata is stored. [#48549](https://github.com/ClickHouse/ClickHouse/pull/48549) ([cangyin](https://github.com/cangyin)).
- `IN` operator support the comparison of `Date` and `Date32`. Closes [#48736](https://github.com/ClickHouse/ClickHouse/issues/48736). [#48806](https://github.com/ClickHouse/ClickHouse/pull/48806) ([flynn](https://github.com/ucasfl)).
- Support for erasure codes in `HDFS`, author: @M1eyu2018, @tomscut. [#48833](https://github.com/ClickHouse/ClickHouse/pull/48833) ([M1eyu](https://github.com/M1eyu2018)).
- Implement SYSTEM DROP REPLICA from auxiliary ZooKeeper clusters, may be close [#48931](https://github.com/ClickHouse/ClickHouse/issues/48931). [#48932](https://github.com/ClickHouse/ClickHouse/pull/48932) ([wangxiaobo](https://github.com/wzb5212)).
- Add Array data type to MongoDB. Closes [#48598](https://github.com/ClickHouse/ClickHouse/issues/48598). [#48983](https://github.com/ClickHouse/ClickHouse/pull/48983) ([Nikolay Degterinsky](https://github.com/evillique)).
- Support storing `Interval` data types in tables. [#49085](https://github.com/ClickHouse/ClickHouse/pull/49085) ([larryluogit](https://github.com/larryluogit)).
- Allow using `ntile` window function without explicit window frame definition: `ntile(3) OVER (ORDER BY a)`, close [#46763](https://github.com/ClickHouse/ClickHouse/issues/46763). [#49093](https://github.com/ClickHouse/ClickHouse/pull/49093) ([vdimir](https://github.com/vdimir)).
- Added settings (`number_of_mutations_to_delay`, `number_of_mutations_to_throw`) to delay or throw `ALTER` queries that create mutations (`ALTER UPDATE`, `ALTER DELETE`, `ALTER MODIFY COLUMN`, ...) in case when table already has a lot of unfinished mutations. [#49117](https://github.com/ClickHouse/ClickHouse/pull/49117) ([Anton Popov](https://github.com/CurtizJ)).
- Catch exception from `create_directories` in filesystem cache. [#49203](https://github.com/ClickHouse/ClickHouse/pull/49203) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Copies embedded examples to a new field `example` in `system.functions` to supplement the field `description`. [#49222](https://github.com/ClickHouse/ClickHouse/pull/49222) ([Dan Roscigno](https://github.com/DanRoscigno)).
- Enable connection options for the MongoDB dictionary. Example: `xml <source> <mongodb> <host>localhost</host> <port>27017</port> <user></user> <password></password> <db>test</db> <collection>dictionary_source</collection> <options>ssl=true</options> </mongodb> </source>` ### Documentation entry for user-facing changes. [#49225](https://github.com/ClickHouse/ClickHouse/pull/49225) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
- Added an alias `asymptotic` for `asymp` computational method for `kolmogorovSmirnovTest`. Improved documentation. [#49286](https://github.com/ClickHouse/ClickHouse/pull/49286) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
- Aggregation function groupBitAnd/Or/Xor now work on signed integer data. This makes them consistent with the behavior of scalar functions bitAnd/Or/Xor. [#49292](https://github.com/ClickHouse/ClickHouse/pull/49292) ([exmy](https://github.com/exmy)).
- Split function-documentation into more fine-granular fields. [#49300](https://github.com/ClickHouse/ClickHouse/pull/49300) ([Robert Schulze](https://github.com/rschu1ze)).
- Use multiple threads shared between all tables within a server to load outdated data parts. The the size of the pool and its queue is controlled by `max_outdated_parts_loading_thread_pool_size` and `outdated_part_loading_thread_pool_queue_size` settings. [#49317](https://github.com/ClickHouse/ClickHouse/pull/49317) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
- Don't overestimate the size of processed data for `LowCardinality` columns when they share dictionaries between blocks. This closes [#49322](https://github.com/ClickHouse/ClickHouse/issues/49322). See also [#48745](https://github.com/ClickHouse/ClickHouse/issues/48745). [#49323](https://github.com/ClickHouse/ClickHouse/pull/49323) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Parquet writer now uses reasonable row group size when invoked through `OUTFILE`. [#49325](https://github.com/ClickHouse/ClickHouse/pull/49325) ([Michael Kolupaev](https://github.com/al13n321)).
- Allow restricted keywords like `ARRAY` as an alias if the alias is quoted. Closes [#49324](https://github.com/ClickHouse/ClickHouse/issues/49324). [#49360](https://github.com/ClickHouse/ClickHouse/pull/49360) ([Nikolay Degterinsky](https://github.com/evillique)).
- Data parts loading and deletion jobs were moved to shared server-wide pools instead of per-table pools. Pools sizes are controlled via settings `max_active_parts_loading_thread_pool_size`, `max_outdated_parts_loading_thread_pool_size` and `max_parts_cleaning_thread_pool_size` in top-level config. Table-level settings `max_part_loading_threads` and `max_part_removal_threads` became obsolete. [#49474](https://github.com/ClickHouse/ClickHouse/pull/49474) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
- Allow `?password=pass` in URL of the Play UI. Password is replaced in browser history. [#49505](https://github.com/ClickHouse/ClickHouse/pull/49505) ([Mike Kot](https://github.com/myrrc)).
- Allow reading zero-size objects from remote filesystems. (because empty files are not backup'd, so we might end up with zero blobs in metadata file). Closes [#49480](https://github.com/ClickHouse/ClickHouse/issues/49480). [#49519](https://github.com/ClickHouse/ClickHouse/pull/49519) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Attach thread MemoryTracker to `total_memory_tracker` after `ThreadGroup` detached. [#49527](https://github.com/ClickHouse/ClickHouse/pull/49527) ([Dmitry Novik](https://github.com/novikd)).
- Fix parameterized views when a query parameter is used multiple times in the query. [#49556](https://github.com/ClickHouse/ClickHouse/pull/49556) ([Azat Khuzhin](https://github.com/azat)).
- Release memory allocated for the last sent ProfileEvents snapshot in the context of a query. Followup [#47564](https://github.com/ClickHouse/ClickHouse/issues/47564). [#49561](https://github.com/ClickHouse/ClickHouse/pull/49561) ([Dmitry Novik](https://github.com/novikd)).
- Function "makeDate" now provides a MySQL-compatible overload (year & day of the year argument). [#49603](https://github.com/ClickHouse/ClickHouse/pull/49603) ([Robert Schulze](https://github.com/rschu1ze)).
- Support `dictionary` table function for `RegExpTreeDictionary`. [#49666](https://github.com/ClickHouse/ClickHouse/pull/49666) ([Han Fei](https://github.com/hanfei1991)).
- Added weighted fair IO scheduling policy. Added dynamic resource manager, which allows IO scheduling hierarchy to be updated in runtime w/o server restarts. [#49671](https://github.com/ClickHouse/ClickHouse/pull/49671) ([Sergei Trifonov](https://github.com/serxa)).
- Add compose request after multipart upload to GCS. This enables the usage of copy operation on objects uploaded with the multipart upload. It's recommended to set `s3_strict_upload_part_size` to some value because compose request can fail on objects created with parts of different sizes. [#49693](https://github.com/ClickHouse/ClickHouse/pull/49693) ([Antonio Andelic](https://github.com/antonio2368)).
- For the `extractKeyValuePairs` function: improve the "best-effort" parsing logic to accept `key_value_delimiter` as a valid part of the value. This also simplifies branching and might even speed up things a bit. [#49760](https://github.com/ClickHouse/ClickHouse/pull/49760) ([Arthur Passos](https://github.com/arthurpassos)).
- Add `initial_query_id` field for system.processors_profile_log [#49777](https://github.com/ClickHouse/ClickHouse/pull/49777) ([helifu](https://github.com/helifu)).
- System log tables can now have custom sorting keys. [#49778](https://github.com/ClickHouse/ClickHouse/pull/49778) ([helifu](https://github.com/helifu)).
- A new field `partitions` to `system.query_log` is used to indicate which partitions are participating in the calculation. [#49779](https://github.com/ClickHouse/ClickHouse/pull/49779) ([helifu](https://github.com/helifu)).
- Added `enable_the_endpoint_id_with_zookeeper_name_prefix` setting for `ReplicatedMergeTree` (disabled by default). When enabled, it adds ZooKeeper cluster name to table's interserver communication endpoint. It avoids `Duplicate interserver IO endpoint` errors when having replicated tables with the same path, but different auxiliary ZooKeepers. [#49780](https://github.com/ClickHouse/ClickHouse/pull/49780) ([helifu](https://github.com/helifu)).
- Add query parameters to `clickhouse-local`. Closes [#46561](https://github.com/ClickHouse/ClickHouse/issues/46561). [#49785](https://github.com/ClickHouse/ClickHouse/pull/49785) ([Nikolay Degterinsky](https://github.com/evillique)).
- Allow loading dictionaries and functions from YAML by default. In previous versions, it required editing the `dictionaries_config` or `user_defined_executable_functions_config` in the configuration file, as they expected `*.xml` files. [#49812](https://github.com/ClickHouse/ClickHouse/pull/49812) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- The Kafka table engine now allows to use alias columns. [#49824](https://github.com/ClickHouse/ClickHouse/pull/49824) ([Aleksandr Musorin](https://github.com/AVMusorin)).
- Add setting to limit the max number of pairs produced by `extractKeyValuePairs`, a safeguard to avoid using way too much memory. [#49836](https://github.com/ClickHouse/ClickHouse/pull/49836) ([Arthur Passos](https://github.com/arthurpassos)).
- Add support for (an unusual) case where the arguments in the `IN` operator are single-element tuples. [#49844](https://github.com/ClickHouse/ClickHouse/pull/49844) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
- `bitHammingDistance` function support `String` and `FixedString` data type. Closes [#48827](https://github.com/ClickHouse/ClickHouse/issues/48827). [#49858](https://github.com/ClickHouse/ClickHouse/pull/49858) ([flynn](https://github.com/ucasfl)).
- Fix timeout resetting errors in the client on OS X. [#49863](https://github.com/ClickHouse/ClickHouse/pull/49863) ([alekar](https://github.com/alekar)).
- Add support for big integers, such as UInt128, Int128, UInt256, and Int256 in the function `bitCount`. This enables Hamming distance over large bit masks for AI applications. [#49867](https://github.com/ClickHouse/ClickHouse/pull/49867) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Fingerprints to be used instead of key IDs in encrypted disks. This simplifies the configuration of encrypted disks. [#49882](https://github.com/ClickHouse/ClickHouse/pull/49882) ([Vitaly Baranov](https://github.com/vitlibar)).
- Add UUID data type to PostgreSQL. Closes [#49739](https://github.com/ClickHouse/ClickHouse/issues/49739). [#49894](https://github.com/ClickHouse/ClickHouse/pull/49894) ([Nikolay Degterinsky](https://github.com/evillique)).
- Function `toUnixTimestamp` now accepts `Date` and `Date32` arguments. [#49989](https://github.com/ClickHouse/ClickHouse/pull/49989) ([Victor Krasnov](https://github.com/sirvickr)).
- Charge only server memory for dictionaries. [#49995](https://github.com/ClickHouse/ClickHouse/pull/49995) ([Azat Khuzhin](https://github.com/azat)).
- The server will allow using the `SQL_*` settings such as `SQL_AUTO_IS_NULL` as no-ops for MySQL compatibility. This closes [#49927](https://github.com/ClickHouse/ClickHouse/issues/49927). [#50013](https://github.com/ClickHouse/ClickHouse/pull/50013) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Preserve initial_query_id for ON CLUSTER queries, which is useful for introspection (under `distributed_ddl_entry_format_version=5`). [#50015](https://github.com/ClickHouse/ClickHouse/pull/50015) ([Azat Khuzhin](https://github.com/azat)).
- Preserve backward incompatibility for renamed settings by using aliases (`allow_experimental_projection_optimization` for `optimize_use_projections`, `allow_experimental_lightweight_delete` for `enable_lightweight_delete`). [#50044](https://github.com/ClickHouse/ClickHouse/pull/50044) ([Azat Khuzhin](https://github.com/azat)).
- Support passing FQDN through setting my_hostname to register cluster node in keeper. Add setting of invisible to support multi compute groups. A compute group as a cluster, is invisible to other compute groups. [#50186](https://github.com/ClickHouse/ClickHouse/pull/50186) ([Yangkuan Liu](https://github.com/LiuYangkuan)).
- Fix PostgreSQL reading all the data even though `LIMIT n` could be specified. [#50187](https://github.com/ClickHouse/ClickHouse/pull/50187) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Add new profile events for queries with subqueries (`QueriesWithSubqueries`/`SelectQueriesWithSubqueries`/`InsertQueriesWithSubqueries`). [#50204](https://github.com/ClickHouse/ClickHouse/pull/50204) ([Azat Khuzhin](https://github.com/azat)).
- Adding the roles field in the users.xml file, which allows specifying roles with grants via a config file. [#50278](https://github.com/ClickHouse/ClickHouse/pull/50278) ([pufit](https://github.com/pufit)).
- Report `CGroupCpuCfsPeriod` and `CGroupCpuCfsQuota` in AsynchronousMetrics. - Respect cgroup v2 memory limits during server startup. [#50379](https://github.com/ClickHouse/ClickHouse/pull/50379) ([alekar](https://github.com/alekar)).
- Add a signal handler for SIGQUIT to work the same way as SIGINT. Closes [#50298](https://github.com/ClickHouse/ClickHouse/issues/50298). [#50435](https://github.com/ClickHouse/ClickHouse/pull/50435) ([Nikolay Degterinsky](https://github.com/evillique)).
- In case JSON parse fails due to the large size of the object output the last position to allow debugging. [#50474](https://github.com/ClickHouse/ClickHouse/pull/50474) ([Valentin Alexeev](https://github.com/valentinalexeev)).
- Support decimals with not fixed size. Closes [#49130](https://github.com/ClickHouse/ClickHouse/issues/49130). [#50586](https://github.com/ClickHouse/ClickHouse/pull/50586) ([Kruglov Pavel](https://github.com/Avogar)).





#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-7}

- 新しく改善された`keeper-bench`。YAML/XMLファイルからすべてをカスタマイズ可能: - リクエストジェネレータ - 各タイプのリクエストジェネレータは特定のフィールドセットを持つことができる - マルチリクエストは`multi`キー配下で同様に生成可能 - マルチ内の各リクエストまたはサブリクエストに対して`weight`フィールドを定義し分散を制御可能 - テスト実行のためにセットアップが必要なツリーを定義 - ホストはすべてのタイムアウトをカスタマイズ可能な形で定義でき、各ホストに対して生成するセッション数を制御可能 - `min_value`および`max_value`フィールドで定義された整数は乱数ジェネレータとなる。[#48547](https://github.com/ClickHouse/ClickHouse/pull/48547) ([Antonio Andelic](https://github.com/antonio2368))。
- Io_uringはmacOSではサポートされていないため、ローカルでテストを実行する際は選択せず、偶発的な失敗を回避する。[#49250](https://github.com/ClickHouse/ClickHouse/pull/49250) ([Frank Chen](https://github.com/FrankChen021))。
- テスト用の名前付きフォールトインジェクションをサポート。[#49361](https://github.com/ClickHouse/ClickHouse/pull/49361) ([Han Fei](https://github.com/hanfei1991))。
- AWS Lambdaなど、`prctl`(プロセス制御)システムコールが利用できないOS上でのClickHouseの実行を許可。[#49538](https://github.com/ClickHouse/ClickHouse/pull/49538) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- contrib/isa-lとqpl内のisa-l間のビルド競合の問題を修正 [49296](https://github.com/ClickHouse/ClickHouse/issues/49296)。[#49584](https://github.com/ClickHouse/ClickHouse/pull/49584) ([jasperzhu](https://github.com/jinjunzh))。
- ユーティリティは、デフォルトではなく明示的に要求された場合("-DENABLE_UTILS=1")のみビルドされるようになり、通常の開発ビルドにおけるリンク時間が短縮される。[#49620](https://github.com/ClickHouse/ClickHouse/pull/49620) ([Robert Schulze](https://github.com/rschu1ze))。
- idxd-configのビルド記述を別のCMakeファイルに分離し、将来の誤削除を回避。[#49651](https://github.com/ClickHouse/ClickHouse/pull/49651) ([jasperzhu](https://github.com/jinjunzh))。
- masterブランチでアナライザを有効にしたCIチェックを追加。フォローアップ [#49562](https://github.com/ClickHouse/ClickHouse/issues/49562)。[#49668](https://github.com/ClickHouse/ClickHouse/pull/49668) ([Dmitry Novik](https://github.com/novikd))。
- LLVM/clang 16に切り替え。[#49678](https://github.com/ClickHouse/ClickHouse/pull/49678) ([Azat Khuzhin](https://github.com/azat))。
- clang-17でのClickHouseのビルドを許可。[#49851](https://github.com/ClickHouse/ClickHouse/pull/49851) ([Alexey Milovidov](https://github.com/alexey-milovidov))。[#50410](https://github.com/ClickHouse/ClickHouse/pull/50410) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ClickHouseが他のcmakeプロジェクトへの統合がより容易になった。[#49991](https://github.com/ClickHouse/ClickHouse/pull/49991) ([Amos Bird](https://github.com/amosbird))。(これは強く非推奨 - Alexey Milovidov)。
- [#47151](https://github.com/ClickHouse/ClickHouse/issues/47151)以降の奇妙な追加QEMUログを修正、https://s3.amazonaws.com/clickhouse-test-reports/50078/a4743996ee4f3583884d07bcd6501df0cfdaa346/stateless_tests__release__databasereplicated__[3_4].htmlを参照。[#50442](https://github.com/ClickHouse/ClickHouse/pull/50442) ([Mikhail f. Shiryaev](https://github.com/Felixoid))。
- ClickHouseがLinux RISC-V 6.1.22上で動作可能に。これにより[#50456](https://github.com/ClickHouse/ClickHouse/issues/50456)がクローズ。[#50457](https://github.com/ClickHouse/ClickHouse/pull/50457) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 内部protobufをv3.18にバージョンアップ(誤ったCVE-2022-1941を修正)。[#50400](https://github.com/ClickHouse/ClickHouse/pull/50400) ([Robert Schulze](https://github.com/rschu1ze))。
- 内部libxml2をv2.10.4にバージョンアップ(誤ったCVE-2023-28484および誤ったCVE-2023-29469を修正)。[#50402](https://github.com/ClickHouse/ClickHouse/pull/50402) ([Robert Schulze](https://github.com/rschu1ze))。
- c-aresをv1.19.1にバージョンアップ(誤ったCVE-2023-32067、誤ったCVE-2023-31130、誤ったCVE-2023-31147)。[#50403](https://github.com/ClickHouse/ClickHouse/pull/50403) ([Robert Schulze](https://github.com/rschu1ze))。
- libgsasl内の誤ったCVE-2022-2469を修正。[#50404](https://github.com/ClickHouse/ClickHouse/pull/50404) ([Robert Schulze](https://github.com/rschu1ze))。

#### バグ修正（公式安定版リリースにおけるユーザーに影響する不具合） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-7}


* ActionsDAG: 誤った最適化を修正 [#47584](https://github.com/ClickHouse/ClickHouse/pull/47584) ([Salvatore Mesoraca](https://github.com/aiven-sal))。
* Keeper における同時スナップショット処理を正しく対応 [#48466](https://github.com/ClickHouse/ClickHouse/pull/48466) ([Antonio Andelic](https://github.com/antonio2368))。
* MergeTreeMarksLoader が DataPartStorage ではなく DataPart を保持するようになりました [#48515](https://github.com/ClickHouse/ClickHouse/pull/48515) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
* シーケンス状態の修正。 [#48603](https://github.com/ClickHouse/ClickHouse/pull/48603)（[Ilya Golshtein](https://github.com/ilejn)）。
* バックアップ/リストアの同時実行チェックで、過去の失敗を考慮するように修正 [#48726](https://github.com/ClickHouse/ClickHouse/pull/48726) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
* 存在しない ZK パスを持つテーブルを `ATTACH` しても `ReadonlyReplica` メトリクスが増加しない問題を修正 [#48954](https://github.com/ClickHouse/ClickHouse/pull/48954) ([wangxiaobo](https://github.com/wzb5212)).
* 一部の箇所で発生しうる、捕捉されない例外による `terminate` 呼び出しを修正しました [#49112](https://github.com/ClickHouse/ClickHouse/pull/49112) ([Kruglov Pavel](https://github.com/Avogar)).
* 複数の StorageJoin を含むクエリで発生する key not found エラーを修正しました [#49137](https://github.com/ClickHouse/ClickHouse/pull/49137) ([vdimir](https://github.com/vdimir))。
* Nullable なプライマリキーを使用している場合に誤ったクエリ結果が返される問題を修正 [#49172](https://github.com/ClickHouse/ClickHouse/pull/49172) ([Duc Canh Le](https://github.com/canhld94))。
* ビッグエンディアンマシン上での reinterpretAs*() の動作を修正 [#49198](https://github.com/ClickHouse/ClickHouse/pull/49198)（[Suzy Wang](https://github.com/SuzyWangIBMer)）。
* （実験的なゼロコピーレプリケーション）ゼロコピーのパーツをよりアトミックにロックするように変更 [#49211](https://github.com/ClickHouse/ClickHouse/pull/49211) ([alesapin](https://github.com/alesapin))。
* 古いパーツ読み込み時の競合状態を修正 [#49223](https://github.com/ClickHouse/ClickHouse/pull/49223) ([Alexander Tokmakov](https://github.com/tavplubix))。
* すべてのキー値が null の場合や `GROUP BY ... WITH ROLLUP` を使用した場合に誤った結果が返される問題を修正 [#49282](https://github.com/ClickHouse/ClickHouse/pull/49282)（[Shuai li](https://github.com/loneylee)）。
* SHARDS を使用する HASHED 辞書の `load_factor` の計算を修正 [#49319](https://github.com/ClickHouse/ClickHouse/pull/49319) ([Azat Khuzhin](https://github.com/azat))。
* エイリアス列に対する圧縮 CODEC の設定を禁止するよう変更 [#49363](https://github.com/ClickHouse/ClickHouse/pull/49363)（[Timur Solodovnikov](https://github.com/tsolodov)）。
* 既存パートディレクトリの削除処理におけるバグを修正 [#49365](https://github.com/ClickHouse/ClickHouse/pull/49365) ([alesapin](https://github.com/alesapin))。
* HMAC 使用時の GCS の不具合を適切に修正 [#49390](https://github.com/ClickHouse/ClickHouse/pull/49390)（[Antonio Andelic](https://github.com/antonio2368)）。
* remote() から読み取る際にサブクエリセットが構築されない fuzz バグを修正 [#49425](https://github.com/ClickHouse/ClickHouse/pull/49425) ([Alexander Gololobov](https://github.com/davenger))。
* `shutdown_wait_unfinished_queries` を反転しました [#49427](https://github.com/ClickHouse/ClickHouse/pull/49427) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* (実験的なゼロコピー レプリケーション) ゼロコピー関連の別のバグを修正 [#49473](https://github.com/ClickHouse/ClickHouse/pull/49473) ([alesapin](https://github.com/alesapin)).
* PostgreSQL データベース設定を修正 [#49481](https://github.com/ClickHouse/ClickHouse/pull/49481) ([Mal Curtis](https://github.com/snikch))。
* `s3Cluster` 引数を正しく処理するよう修正しました [#49490](https://github.com/ClickHouse/ClickHouse/pull/49490) ([Antonio Andelic](https://github.com/antonio2368)).
* TraceCollector のデストラクタのバグを修正。 [#49508](https://github.com/ClickHouse/ClickHouse/pull/49508) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 短いシークで動作が壊れる AsynchronousReadIndirectBufferFromRemoteFS を修正 [#49525](https://github.com/ClickHouse/ClickHouse/pull/49525) ([Michael Kolupaev](https://github.com/al13n321)).
* 辞書の読み込み順を修正 [#49560](https://github.com/ClickHouse/ClickHouse/pull/49560) ([Alexander Tokmakov](https://github.com/tavplubix)).
* Object(&#39;json&#39;) 列のデータ型の変更を禁止 [#49563](https://github.com/ClickHouse/ClickHouse/pull/49563) ([Nikolay Degterinsky](https://github.com/evillique))。
* ストレステストを修正（論理エラー: Expected 7134 &lt; 11030）[#49623](https://github.com/ClickHouse/ClickHouse/pull/49623)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* DISTINCT のバグを修正 [#49628](https://github.com/ClickHouse/ClickHouse/pull/49628)（[Alexey Milovidov](https://github.com/alexey-milovidov) による）。
* 修正: ソートされていない列にゼロ値がある場合の `ORDER BY` と `DISTINCT` の動作を修正 [#49636](https://github.com/ClickHouse/ClickHouse/pull/49636) ([Igor Nikonov](https://github.com/devcrafter))。
* fuzzer によって UBSan で検出された大きな整数における off-by-one エラーを修正 [#49645](https://github.com/ClickHouse/ClickHouse/pull/49645)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 再起動後のスパース列からの読み込みを修正 [#49660](https://github.com/ClickHouse/ClickHouse/pull/49660) ([Anton Popov](https://github.com/CurtizJ)).
* ファイバー使用時の `SpanHolder::finish()` 内の `assert` を修正 [#49673](https://github.com/ClickHouse/ClickHouse/pull/49673)（[Kruglov Pavel](https://github.com/Avogar)）。
* スパースな引数を持つショートサーキット関数およびミューテーションを修正 [#49716](https://github.com/ClickHouse/ClickHouse/pull/49716) ([Anton Popov](https://github.com/CurtizJ)).
* 追記されたファイルのインクリメンタルバックアップへの書き込み処理を修正 [#49725](https://github.com/ClickHouse/ClickHouse/pull/49725)（[Vitaly Baranov](https://github.com/vitlibar)）。
* Object 列を持つテーブルに対する軽量 DELETE ミューテーション中に発生する「There is no physical column &#95;row&#95;exists in table」エラーを修正。 [#49737](https://github.com/ClickHouse/ClickHouse/pull/49737) ([Alexander Gololobov](https://github.com/davenger)).
* randomStringUTF8（不均一な数）における msan の問題を修正 [#49750](https://github.com/ClickHouse/ClickHouse/pull/49750) ([Robert Schulze](https://github.com/rschu1ze)).
* 集約関数 `kolmogorovSmirnovTest` を修正しました [#49768](https://github.com/ClickHouse/ClickHouse/pull/49768)（[FFFFFFFHHHHHHH](https://github.com/FFFFFFFHHHHHHH)）。
* ネイティブプロトコルにおける設定エイリアスを修正 [#49776](https://github.com/ClickHouse/ClickHouse/pull/49776) ([Azat Khuzhin](https://github.com/azat))。
* 単一要素のタプル配列に対する `arrayMap` を修正 [#49789](https://github.com/ClickHouse/ClickHouse/pull/49789) ([Anton Popov](https://github.com/CurtizJ))。
* クエリ単位の IO/BACKUP スロットリング設定を修正 [#49797](https://github.com/ClickHouse/ClickHouse/pull/49797) ([Azat Khuzhin](https://github.com/azat)).
* プロファイル定義で `NULL` を設定できない問題を修正 [#49831](https://github.com/ClickHouse/ClickHouse/pull/49831)（[Vitaly Baranov](https://github.com/vitlibar)）。
* プロジェクションと `aggregate_functions_null_for_empty` 設定（`query_plan_optimize_projection` 用）に関するバグを修正 [#49873](https://github.com/ClickHouse/ClickHouse/pull/49873)（[Amos Bird](https://github.com/amosbird)）。
* 再起動後の Distributed エンジンにおける非同期 `INSERT` で、保留中バッチの処理を修正 [#49884](https://github.com/ClickHouse/ClickHouse/pull/49884) ([Azat Khuzhin](https://github.com/azat))。
* CacheMetadata::doCleanup のアサートを修正 [#49914](https://github.com/ClickHouse/ClickHouse/pull/49914) ([Kseniia Sumarokova](https://github.com/kssenii))。
* OptimizeRegularExpression における `is_prefix` を修正しました [#49919](https://github.com/ClickHouse/ClickHouse/pull/49919)（[Han Fei](https://github.com/hanfei1991)）。
* メトリクス `WriteBufferFromS3Bytes`、`WriteBufferFromS3Microseconds`、`WriteBufferFromS3RequestsErrors` を修正 [#49930](https://github.com/ClickHouse/ClickHouse/pull/49930)（[Aleksandr Musorin](https://github.com/AVMusorin)）。
* protobuf における IPv6 のエンコードを修正 [#49933](https://github.com/ClickHouse/ClickHouse/pull/49933) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* テキスト形式における不正な `Nullable` パースによって発生し得る論理エラーを修正 [#49960](https://github.com/ClickHouse/ClickHouse/pull/49960)（[Kruglov Pavel](https://github.com/Avogar)）。
* より互換性の高い Parquet ファイルを生成するため、設定 output&#95;format&#95;parquet&#95;compliant&#95;nested&#95;types を追加 [#50001](https://github.com/ClickHouse/ClickHouse/pull/50001)（[Michael Kolupaev](https://github.com/al13n321)）。
* ストレステスト「Not enough space to add ...」における論理エラーを修正。 [#50021](https://github.com/ClickHouse/ClickHouse/pull/50021) ([Kseniia Sumarokova](https://github.com/kssenii))。
* `ReplicatedMergeTree` の attach スレッドでテーブルを開始する際に発生するデッドロックを回避 [#50026](https://github.com/ClickHouse/ClickHouse/pull/50026) ([Antonio Andelic](https://github.com/antonio2368)).
* SpanHolder::finish() における fibers 使用時の assert の修正 (試行2) [#50034](https://github.com/ClickHouse/ClickHouse/pull/50034) ([Kruglov Pavel](https://github.com/Avogar)).
* DDL OpenTelemetry コンテキストのシリアライズに適切なエスケープ処理を追加 [#50045](https://github.com/ClickHouse/ClickHouse/pull/50045) ([Azat Khuzhin](https://github.com/azat))。
* 破損したプロジェクションパーツの報告処理を修正 [#50052](https://github.com/ClickHouse/ClickHouse/pull/50052) ([Amos Bird](https://github.com/amosbird))。
* JIT コンパイルが NaN 修正と等価でない問題を修正 [#50056](https://github.com/ClickHouse/ClickHouse/pull/50056)（[Maksim Kita](https://github.com/kitaisreal)）。
* 引数なしの Replicated データベースで発生するクラッシュを修正 [#50058](https://github.com/ClickHouse/ClickHouse/pull/50058)（[Azat Khuzhin](https://github.com/azat)）。
* `multiIf` の定数条件と Nullable 引数の組み合わせで発生していたクラッシュを修正 [#50123](https://github.com/ClickHouse/ClickHouse/pull/50123) ([Anton Popov](https://github.com/CurtizJ))。
* 日付関連キーに対する不正なインデックス解析を修正 [#50153](https://github.com/ClickHouse/ClickHouse/pull/50153)（[Amos Bird](https://github.com/amosbird)）。
* `ORDER BY` 列が存在しない場合は `ORDER BY` の変更を許可しないようにしました [#50154](https://github.com/ClickHouse/ClickHouse/pull/50154) ([Han Fei](https://github.com/hanfei1991))。
* バイナリ演算子に `NULL` の定数引数が含まれている場合の不正なインデックス解析を修正 [#50177](https://github.com/ClickHouse/ClickHouse/pull/50177) ([Amos Bird](https://github.com/amosbird))。
* clickhouse-client: `--query` と `--queries-file` を同時に使用できないように変更 [#50210](https://github.com/ClickHouse/ClickHouse/pull/50210)（[Alexey Gerasimchuk](https://github.com/Demilivor)）。
* INTO OUTFILE 拡張機能（APPEND / AND STDOUT）および WATCH EVENTS の未定義動作を修正 [#50216](https://github.com/ClickHouse/ClickHouse/pull/50216)（[Azat Khuzhin](https://github.com/azat)）。
* CustomSeparatedIgnoreSpaces フォーマットで行末のスペースがスキップされる問題を修正 [#50224](https://github.com/ClickHouse/ClickHouse/pull/50224) ([Kruglov Pavel](https://github.com/Avogar))。
* Iceberg メタデータのパースを修正 [#50232](https://github.com/ClickHouse/ClickHouse/pull/50232) ([Kseniia Sumarokova](https://github.com/kssenii)).
* WITH 句内のネストされた分散 SELECT を修正 [#50234](https://github.com/ClickHouse/ClickHouse/pull/50234) ([Azat Khuzhin](https://github.com/azat))。
* キー付き SipHash における msan の問題を修正 [#50245](https://github.com/ClickHouse/ClickHouse/pull/50245) ([Robert Schulze](https://github.com/rschu1ze))。
* ノンブロッキングモードにおける Poco ソケットのバグを修正し、実際のノンブロッキングソケットを使用するようにしました [#50252](https://github.com/ClickHouse/ClickHouse/pull/50252) ([Kruglov Pavel](https://github.com/Avogar))。
* バックアップエントリのチェックサム計算を修正 [#50264](https://github.com/ClickHouse/ClickHouse/pull/50264)（[Vitaly Baranov](https://github.com/vitlibar)）。
* 比較関数における NaN の扱いを修正 [#50287](https://github.com/ClickHouse/ClickHouse/pull/50287)（[Maksim Kita](https://github.com/kitaisreal)）。
* JIT 集約における Nullable キーの修正 [#50291](https://github.com/ClickHouse/ClickHouse/pull/50291) ([Maksim Kita](https://github.com/kitaisreal))。
* 空の Arrow または Parquet 出力を書き込む際に `clickhouse-local` がクラッシュする問題を修正しました [#50328](https://github.com/ClickHouse/ClickHouse/pull/50328) ([Michael Kolupaev](https://github.com/al13n321))。
* Pool::Entry::disconnect() が呼び出されたときに発生するクラッシュを修正 [#50334](https://github.com/ClickHouse/ClickHouse/pull/50334) ([Val Doroshchuk](https://github.com/valbok)).
* ディレクトリロックの保持時間を延長することでフェッチパーツを改善 [#50339](https://github.com/ClickHouse/ClickHouse/pull/50339) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
* 両方の引数が定数である `bitShift*` 関数を修正 [#50343](https://github.com/ClickHouse/ClickHouse/pull/50343)（[Kruglov Pavel](https://github.com/Avogar)）。
* リクエストの前処理中に例外が発生した際に Keeper がデッドロックする問題を修正。 [#50387](https://github.com/ClickHouse/ClickHouse/pull/50387) ([frinkr](https://github.com/frinkr)).
* const 整数値のハッシュ処理を修正 [#50421](https://github.com/ClickHouse/ClickHouse/pull/50421) ([Robert Schulze](https://github.com/rschu1ze))。
* データスキップインデックスに対する merge&#95;tree&#95;min&#95;rows&#95;for&#95;seek および merge&#95;tree&#95;min&#95;bytes&#95;for&#95;seek を修正 [#50432](https://github.com/ClickHouse/ClickHouse/pull/50432) ([Azat Khuzhin](https://github.com/azat))。
* 古いパーツをロードするインフライトタスクの数を制限するように変更 [#50450](https://github.com/ClickHouse/ClickHouse/pull/50450) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Keeper の修正: スナップショットインストール後に未コミット状態を適用 [#50483](https://github.com/ClickHouse/ClickHouse/pull/50483) ([Antonio Andelic](https://github.com/antonio2368)).
* 誤った定数フォールディングを修正 [#50536](https://github.com/ClickHouse/ClickHouse/pull/50536) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* ストレステストで発生していた論理エラー（Not enough space to add ...）を修正 [#50583](https://github.com/ClickHouse/ClickHouse/pull/50583)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* values テーブル関数における Null から LowCardinality(Nullable) への変換処理を修正 [#50637](https://github.com/ClickHouse/ClickHouse/pull/50637) ([Kruglov Pavel](https://github.com/Avogar)).
* 無効な RegExpTreeDictionary の最適化を取り消す [#50642](https://github.com/ClickHouse/ClickHouse/pull/50642)（[Johann Gan](https://github.com/johanngan)）。

### <a id="234"></a> ClickHouse リリース 23.4, 2023-04-26 {#234}

#### 後方互換性のない変更 {#backward-incompatible-change-7}

- formatDateTime() 関数のフォーマッタ '%M' は、分ではなく月名を出力するようになりました。これにより、MySQL との動作の一貫性が保たれます。以前の動作は、設定 "formatdatetime_parsedatetime_m_is_month_name = 0" を使用することで復元できます。[#47246](https://github.com/ClickHouse/ClickHouse/pull/47246) ([Robert Schulze](https://github.com/rschu1ze))。
- この変更は、仮想ファイルシステムキャッシュを使用している場合にのみ該当します。仮想ファイルシステムキャッシュ設定の `path` が空でなく、絶対パスでない場合、`<clickhouse server data directory>/caches/<path_from_cache_config>` に配置されます。[#48784](https://github.com/ClickHouse/ClickHouse/pull/48784) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 同一の式を持つプライマリ/セカンダリインデックスおよびソートキーは拒否されるようになりました。この動作は、設定 `allow_suspicious_indices` を使用することで無効にできます。[#48536](https://github.com/ClickHouse/ClickHouse/pull/48536) ([凌涛](https://github.com/lingtaolf))。


#### 新機能 {#new-feature-8}

- 新しい集約関数`quantileGK`/`quantilesGK`をサポートしました。Sparkの[approx_percentile](https://spark.apache.org/docs/latest/api/sql/index.html#approx_percentile)と同様です。Greenwald-Khannaアルゴリズムについては http://infolab.stanford.edu/~datar/courses/cs361a/papers/quantiles.pdf を参照してください。[#46428](https://github.com/ClickHouse/ClickHouse/pull/46428) ([李扬](https://github.com/taiyang-li))。
- system.columnsから抽出された情報を表示する`SHOW COLUMNS`ステートメントを追加しました。[#48017](https://github.com/ClickHouse/ClickHouse/pull/48017) ([Robert Schulze](https://github.com/rschu1ze))。
- `SYSTEM SYNC REPLICA`クエリに`LIGHTWEIGHT`および`PULL`修飾子を追加しました。`LIGHTWEIGHT`バージョンはフェッチとドロップレンジのみを待機します(マージとミューテーションは無視されます)。`PULL`バージョンはZooKeeperから新しいエントリを取得しますが、それらの完了を待機しません。[#47794](https://github.com/ClickHouse/ClickHouse/issues/47794)を修正しました。[#48085](https://github.com/ClickHouse/ClickHouse/pull/48085) ([Alexander Tokmakov](https://github.com/tavplubix))。
- Kafka DefaultPartitionerとの互換性のために`kafkaMurmurHash`関数を追加しました。[#47834](https://github.com/ClickHouse/ClickHouse/issues/47834)をクローズしました。[#48185](https://github.com/ClickHouse/ClickHouse/pull/48185) ([Nikolay Degterinsky](https://github.com/evillique))。
- `GRANT CURRENT GRANTS`を使用して、現在のユーザーと同じ権限を持つユーザーを簡単に作成できるようにしました。[#48262](https://github.com/ClickHouse/ClickHouse/pull/48262) ([pufit](https://github.com/pufit))。
- 統計集約関数`kolmogorovSmirnovTest`を追加しました。[#48228](https://github.com/ClickHouse/ClickHouse/issues/48228)をクローズしました。[#48325](https://github.com/ClickHouse/ClickHouse/pull/48325) ([FFFFFFFHHHHHHH](https://github.com/FFFFFFFHHHHHHH))。
- `system.replicas`テーブルに`lost_part_count`カラムを追加しました。このカラムの値は、対応するテーブルで失われたパートの総数を示します。値はZooKeeperに保存され、監視のために永続化されない`ReplicatedDataLoss`プロファイルイベントの代わりに使用できます。[#48526](https://github.com/ClickHouse/ClickHouse/pull/48526) ([Sergei Trifonov](https://github.com/serxa))。
- 互換性のために`soundex`関数を追加しました。[#39880](https://github.com/ClickHouse/ClickHouse/issues/39880)をクローズしました。[#48567](https://github.com/ClickHouse/ClickHouse/pull/48567) ([FriendLey](https://github.com/FriendLey))。
- JSONExtractで`Map`型をサポートしました。[#48629](https://github.com/ClickHouse/ClickHouse/pull/48629) ([李扬](https://github.com/taiyang-li))。
- 改行区切りと4スペースインデントで整形されたJSONを出力する`PrettyJSONEachRow`フォーマットを追加しました。[#48898](https://github.com/ClickHouse/ClickHouse/pull/48898) ([Kruglov Pavel](https://github.com/Avogar))。
- Parquetファイルのメタデータを読み取るための`ParquetMetadata`入力フォーマットを追加しました。[#48911](https://github.com/ClickHouse/ClickHouse/pull/48911) ([Kruglov Pavel](https://github.com/Avogar))。
- 文字列からキーバリューペアを抽出する`extractKeyValuePairs`関数を追加しました。入力文字列にはノイズが含まれる可能性があり(例:ログファイル / キーバリューペア形式で100%フォーマットされている必要はありません)、アルゴリズムは関数に渡された引数に一致するキーバリューペアを検索します。現在、この関数は次の引数を受け付けます:`data_column`(必須)、`key_value_pair_delimiter`(デフォルトは`:`)、`pair_delimiters`(デフォルトは`\space \, \;`)、`quoting_character`(デフォルトは二重引用符)。[#43606](https://github.com/ClickHouse/ClickHouse/pull/43606) ([Arthur Passos](https://github.com/arthurpassos))。
- replaceOne()、replaceAll()、replaceRegexpOne()、replaceRegexpAll()関数が、非const型のパターンおよび置換引数で呼び出せるようになりました。[#46589](https://github.com/ClickHouse/ClickHouse/pull/46589) ([Robert Schulze](https://github.com/rschu1ze))。
- `Map`型のカラムを操作する関数を追加しました:`mapConcat`、`mapSort`、`mapExists`。[#48071](https://github.com/ClickHouse/ClickHouse/pull/48071) ([Anton Popov](https://github.com/CurtizJ))。

#### パフォーマンス改善 {#performance-improvement-8}

- `Parquet`形式のファイル読み込みが大幅に高速化されました。IOとデコードが並列化され（`max_threads`設定で制御）、必要なデータ範囲のみが読み込まれるようになりました。[#47964](https://github.com/ClickHouse/ClickHouse/pull/47964) ([Michael Kolupaev](https://github.com/al13n321))。
- 次のようなIN（サブクエリ）を使用したミューテーションを実行する場合：`ALTER TABLE t UPDATE col='new value' WHERE id IN (SELECT id FROM huge_table)`、テーブル`t`に複数のパートがあると、各パートに対してサブクエリ`SELECT id FROM huge_table`のセットがメモリ内に構築されます。パートが多数ある場合、大量のメモリ（OOMにつながる可能性があります）とCPUを消費する可能性があります。解決策として、ミューテーションタスクによって現在構築中のセットの短期キャッシュを導入しました。同じミューテーションの別のタスクが同時に実行される場合、キャッシュ内のセットを検索し、構築が完了するのを待ってから再利用できます。[#46835](https://github.com/ClickHouse/ClickHouse/pull/46835) ([Alexander Gololobov](https://github.com/davenger))。
- `ALTER TABLE`クエリを適用する際、必要な場合にのみ依存関係をチェックするようになりました。[#48062](https://github.com/ClickHouse/ClickHouse/pull/48062) ([Raúl Marín](https://github.com/Algunenano))。
- `mapUpdate`関数を最適化しました。[#48118](https://github.com/ClickHouse/ClickHouse/pull/48118) ([Anton Popov](https://github.com/CurtizJ))。
- ローカルレプリカへの内部クエリが明示的に送信され、そこからのデータがループバックインターフェースを通じて受信されるようになりました。並列レプリカでは`prefer_localhost_replica`設定は考慮されません。これはより良いスケジューリングのために必要であり、コードをよりクリーンにします：イニシエーターは読み取りプロセスの調整と結果のマージのみを担当し、すべてのセカンダリクエリがデータを読み取る間、継続的にリクエストに応答します。注意：ループバックインターフェースの使用はそれほど高性能ではありませんが、そうしないと一部のレプリカがタスク不足に陥り、クエリ実行がさらに遅くなり、利用可能なすべてのリソースを活用できなくなる可能性があります。コーディネーターの初期化はさらに遅延されるようになりました。すべての受信リクエストには読み取りアルゴリズムに関する情報が含まれており、最初のリクエストが到着したときにそれを使用してコーディネーターを初期化します。いずれかのレプリカが異なるアルゴリズムで読み取ることを決定した場合、例外がスローされ、クエリが中止されます。[#48246](https://github.com/ClickHouse/ClickHouse/pull/48246) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- スキップインデックスの分析にのみ使用され、設定（`use_skip_indexes=0`）で無効化されている場合、サブクエリを含む`IN`句の右側のセットを構築しないようになりました。以前はクエリのパフォーマンスに影響を与える可能性がありました。[#48299](https://github.com/ClickHouse/ClickHouse/pull/48299) ([Anton Popov](https://github.com/CurtizJ))。
- `FROM file(...)`からの読み取り直後にクエリ処理が並列化されるようになりました。[#38755](https://github.com/ClickHouse/ClickHouse/issues/38755)に関連します。[#48525](https://github.com/ClickHouse/ClickHouse/pull/48525) ([Igor Nikonov](https://github.com/devcrafter))。任意のデータソースからの読み取り直後にクエリ処理が並列化されるようになりました。影響を受けるデータソースは、主にテーブル関数`url`、`file`などのシンプルまたは外部ストレージです。[#48727](https://github.com/ClickHouse/ClickHouse/pull/48727) ([Igor Nikonov](https://github.com/devcrafter))。これは`parallelize_output_from_storages`設定によって制御され、デフォルトでは有効になっていません。
- ThreadPoolミューテックスの競合を低減しました（大量の小規模ジョブのパフォーマンスが向上する可能性があります）。[#48750](https://github.com/ClickHouse/ClickHouse/pull/48750) ([Sergei Trifonov](https://github.com/serxa))。
- 複数の`ALTER DELETE`ミューテーションのメモリ使用量を削減しました。[#48522](https://github.com/ClickHouse/ClickHouse/pull/48522) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- `skip_unavailable_shards`設定が有効な場合、過剰な接続試行を削除しました。[#48771](https://github.com/ClickHouse/ClickHouse/pull/48771) ([Azat Khuzhin](https://github.com/azat))。


#### 実験的機能 {#experimental-feature-5}

- クエリキャッシュのエントリがmax_block_sizeに統合され、圧縮されるようになりました。[#45912](https://github.com/ClickHouse/ClickHouse/pull/45912) ([Robert Schulze](https://github.com/rschu1ze))。
- クエリキャッシュでユーザーごとのクォータを定義できるようになりました。[#48284](https://github.com/ClickHouse/ClickHouse/pull/48284) ([Robert Schulze](https://github.com/rschu1ze))。
- 並列レプリカに関するいくつかの修正。[#48433](https://github.com/ClickHouse/ClickHouse/pull/48433) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- 暗号化ディスク上でゼロコピーレプリケーション(実験的機能)を実装。[#48741](https://github.com/ClickHouse/ClickHouse/pull/48741) ([Vitaly Baranov](https://github.com/vitlibar))。


#### 改善 {#improvement-8}

- Increase default value for `connect_timeout_with_failover_ms` to 1000 ms (because of adding async connections in https://github.com/ClickHouse/ClickHouse/pull/47229) . Closes [#5188](https://github.com/ClickHouse/ClickHouse/issues/5188). [#49009](https://github.com/ClickHouse/ClickHouse/pull/49009) ([Kruglov Pavel](https://github.com/Avogar)).
- Several improvements around data lakes: - Make `Iceberg` work with non-partitioned data. - Support `Iceberg` format version v2 (previously only v1 was supported) - Support reading partitioned data for `DeltaLake`/`Hudi` - Faster reading of `DeltaLake` metadata by using Delta's checkpoint files - Fixed incorrect `Hudi` reads: previously it incorrectly chose which data to read and therefore was able to read correctly only small size tables - Made these engines to pickup updates of changed data (previously the state was set on table creation) - Make proper testing for `Iceberg`/`DeltaLake`/`Hudi` using spark. [#47307](https://github.com/ClickHouse/ClickHouse/pull/47307) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Add async connection to socket and async writing to socket. Make creating connections and sending query/external tables async across shards. Refactor code with fibers. Closes [#46931](https://github.com/ClickHouse/ClickHouse/issues/46931). We will be able to increase `connect_timeout_with_failover_ms` by default after this PR (https://github.com/ClickHouse/ClickHouse/issues/5188). [#47229](https://github.com/ClickHouse/ClickHouse/pull/47229) ([Kruglov Pavel](https://github.com/Avogar)).
- Support config sections `keeper`/`keeper_server` as an alternative to `zookeeper`. Close [#34766](https://github.com/ClickHouse/ClickHouse/issues/34766) , [#34767](https://github.com/ClickHouse/ClickHouse/issues/34767). [#35113](https://github.com/ClickHouse/ClickHouse/pull/35113) ([李扬](https://github.com/taiyang-li)).
- It is possible to set _secure_ flag in named_collections for a dictionary with a ClickHouse table source. Addresses [#38450](https://github.com/ClickHouse/ClickHouse/issues/38450) . [#46323](https://github.com/ClickHouse/ClickHouse/pull/46323) ([Ilya Golshtein](https://github.com/ilejn)).
- `bitCount` function support `FixedString` and `String` data type. [#49044](https://github.com/ClickHouse/ClickHouse/pull/49044) ([flynn](https://github.com/ucasfl)).
- Added configurable retries for all operations with [Zoo]Keeper for Backup queries. [#47224](https://github.com/ClickHouse/ClickHouse/pull/47224) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
- Enable `use_environment_credentials` for S3 by default, so the entire provider chain is constructed by default. [#47397](https://github.com/ClickHouse/ClickHouse/pull/47397) ([Antonio Andelic](https://github.com/antonio2368)).
- Currently, the JSON_VALUE function is similar as spark's get_json_object function, which support to get value from JSON string by a path like '$.key'. But still has something different - 1. in spark's get_json_object will return null while the path is not exist, but in JSON_VALUE will return empty string; - 2. in spark's get_json_object will return a complex type value, such as a JSON object/array value, but in JSON_VALUE will return empty string. [#47494](https://github.com/ClickHouse/ClickHouse/pull/47494) ([KevinyhZou](https://github.com/KevinyhZou)).
- For `use_structure_from_insertion_table_in_table_functions` more flexible insert table structure propagation to table function. Fixed an issue with name mapping and using virtual columns. No more need for 'auto' setting. [#47962](https://github.com/ClickHouse/ClickHouse/pull/47962) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- Do not continue retrying to connect to Keeper if the query is killed or over limits. [#47985](https://github.com/ClickHouse/ClickHouse/pull/47985) ([Raúl Marín](https://github.com/Algunenano)).
- Support Enum output/input in `BSONEachRow`, allow all map key types and avoid extra calculations on output. [#48122](https://github.com/ClickHouse/ClickHouse/pull/48122) ([Kruglov Pavel](https://github.com/Avogar)).
- Support more ClickHouse types in `ORC`/`Arrow`/`Parquet` formats: Enum(8|16), (U)Int(128|256), Decimal256 (for ORC), allow reading IPv4 from Int32 values (ORC outputs IPv4 as Int32, and we couldn't read it back), fix reading Nullable(IPv6) from binary data for `ORC`. [#48126](https://github.com/ClickHouse/ClickHouse/pull/48126) ([Kruglov Pavel](https://github.com/Avogar)).
- Add columns `perform_ttl_move_on_insert`, `load_balancing` for table `system.storage_policies`, modify column `volume_type` type to `Enum8`. [#48167](https://github.com/ClickHouse/ClickHouse/pull/48167) ([lizhuoyu5](https://github.com/lzydmxy)).
- Added support for `BACKUP ALL` command which backups all tables and databases, including temporary and system ones. [#48189](https://github.com/ClickHouse/ClickHouse/pull/48189) ([Vitaly Baranov](https://github.com/vitlibar)).
- Function mapFromArrays supports `Map` type as an input. [#48207](https://github.com/ClickHouse/ClickHouse/pull/48207) ([李扬](https://github.com/taiyang-li)).
- The output of some SHOW PROCESSLIST is now sorted. [#48241](https://github.com/ClickHouse/ClickHouse/pull/48241) ([Robert Schulze](https://github.com/rschu1ze)).
- Per-query/per-server throttling for remote IO/local IO/BACKUPs (server settings: `max_remote_read_network_bandwidth_for_server`, `max_remote_write_network_bandwidth_for_server`, `max_local_read_bandwidth_for_server`, `max_local_write_bandwidth_for_server`, `max_backup_bandwidth_for_server`, settings: `max_remote_read_network_bandwidth`, `max_remote_write_network_bandwidth`, `max_local_read_bandwidth`, `max_local_write_bandwidth`, `max_backup_bandwidth`). [#48242](https://github.com/ClickHouse/ClickHouse/pull/48242) ([Azat Khuzhin](https://github.com/azat)).
- Support more types in `CapnProto` format: Map, (U)Int(128|256), Decimal(128|256). Allow integer conversions during input/output. [#48257](https://github.com/ClickHouse/ClickHouse/pull/48257) ([Kruglov Pavel](https://github.com/Avogar)).
- Don't throw CURRENT_WRITE_BUFFER_IS_EXHAUSTED for normal behaviour. [#48288](https://github.com/ClickHouse/ClickHouse/pull/48288) ([Raúl Marín](https://github.com/Algunenano)).
- Add new setting `keeper_map_strict_mode` which enforces extra guarantees on operations made on top of `KeeperMap` tables. [#48293](https://github.com/ClickHouse/ClickHouse/pull/48293) ([Antonio Andelic](https://github.com/antonio2368)).
- Check primary key type for simple dictionary is native unsigned integer type Add setting `check_dictionary_primary_key ` for compatibility(set `check_dictionary_primary_key =false` to disable checking). [#48335](https://github.com/ClickHouse/ClickHouse/pull/48335) ([lizhuoyu5](https://github.com/lzydmxy)).
- Don't replicate mutations for `KeeperMap` because it's unnecessary. [#48354](https://github.com/ClickHouse/ClickHouse/pull/48354) ([Antonio Andelic](https://github.com/antonio2368)).
- Allow to write/read unnamed tuple as nested Message in Protobuf format. Tuple elements and Message fields are matched by position. [#48390](https://github.com/ClickHouse/ClickHouse/pull/48390) ([Kruglov Pavel](https://github.com/Avogar)).
- Support `additional_table_filters` and `additional_result_filter` settings in the new planner. Also, add a documentation entry for `additional_result_filter`. [#48405](https://github.com/ClickHouse/ClickHouse/pull/48405) ([Dmitry Novik](https://github.com/novikd)).
- `parseDateTime` now understands format string '%f' (fractional seconds). [#48420](https://github.com/ClickHouse/ClickHouse/pull/48420) ([Robert Schulze](https://github.com/rschu1ze)).
- Format string "%f" in formatDateTime() now prints "000000" if the formatted value has no fractional seconds, the previous behavior (single zero) can be restored using setting "formatdatetime_f_prints_single_zero = 1". [#48422](https://github.com/ClickHouse/ClickHouse/pull/48422) ([Robert Schulze](https://github.com/rschu1ze)).
- Don't replicate DELETE and TRUNCATE for KeeperMap. [#48434](https://github.com/ClickHouse/ClickHouse/pull/48434) ([Antonio Andelic](https://github.com/antonio2368)).
- Generate valid Decimals and Bools in generateRandom function. [#48436](https://github.com/ClickHouse/ClickHouse/pull/48436) ([Kruglov Pavel](https://github.com/Avogar)).
- Allow trailing commas in expression list of SELECT query, for example `SELECT a, b, c, FROM table`. Closes [#37802](https://github.com/ClickHouse/ClickHouse/issues/37802). [#48438](https://github.com/ClickHouse/ClickHouse/pull/48438) ([Nikolay Degterinsky](https://github.com/evillique)).
- Override `CLICKHOUSE_USER` and `CLICKHOUSE_PASSWORD` environment variables with `--user` and `--password` client parameters. Closes [#38909](https://github.com/ClickHouse/ClickHouse/issues/38909). [#48440](https://github.com/ClickHouse/ClickHouse/pull/48440) ([Nikolay Degterinsky](https://github.com/evillique)).
- Added retries to loading of data parts in `MergeTree` tables in case of retryable errors. [#48442](https://github.com/ClickHouse/ClickHouse/pull/48442) ([Anton Popov](https://github.com/CurtizJ)).
- Add support for `Date`, `Date32`, `DateTime`, `DateTime64` data types to `arrayMin`, `arrayMax`, `arrayDifference` functions. Closes [#21645](https://github.com/ClickHouse/ClickHouse/issues/21645). [#48445](https://github.com/ClickHouse/ClickHouse/pull/48445) ([Nikolay Degterinsky](https://github.com/evillique)).
- Add support for `{server_uuid}` macro. It is useful for identifying replicas in autoscaled clusters when new replicas are constantly added and removed in runtime. This closes [#48554](https://github.com/ClickHouse/ClickHouse/issues/48554). [#48563](https://github.com/ClickHouse/ClickHouse/pull/48563) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- The installation script will create a hard link instead of copying if it is possible. [#48578](https://github.com/ClickHouse/ClickHouse/pull/48578) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Support `SHOW TABLE` syntax meaning the same as `SHOW CREATE TABLE`. Closes [#48580](https://github.com/ClickHouse/ClickHouse/issues/48580). [#48591](https://github.com/ClickHouse/ClickHouse/pull/48591) ([flynn](https://github.com/ucasfl)).
- HTTP temporary buffers now support working by evicting data from the virtual filesystem cache. [#48664](https://github.com/ClickHouse/ClickHouse/pull/48664) ([Vladimir C](https://github.com/vdimir)).
- Make Schema inference works for `CREATE AS SELECT`. Closes [#47599](https://github.com/ClickHouse/ClickHouse/issues/47599). [#48679](https://github.com/ClickHouse/ClickHouse/pull/48679) ([flynn](https://github.com/ucasfl)).
- Added a `replicated_max_mutations_in_one_entry` setting for `ReplicatedMergeTree` that allows limiting the number of mutation commands per one `MUTATE_PART` entry (default is 10000). [#48731](https://github.com/ClickHouse/ClickHouse/pull/48731) ([Alexander Tokmakov](https://github.com/tavplubix)).
- In AggregateFunction types, don't count unused arena bytes as `read_bytes`. [#48745](https://github.com/ClickHouse/ClickHouse/pull/48745) ([Raúl Marín](https://github.com/Algunenano)).
- Fix some MySQL-related settings not being handled with the MySQL dictionary source + named collection. Closes [#48402](https://github.com/ClickHouse/ClickHouse/issues/48402). [#48759](https://github.com/ClickHouse/ClickHouse/pull/48759) ([Kseniia Sumarokova](https://github.com/kssenii)).
- If a user set `max_single_part_upload_size` to a very large value, it can lead to a crash due to a bug in the AWS S3 SDK. This fixes [#47679](https://github.com/ClickHouse/ClickHouse/issues/47679). [#48816](https://github.com/ClickHouse/ClickHouse/pull/48816) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Fix data race in `RabbitMQ` ([report](https://pastila.nl/?004f7100/de1505289ab5bb355e67ebe6c7cc8707)), refactor the code. [#48845](https://github.com/ClickHouse/ClickHouse/pull/48845) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Add aliases `name` and `part_name` form `system.parts` and `system.part_log`. Closes [#48718](https://github.com/ClickHouse/ClickHouse/issues/48718). [#48850](https://github.com/ClickHouse/ClickHouse/pull/48850) ([sichenzhao](https://github.com/sichenzhao)).
- Functions "arrayDifferenceSupport()", "arrayCumSum()" and "arrayCumSumNonNegative()" now support input arrays of wide integer types (U)Int128/256. [#48866](https://github.com/ClickHouse/ClickHouse/pull/48866) ([cluster](https://github.com/infdahai)).
- Multi-line history in clickhouse-client is now no longer padded. This makes pasting more natural. [#48870](https://github.com/ClickHouse/ClickHouse/pull/48870) ([Joanna Hulboj](https://github.com/jh0x)).
- Implement a slight improvement for the rare case when ClickHouse is run inside LXC and LXCFS is used. The LXCFS has an issue: sometimes it returns an error "Transport endpoint is not connected" on reading from the file inside `/proc`. This error was correctly logged into ClickHouse's server log. We have additionally workaround this issue by reopening a file. This is a minuscule change. [#48922](https://github.com/ClickHouse/ClickHouse/pull/48922) ([Real](https://github.com/RunningXie)).
- Improve memory accounting for prefetches. Randomise prefetch settings In CI. [#48973](https://github.com/ClickHouse/ClickHouse/pull/48973) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Correctly set headers for native copy operations on GCS. [#48981](https://github.com/ClickHouse/ClickHouse/pull/48981) ([Antonio Andelic](https://github.com/antonio2368)).
- Add support for specifying setting names in the command line with dashes instead of underscores, for example, `--max-threads` instead of `--max_threads`. Additionally, support Unicode dash characters like `—` instead of `--` - this is useful when you communicate with a team in another company, and a manager from that team copy-pasted code from MS Word. [#48985](https://github.com/ClickHouse/ClickHouse/pull/48985) ([alekseygolub](https://github.com/alekseygolub)).
- Add fallback to password authentication when authentication with SSL user certificate has failed. Closes [#48974](https://github.com/ClickHouse/ClickHouse/issues/48974). [#48989](https://github.com/ClickHouse/ClickHouse/pull/48989) ([Nikolay Degterinsky](https://github.com/evillique)).
- Improve the embedded dashboard. Close [#46671](https://github.com/ClickHouse/ClickHouse/issues/46671). [#49036](https://github.com/ClickHouse/ClickHouse/pull/49036) ([Kevin Zhang](https://github.com/Kinzeng)).
- Add profile events for log messages, so you can easily see the count of log messages by severity. [#49042](https://github.com/ClickHouse/ClickHouse/pull/49042) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- In previous versions, the `LineAsString` format worked inconsistently when the parallel parsing was enabled or not, in presence of DOS or macOS Classic line breaks. This closes [#49039](https://github.com/ClickHouse/ClickHouse/issues/49039). [#49052](https://github.com/ClickHouse/ClickHouse/pull/49052) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- The exception message about the unparsed query parameter will also tell about the name of the parameter. Reimplement [#48878](https://github.com/ClickHouse/ClickHouse/issues/48878). Close [#48772](https://github.com/ClickHouse/ClickHouse/issues/48772). [#49061](https://github.com/ClickHouse/ClickHouse/pull/49061) ([Alexey Milovidov](https://github.com/alexey-milovidov)).

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-8}

- タイムゾーンを更新しました。以下のタイムゾーンが更新されました: Africa/Cairo, Africa/Casablanca, Africa/El_Aaiun, America/Bogota, America/Cambridge_Bay, America/Ciudad_Juarez, America/Godthab, America/Inuvik, America/Iqaluit, America/Nuuk, America/Ojinaga, America/Pangnirtung, America/Rankin_Inlet, America/Resolute, America/Whitehorse, America/Yellowknife, Asia/Gaza, Asia/Hebron, Asia/Kuala_Lumpur, Asia/Singapore, Canada/Yukon, Egypt, Europe/Kirov, Europe/Volgograd, Singapore。[#48572](https://github.com/ClickHouse/ClickHouse/pull/48572) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ビルドを高速化するため、ヘッダーファイルの依存関係数を削減しました。[#47984](https://github.com/ClickHouse/ClickHouse/pull/47984) ([Dmitry Novik](https://github.com/novikd))。
- テストにおいてマークとインデックスの圧縮をランダム化しました。[#48286](https://github.com/ClickHouse/ClickHouse/pull/48286) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 内部ZSTDを1.5.4から1.5.5にバージョンアップしました。[#46797](https://github.com/ClickHouse/ClickHouse/pull/46797) ([Robert Schulze](https://github.com/rschu1ze))。
- テストにおいてコンパクトパートからワイドパートへの垂直マージをランダム化しました。[#48287](https://github.com/ClickHouse/ClickHouse/pull/48287) ([Raúl Marín](https://github.com/Algunenano))。
- HDFSにおけるCRC32チェックサムのサポートを追加しました。パフォーマンスの問題を修正しました。[#48614](https://github.com/ClickHouse/ClickHouse/pull/48614) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- GCCサポートの残存部分を削除しました。[#48671](https://github.com/ClickHouse/ClickHouse/pull/48671) ([Robert Schulze](https://github.com/rschu1ze))。
- 新しいアナライザーインフラストラクチャを有効にしたCI実行を追加しました。[#48719](https://github.com/ClickHouse/ClickHouse/pull/48719) ([Dmitry Novik](https://github.com/novikd))。

#### バグ修正(公式安定版リリースにおけるユーザーに影響する不具合) {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-8}


* バックグラウンドスレッドから実行されるマテリアライズドビュー向けに system.query&#95;views&#95;log を修正 [#46668](https://github.com/ClickHouse/ClickHouse/pull/46668) ([Azat Khuzhin](https://github.com/azat)).
* 複数の `RENAME COLUMN` バグを修正 [#46946](https://github.com/ClickHouse/ClickHouse/pull/46946) ([alesapin](https://github.com/alesapin))。
* clickhouse-format における軽微なハイライト表示の問題を修正 [#47610](https://github.com/ClickHouse/ClickHouse/pull/47610)（[Natasha Murashkina](https://github.com/murfel)）。
* LLVM の libc++ のバグを修正し、サイズが INT&#95;MAX を超えるパーツを S3 にアップロードする際にクラッシュしていた問題を解消しました [#47693](https://github.com/ClickHouse/ClickHouse/pull/47693) ([Azat Khuzhin](https://github.com/azat))。
* `sparkbar` 関数で発生していたオーバーフローを修正しました [#48121](https://github.com/ClickHouse/ClickHouse/pull/48121) ([Vladimir C](https://github.com/vdimir))。
* S3 のレースコンディションを修正 [#48190](https://github.com/ClickHouse/ClickHouse/pull/48190) ([Anton Popov](https://github.com/CurtizJ))。
* 挙動が一貫しないため、集約関数に対する JIT を無効化しました [#48195](https://github.com/ClickHouse/ClickHouse/pull/48195)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `ALTER` の書式を軽微に修正 [#48289](https://github.com/ClickHouse/ClickHouse/pull/48289) ([Natasha Murashkina](https://github.com/murfel)).
* RabbitMQ の CPU 使用率を修正（23.2 で [#44404](https://github.com/ClickHouse/ClickHouse/issues/44404) により悪化していた問題）[#48311](https://github.com/ClickHouse/ClickHouse/pull/48311)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* Distributed 上の Merge に対する EXPLAIN PIPELINE でのクラッシュを修正 [#48320](https://github.com/ClickHouse/ClickHouse/pull/48320) ([Azat Khuzhin](https://github.com/azat))。
* LowCardinality を Arrow のディクショナリとしてシリアライズする処理を修正 [#48361](https://github.com/ClickHouse/ClickHouse/pull/48361) ([Kruglov Pavel](https://github.com/Avogar))。
* TemporaryFileStream のキャッシュファイルセグメント用ダウンローダーをリセットする [#48386](https://github.com/ClickHouse/ClickHouse/pull/48386)（[Vladimir C](https://github.com/vdimir)）。
* DROP/REPLACE PARTITION の場合に発生しうる SYSTEM SYNC REPLICA のハングの可能性を修正。 [#48391](https://github.com/ClickHouse/ClickHouse/pull/48391) ([Azat Khuzhin](https://github.com/azat)).
* ディクショナリに依存する分散テーブルの読み込み時に発生する起動エラーを修正 [#48419](https://github.com/ClickHouse/ClickHouse/pull/48419) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。
* システムテーブルを自動リネームする際に依存関係をチェックしないように変更 [#48431](https://github.com/ClickHouse/ClickHouse/pull/48431) ([Raúl Marín](https://github.com/Algunenano)).
* KeeperMap ストレージで影響を受けた行のみを更新 [#48435](https://github.com/ClickHouse/ClickHouse/pull/48435) ([Antonio Andelic](https://github.com/antonio2368)).
* VFS キャッシュで発生し得るセグメンテーションフォールトを修正 [#48469](https://github.com/ClickHouse/ClickHouse/pull/48469) ([Kseniia Sumarokova](https://github.com/kssenii))。
* `toTimeZone` 関数は、定数文字列が指定されていない場合にエラーをスローするようになりました [#48471](https://github.com/ClickHouse/ClickHouse/pull/48471) ([Jordi Villar](https://github.com/jrdi))。
* Protobuf における IPv4 の論理エラーを修正し、Date32 をサポート [#48486](https://github.com/ClickHouse/ClickHouse/pull/48486) ([Kruglov Pavel](https://github.com/Avogar))。
* system.settings における &quot;changed&quot; フラグが、複数の値を持つ設定に対して誤って計算されていた問題を修正。 [#48516](https://github.com/ClickHouse/ClickHouse/pull/48516) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* 圧縮を有効にした場合のストレージ `Memory` を修正 [#48517](https://github.com/ClickHouse/ClickHouse/pull/48517)（[Anton Popov](https://github.com/CurtizJ)）。
* クライアントの再接続時にブラケットペーストモードが原因でパスワード入力が乱れる問題を修正 [#48528](https://github.com/ClickHouse/ClickHouse/pull/48528) ([Michael Kolupaev](https://github.com/al13n321)).
* IP および UUID 型キーに対するネストした Map を修正 [#48556](https://github.com/ClickHouse/ClickHouse/pull/48556)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* ハッシュ辞書の並列ローダー使用時に発生する未処理例外を修正 [#48571](https://github.com/ClickHouse/ClickHouse/pull/48571) ([Azat Khuzhin](https://github.com/azat))。
* `groupArray` 集約関数が、NULL 許容型に対する空の結果についても正しく動作するようになりました [#48593](https://github.com/ClickHouse/ClickHouse/pull/48593) ([lgbo](https://github.com/lgbo-ustc))。
* ACL でスキーム `auth` を使用してもノードが作成されないことがある Keeper のバグを修正しました。 [#48595](https://github.com/ClickHouse/ClickHouse/pull/48595) ([Aleksei Filatov](https://github.com/aalexfvk)).
* IPv4 と UInt の比較演算子を許可 [#48611](https://github.com/ClickHouse/ClickHouse/pull/48611)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* キャッシュで発生する可能性のあるエラーを修正 [#48636](https://github.com/ClickHouse/ClickHouse/pull/48636)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 空のデータに対する非同期挿入で、例外がスローされないようになりました。 [#48663](https://github.com/ClickHouse/ClickHouse/pull/48663) ([Anton Popov](https://github.com/CurtizJ)).
* `RENAME TABLE` の失敗時にテーブルの依存関係を修正 [#48683](https://github.com/ClickHouse/ClickHouse/pull/48683)（[Azat Khuzhin](https://github.com/azat)）。
* 主キーに重複するカラムが含まれている場合（これはプロジェクションでのみ発生し得ます）、以前のバージョンではバグを引き起こす可能性がありました [#48838](https://github.com/ClickHouse/ClickHouse/pull/48838)（[Amos Bird](https://github.com/amosbird)）。
* ZooKeeper における send&#95;thread/receive&#95;thread 結合時のレースコンディションの修正 [#48849](https://github.com/ClickHouse/ClickHouse/pull/48849) ([Alexander Gololobov](https://github.com/davenger)).
* ゼロコピーレプリケーションで無視されている切り離し済みパーツを `DROP` しようとした際に発生する、予期しないパーツ名エラーを修正 [#48862](https://github.com/ClickHouse/ClickHouse/pull/48862) ([Michael Lex](https://github.com/mlex))。
* `Date32` の Parquet/Arrow カラムが `Date32` カラムとして読み込まれない問題を修正 [#48864](https://github.com/ClickHouse/ClickHouse/pull/48864) ([Kruglov Pavel](https://github.com/Avogar))。
* 行ポリシーが設定されたテーブルで、ドットを含むカラムに対して `SELECT` した際に発生する `UNKNOWN_IDENTIFIER` エラーを修正 [#48976](https://github.com/ClickHouse/ClickHouse/pull/48976) ([Kruglov Pavel](https://github.com/Avogar))。
* 空の Nullable 文字列に対する集約処理を修正 [#48999](https://github.com/ClickHouse/ClickHouse/pull/48999) ([LiuNeng](https://github.com/liuneng1994)).

### <a id="233"></a> ClickHouse リリース 23.3 LTS, 2023-03-30 {#233}

#### アップグレード時の注意事項 {#upgrade-notes-1}

- 軽量DELETEが本番環境対応となり、デフォルトで有効化されました。MergeTreeテーブルに対する`DELETE`クエリがデフォルトで利用可能になりました。
- `*domain*RFC`および`netloc`関数の動作がわずかに変更されました:より適切な準拠のため、URL authorityで許可される記号のセットが緩和されました。[#46841](https://github.com/ClickHouse/ClickHouse/pull/46841) ([Azat Khuzhin](https://github.com/azat))。
- KafkaEngineベースのテーブルを、カラムに対してDEFAULT/EPHEMERAL/ALIAS/MATERIALIZED文を使用して作成することを禁止しました。[#47138](https://github.com/ClickHouse/ClickHouse/pull/47138) ([Aleksandr Musorin](https://github.com/AVMusorin))。
- 「非同期接続ドレイン」機能が削除されました。関連する設定とメトリクスも削除されました。これは内部機能であったため、この機能について知らなかったユーザーには影響しないはずです。[#47486](https://github.com/ClickHouse/ClickHouse/pull/47486) ([Alexander Tokmakov](https://github.com/tavplubix))。
- `arraySum`/`Min`/`Max`/`Avg`/`Product`、`arrayCumSum`/`CumSumNonNegative`、`arrayDifference`、配列構築、IN演算子、クエリパラメータ、`groupArrayMovingSum`、統計関数、`min`/`max`/`any`/`argMin`/`argMax`、PostgreSQLワイヤプロトコル、MySQLテーブルエンジンおよび関数、`sumMap`、`mapAdd`、`mapSubtract`、`arrayIntersect`において、256ビットDecimalデータ型(38桁以上)をサポートしました。`arrayIntersect`に大きな整数のサポートを追加しました。モーメントを含む統計集約関数(`corr`や各種`TTest`など)は、内部表現として`Float64`を使用するようになります(この変更前は`Decimal128`を使用していましたが、意味がありませんでした)。これらの関数は、無限分散の場合に`inf`の代わりに`nan`を返すことができます。一部の関数は`Decimal256`データ型で許可されていましたが、以前のバージョンでは`Decimal128`を返していました - これが修正されました。これにより[#47569](https://github.com/ClickHouse/ClickHouse/issues/47569)が解決されます。これにより[#44864](https://github.com/ClickHouse/ClickHouse/issues/44864)が解決されます。これにより[#28335](https://github.com/ClickHouse/ClickHouse/issues/28335)が解決されます。[#47594](https://github.com/ClickHouse/ClickHouse/pull/47594) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- backup_threads/restore_threadsをサーバー設定にしました(ユーザー設定ではなく)。[#47881](https://github.com/ClickHouse/ClickHouse/pull/47881) ([Azat Khuzhin](https://github.com/azat))。
- 定数および非決定的なセカンダリインデックスを許可しないようにしました [#46839](https://github.com/ClickHouse/ClickHouse/pull/46839) ([Anton Popov](https://github.com/CurtizJ))。


#### 新機能 {#new-feature-9}

- 設定 `parallel_replicas_custom_key` と `parallel_replicas_custom_key_filter_type` を使用してレプリカ間で作業を分割する新しいモードを追加しました。クラスタが複数のレプリカを持つ単一のシャードで構成されている場合、最大 `max_parallel_replicas` 個がランダムに選択されてシャードに変換されます。各シャードに対して、シャードに送信される前にイニシエータ上のクエリに対応するフィルタが追加されます。クラスタが複数のシャードで構成されている場合、`sample_key` と同じ動作をしますが、任意のキーを定義することができます。[#45108](https://github.com/ClickHouse/ClickHouse/pull/45108) ([Antonio Andelic](https://github.com/antonio2368))。
- キャンセル時に部分結果を表示するオプション: キャンセルされたクエリ(例: Ctrl-Cによる)が部分結果を返すことを可能にするクエリ設定 `partial_result_on_first_cancel` を追加しました。[#45689](https://github.com/ClickHouse/ClickHouse/pull/45689) ([Alexey Perevyshin](https://github.com/alexX512))。
- 一時テーブルに対する任意のテーブルエンジンのサポートを追加しました(ReplicatedおよびKeeperMapエンジンを除く)。Close [#31497](https://github.com/ClickHouse/ClickHouse/issues/31497)。[#46071](https://github.com/ClickHouse/ClickHouse/pull/46071) ([Roman Vasin](https://github.com/rvasin))。
- Keeper内の集中ストレージを使用したユーザー定義SQL関数のレプリケーションのサポートを追加しました。[#46085](https://github.com/ClickHouse/ClickHouse/pull/46085) ([Aleksei Filatov](https://github.com/aalexfvk))。
- サーバー設定を含む `system.server_settings`(`system.settings` と同様)を実装しました。[#46550](https://github.com/ClickHouse/ClickHouse/pull/46550) ([pufit](https://github.com/pufit))。
- `UNDROP TABLE` クエリのサポート。Closes [#46811](https://github.com/ClickHouse/ClickHouse/issues/46811)。[#47241](https://github.com/ClickHouse/ClickHouse/pull/47241) ([chen](https://github.com/xiedeyantu))。
- 名前付きコレクションに対する個別の権限付与を許可します(例: すべてのコレクションに一度にアクセスを与えるのではなく、特定のコレクションにのみ `SHOW/CREATE/ALTER/DROP named collection` アクセスを与えることができます)。Closes [#40894](https://github.com/ClickHouse/ClickHouse/issues/40894)。新しいアクセスタイプ `NAMED_COLLECTION_CONTROL` を追加しました。これはユーザー設定に明示的に追加されない限り、デフォルトユーザーには付与されません(`GRANT ALL` を実行できるようにするために必要です)。また、23.2のように、デフォルトユーザーが完全なアクセス権を持つために `show_named_collections` を手動で指定する必要はなくなりました。[#46241](https://github.com/ClickHouse/ClickHouse/pull/46241) ([Kseniia Sumarokova](https://github.com/kssenii))。
- ネストされたカスタムディスクを許可します。以前は、カスタムディスクはフラットなディスク構造のみをサポートしていました。[#47106](https://github.com/ClickHouse/ClickHouse/pull/47106) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 関数 `widthBucket`(互換性のための `WIDTH_BUCKET` エイリアス付き)を導入しました。[#42974](https://github.com/ClickHouse/ClickHouse/issues/42974)。[#46790](https://github.com/ClickHouse/ClickHouse/pull/46790) ([avoiderboi](https://github.com/avoiderboi))。
- 指定されたフォーマット文字列に従って新しい関数 `parseDateTime`/`parseDateTimeInJodaSyntax` を追加しました。parseDateTime は MySQL 構文で String を DateTime に解析し、parseDateTimeInJodaSyntax は Joda 構文で解析します。[#46815](https://github.com/ClickHouse/ClickHouse/pull/46815) ([李扬](https://github.com/taiyang-li))。
- テーブル関数 `null` のデフォルト構造に `dummy UInt8` を使用します。Closes [#46930](https://github.com/ClickHouse/ClickHouse/issues/46930)。[#47006](https://github.com/ClickHouse/ClickHouse/pull/47006) ([flynn](https://github.com/ucasfl))。
- `parseDateTimeBestEffort` 関数で `Dec 15, 2021` のようなカンマ付き日付フォーマットのサポート。Closes [#46816](https://github.com/ClickHouse/ClickHouse/issues/46816)。[#47071](https://github.com/ClickHouse/ClickHouse/pull/47071) ([chen](https://github.com/xiedeyantu))。
- HTTPインターフェースのURLパラメータ `wait_end_of_query` と `buffer_size` に対応する設定 `http_wait_end_of_query` と `http_response_buffer_size` を追加しました。これにより、プロファイル内でこれらの設定を変更できます。[#47108](https://github.com/ClickHouse/ClickHouse/pull/47108) ([Vladimir C](https://github.com/vdimir))。
- `Atomic` データベースから削除されたがまだ完全に削除されていないテーブルを表示する `system.dropped_tables` テーブルを追加しました。[#47364](https://github.com/ClickHouse/ClickHouse/pull/47364) ([chen](https://github.com/xiedeyantu))。
- MySQL互換性のために `positionCaseInsensitive` のエイリアスとして `INSTR` を追加しました。Closes [#47529](https://github.com/ClickHouse/ClickHouse/issues/47529)。[#47535](https://github.com/ClickHouse/ClickHouse/pull/47535) ([flynn](https://github.com/ucasfl))。
- 固定精度で数値を文字列に変換できる `toDecimalString` 関数を追加しました。[#47838](https://github.com/ClickHouse/ClickHouse/pull/47838) ([Andrey Zvonov](https://github.com/zvonand))。
- マージツリー設定 `max_number_of_mutations_for_replica` を追加しました。これは、レプリカごとのパートミューテーション数を指定された量に制限します。ゼロは、レプリカごとのミューテーション数に制限がないことを意味します(実行は他の設定によって制約される可能性があります)。[#48047](https://github.com/ClickHouse/ClickHouse/pull/48047) ([Vladimir C](https://github.com/vdimir))。
- 配列のペアからマップを作成できるMap関連関数 `mapFromArrays` を追加しました。[#31125](https://github.com/ClickHouse/ClickHouse/pull/31125) ([李扬](https://github.com/taiyang-li))。
- Parquet/ORC/Arrow出力フォーマットでの圧縮制御を許可し、より多くの圧縮入力フォーマットのサポートを追加しました。This closes [#13541](https://github.com/ClickHouse/ClickHouse/issues/13541)。[#47114](https://github.com/ClickHouse/ClickHouse/pull/47114) ([Kruglov Pavel](https://github.com/Avogar))。
- ネイティブプロトコルにSSLユーザー証明書認証を追加しました。Closes [#47077](https://github.com/ClickHouse/ClickHouse/issues/47077)。[#47596](https://github.com/ClickHouse/ClickHouse/pull/47596) ([Nikolay Degterinsky](https://github.com/evillique))。
- `parseDateTime` に *OrNull() および *OrZero() バリアントを追加し、MySQL互換性のためにエイリアス `str_to_date` を追加しました。[#48000](https://github.com/ClickHouse/ClickHouse/pull/48000) ([Robert Schulze](https://github.com/rschu1ze))。
- MySQLとのより良い互換性のために演算子 `REGEXP`(演算子 "LIKE"、"IN"、"MOD" などと同様)を追加しました [#47869](https://github.com/ClickHouse/ClickHouse/pull/47869) ([Robert Schulze](https://github.com/rschu1ze))。





#### パフォーマンス改善 {#performance-improvement-9}

- メモリ内のマークが圧縮されるようになり、メモリ使用量が3～6分の1に削減されました。[#47290](https://github.com/ClickHouse/ClickHouse/pull/47290) ([Michael Kolupaev](https://github.com/al13n321))。
- 以前のバージョンでは、大量のファイルのバックアップは信じられないほど遅いものでした。もうそんなことはありません。今では信じられないほど高速です。[#47251](https://github.com/ClickHouse/ClickHouse/pull/47251) ([Alexey Milovidov](https://github.com/alexey-milovidov))。バックアップのIO操作用に専用のスレッドプールを導入しました。これにより、他のプールとは独立してスケーリングでき、パフォーマンスが向上します。[#47174](https://github.com/ClickHouse/ClickHouse/pull/47174) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。バックアップ処理の最終段階でメタデータを収集する際に、MultiReadリクエストとリトライを使用するようにしました。[#47243](https://github.com/ClickHouse/ClickHouse/pull/47243) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。バックアップと復元データの両方がS3にある場合、今後はサーバーサイドコピーが使用されます。[#47546](https://github.com/ClickHouse/ClickHouse/pull/47546) ([Vitaly Baranov](https://github.com/vitlibar))。
- `FINAL`を使用したクエリでの過剰な読み取りを修正しました。[#47801](https://github.com/ClickHouse/ClickHouse/pull/47801) ([Nikita Taranov](https://github.com/nickitat))。
- 設定`max_final_threads`は、サーバー起動時にコア数に設定されるようになります（`max_threads`と同じアルゴリズムを使用）。これにより、CPU数が多いサーバーでの`final`実行の並行性が向上します。[#47915](https://github.com/ClickHouse/ClickHouse/pull/47915) ([Nikita Taranov](https://github.com/nickitat))。
- CLICKHOUSEソースを持つDIRECTディクショナリの読み取りパイプラインを複数スレッドで実行できるようになりました。有効にするには、`CREATE DICTIONARY`文のソースの`SETTINGS`セクションで`dictionary_use_async_executor=1`を設定してください。[#47986](https://github.com/ClickHouse/ClickHouse/pull/47986) ([Vladimir C](https://github.com/vdimir))。
- nullableキーを1つ持つ集約のパフォーマンスを最適化しました。[#45772](https://github.com/ClickHouse/ClickHouse/pull/45772) ([LiuNeng](https://github.com/liuneng1994))。
- `hasTokenOrNull`、`hasTokenCaseInsensitive`、`hasTokenCaseInsensitiveOrNull`に対して、小文字の`tokenbf_v1`インデックスの活用を実装しました。[#46252](https://github.com/ClickHouse/ClickHouse/pull/46252) ([ltrk2](https://github.com/ltrk2))。
- SIMDを使用して最初の2文字を検索することで、関数`position`と`LIKE`を最適化しました。[#46289](https://github.com/ClickHouse/ClickHouse/pull/46289) ([Jiebin Sun](https://github.com/jiebinn))。
- 大幅に大きくなる可能性がある`system.detached_parts`からのクエリを最適化しました。ブロックサイズ制限に関して複数のソースを追加し、各ブロックでIOスレッドプールを使用してパートサイズを計算する、つまりシステムコールを並列実行するようにしました。[#46624](https://github.com/ClickHouse/ClickHouse/pull/46624) ([Sema Checherinda](https://github.com/CheSema))。
- ReplicatedMergeTreeテーブルの`max_replicated_merges_in_queue`のデフォルト値を16から1000に増やしました。これにより、ClickHouse Cloudの共有ストレージを持つクラスタなど、非常に多数のレプリカを持つクラスタでのバックグラウンドマージ操作が高速化されます。[#47050](https://github.com/ClickHouse/ClickHouse/pull/47050) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `clickhouse-copier`を更新し、パーティションのリストを取得する際に`DISTINCT`の代わりに`GROUP BY`を使用するようにしました。大きなテーブルでは、これによりselect時間が500秒以上から1秒未満に短縮されました。[#47386](https://github.com/ClickHouse/ClickHouse/pull/47386) ([Clayton McClure](https://github.com/cmcclure-twilio))。
- `ASOF JOIN`のパフォーマンス低下を修正しました。[#47544](https://github.com/ClickHouse/ClickHouse/pull/47544) ([Ongkong](https://github.com/ongkong))。
- Keeperでさらにバッチ処理を強化しました。読み取りリクエストでバッチを分割しないようにすることで、パフォーマンスを向上させました。[#47978](https://github.com/ClickHouse/ClickHouse/pull/47978) ([Antonio Andelic](https://github.com/antonio2368))。
- カラムに異なるDEFAULT式を持つMergeに対してPREWHEREを許可するようにしました。[#46831](https://github.com/ClickHouse/ClickHouse/pull/46831) ([Azat Khuzhin](https://github.com/azat))。

#### 実験的機能 {#experimental-feature-6}

- 並列レプリカ: ローカルレプリカをより効果的に活用することで全体的なパフォーマンスを向上させ、デフォルトで非レプリケートMergeTreeからの並列レプリカによる読み取りを禁止しました。[#47858](https://github.com/ClickHouse/ClickHouse/pull/47858) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- 実験的なAnalyzerが有効な場合、`Join`、`Dictionary`、`EmbeddedRocksDB`テーブルとのJOINにおいて、左テーブルへのフィルタプッシュダウンをサポートしました。[#47280](https://github.com/ClickHouse/ClickHouse/pull/47280) ([Maksim Kita](https://github.com/kitaisreal))。
- ゼロコピーレプリケーションを使用するReplicatedMergeTreeのKeeperへの負荷が軽減されました。[#47676](https://github.com/ClickHouse/ClickHouse/pull/47676) ([alesapin](https://github.com/alesapin))。
- MaterializedPostgreSQLでのマテリアライズドビュー作成を修正しました。[#40807](https://github.com/ClickHouse/ClickHouse/pull/40807) ([Maksim Buren](https://github.com/maks-buren630501))。


#### 改善 {#improvement-9}

- Enable `input_format_json_ignore_unknown_keys_in_named_tuple` by default. [#46742](https://github.com/ClickHouse/ClickHouse/pull/46742) ([Kruglov Pavel](https://github.com/Avogar)).
- Allow errors to be ignored while pushing to MATERIALIZED VIEW (add new setting `materialized_views_ignore_errors`, by default to `false`, but it is set to `true` for flushing logs to `system.*_log` tables unconditionally). [#46658](https://github.com/ClickHouse/ClickHouse/pull/46658) ([Azat Khuzhin](https://github.com/azat)).
- Track the file queue of distributed sends in memory. [#45491](https://github.com/ClickHouse/ClickHouse/pull/45491) ([Azat Khuzhin](https://github.com/azat)).
- Now `X-ClickHouse-Query-Id` and `X-ClickHouse-Timezone` headers are added to responses in all queries via HTTP protocol. Previously it was done only for `SELECT` queries. [#46364](https://github.com/ClickHouse/ClickHouse/pull/46364) ([Anton Popov](https://github.com/CurtizJ)).
- External tables from `MongoDB`: support for connection to a replica set via a URI with a host:port enum and support for the readPreference option in MongoDB dictionaries. Example URI: mongodb://db0.example.com:27017,db1.example.com:27017,db2.example.com:27017/?replicaSet=myRepl&readPreference=primary. [#46524](https://github.com/ClickHouse/ClickHouse/pull/46524) ([artem-yadr](https://github.com/artem-yadr)).
- This improvement should be invisible for users. Re-implement projection analysis on top of query plan. Added setting `query_plan_optimize_projection=1` to switch between old and new version. Fixes [#44963](https://github.com/ClickHouse/ClickHouse/issues/44963). [#46537](https://github.com/ClickHouse/ClickHouse/pull/46537) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
- Use Parquet format v2 instead of v1 in output format by default. Add setting `output_format_parquet_version` to control parquet version, possible values `1.0`, `2.4`, `2.6`, `2.latest` (default). [#46617](https://github.com/ClickHouse/ClickHouse/pull/46617) ([Kruglov Pavel](https://github.com/Avogar)).
- It is now possible to use the new configuration syntax to configure Kafka topics with periods (`.`) in their name. [#46752](https://github.com/ClickHouse/ClickHouse/pull/46752) ([Robert Schulze](https://github.com/rschu1ze)).
- Fix heuristics that check hyperscan patterns for problematic repeats. [#46819](https://github.com/ClickHouse/ClickHouse/pull/46819) ([Robert Schulze](https://github.com/rschu1ze)).
- Don't report ZK node exists to system.errors when a block was created concurrently by a different replica. [#46820](https://github.com/ClickHouse/ClickHouse/pull/46820) ([Raúl Marín](https://github.com/Algunenano)).
- Increase the limit for opened files in `clickhouse-local`. It will be able to read from `web` tables on servers with a huge number of CPU cores. Do not back off reading from the URL table engine in case of too many opened files. This closes [#46852](https://github.com/ClickHouse/ClickHouse/issues/46852). [#46853](https://github.com/ClickHouse/ClickHouse/pull/46853) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Exceptions thrown when numbers cannot be parsed now have an easier-to-read exception message. [#46917](https://github.com/ClickHouse/ClickHouse/pull/46917) ([Robert Schulze](https://github.com/rschu1ze)).
- Added update `system.backups` after every processed task to track the progress of backups. [#46989](https://github.com/ClickHouse/ClickHouse/pull/46989) ([Aleksandr Musorin](https://github.com/AVMusorin)).
- Allow types conversion in Native input format. Add settings `input_format_native_allow_types_conversion` that controls it (enabled by default). [#46990](https://github.com/ClickHouse/ClickHouse/pull/46990) ([Kruglov Pavel](https://github.com/Avogar)).
- Allow IPv4 in the `range` function to generate IP ranges. [#46995](https://github.com/ClickHouse/ClickHouse/pull/46995) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- Improve exception message when it's impossible to move a part from one volume/disk to another. [#47032](https://github.com/ClickHouse/ClickHouse/pull/47032) ([alesapin](https://github.com/alesapin)).
- Support `Bool` type in `JSONType` function. Previously `Null` type was mistakenly returned for bool values. [#47046](https://github.com/ClickHouse/ClickHouse/pull/47046) ([Anton Popov](https://github.com/CurtizJ)).
- Use `_request_body` parameter to configure predefined HTTP queries. [#47086](https://github.com/ClickHouse/ClickHouse/pull/47086) ([Constantine Peresypkin](https://github.com/pkit)).
- Automatic indentation in the built-in UI SQL editor when Enter is pressed. [#47113](https://github.com/ClickHouse/ClickHouse/pull/47113) ([Alexey Korepanov](https://github.com/alexkorep)).
- Self-extraction with 'sudo' will attempt to set uid and gid of extracted files to running user. [#47116](https://github.com/ClickHouse/ClickHouse/pull/47116) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- Previously, the `repeat` function's second argument only accepted an unsigned integer type, which meant it could not accept values such as -1. This behavior differed from that of the Spark function. In this update, the repeat function has been modified to match the behavior of the Spark function. It now accepts the same types of inputs, including negative integers. Extensive testing has been performed to verify the correctness of the updated implementation. [#47134](https://github.com/ClickHouse/ClickHouse/pull/47134) ([KevinyhZou](https://github.com/KevinyhZou)). Note: the changelog entry was rewritten by ChatGPT.
- Remove `::__1` part from stacktraces. Display `std::basic_string<char, ...` as `String` in stacktraces. [#47171](https://github.com/ClickHouse/ClickHouse/pull/47171) ([Mike Kot](https://github.com/myrrc)).
- Reimplement interserver mode to avoid replay attacks (note, that change is backward compatible with older servers). [#47213](https://github.com/ClickHouse/ClickHouse/pull/47213) ([Azat Khuzhin](https://github.com/azat)).
- Improve recognition of regular expression groups and refine the regexp_tree dictionary. [#47218](https://github.com/ClickHouse/ClickHouse/pull/47218) ([Han Fei](https://github.com/hanfei1991)).
- Keeper improvement: Add new 4LW `clrs` to clean resources used by Keeper (e.g. release unused memory). [#47256](https://github.com/ClickHouse/ClickHouse/pull/47256) ([Antonio Andelic](https://github.com/antonio2368)).
- Add optional arguments to codecs `DoubleDelta(bytes_size)`, `Gorilla(bytes_size)`, `FPC(level, float_size)`, this allows using these codecs without column type in `clickhouse-compressor`. Fix possible aborts and arithmetic errors in `clickhouse-compressor` with these codecs. Fixes: https://github.com/ClickHouse/ClickHouse/discussions/47262. [#47271](https://github.com/ClickHouse/ClickHouse/pull/47271) ([Kruglov Pavel](https://github.com/Avogar)).
- Add support for big int types to the `runningDifference` function. Closes [#47194](https://github.com/ClickHouse/ClickHouse/issues/47194). [#47322](https://github.com/ClickHouse/ClickHouse/pull/47322) ([Nikolay Degterinsky](https://github.com/evillique)).
- Add an expiration window for S3 credentials that have an expiration time to avoid `ExpiredToken` errors in some edge cases. It can be controlled with `expiration_window_seconds` config, the default is 120 seconds. [#47423](https://github.com/ClickHouse/ClickHouse/pull/47423) ([Antonio Andelic](https://github.com/antonio2368)).
- Support Decimals and Date32 in `Avro` format. [#47434](https://github.com/ClickHouse/ClickHouse/pull/47434) ([Kruglov Pavel](https://github.com/Avogar)).
- Do not start the server if an interrupted conversion from `Ordinary` to `Atomic` was detected, print a better error message with troubleshooting instructions. [#47487](https://github.com/ClickHouse/ClickHouse/pull/47487) ([Alexander Tokmakov](https://github.com/tavplubix)).
- Add a new column `kind` to the `system.opentelemetry_span_log`. This column holds the value of [SpanKind](https://opentelemetry.io/docs/reference/specification/trace/api/#spankind) defined in OpenTelemtry. [#47499](https://github.com/ClickHouse/ClickHouse/pull/47499) ([Frank Chen](https://github.com/FrankChen021)).
- Allow reading/writing nested arrays in `Protobuf` format with only the root field name as column name. Previously column name should've contained all nested field names (like `a.b.c Array(Array(Array(UInt32)))`, now you can use just `a Array(Array(Array(UInt32)))`. [#47650](https://github.com/ClickHouse/ClickHouse/pull/47650) ([Kruglov Pavel](https://github.com/Avogar)).
- Added an optional `STRICT` modifier for `SYSTEM SYNC REPLICA` which makes the query wait for the replication queue to become empty (just like it worked before https://github.com/ClickHouse/ClickHouse/pull/45648). [#47659](https://github.com/ClickHouse/ClickHouse/pull/47659) ([Alexander Tokmakov](https://github.com/tavplubix)).
- Improve the naming of some OpenTelemetry span logs. [#47667](https://github.com/ClickHouse/ClickHouse/pull/47667) ([Frank Chen](https://github.com/FrankChen021)).
- Prevent using too long chains of aggregate function combinators (they can lead to slow queries in the analysis stage). This closes [#47715](https://github.com/ClickHouse/ClickHouse/issues/47715). [#47716](https://github.com/ClickHouse/ClickHouse/pull/47716) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Support for subquery in parameterized views; resolves [#46741](https://github.com/ClickHouse/ClickHouse/issues/46741) [#47725](https://github.com/ClickHouse/ClickHouse/pull/47725) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
- Fix memory leak in MySQL integration (reproduces with `connection_auto_close=1`). [#47732](https://github.com/ClickHouse/ClickHouse/pull/47732) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Improved error handling in the code related to Decimal parameters, resulting in more informative error messages. Previously, when incorrect Decimal parameters were supplied, the error message generated was unclear or unhelpful. With this update, the error message printed has been fixed to provide more detailed and useful information, making it easier to identify and correct issues related to Decimal parameters. [#47812](https://github.com/ClickHouse/ClickHouse/pull/47812) ([Yu Feng](https://github.com/Vigor-jpg)). Note: this changelog entry is rewritten by ChatGPT.
- The parameter `exact_rows_before_limit` is used to make `rows_before_limit_at_least` is designed to accurately reflect the number of rows returned before the limit is reached. This pull request addresses issues encountered when the query involves distributed processing across multiple shards or sorting operations. Prior to this update, these scenarios were not functioning as intended. [#47874](https://github.com/ClickHouse/ClickHouse/pull/47874) ([Amos Bird](https://github.com/amosbird)).
- ThreadPools metrics introspection. [#47880](https://github.com/ClickHouse/ClickHouse/pull/47880) ([Azat Khuzhin](https://github.com/azat)).
- Add `WriteBufferFromS3Microseconds` and `WriteBufferFromS3RequestsErrors` profile events. [#47885](https://github.com/ClickHouse/ClickHouse/pull/47885) ([Antonio Andelic](https://github.com/antonio2368)).
- Add `--link` and `--noninteractive` (`-y`) options to ClickHouse install. Closes [#47750](https://github.com/ClickHouse/ClickHouse/issues/47750). [#47887](https://github.com/ClickHouse/ClickHouse/pull/47887) ([Nikolay Degterinsky](https://github.com/evillique)).
- Fixed `UNKNOWN_TABLE` exception when attaching to a materialized view that has dependent tables that are not available. This might be useful when trying to restore state from a backup. [#47975](https://github.com/ClickHouse/ClickHouse/pull/47975) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
- Fix case when the (optional) path is not added to an encrypted disk configuration. [#47981](https://github.com/ClickHouse/ClickHouse/pull/47981) ([Kseniia Sumarokova](https://github.com/kssenii)).
- Support for CTE in parameterized views Implementation: Updated to allow query parameters while evaluating scalar subqueries. [#48065](https://github.com/ClickHouse/ClickHouse/pull/48065) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
- Support big integers `(U)Int128/(U)Int256`, `Map` with any key type and `DateTime64` with any precision (not only 3 and 6). [#48119](https://github.com/ClickHouse/ClickHouse/pull/48119) ([Kruglov Pavel](https://github.com/Avogar)).
- Allow skipping errors related to unknown enum values in row input formats. [#48133](https://github.com/ClickHouse/ClickHouse/pull/48133) ([Alexey Milovidov](https://github.com/alexey-milovidov)).

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-9}

- ClickHouseは`C++23`でビルドされるようになりました。[#47424](https://github.com/ClickHouse/ClickHouse/pull/47424) ([Robert Schulze](https://github.com/rschu1ze))。
- AST Fuzzerで`EXPLAIN`クエリのファズテストを実施。[#47803](https://github.com/ClickHouse/ClickHouse/pull/47803) [#47852](https://github.com/ClickHouse/ClickHouse/pull/47852) ([flynn](https://github.com/ucasfl))。
- ストレステストと自動後方互換性チェック(現在はアップグレードチェック)を分離。[#44879](https://github.com/ClickHouse/ClickHouse/pull/44879) ([Kruglov Pavel](https://github.com/Avogar))。
- 誤検知のセキュリティレポートを抑制するため、Docker用のUbuntuイメージを更新。[#46784](https://github.com/ClickHouse/ClickHouse/pull/46784) ([Julio Jimenez](https://github.com/juliojimenez))。なお、ClickHouseには依存関係がなく、Dockerは不要です。
- 「curl | sh」を使用したClickHouseのダウンロード時に、既存の`clickhouse`ダウンロードの削除を許可するプロンプトを追加。プロンプトは「ClickHouse binary clickhouse already exists. Overwrite? \[y/N\]」です。[#46859](https://github.com/ClickHouse/ClickHouse/pull/46859) ([Dan Roscigno](https://github.com/DanRoscigno))。
- 古いディストリビューション(例: Amazon Linux 2)およびARMでのサーバー起動時に、glibc 2.28シンボルが見つからないエラーを修正。[#47008](https://github.com/ClickHouse/ClickHouse/pull/47008) ([Robert Schulze](https://github.com/rschu1ze))。
- clang 16への対応準備。[#47027](https://github.com/ClickHouse/ClickHouse/pull/47027) ([Amos Bird](https://github.com/amosbird))。
- ARMで古いglibcを使用してClickHouseが実行できることを確認するCIチェックを追加。[#47063](https://github.com/ClickHouse/ClickHouse/pull/47063) ([Robert Schulze](https://github.com/rschu1ze))。
- `NDEBUG`マクロの誤った使用を防ぐためのスタイルチェックを追加。[#47699](https://github.com/ClickHouse/ClickHouse/pull/47699) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- ビルドを若干高速化。[#47714](https://github.com/ClickHouse/ClickHouse/pull/47714) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `vectorscan`を5.4.9にバージョンアップ。[#47955](https://github.com/ClickHouse/ClickHouse/pull/47955) ([Robert Schulze](https://github.com/rschu1ze))。
- Apache Arrowの致命的なロギングが中断しないことを確認するユニットテストを追加。これは[ClickHouse/arrow#16](https://github.com/ClickHouse/arrow/pull/16)の変更をカバーしています。[#47958](https://github.com/ClickHouse/ClickHouse/pull/47958) ([Arthur Passos](https://github.com/arthurpassos))。
- ネイティブmacOSデバッグサーバービルドの起動機能を復元。[#48050](https://github.com/ClickHouse/ClickHouse/pull/48050) ([Robert Schulze](https://github.com/rschu1ze))。注意: この変更は開発にのみ関連するものです。ClickHouseの公式ビルドはクロスコンパイルで行われます。


#### バグ修正（公式安定版リリースにおけるユーザーに見える不具合） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-9}

- Fix formats parser resetting, test processing bad messages in `Kafka` [#45693](https://github.com/ClickHouse/ClickHouse/pull/45693) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix data size calculation in Keeper [#46086](https://github.com/ClickHouse/ClickHouse/pull/46086) ([Antonio Andelic](https://github.com/antonio2368)).
- Fixed a bug in automatic retries of `DROP TABLE` query with `ReplicatedMergeTree` tables and `Atomic` databases. In rare cases it could lead to `Can't get data for node /zk_path/log_pointer` and `The specified key does not exist` errors if the ZooKeeper session expired during DROP and a new replicated table with the same path in ZooKeeper was created in parallel. [#46384](https://github.com/ClickHouse/ClickHouse/pull/46384) ([Alexander Tokmakov](https://github.com/tavplubix)).
- Fix incorrect alias recursion while normalizing queries that prevented some queries to run. [#46609](https://github.com/ClickHouse/ClickHouse/pull/46609) ([Raúl Marín](https://github.com/Algunenano)).
- Fix IPv4/IPv6 serialization/deserialization in binary formats [#46616](https://github.com/ClickHouse/ClickHouse/pull/46616) ([Kruglov Pavel](https://github.com/Avogar)).
- ActionsDAG: do not change result of `and` during optimization [#46653](https://github.com/ClickHouse/ClickHouse/pull/46653) ([Salvatore Mesoraca](https://github.com/aiven-sal)).
- Improve query cancellation when a client dies [#46681](https://github.com/ClickHouse/ClickHouse/pull/46681) ([Alexander Tokmakov](https://github.com/tavplubix)).
- Fix arithmetic operations in aggregate optimization [#46705](https://github.com/ClickHouse/ClickHouse/pull/46705) ([Duc Canh Le](https://github.com/canhld94)).
- Fix possible `clickhouse-local`'s abort on JSONEachRow schema inference [#46731](https://github.com/ClickHouse/ClickHouse/pull/46731) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix changing an expired role [#46772](https://github.com/ClickHouse/ClickHouse/pull/46772) ([Vitaly Baranov](https://github.com/vitlibar)).
- Fix combined PREWHERE column accumulation from multiple steps [#46785](https://github.com/ClickHouse/ClickHouse/pull/46785) ([Alexander Gololobov](https://github.com/davenger)).
- Use initial range for fetching file size in HTTP read buffer. Without this change, some remote files couldn't be processed. [#46824](https://github.com/ClickHouse/ClickHouse/pull/46824) ([Antonio Andelic](https://github.com/antonio2368)).
- Fix the incorrect progress bar while using the URL tables [#46830](https://github.com/ClickHouse/ClickHouse/pull/46830) ([Antonio Andelic](https://github.com/antonio2368)).
- Fix MSan report in `maxIntersections` function [#46847](https://github.com/ClickHouse/ClickHouse/pull/46847) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Fix a bug in `Map` data type [#46856](https://github.com/ClickHouse/ClickHouse/pull/46856) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Fix wrong results of some LIKE searches when the LIKE pattern contains quoted non-quotable characters [#46875](https://github.com/ClickHouse/ClickHouse/pull/46875) ([Robert Schulze](https://github.com/rschu1ze)).
- Fix - WITH FILL would produce abort when the Filling Transform processing an empty block [#46897](https://github.com/ClickHouse/ClickHouse/pull/46897) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- Fix date and int inference from string in JSON [#46972](https://github.com/ClickHouse/ClickHouse/pull/46972) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix bug in zero-copy replication disk choice during fetch [#47010](https://github.com/ClickHouse/ClickHouse/pull/47010) ([alesapin](https://github.com/alesapin)).
- Fix a typo in systemd service definition [#47051](https://github.com/ClickHouse/ClickHouse/pull/47051) ([Palash Goel](https://github.com/palash-goel)).
- Fix the NOT_IMPLEMENTED error with CROSS JOIN and algorithm = auto [#47068](https://github.com/ClickHouse/ClickHouse/pull/47068) ([Vladimir C](https://github.com/vdimir)).
- Fix the problem that the 'ReplicatedMergeTree' table failed to insert two similar data when the 'part_type' is configured as 'InMemory' mode (experimental feature). [#47121](https://github.com/ClickHouse/ClickHouse/pull/47121) ([liding1992](https://github.com/liding1992)).
- External dictionaries / library-bridge: Fix error "unknown library method 'extDict_libClone'" [#47136](https://github.com/ClickHouse/ClickHouse/pull/47136) ([alex filatov](https://github.com/phil-88)).
- Fix race condition in a grace hash join with limit [#47153](https://github.com/ClickHouse/ClickHouse/pull/47153) ([Vladimir C](https://github.com/vdimir)).
- Fix concrete columns PREWHERE support [#47154](https://github.com/ClickHouse/ClickHouse/pull/47154) ([Azat Khuzhin](https://github.com/azat)).
- Fix possible deadlock in Query Status [#47161](https://github.com/ClickHouse/ClickHouse/pull/47161) ([Kruglov Pavel](https://github.com/Avogar)).
- Forbid insert select for the same `Join` table, as it leads to a deadlock [#47260](https://github.com/ClickHouse/ClickHouse/pull/47260) ([Vladimir C](https://github.com/vdimir)).
- Skip merged partitions for `min_age_to_force_merge_seconds` merges [#47303](https://github.com/ClickHouse/ClickHouse/pull/47303) ([Antonio Andelic](https://github.com/antonio2368)).
- Modify find_first_symbols, so it works as expected for find_first_not_symbols [#47304](https://github.com/ClickHouse/ClickHouse/pull/47304) ([Arthur Passos](https://github.com/arthurpassos)).
- Fix big numbers inference in CSV [#47410](https://github.com/ClickHouse/ClickHouse/pull/47410) ([Kruglov Pavel](https://github.com/Avogar)).
- Disable logical expression optimizer for expression with aliases. [#47451](https://github.com/ClickHouse/ClickHouse/pull/47451) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
- Fix error in `decodeURLComponent` [#47457](https://github.com/ClickHouse/ClickHouse/pull/47457) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Fix explain graph with projection [#47473](https://github.com/ClickHouse/ClickHouse/pull/47473) ([flynn](https://github.com/ucasfl)).
- Fix query parameters [#47488](https://github.com/ClickHouse/ClickHouse/pull/47488) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Parameterized view: a bug fix. [#47495](https://github.com/ClickHouse/ClickHouse/pull/47495) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
- Fuzzer of data formats, and the corresponding fixes. [#47519](https://github.com/ClickHouse/ClickHouse/pull/47519) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Fix monotonicity check for `DateTime64` [#47526](https://github.com/ClickHouse/ClickHouse/pull/47526) ([Antonio Andelic](https://github.com/antonio2368)).
- Fix "block structure mismatch" for a Nullable LowCardinality column [#47537](https://github.com/ClickHouse/ClickHouse/pull/47537) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
- Proper fix for a bug in Apache Parquet [#45878](https://github.com/ClickHouse/ClickHouse/issues/45878) [#47538](https://github.com/ClickHouse/ClickHouse/pull/47538) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix `BSONEachRow` parallel parsing when document size is invalid [#47540](https://github.com/ClickHouse/ClickHouse/pull/47540) ([Kruglov Pavel](https://github.com/Avogar)).
- Preserve error in `system.distribution_queue` on `SYSTEM FLUSH DISTRIBUTED` [#47541](https://github.com/ClickHouse/ClickHouse/pull/47541) ([Azat Khuzhin](https://github.com/azat)).
- Check for duplicate column in `BSONEachRow` format [#47609](https://github.com/ClickHouse/ClickHouse/pull/47609) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix wait for zero copy lock during move [#47631](https://github.com/ClickHouse/ClickHouse/pull/47631) ([alesapin](https://github.com/alesapin)).
- Fix aggregation by partitions [#47634](https://github.com/ClickHouse/ClickHouse/pull/47634) ([Nikita Taranov](https://github.com/nickitat)).
- Fix bug in tuple as array serialization in `BSONEachRow` format [#47690](https://github.com/ClickHouse/ClickHouse/pull/47690) ([Kruglov Pavel](https://github.com/Avogar)).
- Fix crash in `polygonsSymDifferenceCartesian` [#47702](https://github.com/ClickHouse/ClickHouse/pull/47702) ([pufit](https://github.com/pufit)).
- Fix reading from storage `File` compressed files with `zlib` and `gzip` compression [#47796](https://github.com/ClickHouse/ClickHouse/pull/47796) ([Anton Popov](https://github.com/CurtizJ)).
- Improve empty query detection for PostgreSQL (for pgx golang driver) [#47854](https://github.com/ClickHouse/ClickHouse/pull/47854) ([Azat Khuzhin](https://github.com/azat)).
- Fix DateTime monotonicity check for LowCardinality types [#47860](https://github.com/ClickHouse/ClickHouse/pull/47860) ([Antonio Andelic](https://github.com/antonio2368)).
- Use restore_threads (not backup_threads) for RESTORE ASYNC [#47861](https://github.com/ClickHouse/ClickHouse/pull/47861) ([Azat Khuzhin](https://github.com/azat)).
- Fix DROP COLUMN with ReplicatedMergeTree containing projections [#47883](https://github.com/ClickHouse/ClickHouse/pull/47883) ([Antonio Andelic](https://github.com/antonio2368)).
- Fix for Replicated database recovery [#47901](https://github.com/ClickHouse/ClickHouse/pull/47901) ([Alexander Tokmakov](https://github.com/tavplubix)).
- Hotfix for too verbose warnings in HTTP [#47903](https://github.com/ClickHouse/ClickHouse/pull/47903) ([Alexander Tokmakov](https://github.com/tavplubix)).
- Fix "Field value too long" in `catboostEvaluate` [#47970](https://github.com/ClickHouse/ClickHouse/pull/47970) ([Robert Schulze](https://github.com/rschu1ze)).
- Fix [#36971](https://github.com/ClickHouse/ClickHouse/issues/36971): Watchdog: exit with non-zero code if child process exits [#47973](https://github.com/ClickHouse/ClickHouse/pull/47973) ([Коренберг Марк](https://github.com/socketpair)).
- Fix for "index file `cidx` is unexpectedly long" [#48010](https://github.com/ClickHouse/ClickHouse/pull/48010) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
- Fix MaterializedPostgreSQL query to get attributes (replica-identity) [#48015](https://github.com/ClickHouse/ClickHouse/pull/48015) ([Solomatov Sergei](https://github.com/solomatovs)).
- parseDateTime(): Fix UB (signed integer overflow) [#48019](https://github.com/ClickHouse/ClickHouse/pull/48019) ([Robert Schulze](https://github.com/rschu1ze)).
- Use unique names for Records in Avro to avoid reusing its schema [#48057](https://github.com/ClickHouse/ClickHouse/pull/48057) ([Kruglov Pavel](https://github.com/Avogar)).
- Correctly set TCP/HTTP socket timeouts in Keeper [#48108](https://github.com/ClickHouse/ClickHouse/pull/48108) ([Antonio Andelic](https://github.com/antonio2368)).
- Fix possible member call on null pointer in `Avro` format [#48184](https://github.com/ClickHouse/ClickHouse/pull/48184) ([Kruglov Pavel](https://github.com/Avogar)).

### <a id="232"></a> ClickHouseリリース23.2、2023-02-23 {#232}

#### 後方互換性のない変更 {#backward-incompatible-change-8}

- 関数"toDayOfWeek()"（エイリアス："DAYOFWEEK"）を拡張し、週の開始曜日（月曜日または日曜日）とカウント開始値（0または1）を指定するモード引数を追加しました。他の日時関数との一貫性を保つため、モード引数は時刻引数とタイムゾーン引数の間に挿入されました。これにより、既存の（以前は文書化されていなかった）2引数構文"toDayOfWeek(time, time_zone)"の使用が破壊されます。修正するには、関数を"toDayOfWeek(time, 0, time_zone)"に書き換えてください。[#45233](https://github.com/ClickHouse/ClickHouse/pull/45233) ([Robert Schulze](https://github.com/rschu1ze))。
- 設定`max_query_cache_size`を`filesystem_cache_max_download_size`に名称変更しました。[#45614](https://github.com/ClickHouse/ClickHouse/pull/45614) ([Kseniia Sumarokova](https://github.com/kssenii))。
- `default`ユーザーはデフォルトでアクセスタイプ`SHOW NAMED COLLECTION`の権限を持たなくなります（例：`default`ユーザーは以前のように他のユーザーにALLを付与できなくなるため、このPRは後方互換性がありません）。[#46010](https://github.com/ClickHouse/ClickHouse/pull/46010) ([Kseniia Sumarokova](https://github.com/kssenii))。
- SETTINGS句がFORMAT句の前に指定された場合、設定はフォーマット処理にも適用されます。[#46003](https://github.com/ClickHouse/ClickHouse/pull/46003) ([Azat Khuzhin](https://github.com/azat))。
- 設定`materialized_postgresql_allow_automatic_update`（デフォルトでオフになっていました）のサポートを削除しました。[#46106](https://github.com/ClickHouse/ClickHouse/pull/46106) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 実際のデータセットにおける`countDigits`のパフォーマンスをわずかに改善しました。これにより[#44518](https://github.com/ClickHouse/ClickHouse/issues/44518)がクローズされました。以前のバージョンでは、`countDigits(0)`は`0`を返していましたが、現在は`1`を返すようになり、これはより正確で既存のドキュメントに準拠しています。[#46187](https://github.com/ClickHouse/ClickHouse/pull/46187) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- コーデック"Delta"または"DoubleDelta"の後にコーデック"Gorilla"または"FPC"が続く組み合わせで圧縮された新しいカラムの作成を禁止しました。これは設定"allow_suspicious_codecs = true"を使用することで回避できます。[#45652](https://github.com/ClickHouse/ClickHouse/pull/45652) ([Robert Schulze](https://github.com/rschu1ze))。


#### 新機能 {#new-feature-10}

- S3上のIcebergテーブルストアにアクセスするための`StorageIceberg`とテーブル関数`iceberg`を追加しました。[#45384](https://github.com/ClickHouse/ClickHouse/pull/45384) ([flynn](https://github.com/ucasfl))。
- ストレージを`SETTINGS disk = '<disk_name>'`として設定できるようになりました(`storage_policy`の代わり)。また、明示的なディスク作成`SETTINGS disk = disk(type=s3, ...)`もサポートされます。[#41976](https://github.com/ClickHouse/ClickHouse/pull/41976) ([Kseniia Sumarokova](https://github.com/kssenii))。
- `system.part_log`に`ProfileEvents`カウンターを公開しました。[#38614](https://github.com/ClickHouse/ClickHouse/pull/38614) ([Bharat Nallan](https://github.com/bharatnc))。
- 既存の`ReplacingMergeTree`エンジンを拡張し、重複挿入を可能にしました。これにより、`ReplacingMergeTree`と`CollapsingMergeTree`の両方の機能を1つのMergeTreeエンジンで活用できます。削除されたデータはクエリ時に返されませんが、ディスクからは削除されません。[#41005](https://github.com/ClickHouse/ClickHouse/pull/41005) ([youennL-cs](https://github.com/youennL-cs))。
- `generateULID`関数を追加しました。Closes [#36536](https://github.com/ClickHouse/ClickHouse/issues/36536)。[#44662](https://github.com/ClickHouse/ClickHouse/pull/44662) ([Nikolay Degterinsky](https://github.com/evillique))。
- 各2列間の相関を計算する集約関数`corrMatrix`を追加しました。また、集約関数`covarSamp`と`covarPop`は`corr`と類似しているため、`covarSampMatrix`と`covarPopMatrix`も併せて追加しました。@alexey-milovidov closes [#44587](https://github.com/ClickHouse/ClickHouse/issues/44587)。[#44680](https://github.com/ClickHouse/ClickHouse/pull/44680) ([FFFFFFFHHHHHHH](https://github.com/FFFFFFFHHHHHHH))。
- 配列をランダムに並べ替えるための`arrayShuffle`関数を導入しました。[#45271](https://github.com/ClickHouse/ClickHouse/pull/45271) ([Joanna Hulboj](https://github.com/jh0x))。
- Arrowの`FIXED_SIZE_BINARY`型、`Parquet`の`FIXED_LENGTH_BYTE_ARRAY`型をサポートし、これらを`FixedString`にマッピングしました。FixedStringのデフォルト出力型を制御するための設定`output_format_parquet_fixed_string_as_fixed_byte_array/output_format_arrow_fixed_string_as_fixed_byte_array`を追加しました。Closes [#45326](https://github.com/ClickHouse/ClickHouse/issues/45326)。[#45340](https://github.com/ClickHouse/ClickHouse/pull/45340) ([Kruglov Pavel](https://github.com/Avogar))。
- system.replication_queueに新しいカラム`last_exception_time`を追加しました。[#45457](https://github.com/ClickHouse/ClickHouse/pull/45457) ([Frank Chen](https://github.com/FrankChen021))。
- SipHash{64,128}でユーザー定義のキー/シードを使用できる2つの新しい関数を追加しました。[#45513](https://github.com/ClickHouse/ClickHouse/pull/45513) ([Salvatore Mesoraca](https://github.com/aiven-sal))。
- テーブル関数`format`の3引数バージョンを許可しました。close [#45808](https://github.com/ClickHouse/ClickHouse/issues/45808)。[#45873](https://github.com/ClickHouse/ClickHouse/pull/45873) ([FFFFFFFHHHHHHH](https://github.com/FFFFFFFHHHHHHH))。
- 'x'、'w'、'S'に対する`JodaTime`フォーマットのサポートを追加しました。https://joda-time.sourceforge.net/apidocs/org/joda/time/format/DateTimeFormat.html を参照してください。[#46073](https://github.com/ClickHouse/ClickHouse/pull/46073) ([zk_kiger](https://github.com/zk-kiger))。
- ウィンドウ関数`ntile`をサポートしました。([lgbo](https://github.com/lgbo-ustc))。
- すべてのテーブルに`FINAL`修飾子を暗黙的に適用するための設定`final`を追加しました。[#40945](https://github.com/ClickHouse/ClickHouse/pull/40945) ([Arthur Passos](https://github.com/arthurpassos))。
- `arrayPartialSort`と`arrayPartialReverseSort`関数を追加しました。[#46296](https://github.com/ClickHouse/ClickHouse/pull/46296) ([Joanna Hulboj](https://github.com/jh0x))。
- 新しいHTTPパラメータ`client_protocol_version`により、Nativeフォーマットを使用するHTTPレスポンスのクライアントプロトコルバージョンを設定できるようになりました。[#40397](https://github.com/ClickHouse/ClickHouse/issues/40397)。[#46360](https://github.com/ClickHouse/ClickHouse/pull/46360) ([Geoff Genz](https://github.com/genzgd))。
- 互換性のためにSparkの`REGEXP_EXTRACT`関数に似た新しい関数`regexpExtract`を追加しました。既存の関数`extract`と類似しています。[#46469](https://github.com/ClickHouse/ClickHouse/pull/46469) ([李扬](https://github.com/taiyang-li))。
- 最も外側のJSON配列内の要素数を返す新しい関数`JSONArrayLength`を追加しました。入力されたJSON文字列が無効な場合、この関数はNULLを返します。[#46631](https://github.com/ClickHouse/ClickHouse/pull/46631) ([李扬](https://github.com/taiyang-li))。





#### パフォーマンスの改善 {#performance-improvement-10}

- 導入されたロジックは、PREWHERE条件が複数の条件の論理積(cond1 AND cond2 AND ... )である場合に機能します。同じカラムの読み取りを必要とする条件をステップごとにグループ化します。各ステップの後、完全な条件の対応する部分が計算され、結果の行がフィルタリングされる可能性があります。これにより、次のステップで読み取る行数が減少し、IOバンド幅を節約し、計算量を削減できます。このロジックは現在デフォルトで無効になっています。リグレッションがないことが確認された後、将来のリリースのいずれかでデフォルトで有効になる予定です。そのため、テストでの使用を強く推奨します。2つの設定で制御できます:"enable_multiple_prewhere_read_steps"と"move_all_conditions_to_prewhere"。[#46140](https://github.com/ClickHouse/ClickHouse/pull/46140) ([Alexander Gololobov](https://github.com/davenger))。
- テーブルのパーティションキーとGROUP BYキーに互換性がある場合、パーティションを独立して集計するオプションが追加されました。設定`allow_aggregate_partitions_independently`で制御されます。適用範囲が限定されているため、デフォルトでは無効になっています(ドキュメントを参照してください)。[#45364](https://github.com/ClickHouse/ClickHouse/pull/45364) ([Nikita Taranov](https://github.com/nickitat))。
- Compactフォーマットのパートに対してVerticalマージアルゴリズムの使用を許可します。これにより、ClickHouseサーバーはバックグラウンド操作でのメモリ使用量を大幅に削減できます。これにより[#46084](https://github.com/ClickHouse/ClickHouse/issues/46084)が解決されます。[#45681](https://github.com/ClickHouse/ClickHouse/pull/45681) [#46282](https://github.com/ClickHouse/ClickHouse/pull/46282) ([Anton Popov](https://github.com/CurtizJ))。
- バッチリーダーを使用して`Parquet`リーダーを最適化しました。[#45878](https://github.com/ClickHouse/ClickHouse/pull/45878) ([LiuNeng](https://github.com/liuneng1994))。
- 非同期Linuxサブシステム[io_uring](https://kernel.dk/io_uring.pdf)に基づく新しい`local_filesystem_read_method`メソッド`io_uring`を追加しました。デフォルトの`pread`メソッドと比較して、ほぼすべての場合で読み取りパフォーマンスが向上します。[#38456](https://github.com/ClickHouse/ClickHouse/pull/38456) ([Saulius Valatka](https://github.com/sauliusvl))。
- 論理的に等価な場合、引数として`if`式を持つ集計関数を書き換えます。例えば、`avg(if(cond, col, null))`は`avgIf(cond, col)`に書き換えることができます。これはパフォーマンスの向上に役立ちます。[#44730](https://github.com/ClickHouse/ClickHouse/pull/44730) ([李扬](https://github.com/taiyang-li))。
- avx512命令を使用してlower/upper関数のパフォーマンスを向上させました。[#37894](https://github.com/ClickHouse/ClickHouse/pull/37894) ([yaqi-zhao](https://github.com/yaqi-zhao))。
- 32コア以上のシステムでSMTが無効な場合にClickHouseがコアの半分しか使用しないという制限を削除しました(BIOSでHyper Threadingを無効にした場合)。[#44973](https://github.com/ClickHouse/ClickHouse/pull/44973) ([Robert Schulze](https://github.com/rschu1ze))。
- カラム単位の実行により関数`multiIf`のパフォーマンスを向上させ、2.3倍高速化しました。[#45296](https://github.com/ClickHouse/ClickHouse/pull/45296) ([李扬](https://github.com/taiyang-li))。
- 検索文字列が空の場合の関数`position`の高速パスを追加しました。[#45382](https://github.com/ClickHouse/ClickHouse/pull/45382) ([李扬](https://github.com/taiyang-li))。
- `query_plan_remove_redundant_sorting`最適化をデフォルトで有効にしました。最適化は[#45420](https://github.com/ClickHouse/ClickHouse/issues/45420)で実装されています。[#45567](https://github.com/ClickHouse/ClickHouse/pull/45567) ([Igor Nikonov](https://github.com/devcrafter))。
- HTTPインターフェースを使用する大規模クエリのパフォーマンスを向上させるため、HTTP Transfer Encodingのチャンクサイズを増加させました。[#45593](https://github.com/ClickHouse/ClickHouse/pull/45593) ([Geoff Genz](https://github.com/genzgd))。
- 多数の`Array`/`Map`/`Nested`カラムを持つテーブルから読み取る短い`SELECT`クエリのパフォーマンスを修正しました。[#45630](https://github.com/ClickHouse/ClickHouse/pull/45630) ([Anton Popov](https://github.com/CurtizJ))。
- 大きな整数型と10進数型のフィルタリングのパフォーマンスを向上させました。[#45949](https://github.com/ClickHouse/ClickHouse/pull/45949) ([李扬](https://github.com/taiyang-li))。
- この変更により、ColumnNullable(UInt8)からフィルタを取得する際のオーバーヘッドを効果的に削減し、全体的なクエリパフォーマンスを向上させることができます。この変更の影響を評価するため、TPC-Hベンチマークを採用しましたが、カラムタイプをnon-nullableからnullableに変更し、パフォーマンス指標としてクエリのQPSを測定しました。[#45962](https://github.com/ClickHouse/ClickHouse/pull/45962) ([Zhiguo Zhou](https://github.com/ZhiguoZh))。
- 仮想カラム`_part`と`_partition_id`を`LowCardinality(String)`型にしました。これにより[#45964](https://github.com/ClickHouse/ClickHouse/issues/45964)が解決されます。[#45975](https://github.com/ClickHouse/ClickHouse/pull/45975) ([flynn](https://github.com/ucasfl))。
- スケールが変更されない場合のDecimal変換のパフォーマンスを向上させました。[#46095](https://github.com/ClickHouse/ClickHouse/pull/46095) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 読み取りデータのプリフェッチを増加できるようにしました。[#46168](https://github.com/ClickHouse/ClickHouse/pull/46168) ([Kseniia Sumarokova](https://github.com/kssenii))。
- `arrayExists(x -> x = 1, arr)`を`has(arr, 1)`に書き換え、パフォーマンスを1.34倍向上させました。[#46188](https://github.com/ClickHouse/ClickHouse/pull/46188) ([李扬](https://github.com/taiyang-li))。
- 非リモートディスクでの垂直マージにおける過大なメモリ使用量を修正しました。リモートディスクに対して`max_insert_delayed_streams_for_parallel_write`を尊重するようにしました。[#46275](https://github.com/ClickHouse/ClickHouse/pull/46275) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- zstdをv1.5.4に更新しました。パフォーマンスと圧縮率にいくつかの小さな改善があります。異なるバージョンのClickHouseでレプリカを実行している場合、説明付きで`Data after merge/mutation is not byte-identical to data on another replicas.`という妥当なエラーメッセージが表示される可能性があります。これらのメッセージは問題なく、心配する必要はありません。[#46280](https://github.com/ClickHouse/ClickHouse/pull/46280) ([Raúl Marín](https://github.com/Algunenano))。
- [#39737](https://github.com/ClickHouse/ClickHouse/issues/39737)によって引き起こされたパフォーマンス低下を修正しました。[#46309](https://github.com/ClickHouse/ClickHouse/pull/46309) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `replicas_status`ハンドルは、大規模なレプリケーションキューがある場合でも迅速に応答します。[#46310](https://github.com/ClickHouse/ClickHouse/pull/46310) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 集計関数`sum`、単項算術関数、比較関数にavx512サポートを追加しました。[#37870](https://github.com/ClickHouse/ClickHouse/pull/37870) ([zhao zhou](https://github.com/zzachimed))。
- 最大のパフォーマンス向上を達成するため、マーク分散と読み取りの全体的な調整に関するコードを書き直しました。これにより[#34527](https://github.com/ClickHouse/ClickHouse/issues/34527)が解決されます。[#43772](https://github.com/ClickHouse/ClickHouse/pull/43772) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
- クエリ(サブクエリ)内の冗長なDISTINCT句を削除します。クエリプランの上に実装されています。DISTINCT句に関して`optimize_duplicate_order_by_and_distinct`と同様の最適化を行います。`query_plan_remove_redundant_distinct`設定で有効にできます。関連:[#42648](https://github.com/ClickHouse/ClickHouse/issues/42648)。[#44176](https://github.com/ClickHouse/ClickHouse/pull/44176) ([Igor Nikonov](https://github.com/devcrafter))。
- いくつかのクエリ書き換え最適化:`sumIf(123, cond) -> 123 * countIf(1, cond)`、`sum(if(cond, 123, 0)) -> 123 * countIf(cond)`、`sum(if(cond, 0, 123)) -> 123 * countIf(not(cond))` [#44728](https://github.com/ClickHouse/ClickHouse/pull/44728) ([李扬](https://github.com/taiyang-li))。
- クエリプラン上でのメモリバウンドマージと順序付き集計の相互作用を改善しました。以前は、実際には必要ない場合でも、AIOに対して明示的なソートにフォールバックしていました。[#45892](https://github.com/ClickHouse/ClickHouse/pull/45892) ([Nikita Taranov](https://github.com/nickitat))。
- 並行マージは、公平でスターベーションのない動作を保証するため、デフォルトでラウンドロビンを使用してスケジュールされます。以前は、厳密な優先度スケジューリングの使用により、過負荷のシャードでは大きなマージが小さなマージによってスターベーションする可能性がありました。スケジューリングアルゴリズムを選択するためのサーバー設定オプション`background_merges_mutations_scheduling_policy`を追加しました(`round_robin`または`shortest_task_first`)。[#46247](https://github.com/ClickHouse/ClickHouse/pull/46247) ([Sergei Trifonov](https://github.com/serxa))。





#### 改善 {#improvement-10}

- Enable retries for INSERT by default in case of ZooKeeper session loss. We already use it in production. [#46308](https://github.com/ClickHouse/ClickHouse/pull/46308) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Add ability to ignore unknown keys in JSON object for named tuples (`input_format_json_ignore_unknown_keys_in_named_tuple`). [#45678](https://github.com/ClickHouse/ClickHouse/pull/45678) ([Azat Khuzhin](https://github.com/azat)).
- Support optimizing the `where` clause with sorting key expression move to `prewhere` for query with `final`. [#38893](https://github.com/ClickHouse/ClickHouse/issues/38893). [#38950](https://github.com/ClickHouse/ClickHouse/pull/38950) ([hexiaoting](https://github.com/hexiaoting)).
- Add new metrics for backups: num_processed_files and processed_files_size described actual number of processed files. [#42244](https://github.com/ClickHouse/ClickHouse/pull/42244) ([Aleksandr](https://github.com/AVMusorin)).
- Added retries on interserver DNS errors. [#43179](https://github.com/ClickHouse/ClickHouse/pull/43179) ([Anton Kozlov](https://github.com/tonickkozlov)).
- Keeper improvement: try preallocating space on the disk to avoid undefined out-of-space issues. Introduce setting `max_log_file_size` for the maximum size of Keeper's Raft log files. [#44370](https://github.com/ClickHouse/ClickHouse/pull/44370) ([Antonio Andelic](https://github.com/antonio2368)).
- Optimize behavior for a replica delay api logic in case the replica is read-only. [#45148](https://github.com/ClickHouse/ClickHouse/pull/45148) ([mateng915](https://github.com/mateng0915)).
- Ask for the password in clickhouse-client interactively in a case when the empty password is wrong. Closes [#46702](https://github.com/ClickHouse/ClickHouse/issues/46702). [#46730](https://github.com/ClickHouse/ClickHouse/pull/46730) ([Nikolay Degterinsky](https://github.com/evillique)).
- Mark `Gorilla` compression on columns of non-Float\* type as suspicious. [#45376](https://github.com/ClickHouse/ClickHouse/pull/45376) ([Robert Schulze](https://github.com/rschu1ze)).
- Show replica name that is executing a merge in the `postpone_reason` column. [#45458](https://github.com/ClickHouse/ClickHouse/pull/45458) ([Frank Chen](https://github.com/FrankChen021)).
- Save exception stack trace in part_log. [#45459](https://github.com/ClickHouse/ClickHouse/pull/45459) ([Frank Chen](https://github.com/FrankChen021)).
- The `regexp_tree` dictionary is polished and now it is compatible with https://github.com/ua-parser/uap-core. [#45631](https://github.com/ClickHouse/ClickHouse/pull/45631) ([Han Fei](https://github.com/hanfei1991)).
- Updated checking of `SYSTEM SYNC REPLICA`, resolves [#45508](https://github.com/ClickHouse/ClickHouse/issues/45508) [#45648](https://github.com/ClickHouse/ClickHouse/pull/45648) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
- Rename setting `replication_alter_partitions_sync` to `alter_sync`. [#45659](https://github.com/ClickHouse/ClickHouse/pull/45659) ([Antonio Andelic](https://github.com/antonio2368)).
- The `generateRandom` table function and the engine now support `LowCardinality` data types. This is useful for testing, for example you can write `INSERT INTO table SELECT * FROM generateRandom() LIMIT 1000`. This is needed to debug [#45590](https://github.com/ClickHouse/ClickHouse/issues/45590). [#45661](https://github.com/ClickHouse/ClickHouse/pull/45661) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- The experimental query result cache now provides more modular configuration settings. [#45679](https://github.com/ClickHouse/ClickHouse/pull/45679) ([Robert Schulze](https://github.com/rschu1ze)).
- Renamed "query result cache" to "query cache". [#45682](https://github.com/ClickHouse/ClickHouse/pull/45682) ([Robert Schulze](https://github.com/rschu1ze)).
- add `SYSTEM SYNC FILE CACHE` command. It will do the `sync` syscall. [#8921](https://github.com/ClickHouse/ClickHouse/issues/8921). [#45685](https://github.com/ClickHouse/ClickHouse/pull/45685) ([DR](https://github.com/freedomDR)).
- Add a new S3 setting `allow_head_object_request`. This PR makes usage of `GetObjectAttributes` request instead of `HeadObject` introduced in https://github.com/ClickHouse/ClickHouse/pull/45288 optional (and disabled by default). [#45701](https://github.com/ClickHouse/ClickHouse/pull/45701) ([Vitaly Baranov](https://github.com/vitlibar)).
- Add ability to override connection settings based on connection names (that said that now you can forget about storing password for each connection, you can simply put everything into `~/.clickhouse-client/config.xml` and even use different history files for them, which can be also useful). [#45715](https://github.com/ClickHouse/ClickHouse/pull/45715) ([Azat Khuzhin](https://github.com/azat)).
- Arrow format: support the duration type. Closes [#45669](https://github.com/ClickHouse/ClickHouse/issues/45669). [#45750](https://github.com/ClickHouse/ClickHouse/pull/45750) ([flynn](https://github.com/ucasfl)).
- Extend the logging in the Query Cache to improve investigations of the caching behavior. [#45751](https://github.com/ClickHouse/ClickHouse/pull/45751) ([Robert Schulze](https://github.com/rschu1ze)).
- The query cache's server-level settings are now reconfigurable at runtime. [#45758](https://github.com/ClickHouse/ClickHouse/pull/45758) ([Robert Schulze](https://github.com/rschu1ze)).
- Hide password in logs when a table function's arguments are specified with a named collection. [#45774](https://github.com/ClickHouse/ClickHouse/pull/45774) ([Vitaly Baranov](https://github.com/vitlibar)).
- Improve internal S3 client to correctly deduce regions and redirections for different types of URLs. [#45783](https://github.com/ClickHouse/ClickHouse/pull/45783) ([Antonio Andelic](https://github.com/antonio2368)).
- Add support for Map, IPv4 and IPv6 types in generateRandom. Mostly useful for testing. [#45785](https://github.com/ClickHouse/ClickHouse/pull/45785) ([Raúl Marín](https://github.com/Algunenano)).
- Support empty/notEmpty for IP types. [#45799](https://github.com/ClickHouse/ClickHouse/pull/45799) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
- The column `num_processed_files` was split into two columns: `num_files` (for BACKUP) and `files_read` (for RESTORE). The column `processed_files_size` was split into two columns: `total_size` (for BACKUP) and `bytes_read` (for RESTORE). [#45800](https://github.com/ClickHouse/ClickHouse/pull/45800) ([Vitaly Baranov](https://github.com/vitlibar)).
- Add support for `SHOW ENGINES` query for MySQL compatibility. [#45859](https://github.com/ClickHouse/ClickHouse/pull/45859) ([Filatenkov Artur](https://github.com/FArthur-cmd)).
- Improved how the obfuscator deals with queries. [#45867](https://github.com/ClickHouse/ClickHouse/pull/45867) ([Raúl Marín](https://github.com/Algunenano)).
- Improve behaviour of conversion into Date for boundary value 65535 (2149-06-06). [#46042](https://github.com/ClickHouse/ClickHouse/pull/46042) [#45914](https://github.com/ClickHouse/ClickHouse/pull/45914) ([Joanna Hulboj](https://github.com/jh0x)).
- Add setting `check_referential_table_dependencies` to check referential dependencies on `DROP TABLE`. This PR solves [#38326](https://github.com/ClickHouse/ClickHouse/issues/38326). [#45936](https://github.com/ClickHouse/ClickHouse/pull/45936) ([Vitaly Baranov](https://github.com/vitlibar)).
- Fix `tupleElement` to return `Null` when having `Null` argument. Closes [#45894](https://github.com/ClickHouse/ClickHouse/issues/45894). [#45952](https://github.com/ClickHouse/ClickHouse/pull/45952) ([flynn](https://github.com/ucasfl)).
- Throw an error on no files satisfying the S3 wildcard. Closes [#45587](https://github.com/ClickHouse/ClickHouse/issues/45587). [#45957](https://github.com/ClickHouse/ClickHouse/pull/45957) ([chen](https://github.com/xiedeyantu)).
- Use cluster state data to check concurrent backup/restore. [#45982](https://github.com/ClickHouse/ClickHouse/pull/45982) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
- ClickHouse Client: Use "exact" matching for fuzzy search, which has correct case ignorance and more appropriate algorithm for matching SQL queries. [#46000](https://github.com/ClickHouse/ClickHouse/pull/46000) ([Azat Khuzhin](https://github.com/azat)).
- Forbid wrong create View syntax `CREATE View X TO Y AS SELECT`. Closes [#4331](https://github.com/ClickHouse/ClickHouse/issues/4331). [#46043](https://github.com/ClickHouse/ClickHouse/pull/46043) ([flynn](https://github.com/ucasfl)).
- Storage `Log` family support setting the `storage_policy`. Closes [#43421](https://github.com/ClickHouse/ClickHouse/issues/43421). [#46044](https://github.com/ClickHouse/ClickHouse/pull/46044) ([flynn](https://github.com/ucasfl)).
- Improve `JSONColumns` format when the result is empty. Closes [#46024](https://github.com/ClickHouse/ClickHouse/issues/46024). [#46053](https://github.com/ClickHouse/ClickHouse/pull/46053) ([flynn](https://github.com/ucasfl)).
- Add reference implementation for SipHash128. [#46065](https://github.com/ClickHouse/ClickHouse/pull/46065) ([Salvatore Mesoraca](https://github.com/aiven-sal)).
- Add a new metric to record allocations times and bytes using mmap. [#46068](https://github.com/ClickHouse/ClickHouse/pull/46068) ([李扬](https://github.com/taiyang-li)).
- Currently for functions like `leftPad`, `rightPad`, `leftPadUTF8`, `rightPadUTF8`, the second argument `length` must be UInt8|16|32|64|128|256. Which is too strict for clickhouse users, besides, it is not consistent with other similar functions like `arrayResize`, `substring` and so on. [#46103](https://github.com/ClickHouse/ClickHouse/pull/46103) ([李扬](https://github.com/taiyang-li)).
- Fix assertion in the `welchTTest` function in debug build when the resulting statistics is NaN. Unified the behavior with other similar functions. Change the behavior of `studentTTest` to return NaN instead of throwing an exception because the previous behavior was inconvenient. This closes [#41176](https://github.com/ClickHouse/ClickHouse/issues/41176) This closes [#42162](https://github.com/ClickHouse/ClickHouse/issues/42162). [#46141](https://github.com/ClickHouse/ClickHouse/pull/46141) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- More convenient usage of big integers and ORDER BY WITH FILL. Allow using plain integers for start and end points in WITH FILL when ORDER BY big (128-bit and 256-bit) integers. Fix the wrong result for big integers with negative start or end points. This closes [#16733](https://github.com/ClickHouse/ClickHouse/issues/16733). [#46152](https://github.com/ClickHouse/ClickHouse/pull/46152) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Add `parts`, `active_parts` and `total_marks` columns to `system.tables` on [issue](https://github.com/ClickHouse/ClickHouse/issues/44336). [#46161](https://github.com/ClickHouse/ClickHouse/pull/46161) ([attack204](https://github.com/attack204)).
- Functions "multi[Fuzzy]Match(Any|AnyIndex|AllIndices}" now reject regexes which will likely evaluate very slowly in vectorscan. [#46167](https://github.com/ClickHouse/ClickHouse/pull/46167) ([Robert Schulze](https://github.com/rschu1ze)).
- When `insert_null_as_default` is enabled and column doesn't have defined default value, the default of column type will be used. Also this PR fixes using default values on nulls in case of LowCardinality columns. [#46171](https://github.com/ClickHouse/ClickHouse/pull/46171) ([Kruglov Pavel](https://github.com/Avogar)).
- Prefer explicitly defined access keys for S3 clients. If `use_environment_credentials` is set to `true`, and the user has provided the access key through query or config, they will be used instead of the ones from the environment variable. [#46191](https://github.com/ClickHouse/ClickHouse/pull/46191) ([Antonio Andelic](https://github.com/antonio2368)).
- Add an alias "DATE_FORMAT()" for function "formatDateTime()" to improve compatibility with MySQL's SQL dialect, extend function `formatDateTime` with substitutions "a", "b", "c", "h", "i", "k", "l" "r", "s", "W". ### Documentation entry for user-facing changes User-readable short description: `DATE_FORMAT` is an alias of `formatDateTime`. Formats a Time according to the given Format string. Format is a constant expression, so you cannot have multiple formats for a single result column. (Provide link to [formatDateTime](/sql-reference/functions/date-time-functions/#formatDateTime)). [#46302](https://github.com/ClickHouse/ClickHouse/pull/46302) ([Jake Bamrah](https://github.com/JakeBamrah)).
- Add `ProfileEvents` and `CurrentMetrics` about the callback tasks for parallel replicas (`s3Cluster` and `MergeTree` tables). [#46313](https://github.com/ClickHouse/ClickHouse/pull/46313) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
- Add support for `DELETE` and `UPDATE` for tables using `KeeperMap` storage engine. [#46330](https://github.com/ClickHouse/ClickHouse/pull/46330) ([Antonio Andelic](https://github.com/antonio2368)).
- Allow writing RENAME queries with query parameters. Resolves [#45778](https://github.com/ClickHouse/ClickHouse/issues/45778). [#46407](https://github.com/ClickHouse/ClickHouse/pull/46407) ([Nikolay Degterinsky](https://github.com/evillique)).
- Fix parameterized SELECT queries with REPLACE transformer. Resolves [#33002](https://github.com/ClickHouse/ClickHouse/issues/33002). [#46420](https://github.com/ClickHouse/ClickHouse/pull/46420) ([Nikolay Degterinsky](https://github.com/evillique)).
- Exclude the internal database used for temporary/external tables from the calculation of asynchronous metric "NumberOfDatabases". This makes the behavior consistent with system table "system.databases". [#46435](https://github.com/ClickHouse/ClickHouse/pull/46435) ([Robert Schulze](https://github.com/rschu1ze)).
- Added `last_exception_time` column into distribution_queue table. [#46564](https://github.com/ClickHouse/ClickHouse/pull/46564) ([Aleksandr](https://github.com/AVMusorin)).
- Support for IN clause with parameter in parameterized views. [#46583](https://github.com/ClickHouse/ClickHouse/pull/46583) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
- Do not load named collections on server startup (load them on first access instead). [#46607](https://github.com/ClickHouse/ClickHouse/pull/46607) ([Kseniia Sumarokova](https://github.com/kssenii)).

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-10}

- LLVMランタイムによって実装されたGWP-ASanを導入しました。これにより [#27039](https://github.com/ClickHouse/ClickHouse/issues/27039) が解決されます。[#45226](https://github.com/ClickHouse/ClickHouse/pull/45226) ([Han Fei](https://github.com/hanfei1991))。
- テストの安定性を低下させ、より不安定にすることを目的として、テストにおけるマージツリー設定のランダム化を追加しました。[#38983](https://github.com/ClickHouse/ClickHouse/pull/38983) ([Anton Popov](https://github.com/CurtizJ))。
- PowerPCにおけるHDFSサポートを有効化し、以下の機能テスト02113_hdfs_assert.sh、02244_hdfs_cluster.sql、02368_cancel_write_into_hdfs.shの修正に貢献しました。[#44949](https://github.com/ClickHouse/ClickHouse/pull/44949) ([MeenaRenganathan22](https://github.com/MeenaRenganathan22))。
- clickhouse-keeper用のsystemd.serviceファイルを追加しました。[#44293](https://github.com/ClickHouse/ClickHouse/issues/44293) を修正します。[#45568](https://github.com/ClickHouse/ClickHouse/pull/45568) ([Mikhail f. Shiryaev](https://github.com/Felixoid))。
- ClickHouseのpocoフォークを「contrib/」から「base/poco/」に移動しました。[#46075](https://github.com/ClickHouse/ClickHouse/pull/46075) ([Robert Schulze](https://github.com/rschu1ze))。
- `clickhouse-watchdog`に子プロセスを再起動するオプションを追加しました。これはあまり有用ではありません。[#46312](https://github.com/ClickHouse/ClickHouse/pull/46312) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 環境変数`CLICKHOUSE_DOCKER_RESTART_ON_EXIT`が1に設定されている場合、Dockerコンテナは`clickhouse-server`を最初のプロセスではなく子プロセスとして実行し、終了時に再起動します。[#46391](https://github.com/ClickHouse/ClickHouse/pull/46391) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- Systemdサービスファイルを修正しました。[#46461](https://github.com/ClickHouse/ClickHouse/pull/46461) ([SuperDJY](https://github.com/cmsxbc))。
- ClickHouseのビルドに必要な最小Clangバージョンを12から15に引き上げました。[#46710](https://github.com/ClickHouse/ClickHouse/pull/46710) ([Robert Schulze](https://github.com/rschu1ze))。
- Intel QPLをv0.3.0からv1.0.0にアップグレードしました。libaccel-configをビルドし、動的ではなく静的にQPLライブラリにリンクするようにしました。[#45809](https://github.com/ClickHouse/ClickHouse/pull/45809) ([jasperzhu](https://github.com/jinjunzh))。

#### バグ修正(公式安定版リリースにおけるユーザーから見える不具合) {#bug-fix-user-visible-misbehavior-in-official-stable-release}


* `StorageRabbitMQ` で、データを `rabbitmq_flush_interval_ms` または `rabbitmq_max_block_size` に従って正確にフラッシュするようにしました。 [#42389](https://github.com/ClickHouse/ClickHouse/issues/42389) をクローズ。 [#45160](https://github.com/ClickHouse/ClickHouse/issues/45160) をクローズ。 [#44404](https://github.com/ClickHouse/ClickHouse/pull/44404)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* `sparkBar` 関数でのレンダリングに `PODArray` を使用することで、メモリ使用量を制御できるようにしました。[#44467](https://github.com/ClickHouse/ClickHouse/issues/44467) をクローズ。[#44489](https://github.com/ClickHouse/ClickHouse/pull/44489)（[Duc Canh Le](https://github.com/canhld94)）。
* 関数 (quantilesExactExclusive, quantilesExactInclusive) がソートされていない配列要素を返す問題を修正しました。 [#45379](https://github.com/ClickHouse/ClickHouse/pull/45379) ([wujunfu](https://github.com/wujunfu)).
* OpenTelemetry が有効な場合に HTTPHandler で発生する未捕捉例外を修正。 [#45456](https://github.com/ClickHouse/ClickHouse/pull/45456) ([Frank Chen](https://github.com/FrankChen021)).
* 8 桁の数字から日付を推測しないでください。誤ったデータが読み込まれる可能性があります。 [#45581](https://github.com/ClickHouse/ClickHouse/pull/45581) ([Kruglov Pavel](https://github.com/Avogar)).
* `odbc_bridge_use_connection_pooling` 設定が正しく使用されるように修正。[#45591](https://github.com/ClickHouse/ClickHouse/pull/45591) ([Bharat Nallan](https://github.com/bharatnc))。
* キャッシュ内のコールバックが呼び出された時点で、そのキャッシュが既に破棄されている可能性があります。安全性を確保するため、メンバーは値キャプチャします。タスクスケジューラについても、ストレージが破棄される前に非アクティブ化されるため安全です。[#45548](https://github.com/ClickHouse/ClickHouse/issues/45548) を解決しました。 [#45601](https://github.com/ClickHouse/ClickHouse/pull/45601)（[Han Fei](https://github.com/hanfei1991)）。
* コーデック Delta または DoubleDelta をコーデック Gorilla と組み合わせた場合に発生するデータ破損を修正しました。 [#45615](https://github.com/ClickHouse/ClickHouse/pull/45615) ([Robert Schulze](https://github.com/rschu1ze)).
* N-gram ブルームフィルターインデックス使用時の型チェックを正しく行い、不正な読み取りを回避します。 [#45617](https://github.com/ClickHouse/ClickHouse/pull/45617) ([Antonio Andelic](https://github.com/antonio2368)).
* `c-ares` をめぐって、いくつかのセグメンテーションフォルトが報告されました。これらは私の以前のプルリクエストで発生するようになった不具合です。Alexander Tokmakov の協力を得て、これらを修正しました。[#45629](https://github.com/ClickHouse/ClickHouse/pull/45629) ([Arthur Passos](https://github.com/arthurpassos))。
* 重複したプライマリキーが存在する場合のキーの記述を修正しました。これはプロジェクションで発生することがあります。詳細は [#45590](https://github.com/ClickHouse/ClickHouse/issues/45590) を参照してください。[#45686](https://github.com/ClickHouse/ClickHouse/pull/45686)（[Amos Bird](https://github.com/amosbird)）。
* バックアップの圧縮方式とレベルを設定できるようにしました。[#45690](https://github.com/ClickHouse/ClickHouse/issues/45690) をクローズ。[#45737](https://github.com/ClickHouse/ClickHouse/pull/45737)（[Pradeep Chhetri](https://github.com/chhetripradeep)）。
* `select_query_typed.limitOffset` の代わりに `select_query_typed.limitByOffset` を使用する必要があります。 [#45817](https://github.com/ClickHouse/ClickHouse/pull/45817) ([刘陶峰](https://github.com/taofengliu)).
* experimental analyzer を使用すると、`SELECT number FROM numbers(100) LIMIT 10 OFFSET 10;` のようなクエリが誤った結果（この SQL に対して結果が空になる）を返すことがあります。これは、planner によって不要な offset ステップが追加されてしまうことが原因です。[#45822](https://github.com/ClickHouse/ClickHouse/pull/45822)（[刘陶峰](https://github.com/taofengliu)）。
* 後方互換性 - `UInt64` から `IPv4` への暗黙的な縮小変換を許可 - 「INSERT ... VALUES ...」式に必要。 [#45865](https://github.com/ClickHouse/ClickHouse/pull/45865) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 先頭オクテットが欠落した混在 IPv4 アドレス（`::.1.2.3` のような形式）に対する IPv6 パーサーのバグを修正しました。 [#45871](https://github.com/ClickHouse/ClickHouse/pull/45871) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* `query_kind` 列を `system.processes` テーブルおよび `SHOW PROCESSLIST` クエリに追加しました。重複したコードを削除しました。これにより、次のバグが修正されました。グローバル設定パラメータ `max_concurrent_select_queries` が、`INTERSECT` または `EXCEPT` のチェーンを含むクエリに対しては適用されていませんでした。 [#45872](https://github.com/ClickHouse/ClickHouse/pull/45872) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* `stochasticLinearRegression` 関数で発生していたクラッシュを修正。WingFuzz により検出。[#45985](https://github.com/ClickHouse/ClickHouse/pull/45985)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* スパースカラムが有効になっているテーブル（設定 `ratio_of_defaults_for_sparse_serialization` により制御）からデータを読み取る際に、`INTERSECT` および `EXCEPT` 修飾子を使用した `SELECT` クエリで発生していたクラッシュを修正しました。 [#45987](https://github.com/ClickHouse/ClickHouse/pull/45987) ([Anton Popov](https://github.com/CurtizJ)).
* FINAL を伴う DESC ソートに対する read-in-order 最適化を修正し、[#45815](https://github.com/ClickHouse/ClickHouse/issues/45815) をクローズ。[#46009](https://github.com/ClickHouse/ClickHouse/pull/46009)（[Vladimir C](https://github.com/vdimir)）。
* コンパクトパーツで、複数レベルのネストを持つ存在しないカラムを読み取ろうとした際の挙動を修正。 [#46045](https://github.com/ClickHouse/ClickHouse/pull/46045) ([Azat Khuzhin](https://github.com/azat)).
* system.processes の elapsed カラムの (10倍の) 誤差を修正。[#46047](https://github.com/ClickHouse/ClickHouse/pull/46047) ([Azat Khuzhin](https://github.com/azat)).
* ドメイン IP 型 (IPv4, IPv6) をネイティブ型に置き換える変更 [https://github.com/ClickHouse/ClickHouse/pull/43221](https://github.com/ClickHouse/ClickHouse/pull/43221) に対するフォローアップ修正。 [#46087](https://github.com/ClickHouse/ClickHouse/pull/46087) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 設定において、すでに値を持つパラメータへの環境変数の代入処理を修正しました。これにより [#46131](https://github.com/ClickHouse/ClickHouse/issues/46131) がクローズされます。また [#9547](https://github.com/ClickHouse/ClickHouse/issues/9547) もクローズされます。 [#46144](https://github.com/ClickHouse/ClickHouse/pull/46144) ([pufit](https://github.com/pufit))。
* `GROUPING SETS` における誤った述語プッシュダウンを修正。[#45947](https://github.com/ClickHouse/ClickHouse/issues/45947) をクローズ。[#46151](https://github.com/ClickHouse/ClickHouse/pull/46151)（[flynn](https://github.com/ucasfl)）。
* 定数キーを使用する `fulls_sorting_join` で発生する可能性のあるパイプライン停止エラーを修正。 [#46175](https://github.com/ClickHouse/ClickHouse/pull/46175) ([Vladimir C](https://github.com/vdimir)).
* 誤った結果を避けるため、フォーマット時にタプル関数をリテラルとして書き換えないようにしました。 [#46232](https://github.com/ClickHouse/ClickHouse/pull/46232) ([Salvatore Mesoraca](https://github.com/aiven-sal))。
* Arrow フォーマットで LowCardinality(Nullable) を読み取る際に発生する可能性のある範囲外アクセスエラーを修正しました。 [#46270](https://github.com/ClickHouse/ClickHouse/pull/46270) ([Kruglov Pavel](https://github.com/Avogar)).
* 例外 `CANNOT_PARSE_INPUT_ASSERTION_FAILED` により失敗していた `SYSTEM UNFREEZE` クエリの問題を修正しました。[#46325](https://github.com/ClickHouse/ClickHouse/pull/46325) ([Aleksei Filatov](https://github.com/aalexfvk))。
* HashTable を格納する関数の集約状態をデシリアライズする際に整数オーバーフローによって発生し得るクラッシュを修正しました。 [#46349](https://github.com/ClickHouse/ClickHouse/pull/46349) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* フォーマット `VALUES` で送信された不正なデータを含む非同期挿入で発生する可能性のある `LOGICAL_ERROR` を修正しました。 [#46350](https://github.com/ClickHouse/ClickHouse/pull/46350) ([Anton Popov](https://github.com/CurtizJ))。
* `ALTER ... MOVE PART ... TO TABLE` を実行しようとした際に発生していた LOGICAL&#95;ERROR を修正しました。この種のクエリはもともとサポートされていませんでした。 [#46359](https://github.com/ClickHouse/ClickHouse/pull/46359) ([Alexander Tokmakov](https://github.com/tavplubix)).
* `parallel_distributed_insert_select` が有効な場合の並列 distributed insert-select において、s3Cluster のスキーマ推論を修正しました。 [#46381](https://github.com/ClickHouse/ClickHouse/pull/46381) ([Kruglov Pavel](https://github.com/Avogar)).
* `arr1` と `arr2` が同じ `Nested` カラムのフィールドである場合の `ALTER TABLE ... UPDATE nested.arr1 = nested.arr2 ...` のようなクエリの問題を修正しました。 [#46387](https://github.com/ClickHouse/ClickHouse/pull/46387) ([Anton Popov](https://github.com/CurtizJ)).
* スケジューラがタスクのスケジュールに失敗することがあります。その場合は `MulityPartUpload` 全体を中止し、`UploadHelper` はすでにスケジュールされたタスクの完了を待機しなければなりません。 [#46451](https://github.com/ClickHouse/ClickHouse/pull/46451) ([Dmitry Novik](https://github.com/novikd))。
* デフォルト型が異なる Merge に対する PREWHERE の挙動を修正（列のデフォルト型が異なる場合に発生していた一部の `NOT_FOUND_COLUMN_IN_BLOCK` を解消し、列の型がテーブル間で同じ場合には `PREWHERE` を許可し、型が異なる場合にのみ禁止するようにした）。 [#46454](https://github.com/ClickHouse/ClickHouse/pull/46454) ([Azat Khuzhin](https://github.com/azat)).
* `ORDER BY` で定数値が使用された場合に発生しうるクラッシュを修正しました。 [#46466](https://github.com/ClickHouse/ClickHouse/issues/46466) を修正。 [#46493](https://github.com/ClickHouse/ClickHouse/pull/46493)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* クエリレベルで `disk` 設定が指定されており、かつ設定ファイルの MergeTree 設定セクションで `storage_policy` が指定されている場合でも、例外をスローしないようにしました。`disk` は設定ファイル側の設定を上書きします。[#46533](https://github.com/ClickHouse/ClickHouse/pull/46533) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 関数 `arrayMap` における定数 `LowCardinality` 引数の不正な処理を修正しました。このバグにより、リリースビルドではセグメンテーションフォルトが、デバッグビルドでは論理エラー `Bad cast` が発生する可能性がありました。 [#46569](https://github.com/ClickHouse/ClickHouse/pull/46569) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* [#46557](https://github.com/ClickHouse/ClickHouse/issues/46557) を修正します。[#46611](https://github.com/ClickHouse/ClickHouse/pull/46611)（[Alexander Gololobov](https://github.com/davenger)）。
* サーバーが1分30秒以内に起動できない場合に、clickhouse-server の systemd ユニットが無限に再起動を繰り返す問題を修正しました（systemd サービスから clickhouse-server を起動する際のタイムアウトロジックを無効化）。[#46613](https://github.com/ClickHouse/ClickHouse/pull/46613)（[Azat Khuzhin](https://github.com/azat)）。
* 非同期挿入中に割り当てられたメモリバッファがグローバルコンテキストで解放され、その際に対応するユーザーおよびクエリの `MemoryTracker` カウンタが正しく更新されていませんでした。その結果、OOM 例外が誤って発生することがありました。 [#46622](https://github.com/ClickHouse/ClickHouse/pull/46622) ([Dmitry Novik](https://github.com/novikd)).
* 今後の analyze 実行で使用されるため、table&#95;join から on&#95;expression をクリアしないように変更し、[#45185](https://github.com/ClickHouse/ClickHouse/issues/45185) を解決しました。[#46487](https://github.com/ClickHouse/ClickHouse/pull/46487)（[SmitaRKulkarni](https://github.com/SmitaRKulkarni)）。

### <a id="231"></a> ClickHouseリリース23.1、2023-01-26 {#231}

### ClickHouseリリース23.1 {#clickhouse-release-231}

#### アップグレード時の注意事項 {#upgrade-notes-2}

- `SYSTEM RESTART DISK`クエリは何も実行しなくなります。[#44647](https://github.com/ClickHouse/ClickHouse/pull/44647) ([alesapin](https://github.com/alesapin))。
- `HASHED`/`SPARSE_HASHED`ディクショナリの`PREALLOCATE`オプションは何も実行しなくなります。[#45388](https://github.com/ClickHouse/ClickHouse/pull/45388) ([Azat Khuzhin](https://github.com/azat))。このオプションは既に大きな利点を提供しません。
- Float32型またはFloat64型以外のカラムに対する`Gorilla`コーデックの使用を禁止します。[#45252](https://github.com/ClickHouse/ClickHouse/pull/45252) ([Robert Schulze](https://github.com/rschu1ze))。これは無意味であり、不整合を引き起こしていました。
- 非推奨の構文で作成された`*MergeTree`テーブルでは、並列クォーラム挿入が正しく動作しない可能性があります。そのため、このようなテーブルに対する並列クォーラム挿入のサポートは完全に無効化されます。新しい構文で作成されたテーブルには影響しません。[#45430](https://github.com/ClickHouse/ClickHouse/pull/45430) ([Alexander Tokmakov](https://github.com/tavplubix))。
- AWS S3内のオブジェクトのサイズを取得する際に、`HeadObject`リクエストの代わりに`GetObjectAttributes`リクエストを使用します。この変更により、例えばAWS SDKの更新後に明示的なリージョンを持たないエンドポイントの処理が修正されます。[#45288](https://github.com/ClickHouse/ClickHouse/pull/45288) ([Vitaly Baranov](https://github.com/vitlibar))。AWS S3とMinioはテスト済みですが、各種S3互換サービス(GCS、R2、B2)には微妙な非互換性がある可能性があることに注意してください。この変更により、`GetObjectAttributes`リクエストを許可するためにACLの調整が必要になる場合があります。
- タイムゾーン名にパスを含めることを禁止します。例えば、`/usr/share/zoneinfo/Asia/Aden`のようなタイムゾーン名は許可されません。`Asia/Aden`のようなIANAタイムゾーンデータベース名を使用する必要があります。[#44225](https://github.com/ClickHouse/ClickHouse/pull/44225) ([Kruglov Pavel](https://github.com/Avogar))。
- 等結合と定数式を組み合わせたクエリ(例:`JOIN ON t1.x = t2.x AND 1 = 1`)は、不正確な結果を生じるため禁止されます。[#44016](https://github.com/ClickHouse/ClickHouse/pull/44016) ([Vladimir C](https://github.com/vdimir))。


#### 新機能 {#new-feature-11}

- 正規表現ツリーを走査してキーを抽出するディクショナリソース。User-Agentの解析に使用できます。[#40878](https://github.com/ClickHouse/ClickHouse/pull/40878) ([Vage Ogannisian](https://github.com/nooblose)). [#43858](https://github.com/ClickHouse/ClickHouse/pull/43858) ([Han Fei](https://github.com/hanfei1991)).
- パラメータ化ビュー機能を追加しました。Viewテーブルエンジンにクエリパラメータを指定できるようになりました。解決: [#40907](https://github.com/ClickHouse/ClickHouse/issues/40907). [#41687](https://github.com/ClickHouse/ClickHouse/pull/41687) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
- `quantileInterpolatedWeighted`/`quantilesInterpolatedWeighted`関数を追加しました。[#38252](https://github.com/ClickHouse/ClickHouse/pull/38252) ([Bharat Nallan](https://github.com/bharatnc)).
- `Map`型に対するArray joinのサポート。Sparkの"explode"関数と同様の機能です。[#43239](https://github.com/ClickHouse/ClickHouse/pull/43239) ([李扬](https://github.com/taiyang-li)).
- SQL標準のバイナリおよび16進数文字列リテラルをサポートしました。[#43785](https://github.com/ClickHouse/ClickHouse/pull/43785) ([Mo Xuan](https://github.com/mo-avatar)).
- Joda-Timeスタイルでの`DateTime`フォーマットを許可しました。[Joda-Timeドキュメント](https://joda-time.sourceforge.net/apidocs/org/joda/time/format/DateTimeFormat.html)を参照してください。[#43818](https://github.com/ClickHouse/ClickHouse/pull/43818) ([李扬](https://github.com/taiyang-li)).
- `formatDateTime`に小数秒フォーマッタ(`%f`)を実装しました。[#44060](https://github.com/ClickHouse/ClickHouse/pull/44060) ([ltrk2](https://github.com/ltrk2)). [#44497](https://github.com/ClickHouse/ClickHouse/pull/44497) ([Alexander Gololobov](https://github.com/davenger)).
- 2つの日付または日時の差を完全な単位数で表現して計算する`age`関数を追加しました。解決: [#41115](https://github.com/ClickHouse/ClickHouse/issues/41115). [#44421](https://github.com/ClickHouse/ClickHouse/pull/44421) ([Robert Schulze](https://github.com/rschu1ze)).
- ディクショナリに`Null`ソースを追加しました。解決: [#44240](https://github.com/ClickHouse/ClickHouse/issues/44240). [#44502](https://github.com/ClickHouse/ClickHouse/pull/44502) ([mayamika](https://github.com/mayamika)).
- `s3_storage_class`設定オプションでS3ストレージクラスを設定可能になりました。例: `<s3_storage_class>STANDARD/INTELLIGENT_TIERING</s3_storage_class>` 解決: [#44443](https://github.com/ClickHouse/ClickHouse/issues/44443). [#44707](https://github.com/ClickHouse/ClickHouse/pull/44707) ([chen](https://github.com/xiedeyantu)).
- 名前付きタプルの解析時にJSONオブジェクトに要素が欠落している場合、デフォルト値を挿入します。この動作を制御する設定`input_format_json_defaults_for_missing_elements_in_named_tuple`を追加しました。解決: [#45142](https://github.com/ClickHouse/ClickHouse/issues/45142)#issuecomment-1380153217. [#45231](https://github.com/ClickHouse/ClickHouse/pull/45231) ([Kruglov Pavel](https://github.com/Avogar)).
- ProfileEventsにサーバー起動時間を記録します(`ServerStartupMilliseconds`)。解決: [#43188](https://github.com/ClickHouse/ClickHouse/issues/43188). [#45250](https://github.com/ClickHouse/ClickHouse/pull/45250) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
- ストリーミングエンジンKafka/RabbitMQ/NATSをリファクタリングおよび改善し、すべてのフォーマットのサポートを追加しました。フォーマットも一部リファクタリングしました: - サフィックス/プレフィックス付きの行ベースフォーマットでのメッセージ生成を修正しました。すべてのメッセージがすべての区切り文字を含めて完全にフォーマットされ、入力フォーマットを使用して解析できるようになりました。 - Native、Parquet、ORCなどのブロックベースフォーマットをサポートしました。各ブロックは個別のメッセージとしてフォーマットされます。1つのメッセージ内の行数はブロックサイズに依存するため、設定`max_block_size`で制御できます。 - 新しいエンジン設定`kafka_max_rows_per_message/rabbitmq_max_rows_per_message/nats_max_rows_per_message`を追加しました。これらは行ベースフォーマットで1つのメッセージにフォーマットされる行数を制御します。デフォルト値: 1。 - NATSテーブルエンジンの高メモリ消費を修正しました。 - NATSプロデューサーで任意のバイナリデータをサポートしました(以前は末尾に\0を含む文字列のみで動作していました) - ドキュメントに欠落していたKafka/RabbitMQ/NATSエンジン設定を追加しました。 - Kafka/RabbitMQ/NATSでの生成と消費をリファクタリングし、WriteBuffers/ReadBuffersのセマンティクスから分離しました。 - 出力フォーマットをリファクタリングしました: Kafka/RabbitMQ/NATSで使用されていた各行のコールバックを削除(現在はコールバックを使用していません)、IRowOutputFormatを直接使用可能に、行末と行間の区切り文字を明確化、フォーマットを再開するために出力フォーマットをリセット可能にしました - formatRow関数に適切な実装を追加しました(フォーマットリファクタリング後のボーナス)。[#42777](https://github.com/ClickHouse/ClickHouse/pull/42777) ([Kruglov Pavel](https://github.com/Avogar)).
- `CapnProto`フォーマットで`Nested`テーブルを`Struct`の`List`として読み書きをサポートしました。`Decimal32/64`を`Int32/64`として読み書きします。解決: [#43319](https://github.com/ClickHouse/ClickHouse/issues/43319). [#43379](https://github.com/ClickHouse/ClickHouse/pull/43379) ([Kruglov Pavel](https://github.com/Avogar)).
- `system.text_log`に`message_format_string`カラムを追加しました。このカラムにはメッセージのフォーマットに使用されたパターンが含まれます。[#44543](https://github.com/ClickHouse/ClickHouse/pull/44543) ([Alexander Tokmakov](https://github.com/tavplubix)). これによりClickHouseログに対する様々な分析が可能になります。
- CSV/TSV/CustomSeparated入力フォーマットのカラム名(および場合によっては型)を含むヘッダーの自動検出を試行します。
  この動作を有効にする設定input_format_tsv/csv/custom_detect_headerを追加しました(デフォルトで有効)。解決: [#44640](https://github.com/ClickHouse/ClickHouse/issues/44640). [#44953](https://github.com/ClickHouse/ClickHouse/pull/44953) ([Kruglov Pavel](https://github.com/Avogar)).

#### 実験的機能 {#experimental-feature-7}

- 効率的なテキスト検索のための新しいセカンダリインデックスタイプとして、実験的な転置インデックスを追加しました。[#38667](https://github.com/ClickHouse/ClickHouse/pull/38667) ([larryluogit](https://github.com/larryluogit))。
- 実験的なクエリ結果キャッシュを追加しました。[#43797](https://github.com/ClickHouse/ClickHouse/pull/43797) ([Robert Schulze](https://github.com/rschu1ze))。
- IOリクエスト用の拡張可能かつ設定可能なスケジューリングサブシステムを追加しました(IOコード自体にはまだ統合されていません)。[#41840](https://github.com/ClickHouse/ClickHouse/pull/41840) ([Sergei Trifonov](https://github.com/serxa))。この機能は現時点では何も実行しません、お楽しみください。
- `Replicated`データベースの停止したレプリカのメタデータを削除する`SYSTEM DROP DATABASE REPLICA`を追加しました。[#41794](https://github.com/ClickHouse/ClickHouse/issues/41794)を解決します。[#42807](https://github.com/ClickHouse/ClickHouse/pull/42807) ([Alexander Tokmakov](https://github.com/tavplubix))。


#### パフォーマンス改善 {#performance-improvement-11}

- `MergeTree`テーブルの起動時に非アクティブなパートを読み込まないようにしました。[#42181](https://github.com/ClickHouse/ClickHouse/pull/42181) ([Anton Popov](https://github.com/CurtizJ))。
- 大量の小さなファイルを扱う際の、ストレージ`S3`およびテーブル関数`s3`からの読み取りレイテンシを改善しました。ストレージ`S3`からの読み取り時に、設定`remote_filesystem_read_method`と`remote_filesystem_read_prefetch`が有効になりました。[#43726](https://github.com/ClickHouse/ClickHouse/pull/43726) ([Anton Popov](https://github.com/CurtizJ))。
- Parquet/ORCファイルの構造体フィールド読み取りを最適化しました。必要なフィールドのみが読み込まれます。[#44484](https://github.com/ClickHouse/ClickHouse/pull/44484) ([lgbo](https://github.com/lgbo-ustc))。
- HTTPインターフェース経由のクエリで2段階集約アルゴリズムが誤って無効化されていました。再度有効化され、大幅なパフォーマンス改善につながりました。[#45450](https://github.com/ClickHouse/ClickHouse/pull/45450) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
- StorageFileにmmapサポートを追加し、clickhouse-localのパフォーマンスを改善しました。[#43927](https://github.com/ClickHouse/ClickHouse/pull/43927) ([pufit](https://github.com/pufit))。
- HashedDictionaryにシャーディングサポートを追加し、並列読み込みを可能にしました(シャード数に基づくほぼ線形のスケーリング)。[#40003](https://github.com/ClickHouse/ClickHouse/pull/40003) ([Azat Khuzhin](https://github.com/azat))。
- クエリ解析を高速化しました。[#42284](https://github.com/ClickHouse/ClickHouse/pull/42284) ([Raúl Marín](https://github.com/Algunenano))。
- `expr`が`LowCardinality`カラムの場合、OR連鎖`expr = x1 OR ... OR expr = xN`を常に`expr IN (x1, ..., xN)`に置き換えるようにしました。この場合、設定`optimize_min_equality_disjunction_chain_length`は無視されます。[#42889](https://github.com/ClickHouse/ClickHouse/pull/42889) ([Guo Wangyang](https://github.com/guowangy))。
- ThreadStatus周辺のコードを最適化し、パフォーマンスをわずかに改善しました。[#43586](https://github.com/ClickHouse/ClickHouse/pull/43586) ([Zhiguo Zhou](https://github.com/ZhiguoZh))。
- 自動ベクトル化を実現することで、カラム単位の三項論理評価を最適化しました。この[マイクロベンチマーク](https://github.com/ZhiguoZh/ClickHouse/blob/20221123-ternary-logic-opt-example/src/Functions/examples/associative_applier_perf.cpp)のパフォーマンステストでは、ICXデバイス(Intel Xeon Platinum 8380 CPU)において最大**21倍**の**パフォーマンス向上**を確認しました。[#43669](https://github.com/ClickHouse/ClickHouse/pull/43669) ([Zhiguo Zhou](https://github.com/ZhiguoZh))。
- 可能な限り`system.tables`テーブルでの読み取りロックの取得を回避するようにしました。[#43840](https://github.com/ClickHouse/ClickHouse/pull/43840) ([Raúl Marín](https://github.com/Algunenano))。
- ThreadPoolを最適化しました。ICXデバイス(Intel Xeon Platinum 8380 CPU、80コア、160スレッド)でのSSB(Star Schema Benchmark)のパフォーマンス実験では、この変更によりThreadPoolImpl::mutexのロック競合を**75%**効果的に削減し、CPU使用率を向上させ、全体的なパフォーマンスを**2.4%**改善できることが示されました。[#44308](https://github.com/ClickHouse/ClickHouse/pull/44308) ([Zhiguo Zhou](https://github.com/ZhiguoZh))。
- ハッシュテーブルサイズを予測する最適化は、キャッシュされたハッシュテーブルサイズが十分に大きい場合にのみ適用されるようになりました(閾値は経験的に決定され、ハードコードされています)。[#44455](https://github.com/ClickHouse/ClickHouse/pull/44455) ([Nikita Taranov](https://github.com/nickitat))。
- リモートファイルシステムからの非同期読み取りのパフォーマンスをわずかに改善しました。[#44868](https://github.com/ClickHouse/ClickHouse/pull/44868) ([Kseniia Sumarokova](https://github.com/kssenii))。
- 次の処理に高速パスを追加しました: - `col like '%%'`; - `col like '%'`; - `col not like '%'`; - `col not like '%'`; - `match(col, '.*')`。[#45244](https://github.com/ClickHouse/ClickHouse/pull/45244) ([李扬](https://github.com/taiyang-li))。
- フィルタリング(WHERE句)におけるハッピーパス最適化をわずかに改善しました。[#45289](https://github.com/ClickHouse/ClickHouse/pull/45289) ([Nikita Taranov](https://github.com/nickitat))。
- `toUnixTimestamp64*`に単調性情報を提供し、インデックス解析のためのより多くの代数的最適化を可能にしました。[#44116](https://github.com/ClickHouse/ClickHouse/pull/44116) ([Nikita Taranov](https://github.com/nickitat))。
- クエリ処理用の一時データ(ディスクへのスピル)の設定がファイルシステムキャッシュと連携できるようにしました(キャッシュディスクから領域を使用) [#43972](https://github.com/ClickHouse/ClickHouse/pull/43972) ([Vladimir C](https://github.com/vdimir))。これは主に[ClickHouse Cloud](https://console.clickhouse.cloud/)を改善しますが、適切な知識があればセルフマネージド環境でも使用できます。
- `system.replicas`テーブルでレプリカステータスを並列取得するようにしました。[#43918](https://github.com/ClickHouse/ClickHouse/issues/43918)を解決。[#43998](https://github.com/ClickHouse/ClickHouse/pull/43998) ([Nikolay Degterinsky](https://github.com/evillique))。
- S3へのバックアップ時のメモリ消費を最適化しました: S3へのファイルは、`WriteBufferFromS3`(大量のメモリを使用する可能性がある)を使用せずに直接コピーされるようになりました。[#45188](https://github.com/ClickHouse/ClickHouse/pull/45188) ([Vitaly Baranov](https://github.com/vitlibar))。
- 非同期ブロックIDのキャッシュを追加しました。これにより、非同期挿入の重複排除を有効にした際のZooKeeperへのリクエスト数が削減されます。[#45106](https://github.com/ClickHouse/ClickHouse/pull/45106) ([Han Fei](https://github.com/hanfei1991))。

#### 改善 {#improvement-11}


* 引数なしの `generateRandom` で挿入先テーブルの構造を使用するようにしました。 [#45239](https://github.com/ClickHouse/ClickHouse/pull/45239) ([Kruglov Pavel](https://github.com/Avogar)).
* `JSONExtract` 関数で、JSON の文字列フィールドに格納された浮動小数点数を整数型へ暗黙的に変換できるようにしました。例: `JSONExtract('{"a": "1000.111"}', 'a', 'UInt64')` -&gt; `1000`。それ以前は 0 を返していました。 [#45432](https://github.com/ClickHouse/ClickHouse/pull/45432) ([Anton Popov](https://github.com/CurtizJ)).
* テーブル `system.formats` にフィールド `supports_parallel_parsing` と `supports_parallel_formatting` を追加し、インスペクション機能を改善しました。 [#45499](https://github.com/ClickHouse/ClickHouse/pull/45499) ([Anton Popov](https://github.com/CurtizJ)).
* CustomSeparated/Template 形式での CSV フィールドの読み取りを改善。[#42352](https://github.com/ClickHouse/ClickHouse/issues/42352) と [#39620](https://github.com/ClickHouse/ClickHouse/issues/39620) をクローズ。 [#43332](https://github.com/ClickHouse/ClickHouse/pull/43332)（[Kruglov Pavel](https://github.com/Avogar)）。
* クエリの経過時間の計測方法を統一しました。 [#43455](https://github.com/ClickHouse/ClickHouse/pull/43455) ([Raúl Marín](https://github.com/Algunenano)).
* 仮想列が `SELECT` クエリ内に存在する場合に、テーブル関数 file/hdfs/s3 で挿入元テーブルの構造を自動的に利用する処理を改善しました。これにより、`Block structure mismatch` や `number of columns mismatch` といったエラーが発生する可能性のあった問題が修正されます。 [#43695](https://github.com/ClickHouse/ClickHouse/pull/43695) ([Kruglov Pavel](https://github.com/Avogar)).
* 関数 `range` で符号付き引数をサポートしました。[#43333](https://github.com/ClickHouse/ClickHouse/issues/43333) を修正。 [#43733](https://github.com/ClickHouse/ClickHouse/pull/43733)（[sanyu](https://github.com/wineternity)）。
* 冗長なソートを削除します。たとえば、サブクエリ内の関連する ORDER BY 句によるソートなどです。クエリプラン上に実装されています。`ORDER BY` 句に関しては `optimize_duplicate_order_by_and_distinct` と同様の最適化を行いますが、より汎用的です。ORDER BY 句によって生じたものに限らず、あらゆる冗長なソートステップに適用され、任意の深さのサブクエリに対して適用されます。[#42648](https://github.com/ClickHouse/ClickHouse/issues/42648) に関連。 [#43905](https://github.com/ClickHouse/ClickHouse/pull/43905)（[Igor Nikonov](https://github.com/devcrafter)）。
* BACKUP のファイル重複排除を無効化できる機能を追加しました（重複排除なしのバックアップでは、完全な RESTORE の代わりに ATTACH を使用できます）。たとえば `BACKUP foo TO S3(...) SETTINGS deduplicate_files=0`（デフォルトは `deduplicate_files=1`）。[#43947](https://github.com/ClickHouse/ClickHouse/pull/43947)（[Azat Khuzhin](https://github.com/azat)）。
* テキストフォーマットに対するスキーマ推論をリファクタリングし、改善しました。結果の型を `Nullable` にするかどうかを制御する新しい設定 `schema_inference_make_columns_nullable` を追加しました（デフォルトで有効）。[#44019](https://github.com/ClickHouse/ClickHouse/pull/44019) ([Kruglov Pavel](https://github.com/Avogar))。
* `PROXYv1` プロトコルのサポートを強化。 [#44135](https://github.com/ClickHouse/ClickHouse/pull/44135) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* `system.parts` テーブルに、クリーンアップスレッドによる最新のパーツ検査に関する情報を追加しました。 [#44244](https://github.com/ClickHouse/ClickHouse/pull/44244) ([Dmitry Novik](https://github.com/novikd))。
* 読み取り専用モードでの挿入にテーブル関数を使用できないようにしました。 [#44290](https://github.com/ClickHouse/ClickHouse/pull/44290) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* `CleanupThread` の 1 回のイテレーションで処理されるパーツ数を制限するための設定 `simultaneous_parts_removal_limit` を追加しました。 [#44461](https://github.com/ClickHouse/ClickHouse/pull/44461) ([Dmitry Novik](https://github.com/novikd))。
* クエリで仮想カラムのみが必要な場合は、ReadBufferFromS3 を初期化しないようにします。これは [#44246](https://github.com/ClickHouse/ClickHouse/issues/44246) の改善に役立つ可能性があります。 [#44493](https://github.com/ClickHouse/ClickHouse/pull/44493)（[chen](https://github.com/xiedeyantu)）。
* 重複した列名に関するヒントの出力を防止。 [#44130](https://github.com/ClickHouse/ClickHouse/issues/44130) をクローズ。 [#44519](https://github.com/ClickHouse/ClickHouse/pull/44519)（[Joanna Hulboj](https://github.com/jh0x)）。
* ディスクのエンドポイントでマクロの代入を許可。 [#40951](https://github.com/ClickHouse/ClickHouse/issues/40951) を解決。 [#44533](https://github.com/ClickHouse/ClickHouse/pull/44533)（[SmitaRKulkarni](https://github.com/SmitaRKulkarni)）。
* `input_format_json_read_object_as_string` が有効な場合のスキーマ推論を改善。 [#44546](https://github.com/ClickHouse/ClickHouse/pull/44546) ([Kruglov Pavel](https://github.com/Avogar)).
* ユーザーレベルの設定 `database_replicated_allow_replicated_engine_arguments` を追加しました。これにより、`DatabaseReplicated` で引数付きの `ReplicatedMergeTree` テーブルを作成することを禁止できるようになります。 [#44566](https://github.com/ClickHouse/ClickHouse/pull/44566) ([alesapin](https://github.com/alesapin)).
* ユーザーが誤って `index_granularity` にゼロ（無効な）値を指定してしまうことを防ぎます。これにより [#44536](https://github.com/ClickHouse/ClickHouse/issues/44536) がクローズされました。[#44578](https://github.com/ClickHouse/ClickHouse/pull/44578)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* config.xml の `kerberos` セクション内の `keytab` パラメータで、サービス keytab ファイルへのパスを設定できるようになりました。 [#44594](https://github.com/ClickHouse/ClickHouse/pull/44594) ([Roman Vasin](https://github.com/rvasin)).
* すでに入力されているクエリの一部をファジー検索に利用するようにしました（`skim` ライブラリに渡します。このライブラリは Rust で実装され、ClickHouse に静的リンクされています）。[#44600](https://github.com/ClickHouse/ClickHouse/pull/44600)（[Azat Khuzhin](https://github.com/azat)）。
* `JSON Object` 型が実験的機能である間もネストされた JSON オブジェクトを読み取れるようにするため、`input_format_json_read_objects_as_strings` をデフォルトで有効にしました。 [#44657](https://github.com/ClickHouse/ClickHouse/pull/44657) ([Kruglov Pavel](https://github.com/Avogar)).
* 非同期挿入の重複排除の改善: ユーザーが重複した非同期挿入を行った場合、Keeper を問い合わせる前にメモリ内で重複排除を行うようにしました。 [#44682](https://github.com/ClickHouse/ClickHouse/pull/44682) ([Han Fei](https://github.com/hanfei1991))。
* 入力/出力の `Avro` フォーマットは、bool 型を ClickHouse の Bool 型として解析するようになりました。 [#44684](https://github.com/ClickHouse/ClickHouse/pull/44684) ([Kruglov Pavel](https://github.com/Avogar)).
* Arrow/Parquet/ORC で Bool 型をサポート。 [#43970](https://github.com/ClickHouse/ClickHouse/issues/43970) をクローズ。 [#44698](https://github.com/ClickHouse/ClickHouse/pull/44698)（[Kruglov Pavel](https://github.com/Avogar)）。
* UUID を読み取る際に、クォートの外側まで貪欲にパースしないようにしました。そうしないと、誤ったデータを誤って正常にパースしてしまう可能性があります。 [#44686](https://github.com/ClickHouse/ClickHouse/pull/44686) ([Raúl Marín](https://github.com/Algunenano)).
* Int64 のオーバーフロー時に UInt64 を推論し、スキーマ推論における一部の変換を修正します。 [#44696](https://github.com/ClickHouse/ClickHouse/pull/44696) ([Kruglov Pavel](https://github.com/Avogar)).
* 以前は `Replicated` データベース内での依存関係の解決がハック的な方法で行われていましたが、現在は明示的なグラフを使用して正しく実装されています。 [#44697](https://github.com/ClickHouse/ClickHouse/pull/44697) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
* `output_format_pretty_row_numbers` がブロック間でカウンタを保持しない問題を修正。 [#44815](https://github.com/ClickHouse/ClickHouse/issues/44815) をクローズ。 [#44832](https://github.com/ClickHouse/ClickHouse/pull/44832)（[flynn](https://github.com/ucasfl)）。
* バックグラウンドのクリーンアップ処理と同時にパーツがマージされていることが原因で発生する `system.errors` 内のエラーを報告しないようにしました。 [#44874](https://github.com/ClickHouse/ClickHouse/pull/44874) ([Raúl Marín](https://github.com/Algunenano)).
* Distributed async INSERT のメトリクスを最適化し、修正しました。 [#44922](https://github.com/ClickHouse/ClickHouse/pull/44922) ([Azat Khuzhin](https://github.com/azat)).
* バックアップおよびリストアの同時実行を禁止する設定を追加し、[#43891](https://github.com/ClickHouse/ClickHouse/issues/43891) を解決しました。実装: * サーバーレベルの設定を追加してバックアップおよびリストアの同時実行を禁止し、`BackupWorker` が `Context` 内で作成される際にそれらが読み取られ、設定されるようにしました。 * 設定はデフォルトで `true` に設定されています。 * バックアップまたはリストアを開始する前に、他のバックアップ／リストアが実行中でないかを確認するチェックを追加しました。内部リクエストの場合、`backup_uuid` を使用して同一ノードからのリクエストかどうかを確認します。 [#45072](https://github.com/ClickHouse/ClickHouse/pull/45072) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
* システムログ用に `<storage_policy>` 設定パラメータを追加。[#45320](https://github.com/ClickHouse/ClickHouse/pull/45320) ([Stig Bakken](https://github.com/stigsb))。

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-11}

- ClickHouseクライアント/ローカルの履歴におけるファジー検索のために、`skim`ライブラリ(Rustで記述)との静的リンクを実装しました。[#44239](https://github.com/ClickHouse/ClickHouse/pull/44239) ([Azat Khuzhin](https://github.com/azat))。
- Rustの導入に伴い、共有リンクのサポートを削除しました。実際のところ、Rustは削除の口実に過ぎず、以前から削除を検討していました。[#44828](https://github.com/ClickHouse/ClickHouse/pull/44828) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- 使用していないため、パッケージから`adduser`ツールへの依存関係を削除しました。これにより[#44934](https://github.com/ClickHouse/ClickHouse/issues/44934)が修正されます。[#45011](https://github.com/ClickHouse/ClickHouse/pull/45011) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- `SQLite`ライブラリを最新版に更新しました。これはSQLiteデータベースおよびテーブル統合エンジンで使用されます。また、TSanの誤検知レポートを修正しました。これにより[#45027](https://github.com/ClickHouse/ClickHouse/issues/45027)がクローズされます。[#45031](https://github.com/ClickHouse/ClickHouse/pull/45031) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
- PowerPCにおけるWeakHashの衝突問題に対処するためのCRC-32の変更。[#45144](https://github.com/ClickHouse/ClickHouse/pull/45144) ([MeenaRenganathan22](https://github.com/MeenaRenganathan22))。
- aws-c\*サブモジュールの更新 [#43020](https://github.com/ClickHouse/ClickHouse/pull/43020) ([Vitaly Baranov](https://github.com/vitlibar))。
- グリーンなバックポートPRおよびグリーンな承認済みPRの自動マージ [#41110](https://github.com/ClickHouse/ClickHouse/pull/41110) ([Mikhail f. Shiryaev](https://github.com/Felixoid))。
- ClickHouse CIのステータス用[ウェブサイト](https://aretestsgreenyet.com/)を導入しました。[ソース](https://github.com/ClickHouse/aretestsgreenyet)。

#### バグ修正 {#bug-fix}


* ドメイン IP 型（IPv4、IPv6）をネイティブ型に置き換えました。 [#43221](https://github.com/ClickHouse/ClickHouse/pull/43221) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。これにより、コード内で不足していたいくつかの実装が自動的に補完されます。
* バックアップ処理中にミューテーションが kill された場合のバックアップ処理を修正。 [#45351](https://github.com/ClickHouse/ClickHouse/pull/45351) ([Vitaly Baranov](https://github.com/vitlibar)).
* `Invalid number of rows in Chunk` という例外メッセージを修正しました。 [#41404](https://github.com/ClickHouse/ClickHouse/issues/41404)。 [#42126](https://github.com/ClickHouse/ClickHouse/pull/42126) ([Alexander Gololobov](https://github.com/davenger))。
* ソート後に式を実行した際に初期化されていない値が使用される可能性がある問題を修正します。 [#43386](https://github.com/ClickHouse/ClickHouse/issues/43386) [#43635](https://github.com/ClickHouse/ClickHouse/pull/43635) をクローズします（[Kruglov Pavel](https://github.com/Avogar)）。
* 集約コンビネータにおける NULL の扱いを改善し、あまり一般的でない最適化 `optimize_rewrite_sum_if_to_count_if` の使用時に発生しうるセグフォルト／論理エラーを修正しました。[#43758](https://github.com/ClickHouse/ClickHouse/issues/43758) をクローズ。[#43813](https://github.com/ClickHouse/ClickHouse/pull/43813)（[Kruglov Pavel](https://github.com/Avogar)）。
* CREATE USER/ROLE クエリの settings 制約を修正しました。 [#43993](https://github.com/ClickHouse/ClickHouse/pull/43993) ([Nikolay Degterinsky](https://github.com/evillique)).
* テーブルメタデータ内の `EPHEMERAL` カラムの既定値がパース不可能になっていたバグを修正しました。 [#44026](https://github.com/ClickHouse/ClickHouse/pull/44026) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 互換性設定における不正なバージョンのパース処理を修正。 [#44224](https://github.com/ClickHouse/ClickHouse/pull/44224) ([Kruglov Pavel](https://github.com/Avogar)).
* datetime からの interval の減算を加算と同様の挙動にそろえました。 [#44241](https://github.com/ClickHouse/ClickHouse/pull/44241) ([ltrk2](https://github.com/ltrk2)).
* ビュー結果の最大サイズ制限を解除しました。 [#44261](https://github.com/ClickHouse/ClickHouse/pull/44261) ([lizhuoyu5](https://github.com/lzydmxy)).
* `do_not_evict_index_and_mrk_files=1` の場合にキャッシュで発生しうる論理エラーを修正しました。[#42142](https://github.com/ClickHouse/ClickHouse/issues/42142) をクローズ。[#44268](https://github.com/ClickHouse/ClickHouse/pull/44268)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 書き込みスルーキャッシュにおいて、本来は継続されるべきキャッシュ処理が、誤った前提により早期に中断されてしまう可能性があった問題を修正。 [#44289](https://github.com/ClickHouse/ClickHouse/pull/44289) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 定数引数を持つ `IN` 関数が、`LowCardinality` と組み合わせて定数引数として使用された場合に発生し得るクラッシュを修正しました。[#44221](https://github.com/ClickHouse/ClickHouse/issues/44221) を修正します。 [#44346](https://github.com/ClickHouse/ClickHouse/pull/44346)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* パラメトリック集約関数の複雑なパラメータ（配列など）に対するサポートを修正しました。この変更により、[#30975](https://github.com/ClickHouse/ClickHouse/issues/30975) がクローズされました。集約関数 `sumMapFiltered` は、この変更以前は分散クエリで使用できませんでした。[#44358](https://github.com/ClickHouse/ClickHouse/pull/44358)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* BSON スキーマ推論における `ObjectId` の読み取りを修正しました。 [#44382](https://github.com/ClickHouse/ClickHouse/pull/44382) ([Kruglov Pavel](https://github.com/Avogar)).
* ReplicatedMergeTree において、マージが完了する前に一時パーツが早期に削除されてしまう原因となるレースコンディションを修正しました。この問題により、`No such file or directory: xxx` のようなエラーが発生する可能性がありました。[#43983](https://github.com/ClickHouse/ClickHouse/issues/43983) を修正します。[#44383](https://github.com/ClickHouse/ClickHouse/pull/44383)（[alesapin](https://github.com/alesapin)）。
* 一部の不正な `SYSTEM ... ON CLUSTER` クエリが、クラスタ名が指定されていない場合に予期しない動作をしていました。これは修正され、現在は不正なクエリは本来どおり `SYNTAX_ERROR` を送出するようになりました。 [#44264](https://github.com/ClickHouse/ClickHouse/issues/44264) を修正。 [#44387](https://github.com/ClickHouse/ClickHouse/pull/44387)（[Alexander Tokmakov](https://github.com/tavplubix)）。
* ORC フォーマットでの Map 型の読み込みを修正。 [#44400](https://github.com/ClickHouse/ClickHouse/pull/44400) ([Kruglov Pavel](https://github.com/Avogar)).
* Parquet/ORC フォーマットにおいて、入力データに存在しない列を読み取る際の動作を修正しました。以前は `INCORRECT_NUMBER_OF_COLUMNS` エラーが発生する可能性がありました。[#44333](https://github.com/ClickHouse/ClickHouse/issues/44333) をクローズ。 [#44405](https://github.com/ClickHouse/ClickHouse/pull/44405)（[Kruglov Pavel](https://github.com/Avogar)）。
* 以前は `bar` 関数が、5/8 と 6/8 のバーの両方を表示するために同じ &#39;▋&#39; (U+258B &quot;Left five eighths block&quot;) 文字を使用していました。この変更により、6/8 のバーの表示には &#39;▊&#39; (U+258A &quot;Left three quarters block&quot;) を使用するように動作が修正されました。[#44410](https://github.com/ClickHouse/ClickHouse/pull/44410)（[Alexander Gololobov](https://github.com/davenger)）。
* 構成ファイルでプロファイル設定制約より後にプロファイル設定を記述していたため、制約が効いていませんでした。 [#44411](https://github.com/ClickHouse/ClickHouse/pull/44411) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* データ付きの `EXPLAIN AST INSERT` クエリを実行した際に発生する `SYNTAX_ERROR` を修正。[#44207](https://github.com/ClickHouse/ClickHouse/issues/44207) をクローズ。[#44413](https://github.com/ClickHouse/ClickHouse/pull/44413)（[save-my-heart](https://github.com/save-my-heart)）。
* CSV フォーマットで CRLF を含む bool 値の読み取りを修正。[#44401](https://github.com/ClickHouse/ClickHouse/issues/44401) をクローズ。[#44442](https://github.com/ClickHouse/ClickHouse/pull/44442)（[Kruglov Pavel](https://github.com/Avogar)）。
* LowCardinality 辞書に対して execute や and/or/if/multiIf を実行しないようにし、その結果型が LowCardinality にならないようにしました。これにより、場合によって発生していた `Illegal column ColumnLowCardinality` エラーを防ぎます。[#43603](https://github.com/ClickHouse/ClickHouse/issues/43603) を修正。 [#44469](https://github.com/ClickHouse/ClickHouse/pull/44469)（[Kruglov Pavel](https://github.com/Avogar)）。
* 設定 `max_streams_for_merge_tree_reading` によってミューテーションを修正します。 [#44472](https://github.com/ClickHouse/ClickHouse/pull/44472) ([Anton Popov](https://github.com/CurtizJ)).
* ASTSelectQuery::formatImpl における GROUPING SETS でのヌルポインタ・デリファレンスの可能性を修正しました（[#43049](https://github.com/ClickHouse/ClickHouse/issues/43049)）。[#44479](https://github.com/ClickHouse/ClickHouse/pull/44479)（[Robert Schulze](https://github.com/rschu1ze)）。
* 設定に従って、テーブル関数の引数、CAST 関数の引数、および JSONAsObject のスキーマ推論における型を検証。 [#44501](https://github.com/ClickHouse/ClickHouse/pull/44501) ([Kruglov Pavel](https://github.com/Avogar)).
* LowCardinality と const カラムを使用した IN 関数の不具合を修正し、[#44503](https://github.com/ClickHouse/ClickHouse/issues/44503) をクローズ。 [#44506](https://github.com/ClickHouse/ClickHouse/pull/44506)（[Duc Canh Le](https://github.com/canhld94)）。
* `CREATE TABLE` 文における `DEFAULT` 式の正規化処理で発生していたバグを修正しました。関数 `in` の第 2 引数（または演算子 `IN` の右辺引数）が、CREATE クエリの実行中にその評価結果で置き換えられてしまう可能性がありました。[#44496](https://github.com/ClickHouse/ClickHouse/issues/44496) を修正します。 [#44547](https://github.com/ClickHouse/ClickHouse/pull/44547)（[Alexander Tokmakov](https://github.com/tavplubix)）。
* WITH ROLLUP、WITH CUBE、WITH TOTALS が指定されている場合、プロジェクションは動作しません。以前のバージョンでは、プロジェクションの使用をスキップする代わりに、クエリは例外をスローしていました。これにより [#44614](https://github.com/ClickHouse/ClickHouse/issues/44614) がクローズされます。これにより [#42772](https://github.com/ClickHouse/ClickHouse/issues/42772) がクローズされます。 [#44615](https://github.com/ClickHouse/ClickHouse/pull/44615)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 関数 `get all blocks sorted by time` が非同期ブロックを取得していなかったため、非同期ブロックがクリーンアップされませんでした。 [#44651](https://github.com/ClickHouse/ClickHouse/pull/44651) ([Han Fei](https://github.com/hanfei1991)).
* サブクエリ、UNION、TOTALS を伴う JOIN において発生する `LOGICAL_ERROR`「The top step of the right pipeline should be ExpressionStep」を修正しました。 [#43687](https://github.com/ClickHouse/ClickHouse/issues/43687) を修正。 [#44673](https://github.com/ClickHouse/ClickHouse/pull/44673)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* Executable テーブルエンジンでの `std::out_of_range` 例外を回避。 [#44681](https://github.com/ClickHouse/ClickHouse/pull/44681) ([Kruglov Pavel](https://github.com/Avogar)).
* AST 上の quantiles に `optimize_syntax_fuse_functions` を適用しないようにし、[#44712](https://github.com/ClickHouse/ClickHouse/issues/44712) をクローズ。[#44713](https://github.com/ClickHouse/ClickHouse/pull/44713)（[Vladimir C](https://github.com/vdimir)）。
* Merge テーブルと PREWHERE における誤った型のバグを修正し、[#43324](https://github.com/ClickHouse/ClickHouse/issues/43324) をクローズしました。[#44716](https://github.com/ClickHouse/ClickHouse/pull/44716)（[Vladimir C](https://github.com/vdimir)）。
* シャットダウン時（TraceCollector の破棄中）に発生しうるクラッシュを修正しました。 [#44757](https://github.com/ClickHouse/ClickHouse/issues/44757) を解決。 [#44758](https://github.com/ClickHouse/ClickHouse/pull/44758)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 分散クエリ処理で発生しうるクラッシュを修正しました。このクラッシュは、totals または extremes を含むクエリが空の結果を返し、かつ Distributed テーブルとローカルテーブルの型が一致していない場合に発生する可能性がありました。[#44738](https://github.com/ClickHouse/ClickHouse/issues/44738) を修正します。[#44760](https://github.com/ClickHouse/ClickHouse/pull/44760)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* フェッチ（`min_compressed_bytes_to_fsync_after_fetch`）時の fsync と、小さいファイル（ttl.txt、columns.txt）、およびミューテーション（`min_rows_to_fsync_after_merge` / `min_compressed_bytes_to_fsync_after_merge`）時の fsync を修正。 [#44781](https://github.com/ClickHouse/ClickHouse/pull/44781) ([Azat Khuzhin](https://github.com/azat)).
* ディスク間でパーツが移動されている状況で `system.parts` または `system.parts_columns` テーブルをクエリすると、まれにレースコンディションが発生する可能性がありました。[#41145](https://github.com/ClickHouse/ClickHouse/issues/41145) で導入。[#44809](https://github.com/ClickHouse/ClickHouse/pull/44809)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* プロジェクション最適化を有効にしている場合に発生する可能性がある `Context has expired` エラーを修正しました。これは、実行時にコンテキストを使用する `dictHas/dictGet` のような特定の関数を含むクエリで再現可能でした。[#44844](https://github.com/ClickHouse/ClickHouse/issues/44844) を修正。[#44850](https://github.com/ClickHouse/ClickHouse/pull/44850)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* リモート fs から `LowCardinality` 辞書を読み込む際に発生する可能性があった `Cannot read all data` エラーの修正。 [#44709](https://github.com/ClickHouse/ClickHouse/issues/44709) を修正。 [#44875](https://github.com/ClickHouse/ClickHouse/pull/44875)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* ハードウェアモニターセンサーを読み取れない場合に、ログに完全な例外メッセージを出力するのではなく、そのケースを無視するようにしました。 [#44895](https://github.com/ClickHouse/ClickHouse/pull/44895) ([Raúl Marín](https://github.com/Algunenano)).
* 計算された INSERT の遅延時間が設定値を超えた場合に `max_delay_to_insert` の値を使用します。[#44902](https://github.com/ClickHouse/ClickHouse/issues/44902) に関連。[#44916](https://github.com/ClickHouse/ClickHouse/pull/44916)（[Igor Nikonov](https://github.com/devcrafter)）。
* `UNION` を含むクエリで発生するエラー `Different order of columns in UNION subquery` を修正。 [#44866](https://github.com/ClickHouse/ClickHouse/issues/44866) を解決。 [#44920](https://github.com/ClickHouse/ClickHouse/pull/44920) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
* INSERT の遅延が誤って計算される可能性があり、その結果、正しい値ではなく常に `max_delay_to_insert` 設定が遅延として使用されてしまうことがありました。単純な式 `max_delay_to_insert * (parts_over_threshold/max_allowed_parts_over_threshold)` を使用し、しきい値を超えたパーツ数に比例して遅延が増加するようにしました。[#44902](https://github.com/ClickHouse/ClickHouse/issues/44902) をクローズします。[#44954](https://github.com/ClickHouse/ClickHouse/pull/44954)（[Igor Nikonov](https://github.com/devcrafter)）。
* ワイドパートに軽量削除マスクがある場合に発生する `ALTER TABLE ... TTL` エラーを修正。 [#44959](https://github.com/ClickHouse/ClickHouse/pull/44959) ([Mingliang Pan](https://github.com/liangliangpan)).
* ドメイン IP 型（IPv4, IPv6）をネイティブ型に置き換える変更 [#43221](https://github.com/ClickHouse/ClickHouse/issues/43221) に対するフォローアップ修正。[#45024](https://github.com/ClickHouse/ClickHouse/pull/45024)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* ドメイン IP 型 (IPv4, IPv6) をネイティブ型に置き換える変更に対するフォローアップの修正 [https://github.com/ClickHouse/ClickHouse/pull/43221](https://github.com/ClickHouse/ClickHouse/pull/43221)。 [#45043](https://github.com/ClickHouse/ClickHouse/pull/45043)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* パーサーでバッファオーバーフローが発生する可能性がありました。ファザーによって発見されました。 [#45047](https://github.com/ClickHouse/ClickHouse/pull/45047) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* ストレージ FileLog で発生しうる `cannot-read-all-data` エラーを修正しました。[#45051](https://github.com/ClickHouse/ClickHouse/issues/45051)、[#38257](https://github.com/ClickHouse/ClickHouse/issues/38257) をクローズしました。[#45057](https://github.com/ClickHouse/ClickHouse/pull/45057)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* クエリに grouping sets が含まれている場合、メモリ効率の良い集計（`distributed_aggregation_memory_efficient` 設定）は無効化されます。 [#45058](https://github.com/ClickHouse/ClickHouse/pull/45058) ([Nikita Taranov](https://github.com/nickitat))。
* `update_field` が指定されている場合の更新時に、`RANGE_HASHED` 辞書が範囲カラムを主キーの一部として扱うように修正しました。[#44588](https://github.com/ClickHouse/ClickHouse/issues/44588) をクローズ。[#45061](https://github.com/ClickHouse/ClickHouse/pull/45061)（[Maksim Kita](https://github.com/kitaisreal)）。
* 入れ子のラムダでキャプチャされた `LowCardinality` 型の引数に対して発生するエラー `Cannot capture column` を修正。 [#45028](https://github.com/ClickHouse/ClickHouse/issues/45028) を解決。 [#45065](https://github.com/ClickHouse/ClickHouse/pull/45065)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* minmax/count projection が使用されている場合に、`additional_table_filters` で追加フィルタが適用されず、誤ったクエリ結果となっていた問題を修正しました。 [#45133](https://github.com/ClickHouse/ClickHouse/pull/45133) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* 負の値を受け入れていた `histogram` 関数の不具合を修正しました。 [#45147](https://github.com/ClickHouse/ClickHouse/pull/45147) ([simpleton](https://github.com/rgzntrade)).
* StoreageJoin における列の Null 許容属性の誤りを修正し、[#44940](https://github.com/ClickHouse/ClickHouse/issues/44940) をクローズしました。[#45184](https://github.com/ClickHouse/ClickHouse/pull/45184)（[Vladimir C](https://github.com/vdimir)）。
* `background_fetches_pool_size` 設定のリロード時に、実行時での増加が反映されない問題を修正。 [#45189](https://github.com/ClickHouse/ClickHouse/pull/45189) ([Raúl Marín](https://github.com/Algunenano))。
* KV エンジン（例: KeeperMap、EmbeddedRocksDB）上で、キーに対して `IN` を使用し、サブクエリが異なる型を返す場合の `SELECT` クエリを正しく処理します。 [#45215](https://github.com/ClickHouse/ClickHouse/pull/45215) ([Antonio Andelic](https://github.com/antonio2368)).
* いくつかのケースにおいて発生していた SEMI JOIN と join&#95;use&#95;nulls の論理エラーを修正し、[#45163](https://github.com/ClickHouse/ClickHouse/issues/45163) および [#45209](https://github.com/ClickHouse/ClickHouse/issues/45209) をクローズ。[#45230](https://github.com/ClickHouse/ClickHouse/pull/45230)（[Vladimir C](https://github.com/vdimir)）。
* S3 からの読み取り時に発生する heap-use-after-free を修正。 [#45253](https://github.com/ClickHouse/ClickHouse/pull/45253) ([Kruglov Pavel](https://github.com/Avogar)).
* Avro Union 型が [&#39;null&#39;, Nested 型] の場合のバグを修正し、[#45275](https://github.com/ClickHouse/ClickHouse/issues/45275) をクローズ。`bytes` 型を `Float` と誤って推論してしまうバグを修正。[#45276](https://github.com/ClickHouse/ClickHouse/pull/45276) ([flynn](https://github.com/ucasfl))。
* ストレージエンジン `Merge` を使用するテーブルで明示的な PREWHERE を使用できない場合に、適切な例外を送出するようにしました。 [#45319](https://github.com/ClickHouse/ClickHouse/pull/45319) ([Antonio Andelic](https://github.com/antonio2368)).
* WSL1 上の Ubuntu で、自己解凍型 ClickHouse が解凍に失敗する問題を修正。これは、/proc/self/maps が 32bit ファイルの inode を報告する一方で、stat が 64bit の inode を報告するという不整合が原因だった。 [#45339](https://github.com/ClickHouse/ClickHouse/pull/45339) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* Distributed テーブル起動時のレースコンディションを修正しました（非同期 `INSERT` のファイルが複数回処理されてしまう可能性がありました）。 [#45360](https://github.com/ClickHouse/ClickHouse/pull/45360) ([Azat Khuzhin](https://github.com/azat)).
* `ListObject` リクエストが失敗した場合に、ストレージ `S3` およびテーブル関数 `s3` からの読み取り時に発生し得たクラッシュを修正しました。 [#45371](https://github.com/ClickHouse/ClickHouse/pull/45371) ([Anton Popov](https://github.com/CurtizJ)).
* 不正な構造の辞書（例: XML 設定内の型の誤り）が存在する場合に発生していた `SELECT ... FROM system.dictionaries` の例外を修正。[#45399](https://github.com/ClickHouse/ClickHouse/pull/45399) ([Aleksei Filatov](https://github.com/aalexfvk)).
* `INSERT INTO ... SELECT * FROM s3Cluster` クエリで挿入先テーブルの構造が使用される場合の s3Cluster のスキーマ推論を修正。 [#45422](https://github.com/ClickHouse/ClickHouse/pull/45422) ([Kruglov Pavel](https://github.com/Avogar)).
* HTTP を使用した JSON/BSONEachRow のパースにおいて、一部のカラムでデータ中の値ではなくデフォルト値が使用される可能性があったバグを修正。 [#45424](https://github.com/ClickHouse/ClickHouse/pull/45424) ([Kruglov Pavel](https://github.com/Avogar)).
* テキストソースからの IP 型の型付きパースで発生していたバグ（コード: 632. DB::Exception: Unexpected data ... after parsed IPv6 value ...）を修正しました。 [#45425](https://github.com/ClickHouse/ClickHouse/pull/45425) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* [#45297](https://github.com/ClickHouse/ClickHouse/issues/45297) をクローズし、空の正規表現に対するチェックを追加。 [#45428](https://github.com/ClickHouse/ClickHouse/pull/45428) ([Han Fei](https://github.com/hanfei1991)).
* ハングしていた可能性のある（おそらく分散）クエリを修正。 [#45448](https://github.com/ClickHouse/ClickHouse/pull/45448) ([Azat Khuzhin](https://github.com/azat)).
* `allow_asynchronous_read_from_io_pool_for_merge_tree` が有効な場合に、`ThreadPool::schedule` からの例外により発生しうるデッドロックを修正しました。 [#45481](https://github.com/ClickHouse/ClickHouse/pull/45481) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
* DETACH 後に使用中になってしまう可能性があるテーブルの問題を修正。 [#45493](https://github.com/ClickHouse/ClickHouse/pull/45493) ([Azat Khuzhin](https://github.com/azat)).
* クエリがキャンセルされ、その実行中に並列パースが使用されていた場合にまれに発生するアボートを修正しました。 [#45498](https://github.com/ClickHouse/ClickHouse/pull/45498) ([Anton Popov](https://github.com/CurtizJ))。
* Distributed テーブルの作成とそのテーブルへの INSERT の間のレースコンディションを修正しました（テーブルへの INSERT 中に CANNOT&#95;LINK が発生する可能性がありました）。 [#45502](https://github.com/ClickHouse/ClickHouse/pull/45502) ([Azat Khuzhin](https://github.com/azat)).
* キャッシュポリシーのゲッターに適切なデフォルト値（SLRU）を追加。 [#45514](https://github.com/ClickHouse/ClickHouse/issues/45514) をクローズ。 [#45524](https://github.com/ClickHouse/ClickHouse/pull/45524)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* ミューテーションでの ARRAY JOIN を禁止します。closes [#42637](https://github.com/ClickHouse/ClickHouse/issues/42637) [#44447](https://github.com/ClickHouse/ClickHouse/pull/44447) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* エイリアス付きテーブル名およびカラムトランスフォーマーを伴う修飾付きアスタリスクに関する不具合を修正。[#44736](https://github.com/ClickHouse/ClickHouse/issues/44736) を解決。[#44755](https://github.com/ClickHouse/ClickHouse/pull/44755)（[SmitaRKulkarni](https://github.com/SmitaRKulkarni)）。





## [2022年の変更履歴](/whats-new/changelog/2022) {#changelog-for-2022}
