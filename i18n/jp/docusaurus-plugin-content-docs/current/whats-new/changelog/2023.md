---
slug: /whats-new/changelog/2023
sidebar_position: 4
sidebar_label: '2023'
title: '2023年の変更履歴'
description: '2023年の変更履歴'
keywords: ['ClickHouse 2023', '2023年 変更履歴', 'リリースノート', 'バージョン履歴', 'パフォーマンス改善']
doc_type: 'changelog'
---

### 目次 {#table-of-contents}
**[ClickHouse リリース v23.12, 2023-12-28](#2312)**<br/>
**[ClickHouse リリース v23.11, 2023-12-06](#2311)**<br/>
**[ClickHouse リリース v23.10, 2023-11-02](#2310)**<br/>
**[ClickHouse リリース v23.9, 2023-09-28](#239)**<br/>
**[ClickHouse リリース v23.8 LTS, 2023-08-31](#238)**<br/>
**[ClickHouse リリース v23.7, 2023-07-27](#237)**<br/>
**[ClickHouse リリース v23.6, 2023-06-30](#236)**<br/>
**[ClickHouse リリース v23.5, 2023-06-08](#235)**<br/>
**[ClickHouse リリース v23.4, 2023-04-26](#234)**<br/>
**[ClickHouse リリース v23.3 LTS, 2023-03-30](#233)**<br/>
**[ClickHouse リリース v23.2, 2023-02-23](#232)**<br/>
**[ClickHouse リリース v23.1, 2023-01-25](#231)**<br/>
**[2022年の変更履歴](/whats-new/changelog/2022/)**<br/>

### <a id="2312"></a> ClickHouse リリース 23.12, 2023-12-28 {#2312}

#### 後方互換性のない変更 {#backward-incompatible-change}
* TTL 式における非決定的関数のチェックを修正しました。以前は、場合によっては非決定的関数を含む TTL 式を作成でき、その後に未定義の動作を引き起こす可能性がありました。これにより [#37250](https://github.com/ClickHouse/ClickHouse/issues/37250) が修正されました。既定では、テーブルのどのカラムにも依存しない TTL 式は許可されません。`SET allow_suspicious_ttl_expressions = 1` または `SET compatibility = '23.11'` によって再度許可できます。[#37286](https://github.com/ClickHouse/ClickHouse/issues/37286) をクローズします。[#51858](https://github.com/ClickHouse/ClickHouse/pull/51858)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* MergeTree 設定 `clean_deleted_rows` は非推奨となり、もはや効果を持ちません。`OPTIMIZE` に対する `CLEANUP` キーワードは既定では許可されません（`allow_experimental_replacing_merge_with_cleanup` 設定によって有効化できます）。[#58267](https://github.com/ClickHouse/ClickHouse/pull/58267)（[Alexander Tokmakov](https://github.com/tavplubix)）。これにより [#57930](https://github.com/ClickHouse/ClickHouse/issues/57930) が修正され、[#54988](https://github.com/ClickHouse/ClickHouse/issues/54988)、[#54570](https://github.com/ClickHouse/ClickHouse/issues/54570)、[#50346](https://github.com/ClickHouse/ClickHouse/issues/50346)、[#47579](https://github.com/ClickHouse/ClickHouse/issues/47579) がクローズされます。この機能は望ましくないため削除する必要があります。他に選択肢がないため、可能な限り早急に削除しなければなりません。[#57932](https://github.com/ClickHouse/ClickHouse/pull/57932)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。

#### 新機能 {#new-feature}

* [#33919](https://github.com/ClickHouse/ClickHouse/issues/33919) で要望されていたリフレッシュ可能なマテリアライズドビューを実装しました。[#56946](https://github.com/ClickHouse/ClickHouse/pull/56946)（[Michael Kolupaev](https://github.com/al13n321)、[Michael Guzov](https://github.com/koloshmet)）。
* `PASTE JOIN` を導入しました。これにより、`ON` 句なしで行番号に基づいてテーブルを結合できるようになります。例: `SELECT * FROM (SELECT number AS a FROM numbers(2)) AS t1 PASTE JOIN (SELECT number AS a FROM numbers(2) ORDER BY a DESC) AS t2`。 [#57995](https://github.com/ClickHouse/ClickHouse/pull/57995) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* `ORDER BY` 句で `ALL` を指定できるようになりました。これは、ClickHouse が `SELECT` 句に含まれているすべての列を基準にソートすることを意味します。例: `SELECT col1, col2 FROM tab WHERE [...] ORDER BY ALL`。[#57875](https://github.com/ClickHouse/ClickHouse/pull/57875)（[zhongyuankai](https://github.com/zhongyuankai)）。
* 新しいミューテーションコマンド `ALTER TABLE <table> APPLY DELETED MASK` が追加されました。これにより、lightweight delete で書き込まれたマスクを強制的に適用し、削除済みとしてマークされた行をディスクから削除できるようになります。 [#57433](https://github.com/ClickHouse/ClickHouse/pull/57433) ([Anton Popov](https://github.com/CurtizJ))。
* ハンドラ `/binary` は、ClickHouse バイナリ内のシンボルを表示するビューアを開きます。 [#58211](https://github.com/ClickHouse/ClickHouse/pull/58211) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* Sqids（[https://sqids.org/](https://sqids.org/)）を生成するための新しい SQL 関数 `sqid` を追加しました。例：`SELECT sqid(125, 126)`。[#57512](https://github.com/ClickHouse/ClickHouse/pull/57512)（[Robert Schulze](https://github.com/rschu1ze)）。
* FFT を使用して時系列データの周期を検出する新しい関数 `seriesPeriodDetectFFT` を追加。[#57574](https://github.com/ClickHouse/ClickHouse/pull/57574)（[Bhavna Jindal](https://github.com/bhavnajindal)）。
* Keeper がトラフィックを受け入れ可能かを確認するための HTTP エンドポイントを追加。 [#55876](https://github.com/ClickHouse/ClickHouse/pull/55876) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* スキーマ推論に「union」モードを追加しました。このモードでは、生成されるテーブルスキーマはすべてのファイルスキーマの和集合となります（つまり、スキーマは各ファイルごとに推論されます）。スキーマ推論のモードは設定項目 `schema_inference_mode` によって制御され、取り得る値は `default` と `union` の2つです。[#55428](https://github.com/ClickHouse/ClickHouse/issues/55428) をクローズ。[#55892](https://github.com/ClickHouse/ClickHouse/pull/55892)（[Kruglov Pavel](https://github.com/Avogar)）。
* 新しい設定 `input_format_csv_try_infer_numbers_from_strings` を追加し、CSV 形式の文字列から数値を推論できるようにしました。 [#56455](https://github.com/ClickHouse/ClickHouse/issues/56455) をクローズしました。 [#56859](https://github.com/ClickHouse/ClickHouse/pull/56859)（[Kruglov Pavel](https://github.com/Avogar)）。
* データベースまたはテーブルの数が設定可能な閾値を超えた際に、ユーザーに警告を表示します。 [#57375](https://github.com/ClickHouse/ClickHouse/pull/57375) ([凌涛](https://github.com/lingtaolf)).
* `HASHED_ARRAY` レイアウト（および `COMPLEX_KEY_HASHED_ARRAY`）を持つ辞書は、`HASHED` と同様に `SHARDS` をサポートします。 [#57544](https://github.com/ClickHouse/ClickHouse/pull/57544) ([vdimir](https://github.com/vdimir))。
* メモリ内のプライマリキー総バイト数と、メモリに割り当てられたプライマリキー総バイト数の非同期メトリクスを追加。 [#57551](https://github.com/ClickHouse/ClickHouse/pull/57551) ([Bharat Nallan](https://github.com/bharatnc)).
* `SHA512_256` 関数を追加しました。 [#57645](https://github.com/ClickHouse/ClickHouse/pull/57645) ([Bharat Nallan](https://github.com/bharatnc))。
* `FORMAT_BYTES` を `formatReadableSize` のエイリアスとして追加しました。[#57592](https://github.com/ClickHouse/ClickHouse/pull/57592) ([Bharat Nallan](https://github.com/bharatnc))。
* `s3` テーブル関数にオプションのセッショントークンを渡せるようにしました。[#57850](https://github.com/ClickHouse/ClickHouse/pull/57850) ([Shani Elharrar](https://github.com/shanielh))。
* 新しい設定項目 `http_make_head_request` を導入しました。これをオフにすると、URL テーブルエンジンはファイルサイズを取得するための HEAD リクエストを行いません。これは、非効率的なものや設定ミスがあるもの、HEAD に対応していないものなどの HTTP サーバーをサポートするために必要です。 [#54602](https://github.com/ClickHouse/ClickHouse/pull/54602) ([Fionera](https://github.com/fionera))。
* インデックス（非主キー）定義内で ALIAS カラムを参照できるようになりました（issue [#55650](https://github.com/ClickHouse/ClickHouse/issues/55650)）。例：`CREATE TABLE tab(col UInt32, col_alias ALIAS col + 1, INDEX idx (col_alias) TYPE minmax) ENGINE = MergeTree ORDER BY col;`。[#57546](https://github.com/ClickHouse/ClickHouse/pull/57546)（[Robert Schulze](https://github.com/rschu1ze)）。
* 新しい設定項目 `readonly` を追加しました。この設定により、S3 ディスクを読み取り専用として指定できます。基盤となる S3 バケットへのアクセス権が読み取り専用であっても、`s3_plain` タイプのディスク上にテーブルを作成する場合に有用です。 [#57977](https://github.com/ClickHouse/ClickHouse/pull/57977) ([Pengyuan Bian](https://github.com/bianpengyuan)).
* MergeTree テーブルにおけるプライマリキー解析が、仮想カラム `_part_offset`（必要に応じて `_part` も含む）を含む述語にも適用されるようになりました。この機能は、一種のセカンダリインデックスとして利用できます。 [#58224](https://github.com/ClickHouse/ClickHouse/pull/58224) ([Amos Bird](https://github.com/amosbird))。



#### パフォーマンスの向上 {#performance-improvement}

* FINAL 処理中に、MergeTree テーブルから互いに重ならないパーツの範囲を抽出します。これにより、これらの重ならないパーツ範囲に対しては、追加の FINAL ロジックを適用せずに済みます。同一の主キーを持つ重複値の数が少ない場合、パフォーマンスは FINAL を指定しない場合とほぼ同じになります。`do_not_merge_across_partitions_select_final` 設定が有効な場合に、MergeTree の FINAL 実行時の読み取りパフォーマンスを改善しました。 [#58120](https://github.com/ClickHouse/ClickHouse/pull/58120) ([Maksim Kita](https://github.com/kitaisreal)).
* バッファ経由でコピーする代わりに、S3 のサーバーサイドコピー機能を使用して S3 ディスク間でコピーを行うようにしました。これにより、`BACKUP/RESTORE` 操作および `clickhouse-disks copy` コマンドの効率が向上します。 [#56744](https://github.com/ClickHouse/ClickHouse/pull/56744) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* Hash JOIN は設定値 `max_joined_block_size_rows` を尊重し、`ALL JOIN` に対して大きなブロックを生成しないようになりました。 [#56996](https://github.com/ClickHouse/ClickHouse/pull/56996) ([vdimir](https://github.com/vdimir)).
* 集約で使用するメモリの解放を、より早い段階で行うようにしました。これにより、不要な外部集約を回避できる場合があります。 [#57691](https://github.com/ClickHouse/ClickHouse/pull/57691) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* 文字列シリアライズの性能を改善。 [#57717](https://github.com/ClickHouse/ClickHouse/pull/57717) ([Maksim Kita](https://github.com/kitaisreal)).
* `Merge` エンジンのテーブルで、単純な count クエリの最適化をサポートしました。 [#57867](https://github.com/ClickHouse/ClickHouse/pull/57867) ([skyoct](https://github.com/skyoct)).
* 一部のケースで集約処理を最適化しました。 [#57872](https://github.com/ClickHouse/ClickHouse/pull/57872) ([Anton Popov](https://github.com/CurtizJ)).
* `hasAny` 関数でフルテキストスキップインデックスを利用できるようになりました。[#57878](https://github.com/ClickHouse/ClickHouse/pull/57878) ([Jpnock](https://github.com/Jpnock))。
* 関数 `if(cond, then, else)`（およびそのエイリアス `cond ? then : else`）は、分岐を行わずに評価するよう最適化されました。 [#57885](https://github.com/ClickHouse/ClickHouse/pull/57885) ([zhanglistar](https://github.com/zhanglistar))。
* MergeTree は、パーティションキー式がプライマリキー式に含まれる列のみで構成されている場合、`do_not_merge_across_partitions_select_final` の設定を自動的に決定します。 [#58218](https://github.com/ClickHouse/ClickHouse/pull/58218) ([Maksim Kita](https://github.com/kitaisreal))。
* ネイティブ型の `MIN` および `MAX` を高速化。 [#58231](https://github.com/ClickHouse/ClickHouse/pull/58231) ([Raúl Marín](https://github.com/Algunenano)).
* ファイルシステムキャッシュ用に `SLRU` キャッシュポリシーを実装しました。 [#57076](https://github.com/ClickHouse/ClickHouse/pull/57076) ([Kseniia Sumarokova](https://github.com/kssenii)).
* バックグラウンドフェッチにおけるエンドポイントごとの接続数の上限が、`15` から `background_fetches_pool_size` 設定値に引き上げられました。- MergeTree レベルの設定 `replicated_max_parallel_fetches_for_host` は廃止されました。- MergeTree レベルの設定 `replicated_fetches_http_connection_timeout`、`replicated_fetches_http_send_timeout` および `replicated_fetches_http_receive_timeout` は Server レベルに移動しました。- 設定 `keep_alive_timeout` が Server レベル設定の一覧に追加されました。[#57523](https://github.com/ClickHouse/ClickHouse/pull/57523) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
* `system.filesystem_cache` へのクエリが大量のメモリを消費しないようにしました。 [#57687](https://github.com/ClickHouse/ClickHouse/pull/57687) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 文字列のデシリアライズ時のメモリ使用量を削減。 [#57787](https://github.com/ClickHouse/ClickHouse/pull/57787) ([Maksim Kita](https://github.com/kitaisreal)).
* Enum 向けのより効率的なコンストラクタ — とくに Enum に多数の値がある場合に有用です。 [#57887](https://github.com/ClickHouse/ClickHouse/pull/57887) ([Duc Canh Le](https://github.com/canhld94)).
* ファイルシステムキャッシュからの読み取り処理を改善し、常に `pread` メソッドを使用するようにしました。 [#57970](https://github.com/ClickHouse/ClickHouse/pull/57970) ([Nikita Taranov](https://github.com/nickitat)).
* 論理式オプティマイザで `AND notEquals` チェーン向けの最適化を追加しました。この最適化は、実験的な Analyzer が有効になっている場合にのみ利用できます。 [#58214](https://github.com/ClickHouse/ClickHouse/pull/58214) ([Kevin Mingtarja](https://github.com/kevinmingtarja))。



#### 改善 {#improvement}

* Keeper におけるソフトメモリ上限のサポート。メモリ使用量が上限に近づいた場合、リクエストを拒否します。 [#57271](https://github.com/ClickHouse/ClickHouse/pull/57271) ([Han Fei](https://github.com/hanfei1991)). [#57699](https://github.com/ClickHouse/ClickHouse/pull/57699) ([Han Fei](https://github.com/hanfei1991)).
* 分散テーブルへの挿入が、更新されたクラスタ設定を正しく反映できるようにしました。クラスタノードの一覧が動的に更新された場合、分散テーブルの Directory Monitor がそれを検知して一覧を更新します。 [#42826](https://github.com/ClickHouse/ClickHouse/pull/42826) ([zhongyuankai](https://github.com/zhongyuankai)).
* 不整合なマージパラメータを持つレプリケートテーブルを作成できないようにしました。 [#56833](https://github.com/ClickHouse/ClickHouse/pull/56833) ([Duc Canh Le](https://github.com/canhld94))。
* `system.tables` に非圧縮サイズを表示できるようになりました。 [#56618](https://github.com/ClickHouse/ClickHouse/issues/56618)。 [#57186](https://github.com/ClickHouse/ClickHouse/pull/57186) ([Chen Lixiang](https://github.com/chenlx0))。
* `Distributed` テーブルに、対応するクエリレベルの設定と同様の設定である `skip_unavailable_shards` を追加しました。[#43666](https://github.com/ClickHouse/ClickHouse/issues/43666) をクローズしました。 [#57218](https://github.com/ClickHouse/ClickHouse/pull/57218)（[Gagan Goel](https://github.com/tntnatbry)）。
* 関数 `substring`（エイリアス: `substr`, `mid`）が `Enum` 型でも使用できるようになりました。これまでは、最初の関数引数は `String` または `FixedString` 型の値である必要がありました。これにより、MySQL インターフェース経由での Tableau などのサードパーティツールとの互換性が向上します。[#57277](https://github.com/ClickHouse/ClickHouse/pull/57277)（[Serge Klochkov](https://github.com/slvrtrn)）。
* `format` 関数が、（従来の `String` と `FixedString` のみではなく）任意の引数型をサポートするようになりました。これにより、`SELECT format('The {0} to all questions is {1}', 'answer', 42)` を評価できます。 [#57549](https://github.com/ClickHouse/ClickHouse/pull/57549) ([Robert Schulze](https://github.com/rschu1ze)).
* `date_trunc` 関数の第1引数を大文字小文字を区別せずに扱えるようになりました。`SELECT date_trunc('day', now())` と `SELECT date_trunc('DAY', now())` の両方がサポートされるようになりました。 [#57624](https://github.com/ClickHouse/ClickHouse/pull/57624) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* テーブルが存在しない場合に表示されるヒントを改善。 [#57342](https://github.com/ClickHouse/ClickHouse/pull/57342) ([Bharat Nallan](https://github.com/bharatnc)).
* クエリ時に `max_partition_size_to_drop` および `max_table_size_to_drop` のサーバー設定を上書きできるようにしました。 [#57452](https://github.com/ClickHouse/ClickHouse/pull/57452) ([Jordi Villar](https://github.com/jrdi)).
* JSON フォーマットにおける無名タプルの推論をわずかに改善。 [#57751](https://github.com/ClickHouse/ClickHouse/pull/57751) ([Kruglov Pavel](https://github.com/Avogar)).
* Keeper への接続時に read-only フラグをサポートしました（[#53749](https://github.com/ClickHouse/ClickHouse/issues/53749) を修正）。[#57479](https://github.com/ClickHouse/ClickHouse/pull/57479)（[Mikhail Koviazin](https://github.com/mkmkme)）。
* ディスクからバッチをリカバリ中に発生する「No such file or directory」によって分散送信がスタックしてしまう可能性がある問題を修正しました。`distributed_directory_monitor_max_sleep_time_ms` が 5 分を超える場合に、`system.distribution_queue` の `error_count` に関連して発生しうる問題を修正しました。非同期 INSERT の失敗を追跡するためのプロファイルイベント `DistributedAsyncInsertionFailures` を導入しました。 [#57480](https://github.com/ClickHouse/ClickHouse/pull/57480) ([Azat Khuzhin](https://github.com/azat)).
* `MaterializedPostgreSQL`（実験的機能）で PostgreSQL の生成列およびデフォルト列値をサポートします。[#40449](https://github.com/ClickHouse/ClickHouse/issues/40449) をクローズ。[#57568](https://github.com/ClickHouse/ClickHouse/pull/57568)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* サーバーの再起動なしに一部のファイルシステムキャッシュ設定の変更を適用できるようにしました。 [#57578](https://github.com/ClickHouse/ClickHouse/pull/57578) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 空配列を含む PostgreSQL のテーブル構造を正しく処理。 [#57618](https://github.com/ClickHouse/ClickHouse/pull/57618) ([Mike Kot](https://github.com/myrrc)).
* 最後のサーバー再起動以降に発生したエラーの総数を、`ClickHouseErrorMetric_ALL` メトリクスとして公開するようにしました。[#57627](https://github.com/ClickHouse/ClickHouse/pull/57627) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
* `from_env`/`from_zk` 参照を持ち、かつ `replace=1` が指定された非空要素を含む設定ファイル内のノードを許可できるようにしました。 [#57628](https://github.com/ClickHouse/ClickHouse/pull/57628) ([Azat Khuzhin](https://github.com/azat)).
* 大量の不正な形式の JSON をファジング用に生成できるテーブル関数 `fuzzJSON`。 [#57646](https://github.com/ClickHouse/ClickHouse/pull/57646) ([Julia Kartseva](https://github.com/jkartseva))。
* IPv6 から UInt128 への変換とバイナリ算術演算を可能にしました。 [#57707](https://github.com/ClickHouse/ClickHouse/pull/57707) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* `async inserts deduplication cache` に対して、キャッシュの更新をどれくらいの時間待機するかを指定する設定を追加しました。設定項目 `async_block_ids_cache_min_update_interval_ms` は非推奨になりました。現在は、競合が発生した場合にのみキャッシュが更新されます。[#57743](https://github.com/ClickHouse/ClickHouse/pull/57743)（[alesapin](https://github.com/alesapin)）。
* `sleep()` 関数は、`KILL QUERY` によってキャンセルできるようになりました。 [#57746](https://github.com/ClickHouse/ClickHouse/pull/57746) ([Vitaly Baranov](https://github.com/vitlibar))。
* 実験的な `Replicated` データベースではサポートされていないため、`Replicated` テーブルエンジンに対する `CREATE TABLE ... AS SELECT` クエリを禁止しました。[#35408](https://github.com/ClickHouse/ClickHouse/issues/35408) を参照してください。[#57796](https://github.com/ClickHouse/ClickHouse/pull/57796)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 外部データベース向けのクエリ変換を修正・改善し、互換性のある述語を再帰的にすべて取得できるようにしました。 [#57888](https://github.com/ClickHouse/ClickHouse/pull/57888) ([flynn](https://github.com/ucasfl)).
* ファイルシステムキャッシュサイズの動的な再読み込みに対応。[#57866](https://github.com/ClickHouse/ClickHouse/issues/57866) をクローズ。[#57897](https://github.com/ClickHouse/ClickHouse/pull/57897) ([Kseniia Sumarokova](https://github.com/kssenii)).
* ブロックされている SIGRTMIN を持つスレッド（Apache rdkafka のような低品質な外部ライブラリ内に存在することがあります）に対して `system.stack_trace` を正しくサポートしました。 [#57907](https://github.com/ClickHouse/ClickHouse/pull/57907) ([Azat Khuzhin](https://github.com/azat))。また、意味のない `storage_system_stack_trace_pipe_read_timeout_ms` の待機が発生しないよう、シグナルがブロックされていないスレッドに対してのみシグナルを送信するようにしました。 [#58136](https://github.com/ClickHouse/ClickHouse/pull/58136) ([Azat Khuzhin](https://github.com/azat))。
* クォーラム挿入時のチェックで Keeper の障害を許容するようにしました。 [#57986](https://github.com/ClickHouse/ClickHouse/pull/57986) ([Raúl Marín](https://github.com/Algunenano)).
* max/peak RSS（`MemoryResidentMax`）を system.asynchronous&#95;metrics に追加しました。 [#58095](https://github.com/ClickHouse/ClickHouse/pull/58095) ([Azat Khuzhin](https://github.com/azat)).
* このPRにより、ユーザーはデフォルト以外のリージョンであってもリージョンを明示せずに、`https://` や `s3://` といった S3 スタイルのリンクを使用できるようになります。また、ユーザーが誤ったリージョンを指定した場合でも、正しいリージョンが自動的に特定されます。 [#58148](https://github.com/ClickHouse/ClickHouse/pull/58148) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* `clickhouse-format --obfuscate` は Settings、MergeTreeSettings、およびタイムゾーンを認識し、それらの名前を変更せず、そのまま保持します。 [#58179](https://github.com/ClickHouse/ClickHouse/pull/58179) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* `ZipArchiveWriter` に明示的な `finalize()` 関数を追加しました。`ZipArchiveWriter` 内の複雑すぎるコードを簡素化しました。これにより [#58074](https://github.com/ClickHouse/ClickHouse/issues/58074) が修正されました。[#58202](https://github.com/ClickHouse/ClickHouse/pull/58202)（[Vitaly Baranov](https://github.com/vitlibar)）。
* 同じパスを持つキャッシュが同じキャッシュオブジェクトを使用するようにしました。この動作はもともと存在していましたが、23.4 で壊れていました。同じパスを持つキャッシュでキャッシュ設定の組み合わせが異なる場合は、許可されていないことを示す例外がスローされます。 [#58264](https://github.com/ClickHouse/ClickHouse/pull/58264) ([Kseniia Sumarokova](https://github.com/kssenii))。
* Parallel replicas（実験的機能）：ユーザーフレンドリーな設定 [#57542](https://github.com/ClickHouse/ClickHouse/pull/57542) ([Igor Nikonov](https://github.com/devcrafter)).
* 並列レプリカ（実験的機能）：アナウンス応答の処理を改善 [#57749](https://github.com/ClickHouse/ClickHouse/pull/57749)（[Igor Nikonov](https://github.com/devcrafter)）。
* Parallel replicas（実験的機能）：`ParallelReplicasReadingCoordinator` において `min_number_of_marks` をより厳密に考慮するようにしました [#57763](https://github.com/ClickHouse/ClickHouse/pull/57763)（[Nikita Taranov](https://github.com/nickitat)）。
* Parallel replicas（実験的機能）：IN 句（サブクエリ）使用時の並列レプリカを無効化 [#58133](https://github.com/ClickHouse/ClickHouse/pull/58133) ([Igor Nikonov](https://github.com/devcrafter)).
* 並列レプリカ（実験的機能）：プロファイルイベント &#39;ParallelReplicasUsedCount&#39; を追加 [#58173](https://github.com/ClickHouse/ClickHouse/pull/58173) ([Igor Nikonov](https://github.com/devcrafter))。
* HEAD などの POST 以外のリクエストは、GET と同様に読み取り専用になります。 [#58060](https://github.com/ClickHouse/ClickHouse/pull/58060) ([San](https://github.com/santrancisco)).
* `system.part_log` に `bytes_uncompressed` カラムを追加 [#58167](https://github.com/ClickHouse/ClickHouse/pull/58167) ([Jordi Villar](https://github.com/jrdi)).
* `system.backups` および `system.backup_log` テーブルにベースバックアップ名を追加 [#58178](https://github.com/ClickHouse/ClickHouse/pull/58178) ([Pradeep Chhetri](https://github.com/chhetripradeep))。
* clickhouse-local に、コマンドラインからクエリパラメータを指定するためのサポートを追加 [#58210](https://github.com/ClickHouse/ClickHouse/pull/58210) ([Pradeep Chhetri](https://github.com/chhetripradeep))。

#### ビルド／テスト／パッケージングの改善 {#buildtestingpackaging-improvement}
* さらに多くの設定をランダム化。 [#39663](https://github.com/ClickHouse/ClickHouse/pull/39663) ([Anton Popov](https://github.com/CurtizJ)).
* CI で無効化する最適化をランダム化。 [#57315](https://github.com/ClickHouse/ClickHouse/pull/57315) ([Raúl Marín](https://github.com/Algunenano)).
* macOS 上で Azure 関連のテーブルエンジン／関数を利用できるようにした。 [#51866](https://github.com/ClickHouse/ClickHouse/pull/51866) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* ClickHouse Fast Test が GLibc の代わりに Musl を使用するようになった。 [#57711](https://github.com/ClickHouse/ClickHouse/pull/57711) ([Alexey Milovidov](https://github.com/alexey-milovidov)). 完全に静的な Musl ビルドは CI からダウンロード可能。
* すべてのコミットで ClickBench を実行するようにした。これにより [#57708](https://github.com/ClickHouse/ClickHouse/issues/57708) がクローズされた。 [#57712](https://github.com/ClickHouse/ClickHouse/pull/57712) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 外部ライブラリから、有害な C/POSIX の `select` 関数の使用を削除。 [#57467](https://github.com/ClickHouse/ClickHouse/pull/57467) ([Igor Nikonov](https://github.com/devcrafter)).
* ClickHouse Cloud のみで利用可能だった設定を、利便性のためオープンソース版 ClickHouse ビルドにも含めるようにした。 [#57638](https://github.com/ClickHouse/ClickHouse/pull/57638) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).

#### バグ修正（公式の安定版リリースにおけるユーザーに影響する不具合） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release}

* TTL GROUP BY においてソート順が乱れる可能性のあった問題を修正しました [#49103](https://github.com/ClickHouse/ClickHouse/pull/49103) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* 修正: `lttb` バケット戦略を修正し、最初と最後のバケットには単一のデータポイントのみを含めるようにした [#57003](https://github.com/ClickHouse/ClickHouse/pull/57003) ([FFish](https://github.com/wxybear))。
* エラー後の同期処理中に `Template` フォーマットで発生し得るデッドロックを修正 [#57004](https://github.com/ClickHouse/ClickHouse/pull/57004) ([Kruglov Pavel](https://github.com/Avogar)).
* 多数のエラーをスキップしながらファイルをパースする際に発生していた早期終了の問題を修正 [#57006](https://github.com/ClickHouse/ClickHouse/pull/57006) ([Kruglov Pavel](https://github.com/Avogar)).
* `dictionary` テーブル関数を経由した辞書 ACL のバイパスを防止しました [#57362](https://github.com/ClickHouse/ClickHouse/pull/57362)（[Salvatore Mesoraca](https://github.com/aiven-sal)）。
* Fuzzer によって検出された「non-ready set」エラーの別のケースを修正しました。 [#57423](https://github.com/ClickHouse/ClickHouse/pull/57423) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* PostgreSQL の `array_ndims` の使用に関するいくつかの問題を修正。 [#57436](https://github.com/ClickHouse/ClickHouse/pull/57436) ([Ryan Jacobs](https://github.com/ryanmjacobs)).
* 書き込みロックのタイムアウト後に発生する RWLock の不整合状態を修正 [#57454](https://github.com/ClickHouse/ClickHouse/pull/57454) ([Vitaly Baranov](https://github.com/vitlibar))。書き込みロックのタイムアウト後に発生する RWLock の不整合状態を再度修正 [#57733](https://github.com/ClickHouse/ClickHouse/pull/57733) ([Vitaly Baranov](https://github.com/vitlibar))。
* 修正: ビューチェーンへの push 処理を構築する際に ephemeral カラムを除外しないように修正 [#57461](https://github.com/ClickHouse/ClickHouse/pull/57461) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* MaterializedPostgreSQL（実験的）: issue [#41922](https://github.com/ClickHouse/ClickHouse/issues/41922) を修正し、[#41923](https://github.com/ClickHouse/ClickHouse/issues/41923) に対するテストを追加 [#57515](https://github.com/ClickHouse/ClickHouse/pull/57515) ([Kseniia Sumarokova](https://github.com/kssenii))。
* レプリケートされたアクセスエンティティの管理時には、grant/revoke クエリの ON CLUSTER 句を無視するようにしました。  [#57538](https://github.com/ClickHouse/ClickHouse/pull/57538) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* clickhouse-local のクラッシュを修正 [#57553](https://github.com/ClickHouse/ClickHouse/pull/57553) ([Nikolay Degterinsky](https://github.com/evillique))。
* Hash JOIN の不具合修正。 [#57564](https://github.com/ClickHouse/ClickHouse/pull/57564) ([vdimir](https://github.com/vdimir)).
* PostgreSQL ソースの潜在的な誤りを修正 [#57567](https://github.com/ClickHouse/ClickHouse/pull/57567) ([Kseniia Sumarokova](https://github.com/kssenii)).
* ネストされた LowCardinality に対する Hash JOIN の型の補正を修正。 [#57614](https://github.com/ClickHouse/ClickHouse/pull/57614) ([vdimir](https://github.com/vdimir)).
* `system.stack_trace` からの並列読み取りを正しく禁止し、ハングを回避するようにしました。 [#57641](https://github.com/ClickHouse/ClickHouse/pull/57641) ([Azat Khuzhin](https://github.com/azat)).
* `sparse` カラムの `any(...) RESPECT NULL` 集約で発生していたエラーを修正しました [#57710](https://github.com/ClickHouse/ClickHouse/pull/57710) ([Azat Khuzhin](https://github.com/azat))。
* 単項演算子の構文解析を修正 [#57713](https://github.com/ClickHouse/ClickHouse/pull/57713) ([Nikolay Degterinsky](https://github.com/evillique)).
* 実験的テーブルエンジン `MaterializedPostgreSQL` の依存関係の読み込み処理を修正しました。 [#57754](https://github.com/ClickHouse/ClickHouse/pull/57754) ([Kseniia Sumarokova](https://github.com/kssenii))。
* BACKUP/RESTORE ON CLUSTER 実行時に切断されたノードに対するリトライ処理を修正しました [#57764](https://github.com/ClickHouse/ClickHouse/pull/57764) ([Vitaly Baranov](https://github.com/vitlibar))。
* 部分的にマテリアライズされたプロジェクションがある場合の外部集約の結果を修正 [#57790](https://github.com/ClickHouse/ClickHouse/pull/57790) ([Anton Popov](https://github.com/CurtizJ)).
* `*Map` コンビネーター付き集約関数のマージ処理を修正 [#57795](https://github.com/ClickHouse/ClickHouse/pull/57795) ([Anton Popov](https://github.com/CurtizJ)).
* バグがあるため、`system.kafka_consumers` を無効化しました。[#57822](https://github.com/ClickHouse/ClickHouse/pull/57822)（[Azat Khuzhin](https://github.com/azat)）。
* Merge JOIN における LowCardinality キーのサポートを修正。 [#57827](https://github.com/ClickHouse/ClickHouse/pull/57827) ([vdimir](https://github.com/vdimir)).
* サンプルブロックに関連する `InterpreterCreateQuery` の修正。[#57855](https://github.com/ClickHouse/ClickHouse/pull/57855)（[Maksim Kita](https://github.com/kitaisreal)）。
* PostgreSQL 由来の名前付きコレクションで `addresses_expr` が無視されていました。[#57874](https://github.com/ClickHouse/ClickHouse/pull/57874) ([joelynch](https://github.com/joelynch)).
* BLAKE3（Rust 実装）での不正なメモリアクセスを修正しました [#57876](https://github.com/ClickHouse/ClickHouse/pull/57876)（[Raúl Marín](https://github.com/Algunenano)）。その後、[メモリ安全性](https://www.memorysafety.org/)を高めるために Rust から C++ へ書き換えられました [#57994](https://github.com/ClickHouse/ClickHouse/pull/57994)（[Raúl Marín](https://github.com/Algunenano)）。
* `CREATE INDEX` で使用する関数名を正規化 [#57906](https://github.com/ClickHouse/ClickHouse/pull/57906) ([Alexander Tokmakov](https://github.com/tavplubix)).
* 最初のリクエストが発生する前に利用不能になっているレプリカの扱いを修正 [#57933](https://github.com/ClickHouse/ClickHouse/pull/57933) ([Nikita Taranov](https://github.com/nickitat))。
* リテラルエイリアスの誤った分類を修正 [#57988](https://github.com/ClickHouse/ClickHouse/pull/57988) ([Chen768959](https://github.com/Chen768959))。
* Keeper における無効な前処理を修正 [#58069](https://github.com/ClickHouse/ClickHouse/pull/58069) ([Antonio Andelic](https://github.com/antonio2368))。
* `Poco` ライブラリの `UTF32Encoding` に関連する整数オーバーフローを修正 [#58073](https://github.com/ClickHouse/ClickHouse/pull/58073) ([Andrey Fedotov](https://github.com/anfedotoff))。
* 非常に大きな整数値を含むスカラサブクエリが存在する場合に parallel replicas（実験的機能）で発生していた問題を修正 [#58118](https://github.com/ClickHouse/ClickHouse/pull/58118)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 範囲外の `DateTime` に対する `accurateCastOrNull` の動作を修正 [#58139](https://github.com/ClickHouse/ClickHouse/pull/58139) ([Andrey Zvonov](https://github.com/zvonand)).
* MergeTree の wide part からサブカラムを読み取る際に発生する可能性のある `PARAMETER_OUT_OF_BOUND` エラーを修正 [#58175](https://github.com/ClickHouse/ClickHouse/pull/58175) ([Kruglov Pavel](https://github.com/Avogar))。
* 膨大な数のサブクエリを含む CREATE VIEW の実行が遅くなる問題を修正 [#58220](https://github.com/ClickHouse/ClickHouse/pull/58220) ([Tao Wang](https://github.com/wangtZJU)).
* JSONCompactEachRow の並列解析を修正 [#58181](https://github.com/ClickHouse/ClickHouse/pull/58181) ([Alexey Milovidov](https://github.com/alexey-milovidov)). [#58250](https://github.com/ClickHouse/ClickHouse/pull/58250) ([Kruglov Pavel](https://github.com/Avogar)).

### <a id="2311"></a> ClickHouse リリース 23.11, 2023-12-06 {#2311}

#### 後方互換性のない変更 {#backward-incompatible-change-1}
* デフォルトの ClickHouse サーバー設定ファイルでは、`default` ユーザーに対して `access_management`（SQL クエリによるユーザー管理）および `named_collection_control`（SQL クエリによる `named collection` の操作）が標準で有効になりました。これにより [#56482](https://github.com/ClickHouse/ClickHouse/issues/56482) がクローズされました。[#56619](https://github.com/ClickHouse/ClickHouse/pull/56619)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* ウィンドウ関数に対する `RESPECT NULLS`/`IGNORE NULLS` について、複数の改善を行いました。これらを集約関数として使用し、これらの修飾子付き集約関数の状態を保存している場合、それらが互換性がなくなる可能性があります。[#57189](https://github.com/ClickHouse/ClickHouse/pull/57189)（[Raúl Marín](https://github.com/Algunenano)）。
* 最適化 `optimize_move_functions_out_of_any` を削除しました。[#57190](https://github.com/ClickHouse/ClickHouse/pull/57190)（[Raúl Marín](https://github.com/Algunenano)）。
* 関数 `parseDateTime` のフォーマッタ `%l`/`%k`/`%c` は、先頭にゼロのない時/月をパースできるようになりました。例えば `select parseDateTime('2023-11-26 8:14', '%F %k:%i')` が動作するようになりました。以前の 2 桁を必須としていた挙動を復元するには、`parsedatetime_parse_without_leading_zeros = 0` を設定してください。関数 `formatDateTime` も、先頭にゼロのない時/月を出力できるようになりました。これは `formatdatetime_format_without_leading_zeros` の設定で制御されますが、既存のユースケースを壊さないようデフォルトでは無効になっています。[#55872](https://github.com/ClickHouse/ClickHouse/pull/55872)（[Azat Khuzhin](https://github.com/azat)）。
* 集約関数 `avgWeighted` を `Decimal` 型の引数とともに使用することはできなくなりました。回避策: 引数を `Float64` に変換してください。これにより [#43928](https://github.com/ClickHouse/ClickHouse/issues/43928) がクローズされました。これにより [#31768](https://github.com/ClickHouse/ClickHouse/issues/31768) がクローズされました。これにより [#56435](https://github.com/ClickHouse/ClickHouse/issues/56435) がクローズされました。`Decimal` 引数を用いたマテリアライズドビューまたはプロジェクション内でこの関数を使用している場合は、support@clickhouse.com までお問い合わせください。集約関数 `sumMap` のエラーを修正し、その結果としておおよそ 1.5～2 倍ほど遅くなりました。ただし、この関数自体が元々あまり有用ではないため問題にはなりません。これにより [#54955](https://github.com/ClickHouse/ClickHouse/issues/54955) がクローズされました。これにより [#53134](https://github.com/ClickHouse/ClickHouse/issues/53134) がクローズされました。これにより [#55148](https://github.com/ClickHouse/ClickHouse/issues/55148) がクローズされました。関数 `groupArraySample` のバグを修正しました。この関数は、1 つのクエリで複数の集約状態が生成される場合に、同じ乱数シードを使用していました。[#56350](https://github.com/ClickHouse/ClickHouse/pull/56350)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。

#### 新機能 {#new-feature-1}

* データベースとテーブルを非同期にロードするためのサーバー設定 `async_load_databases` を追加しました。サーバーの起動時間を短縮します。`Ordinary`、`Atomic`、`Replicated` エンジンを使用するデータベースに適用されます。これらのデータベースのテーブルはメタデータを非同期にロードします。テーブルへのクエリが実行されると、そのテーブルのロードジョブの優先度が上がり、完了まで待機します。内部状態の調査用として、新しいテーブル `system.asynchronous_loader` を追加しました。 [#49351](https://github.com/ClickHouse/ClickHouse/pull/49351)（[Sergei Trifonov](https://github.com/serxa)）。
* システムテーブル `blob_storage_log` を追加しました。これにより、S3 およびその他のオブジェクトストレージに書き込まれたすべてのデータを監査できるようになります。 [#52918](https://github.com/ClickHouse/ClickHouse/pull/52918) ([vdimir](https://github.com/vdimir))。
* 統計情報を利用して `PREWHERE` 条件の並び順をより適切に決定するようにしました。 [#53240](https://github.com/ClickHouse/ClickHouse/pull/53240) ([Han Fei](https://github.com/hanfei1991)).
* Keeper プロトコルで圧縮がサポートされるようになりました。ClickHouse 側では、`zookeeper` セクション内でフラグ `use_compression` を設定することで有効化できます。なお、圧縮をサポートしているのは ClickHouse Keeper のみであり、Apache ZooKeeper は圧縮をサポートしていないことに注意してください。 [#49507](https://github.com/ClickHouse/ClickHouse/issues/49507) を解決しました。 [#54957](https://github.com/ClickHouse/ClickHouse/pull/54957)（[SmitaRKulkarni](https://github.com/SmitaRKulkarni)）。
* `storage_metadata_write_full_object_key` 機能を導入しました。これを `true` に設定すると、メタデータファイルは新しい形式で書き込まれます。この形式では、ClickHouse はメタデータファイル内にリモートオブジェクトキー全体を保存し、柔軟性と最適化の向上を可能にします。[#55566](https://github.com/ClickHouse/ClickHouse/pull/55566) ([Sema Checherinda](https://github.com/CheSema))。
* 名前付きコレクションのフィールドが上書きされるのを防ぐための新しい設定と構文を追加しました。これは、悪意のあるユーザーがシークレットへ不正アクセスを行うことを防ぐことを目的としています。 [#55782](https://github.com/ClickHouse/ClickHouse/pull/55782) ([Salvatore Mesoraca](https://github.com/aiven-sal)).
* すべてのシステムログテーブルに `hostname` カラムを追加しました。これは、システムテーブルをレプリケート、共有、または分散構成にする場合に便利です。 [#55894](https://github.com/ClickHouse/ClickHouse/pull/55894) ([Bharat Nallan](https://github.com/bharatnc)).
* `CHECK ALL TABLES` クエリを追加しました。 [#56022](https://github.com/ClickHouse/ClickHouse/pull/56022) ([vdimir](https://github.com/vdimir))。
* MySQL の `FROM_DAYS` に類似する関数 `fromDaysSinceYearZero` を追加しました。例えば `SELECT fromDaysSinceYearZero(739136)` は `2023-09-08` を返します。 [#56088](https://github.com/ClickHouse/ClickHouse/pull/56088) ([Joanna Hulboj](https://github.com/jh0x))。
* ClickHouse を使用せずにバックアップを閲覧し、そこから情報を抽出するための外部の Python ツールを追加しました。 [#56268](https://github.com/ClickHouse/ClickHouse/pull/56268) ([Vitaly Baranov](https://github.com/vitlibar))。
* `preferred_optimize_projection_name` という新しい設定を実装しました。空でない文字列が設定されている場合、可能であれば、すべての候補から選択するのではなく、その指定されたプロジェクションが使用されます。 [#56309](https://github.com/ClickHouse/ClickHouse/pull/56309) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* リーダー権限の譲渡/辞任を行う4文字のコマンドを追加（[https://github.com/ClickHouse/ClickHouse/issues/56352](https://github.com/ClickHouse/ClickHouse/issues/56352)）。[#56354](https://github.com/ClickHouse/ClickHouse/pull/56354)（[Pradeep Chhetri](https://github.com/chhetripradeep)）。[#56620](https://github.com/ClickHouse/ClickHouse/pull/56620)（[Pradeep Chhetri](https://github.com/chhetripradeep)）。
* 新しい SQL 関数 `arrayRandomSample(arr, k)` を追加しました。これは入力配列から k 個の要素をランダムサンプルとして返します。これまで同様の機能を実現するには、`SELECT arrayReduce('groupArraySample(3)', range(10))` のような、あまり扱いやすくない構文を使う必要がありました。 [#56416](https://github.com/ClickHouse/ClickHouse/pull/56416) ([Robert Schulze](https://github.com/rschu1ze)).
* `.npy` ファイルで使用するための `Float16` 型データのサポートを追加しました。[#56344](https://github.com/ClickHouse/ClickHouse/issues/56344) をクローズしました。[#56424](https://github.com/ClickHouse/ClickHouse/pull/56424) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* Tableau Online との互換性を高めるために、システムビュー `information_schema.statistics` を追加しました。[#56425](https://github.com/ClickHouse/ClickHouse/pull/56425)（[Serge Klochkov](https://github.com/slvrtrn)）。
* バイナリの解析に役立つ `system.symbols` テーブルを追加しました。 [#56548](https://github.com/ClickHouse/ClickHouse/pull/56548) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 設定可能なダッシュボード。チャート用のクエリは、デフォルトでは新しい `system.dashboards` テーブルを参照するクエリとして読み込まれるようになりました。 [#56771](https://github.com/ClickHouse/ClickHouse/pull/56771) ([Sergei Trifonov](https://github.com/serxa))。
* `fileCluster` テーブル関数を追加しました。共有ファイルシステム（NFS など）を `user_files` ディレクトリにマウントしている場合に便利です。 [#56868](https://github.com/ClickHouse/ClickHouse/pull/56868) ([Andrey Zvonov](https://github.com/zvonand))。
* `s3/file/hdfs/url/azureBlobStorage` エンジンに、バイト単位のファイルサイズを表す `_size` 仮想列を追加しました。 [#57126](https://github.com/ClickHouse/ClickHouse/pull/57126)（[Kruglov Pavel](https://github.com/Avogar)）。
* Prometheus エンドポイントで、サーバーの直近の再起動以降に発生した各エラーコードごとのエラー数を公開できるようにしました。 [#57209](https://github.com/ClickHouse/ClickHouse/pull/57209) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* ClickHouse keeper は、稼働中のアベイラビリティゾーンを `/keeper/availability-zone` パスで報告します。これは `<availability_zone><value>us-west-1a</value></availability_zone>` によって設定できます。 [#56715](https://github.com/ClickHouse/ClickHouse/pull/56715) ([Jianfei Hu](https://github.com/incfly)).
* ALTER materialized&#95;view MODIFY QUERY を実験的機能ではない通常機能とし、`allow_experimental_alter_materialized_view_structure` 設定を非推奨化。[#15206](https://github.com/ClickHouse/ClickHouse/issues/15206) を修正。[#57311](https://github.com/ClickHouse/ClickHouse/pull/57311)（[alesapin](https://github.com/alesapin)）。
* `join_algorithm` 設定で指定した順序が尊重されるようになりました [#51745](https://github.com/ClickHouse/ClickHouse/pull/51745) ([vdimir](https://github.com/vdimir)).
* Protobuf フォーマットで [well-known Protobuf types](https://protobuf.dev/reference/protobuf/google.protobuf/) をサポートしました。[#56741](https://github.com/ClickHouse/ClickHouse/pull/56741)（[János Benjamin Antal](https://github.com/antaljanosbenjamin)）。



#### パフォーマンス向上 {#performance-improvement-1}

* S3 との通信に対するアダプティブなタイムアウト。最初の試行では、送信および受信タイムアウトを短く設定します。 [#56314](https://github.com/ClickHouse/ClickHouse/pull/56314) ([Sema Checherinda](https://github.com/CheSema)).
* `max_concurrent_queries` のデフォルト値を 100 から 1000 に引き上げました。これは、接続しているクライアント数が多く、それぞれがゆっくりとデータを送受信していてサーバーの CPU がボトルネックになっていない場合や、CPU コア数が 100 を超える場合に妥当です。また、デフォルトで同時実行制御を有効化し、クエリ処理スレッドの総数を CPU コア数の 2 倍に設定します。これにより、同時実行クエリ数が非常に多いシナリオでのパフォーマンスが向上します。 [#46927](https://github.com/ClickHouse/ClickHouse/pull/46927) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* ウィンドウ関数の並列評価をサポートしました。[#34688](https://github.com/ClickHouse/ClickHouse/issues/34688) を修正。[#39631](https://github.com/ClickHouse/ClickHouse/pull/39631)（[Dmitry Novik](https://github.com/novikd)）。
* `Numbers` テーブルエンジン（`system.numbers` テーブル用）が、テーブルのインデックスと同様に、必要なデータの部分集合を生成するために条件を解析するようになりました。 [#50909](https://github.com/ClickHouse/ClickHouse/pull/50909) ([JackyWoo](https://github.com/JackyWoo)).
* `Merge` テーブルエンジンにおける `IN (...)` 条件でのフィルタリングのパフォーマンスを改善しました。 [#54905](https://github.com/ClickHouse/ClickHouse/pull/54905)（[Nikita Taranov](https://github.com/nickitat)）。
* ファイルシステムキャッシュがいっぱいの状態で大規模な読み取りが行われる場合に効果を発揮する改善。 [#55158](https://github.com/ClickHouse/ClickHouse/pull/55158) ([Kseniia Sumarokova](https://github.com/kssenii)).
* S3 に対するチェックサム計算を無効化できるようにし、ファイルに対する不要な複数回の走査を回避できるようにしました（設定 `s3_disable_checksum` で制御されます）。 [#55559](https://github.com/ClickHouse/ClickHouse/pull/55559) ([Azat Khuzhin](https://github.com/azat)).
* ページキャッシュ内にデータがある場合、リモートテーブルに対しても（ローカルテーブルと同様に）同期的に読み取るようになりました。これにより高速になり、スレッドプール内での同期が不要となり、ローカルファイルシステム上での `seek` も問題なく行え、CPU の待ち時間も削減します。 [#55841](https://github.com/ClickHouse/ClickHouse/pull/55841) ([Nikita Taranov](https://github.com/nickitat)).
* `map`、`arrayElement` から値を取得する処理の最適化。約30%の高速化を実現します。- 予約済みメモリの削減 - `resize` 呼び出し回数の削減。[#55957](https://github.com/ClickHouse/ClickHouse/pull/55957)（[lgbo](https://github.com/lgbo-ustc)）。
* AVX-512 を用いたマルチステージフィルタリングの最適化。ICX デバイス（Intel Xeon Platinum 8380 CPU、80 コア、160 スレッド）上で OnTime データセットを用いて行ったパフォーマンス実験により、この変更によってクエリ Q2、Q3、Q4、Q5、Q6 の QPS がそれぞれ 7.4%、5.9%、4.7%、3.0%、4.6% 向上し、その他のクエリには影響がないことが確認されました。[#56079](https://github.com/ClickHouse/ClickHouse/pull/56079)（[Zhiguo Zhou](https://github.com/ZhiguoZh)）。
* クエリプロファイラ内で処理中のスレッド数に上限を設けました。上限を超えたスレッドはプロファイリングをスキップします。 [#56105](https://github.com/ClickHouse/ClickHouse/pull/56105) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* ウィンドウ関数での仮想関数呼び出し回数を削減しました。 [#56120](https://github.com/ClickHouse/ClickHouse/pull/56120) ([Maksim Kita](https://github.com/kitaisreal)).
* ORC データ形式で Tuple フィールドの再帰的な削減を可能にし、スキャンを高速化しました。 [#56122](https://github.com/ClickHouse/ClickHouse/pull/56122) ([李扬](https://github.com/taiyang-li))。
* `Npy` データ形式向けの簡易な count の最適化: `select count() from 'data.npy'` のようなクエリは、結果をキャッシュすることで大幅に高速に実行されるようになりました。[#56304](https://github.com/ClickHouse/ClickHouse/pull/56304)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 集約を伴いストリーム数が多いクエリでは、プラン構築中に使用されるメモリ量が削減されました。 [#57074](https://github.com/ClickHouse/ClickHouse/pull/57074) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 多数のユーザーと高い同時実行性（&gt;2000 QPS）を伴うユースケース向けに、ProcessList へのアクセスを最適化することでクエリ実行パフォーマンスを改善しました。 [#57106](https://github.com/ClickHouse/ClickHouse/pull/57106) ([Andrej Hoos](https://github.com/adikus)).
* array join に対してささやかな改善を行い、一部の中間結果を再利用するようにしました。 [#57183](https://github.com/ClickHouse/ClickHouse/pull/57183) ([李扬](https://github.com/taiyang-li))。
* スタックアンワインドが遅いケースがありましたが、現在は解消されています。[#57221](https://github.com/ClickHouse/ClickHouse/pull/57221)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `max_streams = 1` の場合、外部ストレージからの読み込みにデフォルトの read pool を使用するようになりました。これは read prefetch が有効化されている場合に特に有効です。 [#57334](https://github.com/ClickHouse/ClickHouse/pull/57334) ([Nikita Taranov](https://github.com/nickitat))。
* Keeper の改善: ログ前処理を遅延させることで、起動時のメモリ使用量を削減。 [#55660](https://github.com/ClickHouse/ClickHouse/pull/55660) ([Antonio Andelic](https://github.com/antonio2368)).
* `File` および `HDFS` ストレージに対するグロブマッチングのパフォーマンスを向上。 [#56141](https://github.com/ClickHouse/ClickHouse/pull/56141) ([Andrey Zvonov](https://github.com/zvonand)).
* 実験的なフルテキストインデックスのポスティングリストが圧縮され、そのサイズが 10〜30% 削減されました。 [#56226](https://github.com/ClickHouse/ClickHouse/pull/56226) ([Harry Lee](https://github.com/HarryLeeIBM)).
* バックアップ処理で `BackupEntriesCollector` の並列実行を可能にしました。 [#56312](https://github.com/ClickHouse/ClickHouse/pull/56312) ([Kseniia Sumarokova](https://github.com/kssenii)).



#### 改善点 {#improvement-1}

* 新しい `MergeTree` の設定 `add_implicit_sign_column_constraint_for_collapsing_engine` を追加しました（デフォルトは無効）。有効にすると、`CollapsingMergeTree` テーブルに対して、`Sign` 列の値を -1 または 1 のみに制限する暗黙的な CHECK 制約が追加されます。[#56701](https://github.com/ClickHouse/ClickHouse/issues/56701)。[#56986](https://github.com/ClickHouse/ClickHouse/pull/56986) ([Kevin Mingtarja](https://github.com/kevinmingtarja))。
* 再起動なしでストレージ構成に新しいディスクを追加できるようにしました。 [#56367](https://github.com/ClickHouse/ClickHouse/pull/56367) ([Duc Canh Le](https://github.com/canhld94)).
* 同一の ALTER クエリ内でインデックスの作成と `MATERIALIZE INDEX` を行えるようにし、同一クエリ内での `MODIFY TTL` および `MATERIALIZE TTL` もサポートしました。[#55651](https://github.com/ClickHouse/ClickHouse/issues/55651) をクローズしました。[#56331](https://github.com/ClickHouse/ClickHouse/pull/56331)（[flynn](https://github.com/ucasfl)）。
* `fuzzJSON` という名前の新しいテーブル関数を追加し、元の JSON 文字列にランダムな変動（摂動）を加えたバージョンを行として含めるようにしました。 [#56490](https://github.com/ClickHouse/ClickHouse/pull/56490) ([Julia Kartseva](https://github.com/jkartseva)).
* `Merge` エンジンは、基になるテーブルの行ポリシーに従ってレコードをフィルタリングするため、`Merge` テーブルに別途行ポリシーを作成する必要はありません。 [#50209](https://github.com/ClickHouse/ClickHouse/pull/50209) ([Ilya Golshtein](https://github.com/ilejn)).
* 分散クエリにおいてシャード上での実行時間を制限するための設定 `max_execution_time_leaf` を追加し、タイムアウト発生時の動作を制御するための設定 `timeout_overflow_mode_leaf` を追加しました。 [#51823](https://github.com/ClickHouse/ClickHouse/pull/51823) ([Duc Canh Le](https://github.com/canhld94)).
* HTTP プロキシ経由の HTTPS リクエストに対してトンネリングを無効化するための ClickHouse 設定を追加しました。[#55033](https://github.com/ClickHouse/ClickHouse/pull/55033)（[Arthur Passos](https://github.com/arthurpassos)）。
* `background_fetches_pool_size` を 16 に、background&#95;schedule&#95;pool&#95;size を 512 に設定します。これは、頻繁に小さな挿入が行われる本番環境での利用に適した設定です。 [#54327](https://github.com/ClickHouse/ClickHouse/pull/54327) ([Denny Crane](https://github.com/den-crane)).
* CSV 形式のファイルからデータを読み込む際に、行末が `\n` を伴わない `\r` になっていると、次のような例外が発生します：`Cannot parse CSV format: found \r (CR) not followed by \n (LF). Line must end by \n (LF) or \r\n (CR LF) or \n\r.` ClickHouse では、CSV の行末は `\n` または `\r\n` または `\n\r` である必要があり、`\r` は必ず `\n` に続かなければなりません。しかし一部の状況では、上記のように CSV 入力データが異常で、行末が `\r` のみになっている場合があります。 [#54340](https://github.com/ClickHouse/ClickHouse/pull/54340) ([KevinyhZou](https://github.com/KevinyhZou)).
* 新しいエンコーディングに対応した Arrow ライブラリの release-13.0.0 へ更新。 [#44505](https://github.com/ClickHouse/ClickHouse/issues/44505) をクローズ。 [#54800](https://github.com/ClickHouse/ClickHouse/pull/54800)（[Kruglov Pavel](https://github.com/Avogar)）。
* DDL エントリ内の hosts リストでローカル IP アドレスを検索する際に、すべてのネットワークインターフェイスを列挙する負荷の高いシステムコールを削除し、ON CLUSTER クエリのパフォーマンスを向上。 [#54909](https://github.com/ClickHouse/ClickHouse/pull/54909) ([Duc Canh Le](https://github.com/canhld94)).
* クエリまたはユーザーにスレッドを関連付ける前に割り当てられたメモリ使用量の計上処理を修正しました。 [#56089](https://github.com/ClickHouse/ClickHouse/pull/56089) ([Nikita Taranov](https://github.com/nickitat)).
* Apache Arrow 形式に `LARGE_LIST` のサポートを追加しました。[#56118](https://github.com/ClickHouse/ClickHouse/pull/56118) ([edef](https://github.com/edef1c))。
* `OPTIMIZE` クエリで `EmbeddedRocksDB` の手動コンパクションを実行できるようにしました。 [#56225](https://github.com/ClickHouse/ClickHouse/pull/56225) ([Azat Khuzhin](https://github.com/azat)).
* `EmbeddedRocksDB` テーブルに対して BlockBasedTableOptions を指定できるようにしました。 [#56264](https://github.com/ClickHouse/ClickHouse/pull/56264) ([Azat Khuzhin](https://github.com/azat)).
* `SHOW COLUMNS` は、MySQL プロトコル経由で接続された場合に、MySQL の相当するデータ型名を表示するようになりました。以前は、`use_mysql_types_in_show_columns = 1` を設定した場合にのみ、この動作になっていました。この設定は保持されますが、非推奨となりました。 [#56277](https://github.com/ClickHouse/ClickHouse/pull/56277) ([Robert Schulze](https://github.com/rschu1ze))。
* サーバーが `TRUNCATE` または `DROP PARTITION` の直後に再起動された場合に発生する可能性があった `The local set of parts of table doesn't look like the set of parts in ZooKeeper` エラーを修正しました。 [#56282](https://github.com/ClickHouse/ClickHouse/pull/56282) ([Alexander Tokmakov](https://github.com/tavplubix)).
* 関数 `formatQuery`/`formatQuerySingleLine` における非 `const` クエリ文字列の処理を修正しました。また、クエリをパースできない場合に例外をスローするのではなく NULL を返す、両関数の `OrNull` 版も追加しました。 [#56327](https://github.com/ClickHouse/ClickHouse/pull/56327) ([Robert Schulze](https://github.com/rschu1ze))。
* バックアップが失敗しないよう、削除済みの内部テーブルを持つマテリアライズドビューもバックアップできるようにしました。 [#56387](https://github.com/ClickHouse/ClickHouse/pull/56387) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `system.replicas` へのクエリは、特定のカラムが問い合わせられたときに ZooKeeper へのリクエストを発行します。テーブルが数千ある場合、これらのリクエストが ZooKeeper にかなりの負荷を与える可能性があります。`system.replicas` へのクエリが同時に複数実行されると、同一のリクエストが複数回行われます。この変更は、並行クエリからのリクエストを「重複排除」するものです。[#56420](https://github.com/ClickHouse/ClickHouse/pull/56420) ([Alexander Gololobov](https://github.com/davenger))。
* 外部データベースをクエリするための MySQL 互換クエリへの変換処理を修正しました。 [#56456](https://github.com/ClickHouse/ClickHouse/pull/56456) ([flynn](https://github.com/ucasfl)).
* `KeeperMap` エンジンを使用したテーブルのバックアップおよび復元のサポートを追加。 [#56460](https://github.com/ClickHouse/ClickHouse/pull/56460) ([Antonio Andelic](https://github.com/antonio2368)).
* CompleteMultipartUpload への 404 応答は再確認する必要があります。クライアント側でタイムアウトやその他のネットワークエラーが発生した場合でも、サーバー側では操作が完了している可能性があります。次回の CompleteMultipartUpload の再試行では 404 応答が返されます。オブジェクトキーが存在する場合、その CompleteMultipartUpload 操作は成功したものとみなされます。 [#56475](https://github.com/ClickHouse/ClickHouse/pull/56475) ([Sema Checherinda](https://github.com/CheSema)).
* デフォルトで HTTP OPTIONS メソッドを有効化しました。これにより、Web ブラウザから ClickHouse へリクエストしやすくなります。 [#56483](https://github.com/ClickHouse/ClickHouse/pull/56483) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* `dns_max_consecutive_failures` の値が [#46550](https://github.com/ClickHouse/ClickHouse/issues/46550) で誤って変更されていたため、これを元に戻し、より適切な値に調整しました。また、HTTP keep-alive タイムアウトを、本番環境での実運用に基づいた妥当な値に引き上げました。[#56485](https://github.com/ClickHouse/ClickHouse/pull/56485)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* ベースバックアップを遅延読み込みするようにしました（必要になるまでベースバックアップは読み込まれません）。また、バックアップに関するログメッセージとプロファイルイベントも追加しました。[#56516](https://github.com/ClickHouse/ClickHouse/pull/56516) ([Vitaly Baranov](https://github.com/vitlibar))。
* `query_cache_store_results_of_queries_with_nondeterministic_functions`（値は `false` または `true`）の設定は非推奨とマークされました。これは、クエリキャッシュが非決定的関数を含むクエリをどのように扱うかを制御する 3 値の enum である `query_cache_nondeterministic_function_handling` 設定に置き換えられました。a) 例外をスローする（デフォルト動作）、b) 非決定的なクエリ結果であっても保存する、c) 無視する、すなわち例外をスローせず結果もキャッシュしない、のいずれかを選択できます。[#56519](https://github.com/ClickHouse/ClickHouse/pull/56519) ([Robert Schulze](https://github.com/rschu1ze))。
* JOIN の ON 句で等価条件を `is null` チェックに書き換え。実験的な *Analyzer のみ*。[#56538](https://github.com/ClickHouse/ClickHouse/pull/56538)（[vdimir](https://github.com/vdimir)）。
* 関数 `concat` は、これまでの String および FixedString 引数に限られず、任意の引数型をサポートするようになりました。これにより、MySQL の `concat` 実装により近い動作をするようになりました。たとえば、`SELECT concat('ab', 42)` は `ab42` を返します。 [#56540](https://github.com/ClickHouse/ClickHouse/pull/56540) ([Serge Klochkov](https://github.com/slvrtrn))。
* キャッシュ構成を、設定ファイル内の &#39;named&#95;collection&#39; セクション、または SQL で作成された named collection から取得できるようになりました。 [#56541](https://github.com/ClickHouse/ClickHouse/pull/56541) ([Kseniia Sumarokova](https://github.com/kssenii)).
* PostgreSQL データベースエンジン: `postgres` 接続が確立できなかった場合に、古いテーブルの削除をあまり積極的に行わないようにしました。[#56609](https://github.com/ClickHouse/ClickHouse/pull/56609) ([jsc0218](https://github.com/jsc0218)).
* URL が正しくない場合に PG への接続に非常に時間がかかり、その結果、該当するクエリがそのままハングしてキャンセルされてしまっていました。 [#56648](https://github.com/ClickHouse/ClickHouse/pull/56648) ([jsc0218](https://github.com/jsc0218)).
* Keeper の改善: Keeper で圧縮ログをデフォルトで無効化しました。 [#56763](https://github.com/ClickHouse/ClickHouse/pull/56763) ([Antonio Andelic](https://github.com/antonio2368)).
* 設定項目 `wait_dictionaries_load_at_startup` を追加しました。 [#56782](https://github.com/ClickHouse/ClickHouse/pull/56782) ([Vitaly Baranov](https://github.com/vitlibar)).
* 以前の ClickHouse のバージョンには、次のような潜在的な脆弱性がありました。ユーザーが接続し、「interserver secret」メソッドでの認証に失敗した場合、サーバーは直ちに接続を終了せず、クライアントから送信される残りのパケットを受信し続け、それらを無視していました。これらのパケットは無視されますが、依然として解析されるため、もし別の既知の脆弱性がある圧縮方式が使われていた場合、認証なしにその脆弱性を悪用される可能性がありました。この問題は [ClickHouse Bug Bounty Program](https://github.com/ClickHouse/ClickHouse/issues/38986) を通じて [https://twitter.com/malacupa](https://twitter.com/malacupa) 氏により発見されました。[#56794](https://github.com/ClickHouse/ClickHouse/pull/56794)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* パーツのフェッチは、そのパーツがリモートレプリカ側で完全にコミットされるまで待機します。`PreActive` 状態のパーツは送信しないことが望ましいです。ゼロコピーの場合、これは必須の制約となります。 [#56808](https://github.com/ClickHouse/ClickHouse/pull/56808) ([Sema Checherinda](https://github.com/CheSema))。
* 実験的機能である `MaterializedPostgreSQL` 使用時に発生する可能性のある PostgreSQL 論理レプリケーションの変換エラーを修正しました。 [#53721](https://github.com/ClickHouse/ClickHouse/pull/53721) ([takakawa](https://github.com/takakawa)).
* ユーザーレベルの設定 `alter_move_to_space_execute_async` を実装し、クエリ `ALTER TABLE ... MOVE PARTITION|PART TO DISK|VOLUME` を非同期で実行できるようにしました。バックグラウンド実行用プールのサイズは `background_move_pool_size` によって制御されます。デフォルトの動作は同期実行です。[#47643](https://github.com/ClickHouse/ClickHouse/issues/47643) を修正しました。 [#56809](https://github.com/ClickHouse/ClickHouse/pull/56809) ([alesapin](https://github.com/alesapin))。
* system.tables をスキャンする際にエンジンでフィルタリングできるようになり、不必要な（時間がかかる可能性のある）接続を回避可能に。 [#56813](https://github.com/ClickHouse/ClickHouse/pull/56813) ([jsc0218](https://github.com/jsc0218))。
* RocksDB ストレージ用に、system テーブルで `total_bytes` と `total_rows` を表示できるようにしました。 [#56816](https://github.com/ClickHouse/ClickHouse/pull/56816) ([Aleksandr Musorin](https://github.com/AVMusorin)).
* TEMPORARY テーブルに対する ALTER で基本的なコマンドを使用できるようにしました。 [#56892](https://github.com/ClickHouse/ClickHouse/pull/56892) ([Sergey](https://github.com/icuken)).
* LZ4 圧縮。`out` のバッファ容量が不足しており、圧縮済みブロックを直接 `out` のバッファに書き込めないまれなケースでは、圧縮ブロックをバッファリングするようにしました。 [#56938](https://github.com/ClickHouse/ClickHouse/pull/56938) ([Sema Checherinda](https://github.com/CheSema)).
* キューに入っているジョブ数のメトリクスを追加しました。これは IO スレッドプールで役立ちます。 [#56958](https://github.com/ClickHouse/ClickHouse/pull/56958) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 設定ファイルに PostgreSQL テーブルエンジン用の設定を追加しました。設定値のチェック処理を追加しました。追加設定に関するドキュメントを追記しました。 [#56959](https://github.com/ClickHouse/ClickHouse/pull/56959) ([Peignon Melvyn](https://github.com/melvynator)).
* 関数 `concat` は、`SELECT concat('abc')` のように 1 つの引数で呼び出せるようになりました。これにより、動作が MySQL の concat 実装とより一貫したものになりました。 [#57000](https://github.com/ClickHouse/ClickHouse/pull/57000) ([Serge Klochkov](https://github.com/slvrtrn))。
* AWS S3 のドキュメントで求められているとおり、すべての `x-amz-*` ヘッダーに対して署名を行います。 [#57001](https://github.com/ClickHouse/ClickHouse/pull/57001) ([Arthur Passos](https://github.com/arthurpassos)).
* 関数 `fromDaysSinceYearZero`（エイリアス: `FROM_DAYS`）は、符号なし整数型に加えて符号付き整数型でも使用できるようになりました（以前は符号なし整数型である必要がありました）。これにより、Tableau Online などのサードパーティー製ツールとの互換性が向上します。 [#57002](https://github.com/ClickHouse/ClickHouse/pull/57002) ([Serge Klochkov](https://github.com/slvrtrn))。
* `system.s3queue_log` をデフォルト設定に追加しました。 [#57036](https://github.com/ClickHouse/ClickHouse/pull/57036) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `wait_dictionaries_load_at_startup` のデフォルト値を true に変更し、`dictionaries_lazy_load` が false の場合にのみこの設定を使用するようにしました。 [#57133](https://github.com/ClickHouse/ClickHouse/pull/57133) ([Vitaly Baranov](https://github.com/vitlibar))。
* `dictionaries_lazy_load` が有効になっている場合でも、辞書作成時に辞書ソースの種類をチェックするようにしました。 [#57134](https://github.com/ClickHouse/ClickHouse/pull/57134) ([Vitaly Baranov](https://github.com/vitlibar))。
* プランレベルの最適化を、個別に有効化または無効化できるようになりました。以前は、すべてをまとめて無効化することしかできませんでした。以前すべての最適化を無効化するために使われていた設定（`query_plan_enable_optimizations`）は残されており、引き続き最適化を一括で無効化するために使用できます。 [#57152](https://github.com/ClickHouse/ClickHouse/pull/57152) ([Robert Schulze](https://github.com/rschu1ze))。
* サーバーの終了コードは、例外コードに対応します。例えば、サーバーがメモリ制限により起動できない場合、コード 241 = MEMORY&#95;LIMIT&#95;EXCEEDED で終了します。以前のバージョンでは、例外に対する終了コードは常に 70 = Poco::Util::ExitCode::EXIT&#95;SOFTWARE でした。[#57153](https://github.com/ClickHouse/ClickHouse/pull/57153)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `functional` C++ ヘッダー由来のスタックフレームをデマングルやシンボル化しないようにしました。 [#57201](https://github.com/ClickHouse/ClickHouse/pull/57201) ([Mike Kot](https://github.com/myrrc)).
* HTTP サーバーの `/dashboard` ページが、複数系列の線グラフをサポートするようになりました。 [#57236](https://github.com/ClickHouse/ClickHouse/pull/57236) ([Sergei Trifonov](https://github.com/serxa))。
* `max_memory_usage_in_client` コマンドラインオプションで、サフィックス（K、M、G など）付きの文字列値がサポートされるようになりました。これにより [#56879](https://github.com/ClickHouse/ClickHouse/issues/56879) がクローズされました。 [#57273](https://github.com/ClickHouse/ClickHouse/pull/57273)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* Intel QPL（codec `DEFLATE_QPL` で使用）を v1.2.0 から v1.3.1 に更新しました。また、BOF（Block On Fault）が 0 の場合のバグを修正し、ページフォールト発生時には SW パスへフォールバックして処理するように変更しました。[#57291](https://github.com/ClickHouse/ClickHouse/pull/57291)（[jasperzhu](https://github.com/jinjunzh)）。
* MergeTree 設定の `replicated_deduplication_window` のデフォルト値を 100 から 1k に引き上げ。 [#57335](https://github.com/ClickHouse/ClickHouse/pull/57335) ([sichenzhao](https://github.com/sichenzhao)).
* `INCONSISTENT_METADATA_FOR_BACKUP` を過度に使用しないようにしました。可能であれば、バックアップ用のスキャンを一度停止して最初からやり直すのではなく、そのまま継続してスキャンするようにしました。 [#57385](https://github.com/ClickHouse/ClickHouse/pull/57385) ([Vitaly Baranov](https://github.com/vitlibar)).



#### ビルド／テスト／パッケージングの改善 {#buildtestingpackaging-improvement-1}

* SQLLogic テストを追加。 [#56078](https://github.com/ClickHouse/ClickHouse/pull/56078) ([Han Fei](https://github.com/hanfei1991)).
* `clickhouse-local` と `clickhouse-client` を、利便性向上のために短い名前（`ch`、`chl`、`chc`）で利用できるようにしました。 [#56634](https://github.com/ClickHouse/ClickHouse/pull/56634) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 外部ライブラリから未使用コードを削除することで、ビルドサイズをさらに削減しました。 [#56786](https://github.com/ClickHouse/ClickHouse/pull/56786) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 大きな翻訳単位が存在しないことを検証する自動チェック機能を追加。[#56559](https://github.com/ClickHouse/ClickHouse/pull/56559) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 単一バイナリディストリビューションのサイズを小さくしました。これにより [#55181](https://github.com/ClickHouse/ClickHouse/issues/55181) がクローズされました。 [#56617](https://github.com/ClickHouse/ClickHouse/pull/56617) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 各ビルドごとに、すべてのトランスレーションユニットおよびバイナリファイルのサイズに関する情報が ClickHouse Cloud 内の CI データベースに送信されるようになりました。これにより [#56107](https://github.com/ClickHouse/ClickHouse/issues/56107) がクローズされました。[#56636](https://github.com/ClickHouse/ClickHouse/pull/56636)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 「Apache Arrow」ライブラリの一部のファイル（Arrow フォーマットのパースといった必須ではない用途にのみ使用しているもの）が、ビルドキャッシュに関係なく常に再ビルドされていました。これは修正されました。 [#56657](https://github.com/ClickHouse/ClickHouse/pull/56657) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* バージョン情報用の自動生成ソースファイルに依存する翻訳ユニットを再コンパイルしないようにした。 [#56660](https://github.com/ClickHouse/ClickHouse/pull/56660) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* リンカー呼び出しのトレースデータは、ClickHouse Cloud 上の CI データベースに送信されます。 [#56725](https://github.com/ClickHouse/ClickHouse/pull/56725) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* ClickHouse バイナリに DWARF 5 のデバッグシンボルを使用するようにしました（以前は DWARF 4 を使用）。 [#56770](https://github.com/ClickHouse/ClickHouse/pull/56770) ([Michael Kolupaev](https://github.com/al13n321)).
* 新しいビルドオプション `SANITIZE_COVERAGE` を追加しました。有効化すると、コードに計測用のインストルメンテーションが挿入され、カバレッジを追跡できるようになります。収集された情報は ClickHouse 内で次のように利用できます。（1）新しい関数 `coverage` により、前回のカバレッジリセット以降に検出されたコード内の一意なアドレスの配列が返されます。（2）`SYSTEM RESET COVERAGE` クエリにより、蓄積されたデータをリセットできます。これにより、差分コードカバレッジを含む、異なるテスト間のカバレッジを比較できます。[#20539](https://github.com/ClickHouse/ClickHouse/issues/20539) の継続です。[#56102](https://github.com/ClickHouse/ClickHouse/pull/56102)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* スタックを収集する際に、一部のスタックフレームを解決できないことがあります。そのような場合には、生のアドレスが役立つことがあります。 [#56267](https://github.com/ClickHouse/ClickHouse/pull/56267) ([Alexander Gololobov](https://github.com/davenger)).
* `libssh` を無効化できるオプションを追加。 [#56333](https://github.com/ClickHouse/ClickHouse/pull/56333) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* CI の S3 テストで temporary&#95;data&#95;in&#95;cache を有効化。 [#48425](https://github.com/ClickHouse/ClickHouse/pull/48425) ([vdimir](https://github.com/vdimir)).
* CI で clickhouse-client の最大メモリ使用量を `1G` に設定。 [#56873](https://github.com/ClickHouse/ClickHouse/pull/56873) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).



#### バグ修正（公式安定版リリースでユーザーに見える不具合） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-1}

* 実験的な Analyzer を修正しました。挿入テーブルを参照するサブクエリを含む `INSERT ... SELECT` は、挿入ブロックのみを処理するようにしました。 [#50857](https://github.com/ClickHouse/ClickHouse/pull/50857) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))
* `str_to_map` 関数の不具合を修正。 [#56423](https://github.com/ClickHouse/ClickHouse/pull/56423) ([Arthur Passos](https://github.com/arthurpassos))。
* Keeper `reconfig`: リーダー権限を放棄／取得する前にタイムアウトを追加 [#53481](https://github.com/ClickHouse/ClickHouse/pull/53481) ([Mike Kot](https://github.com/myrrc)).
* grace hash join および filter pushdown における誤ったヘッダーを修正 [#53922](https://github.com/ClickHouse/ClickHouse/pull/53922) ([vdimir](https://github.com/vdimir)).
* テーブルがテーブル関数を元に作成されている場合でも system テーブルから `SELECT` できるようにしました。 [#55540](https://github.com/ClickHouse/ClickHouse/pull/55540) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* RFC: Distributed クエリでの LIMIT BY における「Cannot find column X in source stream」の修正 [#55836](https://github.com/ClickHouse/ClickHouse/pull/55836) ([Azat Khuzhin](https://github.com/azat)).
* バックグラウンドでクライアントを実行している際に発生する&#39;Cannot read from file:&#39; エラーを修正 [#55976](https://github.com/ClickHouse/ClickHouse/pull/55976) ([Kruglov Pavel](https://github.com/Avogar)).
* 不正な send&#95;logs&#95;level 設定時に clickhouse-local が終了する問題を修正 [#55994](https://github.com/ClickHouse/ClickHouse/pull/55994) ([Kruglov Pavel](https://github.com/Avogar)).
* パラメータ化ビューにおける EXPLAIN AST のバグ修正 [#56004](https://github.com/ClickHouse/ClickHouse/pull/56004) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* 起動時のテーブル読み込み中にクラッシュが発生する問題を修正 [#56232](https://github.com/ClickHouse/ClickHouse/pull/56232) ([Nikolay Degterinsky](https://github.com/evillique)).
* 明示的なクエリを使用して ClickHouse 由来の辞書を修正 [#56236](https://github.com/ClickHouse/ClickHouse/pull/56236) ([Nikolay Degterinsky](https://github.com/evillique))。
* Keeper のシグナルハンドラにおけるセグフォルトを修正 [#56266](https://github.com/ClickHouse/ClickHouse/pull/56266) ([Antonio Andelic](https://github.com/antonio2368)).
* view() 関数での UNION の結果が不完全になる問題を修正。 [#56274](https://github.com/ClickHouse/ClickHouse/pull/56274) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* &quot;cast(&#39;0&#39; as DateTime64(3))&quot; と &quot;cast(&#39;0&#39; as Nullable(DateTime64(3)))&quot; の不一致を修正 [#56286](https://github.com/ClickHouse/ClickHouse/pull/56286) ([李扬](https://github.com/taiyang-li))。
* メモリ割り当て失敗に関連する、まれに発生するレースコンディションを修正 [#56303](https://github.com/ClickHouse/ClickHouse/pull/56303) ([alesapin](https://github.com/alesapin))。
* `flatten_nested` と `data_type_default_nullable` を使用したバックアップからの復元処理を修正 [#56306](https://github.com/ClickHouse/ClickHouse/pull/56306) ([Kseniia Sumarokova](https://github.com/kssenii))。
* Object(JSON) 型のカラムを追加した場合に発生するクラッシュを修正 [#56307](https://github.com/ClickHouse/ClickHouse/pull/56307) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
* filterPushDown で発生するクラッシュを修正 [#56380](https://github.com/ClickHouse/ClickHouse/pull/56380) ([vdimir](https://github.com/vdimir)).
* マテリアライズドビューと削除されたソーステーブルが存在する場合のバックアップからの復元を修正 [#56383](https://github.com/ClickHouse/ClickHouse/pull/56383) ([Kseniia Sumarokova](https://github.com/kssenii)).
* Kerberos 初期化時に発生するセグメンテーションフォールトを修正 [#56401](https://github.com/ClickHouse/ClickHouse/pull/56401) ([Nikolay Degterinsky](https://github.com/evillique)).
* T64 のバッファオーバーフローを修正 [#56434](https://github.com/ClickHouse/ClickHouse/pull/56434) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* final における NULL 許容 primary key を修正 (2) [#56452](https://github.com/ClickHouse/ClickHouse/pull/56452) ([Amos Bird](https://github.com/amosbird))。
* 初期ノードにデータベースが存在しない場合の `ON CLUSTER` クエリの問題を修正 [#56484](https://github.com/ClickHouse/ClickHouse/pull/56484)（[Nikolay Degterinsky](https://github.com/evillique)）。
* TTL の依存関係により発生していた起動失敗を修正 [#56489](https://github.com/ClickHouse/ClickHouse/pull/56489) ([Nikolay Degterinsky](https://github.com/evillique)).
* `ON CLUSTER` を伴う `ALTER COMMENT` クエリを修正 [#56491](https://github.com/ClickHouse/ClickHouse/pull/56491) ([Nikolay Degterinsky](https://github.com/evillique))。
* ALIAS を伴う ALTER COLUMN を修正 [#56493](https://github.com/ClickHouse/ClickHouse/pull/56493) ([Nikolay Degterinsky](https://github.com/evillique)).
* 空の NAMED COLLECTION の不具合を修正 [#56494](https://github.com/ClickHouse/ClickHouse/pull/56494) ([Nikolay Degterinsky](https://github.com/evillique)).
* 2 つのケースでのプロジェクション解析を修正。 [#56502](https://github.com/ClickHouse/ClickHouse/pull/56502) ([Amos Bird](https://github.com/amosbird))。
* クエリキャッシュにおけるエイリアスの処理を修正 [#56545](https://github.com/ClickHouse/ClickHouse/pull/56545) ([Robert Schulze](https://github.com/rschu1ze))。
* `Nullable(Enum)` から `Nullable(String)` への変換を修正 [#56644](https://github.com/ClickHouse/ClickHouse/pull/56644) ([Nikolay Degterinsky](https://github.com/evillique))。
* Keeper におけるより信頼性の高いログ処理 [#56670](https://github.com/ClickHouse/ClickHouse/pull/56670) ([Antonio Andelic](https://github.com/antonio2368)).
* 置換属性を持つノードに対する設定のマージ処理を修正 [#56694](https://github.com/ClickHouse/ClickHouse/pull/56694) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* テーブル関数 `input()` が重複して使用される問題を修正しました。 [#56695](https://github.com/ClickHouse/ClickHouse/pull/56695) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* 修正: RabbitMQ における OpenSSL の動的ロードの問題 [#56703](https://github.com/ClickHouse/ClickHouse/pull/56703) ([Igor Nikonov](https://github.com/devcrafter))。
* データ内にゼロが存在する場合に GCD codec がクラッシュする問題を修正 [#56704](https://github.com/ClickHouse/ClickHouse/pull/56704) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
* `clickhouse-local` で `INSERT INTO FUNCTION` の実行時に発生する「mutex lock failed: Invalid argument」を修正 [#56710](https://github.com/ClickHouse/ClickHouse/pull/56710)（[Kruglov Pavel](https://github.com/Avogar)）。
* 楽観的パスにおける Date テキスト解析を修正 [#56765](https://github.com/ClickHouse/ClickHouse/pull/56765) ([Kruglov Pavel](https://github.com/Avogar)).
* FPC コーデックのクラッシュを修正 [#56795](https://github.com/ClickHouse/ClickHouse/pull/56795) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* DatabaseReplicated: レプリカ復旧後に発生する DDL クエリのタイムアウト問題を修正 [#56796](https://github.com/ClickHouse/ClickHouse/pull/56796) ([Alexander Tokmakov](https://github.com/tavplubix)).
* MySQL バイナリプロトコルにおける nullable 列の誤った報告を修正 [#56799](https://github.com/ClickHouse/ClickHouse/pull/56799) ([Serge Klochkov](https://github.com/slvrtrn))。
* メタストアテーブルで Iceberg メタデータファイルをサポート [#56810](https://github.com/ClickHouse/ClickHouse/pull/56810) ([Kruglov Pavel](https://github.com/Avogar))。
* transform における TSAN レポートの問題を修正 [#56817](https://github.com/ClickHouse/ClickHouse/pull/56817) ([Raúl Marín](https://github.com/Algunenano))。
* `SET` クエリと `SETTINGS` の書式を修正 [#56825](https://github.com/ClickHouse/ClickHouse/pull/56825) ([Nikolay Degterinsky](https://github.com/evillique))。
* joinGet のテーブル依存関係により起動できなくなる問題を修正 [#56828](https://github.com/ClickHouse/ClickHouse/pull/56828) ([Nikolay Degterinsky](https://github.com/evillique))。
* ADD COLUMN で既存の Nested カラムがフラット化されてしまう問題を修正 [#56830](https://github.com/ClickHouse/ClickHouse/pull/56830) ([Nikolay Degterinsky](https://github.com/evillique))。
* CSV で行末の CR を許可するように修正 [#56901](https://github.com/ClickHouse/ClickHouse/pull/56901) ([KevinyhZou](https://github.com/KevinyhZou))。
* 無効な入力に対する `tryBase64Decode` の不具合を修正 [#56913](https://github.com/ClickHouse/ClickHouse/pull/56913) ([Robert Schulze](https://github.com/rschu1ze))。
* CapnProto/Protobuf スキーマにおける深くネストしたカラムの生成を修正 [#56941](https://github.com/ClickHouse/ClickHouse/pull/56941) ([Kruglov Pavel](https://github.com/Avogar)).
* Projection 列に対する非互換な ALTER 操作を防止 [#56948](https://github.com/ClickHouse/ClickHouse/pull/56948) ([Amos Bird](https://github.com/amosbird))。
* SQLite ファイルパスの検証を修正 [#56984](https://github.com/ClickHouse/ClickHouse/pull/56984) ([San](https://github.com/santrancisco)).
* S3Queue: メタデータ参照カウンタのインクリメント処理を修正 [#56990](https://github.com/ClickHouse/ClickHouse/pull/56990) ([Kseniia Sumarokova](https://github.com/kssenii)).
* S3Queue に関する軽微な修正 [#56999](https://github.com/ClickHouse/ClickHouse/pull/56999) ([Kseniia Sumarokova](https://github.com/kssenii))。
* DatabaseFileSystem のファイルパス検証を修正 [#57029](https://github.com/ClickHouse/ClickHouse/pull/57029) ([San](https://github.com/santrancisco))。
* `ARRAY JOIN` を使用して `fuzzBits` を修正 [#57033](https://github.com/ClickHouse/ClickHouse/pull/57033) ([Antonio Andelic](https://github.com/antonio2368))。
* joined&#95;subquery&#95;re... を用いた partial merge join で発生する nullptr デリファレンスを修正 [#57048](https://github.com/ClickHouse/ClickHouse/pull/57048) ([vdimir](https://github.com/vdimir)).
* RemoteSource のレースコンディションを修正 [#57052](https://github.com/ClickHouse/ClickHouse/pull/57052)（[Raúl Marín](https://github.com/Algunenano)）。
* 大きな整数に対して `bitHammingDistance` を実装 [#57073](https://github.com/ClickHouse/ClickHouse/pull/57073) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* S3 スタイルのリンクのバグ修正 [#57075](https://github.com/ClickHouse/ClickHouse/pull/57075) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* 複数の数値パスを扱う JSON&#95;QUERY 関数を修正 [#57096](https://github.com/ClickHouse/ClickHouse/pull/57096) ([KevinyhZou](https://github.com/KevinyhZou))。
* Gorilla コーデックのバッファオーバーフローを修正 [#57107](https://github.com/ClickHouse/ClickHouse/pull/57107) ([Nikolay Degterinsky](https://github.com/evillique))。
* 認証前に例外が発生した場合は常にサーバ間接続をクローズする [#57142](https://github.com/ClickHouse/ClickHouse/pull/57142) ([Antonio Andelic](https://github.com/antonio2368))。
* Nullable な MATERIALIZED カラムを持つテーブルでの ALTER UPDATE 実行後に発生するセグフォルトを修正 [#57147](https://github.com/ClickHouse/ClickHouse/pull/57147) ([Nikolay Degterinsky](https://github.com/evillique)).
* 部分的にマテリアライズされた通常プロジェクションに対して誤った JOIN プランが最適化される問題を修正 [#57196](https://github.com/ClickHouse/ClickHouse/pull/57196) ([Amos Bird](https://github.com/amosbird)).
* 列の説明を比較する際にコメントを無視するようにしました [#57259](https://github.com/ClickHouse/ClickHouse/pull/57259)（[Antonio Andelic](https://github.com/antonio2368)）。
* `ReadonlyReplica` メトリクスがすべてのケースで正しく動作するように修正 [#57267](https://github.com/ClickHouse/ClickHouse/pull/57267)（[Antonio Andelic](https://github.com/antonio2368)）。
* バックグラウンドマージ処理がキャッシュ内の一時データストレージを正しく使用するようになりました [#57275](https://github.com/ClickHouse/ClickHouse/pull/57275) ([vdimir](https://github.com/vdimir))。
* 変更ログおよびスナップショット向けの Keeper の修正 [#57299](https://github.com/ClickHouse/ClickHouse/pull/57299) ([Antonio Andelic](https://github.com/antonio2368)).
* ホスト名が変更された場合は、完了済みの ON CLUSTER タスクを無視するようになりました [#57339](https://github.com/ClickHouse/ClickHouse/pull/57339) ([Alexander Tokmakov](https://github.com/tavplubix)).
* MergeTree の mutation でソースパーツのインデックス粒度を再利用するようになりました [#57352](https://github.com/ClickHouse/ClickHouse/pull/57352)（[Maksim Kita](https://github.com/kitaisreal)）。
* FS キャッシュ: バックグラウンドでのダウンロードに上限を追加 [#57424](https://github.com/ClickHouse/ClickHouse/pull/57424) ([Kseniia Sumarokova](https://github.com/kssenii)).

### <a id="2310"></a> ClickHouse リリース 23.10, 2023-11-02 {#2310}

#### 後方互換性のない変更 {#backward-incompatible-change-2}
* 壊れたデータパーツを自動的に削除するオプションは廃止されました。これにより [#55174](https://github.com/ClickHouse/ClickHouse/issues/55174) がクローズされました。 [#55184](https://github.com/ClickHouse/ClickHouse/pull/55184)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。 [#55557](https://github.com/ClickHouse/ClickHouse/pull/55557)（[Jihyuk Bok](https://github.com/tomahawk28)）。
* 古いインメモリデータパーツは、write-ahead ログからはもはや読み取れません。以前にインメモリパーツを構成している場合は、アップグレード前にそれらを削除する必要があります。 [#55186](https://github.com/ClickHouse/ClickHouse/pull/55186)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* Meilisearch との統合を削除しました。理由: 旧バージョン 0.18 にしか対応していなかったためです。最近の Meilisearch のバージョンではプロトコルが変更されており、もはや動作しません。注意: 復活させることにご協力いただけると幸いです。 [#55189](https://github.com/ClickHouse/ClickHouse/pull/55189)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* directory monitor という概念の名称を background INSERT に変更しました。すべての `*directory_monitor*` 設定は `distributed_background_insert*` に改名されました。*後方互換性は維持されるはずです*（旧設定名はエイリアスとして追加されています）。 [#55978](https://github.com/ClickHouse/ClickHouse/pull/55978)（[Azat Khuzhin](https://github.com/azat)）。
* クライアント側で設定された `send_timeout` をサーバー側の `receive_timeout` として、またその逆として解釈しないようにしました。 [#56035](https://github.com/ClickHouse/ClickHouse/pull/56035)（[Azat Khuzhin](https://github.com/azat)）。
* 単位の異なる時間間隔の比較は、例外をスローするようになりました。これにより [#55942](https://github.com/ClickHouse/ClickHouse/issues/55942) がクローズされます。以前の挙動（単位に関係なく基になる数値が比較される）に、意図せず依存していた可能性があります。 [#56090](https://github.com/ClickHouse/ClickHouse/pull/56090)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 実験的な `S3Queue` テーブルエンジンを完全に書き換えました。ZooKeeper に情報を保持する方法を変更し、ZooKeeper へのリクエストを減らせるようにし、状態が変化しないことが分かっている場合に ZooKeeper の状態をキャッシュする機能を追加し、S3 からのポーリング処理を改善して過度に攻撃的にならないようにし、追跡対象ファイルに対する TTL と最大数の設定の管理方法を変更して、これをバックグラウンドプロセスとしました。`system.s3queue` および `system.s3queue_log` テーブルを追加しました。[#54998](https://github.com/ClickHouse/ClickHouse/issues/54998) をクローズします。 [#54422](https://github.com/ClickHouse/ClickHouse/pull/54422)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 任意のパスでの HTTP エンドポイントへのアクセスは、もはや `/query` エンドポイントへのリクエストとして解釈されません。 [#55521](https://github.com/ClickHouse/ClickHouse/pull/55521)（[Konstantin Bogdanov](https://github.com/thevar1able)）。

#### 新機能 {#new-feature-2}

* 同じ長さの複数の配列にラムダ関数を適用し、その結果をアキュムレータに蓄積する関数 `arrayFold(accumulator, x1, ..., xn -> expression, initial, array1, ..., arrayn)` を追加。 [#49794](https://github.com/ClickHouse/ClickHouse/pull/49794) ([Lirikl](https://github.com/Lirikl)).
* `Npy` 形式のサポート。`SELECT * FROM file('example_array.npy', Npy)`。[#55982](https://github.com/ClickHouse/ClickHouse/pull/55982)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* テーブルのキーに空間充填曲線が含まれている場合、例えば `ORDER BY mortonEncode(x, y)` のようなとき、その引数に対する条件、例えば `x >= 10 AND x <= 20 AND y >= 20 AND y <= 30` はインデックスとして利用できます。この分析を有効または無効にするための設定として、`analyze_index_with_space_filling_curves` が追加されました。これにより [#41195](https://github.com/ClickHouse/ClickHouse/issue/41195) が解決されます。[#4538](https://github.com/ClickHouse/ClickHouse/pull/4538) の継続です。[#6286](https://github.com/ClickHouse/ClickHouse/pull/6286) の継続です。[#28130](https://github.com/ClickHouse/ClickHouse/pull/28130) の継続です。[#41753](https://github.com/ClickHouse/ClickHouse/pull/#41753) の継続です。[#55642](https://github.com/ClickHouse/ClickHouse/pull/55642)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `force_optimize_projection_name` という新しい設定項目が追加されました。引数として projection の名前を受け取ります。この値に空でない文字列が設定されている場合、ClickHouse はその projection がクエリ内で少なくとも 1 回は使用されていることを検証します。これにより [#55331](https://github.com/ClickHouse/ClickHouse/issues/55331) がクローズされました。 [#56134](https://github.com/ClickHouse/ClickHouse/pull/56134) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* ネイティブプロトコル経由での外部データを用いた非同期INSERTをサポートしました。以前は、データをクエリ内にインライン指定した場合にのみ動作していました。 [#54730](https://github.com/ClickHouse/ClickHouse/pull/54730) ([Anton Popov](https://github.com/CurtizJ)).
* 可視化用のデータのダウンサンプリングに [Largest-Triangle-Three-Buckets](https://skemman.is/bitstream/1946/15343/3/SS_MSthesis.pdf) アルゴリズムを使用する集約関数 `lttb` を追加しました。 [#53145](https://github.com/ClickHouse/ClickHouse/pull/53145) ([Sinan](https://github.com/sinsinan))。
* クエリ `CHECK TABLE` のパフォーマンスと使い勝手が向上し、進行状況の更新を送信でき、キャンセルも可能になりました。`CHECK TABLE ... PART 'part_name'` を用いて特定のパーツのみをチェックできるようになりました。[#53404](https://github.com/ClickHouse/ClickHouse/pull/53404) ([vdimir](https://github.com/vdimir))。
* 関数 `jsonMergePatch` を追加しました。文字列としての JSON データを扱う際に、JSON オブジェクトを表すこれらの文字列をマージし、1 つの JSON オブジェクトを表す単一の文字列にまとめることができます。 [#54364](https://github.com/ClickHouse/ClickHouse/pull/54364) ([Memo](https://github.com/Joeywzr)).
* Kusto Query Language 方言サポートの第 2 段階です。[第 1 フェーズの実装](https://github.com/ClickHouse/ClickHouse/pull/37961)はすでにマージされています。[#42510](https://github.com/ClickHouse/ClickHouse/pull/42510)（[larryluogit](https://github.com/larryluogit)）。
* 新しい SQL 関数 `arrayRandomSample(arr, k)` を追加しました。これは入力配列から k 個の要素をサンプルとして返します。これまで同様の機能は、たとえば &quot;SELECT arrayReduce(&#39;groupArraySample(3)&#39;, range(10))&quot; のような、あまり使い勝手のよくない構文でのみ実現可能でした。 [#54391](https://github.com/ClickHouse/ClickHouse/pull/54391) ([itayisraelov](https://github.com/itayisraelov))。
* `-ArgMin`/`-ArgMax` 集約コンビネータを導入しました。これにより、最小値／最大値のみで集約できるようになります。ユースケースの一例は [#54818](https://github.com/ClickHouse/ClickHouse/issues/54818) にあります。この PR では、コンビネータを専用フォルダに再編成しています。 [#54947](https://github.com/ClickHouse/ClickHouse/pull/54947) ([Amos Bird](https://github.com/amosbird))。
* `SYSTEM DROP SCHEMA FORMAT CACHE [FOR Protobuf]` を使用して、Protobuf フォーマット用のキャッシュをドロップできるようになりました。 [#55064](https://github.com/ClickHouse/ClickHouse/pull/55064) ([Aleksandr Musorin](https://github.com/AVMusorin)).
* 外部 HTTP Basic認証器を追加。[#55199](https://github.com/ClickHouse/ClickHouse/pull/55199) ([Aleksei Filatov](https://github.com/aalexfvk)).
* 符号なし整数のバイト順を反転させる関数 `byteSwap` を追加しました。これは、IPv4 のように内部的に符号なし整数として表現される型の値のバイト順を入れ替える場合に特に有用です。 [#55211](https://github.com/ClickHouse/ClickHouse/pull/55211) ([Priyansh Agrawal](https://github.com/Priyansh121096))。
* SQL クエリ文字列の整形済みバージョン（複数行にまたがる場合があります）を返す関数 `formatQuery` を追加しました。同様の処理を行いつつ、返される文字列に改行を含めない関数 `formatQuerySingleLine` も追加しました。 [#55239](https://github.com/ClickHouse/ClickHouse/pull/55239) ([Salvatore Mesoraca](https://github.com/aiven-sal))。
* ELF 実行ファイル／ライブラリ／オブジェクトファイルからデバッグシンボルを読み込む `DWARF` 入力フォーマットを追加しました。 [#55450](https://github.com/ClickHouse/ClickHouse/pull/55450)（[Michael Kolupaev](https://github.com/al13n321)）。
* 未解析のレコードとエラーを RabbitMQ、NATS、および FileLog エンジンに保存できるようにしました。ClickHouse が新しいレコードの解析に失敗したときに格納される仮想カラム `_error` および `_raw_message`（NATS と RabbitMQ 用）、`_raw_record`（FileLog 用）を追加しました。この動作は、NATS 用のストレージ設定 `nats_handle_error_mode`、RabbitMQ 用の `rabbitmq_handle_error_mode`、FileLog 用の `handle_error_mode` によって制御され、`kafka_handle_error_mode` と同様です。これが `default` に設定されている場合、ClickHouse がレコードの解析に失敗すると例外がスローされ、`stream` に設定されている場合は、エラーと生のレコードが仮想カラムに保存されます。[#36035](https://github.com/ClickHouse/ClickHouse/issues/36035) をクローズしました。[#55477](https://github.com/ClickHouse/ClickHouse/pull/55477)（[Kruglov Pavel](https://github.com/Avogar)）。
* Keeper クライアントの改善：特定のパス配下にあるすべての子ノード数を返す `get_all_children_number` コマンドを追加。[#55485](https://github.com/ClickHouse/ClickHouse/pull/55485) ([guoxiaolong](https://github.com/guoxiaolongzte))。
* Keeper クライアントの改善：パス直下の子ノード数を返す `get_direct_children_number` コマンドを追加しました。 [#55898](https://github.com/ClickHouse/ClickHouse/pull/55898) ([xuzifu666](https://github.com/xuzifu666)).
* 既存の `SHOW SETTINGS` ステートメントの簡易版である `SHOW SETTING setting_name` ステートメントを追加しました。 [#55979](https://github.com/ClickHouse/ClickHouse/pull/55979) ([Maksim Kita](https://github.com/kitaisreal)).
* `system.parts_columns` テーブルに `substreams` および `filenames` フィールドを追加しました。 [#55108](https://github.com/ClickHouse/ClickHouse/pull/55108) ([Anton Popov](https://github.com/CurtizJ))。
* `SHOW MERGES` クエリのサポートを追加しました。 [#55815](https://github.com/ClickHouse/ClickHouse/pull/55815) ([megao](https://github.com/jetgm)).
* デフォルトで `ORDER BY ()` を使用するための設定 `create_table_empty_primary_key_by_default` を導入。 [#55899](https://github.com/ClickHouse/ClickHouse/pull/55899) ([Srikanth Chekuri](https://github.com/srikanthccv)).



#### パフォーマンスの向上 {#performance-improvement-2}

* ウィンドウ関数の評価後もストリーム数を保持し、並列ストリーム処理を可能にするオプション `query_plan_preserve_num_streams_after_window_functions` を追加しました。 [#50771](https://github.com/ClickHouse/ClickHouse/pull/50771) ([frinkr](https://github.com/frinkr)).
* データ量が小さい場合は、より多くのストリームを解放するようにしました。 [#53867](https://github.com/ClickHouse/ClickHouse/pull/53867) ([Jiebin Sun](https://github.com/jiebinn)).
* RoaringBitmaps がシリアライズ前に最適化されるようになりました。 [#55044](https://github.com/ClickHouse/ClickHouse/pull/55044) ([UnamedRus](https://github.com/UnamedRus)).
* 転置インデックス内のポスティングリストは、内部ビットマップに対して可能な限り最小の表現を使用するよう最適化されました。データの繰り返し度合いによっては、転置インデックスが占有する領域を大幅に削減できる場合があります。 [#55069](https://github.com/ClickHouse/ClickHouse/pull/55069) ([Harry Lee](https://github.com/HarryLeeIBM)).
* Context ロックでの競合を修正しました。これにより、多数の短時間で終了する並行クエリのパフォーマンスが大幅に向上します。 [#55121](https://github.com/ClickHouse/ClickHouse/pull/55121) ([Maksim Kita](https://github.com/kitaisreal)).
* 転置インデックス作成のパフォーマンスを30％向上しました。これは `std::unordered_map` を `absl::flat_hash_map` に置き換えることで実現しています。 [#55210](https://github.com/ClickHouse/ClickHouse/pull/55210) ([Harry Lee](https://github.com/HarryLeeIBM)).
* ORC フィルターのプッシュダウン（rowgroup レベル）をサポート。 [#55330](https://github.com/ClickHouse/ClickHouse/pull/55330) ([李扬](https://github.com/taiyang-li)).
* 多数の一時ファイルを使用する external aggregation のパフォーマンスを改善しました。 [#55489](https://github.com/ClickHouse/ClickHouse/pull/55489) ([Maksim Kita](https://github.com/kitaisreal)).
* セカンダリインデックス用の marks キャッシュに、デフォルトで妥当なサイズを設定し、marks が繰り返し読み込まれることを避けるようにしました。 [#55654](https://github.com/ClickHouse/ClickHouse/pull/55654) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* スキップインデックスを読み取る際に、不必要なインデックスグラニュールの再構築を避けるようにしました。これにより、[#55653](https://github.com/ClickHouse/ClickHouse/issues/55653#issuecomment-1763766009) に対処しました。[#55683](https://github.com/ClickHouse/ClickHouse/pull/55683)（[Amos Bird](https://github.com/amosbird)）。
* 実行時にセット内の CAST をキャッシュすることで、セットの要素型が列の型と完全には一致しない場合でも `IN` 関数のパフォーマンスを向上させました。 [#55712](https://github.com/ClickHouse/ClickHouse/pull/55712) ([Duc Canh Le](https://github.com/canhld94)).
* `ColumnVector::insertMany` および `ColumnVector::insertManyFrom` のパフォーマンスを改善。 [#55714](https://github.com/ClickHouse/ClickHouse/pull/55714) ([frinkr](https://github.com/frinkr)).
* 次の行のキー位置を予測して比較回数を減らすことで、Map の添字アクセスを最適化しました。[#55929](https://github.com/ClickHouse/ClickHouse/pull/55929) ([lgbo](https://github.com/lgbo-ustc)).
* Parquet における struct フィールドのプルーニングをサポート（以前のバージョンでは一部のケースで正しく動作していなかった）。 [#56117](https://github.com/ClickHouse/ClickHouse/pull/56117) ([lgbo](https://github.com/lgbo-ustc)).
* 読み取る行数の推定に基づいて、クエリ実行で使用される並列レプリカ数をチューニングできるようにしました。 [#51692](https://github.com/ClickHouse/ClickHouse/pull/51692) ([Raúl Marín](https://github.com/Algunenano)).
* 多数の一時ファイルが生成される場合における外部集約処理のメモリ消費を最適化しました。 [#54798](https://github.com/ClickHouse/ClickHouse/pull/54798) ([Nikita Taranov](https://github.com/nickitat)).
* `async_socket_for_remote` モード（デフォルト）で実行される分散クエリで、`max_threads` による上限が適用されるようになりました。以前は、一部のクエリが過剰なスレッド（最大で `max_distributed_connections` まで）を作成し、サーバーのパフォーマンス低下を引き起こす可能性がありました。[#53504](https://github.com/ClickHouse/ClickHouse/pull/53504)（[filimonov](https://github.com/filimonov)）。
* ZooKeeper の分散 DDL キューからの DDL 実行時に、スキップ可能なエントリをキャッシュするようにしました。 [#54828](https://github.com/ClickHouse/ClickHouse/pull/54828) ([Duc Canh Le](https://github.com/canhld94)).
* 実験的な転置インデックスでは、一致件数が多すぎるトークン（すなわちポスティングリスト内の行 ID）は保存しません。これによりストレージ容量を節約でき、逐次スキャンと同等またはそれ以上に高速な場合に、効果の薄いインデックスルックアップを回避できます。トークンを保存しないかどうかを制御していた従来のヒューリスティクス（インデックス定義に渡される `density` パラメータ）は、ユーザーにとって分かりづらいものでした。より単純なヒューリスティクスとして、ポスティングリスト内で許可される行 ID の最大数を直接制御する `max_rows_per_postings_list` パラメータ（デフォルト: 64k）に基づく方式が導入されました。[#55616](https://github.com/ClickHouse/ClickHouse/pull/55616)（[Harry Lee](https://github.com/HarryLeeIBM)）。
* `EmbeddedRocksDB` テーブルへの書き込み性能を改善。[#55732](https://github.com/ClickHouse/ClickHouse/pull/55732)（[Duc Canh Le](https://github.com/canhld94)）。
* パーティション内に多数のパーツ（1000 個を超える場合）が存在する場合の ClickHouse の全体的な耐障害性を向上しました。これにより、`TOO_MANY_PARTS` エラーの発生数が減少する可能性があります。 [#55526](https://github.com/ClickHouse/ClickHouse/pull/55526) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* 階層型ディクショナリの読み込み時のメモリ使用量を削減しました。 [#55838](https://github.com/ClickHouse/ClickHouse/pull/55838) ([Nikita Taranov](https://github.com/nickitat)).
* すべてのディクショナリで `dictionary_use_async_executor` を設定可能になりました。[#55839](https://github.com/ClickHouse/ClickHouse/pull/55839)（[vdimir](https://github.com/vdimir)）。
* AggregateFunctionTopKGenericData のデシリアライズ時の過剰なメモリ使用量を防止。 [#55947](https://github.com/ClickHouse/ClickHouse/pull/55947) ([Raúl Marín](https://github.com/Algunenano)).
* 大量の watch を持つ Keeper 上では、`DB::KeeperStorage::getSessionsWithWatchesCount` 内で AsyncMetrics スレッドが一定時間 CPU を 100% 消費してしまう場合があります。修正として、大きな `watches` および `list_watches` セットの走査を回避するようにしました。 [#56054](https://github.com/ClickHouse/ClickHouse/pull/56054) ([Alexander Gololobov](https://github.com/davenger))。
* 設定 `optimize_trivial_approximate_count_query` を追加し、EmbeddedRocksDB ストレージで `count` の近似値を使用するようにしました。また、StorageJoin で trivial count を有効化しました。 [#55806](https://github.com/ClickHouse/ClickHouse/pull/55806) ([Duc Canh Le](https://github.com/canhld94)).



#### 改善点 {#improvement-2}

* 関数 `toDayOfWeek`（MySQL のエイリアス: `DAYOFWEEK`）、`toYearWeek`（`YEARWEEK`）、`toWeek`（`WEEK`）が `String` 引数をサポートするようになりました。これにより、これらの動作が MySQL と同様になります。 [#55589](https://github.com/ClickHouse/ClickHouse/pull/55589) ([Robert Schulze](https://github.com/rschu1ze)).
* `date_time_overflow_behavior` 設定を追加しました。`ignore`、`throw`、`saturate` の値を指定でき、Date、Date32、DateTime64、Integer または Float から Date、Date32、DateTime もしくは DateTime64 への変換時のオーバーフロー時の動作を制御します。 [#55696](https://github.com/ClickHouse/ClickHouse/pull/55696) ([Andrey Zvonov](https://github.com/zvonand)).
* `ALTER TABLE ... ACTION PARTITION [ID] {parameter_name:ParameterType}` のクエリパラメータ対応を実装しました。[#49516](https://github.com/ClickHouse/ClickHouse/issues/49516) をマージし、[#49449](https://github.com/ClickHouse/ClickHouse/issues/49449) をクローズしました。[#55604](https://github.com/ClickHouse/ClickHouse/pull/55604)（[alesapin](https://github.com/alesapin)）。
* EXPLAIN でのプロセッサ ID の表示を、よりわかりやすい形式にしました。 [#48852](https://github.com/ClickHouse/ClickHouse/pull/48852) ([Vlad Seliverstov](https://github.com/behebot)).
* `lifetime` フィールド付きの direct dictionary を作成しようとすると（direct dictionary では `lifetime` は意味を持たないため）、作成時に拒否されるようになりました。修正: [#27861](https://github.com/ClickHouse/ClickHouse/issues/27861)。[#49043](https://github.com/ClickHouse/ClickHouse/pull/49043)（[Rory Crispin](https://github.com/RoryCrispin)）。
* `ALTER TABLE t DROP PARTITION` のようなパーティションを指定するクエリでパラメータの使用を許可しました。[#49449](https://github.com/ClickHouse/ClickHouse/issues/49449) をクローズ。 [#49516](https://github.com/ClickHouse/ClickHouse/pull/49516) ([Nikolay Degterinsky](https://github.com/evillique)).
* `system.zookeeper_connection` に新しいカラム `xid` を追加。 [#50702](https://github.com/ClickHouse/ClickHouse/pull/50702) ([helifu](https://github.com/helifu)).
* 設定の再読み込み後に `system.server_settings` に正しいサーバー設定が表示されるようにしました。 [#53774](https://github.com/ClickHouse/ClickHouse/pull/53774) ([helifu](https://github.com/helifu)).
* クエリで `-` と同様に数学用マイナス記号 `−` 文字をサポートするようにしました。[#54100](https://github.com/ClickHouse/ClickHouse/pull/54100) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 実験的な `Replicated` データベースエンジンにレプリカグループを追加。[#53620](https://github.com/ClickHouse/ClickHouse/issues/53620) をクローズ。[#54421](https://github.com/ClickHouse/ClickHouse/pull/54421)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 再試行可能な S3 エラーは、クエリを即座に失敗させるよりも再試行した方がよいです。そのため、デフォルトの `s3_retry_attempts` の値を大きくしました。 [#54770](https://github.com/ClickHouse/ClickHouse/pull/54770) ([Sema Checherinda](https://github.com/CheSema)).
* ロードバランシングモード `hostname_levenshtein_distance` を追加しました。[#54826](https://github.com/ClickHouse/ClickHouse/pull/54826)（[JackyWoo](https://github.com/JackyWoo)）。
* ログ内のシークレットのマスキングを改善。 [#55089](https://github.com/ClickHouse/ClickHouse/pull/55089) ([Vitaly Baranov](https://github.com/vitlibar)).
* 現時点では、プロジェクションの解析はクエリプランに対してのみ実行されます。設定項目 `query_plan_optimize_projection` は（かなり前からデフォルトで有効になっていたため）廃止されました。 [#55112](https://github.com/ClickHouse/ClickHouse/pull/55112) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
* 関数 `untuple` が名前付き要素を持つタプルに対して呼び出され、かつその関数自体にエイリアスが付いている場合（例: `select untuple(tuple(1)::Tuple(element_alias Int)) AS untuple_alias`）、結果のカラム名は `untuple` のエイリアスとタプル要素のエイリアスから生成されるようになりました（この例では「untuple&#95;alias.element&#95;alias」）。 [#55123](https://github.com/ClickHouse/ClickHouse/pull/55123) ([garcher22](https://github.com/garcher22))。
* テーブルの仮想カラムを `DESCRIBE` クエリの結果に含められるようにする設定 `describe_include_virtual_columns` を追加しました。さらに、設定 `describe_compact_output` を追加しました。これを `true` に設定すると、`DESCRIBE` クエリは追加情報なしでカラム名と型のみを返します。 [#55129](https://github.com/ClickHouse/ClickHouse/pull/55129) ([Anton Popov](https://github.com/CurtizJ)).
* `optimize_throw_if_noop=1` を指定した `OPTIMIZE` がエラー `unknown reason` で失敗することがありましたが、実際の原因はパーツごとに投影が異なることにありました。この挙動は修正されました。 [#55130](https://github.com/ClickHouse/ClickHouse/pull/55130) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
* 同じ Postgres テーブルに対応する複数の `MaterializedPostgreSQL` テーブルを持てるようにしました。デフォルトではこの挙動は無効です（後方互換性のない変更であり、互換性維持のため）が、設定 `materialized_postgresql_use_unique_replication_consumer_identifier` を有効にすることで利用できます。[#54918](https://github.com/ClickHouse/ClickHouse/issues/54918) をクローズ。[#55145](https://github.com/ClickHouse/ClickHouse/pull/55145)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 負の `DateTime64` および `DateTime` を、小数部を含む短い文字列からパースできるようにしました。 [#55146](https://github.com/ClickHouse/ClickHouse/pull/55146) ([Andrey Zvonov](https://github.com/zvonand)).
* MySQL との互換性向上のために、1. `information_schema.tables` に新しいフィールド `table_rows` が追加され、2. `information_schema.columns` にフィールド `extra` が追加されました。 [#55215](https://github.com/ClickHouse/ClickHouse/pull/55215) ([Robert Schulze](https://github.com/rschu1ze)).
* ClickHouse-client は、行数が 0 で、かつ例外がスローされた場合には、「0 rows in set」を表示しません。 [#55240](https://github.com/ClickHouse/ClickHouse/pull/55240) ([Salvatore Mesoraca](https://github.com/aiven-sal))。
* `RENAME db.t1 to db.t2` のように、キーワード `TABLE` なしでテーブルをリネームできるようになりました。 [#55373](https://github.com/ClickHouse/ClickHouse/pull/55373) ([凌涛](https://github.com/lingtaolf))。
* `system.clusters` に `internal_replication` を追加しました。 [#55377](https://github.com/ClickHouse/ClickHouse/pull/55377) ([Konstantin Morozov](https://github.com/k-morozov)).
* リクエストプロトコルに基づいてリモートプロキシリゾルバを選択し、プロキシ機能に関するドキュメントを追加して `DB::ProxyConfiguration::Protocol::ANY` を削除しました。 [#55430](https://github.com/ClickHouse/ClickHouse/pull/55430) ([Arthur Passos](https://github.com/arthurpassos))。
* テーブルのシャットダウン後は、INSERT における Keeper 操作を再試行しないようにしました。 [#55519](https://github.com/ClickHouse/ClickHouse/pull/55519) ([Azat Khuzhin](https://github.com/azat)).
* `SHOW COLUMNS` は、設定 `use_mysql_types_in_show_columns` がオンの場合、型 `FixedString` を正しく `BLOB` として報告するようになりました。さらに、型 `String` および `FixedString` の出力を `TEXT` または `BLOB` に切り替えるための 2 つの新しい設定 `mysql_map_string_to_text_in_show_columns` と `mysql_map_fixed_string_to_text_in_show_columns` が追加されました。 [#55617](https://github.com/ClickHouse/ClickHouse/pull/55617) ([Serge Klochkov](https://github.com/slvrtrn)).
* ReplicatedMergeTree テーブルの起動時、ClickHouse サーバーはパーツの集合について、予期しないパーツ（ローカルには存在するが ZooKeeper には存在しないもの）がないかをチェックします。すべての予期しないパーツは detached ディレクトリに移動され、その代わりにサーバーはそれらをカバーしている祖先パーツを復元しようとします。現在は、サーバーはランダムなカバー済みパーツではなく、最も近い祖先パーツを復元しようとします。 [#55645](https://github.com/ClickHouse/ClickHouse/pull/55645) ([alesapin](https://github.com/alesapin)).
* 高度なダッシュボードで、タッチデバイス上のチャートをドラッグできるようになりました。これにより [#54206](https://github.com/ClickHouse/ClickHouse/issues/54206) がクローズされました。 [#55649](https://github.com/ClickHouse/ClickHouse/pull/55649) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* `http_write_exception_in_output_format` で例外を出力する際、宣言されている場合はデフォルトのクエリフォーマットを使用するようにしました。 [#55739](https://github.com/ClickHouse/ClickHouse/pull/55739) ([Raúl Marín](https://github.com/Algunenano)).
* 一般的なマテリアライズドビューの落とし穴に関するメッセージを、よりわかりやすい内容に改善しました。 [#55826](https://github.com/ClickHouse/ClickHouse/pull/55826) ([Raúl Marín](https://github.com/Algunenano))。
* 現在のデータベースを削除してしまった場合でも、`clickhouse-local` で一部のクエリを実行し、別のデータベースに切り替えることができます。これにより、`clickhouse-client` と動作が一貫します。この変更により [#55834](https://github.com/ClickHouse/ClickHouse/issues/55834) がクローズされました。[#55853](https://github.com/ClickHouse/ClickHouse/pull/55853)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 関数 `(add|subtract)(Year|Quarter|Month|Week|Day|Hour|Minute|Second|Millisecond|Microsecond|Nanosecond)` は、文字列で表現された日付引数をサポートするようになりました。例: `SELECT addDays('2023-10-22', 1)`。これにより MySQL との互換性が向上し、Tableau Online で必要とされる機能が提供されます。 [#55869](https://github.com/ClickHouse/ClickHouse/pull/55869) ([Robert Schulze](https://github.com/rschu1ze)).
* `apply_deleted_mask` 設定を無効化すると、軽量 DELETE クエリによって削除マークが付けられた行を読み取ることができます。これはデバッグに役立ちます。 [#55952](https://github.com/ClickHouse/ClickHouse/pull/55952) ([Alexander Gololobov](https://github.com/davenger)).
* Tuple を JSON オブジェクトにシリアル化する際に `null` 値をスキップできるようにし、Spark の `to_json` 関数との互換性を維持できるようにしました。また、gluten にとっても有用です。 [#55956](https://github.com/ClickHouse/ClickHouse/pull/55956) ([李扬](https://github.com/taiyang-li)).
* 関数 `(add|sub)Date` は、文字列表現の日付引数をサポートするようになりました。例: `SELECT addDate('2023-10-22 11:12:13', INTERVAL 5 MINUTE)`。同様の文字列表現の日付引数のサポートが、加算および減算演算子にも追加されました。例: `SELECT '2023-10-23' + INTERVAL 1 DAY`。これにより MySQL との互換性が向上し、Tableau Online で必要とされる機能が提供されます。 [#55960](https://github.com/ClickHouse/ClickHouse/pull/55960) ([Robert Schulze](https://github.com/rschu1ze))。
* CSV 形式で CR (`\r`) を含む引用符で囲まれていない文字列を許可します。[#39930](https://github.com/ClickHouse/ClickHouse/issues/39930) をクローズします。[#56046](https://github.com/ClickHouse/ClickHouse/pull/56046)（[Kruglov Pavel](https://github.com/Avogar)）。
* 組み込み設定を使用して `clickhouse-keeper` を実行できるようにしました。 [#56086](https://github.com/ClickHouse/ClickHouse/pull/56086) ([Maksim Kita](https://github.com/kitaisreal))。
* Kafka からデータのフェッチを開始する際の問題を回避するため、`queued.min.messages` 設定の最大値に制限を設けました。 [#56121](https://github.com/ClickHouse/ClickHouse/pull/56121) ([Stas Morozov](https://github.com/r3b-fish)).
* SQL 関数 `minSampleSizeContinous` のスペルミスを修正しました（`minSampleSizeContinuous` に名称変更）。後方互換性のため、古い名前も維持されています。これにより次の issue がクローズされました: [#56139](https://github.com/ClickHouse/ClickHouse/issues/56139)。[#56143](https://github.com/ClickHouse/ClickHouse/pull/56143)（[Dorota Szeremeta](https://github.com/orotaday)）。
* サーバーをシャットダウンする前に、ディスク上で破損しているパーツのパスを出力するようになりました。この変更以前は、ディスク上のパーツが破損していてサーバーが起動できない場合、どのパーツが壊れているかを特定するのはほぼ不可能でした。この問題は修正されました。 [#56181](https://github.com/ClickHouse/ClickHouse/pull/56181) ([Duc Canh Le](https://github.com/canhld94))。

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-2}
* Docker 内のデータベースがすでに初期化されている場合、後続の起動時に再度初期化する必要はありません。これにより、データベースが 1000 回の試行以内にロードされない場合にコンテナが無限に再起動してしまう問題を回避できる可能性があります（非常に大きなデータベースやマルチノード構成で発生し得ます）。[#50724](https://github.com/ClickHouse/ClickHouse/pull/50724)（[Alexander Nikolaev](https://github.com/AlexNik)）。
* サブモジュールを含むソースコードを持つリソースは、Darwin 向けの専用ビルドタスクでビルドされます。これにより、サブモジュールを個別にチェックアウトせずに ClickHouse をビルドできます。[#51435](https://github.com/ClickHouse/ClickHouse/pull/51435)（[Ilya Yatsishin](https://github.com/qoega)）。
* ClickHouse を AVX 系の命令をグローバルに有効にした状態でビルドすると（これは推奨されません）、エラーが発生していました。原因は、snappy が `SNAPPY_HAVE_X86_CRC32` を有効にしていないことです。[#55049](https://github.com/ClickHouse/ClickHouse/pull/55049)（[monchickey](https://github.com/monchickey)）。
* `clickhouse-server` パッケージからスタンドアロンの `clickhouse-keeper` を起動する際の問題を解決しました。[#55226](https://github.com/ClickHouse/ClickHouse/pull/55226)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* テストにおいて、RabbitMQ のバージョンを 3.12.6 に更新しました。RabbitMQ テスト用のログ収集を改善しました。[#55424](https://github.com/ClickHouse/ClickHouse/pull/55424)（[Ilya Yatsishin](https://github.com/qoega)）。
* 機能テストを修正するため、openssl と boringssl 間のエラーメッセージの差異を調整しました。[#55975](https://github.com/ClickHouse/ClickHouse/pull/55975)（[MeenaRenganathan22](https://github.com/MeenaRenganathan22)）。
* Apache DataSketches に上流のリポジトリを使用するようにしました。[#55787](https://github.com/ClickHouse/ClickHouse/pull/55787)（[Nikita Taranov](https://github.com/nickitat)）。

#### バグ修正（公式安定版リリースで発生するユーザーに見える不具合） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-2}

* mutation 実行時に転置インデックスファイルのハードリンク作成をスキップ [#47663](https://github.com/ClickHouse/ClickHouse/pull/47663) ([cangyin](https://github.com/cangyin))。
* パターンにオルタネーション（`|`）を含む `match` 関数（正規表現）が誤ったキー条件を生成していたバグを修正。#53222 をクローズ。[#54696](https://github.com/ClickHouse/ClickHouse/pull/54696)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* ARRAY JOIN を用いた read-in-order 最適化で発生する &#39;Cannot find column&#39; エラーを修正 [#51746](https://github.com/ClickHouse/ClickHouse/pull/51746) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* クエリで未対応だった実験的な `Object(Nullable(json))` のサブカラムをサポートしました。 [#54052](https://github.com/ClickHouse/ClickHouse/pull/54052) ([zps](https://github.com/VanDarkholme7))。
* `accurateCastOrNull` 向けの修正を再度適用 [#54629](https://github.com/ClickHouse/ClickHouse/pull/54629) ([Salvatore Mesoraca](https://github.com/aiven-sal))。
* `AS` 句を使用せずに作成された Distributed テーブルの列に対する `DEFAULT` の検出を修正 [#55060](https://github.com/ClickHouse/ClickHouse/pull/55060)（[Vitaly Baranov](https://github.com/vitlibar)）。
* ShellCommandSource のコンストラクタで例外が発生した場合の適切なクリーンアップ [#55103](https://github.com/ClickHouse/ClickHouse/pull/55103) ([Alexander Gololobov](https://github.com/davenger)).
* LDAP で割り当てられたロールの更新時のデッドロックを修正 [#55119](https://github.com/ClickHouse/ClickHouse/pull/55119) ([Julian Maicher](https://github.com/jmaicher)).
* 内部例外に起因するエラー統計の更新を抑制 [#55128](https://github.com/ClickHouse/ClickHouse/pull/55128) ([Robert Schulze](https://github.com/rschu1ze))。
* バックアップ処理におけるデッドロックを修正 [#55132](https://github.com/ClickHouse/ClickHouse/pull/55132) ([alesapin](https://github.com/alesapin)).
* ストレージの Iceberg ファイル取得を修正 [#55144](https://github.com/ClickHouse/ClickHouse/pull/55144) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `set` 内の余分なカラムに対するパーティションプルーニングを修正。 [#55172](https://github.com/ClickHouse/ClickHouse/pull/55172) ([Amos Bird](https://github.com/amosbird)).
* テーブルがアダプティブグラニュラリティを使用している場合の ALTER UPDATE クエリにおけるスキップインデックス再計算の問題を修正しました [#55202](https://github.com/ClickHouse/ClickHouse/pull/55202) ([Duc Canh Le](https://github.com/canhld94)).
* fs キャッシュにおけるバックグラウンド ダウンロードの修正 [#55252](https://github.com/ClickHouse/ClickHouse/pull/55252) ([Kseniia Sumarokova](https://github.com/kssenii)).
* バッファのファイナライズ漏れに起因しうるコンプレッサでのメモリリークを回避 [#55262](https://github.com/ClickHouse/ClickHouse/pull/55262) ([Azat Khuzhin](https://github.com/azat)).
* スパースカラムでの関数の実行を修正 [#55275](https://github.com/ClickHouse/ClickHouse/pull/55275) ([Azat Khuzhin](https://github.com/azat)).
* SELECT FINAL を使用した SummingMergeTree における Nested の誤ったマージを修正しました [#55276](https://github.com/ClickHouse/ClickHouse/pull/55276) ([Azat Khuzhin](https://github.com/azat)).
* S3 上に構築された ReplicatedMergeTree において、ゼロコピーを使用していない場合に detached パーティションを削除できなかったバグを修正 [#55309](https://github.com/ClickHouse/ClickHouse/pull/55309) ([alesapin](https://github.com/alesapin))。
* MergeSortingPartialResultTransform で発生するクラッシュを修正（`remerge` 後にチャンクが 0 個になることが原因）[#55335](https://github.com/ClickHouse/ClickHouse/pull/55335)（[Azat Khuzhin](https://github.com/azat)）。
* 共有例外をスローしていたことが原因で、エラー時に CreatingSetsTransform で発生していたデータレースを修正しました [#55338](https://github.com/ClickHouse/ClickHouse/pull/55338) ([Azat Khuzhin](https://github.com/azat))。
* `trash` の最適化を一定の範囲で修正 [#55353](https://github.com/ClickHouse/ClickHouse/pull/55353) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* StorageHDFS のリークを修正 [#55370](https://github.com/ClickHouse/ClickHouse/pull/55370) ([Azat Khuzhin](https://github.com/azat))。
* cast 演算子での配列のパース処理を修正 [#55417](https://github.com/ClickHouse/ClickHouse/pull/55417) ([Anton Popov](https://github.com/CurtizJ))
* OR フィルターを含むクエリでの仮想カラムによるフィルタリングを修正 [#55418](https://github.com/ClickHouse/ClickHouse/pull/55418) ([Azat Khuzhin](https://github.com/azat))。
* MongoDB 接続の問題を修正 [#55419](https://github.com/ClickHouse/ClickHouse/pull/55419)（[Nikolay Degterinsky](https://github.com/evillique)）。
* MySQL インターフェイスにおけるブール値の表現を修正 [#55427](https://github.com/ClickHouse/ClickHouse/pull/55427) ([Serge Klochkov](https://github.com/slvrtrn))。
* MySQL テキストプロトコルにおける DateTime のフォーマットと LowCardinality(Nullable(T)) 型の報告を修正 [#55479](https://github.com/ClickHouse/ClickHouse/pull/55479)（[Serge Klochkov](https://github.com/slvrtrn)）。
* `use_mysql_types_in_show_columns` が `SHOW COLUMNS` のみに影響するように変更しました [#55481](https://github.com/ClickHouse/ClickHouse/pull/55481) ([Robert Schulze](https://github.com/rschu1ze)).
* スタックシンボライザーが `DW_FORM_ref_addr` を誤ってパースし、稀にクラッシュしていた問題を修正 [#55483](https://github.com/ClickHouse/ClickHouse/pull/55483) ([Michael Kolupaev](https://github.com/al13n321)).
* 例外発生時には AsyncTaskExecutor の cancelBefore 内で fiber を破棄する [#55516](https://github.com/ClickHouse/ClickHouse/pull/55516) ([Kruglov Pavel](https://github.com/Avogar))。
* カスタム HTTP ハンドラーでクエリパラメータが動作しない問題を修正 [#55521](https://github.com/ClickHouse/ClickHouse/pull/55521) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* Values 形式での未処理データの検査処理を修正 [#55527](https://github.com/ClickHouse/ClickHouse/pull/55527) ([Azat Khuzhin](https://github.com/azat)).
* ODBC 経由で MS SQL Server と連携する際に発生する &#39;Invalid cursor state&#39; エラーを修正 [#55558](https://github.com/ClickHouse/ClickHouse/pull/55558) ([vdimir](https://github.com/vdimir)).
* 最大実行時間と&#39;break&#39; オーバーフロー モードを修正 [#55577](https://github.com/ClickHouse/ClickHouse/pull/55577) ([Alexander Gololobov](https://github.com/davenger))。
* 循環エイリアスが原因の QueryNormalizer のクラッシュを修正 [#55602](https://github.com/ClickHouse/ClickHouse/pull/55602) ([vdimir](https://github.com/vdimir))。
* 誤った最適化を無効にし、テストを追加 [#55609](https://github.com/ClickHouse/ClickHouse/pull/55609)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* [#52352](https://github.com/ClickHouse/ClickHouse/issues/52352) と [#55621](https://github.com/ClickHouse/ClickHouse/pull/55621) のマージ（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 小数の誤ったソートを防ぐためのテストを追加 [#55662](https://github.com/ClickHouse/ClickHouse/pull/55662) ([Amos Bird](https://github.com/amosbird))。
* グロブを含まない URL を使用する S3 および Azure の Cluster 関数のプログレスバーを修正しました [#55666](https://github.com/ClickHouse/ClickHouse/pull/55666) ([Kruglov Pavel](https://github.com/Avogar))。
* OR フィルタを含むクエリにおける仮想カラムによるフィルタリングを修正 (再投稿) [#55678](https://github.com/ClickHouse/ClickHouse/pull/55678) ([Azat Khuzhin](https://github.com/azat)).
* Iceberg ストレージに関する修正および改善 [#55695](https://github.com/ClickHouse/ClickHouse/pull/55695) ([Kruglov Pavel](https://github.com/Avogar))。
* CreatingSetsTransform (v2) におけるデータ競合を修正 [#55786](https://github.com/ClickHouse/ClickHouse/pull/55786) ([Azat Khuzhin](https://github.com/azat))。
* `precise_float_parsing` が true の場合に、不正な文字列を float としてパースしようとしたときに例外をスローするように変更 [#55861](https://github.com/ClickHouse/ClickHouse/pull/55861) ([李扬](https://github.com/taiyang-li))。
* CTE にステートフル関数が含まれている場合は述語プッシュダウンを無効化する [#55871](https://github.com/ClickHouse/ClickHouse/pull/55871) ([Raúl Marín](https://github.com/Algunenano))。
* クエリから `FORMAT` が削除されてしまっていた normalize ASTSelectWithUnionQuery を修正 [#55887](https://github.com/ClickHouse/ClickHouse/pull/55887) ([flynn](https://github.com/ucasfl))。
* Native ORC 入力フォーマットで発生し得るセグフォールトを修正しました [#55891](https://github.com/ClickHouse/ClickHouse/pull/55891) ([Kruglov Pavel](https://github.com/Avogar))。
* 疎なカラムを含む場合のウィンドウ関数の動作を修正。 [#55895](https://github.com/ClickHouse/ClickHouse/pull/55895) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* 修正: StorageNull がサブカラムをサポートするようになりました [#55912](https://github.com/ClickHouse/ClickHouse/pull/55912) ([FFish](https://github.com/wxybear))。
* Replicated テーブルの mutate/merge で発生した再試行可能なエラーをエラーログに書き出さないようにしました [#55944](https://github.com/ClickHouse/ClickHouse/pull/55944) ([Azat Khuzhin](https://github.com/azat)).
* `SHOW DATABASES LIMIT <N>` を修正しました [#55962](https://github.com/ClickHouse/ClickHouse/pull/55962) ([Raúl Marín](https://github.com/Algunenano))。
* アンダースコアを含むフィールドを持つ自動生成 Protobuf スキーマを修正 [#55974](https://github.com/ClickHouse/ClickHouse/pull/55974) ([Kruglov Pavel](https://github.com/Avogar))。
* 非デフォルトのスケール使用時の dateTime64ToSnowflake64() を修正 [#55983](https://github.com/ClickHouse/ClickHouse/pull/55983)（[Robert Schulze](https://github.com/rschu1ze)）。
* Arrow の辞書カラムの入出力を修正 [#55989](https://github.com/ClickHouse/ClickHouse/pull/55989) ([Kruglov Pavel](https://github.com/Avogar)).
* AvroConfluent での schema registry からのスキーマ取得処理を修正 [#55991](https://github.com/ClickHouse/ClickHouse/pull/55991) ([Kruglov Pavel](https://github.com/Avogar))。
* Buffer テーブルでの ALTER と INSERT の同時実行時に発生する &#39;Block structure mismatch&#39; エラーを修正 [#55995](https://github.com/ClickHouse/ClickHouse/pull/55995) ([Michael Kolupaev](https://github.com/al13n321)).
* least&#95;used JBOD ポリシーにおける空き容量の誤った計上を修正 [#56030](https://github.com/ClickHouse/ClickHouse/pull/56030) ([Azat Khuzhin](https://github.com/azat)).
* テーブル関数内でサブクエリを評価する際にスカラー値が見つからなくなる問題を修正 [#56057](https://github.com/ClickHouse/ClickHouse/pull/56057) ([Amos Bird](https://github.com/amosbird))。
* http&#95;write&#95;exception&#95;in&#95;output&#95;format=1 設定時に誤ったクエリ結果が返される問題を修正 [#56135](https://github.com/ClickHouse/ClickHouse/pull/56135) ([Kruglov Pavel](https://github.com/Avogar))。
* 設定変更後に使用されるフォールバック JSON-&gt;JSONEachRow のスキーマキャッシュを修正 [#56172](https://github.com/ClickHouse/ClickHouse/pull/56172) ([Kruglov Pavel](https://github.com/Avogar))。
* odbc-bridge にエラーハンドラを追加 [#56185](https://github.com/ClickHouse/ClickHouse/pull/56185) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).

### <a id="239"></a> ClickHouse リリース 23.9, 2023-09-28 {#239}

#### 後方互換性のない変更 {#backward-incompatible-change-3}
* デフォルトの Prometheus ハンドラから `status_info` 設定オプションとディクショナリのステータス情報を削除しました。 [#54090](https://github.com/ClickHouse/ClickHouse/pull/54090) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 実験的な parts メタデータキャッシュをコードベースから削除しました。 [#54215](https://github.com/ClickHouse/ClickHouse/pull/54215) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* デフォルトで `input_format_json_try_infer_numbers_from_strings` を有効にしないようにしました。これにより、サンプルデータに数値のように見える文字列が含まれている場合に発生しうる解析エラーを避けるため、JSON 形式で文字列から数値を推論しない挙動がデフォルトになります。 [#55099](https://github.com/ClickHouse/ClickHouse/pull/55099) ([Kruglov Pavel](https://github.com/Avogar)).

#### 新機能 {#new-feature-3}

* JSON フォーマットからのスキーマ推論を改善しました。1) JSON フォーマットにおいて、設定 `input_format_json_try_infer_named_tuples_from_objects` のもとで、実験的な JSON 型を使わずに JSON オブジェクトから名前付き Tuple を推論できるようになりました。これまで実験的な JSON 型なしでは、JSON オブジェクトは String か Map としてしか推論できませんでしたが、今では名前付き Tuple を推論できます。生成される Tuple 型には、スキーマ推論時のデータサンプルで読み込まれたオブジェクトのすべてのキーが含まれます。これは、スパースでない構造化 JSON データを読み取る際に有用です。この設定はデフォルトで有効になっています。2) 設定 `input_format_json_read_arrays_as_strings` のもとで、JSON 配列を型 String のカラムとしてパースできるようになりました。これにより、異なる型の値を含む配列の読み取りに役立ちます。3) 設定 `input_format_json_infer_incomplete_types_as_strings` のもとで、サンプルデータ内で型が不明 (`null`/`[]`/`{}`) な JSON キーに対して、型 String を使用できるようになりました。これにより JSON フォーマットでは、任意の値を String カラムに読み込むことができ、未知の型に対して String 型を用いることで、スキーマ推論中に `Cannot determine type for column 'column_name' by first 25000 rows of data, most likely this column contains only Nulls or empty Arrays/Maps` というエラーが発生するのを回避し、データを正常に読み込むことができます。 [#54427](https://github.com/ClickHouse/ClickHouse/pull/54427) ([Kruglov Pavel](https://github.com/Avogar)).
* リモートディスク向けの IO スケジューリングのサポートを追加しました。ディスク種別 `s3`、`s3_plain`、`hdfs`、`azure_blob_storage` のストレージ設定に、リソース名を保持する `read_resource` と `write_resource` 要素を含められるようになりました。これらのリソース向けのスケジューリングポリシーは、別のサーバー設定セクション `resources` で構成できます。`workload` 設定を用いてクエリにラベル付けし、サーバー設定セクション `workload_classifiers` を使って分類することで、さまざまなリソーススケジューリング上の目標を達成できます。詳細は[ドキュメント](/operations/workload-scheduling)を参照してください。 [#47009](https://github.com/ClickHouse/ClickHouse/pull/47009) ([Sergei Trifonov](https://github.com/serxa))。`bandwidth_limit` IO スケジューリングノードタイプを追加しました。これにより、このノードを通過するトラフィックに対して `max_speed` および `max_burst` の制約を指定できます。 [#54618](https://github.com/ClickHouse/ClickHouse/pull/54618) ([Sergei Trifonov](https://github.com/serxa))。
* SSH キーに基づく新しい認証方式を追加しました。これはネイティブ TCP プロトコルでのみ動作します。 [#41109](https://github.com/ClickHouse/ClickHouse/pull/41109) ([George Gamezardashvili](https://github.com/InfJoker)).
* MergeTree テーブルに `_block_number` という新しいカラムを追加しました。 [#44532](https://github.com/ClickHouse/ClickHouse/issues/44532)。 [#47532](https://github.com/ClickHouse/ClickHouse/pull/47532)（[SmitaRKulkarni](https://github.com/SmitaRKulkarni)）。
* `DROP TABLE` クエリで `IF EMPTY` 句を使用できるようにしました。 [#48915](https://github.com/ClickHouse/ClickHouse/pull/48915) ([Pavel Novitskiy](https://github.com/pnovitskiy)).
* SQL 関数 `toString(datetime, timezone)` および `formatDateTime(datetime, format, timezone)` が、非定数の timezone 引数をサポートするようになりました。[#53680](https://github.com/ClickHouse/ClickHouse/pull/53680) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* `ALTER TABLE MODIFY COMMENT` のサポートを追加しました。注記: 以前、外部コントリビューターにより類似の機能が追加されましたが、その機能はまったく動作せず、ユーザーを混乱させるだけでした。これにより [#36377](https://github.com/ClickHouse/ClickHouse/issues/36377) がクローズされました。 [#51304](https://github.com/ClickHouse/ClickHouse/pull/51304) ([Alexey Milovidov](https://github.com/alexey-milovidov))。注記: このコマンドはレプリカ間で伝播しないため、同じテーブルでもレプリカごとに異なるコメントを持つ可能性があります。
* 新しいデータ圧縮コーデックとして `GCD`（greatest common denominator、最大公約数）を追加しました。このコーデックは列内のすべての値の GCD を計算し、その GCD で各値を割ります。GCD コーデックは（Delta や DoubleDelta と同様の）データ前処理用コーデックであり、単体では使用できません。整数型、decimal 型、および日付/時刻型のデータで動作します。GCD コーデックの代表的なユースケースとしては、列の値が GCD の倍数で増減するケースが挙げられます（例: 24 - 28 - 16 - 24 - 8 - 24、ここでは GCD = 4 と仮定）。[#53149](https://github.com/ClickHouse/ClickHouse/pull/53149) ([Alexander Nam](https://github.com/seshWCS)).
* 2 つの新しい型エイリアス `DECIMAL(P)`（`DECIMAL(P, 0)` の省略形）と `DECIMAL`（`DECIMAL(10, 0)` の省略形）が追加されました。これにより、ClickHouse は MySQL の SQL 方言との互換性が向上しました。[#53328](https://github.com/ClickHouse/ClickHouse/pull/53328) ([Val Doroshchuk](https://github.com/valbok))。
* すべての `BACKUP` および `RESTORE` 操作を追跡できる新しいシステムログテーブル `backup_log` を追加しました。 [#53638](https://github.com/ClickHouse/ClickHouse/pull/53638) ([Victor Krasnov](https://github.com/sirvickr)).
* `output_format_markdown_escape_special_characters` というフォーマット設定（デフォルト: false）を追加しました。この設定は、`Markdown` 出力フォーマットにおいて `!`、`#`、`$` などの特殊文字をエスケープ（バックスラッシュを前置）するかどうかを制御します。[#53860](https://github.com/ClickHouse/ClickHouse/pull/53860)（[irenjj](https://github.com/irenjj)）。
* 関数 `decodeHTMLComponent` を追加しました。 [#54097](https://github.com/ClickHouse/ClickHouse/pull/54097) ([Bharat Nallan](https://github.com/bharatnc)).
* `query_log` テーブルに `peak_threads_usage` を追加しました。 [#54335](https://github.com/ClickHouse/ClickHouse/pull/54335)（[Alexey Gerasimchuck](https://github.com/Demilivor)）
* clickhouse-client に `SHOW FUNCTIONS` のサポートを追加。[#54337](https://github.com/ClickHouse/ClickHouse/pull/54337)（[Julia Kartseva](https://github.com/wat-ze-hex)）。
* 関数 `toDaysSinceYearZero` を追加しました。MySQL との互換性のためのエイリアス `TO_DAYS` を持ち、`0001-01-01`（プロレプティック・グレゴリオ暦）から経過した日数を返します。[#54479](https://github.com/ClickHouse/ClickHouse/pull/54479)（[Robert Schulze](https://github.com/rschu1ze)）。関数 `toDaysSinceYearZero` は、`DateTime` および `DateTime64` 型の引数をサポートするようになりました。[#54856](https://github.com/ClickHouse/ClickHouse/pull/54856)（[Serge Klochkov](https://github.com/slvrtrn)）。
* 関数 `YYYYMMDDtoDate`、`YYYYMMDDtoDate32`、`YYYYMMDDhhmmssToDateTime`、`YYYYMMDDhhmmssToDateTime64` を追加しました。これらは、整数値で表現された日付または日時（例: 20230911）をネイティブな日付または日時に変換します。そのため、既存の関数 `YYYYMMDDToDate`、`YYYYMMDDToDateTime`、`YYYYMMDDhhmmddToDateTime`、`YYYYMMDDhhmmddToDateTime64` の逆変換を行います。 [#54509](https://github.com/ClickHouse/ClickHouse/pull/54509) ([Quanfa Fu](https://github.com/dentiscalprum)) ([Robert Schulze](https://github.com/rschu1ze)).
* `byteHammingDistance`、`editDistance` を含む複数の文字列距離関数を追加しました。[#54935](https://github.com/ClickHouse/ClickHouse/pull/54935) ([flynn](https://github.com/ucasfl))。
* ユーザー資格情報について、有効期限日および（必要に応じて）時刻を `VALID UNTIL datetime` 句で指定できるようにしました。 [#51261](https://github.com/ClickHouse/ClickHouse/pull/51261) ([Nikolay Degterinsky](https://github.com/evillique)).
* テーブル関数 `s3`、`gcs`、`oss` に対して S3 形式の URL を許可します。URL は自動的に HTTP URL に変換されます。例: `'s3://clickhouse-public-datasets/hits.csv'` は `'https://clickhouse-public-datasets.s3.amazonaws.com/hits.csv'` に変換されます。[#54931](https://github.com/ClickHouse/ClickHouse/pull/54931)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 新しい設定 `print_pretty_type_names` を追加し、Tuple/Maps/Arrays のような深くネストされた型を可読性の高い形式で出力できるようにしました。 [#55095](https://github.com/ClickHouse/ClickHouse/pull/55095) ([Kruglov Pavel](https://github.com/Avogar))。



#### パフォーマンスの向上 {#performance-improvement-3}

* S3 からの読み込みを高速化するため、デフォルトでプリフェッチを有効にしました。 [#53709](https://github.com/ClickHouse/ClickHouse/pull/53709) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* FINAL を付けたクエリで不要な場合、単独のパーツでは PK とバージョン列を暗黙的に読み込まないようにしました。 [#53919](https://github.com/ClickHouse/ClickHouse/pull/53919) ([Duc Canh Le](https://github.com/canhld94)).
* 定数キーを使った GROUP BY を最適化します。[https://github.com/ClickHouse/ClickHouse/pull/53529](https://github.com/ClickHouse/ClickHouse/pull/53529) の後、`_file` / `_path` をキーとする GROUP BY を含むクエリが最適化されます。[#53549](https://github.com/ClickHouse/ClickHouse/pull/53549)（[Kruglov Pavel](https://github.com/Avogar)）。
* `Decimal` カラムのソート性能を改善。ORDER BY 句に `Decimal` カラムが含まれている場合の `MergeTree` への挿入性能を改善。データがすでにソート済み、またはほぼソート済みの場合のソート性能を改善。 [#35961](https://github.com/ClickHouse/ClickHouse/pull/35961) ([Maksim Kita](https://github.com/kitaisreal)).
* 巨大なクエリの解析パフォーマンスを改善。[#51224](https://github.com/ClickHouse/ClickHouse/issues/51224) を修正。[#51469](https://github.com/ClickHouse/ClickHouse/pull/51469) ([frinkr](https://github.com/frinkr))。
* `COUNT(DISTINCT ...)` および各種 `uniq` 系集約関数を、GROUP BY を含むサブクエリから選択されている場合に `count` へ書き換える最適化。 [#52082](https://github.com/ClickHouse/ClickHouse/pull/52082) [#52645](https://github.com/ClickHouse/ClickHouse/pull/52645) ([JackyWoo](https://github.com/JackyWoo)).
* `mmap/mremap/munmap` への手動呼び出しを削除し、この処理をすべて `jemalloc` に委譲することで、パフォーマンスがわずかに向上します。 [#52792](https://github.com/ClickHouse/ClickHouse/pull/52792) ([Nikita Taranov](https://github.com/nickitat)).
* NATS を使用している際に CPU 使用率が高くなる問題を修正しました。 [#54399](https://github.com/ClickHouse/ClickHouse/pull/54399) ([Vasilev Pyotr](https://github.com/vahpetr)).
* datetime 引数付きで `toString` を実行するための専用命令を別途用意しているため、datetime 以外の引数に対してはパフォーマンスを少し向上させるとともに、一部のコードをよりクリーンにできます。[#53680](https://github.com/ClickHouse/ClickHouse/issues/53680) のフォローアップです。[#54443](https://github.com/ClickHouse/ClickHouse/pull/54443)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* `std::stringstream` に JSON 要素をシリアライズする代わりに、この PR ではシリアライズ結果を直接 `ColumnString` に格納するようにしています。 [#54613](https://github.com/ClickHouse/ClickHouse/pull/54613) ([lgbo](https://github.com/lgbo-ustc))。
* ビューを介して参照されている MergeTree テーブルから、対応する順序でデータを読み取れるようにする ORDER BY 最適化を有効にしました。 [#54628](https://github.com/ClickHouse/ClickHouse/pull/54628) ([Vitaly Baranov](https://github.com/vitlibar)).
* `GeneratorJSONPath` を再利用し、いくつかの shared pointer を削除することで JSON 関連の SQL 関数を改善しました。 [#54735](https://github.com/ClickHouse/ClickHouse/pull/54735) ([lgbo](https://github.com/lgbo-ustc)).
* Keeper はパフォーマンス向上のため、リクエストのフラッシュをバッチ化して行おうとします。 [#53049](https://github.com/ClickHouse/ClickHouse/pull/53049) ([Antonio Andelic](https://github.com/antonio2368))。
* `INFILE 'glob_expression'` を使用する場合、`clickhouse-client` がファイルを並列処理するようになりました。これにより [#54218](https://github.com/ClickHouse/ClickHouse/issues/54218) がクローズされました。 [#54533](https://github.com/ClickHouse/ClickHouse/pull/54533)（[Max K.](https://github.com/mkaynov)）。
* 主キー列の型が `IN` 関数の右辺の列の型と異なる場合でも、`IN` 関数で主キーを使用できるようにしました。例: `SELECT id FROM test_table WHERE id IN (SELECT '5')`。 [#48936](https://github.com/ClickHouse/ClickHouse/issues/48936) をクローズしました。 [#54544](https://github.com/ClickHouse/ClickHouse/pull/54544) ([Maksim Kita](https://github.com/kitaisreal))。
* Hash JOIN は、内部バッファを縮小しようとする際に、利用可能な最大メモリ（`max_bytes_in_join` で設定）の約半分を消費します。 [#54584](https://github.com/ClickHouse/ClickHouse/pull/54584) ([vdimir](https://github.com/vdimir))。
* array join で `max_block_size` を尊重し、OOM が発生する可能性を回避するようにしました。[#54290](https://github.com/ClickHouse/ClickHouse/issues/54290) をクローズしました。[#54664](https://github.com/ClickHouse/ClickHouse/pull/54664)（[李扬](https://github.com/taiyang-li)）。
* `s3` テーブル関数で HTTP 接続を再利用できるようにしました。 [#54812](https://github.com/ClickHouse/ClickHouse/pull/54812) ([Michael Kolupaev](https://github.com/al13n321)).
* `MergeTreeRangeReader::Stream::ceilRowsToCompleteGranules` における線形探索を二分探索に置き換え。 [#54869](https://github.com/ClickHouse/ClickHouse/pull/54869) ([usurai](https://github.com/usurai)).

#### 実験的機能 {#experimental-feature}
* `Annoy` インデックスの作成は、設定項目 `max_threads_for_annoy_index_creation` を使用して並列化できるようになりました。 [#54047](https://github.com/ClickHouse/ClickHouse/pull/54047) ([Robert Schulze](https://github.com/rschu1ze)).
* 分散テーブルを介した parallel replicas は、すべてのレプリカから読み取らないようになりました。 [#54199](https://github.com/ClickHouse/ClickHouse/pull/54199) ([Igor Nikonov](https://github.com/devcrafter)).

#### 改善 {#improvement-3}

* `MergeTree` データパーツ内のファイル名やカラム名が長くなる場合に、それらを名前のハッシュ値に置き換えられるようにしました。これにより、一部の状況で発生する `File name too long` エラーを回避できます。 [#50612](https://github.com/ClickHouse/ClickHouse/pull/50612) ([Anton Popov](https://github.com/CurtizJ)).
* メタデータのパースに失敗した場合、`JSON` 形式のデータを `JSONEachRow` としてパースします。これにより、実際の形式が JSONEachRow であっても、拡張子が `.json` のファイルを読み取ることができるようになります。[#45740](https://github.com/ClickHouse/ClickHouse/issues/45740) をクローズしました。[#54405](https://github.com/ClickHouse/ClickHouse/pull/54405)（[Kruglov Pavel](https://github.com/Avogar)）。
* HTTP クエリの実行中に例外が発生した場合、有効な JSON/XML を出力するようになりました。この挙動は設定 `http_write_exception_in_output_format` で有効/無効を切り替えられます（デフォルトは有効）。 [#52853](https://github.com/ClickHouse/ClickHouse/pull/52853) ([Kruglov Pavel](https://github.com/Avogar)).
* `information_schema.tables` ビューに新しいフィールド `data_length` が追加され、ディスク上のデータのおおよそのサイズを表示できるようになりました。これは Amazon QuickSight によって生成されるクエリを実行するために必要があります。 [#55037](https://github.com/ClickHouse/ClickHouse/pull/55037) ([Robert Schulze](https://github.com/rschu1ze)).
* MySQL インターフェイスにプリペアドステートメントの最小限の実装が追加され、MySQL コネクタ経由で Tableau Online から ClickHouse への接続ができるようになりました。 [#54115](https://github.com/ClickHouse/ClickHouse/pull/54115) ([Serge Klochkov](https://github.com/slvrtrn))。注意: プリペアドステートメントの実装はかなり最小限であり、現在は引数バインドをまだサポートしていません。この特定の Tableau Online のユースケースでは必要ないためです。Tableau Online の包括的なテストを行ったうえで問題が見つかった場合には、必要に応じてフォローアップとして実装される予定です。
* `regexp_tree` 辞書で、case-insensitive（大文字小文字を区別しない）および dot-all のマッチングモードをサポートしました。 [#50906](https://github.com/ClickHouse/ClickHouse/pull/50906) ([Johann Gan](https://github.com/johanngan)).
* Keeper の改良: `createIfNotExists` コマンドを追加。 [#48855](https://github.com/ClickHouse/ClickHouse/pull/48855) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* 整数型推論の精度を向上し、[#51236](https://github.com/ClickHouse/ClickHouse/issues/51236) を修正。[#53003](https://github.com/ClickHouse/ClickHouse/pull/53003)（[Chen768959](https://github.com/Chen768959)）。
* MaterializedMySQL における文字列リテラルに対する文字セットの解決処理を導入しました。 [#53220](https://github.com/ClickHouse/ClickHouse/pull/53220) ([Val Doroshchuk](https://github.com/valbok))。
* ほとんど使用されない `EmbeddedRocksDB` テーブルエンジンにおいて、きわめてまれな状況で発生する細かな問題を修正しました。`DROP TABLE` 実行後に、`EmbeddedRocksDB` テーブルエンジンが NFS 上のファイルを正しくクローズしないことがある不具合です。 [#53502](https://github.com/ClickHouse/ClickHouse/pull/53502) ([Mingliang Pan](https://github.com/liangliangpan)).
* `RESTORE TABLE ON CLUSTER` は、各ホスト上に同一の UUID を持つレプリケーテッドテーブルを作成する必要があります。そうしないと、ZooKeeper パス内のマクロ `{uuid}` が RESTORE 後に正しく機能しません。この PR でその対応を行いました。 [#53765](https://github.com/ClickHouse/ClickHouse/pull/53765) ([Vitaly Baranov](https://github.com/vitlibar))。
* `restore_broken_parts_as_detached` という復元設定を追加しました。これが true の場合、RESTORE 処理は復元中に破損したパーツで停止せず、その代わりにすべての破損したパーツを、`broken-from-backup` というプレフィックス付きで `detached` フォルダにコピーします。false の場合、RESTORE 処理は最初の破損したパーツ（存在する場合）のところで停止します。デフォルト値は false です。 [#53877](https://github.com/ClickHouse/ClickHouse/pull/53877) ([Vitaly Baranov](https://github.com/vitlibar))。
* HTTP ヘッダー `X-ClickHouse-Progress` および `X-ClickHouse-Summary` に `elapsed_ns` フィールドを追加しました。 [#54179](https://github.com/ClickHouse/ClickHouse/pull/54179) ([joelynch](https://github.com/joelynch)).
* keeper-client 用に `reconfig`（[https://github.com/ClickHouse/ClickHouse/pull/49450](https://github.com/ClickHouse/ClickHouse/pull/49450)）、`sync`、`exists` コマンドを実装しました。[#54201](https://github.com/ClickHouse/ClickHouse/pull/54201)（[pufit](https://github.com/pufit)）。
* `clickhouse-local` と `clickhouse-client` では、`--query` パラメータを複数回指定できるようになりました。たとえば、`./clickhouse-client --query "SELECT 1" --query "SELECT 2"` のように指定します。この構文は `./clickhouse-client --multiquery "SELECT  1;S ELECT 2"` よりもわずかに直感的であり、スクリプトから利用するのも容易で（例: `queries.push_back('--query "$q"')`）、既存のパラメータ `--queries-file` の動作（例: `./clickhouse client --queries-file queries1.sql --queries-file queries2.sql`）ともより一貫しています。[#54249](https://github.com/ClickHouse/ClickHouse/pull/54249)（[Robert Schulze](https://github.com/rschu1ze)）。
* `formatReadableTimeDelta` にサブ秒精度を追加。 [#54250](https://github.com/ClickHouse/ClickHouse/pull/54250) ([Andrey Zvonov](https://github.com/zvonand)).
* `allow_remove_stale_moving_parts` をデフォルトで有効にしました。 [#54260](https://github.com/ClickHouse/ClickHouse/pull/54260) ([vdimir](https://github.com/vdimir))。
* キャッシュからの `count` 利用を修正し、アーカイブ読み取り時の進行状況バーを改善。[#54271](https://github.com/ClickHouse/ClickHouse/pull/54271) ([Kruglov Pavel](https://github.com/Avogar)).
* SSO 経由の S3 認証情報のサポートを追加しました。SSO で使用するプロファイルを定義するには、`AWS_PROFILE` 環境変数を設定します。[#54347](https://github.com/ClickHouse/ClickHouse/pull/54347) ([Antonio Andelic](https://github.com/antonio2368))。
* 入力フォーマットにおいて、ネストされた型 Array/Tuple/Map のデフォルト値として NULL をサポート。 [#51100](https://github.com/ClickHouse/ClickHouse/issues/51100) をクローズ。 [#54351](https://github.com/ClickHouse/ClickHouse/pull/54351)（[Kruglov Pavel](https://github.com/Avogar)）。
* Arrow/Parquet 形式での一部の特殊なチャンク構成からも読み取れるようにしました。 [#54370](https://github.com/ClickHouse/ClickHouse/pull/54370) ([Arthur Passos](https://github.com/arthurpassos)).
* MySQL との互換性のために `stddevPop` 関数に `STD` エイリアスを追加。[#54274](https://github.com/ClickHouse/ClickHouse/issues/54274) をクローズ。[#54382](https://github.com/ClickHouse/ClickHouse/pull/54382)（[Nikolay Degterinsky](https://github.com/evillique)）。
* MySQL との互換性のために `addDate` 関数を、一貫性のために `subDate` 関数を追加。[#54275](https://github.com/ClickHouse/ClickHouse/issues/54275) を参照してください。[#54400](https://github.com/ClickHouse/ClickHouse/pull/54400)（[Nikolay Degterinsky](https://github.com/evillique)）。
* `system.detached_parts` に `modification_time` を追加しました。 [#54506](https://github.com/ClickHouse/ClickHouse/pull/54506) ([Azat Khuzhin](https://github.com/azat)).
* 引数「max&#95;substring」に 0 より大きい値が指定された場合に、関数「splitBy*()」が残りの文字列（存在する場合）を結果配列に含めるかどうか（Python/Spark のセマンティクス）を制御する設定 `splitby_max_substrings_includes_remaining_string` を追加しました。デフォルトの動作は変更されていません。 [#54518](https://github.com/ClickHouse/ClickHouse/pull/54518) ([Robert Schulze](https://github.com/rschu1ze))。
* `Int64`/`UInt64` フィールドに対する整数型の推論を改善。[#53003](https://github.com/ClickHouse/ClickHouse/pull/53003) の継続。配列の配列のようなネストした型や `map`/`tuple` のような関数にも対応するようになりました。Issue: [#51236](https://github.com/ClickHouse/ClickHouse/issues/51236)。[#54553](https://github.com/ClickHouse/ClickHouse/pull/54553)（[Kruglov Pavel](https://github.com/Avogar)）。
* スカラーに対する乗算・除算・剰余演算の配列演算を追加しました。`5 * [5, 5]` や `[5, 5] * 5` のように、どちらの順序でも利用でき、両方のケースが可能です。 [#54608](https://github.com/ClickHouse/ClickHouse/pull/54608) ([Yarik Briukhovetskyi](https://github.com/yariks5s))。
* `keeper-client` の `rm` コマンドにオプションの `version` 引数を追加して、削除をより安全に行えるようにしました。 [#54708](https://github.com/ClickHouse/ClickHouse/pull/54708) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* Buffer テーブル使用時にデータ損失を招く可能性があるため、systemd によるサーバーの強制終了を無効化。 [#54744](https://github.com/ClickHouse/ClickHouse/pull/54744) ([Azat Khuzhin](https://github.com/azat)).
* システムテーブル `system.functions` にフィールド `is_deterministic` を追加しました。このフィールドは、（まったく同じ入力が与えられた場合に）関数の結果が 2 回の呼び出し間で一定かどうかを示します。 [#54766](https://github.com/ClickHouse/ClickHouse/pull/54766) [#55035](https://github.com/ClickHouse/ClickHouse/pull/55035) ([Robert Schulze](https://github.com/rschu1ze))。
* スキーマ `information_schema` 内のビューを、MySQL の同等のビューとの互換性がより高くなるように変更・拡張し、Tableau Online から ClickHouse へ接続できるレベルまで対応しました。より具体的には、1. フィールド `information_schema.tables.table_type` の型を Enum8 から String に変更しました。2. ビュー `information_schema.table` にフィールド `table_comment` と `table_collation` を追加しました。3. ビュー `information_schema.key_column_usage` および `referential_constraints` を追加しました。4. `information_schema` ビュー内の大文字エイリアスを、実際の大文字カラムに置き換えました。 [#54773](https://github.com/ClickHouse/ClickHouse/pull/54773) ([Serge Klochkov](https://github.com/slvrtrn))。
* クエリキャッシュは、`now`、`randomString`、`dictGet` のような非決定的関数を含むクエリの結果をキャッシュしようとした場合、エラーを返すようになりました。以前の「結果をキャッシュしないが、そのことを通知しない」という挙動と比べて、これによりユーザーの混乱や意外な挙動が減ります。 [#54801](https://github.com/ClickHouse/ClickHouse/pull/54801) ([Robert Schulze](https://github.com/rschu1ze))。
* `file`/`s3`/`url`/... ストレージに対して materialized/ephemeral/alias などの特殊カラムを禁止し、ファイルから ephemeral カラムへの挿入処理を修正しました。[#53477](https://github.com/ClickHouse/ClickHouse/issues/53477) をクローズします。[#54803](https://github.com/ClickHouse/ClickHouse/pull/54803)（[Kruglov Pavel](https://github.com/Avogar)）。
* バックアップ用メタデータ収集の設定をより柔軟に行えるようにしました。 [#54804](https://github.com/ClickHouse/ClickHouse/pull/54804) ([Vitaly Baranov](https://github.com/vitlibar)).
* `clickhouse-local` のログファイル（`--server&#95;logs&#95;file` フラグを指定して有効化した場合）は、`clickhouse-server` と同様に、各行の先頭にタイムスタンプやスレッド ID などが付与されるようになりました。 [#54807](https://github.com/ClickHouse/ClickHouse/pull/54807) ([Michael Kolupaev](https://github.com/al13n321))。
* `system.merge_tree_settings` テーブル内のフィールド `is_obsolete` — 廃止予定の MergeTree 設定に対して、現在は 1 が設定されるようになりました。以前は、その設定が廃止予定であることは説明文にのみ示されていました。 [#54837](https://github.com/ClickHouse/ClickHouse/pull/54837) ([Robert Schulze](https://github.com/rschu1ze)).
* INTERVAL リテラルを使用する際に複数形も使えるようにしました。`INTERVAL 2 HOURS` は `INTERVAL 2 HOUR` と同等になります。 [#54860](https://github.com/ClickHouse/ClickHouse/pull/54860) ([Jordi Villar](https://github.com/jrdi)).
* `Nullable` な PK を持つ projection の作成を常に許可するようにした。これにより [#54814](https://github.com/ClickHouse/ClickHouse/issues/54814) が修正される。[#54895](https://github.com/ClickHouse/ClickHouse/pull/54895)（[Amos Bird](https://github.com/amosbird)）。
* 接続リセットにより失敗した場合に、バックアップの S3 操作を再試行するようにしました。 [#54900](https://github.com/ClickHouse/ClickHouse/pull/54900) ([Vitaly Baranov](https://github.com/vitlibar)).
* 設定の最大値が最小値より小さい場合に出力される例外メッセージをより正確にしました。 [#54925](https://github.com/ClickHouse/ClickHouse/pull/54925) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* `LIKE`、`match` およびその他の正規表現マッチング関数で、バイナリマッチにフォールバックすることで非 UTF-8 の部分文字列を含むパターンとのマッチが可能になりました。例えば、`string LIKE '\xFE\xFF%'` を使用して BOM を検出できます。これにより [#54486](https://github.com/ClickHouse/ClickHouse/issues/54486) が解決されました。[#54942](https://github.com/ClickHouse/ClickHouse/pull/54942)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `ContextLockWaitMicroseconds` プロファイルイベントを追加しました。 [#55029](https://github.com/ClickHouse/ClickHouse/pull/55029) ([Maksim Kita](https://github.com/kitaisreal)).
* Keeper はログレベルを動的に調整できるようになりました。 [#50372](https://github.com/ClickHouse/ClickHouse/pull/50372) ([helifu](https://github.com/helifu)).
* MySQL との互換性のために `timestamp` 関数を追加しました。 [#54275](https://github.com/ClickHouse/ClickHouse/issues/54275) をクローズしました。 [#54639](https://github.com/ClickHouse/ClickHouse/pull/54639) ([Nikolay Degterinsky](https://github.com/evillique)).

#### ビルド／テスト／パッケージングの改善 {#buildtestingpackaging-improvement-3}
* ClickHouse の公式ビルドおよび CI（継続的インテグレーション）ビルドで使用するコンパイラを、Clang 16 から 17 に更新しました。 [#53831](https://github.com/ClickHouse/ClickHouse/pull/53831) ([Robert Schulze](https://github.com/rschu1ze)).
* ルックアップ用の tld データ（`tldLookup.generated.cpp`）を再生成しました。 [#54269](https://github.com/ClickHouse/ClickHouse/pull/54269) ([Bharat Nallan](https://github.com/bharatnc)).
* 冗長な `clickhouse-keeper-client` シンボリックリンクを削除しました。 [#54587](https://github.com/ClickHouse/ClickHouse/pull/54587) ([Tomas Barton](https://github.com/deric)).
* bash のパス解決に `/usr/bin/env` を使用するようにし、Nix OS をサポートしました。 [#54603](https://github.com/ClickHouse/ClickHouse/pull/54603) ([Fionera](https://github.com/fionera)).
* `perf record` を DWARF コールグラフなしで実行するために必要な `PROFILE_CPU` オプションを CMake に追加しました。 [#54917](https://github.com/ClickHouse/ClickHouse/pull/54917) ([Maksim Kita](https://github.com/kitaisreal)).
* リンカが LLD 以外の場合は致命的エラーで停止するようにしました。 [#55036](https://github.com/ClickHouse/ClickHouse/pull/55036) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* base64 値（エンコード／デコード）を扱うライブラリを Turbo-Base64 から aklomp-base64 に置き換えました。どちらも x86 および ARM 上で SIMD により高速化されていますが、1. 後者のライセンス（BSD-2）は ClickHouse にとってより好ましく、Turbo64 はその間に GPL-3 へと変更されたこと、2. GitHub スター数が多いことから aklomp-base64 の方が将来性が高そうであること、3. aklomp-base64 は（主観的ではありますが）やや扱いやすい API を持つこと、4. aklomp-base64 ではバグ（スレッドセーフでない初期化など）を回避するためのハックが不要であること、が理由です。注意：aklomp-base64 はパディングされていない base64 値を拒否しますが、Turbo-Base64 はベストエフォートでデコードします。RFC-4648 ではパディングが必須かどうかを明示していませんが、コンテキストによってはこの変更により挙動が変わる可能性があるため注意してください。 [#54119](https://github.com/ClickHouse/ClickHouse/pull/54119) ([Mikhail Koviazin](https://github.com/mkmkme)).

#### バグ修正（公式の安定版リリースにおけるユーザーから見て分かる不具合） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-3}

* zero-copy replication 使用時の REPLACE/MOVE PARTITION の問題を修正（注: 「zero-copy replication」は実験的機能です）[#54193](https://github.com/ClickHouse/ClickHouse/pull/54193) ([Alexander Tokmakov](https://github.com/tavplubix))。
* ハードリンクで zero copy ロックを修正 (注: &quot;zero-copy replication&quot; は実験的な機能です) [#54859](https://github.com/ClickHouse/ClickHouse/pull/54859) ([Alexander Tokmakov](https://github.com/tavplubix)).
* ゼロコピーのガベージを修正（注: 「zero-copy replication」は実験的な機能です） [#54550](https://github.com/ClickHouse/ClickHouse/pull/54550) ([Alexander Tokmakov](https://github.com/tavplubix))。
* HTTP リトライのタイムアウトをミリ秒単位で渡すようにしました（以前は正しくありませんでした）。 [#54438](https://github.com/ClickHouse/ClickHouse/pull/54438) ([Duc Canh Le](https://github.com/canhld94)).
* OUTFILE で `CapnProto`/`Protobuf` を使用した場合の、誤解を招くエラーメッセージを修正 [#52870](https://github.com/ClickHouse/ClickHouse/pull/52870) ([Kruglov Pavel](https://github.com/Avogar))。
* LIMIT 付き parallel replicas のサマリー報告を修正 [#53050](https://github.com/ClickHouse/ClickHouse/pull/53050) ([Raúl Marín](https://github.com/Algunenano))。
* S3 への／からの BACKUP（ネイティブコピー未使用時）のスロットル処理およびその他の箇所でのスロットル処理を修正 [#53336](https://github.com/ClickHouse/ClickHouse/pull/53336) ([Azat Khuzhin](https://github.com/azat)).
* ディレクトリ全体をコピーする際の I/O スロットリングの問題を修正 [#53338](https://github.com/ClickHouse/ClickHouse/pull/53338) ([Azat Khuzhin](https://github.com/azat)).
* Fix: PREWHERE 句に移動された actions によって列が失われる可能性がある問題を修正 [#53492](https://github.com/ClickHouse/ClickHouse/pull/53492) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* バイトレベルで同一のパーツに置き換える際に発生していた内部エラーを修正しました [#53735](https://github.com/ClickHouse/ClickHouse/pull/53735) ([Pedro Riera](https://github.com/priera))。
* Fix: `interpolate` 式で使用される列を必須にする [#53754](https://github.com/ClickHouse/ClickHouse/pull/53754) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* クラスタディスカバリの初期化を修正し、設定ファイルでフェイルポイントを設定 [#54113](https://github.com/ClickHouse/ClickHouse/pull/54113) ([vdimir](https://github.com/vdimir))。
* `accurateCastOrNull` の不具合を修正 [#54136](https://github.com/ClickHouse/ClickHouse/pull/54136)（[Salvatore Mesoraca](https://github.com/aiven-sal)）。
* FINAL 修飾子使用時の NULL 許容主キーに関する問題を修正 [#54164](https://github.com/ClickHouse/ClickHouse/pull/54164)（[Amos Bird](https://github.com/amosbird)）。
* 重複したデータが存在する場合に、新しいデータをレプリケーテッドマテリアライズドビューに挿入できない不具合を修正しました。 [#54184](https://github.com/ClickHouse/ClickHouse/pull/54184) ([Pedro Riera](https://github.com/priera))。
* 修正: ブルームフィルターで `IPv6` を許可 [#54200](https://github.com/ClickHouse/ClickHouse/pull/54200) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* `IPv4` で発生し得る型不一致を修正 [#54212](https://github.com/ClickHouse/ClickHouse/pull/54212) ([Bharat Nallan](https://github.com/bharatnc))。
* 再作成されたインデックスにおける `system.data_skipping_indices` を修正 [#54225](https://github.com/ClickHouse/ClickHouse/pull/54225)（[Artur Malchanau](https://github.com/Hexta)）。
* multiple join rewriter v2 における名前競合を修正 [#54240](https://github.com/ClickHouse/ClickHouse/pull/54240) ([Tao Wang](https://github.com/wangtZJU)).
* JOIN 実行後に `system.errors` に予期しないエラーが発生する問題を修正 [#54306](https://github.com/ClickHouse/ClickHouse/pull/54306) ([vdimir](https://github.com/vdimir))。
* `isZeroOrNull(NULL)` を修正 [#54316](https://github.com/ClickHouse/ClickHouse/pull/54316) ([flynn](https://github.com/ucasfl))。
* Fix: `prefer_localhost_replica` = 1 設定時に distributed で parallel replicas を使用する場合の動作を修正 [#54334](https://github.com/ClickHouse/ClickHouse/pull/54334) ([Igor Nikonov](https://github.com/devcrafter)).
* 垂直マージおよび ReplacingMergeTree における論理エラーを修正し、クリーンアップを最適化 [#54368](https://github.com/ClickHouse/ClickHouse/pull/54368) ([alesapin](https://github.com/alesapin))。
* `s3` テーブル関数で発生する可能性のある `URI contains invalid characters` エラーを修正 [#54373](https://github.com/ClickHouse/ClickHouse/pull/54373)（[Kruglov Pavel](https://github.com/Avogar)）。
* `arrayExists` 関数の AST 最適化時に発生するセグメンテーションフォルトを修正 [#54379](https://github.com/ClickHouse/ClickHouse/pull/54379) ([Nikolay Degterinsky](https://github.com/evillique)).
* 加算前にオーバーフローをチェックするよう `analysisOfVariance` 関数を変更 [#54385](https://github.com/ClickHouse/ClickHouse/pull/54385) ([Antonio Andelic](https://github.com/antonio2368)).
* removeSharedRecursive のバグを再現し修正 [#54430](https://github.com/ClickHouse/ClickHouse/pull/54430) ([Sema Checherinda](https://github.com/CheSema))。
* PREWHERE および FINAL での SimpleAggregateFunction 使用時に誤った結果が返される可能性がある問題を修正 [#54436](https://github.com/ClickHouse/ClickHouse/pull/54436) ([Azat Khuzhin](https://github.com/azat)).
* analyzer を使用しない場合の indexHint によるパーツのフィルタリングを修正 [#54449](https://github.com/ClickHouse/ClickHouse/pull/54449) ([Azat Khuzhin](https://github.com/azat)).
* 正規化された状態を持つ集約プロジェクションの問題を修正 [#54480](https://github.com/ClickHouse/ClickHouse/pull/54480) ([Amos Bird](https://github.com/amosbird))。
* `clickhouse-local`: マルチクエリパラメータ向けの機能 [#54498](https://github.com/ClickHouse/ClickHouse/pull/54498) ([CuiShuoGuo](https://github.com/bakam412)).
* `clickhouse-local` が `--database` コマンドライン引数をサポートするようになりました [#54503](https://github.com/ClickHouse/ClickHouse/pull/54503) ([vdimir](https://github.com/vdimir))。
* `input_format_with_names_use_header` を無効にしている場合に発生する可能性がある `-WithNames` フォーマットでのパースエラーを修正 [#54513](https://github.com/ClickHouse/ClickHouse/pull/54513) ([Kruglov Pavel](https://github.com/Avogar))。
* まれに発生する CHECKSUM&#95;DOESNT&#95;MATCH エラーを修正 [#54549](https://github.com/ClickHouse/ClickHouse/pull/54549) ([alesapin](https://github.com/alesapin))。
* 既に並べ替えられている結果を UNION ALL した際のソート処理を修正 [#54564](https://github.com/ClickHouse/ClickHouse/pull/54564) ([Vitaly Baranov](https://github.com/vitlibar))。
* Keeper におけるスナップショットのインストール処理を修正 [#54572](https://github.com/ClickHouse/ClickHouse/pull/54572) ([Antonio Andelic](https://github.com/antonio2368))。
* `ColumnUnique` の競合状態を修正 [#54575](https://github.com/ClickHouse/ClickHouse/pull/54575) ([Nikita Taranov](https://github.com/nickitat))。
* Annoy/Usearch インデックス: デフォルト値使用時の構築中に発生する LOGICAL&#95;ERROR を修正 [#54600](https://github.com/ClickHouse/ClickHouse/pull/54600) ([Robert Schulze](https://github.com/rschu1ze)).
* `ColumnDecimal` のシリアル化処理を修正 [#54601](https://github.com/ClickHouse/ClickHouse/pull/54601) ([Nikita Taranov](https://github.com/nickitat))。
* 空白を含むカラム名に対する *Cluster 関数* のスキーマ推論を修正 [#54635](https://github.com/ClickHouse/ClickHouse/pull/54635) ([Kruglov Pavel](https://github.com/Avogar))。
* デフォルト値や明示的な挿入カラムがある場合に、挿入元テーブルの構造を利用するよう修正 [#54655](https://github.com/ClickHouse/ClickHouse/pull/54655)（[Kruglov Pavel](https://github.com/Avogar)）。
* 修正: 選択（|）を含む可能性のある正規表現マッチを、キー条件として使用しないようにしました。 [#54696](https://github.com/ClickHouse/ClickHouse/pull/54696) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* vertical merge およびクリーンアップ時の ReplacingMergeTree を修正 [#54706](https://github.com/ClickHouse/ClickHouse/pull/54706) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* ORDER BY 句適用後に仮想カラムの値が不正になる問題を修正 [#54811](https://github.com/ClickHouse/ClickHouse/pull/54811) ([Michael Kolupaev](https://github.com/al13n321))。
* `indexHint` を用いた、analyzer を使用しない場合のフィルタリング部分を修正 [#54825](https://github.com/ClickHouse/ClickHouse/pull/54825) [#54449](https://github.com/ClickHouse/ClickHouse/pull/54449) ([Azat Khuzhin](https://github.com/azat)).
* シャットダウン中の Keeper のセグメンテーションフォルトを修正 [#54841](https://github.com/ClickHouse/ClickHouse/pull/54841) ([Antonio Andelic](https://github.com/antonio2368))。
* MaterializedPostgreSQL で発生する `Invalid number of rows in Chunk` を修正 [#54844](https://github.com/ClickHouse/ClickHouse/pull/54844) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 古いフォーマット設定を別セクションに移動 [#54855](https://github.com/ClickHouse/ClickHouse/pull/54855) ([Kruglov Pavel](https://github.com/Avogar))。
* パーティションキーが変更された場合に `minmax_count_projection` を再構築するようにした [#54943](https://github.com/ClickHouse/ClickHouse/pull/54943) ([Amos Bird](https://github.com/amosbird))。
* `if` 関数内での `ColumnVector<Int128>` への誤ったキャストを修正 [#55019](https://github.com/ClickHouse/ClickHouse/pull/55019) ([Kruglov Pavel](https://github.com/Avogar)).
* 異なるプロジェクションまたはインデックスを持つテーブルからのパーツのアタッチを禁止しました [#55062](https://github.com/ClickHouse/ClickHouse/pull/55062) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* 空のサブクエリ結果の場合、スカラ結果マップに NULL を格納する [#52240](https://github.com/ClickHouse/ClickHouse/pull/52240) ([vdimir](https://github.com/vdimir))。
* まれなケースで `FINAL` により不正な読み取り範囲が生成される問題を修正 [#54934](https://github.com/ClickHouse/ClickHouse/pull/54934) ([Nikita Taranov](https://github.com/nickitat))。
* Fix: Keeper によるリトライなしで insert quorum を実行 [#55026](https://github.com/ClickHouse/ClickHouse/pull/55026) ([Igor Nikonov](https://github.com/devcrafter)).
* nullable を含む simple state を修正 [#55030](https://github.com/ClickHouse/ClickHouse/pull/55030) ([Pedro Riera](https://github.com/priera))。

### <a id="238"></a> ClickHouse リリース 23.8 LTS, 2023-08-31 {#238}

#### 後方互換性のない変更 {#backward-incompatible-change-4}
* 動的ディスクに名前がある場合は、ディスク関数の引数で `disk = disk(name = 'disk_name'`, ...) のように指定する必要があります。以前のバージョンでは `disk = disk_<disk_name>(...)` のように指定できましたが、これはサポートされなくなりました。 [#52820](https://github.com/ClickHouse/ClickHouse/pull/52820) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `clickhouse-benchmark` は、`--concurrency` を 1 より大きい値で指定した場合、接続を並列に確立するようになりました。以前は、ヨーロッパから米国への 1000 個の同時接続で実行した場合には実用的ではありませんでした。高レイテンシの接続に対する QPS を正しく計算するようになりました。後方互換性のない変更として、`clickhouse-benchmark` の JSON 出力オプションは削除されました。このオプションを使用していた場合は、ワークアラウンドとして `system.query_log` から JSON 形式でデータを抽出することもできます。 [#53293](https://github.com/ClickHouse/ClickHouse/pull/53293) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `system.text_log` から `microseconds` 列が、`system.metric_log` から `milliseconds` 列が削除されました。これらは `event_time_microseconds` 列が存在するため冗長だからです。 [#53601](https://github.com/ClickHouse/ClickHouse/pull/53601) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* メタデータキャッシュ機能を非推奨としました。これは実験的機能であり、私たち自身はこれまで一度も使用していません。また、この機能は危険です: [#51182](https://github.com/ClickHouse/ClickHouse/issues/51182)。`system.merge_tree_metadata_cache` システムテーブルを削除しました。メタデータキャッシュ自体はこのバージョンではまだ利用可能ですが、近いうちに削除される予定です。これにより [#39197](https://github.com/ClickHouse/ClickHouse/issues/39197) がクローズされます。 [#51303](https://github.com/ClickHouse/ClickHouse/pull/51303) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* TLS 接続での 3DES サポートを無効化しました。 [#52893](https://github.com/ClickHouse/ClickHouse/pull/52893) ([Kenji Noguchi](https://github.com/knoguchi)).

#### 新機能 {#new-feature-4}

* zip/7z/tar アーカイブからの直接インポートをサポート。例: `file('*.zip :: *.csv')`。[#50321](https://github.com/ClickHouse/ClickHouse/pull/50321)（[nikitakeba](https://github.com/nikitakeba)）。
* `trace_type = 'MemorySample'` の場合に `system.trace_log` にカラム `ptr` を追加しました。このカラムにはメモリアロケーションのアドレスが含まれます。割り当てられたが未解放のメモリを含むフレームグラフを構築できる関数 `flameGraph` を追加しました。[#38391](https://github.com/ClickHouse/ClickHouse/issues/38391) の再実装です。[#45322](https://github.com/ClickHouse/ClickHouse/pull/45322)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* テーブル関数 `azureBlobStorageCluster` を追加しました。サポートされる機能セットは、テーブル関数 `s3Cluster` のものと非常に似ています。 [#50795](https://github.com/ClickHouse/ClickHouse/pull/50795) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
* `cluster`、`clusterAllReplicas`、`remote`、`remoteSecure` をテーブル名を指定せずに使用できるようにしました（issue [#50808](https://github.com/ClickHouse/ClickHouse/issues/50808)）。[#50848](https://github.com/ClickHouse/ClickHouse/pull/50848)（[Yangkuan Liu](https://github.com/LiuYangkuan)）。
* Kafka コンシューマの監視用システムテーブル。 [#50999](https://github.com/ClickHouse/ClickHouse/pull/50999) ([Ilya Golshtein](https://github.com/ilejn))。
* `max_sessions_for_user` 設定を追加しました。 [#51724](https://github.com/ClickHouse/ClickHouse/pull/51724) ([Alexey Gerasimchuck](https://github.com/Demilivor)).
* Spark の `to_utc_timestamp/from_utc_timestamp` と同様に動作する新しい関数 `toUTCTimestamp/fromUTCTimestamp` を追加。 [#52117](https://github.com/ClickHouse/ClickHouse/pull/52117) ([KevinyhZou](https://github.com/KevinyhZou)).
* ClickHouse のテーブル構造を CapnProto/Protobuf 形式のスキーマに変換する新しい関数 `structureToCapnProtoSchema` / `structureToProtobufSchema` を追加しました。テーブル構造から自動生成されたスキーマを使用することで、外部のフォーマット用スキーマなしで CapnProto/Protobuf 形式のデータを入出力できるようになりました（設定 `format_capn_proto_use_autogenerated_schema` / `format_protobuf_use_autogenerated_schema` で制御）。また、設定 `output_format_schema` によって、入出力時に使用される自動生成スキーマをエクスポートできるようにしました。 [#52278](https://github.com/ClickHouse/ClickHouse/pull/52278) ([Kruglov Pavel](https://github.com/Avogar)).
* `system.query_log` に新しいフィールド `query_cache_usage` が追加され、クエリキャッシュが使用されたかどうか、またどのように使用されたかを示すようになりました。 [#52384](https://github.com/ClickHouse/ClickHouse/pull/52384) ([Robert Schulze](https://github.com/rschu1ze))。
* 新しい関数 `startsWithUTF8` と `endsWithUTF8` を追加しました。 [#52555](https://github.com/ClickHouse/ClickHouse/pull/52555) ([李扬](https://github.com/taiyang-li))。
* TSV/CustomSeparated/JSONCompactEachRow 形式で可変長の列数を許可し、可変長の列数でもスキーマの自動推論が機能するようにしました。設定 `input_format_tsv_allow_variable_number_of_columns`、`input_format_custom_allow_variable_number_of_columns`、`input_format_json_compact_allow_variable_number_of_columns` を追加しました。 [#52692](https://github.com/ClickHouse/ClickHouse/pull/52692) ([Kruglov Pavel](https://github.com/Avogar)).
* `ReplicatedMergeTree` のテスト用に `SYSTEM STOP/START PULLING REPLICATION LOG` クエリを追加しました。 [#52881](https://github.com/ClickHouse/ClickHouse/pull/52881) ([Alexander Tokmakov](https://github.com/tavplubix)).
* ミューテーションのイニシエータ側で、定数の非決定的関数を実行できるようにしました。 [#53129](https://github.com/ClickHouse/ClickHouse/pull/53129) ([Anton Popov](https://github.com/CurtizJ)).
* データを一切読み取らず、常に `dummy` という名前の `UInt8` 型カラムを持ち、その値が `0` の 1 行だけを返す入力フォーマット `One` を追加しました。これは `system.one` と同様です。file/S3/URL/HDFS などのテーブル関数で、データを読み取ることなくファイルを一覧表示するために、`_file` / `_path` 仮想カラムと組み合わせて使用できます。[#53209](https://github.com/ClickHouse/ClickHouse/pull/53209)（[Kruglov Pavel](https://github.com/Avogar)）。
* `tupleConcat` 関数を追加。[#52759](https://github.com/ClickHouse/ClickHouse/issues/52759) を解決。[#53239](https://github.com/ClickHouse/ClickHouse/pull/53239)（[Nikolay Degterinsky](https://github.com/evillique)）。
* `TRUNCATE DATABASE` 操作のサポートを追加しました。[#53261](https://github.com/ClickHouse/ClickHouse/pull/53261)（[Bharat Nallan](https://github.com/bharatnc)）。
* プライマリキーの処理に使用されるスレッド数を制限するための `max_threads_for_indexes` 設定を追加しました。 [#53313](https://github.com/ClickHouse/ClickHouse/pull/53313) ([jorisgio](https://github.com/jorisgio)).
* SipHash のキー付き関数を再度追加。 [#53525](https://github.com/ClickHouse/ClickHouse/pull/53525) ([Salvatore Mesoraca](https://github.com/aiven-sal)).
* ([#52755](https://github.com/ClickHouse/ClickHouse/issues/52755), [#52895](https://github.com/ClickHouse/ClickHouse/issues/52895)) 関数 `arrayRotateLeft`、`arrayRotateRight`、`arrayShiftLeft`、`arrayShiftRight` を追加しました。 [#53557](https://github.com/ClickHouse/ClickHouse/pull/53557) ([Mikhail Koviazin](https://github.com/mkmkme))。
* `system.clusters` に `cluster` 列のエイリアスとして `name` 列を追加しました。 [#53605](https://github.com/ClickHouse/ClickHouse/pull/53605) ([irenjj](https://github.com/irenjj))。
* 高度なダッシュボードで一括編集（保存・読み込み）が可能になりました。 [#53608](https://github.com/ClickHouse/ClickHouse/pull/53608) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 高度なダッシュボードで、チャートを最大化したり移動したりできるようになりました。 [#53622](https://github.com/ClickHouse/ClickHouse/pull/53622) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 配列の加算および減算に対応しました: `[5,2] + [1,7]`。除算と乗算は、要素ごとの乗算と引数のスカラー積が混同されるおそれがあるため、実装していません。[#49939](https://github.com/ClickHouse/ClickHouse/issues/49939) をクローズします。[#52625](https://github.com/ClickHouse/ClickHouse/pull/52625)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* テーブル名として文字列リテラルを使用できるようにしました。[#52178](https://github.com/ClickHouse/ClickHouse/issues/52178) をクローズしました。[#52635](https://github.com/ClickHouse/ClickHouse/pull/52635)（[hendrik-m](https://github.com/hendrik-m)）。

#### 実験的機能 {#experimental-feature-1}
* `S3` からのストリーミングデータのインポート用に、新しいテーブルエンジン `S3Queue` を追加しました。 [#37012](https://github.com/ClickHouse/ClickHouse/issues/37012) をクローズ。 [#49086](https://github.com/ClickHouse/ClickHouse/pull/49086) ([s-kat](https://github.com/s-kat))。まだ利用可能な状態ではありません。使用しないでください。
* 分散テーブルで、レプリカからの並列読み取りを有効にしました。 [#49708](https://github.com/ClickHouse/ClickHouse/issues/49708) に関連。 [#53005](https://github.com/ClickHouse/ClickHouse/pull/53005) ([Igor Nikonov](https://github.com/devcrafter))。
* 近似近傍探索メソッドとして HNSW の実験的サポートを追加しました。 [#53447](https://github.com/ClickHouse/ClickHouse/pull/53447) ([Davit Vardanyan](https://github.com/davvard))。これは現在、この実装の開発を継続している人向けです。使用しないでください。

#### パフォーマンス向上 {#performance-improvement-4}

* Parquet のフィルタープッシュダウン。つまり、Parquet ファイルを読み込む際に、`WHERE` 条件と各カラムの最小値 / 最大値に基づいて、行グループ（ファイルを構成するチャンク）がスキップされます。特に、ファイルがおおよそあるカラムでソートされている場合、そのカラムの狭い範囲でフィルタリングするクエリは、はるかに高速になります。 [#52951](https://github.com/ClickHouse/ClickHouse/pull/52951) ([Michael Kolupaev](https://github.com/al13n321)).
* Parquet で小さな行グループをまとめて一括処理することで、読み取りを最適化しました。[#53069](https://github.com/ClickHouse/ClickHouse/issues/53069) をクローズ。[#53281](https://github.com/ClickHouse/ClickHouse/pull/53281)（[Kruglov Pavel](https://github.com/Avogar)）。
* ほとんどの入力フォーマットにおいて、ファイルからの count の計算を最適化しました。Closes [#44334](https://github.com/ClickHouse/ClickHouse/issues/44334). [#53637](https://github.com/ClickHouse/ClickHouse/pull/53637) ([Kruglov Pavel](https://github.com/Avogar)).
* `url`/`file`/`hdfs` テーブル関数で読み込みを行う前に、ファイル/パスでのフィルタリングを行えるようにしました。 [#53529](https://github.com/ClickHouse/ClickHouse/pull/53529) ([Kruglov Pavel](https://github.com/Avogar)).
* AArch64、PowerPC、SystemZ、RISC-V での JIT コンパイルを有効化。[#38217](https://github.com/ClickHouse/ClickHouse/pull/38217)（[Maksim Kita](https://github.com/kitaisreal)）。
* `countDistinctIf` を `count_distinct_implementation` で書き換えるための設定 `rewrite_count_distinct_if_with_count_distinct_implementation` を追加しました。 [#30642](https://github.com/ClickHouse/ClickHouse/issues/30642) をクローズ。 [#46051](https://github.com/ClickHouse/ClickHouse/pull/46051)（[flynn](https://github.com/ucasfl)）。
* マージ前の変換処理を並列化することで、`uniq` および `uniqExact` 集約関数の状態のマージ処理を高速化しました。 [#50748](https://github.com/ClickHouse/ClickHouse/pull/50748) ([Jiebin Sun](https://github.com/jiebinn)).
* 可変長キーを多数使用する場合の nullable な文字列キーに対する集約処理のパフォーマンスを最適化しました。 [#51399](https://github.com/ClickHouse/ClickHouse/pull/51399) ([LiuNeng](https://github.com/liuneng1994)).
* preimage を用いた時間フィルタ最適化を行うパスを Analyzer に追加しました。ICX デバイス（Intel Xeon Platinum 8380 CPU、80 コア、160 スレッド）上での SSB のパフォーマンス実験では、この変更により experimental analyzer 有効時の QPS の幾何平均が 8.5% 向上することが確認されています。 [#52091](https://github.com/ClickHouse/ClickHouse/pull/52091) ([Zhiguo Zhou](https://github.com/ZhiguoZh))。
* `uniqExact`（COUNT DISTINCT）関数において、すべてのハッシュセットが単一レベル構造である場合のマージ処理を最適化しました。 [#52973](https://github.com/ClickHouse/ClickHouse/pull/52973) ([Jiebin Sun](https://github.com/jiebinn))。
* `Join` テーブルエンジン：すべてのカラムを含むハッシュ結合用データ構造をクローンしないようにしました。 [#53046](https://github.com/ClickHouse/ClickHouse/pull/53046) ([Duc Canh Le](https://github.com/canhld94)).
* Apache Arrow ライブラリを使用せずにネイティブな `ORC` 入力フォーマットを実装し、パフォーマンスを向上させました。 [#53324](https://github.com/ClickHouse/ClickHouse/pull/53324) ([李扬](https://github.com/taiyang-li)).
* ダッシュボードはサーバーにデータを圧縮するよう指示します。これは、低速なインターネット回線で長い時間範囲のデータを扱う場合に有用です。たとえば、86400 個のポイントを持つ 1 つのチャートは、未圧縮の場合 1.5 MB ですが、`br` で圧縮すると 60 KB になります。 [#53569](https://github.com/ClickHouse/ClickHouse/pull/53569)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* BACKUP および RESTORE におけるスレッドプールの利用を改善。 [#53649](https://github.com/ClickHouse/ClickHouse/pull/53649) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* 起動時にファイルシステムキャッシュのメタデータを並列で読み込みます。`load_metadata_threads`（デフォルト: 1）のキャッシュ設定で構成されます。[#52037](https://github.com/ClickHouse/ClickHouse/issues/52037) に関連しています。 [#52943](https://github.com/ClickHouse/ClickHouse/pull/52943)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* `move_primary_key_columns_to_end_of_prewhere` を改善しました。 [#53337](https://github.com/ClickHouse/ClickHouse/pull/53337) ([Han Fei](https://github.com/hanfei1991)).
* この変更により、ClickHouse Keeper とのやり取りが最適化されます。以前は、呼び出し元が同じ watch コールバックを複数回登録できていました。その場合、各エントリがメモリを消費し、同じコールバックが複数回呼び出されることになり、あまり意味がありませんでした。これを避けるには、呼び出し元側で同じ watch を複数回追加しないようなロジックを持つ必要がありました。これにより、watch コールバックが shared&#95;ptr 経由で渡された場合には、この重複排除が内部で行われるようになりました。[#53452](https://github.com/ClickHouse/ClickHouse/pull/53452)（[Alexander Gololobov](https://github.com/davenger)）。
* file/s3/url/hdfs/azure 関数での count 実行時に備えて、ファイル内の行数をキャッシュします。キャッシュは `use_cache_for_count_from_files` の設定で有効/無効を切り替えられます（デフォルトで有効）。[https://github.com/ClickHouse/ClickHouse/pull/53637](https://github.com/ClickHouse/ClickHouse/pull/53637) の継続です。[#53692](https://github.com/ClickHouse/ClickHouse/pull/53692)（[Kruglov Pavel](https://github.com/Avogar)）。
* より慎重なスレッド管理により、多数のファイルを扱う S3 テーブル関数の処理速度が約 25% 以上向上しました。 [#53668](https://github.com/ClickHouse/ClickHouse/pull/53668) ([pufit](https://github.com/pufit)).



#### 改善 {#improvement-4}

* 外部コマンドの標準エラー出力（`stderr`）にデータがある場合の動作（`none`、`log`、`throw`）を制御するための `stderr_reaction` 設定項目を追加しました。これにより、外部コマンドのデバッグが容易になります。 [#43210](https://github.com/ClickHouse/ClickHouse/pull/43210) ([Amos Bird](https://github.com/amosbird)).
* `system.part_log` およびマージテーブルに `partition` カラムを追加。 [#48990](https://github.com/ClickHouse/ClickHouse/pull/48990) ([Jianfei Hu](https://github.com/incfly)).
* （インデックス用の）非圧縮/マーク、mmap、およびクエリキャッシュのサイズを、サーバーを再起動することなく実行時に動的に変更できるようになりました。[#51446](https://github.com/ClickHouse/ClickHouse/pull/51446) ([Robert Schulze](https://github.com/rschu1ze))。
* 複雑なキーを持つ辞書が作成された場合には、自動的に「complex key」レイアウトのバリアントが選択されるようになりました。 [#49587](https://github.com/ClickHouse/ClickHouse/pull/49587) ([xiebin](https://github.com/xbthink)).
* 新しい同時実行制御機能をより適切にテストするための設定 `use_concurrency_control` を追加しました。 [#49618](https://github.com/ClickHouse/ClickHouse/pull/49618) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* データベース名およびテーブル名を誤入力した場合に、候補を提案する機能を追加しました。 [#49801](https://github.com/ClickHouse/ClickHouse/pull/49801) ([Yarik Briukhovetskyi](https://github.com/yariks5s)).
* Gluten で HDFS から小さなファイルを読み込む際、Spark で直接クエリする場合と比べて、より多くの時間がかかることが判明しました。この問題に対して、いくつかの改善を行いました。 [#50063](https://github.com/ClickHouse/ClickHouse/pull/50063) ([KevinyhZou](https://github.com/KevinyhZou)).
* セッションの有効期限切れ後に不要なエラーログが大量に出力されており、望ましくありませんでした。[#50171](https://github.com/ClickHouse/ClickHouse/pull/50171)（[helifu](https://github.com/helifu)）。
* 時間制限付きのフォールバック ZooKeeper セッションを導入しました。DNS アドレス向けの `system.zookeeper_connection` の `index` 列を修正しました。 [#50424](https://github.com/ClickHouse/ClickHouse/pull/50424) ([Anton Kozlov](https://github.com/tonickkozlov))。
* max&#95;partitions&#95;per&#95;insert&#95;block に到達したときにログを出力する機能を追加しました。 [#50948](https://github.com/ClickHouse/ClickHouse/pull/50948) ([Sean Haynes](https://github.com/seandhaynes)).
* clickhouse-keeper-client に多数のカスタムコマンドを追加しました（主に ClickHouse のデバッグを容易にするため）。 [#51117](https://github.com/ClickHouse/ClickHouse/pull/51117) ([pufit](https://github.com/pufit))。
* `azureBlobStorage` テーブル関数における接続文字列のチェックを更新しました。`sas` を含む接続文字列は既定のエンドポイントで始まるとは限らないためです。また、URL に Azure のコンテナを追加した後に `sas` トークンが含まれるよう、接続 URL を更新しました。 [#51141](https://github.com/ClickHouse/ClickHouse/pull/51141) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* `full_sorting_merge` JOIN アルゴリズムにおけるセットのフィルタリング処理に関する説明を修正。[#51329](https://github.com/ClickHouse/ClickHouse/pull/51329)（[Tanay Tummalapalli](https://github.com/ttanay)）。
* `max_block_size` が巨大な場合に `Aggregator` で発生していたメモリ消費を修正しました。 [#51566](https://github.com/ClickHouse/ClickHouse/pull/51566) ([Nikita Taranov](https://github.com/nickitat))。
* `SYSTEM SYNC FILESYSTEM CACHE` コマンドを追加しました。このコマンドは、ファイルシステムキャッシュのメモリ上の状態をディスク上の内容と比較し、必要に応じてメモリ上の状態を修正します。これは、ディスク上のデータを手動で変更する場合にのみ必要になりますが、そのような操作は強く非推奨です。 [#51622](https://github.com/ClickHouse/ClickHouse/pull/51622) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 既存の S3 ストレージ構成用プロキシリゾルバとの後方互換性を維持しつつ、ClickHouse 向けの汎用プロキシリゾルバの作成を試みました。 [#51749](https://github.com/ClickHouse/ClickHouse/pull/51749) ([Arthur Passos](https://github.com/arthurpassos)).
* file/s3/hdfs/url/azureBlobStorage テーブル関数でタプルのサブカラムの読み取りをサポートしました。 [#51806](https://github.com/ClickHouse/ClickHouse/pull/51806) ([Kruglov Pavel](https://github.com/Avogar))
* 関数 `arrayIntersect` は、最初の引数の順序に従って値を返すようになりました。これにより [#27622](https://github.com/ClickHouse/ClickHouse/issues/27622) がクローズされました。[#51850](https://github.com/ClickHouse/ClickHouse/pull/51850)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* 指定したアクセスストレージに対してアクセスエンティティの作成・削除や、あるアクセスストレージから別のアクセスストレージへの移動を行える新しいクエリを追加。 [#51912](https://github.com/ClickHouse/ClickHouse/pull/51912) ([pufit](https://github.com/pufit)).
* `ALTER TABLE FREEZE` クエリが Replicated データベースエンジンでレプリケートされないようにしました。 [#52064](https://github.com/ClickHouse/ClickHouse/pull/52064) ([Mike Kot](https://github.com/myrrc)).
* 予期せぬシャットダウン時に system テーブルをフラッシュできるようにしました。 [#52174](https://github.com/ClickHouse/ClickHouse/pull/52174) ([Alexey Gerasimchuck](https://github.com/Demilivor)).
* 事前署名付きURLで `s3` テーブル関数が動作しない問題を修正しました。 [#50846](https://github.com/ClickHouse/ClickHouse/issues/50846) をクローズ。 [#52310](https://github.com/ClickHouse/ClickHouse/pull/52310) ([chen](https://github.com/xiedeyantu))。
* `system.events` テーブルおよび `system.metrics` テーブルの `event` と `metric` に対するエイリアスとして、列 `name` を追加しました。[#51257](https://github.com/ClickHouse/ClickHouse/issues/51257) をクローズしました。 [#52315](https://github.com/ClickHouse/ClickHouse/pull/52315)（[chen](https://github.com/xiedeyantu)）。
* パーサーにおいて、SQL 互換性を高めるために `CREATE UNIQUE INDEX` 構文を実質的な処理を行わない no-op としてサポートしました。`UNIQUE` インデックスはサポートされていません。クエリ中の `UNIQUE` キーワードを無視するには `create_index_ignore_unique = 1` を設定してください。 [#52320](https://github.com/ClickHouse/ClickHouse/pull/52320) ([Ilya Yatsishin](https://github.com/qoega)).
* 一部の Kafka エンジン設定項目（topic、consumer、client&#95;id など）で、あらかじめ定義されたマクロ（`{database}` と `{table}`）のサポートを追加しました。 [#52386](https://github.com/ClickHouse/ClickHouse/pull/52386) ([Yury Bogomolov](https://github.com/ybogo))。
* バックアップ／リストア中のファイルシステムキャッシュの更新を無効化しました。バックアップ／リストア中にはファイルシステムキャッシュを更新すべきではなく、プロセスを遅くするだけで利点がないようです（`BACKUP` コマンドは大量のデータを読み取る可能性があり、そのすべてをファイルシステムキャッシュに載せてすぐに破棄するのは意味がないためです）。[#52402](https://github.com/ClickHouse/ClickHouse/pull/52402)（[Vitaly Baranov](https://github.com/vitlibar)）。
* S3 エンドポイントの設定により、ルートパスから利用可能になり、必要に応じて末尾に &#39;/&#39; が自動的に追加されるようになりました。 [#47809](https://github.com/ClickHouse/ClickHouse/issues/47809)。 [#52600](https://github.com/ClickHouse/ClickHouse/pull/52600) ([xiaolei565](https://github.com/xiaolei565))。
* clickhouse-local で位置指定オプションを許可し、グローバルな UDF 設定（`user_scripts_path` と `user_defined_executable_functions_config`）を設定できるようにしました。 [#52643](https://github.com/ClickHouse/ClickHouse/pull/52643) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* `system.asynchronous_metrics` に、クエリキャッシュを確認するためのメトリクス「QueryCacheEntries」および「QueryCacheBytes」が含まれるようになりました。 [#52650](https://github.com/ClickHouse/ClickHouse/pull/52650) ([Robert Schulze](https://github.com/rschu1ze)).
* S3 へのバックアップ時に、`BACKUP` ステートメントの `SETTINGS` 句で `s3_storage_class` パラメータを使用できるようになりました。 [#52658](https://github.com/ClickHouse/ClickHouse/pull/52658) ([Roman Vasin](https://github.com/rvasin))。
* バックアップメタデータファイルを解析し、バックアップ情報を表示するユーティリティ `print-backup-info.py` を追加しました。 [#52690](https://github.com/ClickHouse/ClickHouse/pull/52690) ([Vitaly Baranov](https://github.com/vitlibar)).
* [#49510](https://github.com/ClickHouse/ClickHouse/issues/49510) をクローズします。現在、データベース名およびテーブル名は大文字・小文字を区別しますが、BI ツールは `information_schema` に対して、小文字でクエリする場合もあれば、大文字でクエリする場合もあります。このため、小文字のテーブル（`information_schema.tables` など）を含む `information_schema` データベースと、大文字のテーブル（`INFORMATION_SCHEMA.TABLES` など）を含む `INFORMATION_SCHEMA` データベースを用意しています。しかし、一部のツールは `INFORMATION_SCHEMA.tables` や `information_schema.TABLES` に対してクエリを実行します。提案されている解決策は、小文字および大文字のテーブルの両方を、小文字および大文字の `information_schema` データベースの両方に複製することです。[#52695](https://github.com/ClickHouse/ClickHouse/pull/52695)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* クエリ `CHECK TABLE` のパフォーマンスと使い勝手が向上しました（進行状況の更新を表示し、キャンセルも可能）。 [#52745](https://github.com/ClickHouse/ClickHouse/pull/52745) ([vdimir](https://github.com/vdimir))。
* `modulo`、`intDiv`、`intDivOrZero` がタプルをサポートするようにし、タプルの各要素に対して演算を分配して実行できるようにしました。 [#52758](https://github.com/ClickHouse/ClickHouse/pull/52758) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* clickhouse-client で、`xml` の後にデフォルトの `yaml` および `yml` 設定ファイルを検索するようにしました。 [#52767](https://github.com/ClickHouse/ClickHouse/pull/52767) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* ルートが「clickhouse」ではない構成にマージする場合、ルートノード名が異なる構成は例外をスローせずに単にスキップされます。 [#52770](https://github.com/ClickHouse/ClickHouse/pull/52770) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* サンプリングメモリプロファイラで追跡するメモリ割り当てに対して、最小サイズ（`memory_profiler_sample_min_allocation_size`）と最大サイズ（`memory_profiler_sample_max_allocation_size`）を指定できるようになりました。 [#52779](https://github.com/ClickHouse/ClickHouse/pull/52779) ([alesapin](https://github.com/alesapin))。
* `precise_float_parsing` 設定を追加して、浮動小数点数の解析方法（高速/高精度）を切り替えられるようにしました。 [#52791](https://github.com/ClickHouse/ClickHouse/pull/52791) ([Andrey Zvonov](https://github.com/zvonand)).
* `clickhouse-keeper`（シンボリックリンク）についても、`clickhouse-keeper`（実行ファイル）と同じデフォルトパスを使用するようにしました。 [#52861](https://github.com/ClickHouse/ClickHouse/pull/52861) ([Vitaly Baranov](https://github.com/vitlibar)).
* テーブル関数 `remote` のエラーメッセージを改善し、[#40220](https://github.com/ClickHouse/ClickHouse/issues/40220) をクローズ。[#52959](https://github.com/ClickHouse/ClickHouse/pull/52959)（[jiyoungyoooo](https://github.com/jiyoungyoooo)）。
* `RESTORE` クエリの `SETTINGS` 句で独自のストレージポリシーを指定できるようになりました。 [#52970](https://github.com/ClickHouse/ClickHouse/pull/52970) ([Victor Krasnov](https://github.com/sirvickr)).
* バックアップ操作での S3 リクエストをスロットル（制限）できる機能を追加しました（`BACKUP` および `RESTORE` コマンドが `s3_max_[get/put]_[rps/burst]` の設定に従うようになりました）。 [#52974](https://github.com/ClickHouse/ClickHouse/pull/52974) ([Daniel Pozo Escalona](https://github.com/danipozo))。
* レプリケートされたユーザー定義関数や、レプリケートされたストレージを使用するアクセス制御エンティティを管理するために、クエリ内の ON CLUSTER 句を無視するための設定を追加しました。 [#52975](https://github.com/ClickHouse/ClickHouse/pull/52975) ([Aleksei Filatov](https://github.com/aalexfvk)).
* JOIN ステップ向けの EXPLAIN actions を追加。 [#53006](https://github.com/ClickHouse/ClickHouse/pull/53006) ([Maksim Kita](https://github.com/kitaisreal)).
* 空の needle を指定した場合は、`hasTokenOrNull` と `hasTokenCaseInsensitiveOrNull` が null を返すようにしました。[#53059](https://github.com/ClickHouse/ClickHouse/pull/53059) ([ltrk2](https://github.com/ltrk2)).
* ファイルシステムキャッシュで許可されるパスを制限できるようにしました。主に dynamic disk で有用です。サーバー設定で `filesystem_caches_path` が指定されている場合、すべてのファイルシステムキャッシュのパスはこのディレクトリに制限されます。例えば、キャッシュ設定内の `path` が相対パスの場合は `filesystem_caches_path` 配下に配置されます。キャッシュ設定内の `path` が絶対パスの場合は、そのパスが `filesystem_caches_path` の内部である必要があります。設定で `filesystem_caches_path` が指定されていない場合、動作は以前のバージョンと同じになります。 [#53124](https://github.com/ClickHouse/ClickHouse/pull/53124) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 多数のカスタムコマンドを追加しました（主に ClickHouse のデバッグを簡単にするため）。[#53127](https://github.com/ClickHouse/ClickHouse/pull/53127) ([pufit](https://github.com/pufit))。
* スキーマ推論時にファイル名に関する診断情報を追加しました。これにより、glob パターンで複数のファイルを処理する際に役立ちます。 [#53135](https://github.com/ClickHouse/ClickHouse/pull/53135) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 第 2 の接続でセッションの作成が許可されていない場合、クライアントはメインの接続を使用してサジェスト候補を読み込みます。 [#53177](https://github.com/ClickHouse/ClickHouse/pull/53177) ([Alexey Gerasimchuck](https://github.com/Demilivor)).
* `SYSTEM STOP/START LISTEN QUERIES [ALL/DEFAULT/CUSTOM]` クエリに EXCEPT 句を追加しました。例えば、`SYSTEM STOP LISTEN QUERIES ALL EXCEPT TCP, HTTP` のように指定できます。[#53280](https://github.com/ClickHouse/ClickHouse/pull/53280) ([Nikolay Degterinsky](https://github.com/evillique)).
* `max_concurrent_queries` のデフォルト値を 100 から 1000 に変更しました。ネットワーク待ちが主で負荷の軽いクエリであれば、多数の同時クエリがあっても問題ありません。注意: 同時クエリ数と QPS を混同しないでください。たとえば、ClickHouse サーバーは、同時クエリ数が 100 未満でも、数万 QPS を処理できます。 [#53285](https://github.com/ClickHouse/ClickHouse/pull/53285) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* バックグラウンドのパーティション最適化マージの同時実行数を制限します。 [#53405](https://github.com/ClickHouse/ClickHouse/pull/53405) ([Duc Canh Le](https://github.com/canhld94)).
* `Replicated` データベースのレプリケーションやリカバリ時に発生する `Directory for table data already exists` エラーを無視できる設定 `allow_moving_table_directory_to_trash` を追加しました。 [#53425](https://github.com/ClickHouse/ClickHouse/pull/53425) ([Alexander Tokmakov](https://github.com/tavplubix)).
* サーバー設定 `asynchronous_metrics_update_period_s` および `asynchronous_heavy_metrics_update_period_s` が誤って 0 に設定されている場合、アプリケーションを終了させるのではなく、安全に失敗するようになりました。 [#53428](https://github.com/ClickHouse/ClickHouse/pull/53428) ([Robert Schulze](https://github.com/rschu1ze)).
* ClickHouse サーバーは、設定の再読み込み時に cgroups によって変更されたメモリ制限を正しく認識するようになりました。 [#53455](https://github.com/ClickHouse/ClickHouse/pull/53455) ([Robert Schulze](https://github.com/rschu1ze))。
* `DETACH`、`DROP`、またはサーバーのシャットダウン時に Distributed テーブルのフラッシュを無効化する機能を追加。 [#53501](https://github.com/ClickHouse/ClickHouse/pull/53501) ([Azat Khuzhin](https://github.com/azat))。
* `domainRFC` 関数は、角括弧付きの IPv6 アドレスをサポートするようになりました。 [#53506](https://github.com/ClickHouse/ClickHouse/pull/53506) ([Chen768959](https://github.com/Chen768959))。
* バックアップで使用される S3 の CopyObject リクエストに対して、より長いタイムアウト値を使用するようにしました。 [#53533](https://github.com/ClickHouse/ClickHouse/pull/53533) ([Michael Kolupaev](https://github.com/al13n321)).
* サーバー設定 `aggregate_function_group_array_max_element_size` を追加しました。この設定は、シリアライズ時に `groupArray` 関数の配列サイズを制限するために使用されます。デフォルト値は `16777215` です。 [#53550](https://github.com/ClickHouse/ClickHouse/pull/53550) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* MySQL との互換性を向上させるために、`DATABASE` のエイリアスとして `SCHEMA` が追加されました。 [#53587](https://github.com/ClickHouse/ClickHouse/pull/53587) ([Daniël van Eeden](https://github.com/dveeden)).
* system データベース内のテーブルに関する非同期メトリクスを追加しました。例えば `TotalBytesOfMergeTreeTablesSystem` などです。これにより [#53603](https://github.com/ClickHouse/ClickHouse/issues/53603) がクローズされました。[#53604](https://github.com/ClickHouse/ClickHouse/pull/53604)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* Play UI とダッシュボードの SQL エディターでは Grammarly は使用されません。 [#53614](https://github.com/ClickHouse/ClickHouse/pull/53614) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* エキスパート向け設定として、(1) [index] mark/uncompressed キャッシュの size&#95;ratio（つまり保護キューの相対サイズ）を構成し、(2) index mark キャッシュおよび index uncompressed キャッシュのキャッシュポリシーを構成できるようになりました。 [#53657](https://github.com/ClickHouse/ClickHouse/pull/53657) ([Robert Schulze](https://github.com/rschu1ze))。
* TCPHandler のクエリパケットにクライアント情報の検証を追加しました。 [#53673](https://github.com/ClickHouse/ClickHouse/pull/53673) ([Alexey Gerasimchuck](https://github.com/Demilivor)).
* Microsoft Azure との連携中にネットワークエラーが発生した場合、パーツの読み込みを再試行するようにしました。 [#53750](https://github.com/ClickHouse/ClickHouse/pull/53750) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* 例外にスタックトレースが付与され、マテリアライズドビューで発生した例外も伝播されるようになりました。 [#53766](https://github.com/ClickHouse/ClickHouse/pull/53766) ([Ilya Golshtein](https://github.com/ilejn)).
* ホスト名またはポートが指定されていない場合、keeper client は ClickHouse の設定ファイル config.xml から接続文字列を取得しようとします。 [#53769](https://github.com/ClickHouse/ClickHouse/pull/53769) ([pufit](https://github.com/pufit))。
* プロファイルイベント `PartsLockMicroseconds` を追加しました。これは、MergeTree テーブルエンジンファミリーにおいてデータパーツのロックを保持している時間（マイクロ秒単位）を示します。 [#53797](https://github.com/ClickHouse/ClickHouse/pull/53797) ([alesapin](https://github.com/alesapin)).
* Keeper 向けに RAFT の再接続試行回数の上限を設定可能にしました。この設定により、現在の接続が切断された場合に、Keeper がピアとの接続をより迅速に再構築できるようになります。 [#53817](https://github.com/ClickHouse/ClickHouse/pull/53817) ([Pengyuan Bian](https://github.com/bianpengyuan))。
* MySQL との互換性を高めるためにテーブル定義内の外部キー定義を無視し、ユーザーが外部キー部分の SQL を書き換える必要がないようにしました。[#53380](https://github.com/ClickHouse/ClickHouse/issues/53380)。[#53864](https://github.com/ClickHouse/ClickHouse/pull/53864)（[jsc0218](https://github.com/jsc0218)）。



#### ビルド／テスト／パッケージングの改善 {#buildtestingpackaging-improvement-4}

* ClickHouse バイナリから動的リンカーへのシンボルの公開を行わないようにしました。これにより [#43933](https://github.com/ClickHouse/ClickHouse/issues/43933) が修正される可能性があります。[#47475](https://github.com/ClickHouse/ClickHouse/pull/47475)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `clickhouse-keeper-client` のシンボリックリンクを `clickhouse-server` パッケージに追加。 [#51882](https://github.com/ClickHouse/ClickHouse/pull/51882) ([Mikhail f. Shiryaev](https://github.com/Felixoid))。
* SQL 2016 への準拠状況を報告するために [https://github.com/elliotchance/sqltest](https://github.com/elliotchance/sqltest) を CI に追加しました。[#52293](https://github.com/ClickHouse/ClickHouse/pull/52293)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* PRQL を 0.9.3 にアップグレードしました。 [#53060](https://github.com/ClickHouse/ClickHouse/pull/53060)（[Maximilian Roos](https://github.com/max-sixty)）。
* CI チェックのシステムテーブルが ClickHouse Cloud にエクスポートされるようになりました。 [#53086](https://github.com/ClickHouse/ClickHouse/pull/53086) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* コンパイラのプロファイルデータ (`-ftime-trace`) が ClickHouse Cloud にアップロードされます。[#53100](https://github.com/ClickHouse/ClickHouse/pull/53100)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* Debug ビルドおよび Tidy ビルドを高速化しました。 [#53178](https://github.com/ClickHouse/ClickHouse/pull/53178) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 大量の不要なゴミを取り除くことでビルド時間を短縮しました。頻繁にインクルードされるヘッダーファイルの 1 つが、Boost によって「汚染」されていました。 [#53180](https://github.com/ClickHouse/ClickHouse/pull/53180) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* さらに不要なものを削除。 [#53182](https://github.com/ClickHouse/ClickHouse/pull/53182) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 関数 `arrayAUC` は重い C++ テンプレートを使用していましたが、それらを削除しました。 [#53183](https://github.com/ClickHouse/ClickHouse/pull/53183) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* いくつかの翻訳単位が、ccache の有無にかかわらず常に再ビルドされていました。原因が判明し、修正されました。 [#53184](https://github.com/ClickHouse/ClickHouse/pull/53184) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* コンパイラのプロファイルデータ（`-ftime-trace`）が ClickHouse Cloud にアップロードされるようになりました。これは [#53100](https://github.com/ClickHouse/ClickHouse/issues/53100) に続く 2 回目の試みです。[#53213](https://github.com/ClickHouse/ClickHouse/pull/53213)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* ステートフルテストの CI ログを ClickHouse Cloud にエクスポート。[#53351](https://github.com/ClickHouse/ClickHouse/pull/53351) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* ストレステスト時に CI からログをエクスポートする。 [#53353](https://github.com/ClickHouse/ClickHouse/pull/53353) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* fuzzer の CI からログをエクスポートするようにしました。 [#53354](https://github.com/ClickHouse/ClickHouse/pull/53354) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `clickhouse start` コマンドで環境変数を保持するようにしました。[#51962](https://github.com/ClickHouse/ClickHouse/issues/51962) を修正しました。[#53418](https://github.com/ClickHouse/ClickHouse/pull/53418)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* [#53418](https://github.com/ClickHouse/ClickHouse/issues/53418) のフォローアップ対応。install&#95;check.py の細かな改善と、`init.d start` でメインプロセスに適切な環境変数 (ENV) パラメータが渡されることを確認するテストを追加。[#53457](https://github.com/ClickHouse/ClickHouse/pull/53457)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* CMake におけるファイル管理を再編成し、重複の発生を防ぎます。たとえば、`indexHint.cpp` は `dbms_sources` と `clickhouse_functions_sources` の両方で重複しています。 [#53621](https://github.com/ClickHouse/ClickHouse/pull/53621) ([Amos Bird](https://github.com/amosbird))。
* Snappy を 1.1.10 にアップグレードしました。 [#53672](https://github.com/ClickHouse/ClickHouse/pull/53672) ([李扬](https://github.com/taiyang-li)).
* いくつかの依存関係を整理して一部の重複を削除することで、CMake ビルドをわずかに改善しました。各コミットには、行った変更内容の簡潔な説明が含まれています。 [#53759](https://github.com/ClickHouse/ClickHouse/pull/53759) ([Amos Bird](https://github.com/amosbird)).



#### バグ修正（公式の安定版リリースでユーザーに影響する不具合） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-4}

* 複数の mark がある場合の構築中に実験的な Annoy インデックスをリセットしないようにしました [#51325](https://github.com/ClickHouse/ClickHouse/pull/51325) ([Tian Xinhui](https://github.com/xinhuitian))。
* RESTORE 時における一時ディレクトリの扱いを修正 [#51493](https://github.com/ClickHouse/ClickHouse/pull/51493) ([Azat Khuzhin](https://github.com/azat)).
* Nullable(IPv4) に対するバイナリ算術演算を修正 [#51642](https://github.com/ClickHouse/ClickHouse/pull/51642) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* IPv4 および IPv6 データ型を辞書属性としてサポート [#51756](https://github.com/ClickHouse/ClickHouse/pull/51756) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 圧縮マークのチェックサムの修正 [#51777](https://github.com/ClickHouse/ClickHouse/pull/51777)（[SmitaRKulkarni](https://github.com/SmitaRKulkarni)）。
* CSV のベストエフォートパースにおいて、カンマが誤って日時の一部として解釈される問題を修正 [#51950](https://github.com/ClickHouse/ClickHouse/pull/51950) ([Kruglov Pavel](https://github.com/Avogar))。
* 実行可能な UDF にパラメータがある場合に例外をスローしないように変更 [#51961](https://github.com/ClickHouse/ClickHouse/pull/51961) ([Nikita Taranov](https://github.com/nickitat))。
* `ALTER DELETE` クエリにおけるスキップインデックスおよびプロジェクションの再計算処理を修正 [#52530](https://github.com/ClickHouse/ClickHouse/pull/52530) ([Anton Popov](https://github.com/CurtizJ)).
* MaterializedMySQL: ReadBuffer::read における無限ループを修正 [#52621](https://github.com/ClickHouse/ClickHouse/pull/52621) ([Val Doroshchuk](https://github.com/valbok))。
* `clickhouse` ダイアレクトでのみサジェストをロードするようにしました [#52628](https://github.com/ClickHouse/ClickHouse/pull/52628) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* オンデマンドで ares チャンネルを初期化および破棄します。 [#52634](https://github.com/ClickHouse/ClickHouse/pull/52634) ([Arthur Passos](https://github.com/arthurpassos)).
* OR 式を含む仮想カラムでのフィルタリングを修正 [#52653](https://github.com/ClickHouse/ClickHouse/pull/52653) ([Azat Khuzhin](https://github.com/azat)).
* 疎なカラムを1つだけ引数として渡した場合に `tuple` 関数がクラッシュする問題を修正 [#52659](https://github.com/ClickHouse/ClickHouse/pull/52659) ([Anton Popov](https://github.com/CurtizJ))。
* クラスタ内の名前付きコレクションを修正 [#52687](https://github.com/ClickHouse/ClickHouse/pull/52687) ([Al Korgun](https://github.com/alkorgun)).
* 複数段階の `PREWHERE` 使用時に不要なカラムの読み取りが発生する問題を修正 [#52689](https://github.com/ClickHouse/ClickHouse/pull/52689) ([Anton Popov](https://github.com/CurtizJ)).
* NULLS FIRST 指定の複数列ソートで発生していた予期しない結果を修正 [#52761](https://github.com/ClickHouse/ClickHouse/pull/52761) ([copperybean](https://github.com/copperybean)).
* Keeper の再構成におけるデータレースを修正 [#52804](https://github.com/ClickHouse/ClickHouse/pull/52804) ([Antonio Andelic](https://github.com/antonio2368))。
* 疎なカラムで大きな LIMIT を指定した場合のソートを修正 [#52827](https://github.com/ClickHouse/ClickHouse/pull/52827) ([Anton Popov](https://github.com/CurtizJ)).
* clickhouse-keeper: poll を使用するサーバーの実装を修正しました。 [#52833](https://github.com/ClickHouse/ClickHouse/pull/52833) ([Andy Fiddaman](https://github.com/citrus-it)).
* 正規表現アナライザーが名前付きキャプチャグループを認識できるようにした [#52840](https://github.com/ClickHouse/ClickHouse/pull/52840) ([Han Fei](https://github.com/hanfei1991)).
* clickhouse-local の `~PushingAsyncPipelineExecutor` で発生する可能性のあるアサーションを修正 [#52862](https://github.com/ClickHouse/ClickHouse/pull/52862)（[Kruglov Pavel](https://github.com/Avogar)）。
* 空の `Nested(Array(LowCardinality(...)))` の読み取り処理を修正 [#52949](https://github.com/ClickHouse/ClickHouse/pull/52949) ([Anton Popov](https://github.com/CurtizJ))。
* session&#95;log 向けの新しいテストを追加し、login と logout の不整合を修正しました。 [#52958](https://github.com/ClickHouse/ClickHouse/pull/52958) ([Alexey Gerasimchuck](https://github.com/Demilivor)).
* MySQL の SHOW CREATE TABLE におけるパスワード漏えいを修正 [#52962](https://github.com/ClickHouse/ClickHouse/pull/52962) ([Duc Canh Le](https://github.com/canhld94))。
* CreateSetAndFilterOnTheFlyStep でスパースカラム形式をフル形式に変換 [#53000](https://github.com/ClickHouse/ClickHouse/pull/53000) ([vdimir](https://github.com/vdimir))。
* FS キャッシュにおける、空のキー・プレフィックスを持つディレクトリ削除時のまれなレースコンディションを修正 [#53055](https://github.com/ClickHouse/ClickHouse/pull/53055) ([Kseniia Sumarokova](https://github.com/kssenii))。
* ZstdDeflatingWriteBuffer がまれに出力を途中で切り捨ててしまう問題を修正 [#53064](https://github.com/ClickHouse/ClickHouse/pull/53064) ([Michael Kolupaev](https://github.com/al13n321)).
* 非同期フラッシュクエリにおける part&#95;log 内の `query_id` を修正 [#53103](https://github.com/ClickHouse/ClickHouse/pull/53103) ([Raúl Marín](https://github.com/Algunenano))。
* キャッシュに起因する可能性のあるエラー「Read unexpected size」を修正 [#53121](https://github.com/ClickHouse/ClickHouse/pull/53121)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 新しい Parquet エンコーダを無効にする [#53130](https://github.com/ClickHouse/ClickHouse/pull/53130)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* &quot;Not-ready Set&quot; 例外を修正 [#53162](https://github.com/ClickHouse/ClickHouse/pull/53162) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
* PostgreSQL エンジンの文字エスケープ処理を修正 [#53250](https://github.com/ClickHouse/ClickHouse/pull/53250) ([Nikolay Degterinsky](https://github.com/evillique))。
* 実験的な `session_log` テーブル: `session_log` の新しいテストを追加し、ログインとログアウトの不整合を修正しました。 [#53255](https://github.com/ClickHouse/ClickHouse/pull/53255) ([Alexey Gerasimchuck](https://github.com/Demilivor))。ログイン成功時とログアウト時の不整合を修正しました。 [#53302](https://github.com/ClickHouse/ClickHouse/pull/53302) ([Alexey Gerasimchuck](https://github.com/Demilivor))。
* DateTime へのサブ秒単位の間隔追加を修正 [#53309](https://github.com/ClickHouse/ClickHouse/pull/53309) ([Michael Kolupaev](https://github.com/al13n321)).
* 辞書で発生する「Context has expired」エラーを修正 [#53342](https://github.com/ClickHouse/ClickHouse/pull/53342) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 通常プロジェクションの誤った AST 形式を修正 [#53347](https://github.com/ClickHouse/ClickHouse/pull/53347) ([Amos Bird](https://github.com/amosbird))。
* Scalar を実行する際に use&#95;structure&#95;from&#95;insertion&#95;table&#95;in&#95;table&#95;functions 設定の使用を禁止しました [#53348](https://github.com/ClickHouse/ClickHouse/pull/53348) ([flynn](https://github.com/ucasfl))。
* `system.table` への SELECT クエリ実行時における遅延ロードデータベースの読み込み処理を修正 [#53372](https://github.com/ClickHouse/ClickHouse/pull/53372) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
* MaterializedMySQL 向けの system.data&#95;skipping&#95;indices を修正しました [#53381](https://github.com/ClickHouse/ClickHouse/pull/53381) ([Filipp Ozinov](https://github.com/bakwc)).
* TSVファイルのセグメンテーションエンジンにおける単一のキャリッジリターン処理を修正 [#53407](https://github.com/ClickHouse/ClickHouse/pull/53407) ([Kruglov Pavel](https://github.com/Avogar)).
* `Context has expired` エラーを適切に修正 [#53433](https://github.com/ClickHouse/ClickHouse/pull/53433) ([Michael Kolupaev](https://github.com/al13n321))。
* IN 述語の右辺にサブクエリがある場合の `timeout_overflow_mode` を修正 [#53439](https://github.com/ClickHouse/ClickHouse/pull/53439) ([Duc Canh Le](https://github.com/canhld94))。
* [#53152](https://github.com/ClickHouse/ClickHouse/issues/53152) [#53440](https://github.com/ClickHouse/ClickHouse/pull/53440) における予期しない挙動を修正。([Zhiguo Zhou](https://github.com/ZhiguoZh))
* パスがすべて数値のときに発生する JSON&#95;QUERY 関数のパースエラーを修正 [#53470](https://github.com/ClickHouse/ClickHouse/pull/53470) ([KevinyhZou](https://github.com/KevinyhZou))。
* 並列 FINAL を使用するクエリにおける列順序の誤りを修正しました。 [#53489](https://github.com/ClickHouse/ClickHouse/pull/53489) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* do&#95;not&#95;merge&#95;across&#95;partitions&#95;select&#95;final を使用した ReplacingMergeTree からの SELECT の不具合を修正しました [#53511](https://github.com/ClickHouse/ClickHouse/pull/53511) ([Vasily Nemkov](https://github.com/Enmk)).
* シャットダウン時に非同期挿入キューを先にフラッシュするように変更 [#53547](https://github.com/ClickHouse/ClickHouse/pull/53547) ([joelynch](https://github.com/joelynch)).
* スパースカラムに対する JOIN で発生するクラッシュを修正 [#53548](https://github.com/ClickHouse/ClickHouse/pull/53548) ([vdimir](https://github.com/vdimir))。
* 誤った引数を取る関数に対する Set スキップインデックスで発生し得る未定義動作 (UB) を修正 [#53559](https://github.com/ClickHouse/ClickHouse/pull/53559) ([Azat Khuzhin](https://github.com/azat))。
* インバーテッドインデックス（実験的機能）における未定義動作（UB）の可能性を修正 [#53560](https://github.com/ClickHouse/ClickHouse/pull/53560) ([Azat Khuzhin](https://github.com/azat))。
* 修正: `interpolate` 式が、`SELECT` 式で同名のエイリアスが付けられた列ではなく、元の列を使用するようにしました。 [#53572](https://github.com/ClickHouse/ClickHouse/pull/53572) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* EXPLAIN PLAN index=1 でのドロップ済みグラニュール数の計算を修正 [#53616](https://github.com/ClickHouse/ClickHouse/pull/53616) ([wangxiaobo](https://github.com/wzb5212)).
* `DelayedSource` 使用時の totals および extremes の処理を正しく行うように修正 [#53644](https://github.com/ClickHouse/ClickHouse/pull/53644)（[Antonio Andelic](https://github.com/antonio2368)）。
* mutation パイプライン内で prepared set cache が停止してしまう問題を修正 [#53645](https://github.com/ClickHouse/ClickHouse/pull/53645) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
* UPDATE および DELETE クエリの述語で JSON 型サブカラムを使用するミューテーションに関するバグを修正。 [#53677](https://github.com/ClickHouse/ClickHouse/pull/53677) ([VanDarkholme7](https://github.com/VanDarkholme7)).
* full&#95;sorting&#95;merge join のフィルタープッシュダウンを修正 [#53699](https://github.com/ClickHouse/ClickHouse/pull/53699) ([vdimir](https://github.com/vdimir))。
* `NULL::LowCardinality(Nullable(...)) NOT IN` に関するバグ修正を試行しました [#53706](https://github.com/ClickHouse/ClickHouse/pull/53706) ([Andrey Zvonov](https://github.com/zvonand))。
* 修正: スパース列での sorted distinct [#53711](https://github.com/ClickHouse/ClickHouse/pull/53711) ([Igor Nikonov](https://github.com/devcrafter)).
* `transform`: 複数行を含む default 列を正しく処理する [#53742](https://github.com/ClickHouse/ClickHouse/pull/53742) ([Salvatore Mesoraca](https://github.com/aiven-sal))。
* parseDateTime における fuzzer によるクラッシュを修正 [#53764](https://github.com/ClickHouse/ClickHouse/pull/53764) ([Robert Schulze](https://github.com/rschu1ze))。
* MaterializedPostgreSQL: getCreateTableQueryImpl における未処理の例外を修正 [#53832](https://github.com/ClickHouse/ClickHouse/pull/53832) ([Kseniia Sumarokova](https://github.com/kssenii)).
* PostgreSQL エンジン使用時に発生する可能性があったセグメンテーションフォルトを修正 [#53847](https://github.com/ClickHouse/ClickHouse/pull/53847) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `named_collection_admin` エイリアスを修正 [#54066](https://github.com/ClickHouse/ClickHouse/pull/54066) ([Kseniia Sumarokova](https://github.com/kssenii)).

### <a id="237"></a> ClickHouse リリース 23.7, 2023-07-27 {#237}

#### 後方互換性のない変更 {#backward-incompatible-change-5}
* `NAMED COLLECTION` アクセスタイプ（エイリアス `USE NAMED COLLECTION`、`NAMED COLLECTION USAGE`）を追加しました。この PR は、このアクセスタイプがデフォルトで無効になっているため（親アクセスタイプである `NAMED COLLECTION ADMIN` もデフォルトで無効であるため）、後方互換性のない変更です。[#50277](https://github.com/ClickHouse/ClickHouse/issues/50277) で提案されました。使用を許可するには `GRANT NAMED COLLECTION ON collection_name TO user` または `GRANT NAMED COLLECTION ON * TO user` を使用してください。これらの権限を付与できるようにするには、設定ファイルで `named_collection_admin` が必要です（以前は `named_collection_control` という名前であり、エイリアスとして残ります）。[#50625](https://github.com/ClickHouse/ClickHouse/pull/50625)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* `system.parts` のカラム名 `last_removal_attemp_time` のタイポを修正しました。現在は `last_removal_attempt_time` という名前になっています。[#52104](https://github.com/ClickHouse/ClickHouse/pull/52104)（[filimonov](https://github.com/filimonov)）。
* `distributed_ddl_entry_format_version` のデフォルトバージョンを 5 に引き上げました（OpenTelemetry と `initial_query_idd` のパススルーを有効化します）。これにより、*ダウングレード* 後には既存の distributed DDL エントリを処理できなくなります（ただし、通常そのような未処理エントリは存在しないはずです）。[#52128](https://github.com/ClickHouse/ClickHouse/pull/52128)（[Azat Khuzhin](https://github.com/azat)）。
* プロジェクションのメタデータを、通常のメタデータと同じ方法でチェックするようにしました。この変更により、不正なプロジェクションを含むテーブルが存在する場合、サーバーが起動できなくなる可能性があります。例としては、PK 内に位置指定カラムを作成するプロジェクション（例: `projection p (select * order by 1, 4)`）があり、これはテーブルの PK では許可されず、挿入/マージ時にクラッシュを引き起こす可能性があります。アップデートの前に、そのようなプロジェクションは削除してください。[#52353](https://github.com/ClickHouse/ClickHouse/issues/52353) を修正します。[#52361](https://github.com/ClickHouse/ClickHouse/pull/52361)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* バグがあるため、実験的機能 `hashid` を削除しました。この実装の品質は当初から疑問視されており、実験的ステータスを脱することはありませんでした。これにより [#52406](https://github.com/ClickHouse/ClickHouse/issues/52406) がクローズされます。[#52449](https://github.com/ClickHouse/ClickHouse/pull/52449)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。

#### 新機能 {#new-feature-5}

* 複数のデータベースを 1 つに統合するための `Overlay` データベースエンジンを追加しました。ファイルシステム内のディレクトリを、自動検出されたフォーマットと構造を持つ暗黙的に利用可能なテーブル集合として表現するための `Filesystem` データベースエンジンを追加しました。新しい `S3` データベースエンジンにより、プレフィックスをテーブル集合として表現することで、S3 ストレージに読み取り専用でアクセスできるようになりました。新しい `HDFS` データベースエンジンにより、同様の方法で HDFS ストレージにアクセスできるようになりました。[#48821](https://github.com/ClickHouse/ClickHouse/pull/48821) ([alekseygolub](https://github.com/alekseygolub))。
* スナップショットとログの保存用に、Keeper に外部ディスクのサポートを追加しました。 [#50098](https://github.com/ClickHouse/ClickHouse/pull/50098) ([Antonio Andelic](https://github.com/antonio2368))。
* 複数ディレクトリ選択を行う（`{}`）グロブのサポートを追加。 [#50559](https://github.com/ClickHouse/ClickHouse/pull/50559)（[Andrey Zvonov](https://github.com/zvonand)）。
* Kafka コネクタは、URL エンコードした認証情報を用いるベーシック認証により、スキーマレジストリから Avro スキーマを取得できるようになりました。 [#49664](https://github.com/ClickHouse/ClickHouse/pull/49664) ([Ilya Golshtein](https://github.com/ilejn))。
* 2 つの配列間の Jaccard 類似度を計算する関数 `arrayJaccardIndex` を追加しました。 [#50076](https://github.com/ClickHouse/ClickHouse/pull/50076) ([FFFFFFFHHHHHHH](https://github.com/FFFFFFFHHHHHHH))。
* `system.settings` および類似のテーブルに `is_obsolete` 列を追加。[#50819](https://github.com/ClickHouse/ClickHouse/issues/50819) をクローズ。[#50826](https://github.com/ClickHouse/ClickHouse/pull/50826)（[flynn](https://github.com/ucasfl)）。
* 設定ファイル内の暗号化された要素のサポートを実装しました。設定ファイルの末端（リーフ）要素で暗号化されたテキストを使用できるようになりました。テキストは `<encryption_codecs>` セクションの暗号化コーデックを使用して暗号化されます。 [#50986](https://github.com/ClickHouse/ClickHouse/pull/50986) ([Roman Vasin](https://github.com/rvasin)).
* Grace Hash Join アルゴリズムが FULL JOIN および RIGHT JOIN にも適用可能になりました。[#49483](https://github.com/ClickHouse/ClickHouse/issues/49483)、[#51013](https://github.com/ClickHouse/ClickHouse/pull/51013)（[lgbo](https://github.com/lgbo-ustc)）。
* よりグレースフルに終了できるよう、`SYSTEM STOP LISTEN` クエリを追加しました。[#47972](https://github.com/ClickHouse/ClickHouse/issues/47972) をクローズします。[#51016](https://github.com/ClickHouse/ClickHouse/pull/51016)（[Nikolay Degterinsky](https://github.com/evillique)）。
* `input_format_csv_allow_variable_number_of_columns` オプションを追加しました。 [#51273](https://github.com/ClickHouse/ClickHouse/pull/51273) ([Dmitry Kardymon](https://github.com/kardymonds)).
* もう一つ地味な機能として、Spark や MySQL と同様に `substring_index` 関数を追加しました。 [#51472](https://github.com/ClickHouse/ClickHouse/pull/51472) ([李扬](https://github.com/taiyang-li))。
* jemalloc のビンごとの統計情報を表示するためのシステムテーブル `jemalloc_bins` を追加しました。例: `SELECT *, size * (nmalloc - ndalloc) AS allocated_bytes FROM system.jemalloc_bins WHERE allocated_bytes > 0 ORDER BY allocated_bytes DESC LIMIT 10`。ぜひ活用してください。 [#51674](https://github.com/ClickHouse/ClickHouse/pull/51674) ([Alexander Gololobov](https://github.com/davenger))。
* 各カラムの前に、そのカラムのデフォルト値を使用するかどうかを示すフラグ用の追加バイトを挿入する `RowBinaryWithDefaults` フォーマットを追加。 [#50854](https://github.com/ClickHouse/ClickHouse/issues/50854) をクローズ。 [#51695](https://github.com/ClickHouse/ClickHouse/pull/51695)（[Kruglov Pavel](https://github.com/Avogar)）。
* `default_temporary_table_engine` 設定を追加しました。`default_table_engine` と同様の設定ですが、一時テーブル用です。[#51292](https://github.com/ClickHouse/ClickHouse/issues/51292)。[#51708](https://github.com/ClickHouse/ClickHouse/pull/51708)（[velavokr](https://github.com/velavokr)）。
* 各単語の先頭の文字を大文字にし、残りを小文字に変換する新しい `initcap` / `initcapUTF8` 関数を追加しました。 [#51735](https://github.com/ClickHouse/ClickHouse/pull/51735) ([Dmitry Kardymon](https://github.com/kardymonds)).
* `CREATE TABLE` でカラム定義内の `PRIMARY KEY` 構文がサポートされました。カラムは定義されたのと同じ順序でプライマリインデックスに追加されます。 [#51881](https://github.com/ClickHouse/ClickHouse/pull/51881) ([Ilya Yatsishin](https://github.com/qoega)).
* ログおよびエラーログのファイル名に日時のフォーマット指定子を使用できるようになりました。設定ファイル（`log` および `errorlog` タグ）またはコマンドライン引数（`--log-file` および `--errorlog-file`）で指定できます。 [#51945](https://github.com/ClickHouse/ClickHouse/pull/51945) ([Victor Krasnov](https://github.com/sirvickr))。
* HTTP ヘッダーにピークメモリ使用量の統計情報を追加しました。 [#51946](https://github.com/ClickHouse/ClickHouse/pull/51946) ([Dmitry Kardymon](https://github.com/kardymonds)).
* 文字列内の部分列を検索するための新しい `hasSubsequence` 関数（`CaseInsensitive` および `UTF8` バージョンを含む）を追加しました。 [#52050](https://github.com/ClickHouse/ClickHouse/pull/52050) ([Dmitry Kardymon](https://github.com/kardymonds)).
* PostgreSQL 互換性のために `groupArray` のエイリアスとして `array_agg` を追加しました。[#52100](https://github.com/ClickHouse/ClickHouse/issues/52100) をクローズ。### ユーザー向け変更に関するドキュメント項目。[#52135](https://github.com/ClickHouse/ClickHouse/pull/52135) ([flynn](https://github.com/ucasfl)).
* 集約関数 `any` の互換性エイリアスとして `any_value` を追加しました。[#52140](https://github.com/ClickHouse/ClickHouse/issues/52140) をクローズします。[#52147](https://github.com/ClickHouse/ClickHouse/pull/52147)（[flynn](https://github.com/ucasfl)）。
* BigQuery との互換性を持たせるために、集約関数 `array_concat_agg` を追加しました。これは `groupArrayArray` のエイリアスです。 [#52139](https://github.com/ClickHouse/ClickHouse/issues/52139) をクローズ。 [#52149](https://github.com/ClickHouse/ClickHouse/pull/52149)（[flynn](https://github.com/ucasfl)）。
* `length` 関数の別名として `OCTET_LENGTH` を追加し、[#52153](https://github.com/ClickHouse/ClickHouse/issues/52153) をクローズ。[#52176](https://github.com/ClickHouse/ClickHouse/pull/52176)（[FFFFFFFHHHHHHH](https://github.com/FFFFFFFHHHHHHH)）。
* 複数行文字列から最初の行を抽出する `firstLine` 関数を追加しました。これにより[#51172](https://github.com/ClickHouse/ClickHouse/issues/51172) が解決されました。[#52209](https://github.com/ClickHouse/ClickHouse/pull/52209)（[Mikhail Koviazin](https://github.com/mkmkme)）。
* `Interval` データ型に対して KQL スタイルのフォーマットを実装しました。これは `Kusto` クエリ言語との互換性のためにのみ必要です。 [#45671](https://github.com/ClickHouse/ClickHouse/pull/45671) ([ltrk2](https://github.com/ltrk2))。
* クエリ `SYSTEM FLUSH ASYNC INSERT QUEUE` を追加し、保留中のすべての非同期挿入を宛先テーブルにフラッシュできるようにしました。サーバー側設定 `async_insert_queue_flush_on_shutdown`（デフォルトは `true`）を追加し、グレースフルシャットダウン時に非同期挿入キューをフラッシュするかどうかを制御できるようにしました。`async_insert_threads` 設定はサーバー側設定になりました。 [#49160](https://github.com/ClickHouse/ClickHouse/pull/49160) ([Anton Popov](https://github.com/CurtizJ))。
* PostgreSQL 互換性のために、`current_database` のエイリアスと新しい関数 `current_schemas` を追加しました。 [#51076](https://github.com/ClickHouse/ClickHouse/pull/51076) ([Pedro Riera](https://github.com/priera))。
* 関数 `today`（別名 `curdate` / `current_date`）および `now`（別名 `current_timestamp`）にエイリアスを追加しました。 [#52106](https://github.com/ClickHouse/ClickHouse/pull/52106) ([Lloyd-Pottiger](https://github.com/Lloyd-Pottiger)).
* 非同期挿入で `async_deduplication_token` をサポートするようになりました。 [#52136](https://github.com/ClickHouse/ClickHouse/pull/52136) ([Han Fei](https://github.com/hanfei1991)).
* URL エンジンで URI のパス部分のエンコード／デコードを無効化できる新しい設定 `disable_url_encoding` を追加しました。 [#52337](https://github.com/ClickHouse/ClickHouse/pull/52337) ([Kruglov Pavel](https://github.com/Avogar))。



#### パフォーマンスの向上 {#performance-improvement-5}

* デフォルトでスパースシリアル化形式を自動的に選択するようにします。これによりパフォーマンスが向上します。この形式はバージョン 22.1 以降でサポートされています。この変更の後、22.1 より古いバージョンへのダウングレードができない場合があります。ダウングレードには `ratio_of_defaults_for_sparse_serialization=0.9375` を設定する必要がある場合があります [55153](https://github.com/ClickHouse/ClickHouse/issues/55153)。MergeTree テーブルに対して `ratio_of_defaults_for_sparse_serialization = 1` の設定を行うことで、スパースシリアル化形式の使用を無効にできます。[#49631](https://github.com/ClickHouse/ClickHouse/pull/49631)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `move_all_conditions_to_prewhere` と `enable_multiple_prewhere_read_steps` の設定をデフォルトで有効化しました。 [#46365](https://github.com/ClickHouse/ClickHouse/pull/46365) ([Alexander Gololobov](https://github.com/davenger)).
* メモリアロケータを調整することで、一部のクエリのパフォーマンスを向上させます。 [#46416](https://github.com/ClickHouse/ClickHouse/pull/46416) ([Azat Khuzhin](https://github.com/azat)).
* `MergeTreeReadPool` と同様に、`MergeTreePrefetchedReadPool` でも固定サイズのタスクを使用するようにしました。また、今後は S3 リクエストにもコネクションプールを使用します。 [#49732](https://github.com/ClickHouse/ClickHouse/pull/49732) ([Nikita Taranov](https://github.com/nickitat)).
* 結合の右側へのプッシュダウンを拡張。[#50532](https://github.com/ClickHouse/ClickHouse/pull/50532) ([Nikita Taranov](https://github.com/nickitat))。
* ハッシュテーブルのサイズを事前に確保して grace&#95;hash join を改善（再投稿）。 [#50875](https://github.com/ClickHouse/ClickHouse/pull/50875) ([lgbo](https://github.com/lgbo-ustc))。
* `OpenedFileCache` 内でのロック待ちが、場合によっては目に見えて遅延として現れることがあります。このロック競合を避けるため、複数のサブマップ（それぞれが独自のロックを持つ）にシャーディングしました。 [#51341](https://github.com/ClickHouse/ClickHouse/pull/51341) ([Nikita Taranov](https://github.com/nickitat))。
* 主キー列を含む条件は、PREWHERE チェーンの末尾に移動します。これは、主キー列を含む条件は主キー解析に利用される可能性が高く、PREWHERE での追加的なフィルタリング効果は小さいと考えられるためです。 [#51958](https://github.com/ClickHouse/ClickHouse/pull/51958) ([Alexander Gololobov](https://github.com/davenger))。
* String 型に対する `COUNT(DISTINCT)` を、SipHash をインライン展開することで高速化しました。ICX デバイス（Intel Xeon Platinum 8380 CPU、80 コア、160 スレッド）上で *OnTime* を用いて行った性能実験では、この変更によりクエリ *Q8* の QPS が *11.6%* 向上し、他のクエリには影響しないことが確認されました。 [#52036](https://github.com/ClickHouse/ClickHouse/pull/52036) ([Zhiguo Zhou](https://github.com/ZhiguoZh)).
* デフォルトで `allow_vertical_merges_from_compact_to_wide_parts` を有効にしました。これにより、マージ処理中のメモリ使用量が削減されます。 [#52295](https://github.com/ClickHouse/ClickHouse/pull/52295) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* プライマリキーを無効にしてしまう誤ったプロジェクション解析を修正しました。この問題は `query_plan_optimize_primary_key = 1, query_plan_optimize_projection = 1` の場合にのみ発生します。この修正により [#48823](https://github.com/ClickHouse/ClickHouse/issues/48823) が解決されます。また、[#51173](https://github.com/ClickHouse/ClickHouse/issues/51173) も解決されます。[#52308](https://github.com/ClickHouse/ClickHouse/pull/52308)（[Amos Bird](https://github.com/amosbird)）。
* `FileCache::loadMetadata` 内でのシステムコール数を削減しました。これにより、ファイルシステムキャッシュが設定されている場合のサーバー起動が高速化されます。 [#52435](https://github.com/ClickHouse/ClickHouse/pull/52435) ([Raúl Marín](https://github.com/Algunenano)).
* バックグラウンドで残りのデータをダウンロードすることで、ファイルセグメントサイズに対して厳密な下限値を設定できるようにしました。実際のファイルサイズがそれより大きい場合のファイルセグメントの最小サイズは、キャッシュ設定項目 `boundary_alignment` で指定し、デフォルト値は `4Mi` です。バックグラウンドスレッド数はキャッシュ設定項目 `background_download_threads` で指定し、デフォルト値は `2` です。また、この PR では `max_file_segment_size` を `8Mi` から `32Mi` に増やしました。 [#51000](https://github.com/ClickHouse/ClickHouse/pull/51000) ([Kseniia Sumarokova](https://github.com/kssenii))。
* S3 のデフォルトタイムアウトを 30 秒から 3 秒に、その他の HTTP リクエストのデフォルトタイムアウトを 180 秒から 30 秒に短縮しました。 [#51171](https://github.com/ClickHouse/ClickHouse/pull/51171) ([Michael Kolupaev](https://github.com/al13n321)).
* 新しい設定 `merge_tree_determine_task_size_by_prewhere_columns` が追加されました。`true` に設定すると、読み取りタスクのサイズを決定する際に、`PREWHERE` 句に含まれるカラムのサイズのみが考慮されます。そうでない場合は、クエリ内のすべてのカラムが考慮されます。 [#52606](https://github.com/ClickHouse/ClickHouse/pull/52606) ([Nikita Taranov](https://github.com/nickitat))。



#### 改善点 {#improvement-5}

* s3/file/url/... テーブル関数の進捗バーで read&#95;bytes/total&#95;bytes&#95;to&#95;read を利用し、進捗がより分かりやすく表示されるようにしました。 [#51286](https://github.com/ClickHouse/ClickHouse/pull/51286) ([Kruglov Pavel](https://github.com/Avogar)).
* レプリケーション送信のためのインターサーバーハンドラを閉じる前にレプリカが待機する時間を指定するテーブル設定 `wait_for_unique_parts_send_before_shutdown_ms` を導入しました。また、テーブルとインターサーバーハンドラのシャットダウンに関する不整合も修正されました。サーバーはまずテーブルをシャットダウンし、その後でインターサーバーハンドラをシャットダウンするようになりました。 [#51851](https://github.com/ClickHouse/ClickHouse/pull/51851) ([alesapin](https://github.com/alesapin)).
* `OFFSET` なしの SQL 標準 `FETCH` を許可します。詳細は [https://antonz.org/sql-fetch/](https://antonz.org/sql-fetch/) を参照してください。[#51293](https://github.com/ClickHouse/ClickHouse/pull/51293)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* URL/S3 テーブル関数に対して、設定ファイルの新しい `http_forbid_headers` セクションを使用して HTTP ヘッダーをフィルタリングできるようになりました。完全一致と正規表現の両方のフィルタが利用可能です。 [#51038](https://github.com/ClickHouse/ClickHouse/pull/51038) ([Nikolay Degterinsky](https://github.com/evillique)).
* 意味がないため、ログに `16 EiB` の空き容量に関するメッセージを表示しないようにしました。これにより [#49320](https://github.com/ClickHouse/ClickHouse/issues/49320) がクローズされました。[#49342](https://github.com/ClickHouse/ClickHouse/pull/49342)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `sleepEachRow` 関数の上限を正しく検証するようにしました。`function_sleep_max_microseconds_per_block` 設定を追加しました。これは汎用的な query fuzzer のために必要です。 [#49343](https://github.com/ClickHouse/ClickHouse/pull/49343) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `geoHash` 関数における 2 つの不具合を修正しました。 [#50066](https://github.com/ClickHouse/ClickHouse/pull/50066) ([李扬](https://github.com/taiyang-li))。
* 非同期インサートのフラッシュクエリを `system.query_log` に記録します。 [#51160](https://github.com/ClickHouse/ClickHouse/pull/51160) ([Raúl Marín](https://github.com/Algunenano)).
* 関数 `date_diff` と `age` は、ミリ秒およびマイクロ秒の単位をサポートし、マイクロ秒精度で動作するようになりました。 [#51291](https://github.com/ClickHouse/ClickHouse/pull/51291) ([Dmitry Kardymon](https://github.com/kardymonds))。
* clickhouse-keeper-client におけるパス解析を改善。 [#51359](https://github.com/ClickHouse/ClickHouse/pull/51359) ([Azat Khuzhin](https://github.com/azat)).
* ClickHouse に依存しているサードパーティ製品（Gluten: Spark SQL のパフォーマンスを 2 倍にするプラグイン）にバグがありました。この修正により、HDFS からの読み取り時にそのサードパーティ製品で発生していたヒープオーバーフローを回避します。 [#51386](https://github.com/ClickHouse/ClickHouse/pull/51386) ([李扬](https://github.com/taiyang-li)).
* S3 に対するネイティブコピー機能を無効化できるようにしました（BACKUP/RESTORE 用設定 `allow_s3_native_copy`、および `s3`/`s3_plain` ディスク用 `s3_allow_native_copy`）。 [#51448](https://github.com/ClickHouse/ClickHouse/pull/51448) ([Azat Khuzhin](https://github.com/azat)).
* ディスク上の圧縮されたプライマリキーサイズを表示するため、`system.parts` テーブルに列 `primary_key_size` を追加しました。[#51400](https://github.com/ClickHouse/ClickHouse/issues/51400) をクローズします。[#51496](https://github.com/ClickHouse/ClickHouse/pull/51496)（[Yarik Briukhovetskyi](https://github.com/yariks5s)）。
* `clickhouse-local` を、procfs がなくても、ホームディレクトリが存在しなくても、glibc の名前解決プラグインがなくても実行できるようにしました。 [#51518](https://github.com/ClickHouse/ClickHouse/pull/51518) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* rename&#95;files&#95;after&#95;processing 設定に、完全なファイル名用のプレースホルダー `%a` を追加。 [#51603](https://github.com/ClickHouse/ClickHouse/pull/51603) ([Kruglov Pavel](https://github.com/Avogar)).
* カラム `modification_time` を `system.parts_columns` に追加しました。 [#51685](https://github.com/ClickHouse/ClickHouse/pull/51685) ([Azat Khuzhin](https://github.com/azat)).
* CSV フォーマットに新しい設定 `input_format_csv_use_default_on_bad_values` を追加しました。これにより、1 つのフィールドの解析に失敗した場合に、デフォルト値を挿入できるようになります。 [#51716](https://github.com/ClickHouse/ClickHouse/pull/51716) ([KevinyhZou](https://github.com/KevinyhZou))。
* 予期せぬクラッシュ後にクラッシュログをディスクにフラッシュする処理を追加しました。 [#51720](https://github.com/ClickHouse/ClickHouse/pull/51720) ([Alexey Gerasimchuck](https://github.com/Demilivor)).
* ダッシュボードページで認証とは無関係なエラーが表示されない問題を修正しました。また、「overlapping」チャートの動作も修正しました。 [#51744](https://github.com/ClickHouse/ClickHouse/pull/51744) ([Zach Naimon](https://github.com/ArctypeZach)).
* UUID から UInt128 への変換を許可しました。 [#51765](https://github.com/ClickHouse/ClickHouse/pull/51765) ([Dmitry Kardymon](https://github.com/kardymonds)).
* Nullable な引数を持つ `range` 関数のサポートを追加しました。 [#51767](https://github.com/ClickHouse/ClickHouse/pull/51767) ([Dmitry Kardymon](https://github.com/kardymonds)).
* `toYear(x) = c` のような条件を `c1 <= x < c2` に変換するようにしました。[#51795](https://github.com/ClickHouse/ClickHouse/pull/51795) ([Han Fei](https://github.com/hanfei1991)).
* `SHOW INDEX` ステートメントの MySQL との互換性を向上しました。 [#51796](https://github.com/ClickHouse/ClickHouse/pull/51796) ([Robert Schulze](https://github.com/rschu1ze)).
* `use_structure_from_insertion_table_in_table_functions` が `MATERIALIZED` および `ALIAS` カラムと併用した場合に動作しない問題を修正。 [#51817](https://github.com/ClickHouse/ClickHouse/issues/51817) をクローズ。 [#51019](https://github.com/ClickHouse/ClickHouse/issues/51019) をクローズ。 [#51825](https://github.com/ClickHouse/ClickHouse/pull/51825)（[flynn](https://github.com/ucasfl)）。
* キャッシュ辞書では、ソースから一意なキーのみを要求するようになりました。 [#51762](https://github.com/ClickHouse/ClickHouse/issues/51762) をクローズしました。 [#51853](https://github.com/ClickHouse/ClickHouse/pull/51853)（[Maksim Kita](https://github.com/kitaisreal)）。
* FORMAT が指定されている EXPLAIN クエリに設定が適用されない不具合を修正しました。[#51859](https://github.com/ClickHouse/ClickHouse/pull/51859) ([Nikita Taranov](https://github.com/nickitat)).
* `SELECT` クエリとの互換性を持たせるため、`DESCRIBE TABLE` クエリで `FORMAT` より前に `SETTINGS` を指定できるようにしました。 [#51544](https://github.com/ClickHouse/ClickHouse/issues/51544) をクローズ。 [#51899](https://github.com/ClickHouse/ClickHouse/pull/51899) ([Nikolay Degterinsky](https://github.com/evillique)).
* Var-Int でエンコードされた整数（例: ネイティブプロトコルで使用されるもの）は、64 ビットの全範囲を使用できるようになりました。サードパーティ製クライアントは、それに合わせて Var-Int コードを更新することが推奨されます。 [#51905](https://github.com/ClickHouse/ClickHouse/pull/51905) ([Robert Schulze](https://github.com/rschu1ze)).
* 証明書が変更された際に、手動で SYSTEM RELOAD CONFIG を実行しなくても更新されるようになりました。 [#52030](https://github.com/ClickHouse/ClickHouse/pull/52030) ([Mike Kot](https://github.com/myrrc)).
* `TYPE` が指定されていない `ADD INDEX` クエリを無視するための `allow_create_index_without_type` 設定を追加しました。標準的な SQL クエリは、テーブルスキーマを変更することなくエラーなく成功します。 [#52056](https://github.com/ClickHouse/ClickHouse/pull/52056) ([Ilya Yatsishin](https://github.com/qoega)).
* サーバーの起動時から、ログメッセージは `system.text_log` に書き込まれます。[#52113](https://github.com/ClickHouse/ClickHouse/pull/52113) ([Dmitry Kardymon](https://github.com/kardymonds))。
* HTTP エンドポイントに複数の IP アドレスがあり、先頭のアドレスに接続できない場合にタイムアウト例外がスローされていました。解決済みのすべてのエンドポイントを考慮してセッションを作成するように修正しました。 [#52116](https://github.com/ClickHouse/ClickHouse/pull/52116) ([Aleksei Filatov](https://github.com/aalexfvk)).
* Avro 入力フォーマットは、単一の型しか含まない場合でも Union をサポートするようになりました。これにより [#52131](https://github.com/ClickHouse/ClickHouse/issues/52131) がクローズされます。 [#52137](https://github.com/ClickHouse/ClickHouse/pull/52137) ([flynn](https://github.com/ucasfl)).
* 暗黙のプロジェクション（現在は `min_max_count` プロジェクションのみ）を無効化するための設定 `optimize_use_implicit_projections` を追加しました。 [#52152](https://github.com/ClickHouse/ClickHouse/pull/52152) ([Amos Bird](https://github.com/amosbird))。
* `hasToken` 関数を無限ループを引き起こす用途に使えてしまう不具合がありましたが、この問題は修正されました。これにより [#52156](https://github.com/ClickHouse/ClickHouse/issues/52156) がクローズされました。[#52160](https://github.com/ClickHouse/ClickHouse/pull/52160)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* ZK の祖先ノードを楽観的に作成します。 [#52195](https://github.com/ClickHouse/ClickHouse/pull/52195) ([Raúl Marín](https://github.com/Algunenano)).
* [#50582](https://github.com/ClickHouse/ClickHouse/issues/50582) を修正。インオーダー読み取りや定数を扱う一部のケースで発生していた `Not found column ... in block` エラーを回避。[#52259](https://github.com/ClickHouse/ClickHouse/pull/52259)（[Chen768959](https://github.com/Chen768959)）。
* ClickHouse 側で S2 Geo プリミティブが無効かどうかを、可能な限り早い段階でチェックします。これにより、次の Issue がクローズされます: [#27090](https://github.com/ClickHouse/ClickHouse/issues/27090)。[#52260](https://github.com/ClickHouse/ClickHouse/pull/52260)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* `query_plan_optimize_projection = 1` のときに欠落していたプロジェクション用の QueryAccessInfo を再度追加しました。これにより [#50183](https://github.com/ClickHouse/ClickHouse/issues/50183) および [#50093](https://github.com/ClickHouse/ClickHouse/issues/50093) が修正されます。[#52327](https://github.com/ClickHouse/ClickHouse/pull/52327)（[Amos Bird](https://github.com/amosbird)）。
* `ZooKeeperRetriesControl` がエラーを再スローする場合は、`ZooKeeperRetriesControl` 自身のスタックトレースではなく、元のスタックトレースが表示される方がより有用です。 [#52347](https://github.com/ClickHouse/ClickHouse/pull/52347) ([Vitaly Baranov](https://github.com/vitlibar))。
* 一部のディスクがゼロコピー レプリケーションのロックをサポートしていなくても、そのロックが取得されるまで待機するようにしました。 [#52376](https://github.com/ClickHouse/ClickHouse/pull/52376) ([Raúl Marín](https://github.com/Algunenano)).
* これにより、テーブルのシャットダウン完了後にのみ interserver ポートが閉じられるようになりました。 [#52498](https://github.com/ClickHouse/ClickHouse/pull/52498) ([alesapin](https://github.com/alesapin)).

#### 実験的機能 {#experimental-feature-2}
* Parquet ファイルの書き込みが 10 倍高速になり、マルチスレッド化されました。読み込みとほぼ同じ速度です。[#49367](https://github.com/ClickHouse/ClickHouse/pull/49367)（[Michael Kolupaev](https://github.com/al13n321)）。この挙動は設定 `output_format_parquet_use_custom_encoder` によって制御されますが、この機能はまだ理想的な状態ではないため、デフォルトでは無効になっています。
* クエリ言語として [PRQL](https://prql-lang.org/) のサポートを追加しました。[#50686](https://github.com/ClickHouse/ClickHouse/pull/50686)（[János Benjamin Antal](https://github.com/antaljanosbenjamin)）。
* カスタムディスクに対してディスク名を指定できるようにしました。以前はカスタムディスクは内部で生成されたディスク名を使用していました。現在は `disk = disk_<name>(...)`（例: ディスク名が `name` になる）のように指定できます。[#51552](https://github.com/ClickHouse/ClickHouse/pull/51552)（[Kseniia Sumarokova](https://github.com/kssenii)）。このリリースでは、この構文が変更される可能性があります。
* （実験的 MaterializedMySQL）切断後に `mysqlxx::Pool::Entry` が使用された際にクラッシュする問題を修正しました。[#52063](https://github.com/ClickHouse/ClickHouse/pull/52063)（[Val Doroshchuk](https://github.com/valbok)）。
* （実験的 MaterializedMySQL）MaterializedMySQL で `CREATE TABLE ... AS SELECT` .. がサポートされるようになりました。[#52067](https://github.com/ClickHouse/ClickHouse/pull/52067)（[Val Doroshchuk](https://github.com/valbok)）。
* （実験的 MaterializedMySQL）MaterializedMySQL 向けにテキスト型を utf8 に自動変換する機能を導入しました。[#52084](https://github.com/ClickHouse/ClickHouse/pull/52084)（[Val Doroshchuk](https://github.com/valbok)）。
* （実験的 MaterializedMySQL）MaterializedMySQL の DDL で、引用符なしの UTF-8 文字列がサポートされるようになりました。[#52318](https://github.com/ClickHouse/ClickHouse/pull/52318)（[Val Doroshchuk](https://github.com/valbok)）。
* （実験的 MaterializedMySQL）MaterializedMySQL で二重引用符によるコメントがサポートされるようになりました。[#52355](https://github.com/ClickHouse/ClickHouse/pull/52355)（[Val Doroshchuk](https://github.com/valbok)）。
* 1. Intel QPL を v1.1.0 から v1.2.0 にアップグレードしました。2. Intel accel-config を v3.5 から v4.0 にアップグレードしました。3. IAA アクセラレータにおいて Device IOTLB miss が大きなパフォーマンス低下を引き起こす問題を修正しました。[#52180](https://github.com/ClickHouse/ClickHouse/pull/52180)（[jasperzhu](https://github.com/jinjunzh)）。
* （バージョン 23.6 で新規導入された）`session_timezone` 設定を実験的機能に格下げしました。[#52445](https://github.com/ClickHouse/ClickHouse/pull/52445)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* インクリメンタルな再構成をサポートする ClickHouse Keeper で、ZooKeeper の `reconfig` コマンドに対応しました。この機能は `keeper_server.enable_reconfiguration` 設定で有効化できます。サーバーの追加、削除、およびサーバー優先度の変更をサポートします。[#49450](https://github.com/ClickHouse/ClickHouse/pull/49450)（[Mike Kot](https://github.com/myrrc)）。この機能は未完成である可能性があります。

#### ビルド／テスト／パッケージングの改善 {#buildtestingpackaging-improvement-5}
* Linux RISC-V 64 向けの実験的な ClickHouse ビルドを CI に追加。[#31398](https://github.com/ClickHouse/ClickHouse/pull/31398) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Analyzer を有効にした状態でのインテグレーションテストのチェックを追加。[#50926](https://github.com/ClickHouse/ClickHouse/pull/50926) [#52210](https://github.com/ClickHouse/ClickHouse/pull/52210) ([Dmitry Novik](https://github.com/novikd)).
* Rust の再現可能ビルドを実現。[#52395](https://github.com/ClickHouse/ClickHouse/pull/52395) ([Azat Khuzhin](https://github.com/azat)).
* Cargo の依存関係を更新。[#51721](https://github.com/ClickHouse/ClickHouse/pull/51721) ([Raúl Marín](https://github.com/Algunenano)).
* 関数 `CHColumnToArrowColumn::fillArrowArrayWithArrayColumnData` が nullable な配列でも動作するように変更。これは ClickHouse ではサポートされていないが、Gluten では必要。[#52112](https://github.com/ClickHouse/ClickHouse/pull/52112) ([李扬](https://github.com/taiyang-li)).
* CCTZ ライブラリを master ブランチの最新版に更新。ただしユーザーに見える変更はない。[#52124](https://github.com/ClickHouse/ClickHouse/pull/52124) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `system.licenses` テーブルに、ハードフォークされた Poco ライブラリを追加。これにより [#52066](https://github.com/ClickHouse/ClickHouse/issues/52066) がクローズされた。[#52127](https://github.com/ClickHouse/ClickHouse/pull/52127) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `Hello, world` ではなく `Hello ,world` のようにコンマの前に空白が入ってしまう、誤った句読点のケースがないことをチェック。[#52549](https://github.com/ClickHouse/ClickHouse/pull/52549) ([Alexey Milovidov](https://github.com/alexey-milovidov)).

#### バグ修正（公式安定版リリースでのユーザーに影響のある不具合） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-5}

* MaterializedPostgreSQL の syncTables を修正 [#49698](https://github.com/ClickHouse/ClickHouse/pull/49698) ([Kseniia Sumarokova](https://github.com/kssenii)).
* optimize&#95;aggregators&#95;of&#95;group&#95;by&#95;keys によるプロジェクションの不具合を修正 [#49709](https://github.com/ClickHouse/ClickHouse/pull/49709) ([Amos Bird](https://github.com/amosbird))。
* JOIN 使用時の `optimize_skip_unused_shards` を修正 [#51037](https://github.com/ClickHouse/ClickHouse/pull/51037) ([Azat Khuzhin](https://github.com/azat)).
* 小数部を持つ負の datetime64 に対する formatDateTime() の不具合を修正 [#51290](https://github.com/ClickHouse/ClickHouse/pull/51290) ([Dmitry Kardymon](https://github.com/kardymonds))。
* 関数 `hasToken*` の動作が完全に誤っていました。[#43358](https://github.com/ClickHouse/ClickHouse/issues/43358) [#51378](https://github.com/ClickHouse/ClickHouse/pull/51378) 向けのテストを追加しました（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 関数をソート前に移動する最適化を修正しました。 [#51481](https://github.com/ClickHouse/ClickHouse/pull/51481) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* FINAL 用の Pipe::unitePipes における Block 構造の不一致を修正 [#51492](https://github.com/ClickHouse/ClickHouse/pull/51492) ([Nikita Taranov](https://github.com/nickitat))。
* 全シャードで重みがゼロのクラスタで発生する SIGSEGV を修正（INSERT INTO FUNCTION clusterAllReplicas() の問題を修正） [#51545](https://github.com/ClickHouse/ClickHouse/pull/51545) ([Azat Khuzhin](https://github.com/azat))。
* ヘッジリクエストのタイムアウトを修正 [#51582](https://github.com/ClickHouse/ClickHouse/pull/51582) ([Azat Khuzhin](https://github.com/azat)).
* NULL を含む ANTI 結合の論理エラーを修正 [#51601](https://github.com/ClickHouse/ClickHouse/pull/51601) ([vdimir](https://github.com/vdimir))。
* `IN` 条件を PREWHERE に移動するロジックの修正 [#51610](https://github.com/ClickHouse/ClickHouse/pull/51610) ([Alexander Gololobov](https://github.com/davenger))。
* ASOF/ANTI JOIN に対しては PredicateExpressionsOptimizer を適用しないようにしました [#51633](https://github.com/ClickHouse/ClickHouse/pull/51633) ([vdimir](https://github.com/vdimir))。
* マージアルゴリズムを使用する ReplicatedMergeTree における重複排除付き非同期挿入を修正 [#51676](https://github.com/ClickHouse/ClickHouse/pull/51676)（[Antonio Andelic](https://github.com/antonio2368)）。
* `parseSipHashKey` で空のカラムから読み取ってしまう問題を修正 [#51804](https://github.com/ClickHouse/ClickHouse/pull/51804) ([Nikita Taranov](https://github.com/nickitat)).
* 不正な EmbeddedRocksdb テーブル作成時に発生するセグメンテーションフォールトを修正 [#51847](https://github.com/ClickHouse/ClickHouse/pull/51847) ([Duc Canh Le](https://github.com/canhld94)).
* MongoDB テーブルへの挿入処理を修正 [#51876](https://github.com/ClickHouse/ClickHouse/pull/51876) ([Nikolay Degterinsky](https://github.com/evillique))。
* DatabaseCatalog のシャットダウン時のデッドロックを修正 [#51908](https://github.com/ClickHouse/ClickHouse/pull/51908) ([Alexander Tokmakov](https://github.com/tavplubix))。
* サブクエリ演算子の不具合を修正 [#51922](https://github.com/ClickHouse/ClickHouse/pull/51922)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 複数の IP アドレスを持つホストへの非同期接続を修正 [#51934](https://github.com/ClickHouse/ClickHouse/pull/51934) ([Kruglov Pavel](https://github.com/Avogar))。
* ActionsDAG::merge 実行後に inputs を削除しないようにしました [#51947](https://github.com/ClickHouse/ClickHouse/pull/51947) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* 参照カウントの確認を `execute` ではなく `RemoveManyObjectStorageOperation::finalize` で行うように変更 [#51954](https://github.com/ClickHouse/ClickHouse/pull/51954) ([vdimir](https://github.com/vdimir)).
* パラメトリック UDF をサポート [#51964](https://github.com/ClickHouse/ClickHouse/pull/51964) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* toDateTime64() における 2283-12-31 以降の日付の軽微な修正 [#52130](https://github.com/ClickHouse/ClickHouse/pull/52130)（[Andrey Zvonov](https://github.com/zvonand) 氏）。
* ウィンドウ関数の ORDER BY 句のタプルを修正 [#52145](https://github.com/ClickHouse/ClickHouse/pull/52145) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 集約式に単調関数が含まれる場合の誤ったプロジェクション解析を修正 [#52151](https://github.com/ClickHouse/ClickHouse/pull/52151) ([Amos Bird](https://github.com/amosbird))。
* `groupArrayMoving` 関数の不具合を修正 [#52161](https://github.com/ClickHouse/ClickHouse/pull/52161)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* range 辞書に対する direct join を無効化 [#52187](https://github.com/ClickHouse/ClickHouse/pull/52187) ([Duc Canh Le](https://github.com/canhld94))。
* sticky mutations テストおよび極めてまれに発生するレースコンディションを修正 [#52197](https://github.com/ClickHouse/ClickHouse/pull/52197) ([alesapin](https://github.com/alesapin))。
* Web disk のレースコンディションを修正 [#52211](https://github.com/ClickHouse/ClickHouse/pull/52211) ([Kseniia Sumarokova](https://github.com/kssenii)).
* サーバーからの不明なパケットを処理する際の Connection::setAsyncCallback におけるデータレースを修正 [#52219](https://github.com/ClickHouse/ClickHouse/pull/52219) ([Kruglov Pavel](https://github.com/Avogar)).
* 起動時の一時データ削除処理を修正し、テストを追加 [#52275](https://github.com/ClickHouse/ClickHouse/pull/52275) ([vdimir](https://github.com/vdimir))。
* Nullable カラムのカウント時には minmax&#95;count プロジェクションを使用しないようにしました [#52297](https://github.com/ClickHouse/ClickHouse/pull/52297) ([Amos Bird](https://github.com/amosbird)).
* MergeTree/ReplicatedMergeTree がログエントリにサーバーのタイムゾーンを使用するようにしました [#52325](https://github.com/ClickHouse/ClickHouse/pull/52325) ([Azat Khuzhin](https://github.com/azat)).
* CTE を含み複数箇所で使用されるパラメータ化ビューを修正 [#52328](https://github.com/ClickHouse/ClickHouse/pull/52328) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
* 時間間隔用の式テンプレートを無効化 [#52335](https://github.com/ClickHouse/ClickHouse/pull/52335) ([Alexander Tokmakov](https://github.com/tavplubix))。
* Keeper の `apply_snapshot` を修正 [#52358](https://github.com/ClickHouse/ClickHouse/pull/52358) ([Antonio Andelic](https://github.com/antonio2368)).
* build-osx.md を更新 [#52377](https://github.com/ClickHouse/ClickHouse/pull/52377) ([AlexBykovski](https://github.com/AlexBykovski))。
* needle が空で haystack がカラムのときに `countSubstrings` がハングする問題を修正 [#52409](https://github.com/ClickHouse/ClickHouse/pull/52409) ([Sergei Trifonov](https://github.com/serxa))。
* Merge テーブルで通常のプロジェクションを修正  [#52432](https://github.com/ClickHouse/ClickHouse/pull/52432) ([Amos Bird](https://github.com/amosbird)).
* Aggregator で発生し得るダブルフリーを修正 [#52439](https://github.com/ClickHouse/ClickHouse/pull/52439)（[Nikita Taranov](https://github.com/nickitat)）。
* Buffer エンジンへの挿入の不具合を修正 [#52440](https://github.com/ClickHouse/ClickHouse/pull/52440) ([Vasily Nemkov](https://github.com/Enmk)).
* AnyHash の実装は非準拠でした。 [#52448](https://github.com/ClickHouse/ClickHouse/pull/52448) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* OptimizedRegularExpression で再帰深度をチェックする [#52451](https://github.com/ClickHouse/ClickHouse/pull/52451) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* DatabaseReplicated::startupTables()/canExecuteReplicatedMetadataAlter() のデータ競合を修正 [#52490](https://github.com/ClickHouse/ClickHouse/pull/52490) ([Azat Khuzhin](https://github.com/azat)).
* 関数 `transform` 内で発生する abort を修正 [#52513](https://github.com/ClickHouse/ClickHouse/pull/52513) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* プロジェクションを DROP した後の軽量削除の問題を修正 [#52517](https://github.com/ClickHouse/ClickHouse/pull/52517) ([Anton Popov](https://github.com/CurtizJ)).
* 発生し得るエラー「Cannot drain connections: cancel first」を修正 [#52585](https://github.com/ClickHouse/ClickHouse/pull/52585) ([Kruglov Pavel](https://github.com/Avogar)).

### <a id="236"></a> ClickHouse リリース 23.6, 2023-06-29 {#236}

#### 後方互換性のない変更 {#backward-incompatible-change-6}
* fs キャッシュから `do_not_evict_index_and_mark_files` 機能を削除しました。この機能はかえって状況を悪化させるだけでした。[#51253](https://github.com/ClickHouse/ClickHouse/pull/51253) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 実験的機能である LIVE VIEW に対する ALTER のサポートを削除しました。[#51287](https://github.com/ClickHouse/ClickHouse/pull/51287) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `http_max_field_value_size` と `http_max_field_name_size` のデフォルト値を 128 KiB に引き下げました。[#51163](https://github.com/ClickHouse/ClickHouse/pull/51163) ([Mikhail f. Shiryaev](https://github.com/Felixoid)).
* CPU に関連する CGroups メトリクスを 1 つのメトリクス `CGroupMaxCPU` に統合し、使いやすさを向上させました。`Normalized` CPU 使用率メトリクスは、制限が設定されている場合には総 CPU 数ではなく CGroups の制限値に対して正規化されるようになります。これにより [#50836](https://github.com/ClickHouse/ClickHouse/issues/50836) が解決されます。[#50835](https://github.com/ClickHouse/ClickHouse/pull/50835) ([Alexey Milovidov](https://github.com/alexey-milovidov)).

#### 新機能 {#new-feature-6}
* 関数 `transform` および値マッチングを行う `CASE` が、すべてのデータ型をサポートするようになりました。これにより [#29730](https://github.com/ClickHouse/ClickHouse/issues/29730)、[#32387](https://github.com/ClickHouse/ClickHouse/issues/32387)、[#50827](https://github.com/ClickHouse/ClickHouse/issues/50827)、[#31336](https://github.com/ClickHouse/ClickHouse/issues/31336)、[#40493](https://github.com/ClickHouse/ClickHouse/issues/40493) がクローズされました。[#51351](https://github.com/ClickHouse/ClickHouse/pull/51351)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* オプション `--rename_files_after_processing <pattern>` を追加しました。これにより [#34207](https://github.com/ClickHouse/ClickHouse/issues/34207) がクローズされました。[#49626](https://github.com/ClickHouse/ClickHouse/pull/49626)（[alekseygolub](https://github.com/alekseygolub)）。
* `INTO OUTFILE` 句で `TRUNCATE` 修飾子をサポートしました。ファイルが既に存在する場合は、`INTO OUTFILE` で `APPEND` または `TRUNCATE` を使用することを推奨します。[#50950](https://github.com/ClickHouse/ClickHouse/pull/50950)（[alekar](https://github.com/alekar)）。
* テーブルエンジン `Redis` とテーブル関数 `redis` を追加しました。これにより外部の Redis サーバーに対してクエリを実行できます。[#50150](https://github.com/ClickHouse/ClickHouse/pull/50150)（[JackyWoo](https://github.com/JackyWoo)）。
* 設定 `s3_skip_empty_files`、`hdfs_skip_empty_files`、`engine_file_skip_empty_files`、`engine_url_skip_empty_files` を使用して、file/s3/url/hdfs テーブル関数で空ファイルをスキップできるようになりました。[#50364](https://github.com/ClickHouse/ClickHouse/pull/50364)（[Kruglov Pavel](https://github.com/Avogar)）。
* MySQL 互換ポート経由でクライアントが接続されている場合に、`SHOW COLUMNS` SQL ステートメントを変更して MySQL 相当の型を表示するための新しい設定 `use_mysql_types_in_show_columns` を追加しました。[#49577](https://github.com/ClickHouse/ClickHouse/pull/49577)（[Thomas Panetti](https://github.com/tpanetti)）。
* `clickhouse-client` を `"--host"`、`"--port"`、`"--user"` などの代わりに接続文字列で呼び出せるようになりました。[#50689](https://github.com/ClickHouse/ClickHouse/pull/50689)（[Alexey Gerasimchuck](https://github.com/Demilivor)）。
* 設定 `session_timezone` を追加しました。これは、タイムゾーンが明示的に指定されていない場合にセッションのデフォルトタイムゾーンとして使用されます。[#44149](https://github.com/ClickHouse/ClickHouse/pull/44149)（[Andrey Zvonov](https://github.com/zvonand)）。
* コーデック DEFLATE_QPL は、設定 `"allow_experimental_codecs"` ではなく、サーバー設定 `"enable_deflate_qpl_codec"`（デフォルト: false）で制御されるようになりました。これにより DEFLATE_QPL は非実験的とみなされます。[#50775](https://github.com/ClickHouse/ClickHouse/pull/50775)（[Robert Schulze](https://github.com/rschu1ze)）。

#### パフォーマンスの改善 {#performance-improvement-6}
* `ReplicatedMergeTree` におけるマージ選択およびクリーンアップタスクのスケジューリングを改善しました。マージやクリーンアップ対象がない場合に、タスクが過度に頻繁に実行されないようにしました。設定項目 `max_merge_selecting_sleep_ms`、`merge_selecting_sleep_slowdown_factor`、`max_cleanup_delay_period`、`cleanup_thread_preferred_points_per_iteration` を追加しました。これにより [#31919](https://github.com/ClickHouse/ClickHouse/issues/31919) が解決されるはずです。 [#50107](https://github.com/ClickHouse/ClickHouse/pull/50107) ([Alexander Tokmakov](https://github.com/tavplubix)).
* CROSS JOIN に対してフィルタのプッシュダウンを行うようにしました。 [#50605](https://github.com/ClickHouse/ClickHouse/pull/50605) ([Han Fei](https://github.com/hanfei1991)).
* グローバルオブジェクトの代わりにスレッドローカルな `timer_id` を使用することで、QueryProfiler 有効時のパフォーマンスを改善しました。 [#48778](https://github.com/ClickHouse/ClickHouse/pull/48778) ([Jiebin Sun](https://github.com/jiebinn)).
* CapnProto 入出力フォーマットを書き直し、パフォーマンスを改善しました。カラム名と CapnProto フィールドの対応付けを大文字小文字を区別しないようにし、ネストした構造体フィールドの読み書きを修正しました。 [#49752](https://github.com/ClickHouse/ClickHouse/pull/49752) ([Kruglov Pavel](https://github.com/Avogar)).
* 並列スレッドにおける Parquet の書き込み性能を最適化しました。 [#50102](https://github.com/ClickHouse/ClickHouse/pull/50102) ([Hongbin Ma](https://github.com/binmahone)).
* `MATERIALIZED VIEW` の処理およびブロックが 1 つだけのストレージに対しては、`parallelize_output_from_storages` を無効化しました。 [#50214](https://github.com/ClickHouse/ClickHouse/pull/50214) ([Azat Khuzhin](https://github.com/azat)).
* PR [#46558](https://github.com/ClickHouse/ClickHouse/pull/46558) をマージしました。ブロックがすでにソートされている場合は、ソート時のブロックの並べ替えを回避します。 [#50697](https://github.com/ClickHouse/ClickHouse/pull/50697) ([Alexey Milovidov](https://github.com/alexey-milovidov)、[Maksim Kita](https://github.com/kitaisreal)).
* `system.zookeeper` テーブルからの読み取りを高速化するため、ZooKeeper への複数の list リクエストを並列に実行するようにしました。 [#51042](https://github.com/ClickHouse/ClickHouse/pull/51042) ([Alexander Gololobov](https://github.com/davenger)).
* タイムゾーン用 DateTime ルックアップテーブルの初期化を高速化しました。これにより、特にデバッグビルドのように重い場合でも、`clickhouse-client` の起動・接続時間が短縮されるはずです。 [#51347](https://github.com/ClickHouse/ClickHouse/pull/51347) ([Alexander Gololobov](https://github.com/davenger)).
* 同期的な HEAD リクエストが原因で発生していたデータレイクの低速化を修正しました。（大量のファイルがある Iceberg/Deltalake/Hudi で遅くなる問題に関連します。） [#50976](https://github.com/ClickHouse/ClickHouse/pull/50976) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 右側の GLOBAL JOIN テーブルからすべてのカラムを読み込まないようにしました。 [#50721](https://github.com/ClickHouse/ClickHouse/pull/50721) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).

#### 実験的機能 {#experimental-feature-3}
* アナライザで parallel replicas をサポートしました。 [#50441](https://github.com/ClickHouse/ClickHouse/pull/50441) ([Raúl Marín](https://github.com/Algunenano)).
* ゼロコピー複製の場合に、レプリカ間で負荷をより均等に分散するため、大規模なマージ／ミューテーションの実行前にランダムなスリープを挿入しました。 [#51282](https://github.com/ClickHouse/ClickHouse/pull/51282) ([alesapin](https://github.com/alesapin)).
* シャードが 1 つしかなく、基盤のテーブルが `ReplicatedMergeTree` の場合、`Replicated` データベースを介して `ALTER PARTITION` クエリおよびミューテーションをレプリケートしないようにしました。 [#51049](https://github.com/ClickHouse/ClickHouse/pull/51049) ([Alexander Tokmakov](https://github.com/tavplubix)).

#### 改善 {#improvement-6}

* &quot;too many parts&quot; のしきい値を、より現代的な環境に即した値となるよう緩和しました。長時間実行される INSERT クエリに対するバックプレッシャーを復活させました。 [#50856](https://github.com/ClickHouse/ClickHouse/pull/50856) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* CIDR ::ffff:0:0/96（IPv4 マップドアドレス）に対して、IPv6 アドレスから IPv4 アドレスへのキャストを許可します。[#49759](https://github.com/ClickHouse/ClickHouse/pull/49759)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* MongoDB プロトコルを更新し、MongoDB 5.1 以降のバージョンをサポートしました。古いプロトコル（バージョン 3.6 未満）へのサポートは維持されています。[#45621](https://github.com/ClickHouse/ClickHouse/issues/45621)、[#49879](https://github.com/ClickHouse/ClickHouse/issues/49879) をクローズしました。[#50061](https://github.com/ClickHouse/ClickHouse/pull/50061)（[Nikolay Degterinsky](https://github.com/evillique)）。
* スキーマ推論時に読み取るバイト数を制限するための設定 `input_format_max_bytes_to_read_for_schema_inference` を追加しました。[#50577](https://github.com/ClickHouse/ClickHouse/issues/50577) をクローズ。 [#50592](https://github.com/ClickHouse/ClickHouse/pull/50592)（[Kruglov Pavel](https://github.com/Avogar)）。
* スキーマ推論時に `input_format_null_as_default` 設定が反映されるようにしました。 [#50602](https://github.com/ClickHouse/ClickHouse/pull/50602) ([Kruglov Pavel](https://github.com/Avogar)).
* CSV/TSV/CustomSeparated フォーマットにおいて、設定 `input_format_csv_skip_trailing_empty_lines`、`input_format_tsv_skip_trailing_empty_lines`、`input_format_custom_skip_trailing_empty_lines` により末尾の空行をスキップできるようにしました（デフォルトでは無効）。[#49315](https://github.com/ClickHouse/ClickHouse/issues/49315) をクローズしました。[#50635](https://github.com/ClickHouse/ClickHouse/pull/50635)（[Kruglov Pavel](https://github.com/Avogar)）。
* 関数「toDateOrDefault|OrNull」および「accuateCast[OrDefault|OrNull]」が、数値引数を正しく解析するようになりました。 [#50709](https://github.com/ClickHouse/ClickHouse/pull/50709) ([Dmitry Kardymon](https://github.com/kardymonds)).
* 空白または `\t` をフィールド区切り文字とする CSV をサポートし、これらの区切り文字は Spark でも利用可能です。 [#50712](https://github.com/ClickHouse/ClickHouse/pull/50712) ([KevinyhZou](https://github.com/KevinyhZou))。
* `number_of_mutations_to_delay` と `number_of_mutations_to_throw` の設定が、デフォルトで有効になり、それぞれの値は 500 と 1000 になりました。 [#50726](https://github.com/ClickHouse/ClickHouse/pull/50726) ([Anton Popov](https://github.com/CurtizJ))。
* ダッシュボードで欠損値が正しく表示されるようになりました。これにより [#50831](https://github.com/ClickHouse/ClickHouse/issues/50831) がクローズされました。[#50832](https://github.com/ClickHouse/ClickHouse/pull/50832)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 関数 `parseDateTimeBestEffort*` および `parseDateTime64BestEffort*` で、syslog のタイムスタンプ形式の日付・時刻引数を使用できるようになりました。 [#50925](https://github.com/ClickHouse/ClickHouse/pull/50925) ([Victor Krasnov](https://github.com/sirvickr)).
* clickhouse-client のコマンドラインパラメータ &quot;--password&quot; は、一度しか指定できなくなりました。 [#50966](https://github.com/ClickHouse/ClickHouse/pull/50966) ([Alexey Gerasimchuck](https://github.com/Demilivor)).
* クラスタ内バックアップの際にパーツの同一性を確認するため、`system.parts` の `hash_of_all_files` を使用します。 [#50997](https://github.com/ClickHouse/ClickHouse/pull/50997)（[Vitaly Baranov](https://github.com/vitlibar)）。
* システムテーブル `zookeeper_connection` の `connected_time` は、接続が確立された時刻（標準フォーマット）を示し、確立された接続セッションの継続時間（秒単位）を示す `session_uptime_elapsed_seconds` 列が追加されました。 [#51026](https://github.com/ClickHouse/ClickHouse/pull/51026) ([郭小龙](https://github.com/guoxiaolongzte)).
* file/s3/hdfs/url テーブル関数のプログレスバーを、ソースデータのチャンクサイズを利用し、各スレッドで合計サイズを増分的にカウントすることで改善しました。*Cluster 関数向けのプログレスバーも修正しました。これにより [#47250](https://github.com/ClickHouse/ClickHouse/issues/47250) がクローズされます。[#51088](https://github.com/ClickHouse/ClickHouse/pull/51088)（[Kruglov Pavel](https://github.com/Avogar)）。
* Progress バーを改善するため、TCP プロトコルの Progress パケットに total&#95;bytes&#95;to&#95;read を追加。 [#51158](https://github.com/ClickHouse/ClickHouse/pull/51158) ([Kruglov Pavel](https://github.com/Avogar)).
* ファイルシステムキャッシュを利用したディスク上のデータパーツのチェックを改善。 [#51164](https://github.com/ClickHouse/ClickHouse/pull/51164) ([Anton Popov](https://github.com/CurtizJ)).
* fs キャッシュにおいて `current_elements_num` が正しくない場合がある問題を修正。 [#51242](https://github.com/ClickHouse/ClickHouse/pull/51242) ([Kseniia Sumarokova](https://github.com/kssenii)).

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-6}
* スタンドアロンの keeper バイナリに埋め込みの keeper-client を追加しました。 [#50964](https://github.com/ClickHouse/ClickHouse/pull/50964) ([pufit](https://github.com/pufit)).
* 実際に使用される LZ4 バージョンが利用されるようになりました。 [#50621](https://github.com/ClickHouse/ClickHouse/pull/50621) ([Nikita Taranov](https://github.com/nickitat)).
* 致命的エラー発生時に、ClickHouse server が変更された設定の一覧を出力するようになりました。これにより [#51137](https://github.com/ClickHouse/ClickHouse/issues/51137) がクローズされました。 [#51138](https://github.com/ClickHouse/ClickHouse/pull/51138) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* ClickHouse を clang-17 でビルドできるようにしました。 [#51300](https://github.com/ClickHouse/ClickHouse/pull/51300) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* [SQLancer](https://github.com/sqlancer/sqlancer) チェックは、それによってトリガーされたバグが修正されたため、安定と見なされるようになりました。今後は、SQLancer チェックの失敗は失敗したチェックステータスとして報告されます。 [#51340](https://github.com/ClickHouse/ClickHouse/pull/51340) ([Ilya Yatsishin](https://github.com/qoega)).
* Dockerfile の巨大な `RUN` を、より小さな条件付きのものに分割しました。同じ `RUN` レイヤー内で必要なツールをオンデマンドでインストールし、その後削除します。OS のアップグレードは冒頭で 1 回だけ実施します。署名済みリポジトリのチェックには最新の方法を使用します。古い docker バージョンでの問題に対処するため、ベースリポジトリを ubuntu:20.04 にダウングレードしました。golang の脆弱性に対処するため、golang のバージョンをアップグレードしました。 [#51504](https://github.com/ClickHouse/ClickHouse/pull/51504) ([Mikhail f. Shiryaev](https://github.com/Felixoid)).

#### バグ修正（公式安定版リリースにおけるユーザーに見える誤動作） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-6}

* 実行可能辞書の読み込みステータスを正しく報告するように修正 [#48775](https://github.com/ClickHouse/ClickHouse/pull/48775) ([Anton Kozlov](https://github.com/tonickkozlov)).
* スキップインデックスおよびプロジェクションに対するミューテーションの適切な処理 [#50104](https://github.com/ClickHouse/ClickHouse/pull/50104) ([Amos Bird](https://github.com/amosbird)).
* 可動部分の整理 [#50489](https://github.com/ClickHouse/ClickHouse/pull/50489) ([vdimir](https://github.com/vdimir))。
* 集約関数における IP 型のハッシュの後方互換性を修正 [#50551](https://github.com/ClickHouse/ClickHouse/pull/50551) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* Log ファミリーテーブルが `TRUNCATE` 後に誤った行数を返す問題を修正 [#50585](https://github.com/ClickHouse/ClickHouse/pull/50585) ([flynn](https://github.com/ucasfl)).
* `uniqExact` の並列マージ処理におけるバグを修正 [#50590](https://github.com/ClickHouse/ClickHouse/pull/50590) ([Nikita Taranov](https://github.com/nickitat))。
* 最近の grace hash join の変更をリバート [#50699](https://github.com/ClickHouse/ClickHouse/pull/50699) ([vdimir](https://github.com/vdimir))。
* クエリキャッシュ: `ColumnConst` から `ColumnVector<char8_t>` への不正なキャストを修正 [#50704](https://github.com/ClickHouse/ClickHouse/pull/50704) ([Robert Schulze](https://github.com/rschu1ze)).
* 未知の操作を含むログを Keeper に保存しないようにしました [#50751](https://github.com/ClickHouse/ClickHouse/pull/50751)（[Antonio Andelic](https://github.com/antonio2368)）。
* DateTime64 に対する SummingMergeTree のサポート [#50797](https://github.com/ClickHouse/ClickHouse/pull/50797) ([Jordi Villar](https://github.com/jrdi))。
* const でないタイムゾーン用の互換性設定を追加 [#50834](https://github.com/ClickHouse/ClickHouse/pull/50834) ([Robert Schulze](https://github.com/rschu1ze))。
* キャッシュエントリ内の LDAP パラメータのハッシュ処理を修正 [#50865](https://github.com/ClickHouse/ClickHouse/pull/50865) ([Julian Maicher](https://github.com/jmaicher))。
* Parquet 形式で、例外を送出する代わりに String から big integer をパースするフォールバックを行うよう変更 [#50873](https://github.com/ClickHouse/ClickHouse/pull/50873) ([Kruglov Pavel](https://github.com/Avogar)).
* バックアップの書き込み中にロックファイルを過剰にチェックしてしまう問題を修正 [#50889](https://github.com/ClickHouse/ClickHouse/pull/50889) ([Vitaly Baranov](https://github.com/vitlibar))。
* read-in-order が有効な場合は projection を適用しないようにしました。 [#50923](https://github.com/ClickHouse/ClickHouse/pull/50923) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
* Azure Blob Storage イテレータにおけるレースコンディションを修正 [#50936](https://github.com/ClickHouse/ClickHouse/pull/50936) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
* `CreatingSets` における `sort_description` の誤った伝播を修正 [#50955](https://github.com/ClickHouse/ClickHouse/pull/50955) ([Nikita Taranov](https://github.com/nickitat))。
* Iceberg v2 のオプションメタデータ解析を修正 [#50974](https://github.com/ClickHouse/ClickHouse/pull/50974) ([Kseniia Sumarokova](https://github.com/kssenii)).
* MaterializedMySQL: 空テーブルのオーバーライド時に括弧を保持するようにしました [#50977](https://github.com/ClickHouse/ClickHouse/pull/50977) ([Val Doroshchuk](https://github.com/valbok)).
* BackupCoordinationStageSync::setError() 内で発生するクラッシュの問題を修正 [#51012](https://github.com/ClickHouse/ClickHouse/pull/51012) ([Vitaly Baranov](https://github.com/vitlibar))。
* ColumnLowCardinality 辞書における copy-on-write の微妙な不具合を修正 [#51064](https://github.com/ClickHouse/ClickHouse/pull/51064) ([Michael Kolupaev](https://github.com/al13n321)).
* 安全な IV の生成 [#51086](https://github.com/ClickHouse/ClickHouse/pull/51086) ([Salvatore Mesoraca](https://github.com/aiven-sal)).
* サブクエリを含む SELECT に対してクエリキャッシュが正しく機能していなかった問題を修正 [#51132](https://github.com/ClickHouse/ClickHouse/pull/51132) ([Robert Schulze](https://github.com/rschu1ze)).
* 定数 Nullable 値との比較を行う Set インデックスを修正しました。 [#51205](https://github.com/ClickHouse/ClickHouse/pull/51205) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* s3 および s3Cluster 関数のクラッシュを修正 [#51209](https://github.com/ClickHouse/ClickHouse/pull/51209) ([Nikolay Degterinsky](https://github.com/evillique))。
* コンパイル済みの式で発生するクラッシュを修正 [#51231](https://github.com/ClickHouse/ClickHouse/pull/51231) ([LiuNeng](https://github.com/liuneng1994)).
* URL 切り替え時の StorageURL における use-after-free を修正 [#51260](https://github.com/ClickHouse/ClickHouse/pull/51260) ([Michael Kolupaev](https://github.com/al13n321))。
* パラメータ化されたビューのチェックを更新しました [#51272](https://github.com/ClickHouse/ClickHouse/pull/51272) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
* バックアップへの同一ファイルの複数回書き込みを修正 [#51299](https://github.com/ClickHouse/ClickHouse/pull/51299) ([Vitaly Baranov](https://github.com/vitlibar)).
* ActionsDAG で発生する fuzzer の失敗を修正 [#51301](https://github.com/ClickHouse/ClickHouse/pull/51301)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `transform` 関数から不要な処理を削除 [#51350](https://github.com/ClickHouse/ClickHouse/pull/51350) ([Alexey Milovidov](https://github.com/alexey-milovidov)).

### <a id="235"></a> ClickHouse リリース 23.5, 2023-06-08 {#235}

#### アップグレードに関する注意事項 {#upgrade-notes}
* マークとプライマリキーをデフォルトで圧縮します。これによりコールドクエリの処理時間が大幅に短縮されます。アップグレードに関する注意事項: 圧縮されたマークおよびプライマリキーのサポートはバージョン 22.9 で追加されました。圧縮マークまたはプライマリキーを有効にした場合、あるいはそれらがデフォルトで有効になっているバージョン 23.5 以降をインストールした場合、バージョン 22.8 以前へダウングレードすることはできません。また、サーバー設定ファイルの `<merge_tree>` セクションで `compress_marks` および `compress_primary_key` 設定を指定することで、圧縮マークやプライマリキーを明示的に無効化することもできます。**アップグレードに関する注意事項:** 22.9 より前のバージョンからアップグレードする場合は、すべてのレプリカを一度にアップグレードするか、アップグレード前に圧縮を無効にするか、あるいは圧縮マークがサポートされているもののデフォルトでは有効になっていない中間バージョン (例: 23.3) を経由してアップグレードしてください。[#42587](https://github.com/ClickHouse/ClickHouse/pull/42587) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* ローカルオブジェクトストレージが S3 オブジェクトストレージと一貫して動作するようにし、append に関する問題を修正します ([#48465](https://github.com/ClickHouse/ClickHouse/issues/48465) をクローズ)、さらに独立したストレージとして設定可能にします。この変更は後方互換性がありません。ローカルオブジェクトストレージ上のキャッシュが、以前のバージョンとは互換性がないためです。[#48791](https://github.com/ClickHouse/ClickHouse/pull/48791) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 実験的機能であった「in-memory data parts」は削除されました。データ形式自体は引き続きサポートされますが、関連する設定は no-op (何もしない) となり、代わりに compact または wide パーツが使用されます。これにより [#45409](https://github.com/ClickHouse/ClickHouse/issues/45409) がクローズされます。[#49429](https://github.com/ClickHouse/ClickHouse/pull/49429) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 設定 `parallelize_output_from_storages` と `input_format_parquet_preserve_order` のデフォルト値を変更しました。これにより、ファイル (例: CSV や Parquet) から読み込む際に ClickHouse が行の順序を並べ替えることが可能になり、多くの場合に性能が大きく向上します。従来の順序維持の動作を復元するには、`parallelize_output_from_storages = 0`, `input_format_parquet_preserve_order = 1` を使用してください。[#49479](https://github.com/ClickHouse/ClickHouse/pull/49479) ([Michael Kolupaev](https://github.com/al13n321)).
* プロジェクションを本番運用レベルにしました。`optimize_use_projections` 設定を追加し、SELECT クエリに対してプロジェクションを選択するかどうかを制御できるようにしました。設定 `allow_experimental_projection_optimization` は廃止され、何の効果も持ちません。[#49719](https://github.com/ClickHouse/ClickHouse/pull/49719) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `joinGet` を非決定的 (同様に `dictGet` も) としてマークしました。これにより、追加の設定なしでミューテーション内で使用できるようになります。[#49843](https://github.com/ClickHouse/ClickHouse/pull/49843) ([Azat Khuzhin](https://github.com/azat)).
* 「`groupArray` の戻り値は Nullable にはなりえない」という変更をリバートしました (`Nullable` 型上の `groupArray` / `groupArrayLast` / `groupArraySample` に対するバイナリ互換性が壊れ、`TOO_LARGE_ARRAY_SIZE` または `CANNOT_READ_ALL_DATA` が発生する可能性が高いため)。[#49971](https://github.com/ClickHouse/ClickHouse/pull/49971) ([Azat Khuzhin](https://github.com/azat)).
* 設定 `enable_memory_bound_merging_of_aggregation_results` がデフォルトで有効になりました。22.12 より前のバージョンからアップデートする場合は、アップデートが完了するまでこのフラグを `false` に設定することを推奨します。[#50319](https://github.com/ClickHouse/ClickHouse/pull/50319) ([Nikita Taranov](https://github.com/nickitat)).

#### 新機能 {#new-feature-7}

* ストレージエンジン AzureBlobStorage と azureBlobStorage テーブル関数を追加しました。サポートされている機能群は、S3 ストレージエンジン／テーブル関数のものと非常によく似ています [#50604] ([https://github.com/ClickHouse/ClickHouse/pull/50604](https://github.com/ClickHouse/ClickHouse/pull/50604)) ([alesapin](https://github.com/alesapin)) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* ネイティブの ClickHouse Keeper CLI クライアントを追加しました。`clickhouse keeper-client` として利用できます。[#47414](https://github.com/ClickHouse/ClickHouse/pull/47414)（[pufit](https://github.com/pufit)）
* `urlCluster` テーブル関数を追加。コードの重複を減らすため、すべての *Cluster テーブル関数をリファクタリング。あらゆる *Cluster 関数シグネチャおよび名前付きコレクションに対してスキーマ推論が機能するように対応。[#38499](https://github.com/ClickHouse/ClickHouse/issues/38499) をクローズ。[#45427](https://github.com/ClickHouse/ClickHouse/pull/45427)（[attack204](https://github.com/attack204)）、Pavel Kruglov。
* クエリキャッシュは本番環境のワークロードでも使用できるようになりました。 [#47977](https://github.com/ClickHouse/ClickHouse/pull/47977) ([Robert Schulze](https://github.com/rschu1ze))。クエリキャッシュは `totals` および `extremes` 修飾子を持つクエリもサポートするようになりました。 [#48853](https://github.com/ClickHouse/ClickHouse/pull/48853) ([Robert Schulze](https://github.com/rschu1ze))。後方互換性のため、`allow_experimental_query_cache` 設定は非推奨となりました。この設定は [https://github.com/ClickHouse/ClickHouse/pull/47977](https://github.com/ClickHouse/ClickHouse/pull/47977) で削除されています。 [#49934](https://github.com/ClickHouse/ClickHouse/pull/49934) ([Timur Solodovnikov](https://github.com/tsolodov))。
* 地理データ型（`Point`、`Ring`、`Polygon`、`MultiPolygon`）が本番環境での利用に対応しました。 [#50022](https://github.com/ClickHouse/ClickHouse/pull/50022) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* PostgreSQL、MySQL、MeiliSearch、および SQLite のテーブルエンジンにスキーマ推論を追加しました。[#49972](https://github.com/ClickHouse/ClickHouse/issues/49972) をクローズ。[#50000](https://github.com/ClickHouse/ClickHouse/pull/50000)（[Nikolay Degterinsky](https://github.com/evillique)）。
* `CREATE USER u IDENTIFIED BY 'p'` のようなクエリで指定されたパスワードのタイプは、サーバー上の `config.xml` にある設定項目 `default_password_type` に従って自動的に設定されます。 [#42915](https://github.com/ClickHouse/ClickHouse/issues/42915) をクローズしました。 [#44674](https://github.com/ClickHouse/ClickHouse/pull/44674)（[Nikolay Degterinsky](https://github.com/evillique)）。
* bcrypt パスワード認証方式を追加。 [#34599](https://github.com/ClickHouse/ClickHouse/issues/34599) をクローズ。 [#44905](https://github.com/ClickHouse/ClickHouse/pull/44905)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 新しいキーワード `INTO OUTFILE 'file.txt' APPEND` を追加。 [#48880](https://github.com/ClickHouse/ClickHouse/pull/48880) ([alekar](https://github.com/alekar)).
* Keeper 接続に関する情報を表示する `system.zookeeper_connection` テーブルを追加しました。 [#45245](https://github.com/ClickHouse/ClickHouse/pull/45245) ([mateng915](https://github.com/mateng0915)).
* ランダムなテーブル構造を生成する新しい関数 `generateRandomStructure` を追加しました。テーブル関数 `generateRandom` と組み合わせて使用できます。 [#47409](https://github.com/ClickHouse/ClickHouse/pull/47409) ([Kruglov Pavel](https://github.com/Avogar)).
* `ELSE` ブランチなしで `CASE` を使用できるようにし、より多くの型を扱えるように `transform` を拡張しました。また、Decimal 型が他の数値型と混在している場合に transform() が誤った結果を返してしまういくつかの問題も修正しました。 [#48300](https://github.com/ClickHouse/ClickHouse/pull/48300) ([Salvatore Mesoraca](https://github.com/aiven-sal))。これにより #2655 がクローズされます。これにより #9596 がクローズされます。これにより #38666 がクローズされます。
* S3 テーブルに [KMS キーを使用したサーバーサイド暗号化](https://docs.aws.amazon.com/AmazonS3/latest/userguide/UsingKMSEncryption.html) を追加し、S3 ディスクに `header` 設定を追加しました。 [#48723](https://github.com/ClickHouse/ClickHouse/issues/48723) をクローズしました。 [#48724](https://github.com/ClickHouse/ClickHouse/pull/48724)（[Johann Gan](https://github.com/johanngan)）。
* バックグラウンドタスク（マージおよびミューテーション）用に MemoryTracker を追加しました。マージとミューテーション用のソフトなメモリ上限を表す設定 `merges_mutations_memory_usage_soft_limit` と `merges_mutations_memory_usage_to_ram_ratio` を導入しています。この上限に達した場合、ClickHouse は新しいマージまたはミューテーションタスクをスケジュールしません。また、バックグラウンドタスクの現在のメモリ使用量を監視できるようにするため、`MergesMutationsMemoryTracking` メトリクスも導入しました。[#46089](https://github.com/ClickHouse/ClickHouse/issues/46089) の再提出です。[#48774](https://github.com/ClickHouse/ClickHouse/issues/48774) をクローズします。[#48787](https://github.com/ClickHouse/ClickHouse/pull/48787)（[Dmitry Novik](https://github.com/novikd)）。
* Function `dotProduct` が配列でも利用できるようになりました。 [#49050](https://github.com/ClickHouse/ClickHouse/pull/49050) ([FFFFFFFHHHHHHH](https://github.com/FFFFFFFHHHHHHH)).
* MySQL との互換性を向上させるため、`SHOW INDEX` ステートメントのサポートを追加。 [#49158](https://github.com/ClickHouse/ClickHouse/pull/49158) ([Robert Schulze](https://github.com/rschu1ze)).
* テーブル関数 `url` に仮想カラム `_file` および `_path` のサポートを追加。- テーブル関数 `url` のエラーメッセージを改善。- [#49231](https://github.com/ClickHouse/ClickHouse/issues/49231) を解決。- [#49232](https://github.com/ClickHouse/ClickHouse/issues/49232) を解決。[#49356](https://github.com/ClickHouse/ClickHouse/pull/49356)（[Ziyi Tan](https://github.com/Ziy1-Tan)）。
* users.xml ファイルに `grants` フィールドを追加し、ユーザーに付与する権限を指定できるようにしました。 [#49381](https://github.com/ClickHouse/ClickHouse/pull/49381) ([pufit](https://github.com/pufit))。
* Grace ハッシュ結合アルゴリズムの採用により FULL/RIGHT JOIN をサポートしました。 [#49483](https://github.com/ClickHouse/ClickHouse/pull/49483) ([lgbo](https://github.com/lgbo-ustc)).
* `WITH FILL` 修飾子は、ソートの接頭辞ごとに補間をグループ化します。`use_with_fill_by_sorting_prefix` 設定によって制御されます（デフォルトで有効）。[#33203](https://github.com/ClickHouse/ClickHouse/issues/33203)#issuecomment-1418736794 に関連しています。[#49503](https://github.com/ClickHouse/ClickHouse/pull/49503)（[Igor Nikonov](https://github.com/devcrafter)）。
* `clickhouse-client` は、`--query`（または `-q`）が指定されていない場合、`--multiquery` の後に続けてクエリを受け付けるようになりました。例: `clickhouse-client --multiquery "select 1; select 2;"`。 [#49870](https://github.com/ClickHouse/ClickHouse/pull/49870) ([Alexey Gerasimchuk](https://github.com/Demilivor)).
* レプリカからの Hello パケット受信用に、個別の `handshake_timeout` を追加。 [#48854](https://github.com/ClickHouse/ClickHouse/issues/48854) をクローズ。 [#49948](https://github.com/ClickHouse/ClickHouse/pull/49948)（[Kruglov Pavel](https://github.com/Avogar)）。
* 指定された回数分の空白文字列を返す関数「space」を追加しました。 [#50103](https://github.com/ClickHouse/ClickHouse/pull/50103) ([Robert Schulze](https://github.com/rschu1ze))。
* --input&#95;format&#95;csv&#95;trim&#95;whitespaces オプションを追加しました。 [#50215](https://github.com/ClickHouse/ClickHouse/pull/50215) ([Alexey Gerasimchuk](https://github.com/Demilivor)).
* regexp ツリー辞書に対する `dictGetAll` 関数で、複数のマッチに対応する値を配列として返せるようにしました。 [#50254](https://github.com/ClickHouse/ClickHouse/issues/50254) をクローズしました。 [#50255](https://github.com/ClickHouse/ClickHouse/pull/50255)（[Johann Gan](https://github.com/johanngan)）。
* 日付または日時を直近の土曜日または日曜日に切り上げるための `toLastDayOfWeek` 関数を追加しました。 [#50315](https://github.com/ClickHouse/ClickHouse/pull/50315) ([Victor Krasnov](https://github.com/sirvickr))。
* `ignore_data_skipping_indices` を指定することでスキップインデックスを無視できるように。 [#50329](https://github.com/ClickHouse/ClickHouse/pull/50329) ([Boris Kuschel](https://github.com/bkuschel)).
* ユーザー単位のメモリ情報および ProfileEvents を表示するための `system.user_processes` テーブルと `SHOW USER PROCESSES` クエリを追加。 [#50492](https://github.com/ClickHouse/ClickHouse/pull/50492) ([János Benjamin Antal](https://github.com/antaljanosbenjamin)).
* テーブル、データベース、テーブル関数、および辞書のシークレットを表示するためのサーバー設定およびフォーマット設定 `display_secrets_in_show_and_select` を追加。ユーザーがどのシークレットを表示できるかを制御する権限 `displaySecretsInShowAndSelect` を追加。 [#46528](https://github.com/ClickHouse/ClickHouse/pull/46528) ([Mike Kot](https://github.com/myrrc)).
* DATABASE に属するすべてのテーブルに対して ROW POLICY を設定できるようにしました。 [#47640](https://github.com/ClickHouse/ClickHouse/pull/47640) ([Ilya Golshtein](https://github.com/ilejn)).



#### パフォーマンスの向上 {#performance-improvement-7}

* マークおよびプライマリキーをデフォルトで圧縮します。これによりコールドクエリの実行時間が大幅に短縮されます。アップグレードに関する注意事項: 圧縮マークおよびプライマリキーのサポートはバージョン 22.9 で追加されました。圧縮マークまたはプライマリキーを有効にした場合、あるいは圧縮マークおよびプライマリキーがデフォルトで有効になっているバージョン 23.5 以降をインストールした場合、バージョン 22.8 以前にダウングレードすることはできません。また、サーバー設定ファイルの `<merge_tree>` セクションで `compress_marks` および `compress_primary_key` 設定を指定することで、圧縮マークまたはプライマリキーを明示的に無効化することもできます。 [#42587](https://github.com/ClickHouse/ClickHouse/pull/42587) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 新しい設定 `s3_max_inflight_parts_for_one_file` は、1 つのファイルの範囲で、マルチパートアップロードリクエストによって同時にアップロードされるパーツ数の上限を設定します。 [#49961](https://github.com/ClickHouse/ClickHouse/pull/49961) ([Sema Checherinda](https://github.com/CheSema))。
* 複数のファイルから読み出す場合、各ファイルに対する並列パース用スレッド数を減らします。 [#42192](https://github.com/ClickHouse/ClickHouse/issues/42192) を解決します。 [#46661](https://github.com/ClickHouse/ClickHouse/pull/46661)（[SmitaRKulkarni](https://github.com/SmitaRKulkarni)）。
* 通常の読み取りよりも少ない granule を読み取れる場合にのみ、集約プロジェクションを使用してください。クエリがテーブルの主キーにはヒットするが、プロジェクションにはヒットしない場合に役立ちます。 [#49150](https://github.com/ClickHouse/ClickHouse/issues/49150) を修正。 [#49417](https://github.com/ClickHouse/ClickHouse/pull/49417)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 何も挿入されない場合は、`ANY` ハッシュ結合でブロックを保持しないようにしました。 [#48633](https://github.com/ClickHouse/ClickHouse/pull/48633) ([vdimir](https://github.com/vdimir))。
* JIT コンパイル時の集約コンビネータ `-If` の不具合を修正し、集約関数に対する JIT コンパイルを有効化しました。[#48120](https://github.com/ClickHouse/ClickHouse/issues/48120) をクローズ。[#49083](https://github.com/ClickHouse/ClickHouse/pull/49083)（[Igor Nikonov](https://github.com/devcrafter)）。
* リモートテーブルからの読み取りでは、タスクスティーリングが機能するように、（パート全体を読むのではなく）より小さなタスクを使用します。* タスクサイズは読み取るカラムのサイズによって決定されます * S3 から読み取る際には常に 1MB のバッファを使用します * キャッシュセグメントの境界は 1MB に揃えられているため、小さなタスクでも十分なサイズとなり、断片化も防げるはずです。 [#49287](https://github.com/ClickHouse/ClickHouse/pull/49287) ([Nikita Taranov](https://github.com/nickitat))。
* 次の設定を導入しました: - バックグラウンド処理で使用されるメモリ使用量を制限するための `merge_max_block_size_bytes`。- 垂直マージを有効化するための追加条件となる `vertical_merge_algorithm_min_bytes_to_activate`。[#49313](https://github.com/ClickHouse/ClickHouse/pull/49313)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* ローカルファイルシステムから読み取る際の読み取りバッファのデフォルトサイズが、わずかにより適切な値に変更されました。あわせて、新たに 2 つの設定 `max_read_buffer_size_local_fs` と `max_read_buffer_size_remote_fs` が導入されました。 [#49321](https://github.com/ClickHouse/ClickHouse/pull/49321) ([Nikita Taranov](https://github.com/nickitat)).
* `SPARSE_HASHED`/`HASHED` 辞書のメモリ使用量と速度を改善しました（たとえば、`SPARSE_HASHED` はメモリ使用量が従来比で約 1/2.6 になり、約 2 倍高速になりました）。 [#49380](https://github.com/ClickHouse/ClickHouse/pull/49380) ([Azat Khuzhin](https://github.com/azat)).
* `system.query_log` および `system.query_thread_log` テーブルに対して、適切な場合には `LowCardinality` を適用して最適化しました。これにより、これらのテーブルに対するクエリがより高速になります。 [#49530](https://github.com/ClickHouse/ClickHouse/pull/49530) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* ローカルの `Parquet` ファイルを読み込む際のパフォーマンスが、並列読み込みにより向上しました。 [#49539](https://github.com/ClickHouse/ClickHouse/pull/49539) ([Michael Kolupaev](https://github.com/al13n321))。
* 特定のシナリオ、特に小さい左テーブルと大きい右テーブルを結合する場合に、`RIGHT/FULL JOIN` のパフォーマンスを最大 2 倍まで向上しました。 [#49585](https://github.com/ClickHouse/ClickHouse/pull/49585) ([lgbo](https://github.com/lgbo-ustc)).
* Rust で LTO を有効にすることで、BLAKE3 の性能を 11% 向上させました。 [#49600](https://github.com/ClickHouse/ClickHouse/pull/49600) ([Azat Khuzhin](https://github.com/azat))。これにより、C++ と同等の性能になりました。
* `system.opentelemetry_span_log` の構造を最適化しました。適切な箇所では `LowCardinality` を使用するようにしました。このテーブルは全般的にあまり良い設計ではなく（よく使われる属性に対しても Map 型を使用しています）が、多少はマシになります。[#49647](https://github.com/ClickHouse/ClickHouse/pull/49647)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `grace_hash` 結合でハッシュテーブルのサイズを事前に予約するようにしました。 [#49816](https://github.com/ClickHouse/ClickHouse/pull/49816) ([lgbo](https://github.com/lgbo-ustc))。
* `uniqExactIf` 状態の並列マージに対応。[#49885](https://github.com/ClickHouse/ClickHouse/issues/49885) をクローズ。[#50285](https://github.com/ClickHouse/ClickHouse/pull/50285)（[flynn](https://github.com/ucasfl)）。
* Keeper の改良: Keeper に `CheckNotExists` リクエストを追加し、Replicated テーブルのパフォーマンスを向上させました。 [#48897](https://github.com/ClickHouse/ClickHouse/pull/48897) ([Antonio Andelic](https://github.com/antonio2368)).
* Keeper のパフォーマンスを改善: 処理中に同一リクエストを 2 回シリアライズしないようにし、大きなリクエストのデシリアライズ結果をキャッシュするようにしました。新しい coordination 設定 `min_request_size_for_cache` で制御されます。 [#49004](https://github.com/ClickHouse/ClickHouse/pull/49004) ([Antonio Andelic](https://github.com/antonio2368))。
* マージ対象のパーツを選択する際、多くのパーティションにマージ対象が存在しない場合に発生する ZooKeeper の `List` リクエスト数を削減しました。 [#49637](https://github.com/ClickHouse/ClickHouse/pull/49637) ([Alexander Tokmakov](https://github.com/tavplubix)).
* FS キャッシュのロック処理を再設計 [#44985](https://github.com/ClickHouse/ClickHouse/pull/44985) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 自明な COUNT 最適化が可能な場合は pure parallel replicas を無効化。 [#50594](https://github.com/ClickHouse/ClickHouse/pull/50594) ([Raúl Marín](https://github.com/Algunenano)).
* Iceberg スキーマ推論において、すべてのキーに対して HEAD リクエストを送信せず、データの読み取りに使用されるキーに対してのみ送信するようにしました。 [#50203](https://github.com/ClickHouse/ClickHouse/pull/50203) ([Kruglov Pavel](https://github.com/Avogar)).
* `enable_memory_bound_merging_of_aggregation_results` はデフォルトで有効です。 [#50319](https://github.com/ClickHouse/ClickHouse/pull/50319) ([Nikita Taranov](https://github.com/nickitat)).

#### 実験的機能 {#experimental-feature-4}
* `DEFLATE_QPL` コーデックで必要な最小 SIMD バージョンを SSE 4.2 まで引き下げました。[qpl のドキュメント変更](https://github.com/intel/qpl/commit/3f8f5cea27739f5261e8fd577dc233ffe88bf679) - Intel® QPL は、ランタイムのカーネルディスパッチャーと CPUID チェックに依存して、利用可能な中で最適な実装 (SSE/AVX2/AVX512) を選択します。ClickHouse における qpl ビルド用の CMakefile を再構成し、上流の qpl の最新版と整合させました。 [#49811](https://github.com/ClickHouse/ClickHouse/pull/49811) ([jasperzhu](https://github.com/jinjunzh)).
* pure parallel replicas を用いた JOIN の初期サポートを追加しました。 [#49544](https://github.com/ClickHouse/ClickHouse/pull/49544) ([Raúl Marín](https://github.com/Algunenano)).
* "zero-copy replication" における `Outdated` パーツ削除の並列度を向上しました。 [#49630](https://github.com/ClickHouse/ClickHouse/pull/49630) ([Alexander Tokmakov](https://github.com/tavplubix)).
* Parallel Replicas: 1) 非レプリケートなストレージで、設定 `parallel_replicas_for_non_replicated_merge_tree` が無効な状態で Parallel Replicas を使用した場合に発生する `NOT_FOUND_COLUMN_IN_BLOCK` エラーを修正しました。2) `allow_experimental_parallel_reading_from_replicas` は 0、1、2 の 3 つの値を取れるようになりました。0 - 無効、1 - 有効で、失敗時 (FINAL または JOIN の場合) にサイレントに無効化、2 - 有効で、失敗時に例外をスローします。3) SELECT クエリで FINAL 修飾子が使用されており、かつ Parallel Replicas が有効な場合、`allow_experimental_parallel_reading_from_replicas` が 1 に設定されていれば ClickHouse はそれらを無効化しようとし、それ以外の場合は例外をスローします。 [#50195](https://github.com/ClickHouse/ClickHouse/pull/50195) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Parallel Replicas が有効な場合、常に利用不可能なサーバーをスキップするようになりました (この動作は設定 `skip_unavailable_shards` によって制御され、デフォルトで有効であり、無効にすることしかできません)。これにより次の Issue が解決されます: [#48565](https://github.com/ClickHouse/ClickHouse/issues/48565)。 [#50293](https://github.com/ClickHouse/ClickHouse/pull/50293) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).

#### 改善 {#improvement-7}

* `BACKUP` コマンドは、バックアップ作成時に暗号化ディスク上のデータを復号しません。代わりに、データはバックアップ内に暗号化されたまま保存されます。そのようなバックアップは、同じ（またはそれを拡張した）暗号化キーのリストを持つ暗号化ディスクにのみ復元できます。 [#48896](https://github.com/ClickHouse/ClickHouse/pull/48896) ([Vitaly Baranov](https://github.com/vitlibar)).
* ATTACH PARTITION FROM および REPLACE PARTITION FROM の FROM 句で一時テーブルを使用できるようになりました。 [#49436](https://github.com/ClickHouse/ClickHouse/pull/49436) ([Roman Vasin](https://github.com/rvasin)).
* `MergeTree` テーブル向けに `async_insert` 設定を追加しました。これはクエリレベルの `async_insert` 設定と同じ意味を持ち、特定のテーブルに対して非同期インサートを有効にします。注意: `clickhouse-client` からの INSERT クエリには適用されないため、その場合はクエリレベルの設定を使用してください。[#49122](https://github.com/ClickHouse/ClickHouse/pull/49122)（[Anton Popov](https://github.com/CurtizJ)）。
* クオータ作成ステートメントのパラメータでサイズ接尾辞をサポートしました。 [#49087](https://github.com/ClickHouse/ClickHouse/pull/49087) ([Eridanus](https://github.com/Eridanus117)).
* `first_value` と `last_value` が NULL を受け付けるように拡張。 [#46467](https://github.com/ClickHouse/ClickHouse/pull/46467) ([lgbo](https://github.com/lgbo-ustc))。
* `extractKeyValuePairs` のエイリアスとして `str_to_map` と `mapFromString` を追加し、[https://github.com/clickhouse/clickhouse/issues/47185](https://github.com/clickhouse/clickhouse/issues/47185) をクローズ。 [#49466](https://github.com/ClickHouse/ClickHouse/pull/49466) ([flynn](https://github.com/ucasfl)).
* メモリ使用量および利用可能量に関する非同期メトリクス向けに CGroup バージョン 2 への対応を追加しました。これにより [#37983](https://github.com/ClickHouse/ClickHouse/issues/37983) がクローズされました。[#45999](https://github.com/ClickHouse/ClickHouse/pull/45999)（[sichenzhao](https://github.com/sichenzhao)）。
* Cluster テーブル関数は、利用不能なシャードを常にスキップするようにしました。 [#46314](https://github.com/ClickHouse/ClickHouse/issues/46314) をクローズ。 [#46765](https://github.com/ClickHouse/ClickHouse/pull/46765) ([zk&#95;kiger](https://github.com/zk-kiger)).
* CSV ファイルのヘッダー行に空の列名を含められるようにしました。 [#47496](https://github.com/ClickHouse/ClickHouse/pull/47496) ([你不要过来啊](https://github.com/iiiuwioajdks)).
* Google Cloud Storage の S3 互換テーブル関数 `gcs` を追加しました。`oss` や `cosn` 関数と同様に、`s3` テーブル関数の単なるエイリアスであり、新しい機能が追加されるわけではありません。[#47815](https://github.com/ClickHouse/ClickHouse/pull/47815) ([Kuba Kaflik](https://github.com/jkaflik))
* S3 で厳密なパートサイズを使用できるようにしました（Cloudflare R2 S3 Storage との互換性）。 [#48492](https://github.com/ClickHouse/ClickHouse/pull/48492) ([Azat Khuzhin](https://github.com/azat)).
* `Replicated` データベースのレプリカに関する情報を含む新しいカラム `database_shard_name`、`database_replica_name`、`is_active` を `system.clusters` に追加しました。`SYSTEM DROP DATABASE REPLICA` クエリにオプションの `FROM SHARD` 句を追加しました。[#48548](https://github.com/ClickHouse/ClickHouse/pull/48548)（[Alexander Tokmakov](https://github.com/tavplubix)）。
* `system.replicas` に新しいカラム `zookeeper_name` を追加し、レプリケーテッドテーブルのメタデータがどの（補助的な）ZooKeeper クラスターに保存されているかを示すようにしました。 [#48549](https://github.com/ClickHouse/ClickHouse/pull/48549) ([cangyin](https://github.com/cangyin)).
* `IN` 演算子が `Date` と `Date32` の比較をサポートするようになりました。 [#48736](https://github.com/ClickHouse/ClickHouse/issues/48736) をクローズしました。 [#48806](https://github.com/ClickHouse/ClickHouse/pull/48806) ([flynn](https://github.com/ucasfl)).
* `HDFS` でのイレージャーコーディングのサポート、著者: @M1eyu2018, @tomscut。 [#48833](https://github.com/ClickHouse/ClickHouse/pull/48833) ([M1eyu](https://github.com/M1eyu2018))。
* 補助 ZooKeeper クラスターからの `SYSTEM DROP REPLICA` を実装。これにより [#48931](https://github.com/ClickHouse/ClickHouse/issues/48931) をクローズできる可能性があります。 [#48932](https://github.com/ClickHouse/ClickHouse/pull/48932) ([wangxiaobo](https://github.com/wzb5212)).
* MongoDB に Array データ型を追加し、[#48598](https://github.com/ClickHouse/ClickHouse/issues/48598) をクローズ。 [#48983](https://github.com/ClickHouse/ClickHouse/pull/48983)（[Nikolay Degterinsky](https://github.com/evillique)）。
* テーブルへの `Interval` データ型の保存をサポートしました。 [#49085](https://github.com/ClickHouse/ClickHouse/pull/49085) ([larryluogit](https://github.com/larryluogit)).
* 明示的なウィンドウフレームの定義がなくても `ntile` ウィンドウ関数を使用できるようにしました: `ntile(3) OVER (ORDER BY a)`。[#46763](https://github.com/ClickHouse/ClickHouse/issues/46763) をクローズしました。 [#49093](https://github.com/ClickHouse/ClickHouse/pull/49093)（[vdimir](https://github.com/vdimir)）。
* 多くの未完了の mutation が既に存在するテーブルに対して、mutation を生成する `ALTER` クエリ（`ALTER UPDATE`、`ALTER DELETE`、`ALTER MODIFY COLUMN` など）を遅延させる、またはスローするための設定（`number_of_mutations_to_delay`、`number_of_mutations_to_throw`）を追加しました。 [#49117](https://github.com/ClickHouse/ClickHouse/pull/49117) ([Anton Popov](https://github.com/CurtizJ)).
* ファイルシステムキャッシュでの `create_directories` による例外を捕捉。 [#49203](https://github.com/ClickHouse/ClickHouse/pull/49203) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 埋め込み例を、フィールド `description` を補完するために `system.functions` の新しいフィールド `example` にコピーします。 [#49222](https://github.com/ClickHouse/ClickHouse/pull/49222) ([Dan Roscigno](https://github.com/DanRoscigno))。
* MongoDB 辞書の接続オプションを有効にしました。例: `xml <source> <mongodb> <host>localhost</host> <port>27017</port> <user></user> <password></password> <db>test</db> <collection>dictionary_source</collection> <options>ssl=true</options> </mongodb> </source>` ### ユーザー向け変更のドキュメント項目。 [#49225](https://github.com/ClickHouse/ClickHouse/pull/49225) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* `kolmogorovSmirnovTest` の計算方法 `asymp` に対して、別名 `asymptotic` を追加しました。ドキュメントを改善しました。 [#49286](https://github.com/ClickHouse/ClickHouse/pull/49286) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* 集約関数 groupBitAnd/Or/Xor が符号付き整数データでも動作するようになりました。これにより、スカラ関数 bitAnd/Or/Xor の動作と一貫したものになりました。 [#49292](https://github.com/ClickHouse/ClickHouse/pull/49292) ([exmy](https://github.com/exmy)).
* 関数ドキュメントを、より細かなフィールドに細分化しました。 [#49300](https://github.com/ClickHouse/ClickHouse/pull/49300) ([Robert Schulze](https://github.com/rschu1ze)).
* サーバー内のすべてのテーブルで共有される複数のスレッドを使用して、古くなったデータパーツを読み込みます。スレッドプールとそのキューのサイズは、`max_outdated_parts_loading_thread_pool_size` と `outdated_part_loading_thread_pool_queue_size` の各設定によって制御されます。 [#49317](https://github.com/ClickHouse/ClickHouse/pull/49317)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* ブロック間で辞書を共有している場合、`LowCardinality` カラムの処理済みデータのサイズを過大評価しないようにしました。これにより [#49322](https://github.com/ClickHouse/ClickHouse/issues/49322) がクローズされました。あわせて [#48745](https://github.com/ClickHouse/ClickHouse/issues/48745) も参照してください。 [#49323](https://github.com/ClickHouse/ClickHouse/pull/49323)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* Parquet writer は、`OUTFILE` 経由で呼び出された場合に、妥当な row group サイズを使用するようになりました。 [#49325](https://github.com/ClickHouse/ClickHouse/pull/49325) ([Michael Kolupaev](https://github.com/al13n321)).
* エイリアスがクオートされている場合に、`ARRAY` のような制限付きキーワードもエイリアスとして使用できるようにしました。[#49324](https://github.com/ClickHouse/ClickHouse/issues/49324) をクローズ。[#49360](https://github.com/ClickHouse/ClickHouse/pull/49360)（[Nikolay Degterinsky](https://github.com/evillique)）。
* データパーツのロードおよび削除ジョブは、テーブルごとのプールではなく、サーバー全体で共有されるプールに移行されました。プールサイズはトップレベル設定 `max_active_parts_loading_thread_pool_size`、`max_outdated_parts_loading_thread_pool_size`、`max_parts_cleaning_thread_pool_size` によって制御されます。テーブルレベル設定 `max_part_loading_threads` および `max_part_removal_threads` は廃止されました。 [#49474](https://github.com/ClickHouse/ClickHouse/pull/49474) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Play UI の URL で `?password=pass` の指定を許可。パスワードはブラウザ履歴上で置き換えられる。[#49505](https://github.com/ClickHouse/ClickHouse/pull/49505) ([Mike Kot](https://github.com/myrrc)).
* リモートファイルシステムからサイズがゼロのオブジェクトを読み取れるようにしました（空のファイルはバックアップ対象にならないため、メタデータファイル内の BLOB が 0 個になってしまう場合があるため）。[#49480](https://github.com/ClickHouse/ClickHouse/issues/49480) をクローズ。[#49519](https://github.com/ClickHouse/ClickHouse/pull/49519)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* `ThreadGroup` がデタッチされた後にスレッドの MemoryTracker を `total_memory_tracker` にアタッチ。[#49527](https://github.com/ClickHouse/ClickHouse/pull/49527)（[Dmitry Novik](https://github.com/novikd)）。
* クエリ内で同じクエリパラメータが複数回使用されている場合のパラメータ付きビューの動作を修正。 [#49556](https://github.com/ClickHouse/ClickHouse/pull/49556) ([Azat Khuzhin](https://github.com/azat)).
* クエリコンテキスト内で直近に送信されたProfileEventsスナップショットに割り当てられたメモリを解放する。フォローアップ [#47564](https://github.com/ClickHouse/ClickHouse/issues/47564)。[#49561](https://github.com/ClickHouse/ClickHouse/pull/49561)（[Dmitry Novik](https://github.com/novikd)）。
* 関数「makeDate」に、MySQL 互換のオーバーロード（year と 年内通算日 を引数に取るもの）が追加されました。 [#49603](https://github.com/ClickHouse/ClickHouse/pull/49603) ([Robert Schulze](https://github.com/rschu1ze)).
* `RegExpTreeDictionary` で `dictionary` テーブル関数をサポートしました。 [#49666](https://github.com/ClickHouse/ClickHouse/pull/49666) ([Han Fei](https://github.com/hanfei1991)).
* 重み付きフェアな IO スケジューリングポリシーを追加しました。サーバーを再起動することなく、実行時に IO スケジューリング階層を更新できる動的リソースマネージャーを追加しました。 [#49671](https://github.com/ClickHouse/ClickHouse/pull/49671) ([Sergei Trifonov](https://github.com/serxa)).
* GCS へのマルチパートアップロード後に compose リクエストを追加しました。これにより、マルチパートアップロードでアップロードされたオブジェクトに対してコピー操作を使用できるようになります。異なるサイズのパートから作成されたオブジェクトでは compose リクエストが失敗する可能性があるため、`s3_strict_upload_part_size` を何らかの値に設定することを推奨します。[#49693](https://github.com/ClickHouse/ClickHouse/pull/49693) ([Antonio Andelic](https://github.com/antonio2368))。
* `extractKeyValuePairs` 関数について: 「ベストエフォート」なパースロジックを改善し、`key_value_delimiter` を値の有効な一部として扱えるようにしました。これにより分岐が単純化され、処理がわずかに高速になる可能性もあります。 [#49760](https://github.com/ClickHouse/ClickHouse/pull/49760) ([Arthur Passos](https://github.com/arthurpassos)).
* `system.processors_profile_log` に `initial_query_id` フィールドを追加しました [#49777](https://github.com/ClickHouse/ClickHouse/pull/49777) ([helifu](https://github.com/helifu))。
* システムログテーブルでカスタムソートキーを使用できるようになりました。 [#49778](https://github.com/ClickHouse/ClickHouse/pull/49778) ([helifu](https://github.com/helifu))。
* `system.query_log` に新しいフィールド `partitions` が追加され、どのパーティションが計算に関与しているかを示すようになりました。 [#49779](https://github.com/ClickHouse/ClickHouse/pull/49779) ([helifu](https://github.com/helifu))。
* `ReplicatedMergeTree` 用に `enable_the_endpoint_id_with_zookeeper_name_prefix` 設定を追加しました（デフォルトでは無効です）。有効にすると、テーブルのインターサーバー通信エンドポイントに ZooKeeper クラスター名が追加されます。これにより、同じパスを持つが、補助的な ZooKeeper クラスターが異なるレプリケートされたテーブルを使用している場合に発生する `Duplicate interserver IO endpoint` エラーを回避できます。 [#49780](https://github.com/ClickHouse/ClickHouse/pull/49780) ([helifu](https://github.com/helifu))。
* `clickhouse-local` にクエリパラメータを追加しました。[#46561](https://github.com/ClickHouse/ClickHouse/issues/46561) をクローズしました。[#49785](https://github.com/ClickHouse/ClickHouse/pull/49785)（[Nikolay Degterinsky](https://github.com/evillique)）。
* デフォルトで YAML ファイルから辞書と関数を読み込めるようになりました。以前のバージョンでは、設定ファイル内の `dictionaries_config` または `user_defined_executable_functions_config` を編集する必要がありました。これらは `*.xml` ファイルを前提としていたためです。 [#49812](https://github.com/ClickHouse/ClickHouse/pull/49812) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* Kafka テーブルエンジンでエイリアス列が使用可能になりました。 [#49824](https://github.com/ClickHouse/ClickHouse/pull/49824) ([Aleksandr Musorin](https://github.com/AVMusorin)).
* `extractKeyValuePairs` によって生成されるペアの最大数を制限する設定を追加しました。これはメモリの過剰消費を防ぐための安全策です。 [#49836](https://github.com/ClickHouse/ClickHouse/pull/49836) ([Arthur Passos](https://github.com/arthurpassos)).
* `IN` 演算子の引数が要素数 1 のタプルであるという、やや特殊なケースをサポートしました。 [#49844](https://github.com/ClickHouse/ClickHouse/pull/49844) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* `bitHammingDistance` 関数が `String` および `FixedString` データ型をサポートするようになりました。[#48827](https://github.com/ClickHouse/ClickHouse/issues/48827) をクローズしました。 [#49858](https://github.com/ClickHouse/ClickHouse/pull/49858) ([flynn](https://github.com/ucasfl))。
* OS X 上のクライアントでのタイムアウトリセットエラーを修正。 [#49863](https://github.com/ClickHouse/ClickHouse/pull/49863) ([alekar](https://github.com/alekar)).
* `bitCount` 関数で UInt128、Int128、UInt256、Int256 などの大きな整数型をサポートしました。これにより、大きなビットマスクに対するハミング距離を AI アプリケーション向けに計算できるようになります。 [#49867](https://github.com/ClickHouse/ClickHouse/pull/49867) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 暗号化ディスクでキー ID の代わりに使用するフィンガープリント。これにより暗号化ディスクの構成が簡素化されます。 [#49882](https://github.com/ClickHouse/ClickHouse/pull/49882) ([Vitaly Baranov](https://github.com/vitlibar)).
* PostgreSQL に UUID データ型を追加し、[#49739](https://github.com/ClickHouse/ClickHouse/issues/49739) をクローズ。 [#49894](https://github.com/ClickHouse/ClickHouse/pull/49894)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 関数 `toUnixTimestamp` は `Date` および `Date32` を引数として受け取れるようになりました。 [#49989](https://github.com/ClickHouse/ClickHouse/pull/49989) ([Victor Krasnov](https://github.com/sirvickr)).
* 辞書ではサーバーメモリのみを課金対象とするようにしました。 [#49995](https://github.com/ClickHouse/ClickHouse/pull/49995) ([Azat Khuzhin](https://github.com/azat)).
* サーバーでは、MySQL 互換性のために `SQL_AUTO_IS_NULL` などの `SQL_*` 設定を no-op（効果を持たない設定）として扱えるようになります。これにより [#49927](https://github.com/ClickHouse/ClickHouse/issues/49927) が解決されます。[#50013](https://github.com/ClickHouse/ClickHouse/pull/50013)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* ON CLUSTER クエリに対して `initial_query_id` を保持するようにし、（`distributed_ddl_entry_format_version=5` の場合に）クエリの調査に役立つようにしました。 [#50015](https://github.com/ClickHouse/ClickHouse/pull/50015) ([Azat Khuzhin](https://github.com/azat)).
* 名前が変更された設定に対してエイリアス（`optimize_use_projections` には `allow_experimental_projection_optimization`、`enable_lightweight_delete` には `allow_experimental_lightweight_delete`）を使用することで、後方互換性を確保します。 [#50044](https://github.com/ClickHouse/ClickHouse/pull/50044) ([Azat Khuzhin](https://github.com/azat)).
* Keeper でクラスターノードを登録するために、my&#95;hostname を設定して FQDN を渡せるようにしました。複数の compute group をサポートするために invisible 設定を追加しました。クラスタとしての compute group は、他の compute group からは見えません。 [#50186](https://github.com/ClickHouse/ClickHouse/pull/50186) ([Yangkuan Liu](https://github.com/LiuYangkuan)).
* `LIMIT n` を指定できるにもかかわらず PostgreSQL が全てのデータを読み込んでしまう問題を修正しました。 [#50187](https://github.com/ClickHouse/ClickHouse/pull/50187) ([Kseniia Sumarokova](https://github.com/kssenii)).
* サブクエリを含むクエリ向けに新しいプロファイルイベント（`QueriesWithSubqueries`/`SelectQueriesWithSubqueries`/`InsertQueriesWithSubqueries`）を追加しました。[#50204](https://github.com/ClickHouse/ClickHouse/pull/50204) ([Azat Khuzhin](https://github.com/azat))。
* `users.xml` ファイルに `roles` フィールドを追加し、設定ファイルから GRANT を伴うロールを指定できるようにしました。 [#50278](https://github.com/ClickHouse/ClickHouse/pull/50278) ([pufit](https://github.com/pufit))。
* 非同期メトリクスで `CGroupCpuCfsPeriod` と `CGroupCpuCfsQuota` を報告するようにしました。- サーバー起動時に cgroup v2 のメモリ制限を考慮するようにしました。 [#50379](https://github.com/ClickHouse/ClickHouse/pull/50379) ([alekar](https://github.com/alekar))。
* SIGINT と同様に動作するよう SIGQUIT 用のシグナルハンドラを追加しました。[#50298](https://github.com/ClickHouse/ClickHouse/issues/50298) をクローズします。[#50435](https://github.com/ClickHouse/ClickHouse/pull/50435)（[Nikolay Degterinsky](https://github.com/evillique)）。
* JSON のパースがオブジェクトのサイズが大きすぎるために失敗した場合、デバッグできるように最後に処理した位置を出力するようにしました。 [#50474](https://github.com/ClickHouse/ClickHouse/pull/50474) ([Valentin Alexeev](https://github.com/valentinalexeev)).
* 可変長の Decimal をサポートしました。Closes [#49130](https://github.com/ClickHouse/ClickHouse/issues/49130). [#50586](https://github.com/ClickHouse/ClickHouse/pull/50586) ([Kruglov Pavel](https://github.com/Avogar)).



#### ビルド／テスト／パッケージングの改善 {#buildtestingpackaging-improvement-7}

* 新しく改良された `keeper-bench`。すべてを YAML/XML ファイルからカスタマイズ可能: - リクエストジェネレーター - 各タイプのリクエストジェネレーターごとに固有のフィールドセットを指定可能 - `multi` キーの下で同様に記述するだけで複数リクエストを生成可能 - `multi` 内の各リクエストまたはサブリクエストに対して、分布を制御するための `weight` フィールドを定義可能 - テスト実行時にセットアップが必要なツリーを定義可能 - ホストはすべてのタイムアウトをカスタマイズ可能な形で定義でき、各ホストごとに生成するセッション数も制御可能 - `min_value` および `max_value` フィールドで定義された整数は乱数ジェネレーターとして機能。[#48547](https://github.com/ClickHouse/ClickHouse/pull/48547)（[Antonio Andelic](https://github.com/antonio2368)）。
* Io&#95;uring は macOS ではサポートされていないため、ローカルでテストを実行するときは選択しないでください。まれな失敗を避けるためです。 [#49250](https://github.com/ClickHouse/ClickHouse/pull/49250) ([Frank Chen](https://github.com/FrankChen021)).
* テスト用の名前付きフォールトインジェクションをサポート。 [#49361](https://github.com/ClickHouse/ClickHouse/pull/49361) ([Han Fei](https://github.com/hanfei1991)).
* `prctl`（プロセス制御）システムコールが利用できない OS（AWS Lambda など）上でも ClickHouse を実行できるようにしました。 [#49538](https://github.com/ClickHouse/ClickHouse/pull/49538) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* qpl における contrib/isa-l と isa-l 間のビルド競合を修正しました [49296](https://github.com/ClickHouse/ClickHouse/issues/49296)。[#49584](https://github.com/ClickHouse/ClickHouse/pull/49584)（[jasperzhu](https://github.com/jinjunzh)）。
* ユーティリティは、デフォルトではなく `"-DENABLE&#95;UTILS=1"` を明示的に指定した場合にのみビルドされるようになりました。これにより、典型的な開発ビルドにおけるリンク時間が短縮されます。 [#49620](https://github.com/ClickHouse/ClickHouse/pull/49620) ([Robert Schulze](https://github.com/rschu1ze)).
* 将来の誤削除を避けるため、idxd-config のビルド定義を別の CMake ファイルに切り出しました。 [#49651](https://github.com/ClickHouse/ClickHouse/pull/49651) ([jasperzhu](https://github.com/jinjunzh))。
* master ブランチで有効になっている analyzer を使用する CI チェックを追加。フォローアップ [#49562](https://github.com/ClickHouse/ClickHouse/issues/49562)。[#49668](https://github.com/ClickHouse/ClickHouse/pull/49668)（[Dmitry Novik](https://github.com/novikd)）。
* LLVM/clang 16 に切り替え。 [#49678](https://github.com/ClickHouse/ClickHouse/pull/49678) ([Azat Khuzhin](https://github.com/azat)).
* ClickHouse を clang-17 でビルドできるようにしました。 [#49851](https://github.com/ClickHouse/ClickHouse/pull/49851) ([Alexey Milovidov](https://github.com/alexey-milovidov)). [#50410](https://github.com/ClickHouse/ClickHouse/pull/50410) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* ClickHouse は、他の CMake プロジェクトに統合しやすくなりました。 [#49991](https://github.com/ClickHouse/ClickHouse/pull/49991) ([Amos Bird](https://github.com/amosbird)). （ただし、そのような統合は強く非推奨です - Alexey Milovidov）。
* [#47151](https://github.com/ClickHouse/ClickHouse/issues/47151) の後に発生する、余分な QEMU ログ出力が行われる問題を修正します。詳細は [https://s3.amazonaws.com/clickhouse-test-reports/50078/a4743996ee4f3583884d07bcd6501df0cfdaa346/stateless&#95;tests&#95;&#95;release&#95;&#95;databasereplicated&#95;&#95;[3&#95;4].html](https://s3.amazonaws.com/clickhouse-test-reports/50078/a4743996ee4f3583884d07bcd6501df0cfdaa346/stateless_tests__release__databasereplicated__\[3_4].html) を参照してください。[#50442](https://github.com/ClickHouse/ClickHouse/pull/50442)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* ClickHouse は Linux RISC-V カーネル 6.1.22 上で動作するようになりました。これにより [#50456](https://github.com/ClickHouse/ClickHouse/issues/50456) がクローズされました。 [#50457](https://github.com/ClickHouse/ClickHouse/pull/50457) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 内部で使用している protobuf を v3.18 に更新（誤検知された CVE-2022-1941 を修正）。 [#50400](https://github.com/ClickHouse/ClickHouse/pull/50400) ([Robert Schulze](https://github.com/rschu1ze)).
* 内部で使用している libxml2 を v2.10.4 に更新（誤って報告された CVE-2023-28484 および CVE-2023-29469 を解消）。[#50402](https://github.com/ClickHouse/ClickHouse/pull/50402) ([Robert Schulze](https://github.com/rschu1ze))。
* c-ares を v1.19.1 に更新（誤検知と判定された CVE-2023-32067、CVE-2023-31130、CVE-2023-31147）。 [#50403](https://github.com/ClickHouse/ClickHouse/pull/50403) ([Robert Schulze](https://github.com/rschu1ze))。
* libgsasl における誤って報告されていた CVE-2022-2469 を修正。 [#50404](https://github.com/ClickHouse/ClickHouse/pull/50404) ([Robert Schulze](https://github.com/rschu1ze)).

#### バグ修正（公式安定版リリースでユーザーから見て明らかな不具合） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-7}

* ActionsDAG: 誤った最適化の問題を修正 [#47584](https://github.com/ClickHouse/ClickHouse/pull/47584) ([Salvatore Mesoraca](https://github.com/aiven-sal))。
* Keeper での並行スナップショットを正しく処理するようにしました [#48466](https://github.com/ClickHouse/ClickHouse/pull/48466) ([Antonio Andelic](https://github.com/antonio2368))。
* MergeTreeMarksLoader が DataPartStorage の代わりに DataPart を保持するように変更されました [#48515](https://github.com/ClickHouse/ClickHouse/pull/48515) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* シーケンス状態を修正 [#48603](https://github.com/ClickHouse/ClickHouse/pull/48603) ([Ilya Golshtein](https://github.com/ilejn))。
* 以前の失敗時におけるバックアップ/リストアの同時実行チェック [#48726](https://github.com/ClickHouse/ClickHouse/pull/48726) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* 存在しない ZooKeeper パスのテーブルをアタッチしても ReadonlyReplica メトリクスが増加しない問題を修正 [#48954](https://github.com/ClickHouse/ClickHouse/pull/48954) ([wangxiaobo](https://github.com/wzb5212))。
* 一部の箇所で、捕捉されない例外に対して std::terminate が呼び出されてしまう可能性があった問題を修正 [#49112](https://github.com/ClickHouse/ClickHouse/pull/49112) ([Kruglov Pavel](https://github.com/Avogar))。
* 複数の StorageJoin を含むクエリで発生していたキーが見つからないエラーを修正 [#49137](https://github.com/ClickHouse/ClickHouse/pull/49137) ([vdimir](https://github.com/vdimir))。
* nullable な primary key 使用時に誤ったクエリ結果が返される問題を修正 [#49172](https://github.com/ClickHouse/ClickHouse/pull/49172) ([Duc Canh Le](https://github.com/canhld94))。
* ビッグエンディアン環境での reinterpretAs*() の動作を修正 [#49198](https://github.com/ClickHouse/ClickHouse/pull/49198)（[Suzy Wang](https://github.com/SuzyWangIBMer)）。
* （実験的ゼロコピー レプリケーション）ゼロコピーのパーツのロックをよりアトミックに行う [#49211](https://github.com/ClickHouse/ClickHouse/pull/49211) ([alesapin](https://github.com/alesapin)).
* Outdated parts の読み込み時に発生するレースコンディションを修正 [#49223](https://github.com/ClickHouse/ClickHouse/pull/49223) ([Alexander Tokmakov](https://github.com/tavplubix))。
* すべてのキー値が null の場合に、GROUP BY で ROLLUP を使用すると誤った結果が返される問題を修正 [#49282](https://github.com/ClickHouse/ClickHouse/pull/49282) ([Shuai li](https://github.com/loneylee)).
* SHARDS を使用する HASHED 辞書の load&#95;factor の計算を修正 [#49319](https://github.com/ClickHouse/ClickHouse/pull/49319) ([Azat Khuzhin](https://github.com/azat))。
* エイリアス列に圧縮 CODEC を設定できないようにしました [#49363](https://github.com/ClickHouse/ClickHouse/pull/49363) ([Timur Solodovnikov](https://github.com/tsolodov)).
* 既存のパートディレクトリを削除する処理におけるバグを修正 [#49365](https://github.com/ClickHouse/ClickHouse/pull/49365) ([alesapin](https://github.com/alesapin))。
* HMAC 使用時の GCS の挙動を正しく修正 [#49390](https://github.com/ClickHouse/ClickHouse/pull/49390) ([Antonio Andelic](https://github.com/antonio2368)).
* remote() からの読み取り時にサブクエリセットが構築されないファジング関連のバグを修正 [#49425](https://github.com/ClickHouse/ClickHouse/pull/49425)（[Alexander Gololobov](https://github.com/davenger)）。
* `shutdown_wait_unfinished_queries` 設定を反転 [#49427](https://github.com/ClickHouse/ClickHouse/pull/49427) ([Konstantin Bogdanov](https://github.com/thevar1able))。
* (実験的 zero-copy レプリケーション) 別の zero-copy バグを修正 [#49473](https://github.com/ClickHouse/ClickHouse/pull/49473) ([alesapin](https://github.com/alesapin))。
* PostgreSQL データベース設定を修正 [#49481](https://github.com/ClickHouse/ClickHouse/pull/49481) ([Mal Curtis](https://github.com/snikch))。
* `s3Cluster` の引数を正しく処理するように修正 [#49490](https://github.com/ClickHouse/ClickHouse/pull/49490) ([Antonio Andelic](https://github.com/antonio2368))。
* TraceCollector のデストラクタ内のバグを修正。 [#49508](https://github.com/ClickHouse/ClickHouse/pull/49508) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 短いシーク時に動作しなくなる AsynchronousReadIndirectBufferFromRemoteFS の問題を修正 [#49525](https://github.com/ClickHouse/ClickHouse/pull/49525) ([Michael Kolupaev](https://github.com/al13n321))。
* 辞書の読み込み順序を修正 [#49560](https://github.com/ClickHouse/ClickHouse/pull/49560) ([Alexander Tokmakov](https://github.com/tavplubix)).
* Object(&#39;json&#39;) 列のデータ型を変更できないようにしました [#49563](https://github.com/ClickHouse/ClickHouse/pull/49563)（[Nikolay Degterinsky](https://github.com/evillique)）。
* ストレステストの不具合を修正 (Logical error: Expected 7134 &gt;= 11030) [#49623](https://github.com/ClickHouse/ClickHouse/pull/49623) ([Kseniia Sumarokova](https://github.com/kssenii)).
* DISTINCT のバグを修正 [#49628](https://github.com/ClickHouse/ClickHouse/pull/49628)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 修正：ソートされていない列に 0 値が含まれる場合の ORDER 句での DISTINCT の挙動 [#49636](https://github.com/ClickHouse/ClickHouse/pull/49636) ([Igor Nikonov](https://github.com/devcrafter))。
* fuzzer を用いた UBSan により検出された大きな整数のオフバイワンエラーを修正 [#49645](https://github.com/ClickHouse/ClickHouse/pull/49645) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 再起動後の sparse columns からの読み取り処理を修正 [#49660](https://github.com/ClickHouse/ClickHouse/pull/49660) ([Anton Popov](https://github.com/CurtizJ))。
* fibers 使用時の `SpanHolder::finish()` 内の `assert` を修正 [#49673](https://github.com/ClickHouse/ClickHouse/pull/49673) ([Kruglov Pavel](https://github.com/Avogar))。
* 疎な引数を取る短絡評価関数およびミューテーションを修正 [#49716](https://github.com/ClickHouse/ClickHouse/pull/49716) ([Anton Popov](https://github.com/CurtizJ)).
* インクリメンタルバックアップに追記されるファイルの書き込み処理を修正 [#49725](https://github.com/ClickHouse/ClickHouse/pull/49725) ([Vitaly Baranov](https://github.com/vitlibar)).
* Object 型カラムを含むテーブルで lightweight delete mutation を実行した際に発生していた &quot;There is no physical column &#95;row&#95;exists in table&quot; エラーを修正しました。 [#49737](https://github.com/ClickHouse/ClickHouse/pull/49737) ([Alexander Gololobov](https://github.com/davenger)).
* randomStringUTF8（uneven number）における msan の問題を修正 [#49750](https://github.com/ClickHouse/ClickHouse/pull/49750) ([Robert Schulze](https://github.com/rschu1ze))。
* 集約関数 kolmogorovSmirnovTest を修正 [#49768](https://github.com/ClickHouse/ClickHouse/pull/49768) ([FFFFFFFHHHHHHH](https://github.com/FFFFFFFHHHHHHH))。
* ネイティブプロトコルにおける設定エイリアスを修正 [#49776](https://github.com/ClickHouse/ClickHouse/pull/49776) ([Azat Khuzhin](https://github.com/azat)).
* 単一要素のタプル配列に対する `arrayMap` を修正 [#49789](https://github.com/ClickHouse/ClickHouse/pull/49789) ([Anton Popov](https://github.com/CurtizJ)).
* クエリ単位の I/O およびバックアップのスロットリング設定を修正 [#49797](https://github.com/ClickHouse/ClickHouse/pull/49797) ([Azat Khuzhin](https://github.com/azat))。
* プロファイル定義での `NULL` の設定を修正 [#49831](https://github.com/ClickHouse/ClickHouse/pull/49831)（[Vitaly Baranov](https://github.com/vitlibar)）。
* プロジェクションと `aggregate_functions_null_for_empty` 設定（`query_plan_optimize_projection` 用）に関連するバグを修正しました [#49873](https://github.com/ClickHouse/ClickHouse/pull/49873) ([Amos Bird](https://github.com/amosbird))。
* 再起動後の Distributed async INSERT における保留中バッチの処理を修正 [#49884](https://github.com/ClickHouse/ClickHouse/pull/49884) ([Azat Khuzhin](https://github.com/azat))。
* CacheMetadata::doCleanup のアサートを修正 [#49914](https://github.com/ClickHouse/ClickHouse/pull/49914) ([Kseniia Sumarokova](https://github.com/kssenii))。
* OptimizeRegularExpression の `is_prefix` を修正 [#49919](https://github.com/ClickHouse/ClickHouse/pull/49919) ([Han Fei](https://github.com/hanfei1991)).
* メトリクス `WriteBufferFromS3Bytes`、`WriteBufferFromS3Microseconds`、`WriteBufferFromS3RequestsErrors` を修正しました [#49930](https://github.com/ClickHouse/ClickHouse/pull/49930)（[Aleksandr Musorin](https://github.com/AVMusorin)）。
* protobuf における IPv6 のエンコードを修正 [#49933](https://github.com/ClickHouse/ClickHouse/pull/49933) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* テキストフォーマットにおける Nullable の誤ったパースに起因する可能性のある論理エラーを修正 [#49960](https://github.com/ClickHouse/ClickHouse/pull/49960) ([Kruglov Pavel](https://github.com/Avogar))。
* より互換性の高い Parquet ファイルを生成できるようにするため、setting output&#95;format&#95;parquet&#95;compliant&#95;nested&#95;types を追加しました [#50001](https://github.com/ClickHouse/ClickHouse/pull/50001) ([Michael Kolupaev](https://github.com/al13n321))。
* ストレステスト「Not enough space to add ...」の論理エラーを修正 [#50021](https://github.com/ClickHouse/ClickHouse/pull/50021) ([Kseniia Sumarokova](https://github.com/kssenii))。
* `ReplicatedMergeTree` の attach スレッドでのテーブル起動時に発生するデッドロックを回避 [#50026](https://github.com/ClickHouse/ClickHouse/pull/50026)（[Antonio Andelic](https://github.com/antonio2368)）。
* fibers 使用時の SpanHolder::finish() のアサートを修正（試行 2） [#50034](https://github.com/ClickHouse/ClickHouse/pull/50034) ([Kruglov Pavel](https://github.com/Avogar))。
* DDL における OpenTelemetry コンテキストのシリアライゼーションに対して適切なエスケープ処理を追加 [#50045](https://github.com/ClickHouse/ClickHouse/pull/50045) ([Azat Khuzhin](https://github.com/azat))。
* 壊れたプロジェクションパーツの報告処理を修正 [#50052](https://github.com/ClickHouse/ClickHouse/pull/50052) ([Amos Bird](https://github.com/amosbird)).
* JIT コンパイル時の != NaN の不具合修正 [#50056](https://github.com/ClickHouse/ClickHouse/pull/50056) ([Maksim Kita](https://github.com/kitaisreal))
* 引数なしの Replicated データベースの場合に発生するクラッシュを修正 [#50058](https://github.com/ClickHouse/ClickHouse/pull/50058) ([Azat Khuzhin](https://github.com/azat)).
* `multiIf` と定数条件および nullable 引数の組み合わせで発生するクラッシュを修正 [#50123](https://github.com/ClickHouse/ClickHouse/pull/50123) ([Anton Popov](https://github.com/CurtizJ)).
* 日付関連キーに対する無効なインデックス解析を修正 [#50153](https://github.com/ClickHouse/ClickHouse/pull/50153) ([Amos Bird](https://github.com/amosbird))。
* ORDER BY 列が存在しない場合は ORDER BY 句を変更できないようにしました [#50154](https://github.com/ClickHouse/ClickHouse/pull/50154) ([Han Fei](https://github.com/hanfei1991)).
* バイナリ演算子に null の定数引数が含まれている場合にインデックス解析が壊れていた問題を修正 [#50177](https://github.com/ClickHouse/ClickHouse/pull/50177) ([Amos Bird](https://github.com/amosbird))。
* clickhouse-client: `--query` と `--queries-file` の同時使用を禁止 [#50210](https://github.com/ClickHouse/ClickHouse/pull/50210) ([Alexey Gerasimchuk](https://github.com/Demilivor)).
* INTO OUTFILE 拡張（APPEND / STDOUT）および WATCH EVENTS における未定義動作（UB）を修正 [#50216](https://github.com/ClickHouse/ClickHouse/pull/50216) ([Azat Khuzhin](https://github.com/azat))。
* CustomSeparatedIgnoreSpaces フォーマットで行末の空白がスキップされる問題を修正 [#50224](https://github.com/ClickHouse/ClickHouse/pull/50224) ([Kruglov Pavel](https://github.com/Avogar))。
* Iceberg メタデータの解析を修正 [#50232](https://github.com/ClickHouse/ClickHouse/pull/50232) ([Kseniia Sumarokova](https://github.com/kssenii))。
* WITH 句内の入れ子になった分散 SELECT を修正 [#50234](https://github.com/ClickHouse/ClickHouse/pull/50234) ([Azat Khuzhin](https://github.com/azat)).
* Keyed SipHash における MSan の問題を修正 [#50245](https://github.com/ClickHouse/ClickHouse/pull/50245)（[Robert Schulze](https://github.com/rschu1ze)）。
* ノンブロッキングモードにおける Poco ソケットのバグを修正し、実際にノンブロッキングなソケットを使用するようにしました [#50252](https://github.com/ClickHouse/ClickHouse/pull/50252) ([Kruglov Pavel](https://github.com/Avogar))。
* バックアップエントリのチェックサム計算を修正 [#50264](https://github.com/ClickHouse/ClickHouse/pull/50264) ([Vitaly Baranov](https://github.com/vitlibar))。
* 比較関数における NaN の取り扱いを修正 [#50287](https://github.com/ClickHouse/ClickHouse/pull/50287) ([Maksim Kita](https://github.com/kitaisreal)).
* JIT 集約での Nullable キーに関する修正 [#50291](https://github.com/ClickHouse/ClickHouse/pull/50291) ([Maksim Kita](https://github.com/kitaisreal)).
* 空の Arrow または Parquet 出力を書き込んだ際に clickhouse-local がクラッシュする問題を修正 [#50328](https://github.com/ClickHouse/ClickHouse/pull/50328) ([Michael Kolupaev](https://github.com/al13n321))。
* Pool::Entry::disconnect() が呼び出されたときにクラッシュが発生する問題を修正 [#50334](https://github.com/ClickHouse/ClickHouse/pull/50334)（[Val Doroshchuk](https://github.com/valbok)）。
* ディレクトリロックをより長く保持することでフェッチパートを改善しました [#50339](https://github.com/ClickHouse/ClickHouse/pull/50339) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
* 両方の引数が定数である場合の bitShift* 関数を修正 [#50343](https://github.com/ClickHouse/ClickHouse/pull/50343) ([Kruglov Pavel](https://github.com/Avogar))。
* リクエストの前処理中に例外が発生した際の Keeper のデッドロックを修正。 [#50387](https://github.com/ClickHouse/ClickHouse/pull/50387) ([frinkr](https://github.com/frinkr)).
* 定数整数値のハッシュ計算を修正 [#50421](https://github.com/ClickHouse/ClickHouse/pull/50421) ([Robert Schulze](https://github.com/rschu1ze)).
* データスキップインデックス向けの merge&#95;tree&#95;min&#95;rows&#95;for&#95;seek / merge&#95;tree&#95;min&#95;bytes&#95;for&#95;seek を修正 [#50432](https://github.com/ClickHouse/ClickHouse/pull/50432) ([Azat Khuzhin](https://github.com/azat))。
* 古いパーツを読み込むための処理中タスク数を制限する [#50450](https://github.com/ClickHouse/ClickHouse/pull/50450) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* Keeper の修正: スナップショットのインストール後に未コミット状態を適用 [#50483](https://github.com/ClickHouse/ClickHouse/pull/50483) ([Antonio Andelic](https://github.com/antonio2368))。
* 誤った定数フォールディングを修正 [#50536](https://github.com/ClickHouse/ClickHouse/pull/50536) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* ストレステストにおける論理エラーを修正（「Not enough space to add ...」） [#50583](https://github.com/ClickHouse/ClickHouse/pull/50583) ([Kseniia Sumarokova](https://github.com/kssenii)).
* VALUES テーブル関数での Null から LowCardinality(Nullable) への変換を修正 [#50637](https://github.com/ClickHouse/ClickHouse/pull/50637) ([Kruglov Pavel](https://github.com/Avogar))。
* 無効だった RegExpTreeDictionary の最適化を元に戻す [#50642](https://github.com/ClickHouse/ClickHouse/pull/50642) ([Johann Gan](https://github.com/johanngan)).

### <a id="234"></a> ClickHouse リリース 23.4, 2023-04-26 {#234}

#### 後方互換性のない変更 {#backward-incompatible-change-7}
* 関数 formatDateTime() のフォーマッタ '%M' は、分ではなく月名を出力するようになりました。これにより、MySQL の動作と一貫性が取れるようになります。以前の動作は、設定項目 "formatdatetime_parsedatetime_m_is_month_name = 0" を使用することで復元できます。 [#47246](https://github.com/ClickHouse/ClickHouse/pull/47246) ([Robert Schulze](https://github.com/rschu1ze)).
* この変更は、仮想ファイルシステムキャッシュを使用している場合にのみ影響します。仮想ファイルシステムキャッシュ設定内の `path` が空でなく、かつ絶対パスでない場合、それは `<clickhouse server data directory>/caches/<path_from_cache_config>` に配置されます。 [#48784](https://github.com/ClickHouse/ClickHouse/pull/48784) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 同一の式を持つプライマリ/セカンダリインデックスおよびソートキーは、作成できないようになりました。この動作は、設定項目 `allow_suspicious_indices` を使用して無効化できます。 [#48536](https://github.com/ClickHouse/ClickHouse/pull/48536) ([凌涛](https://github.com/lingtaolf)).

#### 新機能 {#new-feature-8}

* Spark の [approx&#95;percentile](https://spark.apache.org/docs/latest/api/sql/index.html#approx_percentile) と同様の新しい集約関数 `quantileGK`/`quantilesGK` をサポートしました。Greenwald-Khanna アルゴリズムについては [http://infolab.stanford.edu/~datar/courses/cs361a/papers/quantiles.pdf](http://infolab.stanford.edu/~datar/courses/cs361a/papers/quantiles.pdf) を参照してください。[#46428](https://github.com/ClickHouse/ClickHouse/pull/46428)（[李扬](https://github.com/taiyang-li)）。
* `system.columns` から要約情報を表示する `SHOW COLUMNS` ステートメントを追加しました。[#48017](https://github.com/ClickHouse/ClickHouse/pull/48017)（[Robert Schulze](https://github.com/rschu1ze)）。
* `SYSTEM SYNC REPLICA` クエリに `LIGHTWEIGHT` および `PULL` 修飾子を追加しました。`LIGHTWEIGHT` バージョンはフェッチと drop-range のみを待機し（マージおよびミューテーションは無視します）、`PULL` バージョンは ZooKeeper から新しいエントリを取得しますが、その完了は待機しません。[#47794](https://github.com/ClickHouse/ClickHouse/issues/47794) を修正しました。[#48085](https://github.com/ClickHouse/ClickHouse/pull/48085)（[Alexander Tokmakov](https://github.com/tavplubix)）。
* Kafka の DefaultPartitioner との互換性を持たせるために `kafkaMurmurHash` 関数を追加。[#47834](https://github.com/ClickHouse/ClickHouse/issues/47834) をクローズ。[#48185](https://github.com/ClickHouse/ClickHouse/pull/48185)（[Nikolay Degterinsky](https://github.com/evillique)）。
* `GRANT CURRENT GRANTS` を使用して、現在のユーザーと同じ権限を持つ新しいユーザーを簡単に作成できるようにしました。 [#48262](https://github.com/ClickHouse/ClickHouse/pull/48262) ([pufit](https://github.com/pufit)).
* 統計的集約関数 `kolmogorovSmirnovTest` を追加。[#48228](https://github.com/ClickHouse/ClickHouse/issues/48228) をクローズ。[#48325](https://github.com/ClickHouse/ClickHouse/pull/48325)（[FFFFFFFHHHHHHH](https://github.com/FFFFFFFHHHHHHH)）。
* `system.replicas` テーブルに `lost_part_count` カラムを追加しました。このカラムの値は、対応するテーブルにおける失われたパーツの合計数を示します。値は ZooKeeper に保存されており、永続化されない `ReplicatedDataLoss` プロファイルイベントの代わりにモニタリング用途で使用できます。 [#48526](https://github.com/ClickHouse/ClickHouse/pull/48526) ([Sergei Trifonov](https://github.com/serxa))。
* 互換性のために `soundex` 関数を追加。[#39880](https://github.com/ClickHouse/ClickHouse/issues/39880) をクローズ。[#48567](https://github.com/ClickHouse/ClickHouse/pull/48567)（[FriendLey](https://github.com/FriendLey)）。
* JSONExtract が `Map` 型をサポート。[#48629](https://github.com/ClickHouse/ClickHouse/pull/48629)（[李扬](https://github.com/taiyang-li)）。
* `PrettyJSONEachRow` フォーマットを追加し、改行区切りかつ 4 スペースインデントの整形済み JSON を出力できるようにしました。 [#48898](https://github.com/ClickHouse/ClickHouse/pull/48898) ([Kruglov Pavel](https://github.com/Avogar)).
* Parquet ファイルのメタデータを読み取るための `ParquetMetadata` 入力フォーマットを追加しました。 [#48911](https://github.com/ClickHouse/ClickHouse/pull/48911) ([Kruglov Pavel](https://github.com/Avogar)).
* 文字列からキーと値のペアを抽出するための `extractKeyValuePairs` 関数を追加しました。入力文字列にはノイズが含まれていてもかまわず（例: ログファイル / キーと値のペア形式で 100% 整形されている必要はありません）、アルゴリズムは関数に渡された引数に一致するキーと値のペアを探します。現時点では、この関数は次の引数を受け取ります: `data_column`（必須）、`key_value_pair_delimiter`（デフォルトは `:`）、`pair_delimiters`（デフォルトは `\space \, \;`）、および `quoting_character`（デフォルトは二重引用符）。 [#43606](https://github.com/ClickHouse/ClickHouse/pull/43606)（[Arthur Passos](https://github.com/arthurpassos)）。
* 関数 replaceOne()、replaceAll()、replaceRegexpOne() および replaceRegexpAll() は、非定数のパターンおよび置換引数でも呼び出せるようになりました。[#46589](https://github.com/ClickHouse/ClickHouse/pull/46589)（[Robert Schulze](https://github.com/rschu1ze)）。
* `Map` 型の列を扱うための関数 `mapConcat`、`mapSort`、`mapExists` を追加しました。 [#48071](https://github.com/ClickHouse/ClickHouse/pull/48071) ([Anton Popov](https://github.com/CurtizJ)).

#### パフォーマンスの改善 {#performance-improvement-8}
* `Parquet` フォーマットでのファイル読み込みが大幅に高速化されました。IO とデコード処理が `max_threads` 設定で制御される形で並列化され、必要なデータ範囲のみが読み込まれます。[#47964](https://github.com/ClickHouse/ClickHouse/pull/47964) ([Michael Kolupaev](https://github.com/al13n321)).
* 次のような IN 句（サブクエリ）を伴う mutation を実行する場合: `ALTER TABLE t UPDATE col='new value' WHERE id IN (SELECT id FROM huge_table)`、テーブル `t` に複数のパーツがあると、各パーツごとにサブクエリ `SELECT id FROM huge_table` のセットがメモリ内に構築されます。パーツが多い場合、これによって大量のメモリと CPU を消費し（OOM を引き起こす可能性もあります）、負荷が高くなります。この問題への解決策として、現在 mutation タスクによって構築中のセットを短期間だけ保持するキャッシュを導入しました。同じ mutation の別のタスクが並行して実行されている場合は、そのキャッシュ内のセットを検索し、構築完了を待って再利用できます。[#46835](https://github.com/ClickHouse/ClickHouse/pull/46835) ([Alexander Gololobov](https://github.com/davenger)).
* `ALTER TABLE` クエリを適用する際、必要な場合にのみ依存関係をチェックするようにしました。[#48062](https://github.com/ClickHouse/ClickHouse/pull/48062) ([Raúl Marín](https://github.com/Algunenano)).
* 関数 `mapUpdate` を最適化しました。[#48118](https://github.com/ClickHouse/ClickHouse/pull/48118) ([Anton Popov](https://github.com/CurtizJ)).
* ローカルレプリカへの内部クエリは、明示的に送信され、その結果のデータはループバックインターフェイス経由で受信されるようになりました。設定 `prefer_localhost_replica` は並列レプリカに対しては適用されません。これはスケジューリングを改善し、コードをよりクリーンにするための変更です。イニシエータは読み取りプロセスの調整と結果のマージのみを担当し、他のすべての副次クエリはデータの読み取りを行い、その間イニシエータはリクエストに継続的に応答します。注: ループバックインターフェイスの使用は必ずしも高パフォーマンスではありませんが、そうしないと一部のレプリカがタスク不足で待たされ、結果としてクエリ実行のさらなる遅延や利用可能なリソースを使い切れない状況につながる可能性があります。コーディネータの初期化はさらに遅延実行されるようになりました。すべての受信リクエストには読み取りアルゴリズムに関する情報が含まれており、最初のリクエスト到着時にその情報を用いてコーディネータを初期化します。もし任意のレプリカが別のアルゴリズムで読み取りを行うことを決定した場合は、例外がスローされ、クエリは中止されます。[#48246](https://github.com/ClickHouse/ClickHouse/pull/48246) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* `use_skip_indexes=0` の設定によりスキップインデックスが無効化されている場合、スキップインデックスの解析のみに使用される `IN` 句右辺のサブクエリに対しては、セットを構築しないようにしました。以前はこれがクエリのパフォーマンスに悪影響を与える可能性がありました。[#48299](https://github.com/ClickHouse/ClickHouse/pull/48299) ([Anton Popov](https://github.com/CurtizJ)).
* `FROM file(...)` を読み込んだ直後からクエリ処理を並列化するようにしました。[#38755](https://github.com/ClickHouse/ClickHouse/issues/38755) に関連します。[#48525](https://github.com/ClickHouse/ClickHouse/pull/48525) ([Igor Nikonov](https://github.com/devcrafter)). クエリ処理は、任意のデータソースから読み込んだ直後から並列化されます。影響を受けるデータソースは、主に `url`、`file` といったテーブル関数のようなシンプルまたは外部ストレージです。[#48727](https://github.com/ClickHouse/ClickHouse/pull/48727) ([Igor Nikonov](https://github.com/devcrafter)). これはデフォルトでは無効になっている設定 `parallelize_output_from_storages` によって制御されます。
* ThreadPool のミューテックス競合を低減しました（多数の小さなジョブが存在する場合にパフォーマンスが向上する可能性があります）。[#48750](https://github.com/ClickHouse/ClickHouse/pull/48750) ([Sergei Trifonov](https://github.com/serxa)).
* 複数の `ALTER DELETE` mutation におけるメモリ使用量を削減しました。[#48522](https://github.com/ClickHouse/ClickHouse/pull/48522) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* `skip_unavailable_shards` 設定が有効な場合に、不要な接続試行を行わないようにしました。[#48771](https://github.com/ClickHouse/ClickHouse/pull/48771) ([Azat Khuzhin](https://github.com/azat)).

#### 実験的機能 {#experimental-feature-5}
* クエリキャッシュ内のエントリが `max_block_size` に集約され、圧縮されるようになりました。 [#45912](https://github.com/ClickHouse/ClickHouse/pull/45912) ([Robert Schulze](https://github.com/rschu1ze)).
* クエリキャッシュでユーザーごとのクオータを定義できるようになりました。 [#48284](https://github.com/ClickHouse/ClickHouse/pull/48284) ([Robert Schulze](https://github.com/rschu1ze)).
* 並列レプリカに関するいくつかの修正が行われました。 [#48433](https://github.com/ClickHouse/ClickHouse/pull/48433) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* 暗号化ディスク上での zero-copy replication（実験的機能）が実装されました。 [#48741](https://github.com/ClickHouse/ClickHouse/pull/48741) ([Vitaly Baranov](https://github.com/vitlibar)).

#### 改善 {#improvement-8}

* `connect_timeout_with_failover_ms` のデフォルト値を 1000 ms に引き上げました（[https://github.com/ClickHouse/ClickHouse/pull/47229](https://github.com/ClickHouse/ClickHouse/pull/47229) で非同期接続を追加したため）。[#5188](https://github.com/ClickHouse/ClickHouse/issues/5188) をクローズしました。[#49009](https://github.com/ClickHouse/ClickHouse/pull/49009)（[Kruglov Pavel](https://github.com/Avogar)）。
* データレイク関連にいくつかの改善を行いました：- 非パーティション化データでも `Iceberg` が動作するようにしました。- `Iceberg` フォーマットバージョン v2 をサポートしました（以前は v1 のみ対応）。- `DeltaLake` / `Hudi` のパーティション化されたデータの読み取りをサポートしました。- Delta のチェックポイントファイルを使用することで `DeltaLake` メタデータの読み取りを高速化しました。- `Hudi` の誤った読み取りを修正しました：以前は読み出すデータの選択を誤っており、そのため小規模なテーブルのみ正しく読み取ることができていました。- これらのエンジンが変更されたデータの更新を取り込めるようにしました（以前はテーブル作成時点の状態に固定されていました）。- Spark を使用して `Iceberg` / `DeltaLake` / `Hudi` の適切なテストを行いました。[#47307](https://github.com/ClickHouse/ClickHouse/pull/47307) ([Kseniia Sumarokova](https://github.com/kssenii)).
* ソケットへの非同期接続と非同期書き込みを追加しました。シャード間での接続確立およびクエリ／外部テーブルの送信を非同期化しました。コードを fiber を用いてリファクタリングしました。[#46931](https://github.com/ClickHouse/ClickHouse/issues/46931) をクローズします。この PR の後、デフォルトの `connect_timeout_with_failover_ms` を増やすことが可能になります（[https://github.com/ClickHouse/ClickHouse/issues/5188](https://github.com/ClickHouse/ClickHouse/issues/5188)）。[#47229](https://github.com/ClickHouse/ClickHouse/pull/47229)（[Kruglov Pavel](https://github.com/Avogar)）。
* `zookeeper` の代替として、設定セクション `keeper` / `keeper_server` をサポートしました。 [#34766](https://github.com/ClickHouse/ClickHouse/issues/34766)、[#34767](https://github.com/ClickHouse/ClickHouse/issues/34767) をクローズ。 [#35113](https://github.com/ClickHouse/ClickHouse/pull/35113)（[李扬](https://github.com/taiyang-li)）。
* ClickHouse テーブルをソースとする辞書に対して、named&#95;collections で *secure* フラグを設定できるようになりました。 [#38450](https://github.com/ClickHouse/ClickHouse/issues/38450) に対応。 [#46323](https://github.com/ClickHouse/ClickHouse/pull/46323)（[Ilya Golshtein](https://github.com/ilejn)）。
* `bitCount` 関数が `FixedString` および `String` データ型をサポートするようになりました。[#49044](https://github.com/ClickHouse/ClickHouse/pull/49044) ([flynn](https://github.com/ucasfl))。
* Backup クエリにおけるすべての [Zoo]Keeper 操作について、再試行回数を設定できるようにしました。 [#47224](https://github.com/ClickHouse/ClickHouse/pull/47224) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* デフォルトで S3 用に `use_environment_credentials` を有効化し、プロバイダー チェーン全体がデフォルトで構成されるようにします。 [#47397](https://github.com/ClickHouse/ClickHouse/pull/47397) ([Antonio Andelic](https://github.com/antonio2368))。
* 現在、`JSON_VALUE` 関数は Spark の `get_json_object` 関数と同様に、`'$.key'` のようなパスを使って JSON 文字列から値を取得できます。ただし、いくつか相違点があります。1. Spark の `get_json_object` はパスが存在しない場合は `null` を返しますが、`JSON_VALUE` は空文字列を返します。2. Spark の `get_json_object` は JSON オブジェクト／配列値といった複合型の値を返すことがありますが、`JSON_VALUE` はその場合、空文字列を返します。 [#47494](https://github.com/ClickHouse/ClickHouse/pull/47494) ([KevinyhZou](https://github.com/KevinyhZou))。
* `use_structure_from_insertion_table_in_table_functions` により、テーブル関数への挿入元テーブル構造の伝播がより柔軟になりました。名前マッピングおよび仮想カラムの使用時に発生していた問題を修正しました。`auto` 設定は不要になりました。 [#47962](https://github.com/ClickHouse/ClickHouse/pull/47962) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* クエリが kill された場合や制限を超えた場合には、Keeper への接続を再試行し続けないようにしました。 [#47985](https://github.com/ClickHouse/ClickHouse/pull/47985) ([Raúl Marín](https://github.com/Algunenano)).
* `BSONEachRow` で Enum 型の入出力をサポートし、すべてのマップキー型を許可し、出力時の余分な計算を回避します。 [#48122](https://github.com/ClickHouse/ClickHouse/pull/48122) ([Kruglov Pavel](https://github.com/Avogar)).
* `ORC`/`Arrow`/`Parquet` フォーマットで、より多くの ClickHouse データ型をサポートしました: Enum(8|16)、(U)Int(128|256)、Decimal256（ORC 用）。また、Int32 値から IPv4 を読み取れるようにしました（ORC は IPv4 を Int32 として出力しており、これまでは読み戻せませんでした）。さらに、`ORC` におけるバイナリデータからの Nullable(IPv6) の読み取りを修正しました。 [#48126](https://github.com/ClickHouse/ClickHouse/pull/48126) ([Kruglov Pavel](https://github.com/Avogar)).
* テーブル `system.storage_policies` に列 `perform_ttl_move_on_insert` と `load_balancing` を追加し、列 `volume_type` のデータ型を `Enum8` に変更しました。 [#48167](https://github.com/ClickHouse/ClickHouse/pull/48167) ([lizhuoyu5](https://github.com/lzydmxy))。
* 一時テーブルやシステムテーブルも含め、すべてのテーブルおよびデータベースをバックアップする `BACKUP ALL` コマンドのサポートを追加しました。[#48189](https://github.com/ClickHouse/ClickHouse/pull/48189) ([Vitaly Baranov](https://github.com/vitlibar))。
* 関数 mapFromArrays は、入力として `Map` 型をサポートします。 [#48207](https://github.com/ClickHouse/ClickHouse/pull/48207) ([李扬](https://github.com/taiyang-li))。
* 一部の `SHOW PROCESSLIST` の出力がソートされるようになりました。 [#48241](https://github.com/ClickHouse/ClickHouse/pull/48241) ([Robert Schulze](https://github.com/rschu1ze)).
* リモート IO／ローカル IO／バックアップに対するクエリ単位／サーバー単位の帯域幅制限（サーバー設定: `max_remote_read_network_bandwidth_for_server`, `max_remote_write_network_bandwidth_for_server`, `max_local_read_bandwidth_for_server`, `max_local_write_bandwidth_for_server`, `max_backup_bandwidth_for_server`、設定: `max_remote_read_network_bandwidth`, `max_remote_write_network_bandwidth`, `max_local_read_bandwidth`, `max_local_write_bandwidth`, `max_backup_bandwidth`）。 [#48242](https://github.com/ClickHouse/ClickHouse/pull/48242)（[Azat Khuzhin](https://github.com/azat)）。
* `CapnProto` フォーマットでサポートする型を拡張: Map、(U)Int(128|256)、Decimal(128|256)。入出力時の整数の相互変換を許可。 [#48257](https://github.com/ClickHouse/ClickHouse/pull/48257) ([Kruglov Pavel](https://github.com/Avogar))。
* 通常の挙動では CURRENT&#95;WRITE&#95;BUFFER&#95;IS&#95;EXHAUSTED 例外をスローしないようにしました。 [#48288](https://github.com/ClickHouse/ClickHouse/pull/48288) ([Raúl Marín](https://github.com/Algunenano)).
* `KeeperMap` テーブル上で行われる操作に対して追加の保証を強制する新しい設定 `keeper_map_strict_mode` を追加しました。[#48293](https://github.com/ClickHouse/ClickHouse/pull/48293)（[Antonio Andelic](https://github.com/antonio2368)）。
* シンプルディクショナリの主キー型がネイティブの符号なし整数型であることを検証するための設定 `check_dictionary_primary_key` を、互換性のために追加しました（チェックを無効にするには `check_dictionary_primary_key = false` を設定します）。 [#48335](https://github.com/ClickHouse/ClickHouse/pull/48335) ([lizhuoyu5](https://github.com/lzydmxy)).
* `KeeperMap` に対する mutation は不要なため、レプリケートしないようにしました。 [#48354](https://github.com/ClickHouse/ClickHouse/pull/48354) ([Antonio Andelic](https://github.com/antonio2368)).
* 無名タプルを Protobuf 形式内のネストされた Message として読み書きできるようにしました。タプル要素と Message フィールドは位置で対応付けられます。 [#48390](https://github.com/ClickHouse/ClickHouse/pull/48390) ([Kruglov Pavel](https://github.com/Avogar)).
* 新しいプランナーで `additional_table_filters` および `additional_result_filter` の設定をサポートします。また、`additional_result_filter` のドキュメントエントリを追加します。 [#48405](https://github.com/ClickHouse/ClickHouse/pull/48405) ([Dmitry Novik](https://github.com/novikd))。
* `parseDateTime` は、フォーマット文字列 &#39;%f&#39;（小数秒）に対応しました。 [#48420](https://github.com/ClickHouse/ClickHouse/pull/48420) ([Robert Schulze](https://github.com/rschu1ze)).
* formatDateTime() におけるフォーマット文字列 &quot;%f&quot; は、フォーマット対象に小数秒部がない場合、現在は &quot;000000&quot; を出力します。以前の挙動（ゼロ 1 桁）を復元するには、設定 &quot;formatdatetime&#95;f&#95;prints&#95;single&#95;zero = 1&quot; を有効にしてください。 [#48422](https://github.com/ClickHouse/ClickHouse/pull/48422) ([Robert Schulze](https://github.com/rschu1ze)).
* KeeperMap では DELETE と TRUNCATE をレプリケートしないようにしました。 [#48434](https://github.com/ClickHouse/ClickHouse/pull/48434) ([Antonio Andelic](https://github.com/antonio2368)).
* generateRandom 関数で有効な Decimal 型および Bool 型の値を生成するようにしました。 [#48436](https://github.com/ClickHouse/ClickHouse/pull/48436) ([Kruglov Pavel](https://github.com/Avogar))。
* SELECT クエリの式リストで末尾のカンマを許可するようにしました。たとえば `SELECT a, b, c, FROM table` のように記述できます。[#37802](https://github.com/ClickHouse/ClickHouse/issues/37802) をクローズしました。 [#48438](https://github.com/ClickHouse/ClickHouse/pull/48438)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 環境変数 `CLICKHOUSE_USER` および `CLICKHOUSE_PASSWORD` を、クライアントパラメータ `--user` および `--password` で上書きできるようにしました。[#38909](https://github.com/ClickHouse/ClickHouse/issues/38909) をクローズ。[#48440](https://github.com/ClickHouse/ClickHouse/pull/48440)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 再試行可能なエラーが発生した場合に `MergeTree` テーブルでデータパーツの読み込みを再試行するようにしました。 [#48442](https://github.com/ClickHouse/ClickHouse/pull/48442) ([Anton Popov](https://github.com/CurtizJ))。
* `arrayMin`、`arrayMax`、`arrayDifference` 関数で `Date`、`Date32`、`DateTime`、`DateTime64` データ型をサポートしました。 [#21645](https://github.com/ClickHouse/ClickHouse/issues/21645) をクローズしました。 [#48445](https://github.com/ClickHouse/ClickHouse/pull/48445) ([Nikolay Degterinsky](https://github.com/evillique))。
* `{server_uuid}` マクロのサポートを追加しました。これは、新しいレプリカがランタイム中に継続的に追加・削除されるオートスケールクラスターでレプリカを識別するのに有用です。この変更により [#48554](https://github.com/ClickHouse/ClickHouse/issues/48554) が解決されました。[#48563](https://github.com/ClickHouse/ClickHouse/pull/48563)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* インストールスクリプトは、可能であればコピーではなくハードリンクを作成します。 [#48578](https://github.com/ClickHouse/ClickHouse/pull/48578) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* `SHOW CREATE TABLE` と同義の `SHOW TABLE` 構文をサポート。 [#48580](https://github.com/ClickHouse/ClickHouse/issues/48580) をクローズ。 [#48591](https://github.com/ClickHouse/ClickHouse/pull/48591)（[flynn](https://github.com/ucasfl)）。
* HTTP 一時バッファで、仮想ファイルシステムキャッシュからデータをエビクトして動作させることができるようになりました。[#48664](https://github.com/ClickHouse/ClickHouse/pull/48664) ([Vladimir C](https://github.com/vdimir))。
* `CREATE AS SELECT` でスキーマ推論が機能するようにした。Closes [#47599](https://github.com/ClickHouse/ClickHouse/issues/47599). [#48679](https://github.com/ClickHouse/ClickHouse/pull/48679) ([flynn](https://github.com/ucasfl)).
* `ReplicatedMergeTree` に `replicated_max_mutations_in_one_entry` 設定を追加し、1 つの `MUTATE_PART` エントリあたりの mutation コマンド数に上限を設けられるようにしました（デフォルトは 10000）。 [#48731](https://github.com/ClickHouse/ClickHouse/pull/48731) ([Alexander Tokmakov](https://github.com/tavplubix))。
* AggregateFunction 型では、未使用の arena のバイト数を `read_bytes` に含めないようにしました。 [#48745](https://github.com/ClickHouse/ClickHouse/pull/48745) ([Raúl Marín](https://github.com/Algunenano)).
* MySQL 辞書ソースと named collection 使用時に、一部の MySQL 関連設定が正しく処理されない問題を修正。[#48402](https://github.com/ClickHouse/ClickHouse/issues/48402) をクローズ。 [#48759](https://github.com/ClickHouse/ClickHouse/pull/48759)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* ユーザーが `max_single_part_upload_size` を非常に大きな値に設定した場合、AWS S3 SDK に起因するバグが原因でクラッシュが発生する可能性があります。この変更により [#47679](https://github.com/ClickHouse/ClickHouse/issues/47679) が修正されました。[#48816](https://github.com/ClickHouse/ClickHouse/pull/48816)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `RabbitMQ` のデータ競合を修正（[レポート](https://pastila.nl/?004f7100/de1505289ab5bb355e67ebe6c7cc8707)）、コードをリファクタリング。 [#48845](https://github.com/ClickHouse/ClickHouse/pull/48845)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* `system.parts` および `system.part_log` にエイリアス `name` と `part_name` を追加。[#48718](https://github.com/ClickHouse/ClickHouse/issues/48718) をクローズ。[#48850](https://github.com/ClickHouse/ClickHouse/pull/48850)（[sichenzhao](https://github.com/sichenzhao)）。
* 関数 &quot;arrayDifferenceSupport()&quot;、&quot;arrayCumSum()&quot; および &quot;arrayCumSumNonNegative()&quot; で、広い整数型 (U)Int128/256 の入力配列がサポートされるようになりました。 [#48866](https://github.com/ClickHouse/ClickHouse/pull/48866) ([cluster](https://github.com/infdahai))。
* clickhouse-client の複数行履歴にはパディングが入らなくなりました。これにより、貼り付け操作がより自然になります。 [#48870](https://github.com/ClickHouse/ClickHouse/pull/48870) ([Joanna Hulboj](https://github.com/jh0x))。
* LXC 内で ClickHouse を実行し、LXCFS を使用しているというまれなケース向けに、わずかな改善を実装しました。LXCFS には問題があり、`/proc` 内のファイルを読み取る際に、まれに「Transport endpoint is not connected」というエラーを返すことがあります。このエラーは ClickHouse のサーバーログに正しく記録されていました。今回、この問題に対処するため、ファイルを再度開くようにする追加のワークアラウンドを導入しました。これはごく小さな変更です。[#48922](https://github.com/ClickHouse/ClickHouse/pull/48922) ([Real](https://github.com/RunningXie))。
* プリフェッチのメモリ使用量の計測を改善。CI でプリフェッチ設定をランダムに変更。[#48973](https://github.com/ClickHouse/ClickHouse/pull/48973) ([Kseniia Sumarokova](https://github.com/kssenii)).
* GCS のネイティブコピー操作用ヘッダーを正しく設定しました。 [#48981](https://github.com/ClickHouse/ClickHouse/pull/48981) ([Antonio Andelic](https://github.com/antonio2368)).
* コマンドラインで設定名を指定する際に、アンダースコアではなくダッシュを使用できるようにしました。たとえば `--max_threads` の代わりに `--max-threads` を使用できます。さらに、`--` の代わりに `—` のような Unicode のダッシュ文字もサポートします。これは、他社のチームとやり取りしていて、そのチームのマネージャーが MS Word からコードをコピー＆ペーストした場合などに便利です。 [#48985](https://github.com/ClickHouse/ClickHouse/pull/48985) ([alekseygolub](https://github.com/alekseygolub)).
* SSL ユーザー証明書による認証が失敗した場合に、パスワード認証へフォールバックするようにしました。 [#48974](https://github.com/ClickHouse/ClickHouse/issues/48974) をクローズしました。 [#48989](https://github.com/ClickHouse/ClickHouse/pull/48989) ([Nikolay Degterinsky](https://github.com/evillique))。
* 埋め込みダッシュボードを改善し、[#46671](https://github.com/ClickHouse/ClickHouse/issues/46671) をクローズ。 [#49036](https://github.com/ClickHouse/ClickHouse/pull/49036)（[Kevin Zhang](https://github.com/Kinzeng)）。
* ログメッセージ向けのプロファイルイベントを追加し、重大度別のログメッセージ数を簡単に確認できるようにしました。 [#49042](https://github.com/ClickHouse/ClickHouse/pull/49042) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* 以前のバージョンでは、`LineAsString` フォーマットは、DOS または macOS Classic 形式の改行コードが存在する場合に、並列パースが有効かどうかによって動作が一貫しませんでした。これにより [#49039](https://github.com/ClickHouse/ClickHouse/issues/49039) が解決されました。[#49052](https://github.com/ClickHouse/ClickHouse/pull/49052)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 未解析のクエリパラメータに関する例外メッセージには、そのパラメータ名も含まれるようになります。[#48878](https://github.com/ClickHouse/ClickHouse/issues/48878) を再実装。[#48772](https://github.com/ClickHouse/ClickHouse/issues/48772) をクローズ。[#49061](https://github.com/ClickHouse/ClickHouse/pull/49061)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。

#### ビルド／テスト／パッケージングの改善 {#buildtestingpackaging-improvement-8}
* タイムゾーンを更新しました。更新対象は次のとおりです: Africa/Cairo, Africa/Casablanca, Africa/El_Aaiun, America/Bogota, America/Cambridge_Bay, America/Ciudad_Juarez, America/Godthab, America/Inuvik, America/Iqaluit, America/Nuuk, America/Ojinaga, America/Pangnirtung, America/Rankin_Inlet, America/Resolute, America/Whitehorse, America/Yellowknife, Asia/Gaza, Asia/Hebron, Asia/Kuala_Lumpur, Asia/Singapore, Canada/Yukon, Egypt, Europe/Kirov, Europe/Volgograd, Singapore。 [#48572](https://github.com/ClickHouse/ClickHouse/pull/48572) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* ビルドを高速化するため、ヘッダーファイル内の依存関係数を削減しました。 [#47984](https://github.com/ClickHouse/ClickHouse/pull/47984) ([Dmitry Novik](https://github.com/novikd)).
* テストでマークおよびインデックスの圧縮方式をランダム化しました。 [#48286](https://github.com/ClickHouse/ClickHouse/pull/48286) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 内部の ZSTD を 1.5.4 から 1.5.5 に更新しました。 [#46797](https://github.com/ClickHouse/ClickHouse/pull/46797) ([Robert Schulze](https://github.com/rschu1ze)).
* テストで、コンパクトパーツからワイドパーツへの縦方向マージをランダム化しました。 [#48287](https://github.com/ClickHouse/ClickHouse/pull/48287) ([Raúl Marín](https://github.com/Algunenano)).
* HDFS での CRC32 チェックサムのサポートを追加し、パフォーマンス問題を修正しました。 [#48614](https://github.com/ClickHouse/ClickHouse/pull/48614) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* GCC サポートの残存部分を削除しました。 [#48671](https://github.com/ClickHouse/ClickHouse/pull/48671) ([Robert Schulze](https://github.com/rschu1ze)).
* 新しいアナライザー基盤を有効にした状態での CI 実行を追加しました。 [#48719](https://github.com/ClickHouse/ClickHouse/pull/48719) ([Dmitry Novik](https://github.com/novikd)).

#### バグ修正（公式安定版リリースにおけるユーザーから見える誤動作） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-8}

* バックグラウンドスレッドからプッシュされるマテリアライズドビュー (MV) 向けに system.query&#95;views&#95;log を修正 [#46668](https://github.com/ClickHouse/ClickHouse/pull/46668) ([Azat Khuzhin](https://github.com/azat)).
* いくつかの `RENAME COLUMN` のバグを修正 [#46946](https://github.com/ClickHouse/ClickHouse/pull/46946) ([alesapin](https://github.com/alesapin))。
* clickhouse-format の軽微なハイライト表示に関する不具合を修正 [#47610](https://github.com/ClickHouse/ClickHouse/pull/47610)（[Natasha Murashkina](https://github.com/murfel)）。
* LLVM の libc++ に存在したバグを修正し、サイズが INT&#95;MAX を超えるパートを S3 にアップロードするとクラッシュしていた問題を解消しました [#47693](https://github.com/ClickHouse/ClickHouse/pull/47693) ([Azat Khuzhin](https://github.com/azat)).
* `sparkbar` 関数のオーバーフローを修正 [#48121](https://github.com/ClickHouse/ClickHouse/pull/48121) ([Vladimir C](https://github.com/vdimir))。
* S3 におけるレースコンディションを修正 [#48190](https://github.com/ClickHouse/ClickHouse/pull/48190) ([Anton Popov](https://github.com/CurtizJ)).
* 一貫性のない動作があるため、集約関数の JIT を無効化 [#48195](https://github.com/ClickHouse/ClickHouse/pull/48195) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* ALTER のフォーマットを軽微に修正 [#48289](https://github.com/ClickHouse/ClickHouse/pull/48289) ([Natasha Murashkina](https://github.com/murfel)).
* RabbitMQ における CPU 使用量の問題を修正（23.2 で [#44404](https://github.com/ClickHouse/ClickHouse/issues/44404) により悪化していた） [#48311](https://github.com/ClickHouse/ClickHouse/pull/48311)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* Distributed 上の Merge に対する EXPLAIN PIPELINE のクラッシュを修正 [#48320](https://github.com/ClickHouse/ClickHouse/pull/48320) ([Azat Khuzhin](https://github.com/azat)).
* LowCardinality を Arrow dictionary としてシリアル化する処理を修正 [#48361](https://github.com/ClickHouse/ClickHouse/pull/48361) ([Kruglov Pavel](https://github.com/Avogar))。
* TemporaryFileStream でキャッシュファイルセグメント用のダウンローダーをリセット [#48386](https://github.com/ClickHouse/ClickHouse/pull/48386) ([Vladimir C](https://github.com/vdimir))。
* DROP/REPLACE PARTITION の場合に SYSTEM SYNC REPLICA がハングする可能性のある問題を修正 [#48391](https://github.com/ClickHouse/ClickHouse/pull/48391) ([Azat Khuzhin](https://github.com/azat)).
* 辞書に依存する分散テーブルを読み込む際に発生する起動エラーを修正しました [#48419](https://github.com/ClickHouse/ClickHouse/pull/48419) ([MikhailBurdukov](https://github.com/MikhailBurdukov))。
* システムテーブルを自動的にリネームする際に依存関係をチェックしないようにしました [#48431](https://github.com/ClickHouse/ClickHouse/pull/48431) ([Raúl Marín](https://github.com/Algunenano)).
* KeeperMap ストレージで影響を受けた行のみを更新する [#48435](https://github.com/ClickHouse/ClickHouse/pull/48435) ([Antonio Andelic](https://github.com/antonio2368))。
* VFS キャッシュで発生し得るセグメンテーションフォルトを修正 [#48469](https://github.com/ClickHouse/ClickHouse/pull/48469) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `toTimeZone` 関数は、定数文字列が指定されていない場合にエラーをスローします [#48471](https://github.com/ClickHouse/ClickHouse/pull/48471) ([Jordi Villar](https://github.com/jrdi))。
* Protobuf における IPv4 に関する論理エラーを修正し、Date32 のサポートを追加 [#48486](https://github.com/ClickHouse/ClickHouse/pull/48486) ([Kruglov Pavel](https://github.com/Avogar))。
* system.settings の &quot;changed&quot; フラグが、複数の値を持つ設定に対して誤って計算されていました [#48516](https://github.com/ClickHouse/ClickHouse/pull/48516) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* 圧縮有効時のストレージ `Memory` を修正 [#48517](https://github.com/ClickHouse/ClickHouse/pull/48517)（[Anton Popov](https://github.com/CurtizJ)）。
* クライアント再接続時に bracketed paste モードによりパスワード入力が乱れる問題を修正 [#48528](https://github.com/ClickHouse/ClickHouse/pull/48528) ([Michael Kolupaev](https://github.com/al13n321)).
* IP 型および UUID 型のキーを持つネストされた map を修正 [#48556](https://github.com/ClickHouse/ClickHouse/pull/48556) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* ハッシュ辞書用の並列ローダー使用時に未処理例外が発生する問題を修正 [#48571](https://github.com/ClickHouse/ClickHouse/pull/48571) ([Azat Khuzhin](https://github.com/azat))。
* `groupArray` 集約関数が、NULL を許容する型で空の結果に対しても正しく動作します [#48593](https://github.com/ClickHouse/ClickHouse/pull/48593) ([lgbo](https://github.com/lgbo-ustc))。
* ACL 使用時に、ノードがスキーム `auth` 付きで作成されないことがある Keeper のバグを修正しました。 [#48595](https://github.com/ClickHouse/ClickHouse/pull/48595) ([Aleksei Filatov](https://github.com/aalexfvk)).
* IPv4 と UInt の比較演算子を許可 [#48611](https://github.com/ClickHouse/ClickHouse/pull/48611) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* キャッシュに起因する可能性のあるエラーを修正 [#48636](https://github.com/ClickHouse/ClickHouse/pull/48636)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* 空のデータに対する非同期挿入で、例外がスローされなくなりました。 [#48663](https://github.com/ClickHouse/ClickHouse/pull/48663) ([Anton Popov](https://github.com/CurtizJ)).
* RENAME TABLE が失敗した場合にテーブルの依存関係を修正する [#48683](https://github.com/ClickHouse/ClickHouse/pull/48683)（[Azat Khuzhin](https://github.com/azat)）。
* 主キーに重複するカラムが含まれている場合（これはプロジェクションに対してのみ発生し得ます）、以前のバージョンではバグを引き起こす可能性がありました [#48838](https://github.com/ClickHouse/ClickHouse/pull/48838)（[Amos Bird](https://github.com/amosbird)）。
* ZooKeeper における send&#95;thread/receive&#95;thread の join 時のレースコンディションを修正 [#48849](https://github.com/ClickHouse/ClickHouse/pull/48849) ([Alexander Gololobov](https://github.com/davenger))。
* zero copy replication で無視されている detached part を削除しようとした際に発生する予期しない part name エラーを修正 [#48862](https://github.com/ClickHouse/ClickHouse/pull/48862) ([Michael Lex](https://github.com/mlex)).
* `Date32` 型の Parquet/Arrow 列が `Date32` 型の列として読み込まれない問題を修正 [#48864](https://github.com/ClickHouse/ClickHouse/pull/48864) ([Kruglov Pavel](https://github.com/Avogar))。
* 行ポリシーが設定され、名前にドットを含む列を持つテーブルから選択するときに発生する `UNKNOWN_IDENTIFIER` エラーを修正 [#48976](https://github.com/ClickHouse/ClickHouse/pull/48976) ([Kruglov Pavel](https://github.com/Avogar))。
* 空の Nullable 文字列による集計を修正 [#48999](https://github.com/ClickHouse/ClickHouse/pull/48999) ([LiuNeng](https://github.com/liuneng1994))。

### <a id="233"></a> ClickHouse リリース 23.3 LTS, 2023-03-30 {#233}

#### アップグレードに関する注意事項 {#upgrade-notes-1}
* 軽量 DELETE は本番運用で使用可能な状態になり、デフォルトで有効化されました。MergeTree テーブルに対する `DELETE` クエリは、現在デフォルトで利用可能です。
* `*domain*RFC` および `netloc` 関数の挙動がわずかに変更されました。より良い仕様準拠のために、URL の authority 部分で許可される記号の集合が緩和されています。 [#46841](https://github.com/ClickHouse/ClickHouse/pull/46841) ([Azat Khuzhin](https://github.com/azat)).
* カラムに対して DEFAULT/EPHEMERAL/ALIAS/MATERIALIZED 句を指定した KafkaEngine ベースのテーブルの作成を禁止しました。 [#47138](https://github.com/ClickHouse/ClickHouse/pull/47138) ([Aleksandr Musorin](https://github.com/AVMusorin)).
* 「非同期接続ドレイン」機能を削除しました。関連する設定およびメトリクスも削除されています。これは内部機能であったため、この機能について知らなかったユーザーには影響しないはずです。 [#47486](https://github.com/ClickHouse/ClickHouse/pull/47486) ([Alexander Tokmakov](https://github.com/tavplubix)).
* `arraySum`/`Min`/`Max`/`Avg`/`Product`、`arrayCumSum`/`CumSumNonNegative`、`arrayDifference`、配列構築、IN 演算子、クエリパラメータ、`groupArrayMovingSum`、統計関数、`min`/`max`/`any`/`argMin`/`argMax`、PostgreSQL ワイヤプロトコル、MySQL テーブルエンジンおよび関数、`sumMap`、`mapAdd`、`mapSubtract`、`arrayIntersect` において、256 ビット Decimal データ型（38 桁を超える）をサポートしました。`arrayIntersect` においてビッグ整数をサポートしました。モーメントを扱う統計集約関数（`corr` や各種 `TTest` など）は、内部表現として `Float64` を使用します（この変更以前は `Decimal128` を使用していましたが、有用ではありませんでした）。また、分散が無限大の場合、これらの関数は `inf` の代わりに `nan` を返すことがあります。いくつかの関数はこれまで `Decimal256` データ型で利用可能でしたが、以前のバージョンでは `Decimal128` を返していましたが、現在は修正されています。これにより [#47569](https://github.com/ClickHouse/ClickHouse/issues/47569) がクローズされます。これにより [#44864](https://github.com/ClickHouse/ClickHouse/issues/44864) がクローズされます。これにより [#28335](https://github.com/ClickHouse/ClickHouse/issues/28335) がクローズされます。 [#47594](https://github.com/ClickHouse/ClickHouse/pull/47594) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* backup_threads/restore_threads をユーザー設定ではなくサーバー設定に変更しました。 [#47881](https://github.com/ClickHouse/ClickHouse/pull/47881) ([Azat Khuzhin](https://github.com/azat)).
* 定数および非決定論的なセカンダリインデックスを許可しないようにしました。 [#46839](https://github.com/ClickHouse/ClickHouse/pull/46839) ([Anton Popov](https://github.com/CurtizJ)).

#### 新機能 {#new-feature-9}

* `parallel_replicas_custom_key` と `parallel_replicas_custom_key_filter_type` の設定を使用して、レプリカ間で処理を分割する新しいモードを追加しました。クラスタが複数のレプリカを持つ単一のシャードで構成されている場合、最大 `max_parallel_replicas` 個までがランダムに選択され、シャードとして扱われます。各シャードに対して、対応するフィルタがイニシエータ側のクエリに追加され、その後シャードに送信されます。クラスタが複数のシャードで構成されている場合、任意のキーを定義できる点を除き、`sample_key` と同様に動作します。[#45108](https://github.com/ClickHouse/ClickHouse/pull/45108)（[Antonio Andelic](https://github.com/antonio2368)）。
* キャンセル時に部分結果を表示するオプション: クエリ設定 `partial_result_on_first_cancel` が追加され、キャンセルされたクエリ（例: Ctrl+C による中断）が部分結果を返せるようになりました。 [#45689](https://github.com/ClickHouse/ClickHouse/pull/45689) ([Alexey Perevyshin](https://github.com/alexX512))。
* 一時テーブルに対して、任意のテーブルエンジン（Replicated エンジンおよび KeeperMap エンジンを除く）をサポートしました。 [#31497](https://github.com/ClickHouse/ClickHouse/issues/31497) をクローズしました。 [#46071](https://github.com/ClickHouse/ClickHouse/pull/46071)（[Roman Vasin](https://github.com/rvasin)）。
* Keeper の集中ストレージを利用してユーザー定義 SQL 関数のレプリケーションをサポートしました。 [#46085](https://github.com/ClickHouse/ClickHouse/pull/46085) ([Aleksei Filatov](https://github.com/aalexfvk)).
* `system.settings` と同様にサーバー設定を保持する `system.server_settings` を実装しました。[#46550](https://github.com/ClickHouse/ClickHouse/pull/46550) ([pufit](https://github.com/pufit)).
* `UNDROP TABLE` クエリのサポートを追加。[#46811](https://github.com/ClickHouse/ClickHouse/issues/46811) をクローズ。[#47241](https://github.com/ClickHouse/ClickHouse/pull/47241)（[chen](https://github.com/xiedeyantu)）。
* 名前付きコレクションに対して個別の権限を付与できるようにしました（例：全コレクションまとめてではなく、特定のコレクションに対してのみ `SHOW/CREATE/ALTER/DROP named collection` アクセスを与えられるようにする）。[#40894](https://github.com/ClickHouse/ClickHouse/issues/40894) をクローズ。新しいアクセス種別 `NAMED_COLLECTION_CONTROL` を追加しました。これはユーザーのデフォルト権限には、ユーザー設定に明示的に追加しない限り付与されません（`GRANT ALL` を行うには必須）。また、23.2 ではユーザーのデフォルト権限にフルアクセス権を持たせるために手動で指定する必要があった `show_named_collections` は、もはや必須ではありません。[#46241](https://github.com/ClickHouse/ClickHouse/pull/46241)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* ネストされたカスタムディスクをサポートしました。以前は、カスタムディスクはフラットなディスク構造のみをサポートしていました。[#47106](https://github.com/ClickHouse/ClickHouse/pull/47106) ([Kseniia Sumarokova](https://github.com/kssenii))。
* 関数 `widthBucket` を導入し、互換性維持のために `WIDTH_BUCKET` エイリアスを追加。[#42974](https://github.com/ClickHouse/ClickHouse/issues/42974)。[#46790](https://github.com/ClickHouse/ClickHouse/pull/46790)（[avoiderboi](https://github.com/avoiderboi)）。
* 指定されたフォーマット文字列に従って動作する新しい関数 `parseDateTime` / `parseDateTimeInJodaSyntax` を追加しました。`parseDateTime` は MySQL の書式で指定された文字列を DateTime に変換し、`parseDateTimeInJodaSyntax` は Joda の書式で変換します。[#46815](https://github.com/ClickHouse/ClickHouse/pull/46815)（[李扬](https://github.com/taiyang-li)）。
* テーブル関数 `null` のデフォルト構造として `dummy UInt8` を使用するようにしました。 [#46930](https://github.com/ClickHouse/ClickHouse/issues/46930) をクローズします。 [#47006](https://github.com/ClickHouse/ClickHouse/pull/47006)（[flynn](https://github.com/ucasfl)）。
* `parseDateTimeBestEffort` 関数で `Dec 15, 2021` のようなカンマ付き日付フォーマットをサポート。 [#46816](https://github.com/ClickHouse/ClickHouse/issues/46816) をクローズ。 [#47071](https://github.com/ClickHouse/ClickHouse/pull/47071) ([chen](https://github.com/xiedeyantu)).
* HTTP インターフェイス用の URL パラメータ `wait_end_of_query` および `buffer_size` に対応する設定 `http_wait_end_of_query` と `http_response_buffer_size` を追加しました。これにより、プロファイルでこれらの設定を変更できるようになりました。 [#47108](https://github.com/ClickHouse/ClickHouse/pull/47108) ([Vladimir C](https://github.com/vdimir))。
* `Atomic` データベースから削除されたが、まだ完全には削除されていないテーブルを表示する `system.dropped_tables` テーブルを追加しました。 [#47364](https://github.com/ClickHouse/ClickHouse/pull/47364) ([chen](https://github.com/xiedeyantu)).
* MySQL 互換性のため、`positionCaseInsensitive` のエイリアスとして `INSTR` を追加。[#47529](https://github.com/ClickHouse/ClickHouse/issues/47529) をクローズ。 [#47535](https://github.com/ClickHouse/ClickHouse/pull/47535)（[flynn](https://github.com/ucasfl)）。
* 固定精度で数値を文字列に変換できる `toDecimalString` 関数を追加しました。 [#47838](https://github.com/ClickHouse/ClickHouse/pull/47838) ([Andrey Zvonov](https://github.com/zvonand))。
* MergeTree の設定 `max_number_of_mutations_for_replica` を追加しました。これは、レプリカごとのパーツのミューテーション数を指定した値に制限します。0 を指定すると、レプリカごとのミューテーション数に制限がないことを意味します（ただし、実行自体は他の設定によって制約される場合があります）。 [#48047](https://github.com/ClickHouse/ClickHouse/pull/48047) ([Vladimir C](https://github.com/vdimir))。
* 2つの配列からマップを作成できる Map 関連関数 `mapFromArrays` を追加しました。 [#31125](https://github.com/ClickHouse/ClickHouse/pull/31125) ([李扬](https://github.com/taiyang-li))。
* Parquet/ORC/Arrow の出力フォーマットで圧縮方式を制御できるようにし、より多くの圧縮入力形式をサポートしました。これにより [#13541](https://github.com/ClickHouse/ClickHouse/issues/13541) が解決されました。 [#47114](https://github.com/ClickHouse/ClickHouse/pull/47114) ([Kruglov Pavel](https://github.com/Avogar)).
* ネイティブプロトコルに SSL ユーザー証明書による認証を追加。[#47077](https://github.com/ClickHouse/ClickHouse/issues/47077) をクローズ。[#47596](https://github.com/ClickHouse/ClickHouse/pull/47596)（[Nikolay Degterinsky](https://github.com/evillique)）。
* `parseDateTime` 用に *OrNull() および *OrZero() バリアントを追加し、MySQL 互換のためのエイリアス `str_to_date` を追加しました。 [#48000](https://github.com/ClickHouse/ClickHouse/pull/48000) ([Robert Schulze](https://github.com/rschu1ze)).
* MySQL との互換性を高めるため、「LIKE」「IN」「MOD」などの演算子に類似する `REGEXP` 演算子を追加しました [#47869](https://github.com/ClickHouse/ClickHouse/pull/47869) ([Robert Schulze](https://github.com/rschu1ze))。



#### パフォーマンスの向上 {#performance-improvement-9}

* メモリ上のマークが圧縮され、3〜6 倍少ないメモリで済むようになりました。 [#47290](https://github.com/ClickHouse/ClickHouse/pull/47290) ([Michael Kolupaev](https://github.com/al13n321)).
* 以前のバージョンでは、大量のファイルに対するバックアップは信じられないほど遅いものでしたが、今は違います。今では信じられないほど高速です。 [#47251](https://github.com/ClickHouse/ClickHouse/pull/47251) ([Alexey Milovidov](https://github.com/alexey-milovidov))。バックアップの IO 処理専用のスレッドプールを導入しました。これにより、他のプールとは独立してスケールでき、パフォーマンスが向上します。 [#47174](https://github.com/ClickHouse/ClickHouse/pull/47174) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。バックアップ処理の最終段階でメタデータを収集する際に、MultiRead リクエストとリトライを使用するようにしました。 [#47243](https://github.com/ClickHouse/ClickHouse/pull/47243) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。バックアップと復元対象のデータの両方が S3 にある場合、今後はサーバーサイドコピーが使用されるようになりました。 [#47546](https://github.com/ClickHouse/ClickHouse/pull/47546) ([Vitaly Baranov](https://github.com/vitlibar))。
* `FINAL` を使用したクエリでの過剰な読み込みを修正しました。 [#47801](https://github.com/ClickHouse/ClickHouse/pull/47801) ([Nikita Taranov](https://github.com/nickitat)).
* `max_final_threads` はサーバー起動時にコア数に設定されるようになりました（`max_threads` と同じアルゴリズムによって）。これにより、多数の CPU を搭載したサーバーにおける `final` 実行の並列性が向上します。 [#47915](https://github.com/ClickHouse/ClickHouse/pull/47915) ([Nikita Taranov](https://github.com/nickitat)).
* CLICKHOUSE ソースを持つ DIRECT 辞書の読み取りパイプラインをマルチスレッドで実行できるようになりました。有効にするには、`CREATE DICTIONARY` 文のソースの `SETTINGS` セクションで `dictionary_use_async_executor=1` を設定します。 [#47986](https://github.com/ClickHouse/ClickHouse/pull/47986) ([Vladimir C](https://github.com/vdimir)).
* 単一の Nullable キーを持つ集計のパフォーマンスを最適化。 [#45772](https://github.com/ClickHouse/ClickHouse/pull/45772) ([LiuNeng](https://github.com/liuneng1994)).
* `hasTokenOrNull`、`hasTokenCaseInsensitive`、`hasTokenCaseInsensitiveOrNull` 向けに、小文字の `tokenbf_v1` インデックスの利用を実装しました。 [#46252](https://github.com/ClickHouse/ClickHouse/pull/46252) ([ltrk2](https://github.com/ltrk2))。
* SIMD を使用して先頭の 2 文字を検索することで、関数 `position` と `LIKE` を最適化。 [#46289](https://github.com/ClickHouse/ClickHouse/pull/46289) ([Jiebin Sun](https://github.com/jiebinn)).
* 大きくなりがちな `system.detached_parts` に対するクエリを最適化しました。ブロックサイズ制限に対応するために複数のソースを追加し、各ブロックごとにパーツサイズを計算する（つまりシステムコールを並列に実行する）ため IO スレッドプールを使用するようにしました。 [#46624](https://github.com/ClickHouse/ClickHouse/pull/46624) ([Sema Checherinda](https://github.com/CheSema))。
* ReplicatedMergeTree テーブルに対する `max_replicated_merges_in_queue` のデフォルト値を 16 から 1000 に引き上げます。これにより、ClickHouse Cloud の共有ストレージを利用するクラスタなど、非常に多くのレプリカを持つクラスタでバックグラウンドマージ処理をより高速に実行できるようになります。 [#47050](https://github.com/ClickHouse/ClickHouse/pull/47050) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* パーティションのリストを取得する際に `DISTINCT` の代わりに `GROUP BY` を使用するように `clickhouse-copier` を更新しました。大きなテーブルでは、これにより SELECT の実行時間が 500 秒超から 1 秒未満に短縮されました。 [#47386](https://github.com/ClickHouse/ClickHouse/pull/47386) ([Clayton McClure](https://github.com/cmcclure-twilio)).
* `ASOF JOIN` におけるパフォーマンス低下を修正。 [#47544](https://github.com/ClickHouse/ClickHouse/pull/47544) ([Ongkong](https://github.com/ongkong)).
* Keeper のバッチ処理をさらに強化。読み取りリクエスト時にバッチを分割しないようにしてパフォーマンスを改善。 [#47978](https://github.com/ClickHouse/ClickHouse/pull/47978) ([Antonio Andelic](https://github.com/antonio2368)).
* 異なる DEFAULT 式を持つ列を含む Merge で PREWHERE を許可。 [#46831](https://github.com/ClickHouse/ClickHouse/pull/46831) ([Azat Khuzhin](https://github.com/azat)).

#### 実験的機能 {#experimental-feature-6}
* Parallel replicas 機能: ローカルレプリカをより有効に活用することで全体的なパフォーマンスを改善し、デフォルトで非レプリケートな MergeTree テーブルからの parallel replicas 機能を用いた読み取りを禁止しました。[#47858](https://github.com/ClickHouse/ClickHouse/pull/47858) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)).
* 実験的な Analyzer が有効な場合、`Join`、`Dictionary`、`EmbeddedRocksDB` テーブルとの JOIN に対して、左テーブルへのフィルタープッシュダウンをサポートしました。[#47280](https://github.com/ClickHouse/ClickHouse/pull/47280) ([Maksim Kita](https://github.com/kitaisreal)).
* ゼロコピー複製を用いる ReplicatedMergeTree において、Keeper への負荷が軽減されました。[#47676](https://github.com/ClickHouse/ClickHouse/pull/47676) ([alesapin](https://github.com/alesapin)).
* MaterializedPostgreSQL を用いたマテリアライズドビューの作成に関する問題を修正しました。[#40807](https://github.com/ClickHouse/ClickHouse/pull/40807) ([Maksim Buren](https://github.com/maks-buren630501)).

#### 改善 {#improvement-9}

* `input_format_json_ignore_unknown_keys_in_named_tuple` をデフォルトで有効にしました。 [#46742](https://github.com/ClickHouse/ClickHouse/pull/46742) ([Kruglov Pavel](https://github.com/Avogar))。
* MATERIALIZED VIEW（マテリアライズドビュー）への push 時に発生したエラーを無視できるようにしました（新しい設定 `materialized_views_ignore_errors` を追加しました。デフォルトは `false` ですが、ログを常に `system.*_log` テーブルにフラッシュするために `true` に設定されています）。 [#46658](https://github.com/ClickHouse/ClickHouse/pull/46658) ([Azat Khuzhin](https://github.com/azat)).
* 分散送信のファイルキューをメモリ上で追跡する。[#45491](https://github.com/ClickHouse/ClickHouse/pull/45491) ([Azat Khuzhin](https://github.com/azat)).
* 現在では、HTTP プロトコル経由のすべてのクエリのレスポンスに、`X-ClickHouse-Query-Id` と `X-ClickHouse-Timezone` ヘッダーが追加されるようになりました。以前は `SELECT` クエリに対してのみ追加されていました。 [#46364](https://github.com/ClickHouse/ClickHouse/pull/46364) ([Anton Popov](https://github.com/CurtizJ)).
* `MongoDB` 外部テーブル: host:port の列挙を含む URI 経由でのレプリカセットへの接続サポートと、MongoDB 辞書における readPreference オプションのサポート。URI の例: mongodb://db0.example.com:27017,db1.example.com:27017,db2.example.com:27017/?replicaSet=myRepl&amp;readPreference=primary。 [#46524](https://github.com/ClickHouse/ClickHouse/pull/46524) ([artem-yadr](https://github.com/artem-yadr))。
* この改善はユーザーからは見えない形で行われます。クエリプランに基づいてプロジェクション解析を再実装しました。旧バージョンと新バージョンを切り替えるための設定項目 `query_plan_optimize_projection=1` を追加しました。[#44963](https://github.com/ClickHouse/ClickHouse/issues/44963) を修正しました。[#46537](https://github.com/ClickHouse/ClickHouse/pull/46537)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* デフォルトで、出力フォーマットでは Parquet フォーマット v1 ではなく v2 を使用するようにしました。Parquet のバージョンを制御するための設定 `output_format_parquet_version` を追加しました。指定可能な値は `1.0`、`2.4`、`2.6`、`2.latest`（デフォルト）です。 [#46617](https://github.com/ClickHouse/ClickHouse/pull/46617) ([Kruglov Pavel](https://github.com/Avogar)).
* 新しい設定構文を使用して、名前にピリオド（`.`）を含む Kafka トピックを構成できるようになりました。 [#46752](https://github.com/ClickHouse/ClickHouse/pull/46752) ([Robert Schulze](https://github.com/rschu1ze))。
* 問題のある繰り返しを検出するために Hyperscan パターンをチェックするヒューリスティックを修正。 [#46819](https://github.com/ClickHouse/ClickHouse/pull/46819) ([Robert Schulze](https://github.com/rschu1ze))。
* 別のレプリカによって並行してブロックが作成された場合に、ZK ノードが存在することを system.errors に報告しないように変更しました。 [#46820](https://github.com/ClickHouse/ClickHouse/pull/46820) ([Raúl Marín](https://github.com/Algunenano)).
* `clickhouse-local` で開くファイル数の上限を引き上げました。これにより、大量の CPU コアを持つサーバー上の `web` テーブルからも読み取れるようになります。開いているファイル数が多すぎる場合でも、`URL` テーブルエンジンからの読み取りでバックオフしないようにしました。これにより [#46852](https://github.com/ClickHouse/ClickHouse/issues/46852) がクローズされました。[#46853](https://github.com/ClickHouse/ClickHouse/pull/46853)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 数値をパースできない場合に送出される例外メッセージが、以前より読みやすくなりました。 [#46917](https://github.com/ClickHouse/ClickHouse/pull/46917) ([Robert Schulze](https://github.com/rschu1ze)).
* バックアップの進捗を追跡するため、各タスクの処理が完了するたびに `system.backups` を更新する処理を追加しました。 [#46989](https://github.com/ClickHouse/ClickHouse/pull/46989) ([Aleksandr Musorin](https://github.com/AVMusorin)).
* Native 入力フォーマットでの型変換を許可しました。これを制御する設定 `input_format_native_allow_types_conversion` を追加しました（デフォルトで有効です）。[#46990](https://github.com/ClickHouse/ClickHouse/pull/46990)（[Kruglov Pavel](https://github.com/Avogar)）。
* `range` 関数で IPv4 を許可し、IP 範囲を生成できるようにしました。 [#46995](https://github.com/ClickHouse/ClickHouse/pull/46995) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* あるボリューム/ディスクから別のボリューム/ディスクへパーツを移動できない場合に出力される例外メッセージを改善しました。 [#47032](https://github.com/ClickHouse/ClickHouse/pull/47032) ([alesapin](https://github.com/alesapin)).
* `JSONType` 関数で `Bool` 型をサポートしました。以前は bool 値に対して誤って `Null` 型が返されていました。 [#47046](https://github.com/ClickHouse/ClickHouse/pull/47046) ([Anton Popov](https://github.com/CurtizJ)).
* `_request_body` パラメータを使用して、あらかじめ定義した HTTP クエリを設定します。 [#47086](https://github.com/ClickHouse/ClickHouse/pull/47086) ([Constantine Peresypkin](https://github.com/pkit))。
* Enter キー押下時に組み込み UI の SQL エディタで自動インデントを行うようにしました。 [#47113](https://github.com/ClickHouse/ClickHouse/pull/47113) ([Alexey Korepanov](https://github.com/alexkorep)).
* &#39;sudo&#39; を使用して自己解凍を行う場合、展開されたファイルの uid および gid を実行ユーザーに設定しようとします。 [#47116](https://github.com/ClickHouse/ClickHouse/pull/47116) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* 以前は、`repeat` 関数の第 2 引数は符号なし整数型のみを受け付けており、-1 のような値は指定できませんでした。この挙動は Spark の同名関数とは異なっていました。このアップデートでは、`repeat` 関数の挙動を Spark の関数と揃えるように変更しました。これにより、負の整数を含む同じ型の入力を受け付けるようになりました。更新後の実装の正しさを検証するために、広範なテストを実施しています。[#47134](https://github.com/ClickHouse/ClickHouse/pull/47134)（[KevinyhZou](https://github.com/KevinyhZou)）。注記: このチェンジログのエントリは ChatGPT によって書き直されました。
* スタックトレースから `::__1` 部分を削除し、スタックトレース内で `std::basic_string<char, ...` を `String` として表示します。 [#47171](https://github.com/ClickHouse/ClickHouse/pull/47171) ([Mike Kot](https://github.com/myrrc)).
* リプレイ攻撃を防ぐために interserver モードを再実装しました（この変更は以前のサーバーとも後方互換性があります）。 [#47213](https://github.com/ClickHouse/ClickHouse/pull/47213) ([Azat Khuzhin](https://github.com/azat)).
* 正規表現グループの認識精度を向上し、`regexp_tree` 辞書を改善しました。 [#47218](https://github.com/ClickHouse/ClickHouse/pull/47218) ([Han Fei](https://github.com/hanfei1991)).
* Keeper の改善: Keeper が使用するリソースをクリーンアップするための新しい 4LW コマンド `clrs` を追加 (例: 未使用メモリの解放)。 [#47256](https://github.com/ClickHouse/ClickHouse/pull/47256) ([Antonio Andelic](https://github.com/antonio2368))。
* コーデック `DoubleDelta(bytes_size)`、`Gorilla(bytes_size)`、`FPC(level, float_size)` にオプション引数を追加しました。これにより、`clickhouse-compressor` でカラム型を指定せずにこれらのコーデックを使用できるようになります。これらのコーデック使用時に `clickhouse-compressor` で発生しうる異常終了や算術エラーを修正しました。修正: [https://github.com/ClickHouse/ClickHouse/discussions/47262](https://github.com/ClickHouse/ClickHouse/discussions/47262)。 [#47271](https://github.com/ClickHouse/ClickHouse/pull/47271)（[Kruglov Pavel](https://github.com/Avogar)）。
* `runningDifference` 関数に big int 型のサポートを追加しました。[#47194](https://github.com/ClickHouse/ClickHouse/issues/47194) をクローズしました。[#47322](https://github.com/ClickHouse/ClickHouse/pull/47322)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 有効期限付きの S3 認証情報に対し有効期限の猶予時間を設け、一部のエッジケースで発生する `ExpiredToken` エラーを回避できるようにしました。これは `expiration_window_seconds` 設定で制御でき、デフォルトは 120 秒です。 [#47423](https://github.com/ClickHouse/ClickHouse/pull/47423) ([Antonio Andelic](https://github.com/antonio2368))。
* `Avro` フォーマットで Decimals 型と Date32 型をサポートするようにしました。 [#47434](https://github.com/ClickHouse/ClickHouse/pull/47434) ([Kruglov Pavel](https://github.com/Avogar)).
* `Ordinary` から `Atomic` への変換が中断されていることが検出された場合はサーバーを起動せず、トラブルシューティング手順を含む、よりわかりやすいエラーメッセージを出力するようにしました。 [#47487](https://github.com/ClickHouse/ClickHouse/pull/47487) ([Alexander Tokmakov](https://github.com/tavplubix))。
* `system.opentelemetry_span_log` に新しいカラム `kind` を追加しました。このカラムには OpenTelemetry で定義されている [SpanKind](https://opentelemetry.io/docs/reference/specification/trace/api/#spankind) の値が格納されます。[#47499](https://github.com/ClickHouse/ClickHouse/pull/47499)（[Frank Chen](https://github.com/FrankChen021)）。
* `Protobuf` フォーマットで、カラム名としてルートフィールド名だけを使用してネストした配列の読み書きができるようになりました。以前は、カラム名にすべてのネストしたフィールド名を含める必要がありました（`a.b.c Array(Array(Array(UInt32)))` のように）。現在では、単に `a Array(Array(Array(UInt32)))` と記述できます。 [#47650](https://github.com/ClickHouse/ClickHouse/pull/47650) ([Kruglov Pavel](https://github.com/Avogar))。
* `SYSTEM SYNC REPLICA` にオプションの `STRICT` 修飾子が追加されました。これにより、クエリはレプリケーションキューが空になるまで待機し、[https://github.com/ClickHouse/ClickHouse/pull/45648](https://github.com/ClickHouse/ClickHouse/pull/45648) の変更前と同じ挙動になります。 [#47659](https://github.com/ClickHouse/ClickHouse/pull/47659)（[Alexander Tokmakov](https://github.com/tavplubix)）。
* 一部の OpenTelemetry スパンログの名前付けを改善しました。 [#47667](https://github.com/ClickHouse/ClickHouse/pull/47667) ([Frank Chen](https://github.com/FrankChen021)).
* 集約関数コンビネータのチェーンが長くなりすぎることを防ぐようにしました（解析段階でクエリが遅くなる可能性があります）。これにより [#47715](https://github.com/ClickHouse/ClickHouse/issues/47715) が解決されました。[#47716](https://github.com/ClickHouse/ClickHouse/pull/47716)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* パラメータ化ビューでのサブクエリをサポートし、[#46741](https://github.com/ClickHouse/ClickHouse/issues/46741) [#47725](https://github.com/ClickHouse/ClickHouse/pull/47725) を解決しました（[SmitaRKulkarni](https://github.com/SmitaRKulkarni)）。
* MySQL インテグレーションにおけるメモリリークを修正しました（`connection_auto_close=1` の場合に再現）。[#47732](https://github.com/ClickHouse/ClickHouse/pull/47732)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* Decimal パラメータに関連するコードのエラー処理が改善され、より情報量の多いエラーメッセージが出力されるようになりました。これまでは、不正な Decimal パラメータが指定された場合に生成されるエラーメッセージが不明瞭であったり、有用でないことがありました。この更新により、出力されるエラーメッセージが改善され、より詳細で有用な情報が提供されるようになったため、Decimal パラメータに関連する問題を特定して修正しやすくなりました。 [#47812](https://github.com/ClickHouse/ClickHouse/pull/47812) ([Yu Feng](https://github.com/Vigor-jpg))。注：この変更ログのエントリは ChatGPT によって書き直されています。
* パラメータ `exact_rows_before_limit` は、リミットに達する前に返された行数を `rows_before_limit_at_least` が正確に反映できるようにするために使用されます。このプルリクエストでは、クエリが複数シャードにまたがる分散処理やソート処理を含む場合に発生していた問題に対処しています。今回の更新以前は、これらのケースは意図したとおりに動作していませんでした。[#47874](https://github.com/ClickHouse/ClickHouse/pull/47874) ([Amos Bird](https://github.com/amosbird))。
* ThreadPools メトリクスの内部観測。 [#47880](https://github.com/ClickHouse/ClickHouse/pull/47880) ([Azat Khuzhin](https://github.com/azat)).
* `WriteBufferFromS3Microseconds` および `WriteBufferFromS3RequestsErrors` のプロファイルイベントを追加しました。 [#47885](https://github.com/ClickHouse/ClickHouse/pull/47885) ([Antonio Andelic](https://github.com/antonio2368))。
* ClickHouse のインストールに `--link` および `--noninteractive` (`-y`) オプションを追加。[#47750](https://github.com/ClickHouse/ClickHouse/issues/47750) をクローズ。[#47887](https://github.com/ClickHouse/ClickHouse/pull/47887)（[Nikolay Degterinsky](https://github.com/evillique)）。
* 利用不可能な依存テーブルを持つマテリアライズドビューにアタッチする際に発生していた `UNKNOWN_TABLE` 例外を修正しました。これはバックアップから状態を復元する際に役立つ可能性があります。 [#47975](https://github.com/ClickHouse/ClickHouse/pull/47975) ([MikhailBurdukov](https://github.com/MikhailBurdukov)).
* 暗号化ディスク構成にオプションの path が追加されていない場合の不具合を修正。 [#47981](https://github.com/ClickHouse/ClickHouse/pull/47981) ([Kseniia Sumarokova](https://github.com/kssenii)).
* パラメータ化ビューにおける CTE サポートの実装: スカラ値サブクエリを評価する際にクエリパラメータを許可するように更新しました。 [#48065](https://github.com/ClickHouse/ClickHouse/pull/48065) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
* 大きな整数型 `(U)Int128/(U)Int256`、任意のキー型を持つ `Map`、および任意の精度（3 および 6 に限定されない）の `DateTime64` をサポート。 [#48119](https://github.com/ClickHouse/ClickHouse/pull/48119) ([Kruglov Pavel](https://github.com/Avogar)).
* 行形式の入力フォーマットで未知の enum 値によるエラーをスキップできるようにしました。 [#48133](https://github.com/ClickHouse/ClickHouse/pull/48133) ([Alexey Milovidov](https://github.com/alexey-milovidov)).

#### ビルド／テスト／パッケージングの改善 {#buildtestingpackaging-improvement-9}
* ClickHouse は現在 `C++23` でビルドされます。 [#47424](https://github.com/ClickHouse/ClickHouse/pull/47424) ([Robert Schulze](https://github.com/rschu1ze)).
* AST Fuzzer で `EXPLAIN` クエリに対するファジングを実施。 [#47803](https://github.com/ClickHouse/ClickHouse/pull/47803) [#47852](https://github.com/ClickHouse/ClickHouse/pull/47852) ([flynn](https://github.com/ucasfl)).
* ストレステストと自動後方互換性チェック（現在は Upgrade チェック）を分離。 [#44879](https://github.com/ClickHouse/ClickHouse/pull/44879) ([Kruglov Pavel](https://github.com/Avogar)).
* 一部の誤った（誤検知の）セキュリティレポートを抑制するため、Docker 用の Ubuntu イメージを更新。 [#46784](https://github.com/ClickHouse/ClickHouse/pull/46784) ([Julio Jimenez](https://github.com/juliojimenez)). なお、ClickHouse にはランタイムの依存関係はなく、Docker を必要としません。
* ClickHouse を "curl | sh" でダウンロードする際、既存の `clickhouse` バイナリを上書きするかどうか削除の可否を確認するプロンプトを追加。プロンプトは "ClickHouse binary clickhouse already exists. Overwrite? \[y/N\]" です。 [#46859](https://github.com/ClickHouse/ClickHouse/pull/46859) ([Dan Roscigno](https://github.com/DanRoscigno)).
* 古いディストリビューション（例: Amazon Linux 2）および ARM 上で、glibc 2.28 のシンボルが見つからないためにサーバー起動時に発生していたエラーを修正。 [#47008](https://github.com/ClickHouse/ClickHouse/pull/47008) ([Robert Schulze](https://github.com/rschu1ze)).
* clang 16 への対応準備。 [#47027](https://github.com/ClickHouse/ClickHouse/pull/47027) ([Amos Bird](https://github.com/amosbird)).
* ARM 上で古い glibc でも ClickHouse が動作することを保証する CI チェックを追加。 [#47063](https://github.com/ClickHouse/ClickHouse/pull/47063) ([Robert Schulze](https://github.com/rschu1ze)).
* `NDEBUG` マクロの誤った使用を防ぐためのスタイルチェックを追加。 [#47699](https://github.com/ClickHouse/ClickHouse/pull/47699) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* ビルドを少し高速化。 [#47714](https://github.com/ClickHouse/ClickHouse/pull/47714) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `vectorscan` を 5.4.9 に更新。 [#47955](https://github.com/ClickHouse/ClickHouse/pull/47955) ([Robert Schulze](https://github.com/rschu1ze)).
* Apache Arrow の fatal ログ出力によってプロセスが abort しないことを検証するユニットテストを追加。これは [ClickHouse/arrow#16](https://github.com/ClickHouse/arrow/pull/16) の変更をカバーします。 [#47958](https://github.com/ClickHouse/ClickHouse/pull/47958) ([Arthur Passos](https://github.com/arthurpassos)).
* ネイティブな macOS 用デバッグサーバービルドが起動できるようにする機能を復元。 [#48050](https://github.com/ClickHouse/ClickHouse/pull/48050) ([Robert Schulze](https://github.com/rschu1ze)). 注: この変更は開発時にのみ関連があり、ClickHouse の公式ビルドはクロスコンパイルで実施されています。

#### バグ修正（公式安定版リリースにおけるユーザー可視の不具合） {#bug-fix-user-visible-misbehavior-in-an-official-stable-release-9}

* フォーマットパーサーがリセットされる問題を修正し、`Kafka` の不正メッセージ処理に関するテストを追加 [`#45693`](https://github.com/ClickHouse/ClickHouse/pull/45693)（[Kruglov Pavel](https://github.com/Avogar)）。
* Keeper におけるデータサイズの計算を修正 [#46086](https://github.com/ClickHouse/ClickHouse/pull/46086) ([Antonio Andelic](https://github.com/antonio2368))。
* `ReplicatedMergeTree` テーブルおよび `Atomic` データベースに対する `DROP TABLE` クエリの自動リトライ処理に存在したバグを修正しました。まれに、DROP の実行中に ZooKeeper セッションが期限切れとなり、ZooKeeper 上で同じパスを持つ新しいレプリケーテッドテーブルが並行して作成された場合に、`Can't get data for node /zk_path/log_pointer` や `The specified key does not exist` というエラーが発生することがありました。 [#46384](https://github.com/ClickHouse/ClickHouse/pull/46384) ([Alexander Tokmakov](https://github.com/tavplubix))。
* クエリの正規化中に発生していた誤ったエイリアスの再帰処理を修正し、一部のクエリが実行できなかった問題を解消しました。 [#46609](https://github.com/ClickHouse/ClickHouse/pull/46609) ([Raúl Marín](https://github.com/Algunenano)).
* バイナリ形式での IPv4/IPv6 のシリアライズ／デシリアライズを修正 [#46616](https://github.com/ClickHouse/ClickHouse/pull/46616) ([Kruglov Pavel](https://github.com/Avogar))。
* ActionsDAG: 最適化時に `and` の結果を変更しない [#46653](https://github.com/ClickHouse/ClickHouse/pull/46653) ([Salvatore Mesoraca](https://github.com/aiven-sal)).
* クライアントが異常終了した場合のクエリキャンセル処理を改善 [#46681](https://github.com/ClickHouse/ClickHouse/pull/46681) ([Alexander Tokmakov](https://github.com/tavplubix))。
* 集約最適化時の算術演算を修正 [#46705](https://github.com/ClickHouse/ClickHouse/pull/46705) ([Duc Canh Le](https://github.com/canhld94)).
* JSONEachRow スキーマ推論時に発生しうる `clickhouse-local` の異常終了を修正 [#46731](https://github.com/ClickHouse/ClickHouse/pull/46731) ([Kruglov Pavel](https://github.com/Avogar)).
* 期限切れのロールを変更する処理を修正 [#46772](https://github.com/ClickHouse/ClickHouse/pull/46772) ([Vitaly Baranov](https://github.com/vitlibar))。
* 複数ステップにまたがって結合された PREWHERE 列の集約処理を修正 [#46785](https://github.com/ClickHouse/ClickHouse/pull/46785) ([Alexander Gololobov](https://github.com/davenger)).
* HTTP 読み込みバッファでファイルサイズを取得する際に initial range を使用するようにしました。この変更がないと、一部のリモートファイルを処理できませんでした。 [#46824](https://github.com/ClickHouse/ClickHouse/pull/46824) ([Antonio Andelic](https://github.com/antonio2368)).
* URL テーブル使用時の誤った進行状況バーを修正 [#46830](https://github.com/ClickHouse/ClickHouse/pull/46830)（[Antonio Andelic](https://github.com/antonio2368)）。
* `maxIntersections` 関数での MSan 報告を修正 [#46847](https://github.com/ClickHouse/ClickHouse/pull/46847) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `Map` データ型のバグを修正 [#46856](https://github.com/ClickHouse/ClickHouse/pull/46856)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* LIKE パターンにクォート不能な文字がクォートされた状態で含まれている場合に、一部の LIKE 検索で誤った結果が返される問題を修正 [#46875](https://github.com/ClickHouse/ClickHouse/pull/46875) ([Robert Schulze](https://github.com/rschu1ze)).
* 修正 - WITH FILL が、Filling Transform による空ブロック処理時にアボートを引き起こす問題を修正 [#46897](https://github.com/ClickHouse/ClickHouse/pull/46897) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* JSON 内の文字列からの日付および int 型の推論を修正 [#46972](https://github.com/ClickHouse/ClickHouse/pull/46972) ([Kruglov Pavel](https://github.com/Avogar))。
* フェッチ時のゼロコピーレプリケーションにおけるディスク選択のバグを修正 [#47010](https://github.com/ClickHouse/ClickHouse/pull/47010) ([alesapin](https://github.com/alesapin))。
* systemd サービス定義のタイプミスを修正 [#47051](https://github.com/ClickHouse/ClickHouse/pull/47051) ([Palash Goel](https://github.com/palash-goel))。
* CROSS JOIN で algorithm = auto を使用した際に発生する NOT&#95;IMPLEMENTED エラーを修正 [#47068](https://github.com/ClickHouse/ClickHouse/pull/47068) ([Vladimir C](https://github.com/vdimir))。
* &#39;part&#95;type&#39; が実験的機能である &#39;InMemory&#39; モードに設定されている場合に、&#39;ReplicatedMergeTree&#39; テーブルが類似した 2 件のデータの挿入に失敗する問題を修正します。[#47121](https://github.com/ClickHouse/ClickHouse/pull/47121) ([liding1992](https://github.com/liding1992)).
* 外部辞書 / library-bridge: エラー「unknown library method &#39;extDict&#95;libClone&#39;」を修正 [#47136](https://github.com/ClickHouse/ClickHouse/pull/47136)（[alex filatov](https://github.com/phil-88)）。
* LIMIT を伴う Grace Hash 結合における競合状態を修正 [#47153](https://github.com/ClickHouse/ClickHouse/pull/47153) ([Vladimir C](https://github.com/vdimir)).
* 実際のカラムに対する PREWHERE サポートを修正 [#47154](https://github.com/ClickHouse/ClickHouse/pull/47154) ([Azat Khuzhin](https://github.com/azat))。
* Query Status で発生する可能性のあるデッドロックを修正 [#47161](https://github.com/ClickHouse/ClickHouse/pull/47161) ([Kruglov Pavel](https://github.com/Avogar))。
* デッドロックを引き起こすため、同じ `Join` テーブルに対する INSERT SELECT を禁止しました [#47260](https://github.com/ClickHouse/ClickHouse/pull/47260) ([Vladimir C](https://github.com/vdimir))。
* `min_age_to_force_merge_seconds` によるマージで、すでにマージ済みのパーティションをスキップするようにしました [#47303](https://github.com/ClickHouse/ClickHouse/pull/47303) ([Antonio Andelic](https://github.com/antonio2368)).
* find&#95;first&#95;not&#95;symbols に対して期待どおりに動作するよう find&#95;first&#95;symbols を修正しました [#47304](https://github.com/ClickHouse/ClickHouse/pull/47304) ([Arthur Passos](https://github.com/arthurpassos)).
* CSV における大きな数値の型推論を修正 [#47410](https://github.com/ClickHouse/ClickHouse/pull/47410) ([Kruglov Pavel](https://github.com/Avogar))。
* エイリアス付きの式に対する論理式オプティマイザを無効化しました。 [#47451](https://github.com/ClickHouse/ClickHouse/pull/47451) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* `decodeURLComponent` のエラーを修正 [#47457](https://github.com/ClickHouse/ClickHouse/pull/47457) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* projection を含む EXPLAIN グラフを修正 [#47473](https://github.com/ClickHouse/ClickHouse/pull/47473) ([flynn](https://github.com/ucasfl)).
* クエリパラメータの不具合を修正 [#47488](https://github.com/ClickHouse/ClickHouse/pull/47488)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* パラメータ化ビュー：バグを修正。 [#47495](https://github.com/ClickHouse/ClickHouse/pull/47495) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* データフォーマット用ファザーと、それに対応する修正。 [#47519](https://github.com/ClickHouse/ClickHouse/pull/47519) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `DateTime64` の単調性チェックを修正。[#47526](https://github.com/ClickHouse/ClickHouse/pull/47526)（[Antonio Andelic](https://github.com/antonio2368)）。
* Nullable LowCardinality 列における「block structure mismatch」を修正 [#47537](https://github.com/ClickHouse/ClickHouse/pull/47537) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* Apache Parquet のバグに対する根本的な修正 [#45878](https://github.com/ClickHouse/ClickHouse/issues/45878) [#47538](https://github.com/ClickHouse/ClickHouse/pull/47538) ([Kruglov Pavel](https://github.com/Avogar))。
* ドキュメントサイズが不正な場合に `BSONEachRow` の並列パースが失敗する問題を修正 [#47540](https://github.com/ClickHouse/ClickHouse/pull/47540) ([Kruglov Pavel](https://github.com/Avogar)).
* `SYSTEM FLUSH DISTRIBUTED` 実行時に `system.distribution_queue` 内のエラーを保持するようにしました [#47541](https://github.com/ClickHouse/ClickHouse/pull/47541) ([Azat Khuzhin](https://github.com/azat)).
* `BSONEachRow` フォーマットで重複列をチェックするようにしました [#47609](https://github.com/ClickHouse/ClickHouse/pull/47609) ([Kruglov Pavel](https://github.com/Avogar))。
* ムーブ操作中のゼロコピーロック待機の問題を修正 [#47631](https://github.com/ClickHouse/ClickHouse/pull/47631) ([alesapin](https://github.com/alesapin))。
* パーティション単位の集約を修正 [#47634](https://github.com/ClickHouse/ClickHouse/pull/47634) ([Nikita Taranov](https://github.com/nickitat))。
* `BSONEachRow` フォーマットにおけるタプルを配列としてシリアル化する処理のバグを修正 [#47690](https://github.com/ClickHouse/ClickHouse/pull/47690) ([Kruglov Pavel](https://github.com/Avogar))。
* `polygonsSymDifferenceCartesian` のクラッシュを修正 [#47702](https://github.com/ClickHouse/ClickHouse/pull/47702) ([pufit](https://github.com/pufit))。
* ストレージ `File` からの、`zlib` および `gzip` で圧縮されたファイルの読み取りを修正 [#47796](https://github.com/ClickHouse/ClickHouse/pull/47796) ([Anton Popov](https://github.com/CurtizJ))。
* PostgreSQL の空クエリ検出を改善 (pgx Go 言語ドライバ向け) [#47854](https://github.com/ClickHouse/ClickHouse/pull/47854) ([Azat Khuzhin](https://github.com/azat)).
* LowCardinality 型の DateTime 単調性チェックを修正 [#47860](https://github.com/ClickHouse/ClickHouse/pull/47860) ([Antonio Andelic](https://github.com/antonio2368))。
* RESTORE ASYNC では backup&#95;threads ではなく restore&#95;threads を使用するようにしました [#47861](https://github.com/ClickHouse/ClickHouse/pull/47861) ([Azat Khuzhin](https://github.com/azat))。
* 投影を含む ReplicatedMergeTree テーブルでの `DROP COLUMN` の問題を修正 [#47883](https://github.com/ClickHouse/ClickHouse/pull/47883) ([Antonio Andelic](https://github.com/antonio2368))。
* Replicated データベース復旧の修正 [#47901](https://github.com/ClickHouse/ClickHouse/pull/47901) ([Alexander Tokmakov](https://github.com/tavplubix)).
* HTTP における冗長すぎる警告メッセージに対するホットフィックス [#47903](https://github.com/ClickHouse/ClickHouse/pull/47903) ([Alexander Tokmakov](https://github.com/tavplubix))。
* `catboostEvaluate` 内で発生する &quot;Field value too long&quot; の問題を修正 [#47970](https://github.com/ClickHouse/ClickHouse/pull/47970) ([Robert Schulze](https://github.com/rschu1ze)).
* [#36971](https://github.com/ClickHouse/ClickHouse/issues/36971) を修正: Watchdog: 子プロセスが終了した場合に非ゼロの終了コードで終了するようにする [#47973](https://github.com/ClickHouse/ClickHouse/pull/47973)（[Коренберг Марк](https://github.com/socketpair)）。
* &quot;index file `cidx` is unexpectedly long&quot; エラーの修正 [#48010](https://github.com/ClickHouse/ClickHouse/pull/48010) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* MaterializedPostgreSQL のクエリを修正し、属性（replica-identity）を取得できるようにしました [#48015](https://github.com/ClickHouse/ClickHouse/pull/48015) ([Solomatov Sergei](https://github.com/solomatovs))。
* parseDateTime(): UB（符号付き整数オーバーフローによる未定義動作）を修正 [#48019](https://github.com/ClickHouse/ClickHouse/pull/48019) ([Robert Schulze](https://github.com/rschu1ze)).
* スキーマの再利用を避けるため、Avro のレコードには一意の名前を使用するようにしました [#48057](https://github.com/ClickHouse/ClickHouse/pull/48057) ([Kruglov Pavel](https://github.com/Avogar))。
* Keeper において TCP/HTTP ソケットのタイムアウトが正しく設定されるように修正 [#48108](https://github.com/ClickHouse/ClickHouse/pull/48108) ([Antonio Andelic](https://github.com/antonio2368))。
* `Avro` フォーマットでのヌルポインタへのメンバー呼び出しが発生する可能性を修正 [#48184](https://github.com/ClickHouse/ClickHouse/pull/48184) ([Kruglov Pavel](https://github.com/Avogar)).

### <a id="232"></a> ClickHouse リリース 23.2, 2023-02-23 {#232}

#### 後方互換性のない変更 {#backward-incompatible-change-8}
* 関数 "toDayOfWeek()"（エイリアス: "DAYOFWEEK"）を拡張し、週の開始曜日（Monday または Sunday）と、カウントを 0 または 1 から開始するかどうかを表す mode 引数を追加しました。他の日時関数との一貫性を保つため、mode 引数は time 引数と time zone 引数の間に挿入されました。これにより、既存の（これまでドキュメント化されていなかった）2 引数構文 "toDayOfWeek(time, time_zone)" の使用は動作しなくなります。修正方法としては、関数を "toDayOfWeek(time, 0, time_zone)" に書き換えてください。 [#45233](https://github.com/ClickHouse/ClickHouse/pull/45233) ([Robert Schulze](https://github.com/rschu1ze)).
* 設定 `max_query_cache_size` の名称を `filesystem_cache_max_download_size` に変更しました。 [#45614](https://github.com/ClickHouse/ClickHouse/pull/45614) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `default` ユーザーは、デフォルトではアクセス種別 `SHOW NAMED COLLECTION` への権限を持たなくなりました（例: これまでのように `default` ユーザーが他のユーザーに対して ALL を GRANT することはできなくなります。そのため、この PR は後方互換性がありません）。 [#46010](https://github.com/ClickHouse/ClickHouse/pull/46010) ([Kseniia Sumarokova](https://github.com/kssenii)).
* SETTINGS 句が FORMAT 句より前に指定されている場合、その設定はフォーマットにも適用されます。 [#46003](https://github.com/ClickHouse/ClickHouse/pull/46003) ([Azat Khuzhin](https://github.com/azat)).
* 設定 `materialized_postgresql_allow_automatic_update` のサポートを削除しました（これはデフォルトで無効になっていました）。 [#46106](https://github.com/ClickHouse/ClickHouse/pull/46106) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 実運用に近いデータセットにおける `countDigits` のパフォーマンスをわずかに改善しました。これにより [#44518](https://github.com/ClickHouse/ClickHouse/issues/44518) がクローズされました。以前のバージョンでは `countDigits(0)` は `0` を返していましたが、現在は `1` を返すようになり、より正しく、既存のドキュメントにも従う動作になりました。 [#46187](https://github.com/ClickHouse/ClickHouse/pull/46187) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* コーデック "Delta" または "DoubleDelta" に続けて "Gorilla" または "FPC" を組み合わせた圧縮を行う新しいカラムの作成を禁止しました。これは設定 "allow_suspicious_codecs = true" を使用することで回避できます。 [#45652](https://github.com/ClickHouse/ClickHouse/pull/45652) ([Robert Schulze](https://github.com/rschu1ze)).

#### 新機能 {#new-feature-10}

* S3 上の Iceberg テーブルストアにアクセスするために、`StorageIceberg` とテーブル関数 `iceberg` を追加しました。 [#45384](https://github.com/ClickHouse/ClickHouse/pull/45384) ([flynn](https://github.com/ucasfl)).
* ストレージの設定で `storage_policy` の代わりに `SETTINGS disk = '<disk_name>'` を使用できるようにし、さらに `SETTINGS disk = disk(type=s3, ...)` によるディスクの明示的な作成も可能にしました。[#41976](https://github.com/ClickHouse/ClickHouse/pull/41976) ([Kseniia Sumarokova](https://github.com/kssenii))。
* `system.part_log` で `ProfileEvents` カウンタを利用できるようにしました。[#38614](https://github.com/ClickHouse/ClickHouse/pull/38614) ([Bharat Nallan](https://github.com/bharatnc)).
* 既存の `ReplacingMergeTree` エンジンを拡張し、重複データの挿入を許可できるようにしました。これにより、1つの MergeTree エンジンで `ReplacingMergeTree` と `CollapsingMergeTree` の両方の機能を活用できます。削除されたデータはクエリ実行時には返されませんが、ディスクから物理的に削除されるわけではありません。[#41005](https://github.com/ClickHouse/ClickHouse/pull/41005)（[youennL-cs](https://github.com/youennL-cs)）。
* `generateULID` 関数を追加し、[#36536](https://github.com/ClickHouse/ClickHouse/issues/36536) をクローズ。 [#44662](https://github.com/ClickHouse/ClickHouse/pull/44662)（[Nikolay Degterinsky](https://github.com/evillique)）。
* `corrMatrix` 集約関数を追加し、各列ペア間の相関を計算します。さらに、集約関数 `covarSamp` と `covarPop` は `corr` と類似しているため、あわせて `covarSampMatrix` と `covarPopMatrix` も追加しました。@alexey-milovidov により [#44587](https://github.com/ClickHouse/ClickHouse/issues/44587) がクローズされました。 [#44680](https://github.com/ClickHouse/ClickHouse/pull/44680) ([FFFFFFFHHHHHHH](https://github.com/FFFFFFFHHHHHHH)).
* ランダムに配列を並べ替える arrayShuffle 関数を追加。 [#45271](https://github.com/ClickHouse/ClickHouse/pull/45271) ([Joanna Hulboj](https://github.com/jh0x)).
* Arrow の `FIXED_SIZE_BINARY` 型および `Parquet` の `FIXED_LENGTH_BYTE_ARRAY` 型をサポートし、それらを `FixedString` にマッピングしました。`FixedString` のデフォルトの出力型を制御するために、`output_format_parquet_fixed_string_as_fixed_byte_array/output_format_arrow_fixed_string_as_fixed_byte_array` 設定を追加しました。[#45326](https://github.com/ClickHouse/ClickHouse/issues/45326) をクローズしました。[#45340](https://github.com/ClickHouse/ClickHouse/pull/45340)（[Kruglov Pavel](https://github.com/Avogar)）。
* system.replication&#95;queue に新しいカラム `last_exception_time` を追加。 [#45457](https://github.com/ClickHouse/ClickHouse/pull/45457) ([Frank Chen](https://github.com/FrankChen021)).
* SipHash{64,128} に対してユーザー定義のキー/シードを指定できる新しい関数を 2 つ追加しました。 [#45513](https://github.com/ClickHouse/ClickHouse/pull/45513) ([Salvatore Mesoraca](https://github.com/aiven-sal))。
* テーブル関数 `format` の 3 引数版をサポート。[#45808](https://github.com/ClickHouse/ClickHouse/issues/45808) をクローズ。 [#45873](https://github.com/ClickHouse/ClickHouse/pull/45873)（[FFFFFFFHHHHHHH](https://github.com/FFFFFFFHHHHHHH)）。
* `JodaTime` フォーマットにおける &#39;x&#39;,&#39;w&#39;,&#39;S&#39; のサポートを追加しました。 [https://joda-time.sourceforge.net/apidocs/org/joda/time/format/DateTimeFormat.html](https://joda-time.sourceforge.net/apidocs/org/joda/time/format/DateTimeFormat.html) を参照してください。 [#46073](https://github.com/ClickHouse/ClickHouse/pull/46073) ([zk&#95;kiger](https://github.com/zk-kiger))。
* ウィンドウ関数 `ntile` をサポートしました。([lgbo](https://github.com/lgbo-ustc))
* すべてのテーブルに `FINAL` 修飾子が暗黙的に適用されるようにする設定 `final` を追加。[#40945](https://github.com/ClickHouse/ClickHouse/pull/40945)（[Arthur Passos](https://github.com/arthurpassos)）。
* `arrayPartialSort` 関数と `arrayPartialReverseSort` 関数を追加しました。[#46296](https://github.com/ClickHouse/ClickHouse/pull/46296) ([Joanna Hulboj](https://github.com/jh0x)).
* 新しい HTTP パラメータ `client_protocol_version` により、Native フォーマットを使用する HTTP レスポンスのクライアントプロトコルバージョンを設定できるようになりました。 [#40397](https://github.com/ClickHouse/ClickHouse/issues/40397)。 [#46360](https://github.com/ClickHouse/ClickHouse/pull/46360) ([Geoff Genz](https://github.com/genzgd))。
* Spark の関数 `REGEXP_EXTRACT` との互換性のため、新しい関数 `regexpExtract` を追加しました。既存の関数 `extract` と類似しています。 [#46469](https://github.com/ClickHouse/ClickHouse/pull/46469) ([李扬](https://github.com/taiyang-li)).
* 新しい関数 `JSONArrayLength` を追加しました。最外層の JSON 配列内の要素数を返します。入力された JSON 文字列が不正な場合は NULL を返します。 [#46631](https://github.com/ClickHouse/ClickHouse/pull/46631) ([李扬](https://github.com/taiyang-li)).



#### パフォーマンスの向上 {#performance-improvement-10}

* 導入されたロジックは、PREWHERE 条件が複数の条件（cond1 AND cond2 AND ...）の論理積で構成されている場合に動作します。同じカラムを読み取る必要がある条件同士をステップとしてグループ化します。各ステップの後に、全体の条件の対応する部分が計算され、その結果行がフィルタリングされる場合があります。これにより、次のステップで読み取る行数を減らすことができ、I/O 帯域を節約し、計算量を削減できます。このロジックは現時点ではデフォルトで無効です。回帰がないことが確認され次第、将来のリリースでデフォルトで有効化される予定のため、テスト用途での利用が強く推奨されます。これは 2 つの設定で制御できます: &quot;enable&#95;multiple&#95;prewhere&#95;read&#95;steps&quot; と &quot;move&#95;all&#95;conditions&#95;to&#95;prewhere&quot; です。 [#46140](https://github.com/ClickHouse/ClickHouse/pull/46140) ([Alexander Gololobov](https://github.com/davenger))。
* テーブルのパーティションキーと GROUP BY キーが互換性がある場合に、パーティションを個別に集約できるオプションが追加されました。設定 `allow_aggregate_partitions_independently` で制御されます。適用可能なケースが限られているため（詳細はドキュメントを参照してください）、デフォルトでは無効になっています。 [#45364](https://github.com/ClickHouse/ClickHouse/pull/45364) ([Nikita Taranov](https://github.com/nickitat))。
* Compact 形式のパーツに対して Vertical merge アルゴリズムを使用できるようにしました。これにより、ClickHouse サーバーはバックグラウンド処理時に使用するメモリを大幅に削減できます。[#46084](https://github.com/ClickHouse/ClickHouse/issues/46084) をクローズしました。[#45681](https://github.com/ClickHouse/ClickHouse/pull/45681) [#46282](https://github.com/ClickHouse/ClickHouse/pull/46282) ([Anton Popov](https://github.com/CurtizJ))。
* バッチリーダーを使用することで `Parquet` リーダーを最適化。 [#45878](https://github.com/ClickHouse/ClickHouse/pull/45878) ([LiuNeng](https://github.com/liuneng1994)).
* Linux の非同期サブシステム [io&#95;uring](https://kernel.dk/io_uring.pdf) に基づく新しい `local_filesystem_read_method` の方式 `io_uring` を追加し、デフォルトの `pread` 方式と比較して、ほぼあらゆるケースで読み取りパフォーマンスを向上させました。 [#38456](https://github.com/ClickHouse/ClickHouse/pull/38456) ([Saulius Valatka](https://github.com/sauliusvl))。
* 論理的に等価である場合、引数として `if` 式を取る集約関数を書き換えます。たとえば、`avg(if(cond, col, null))` は `avgIf(cond, col)` に書き換えることができます。これはパフォーマンスの向上に役立ちます。 [#44730](https://github.com/ClickHouse/ClickHouse/pull/44730) ([李扬](https://github.com/taiyang-li))。
* AVX-512 命令を使用して lower/upper 関数のパフォーマンスを向上しました。 [#37894](https://github.com/ClickHouse/ClickHouse/pull/37894) ([yaqi-zhao](https://github.com/yaqi-zhao)).
* SMT を無効化した状態でコア数が 32 以上のシステムにおいて、ClickHouse がコア数の半分しか使用しないという制約を解除しました（BIOS で Hyper-Threading を無効化した場合）。 [#44973](https://github.com/ClickHouse/ClickHouse/pull/44973) ([Robert Schulze](https://github.com/rschu1ze))。
* 関数 `multiIf` をカラムナ実行に対応させることでパフォーマンスを向上し、2.3倍高速化しました。 [#45296](https://github.com/ClickHouse/ClickHouse/pull/45296) ([李扬](https://github.com/taiyang-li)).
* `position` 関数で、検索文字列が空文字列の場合の高速パスを追加しました。 [#45382](https://github.com/ClickHouse/ClickHouse/pull/45382) ([李扬](https://github.com/taiyang-li)).
* `query_plan_remove_redundant_sorting` 最適化をデフォルトで有効にしました。この最適化は [#45420](https://github.com/ClickHouse/ClickHouse/issues/45420) で実装されました。[#45567](https://github.com/ClickHouse/ClickHouse/pull/45567)（[Igor Nikonov](https://github.com/devcrafter)）。
* HTTP インターフェイスを使用する大規模クエリのパフォーマンスを向上させるため、HTTP Transfer Encoding のチャンクサイズを拡大しました。 [#45593](https://github.com/ClickHouse/ClickHouse/pull/45593) ([Geoff Genz](https://github.com/genzgd)).
* 多数の `Array` / `Map` / `Nested` カラムを持つテーブルを読み取る短い `SELECT` クエリのパフォーマンスを改善しました。 [#45630](https://github.com/ClickHouse/ClickHouse/pull/45630) ([Anton Popov](https://github.com/CurtizJ)).
* 大きな整数値および Decimal 型のフィルタリング性能を改善。 [#45949](https://github.com/ClickHouse/ClickHouse/pull/45949) ([李扬](https://github.com/taiyang-li))。
* この変更により、ColumnNullable(UInt8) からフィルタを取得する際のオーバーヘッドを効果的に削減し、クエリ全体のパフォーマンスを向上させることができます。この変更の影響を評価するために、TPC-H ベンチマークを用い、カラム型を非 NULL 型から NULL 許容型に変更したうえで、そのクエリの QPS をパフォーマンス指標として計測しました。 [#45962](https://github.com/ClickHouse/ClickHouse/pull/45962) ([Zhiguo Zhou](https://github.com/ZhiguoZh))。
* `_part` と `_partition_id` の仮想カラムを `LowCardinality(String)` 型にしました。[#45964](https://github.com/ClickHouse/ClickHouse/issues/45964) をクローズします。[#45975](https://github.com/ClickHouse/ClickHouse/pull/45975)（[flynn](https://github.com/ucasfl)）。
* スケールが変わらない場合の Decimal 変換のパフォーマンスを改善しました。 [#46095](https://github.com/ClickHouse/ClickHouse/pull/46095) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 読み取り時のデータプリフェッチ量を増やせるようにしました。 [#46168](https://github.com/ClickHouse/ClickHouse/pull/46168) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `arrayExists(x -> x = 1, arr)` を `has(arr, 1)` に書き換えることで、パフォーマンスが 1.34 倍向上します。 [#46188](https://github.com/ClickHouse/ClickHouse/pull/46188) ([李扬](https://github.com/taiyang-li))。
* リモートディスク以外での vertical merge による過剰なメモリ使用量を修正しました。リモートディスクでは `max_insert_delayed_streams_for_parallel_write` 設定が適用されるようにしました。[#46275](https://github.com/ClickHouse/ClickHouse/pull/46275) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* zstd を v1.5.4 に更新しました。パフォーマンスと圧縮率が若干改善されています。異なるバージョンの ClickHouse を実行しているレプリカがある場合、説明付きで `Data after merge/mutation is not byte-identical to data on another replicas.` のような妥当なエラーメッセージが表示されることがあります。これらのメッセージは想定内であり、心配する必要はありません。[#46280](https://github.com/ClickHouse/ClickHouse/pull/46280) ([Raúl Marín](https://github.com/Algunenano))。
* [#39737](https://github.com/ClickHouse/ClickHouse/issues/39737) に起因する性能劣化を修正。[#46309](https://github.com/ClickHouse/ClickHouse/pull/46309)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `replicas_status` ハンドルは、レプリケーションキューが大きい場合でも高速に応答します。 [#46310](https://github.com/ClickHouse/ClickHouse/pull/46310) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 集約関数 `sum`、単項算術関数、および比較関数に AVX-512 のサポートを追加。 [#37870](https://github.com/ClickHouse/ClickHouse/pull/37870) ([zhao zhou](https://github.com/zzachimed))。
* マークの分布および読み取り処理全体の調整に関するコードを書き直し、パフォーマンスを最大限に向上させました。これにより [#34527](https://github.com/ClickHouse/ClickHouse/issues/34527) が解決されました。[#43772](https://github.com/ClickHouse/ClickHouse/pull/43772)（[Nikita Mikhaylov](https://github.com/nikitamikhaylov)）。
* クエリ（サブクエリ）内の冗長な DISTINCT 句を削除します。クエリプランの上で実装されています。DISTINCT 句に関しては、`optimize_duplicate_order_by_and_distinct` と同様の最適化を行います。`query_plan_remove_redundant_distinct` 設定で有効にできます。[#42648](https://github.com/ClickHouse/ClickHouse/issues/42648) に関連。[#44176](https://github.com/ClickHouse/ClickHouse/pull/44176)（[Igor Nikonov](https://github.com/devcrafter)）。
* クエリの書き換え最適化をいくつか追加：`sumIf(123, cond) -> 123 * countIf(1, cond)`, `sum(if(cond, 123, 0)) -> 123 * countIf(cond)`, `sum(if(cond, 0, 123)) -> 123 * countIf(not(cond))` [#44728](https://github.com/ClickHouse/ClickHouse/pull/44728)（[李扬](https://github.com/taiyang-li)）。
* メモリ制約付きマージおよび順序付き集約と、トップレベルのクエリプランとの相互作用を改善しました。以前は、実際には不要な場合でも、いくつかのケースで AIO のために明示的なソートにフォールバックしていました。 [#45892](https://github.com/ClickHouse/ClickHouse/pull/45892) ([Nikita Taranov](https://github.com/nickitat))。
* 同時マージは、公平で飢餓の発生しない動作を保証するため、デフォルトでラウンドロビン方式でスケジューリングされます。以前は、過負荷状態のシャードでは、厳格な優先度ベースのスケジューリングを使用していたため、大きなマージが小さなマージによって飢餓状態に陥る可能性がありました。スケジューリングアルゴリズム（`round_robin` または `shortest_task_first`）を選択できるようにするため、サーバー設定オプション `background_merges_mutations_scheduling_policy` を追加しました。 [#46247](https://github.com/ClickHouse/ClickHouse/pull/46247) ([Sergei Trifonov](https://github.com/serxa))。



#### 改善 {#improvement-10}

* ZooKeeper セッションの喪失時に備えて、INSERT 操作の再試行をデフォルトで有効にしました。これはすでに本番環境で利用しています。 [#46308](https://github.com/ClickHouse/ClickHouse/pull/46308) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* 名前付きタプルに対して、JSON オブジェクト内の不明なキーを無視できるようにしました（`input_format_json_ignore_unknown_keys_in_named_tuple`）。[#45678](https://github.com/ClickHouse/ClickHouse/pull/45678)（[Azat Khuzhin](https://github.com/azat)）。
* `final` 付きのクエリに対して、ソートキーの式を `where` 句から `prewhere` に移動して最適化できるようにサポート。 [#38893](https://github.com/ClickHouse/ClickHouse/issues/38893). [#38950](https://github.com/ClickHouse/ClickHouse/pull/38950) ([hexiaoting](https://github.com/hexiaoting)).
* バックアップ用の新しいメトリクスを追加しました: num&#95;processed&#95;files と processed&#95;files&#95;size は、実際に処理されたファイルの数とサイズを表します。 [#42244](https://github.com/ClickHouse/ClickHouse/pull/42244) ([Aleksandr](https://github.com/AVMusorin))。
* サーバ間の DNS エラー発生時に再試行処理を追加しました。 [#43179](https://github.com/ClickHouse/ClickHouse/pull/43179) ([Anton Kozlov](https://github.com/tonickkozlov)).
* Keeper の改善: 予期しないディスク空き容量不足の問題を回避するため、ディスク上の領域を事前に確保するようになりました。Keeper の Raft ログファイルの最大サイズを指定する設定 `max_log_file_size` を導入しました。 [#44370](https://github.com/ClickHouse/ClickHouse/pull/44370) ([Antonio Andelic](https://github.com/antonio2368)).
* 読み取り専用のレプリカにおける replica delay API ロジックの挙動を最適化しました。 [#45148](https://github.com/ClickHouse/ClickHouse/pull/45148) ([mateng915](https://github.com/mateng0915)).
* 空のパスワードが間違っている場合には、clickhouse-client で対話的にパスワードを要求するようにしました。[#46702](https://github.com/ClickHouse/ClickHouse/issues/46702) をクローズしました。[#46730](https://github.com/ClickHouse/ClickHouse/pull/46730)（[Nikolay Degterinsky](https://github.com/evillique)）。
* `Float*` 型以外のカラムで `Gorilla` 圧縮が使用されている場合、それを不審なものとしてマークします。 [#45376](https://github.com/ClickHouse/ClickHouse/pull/45376) ([Robert Schulze](https://github.com/rschu1ze)).
* マージを実行しているレプリカの名前を `postpone_reason` 列に表示するようにしました。 [#45458](https://github.com/ClickHouse/ClickHouse/pull/45458) ([Frank Chen](https://github.com/FrankChen021))。
* part&#95;log に例外のスタックトレースを保存。 [#45459](https://github.com/ClickHouse/ClickHouse/pull/45459) ([Frank Chen](https://github.com/FrankChen021)).
* `regexp_tree` 辞書が改善され、[https://github.com/ua-parser/uap-core](https://github.com/ua-parser/uap-core) と互換性を持つようになりました。[#45631](https://github.com/ClickHouse/ClickHouse/pull/45631)（[Han Fei](https://github.com/hanfei1991)）。
* `SYSTEM SYNC REPLICA` のチェック方法を更新し、[#45508](https://github.com/ClickHouse/ClickHouse/issues/45508) [#45648](https://github.com/ClickHouse/ClickHouse/pull/45648) を解決しました（[SmitaRKulkarni](https://github.com/SmitaRKulkarni)）。
* 設定 `replication_alter_partitions_sync` の名前を `alter_sync` に変更しました。 [#45659](https://github.com/ClickHouse/ClickHouse/pull/45659) ([Antonio Andelic](https://github.com/antonio2368)).
* `generateRandom` テーブル関数とエンジンが `LowCardinality` データ型をサポートするようになりました。これはテストに有用で、例えば `INSERT INTO table SELECT * FROM generateRandom() LIMIT 1000` のようなクエリを書けます。これは [#45590](https://github.com/ClickHouse/ClickHouse/issues/45590) をデバッグするために必要です。[#45661](https://github.com/ClickHouse/ClickHouse/pull/45661)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 実験的なクエリ結果キャッシュは、よりモジュール性の高い設定オプションを提供するようになりました。 [#45679](https://github.com/ClickHouse/ClickHouse/pull/45679) ([Robert Schulze](https://github.com/rschu1ze)).
* &quot;query result cache&quot; を &quot;query cache&quot; に名称変更しました。 [#45682](https://github.com/ClickHouse/ClickHouse/pull/45682) ([Robert Schulze](https://github.com/rschu1ze)).
* `SYSTEM SYNC FILE CACHE` コマンドを追加。これにより `sync` システムコールが実行される。[#8921](https://github.com/ClickHouse/ClickHouse/issues/8921)。[#45685](https://github.com/ClickHouse/ClickHouse/pull/45685) ([DR](https://github.com/freedomDR))。
* 新しい S3 設定 `allow_head_object_request` を追加しました。この PR により、[https://github.com/ClickHouse/ClickHouse/pull/45288](https://github.com/ClickHouse/ClickHouse/pull/45288) で導入された、`HeadObject` の代わりに `GetObjectAttributes` リクエストを使用する挙動をオプション化し（デフォルトでは無効）、切り替え可能にしました。[#45701](https://github.com/ClickHouse/ClickHouse/pull/45701)（[Vitaly Baranov](https://github.com/vitlibar)）。
* 接続名に基づいて接続設定を上書きできる機能を追加しました（つまり、各接続ごとにパスワードを保存しておく必要はなくなり、すべてを `~/.clickhouse-client/config.xml` にまとめて記述できるようになりました。また、接続ごとに異なる履歴ファイルを使用することもでき、これも有用な場合があります）。[#45715](https://github.com/ClickHouse/ClickHouse/pull/45715)（[Azat Khuzhin](https://github.com/azat)）。
* Arrow 形式: duration 型をサポートしました。[#45669](https://github.com/ClickHouse/ClickHouse/issues/45669) をクローズ。[#45750](https://github.com/ClickHouse/ClickHouse/pull/45750) ([flynn](https://github.com/ucasfl)).
* キャッシュ動作の調査を改善するために、Query Cache のログ出力を拡充しました。 [#45751](https://github.com/ClickHouse/ClickHouse/pull/45751) ([Robert Schulze](https://github.com/rschu1ze)).
* クエリキャッシュのサーバーレベルの設定が、実行時に動的に変更できるようになりました。 [#45758](https://github.com/ClickHouse/ClickHouse/pull/45758) ([Robert Schulze](https://github.com/rschu1ze)).
* テーブル関数の引数を名前付きコレクションで指定した場合に、ログ内のパスワードをマスクするようにしました。 [#45774](https://github.com/ClickHouse/ClickHouse/pull/45774) ([Vitaly Baranov](https://github.com/vitlibar)).
* 内部の S3 クライアントを改善し、さまざまな種類の URL に対してリージョンとリダイレクトを正しく判別できるようにしました。 [#45783](https://github.com/ClickHouse/ClickHouse/pull/45783) ([Antonio Andelic](https://github.com/antonio2368)).
* generateRandom 関数に Map、IPv4、IPv6 型のサポートを追加しました。主にテスト用途に有用です。 [#45785](https://github.com/ClickHouse/ClickHouse/pull/45785) ([Raúl Marín](https://github.com/Algunenano)).
* IP 型で empty/notEmpty をサポート。 [#45799](https://github.com/ClickHouse/ClickHouse/pull/45799) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* カラム `num_processed_files` は 2 つのカラム、`num_files`（BACKUP 用）と `files_read`（RESTORE 用）に分割されました。カラム `processed_files_size` は 2 つのカラム、`total_size`（BACKUP 用）と `bytes_read`（RESTORE 用）に分割されました。 [#45800](https://github.com/ClickHouse/ClickHouse/pull/45800) ([Vitaly Baranov](https://github.com/vitlibar))。
* MySQL 互換性のために `SHOW ENGINES` クエリのサポートを追加しました。 [#45859](https://github.com/ClickHouse/ClickHouse/pull/45859) ([Filatenkov Artur](https://github.com/FArthur-cmd)).
* 難読化ツールによるクエリの扱いを改善しました。 [#45867](https://github.com/ClickHouse/ClickHouse/pull/45867) ([Raúl Marín](https://github.com/Algunenano)).
* 境界値 65535 (2149-06-06) の Date 型への変換時の挙動を改善。 [#46042](https://github.com/ClickHouse/ClickHouse/pull/46042) [#45914](https://github.com/ClickHouse/ClickHouse/pull/45914) ([Joanna Hulboj](https://github.com/jh0x)).
* `DROP TABLE` 時に参照の依存関係をチェックするための設定 `check_referential_table_dependencies` を追加しました。この PR は [#38326](https://github.com/ClickHouse/ClickHouse/issues/38326) を解決しました。 [#45936](https://github.com/ClickHouse/ClickHouse/pull/45936)（[Vitaly Baranov](https://github.com/vitlibar)）。
* 引数が `Null` の場合に `Null` を返すように `tupleElement` を修正しました。[#45894](https://github.com/ClickHouse/ClickHouse/issues/45894) をクローズ。[#45952](https://github.com/ClickHouse/ClickHouse/pull/45952)（[flynn](https://github.com/ucasfl)）。
* S3 ワイルドカードに一致するファイルが 1 件も存在しない場合にエラーをスローするようにしました。[#45587](https://github.com/ClickHouse/ClickHouse/issues/45587) をクローズ。[#45957](https://github.com/ClickHouse/ClickHouse/pull/45957) ([chen](https://github.com/xiedeyantu)).
* クラスター状態のデータを使用して、バックアップ／リストア処理の同時実行を確認します。 [#45982](https://github.com/ClickHouse/ClickHouse/pull/45982) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* ClickHouse Client：あいまい検索に対して「exact」マッチングを使用するようにし、大文字・小文字を正しく無視しつつ、SQL クエリのマッチングにより適したアルゴリズムを採用しました。 [#46000](https://github.com/ClickHouse/ClickHouse/pull/46000)（[Azat Khuzhin](https://github.com/azat)）。
* 誤ったビュー作成構文 `CREATE View X TO Y AS SELECT` を禁止しました。 [#4331](https://github.com/ClickHouse/ClickHouse/issues/4331) をクローズしました。 [#46043](https://github.com/ClickHouse/ClickHouse/pull/46043)（[flynn](https://github.com/ucasfl)）。
* `Log` ストレージファミリーで `storage_policy` を設定できるようにしました。[#43421](https://github.com/ClickHouse/ClickHouse/issues/43421) をクローズ。[#46044](https://github.com/ClickHouse/ClickHouse/pull/46044)（[flynn](https://github.com/ucasfl)）。
* 結果が空のときの `JSONColumns` フォーマットを改善。[#46024](https://github.com/ClickHouse/ClickHouse/issues/46024) をクローズ。[#46053](https://github.com/ClickHouse/ClickHouse/pull/46053) ([flynn](https://github.com/ucasfl))。
* SipHash128 の参照実装を追加しました。 [#46065](https://github.com/ClickHouse/ClickHouse/pull/46065) ([Salvatore Mesoraca](https://github.com/aiven-sal)).
* mmap を使用して割り当て時間とバイト数を記録する新しいメトリクスを追加しました。[#46068](https://github.com/ClickHouse/ClickHouse/pull/46068) ([李扬](https://github.com/taiyang-li)).
* 現在、`leftPad`、`rightPad`、`leftPadUTF8`、`rightPadUTF8` のような関数では、2 番目の引数 `length` は UInt8|16|32|64|128|256 でなければなりません。これは ClickHouse ユーザーにとっては制約が厳しすぎるうえに、`arrayResize` や `substring` などの他の類似関数との一貫性もありません。[#46103](https://github.com/ClickHouse/ClickHouse/pull/46103)（[李扬](https://github.com/taiyang-li)）。
* デバッグビルドにおいて、結果の統計量が NaN となる場合の `welchTTest` 関数内のアサーションを修正しました。他の類似関数との動作を統一しました。従来の動作が扱いづらかったため、`studentTTest` の動作を、例外をスローするのではなく NaN を返すように変更しました。これにより [#41176](https://github.com/ClickHouse/ClickHouse/issues/41176) および [#42162](https://github.com/ClickHouse/ClickHouse/issues/42162) がクローズされます。[#46141](https://github.com/ClickHouse/ClickHouse/pull/46141)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 大きな整数と ORDER BY WITH FILL をより便利に利用可能にしました。大きな（128 ビットおよび 256 ビット）整数で ORDER BY を使用する際に、WITH FILL の開始点および終了点として通常の整数を使用できるようにしました。開始点または終了点が負の値の大きな整数に対して誤った結果が返される問題を修正しました。これにより [#16733](https://github.com/ClickHouse/ClickHouse/issues/16733) が解決しました。 [#46152](https://github.com/ClickHouse/ClickHouse/pull/46152)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* `system.tables` に `parts`、`active_parts`、`total_marks` カラムを追加。[issue](https://github.com/ClickHouse/ClickHouse/issues/44336)。[#46161](https://github.com/ClickHouse/ClickHouse/pull/46161)（[attack204](https://github.com/attack204)）。
* 関数 &quot;multi[Fuzzy]Match(Any|AnyIndex|AllIndices&#125;&quot; は、vectorscan での評価に非常に時間がかかる可能性が高い正規表現を拒否するようになりました。 [#46167](https://github.com/ClickHouse/ClickHouse/pull/46167) ([Robert Schulze](https://github.com/rschu1ze)).
* `insert_null_as_default` が有効になっていて、列にデフォルト値が定義されていない場合には、その列の型のデフォルト値が使用されます。また、この PR では LowCardinality 型の列における NULL に対するデフォルト値の適用も修正しています。 [#46171](https://github.com/ClickHouse/ClickHouse/pull/46171) ([Kruglov Pavel](https://github.com/Avogar)).
* S3 クライアントには明示的に定義されたアクセスキーを使用することを推奨します。`use_environment_credentials` が `true` に設定されていて、ユーザーがクエリまたは設定を通じてアクセスキーを指定している場合は、環境変数のものではなく、そのアクセスキーが使用されます。 [#46191](https://github.com/ClickHouse/ClickHouse/pull/46191) ([Antonio Andelic](https://github.com/antonio2368))。
* MySQL の SQL 方言との互換性を向上させるために、関数「formatDateTime()」のエイリアス「DATE&#95;FORMAT()」を追加し、関数 `formatDateTime` を拡張して、フォーマット指定子「a」「b」「c」「h」「i」「k」「l」「r」「s」「W」をサポートします。 ### ユーザー向け変更のドキュメント項目 ユーザー向けの短い説明: `DATE_FORMAT` は `formatDateTime` のエイリアスです。指定されたフォーマット文字列に従って時刻を整形します。フォーマット文字列は定数式である必要があるため、1 つの結果列に対して複数のフォーマットを指定することはできません。（[formatDateTime](/sql-reference/functions/date-time-functions/#formatDateTime) へのリンクを参照）。 [#46302](https://github.com/ClickHouse/ClickHouse/pull/46302)（[Jake Bamrah](https://github.com/JakeBamrah)）。
* 並列レプリカ（`s3Cluster` および `MergeTree` テーブル）のコールバックタスク向けの `ProfileEvents` と `CurrentMetrics` を追加しました。 [#46313](https://github.com/ClickHouse/ClickHouse/pull/46313) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `KeeperMap` ストレージエンジンを使用するテーブルに対して `DELETE` および `UPDATE` のサポートを追加しました。 [#46330](https://github.com/ClickHouse/ClickHouse/pull/46330) ([Antonio Andelic](https://github.com/antonio2368)).
* `RENAME` クエリでクエリパラメータを使用できるようにしました。[#45778](https://github.com/ClickHouse/ClickHouse/issues/45778) に対応。[#46407](https://github.com/ClickHouse/ClickHouse/pull/46407)（[Nikolay Degterinsky](https://github.com/evillique)）。
* REPLACE トランスフォーマーを使用してパラメータ化された SELECT クエリを修正しました。[#33002](https://github.com/ClickHouse/ClickHouse/issues/33002) を解決。[#46420](https://github.com/ClickHouse/ClickHouse/pull/46420) ([Nikolay Degterinsky](https://github.com/evillique))。
* 一時テーブルおよび外部テーブルに使用される内部データベースを、非同期メトリクス「NumberOfDatabases」の計算から除外します。これにより、システムテーブル「system.databases」の動作と一致するようになります。 [#46435](https://github.com/ClickHouse/ClickHouse/pull/46435) ([Robert Schulze](https://github.com/rschu1ze)).
* `distribution_queue` テーブルに `last_exception_time` 列を追加しました。 [#46564](https://github.com/ClickHouse/ClickHouse/pull/46564)（[Aleksandr](https://github.com/AVMusorin)）。
* パラメータ化ビューでのパラメータ付き IN 句のサポート。 [#46583](https://github.com/ClickHouse/ClickHouse/pull/46583) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* サーバー起動時に名前付きコレクションを読み込まず、代わりに初回アクセス時に読み込むようにしました。 [#46607](https://github.com/ClickHouse/ClickHouse/pull/46607) ([Kseniia Sumarokova](https://github.com/kssenii)).

#### ビルド／テスト／パッケージングの改善 {#buildtestingpackaging-improvement-10}
* LLVM ランタイムで実装されている GWP-ASan を導入しました。これにより [#27039](https://github.com/ClickHouse/ClickHouse/issues/27039) がクローズされます。[#45226](https://github.com/ClickHouse/ClickHouse/pull/45226)（[Han Fei](https://github.com/hanfei1991)）。
* テストをあえて不安定でフレークしやすくするため、テスト内の MergeTree 設定にランダム化を追加しました。[#38983](https://github.com/ClickHouse/ClickHouse/pull/38983)（[Anton Popov](https://github.com/CurtizJ)）。
* PowerPC で HDFS サポートを有効化し、これにより次の機能テスト 02113_hdfs_assert.sh、02244_hdfs_cluster.sql、02368_cancel_write_into_hdfs.sh が修正されます。[#44949](https://github.com/ClickHouse/ClickHouse/pull/44949)（[MeenaRenganathan22](https://github.com/MeenaRenganathan22)）。
* clickhouse-keeper 用の systemd.service ファイルを追加しました。[#44293](https://github.com/ClickHouse/ClickHouse/issues/44293) を修正します。[#45568](https://github.com/ClickHouse/ClickHouse/pull/45568)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）。
* ClickHouse の poco フォークを "contrib/" から "base/poco/" に移動しました。[#46075](https://github.com/ClickHouse/ClickHouse/pull/46075)（[Robert Schulze](https://github.com/rschu1ze)）。
* 子プロセスを再起動するための `clickhouse-watchdog` のオプションを追加しました。これはあまり有用ではありません。[#46312](https://github.com/ClickHouse/ClickHouse/pull/46312)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 環境変数 `CLICKHOUSE_DOCKER_RESTART_ON_EXIT` が 1 に設定されている場合、Docker コンテナは最初のプロセスとしてではなく子プロセスとして `clickhouse-server` を実行し、終了した際にそれを再起動します。[#46391](https://github.com/ClickHouse/ClickHouse/pull/46391)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* systemd サービスファイルを修正しました。[#46461](https://github.com/ClickHouse/ClickHouse/pull/46461)（[SuperDJY](https://github.com/cmsxbc)）。
* ClickHouse のビルドに必要な Clang の最小バージョンを 12 から 15 へ引き上げました。[#46710](https://github.com/ClickHouse/ClickHouse/pull/46710)（[Robert Schulze](https://github.com/rschu1ze)）。
* Intel QPL を v0.3.0 から v1.0.0 にアップグレードしました。また、libaccel-config をビルドし、動的ではなく静的に QPL ライブラリへリンクしました。[#45809](https://github.com/ClickHouse/ClickHouse/pull/45809)（[jasperzhu](https://github.com/jinjunzh)）。

#### バグ修正（公式安定版リリースにおけるユーザーにとって目に見える誤動作） {#bug-fix-user-visible-misbehavior-in-official-stable-release}

* `StorageRabbitMQ` で `rabbitmq_flush_interval_ms` または `rabbitmq_max_block_size` に基づいてデータを正確にフラッシュするようにしました。[#42389](https://github.com/ClickHouse/ClickHouse/issues/42389) をクローズしました。[#45160](https://github.com/ClickHouse/ClickHouse/issues/45160) をクローズしました。[#44404](https://github.com/ClickHouse/ClickHouse/pull/44404)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* `sparkBar` 関数で `PODArray` を使用してレンダリングすることで、メモリ使用量を制御できるようにしました。[#44467](https://github.com/ClickHouse/ClickHouse/issues/44467) をクローズしました。[#44489](https://github.com/ClickHouse/ClickHouse/pull/44489)（[Duc Canh Le](https://github.com/canhld94)）。
* 関数 quantilesExactExclusive、quantilesExactInclusive が未ソートの配列要素を返していた問題を修正。 [#45379](https://github.com/ClickHouse/ClickHouse/pull/45379) ([wujunfu](https://github.com/wujunfu))。
* OpenTelemetry が有効な場合に HTTPHandler で発生する捕捉されない例外を修正。 [#45456](https://github.com/ClickHouse/ClickHouse/pull/45456) ([Frank Chen](https://github.com/FrankChen021)).
* 8桁の数値を日付として解釈しないようにしました。誤ったデータが読み取られるおそれがあるためです。 [#45581](https://github.com/ClickHouse/ClickHouse/pull/45581) ([Kruglov Pavel](https://github.com/Avogar)).
* `odbc_bridge_use_connection_pooling` 設定が正しく使用されるよう修正。 [#45591](https://github.com/ClickHouse/ClickHouse/pull/45591) ([Bharat Nallan](https://github.com/bharatnc))。
* キャッシュ内のコールバックが呼び出されたとき、このキャッシュ自体が破棄されている可能性があります。安全性を確保するため、メンバーは値キャプチャします。タスクスケジューリングについても安全であり、ストレージが破棄される前に非アクティブ化されます。[#45548](https://github.com/ClickHouse/ClickHouse/issues/45548) を解決。 [#45601](https://github.com/ClickHouse/ClickHouse/pull/45601)（[Han Fei](https://github.com/hanfei1991)）。
* コーデック Delta または DoubleDelta をコーデック Gorilla と組み合わせて使用した場合に発生するデータ破損の問題を修正しました。 [#45615](https://github.com/ClickHouse/ClickHouse/pull/45615) ([Robert Schulze](https://github.com/rschu1ze)).
* N-gram ブルームフィルターインデックスの使用時に無効な読み取りを回避できるよう、型を正しくチェックするようにしました。 [#45617](https://github.com/ClickHouse/ClickHouse/pull/45617) ([Antonio Andelic](https://github.com/antonio2368)).
* `c-ares` 周辺でいくつかのセグメンテーションフォルトが報告されていました。これらは私の以前の pull request により導入されたものでした。Alexander Tokmakov の協力を得て修正しました。[#45629](https://github.com/ClickHouse/ClickHouse/pull/45629)（[Arthur Passos](https://github.com/arthurpassos)）。
* 重複した主キーに遭遇した場合のキーの説明を修正します。これは projection で発生することがあります。詳細は [#45590](https://github.com/ClickHouse/ClickHouse/issues/45590) を参照してください。 [#45686](https://github.com/ClickHouse/ClickHouse/pull/45686)（[Amos Bird](https://github.com/amosbird)）。
* バックアップの圧縮方式とレベルを設定できるようにしました。これにより [#45690](https://github.com/ClickHouse/ClickHouse/issues/45690) をクローズしました。 [#45737](https://github.com/ClickHouse/ClickHouse/pull/45737)（[Pradeep Chhetri](https://github.com/chhetripradeep)）。
* `select_query_typed.limitOffset` の代わりに `select_query_typed.limitByOffset` を使用してください。 [#45817](https://github.com/ClickHouse/ClickHouse/pull/45817) ([刘陶峰](https://github.com/taofengliu))
* experimental analyzer を使用している場合、`SELECT number FROM numbers(100) LIMIT 10 OFFSET 10;` のようなクエリが誤った結果（この SQL では空の結果）になります。これは、クエリプランナーによって不要な OFFSET ステップが追加されることが原因です。[#45822](https://github.com/ClickHouse/ClickHouse/pull/45822)（[刘陶峰](https://github.com/taofengliu)）。
* 後方互換性 - 「INSERT ... VALUES ...」式に必要な UInt64 から IPv4 への暗黙の縮小変換を許可。[#45865](https://github.com/ClickHouse/ClickHouse/pull/45865) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 先頭のオクテットが欠落している混在 IPv4/IPv6 アドレス（`::.1.2.3` のような）に対する IPv6 パーサーのバグを修正。 [#45871](https://github.com/ClickHouse/ClickHouse/pull/45871) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* `system.processes` テーブルおよび `SHOW PROCESSLIST` クエリに `query_kind` カラムを追加し、重複したコードを削除しました。これにより、グローバル設定パラメータ `max_concurrent_select_queries` が `INTERSECT` や `EXCEPT` を連結したクエリに対して適用されていなかったバグが修正されました。 [#45872](https://github.com/ClickHouse/ClickHouse/pull/45872) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* WingFuzz によって検出された関数 `stochasticLinearRegression` のクラッシュを修正しました。[#45985](https://github.com/ClickHouse/ClickHouse/pull/45985) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
* 疎なカラムが有効になっているテーブル（設定 `ratio_of_defaults_for_sparse_serialization` によって制御）からデータを読み取る際に、`INTERSECT` および `EXCEPT` 修飾子を使用する `SELECT` クエリで発生していたクラッシュを修正しました。 [#45987](https://github.com/ClickHouse/ClickHouse/pull/45987) ([Anton Popov](https://github.com/CurtizJ))。
* FINAL を伴う DESC ソートにおける順序読み取りの最適化を修正し、[#45815](https://github.com/ClickHouse/ClickHouse/issues/45815) をクローズ。[#46009](https://github.com/ClickHouse/ClickHouse/pull/46009)（[Vladimir C](https://github.com/vdimir)）。
* compact パーツにおける、複数レベルの存在しないネストされたカラムの読み取りを修正。[#46045](https://github.com/ClickHouse/ClickHouse/pull/46045)（[Azat Khuzhin](https://github.com/azat)）。
* system.processes の elapsed 列の 10 倍の誤差があった問題を修正。[#46047](https://github.com/ClickHouse/ClickHouse/pull/46047)（[Azat Khuzhin](https://github.com/azat)）。
* ドメイン IP 型（IPv4、IPv6）をネイティブ型に置き換える変更（[https://github.com/ClickHouse/ClickHouse/pull/43221](https://github.com/ClickHouse/ClickHouse/pull/43221)）に対するフォローアップの修正。[#46087](https://github.com/ClickHouse/ClickHouse/pull/46087)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* パラメータにすでに値が設定されている場合の、設定ファイル内での環境変数の代入処理を修正しました。これにより [#46131](https://github.com/ClickHouse/ClickHouse/issues/46131) および [#9547](https://github.com/ClickHouse/ClickHouse/issues/9547) がクローズされます。 [#46144](https://github.com/ClickHouse/ClickHouse/pull/46144)（[pufit](https://github.com/pufit)）。
* グルーピングセット使用時の誤ったプレディケートプッシュダウンを修正。[#45947](https://github.com/ClickHouse/ClickHouse/issues/45947) をクローズ。[#46151](https://github.com/ClickHouse/ClickHouse/pull/46151) ([flynn](https://github.com/ucasfl))。
* 定数キーを使用する `fulls_sorting_join` でパイプラインが停止してしまう可能性のある不具合を修正。[#46175](https://github.com/ClickHouse/ClickHouse/pull/46175)（[Vladimir C](https://github.com/vdimir)）。
* 誤った結果を避けるため、フォーマット時に `tuple` 関数をリテラルに書き換えないよう修正しました。 [#46232](https://github.com/ClickHouse/ClickHouse/pull/46232) ([Salvatore Mesoraca](https://github.com/aiven-sal)).
* Arrow 形式で LowCardinality(Nullable) を読み込む際に発生しうる範囲外アクセスエラーを修正。 [#46270](https://github.com/ClickHouse/ClickHouse/pull/46270) ([Kruglov Pavel](https://github.com/Avogar)).
* 例外 `CANNOT_PARSE_INPUT_ASSERTION_FAILED` により `SYSTEM UNFREEZE` クエリが失敗する不具合を修正。 [#46325](https://github.com/ClickHouse/ClickHouse/pull/46325) ([Aleksei Filatov](https://github.com/aalexfvk))。
* HashTable を保持する関数の集約状態をデシリアライズする際の整数オーバーフローによって発生する可能性のあるクラッシュを修正。 [#46349](https://github.com/ClickHouse/ClickHouse/pull/46349) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* フォーマット `VALUES` で送信された不正なデータにより、非同期インサートで `LOGICAL_ERROR` が発生し得る問題を修正しました。 [#46350](https://github.com/ClickHouse/ClickHouse/pull/46350) ([Anton Popov](https://github.com/CurtizJ)).
* `ALTER ... MOVE PART ... TO TABLE` を実行しようとした際に発生していた LOGICAL&#95;ERROR を修正しました。この種のクエリは元々サポートされていませんでした。 [#46359](https://github.com/ClickHouse/ClickHouse/pull/46359) ([Alexander Tokmakov](https://github.com/tavplubix))。
* `parallel_distributed_insert_select` が有効な場合の並列 distributed INSERT SELECT における s3Cluster のスキーマ推論を修正。 [#46381](https://github.com/ClickHouse/ClickHouse/pull/46381) ([Kruglov Pavel](https://github.com/Avogar)).
* 同じ `Nested` カラム内のフィールドである `arr1` と `arr2` を用いた `ALTER TABLE ... UPDATE nested.arr1 = nested.arr2 ...` のようなクエリを修正。[#46387](https://github.com/ClickHouse/ClickHouse/pull/46387)（[Anton Popov](https://github.com/CurtizJ)）。
* Scheduler がタスクのスケジューリングに失敗することがあります。その場合、MulityPartUpload 全体を中止し、`UploadHelper` はすでにスケジュール済みのタスクの完了を待つ必要があります。 [#46451](https://github.com/ClickHouse/ClickHouse/pull/46451) ([Dmitry Novik](https://github.com/novikd))。
* 異なるデフォルト型を持つ Merge に対する PREWHERE を修正（列のデフォルト型が異なる場合に発生する一部の `NOT_FOUND_COLUMN_IN_BLOCK` を修正し、テーブル間で列型が同一であれば `PREWHERE` を許可し、型が異なる場合にのみ禁止するようにした）。[#46454](https://github.com/ClickHouse/ClickHouse/pull/46454)（[Azat Khuzhin](https://github.com/azat)）。
* `ORDER BY` で定数値が使用された場合に発生する可能性のあったクラッシュを修正しました。関連する issue [#46466](https://github.com/ClickHouse/ClickHouse/issues/46466) を解決。[#46493](https://github.com/ClickHouse/ClickHouse/pull/46493)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* クエリレベルで `disk` 設定が指定されており、かつ構成ファイルの MergeTree 設定セクションで `storage_policy` が指定されている場合でも、例外をスローしないようにしました。`disk` が構成ファイル側の設定を上書きします。 [#46533](https://github.com/ClickHouse/ClickHouse/pull/46533) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 関数 `arrayMap` における定数 `LowCardinality` 引数の不正な処理を修正しました。このバグにより、リリースビルドではセグメンテーションフォルトが、デバッグビルドでは論理エラー `Bad cast` が発生する可能性がありました。 [#46569](https://github.com/ClickHouse/ClickHouse/pull/46569) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* [#46557](https://github.com/ClickHouse/ClickHouse/issues/46557) を修正します。 [#46611](https://github.com/ClickHouse/ClickHouse/pull/46611) ([Alexander Gololobov](https://github.com/davenger)).
* clickhouse-server が 1分30秒以内に起動できない場合に systemd ユニットが際限なく再起動を繰り返す問題を修正しました（systemd サービスから clickhouse-server を起動する際のタイムアウト処理ロジックを無効化）。 [#46613](https://github.com/ClickHouse/ClickHouse/pull/46613) ([Azat Khuzhin](https://github.com/azat)).
* 非同期挿入で確保されたメモリバッファがグローバルコンテキストで解放されており、対応するユーザーおよびクエリの MemoryTracker カウンタが正しく更新されていませんでした。その結果、OOM 例外が誤って発生していました。[#46622](https://github.com/ClickHouse/ClickHouse/pull/46622) ([Dmitry Novik](https://github.com/novikd))。
* 今後の analyze 実行でも使用されるため、table&#95;join から on&#95;expression をクリアしないように更新し、[#45185](https://github.com/ClickHouse/ClickHouse/issues/45185) を解決しました。 [#46487](https://github.com/ClickHouse/ClickHouse/pull/46487) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。

### <a id="231"></a> ClickHouse リリース 23.1, 2023-01-26 {#231}

### ClickHouse リリース 23.1 {#clickhouse-release-231}

#### アップグレードに関する注意事項 {#upgrade-notes-2}
* `SYSTEM RESTART DISK` クエリは no-op になります。 [#44647](https://github.com/ClickHouse/ClickHouse/pull/44647) ([alesapin](https://github.com/alesapin)).
* `HASHED`/`SPARSE_HASHED` 辞書に対する `PREALLOCATE` オプションは no-op になります。 [#45388](https://github.com/ClickHouse/ClickHouse/pull/45388) ([Azat Khuzhin](https://github.com/azat)). もはや大きな利点をもたらしません。
* Float32 型でも Float64 型でもないカラムに対して `Gorilla` コーデックを使用することを禁止します。 [#45252](https://github.com/ClickHouse/ClickHouse/pull/45252) ([Robert Schulze](https://github.com/rschu1ze)). 無意味であり、不整合を引き起こしていました。 
* 非推奨の構文で作成された `*MergeTree` テーブルでは、parallel quorum insert が正しく動作しない可能性があります。そのため、そのようなテーブルに対する parallel quorum insert のサポートは完全に無効化されます。新しい構文で作成されたテーブルには影響しません。 [#45430](https://github.com/ClickHouse/ClickHouse/pull/45430) ([Alexander Tokmakov](https://github.com/tavplubix)).
* AWS S3 内のオブジェクトサイズを取得する際、`HeadObject` リクエストの代わりに `GetObjectAttributes` リクエストを使用します。この変更により、たとえば AWS SDK のアップデート後に明示的なリージョン指定のないエンドポイントを処理できない問題が修正されます。 [#45288](https://github.com/ClickHouse/ClickHouse/pull/45288) ([Vitaly Baranov](https://github.com/vitlibar)). AWS S3 と Minio でテスト済みですが、さまざまな S3 互換サービス（GCS、R2、B2 など）には微妙な非互換性がある可能性がある点に注意してください。この変更により、`GetObjectAttributes` リクエストを許可するように ACL を調整する必要が生じる場合があります。
* タイムゾーン名としてパスの使用を禁止します。たとえば、`/usr/share/zoneinfo/Asia/Aden` のようなタイムゾーン名は許可されません。`Asia/Aden` のような IANA タイムゾーンデータベース名を使用する必要があります。 [#44225](https://github.com/ClickHouse/ClickHouse/pull/44225) ([Kruglov Pavel](https://github.com/Avogar)).
* 等値結合と定数式を組み合わせたクエリ（例: `JOIN ON t1.x = t2.x AND 1 = 1`）は、誤った結果を返すため禁止されます。 [#44016](https://github.com/ClickHouse/ClickHouse/pull/44016) ([Vladimir C](https://github.com/vdimir)).

#### 新機能 {#new-feature-11}

* 正規表現ツリーを走査してキーを抽出するための辞書ソースです。User-Agent の解析に使用できます。 [#40878](https://github.com/ClickHouse/ClickHouse/pull/40878) ([Vage Ogannisian](https://github.com/nooblose)). [#43858](https://github.com/ClickHouse/ClickHouse/pull/43858) ([Han Fei](https://github.com/hanfei1991)).
* パラメータ化ビュー機能を追加し、View テーブルエンジンでクエリパラメータを指定できるようにしました。これにより [#40907](https://github.com/ClickHouse/ClickHouse/issues/40907) が解決されました。 [#41687](https://github.com/ClickHouse/ClickHouse/pull/41687)（[SmitaRKulkarni](https://github.com/SmitaRKulkarni)）。
* `quantileInterpolatedWeighted` / `quantilesInterpolatedWeighted` 関数を追加しました。 [#38252](https://github.com/ClickHouse/ClickHouse/pull/38252) ([Bharat Nallan](https://github.com/bharatnc)).
* Spark の関数「explode」のような、`Map` 型に対する array join のサポートを追加。[#43239](https://github.com/ClickHouse/ClickHouse/pull/43239)（[李扬](https://github.com/taiyang-li)）。
* SQL 標準のバイナリおよび16進数文字列リテラルをサポートしました。 [#43785](https://github.com/ClickHouse/ClickHouse/pull/43785) ([Mo Xuan](https://github.com/mo-avatar)).
* `DateTime` を Joda-Time 形式でフォーマットできるようにしました。詳細は [Joda-Time のドキュメント](https://joda-time.sourceforge.net/apidocs/org/joda/time/format/DateTimeFormat.html) を参照してください。[#43818](https://github.com/ClickHouse/ClickHouse/pull/43818)（[李扬](https://github.com/taiyang-li)）。
* `formatDateTime` に対して、秒の小数部用フォーマッタ（`%f`）を実装しました。 [#44060](https://github.com/ClickHouse/ClickHouse/pull/44060) ([ltrk2](https://github.com/ltrk2)). [#44497](https://github.com/ClickHouse/ClickHouse/pull/44497) ([Alexander Gololobov](https://github.com/davenger)).
* 2つの日付、または時刻値を含む2つの日付の差を、整数の単位数として計算する `age` 関数を追加しました。 [#41115](https://github.com/ClickHouse/ClickHouse/issues/41115) をクローズしました。 [#44421](https://github.com/ClickHouse/ClickHouse/pull/44421)（[Robert Schulze](https://github.com/rschu1ze)）。
* 辞書に `Null` ソースを追加。[#44240](https://github.com/ClickHouse/ClickHouse/issues/44240) をクローズ。[#44502](https://github.com/ClickHouse/ClickHouse/pull/44502)（[mayamika](https://github.com/mayamika)）。
* `s3_storage_class` 設定オプションで S3 のストレージクラスを設定できるようにしました。例: `<s3_storage_class>STANDARD/INTELLIGENT_TIERING</s3_storage_class>` [#44443](https://github.com/ClickHouse/ClickHouse/issues/44443) をクローズしました。 [#44707](https://github.com/ClickHouse/ClickHouse/pull/44707) ([chen](https://github.com/xiedeyantu))。
* 名前付きタプルをパースする際、JSON オブジェクト内で要素が欠落している場合にデフォルト値を挿入するようにしました。この挙動を制御するための設定 `input_format_json_defaults_for_missing_elements_in_named_tuple` を追加しました。[#45142](https://github.com/ClickHouse/ClickHouse/issues/45142)#issuecomment-1380153217 をクローズ。[#45231](https://github.com/ClickHouse/ClickHouse/pull/45231)（[Kruglov Pavel](https://github.com/Avogar)）。
* サーバーの起動時間を ProfileEvents（`ServerStartupMilliseconds`）として記録。 [#43188](https://github.com/ClickHouse/ClickHouse/issues/43188) を解決。 [#45250](https://github.com/ClickHouse/ClickHouse/pull/45250)（[SmitaRKulkarni](https://github.com/SmitaRKulkarni)）。
* ストリーミングエンジン Kafka/RabbitMQ/NATS をリファクタリングおよび改善し、すべてのフォーマットをサポートするとともに、フォーマット自体も一部リファクタリングしました。- サフィックス/プレフィックス付きの行ベースフォーマットでのメッセージ生成を修正しました。これにより、各メッセージはすべての区切り文字を含めて完全にフォーマットされ、入力フォーマットを使用して再パースできるようになりました。- Native、Parquet、ORC などのブロックベースフォーマットをサポートしました。各ブロックは個別のメッセージとしてフォーマットされます。1 つのメッセージ内の行数はブロックサイズに依存するため、`max_block_size` 設定で制御できます。- 新しいエンジン設定 `kafka_max_rows_per_message/rabbitmq_max_rows_per_message/nats_max_rows_per_message` を追加しました。これらは行ベースフォーマットで 1 メッセージにフォーマットされる行数を制御します。デフォルト値: 1。- NATS テーブルエンジンにおける高いメモリ消費を修正しました。- NATS プロデューサで任意のバイナリデータをサポートしました（以前は末尾に \0 を含む文字列でのみ動作していました）。- ドキュメントに不足していた Kafka/RabbitMQ/NATS エンジン設定を追加しました。- Kafka/RabbitMQ/NATS におけるメッセージの送受信処理をリファクタリングし、WriteBuffers/ReadBuffers のセマンティクスから分離しました。- 出力フォーマットをリファクタリングしました: Kafka/RabbitMQ/NATS で使用されていた各行ごとのコールバックを削除（現在はそこでコールバックを使用していません）し、`IRowOutputFormat` を直接使用できるようにし、行末および行間の区切りの扱いを明確にし、再度フォーマットを開始できるように出力フォーマットをリセット可能にしました。- `formatRow` 関数に適切な実装を追加しました（フォーマットのリファクタリングに伴う副次的な改善）。[#42777](https://github.com/ClickHouse/ClickHouse/pull/42777) ([Kruglov Pavel](https://github.com/Avogar)).
* `CapnProto` フォーマットで `Struct` の `List` として `Nested` テーブルの読み書きをサポートします。`Decimal32/64` 型を `Int32/64` 型として読み書きします。[#43319](https://github.com/ClickHouse/ClickHouse/issues/43319) をクローズします。[#43379](https://github.com/ClickHouse/ClickHouse/pull/43379)（[Kruglov Pavel](https://github.com/Avogar)）。
* `system.text_log` に `message_format_string` カラムを追加しました。このカラムには、メッセージのフォーマットに使用されたパターンが含まれます。 [#44543](https://github.com/ClickHouse/ClickHouse/pull/44543) ([Alexander Tokmakov](https://github.com/tavplubix))。これにより、ClickHouse ログに対してさまざまな解析が可能になります。
* CSV/TSV/CustomSeparated の入力フォーマットに対して、列名（および場合によっては型）を持つヘッダーを自動検出するよう試みます。
  この動作を有効にする設定 input&#95;format&#95;tsv/csv/custom&#95;detect&#95;header を追加しました（デフォルトで有効です）。[#44640](https://github.com/ClickHouse/ClickHouse/issues/44640) をクローズしました。[#44953](https://github.com/ClickHouse/ClickHouse/pull/44953)（[Kruglov Pavel](https://github.com/Avogar)）。

#### 実験的機能 {#experimental-feature-7}
* テキスト検索を効率化するため、新しいセカンダリインデックスの種類として実験的な倒立インデックスを追加しました。 [#38667](https://github.com/ClickHouse/ClickHouse/pull/38667) ([larryluogit](https://github.com/larryluogit)).
* 実験的なクエリ結果キャッシュを追加しました。 [#43797](https://github.com/ClickHouse/ClickHouse/pull/43797) ([Robert Schulze](https://github.com/rschu1ze)).
* I/O リクエスト向けに拡張可能かつ構成可能なスケジューリングサブシステムを追加しました（まだ I/O コード本体とは統合されていません）。 [#41840](https://github.com/ClickHouse/ClickHouse/pull/41840) ([Sergei Trifonov](https://github.com/serxa)). この機能は現時点では何もしません。お楽しみください。
* `Replicated` データベースの障害レプリカのメタデータを削除する `SYSTEM DROP DATABASE REPLICA` を追加しました。 [#41794](https://github.com/ClickHouse/ClickHouse/issues/41794) を解決します。 [#42807](https://github.com/ClickHouse/ClickHouse/pull/42807) ([Alexander Tokmakov](https://github.com/tavplubix)).

#### パフォーマンスの向上 {#performance-improvement-11}

* `MergeTree` テーブルの起動時に非アクティブなパーツを読み込まないようにしました。 [#42181](https://github.com/ClickHouse/ClickHouse/pull/42181) ([Anton Popov](https://github.com/CurtizJ)).
* 多数の小さなファイルを対象としたストレージ `S3` およびテーブル関数 `s3` からの読み取り時のレイテンシを改善しました。これにより、ストレージ `S3` から読み取る際に、設定 `remote_filesystem_read_method` と `remote_filesystem_read_prefetch` が有効になるようになりました。 [#43726](https://github.com/ClickHouse/ClickHouse/pull/43726) ([Anton Popov](https://github.com/CurtizJ))。
* Parquet/ORC ファイル内の struct フィールドの読み取りを最適化しました。必要なフィールドのみを読み込みます。 [#44484](https://github.com/ClickHouse/ClickHouse/pull/44484) ([lgbo](https://github.com/lgbo-ustc)).
* HTTP インターフェイス経由のクエリで、二段階集約アルゴリズムが誤って無効化されていました。これを再度有効化したことで、パフォーマンスが大幅に向上しました。 [#45450](https://github.com/ClickHouse/ClickHouse/pull/45450) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* StorageFile に対して mmap サポートを追加しました。これにより、clickhouse-local のパフォーマンスが向上するはずです。 [#43927](https://github.com/ClickHouse/ClickHouse/pull/43927) ([pufit](https://github.com/pufit))。
* `HashedDictionary` にシャーディング対応を追加し、並列読み込みを可能にしました（シャード数に応じてほぼ線形にスケーリング）。 [#40003](https://github.com/ClickHouse/ClickHouse/pull/40003) ([Azat Khuzhin](https://github.com/azat)).
* クエリのパースを高速化しました。 [#42284](https://github.com/ClickHouse/ClickHouse/pull/42284) ([Raúl Marín](https://github.com/Algunenano))。
* `expr` が `LowCardinality` 列である場合、OR チェーン `expr = x1 OR ... OR expr = xN` は常に `expr IN (x1, ..., xN)` に置き換えられます。この場合、`optimize_min_equality_disjunction_chain_length` の設定は無視されます。 [#42889](https://github.com/ClickHouse/ClickHouse/pull/42889) ([Guo Wangyang](https://github.com/guowangy))。
* ThreadStatus 関連のコードを最適化し、パフォーマンスをわずかに向上させました。 [#43586](https://github.com/ClickHouse/ClickHouse/pull/43586) ([Zhiguo Zhou](https://github.com/ZhiguoZh)).
* 列単位の三値論理評価を、自動ベクトル化により最適化しました。この[マイクロベンチマーク](https://github.com/ZhiguoZh/ClickHouse/blob/20221123-ternary-logic-opt-example/src/Functions/examples/associative_applier_perf.cpp)のパフォーマンステストにおいて、ICX デバイス (Intel Xeon Platinum 8380 CPU) 上で **最大 21 倍** の**性能向上**が観測されました。[#43669](https://github.com/ClickHouse/ClickHouse/pull/43669)（[Zhiguo Zhou](https://github.com/ZhiguoZh)）。
* 可能であれば、`system.tables` テーブルの読み取りロックを取得することは避けてください。 [#43840](https://github.com/ClickHouse/ClickHouse/pull/43840) ([Raúl Marín](https://github.com/Algunenano)).
* ThreadPool を最適化しました。ICX デバイス（Intel Xeon Platinum 8380 CPU、80 コア、160 スレッド）上で実施した SSB（Star Schema Benchmark）のパフォーマンス実験により、この変更によって ThreadPoolImpl::mutex に対するロック競合を **75%** 削減し、CPU 使用率を高め、全体的なパフォーマンスを **2.4%** 向上できることが示されました。 [#44308](https://github.com/ClickHouse/ClickHouse/pull/44308) ([Zhiguo Zhou](https://github.com/ZhiguoZh))。
* ハッシュテーブルのサイズ予測に対する最適化は、キャッシュされたハッシュテーブルのサイズが十分に大きい場合にのみ適用されるようになりました（しきい値は経験的に決定され、ハードコードされています）。 [#44455](https://github.com/ClickHouse/ClickHouse/pull/44455)（[Nikita Taranov](https://github.com/nickitat)）。
* リモートファイルシステムからの非同期読み取りのパフォーマンスをわずかに改善。 [#44868](https://github.com/ClickHouse/ClickHouse/pull/44868) ([Kseniia Sumarokova](https://github.com/kssenii)).
* 次のケースに対する高速パスを追加しました: - `col like '%%'`; - `col like '%'`; - `col not like '%'`; - `col not like '%'`; - `match(col, '.*')`。 [#45244](https://github.com/ClickHouse/ClickHouse/pull/45244) ([李扬](https://github.com/taiyang-li)).
* フィルタリング（WHERE 句）におけるハッピーパス処理の最適化をわずかに改善。 [#45289](https://github.com/ClickHouse/ClickHouse/pull/45289) ([Nikita Taranov](https://github.com/nickitat))。
* `toUnixTimestamp64*` 向けの単調性情報を追加し、インデックス解析における代数的最適化の幅を広げました。 [#44116](https://github.com/ClickHouse/ClickHouse/pull/44116) ([Nikita Taranov](https://github.com/nickitat)).
* クエリ処理用の一時データ（ディスクへのスピル）がファイルシステムキャッシュ（キャッシュディスクの容量を使用）と連携して動作するように設定できるようにしました [#43972](https://github.com/ClickHouse/ClickHouse/pull/43972)（[Vladimir C](https://github.com/vdimir)）。これは主に [ClickHouse Cloud](https://console.clickhouse.cloud/) 向けの改善ですが、設定方法を理解していればセルフマネージド環境でも利用できます。
* `system.replicas` テーブルがレプリカのステータスを並列に取得するようにしました。[#43918](https://github.com/ClickHouse/ClickHouse/issues/43918) をクローズしました。[#43998](https://github.com/ClickHouse/ClickHouse/pull/43998)（[Nikolay Degterinsky](https://github.com/evillique)）。
* S3 へのバックアップ時のメモリ消費を最適化しました。S3 へのファイルコピーは、`WriteBufferFromS3`（大量のメモリを消費する可能性がある）を使用せず、直接コピーされるようになりました。 [#45188](https://github.com/ClickHouse/ClickHouse/pull/45188) ([Vitaly Baranov](https://github.com/vitlibar)).
* 非同期ブロック ID 用のキャッシュを追加しました。これにより、非同期挿入の重複排除を有効にした際の ZooKeeper へのリクエスト数が削減されます。 [#45106](https://github.com/ClickHouse/ClickHouse/pull/45106) ([Han Fei](https://github.com/hanfei1991)).

#### 改善 {#improvement-11}

* 引数なしで呼び出された generateRandom は挿入先テーブルの構造を使用するようになりました。 [#45239](https://github.com/ClickHouse/ClickHouse/pull/45239) ([Kruglov Pavel](https://github.com/Avogar))。
* `JSONExtract` 関数で、JSON の文字列フィールドに格納された浮動小数点数を整数に暗黙的に変換できるようにしました。例: `JSONExtract('{"a": "1000.111"}', 'a', 'UInt64')` -&gt; `1000`。以前は 0 を返していました。 [#45432](https://github.com/ClickHouse/ClickHouse/pull/45432) ([Anton Popov](https://github.com/CurtizJ))。
* `system.formats` テーブルにフィールド `supports_parallel_parsing` と `supports_parallel_formatting` を追加し、より詳細な状態確認ができるようにしました。 [#45499](https://github.com/ClickHouse/ClickHouse/pull/45499) ([Anton Popov](https://github.com/CurtizJ)).
* CustomSeparated/Template フォーマットでの CSV フィールドの読み取り処理を改善。 [#42352](https://github.com/ClickHouse/ClickHouse/issues/42352) および [#39620](https://github.com/ClickHouse/ClickHouse/issues/39620) をクローズ。 [#43332](https://github.com/ClickHouse/ClickHouse/pull/43332)（[Kruglov Pavel](https://github.com/Avogar)）。
* クエリの経過時間の測定方法を統一。 [#43455](https://github.com/ClickHouse/ClickHouse/pull/43455) ([Raúl Marín](https://github.com/Algunenano)).
* `SELECT` クエリに仮想カラムが含まれている場合に、テーブル関数 `file`/`hdfs`/`s3` が挿入テーブルの構造を自動的に利用する処理を改善しました。これにより、`Block structure mismatch` や `number of columns mismatch` といったエラーが発生する可能性を解消します。 [#43695](https://github.com/ClickHouse/ClickHouse/pull/43695) ([Kruglov Pavel](https://github.com/Avogar)).
* 関数 `range` に符号付き引数のサポートを追加しました。 [#43333](https://github.com/ClickHouse/ClickHouse/issues/43333) を修正します。 [#43733](https://github.com/ClickHouse/ClickHouse/pull/43733)（[sanyu](https://github.com/wineternity)）。
* 冗長なソートを削除します。例えば、サブクエリ内の ORDER BY 句によるソートを削除します。クエリプラン上に実装されています。`ORDER BY` 句に関しては `optimize_duplicate_order_by_and_distinct` と同様の最適化を行いますが、より汎用的です。これは、任意の冗長なソートステップ（ORDER BY 句によって引き起こされたものに限らない）に適用され、あらゆる深さのサブクエリに適用されるためです。[#42648](https://github.com/ClickHouse/ClickHouse/issues/42648) に関連する変更です。[#43905](https://github.com/ClickHouse/ClickHouse/pull/43905)（[Igor Nikonov](https://github.com/devcrafter)）。
* BACKUP 時のファイル重複排除を無効化できるようにしました（重複排除なしのバックアップでは、完全な RESTORE の代わりに ATTACH を使用できます）。例: `BACKUP foo TO S3(...) SETTINGS deduplicate_files=0`（デフォルトは `deduplicate_files=1`）。[#43947](https://github.com/ClickHouse/ClickHouse/pull/43947)（[Azat Khuzhin](https://github.com/azat)）。
* テキスト形式向けのスキーマ推論をリファクタリングし、改善しました。推論結果の型を `Nullable` にするかどうかを制御する新しい設定 `schema_inference_make_columns_nullable` を追加しました（デフォルトで有効）。 [#44019](https://github.com/ClickHouse/ClickHouse/pull/44019) ([Kruglov Pavel](https://github.com/Avogar)).
* `PROXYv1` プロトコルのサポートを強化。[#44135](https://github.com/ClickHouse/ClickHouse/pull/44135) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* クリーンアップスレッドが実行した最新のパーツチェックに関する情報を `system.parts` テーブルに追加します。 [#44244](https://github.com/ClickHouse/ClickHouse/pull/44244) ([Dmitry Novik](https://github.com/novikd))。
* 読み取り専用モードでの INSERT に対してテーブル関数を無効にする。 [#44290](https://github.com/ClickHouse/ClickHouse/pull/44290) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni)).
* `CleanupThread` の 1 回のイテレーションで処理されるパーツ数を制限できるようにするため、`simultaneous_parts_removal_limit` 設定を追加しました。 [#44461](https://github.com/ClickHouse/ClickHouse/pull/44461) ([Dmitry Novik](https://github.com/novikd))。
* クエリで仮想列のみが必要な場合は、ReadBufferFromS3 を初期化しないでください。この対応は [#44246](https://github.com/ClickHouse/ClickHouse/issues/44246) に役立つ可能性があります。 [#44493](https://github.com/ClickHouse/ClickHouse/pull/44493)（[chen](https://github.com/xiedeyantu)）。
* カラム名に関するヒントの重複を防止。[#44130](https://github.com/ClickHouse/ClickHouse/issues/44130) をクローズ。[#44519](https://github.com/ClickHouse/ClickHouse/pull/44519)（[Joanna Hulboj](https://github.com/jh0x)）。
* ディスクのエンドポイントでマクロ展開を許可。[#40951](https://github.com/ClickHouse/ClickHouse/issues/40951) を解決。[#44533](https://github.com/ClickHouse/ClickHouse/pull/44533)（[SmitaRKulkarni](https://github.com/SmitaRKulkarni)）。
* `input_format_json_read_object_as_string` が有効な場合のスキーマの推論を改善しました。 [#44546](https://github.com/ClickHouse/ClickHouse/pull/44546) ([Kruglov Pavel](https://github.com/Avogar))。
* `DatabaseReplicated` 内で引数付きの `ReplicatedMergeTree` テーブルの作成を禁止するためのユーザーレベル設定 `database_replicated_allow_replicated_engine_arguments` を追加しました。 [#44566](https://github.com/ClickHouse/ClickHouse/pull/44566) ([alesapin](https://github.com/alesapin)).
* ユーザーが誤って `index_granularity` に 0（無効な値）を指定してしまうことを防ぎます。これにより [#44536](https://github.com/ClickHouse/ClickHouse/issues/44536) がクローズされます。 [#44578](https://github.com/ClickHouse/ClickHouse/pull/44578)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* config.xml の `kerberos` セクション内の `keytab` パラメータで、サービスの keytab ファイルへのパスを設定できるようになりました。 [#44594](https://github.com/ClickHouse/ClickHouse/pull/44594) ([Roman Vasin](https://github.com/rvasin))
* すでに入力済みのクエリの一部をファジー検索に使用します（Rust で書かれ、ClickHouse に静的リンクされている `skim` ライブラリに渡します）。[#44600](https://github.com/ClickHouse/ClickHouse/pull/44600)（[Azat Khuzhin](https://github.com/azat)）。
* `JSON Object` 型が実験的な段階にある間にネストされた JSON オブジェクトを読み取れるようにするため、デフォルトで `input_format_json_read_objects_as_strings` を有効化しました。 [#44657](https://github.com/ClickHouse/ClickHouse/pull/44657) ([Kruglov Pavel](https://github.com/Avogar)).
* 非同期 INSERT の重複排除を改善：ユーザーが非同期 INSERT を重複して実行した場合、Keeper へ問い合わせる前にメモリ内で重複排除を行うようにしました。 [#44682](https://github.com/ClickHouse/ClickHouse/pull/44682) ([Han Fei](https://github.com/hanfei1991)).
* Input/output `Avro` フォーマットでは、bool 型を ClickHouse の bool 型として解釈します。 [#44684](https://github.com/ClickHouse/ClickHouse/pull/44684) ([Kruglov Pavel](https://github.com/Avogar)).
* Arrow/Parquet/ORC で Bool 型をサポート。[#43970](https://github.com/ClickHouse/ClickHouse/issues/43970) をクローズ。[#44698](https://github.com/ClickHouse/ClickHouse/pull/44698)（[Kruglov Pavel](https://github.com/Avogar)）。
* UUID を読み取る際にクォートの外まで貪欲にパースしないでください。誤ったデータを誤って正常にパースしてしまう可能性があります。 [#44686](https://github.com/ClickHouse/ClickHouse/pull/44686) ([Raúl Marín](https://github.com/Algunenano)).
* Int64 がオーバーフローする場合に UInt64 を推論し、スキーマ推論におけるいくつかの変換を修正。 [#44696](https://github.com/ClickHouse/ClickHouse/pull/44696) ([Kruglov Pavel](https://github.com/Avogar)).
* 以前は `Replicated` データベース内での依存関係の解決はハック的なやり方で行われていましたが、今は明示的なグラフ構造を用いて正しく実装されています。 [#44697](https://github.com/ClickHouse/ClickHouse/pull/44697) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))。
* `output_format_pretty_row_numbers` がブロック間でカウンターを保持しない問題を修正。[#44815](https://github.com/ClickHouse/ClickHouse/issues/44815) をクローズ。[#44832](https://github.com/ClickHouse/ClickHouse/pull/44832) ([flynn](https://github.com/ucasfl))。
* バックグラウンドのクリーンアップ処理と同時にパーツのマージが行われていることが原因で発生する `system.errors` へのエラー報告を抑止しました。 [#44874](https://github.com/ClickHouse/ClickHouse/pull/44874) ([Raúl Marín](https://github.com/Algunenano)).
* Distributed async INSERT 用のメトリクスを最適化および修正しました。 [#44922](https://github.com/ClickHouse/ClickHouse/pull/44922) ([Azat Khuzhin](https://github.com/azat)).
* 同時バックアップおよびリストアを禁止する設定を追加し、[#43891](https://github.com/ClickHouse/ClickHouse/issues/43891) を解決しました。実装内容: * Context で BackupWorker が作成される際に読み取り・設定される、同時バックアップおよびリストアを禁止するサーバーレベルの設定を追加しました。* 設定はデフォルトで true です。* バックアップまたはリストアを開始する前に、他のバックアップやリストアが実行中でないかを確認するチェックを追加しました。内部リクエストについては、backup&#95;uuid を使用して自ノードからのものかどうかを確認します。[#45072](https://github.com/ClickHouse/ClickHouse/pull/45072) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
* システムログ用に `<storage_policy>` 設定パラメータを追加しました。[#45320](https://github.com/ClickHouse/ClickHouse/pull/45320) ([Stig Bakken](https://github.com/stigsb))。

#### ビルド／テスト／パッケージングの改善 {#buildtestingpackaging-improvement-11}
* ClickHouse クライアント／ローカル履歴でのファジー検索のために、`skim` ライブラリ（Rust で実装）を静的リンクするようにしました。[#44239](https://github.com/ClickHouse/ClickHouse/pull/44239) ([Azat Khuzhin](https://github.com/azat)).
* Rust の都合により、共有リンクのサポートを削除しました。実際のところ、Rust はこの削除の口実にすぎず、いずれにしても削除したいと考えていました。[#44828](https://github.com/ClickHouse/ClickHouse/pull/44828) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* パッケージから `adduser` ツールへの依存関係を削除しました。使用していないためです。これにより [#44934](https://github.com/ClickHouse/ClickHouse/issues/44934) が修正されます。[#45011](https://github.com/ClickHouse/ClickHouse/pull/45011) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* `SQLite` ライブラリを最新版に更新しました。これは SQLite データベースおよびテーブル統合エンジンで使用されます。あわせて、誤検知の TSan レポートも修正しました。これにより [#45027](https://github.com/ClickHouse/ClickHouse/issues/45027) がクローズされます。[#45031](https://github.com/ClickHouse/ClickHouse/pull/45031) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* PowerPC における WeakHash の衝突問題に対応するため、CRC-32 を変更しました。[#45144](https://github.com/ClickHouse/ClickHouse/pull/45144) ([MeenaRenganathan22](https://github.com/MeenaRenganathan22)).
* aws-c* サブモジュールを更新しました。[#43020](https://github.com/ClickHouse/ClickHouse/pull/43020) ([Vitaly Baranov](https://github.com/vitlibar)).
* green（成功）なバックポート PR と、green（成功）かつ承認済みの PR を自動マージするようにしました。[#41110](https://github.com/ClickHouse/ClickHouse/pull/41110) ([Mikhail f. Shiryaev](https://github.com/Felixoid)).
* ClickHouse CI のステータスを確認できる[ウェブサイト](https://aretestsgreenyet.com/)を公開しました。[Source](https://github.com/ClickHouse/aretestsgreenyet).

#### バグ修正 {#bug-fix}

* ドメイン IP 型 (IPv4, IPv6) をネイティブ型に置き換えました。 [#43221](https://github.com/ClickHouse/ClickHouse/pull/43221) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。これにより、コード内で欠けていた一部の実装が自動的に補われます。
* バックアップ処理中にミューテーションが強制終了された場合の挙動を修正しました。 [#45351](https://github.com/ClickHouse/ClickHouse/pull/45351) ([Vitaly Baranov](https://github.com/vitlibar)).
* `Invalid number of rows in Chunk` という例外メッセージを修正しました。[#41404](https://github.com/ClickHouse/ClickHouse/issues/41404)。[#42126](https://github.com/ClickHouse/ClickHouse/pull/42126)（[Alexander Gololobov](https://github.com/davenger)）。
* ソート後に式を評価した際に未初期化の値が使用される可能性があった問題を修正。 [#43386](https://github.com/ClickHouse/ClickHouse/issues/43386) [#43635](https://github.com/ClickHouse/ClickHouse/pull/43635) をクローズ（[Kruglov Pavel](https://github.com/Avogar)）。
* 集約コンビネータにおける NULL の扱いを改善し、あまり一般的でない最適化である `optimize_rewrite_sum_if_to_count_if` を使用した際に発生しうるセグメンテーションフォルト／論理エラーを修正しました。これにより、[#43758](https://github.com/ClickHouse/ClickHouse/issues/43758) がクローズされました。[#43813](https://github.com/ClickHouse/ClickHouse/pull/43813)（[Kruglov Pavel](https://github.com/Avogar)）。
* CREATE USER/ROLE クエリにおける settings 制約を修正。 [#43993](https://github.com/ClickHouse/ClickHouse/pull/43993) ([Nikolay Degterinsky](https://github.com/evillique)).
* テーブルメタデータ内の `EPHEMERAL` カラムに、パースできないデフォルト値が設定されていたバグを修正しました。 [#44026](https://github.com/ClickHouse/ClickHouse/pull/44026) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* 互換性設定から取得した不正なバージョンの解析処理を修正。 [#44224](https://github.com/ClickHouse/ClickHouse/pull/44224) ([Kruglov Pavel](https://github.com/Avogar))
* 日時型からの interval 減算の動作を、加算時と同様にしました。 [#44241](https://github.com/ClickHouse/ClickHouse/pull/44241) ([ltrk2](https://github.com/ltrk2)).
* ビュー結果の最大サイズに関する制限を撤廃しました。 [#44261](https://github.com/ClickHouse/ClickHouse/pull/44261) ([lizhuoyu5](https://github.com/lzydmxy)).
* `do_not_evict_index_and_mrk_files=1` のときにキャッシュ内で発生しうる論理エラーを修正しました。[#42142](https://github.com/ClickHouse/ClickHouse/issues/42142) をクローズ。[#44268](https://github.com/ClickHouse/ClickHouse/pull/44268)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* ライトスルーキャッシュにおいて、キャッシュ書き込みが本来は中断されるべきでない状況で早期に中断されてしまう可能性があった問題を修正（誤った前提によりキャッシュ処理が停止してしまうことがあった）。 [#44289](https://github.com/ClickHouse/ClickHouse/pull/44289) ([Kseniia Sumarokova](https://github.com/kssenii)).
* `LowCardinality` と一緒に、定数引数を取る関数 `IN` が定数引数として使用された場合に発生する可能性のあったクラッシュを修正しました。[#44221](https://github.com/ClickHouse/ClickHouse/issues/44221) を修正します。[#44346](https://github.com/ClickHouse/ClickHouse/pull/44346)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* パラメトリックな集約関数の複雑なパラメータ（配列など）に対するサポートの不具合を修正しました。これにより [#30975](https://github.com/ClickHouse/ClickHouse/issues/30975) がクローズされました。この変更より前は、集約関数 `sumMapFiltered` は分散クエリで使用できませんでした。 [#44358](https://github.com/ClickHouse/ClickHouse/pull/44358) ([Alexey Milovidov](https://github.com/alexey-milovidov))。
* BSON スキーマ推論における ObjectId の読み取りを修正しました。 [#44382](https://github.com/ClickHouse/ClickHouse/pull/44382) ([Kruglov Pavel](https://github.com/Avogar)).
* ReplicatedMergeTree において、マージが完了する前に一時パーツが早期に削除されてしまう可能性のあるレースコンディションを修正しました。この問題により、`No such file or directory: xxx` のようなエラーが発生する可能性がありました。[#43983](https://github.com/ClickHouse/ClickHouse/issues/43983) を修正します。[#44383](https://github.com/ClickHouse/ClickHouse/pull/44383)（[alesapin](https://github.com/alesapin)）。
* クラスタ名が指定されていない場合、一部の無効な `SYSTEM ... ON CLUSTER` クエリが予期しない動作をしていました。この問題を修正し、現在は無効なクエリは本来どおり `SYNTAX_ERROR` をスローします。[#44264](https://github.com/ClickHouse/ClickHouse/issues/44264) を修正。 [#44387](https://github.com/ClickHouse/ClickHouse/pull/44387)（[Alexander Tokmakov](https://github.com/tavplubix)）。
* ORC 形式の Map 型の読み込みを修正。[#44400](https://github.com/ClickHouse/ClickHouse/pull/44400)（[Kruglov Pavel](https://github.com/Avogar)）。
* Parquet/ORC フォーマットにおいて、入力データに含まれないカラムを読み取る際の処理を修正しました。以前はこの問題により `INCORRECT_NUMBER_OF_COLUMNS` エラーが発生することがありました。[#44333](https://github.com/ClickHouse/ClickHouse/issues/44333) をクローズしました。[#44405](https://github.com/ClickHouse/ClickHouse/pull/44405)（[Kruglov Pavel](https://github.com/Avogar)）。
* 以前は、`bar` 関数は 5/8 と 6/8 のバーの表示に同じ &#39;▋&#39; (U+258B &quot;Left five eighths block&quot;) 文字が使われていました。この変更により、6/8 のバーの表示には &#39;▊&#39; (U+258A &quot;Left three quarters block&quot;) を使用するように修正されました。[#44410](https://github.com/ClickHouse/ClickHouse/pull/44410) ([Alexander Gololobov](https://github.com/davenger))。
* 設定ファイル内で profile settings constraints の後に profile settings を記述すると、constraints が効かなくなっていました。 [#44411](https://github.com/ClickHouse/ClickHouse/pull/44411) ([Konstantin Bogdanov](https://github.com/thevar1able)).
* データを含む `EXPLAIN AST INSERT` クエリを実行した際に発生する `SYNTAX_ERROR` を修正しました。[#44207](https://github.com/ClickHouse/ClickHouse/issues/44207) をクローズしました。 [#44413](https://github.com/ClickHouse/ClickHouse/pull/44413)（[save-my-heart](https://github.com/save-my-heart)）。
* CSV フォーマットで CRLF を含む bool 値を読み取る処理を修正。Closes [#44401](https://github.com/ClickHouse/ClickHouse/issues/44401). [#44442](https://github.com/ClickHouse/ClickHouse/pull/44442) ([Kruglov Pavel](https://github.com/Avogar)).
* LowCardinality 辞書上で and/or/if/multiIf 関数を実行しないようにし、その結果型が LowCardinality にならないようにしました。これは一部のケースで `Illegal column ColumnLowCardinality` エラーを引き起こす可能性がありました。この変更により [#43603](https://github.com/ClickHouse/ClickHouse/issues/43603) を修正しました。[#44469](https://github.com/ClickHouse/ClickHouse/pull/44469)（[Kruglov Pavel](https://github.com/Avogar)）。
* 設定 `max_streams_for_merge_tree_reading` で mutation を修正しました。 [#44472](https://github.com/ClickHouse/ClickHouse/pull/44472) ([Anton Popov](https://github.com/CurtizJ))。
* ASTSelectQuery::formatImpl において、GROUPING SETS 使用時に発生し得るヌルポインタ逆参照の問題を修正しました（[#43049](https://github.com/ClickHouse/ClickHouse/issues/43049)）。[#44479](https://github.com/ClickHouse/ClickHouse/pull/44479)（[Robert Schulze](https://github.com/rschu1ze)）。
* 設定に基づいて、テーブル関数の引数、CAST 関数の引数、および JSONAsObject のスキーマ推論における型を検証するようにしました。 [#44501](https://github.com/ClickHouse/ClickHouse/pull/44501) ([Kruglov Pavel](https://github.com/Avogar))。
* LowCardinality と定数列を組み合わせた IN 関数の問題を修正し、[#44503](https://github.com/ClickHouse/ClickHouse/issues/44503) をクローズ。[#44506](https://github.com/ClickHouse/ClickHouse/pull/44506)（[Duc Canh Le](https://github.com/canhld94)）。
* `CREATE TABLE` 文における `DEFAULT` 式の正規化処理で発生していたバグを修正しました。関数 `in` の第 2 引数（または演算子 `IN` の右辺引数）が、CREATE クエリの実行時にその評価結果に置き換えられてしまうことがありました。[#44496](https://github.com/ClickHouse/ClickHouse/issues/44496) を修正。[#44547](https://github.com/ClickHouse/ClickHouse/pull/44547)（[Alexander Tokmakov](https://github.com/tavplubix)）。
* `WITH ROLLUP`、`WITH CUBE`、`WITH TOTALS` を含む場合、プロジェクションは動作しません。以前のバージョンでは、プロジェクションの使用をスキップする代わりに、クエリが例外をスローしていました。これにより [#44614](https://github.com/ClickHouse/ClickHouse/issues/44614) がクローズされました。また、[#42772](https://github.com/ClickHouse/ClickHouse/issues/42772) もクローズされました。[#44615](https://github.com/ClickHouse/ClickHouse/pull/44615)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* 非同期ブロックがクリーンアップされなかったのは、関数 `get all blocks sorted by time` が非同期ブロックを取得していなかったことが原因です。 [#44651](https://github.com/ClickHouse/ClickHouse/pull/44651) ([Han Fei](https://github.com/hanfei1991)).
* サブクエリを伴う `JOIN`、`UNION`、および `TOTALS` で発生する `LOGICAL_ERROR`「The top step of the right pipeline should be ExpressionStep」を修正します。[#43687](https://github.com/ClickHouse/ClickHouse/issues/43687) を解決。 [#44673](https://github.com/ClickHouse/ClickHouse/pull/44673)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* Executable テーブルエンジンで `std::out_of_range` 例外が発生する問題を修正しました。 [#44681](https://github.com/ClickHouse/ClickHouse/pull/44681) ([Kruglov Pavel](https://github.com/Avogar)).
* AST 上の quantiles に対しては `optimize_syntax_fuse_functions` を適用しないようにし、[#44712](https://github.com/ClickHouse/ClickHouse/issues/44712) をクローズ。[#44713](https://github.com/ClickHouse/ClickHouse/pull/44713)（[Vladimir C](https://github.com/vdimir)）。
* Merge テーブルおよび PREWHERE での型不整合のバグを修正し、[#43324](https://github.com/ClickHouse/ClickHouse/issues/43324) をクローズ。[#44716](https://github.com/ClickHouse/ClickHouse/pull/44716)（[Vladimir C](https://github.com/vdimir)）。
* シャットダウン中（TraceCollector の破棄時）に発生する可能性のあるクラッシュを修正しました。[#44757](https://github.com/ClickHouse/ClickHouse/issues/44757) に対応。[#44758](https://github.com/ClickHouse/ClickHouse/pull/44758)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* 分散クエリ処理で発生しうるクラッシュを修正しました。`totals` または `extremes` を含むクエリが空の結果を返し、`Distributed` テーブルとローカルテーブルとの間で型が不一致な場合にクラッシュが発生する可能性がありました。[#44738](https://github.com/ClickHouse/ClickHouse/issues/44738) を修正しました。[#44760](https://github.com/ClickHouse/ClickHouse/pull/44760)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* フェッチ時の fsync（`min_compressed_bytes_to_fsync_after_fetch`）およびミューテーション時の小さいファイル（ttl.txt, columns.txt）に対する fsync（`min_rows_to_fsync_after_merge`/`min_compressed_bytes_to_fsync_after_merge`）の挙動を修正。 [#44781](https://github.com/ClickHouse/ClickHouse/pull/44781) ([Azat Khuzhin](https://github.com/azat)).
* ディスク間でパーツが移動されている状況で `system.parts` または `system.parts_columns` テーブルをクエリすると、まれにレースコンディションが発生する可能性がありました。[#41145](https://github.com/ClickHouse/ClickHouse/issues/41145) で導入された問題です。[#44809](https://github.com/ClickHouse/ClickHouse/pull/44809)（[Alexey Milovidov](https://github.com/alexey-milovidov)）。
* プロジェクションの最適化を有効にした場合に発生する可能性のある `Context has expired` エラーを修正しました。これは、実行時にコンテキストを使用する `dictHas` / `dictGet` などの特定の関数を含むクエリで再現できます。[#44844](https://github.com/ClickHouse/ClickHouse/issues/44844) を修正。[#44850](https://github.com/ClickHouse/ClickHouse/pull/44850)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* リモート fs から `LowCardinality` 辞書を読み込む際に発生する可能性がある `Cannot read all data` エラーを修正。 [#44709](https://github.com/ClickHouse/ClickHouse/issues/44709) を解決。 [#44875](https://github.com/ClickHouse/ClickHouse/pull/44875)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* ハードウェアモニターのセンサー値を読み取れない場合でも、ログに完全な例外メッセージを出力するのではなく、無視するようにしました。 [#44895](https://github.com/ClickHouse/ClickHouse/pull/44895) ([Raúl Marín](https://github.com/Algunenano)).
* 計算された INSERT の遅延時間が設定値を超えた場合には、`max_delay_to_insert` の値を使用します。 [#44902](https://github.com/ClickHouse/ClickHouse/issues/44902) に関連。 [#44916](https://github.com/ClickHouse/ClickHouse/pull/44916)（[Igor Nikonov](https://github.com/devcrafter)）。
* `UNION` を含むクエリで発生する `Different order of columns in UNION subquery` エラーを修正。 [#44866](https://github.com/ClickHouse/ClickHouse/issues/44866) を解決。 [#44920](https://github.com/ClickHouse/ClickHouse/pull/44920) ([Nikolai Kochetov](https://github.com/KochetovNicolai))。
* INSERT の遅延が正しく計算されない場合があり、その結果、正しい値ではなく常に `max_delay_to_insert` 設定値が遅延として使用されてしまう可能性がありました。単純な式 `max_delay_to_insert * (parts_over_threshold/max_allowed_parts_over_threshold)` を使用することで、しきい値を超えた `parts` 数に比例して遅延が増加するようにしました。[#44902](https://github.com/ClickHouse/ClickHouse/issues/44902) をクローズしました。[#44954](https://github.com/ClickHouse/ClickHouse/pull/44954)（[Igor Nikonov](https://github.com/devcrafter)）。
* ワイドパートに lightweight delete mask がある場合の `ALTER TABLE TTL` エラーを修正しました。 [#44959](https://github.com/ClickHouse/ClickHouse/pull/44959) ([Mingliang Pan](https://github.com/liangliangpan)).
* ドメイン IP 型（IPv4、IPv6）をネイティブ型に置き換える修正に関するフォローアップ [#43221](https://github.com/ClickHouse/ClickHouse/issues/43221)。[#45024](https://github.com/ClickHouse/ClickHouse/pull/45024)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* ドメイン IP 型（IPv4, IPv6）をネイティブ型に置き換える変更に対するフォローアップ修正 [https://github.com/ClickHouse/ClickHouse/pull/43221](https://github.com/ClickHouse/ClickHouse/pull/43221)。 [#45043](https://github.com/ClickHouse/ClickHouse/pull/45043)（[Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)）。
* パーサーでバッファオーバーフローが発生する可能性がありました。fuzzer によって検出されました。 [#45047](https://github.com/ClickHouse/ClickHouse/pull/45047) ([Alexey Milovidov](https://github.com/alexey-milovidov)).
* FileLog ストレージで発生する可能性がある cannot-read-all-data エラーを修正。[#45051](https://github.com/ClickHouse/ClickHouse/issues/45051)、[#38257](https://github.com/ClickHouse/ClickHouse/issues/38257) をクローズ。[#45057](https://github.com/ClickHouse/ClickHouse/pull/45057)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* クエリに GROUPING SETS が含まれている場合、メモリ効率の良い集計（`distributed_aggregation_memory_efficient` 設定）は無効になります。 [#45058](https://github.com/ClickHouse/ClickHouse/pull/45058) ([Nikita Taranov](https://github.com/nickitat))。
* `update_field` が指定されている場合の更新時に、`RANGE_HASHED` dictionary がレンジ列をプライマリキーの一部として扱うように修正します。[#44588](https://github.com/ClickHouse/ClickHouse/issues/44588) をクローズします。[#45061](https://github.com/ClickHouse/ClickHouse/pull/45061)（[Maksim Kita](https://github.com/kitaisreal)）。
* ネストされたラムダ内で `LowCardinality` をキャプチャした引数に対して発生するエラー `Cannot capture column` を修正しました。 [#45028](https://github.com/ClickHouse/ClickHouse/issues/45028) を修正。 [#45065](https://github.com/ClickHouse/ClickHouse/pull/45065)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）。
* minmax/count プロジェクションが使用されている場合に、`additional_table_filters` により誤ったクエリ結果となっていた問題（追加のフィルタが適用されていなかった）を修正しました。 [#45133](https://github.com/ClickHouse/ClickHouse/pull/45133) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* `histogram` 関数が負の値を受け付けていたバグを修正しました。[#45147](https://github.com/ClickHouse/ClickHouse/pull/45147) ([simpleton](https://github.com/rgzntrade))。
* StorageJoin におけるカラムの誤った NULL 許容設定を修正し、[#44940](https://github.com/ClickHouse/ClickHouse/issues/44940) をクローズ。[#45184](https://github.com/ClickHouse/ClickHouse/pull/45184)（[Vladimir C](https://github.com/vdimir)）。
* `background_fetches_pool_size` 設定のリロード処理（実行時に値を増加させる場合）を修正。 [#45189](https://github.com/ClickHouse/ClickHouse/pull/45189) ([Raúl Marín](https://github.com/Algunenano)).
* KV エンジン（例: KeeperMap、EmbeddedRocksDB）上の `SELECT` クエリで、キーに対して `IN` を使用する際に、サブクエリが異なる型を返す場合でも正しく処理できるようにしました。 [#45215](https://github.com/ClickHouse/ClickHouse/pull/45215) ([Antonio Andelic](https://github.com/antonio2368))。
* 一部のケースでの SEMI JOIN と join&#95;use&#95;nulls の論理エラーを修正し、[#45163](https://github.com/ClickHouse/ClickHouse/issues/45163) と [#45209](https://github.com/ClickHouse/ClickHouse/issues/45209) をクローズ。[#45230](https://github.com/ClickHouse/ClickHouse/pull/45230)（[Vladimir C](https://github.com/vdimir)）。
* S3 からの読み取り時に発生する heap-use-after-free を修正。 [#45253](https://github.com/ClickHouse/ClickHouse/pull/45253) ([Kruglov Pavel](https://github.com/Avogar)).
* Avro の Union 型が [&#39;null&#39;, Nested type] の場合のバグを修正し、[#45275](https://github.com/ClickHouse/ClickHouse/issues/45275) をクローズしました。`bytes` 型を誤って `Float` 型と推論してしまうバグを修正しました。[#45276](https://github.com/ClickHouse/ClickHouse/pull/45276) ([flynn](https://github.com/ucasfl))。
* ストレージエンジン `Merge` を使用するテーブルで明示的な PREWHERE を使用しようとした際に、それが許可されていない場合は適切な例外をスローするようにしました。 [#45319](https://github.com/ClickHouse/ClickHouse/pull/45319) ([Antonio Andelic](https://github.com/antonio2368)).
* WSL1 Ubuntu 上で自己解凍型の ClickHouse が展開に失敗する問題を修正しました。原因は不整合があり、`/proc/self/maps` が 32 ビットファイルの inode を報告する一方で、`stat` は 64 ビットの inode を報告していたためです。 [#45339](https://github.com/ClickHouse/ClickHouse/pull/45339) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy))。
* Distributed テーブルの起動時のレースコンディションを修正（async `INSERT` のファイルが複数回処理される可能性があった問題）。 [#45360](https://github.com/ClickHouse/ClickHouse/pull/45360) ([Azat Khuzhin](https://github.com/azat)).
* `ListObject` リクエストが失敗した場合に、ストレージ `S3` およびテーブル関数 `s3` から読み取る際にクラッシュが発生する可能性がある問題を修正しました。 [#45371](https://github.com/ClickHouse/ClickHouse/pull/45371) ([Anton Popov](https://github.com/CurtizJ)).
* 不正な構造の辞書（例: XML 設定内の型が誤っている場合）が存在する場合に発生していた `SELECT ... FROM system.dictionaries` 例外を修正。[#45399](https://github.com/ClickHouse/ClickHouse/pull/45399)（[Aleksei Filatov](https://github.com/aalexfvk)）。
* `INSERT INTO ... SELECT * FROM s3Cluster` クエリで挿入先テーブルの構造が使用される場合の s3Cluster のスキーマ推論を修正しました。 [#45422](https://github.com/ClickHouse/ClickHouse/pull/45422) ([Kruglov Pavel](https://github.com/Avogar)).
* HTTP を使用した JSON/BSONEachRow のパースにおいて、データ中の値ではなく一部のカラムにデフォルト値が使用されてしまう可能性があったバグを修正しました。 [#45424](https://github.com/ClickHouse/ClickHouse/pull/45424) ([Kruglov Pavel](https://github.com/Avogar)).
* テキストソースからの IP 型の型付きパース時に発生していたバグ（コード: 632. DB::Exception: Unexpected data ... after parsed IPv6 value ...）を修正しました。 [#45425](https://github.com/ClickHouse/ClickHouse/pull/45425) ([Yakov Olkhovskiy](https://github.com/yakov-olkhovskiy)).
* close [#45297](https://github.com/ClickHouse/ClickHouse/issues/45297) 空の正規表現に対するチェックを追加。[#45428](https://github.com/ClickHouse/ClickHouse/pull/45428) ([Han Fei](https://github.com/hanfei1991)).
* （特に分散クエリで発生しがちな）クエリのハングを修正。 [#45448](https://github.com/ClickHouse/ClickHouse/pull/45448) ([Azat Khuzhin](https://github.com/azat)).
* `ThreadPool::schedule` からの例外発生時に、`allow_asynchronous_read_from_io_pool_for_merge_tree` が有効な場合に発生し得たデッドロックを修正しました。 [#45481](https://github.com/ClickHouse/ClickHouse/pull/45481) ([Nikolai Kochetov](https://github.com/KochetovNicolai)).
* DETACH 後にテーブルが使用中のままになる可能性があった問題を修正。 [#45493](https://github.com/ClickHouse/ClickHouse/pull/45493) ([Azat Khuzhin](https://github.com/azat)).
* クエリがキャンセルされ、その実行中に並列パースが行われている場合にまれに発生する異常終了を修正しました。 [#45498](https://github.com/ClickHouse/ClickHouse/pull/45498) ([Anton Popov](https://github.com/CurtizJ)).
* Distributed テーブルの作成とそのテーブルへの INSERT の間に発生する race（競合状態）を修正（テーブルへの INSERT 実行中に CANNOT&#95;LINK が発生する可能性があった）。[#45502](https://github.com/ClickHouse/ClickHouse/pull/45502) ([Azat Khuzhin](https://github.com/azat)).
* キャッシュポリシーの getter に適切なデフォルト値（SLRU）を追加。 [#45514](https://github.com/ClickHouse/ClickHouse/issues/45514) をクローズ。 [#45524](https://github.com/ClickHouse/ClickHouse/pull/45524)（[Kseniia Sumarokova](https://github.com/kssenii)）。
* ミューテーションでの array join の使用を禁止します [#42637](https://github.com/ClickHouse/ClickHouse/issues/42637) [#44447](https://github.com/ClickHouse/ClickHouse/pull/44447) ([SmitaRKulkarni](https://github.com/SmitaRKulkarni))。
* エイリアス付きテーブル名およびカラムトランスフォーマーと組み合わせた修飾付きアスタリスクに関する不具合を修正。[#44736](https://github.com/ClickHouse/ClickHouse/issues/44736) を解決。[#44755](https://github.com/ClickHouse/ClickHouse/pull/44755)（[SmitaRKulkarni](https://github.com/SmitaRKulkarni)）。



## [2022年の変更履歴](/whats-new/changelog/2022) {#changelog-for-2022}
