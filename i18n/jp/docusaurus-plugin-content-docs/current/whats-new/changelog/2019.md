---
slug: /whats-new/changelog/2019
sidebar_position: 8
sidebar_label: '2019'
title: '2019年の変更履歴'
description: '2019年の変更履歴'
doc_type: 'changelog'
keywords: ['ClickHouse 2019', 'changelog 2019', 'release notes', 'version history', 'legacy releases']
---



## ClickHouse リリース 19.17 {#clickhouse-release-v19-17}

### ClickHouse リリース 19.17.6.36, 2019-12-27 {#clickhouse-release-v19-17-6-36-2019-12-27}

#### バグ修正 {#bug-fix}


* `decompress` におけるバッファオーバーフローの可能性を修正しました。悪意のあるユーザーが、バッファ範囲外の読み取りが発生するような細工された圧縮データを渡すことができていました。この問題は、Yandex の情報セキュリティチームの Eldar Zaitov によって発見されました。 [#8404](https://github.com/ClickHouse/ClickHouse/pull/8404) ([alexey-milovidov](https://github.com/alexey-milovidov))
* サーバーが `String` データ型（UTF-8 検証が必要）の値を含む JSON または XML 形式でデータを送信または書き込めない場合、あるいは結果データを Brotli アルゴリズムで圧縮する場合、またはその他のいくつかの稀なケースで、サーバーがクラッシュ（`std::terminate`）する可能性があった問題を修正。 [#8384](https://github.com/ClickHouse/ClickHouse/pull/8384) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ソースに ClickHouse の `VIEW` を使用する固定辞書を修正しました。これにより、そのような辞書を読み込んだ際に `There is no query` エラーが発生しなくなりました。 [#8351](https://github.com/ClickHouse/ClickHouse/pull/8351) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* users.xml で指定された host&#95;regexp によるクライアントホストの許可チェックを修正しました。 [#8241](https://github.com/ClickHouse/ClickHouse/pull/8241), [#8342](https://github.com/ClickHouse/ClickHouse/pull/8342) ([Vitaly Baranov](https://github.com/vitlibar))
* 分散テーブルに対する `RENAME TABLE` は、シャードに送信する前に、挿入されたデータを含むフォルダの名前を変更するようになりました。これにより、`tableA->tableB`、`tableC->tableA` といった連続したリネームに関する問題が修正されます。 [#8306](https://github.com/ClickHouse/ClickHouse/pull/8306) ([tavplubix](https://github.com/tavplubix))
* DDL クエリで作成された `range_hashed` 外部ディクショナリで、任意の数値型による範囲を使用できるようになりました。 [#8275](https://github.com/ClickHouse/ClickHouse/pull/8275) ([alesapin](https://github.com/alesapin))
* `INSERT INTO table SELECT ... FROM mysql(...)` テーブル関数を修正しました。 [#8234](https://github.com/ClickHouse/ClickHouse/pull/8234) ([tavplubix](https://github.com/tavplubix))
* 存在しないファイルに対して `INSERT INTO TABLE FUNCTION file()` を実行した際に発生していたセグメンテーションフォールトを修正しました。このケースでは、まずファイルが作成され、その後に挿入処理が実行されるようになりました。 [#8177](https://github.com/ClickHouse/ClickHouse/pull/8177) ([Olga Khvostikova](https://github.com/stavrolia))
* 集計済みビットマップとスカラービットマップの積集合をとる際に発生していた `bitmapAnd` のエラーを修正。 [#8082](https://github.com/ClickHouse/ClickHouse/pull/8082) ([Yue Huang](https://github.com/moon03432))
* `TABLE` や `DICTIONARY` 修飾子を付けずに、`EXISTS t` のように `EXISTS` クエリが使用された場合に発生していたセグメンテーションフォルトを修正しました。 [#8213](https://github.com/ClickHouse/ClickHouse/pull/8213) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `Nullable` 引数が指定された場合の `rand` と `randConstant` 関数の戻り値の型を修正しました。これらの関数は常に `UInt32` を返し、`Nullable(UInt32)` を返すことはなくなりました。 [#8204](https://github.com/ClickHouse/ClickHouse/pull/8204) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* `db` が存在しない場合でも例外をスローしないように、`DROP DICTIONARY IF EXISTS db.dict` を修正しました。 [#8185](https://github.com/ClickHouse/ClickHouse/pull/8185) ([Vitaly Baranov](https://github.com/vitlibar))
* テーブルがサーバークラッシュにより完全には削除されなかった場合、サーバーはそのテーブルを復元して読み込もうとします [#8176](https://github.com/ClickHouse/ClickHouse/pull/8176) ([tavplubix](https://github.com/tavplubix))
* 2 つ以上のシャードのローカルテーブルがある場合に、分散テーブルに対する単純な `count` クエリが正しく動作しない問題を修正しました。 [#8164](https://github.com/ClickHouse/ClickHouse/pull/8164) ([小路](https://github.com/nicelulu))
* DB::BlockStreamProfileInfo::calculateRowsBeforeLimit() で発生していたデータ競合の原因となるバグを修正 [#8143](https://github.com/ClickHouse/ClickHouse/pull/8143) ([Alexander Kazakov](https://github.com/Akazz))
* 指定したパーツのマージ直後に実行された `ALTER table MOVE part` の動作を修正しました。以前は、その結果として、指定したパーツがマージされた「移行先」のパーツを移動してしまう可能性がありましたが、現在は指定したパーツ自体を正しく移動するようになりました。 [#8104](https://github.com/ClickHouse/ClickHouse/pull/8104) ([Vladimir Chebotarev](https://github.com/excitoon))
* 辞書の式を文字列として指定できるようになりました。これは、非 ClickHouse ソースからデータを抽出する際に属性を計算する場合に便利で、それらの式に対して非 ClickHouse の構文を利用できるようになります。 [#8098](https://github.com/ClickHouse/ClickHouse/pull/8098) ([alesapin](https://github.com/alesapin))
* ZXid のオーバーフローが原因で発生していた、`clickhouse-copier` における極めてまれなレースコンディションを修正しました。 [#8088](https://github.com/ClickHouse/ClickHouse/pull/8088) ([Ding Xiang Fei](https://github.com/dingxiangfei2009))
* クエリが失敗した後（例えば「Too many simultaneous queries」が原因の場合）、外部テーブルの情報が読み込まれず、その結果、次のリクエストがこの情報を次のクエリの先頭として解釈して `Unknown packet from client` のようなエラーを引き起こしていたバグを修正しました。 [#8084](https://github.com/ClickHouse/ClickHouse/pull/8084) ([Azat Khuzhin](https://github.com/azat))
* サーバーからの「Unknown packet X from server」エラー発生後の null 参照を回避 [#8071](https://github.com/ClickHouse/ClickHouse/pull/8071) ([Azat Khuzhin](https://github.com/azat))
* すべての ICU ロケールのサポートを復元し、定数式に照合順序を適用できるようにし、`system.collations` テーブルに言語名を追加しました。 [#8051](https://github.com/ClickHouse/ClickHouse/pull/8051) ([alesapin](https://github.com/alesapin))
* `StorageFile` と `StorageHDFS` からの読み取りに使用されるストリーム数が、メモリ制限を超えないように制限されるようになりました。 [#7981](https://github.com/ClickHouse/ClickHouse/pull/7981) ([alesapin](https://github.com/alesapin))
* キーを持たない `*MergeTree` テーブルに対する `CHECK TABLE` クエリを修正。 [#7979](https://github.com/ClickHouse/ClickHouse/pull/7979) ([alesapin](https://github.com/alesapin))
* ミューテーションが存在しない場合、パーツ名からミューテーション番号を削除しました。この変更により、古いバージョンとの互換性が向上しました。 [#8250](https://github.com/ClickHouse/ClickHouse/pull/8250) ([alesapin](https://github.com/alesapin))
* 一部のアタッチされたパーツで、`data_version` がテーブルのミューテーションバージョンより大きいためにミューテーションがスキップされてしまうバグを修正しました。 [#7812](https://github.com/ClickHouse/ClickHouse/pull/7812) ([Zhichang Yu](https://github.com/yuzhichang))
* パーツを別のデバイスに移動した後でも、その冗長コピーを保持したままサーバーを起動できるようにしました。 [#7810](https://github.com/ClickHouse/ClickHouse/pull/7810) ([Vladimir Chebotarev](https://github.com/excitoon))
* 集約関数の列を使用した際に発生する可能性があったエラー「Sizes of columns does not match」を修正しました。 [#7790](https://github.com/ClickHouse/ClickHouse/pull/7790) ([Boris Granveaud](https://github.com/bgranvea))
* `WITH TIES` を `LIMIT BY` と併用した場合には、例外がスローされるようになりました。また、`TOP` を `LIMIT BY` と組み合わせて使用できるようになりました。 [#7637](https://github.com/ClickHouse/ClickHouse/pull/7637) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))
* `invalidate_query` を使用している辞書のリロード処理を修正。これにより、更新が停止したり、以前の更新試行で例外が発生したりしていた問題を解消。[#8029](https://github.com/ClickHouse/ClickHouse/pull/8029) ([alesapin](https://github.com/alesapin))

### ClickHouse リリース 19.17.4.11, 2019-11-22 {#clickhouse-release-v19-17-4-11-2019-11-22}

#### 後方互換性のない変更 {#backward-incompatible-change}

- パフォーマンス向上のため、スカラーサブクエリの結果を保存する際にASTの代わりにカラムを使用するようになりました。設定 `enable_scalar_subquery_optimization` は19.17で追加され、デフォルトで有効化されていました。これにより、以前のバージョンから19.17.2または19.17.3へのアップグレード時に[このような](https://github.com/ClickHouse/ClickHouse/issues/7851)エラーが発生していました。この設定は19.17.4でデフォルトで無効化され、19.16以前のバージョンからエラーなしでアップグレードできるようになりました。[#7392](https://github.com/ClickHouse/ClickHouse/pull/7392) ([Amos Bird](https://github.com/amosbird))

#### 新機能 {#new-feature}

- DDLクエリでディクショナリを作成する機能を追加しました。[#7360](https://github.com/ClickHouse/ClickHouse/pull/7360) ([alesapin](https://github.com/alesapin))
- `bloom_filter` タイプのインデックスが `LowCardinality` と `Nullable` をサポートするようになりました。[#7363](https://github.com/ClickHouse/ClickHouse/issues/7363) [#7561](https://github.com/ClickHouse/ClickHouse/pull/7561) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- 渡された文字列が有効なJSONであるかをチェックする関数 `isValidJSON` を追加しました。[#5910](https://github.com/ClickHouse/ClickHouse/issues/5910) [#7293](https://github.com/ClickHouse/ClickHouse/pull/7293) ([Vdimir](https://github.com/Vdimir))
- 関数 `arrayCompact` を実装しました。[#7328](https://github.com/ClickHouse/ClickHouse/pull/7328) ([Memo](https://github.com/Joeywzr))
- Decimal型の数値用の関数 `hex` を作成しました。`hex(reinterpretAsString())` と同様に動作しますが、末尾のゼロバイトを削除しません。[#7355](https://github.com/ClickHouse/ClickHouse/pull/7355) ([Mikhail Korotov](https://github.com/millb))
- 配列内の要素を前方/後方の他の要素で置き換える関数 `arrayFill` と `arrayReverseFill` を追加しました。[#7380](https://github.com/ClickHouse/ClickHouse/pull/7380) ([hcz](https://github.com/hczhcz))
- `CRC32IEEE()`/`CRC64()` のサポートを追加しました。[#7480](https://github.com/ClickHouse/ClickHouse/pull/7480) ([Azat Khuzhin](https://github.com/azat))
- [MySQL](https://dev.mysql.com/doc/refman/8.0/en/string-functions.html#function_char)と同様の関数 `char` を実装しました。[#7486](https://github.com/ClickHouse/ClickHouse/pull/7486) ([sundyli](https://github.com/sundy-li))
- 関数 `bitmapTransform` を追加しました。ビットマップ内の値の配列を別の値の配列に変換し、結果として新しいビットマップを返します。[#7598](https://github.com/ClickHouse/ClickHouse/pull/7598) ([Zhichang Yu](https://github.com/yuzhichang))
- 関数 `javaHashUTF16LE()` を実装しました。[#7651](https://github.com/ClickHouse/ClickHouse/pull/7651) ([achimbab](https://github.com/achimbab))
- Distributedエンジン用の仮想カラム `_shard_num` を追加しました。[#7624](https://github.com/ClickHouse/ClickHouse/pull/7624) ([Azat Khuzhin](https://github.com/azat))

#### 実験的機能 {#experimental-feature}

- `MergeTree` でのプロセッサ(新しいクエリ実行パイプライン)のサポート。[#7181](https://github.com/ClickHouse/ClickHouse/pull/7181) ([Nikolai Kochetov](https://github.com/KochetovNicolai))

#### バグ修正 {#bug-fix-1}


* `Values` における浮動小数点数の不正なパースを修正 [#7817](https://github.com/ClickHouse/ClickHouse/issues/7817) [#7870](https://github.com/ClickHouse/ClickHouse/pull/7870) ([tavplubix](https://github.com/tavplubix))
* `trace_log` が有効な場合にまれに発生する可能性があるデッドロックを修正。 [#7838](https://github.com/ClickHouse/ClickHouse/pull/7838) ([filimonov](https://github.com/filimonov))
* Kafka テーブルに対してメッセージを書き込む際、そのテーブルを参照する任意の MV が存在していてもメッセージが重複しないように防止 [#7265](https://github.com/ClickHouse/ClickHouse/pull/7265) ([Ivan](https://github.com/abyss7))
* `IN` における `Array(LowCardinality(Nullable(String)))` のサポートを追加。 [#7364](https://github.com/ClickHouse/ClickHouse/issues/7364) [#7366](https://github.com/ClickHouse/ClickHouse/pull/7366) を解決 ([achimbab](https://github.com/achimbab))
* ODBC Bridge において、`SQL_TINYINT` および `SQL_BIGINT` の処理を追加し、`SQL_FLOAT` データソース型の処理を修正しました。 [#7491](https://github.com/ClickHouse/ClickHouse/pull/7491) ([Denis Glazachev](https://github.com/traceon))
* 空の Decimal 列に対する集約（`avg` と quantiles）の処理を修正 [#7431](https://github.com/ClickHouse/ClickHouse/pull/7431) ([Andrey Konyaev](https://github.com/akonyaev90))
* `MATERIALIZED` 列を含む Distributed への `INSERT` を修正 [#7377](https://github.com/ClickHouse/ClickHouse/pull/7377) ([Azat Khuzhin](https://github.com/azat))
* パーティションの一部のパーツがすでに移動先ディスクまたはボリューム上に存在している場合でも、`MOVE PARTITION` が動作するようにしました [#7434](https://github.com/ClickHouse/ClickHouse/pull/7434) ([Vladimir Chebotarev](https://github.com/excitoon))
* マルチディスク構成において、`ReplicatedMergeTree` のミューテーション処理中にハードリンクの作成が失敗するバグを修正しました。 [#7558](https://github.com/ClickHouse/ClickHouse/pull/7558) ([Vladimir Chebotarev](https://github.com/excitoon))
* MergeTree のミューテーションにおいて、パーツ全体が変更されないまま残り、より適した空き領域が別ディスク上で見つかる場合に発生していたバグを修正 [#7602](https://github.com/ClickHouse/ClickHouse/pull/7602) ([Vladimir Chebotarev](https://github.com/excitoon))
* `keep_free_space_ratio` が disks の設定から読み込まれない不具合を修正 [#7645](https://github.com/ClickHouse/ClickHouse/pull/7645) ([Vladimir Chebotarev](https://github.com/excitoon))
* `Tuple` 列のみ、または複雑なパスを持つ列のみで構成されるテーブルで発生していたバグを修正。 [7541](https://github.com/ClickHouse/ClickHouse/issues/7541) を修正。 [#7545](https://github.com/ClickHouse/ClickHouse/pull/7545) ([alesapin](https://github.com/alesapin))
* `Buffer` エンジンのメモリを `max_memory_usage` 制限の対象外にする [#7552](https://github.com/ClickHouse/ClickHouse/pull/7552) ([Azat Khuzhin](https://github.com/azat))
* `tuple()` で並べ替えられた `MergeTree` テーブルにおける final mark の使用方法を修正しました。まれなケースで、SELECT 実行中に `Can't adjust last granule` エラーが発生する可能性がありました。 [#7639](https://github.com/ClickHouse/ClickHouse/pull/7639) ([Anton Popov](https://github.com/CurtizJ))
* コンテキストを必要とするアクション（たとえば JSON 用の関数）を含む述語を持つミューテーションで、クラッシュや異常な例外を引き起こす可能性があったバグを修正。 [#7664](https://github.com/ClickHouse/ClickHouse/pull/7664) ([alesapin](https://github.com/alesapin))
* `data/` ディレクトリと `shadow/` ディレクトリにおけるデータベース名およびテーブル名のエスケープ方法の不一致を修正 [#7575](https://github.com/ClickHouse/ClickHouse/pull/7575) ([Alexander Burmak](https://github.com/Alex-Burmak))
* RIGHT|FULL JOIN における重複キーをサポートします（例：`ON t.x = u.x AND t.x = u.y`）。このケースで発生していたクラッシュを修正しました。 [#7586](https://github.com/ClickHouse/ClickHouse/pull/7586) ([Artem Zuikov](https://github.com/4ertus2))
* RIGHT または FULL JOIN で式を結合条件に使用した際に発生する `Not found column &lt;expression&gt; in block` エラーを修正。 [#7641](https://github.com/ClickHouse/ClickHouse/pull/7641) ([Artem Zuikov](https://github.com/4ertus2))
* `PrettySpace` フォーマットの無限ループを修正するためのさらなる試み [#7591](https://github.com/ClickHouse/ClickHouse/pull/7591) ([Olga Khvostikova](https://github.com/stavrolia))
* すべての引数が同じサイズの `FixedString` 型である場合の `concat` 関数のバグを修正しました。 [#7635](https://github.com/ClickHouse/ClickHouse/pull/7635) ([alesapin](https://github.com/alesapin))
* S3、URL、HDFS ストレージを定義する際に引数を 1 つだけ使用した場合に発生していた例外を修正。 [#7618](https://github.com/ClickHouse/ClickHouse/pull/7618) ([Vladimir Chebotarev](https://github.com/excitoon))
* クエリを持つビューに対する `InterpreterSelectQuery` のスコープを修正 [#7601](https://github.com/ClickHouse/ClickHouse/pull/7601) ([Azat Khuzhin](https://github.com/azat))

#### 改善 {#improvement}

- ODBC-bridgeで`Nullable`カラムを認識し、NULL値を正しく処理 [#7402](https://github.com/ClickHouse/ClickHouse/pull/7402) ([Vasily Nemkov](https://github.com/Enmk))
- 分散送信の現在のバッチをアトミックに書き込み [#7600](https://github.com/ClickHouse/ClickHouse/pull/7600) ([Azat Khuzhin](https://github.com/azat))
- クエリ内のカラム名に対してテーブルを検出できない場合に例外をスロー [#7358](https://github.com/ClickHouse/ClickHouse/pull/7358) ([Artem Zuikov](https://github.com/4ertus2))
- `MergeTreeSettings`に`merge_max_block_size`設定を追加 [#7412](https://github.com/ClickHouse/ClickHouse/pull/7412) ([Artem Zuikov](https://github.com/4ertus2))
- `HAVING`を含み`GROUP BY`を含まないクエリは定数によるグループ化を想定するように変更。これにより、`SELECT 1 HAVING 1`が結果を返すようになりました [#7496](https://github.com/ClickHouse/ClickHouse/pull/7496) ([Amos Bird](https://github.com/amosbird))
- Pythonと同様に`(X,)`をタプルとして解析する機能をサポート [#7501](https://github.com/ClickHouse/ClickHouse/pull/7501), [#7562](https://github.com/ClickHouse/ClickHouse/pull/7562) ([Amos Bird](https://github.com/amosbird))
- `range`関数の動作をPythonのものとほぼ同様に変更 [#7518](https://github.com/ClickHouse/ClickHouse/pull/7518) ([sundyli](https://github.com/sundy-li))
- `system.settings`テーブルに`constraints`カラムを追加 [#7553](https://github.com/ClickHouse/ClickHouse/pull/7553) ([Vitaly Baranov](https://github.com/vitlibar))
- TCPハンドラーのNull形式を改善し、clickhouse-client経由でパフォーマンス測定のために`select ignore(<expression>) from table format Null`を使用可能に [#7606](https://github.com/ClickHouse/ClickHouse/pull/7606) ([Amos Bird](https://github.com/amosbird))
- `CREATE TABLE ... AS (SELECT (1, 2))`のようなクエリが正しく解析されるように修正 [#7542](https://github.com/ClickHouse/ClickHouse/pull/7542) ([hcz](https://github.com/hczhcz))

#### パフォーマンス改善 {#performance-improvement}

- 短い文字列キーに対する集約のパフォーマンスを改善 [#6243](https://github.com/ClickHouse/ClickHouse/pull/6243) ([Alexander Kuzmenkov](https://github.com/akuzm), [Amos Bird](https://github.com/amosbird))
- 定数述語が畳み込まれた後に潜在的な最適化を取得するため、構文/式解析の追加パスを実行 [#7497](https://github.com/ClickHouse/ClickHouse/pull/7497) ([Amos Bird](https://github.com/amosbird))
- ストレージメタ情報を使用して単純な`SELECT count() FROM table;`を評価 [#7510](https://github.com/ClickHouse/ClickHouse/pull/7510) ([Amos Bird](https://github.com/amosbird), [alexey-milovidov](https://github.com/alexey-milovidov))
- Aggregatorの`addBatch`と同様に`arrayReduce`の処理をベクトル化 [#7608](https://github.com/ClickHouse/ClickHouse/pull/7608) ([Amos Bird](https://github.com/amosbird))
- `Kafka`消費のパフォーマンスにおける軽微な改善 [#7475](https://github.com/ClickHouse/ClickHouse/pull/7475) ([Ivan](https://github.com/abyss7))

#### ビルド/テスト/パッケージング改善 {#buildtestingpackaging-improvement}


- CPUアーキテクチャAARCH64へのクロスコンパイルのサポートを追加。パッケージャースクリプトをリファクタリング。[#7370](https://github.com/ClickHouse/ClickHouse/pull/7370) [#7539](https://github.com/ClickHouse/ClickHouse/pull/7539) ([Ivan](https://github.com/abyss7))
- パッケージビルド時にdarwin-x86_64およびlinux-aarch64ツールチェーンをマウントされたDockerボリュームに展開 [#7534](https://github.com/ClickHouse/ClickHouse/pull/7534) ([Ivan](https://github.com/abyss7))
- バイナリパッケージャー用のDockerイメージを更新 [#7474](https://github.com/ClickHouse/ClickHouse/pull/7474) ([Ivan](https://github.com/abyss7))
- macOS Catalinaでのコンパイルエラーを修正 [#7585](https://github.com/ClickHouse/ClickHouse/pull/7585) ([Ernest Poletaev](https://github.com/ernestp))
- クエリ解析ロジックのリファクタリング: 複雑なクラスを複数のシンプルなクラスに分割。[#7454](https://github.com/ClickHouse/ClickHouse/pull/7454) ([Artem Zuikov](https://github.com/4ertus2))
- サブモジュールなしでのビルドを修正 [#7295](https://github.com/ClickHouse/ClickHouse/pull/7295) ([proller](https://github.com/proller))
- CMakeファイルの`add_globs`を改善 [#7418](https://github.com/ClickHouse/ClickHouse/pull/7418) ([Amos Bird](https://github.com/amosbird))
- `unwind`ターゲットのハードコードされたパスを削除 [#7460](https://github.com/ClickHouse/ClickHouse/pull/7460) ([Konstantin Podshumok](https://github.com/podshumok))
- SSLなしでmysqlフォーマットを使用できるように変更 [#7524](https://github.com/ClickHouse/ClickHouse/pull/7524) ([proller](https://github.com/proller))

#### その他 {#other}

- ClickHouse SQL方言用のANTLR4文法を追加 [#7595](https://github.com/ClickHouse/ClickHouse/issues/7595) [#7596](https://github.com/ClickHouse/ClickHouse/pull/7596) ([alexey-milovidov](https://github.com/alexey-milovidov))


## ClickHouse リリース 19.16 {#clickhouse-release-v19-16}

#### ClickHouse リリース 19.16.14.65, 2020-03-25 {#clickhouse-release-v19-16-14-65-2020-03-25}

- 複数の引数(10個以上)に対する三項論理演算のバッチ計算におけるバグを修正しました。[#8718](https://github.com/ClickHouse/ClickHouse/pull/8718) ([Alexander Kazakov](https://github.com/Akazz)) このバグ修正は、Altinityからの特別な要請によりバージョン19.16にバックポートされました。

#### ClickHouse リリース 19.16.14.65, 2020-03-05 {#clickhouse-release-v19-16-14-65-2020-03-05}

- 古いCHバージョンとの分散サブクエリの非互換性を修正しました。修正内容: [#7851](https://github.com/ClickHouse/ClickHouse/issues/7851)
  [(tabplubix)](https://github.com/tavplubix)
- `CREATE`クエリ実行時に、ストレージエンジン引数内の定数式を畳み込むようにしました。空のデータベース名を現在のデータベースに置き換えます。修正内容: [#6508](https://github.com/ClickHouse/ClickHouse/issues/6508)、[#3492](https://github.com/ClickHouse/ClickHouse/issues/3492)。また、`ClickHouseDictionarySource`におけるローカルアドレスのチェックを修正しました。
  [#9262](https://github.com/ClickHouse/ClickHouse/pull/9262) [(tabplubix)](https://github.com/tavplubix)
- `*MergeTree`テーブルエンジンファミリーにおけるバックグラウンドマージが、ストレージポリシーのボリューム順序をより正確に保持するようになりました。
  [#8549](https://github.com/ClickHouse/ClickHouse/pull/8549) ([Vladimir Chebotarev](https://github.com/excitoon))
- サフィックス読み取り後、コミット前に例外が発生した場合の稀なケースにおいて、`Kafka`でのデータ損失を防止しました。修正内容: [#9378](https://github.com/ClickHouse/ClickHouse/issues/9378)。関連: [#7175](https://github.com/ClickHouse/ClickHouse/issues/7175)
  [#9507](https://github.com/ClickHouse/ClickHouse/pull/9507) [(filimonov)](https://github.com/filimonov)
- 誤ったパラメータで作成された`Kafka`テーブルを使用/削除しようとした際にサーバーが終了するバグを修正しました。修正内容: [#9494](https://github.com/ClickHouse/ClickHouse/issues/9494)。組み込み: [#9507](https://github.com/ClickHouse/ClickHouse/issues/9507)。
  [#9513](https://github.com/ClickHouse/ClickHouse/pull/9513) [(filimonov)](https://github.com/filimonov)
- `Kafka`テーブル上でサブクエリを含む`MaterializedView`の使用を許可しました。
  [#8197](https://github.com/ClickHouse/ClickHouse/pull/8197) ([filimonov](https://github.com/filimonov))

#### 新機能 {#new-feature-1}

- マテリアライズドビューを持つテーブルへの冪等挿入の動作を制御する`deduplicate_blocks_in_dependent_materialized_views`オプションを追加しました。この新機能は、Altinityからの特別な要請によりバグ修正リリースに追加されました。
  [#9070](https://github.com/ClickHouse/ClickHouse/pull/9070) [(urykhy)](https://github.com/urykhy)

### ClickHouse リリース 19.16.2.2, 2019-10-30 {#clickhouse-release-v19-16-2-2-2019-10-30}

#### 後方互換性のない変更 {#backward-incompatible-change-1}

- count/countIfに対する欠落していた引数数検証を追加しました。
  [#7095](https://github.com/ClickHouse/ClickHouse/issues/7095)
  [#7298](https://github.com/ClickHouse/ClickHouse/pull/7298) ([Vdimir](https://github.com/Vdimir))
- レガシーの`asterisk_left_columns_only`設定を削除しました(デフォルトで無効化されていました)。
  [#7335](https://github.com/ClickHouse/ClickHouse/pull/7335) ([Artem
  Zuikov](https://github.com/4ertus2))
- Templateデータフォーマットのフォーマット文字列がファイルで指定されるようになりました。
  [#7118](https://github.com/ClickHouse/ClickHouse/pull/7118)
  ([tavplubix](https://github.com/tavplubix))

#### 新機能 {#new-feature-2}


- UINT_MAXを超えるカーディナリティを計算するためのuniqCombined64()を導入しました。
  [#7213](https://github.com/ClickHouse/ClickHouse/pull/7213),
  [#7222](https://github.com/ClickHouse/ClickHouse/pull/7222) ([Azat
  Khuzhin](https://github.com/azat))
- Array型カラムに対するBloomフィルタインデックスをサポートしました。
  [#6984](https://github.com/ClickHouse/ClickHouse/pull/6984)
  ([achimbab](https://github.com/achimbab))
- サーバー設定の対応する`<macros>`の値を文字列として返す関数`getMacro(name)`を追加しました。[#7240](https://github.com/ClickHouse/ClickHouse/pull/7240)
  ([alexey-milovidov](https://github.com/alexey-milovidov))
- HTTPソースに基づくディクショナリに対して、`credentials`と`http-headers`の2つの設定オプションを設定できるようにしました。[#7092](https://github.com/ClickHouse/ClickHouse/pull/7092) ([Guillaume
  Tassery](https://github.com/YiuRULE))
- 起動されたバックグラウンドマージの数をカウントする新しいProfileEvent `Merge`を追加しました。
  [#7093](https://github.com/ClickHouse/ClickHouse/pull/7093) ([Mikhail
  Korotov](https://github.com/millb))
- 完全修飾ドメイン名を返すfullHostName関数を追加しました。
  [#7263](https://github.com/ClickHouse/ClickHouse/issues/7263)
  [#7291](https://github.com/ClickHouse/ClickHouse/pull/7291) ([sundyli](https://github.com/sundy-li))
- 「カットオフ」条件によって配列を分割する関数`arraySplit`と`arrayReverseSplit`を追加しました。これらは時系列データの処理に有用です。
  [#7294](https://github.com/ClickHouse/ClickHouse/pull/7294) ([hcz](https://github.com/hczhcz))
- multiMatchファミリーの関数において、マッチしたすべてのインデックスの配列を返す新しい関数を追加しました。
  [#7299](https://github.com/ClickHouse/ClickHouse/pull/7299) ([Danila
  Kutenin](https://github.com/danlark1))
- 多数の小規模な-Logテーブルの保存に最適化された新しいデータベースエンジン`Lazy`を追加しました。[#7171](https://github.com/ClickHouse/ClickHouse/pull/7171) ([Nikita
  Vasilev](https://github.com/nikvas0))
- ビットマップカラム用の集約関数groupBitmapAnd、-Or、-Xorを追加しました。[#7109](https://github.com/ClickHouse/ClickHouse/pull/7109) ([Zhichang
  Yu](https://github.com/yuzhichang))
- 集約対象が存在しない場合にnullまたはデフォルト値を返す集約関数コンビネータ-OrNullと-OrDefaultを追加しました。
  [#7331](https://github.com/ClickHouse/ClickHouse/pull/7331)
  ([hcz](https://github.com/hczhcz))
- カスタムエスケープおよび区切り文字ルールをサポートするCustomSeparatedデータフォーマットを導入しました。[#7118](https://github.com/ClickHouse/ClickHouse/pull/7118)
  ([tavplubix](https://github.com/tavplubix))
- 外部ディクショナリのソースとしてRedisをサポートしました。[#4361](https://github.com/ClickHouse/ClickHouse/pull/4361) [#6962](https://github.com/ClickHouse/ClickHouse/pull/6962) ([comunodi](https://github.com/comunodi), [Anton
  Popov](https://github.com/CurtizJ))

#### バグ修正 {#bug-fix-2}


- `WHERE IN (SELECT ...)` 句を含み、`optimize_read_in_order` が使用されている場合のクエリ結果の誤りを修正しました。[#7371](https://github.com/ClickHouse/ClickHouse/pull/7371) ([Anton
  Popov](https://github.com/CurtizJ))
- プロジェクト外のファイルに依存するMariaDB認証プラグインを無効化しました。[#7140](https://github.com/ClickHouse/ClickHouse/pull/7140) ([Yuriy
  Baranov](https://github.com/yurriy))
- 関数 `now()`、`today()`、`yesterday()`、`randConstant()` を使用した際に稀に発生する例外 `Cannot convert column ... because it is constant but values of constants are different in source and result` を修正しました。[#7156](https://github.com/ClickHouse/ClickHouse/pull/7156) ([Nikolai
  Kochetov](https://github.com/KochetovNicolai))
- TCPキープアライブタイムアウトの代わりにHTTPキープアライブタイムアウトが使用されていた問題を修正しました。[#7351](https://github.com/ClickHouse/ClickHouse/pull/7351) ([Vasily
  Nemkov](https://github.com/Enmk))
- groupBitmapOrにおけるセグメンテーション違反を修正しました (issue [#7109](https://github.com/ClickHouse/ClickHouse/issues/7109))。[#7289](https://github.com/ClickHouse/ClickHouse/pull/7289) ([Zhichang
  Yu](https://github.com/yuzhichang))
- マテリアライズドビューにおいて、すべてのデータが書き込まれた後にKafkaのコミットが呼び出されるようになりました。[#7175](https://github.com/ClickHouse/ClickHouse/pull/7175) ([Ivan](https://github.com/abyss7))
- `system.part_log` テーブルの `duration_ms` 値の誤りを修正しました。10倍の値になっていました。[#7172](https://github.com/ClickHouse/ClickHouse/pull/7172) ([Vladimir
  Chebotarev](https://github.com/excitoon))
- LIVE VIEWテーブルのクラッシュを解決し、すべてのLIVE VIEWテストを再有効化するための迅速な修正を行いました。[#7201](https://github.com/ClickHouse/ClickHouse/pull/7201)
  ([vzakaznikov](https://github.com/vzakaznikov))
- MergeTreeパーツのmin/maxインデックスにおいてNULL値を正しくシリアライズするようにしました。[#7234](https://github.com/ClickHouse/ClickHouse/pull/7234) ([Alexander
  Kuzmenkov](https://github.com/akuzm))
- `CREATE TABLE AS` でテーブルが作成される際に、仮想カラムを.sqlメタデータに含めないようにしました。[#7183](https://github.com/ClickHouse/ClickHouse/pull/7183) ([Ivan](https://github.com/abyss7))
- `ATTACH PART` クエリにおけるセグメンテーション違反を修正しました。[#7185](https://github.com/ClickHouse/ClickHouse/pull/7185)
  ([alesapin](https://github.com/alesapin))
- 空のINサブクエリおよび空のINNER/RIGHT JOINの最適化によって生じる一部のクエリの誤った結果を修正しました。[#7284](https://github.com/ClickHouse/ClickHouse/pull/7284) ([Nikolai
  Kochetov](https://github.com/KochetovNicolai))
- LIVE VIEWのgetHeader()メソッドにおけるAddressSanitizerエラーを修正しました。[#7271](https://github.com/ClickHouse/ClickHouse/pull/7271)
  ([vzakaznikov](https://github.com/vzakaznikov))

#### 改善 {#improvement-1}


- queue_wait_max_msの待機が発生した場合にメッセージを追加しました。
  [#7390](https://github.com/ClickHouse/ClickHouse/pull/7390) ([Azat
  Khuzhin](https://github.com/azat))
- 設定`s3_min_upload_part_size`をテーブルレベルに変更しました。
  [#7059](https://github.com/ClickHouse/ClickHouse/pull/7059) ([Vladimir
  Chebotarev](https://github.com/excitoon))
- StorageFactoryでTTLをチェックするようにしました。[#7304](https://github.com/ClickHouse/ClickHouse/pull/7304)
  ([sundyli](https://github.com/sundy-li))
- 部分マージ結合において左側のブロックを圧縮するようにしました(最適化)。
  [#7122](https://github.com/ClickHouse/ClickHouse/pull/7122) ([Artem
  Zuikov](https://github.com/4ertus2))
- レプリケートされたテーブルエンジンのミューテーションにおいて非決定的関数を許可しないようにしました。これはレプリカ間の不整合を引き起こす可能性があるためです。
  [#7247](https://github.com/ClickHouse/ClickHouse/pull/7247) ([Alexander
  Kazakov](https://github.com/Akazz))
- 例外スタックトレースを文字列に変換する際にメモリトラッカーを無効化するようにしました。これにより、サーバー上で`Memory limit exceeded`タイプのエラーメッセージが失われることを防ぎ、クライアント上で`Attempt to read after eof`例外が発生するのを回避できます。[#7264](https://github.com/ClickHouse/ClickHouse/pull/7264)
  ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- 各種フォーマットの改善。以下を解決します
  [#6033](https://github.com/ClickHouse/ClickHouse/issues/6033)、
  [#2633](https://github.com/ClickHouse/ClickHouse/issues/2633)、
  [#6611](https://github.com/ClickHouse/ClickHouse/issues/6611)、
  [#6742](https://github.com/ClickHouse/ClickHouse/issues/6742)
  [#7215](https://github.com/ClickHouse/ClickHouse/pull/7215)
  ([tavplubix](https://github.com/tavplubix))
- ClickHouseはIN演算子の右側にある、左側の型に変換できない値を無視します。複合型(ArrayとTuple)に対して正しく動作するようにしました。
  [#7283](https://github.com/ClickHouse/ClickHouse/pull/7283) ([Alexander
  Kuzmenkov](https://github.com/akuzm))
- ASOF JOINで不足していた不等式をサポートしました。ON構文において、ASOF列に対して以下または等しいバリアントと厳密な大なり・小なりのバリアントを結合できるようになりました。
  [#7282](https://github.com/ClickHouse/ClickHouse/pull/7282) ([Artem
  Zuikov](https://github.com/4ertus2))
- 部分マージ結合を最適化しました。[#7070](https://github.com/ClickHouse/ClickHouse/pull/7070)
  ([Artem Zuikov](https://github.com/4ertus2))
- uniqCombined関数において98K以上のメモリを使用しないようにしました。
  [#7236](https://github.com/ClickHouse/ClickHouse/pull/7236)、
  [#7270](https://github.com/ClickHouse/ClickHouse/pull/7270) ([Azat
  Khuzhin](https://github.com/azat))
- PartialMergeJoinにおいて、右側の結合テーブルの一部をディスクにフラッシュするようにしました(メモリが不足している場合)。必要に応じてデータをロードし直します。[#7186](https://github.com/ClickHouse/ClickHouse/pull/7186)
  ([Artem Zuikov](https://github.com/4ertus2))

#### パフォーマンスの改善 {#performance-improvement-1}

- const引数を持つjoinGetにおいて、データの重複を回避することで高速化しました。
  [#7359](https://github.com/ClickHouse/ClickHouse/pull/7359) ([Amos
  Bird](https://github.com/amosbird))
- サブクエリが空の場合は早期にリターンするようにしました。
  [#7007](https://github.com/ClickHouse/ClickHouse/pull/7007) ([小路](https://github.com/nicelulu))
- ValuesにおけるSQL式の解析を最適化しました。
  [#6781](https://github.com/ClickHouse/ClickHouse/pull/6781)
  ([tavplubix](https://github.com/tavplubix))

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-1}


* Mac OS へのクロスコンパイル時に一部の contrib を無効化。
  [#7101](https://github.com/ClickHouse/ClickHouse/pull/7101) ([Ivan](https://github.com/abyss7))
* clickhouse&#95;common&#95;io に対する不足していた PocoXML のリンクを追加。
  [#7200](https://github.com/ClickHouse/ClickHouse/pull/7200) ([Azat
  Khuzhin](https://github.com/azat))
* clickhouse-test で複数のテストフィルター引数を受け取れるようにしました。
  [#7226](https://github.com/ClickHouse/ClickHouse/pull/7226) ([Alexander
  Kuzmenkov](https://github.com/akuzm))
* ARM 向けに musl および jemalloc を有効化。 [#7300](https://github.com/ClickHouse/ClickHouse/pull/7300)
  ([Amos Bird](https://github.com/amosbird))
* `clickhouse-test` に `--client-option` パラメータを追加し、クライアントに追加のパラメータを渡せるようにしました。
  [#7277](https://github.com/ClickHouse/ClickHouse/pull/7277) ([Nikolai
  Kochetov](https://github.com/KochetovNicolai))
* rpm パッケージのアップグレード時に既存の設定を保持するようにしました。
  [#7103](https://github.com/ClickHouse/ClickHouse/pull/7103)
  ([filimonov](https://github.com/filimonov))
* PVS によって検出されたエラーを修正。 [#7153](https://github.com/ClickHouse/ClickHouse/pull/7153) ([Artem
  Zuikov](https://github.com/4ertus2))
* Darwin 向けのビルドを修正しました。 [#7149](https://github.com/ClickHouse/ClickHouse/pull/7149)
  ([Ivan](https://github.com/abyss7))
* glibc 2.29 との互換性。 [#7142](https://github.com/ClickHouse/ClickHouse/pull/7142) ([Amos
  Bird](https://github.com/amosbird))
* dh&#95;clean が潜在的なソースファイルに手を加えないようにしました。
  [#7205](https://github.com/ClickHouse/ClickHouse/pull/7205) ([Amos
  Bird](https://github.com/amosbird))
* altinity の rpm から更新する際に競合が発生しないようにしました。設定ファイルは clickhouse-server-common で別パッケージとして提供されています。 [#7073](https://github.com/ClickHouse/ClickHouse/pull/7073)
  ([filimonov](https://github.com/filimonov))
* 一部のヘッダーファイルを最適化して、再ビルドを高速化。
  [#7212](https://github.com/ClickHouse/ClickHouse/pull/7212),
  [#7231](https://github.com/ClickHouse/ClickHouse/pull/7231) ([Alexander
  Kuzmenkov](https://github.com/akuzm))
* Date と DateTime のパフォーマンス テストを追加。[#7332](https://github.com/ClickHouse/ClickHouse/pull/7332) ([Vasily
  Nemkov](https://github.com/Enmk))
* 非決定的なミューテーションを含んでいたいくつかのテストを修正。
  [#7132](https://github.com/ClickHouse/ClickHouse/pull/7132) ([Alexander
  Kazakov](https://github.com/Akazz))
* MemorySanitizer を用いたビルドを CI に追加。 [#7066](https://github.com/ClickHouse/ClickHouse/pull/7066)
  ([Alexander Kuzmenkov](https://github.com/akuzm))
* MetricsTransmitter で未初期化の値が使用されないようにしました。
  [#7158](https://github.com/ClickHouse/ClickHouse/pull/7158) ([Azat
  Khuzhin](https://github.com/azat))
* MemorySanitizer によって `Fields` で検出された問題をいくつか修正。
  [#7135](https://github.com/ClickHouse/ClickHouse/pull/7135),
  [#7179](https://github.com/ClickHouse/ClickHouse/pull/7179) ([Alexander
  Kuzmenkov](https://github.com/akuzm)), [#7376](https://github.com/ClickHouse/ClickHouse/pull/7376)
  ([Amos Bird](https://github.com/amosbird))
* murmurhash32 の未定義動作を修正。 [#7388](https://github.com/ClickHouse/ClickHouse/pull/7388) ([Amos
  Bird](https://github.com/amosbird))
* StoragesInfoStream の未定義動作を修正。 [#7384](https://github.com/ClickHouse/ClickHouse/pull/7384)
  ([tavplubix](https://github.com/tavplubix))
* 外部データベースエンジン（MySQL、ODBC、JDBC）に対する定数式のフォールディング処理を修正しました。以前のバージョンでは、複数の定数式に対しては動作せず、また Date、DateTime、UUID についてはまったく機能していませんでした。この修正は [#7245](https://github.com/ClickHouse/ClickHouse/issues/7245)
  [#7252](https://github.com/ClickHouse/ClickHouse/pull/7252)
  ([alexey-milovidov](https://github.com/alexey-milovidov)) に対応するものです。
* LIVE VIEW で no&#95;users&#95;thread 変数にアクセスする際に発生する ThreadSanitizer のデータレースエラーを修正。
  [#7353](https://github.com/ClickHouse/ClickHouse/pull/7353)
  ([vzakaznikov](https://github.com/vzakaznikov))
* libcommon から malloc シンボルを削除
  [#7134](https://github.com/ClickHouse/ClickHouse/pull/7134),
  [#7065](https://github.com/ClickHouse/ClickHouse/pull/7065) ([Amos
  Bird](https://github.com/amosbird))
* すべてのライブラリを無効化できるグローバルフラグ ENABLE&#95;LIBRARIES を追加。
  [#7063](https://github.com/ClickHouse/ClickHouse/pull/7063)
  ([proller](https://github.com/proller))

#### コードクリーンアップ {#code-cleanup}

- Dictionary用DDLに備えて設定リポジトリを汎用化。[#7155](https://github.com/ClickHouse/ClickHouse/pull/7155)
  ([alesapin](https://github.com/alesapin))
- セマンティクスを持たないDictionary DDL用パーサー。
  [#7209](https://github.com/ClickHouse/ClickHouse/pull/7209)
  ([alesapin](https://github.com/alesapin))
- ParserCreateQueryを複数の小さなパーサーに分割。
  [#7253](https://github.com/ClickHouse/ClickHouse/pull/7253)
  ([alesapin](https://github.com/alesapin))
- 外部Dictionary周辺の小規模なリファクタリングと名前変更。
  [#7111](https://github.com/ClickHouse/ClickHouse/pull/7111)
  ([alesapin](https://github.com/alesapin))
- ロールベースアクセス制御に備えて一部のコードをリファクタリング。[#7235](https://github.com/ClickHouse/ClickHouse/pull/7235) ([Vitaly
  Baranov](https://github.com/vitlibar))
- DatabaseOrdinaryコードの改善。
  [#7086](https://github.com/ClickHouse/ClickHouse/pull/7086) ([Nikita
  Vasilev](https://github.com/nikvas0))
- ハッシュテーブルのfind()およびemplace()メソッドでイテレータを使用しないように変更。
  [#7026](https://github.com/ClickHouse/ClickHouse/pull/7026) ([Alexander
  Kuzmenkov](https://github.com/akuzm))
- パラメータrootが空でない場合のgetMultipleValuesFromConfigを修正。[#7374](https://github.com/ClickHouse/ClickHouse/pull/7374)
  ([Mikhail Korotov](https://github.com/millb))
- 一部の重複コード(TemporaryFileおよびTemporaryFileStream)を削除。
  [#7166](https://github.com/ClickHouse/ClickHouse/pull/7166) ([Artem
  Zuikov](https://github.com/4ertus2))
- コードの可読性を若干改善(`MergeTreeData::getActiveContainingPart`)。
  [#7361](https://github.com/ClickHouse/ClickHouse/pull/7361) ([Vladimir
  Chebotarev](https://github.com/excitoon))
- `ThreadPool::schedule(...)`が例外をスローした場合、ローカルオブジェクトを使用しているすべてのスケジュール済みジョブを待機するように変更。`ThreadPool::schedule(...)`を`ThreadPool::scheduleOrThrowOnError(...)`に名前変更し、例外をスローする可能性があることを明確にするためコメントを修正。
  [#7350](https://github.com/ClickHouse/ClickHouse/pull/7350)
  ([tavplubix](https://github.com/tavplubix))


## ClickHouse リリース 19.15 {#clickhouse-release-19-15}

### ClickHouse リリース 19.15.4.10, 2019-10-31 {#clickhouse-release-19-15-4-10-2019-10-31}

#### バグ修正 {#bug-fix-3}

- ODBC Bridge において SQL_TINYINT と SQL_BIGINT の処理を追加し、SQL_FLOAT データソースタイプの処理を修正しました。
  [#7491](https://github.com/ClickHouse/ClickHouse/pull/7491) ([Denis Glazachev](https://github.com/traceon))
- MOVE PARTITION において、宛先ディスクまたはボリュームに一部のパーツを配置できるようにしました。
  [#7434](https://github.com/ClickHouse/ClickHouse/pull/7434) ([Vladimir Chebotarev](https://github.com/excitoon))
- ODBC-bridge を介した nullable カラムの NULL 値を修正しました。
  [#7402](https://github.com/ClickHouse/ClickHouse/pull/7402) ([Vasily Nemkov](https://github.com/Enmk))
- MATERIALIZED カラムを持つ Distributed の非ローカルノードへの INSERT を修正しました。
  [#7377](https://github.com/ClickHouse/ClickHouse/pull/7377) ([Azat Khuzhin](https://github.com/azat))
- getMultipleValuesFromConfig 関数を修正しました。
  [#7374](https://github.com/ClickHouse/ClickHouse/pull/7374) ([Mikhail Korotov](https://github.com/millb))
- TCP キープアライブタイムアウトの代わりに HTTP キープアライブタイムアウトが使用される問題を修正しました。
  [#7351](https://github.com/ClickHouse/ClickHouse/pull/7351) ([Vasily Nemkov](https://github.com/Enmk))
- 例外発生時にすべてのジョブの完了を待機するようにしました（まれに発生するセグメンテーション違反を修正）。
  [#7350](https://github.com/ClickHouse/ClickHouse/pull/7350) ([tavplubix](https://github.com/tavplubix))
- Kafka テーブルへの挿入時にマテリアライズドビューへのプッシュを行わないようにしました。
  [#7265](https://github.com/ClickHouse/ClickHouse/pull/7265) ([Ivan](https://github.com/abyss7))
- 例外スタックのメモリトラッカーを無効化しました。
  [#7264](https://github.com/ClickHouse/ClickHouse/pull/7264) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- 外部データベース向けのクエリ変換における不適切なコードを修正しました。
  [#7252](https://github.com/ClickHouse/ClickHouse/pull/7252) ([alexey-milovidov](https://github.com/alexey-milovidov))
- MetricsTransmitter における未初期化値の使用を回避しました。
  [#7158](https://github.com/ClickHouse/ClickHouse/pull/7158) ([Azat Khuzhin](https://github.com/azat))
- テスト用のマクロを含む設定例を追加しました ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.15.3.6, 2019-10-09 {#clickhouse-release-19-15-3-6-2019-10-09}

#### バグ修正 {#bug-fix-4}

- ハッシュディクショナリの bad_variant を修正しました。
  ([alesapin](https://github.com/alesapin))
- ATTACH PART クエリにおけるセグメンテーション違反のバグを修正しました。
  ([alesapin](https://github.com/alesapin))
- `MergeTreeData` における時間計算を修正しました。
  ([Vladimir Chebotarev](https://github.com/excitoon))
- 書き込みが完了した後、明示的に Kafka へコミットするようにしました。
  [#7175](https://github.com/ClickHouse/ClickHouse/pull/7175) ([Ivan](https://github.com/abyss7))
- MergeTree パーツの min/max インデックスにおいて NULL 値を正しくシリアライズするようにしました。
  [#7234](https://github.com/ClickHouse/ClickHouse/pull/7234) ([Alexander Kuzmenkov](https://github.com/akuzm))

### ClickHouse リリース 19.15.2.2, 2019-10-01 {#clickhouse-release-19-15-2-2-2019-10-01}

#### 新機能 {#new-feature-3}


- 階層型ストレージ: MergeTreeエンジンを使用するテーブルで複数のストレージボリュームを使用できるようになりました。新しいデータをSSDに保存し、古いデータを自動的にHDDに移動することが可能です。([例](https://clickhouse.github.io/clickhouse-presentations/meetup30/new_features/#12)). [#4918](https://github.com/ClickHouse/ClickHouse/pull/4918) ([Igr](https://github.com/ObjatieGroba)) [#6489](https://github.com/ClickHouse/ClickHouse/pull/6489) ([alesapin](https://github.com/alesapin))
- `INSERT SELECT`クエリで受信データを読み取るためのテーブル関数`input`を追加しました。[#5450](https://github.com/ClickHouse/ClickHouse/pull/5450) ([palasonic1](https://github.com/palasonic1)) [#6832](https://github.com/ClickHouse/ClickHouse/pull/6832) ([Anton Popov](https://github.com/CurtizJ))
- `hashed`レイアウトと機能的に同等でありながら、よりメモリ効率的な`sparse_hashed`辞書レイアウトを追加しました。値の取得速度が遅くなる代わりに、使用メモリを約半分に削減します。[#6894](https://github.com/ClickHouse/ClickHouse/pull/6894) ([Azat Khuzhin](https://github.com/azat))
- 辞書へのアクセスを許可するユーザーリストを定義する機能を実装しました。現在接続されているデータベースのみが対象です。[#6907](https://github.com/ClickHouse/ClickHouse/pull/6907) ([Guillaume Tassery](https://github.com/YiuRULE))
- `SHOW`クエリに`LIMIT`オプションを追加しました。[#6944](https://github.com/ClickHouse/ClickHouse/pull/6944) ([Philipp Malkovsky](https://github.com/malkfilipp))
- `bitmapSubsetLimit(bitmap, range_start, limit)`関数を追加しました。この関数は、`range_start`以上の値の中で最小の`limit`個の値のサブセットを返します。[#6957](https://github.com/ClickHouse/ClickHouse/pull/6957) ([Zhichang Yu](https://github.com/yuzhichang))
- `bitmapMin`および`bitmapMax`関数を追加しました。[#6970](https://github.com/ClickHouse/ClickHouse/pull/6970) ([Zhichang Yu](https://github.com/yuzhichang))
- [issue-6648](https://github.com/ClickHouse/ClickHouse/issues/6648)に関連する`repeat`関数を追加しました。[#6999](https://github.com/ClickHouse/ClickHouse/pull/6999) ([flynn](https://github.com/ucasFL))

#### 実験的機能 {#experimental-feature-1}

- 現在のパイプラインを変更しない（インメモリ）Merge Joinバリアントを実装しました。結果はマージキーによって部分的にソートされます。この機能を使用するには`partial_merge_join = 1`を設定してください。Merge Joinは現在も開発中です。[#6940](https://github.com/ClickHouse/ClickHouse/pull/6940) ([Artem Zuikov](https://github.com/4ertus2))
- `S3`エンジンとテーブル関数を追加しました。現在も開発中です（認証サポートはまだありません）。[#5596](https://github.com/ClickHouse/ClickHouse/pull/5596) ([Vladimir Chebotarev](https://github.com/excitoon))

#### 改善 {#improvement-2}


- Kafkaから読み取られたすべてのメッセージがアトミックに挿入されるようになりました。これによりKafkaエンジンに関する既知の問題のほぼすべてが解決されます。[#6950](https://github.com/ClickHouse/ClickHouse/pull/6950) ([Ivan](https://github.com/abyss7))
- Distributedクエリのフェイルオーバーを改善しました。復旧時間が短縮され、設定可能になり、`system.clusters`で確認できるようになりました。[#6399](https://github.com/ClickHouse/ClickHouse/pull/6399) ([Vasily Nemkov](https://github.com/Enmk))
- `IN`句でEnumの数値を直接サポートするようになりました。#6766 [#6941](https://github.com/ClickHouse/ClickHouse/pull/6941) ([dimarub2000](https://github.com/dimarub2000))
- URLストレージでのリダイレクトをサポートしました(オプション、デフォルトでは無効)。[#6914](https://github.com/ClickHouse/ClickHouse/pull/6914) ([maqroll](https://github.com/maqroll))
- 古いバージョンのクライアントがサーバーに接続した際に情報メッセージを追加しました。[#6893](https://github.com/ClickHouse/ClickHouse/pull/6893) ([Philipp Malkovsky](https://github.com/malkfilipp))
- Distributedテーブルでのデータ送信時の最大バックオフスリープ時間制限を削除しました [#6895](https://github.com/ClickHouse/ClickHouse/pull/6895) ([Azat Khuzhin](https://github.com/azat))
- プロファイルイベント(カウンター)を累積値としてgraphiteに送信する機能を追加しました。サーバーの`config.xml`で`<events_cumulative>`を使用して有効化できます。[#6969](https://github.com/ClickHouse/ClickHouse/pull/6969) ([Azat Khuzhin](https://github.com/azat))
- HTTP経由でNative形式の`LowCardinality(T)`型カラムにデータを挿入する際、型`T`を`LowCardinality(T)`に自動的にキャストする機能を追加しました。[#6891](https://github.com/ClickHouse/ClickHouse/pull/6891) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- `Float32`、`Float64`に対して`reinterpretAsString`を使用せずに`hex`関数を使用できる機能を追加しました。[#7024](https://github.com/ClickHouse/ClickHouse/pull/7024) ([Mikhail Korotov](https://github.com/millb))

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-2}

- デバッグ情報を含むclickhouseバイナリにgdb-indexを追加しました。これにより`gdb`の起動時間が高速化されます。[#6947](https://github.com/ClickHouse/ClickHouse/pull/6947) ([alesapin](https://github.com/alesapin))
- `pigz`を使用するようにパッチを適用したdpkg-debでdebパッケージングを高速化しました。[#6960](https://github.com/ClickHouse/ClickHouse/pull/6960) ([alesapin](https://github.com/alesapin))
- `enable_fuzzing = 1`を設定することで、プロジェクトコード全体のlibfuzzerインストルメンテーションを有効化できるようになりました。[#7042](https://github.com/ClickHouse/ClickHouse/pull/7042) ([kyprizel](https://github.com/kyprizel))
- CIに分割ビルドのスモークテストを追加しました。[#7061](https://github.com/ClickHouse/ClickHouse/pull/7061) ([alesapin](https://github.com/alesapin))
- CIにMemorySanitizerを使用したビルドを追加しました。[#7066](https://github.com/ClickHouse/ClickHouse/pull/7066) ([Alexander Kuzmenkov](https://github.com/akuzm))
- `libsparsehash`を`sparsehash-c11`に置き換えました [#6965](https://github.com/ClickHouse/ClickHouse/pull/6965) ([Azat Khuzhin](https://github.com/azat))

#### バグ修正 {#bug-fix-5}


- 大規模テーブルにおける複合キーのインデックス解析のパフォーマンス低下を修正しました。これにより #6924 が修正されます。[#7075](https://github.com/ClickHouse/ClickHouse/pull/7075) ([alexey-milovidov](https://github.com/alexey-milovidov))
- Kafkaの空のトピックから選択する際にセグメンテーション違反を引き起こす論理エラーを修正しました。[#6909](https://github.com/ClickHouse/ClickHouse/pull/6909) ([Ivan](https://github.com/abyss7))
- `MySQLBlockInputStream.cpp`におけるMySQL接続の早期クローズを修正しました。[#6882](https://github.com/ClickHouse/ClickHouse/pull/6882) ([Clément Rodriguez](https://github.com/clemrodriguez))
- 非常に古いLinuxカーネルのサポートを復元しました([#6841](https://github.com/ClickHouse/ClickHouse/issues/6841)を修正)[#6853](https://github.com/ClickHouse/ClickHouse/pull/6853) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 入力ストリームに空のブロックがある場合の`insert select`クエリにおけるデータ損失の可能性を修正しました。#6834 #6862 [#6911](https://github.com/ClickHouse/ClickHouse/pull/6911) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- パラメータに空の配列がある場合の`АrrayEnumerateUniqRanked`関数を修正しました[#6928](https://github.com/ClickHouse/ClickHouse/pull/6928) ([proller](https://github.com/proller))
- 配列結合とグローバルサブクエリを含む複雑なクエリを修正しました。[#6934](https://github.com/ClickHouse/ClickHouse/pull/6934) ([Ivan](https://github.com/abyss7))
- 複数のJOINを含むORDER BYおよびGROUP BYにおける`Unknown identifier`エラーを修正しました[#7022](https://github.com/ClickHouse/ClickHouse/pull/7022) ([Artem Zuikov](https://github.com/4ertus2))
- `LowCardinality`引数を持つ関数実行時の`MSan`警告を修正しました。[#7062](https://github.com/ClickHouse/ClickHouse/pull/7062) ([Nikolai Kochetov](https://github.com/KochetovNicolai))

#### 後方互換性のない変更 {#backward-incompatible-change-2}

- パフォーマンス向上のためにbitmap\*集約関数の状態のシリアライゼーション形式を変更しました。以前のバージョンからのbitmap\*のシリアライズされた状態は読み取ることができません。[#6908](https://github.com/ClickHouse/ClickHouse/pull/6908) ([Zhichang Yu](https://github.com/yuzhichang))


## ClickHouse リリース 19.14 {#clickhouse-release-19-14}

### ClickHouse リリース 19.14.7.15, 2019-10-02 {#clickhouse-release-19-14-7-15-2019-10-02}

#### バグ修正 {#bug-fix-6}

- このリリースには、19.11.12.69 のすべてのバグ修正も含まれています。
- 19.14 と以前のバージョン間の分散クエリの互換性を修正しました。これにより [#7068](https://github.com/ClickHouse/ClickHouse/issues/7068) が修正されます。[#7069](https://github.com/ClickHouse/ClickHouse/pull/7069) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.14.6.12, 2019-09-19 {#clickhouse-release-19-14-6-12-2019-09-19}

#### バグ修正 {#bug-fix-7}

- パラメータに空の配列を持つ関数 `АrrayEnumerateUniqRanked` を修正しました。[#6928](https://github.com/ClickHouse/ClickHouse/pull/6928) ([proller](https://github.com/proller))
- エイリアスを持つ `ARRAY JOIN` と `GLOBAL IN subquery` を含むクエリでのサブクエリ名を修正しました。指定されている場合は、外部テーブル名にサブクエリのエイリアスを使用します。[#6934](https://github.com/ClickHouse/ClickHouse/pull/6934) ([Ivan](https://github.com/abyss7))

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-3}

- ミューテーションの適用を待つ必要があるため、シェルスクリプトに書き換えることで、[不安定な](<https://clickhouse-test-reports.s3.yandex.net/6944/aab95fd5175a513413c7395a73a82044bdafb906/functional_stateless_tests_(debug).html>) テスト `00715_fetch_merged_or_mutated_part_zookeeper` を修正しました。[#6977](https://github.com/ClickHouse/ClickHouse/pull/6977) ([Alexander Kazakov](https://github.com/Akazz))
- 空の配列引数を持つ関数 `groupUniqArray` での UBSan と MemSan の失敗を修正しました。これは、ゼロセル値のコンストラクタが呼び出されなかったため、空の `PaddedPODArray` がハッシュテーブルのゼロセルに配置されたことが原因でした。[#6937](https://github.com/ClickHouse/ClickHouse/pull/6937) ([Amos Bird](https://github.com/amosbird))

### ClickHouse リリース 19.14.3.3, 2019-09-10 {#clickhouse-release-19-14-3-3-2019-09-10}

#### 新機能 {#new-feature-4}


* `ORDER BY` 向けの `WITH FILL` 修飾子。（[#5069](https://github.com/ClickHouse/ClickHouse/issues/5069) の継続）[#6610](https://github.com/ClickHouse/ClickHouse/pull/6610)（[Anton Popov](https://github.com/CurtizJ)）
* `LIMIT` に対する `WITH TIES` 修飾子（[#5069](https://github.com/ClickHouse/ClickHouse/issues/5069) の続き）。[#6610](https://github.com/ClickHouse/ClickHouse/pull/6610)（[Anton Popov](https://github.com/CurtizJ)）
* 引用符なしの `NULL` リテラルを NULL としてパースします（`format_csv_unquoted_null_literal_as_null=1` の場合）。このフィールドのデータ型が Nullable 型でない場合、null フィールドをデフォルト値で初期化します（`input_format_null_as_default=1` の場合）。 [#5990](https://github.com/ClickHouse/ClickHouse/issues/5990) [#6055](https://github.com/ClickHouse/ClickHouse/pull/6055) ([tavplubix](https://github.com/tavplubix))
* テーブル関数 `file` と `hdfs` のパスでワイルドカードがサポートされました。パスにワイルドカードが含まれている場合、そのテーブルは読み取り専用になります。使用例: `select * from hdfs('hdfs://hdfs1:9000/some_dir/another_dir/*/file{0..9}{0..9}')` および `select * from file('some_dir/{some_file,another_file,yet_another}.tsv', 'TSV', 'value UInt32')`。 [#6092](https://github.com/ClickHouse/ClickHouse/pull/6092) ([Olga Khvostikova](https://github.com/stavrolia))
* 新しい `system.metric_log` テーブルを追加し、指定した時間間隔で `system.events` および `system.metrics` の値を保持するようにしました。 [#6363](https://github.com/ClickHouse/ClickHouse/issues/6363) [#6467](https://github.com/ClickHouse/ClickHouse/pull/6467) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)) [#6530](https://github.com/ClickHouse/ClickHouse/pull/6530) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ClickHouse のテキストログを `system.text_log` テーブルに書き込めるようになりました。 [#6037](https://github.com/ClickHouse/ClickHouse/issues/6037) [#6103](https://github.com/ClickHouse/ClickHouse/pull/6103) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)) [#6164](https://github.com/ClickHouse/ClickHouse/pull/6164) ([alexey-milovidov](https://github.com/alexey-milovidov))
* スタックトレースにプライベートシンボルを表示できるようにしました（ELF ファイルのシンボルテーブルをパースすることで実現）。デバッグ情報が存在する場合、スタックトレースにファイル名と行番号の情報を追加しました。プログラム内に存在するシンボルをインデックス化することで、シンボル名のルックアップを高速化しました。自己検査（イントロスペクション）用の新しい SQL 関数 `demangle` および `addressToLine` を追加しました。一貫性のため、関数 `symbolizeAddress` を `addressToSymbol` にリネームしました。関数 `addressToSymbol` はパフォーマンス上の理由からマングル済みの名前を返すため、`demangle` を適用する必要があります。デフォルトでは無効になっている設定 `allow_introspection_functions` を追加しました。 [#6201](https://github.com/ClickHouse/ClickHouse/pull/6201) ([alexey-milovidov](https://github.com/alexey-milovidov))
* テーブル関数 `values`（名前の大文字・小文字は区別されません）。[#5984](https://github.com/ClickHouse/ClickHouse/issues/5984) で提案された `VALUES` リストから読み取ることができます。例: `SELECT * FROM VALUES('a UInt64, s String', (1, 'one'), (2, 'two'), (3, 'three'))`。[#6217](https://github.com/ClickHouse/ClickHouse/issues/6217)。[#6209](https://github.com/ClickHouse/ClickHouse/pull/6209)（[dimarub2000](https://github.com/dimarub2000)）
* ストレージ設定を変更できるようになりました。構文：`ALTER TABLE <table> MODIFY SETTING <setting> = <value>`. [#6366](https://github.com/ClickHouse/ClickHouse/pull/6366) [#6669](https://github.com/ClickHouse/ClickHouse/pull/6669) [#6685](https://github.com/ClickHouse/ClickHouse/pull/6685) ([alesapin](https://github.com/alesapin))
* デタッチされたパーツを削除する機能をサポート。構文: `ALTER TABLE <table_name> DROP DETACHED PART '<part_id>'`。 [#6158](https://github.com/ClickHouse/ClickHouse/pull/6158) ([tavplubix](https://github.com/tavplubix))
* テーブル制約。INSERT 時に検証される制約をテーブル定義に追加できるようにします。 [#5273](https://github.com/ClickHouse/ClickHouse/pull/5273) ([Gleb Novikov](https://github.com/NanoBjorn)) [#6652](https://github.com/ClickHouse/ClickHouse/pull/6652) ([alexey-milovidov](https://github.com/alexey-milovidov))
* カスケード型マテリアライズドビューのサポート。 [#6324](https://github.com/ClickHouse/ClickHouse/pull/6324) ([Amos Bird](https://github.com/amosbird))
* クエリプロファイラをデフォルトで有効にし、すべてのクエリ実行スレッドを 1 秒ごとに 1 回サンプリングするようにしました。 [#6283](https://github.com/ClickHouse/ClickHouse/pull/6283) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 入力フォーマット `ORC`。[#6454](https://github.com/ClickHouse/ClickHouse/pull/6454) [#6703](https://github.com/ClickHouse/ClickHouse/pull/6703) ([akonyaev90](https://github.com/akonyaev90))
* 機械学習アプリケーションで有用な2つの新しい関数 `sigmoid` と `tanh` を追加。 [#6254](https://github.com/ClickHouse/ClickHouse/pull/6254) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 与えられたトークンが `haystack` 内に含まれているかを確認する関数 `hasToken(haystack, token)` および `hasTokenCaseInsensitive(haystack, token)` を追加。トークンは、2 つの英数字以外の ASCII 文字（または `haystack` の境界）に挟まれた、最大長の部分文字列です。トークンは定数文字列でなければなりません。`tokenbf_v1` インデックスの特殊化によってサポートされます。 [#6596](https://github.com/ClickHouse/ClickHouse/pull/6596)、[#6662](https://github.com/ClickHouse/ClickHouse/pull/6662)（[Vasily Nemkov](https://github.com/Enmk)）
* 新しい関数 `neighbor(value, offset[, default_value])`。データブロック内で、列の前後の値にアクセスできます。 [#5925](https://github.com/ClickHouse/ClickHouse/pull/5925) ([Alex Krash](https://github.com/alex-krash)) [6685365ab8c5b74f9650492c88a012596eb1b0c6](https://github.com/ClickHouse/ClickHouse/commit/6685365ab8c5b74f9650492c88a012596eb1b0c6) [341e2e4587a18065c2da1ca888c73389f48ce36c](https://github.com/ClickHouse/ClickHouse/commit/341e2e4587a18065c2da1ca888c73389f48ce36c) [Alexey Milovidov](https://github.com/alexey-milovidov)
* 認証済みユーザーのログイン名を返す関数 `currentUser()` を追加しました。MySQL との互換性のためにエイリアス `user()` も追加しました。 [#6470](https://github.com/ClickHouse/ClickHouse/pull/6470) ([Alex Krash](https://github.com/alex-krash))
* 新しい集約関数 `quantilesExactInclusive` と `quantilesExactExclusive`。[#5885](https://github.com/ClickHouse/ClickHouse/issues/5885) で提案されたものです。[#6477](https://github.com/ClickHouse/ClickHouse/pull/6477)（[dimarub2000](https://github.com/dimarub2000)）
* 関数 `bitmapRange(bitmap, range_begin, range_end)` は、指定した範囲（`range_end` は含まない）に対応する新しい集合を返します。 [#6314](https://github.com/ClickHouse/ClickHouse/pull/6314) ([Zhichang Yu](https://github.com/yuzhichang))
* 関数 `geohashesInBox(longitude_min, latitude_min, longitude_max, latitude_max, precision)` は、指定された領域をカバーする geohash ボックスを表す、長さ precision の文字列の配列を生成します。 [#6127](https://github.com/ClickHouse/ClickHouse/pull/6127) ([Vasily Nemkov](https://github.com/Enmk))
* `Kafka` テーブルに対する INSERT クエリのサポートを実装。 [#6012](https://github.com/ClickHouse/ClickHouse/pull/6012) ([Ivan](https://github.com/abyss7))
* Kafka エンジンで `_partition` と `_timestamp` 仮想カラムをサポートしました。 [#6400](https://github.com/ClickHouse/ClickHouse/pull/6400) ([Ivan](https://github.com/abyss7))
* `query_log`、サーバーログ、プロセスリストから、正規表現ベースのルールを使って機密データを削除できる機能を追加。 [#5710](https://github.com/ClickHouse/ClickHouse/pull/5710) ([filimonov](https://github.com/filimonov))

#### 実験的機能 {#experimental-feature-2}

- 入出力データフォーマット`Template`。入力と出力のカスタムフォーマット文字列を指定できます。[#4354](https://github.com/ClickHouse/ClickHouse/issues/4354) [#6727](https://github.com/ClickHouse/ClickHouse/pull/6727) ([tavplubix](https://github.com/tavplubix))
- `LIVE VIEW`テーブルの実装。当初[#2898](https://github.com/ClickHouse/ClickHouse/pull/2898)で提案され、[#3925](https://github.com/ClickHouse/ClickHouse/issues/3925)で準備され、その後[#5541](https://github.com/ClickHouse/ClickHouse/issues/5541)で更新されました。詳細については[#5541](https://github.com/ClickHouse/ClickHouse/issues/5541)を参照してください。[#5541](https://github.com/ClickHouse/ClickHouse/issues/5541) ([vzakaznikov](https://github.com/vzakaznikov)) [#6425](https://github.com/ClickHouse/ClickHouse/pull/6425) ([Nikolai Kochetov](https://github.com/KochetovNicolai)) [#6656](https://github.com/ClickHouse/ClickHouse/pull/6656) ([vzakaznikov](https://github.com/vzakaznikov)) なお、`LIVE VIEW`機能は今後のバージョンで削除される可能性があります。

#### バグ修正 {#bug-fix-8}


* このリリースには、19.13 および 19.11 のすべてのバグ修正も含まれています。
* テーブルにスキップインデックスがあり、垂直マージが行われる場合に発生するセグメンテーションフォルトを修正。 [#6723](https://github.com/ClickHouse/ClickHouse/pull/6723) ([alesapin](https://github.com/alesapin))
* 非自明なカラムデフォルトを持つカラム単位 TTL の挙動を修正。以前は、`OPTIMIZE ... FINAL` クエリによる強制 TTL マージ時に、期限切れの値がユーザー指定のカラムデフォルトではなく、型のデフォルト値で置き換えられていた。 [#6796](https://github.com/ClickHouse/ClickHouse/pull/6796) ([Anton Popov](https://github.com/CurtizJ))
* 通常のサーバー再起動時に発生していた Kafka メッセージ重複の問題を修正。 [#6597](https://github.com/ClickHouse/ClickHouse/pull/6597) ([Ivan](https://github.com/abyss7))
* Kafka メッセージの読み取り時に発生していた無限ループを修正しました。特定のシナリオではコンシューマが無期限に一時停止されたままになる可能性があるため、サブスクリプション時にはコンシューマの一時停止／再開を一切行わないようにしました。 [#6354](https://github.com/ClickHouse/ClickHouse/pull/6354) ([Ivan](https://github.com/abyss7))
* `bitmapContains` 関数で発生する `Key expression contains comparison between inconvertible types` という例外を修正。 [#6136](https://github.com/ClickHouse/ClickHouse/issues/6136) [#6146](https://github.com/ClickHouse/ClickHouse/issues/6146) [#6156](https://github.com/ClickHouse/ClickHouse/pull/6156) ([dimarub2000](https://github.com/dimarub2000))
* `optimize_skip_unused_shards` が有効で、シャーディングキーが存在しない場合に発生するセグメンテーションフォルトを修正。 [#6384](https://github.com/ClickHouse/ClickHouse/pull/6384) ([Anton Popov](https://github.com/CurtizJ))
* メモリ破損を引き起こす可能性のあった mutation 内の誤ったコードを修正しました。`system.parts` または `system.parts_columns` からの `SELECT` と `DROP TABLE` が同時に実行されることで発生しうる、アドレス `0x14c0` の読み取り時のセグメンテーションフォルトを修正しました。mutation クエリの準備処理における競合状態を修正しました。Replicated テーブルの `OPTIMIZE` と ALTER などの同時変更操作によって発生していたデッドロックを修正しました。 [#6514](https://github.com/ClickHouse/ClickHouse/pull/6514) ([alexey-milovidov](https://github.com/alexey-milovidov))
* MySQL インターフェイスでの冗長なログ出力を削減 [#6389](https://github.com/ClickHouse/ClickHouse/pull/6389) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 設定ファイルで boolean 設定を `true` および `false` として解釈できる機能を復元。 [#6278](https://github.com/ClickHouse/ClickHouse/pull/6278) ([alesapin](https://github.com/alesapin))
* `Nullable(Decimal128)` に対する `quantile` および `median` 関数で発生していたクラッシュを修正。 [#6378](https://github.com/ClickHouse/ClickHouse/pull/6378) ([Artem Zuikov](https://github.com/4ertus2))
* 主キーに対する `WHERE` 条件に Float 型への変換が含まれている場合に、`SELECT` クエリが不完全な結果を返す可能性があった問題を修正しました。これは、`toFloat` 関数における単調性の検査が誤っていたことが原因です。 [#6248](https://github.com/ClickHouse/ClickHouse/issues/6248) [#6374](https://github.com/ClickHouse/ClickHouse/pull/6374) ([dimarub2000](https://github.com/dimarub2000))
* ミューテーションに対して `max_expanded_ast_elements` 設定を確認するようにしました。`TRUNCATE TABLE` 実行後にミューテーションをクリアするようにしました。 [#6205](https://github.com/ClickHouse/ClickHouse/pull/6205) ([Winter Zhang](https://github.com/zhang2014))
* `join_use_nulls` 使用時のキー列に対する JOIN 結果を修正。列のデフォルト値ではなく Null を設定するように変更。 [#6249](https://github.com/ClickHouse/ClickHouse/pull/6249) ([Artem Zuikov](https://github.com/4ertus2))
* 垂直マージおよび `ALTER` 実行時のスキップインデックスに関する修正。`Bad size of marks file` 例外の修正。[#6594](https://github.com/ClickHouse/ClickHouse/issues/6594) [#6713](https://github.com/ClickHouse/ClickHouse/pull/6713) ([alesapin](https://github.com/alesapin))
* マージ／変更対象のパーツの一方が空（0 行）の場合に発生する、`ALTER MODIFY COLUMN` および縦方向マージにおけるまれなクラッシュを修正 [#6746](https://github.com/ClickHouse/ClickHouse/issues/6746) [#6780](https://github.com/ClickHouse/ClickHouse/pull/6780) ([alesapin](https://github.com/alesapin))
* `AggregateFunctionFactory` における `LowCardinality` 型変換のバグを修正しました。これにより [#6257](https://github.com/ClickHouse/ClickHouse/issues/6257) が解決されます。[#6281](https://github.com/ClickHouse/ClickHouse/pull/6281)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）
* `topK` および `topKWeighted` 集約関数における誤った動作と、セグメンテーションフォールトが発生する可能性のある問題を修正。 [#6404](https://github.com/ClickHouse/ClickHouse/pull/6404) ([Anton Popov](https://github.com/CurtizJ))
* `getIdentifier` 関数まわりの危険なコードを修正。 [#6401](https://github.com/ClickHouse/ClickHouse/issues/6401) [#6409](https://github.com/ClickHouse/ClickHouse/pull/6409) ([alexey-milovidov](https://github.com/alexey-milovidov))
* MySQL クライアントから ClickHouse に接続する際に使用される MySQL ワイヤープロトコルのバグを修正しました。`PacketPayloadWriteBuffer` におけるヒープバッファオーバーフローが原因でした。 [#6212](https://github.com/ClickHouse/ClickHouse/pull/6212) ([Yuriy Baranov](https://github.com/yurriy))
* `bitmapSubsetInRange` 関数のメモリリークを修正。 [#6819](https://github.com/ClickHouse/ClickHouse/pull/6819) ([Zhichang Yu](https://github.com/yuzhichang))
* 粒度変更後に実行されるミューテーションでまれに発生するバグを修正。 [#6816](https://github.com/ClickHouse/ClickHouse/pull/6816) ([alesapin](https://github.com/alesapin))
* 既定で全フィールドを含む protobuf メッセージを許可。 [#6132](https://github.com/ClickHouse/ClickHouse/pull/6132) ([Vitaly Baranov](https://github.com/vitlibar))
* `nullIf` 関数の第 2 引数として `NULL` を渡したときに発生するバグを修正。 [#6446](https://github.com/ClickHouse/ClickHouse/pull/6446) ([Guillaume Tassery](https://github.com/YiuRULE))
* 文字列フィールドを含む複合キーの `cache` 辞書で、誤ったメモリ割り当て／解放が行われるまれなバグを修正しました。このバグによりメモリが無制限に消費される（メモリリークのように見える）状態になっていました。文字列サイズが 8 から始まる 2 の累乗（8, 16, 32 など）の場合にバグが再現します。 [#6447](https://github.com/ClickHouse/ClickHouse/pull/6447) ([alesapin](https://github.com/alesapin))
* 短いシーケンスに対する Gorilla エンコーディングで `Cannot write after end of buffer` という例外が発生していた問題を修正しました。 [#6398](https://github.com/ClickHouse/ClickHouse/issues/6398) [#6444](https://github.com/ClickHouse/ClickHouse/pull/6444) ([Vasily Nemkov](https://github.com/Enmk))
* `join_use_nulls` が有効な場合でも、JOIN で not nullable 型を使用できるようにしました。 [#6705](https://github.com/ClickHouse/ClickHouse/pull/6705) ([Artem Zuikov](https://github.com/4ertus2))
* `clickhouse-client` のクエリ内での `Poco::AbstractConfiguration` 代入を無効化。 [#6706](https://github.com/ClickHouse/ClickHouse/pull/6706) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `REPLACE PARTITION` におけるデッドロックを回避しました。 [#6677](https://github.com/ClickHouse/ClickHouse/pull/6677) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 定数引数に対して `arrayReduce` を使用すると、セグメンテーションフォルトが発生する場合があります。 [#6242](https://github.com/ClickHouse/ClickHouse/issues/6242) [#6326](https://github.com/ClickHouse/ClickHouse/pull/6326) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `DROP PARTITION` の後にレプリカを復元した場合に発生しうる不整合なパーツを修正しました。 [#6522](https://github.com/ClickHouse/ClickHouse/issues/6522) [#6523](https://github.com/ClickHouse/ClickHouse/pull/6523) ([tavplubix](https://github.com/tavplubix))
* `JSONExtractRaw` 関数で発生していたハングアップを修正しました。 [#6195](https://github.com/ClickHouse/ClickHouse/issues/6195) [#6198](https://github.com/ClickHouse/ClickHouse/pull/6198) ([alexey-milovidov](https://github.com/alexey-milovidov))
* アダプティブグラニュラリティ使用時の `skip indices` のシリアライゼーションおよび集約の誤りに関するバグを修正しました。 [#6594](https://github.com/ClickHouse/ClickHouse/issues/6594). [#6748](https://github.com/ClickHouse/ClickHouse/pull/6748) ([alesapin](https://github.com/alesapin))
* 二段階集計における `GROUP BY` の `WITH ROLLUP` および `WITH CUBE` 修飾子を修正しました。 [#6225](https://github.com/ClickHouse/ClickHouse/pull/6225) ([Anton Popov](https://github.com/CurtizJ))
* アダプティブグラニュラリティ使用時のセカンダリインデックスマークの書き込みに関するバグを修正。 [#6126](https://github.com/ClickHouse/ClickHouse/pull/6126) ([alesapin](https://github.com/alesapin))
* サーバー起動時の初期化順序を修正しました。`StorageMergeTree::background_task_handle` は `startup()` 内で初期化されるため、`MergeTreeBlockOutputStream::write()` が初期化前にそれを使用しようとする可能性があります。初期化されているかどうかを確認するようにしました。 [#6080](https://github.com/ClickHouse/ClickHouse/pull/6080) ([Ivan](https://github.com/abyss7))
* エラーで終了した直前の読み取り操作によるデータバッファをクリアします。 [#6026](https://github.com/ClickHouse/ClickHouse/pull/6026) ([Nikolay](https://github.com/bopohaa))
* Replicated*MergeTree テーブルの新しいレプリカを作成する際に `adaptive granularity` が有効化されてしまうバグを修正。 [#6394](https://github.com/ClickHouse/ClickHouse/issues/6394) [#6452](https://github.com/ClickHouse/ClickHouse/pull/6452) ([alesapin](https://github.com/alesapin))
* 初期化されていない `ThreadStatus` 構造体へのアクセスによる例外の処理中に `libunwind` でさらに例外が発生した場合、サーバー起動時にクラッシュする可能性があった問題を修正しました。 [#6456](https://github.com/ClickHouse/ClickHouse/pull/6456) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))
* `yandexConsistentHash` 関数で発生していたクラッシュを修正。fuzz テストにより発見。[#6304](https://github.com/ClickHouse/ClickHouse/issues/6304) [#6305](https://github.com/ClickHouse/ClickHouse/pull/6305) ([alexey-milovidov](https://github.com/alexey-milovidov))
* サーバーが過負荷となり、`global thread pool` がほぼ一杯になったときにクエリがハングする可能性があった問題を修正しました。これは、シャード数が非常に多い（数百）クラスタでより発生しやすくなります。分散クエリが各シャードへの接続ごとに 1 つのスレッドを割り当てるためです。例えば、330 シャードのクラスタが 30 個の分散クエリを同時に処理している場合に、この問題が再現する可能性があります。この問題は 19.2 以降のすべてのバージョンに影響します。 [#6301](https://github.com/ClickHouse/ClickHouse/pull/6301) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `arrayEnumerateUniqRanked` 関数のロジックを修正しました。 [#6423](https://github.com/ClickHouse/ClickHouse/pull/6423) ([alexey-milovidov](https://github.com/alexey-milovidov))
* シンボルテーブルのデコード時に発生するセグメンテーションフォールトを修正。 [#6603](https://github.com/ClickHouse/ClickHouse/pull/6603) ([Amos Bird](https://github.com/amosbird))
* `LowCardinality(Nullable)` を Null を含まない非 Nullable 列に `CAST` した際に発生していた不適切な例外を修正しました（例: `SELECT CAST(CAST('Hello' AS LowCardinality(Nullable(String))) AS String)` のようなクエリ）。[#6094](https://github.com/ClickHouse/ClickHouse/issues/6094) [#6119](https://github.com/ClickHouse/ClickHouse/pull/6119) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* `system.settings` テーブル内の description に対する不要な追加の引用符付けを削除しました。 [#6696](https://github.com/ClickHouse/ClickHouse/issues/6696) [#6699](https://github.com/ClickHouse/ClickHouse/pull/6699) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `Replicated` テーブルの `TRUNCATE` で発生する可能性のあるデッドロックを回避。 [#6695](https://github.com/ClickHouse/ClickHouse/pull/6695) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ソートキーの順序での読み取り処理を修正。 [#6189](https://github.com/ClickHouse/ClickHouse/pull/6189) ([Anton Popov](https://github.com/CurtizJ))
* `enable_mixed_granularity_parts=1` のテーブルに対する `ALTER TABLE ... UPDATE` クエリを修正。 [#6543](https://github.com/ClickHouse/ClickHouse/pull/6543) ([alesapin](https://github.com/alesapin))
* [#4405](https://github.com/ClickHouse/ClickHouse/pull/4405)（19.4.0 以降）で報告されたバグを修正。MergeTree テーブル上の Distributed テーブルに対するクエリで、どのカラムも取得しない場合（`SELECT 1`）に再現する問題。[#6236](https://github.com/ClickHouse/ClickHouse/pull/6236)（[alesapin](https://github.com/alesapin)）
* 符号付き型から符号なし型への整数除算で発生していたオーバーフローを修正しました。挙動は C や C++ 言語（整数の昇格規則）とまったく同じであり、意外に感じられる場合があります。なお、大きな符号付き数を大きな符号なし数で割る、あるいはその逆の場合には、依然としてオーバーフローが起こり得る点に注意してください（ただし、そのようなケースはあまり一般的ではありません）。この問題はすべてのサーバーバージョンに存在していました。 [#6214](https://github.com/ClickHouse/ClickHouse/issues/6214) [#6233](https://github.com/ClickHouse/ClickHouse/pull/6233) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `max_execution_speed` または `max_execution_speed_bytes` が設定されている場合のスロットリング時の最大スリープ時間を制限しました。`Estimated query execution time (inf seconds) is too long` といった誤ったエラーが発生する問題を修正しました。 [#5547](https://github.com/ClickHouse/ClickHouse/issues/5547) [#6232](https://github.com/ClickHouse/ClickHouse/pull/6232) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `MaterializedView` における `MATERIALIZED` カラムおよびエイリアスの使用に関する問題を修正しました。 [#448](https://github.com/ClickHouse/ClickHouse/issues/448) [#3484](https://github.com/ClickHouse/ClickHouse/issues/3484) [#3450](https://github.com/ClickHouse/ClickHouse/issues/3450) [#2878](https://github.com/ClickHouse/ClickHouse/issues/2878) [#2285](https://github.com/ClickHouse/ClickHouse/issues/2285) [#3796](https://github.com/ClickHouse/ClickHouse/pull/3796) ([Amos Bird](https://github.com/amosbird)) [#6316](https://github.com/ClickHouse/ClickHouse/pull/6316) ([alexey-milovidov](https://github.com/alexey-milovidov))
* プロセッサとして実装されていない入力ストリームに対する `FormatFactory` の動作を修正。 [#6495](https://github.com/ClickHouse/ClickHouse/pull/6495) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 誤字を修正。 [#6631](https://github.com/ClickHouse/ClickHouse/pull/6631) ([Alex Ryndin](https://github.com/alexryndin))
* エラーメッセージ内の誤記を修正 (is -&gt; are)。 [#6839](https://github.com/ClickHouse/ClickHouse/pull/6839) ([Denis Zhuravlev](https://github.com/den-crane))
* 型にカンマが含まれている場合に、文字列からカラムリストをパースするときに発生していたエラーを修正しました（この問題は `File`、`URL`、`HDFS` ストレージに影響していました）[#6217](https://github.com/ClickHouse/ClickHouse/issues/6217)。[#6209](https://github.com/ClickHouse/ClickHouse/pull/6209)（[dimarub2000](https://github.com/dimarub2000)）

#### セキュリティ修正 {#security-fix}

- このリリースには、19.13および19.11のすべてのセキュリティバグ修正も含まれています。
- SQLパーサーにおけるスタックオーバーフローにより、細工されたクエリがサーバークラッシュを引き起こす可能性を修正しました。また、Mergeテーブル、Distributedテーブル、マテリアライズドビュー、およびサブクエリを含む行レベルセキュリティの条件におけるスタックオーバーフローの可能性を修正しました。[#6433](https://github.com/ClickHouse/ClickHouse/pull/6433) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### 改善 {#improvement-3}


* `AND` と `OR` に対する三値論理の正しい実装。 [#6048](https://github.com/ClickHouse/ClickHouse/pull/6048) ([Alexander Kazakov](https://github.com/Akazz))
* これにより、TTL 情報が存在しない、または古い TTL 情報を持つ古いパーツについても（例：`ALTER ... MODIFY TTL` クエリ実行後）、`OPTIMIZE ... FINAL` クエリを実行すると、期限切れ TTL の値および行が削除されるようになりました。TTL を伴うマージの割り当てや、すべてのマージでの期限切れ値のフィルタリングを禁止/許可するために、`SYSTEM STOP/START TTL MERGES` クエリが追加されました。[#6274](https://github.com/ClickHouse/ClickHouse/pull/6274) ([Anton Popov](https://github.com/CurtizJ))
* クライアントが使用する ClickHouse の履歴ファイルの場所を、`CLICKHOUSE_HISTORY_FILE` 環境変数で変更できるようにした。 [#6840](https://github.com/ClickHouse/ClickHouse/pull/6840) ([filimonov](https://github.com/filimonov))
* `InterpreterSelectQuery` から `dry_run` フラグを削除。... [#6375](https://github.com/ClickHouse/ClickHouse/pull/6375) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* `ON` 句付きの `ASOF JOIN` をサポート。 [#6211](https://github.com/ClickHouse/ClickHouse/pull/6211) ([Artem Zuikov](https://github.com/4ertus2))
* ミューテーションおよびレプリケーションにおけるスキップインデックスのサポートを改善しました。`MATERIALIZE/CLEAR INDEX ... IN PARTITION` クエリをサポートしました。`UPDATE x = x` は、カラム `x` を使用するすべてのインデックスを再計算します。 [#5053](https://github.com/ClickHouse/ClickHouse/pull/5053) ([Nikita Vasilev](https://github.com/nikvas0))
* `allow_experimental_live_view` 設定に関係なく（例えばサーバー起動時に）ライブビューを `ATTACH` できるようにしました。 [#6754](https://github.com/ClickHouse/ClickHouse/pull/6754) ([alexey-milovidov](https://github.com/alexey-milovidov))
* クエリプロファイラによって収集されるスタックトレースには、クエリプロファイラ自身が生成したスタックフレームを含めないようにしました。 [#6250](https://github.com/ClickHouse/ClickHouse/pull/6250) ([alexey-milovidov](https://github.com/alexey-milovidov))
* テーブル関数 `values`、`file`、`url`、`hdfs` が ALIAS 列をサポートするようになりました。 [#6255](https://github.com/ClickHouse/ClickHouse/pull/6255) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `config.d` ファイルが設定ファイルと同じ対応するルート要素を持たない場合に、例外をスローするようにしました。 [#6123](https://github.com/ClickHouse/ClickHouse/pull/6123) ([dimarub2000](https://github.com/dimarub2000))
* `no space left on device` の例外メッセージに追加情報を出力するようにしました。 [#6182](https://github.com/ClickHouse/ClickHouse/issues/6182), [#6252](https://github.com/ClickHouse/ClickHouse/issues/6252) [#6352](https://github.com/ClickHouse/ClickHouse/pull/6352) ([tavplubix](https://github.com/tavplubix))
* 読み取りクエリでカバーされる `Distributed` テーブルのシャードを決定する際（`optimize_skip_unused_shards` = 1 の場合）、ClickHouse は `SELECT` 文の `PREWHERE` 句と `WHERE` 句の両方の条件を参照して判定するようになりました。 [#6521](https://github.com/ClickHouse/ClickHouse/pull/6521) ([Alexander Kazakov](https://github.com/Akazz))
* AVX2 はないが SSE 4.2 と PCLMUL 命令セットを備えるマシンで `SIMDJSON` を有効化しました。 [#6285](https://github.com/ClickHouse/ClickHouse/issues/6285) [#6320](https://github.com/ClickHouse/ClickHouse/pull/6320) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ClickHouse は、追加のチューニングを行わなくても `O_DIRECT` をサポートしないファイルシステム (ZFS や BtrFS など) 上で動作できます。 [#4449](https://github.com/ClickHouse/ClickHouse/issues/4449) [#6730](https://github.com/ClickHouse/ClickHouse/pull/6730) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `FINAL` サブクエリに対する述語プッシュダウンをサポート。 [#6120](https://github.com/ClickHouse/ClickHouse/pull/6120) ([TCeason](https://github.com/TCeason)) [#6162](https://github.com/ClickHouse/ClickHouse/pull/6162) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `JOIN ON` キー抽出の改善 [#6131](https://github.com/ClickHouse/ClickHouse/pull/6131) ([Artem Zuikov](https://github.com/4ertus2))
* `SIMDJSON` をアップデート。[#6285](https://github.com/ClickHouse/ClickHouse/issues/6285)。[#6306](https://github.com/ClickHouse/ClickHouse/pull/6306) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `SELECT count()` クエリで最小サイズのカラムが選択されるように最適化しました。 [#6344](https://github.com/ClickHouse/ClickHouse/pull/6344) ([Amos Bird](https://github.com/amosbird))
* `windowFunnel()` に `strict` パラメータを追加しました。`strict` が設定されている場合、`windowFunnel()` はユニークな値に対してのみ条件を適用します。 [#6548](https://github.com/ClickHouse/ClickHouse/pull/6548) ([achimbab](https://github.com/achimbab))
* `mysqlxx::Pool` のインターフェースをより安全にしました。 [#6150](https://github.com/ClickHouse/ClickHouse/pull/6150) ([avasiliev](https://github.com/avasiliev))
* `--help` オプションで実行した際のオプション行の幅が、端末サイズに合わせられるようになりました。 [#6590](https://github.com/ClickHouse/ClickHouse/pull/6590) ([dimarub2000](https://github.com/dimarub2000))
* キーなし集約に対する「read in order」最適化を無効化。 [#6599](https://github.com/ClickHouse/ClickHouse/pull/6599) ([Anton Popov](https://github.com/CurtizJ))
* `INCORRECT_DATA` と `TYPE_MISMATCH` の各エラーコードに対する HTTP ステータスコードが、デフォルトの `500 Internal Server Error` から `400 Bad Request` に変更されました。 [#6271](https://github.com/ClickHouse/ClickHouse/pull/6271) ([Alexander Rodin](https://github.com/a-rodin))
* `Join` オブジェクトを `ExpressionAction` から `AnalyzedJoin` に移動。`ExpressionAnalyzer` と `ExpressionAction` はもはや `Join` クラスを参照しません。そのロジックは `AnalyzedJoin` インターフェースによって隠蔽されています。 [#6801](https://github.com/ClickHouse/ClickHouse/pull/6801) ([Artem Zuikov](https://github.com/4ertus2))
* 分散クエリにおいて、シャードの一つが `localhost` であるにもかかわらず、クエリがネットワーク接続経由で送信されている場合に発生し得たデッドロックを修正しました。 [#6759](https://github.com/ClickHouse/ClickHouse/pull/6759) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 複数テーブルに対する `RENAME` のセマンティクスを変更し、デッドロックが発生する可能性を回避しました。 [#6757](https://github.com/ClickHouse/ClickHouse/issues/6757). [#6756](https://github.com/ClickHouse/ClickHouse/pull/6756) ([alexey-milovidov](https://github.com/alexey-milovidov))
* MySQL 互換サーバーを再実装し、パケットのペイロード全体をメモリに読み込まないようにしました。各接続あたりのメモリ消費量を、およそ `2 * DBMS_DEFAULT_BUFFER_SIZE`（読み取り/書き込みバッファ）まで削減しました。 [#5811](https://github.com/ClickHouse/ClickHouse/pull/5811) ([Yuriy Baranov](https://github.com/yurriy))
* クエリのセマンティクスを知る必要のないパーサーから、AST エイリアスの解釈ロジックを切り離しました。 [#6108](https://github.com/ClickHouse/ClickHouse/pull/6108) ([Artem Zuikov](https://github.com/4ertus2))
* `NamesAndTypesList` のパースをより安全にしました。 [#6408](https://github.com/ClickHouse/ClickHouse/issues/6408)。 [#6410](https://github.com/ClickHouse/ClickHouse/pull/6410) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `clickhouse-copier`：パーティションの存在確認を行うクエリで、設定ファイル中の `partition_key` エイリアスを含む `where_condition` を使用できるようにしました（これまではデータ読み取りクエリでのみ使用されていました）。 [#6577](https://github.com/ClickHouse/ClickHouse/pull/6577) ([proller](https://github.com/proller))
* `throwIf` にオプションのメッセージ引数を追加しました。 ([#5772](https://github.com/ClickHouse/ClickHouse/issues/5772)) [#6329](https://github.com/ClickHouse/ClickHouse/pull/6329) ([Vdimir](https://github.com/Vdimir))
* 挿入データ送信中に発生したサーバー側の例外が、クライアント側でも処理されるようになりました。 [#5891](https://github.com/ClickHouse/ClickHouse/issues/5891) [#6711](https://github.com/ClickHouse/ClickHouse/pull/6711) ([dimarub2000](https://github.com/dimarub2000))
* `DistributedFilesToInsert` というメトリクスを追加しました。これは、Distributed テーブルによってリモートサーバーに送信するために選択されたファイルシステム上のファイルの総数を示します。この値はすべてのシャードにわたって合計されます。 [#6600](https://github.com/ClickHouse/ClickHouse/pull/6600) ([alexey-milovidov](https://github.com/alexey-milovidov))
* JOIN の準備ロジックの大部分を `ExpressionAction/ExpressionAnalyzer` から `AnalyzedJoin` に移動しました。 [#6785](https://github.com/ClickHouse/ClickHouse/pull/6785) ([Artem Zuikov](https://github.com/4ertus2))
* TSan の[警告](https://clickhouse-test-reports.s3.yandex.net/6399/c1c1d1daa98e199e620766f1bd06a5921050a00d/functional_stateful_tests_\(thread\).html)「lock-order-inversion」を修正。 [#6740](https://github.com/ClickHouse/ClickHouse/pull/6740) ([Vasily Nemkov](https://github.com/Enmk))
* Linux の capabilities が不足している場合の情報メッセージを改善しました。致命的なエラーを `system.text_log` で見つけやすくするため、ログを &quot;fatal&quot; レベルで出力するようにしました。 [#6441](https://github.com/ClickHouse/ClickHouse/pull/6441) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `GROUP BY`、`ORDER BY` の実行中にメモリ使用量を制限するために一時データをディスクへダンプする機能を有効にしていても、空きディスク容量が確認されていませんでした。この問題を修正するため、新しい設定 `min_free_disk_space` が追加されました。空きディスク容量がこの閾値より小さい場合、クエリは停止して `ErrorCodes::NOT_ENOUGH_SPACE` をスローします。 [#6678](https://github.com/ClickHouse/ClickHouse/pull/6678) ([Weiqing Xu](https://github.com/weiqxu)) [#6691](https://github.com/ClickHouse/ClickHouse/pull/6691) ([alexey-milovidov](https://github.com/alexey-milovidov))
* スレッドごとの再帰的な rwlock を削除しました。スレッドはクエリ間で再利用されるため、これは意味がありません。`SELECT` クエリはあるスレッドでロックを取得し、別のスレッドのロックを保持したまま最初のスレッドを抜ける場合があります。同時に、その最初のスレッドが `DROP` クエリで再利用される可能性があります。これにより、誤って「Attempt to acquire exclusive lock recursively」というメッセージが出力されてしまいます。 [#6771](https://github.com/ClickHouse/ClickHouse/pull/6771) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `ExpressionAnalyzer.appendJoin()` を分割し、`ExpressionAnalyzer` 内に `MergeJoin` 用の場所を準備。 [#6524](https://github.com/ClickHouse/ClickHouse/pull/6524) ([Artem Zuikov](https://github.com/4ertus2))
* MySQL 互換サーバーに `mysql_native_password` 認証プラグインを追加しました。 [#6194](https://github.com/ClickHouse/ClickHouse/pull/6194) ([Yuriy Baranov](https://github.com/yurriy))
* `clock_gettime` 呼び出し回数を削減。`Allocator` においてデバッグ版とリリース版間の ABI 互換性を修正（重要度の低い問題）。 [#6197](https://github.com/ClickHouse/ClickHouse/pull/6197) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `collectUsedColumns` を `ExpressionAnalyzer` から `SyntaxAnalyzer` に移動しました。`SyntaxAnalyzer` は `required_source_columns` を自前で生成するようになりました。 [#6416](https://github.com/ClickHouse/ClickHouse/pull/6416) ([Artem Zuikov](https://github.com/4ertus2))
* `FROM` 句に複数のテーブルが存在する場合（つまり JOIN を含むクエリ）に、サブセレクトおよびテーブル関数にエイリアスを必須とする設定 `joined_subquery_requires_alias` を追加。 [#6733](https://github.com/ClickHouse/ClickHouse/pull/6733) ([Artem Zuikov](https://github.com/4ertus2))
* `ExpressionAnalyzer` から `GetAggregatesVisitor` クラスを抽出。 [#6458](https://github.com/ClickHouse/ClickHouse/pull/6458) ([Artem Zuikov](https://github.com/4ertus2))
* `system.query_log`: `type` 列のデータ型を `Enum` に変更。 [#6265](https://github.com/ClickHouse/ClickHouse/pull/6265) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))
* `sha256_password` 認証プラグインのスタティックリンク。 [#6512](https://github.com/ClickHouse/ClickHouse/pull/6512) ([Yuriy Baranov](https://github.com/yurriy))
* 設定 `compile` が動作するために追加の依存関係が不要になりました。以前のバージョンでは、ユーザーは `cannot open crti.o` や `unable to find library -lc` などのエラーが発生する可能性がありました。 [#6309](https://github.com/ClickHouse/ClickHouse/pull/6309) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 悪意のあるレプリカから送信される可能性のある入力に対する検証をさらに強化しました。 [#6303](https://github.com/ClickHouse/ClickHouse/pull/6303) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 現在は、`clickhouse-obfuscator` ファイルが `clickhouse-client` パッケージに含まれています。以前のバージョンでは、`clickhouse obfuscator`（空白あり）として提供されていました。[#5816](https://github.com/ClickHouse/ClickHouse/issues/5816) [#6609](https://github.com/ClickHouse/ClickHouse/pull/6609) ([dimarub2000](https://github.com/dimarub2000))
* 少なくとも 2 つのテーブルを異なる順序で読み取る少なくとも 2 つのクエリと、そのテーブルの 1 つに対して DDL 操作を実行する別のクエリが存在する場合に発生するデッドロックを修正しました。さらに、きわめてまれな別のデッドロックも修正しました。 [#6764](https://github.com/ClickHouse/ClickHouse/pull/6764) ([alexey-milovidov](https://github.com/alexey-milovidov))
* デバッグをより行いやすくするため、`system.processes` および `system.query_log` に `os_thread_ids` カラムを追加しました。 [#6763](https://github.com/ClickHouse/ClickHouse/pull/6763) ([alexey-milovidov](https://github.com/alexey-milovidov))
* デフォルトの認証プラグインとして `sha256_password` が使用されているときに発生する PHP の mysqlnd 拡張のバグに対する回避策（[#6031](https://github.com/ClickHouse/ClickHouse/issues/6031) で説明）。[#6113](https://github.com/ClickHouse/ClickHouse/pull/6113)（[Yuriy Baranov](https://github.com/yurriy)）
* null 許容性が変更された列に対する不要な領域を削除。 [#6693](https://github.com/ClickHouse/ClickHouse/pull/6693) ([Artem Zuikov](https://github.com/4ertus2))
* `queue_max_wait_ms` のデフォルト値を 0 に変更しました。現在の値（5 秒）には意味がないためです。この設定が有用なケースはごくまれです。区別を明確にするために、`replace_running_query_max_wait_ms`、`kafka_max_wait_ms`、`connection_pool_max_wait_ms` という設定を追加しました。 [#6692](https://github.com/ClickHouse/ClickHouse/pull/6692) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `ExpressionAnalyzer` から `SelectQueryExpressionAnalyzer` を抽出しました。非 `SELECT` クエリ向けには前者を引き続き使用します。 [#6499](https://github.com/ClickHouse/ClickHouse/pull/6499) ([Artem Zuikov](https://github.com/4ertus2))
* 重複していた入力フォーマットと出力フォーマットを削除しました。 [#6239](https://github.com/ClickHouse/ClickHouse/pull/6239) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 接続時にユーザーが `poll_interval` と `idle_connection_timeout` の設定を上書きできるようにしました。 [#6230](https://github.com/ClickHouse/ClickHouse/pull/6230) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `MergeTree` に、新たなオプション `ttl_only_drop_parts`（デフォルトでは無効）が追加されました。このオプションにより、パーツを部分的に削除するのではなく、そのパーツ内のすべての行が期限切れになったタイミングでパーツ全体を削除できるようになります。 [#6191](https://github.com/ClickHouse/ClickHouse/pull/6191) ([Sergi Vladykin](https://github.com/svladykin))
* set index 関数に対して型チェックを行い、誤った型が渡された場合には例外をスローします。これにより UBSan を用いたファジングテストの問題が修正されました。 [#6511](https://github.com/ClickHouse/ClickHouse/pull/6511) ([Nikita Vasilev](https://github.com/nikvas0))

#### パフォーマンス改善 {#performance-improvement-2}

- `MergeTree`テーブルのソートキーと一致するプレフィックスを持つ`expressions`を含む`ORDER BY expressions`句を使用したクエリを最適化します。この最適化は`optimize_read_in_order`設定で制御されます。[#6054](https://github.com/ClickHouse/ClickHouse/pull/6054) [#6629](https://github.com/ClickHouse/ClickHouse/pull/6629) ([Anton Popov](https://github.com/CurtizJ))
- パーツの読み込みと削除時に複数のスレッドを使用できるようにしました。[#6372](https://github.com/ClickHouse/ClickHouse/issues/6372) [#6074](https://github.com/ClickHouse/ClickHouse/issues/6074) [#6438](https://github.com/ClickHouse/ClickHouse/pull/6438) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 集約関数の状態を更新するバッチ処理バリアントを実装しました。これによりパフォーマンスが向上する可能性があります。[#6435](https://github.com/ClickHouse/ClickHouse/pull/6435) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `exp`、`log`、`sigmoid`、`tanh`関数に`FastOps`ライブラリを使用します。FastOpsはMichael Parakhin(Yandex CTO)による高速ベクトル演算ライブラリです。`exp`と`log`関数のパフォーマンスが6倍以上向上しました。`Float32`引数からの`exp`と`log`関数は`Float32`を返すようになります(以前のバージョンでは常に`Float64`を返していました)。現在、`exp(nan)`は`inf`を返す可能性があります。`exp`と`log`関数の結果は、真の答えに最も近い機械表現可能な数値ではない場合があります。[#6254](https://github.com/ClickHouse/ClickHouse/pull/6254) ([alexey-milovidov](https://github.com/alexey-milovidov)) fastopsを動作させるためにDanila Kuteninのバリアントを使用 [#6317](https://github.com/ClickHouse/ClickHouse/pull/6317) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `UInt8/16`の連続キー最適化を無効化しました。[#6298](https://github.com/ClickHouse/ClickHouse/pull/6298) [#6701](https://github.com/ClickHouse/ClickHouse/pull/6701) ([akuzm](https://github.com/akuzm))
- `ParsedJson::Iterator`での動的割り当てを排除することで`simdjson`ライブラリのパフォーマンスを改善しました。[#6479](https://github.com/ClickHouse/ClickHouse/pull/6479) ([Vitaly Baranov](https://github.com/vitlibar))
- `mmap()`でメモリを割り当てる際にページをプリフォルトします。[#6667](https://github.com/ClickHouse/ClickHouse/pull/6667) ([akuzm](https://github.com/akuzm))
- `Decimal`比較のパフォーマンスバグを修正しました。[#6380](https://github.com/ClickHouse/ClickHouse/pull/6380) ([Artem Zuikov](https://github.com/4ertus2))

#### ビルド/テスト/パッケージング改善 {#buildtestingpackaging-improvement-4}


* Compiler（ランタイムテンプレートインスタンス化）を削除しました。これは、そのパフォーマンスを上回ることができたためです。 [#6646](https://github.com/ClickHouse/ClickHouse/pull/6646) ([alexey-milovidov](https://github.com/alexey-milovidov))
* gcc-9 でのパフォーマンス低下を、より限定された条件で示すためのパフォーマンステストを追加しました。 [#6302](https://github.com/ClickHouse/ClickHouse/pull/6302) ([alexey-milovidov](https://github.com/alexey-milovidov))
* テーブル関数 `numbers_mt` を追加しました。これは `numbers` のマルチスレッド版です。ハッシュ関数を使用したパフォーマンステストを更新しました。 [#6554](https://github.com/ClickHouse/ClickHouse/pull/6554) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* `clickhouse-benchmark` の比較モード [#6220](https://github.com/ClickHouse/ClickHouse/issues/6220) [#6343](https://github.com/ClickHouse/ClickHouse/pull/6343) ([dimarub2000](https://github.com/dimarub2000))
* スタックトレース出力をベストエフォートで実行するよう対応。また、実行中のスレッドのスタックトレースを出力するデバッグ用シグナルとして `SIGPROF` を追加。[#6529](https://github.com/ClickHouse/ClickHouse/pull/6529) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 各関数を個別ファイルに分割、その10。 [#6321](https://github.com/ClickHouse/ClickHouse/pull/6321) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 二重に定義されていた `const TABLE_IS_READ_ONLY` を削除。 [#6566](https://github.com/ClickHouse/ClickHouse/pull/6566) ([filimonov](https://github.com/filimonov))
* `StringHashMap` 用の PR [#5417](https://github.com/ClickHouse/ClickHouse/issues/5417) に関するフォーマット変更。 [#6700](https://github.com/ClickHouse/ClickHouse/pull/6700) ([akuzm](https://github.com/akuzm))
* `ExpressionAnalyzer` における JOIN 作成のためのサブクエリの改善。 [#6824](https://github.com/ClickHouse/ClickHouse/pull/6824) ([Artem Zuikov](https://github.com/4ertus2))
* 冗長な条件を削除（PVS Studio により検出）。 [#6775](https://github.com/ClickHouse/ClickHouse/pull/6775) ([akuzm](https://github.com/akuzm))
* `ReverseIndex` 用のハッシュテーブルインターフェイスを分離。 [#6672](https://github.com/ClickHouse/ClickHouse/pull/6672) ([akuzm](https://github.com/akuzm))
* 設定のリファクタリング。 [#6689](https://github.com/ClickHouse/ClickHouse/pull/6689) ([alesapin](https://github.com/alesapin))
* `set` インデックス関数にコメントを追加しました。 [#6319](https://github.com/ClickHouse/ClickHouse/pull/6319) ([Nikita Vasilev](https://github.com/nikvas0))
* Linux のデバッグバージョンで OOM スコアを増加。 [#6152](https://github.com/ClickHouse/ClickHouse/pull/6152) ([akuzm](https://github.com/akuzm))
* HDFS の HA がデバッグビルドで動作するようになりました。 [#6650](https://github.com/ClickHouse/ClickHouse/pull/6650) ([Weiqing Xu](https://github.com/weiqxu))
* `transform_query_for_external_database` にテストを追加。 [#6388](https://github.com/ClickHouse/ClickHouse/pull/6388) ([alexey-milovidov](https://github.com/alexey-milovidov))
* Kafka テーブルに対する複数のマテリアライズドビューのテストを追加。 [#6509](https://github.com/ClickHouse/ClickHouse/pull/6509) ([Ivan](https://github.com/abyss7))
* ビルドスキームを改善。 [#6500](https://github.com/ClickHouse/ClickHouse/pull/6500) ([Ivan](https://github.com/abyss7))
* `root` 以外のユーザーで実行された場合の `test_external_dictionaries` 統合テストを修正。 [#6507](https://github.com/ClickHouse/ClickHouse/pull/6507) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 書き込まれるパケットの合計サイズが `DBMS_DEFAULT_BUFFER_SIZE` を超えると、このバグが再現します。 [#6204](https://github.com/ClickHouse/ClickHouse/pull/6204) ([Yuriy Baranov](https://github.com/yurriy))
* `RENAME` テーブルのレースコンディションに対するテストを追加した [#6752](https://github.com/ClickHouse/ClickHouse/pull/6752)（[alexey-milovidov](https://github.com/alexey-milovidov)）
* `KILL QUERY` における Settings のデータレースを回避。 [#6753](https://github.com/ClickHouse/ClickHouse/pull/6753) ([alexey-milovidov](https://github.com/alexey-milovidov))
* キャッシュ辞書のエラー処理用の統合テストを追加。 [#6755](https://github.com/ClickHouse/ClickHouse/pull/6755) ([Vitaly Baranov](https://github.com/vitlibar))
* Mac OS では ELF オブジェクトファイルのパースを無効化しました。意味がないためです。 [#6578](https://github.com/ClickHouse/ClickHouse/pull/6578) ([alexey-milovidov](https://github.com/alexey-milovidov))
* changelog ジェネレーターの改善を試みています。 [#6327](https://github.com/ClickHouse/ClickHouse/pull/6327) ([alexey-milovidov](https://github.com/alexey-milovidov))
* GCC に `-Wshadow` スイッチを追加。 [#6325](https://github.com/ClickHouse/ClickHouse/pull/6325) ([kreuzerkrieg](https://github.com/kreuzerkrieg))
* `mimalloc` サポート向けの不要なコードを削除しました。 [#6715](https://github.com/ClickHouse/ClickHouse/pull/6715) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `zlib-ng` は x86 の機能を判定し、その情報をグローバル変数に保存します。これは `defalteInit` の呼び出し時に行われますが、複数のスレッドから同時に呼び出される可能性があります。マルチスレッドによる書き込みを避けるため、ライブラリの起動時に実行するようにしました。 [#6141](https://github.com/ClickHouse/ClickHouse/pull/6141) ([akuzm](https://github.com/akuzm))
* [#5192](https://github.com/ClickHouse/ClickHouse/issues/5192) で修正された `JOIN` のバグに対するリグレッションテスト。 [#6147](https://github.com/ClickHouse/ClickHouse/pull/6147) ([Bakhtiyor Ruziev](https://github.com/theruziev))
* MSan レポートを修正。 [#6144](https://github.com/ClickHouse/ClickHouse/pull/6144) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 不安定な TTL テストを修正。 [#6782](https://github.com/ClickHouse/ClickHouse/pull/6782) ([Anton Popov](https://github.com/CurtizJ))
* `MergeTreeDataPart::is_frozen` フィールドで発生していた誤検出のデータ競合を修正。 [#6583](https://github.com/ClickHouse/ClickHouse/pull/6583) ([alexey-milovidov](https://github.com/alexey-milovidov))
* fuzz テストでのタイムアウト処理を修正しました。以前のバージョンでは、クエリ `SELECT * FROM numbers_mt(gccMurmurHash(''))` に対して、誤ってハングアップを検出していました。 [#6582](https://github.com/ClickHouse/ClickHouse/pull/6582) ([alexey-milovidov](https://github.com/alexey-milovidov))
* カラムの `static_cast` にデバッグ用チェックを追加しました。 [#6581](https://github.com/ClickHouse/ClickHouse/pull/6581) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 公式 RPM パッケージで Oracle Linux をサポート。 [#6356](https://github.com/ClickHouse/ClickHouse/issues/6356) [#6585](https://github.com/ClickHouse/ClickHouse/pull/6585) ([alexey-milovidov](https://github.com/alexey-milovidov))
* json のパフォーマンステストを `once` タイプから `loop` タイプに変更しました。 [#6536](https://github.com/ClickHouse/ClickHouse/pull/6536) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* `odbc-bridge.cpp` は `main()` を定義しているため、`clickhouse-lib` に含めるべきではありません。 [#6538](https://github.com/ClickHouse/ClickHouse/pull/6538) ([Orivej Desh](https://github.com/orivej))
* 右テーブルのキーに `NULL` が含まれる場合の `FULL|RIGHT JOIN` のクラッシュ用テスト。 [#6362](https://github.com/ClickHouse/ClickHouse/pull/6362) ([Artem Zuikov](https://github.com/4ertus2))
* 念のため、エイリアス展開の上限に対するテストを追加しました。 [#6442](https://github.com/ClickHouse/ClickHouse/pull/6442) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 適切な箇所で `boost::filesystem` から `std::filesystem` への移行を行いました。 [#6253](https://github.com/ClickHouse/ClickHouse/pull/6253) [#6385](https://github.com/ClickHouse/ClickHouse/pull/6385) ([alexey-milovidov](https://github.com/alexey-milovidov))
* RPM パッケージを Web サイトに追加しました。 [#6251](https://github.com/ClickHouse/ClickHouse/pull/6251) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `IN` セクションで修正された `Unknown identifier` 例外向けのテストを追加。 [#6708](https://github.com/ClickHouse/ClickHouse/pull/6708) ([Artem Zuikov](https://github.com/4ertus2))
* 理解しづらいという声があったため、`shared_ptr_helper` を簡素化しました。 [#6675](https://github.com/ClickHouse/ClickHouse/pull/6675) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 修正された `Gorilla` コーデックと `DoubleDelta` コーデック向けのパフォーマンステストを追加しました。 [#6179](https://github.com/ClickHouse/ClickHouse/pull/6179) ([Vasily Nemkov](https://github.com/Enmk))
* 統合テスト `test_dictionaries` を 4 つの個別テストに分割しました。 [#6776](https://github.com/ClickHouse/ClickHouse/pull/6776) ([Vitaly Baranov](https://github.com/vitlibar))
* `PipelineExecutor` の PVS-Studio 警告を修正。[#6777](https://github.com/ClickHouse/ClickHouse/pull/6777) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* ASan で `library` 辞書ソースを使用可能にした。 [#6482](https://github.com/ClickHouse/ClickHouse/pull/6482) ([alexey-milovidov](https://github.com/alexey-milovidov))
* PR のリストから変更履歴を生成するオプションを追加。 [#6350](https://github.com/ClickHouse/ClickHouse/pull/6350) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 読み取り時に `TinyLog` ストレージをロックする。 [#6226](https://github.com/ClickHouse/ClickHouse/pull/6226) ([akuzm](https://github.com/akuzm))
* CI で壊れたシンボリックリンクをチェックするように。 [#6634](https://github.com/ClickHouse/ClickHouse/pull/6634) ([alexey-milovidov](https://github.com/alexey-milovidov))
* デバッグビルドでは時間がかかる場合があるため、&quot;stack overflow&quot; テストのタイムアウトを延長。[#6637](https://github.com/ClickHouse/ClickHouse/pull/6637) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 連続する空白文字に対するチェックを追加しました。 [#6643](https://github.com/ClickHouse/ClickHouse/pull/6643) ([alexey-milovidov](https://github.com/alexey-milovidov))
* サニタイザ有効時にビルドした場合の `new/delete` メモリトラッキングを修正。トラッキングの内容は明確ではなく、テストにおいてメモリ制限の例外が発生するのを防ぐだけです。 [#6450](https://github.com/ClickHouse/ClickHouse/pull/6450) ([Artem Zuikov](https://github.com/4ertus2))
* リンク時の未定義シンボルのチェックを再度有効化。 [#6453](https://github.com/ClickHouse/ClickHouse/pull/6453) ([Ivan](https://github.com/abyss7))
* `hyperscan` を毎日再ビルドしないようにしました。 [#6307](https://github.com/ClickHouse/ClickHouse/pull/6307) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `ProtobufWriter` における UBSan レポートを修正しました。 [#6163](https://github.com/ClickHouse/ClickHouse/pull/6163) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 互換性がないため、sanitizer 使用時には query profiler を使えないようにしました。 [#6769](https://github.com/ClickHouse/ClickHouse/pull/6769) ([alexey-milovidov](https://github.com/alexey-milovidov))
* タイマーによる失敗後に辞書を再読み込みするテストを追加。 [#6114](https://github.com/ClickHouse/ClickHouse/pull/6114) ([Vitaly Baranov](https://github.com/vitlibar))
* `PipelineExecutor::prepareProcessor` の引数型の不整合を修正。 [#6494](https://github.com/ClickHouse/ClickHouse/pull/6494) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 不正な URI 向けのテストを追加しました。 [#6493](https://github.com/ClickHouse/ClickHouse/pull/6493) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `CAST` 関数にさらなるチェックを追加しました。これにより、ファジーテストにおけるセグメンテーションフォルトに関する情報をより多く取得できるようになります。 [#6346](https://github.com/ClickHouse/ClickHouse/pull/6346) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* ローカルでイメージをビルドする `docker/builder` コンテナに `gcc-9` サポートを追加しました。 [#6333](https://github.com/ClickHouse/ClickHouse/pull/6333) ([Gleb Novikov](https://github.com/NanoBjorn))
* `LowCardinality(String)` を主キーに使用したテスト。 [#5044](https://github.com/ClickHouse/ClickHouse/issues/5044) [#6219](https://github.com/ClickHouse/ClickHouse/pull/6219) ([dimarub2000](https://github.com/dimarub2000))
* スタックトレースの出力が遅いことの影響を受けていたテストを修正しました。 [#6315](https://github.com/ClickHouse/ClickHouse/pull/6315) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `groupUniqArray` で発生していたクラッシュを [#6029](https://github.com/ClickHouse/ClickHouse/pull/6029) で修正した件について、その再現用テストケースを追加。 [#4402](https://github.com/ClickHouse/ClickHouse/issues/4402) [#6129](https://github.com/ClickHouse/ClickHouse/pull/6129) ([akuzm](https://github.com/akuzm))
* 固定インデックスに関するミューテーションのテストを修正。 [#6645](https://github.com/ClickHouse/ClickHouse/pull/6645) ([Nikita Vasilev](https://github.com/nikvas0))
* パフォーマンステストにおいて、実行していないクエリに対しては `query log` を読み取らないようにする。 [#6427](https://github.com/ClickHouse/ClickHouse/pull/6427) ([akuzm](https://github.com/akuzm))
* マテリアライズドビューは、疑わしい低カーディナリティ型に関する設定に関係なく、任意の低カーディナリティ型を使用して作成できるようになりました。 [#6428](https://github.com/ClickHouse/ClickHouse/pull/6428) ([Olga Khvostikova](https://github.com/stavrolia))
* `send_logs_level` 設定向けのテストを更新。 [#6207](https://github.com/ClickHouse/ClickHouse/pull/6207) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* gcc-8.2 環境でのビルドを修正。[#6196](https://github.com/ClickHouse/ClickHouse/pull/6196) ([Max Akhmedov](https://github.com/zlobober))
* internal libc++ によるビルドを修正。 [#6724](https://github.com/ClickHouse/ClickHouse/pull/6724) ([Ivan](https://github.com/abyss7))
* `rdkafka` ライブラリを使った共有ビルドを修正 [#6101](https://github.com/ClickHouse/ClickHouse/pull/6101) ([Ivan](https://github.com/abyss7))
* Mac OS 向けビルドの修正（未完了）。 [#6390](https://github.com/ClickHouse/ClickHouse/pull/6390) ([alexey-milovidov](https://github.com/alexey-milovidov)) [#6429](https://github.com/ClickHouse/ClickHouse/pull/6429) ([alex-zaitsev](https://github.com/alex-zaitsev))
* 「splitted」ビルドを修正。 [#6618](https://github.com/ClickHouse/ClickHouse/pull/6618) ([alexey-milovidov](https://github.com/alexey-milovidov))
* その他のビルド関連の修正: [#6186](https://github.com/ClickHouse/ClickHouse/pull/6186) ([Amos Bird](https://github.com/amosbird)) [#6486](https://github.com/ClickHouse/ClickHouse/pull/6486) [#6348](https://github.com/ClickHouse/ClickHouse/pull/6348) ([vxider](https://github.com/Vxider)) [#6744](https://github.com/ClickHouse/ClickHouse/pull/6744) ([Ivan](https://github.com/abyss7)) [#6016](https://github.com/ClickHouse/ClickHouse/pull/6016) [#6421](https://github.com/ClickHouse/ClickHouse/pull/6421) [#6491](https://github.com/ClickHouse/ClickHouse/pull/6491) ([proller](https://github.com/proller))

#### 後方互換性のない変更 {#backward-incompatible-change-3}

- 使用頻度の低いテーブル関数 `catBoostPool` とストレージ `CatBoostPool` を削除しました。このテーブル関数を使用していた場合は、`feedback@clickhouse.com` までメールでお知らせください。なお、CatBoost統合は引き続き維持され、サポートされます。[#6279](https://github.com/ClickHouse/ClickHouse/pull/6279) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `ANY RIGHT JOIN` と `ANY FULL JOIN` をデフォルトで無効化しました。これらを有効にするには、`any_join_distinct_right_table_keys` 設定を指定してください。[#5126](https://github.com/ClickHouse/ClickHouse/issues/5126) [#6351](https://github.com/ClickHouse/ClickHouse/pull/6351) ([Artem Zuikov](https://github.com/4ertus2))


## ClickHouse リリース 19.13 {#clickhouse-release-19-13}

### ClickHouse リリース 19.13.6.51, 2019-10-02 {#clickhouse-release-19-13-6-51-2019-10-02}

#### バグ修正 {#bug-fix-9}

- このリリースには、19.11.12.69 のすべてのバグ修正も含まれています。

### ClickHouse リリース 19.13.5.44, 2019-09-20 {#clickhouse-release-19-13-5-44-2019-09-20}

#### バグ修正 {#bug-fix-10}

- このリリースには、19.14.6.12 のすべてのバグ修正も含まれています。
- ZooKeeper にアクセスできない状態でレプリケートされたテーブルに対して `DROP` クエリを実行する際に、テーブルの状態が不整合になる可能性がある問題を修正しました。[#6045](https://github.com/ClickHouse/ClickHouse/issues/6045) [#6413](https://github.com/ClickHouse/ClickHouse/pull/6413) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))
- StorageMerge におけるデータ競合を修正しました。[#6717](https://github.com/ClickHouse/ClickHouse/pull/6717) ([alexey-milovidov](https://github.com/alexey-milovidov))
- クエリプロファイラで導入されたバグを修正しました。このバグはソケットからの無限の recv を引き起こしていました。[#6386](https://github.com/ClickHouse/ClickHouse/pull/6386) ([alesapin](https://github.com/alesapin))
- ブール値に対して `JSONExtractRaw` 関数を実行する際の過度な CPU 使用率を修正しました。[#6208](https://github.com/ClickHouse/ClickHouse/pull/6208) ([Vitaly Baranov](https://github.com/vitlibar))
- マテリアライズドビューへのプッシュ時のリグレッションを修正しました。[#6415](https://github.com/ClickHouse/ClickHouse/pull/6415) ([Ivan](https://github.com/abyss7))
- テーブル関数 `url` に、攻撃者がリクエストに任意の HTTP ヘッダーを注入できる脆弱性がありました。この問題は [Nikita Tikhomirov](https://github.com/NSTikhomirov) によって発見されました。[#6466](https://github.com/ClickHouse/ClickHouse/pull/6466) ([alexey-milovidov](https://github.com/alexey-milovidov))
- Set インデックスにおける不要な `AST` チェックを修正しました。[#6510](https://github.com/ClickHouse/ClickHouse/issues/6510) [#6651](https://github.com/ClickHouse/ClickHouse/pull/6651) ([Nikita Vasilev](https://github.com/nikvas0))
- クエリに埋め込まれた `AggregateFunction` 値の解析を修正しました。[#6575](https://github.com/ClickHouse/ClickHouse/issues/6575) [#6773](https://github.com/ClickHouse/ClickHouse/pull/6773) ([Zhichang Yu](https://github.com/yuzhichang))
- `trim` 関数ファミリーの誤った動作を修正しました。[#6647](https://github.com/ClickHouse/ClickHouse/pull/6647) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.13.4.32, 2019-09-10 {#clickhouse-release-19-13-4-32-2019-09-10}

#### バグ修正 {#bug-fix-11}


- このリリースには、19.11.9.52および19.11.10.54のすべてのバグおよびセキュリティ修正が含まれています。
- `system.parts`テーブルと`ALTER`クエリにおけるデータ競合を修正しました。[#6245](https://github.com/ClickHouse/ClickHouse/issues/6245) [#6513](https://github.com/ClickHouse/ClickHouse/pull/6513) ([alexey-milovidov](https://github.com/alexey-milovidov))
- sampleとprewhereを使用した空の分散テーブルからの読み取り時に発生するストリームのヘッダー不一致を修正しました。[#6167](https://github.com/ClickHouse/ClickHouse/issues/6167) ([Lixiang Qian](https://github.com/fancyqlx)) [#6823](https://github.com/ClickHouse/ClickHouse/pull/6823) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- タプルを含むサブクエリで`IN`句を使用した際のクラッシュを修正しました。[#6125](https://github.com/ClickHouse/ClickHouse/issues/6125) [#6550](https://github.com/ClickHouse/ClickHouse/pull/6550) ([tavplubix](https://github.com/tavplubix))
- `GLOBAL JOIN ON`セクションで同じカラム名が使用されている場合の問題を修正しました。[#6181](https://github.com/ClickHouse/ClickHouse/pull/6181) ([Artem Zuikov](https://github.com/4ertus2))
- サポートされていない型を`Decimal`にキャストした際のクラッシュを修正しました。代わりに例外をスローするようになりました。[#6297](https://github.com/ClickHouse/ClickHouse/pull/6297) ([Artem Zuikov](https://github.com/4ertus2))
- `extractAll()`関数のクラッシュを修正しました。[#6644](https://github.com/ClickHouse/ClickHouse/pull/6644) ([Artem Zuikov](https://github.com/4ertus2))
- `MySQL`、`ODBC`、`JDBC`テーブル関数のクエリ変換が、複数の`AND`式を含む`SELECT WHERE`クエリで正しく動作するようになりました。[#6381](https://github.com/ClickHouse/ClickHouse/issues/6381) [#6676](https://github.com/ClickHouse/ClickHouse/pull/6676) ([dimarub2000](https://github.com/dimarub2000))
- MySQL 8統合のための事前宣言チェックを追加しました。[#6569](https://github.com/ClickHouse/ClickHouse/pull/6569) ([Rafael David Tinoco](https://github.com/rafaeldtinoco))

#### セキュリティ修正 {#security-fix-1}

- 展開フェーズにおけるコーデックの2つの脆弱性を修正しました（悪意のあるユーザーが展開時にバッファオーバーフローを引き起こす圧縮データを作成できる問題）。[#6670](https://github.com/ClickHouse/ClickHouse/pull/6670) ([Artem Zuikov](https://github.com/4ertus2))

### ClickHouse リリース 19.13.3.26, 2019-08-22 {#clickhouse-release-19-13-3-26-2019-08-22}

#### バグ修正 {#bug-fix-12}


- `enable_mixed_granularity_parts=1`を持つテーブルに対する`ALTER TABLE ... UPDATE`クエリを修正しました。[#6543](https://github.com/ClickHouse/ClickHouse/pull/6543) ([alesapin](https://github.com/alesapin))
- タプルを含むサブクエリでIN句を使用した際のNPEを修正しました。[#6125](https://github.com/ClickHouse/ClickHouse/issues/6125) [#6550](https://github.com/ClickHouse/ClickHouse/pull/6550) ([tavplubix](https://github.com/tavplubix))
- 停止していたレプリカが復帰した際に、DROP PARTITIONによって削除されたデータパーツが残存する可能性がある問題を修正しました。[#6522](https://github.com/ClickHouse/ClickHouse/issues/6522) [#6523](https://github.com/ClickHouse/ClickHouse/pull/6523) ([tavplubix](https://github.com/tavplubix))
- CSVの解析に関する問題を修正しました。[#6426](https://github.com/ClickHouse/ClickHouse/issues/6426) [#6559](https://github.com/ClickHouse/ClickHouse/pull/6559) ([tavplubix](https://github.com/tavplubix))
- system.partsテーブルとALTERクエリにおけるデータ競合を修正しました。これにより[#6245](https://github.com/ClickHouse/ClickHouse/issues/6245)が修正されます。[#6513](https://github.com/ClickHouse/ClickHouse/pull/6513) ([alexey-milovidov](https://github.com/alexey-milovidov))
- メモリ破損を引き起こす可能性のあるミューテーション内の誤ったコードを修正しました。`DROP TABLE`と`system.parts`または`system.parts_columns`からの`SELECT`の同時実行により発生する可能性のあるアドレス`0x14c0`の読み取りによるセグメンテーション違反を修正しました。ミューテーションクエリの準備における競合状態を修正しました。レプリケートテーブルの`OPTIMIZE`とALTERなどの同時変更操作によって引き起こされるデッドロックを修正しました。[#6514](https://github.com/ClickHouse/ClickHouse/pull/6514) ([alexey-milovidov](https://github.com/alexey-milovidov))
- スキッピングインデックスを持つテーブルに対する`ALTER DELETE`クエリ後に発生する可能性のあるデータ損失を修正しました。[#6224](https://github.com/ClickHouse/ClickHouse/issues/6224) [#6282](https://github.com/ClickHouse/ClickHouse/pull/6282) ([Nikita Vasilev](https://github.com/nikvas0))

#### セキュリティ修正 {#security-fix-2}

- 攻撃者がZooKeeperへの書き込みアクセス権を持ち、ClickHouseが実行されているネットワークからアクセス可能なカスタムサーバーを実行できる場合、ClickHouseレプリカとして動作する悪意のあるカスタムサーバーを作成し、ZooKeeperに登録することができます。別のレプリカが悪意のあるレプリカからデータパーツを取得すると、clickhouse-serverにファイルシステム上の任意のパスへの書き込みを強制できます。Yandexの情報セキュリティチームのEldar Zaitovによって発見されました。[#6247](https://github.com/ClickHouse/ClickHouse/pull/6247) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouseリリース 19.13.2.19, 2019-08-14 {#clickhouse-release-19-13-2-19-2019-08-14}

#### 新機能 {#new-feature-5}


- クエリレベルのサンプリングプロファイラ。[例](https://gist.github.com/alexey-milovidov/92758583dd41c24c360fdb8d6a4da194)。[#4247](https://github.com/ClickHouse/ClickHouse/issues/4247) ([laplab](https://github.com/laplab)) [#6124](https://github.com/ClickHouse/ClickHouse/pull/6124) ([alexey-milovidov](https://github.com/alexey-milovidov)) [#6250](https://github.com/ClickHouse/ClickHouse/pull/6250) [#6283](https://github.com/ClickHouse/ClickHouse/pull/6283) [#6386](https://github.com/ClickHouse/ClickHouse/pull/6386)
- `COLUMNS('regexp')` 式を使用してカラムのリストを指定できるようになりました。これは `*` アスタリスクのより高度な変種として機能します。[#5951](https://github.com/ClickHouse/ClickHouse/pull/5951) ([mfridental](https://github.com/mfridental))、([alexey-milovidov](https://github.com/alexey-milovidov))
- `CREATE TABLE AS table_function()` が使用可能になりました [#6057](https://github.com/ClickHouse/ClickHouse/pull/6057) ([dimarub2000](https://github.com/dimarub2000))
- `stochasticLinearRegression()` および `stochasticLogisticRegression()` 集約関数では、確率的勾配降下法のためのAdamオプティマイザがデフォルトで使用されるようになりました。これは、ほとんどチューニングなしで良好な品質を示すためです。[#6000](https://github.com/ClickHouse/ClickHouse/pull/6000) ([Quid37](https://github.com/Quid37))
- カスタム週番号を扱うための関数を追加しました [#5212](https://github.com/ClickHouse/ClickHouse/pull/5212) ([Andy Yang](https://github.com/andyyzh))
- `RENAME` クエリがすべてのストレージで動作するようになりました。[#5953](https://github.com/ClickHouse/ClickHouse/pull/5953) ([Ivan](https://github.com/abyss7))
- クライアントは、サーバー設定で指定されたログレベルに関係なく、`send_logs_level` を設定することで、任意のレベルのログをサーバーから受信できるようになりました。[#5964](https://github.com/ClickHouse/ClickHouse/pull/5964) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))

#### 後方互換性のない変更 {#backward-incompatible-change-4}

- 設定 `input_format_defaults_for_omitted_fields` がデフォルトで有効になりました。Distributedテーブルへの挿入では、この設定がクラスタ全体で同じである必要があります(ローリングアップデート前に設定する必要があります)。これにより、`JSONEachRow` および `CSV*` 形式で省略されたフィールドに対する複雑なデフォルト式の計算が有効になります。これは期待される動作ですが、わずかなパフォーマンスの違いが生じる可能性があります。[#6043](https://github.com/ClickHouse/ClickHouse/pull/6043) ([Artem Zuikov](https://github.com/4ertus2))、[#5625](https://github.com/ClickHouse/ClickHouse/pull/5625) ([akuzm](https://github.com/akuzm))

#### 実験的機能 {#experimental-features}

- 新しいクエリ処理パイプライン。有効にするには `experimental_use_processors=1` オプションを使用してください。自己責任でご使用ください。[#4914](https://github.com/ClickHouse/ClickHouse/pull/4914) ([Nikolai Kochetov](https://github.com/KochetovNicolai))

#### バグ修正 {#bug-fix-13}

- このバージョンでKafka統合が修正されました。
- 大きな `DoubleDelta` 値に対する `Int64` の `DoubleDelta` エンコーディングを修正し、`Int32` のランダムデータに対する `DoubleDelta` エンコーディングを改善しました。[#5998](https://github.com/ClickHouse/ClickHouse/pull/5998) ([Vasily Nemkov](https://github.com/Enmk))
- 設定 `merge_tree_uniform_read_distribution` が0に設定されている場合の `max_rows_to_read` の過大評価を修正しました。[#6019](https://github.com/ClickHouse/ClickHouse/pull/6019) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### 改善 {#improvement-4}

- `config.d` ファイルが設定ファイルと対応するルート要素を持たない場合に例外をスローするようになりました [#6123](https://github.com/ClickHouse/ClickHouse/pull/6123) ([dimarub2000](https://github.com/dimarub2000))


#### パフォーマンス改善 {#performance-improvement-3}

- `count()` を最適化しました。可能な場合、最小のカラムを使用するようになりました。[#6028](https://github.com/ClickHouse/ClickHouse/pull/6028) ([Amos Bird](https://github.com/amosbird))

#### ビルド/テスト/パッケージング改善 {#buildtestingpackaging-improvement-5}

- パフォーマンステストでメモリ使用量をレポートするようにしました。[#5899](https://github.com/ClickHouse/ClickHouse/pull/5899) ([akuzm](https://github.com/akuzm))
- 外部 `libcxx` でのビルドを修正しました。[#6010](https://github.com/ClickHouse/ClickHouse/pull/6010) ([Ivan](https://github.com/abyss7))
- `rdkafka` ライブラリを使用した共有ビルドを修正しました。[#6101](https://github.com/ClickHouse/ClickHouse/pull/6101) ([Ivan](https://github.com/abyss7))


## ClickHouse リリース 19.11 {#clickhouse-release-19-11}

### ClickHouse リリース 19.11.13.74, 2019-11-01 {#clickhouse-release-19-11-13-74-2019-11-01}

#### バグ修正 {#bug-fix-14}

- マージまたは変更されるパーツの1つが空(0行)の場合に、`ALTER MODIFY COLUMN`と垂直マージで発生する稀なクラッシュを修正しました。[#6780](https://github.com/ClickHouse/ClickHouse/pull/6780) ([alesapin](https://github.com/alesapin))
- `SIMDJSON`の手動更新。不正なJSON診断メッセージによるstderrファイルの氾濫の可能性を修正しました。[#7548](https://github.com/ClickHouse/ClickHouse/pull/7548) ([Alexander Kazakov](https://github.com/Akazz))
- ミューテーションにおける`mrk`ファイル拡張子のバグを修正しました ([alesapin](https://github.com/alesapin))

### ClickHouse リリース 19.11.12.69, 2019-10-02 {#clickhouse-release-19-11-12-69-2019-10-02}

#### バグ修正 {#bug-fix-15}

- 大規模テーブルにおける複雑なキーのインデックス解析のパフォーマンス低下を修正しました。これは[#6924](https://github.com/ClickHouse/ClickHouse/issues/6924)を修正します。[#7075](https://github.com/ClickHouse/ClickHouse/pull/7075) ([alexey-milovidov](https://github.com/alexey-milovidov))
- Distributedエンジンを使用したテーブルでデータ送信中に発生する稀なSIGSEGVを回避しました(`Failed to send batch: file with index XXXXX is absent`)。[#7032](https://github.com/ClickHouse/ClickHouse/pull/7032) ([Azat Khuzhin](https://github.com/azat))
- 複数のJOINにおける`Unknown identifier`を修正しました。これは[#5254](https://github.com/ClickHouse/ClickHouse/issues/5254)を修正します。[#7022](https://github.com/ClickHouse/ClickHouse/pull/7022) ([Artem Zuikov](https://github.com/4ertus2))

### ClickHouse リリース 19.11.11.57, 2019-09-13 {#clickhouse-release-19-11-11-57-2019-09-13}

- Kafkaの空のトピックから選択する際にセグメンテーション違反を引き起こす論理エラーを修正しました。[#6902](https://github.com/ClickHouse/ClickHouse/issues/6902) [#6909](https://github.com/ClickHouse/ClickHouse/pull/6909) ([Ivan](https://github.com/abyss7))
- パラメータに空の配列がある場合の関数`АrrayEnumerateUniqRanked`を修正しました。[#6928](https://github.com/ClickHouse/ClickHouse/pull/6928) ([proller](https://github.com/proller))

### ClickHouse リリース 19.11.10.54, 2019-09-10 {#clickhouse-release-19-11-10-54-2019-09-10}

#### バグ修正 {#bug-fix-16}

- すべてのパーティションに対して一度にコミットできるように、Kafkaメッセージのオフセットを手動で保存するようにしました。「1つのコンシューマー - 複数のパーティション」シナリオにおける潜在的な重複を修正します。[#6872](https://github.com/ClickHouse/ClickHouse/pull/6872) ([Ivan](https://github.com/abyss7))

### ClickHouse リリース 19.11.9.52, 2019-09-6 {#clickhouse-release-19-11-9-52-2019-09-6}


- キャッシュディクショナリのエラーハンドリングを改善しました。[#6737](https://github.com/ClickHouse/ClickHouse/pull/6737) ([Vitaly Baranov](https://github.com/vitlibar))
- `arrayEnumerateUniqRanked`関数のバグを修正しました。[#6779](https://github.com/ClickHouse/ClickHouse/pull/6779) ([proller](https://github.com/proller))
- JSONから`Tuple`を抽出する際の`JSONExtract`関数を修正しました。[#6718](https://github.com/ClickHouse/ClickHouse/pull/6718) ([Vitaly Baranov](https://github.com/vitlibar))
- スキッピングインデックスを持つテーブルに対する`ALTER DELETE`クエリ実行後に発生する可能性のあるデータ損失を修正しました。[#6224](https://github.com/ClickHouse/ClickHouse/issues/6224) [#6282](https://github.com/ClickHouse/ClickHouse/pull/6282) ([Nikita Vasilev](https://github.com/nikvas0))
- パフォーマンステストを修正しました。[#6392](https://github.com/ClickHouse/ClickHouse/pull/6392) ([alexey-milovidov](https://github.com/alexey-milovidov))
- Parquet: ブール型カラムの読み取りを修正しました。[#6579](https://github.com/ClickHouse/ClickHouse/pull/6579) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 定数引数に対する`nullIf`関数の誤った動作を修正しました。[#6518](https://github.com/ClickHouse/ClickHouse/pull/6518) ([Guillaume Tassery](https://github.com/YiuRULE)) [#6580](https://github.com/ClickHouse/ClickHouse/pull/6580) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 通常のサーバー再起動時のKafkaメッセージ重複問題を修正しました。[#6597](https://github.com/ClickHouse/ClickHouse/pull/6597) ([Ivan](https://github.com/abyss7))
- 長時間の`ALTER UPDATE`または`ALTER DELETE`が通常のマージの実行を妨げる可能性がある問題を修正しました。利用可能な空きスレッドが不足している場合、ミューテーションの実行を防止します。[#6502](https://github.com/ClickHouse/ClickHouse/issues/6502) [#6617](https://github.com/ClickHouse/ClickHouse/pull/6617) ([tavplubix](https://github.com/tavplubix))
- サーバー設定ファイルにおける「timezone」の処理エラーを修正しました。[#6709](https://github.com/ClickHouse/ClickHouse/pull/6709) ([alexey-milovidov](https://github.com/alexey-milovidov))
- kafkaテストを修正しました。[#6805](https://github.com/ClickHouse/ClickHouse/pull/6805) ([Ivan](https://github.com/abyss7))

#### セキュリティ修正 {#security-fix-3}

- 攻撃者がZooKeeperへの書き込みアクセス権を持ち、ClickHouseが稼働するネットワークからアクセス可能なカスタムサーバーを実行できる場合、ClickHouseレプリカとして動作する悪意のあるカスタムサーバーを作成し、ZooKeeperに登録することができます。別のレプリカが悪意のあるレプリカからデータパートを取得すると、clickhouse-serverにファイルシステム上の任意のパスへの書き込みを強制できます。Yandex情報セキュリティチームのEldar Zaitovによって発見されました。[#6247](https://github.com/ClickHouse/ClickHouse/pull/6247) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.11.8.46, 2019-08-22 {#clickhouse-release-19-11-8-46-2019-08-22}

#### バグ修正 {#bug-fix-17}


- `enable_mixed_granularity_parts=1`が設定されたテーブルに対する`ALTER TABLE ... UPDATE`クエリを修正しました。[#6543](https://github.com/ClickHouse/ClickHouse/pull/6543) ([alesapin](https://github.com/alesapin))
- タプルを含むサブクエリでIN句を使用した際のNPE(NullPointerException)を修正しました。[#6125](https://github.com/ClickHouse/ClickHouse/issues/6125) [#6550](https://github.com/ClickHouse/ClickHouse/pull/6550) ([tavplubix](https://github.com/tavplubix))
- 停止していたレプリカが復帰した際に、DROP PARTITIONで削除されたデータパーツが残存する可能性がある問題を修正しました。[#6522](https://github.com/ClickHouse/ClickHouse/issues/6522) [#6523](https://github.com/ClickHouse/ClickHouse/pull/6523) ([tavplubix](https://github.com/tavplubix))
- CSVの解析に関する問題を修正しました。[#6426](https://github.com/ClickHouse/ClickHouse/issues/6426) [#6559](https://github.com/ClickHouse/ClickHouse/pull/6559) ([tavplubix](https://github.com/tavplubix))
- system.partsテーブルとALTERクエリにおけるデータ競合を修正しました。これにより[#6245](https://github.com/ClickHouse/ClickHouse/issues/6245)が修正されます。[#6513](https://github.com/ClickHouse/ClickHouse/pull/6513) ([alexey-milovidov](https://github.com/alexey-milovidov))
- メモリ破損を引き起こす可能性のあるミューテーション内の誤ったコードを修正しました。`DROP TABLE`と`system.parts`または`system.parts_columns`からの`SELECT`の同時実行により発生する可能性のあるアドレス`0x14c0`の読み取りによるセグメンテーション違反を修正しました。ミューテーションクエリの準備における競合状態を修正しました。レプリケートテーブルの`OPTIMIZE`とALTERなどの同時変更操作によって引き起こされるデッドロックを修正しました。[#6514](https://github.com/ClickHouse/ClickHouse/pull/6514) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.11.7.40, 2019-08-14 {#clickhouse-release-19-11-7-40-2019-08-14}

#### バグ修正 {#bug-fix-18}


- このバージョンでKafka統合を修正しました。
- 定数引数に対して`arrayReduce`を使用した際のセグメンテーション違反を修正しました。[#6326](https://github.com/ClickHouse/ClickHouse/pull/6326) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `toFloat()`の単調性を修正しました。[#6374](https://github.com/ClickHouse/ClickHouse/pull/6374) ([dimarub2000](https://github.com/dimarub2000))
- `optimize_skip_unused_shards`が有効でシャーディングキーが欠落している場合のセグメンテーション違反を修正しました。[#6384](https://github.com/ClickHouse/ClickHouse/pull/6384) ([CurtizJ](https://github.com/CurtizJ))
- `arrayEnumerateUniqRanked`関数のロジックを修正しました。[#6423](https://github.com/ClickHouse/ClickHouse/pull/6423) ([alexey-milovidov](https://github.com/alexey-milovidov))
- MySQLハンドラから冗長なログ出力を削除しました。[#6389](https://github.com/ClickHouse/ClickHouse/pull/6389) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `topK`および`topKWeighted`集約関数における誤った動作と潜在的なセグメンテーション違反を修正しました。[#6404](https://github.com/ClickHouse/ClickHouse/pull/6404) ([CurtizJ](https://github.com/CurtizJ))
- `system.columns`テーブルで仮想カラムを公開しないようにしました。これは後方互換性のために必要です。[#6406](https://github.com/ClickHouse/ClickHouse/pull/6406) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 複合キーキャッシュディクショナリにおける文字列フィールドのメモリ割り当てに関するバグを修正しました。[#6447](https://github.com/ClickHouse/ClickHouse/pull/6447) ([alesapin](https://github.com/alesapin))
- `Replicated*MergeTree`テーブルの新しいレプリカを作成する際に適応的粒度を有効にする際のバグを修正しました。[#6452](https://github.com/ClickHouse/ClickHouse/pull/6452) ([alesapin](https://github.com/alesapin))
- Kafkaメッセージの読み取り時の無限ループを修正しました。[#6354](https://github.com/ClickHouse/ClickHouse/pull/6354) ([abyss7](https://github.com/abyss7))
- SQLパーサーにおけるスタックオーバーフローによるサーバークラッシュを引き起こす可能性のある不正なクエリ、および`Merge`と`Distributed`テーブルにおけるスタックオーバーフローの可能性を修正しました。[#6433](https://github.com/ClickHouse/ClickHouse/pull/6433) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 小さなシーケンスにおけるGorillaエンコーディングエラーを修正しました。[#6444](https://github.com/ClickHouse/ClickHouse/pull/6444) ([Enmk](https://github.com/Enmk))

#### 改善 {#improvement-5}

- 接続時に`poll_interval`および`idle_connection_timeout`設定をユーザーがオーバーライドできるようにしました。[#6230](https://github.com/ClickHouse/ClickHouse/pull/6230) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.11.5.28, 2019-08-05 {#clickhouse-release-19-11-5-28-2019-08-05}

#### バグ修正 {#bug-fix-19}


- サーバーが過負荷状態の際にクエリがハングする可能性を修正しました。[#6301](https://github.com/ClickHouse/ClickHouse/pull/6301) ([alexey-milovidov](https://github.com/alexey-milovidov))
- yandexConsistentHash関数における浮動小数点例外を修正しました。これにより[#6304](https://github.com/ClickHouse/ClickHouse/issues/6304)が解決されます。[#6126](https://github.com/ClickHouse/ClickHouse/pull/6126) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `AggregateFunctionFactory`における`LowCardinality`型の変換のバグを修正しました。これにより[#6257](https://github.com/ClickHouse/ClickHouse/issues/6257)が解決されます。[#6281](https://github.com/ClickHouse/ClickHouse/pull/6281) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- 設定ファイル内の`true`および`false`文字列からの`bool`設定の解析を修正しました。[#6278](https://github.com/ClickHouse/ClickHouse/pull/6278) ([alesapin](https://github.com/alesapin))
- `WHERE`の一部が`PREWHERE`に移動する際に、`MergeTree`テーブル上の`Distributed`テーブルへのクエリで互換性のないストリームヘッダーが発生する稀なバグを修正しました。[#6236](https://github.com/ClickHouse/ClickHouse/pull/6236) ([alesapin](https://github.com/alesapin))
- 符号付き型から符号なし型への整数除算におけるオーバーフローを修正しました。これにより[#6214](https://github.com/ClickHouse/ClickHouse/issues/6214)が解決されます。[#6233](https://github.com/ClickHouse/ClickHouse/pull/6233) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### 後方互換性のない変更 {#backward-incompatible-change-5}

- `Kafka`は引き続き動作しません。

### ClickHouseリリース 19.11.4.24, 2019-08-01 {#clickhouse-release-19-11-4-24-2019-08-01}

#### バグ修正 {#bug-fix-20}


- アダプティブ粒度を使用したセカンダリインデックスマークの書き込みに関するバグを修正しました。[#6126](https://github.com/ClickHouse/ClickHouse/pull/6126) ([alesapin](https://github.com/alesapin))
- 2レベル集約における`GROUP BY`の`WITH ROLLUP`および`WITH CUBE`修飾子を修正しました。[#6225](https://github.com/ClickHouse/ClickHouse/pull/6225) ([Anton Popov](https://github.com/CurtizJ))
- `JSONExtractRaw`関数のハングを修正しました。修正内容: [#6195](https://github.com/ClickHouse/ClickHouse/issues/6195) [#6198](https://github.com/ClickHouse/ClickHouse/pull/6198) ([alexey-milovidov](https://github.com/alexey-milovidov))
- ExternalLoader::reloadOutdated()におけるセグメンテーション違反を修正しました。[#6082](https://github.com/ClickHouse/ClickHouse/pull/6082) ([Vitaly Baranov](https://github.com/vitlibar))
- サーバーがリスニングソケットを閉じてもシャットダウンせず、残りのクエリの処理を継続する場合の問題を修正しました。この問題により、2つのclickhouse-serverプロセスが実行される可能性がありました。また、残りのクエリに対してサーバーが`bad_function_call`エラーを返すことがありました。[#6231](https://github.com/ClickHouse/ClickHouse/pull/6231) ([alexey-milovidov](https://github.com/alexey-milovidov))
- ODBC、MySQL、ClickHouse、HTTP経由での外部ディクショナリの初期ロード時における更新フィールドの無用かつ不正確な条件を修正しました。この修正により以下の問題が解決されます: [#6069](https://github.com/ClickHouse/ClickHouse/issues/6069) [#6083](https://github.com/ClickHouse/ClickHouse/pull/6083) ([alexey-milovidov](https://github.com/alexey-milovidov))
- Nullを含まない場合に`LowCardinality(Nullable)`を非Nullable列にキャストする際の不適切な例外を修正しました（例: `SELECT CAST(CAST('Hello' AS LowCardinality(Nullable(String))) AS String)`のようなクエリ）。[#6094](https://github.com/ClickHouse/ClickHouse/issues/6094) [#6119](https://github.com/ClickHouse/ClickHouse/pull/6119) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- 極めて稀なケースにおける"uniq"集約関数の非決定的な結果を修正しました。このバグはすべてのClickHouseバージョンに存在していました。[#6058](https://github.com/ClickHouse/ClickHouse/pull/6058) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `IPv6CIDRToRange`関数に少し高すぎるCIDRを設定した際のセグメンテーション違反を修正しました。[#6068](https://github.com/ClickHouse/ClickHouse/pull/6068) ([Guillaume Tassery](https://github.com/YiuRULE))
- サーバーが多数の異なるコンテキストから多くの例外をスローする際の小規模なメモリリークを修正しました。[#6144](https://github.com/ClickHouse/ClickHouse/pull/6144) ([alexey-milovidov](https://github.com/alexey-milovidov))
- サブスクリプション前にコンシューマーが一時停止され、その後再開されない状況を修正しました。[#6075](https://github.com/ClickHouse/ClickHouse/pull/6075) ([Ivan](https://github.com/abyss7)) 注意: このバージョンではKafkaが動作しません。
- エラーで完了した前回の読み取り操作からのKafkaデータバッファのクリアを修正しました。[#6026](https://github.com/ClickHouse/ClickHouse/pull/6026) ([Nikolay](https://github.com/bopohaa)) 注意: このバージョンではKafkaが動作しません。
- `StorageMergeTree::background_task_handle`は`startup()`で初期化されるため、`MergeTreeBlockOutputStream::write()`が初期化前にそれを使用しようとする可能性がありました。初期化されているかどうかを確認するようにしました。[#6080](https://github.com/ClickHouse/ClickHouse/pull/6080) ([Ivan](https://github.com/abyss7))

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-6}


- 公式`rpm`パッケージを追加しました。[#5740](https://github.com/ClickHouse/ClickHouse/pull/5740) ([proller](https://github.com/proller)) ([alesapin](https://github.com/alesapin))
- `packager`スクリプトで`.rpm`および`.tgz`パッケージをビルドする機能を追加しました。[#5769](https://github.com/ClickHouse/ClickHouse/pull/5769) ([alesapin](https://github.com/alesapin))
- "Arcadia"ビルドシステムの修正。[#6223](https://github.com/ClickHouse/ClickHouse/pull/6223) ([proller](https://github.com/proller))

#### 後方互換性のない変更 {#backward-incompatible-change-6}

- このバージョンでは`Kafka`が動作しません。

### ClickHouse リリース 19.11.3.11, 2019-07-18 {#clickhouse-release-19-11-3-11-2019-07-18}

#### 新機能 {#new-feature-6}

- プリペアドステートメントのサポートを追加しました。[#5331](https://github.com/ClickHouse/ClickHouse/pull/5331/) ([Alexander](https://github.com/sanych73)) [#5630](https://github.com/ClickHouse/ClickHouse/pull/5630) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `DoubleDelta`および`Gorilla`カラムコーデック [#5600](https://github.com/ClickHouse/ClickHouse/pull/5600) ([Vasily Nemkov](https://github.com/Enmk))
- クエリ処理スレッドの"nice"値を制御する`os_thread_priority`設定を追加しました。これはOSが動的スケジューリング優先度を調整するために使用されます。動作には`CAP_SYS_NICE`ケーパビリティが必要です。これは[#5858](https://github.com/ClickHouse/ClickHouse/issues/5858)を実装したものです [#5909](https://github.com/ClickHouse/ClickHouse/pull/5909) ([alexey-milovidov](https://github.com/alexey-milovidov))
- Kafkaエンジン用の`_topic`、`_offset`、`_key`カラムを実装しました [#5382](https://github.com/ClickHouse/ClickHouse/pull/5382) ([Ivan](https://github.com/abyss7)) このバージョンではKafkaが動作しないことに注意してください。
- 集約関数コンビネータ`-Resample`を追加しました [#5590](https://github.com/ClickHouse/ClickHouse/pull/5590) ([hcz](https://github.com/hczhcz))
- ウィンドウサイズの制限あり/なしで移動合計/移動平均を計算する集約関数`groupArrayMovingSum(win_size)(x)`および`groupArrayMovingAvg(win_size)(x)`。[#5595](https://github.com/ClickHouse/ClickHouse/pull/5595) ([inv2004](https://github.com/inv2004))
- シノニム`arrayFlatten` \<-\> `flatten`を追加しました [#5764](https://github.com/ClickHouse/ClickHouse/pull/5764) ([hcz](https://github.com/hczhcz))
- UberのH3関数`geoToH3`を統合しました。[#4724](https://github.com/ClickHouse/ClickHouse/pull/4724) ([Remen Ivan](https://github.com/BHYCHIK)) [#5805](https://github.com/ClickHouse/ClickHouse/pull/5805) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### バグ修正 {#bug-fix-21}


* DNS キャッシュの非同期更新を実装しました。専用スレッドがすべてのホスト名を解決し、`dns_cache_update_period` 設定で指定された間隔で DNS キャッシュを更新します。これは、ホストの IP アドレスが頻繁に変わる場合に役立ちます。 [#5857](https://github.com/ClickHouse/ClickHouse/pull/5857) ([Anton Popov](https://github.com/CurtizJ))
* 32 ビット未満のサイズの値を持つカラムに影響する `Delta` codec のセグメンテーションフォールトを修正しました。このバグによりランダムなメモリ破損が発生していました。 [#5786](https://github.com/ClickHouse/ClickHouse/pull/5786) ([alesapin](https://github.com/alesapin))
* ブロック内の非物理カラムを伴う TTL マージで発生していたセグメンテーションフォルトを修正。[#5819](https://github.com/ClickHouse/ClickHouse/pull/5819) ([Anton Popov](https://github.com/CurtizJ))
* `LowCardinality` カラムを含むパーツの検査におけるまれなバグを修正しました。以前は、`LowCardinality` カラムを含むパーツに対しては、常に `checkDataPart` が失敗していました。 [#5832](https://github.com/ClickHouse/ClickHouse/pull/5832) ([alesapin](https://github.com/alesapin))
* サーバーのスレッドプールが満杯のときに接続がハングしないようにします。これは、接続タイムアウトが長い場合の `remote` テーブル関数からの接続や、レプリカを持たないシャードへの接続にとって重要です。これにより [#5878](https://github.com/ClickHouse/ClickHouse/issues/5878) [#5881](https://github.com/ClickHouse/ClickHouse/pull/5881) が修正されました（[alexey-milovidov](https://github.com/alexey-milovidov)）。
* `evalMLModel` 関数で定数引数をサポートしました。これにより [#5817](https://github.com/ClickHouse/ClickHouse/issues/5817) および [#5820](https://github.com/ClickHouse/ClickHouse/pull/5820) が修正されました（[alexey-milovidov](https://github.com/alexey-milovidov)）
* ClickHouse がデフォルトのタイムゾーンを `UTC` ではなく `UCT` と判定してしまう問題を修正しました。これにより [#5804](https://github.com/ClickHouse/ClickHouse/issues/5804) が解決されます。 [#5828](https://github.com/ClickHouse/ClickHouse/pull/5828) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `visitParamExtractRaw` におけるバッファアンダーフローを修正。これにより [#5901](https://github.com/ClickHouse/ClickHouse/issues/5901) および [#5902](https://github.com/ClickHouse/ClickHouse/pull/5902) が解決されました ([alexey-milovidov](https://github.com/alexey-milovidov))
* 分散 `DROP/ALTER/TRUNCATE/OPTIMIZE ON CLUSTER` クエリは、リーダーレプリカ上で直接実行されるようになりました。 [#5757](https://github.com/ClickHouse/ClickHouse/pull/5757) ([alesapin](https://github.com/alesapin))
* `ColumnConst` と `ColumnNullable` に対する `coalesce` を修正し、関連する変更を加えました。 [#5755](https://github.com/ClickHouse/ClickHouse/pull/5755) ([Artem Zuikov](https://github.com/4ertus2))
* `ReadBufferFromKafkaConsumer` を修正し、以前に停止していた場合でも `commit()` の後に新しいメッセージの読み取りを継続できるようにしました [#5852](https://github.com/ClickHouse/ClickHouse/pull/5852) ([Ivan](https://github.com/abyss7))
* 右側のテーブルの `Nullable` キーで結合する際の `FULL` および `RIGHT` JOIN の結果を修正。 [#5859](https://github.com/ClickHouse/ClickHouse/pull/5859) ([Artem Zuikov](https://github.com/4ertus2))
* 低優先度クエリが無限にスリープし続けてしまう問題を修正する可能性のある変更。 [#5842](https://github.com/ClickHouse/ClickHouse/pull/5842) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `SYSTEM FLUSH LOGS` クエリの後に一部のクエリが `query_log` に記録されない可能性がある競合状態を修正。[#5456](https://github.com/ClickHouse/ClickHouse/issues/5456) [#5685](https://github.com/ClickHouse/ClickHouse/pull/5685) ([Anton Popov](https://github.com/CurtizJ))
* すでに削除された copier オブジェクトを使用しようとする watch が原因で ClusterCopier で発生していた `heap-use-after-free` ASan 警告を修正しました。 [#5871](https://github.com/ClickHouse/ClickHouse/pull/5871) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 一部の `IColumn::deserializeAndInsertFromArena` 実装が返していた誤った `StringRef` ポインタを修正しました。このバグの影響を受けるのはユニットテストのみです。 [#5973](https://github.com/ClickHouse/ClickHouse/pull/5973) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* ソースおよび中間の `ARRAY JOIN` 列が、同名の列を隠してしまうことを防ぎます。 [#5941](https://github.com/ClickHouse/ClickHouse/pull/5941) ([Artem Zuikov](https://github.com/4ertus2))
* MySQL スタイルの識別子クオートを使用する `MySQL` エンジンへの `INSERT` および `SELECT` クエリを修正しました。 [#5704](https://github.com/ClickHouse/ClickHouse/pull/5704) ([Winter Zhang](https://github.com/zhang2014))
* `CHECK TABLE` クエリが MergeTree エンジンファミリーでも動作するようになりました。各パーツ（より単純なエンジンの場合はファイル）ごとに、チェック結果のステータスと、あればメッセージを返します。また、破損したパーツをフェッチする際のバグも修正しました。 [#5865](https://github.com/ClickHouse/ClickHouse/pull/5865) ([alesapin](https://github.com/alesapin))
* SPLIT&#95;SHARED&#95;LIBRARIES のランタイムを修正 [#5793](https://github.com/ClickHouse/ClickHouse/pull/5793) ([Danila Kutenin](https://github.com/danlark1))
* `/etc/localtime` が `../usr/share/zoneinfo/Asia/Istanbul` のような相対シンボリックリンクである場合のタイムゾーン初期化の不具合を修正 [#5922](https://github.com/ClickHouse/ClickHouse/pull/5922) ([alexey-milovidov](https://github.com/alexey-milovidov))
* clickhouse-copier: シャットダウン時の use-after-free を修正 [#5752](https://github.com/ClickHouse/ClickHouse/pull/5752) ([proller](https://github.com/proller))
* `simdjson` を更新しました。ゼロバイトを含む一部の無効な JSON が正常にパースされてしまう問題を修正しました。 [#5938](https://github.com/ClickHouse/ClickHouse/pull/5938) ([alexey-milovidov](https://github.com/alexey-milovidov))
* SystemLogs のシャットダウン処理を修正 [#5802](https://github.com/ClickHouse/ClickHouse/pull/5802) ([Anton Popov](https://github.com/CurtizJ))
* `invalidate_query` の条件が辞書に依存している場合に発生するハングの問題を修正。 [#6011](https://github.com/ClickHouse/ClickHouse/pull/6011) ([Vitaly Baranov](https://github.com/vitlibar))

#### 改善 {#improvement-6}


* クラスタ構成で名前解決できないアドレスを許可します。それらは利用不可能とみなされ、接続のたびに名前解決が試みられます。これは特に Kubernetes で有用です。これにより [#5714](https://github.com/ClickHouse/ClickHouse/issues/5714) および [#5924](https://github.com/ClickHouse/ClickHouse/pull/5924) が修正されました（[alexey-milovidov](https://github.com/alexey-milovidov)）
* アイドル状態の TCP 接続をクローズします（デフォルトのタイムアウトは 1 時間）。これは、各サーバー上に複数の `Distributed` テーブルが存在する大規模クラスタでは特に重要です。各サーバーが他のすべてのサーバーへの接続プールを保持しうるため、ピーク時のクエリ同時実行の後に接続が滞留してしまう可能性があるためです。これにより [#5879](https://github.com/ClickHouse/ClickHouse/issues/5879) および [#5880](https://github.com/ClickHouse/ClickHouse/pull/5880) が修正されます（[alexey-milovidov](https://github.com/alexey-milovidov)）
* `topK` 関数の品質を向上しました。SavingSpace セットの動作を変更し、新しい要素の重みがより大きい場合は末尾の要素を削除するようにしました。 [#5833](https://github.com/ClickHouse/ClickHouse/issues/5833) [#5850](https://github.com/ClickHouse/ClickHouse/pull/5850) ([Guillaume Tassery](https://github.com/YiuRULE))
* ドメインを扱う URL 関数が、スキームを含まない不完全な URL に対しても動作するようになりました [#5725](https://github.com/ClickHouse/ClickHouse/pull/5725) ([alesapin](https://github.com/alesapin))
* `system.parts_columns` テーブルにチェックサムを追加しました。 [#5874](https://github.com/ClickHouse/ClickHouse/pull/5874) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))
* `Enum8` または `Enum16` の別名として `Enum` データ型を追加しました。 [#5886](https://github.com/ClickHouse/ClickHouse/pull/5886) ([dimarub2000](https://github.com/dimarub2000))
* `T64` コーデック向けのフルビット転置方式。`zstd` による圧縮率の向上につながる可能性があります。 [#5742](https://github.com/ClickHouse/ClickHouse/pull/5742) ([Artem Zuikov](https://github.com/4ertus2))
* `startsWith` 関数を条件に用いた場合にプライマリーキーを利用できるようになりました。これにより [#5310](https://github.com/ClickHouse/ClickHouse/issues/5310) および [#5882](https://github.com/ClickHouse/ClickHouse/issues/5882) [#5919](https://github.com/ClickHouse/ClickHouse/pull/5919) が修正されました（[dimarub2000](https://github.com/dimarub2000)）。
* 空のデータベース名を許可することで、クロスレプリケーション・クラスタートポロジーで `clickhouse-copier` を使用できるようにしました。 [#5745](https://github.com/ClickHouse/ClickHouse/pull/5745) ([nvartolomei](https://github.com/nvartolomei))
* `tzdata` のないシステム（例: プレーンな Docker コンテナ）では、デフォルトのタイムゾーンとして `UTC` を使用するようにしました。このパッチ以前は、エラーメッセージ `Could not determine local time zone` が出力され、サーバーまたはクライアントが起動を拒否していました。 [#5827](https://github.com/ClickHouse/ClickHouse/pull/5827) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 後方互換性のため、関数 `quantileTiming` で浮動小数点引数のサポートを再び追加しました。 [#5911](https://github.com/ClickHouse/ClickHouse/pull/5911) ([alexey-milovidov](https://github.com/alexey-milovidov))
* エラーメッセージに、どのテーブルで列が不足しているかを表示するようにしました。 [#5768](https://github.com/ClickHouse/ClickHouse/pull/5768) ([Ivan](https://github.com/abyss7))
* 異なるユーザーによる同一の `query_id` を持つクエリの実行を不許可にする [#5430](https://github.com/ClickHouse/ClickHouse/pull/5430) ([proller](https://github.com/proller))
* Graphite へのメトリクス送信コードをより堅牢化しました。長時間にわたる複数の `RENAME TABLE` 操作中であっても動作します。 [#5875](https://github.com/ClickHouse/ClickHouse/pull/5875) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ThreadPool がタスクを実行のためにスケジュールできない場合に、より詳細なエラーメッセージが表示されるようになりました。これにより [#5305](https://github.com/ClickHouse/ClickHouse/issues/5305) と [#5801](https://github.com/ClickHouse/ClickHouse/pull/5801) が修正されます（[alexey-milovidov](https://github.com/alexey-milovidov)）
* `ngramSearch` の挙動をより直感的になるように反転 [#5807](https://github.com/ClickHouse/ClickHouse/pull/5807) ([Danila Kutenin](https://github.com/danlark1))
* HDFS エンジンビルダーにユーザー解析処理を追加 [#5946](https://github.com/ClickHouse/ClickHouse/pull/5946) ([akonyaev90](https://github.com/akonyaev90))
* `max_ast_elements` パラメータのデフォルト値を更新 [#5933](https://github.com/ClickHouse/ClickHouse/pull/5933) ([Artem Konovalov](https://github.com/izebit))
* 廃止予定設定という概念を追加しました。廃止予定設定 `allow_experimental_low_cardinality_type` を指定しても、動作には一切影響しません。[0f15c01c6802f7ce1a1494c12c846be8c98944cd](https://github.com/ClickHouse/ClickHouse/commit/0f15c01c6802f7ce1a1494c12c846be8c98944cd) [Alexey Milovidov](https://github.com/alexey-milovidov)

#### パフォーマンス改善 {#performance-improvement-4}

- MergeテーブルからのSELECT時のストリーム数を増やし、スレッドをより均一に分散できるようにしました。設定`max_streams_multiplier_for_merge_tables`を追加しました。これにより[#5797](https://github.com/ClickHouse/ClickHouse/issues/5797)が修正されます [#5915](https://github.com/ClickHouse/ClickHouse/pull/5915) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### ビルド/テスト/パッケージング改善 {#buildtestingpackaging-improvement-7}


* 異なるバージョンの ClickHouse 間のクライアントとサーバーのやり取りに対する後方互換性テストを追加。 [#5868](https://github.com/ClickHouse/ClickHouse/pull/5868) ([alesapin](https://github.com/alesapin))
* すべてのコミットおよびプルリクエストでテストカバレッジ情報を取得。 [#5896](https://github.com/ClickHouse/ClickHouse/pull/5896) ([alesapin](https://github.com/alesapin))
* アドレスサニタイザと連携し、カスタムアロケータ（`Arena` および `ArenaWithFreeLists`）をサポートして「use-after-free」エラーのデバッグをしやすくしました。 [#5728](https://github.com/ClickHouse/ClickHouse/pull/5728) ([akuzm](https://github.com/akuzm))
* C++ の例外処理およびスタックトレース出力のために [LLVM libunwind 実装](https://github.com/llvm-mirror/libunwind) に切り替え [#4828](https://github.com/ClickHouse/ClickHouse/pull/4828) ([Nikita Lapkov](https://github.com/laplab))
* -Weverything による警告をさらに 2 つ追加 [#5923](https://github.com/ClickHouse/ClickHouse/pull/5923) ([alexey-milovidov](https://github.com/alexey-milovidov))
* Memory Sanitizer を使って ClickHouse をビルドできるようにしました。 [#3949](https://github.com/ClickHouse/ClickHouse/pull/3949) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ファジングテストにおける `bitTest` 関数に関する ubsan レポートを修正しました。 [#5943](https://github.com/ClickHouse/ClickHouse/pull/5943) ([alexey-milovidov](https://github.com/alexey-milovidov))
* Docker: 認証が必要な ClickHouse インスタンスを初期化できるようにしました。 [#5727](https://github.com/ClickHouse/ClickHouse/pull/5727) ([Korviakov Andrey](https://github.com/shurshun))
* librdkafka をバージョン 1.1.0 にアップデート [#5872](https://github.com/ClickHouse/ClickHouse/pull/5872) ([Ivan](https://github.com/abyss7))
* 統合テストにグローバルなタイムアウトを追加し、テストコード内で一部のテストを無効化しました。 [#5741](https://github.com/ClickHouse/ClickHouse/pull/5741) ([alesapin](https://github.com/alesapin))
* 一部の ThreadSanitizer のエラーを修正。[#5854](https://github.com/ClickHouse/ClickHouse/pull/5854) ([akuzm](https://github.com/akuzm))
* `--no-undefined` オプションは、リンク時にリンカーにすべての外部シンボルの存在をチェックすることを強制します。分割ビルドモードでライブラリ間の実際の依存関係を把握するのに非常に有用です。 [#5855](https://github.com/ClickHouse/ClickHouse/pull/5855) ([Ivan](https://github.com/abyss7))
* [#5797](https://github.com/ClickHouse/ClickHouse/issues/5797) [#5914](https://github.com/ClickHouse/ClickHouse/pull/5914) 向けのパフォーマンステストを追加 ([alexey-milovidov](https://github.com/alexey-milovidov))
* gcc-7 との互換性を修正しました。 [#5840](https://github.com/ClickHouse/ClickHouse/pull/5840) ([alexey-milovidov](https://github.com/alexey-milovidov))
* gcc-9 のサポートを追加しました。これにより [#5717](https://github.com/ClickHouse/ClickHouse/issues/5717) [#5774](https://github.com/ClickHouse/ClickHouse/pull/5774) が修正されました ([alexey-milovidov](https://github.com/alexey-milovidov))
* `libunwind` が誤ってリンクされることがある不具合を修正しました。 [#5948](https://github.com/ClickHouse/ClickHouse/pull/5948) ([alexey-milovidov](https://github.com/alexey-milovidov))
* PVS-Studio によって検出された警告をいくつか修正。 [#5921](https://github.com/ClickHouse/ClickHouse/pull/5921) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `clang-tidy` 静的解析ツールの初期サポートを追加しました。 [#5806](https://github.com/ClickHouse/ClickHouse/pull/5806) ([alexey-milovidov](https://github.com/alexey-milovidov))
* BSD/Linux のエンディアンマクロ（&#39;be64toh&#39; と &#39;htobe64&#39;）を Mac OS X の同等マクロに変換 [#5785](https://github.com/ClickHouse/ClickHouse/pull/5785) ([Fu Chen](https://github.com/fredchenbj))
* 統合テストガイドを改善。 [#5796](https://github.com/ClickHouse/ClickHouse/pull/5796) ([Vladimir Chebotarev](https://github.com/excitoon))
* macOS + gcc9 におけるビルドの修正 [#5822](https://github.com/ClickHouse/ClickHouse/pull/5822) ([filimonov](https://github.com/filimonov))
* 気づきにくいタイポを修正: aggreAGte -&gt; aggregate。 [#5753](https://github.com/ClickHouse/ClickHouse/pull/5753) ([akuzm](https://github.com/akuzm))
* FreeBSD ビルドの修正 [#5760](https://github.com/ClickHouse/ClickHouse/pull/5760) ([proller](https://github.com/proller))
* 試験的な YouTube チャンネルへのリンクをウェブサイトに追加 [#5845](https://github.com/ClickHouse/ClickHouse/pull/5845) ([Ivan Blinkov](https://github.com/blinkov))
* CMake: カバレッジフラグ用オプションを追加: WITH&#95;COVERAGE [#5776](https://github.com/ClickHouse/ClickHouse/pull/5776) ([proller](https://github.com/proller))
* いくつかのインライン `PODArray` の初期サイズを修正しました。 [#5787](https://github.com/ClickHouse/ClickHouse/pull/5787) ([akuzm](https://github.com/akuzm))
* clickhouse-server.postinst: CentOS 6 向けの OS 検出処理を修正 [#5788](https://github.com/ClickHouse/ClickHouse/pull/5788) ([proller](https://github.com/proller))
* Arch Linux 向けパッケージの生成を追加。 [#5719](https://github.com/ClickHouse/ClickHouse/pull/5719) ([Vladimir Chebotarev](https://github.com/excitoon))
* Common/config.h をライブラリ（dbms）単位で分割 [#5715](https://github.com/ClickHouse/ClickHouse/pull/5715) ([proller](https://github.com/proller))
* 「Arcadia」ビルドプラットフォーム向けの修正 [#5795](https://github.com/ClickHouse/ClickHouse/pull/5795) ([proller](https://github.com/proller))
* 非標準的なビルド（gcc9、サブモジュールなし）向けの修正 [#5792](https://github.com/ClickHouse/ClickHouse/pull/5792) ([proller](https://github.com/proller))
* unalignedStore では、バグが発生しやすいことが判明したため、明示的な型指定を必須にするよう変更 [#5791](https://github.com/ClickHouse/ClickHouse/pull/5791) ([akuzm](https://github.com/akuzm))
* macOS のビルドを修正 [#5830](https://github.com/ClickHouse/ClickHouse/pull/5830) ([filimonov](https://github.com/filimonov))
* [#5263](https://github.com/ClickHouse/ClickHouse/issues/5263) [#5887](https://github.com/ClickHouse/ClickHouse/pull/5887)（[Guillaume Tassery](https://github.com/YiuRULE)）でリクエストされた、新しい JIT 機能に対する大規模データセットを用いたパフォーマンステスト
* ストレステストでステートフルなテストを実行 [12693e568722f11e19859742f56428455501fd2a](https://github.com/ClickHouse/ClickHouse/commit/12693e568722f11e19859742f56428455501fd2a) ([alesapin](https://github.com/alesapin))

#### 後方互換性のない変更 {#backward-incompatible-change-7}

- このバージョンでは`Kafka`が正常に動作しません。
- 新しい`MergeTree`テーブルに対して、デフォルトで`adaptive_index_granularity` = 10MBを有効にします。バージョン19.11以降で新しいMergeTreeテーブルを作成した場合、19.6より前のバージョンへのダウングレードはできません。[#5628](https://github.com/ClickHouse/ClickHouse/pull/5628) ([alesapin](https://github.com/alesapin))
- Yandex.Metricaで使用されていた、廃止された非公開の組み込みディクショナリを削除しました。関数`OSIn`、`SEIn`、`OSToRoot`、`SEToRoot`、`OSHierarchy`、`SEHierarchy`は利用できなくなりました。これらの関数を使用している場合は、clickhouse-feedback@yandex-team.comまでメールでお問い合わせください。注意: 最終的に、これらの関数を当面の間保持することに決定しました。[#5780](https://github.com/ClickHouse/ClickHouse/pull/5780) ([alexey-milovidov](https://github.com/alexey-milovidov))


## ClickHouse リリース 19.10 {#clickhouse-release-19-10}

### ClickHouse リリース 19.10.1.5, 2019-07-12 {#clickhouse-release-19-10-1-5-2019-07-12}

#### 新機能 {#new-feature-7}

- 新しいカラムコーデック `T64` を追加。(U)IntX/EnumX/Data(Time)/DecimalX カラム向けに作成されました。定数値または小範囲の値を持つカラムに適しています。このコーデックにより、再圧縮なしでデータ型の拡大または縮小が可能になります。[#5557](https://github.com/ClickHouse/ClickHouse/pull/5557) ([Artem Zuikov](https://github.com/4ertus2))
- リモート MySQL サーバー内のすべてのテーブルを表示できるデータベースエンジン `MySQL` を追加 [#5599](https://github.com/ClickHouse/ClickHouse/pull/5599) ([Winter Zhang](https://github.com/zhang2014))
- `bitmapContains` を実装。2番目のビットマップが1つの要素を含む場合、`bitmapHasAny` より2倍高速です。[#5535](https://github.com/ClickHouse/ClickHouse/pull/5535) ([Zhichang Yu](https://github.com/yuzhichang))
- `crc32` 関数のサポート(MySQL または PHP と完全に同じ動作)。ハッシュ関数が必要な場合は使用しないでください。[#5661](https://github.com/ClickHouse/ClickHouse/pull/5661) ([Remen Ivan](https://github.com/BHYCHIK))
- `Distributed` テーブルへの非同期挿入を制御するための `SYSTEM START/STOP DISTRIBUTED SENDS` クエリを実装。[#4935](https://github.com/ClickHouse/ClickHouse/pull/4935) ([Winter Zhang](https://github.com/zhang2014))

#### バグ修正 {#bug-fix-22}

- ミューテーション実行中のマージ制限について、クエリ実行制限と最大パーツサイズを無視するように修正。[#5659](https://github.com/ClickHouse/ClickHouse/pull/5659) ([Anton Popov](https://github.com/CurtizJ))
- 通常ブロックの重複排除(極めて稀)と重複ブロックの挿入(より頻繁)につながる可能性があるバグを修正。[#5549](https://github.com/ClickHouse/ClickHouse/pull/5549) ([alesapin](https://github.com/alesapin))
- 空配列を含む引数に対する `arrayEnumerateUniqRanked` 関数の修正 [#5559](https://github.com/ClickHouse/ClickHouse/pull/5559) ([proller](https://github.com/proller))
- メッセージをポーリングする意図がない場合は Kafka トピックをサブスクライブしないように修正。[#5698](https://github.com/ClickHouse/ClickHouse/pull/5698) ([Ivan](https://github.com/abyss7))
- Nullable 内に含めることができない型に対して、設定 `join_use_nulls` が効果を持たないように修正 [#5700](https://github.com/ClickHouse/ClickHouse/pull/5700) ([Olga Khvostikova](https://github.com/stavrolia))
- `Incorrect size of index granularity` エラーを修正 [#5720](https://github.com/ClickHouse/ClickHouse/pull/5720) ([coraxster](https://github.com/coraxster))
- Float から Decimal への変換オーバーフローを修正 [#5607](https://github.com/ClickHouse/ClickHouse/pull/5607) ([coraxster](https://github.com/coraxster))
- `WriteBufferFromHDFS` のデストラクタが呼び出されたときにバッファをフラッシュ。これにより `HDFS` への書き込みが修正されます。[#5684](https://github.com/ClickHouse/ClickHouse/pull/5684) ([Xindong Peng](https://github.com/eejoin))

#### 改善 {#improvement-7}


- 設定 `input_format_defaults_for_omitted_fields` が有効な場合、`CSV` の空セルをデフォルト値として扱います。[#5625](https://github.com/ClickHouse/ClickHouse/pull/5625) ([akuzm](https://github.com/akuzm))
- 外部ディクショナリの非ブロッキングロード。[#5567](https://github.com/ClickHouse/ClickHouse/pull/5567) ([Vitaly Baranov](https://github.com/vitlibar))
- 既に確立された接続に対して、設定に応じてネットワークタイムアウトを動的に変更できるようになりました。[#4558](https://github.com/ClickHouse/ClickHouse/pull/4558) ([Konstantin Podshumok](https://github.com/podshumok))
- 関数 `firstSignificantSubdomain`、`cutToFirstSignificantSubdomain` で "public_suffix_list" を使用します。https://publicsuffix.org/list/public_suffix_list.dat ファイルから生成されたリストを使用して `gperf` で生成された完全ハッシュテーブルを使用しています。（例えば、ドメイン `ac.uk` を非重要として認識するようになりました）。[#5030](https://github.com/ClickHouse/ClickHouse/pull/5030) ([Guillaume Tassery](https://github.com/YiuRULE))
- システムテーブルで `IPv6` データ型を採用。`system.processes` と `system.query_log` のクライアント情報カラムを統一しました。[#5640](https://github.com/ClickHouse/ClickHouse/pull/5640) ([alexey-milovidov](https://github.com/alexey-milovidov))
- MySQL互換プロトコルでの接続にセッションを使用します。#5476 [#5646](https://github.com/ClickHouse/ClickHouse/pull/5646) ([Yuriy Baranov](https://github.com/yurriy))
- より多くの `ALTER` クエリで `ON CLUSTER` をサポートします。[#5593](https://github.com/ClickHouse/ClickHouse/pull/5593) [#5613](https://github.com/ClickHouse/ClickHouse/pull/5613) ([sundyli](https://github.com/sundy-li))
- `clickhouse-local` 設定ファイルで `<logger>` セクションをサポートします。[#5540](https://github.com/ClickHouse/ClickHouse/pull/5540) ([proller](https://github.com/proller))
- `clickhouse-local` で `remote` テーブル関数を使用したクエリの実行を許可します。[#5627](https://github.com/ClickHouse/ClickHouse/pull/5627) ([proller](https://github.com/proller))

#### パフォーマンス改善 {#performance-improvement-5}

- MergeTreeカラムの末尾に最終マークを書き込む機能を追加しました。これにより、テーブルデータ範囲外のキーに対する無駄な読み取りを回避できます。この機能は、適応型インデックス粒度が使用されている場合にのみ有効になります。[#5624](https://github.com/ClickHouse/ClickHouse/pull/5624) ([alesapin](https://github.com/alesapin))
- `stat` システムコールの回数を削減することで、非常に低速なファイルシステム上のMergeTreeテーブルのパフォーマンスを改善しました。[#5648](https://github.com/ClickHouse/ClickHouse/pull/5648) ([alexey-milovidov](https://github.com/alexey-milovidov))
- バージョン19.6で導入されたMergeTreeテーブルからの読み取りにおけるパフォーマンス低下を修正しました。#5631を修正します。[#5633](https://github.com/ClickHouse/ClickHouse/pull/5633) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### ビルド/テスト/パッケージング改善 {#buildtestingpackaging-improvement-8}


- テスト用に使用される ZooKeeper インターフェースの実装として `TestKeeper` を導入しました [#5643](https://github.com/ClickHouse/ClickHouse/pull/5643) ([alexey-milovidov](https://github.com/alexey-milovidov)) ([levushkin aleksej](https://github.com/alexey-milovidov))
- 今後 `.sql` テストは、サーバーごとに分離された環境で、ランダムなデータベースを用いて並列実行できるようになります。これにより、高速に実行できるようになり、カスタムサーバー設定を用いた新しいテストを追加しやすくなるほか、異なるテスト同士が互いに影響しないことを保証できます。 [#5554](https://github.com/ClickHouse/ClickHouse/pull/5554) ([Ivan](https://github.com/abyss7))
- パフォーマンステストから `<name>` と `<metrics>` を削除しました [#5672](https://github.com/ClickHouse/ClickHouse/pull/5672) ([Olga Khvostikova](https://github.com/stavrolia))
- `Pretty` フォーマット向けの "select_format" パフォーマンステストを修正しました [#5642](https://github.com/ClickHouse/ClickHouse/pull/5642) ([alexey-milovidov](https://github.com/alexey-milovidov))



## ClickHouse リリース 19.9 {#clickhouse-release-19-9}

### ClickHouse リリース 19.9.3.31, 2019-07-05 {#clickhouse-release-19-9-3-31-2019-07-05}

#### バグ修正 {#bug-fix-23}

- 32ビット未満のサイズの値を持つカラムに影響するDeltaコーデックのセグメンテーション違反を修正しました。このバグはランダムなメモリ破損を引き起こしていました。[#5786](https://github.com/ClickHouse/ClickHouse/pull/5786) ([alesapin](https://github.com/alesapin))
- LowCardinalityカラムを持つパートのチェックにおける稀なバグを修正しました。[#5832](https://github.com/ClickHouse/ClickHouse/pull/5832) ([alesapin](https://github.com/alesapin))
- ブロック内の非物理カラムを含むTTLマージにおけるセグメンテーション違反を修正しました。[#5819](https://github.com/ClickHouse/ClickHouse/pull/5819) ([Anton Popov](https://github.com/CurtizJ))
- 低優先度クエリが無限にスリープする可能性がある問題を修正しました。[#5842](https://github.com/ClickHouse/ClickHouse/pull/5842) ([alexey-milovidov](https://github.com/alexey-milovidov))
- ClickHouseがデフォルトのタイムゾーンをUTCではなくUCTと判定する問題を修正しました。[#5828](https://github.com/ClickHouse/ClickHouse/pull/5828) ([alexey-milovidov](https://github.com/alexey-milovidov))
- リーダーレプリカより前にフォロワーレプリカで分散DROP/ALTER/TRUNCATE/OPTIMIZE ON CLUSTERクエリが実行されるバグを修正しました。現在はリーダーレプリカで直接実行されます。[#5757](https://github.com/ClickHouse/ClickHouse/pull/5757) ([alesapin](https://github.com/alesapin))
- SYSTEM FLUSH LOGSクエリの後に一部のクエリがquery_logに即座に表示されない原因となる競合状態を修正しました。[#5685](https://github.com/ClickHouse/ClickHouse/pull/5685) ([Anton Popov](https://github.com/CurtizJ))
- `evalMLModel`関数への定数引数のサポートが欠けていた問題を修正しました。[#5820](https://github.com/ClickHouse/ClickHouse/pull/5820) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.9.2.4, 2019-06-24 {#clickhouse-release-19-9-2-4-2019-06-24}

#### 新機能 {#new-feature-8}

- `system.parts`テーブルに凍結されたパートに関する情報を表示します。[#5471](https://github.com/ClickHouse/ClickHouse/pull/5471) ([proller](https://github.com/proller))
- 引数で設定されていない場合、tty上でclickhouse-client起動時にクライアントパスワードを要求します [#5092](https://github.com/ClickHouse/ClickHouse/pull/5092) ([proller](https://github.com/proller))
- Decimal型に対する`dictGet`および`dictGetOrDefault`関数を実装しました。[#5394](https://github.com/ClickHouse/ClickHouse/pull/5394) ([Artem Zuikov](https://github.com/4ertus2))

#### 改善 {#improvement-8}

- Debian init: サービス停止タイムアウトを追加しました [#5522](https://github.com/ClickHouse/ClickHouse/pull/5522) ([proller](https://github.com/proller))
- LowCardinalityに対して疑わしい型でテーブルを作成することをデフォルトで禁止する設定を追加しました [#5448](https://github.com/ClickHouse/ClickHouse/pull/5448) ([Olga Khvostikova](https://github.com/stavrolia))
- 回帰関数は、`evalMLMethod`関数でStateとして使用されない場合にモデルの重みを返します。[#5411](https://github.com/ClickHouse/ClickHouse/pull/5411) ([Quid37](https://github.com/Quid37))
- 回帰メソッドの名前変更と改善を行いました。[#5492](https://github.com/ClickHouse/ClickHouse/pull/5492) ([Quid37](https://github.com/Quid37))
- 文字列検索のインターフェースをより明確にしました。[#5586](https://github.com/ClickHouse/ClickHouse/pull/5586) ([Danila Kutenin](https://github.com/danlark1))

#### バグ修正 {#bug-fix-24}


* Kafka における潜在的なデータ損失を修正 [#5445](https://github.com/ClickHouse/ClickHouse/pull/5445) ([Ivan](https://github.com/abyss7))
* `PrettySpace` フォーマットが列数 0 で呼び出された場合に発生しうる無限ループを修正 [#5560](https://github.com/ClickHouse/ClickHouse/pull/5560) ([Olga Khvostikova](https://github.com/stavrolia))
* 線形モデルにおける `UInt32` のオーバーフロー不具合を修正しました。定数でない `model` 引数に対しても ML モデルの `eval` を実行できるようにしました。 [#5516](https://github.com/ClickHouse/ClickHouse/pull/5516) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* `ALTER TABLE ... DROP INDEX IF EXISTS ...` は、指定されたインデックスが存在しない場合でも例外をスローしないようになりました [#5524](https://github.com/ClickHouse/ClickHouse/pull/5524) ([Gleb Novikov](https://github.com/NanoBjorn))
* スカラーサブクエリ内の `bitmapHasAny` によるセグメンテーションフォールトを修正 [#5528](https://github.com/ClickHouse/ClickHouse/pull/5528) ([Zhichang Yu](https://github.com/yuzhichang))
* DNS キャッシュが削除された後でも、レプリケーション接続プールがホストの再解決を試行しない不具合を修正。 [#5534](https://github.com/ClickHouse/ClickHouse/pull/5534) ([alesapin](https://github.com/alesapin))
* ReplicatedMergeTree での `ALTER ... MODIFY TTL` を修正しました。 [#5539](https://github.com/ClickHouse/ClickHouse/pull/5539) ([Anton Popov](https://github.com/CurtizJ))
* MATERIALIZED 列を持つ Distributed テーブルへの `INSERT` を修正 [#5429](https://github.com/ClickHouse/ClickHouse/pull/5429) ([Azat Khuzhin](https://github.com/azat))
* Join ストレージを `TRUNCATE` した際に発生する `bad alloc` を修正 [#5437](https://github.com/ClickHouse/ClickHouse/pull/5437) ([TCeason](https://github.com/TCeason))
* 最近のバージョンの tzdata パッケージでは、いくつかのファイルがシンボリックリンクになっています。これにより、デフォルトのタイムゾーンを検出する既存の仕組みが壊れてしまい、一部のタイムゾーンで誤った名前が返されるようになりました。現在は少なくとも、`TZ` が指定されている場合には、その内容をタイムゾーン名として強制的に使用するようにしています。[#5443](https://github.com/ClickHouse/ClickHouse/pull/5443) ([Ivan](https://github.com/abyss7))
* `sum` 内の定数の needle が少なくとも 16KB の長さである場合に発生する、MultiVolnitsky searcher に関する極めてまれな不具合を修正しました。アルゴリズムがそれまでの結果を見落としたり上書きしてしまうことがあり、その結果として `multiSearchAny` の結果が不正確になる可能性がありました。 [#5588](https://github.com/ClickHouse/ClickHouse/pull/5588) ([Danila Kutenin](https://github.com/danlark1))
* ExternalData リクエスト用の設定で ClickHouse の設定を使用できなかった問題を修正しました。なお、現時点では名前のあいまいさにより、`date_time_input_format` と `low_cardinality_allow_in_native_format` の各設定は使用できません（外部データではテーブルフォーマットとして解釈され得る一方で、クエリ内では設定として解釈され得るため）。 [#5455](https://github.com/ClickHouse/ClickHouse/pull/5455) ([Danila Kutenin](https://github.com/danlark1))
* パーツがZookeeperからは削除されず、ファイルシステムからのみ削除されてしまうバグを修正。 [#5520](https://github.com/ClickHouse/ClickHouse/pull/5520) ([alesapin](https://github.com/alesapin))
* MySQL プロトコルからデバッグログ出力を削除 [#5478](https://github.com/ClickHouse/ClickHouse/pull/5478) ([alexey-milovidov](https://github.com/alexey-milovidov))
* DDL クエリ処理時に ZNONODE をスキップする [#5489](https://github.com/ClickHouse/ClickHouse/pull/5489) ([Azat Khuzhin](https://github.com/azat))
* `UNION ALL` の結果列の型の混在を修正しました。結果列において、データと列型が不整合になるケースがありました。 [#5503](https://github.com/ClickHouse/ClickHouse/pull/5503) ([Artem Zuikov](https://github.com/4ertus2))
* `dictGetT` 関数で不正な整数が指定された場合、クラッシュせずに例外をスローするようにしました。 [#5446](https://github.com/ClickHouse/ClickHouse/pull/5446) ([Artem Zuikov](https://github.com/4ertus2))
* `system.dictionaries` テーブル内のハッシュ辞書における誤った `element_count` および `load_factor` を修正。 [#5440](https://github.com/ClickHouse/ClickHouse/pull/5440) ([Azat Khuzhin](https://github.com/azat))

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-9}

- `Brotli` HTTP圧縮サポートなしでのビルドを修正（`ENABLE_BROTLI=OFF` cmake変数）。[#5521](https://github.com/ClickHouse/ClickHouse/pull/5521) ([Anton Yuzhaninov](https://github.com/citrin))
- roaring.hをroaring/roaring.hとしてインクルード [#5523](https://github.com/ClickHouse/ClickHouse/pull/5523) ([Orivej Desh](https://github.com/orivej))
- hyperscanにおけるgcc9の警告を修正（#lineディレクティブは厄介！） [#5546](https://github.com/ClickHouse/ClickHouse/pull/5546) ([Danila Kutenin](https://github.com/danlark1))
- gcc-9でのコンパイル時のすべての警告を修正。一部のcontribの問題を修正。gcc9のICEを修正しbugzillaに報告。 [#5498](https://github.com/ClickHouse/ClickHouse/pull/5498) ([Danila Kutenin](https://github.com/danlark1))
- lldでのリンクを修正 [#5477](https://github.com/ClickHouse/ClickHouse/pull/5477) ([alexey-milovidov](https://github.com/alexey-milovidov))
- ディクショナリ内の未使用の特殊化を削除 [#5452](https://github.com/ClickHouse/ClickHouse/pull/5452) ([Artem Zuikov](https://github.com/4ertus2))
- 異なるファイルタイプのテーブルのフォーマットおよび解析処理のパフォーマンステストを改善 [#5497](https://github.com/ClickHouse/ClickHouse/pull/5497) ([Olga Khvostikova](https://github.com/stavrolia))
- 並列テスト実行の修正 [#5506](https://github.com/ClickHouse/ClickHouse/pull/5506) ([proller](https://github.com/proller))
- Docker: clickhouse-testの設定を使用 [#5531](https://github.com/ClickHouse/ClickHouse/pull/5531) ([proller](https://github.com/proller))
- FreeBSD向けのコンパイルを修正 [#5447](https://github.com/ClickHouse/ClickHouse/pull/5447) ([proller](https://github.com/proller))
- boostを1.70にアップグレード [#5570](https://github.com/ClickHouse/ClickHouse/pull/5570) ([proller](https://github.com/proller))
- サブモジュールとしてのClickHouseのビルドを修正 [#5574](https://github.com/ClickHouse/ClickHouse/pull/5574) ([proller](https://github.com/proller))
- JSONExtractのパフォーマンステストを改善 [#5444](https://github.com/ClickHouse/ClickHouse/pull/5444) ([Vitaly Baranov](https://github.com/vitlibar))


## ClickHouse リリース 19.8 {#clickhouse-release-19-8}

### ClickHouse リリース 19.8.3.8, 2019-06-11 {#clickhouse-release-19-8-3-8-2019-06-11}

#### 新機能 {#new-features}


* JSON を扱う関数を追加 [#4686](https://github.com/ClickHouse/ClickHouse/pull/4686) ([hcz](https://github.com/hczhcz)) [#5124](https://github.com/ClickHouse/ClickHouse/pull/5124). ([Vitaly Baranov](https://github.com/vitlibar))
* 多くの言語に存在する `basename` 関数（Python の `os.path.basename`、PHP の `basename` など）と同様の動作をする関数 `basename` を追加しました。UNIX 系のパスと Windows のパスの両方で動作します。 [#5136](https://github.com/ClickHouse/ClickHouse/pull/5136) ([Guillaume Tassery](https://github.com/YiuRULE))
* `LIMIT BY` 句に対してオフセット n を設定できるように、`LIMIT n, m BY` および `LIMIT m OFFSET n BY` 構文を追加しました。 [#5138](https://github.com/ClickHouse/ClickHouse/pull/5138) ([Anton Popov](https://github.com/CurtizJ))
* `AggregatingMergeTree` 内で軽量な集約を行うカラムを持てる新しいデータ型 `SimpleAggregateFunction` を追加しました。これは `any`、`anyLast`、`sum`、`min`、`max` などの単純な関数でのみ使用できます。 [#4629](https://github.com/ClickHouse/ClickHouse/pull/4629) ([Boris Granveaud](https://github.com/bgranvea))
* 関数 `ngramDistance` で非定数引数をサポートする機能を追加 [#5198](https://github.com/ClickHouse/ClickHouse/pull/5198) ([Danila Kutenin](https://github.com/danlark1))
* シーケンスの歪度、標本歪度、尖度、および標本尖度をそれぞれ計算する関数 `skewPop`、`skewSamp`、`kurtPop`、`kurtSamp` を追加しました。 [#5200](https://github.com/ClickHouse/ClickHouse/pull/5200) ([hcz](https://github.com/hczhcz))
* `MaterializeView` ストレージでの rename 操作をサポート。 [#5209](https://github.com/ClickHouse/ClickHouse/pull/5209) ([Guillaume Tassery](https://github.com/YiuRULE))
* MySQL クライアントを使用して ClickHouse に接続できるサーバーを追加しました。 [#4715](https://github.com/ClickHouse/ClickHouse/pull/4715) ([Yuriy Baranov](https://github.com/yurriy))
* `toDecimal*OrZero` 関数と `toDecimal*OrNull` 関数を追加。 [#5291](https://github.com/ClickHouse/ClickHouse/pull/5291) ([Artem Zuikov](https://github.com/4ertus2))
* 関数 `quantile`、`quantiles`、`median`、`quantileExactWeighted`、`quantilesExactWeighted`、`medianExactWeighted` で Decimal 型をサポート。 [#5304](https://github.com/ClickHouse/ClickHouse/pull/5304) ([Artem Zuikov](https://github.com/4ertus2))
* 無効な UTF-8 文字をすべて置換文字 � (U+FFFD) に変換する `toValidUTF8` 関数を追加。 [#5322](https://github.com/ClickHouse/ClickHouse/pull/5322) ([Danila Kutenin](https://github.com/danlark1))
* `format` 関数を追加しました。引数で指定された文字列を用いて、定数パターン（簡略化された Python のフォーマットパターン）に従って文字列を整形します。 [#5330](https://github.com/ClickHouse/ClickHouse/pull/5330) ([Danila Kutenin](https://github.com/danlark1))
* `MergeTree` テーブルのデタッチされたパーツに関する情報を保持する `system.detached_parts` テーブルを追加しました。 [#5353](https://github.com/ClickHouse/ClickHouse/pull/5353) ([akuzm](https://github.com/akuzm))
* `needle` と `haystack` 間の非対称な差分を計算する `ngramSearch` 関数を追加。 [#5418](https://github.com/ClickHouse/ClickHouse/pull/5418)[#5422](https://github.com/ClickHouse/ClickHouse/pull/5422) ([Danila Kutenin](https://github.com/danlark1))
* 集約関数インターフェイスを用いた基本的な機械学習手法（確率的線形回帰およびロジスティック回帰）の実装。モデルの重みを更新するための複数の戦略（単純な勾配降下法、モメンタム法、Nesterov 法）を備えています。また、任意のサイズのミニバッチにも対応しています。 [#4943](https://github.com/ClickHouse/ClickHouse/pull/4943) ([Quid37](https://github.com/Quid37))
* `geohashEncode` および `geohashDecode` 関数を実装。 [#5003](https://github.com/ClickHouse/ClickHouse/pull/5003) ([Vasily Nemkov](https://github.com/Enmk))
* タイムスタンプが揃っていない複数のタイムシリーズを集約できる集約関数 `timeSeriesGroupSum` を追加しました。2 つのサンプルタイムスタンプ間を線形補間し、その結果を用いてタイムシリーズ同士を合算します。タイムシリーズのレートを計算し、そのレート同士を合算する集約関数 `timeSeriesGroupRateSum` も追加しました。 [#4542](https://github.com/ClickHouse/ClickHouse/pull/4542) ([Yangkuan Liu](https://github.com/LiuYangkuan))
* CIDR を使用してサブネット内の IP の下限値および上限値を計算する関数 `IPv4CIDRtoIPv4Range` と `IPv6CIDRtoIPv6Range` を追加しました。 [#5095](https://github.com/ClickHouse/ClickHouse/pull/5095) ([Guillaume Tassery](https://github.com/YiuRULE))
* HTTP でクエリを送信する際に、設定 `send_progress_in_http_headers` が有効になっている場合、`X-ClickHouse-Summary` ヘッダーを追加します。`X-ClickHouse-Progress` と同様の情報に加え、そのクエリで挿入された行数やバイト数などの追加情報も返します。 [#5116](https://github.com/ClickHouse/ClickHouse/pull/5116) ([Guillaume Tassery](https://github.com/YiuRULE))

#### 改善点 {#improvements}


* MergeTree ファミリーのテーブル向けに `max_parts_in_total` 設定（デフォルト: 100 000）を追加し、パーティションキーの安全でない指定を防止するようにしました #5166。 [#5171](https://github.com/ClickHouse/ClickHouse/pull/5171) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `clickhouse-obfuscator`: 個々のカラム用のシードを、カラム位置ではなく、初期シードとカラム名を組み合わせて導出するようにしました。これは、複数の関連テーブルを含むデータセットを変換しても、テーブル同士を JOIN 可能な状態に保つことを目的としています。 [#5178](https://github.com/ClickHouse/ClickHouse/pull/5178) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 関数 `JSONExtractRaw` と `JSONExtractKeyAndValues` を追加しました。関数 `jsonExtract<type>` を `JSONExtract<type>` に改名しました。問題が発生した場合、これらの関数は `NULL` ではなく対応する値を返します。関数 `JSONExtract` を変更し、最後の引数から戻り値の型を取得し、nullable を付与しないようにしました。AVX2 命令が利用できない場合に RapidJSON にフォールバックするよう実装しました。Simdjson ライブラリを新しいバージョンに更新しました。[#5235](https://github.com/ClickHouse/ClickHouse/pull/5235) ([Vitaly Baranov](https://github.com/vitlibar))
* `if` 関数と `multiIf` 関数は、条件の `Nullable` には依存せず、SQL 互換性のために分岐側に依存するようになりました。 [#5238](https://github.com/ClickHouse/ClickHouse/pull/5238) ([Jian Wu](https://github.com/janplus))
* `In` 述語は、`Equal` 関数と同様に、`Null` 入力から `Null` を結果として返すようになりました。 [#5152](https://github.com/ClickHouse/ClickHouse/pull/5152) ([Jian Wu](https://github.com/janplus))
* Kafka からの行について、(flush&#95;interval / poll&#95;timeout) 行ごとに時間制限を確認します。これにより、Kafka コンシューマーからの読み取りをより頻繁に中断し、トップレベルストリームの時間制限を確認できるようになります [#5249](https://github.com/ClickHouse/ClickHouse/pull/5249) ([Ivan](https://github.com/abyss7))
* バンドルされた SASL と rdkafka をリンクしました。これにより SASL SCRAM 認証が利用可能になりました [#5253](https://github.com/ClickHouse/ClickHouse/pull/5253) ([Ivan](https://github.com/abyss7))
* ALL JOIN 向けの `RowRefList` のバッチ版。 [#5267](https://github.com/ClickHouse/ClickHouse/pull/5267) ([Artem Zuikov](https://github.com/4ertus2))
* clickhouse-server: より情報量の多いリッスンエラーメッセージ。 [#5268](https://github.com/ClickHouse/ClickHouse/pull/5268) ([proller](https://github.com/proller))
* `<sharding_key>` 内の関数向けに clickhouse-copier でディクショナリをサポート [#5270](https://github.com/ClickHouse/ClickHouse/pull/5270) ([proller](https://github.com/proller))
* 新しい設定 `kafka_commit_every_batch` を追加し、Kafka のコミットポリシーを制御できるようにしました。
  この設定により、各メッセージバッチの処理後にコミットするか、ブロック全体がストレージに書き込まれた後にコミットするかのモードを指定できます。これは、極端な状況で一部のメッセージを失うリスクと、同じメッセージを二重に読み取る可能性とのトレードオフです。 [#5308](https://github.com/ClickHouse/ClickHouse/pull/5308) ([Ivan](https://github.com/abyss7))
* `windowFunnel` が他の符号なし整数型もサポートするようになりました。 [#5320](https://github.com/ClickHouse/ClickHouse/pull/5320) ([sundyli](https://github.com/sundy-li))
* Merge エンジンで仮想カラム `_table` をシャドウイングできるようにしました。 [#5325](https://github.com/ClickHouse/ClickHouse/pull/5325) ([Ivan](https://github.com/abyss7))
* `sequenceMatch` 集計関数が他の符号なし整数型もサポートするようになりました [#5339](https://github.com/ClickHouse/ClickHouse/pull/5339) ([sundyli](https://github.com/sundy-li))
* チェックサムの不一致がハードウェア障害に起因している可能性が高い場合に、よりわかりやすいエラーメッセージを表示します。 [#5355](https://github.com/ClickHouse/ClickHouse/pull/5355) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `StorageMerge` 用のサンプリングを下位テーブルがサポートしていることを確認する [#5366](https://github.com/ClickHouse/ClickHouse/pull/5366) ([Ivan](https://github.com/abyss7))
* 外部ディクショナリでの使用後に MySQL 接続をクローズするようにしました。issue #893 に関連します。 [#5395](https://github.com/ClickHouse/ClickHouse/pull/5395) ([Clément Rodriguez](https://github.com/clemrodriguez))
* MySQL Wire Protocol の改善。フォーマット名を MySQLWire に変更。RSA&#95;free を呼び出すために RAII を使用。コンテキストを作成できない場合は SSL を無効化。 [#5419](https://github.com/ClickHouse/ClickHouse/pull/5419) ([Yuriy Baranov](https://github.com/yurriy))
* clickhouse-client: アクセスできない履歴ファイル（読み取り専用、ディスク容量不足、ファイルがディレクトリである、など）があっても実行できるようにしました。 [#5431](https://github.com/ClickHouse/ClickHouse/pull/5431) ([proller](https://github.com/proller))
* 非同期の Distributed テーブルへの `INSERT` でクエリ設定が反映されるようにしました。 [#4936](https://github.com/ClickHouse/ClickHouse/pull/4936) ([TCeason](https://github.com/TCeason))
* 関数 `leastSqr` を `simpleLinearRegression` に、`LinearRegression` を `linearRegression` に、`LogisticRegression` を `logisticRegression` に名称変更しました。 [#5391](https://github.com/ClickHouse/ClickHouse/pull/5391) ([Nikolai Kochetov](https://github.com/KochetovNicolai))

#### パフォーマンス改善 {#performance-improvements}

- ALTER MODIFY クエリにおける非レプリケート MergeTree テーブルのパーツ処理を並列化しました。[#4639](https://github.com/ClickHouse/ClickHouse/pull/4639) ([Ivan Kush](https://github.com/IvanKush))
- 正規表現抽出の最適化を行いました。[#5193](https://github.com/ClickHouse/ClickHouse/pull/5193) [#5191](https://github.com/ClickHouse/ClickHouse/pull/5191) ([Danila Kutenin](https://github.com/danlark1))
- join on セクションでのみ使用される場合、右結合キー列を結合結果に追加しないようにしました。[#5260](https://github.com/ClickHouse/ClickHouse/pull/5260) ([Artem Zuikov](https://github.com/4ertus2))
- 最初の空のレスポンス後に Kafka バッファをフリーズするようにしました。これにより、一部の行解析ストリームにおいて空の結果に対する `ReadBuffer::next()` の複数回呼び出しを回避します。[#5283](https://github.com/ClickHouse/ClickHouse/pull/5283) ([Ivan](https://github.com/abyss7))
- 複数の引数に対する `concat` 関数の最適化を行いました。[#5357](https://github.com/ClickHouse/ClickHouse/pull/5357) ([Danila Kutenin](https://github.com/danlark1))
- クエリ最適化を行いました。カンマ結合/クロス結合を内部結合に書き換える際に IN 文のプッシュダウンを許可するようにしました。[#5396](https://github.com/ClickHouse/ClickHouse/pull/5396) ([Artem Zuikov](https://github.com/4ertus2))
- より高速な展開を実現するため、LZ4 実装をリファレンス実装にアップグレードしました。[#5070](https://github.com/ClickHouse/ClickHouse/pull/5070) ([Danila Kutenin](https://github.com/danlark1))
- MSD 基数ソート(kxsort ベース)と部分ソートを実装しました。[#5129](https://github.com/ClickHouse/ClickHouse/pull/5129) ([Evgenii Pravda](https://github.com/kvinty))

#### バグ修正 {#bug-fixes}

- 結合時の必須列のプッシュを修正しました [#5192](https://github.com/ClickHouse/ClickHouse/pull/5192) ([Winter Zhang](https://github.com/zhang2014))
- ClickHouse が systemd によって実行されている場合に、`sudo service clickhouse-server forcerestart` コマンドが期待通りに動作しないバグを修正しました。[#5204](https://github.com/ClickHouse/ClickHouse/pull/5204) ([proller](https://github.com/proller))
- DataPartsExchange における HTTP エラーコードを修正しました(9009 ポートのサーバー間 HTTP サーバーがエラー時でも常にコード 200 を返していた問題)。[#5216](https://github.com/ClickHouse/ClickHouse/pull/5216) ([proller](https://github.com/proller))
- MAX_SMALL_STRING_SIZE より長い文字列に対する SimpleAggregateFunction を修正しました [#5311](https://github.com/ClickHouse/ClickHouse/pull/5311) ([Azat Khuzhin](https://github.com/azat))
- IN における `Decimal` から `Nullable(Decimal)` への変換エラーを修正しました。その他の Decimal から Decimal への変換(異なるスケールを含む)をサポートしました。[#5350](https://github.com/ClickHouse/ClickHouse/pull/5350) ([Artem Zuikov](https://github.com/4ertus2))
- simdjson ライブラリにおける FPU の破壊により、`uniqHLL` および `uniqCombined` 集約関数や `log` などの数学関数の計算が誤っていた問題を修正しました。[#5354](https://github.com/ClickHouse/ClickHouse/pull/5354) ([alexey-milovidov](https://github.com/alexey-milovidov))
- JSON 関数における const/非const の混在ケースの処理を修正しました。[#5435](https://github.com/ClickHouse/ClickHouse/pull/5435) ([Vitaly Baranov](https://github.com/vitlibar))
- `retention` 関数を修正しました。データの行内で満たされるすべての条件がデータ状態に追加されるようになりました。[#5119](https://github.com/ClickHouse/ClickHouse/pull/5119) ([小路](https://github.com/nicelulu))
- Decimal を使用した `quantileExact` の結果型を修正しました。[#5304](https://github.com/ClickHouse/ClickHouse/pull/5304) ([Artem Zuikov](https://github.com/4ertus2))

#### ドキュメント {#documentation}


- `CollapsingMergeTree`のドキュメントを中国語に翻訳。[#5168](https://github.com/ClickHouse/ClickHouse/pull/5168) ([张风啸](https://github.com/AlexZFX))
- テーブルエンジンに関する一部のドキュメントを中国語に翻訳。
  [#5134](https://github.com/ClickHouse/ClickHouse/pull/5134)
  [#5328](https://github.com/ClickHouse/ClickHouse/pull/5328)
  ([never lee](https://github.com/neverlee))

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvements}

- use-after-freeの可能性を示すサニタイザーレポートを修正。[#5139](https://github.com/ClickHouse/ClickHouse/pull/5139) [#5143](https://github.com/ClickHouse/ClickHouse/pull/5143) [#5393](https://github.com/ClickHouse/ClickHouse/pull/5393) ([Ivan](https://github.com/abyss7))
- 利便性のためパフォーマンステストを個別のディレクトリから移動。[#5158](https://github.com/ClickHouse/ClickHouse/pull/5158) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 不正確なパフォーマンステストを修正。[#5255](https://github.com/ClickHouse/ClickHouse/pull/5255) ([alesapin](https://github.com/alesapin))
- ハードウェア問題のデバッグのため、ビット反転によるチェックサムを計算するツールを追加。[#5334](https://github.com/ClickHouse/ClickHouse/pull/5334) ([alexey-milovidov](https://github.com/alexey-milovidov))
- ランナースクリプトをより使いやすく改善。[#5340](https://github.com/ClickHouse/ClickHouse/pull/5340)[#5360](https://github.com/ClickHouse/ClickHouse/pull/5360) ([filimonov](https://github.com/filimonov))
- パフォーマンステストの書き方に関する簡単な手順を追加。[#5408](https://github.com/ClickHouse/ClickHouse/pull/5408) ([alesapin](https://github.com/alesapin))
- パフォーマンステストにおいてcreate、fill、dropクエリで置換を行う機能を追加。[#5367](https://github.com/ClickHouse/ClickHouse/pull/5367) ([Olga Khvostikova](https://github.com/stavrolia))


## ClickHouse リリース 19.7 {#clickhouse-release-19-7}

### ClickHouse リリース 19.7.5.29, 2019-07-05 {#clickhouse-release-19-7-5-29-2019-07-05}

#### バグ修正 {#bug-fix-25}

- JOIN を含む一部のクエリでのパフォーマンス低下を修正。[#5192](https://github.com/ClickHouse/ClickHouse/pull/5192) ([Winter Zhang](https://github.com/zhang2014))

### ClickHouse リリース 19.7.5.27, 2019-06-09 {#clickhouse-release-19-7-5-27-2019-06-09}

#### 新機能 {#new-features-1}

- 配列用の `hasAny` および `hasAll` 関数に類似したビットマップ関連関数 `bitmapHasAny` および `bitmapHasAll` を追加。[#5279](https://github.com/ClickHouse/ClickHouse/pull/5279) ([Sergi Vladykin](https://github.com/svladykin))

#### バグ修正 {#bug-fixes-1}


- Null値を持つ`minmax` INDEXでのセグメンテーション違反を修正。[#5246](https://github.com/ClickHouse/ClickHouse/pull/5246) ([Nikita Vasilev](https://github.com/nikvas0))
- LIMIT BY内のすべての入力カラムを必須出力としてマーク。これにより、一部の分散クエリにおける「カラムが見つかりません」エラーを修正。[#5407](https://github.com/ClickHouse/ClickHouse/pull/5407) ([Constantin S. Pan](https://github.com/kvap))
- DEFAULTを持つカラムに対する`SELECT .. PREWHERE`での「カラム '0' は既に存在します」エラーを修正 [#5397](https://github.com/ClickHouse/ClickHouse/pull/5397) ([proller](https://github.com/proller))
- `ReplicatedMergeTree`における`ALTER MODIFY TTL`クエリを修正。[#5539](https://github.com/ClickHouse/ClickHouse/pull/5539/commits) ([Anton Popov](https://github.com/CurtizJ))
- Kafkaコンシューマーの起動に失敗した際にサーバーがクラッシュしないように修正。[#5285](https://github.com/ClickHouse/ClickHouse/pull/5285) ([Ivan](https://github.com/abyss7))
- ビットマップ関数が誤った結果を生成する問題を修正。[#5359](https://github.com/ClickHouse/ClickHouse/pull/5359) ([Andy Yang](https://github.com/andyyzh))
- ハッシュディクショナリのelement_countを修正(重複を含めない) [#5440](https://github.com/ClickHouse/ClickHouse/pull/5440) ([Azat Khuzhin](https://github.com/azat))
- 環境変数TZの内容をタイムゾーン名として使用。これにより、一部のケースでデフォルトタイムゾーンを正しく検出できるようになります。[#5443](https://github.com/ClickHouse/ClickHouse/pull/5443) ([Ivan](https://github.com/abyss7))
- `dictGetT`関数内で整数の変換を試みないように修正。正しく動作しないため、代わりに例外をスローします。[#5446](https://github.com/ClickHouse/ClickHouse/pull/5446) ([Artem Zuikov](https://github.com/4ertus2))
- ExternalData HTTPリクエストにおける設定を修正。[#5455](https://github.com/ClickHouse/ClickHouse/pull/5455) ([Danila
  Kutenin](https://github.com/danlark1))
- パーツがZookeeperから削除されずにファイルシステムからのみ削除されるバグを修正。[#5520](https://github.com/ClickHouse/ClickHouse/pull/5520) ([alesapin](https://github.com/alesapin))
- `bitmapHasAny`関数におけるセグメンテーション違反を修正。[#5528](https://github.com/ClickHouse/ClickHouse/pull/5528) ([Zhichang Yu](https://github.com/yuzhichang))
- DNSキャッシュがドロップされた場合でも、レプリケーション接続プールがホストの解決を再試行しないエラーを修正。[#5534](https://github.com/ClickHouse/ClickHouse/pull/5534) ([alesapin](https://github.com/alesapin))
- `DROP INDEX IF EXISTS`クエリを修正。`ALTER TABLE ... DROP INDEX IF EXISTS ...`クエリは、指定されたインデックスが存在しない場合でも例外を発生させなくなりました。[#5524](https://github.com/ClickHouse/ClickHouse/pull/5524) ([Gleb Novikov](https://github.com/NanoBjorn))
- union allのスーパータイプカラムを修正。結果カラムのデータとカラム型に不整合があるケースがありました。[#5503](https://github.com/ClickHouse/ClickHouse/pull/5503) ([Artem Zuikov](https://github.com/4ertus2))
- DDLクエリ処理中にZNONODEをスキップ。以前は、別のノードがタスクキュー内のznodeを削除した場合、それを処理していないがすでに子のリストを取得しているノードがDDLWorkerスレッドを終了していました。[#5489](https://github.com/ClickHouse/ClickHouse/pull/5489) ([Azat Khuzhin](https://github.com/azat))
- MATERIALIZEDカラムを持つDistributed()テーブルへのINSERTを修正。[#5429](https://github.com/ClickHouse/ClickHouse/pull/5429) ([Azat Khuzhin](https://github.com/azat))

### ClickHouse リリース 19.7.3.9, 2019-05-30 {#clickhouse-release-19-7-3-9-2019-05-30}

#### 新機能 {#new-features-2}


- ユーザーが指定できる設定値の範囲を制限できるようになりました。
  これらの制約はユーザー設定プロファイルで設定できます。
  [#4931](https://github.com/ClickHouse/ClickHouse/pull/4931) ([Vitaly
  Baranov](https://github.com/vitlibar))
- オプションの `max_size` パラメータを持つ `groupUniqArray` 関数の第2バージョンを追加しました。このパラメータは結果配列のサイズを制限します。この動作は `groupArray(max_size)(x)` 関数と同様です。
  [#5026](https://github.com/ClickHouse/ClickHouse/pull/5026) ([Guillaume
  Tassery](https://github.com/YiuRULE))
- TSVWithNames/CSVWithNames入力ファイル形式において、列の順序をファイルヘッダーから決定できるようになりました。これは `input_format_with_names_use_header` パラメータで制御されます。
  [#5081](https://github.com/ClickHouse/ClickHouse/pull/5081)
  ([Alexander](https://github.com/Akazz))

#### バグ修正 {#bug-fixes-2}

- マージ中の uncompressed_cache + JOIN によるクラッシュを修正 (#5197)
  [#5133](https://github.com/ClickHouse/ClickHouse/pull/5133) ([Danila
  Kutenin](https://github.com/danlark1))
- システムテーブルへの clickhouse-client クエリでのセグメンテーション違反を修正。#5066
  [#5127](https://github.com/ClickHouse/ClickHouse/pull/5127)
  ([Ivan](https://github.com/abyss7))
- KafkaEngine経由の高負荷時のデータ損失を修正 (#4736)
  [#5080](https://github.com/ClickHouse/ClickHouse/pull/5080)
  ([Ivan](https://github.com/abyss7))
- system.columns、system.tables、system.parts、system.parts_tables、またはMergeファミリーのテーブルから少なくとも2つのSELECTを含むUNION ALLクエリを実行し、同時に関連テーブルの列に対してALTERを実行した場合に発生する可能性のある極めて稀なデータ競合状態を修正しました。[#5189](https://github.com/ClickHouse/ClickHouse/pull/5189) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### パフォーマンス改善 {#performance-improvements-1}

- `LIMIT` なしの `ORDER BY` で単一の数値列によるソート時に基数ソートを使用するようになりました。[#5106](https://github.com/ClickHouse/ClickHouse/pull/5106)、
  [#4439](https://github.com/ClickHouse/ClickHouse/pull/4439)
  ([Evgenii Pravda](https://github.com/kvinty)、
  [alexey-milovidov](https://github.com/alexey-milovidov))

#### ドキュメント {#documentation-1}

- 一部のテーブルエンジンのドキュメントを中国語に翻訳しました。
  [#5107](https://github.com/ClickHouse/ClickHouse/pull/5107)、
  [#5094](https://github.com/ClickHouse/ClickHouse/pull/5094)、
  [#5087](https://github.com/ClickHouse/ClickHouse/pull/5087)
  ([张风啸](https://github.com/AlexZFX))、
  [#5068](https://github.com/ClickHouse/ClickHouse/pull/5068) ([never
  lee](https://github.com/neverlee))

#### ビルド/テスト/パッケージング改善 {#buildtestingpackaging-improvements-1}


- `clickhouse-test` で UTF-8 文字が正しく出力されるようにしました。
    [#5084](https://github.com/ClickHouse/ClickHouse/pull/5084)
    ([alexey-milovidov](https://github.com/alexey-milovidov))
- clickhouse-client に、サジェストデータを常に読み込むためのコマンドラインパラメータを追加しました。
    [#5102](https://github.com/ClickHouse/ClickHouse/pull/5102)
    ([alexey-milovidov](https://github.com/alexey-milovidov))
- PVS-Studio の警告の一部を解消しました。
    [#5082](https://github.com/ClickHouse/ClickHouse/pull/5082)
    ([alexey-milovidov](https://github.com/alexey-milovidov))
- LZ4 を更新しました。 [#5040](https://github.com/ClickHouse/ClickHouse/pull/5040) ([Danila
    Kutenin](https://github.com/danlark1))
- 今後のプルリクエスト #5030 に向けて、ビルド要件に gperf を追加しました。
    [#5110](https://github.com/ClickHouse/ClickHouse/pull/5110)
    ([proller](https://github.com/proller))



## ClickHouse リリース 19.6 {#clickhouse-release-19-6}

### ClickHouse リリース 19.6.3.18, 2019-06-13 {#clickhouse-release-19-6-3-18-2019-06-13}

#### バグ修正 {#bug-fixes-3}

- テーブル関数 `mysql` および `odbc` とそれに対応するテーブルエンジンからのクエリにおける IN 条件のプッシュダウンを修正しました。これにより #3540 と #2384 が修正されます。[#5313](https://github.com/ClickHouse/ClickHouse/pull/5313) ([alexey-milovidov](https://github.com/alexey-milovidov))
- ZooKeeper におけるデッドロックを修正しました。[#5297](https://github.com/ClickHouse/ClickHouse/pull/5297) ([github1youlc](https://github.com/github1youlc))
- CSV における引用符で囲まれた小数値を許可しました。[#5284](https://github.com/ClickHouse/ClickHouse/pull/5284) ([Artem Zuikov](https://github.com/4ertus2)
- 浮動小数点数の Inf/NaN から Decimal への変換を禁止しました（例外をスローします）。[#5282](https://github.com/ClickHouse/ClickHouse/pull/5282) ([Artem Zuikov](https://github.com/4ertus2))
- リネームクエリにおけるデータ競合を修正しました。[#5247](https://github.com/ClickHouse/ClickHouse/pull/5247) ([Winter Zhang](https://github.com/zhang2014))
- LFAlloc を一時的に無効化しました。LFAlloc の使用は UncompressedCache の割り当て時に多数の MAP_FAILED を引き起こし、高負荷サーバーでクエリがクラッシュする原因となる可能性があります。[cfdba93](https://github.com/ClickHouse/ClickHouse/commit/cfdba938ce22f16efeec504f7f90206a515b1280)([Danila Kutenin](https://github.com/danlark1))

### ClickHouse リリース 19.6.2.11, 2019-05-13 {#clickhouse-release-19-6-2-11-2019-05-13}

#### 新機能 {#new-features-3}

- カラムとテーブルに対する TTL 式。[#4212](https://github.com/ClickHouse/ClickHouse/pull/4212) ([Anton Popov](https://github.com/CurtizJ))
- HTTP レスポンスに対する `brotli` 圧縮のサポートを追加しました（Accept-Encoding: br）。[#4388](https://github.com/ClickHouse/ClickHouse/pull/4388) ([Mikhail](https://github.com/fandyushin))
- バイト列が正しく UTF-8 エンコードされているかを確認する新しい関数 `isValidUTF8` を追加しました。[#4934](https://github.com/ClickHouse/ClickHouse/pull/4934) ([Danila Kutenin](https://github.com/danlark1))
- 新しい負荷分散ポリシー `first_or_random` を追加しました。これは最初に指定されたホストにクエリを送信し、アクセスできない場合はシャードのランダムなホストにクエリを送信します。クロスレプリケーショントポロジーの設定に有用です。[#5012](https://github.com/ClickHouse/ClickHouse/pull/5012) ([nvartolomei](https://github.com/nvartolomei))

#### 実験的機能 {#experimental-features-1}

- MergeTree\* テーブルファミリーに対して設定 `index_granularity_bytes`（適応型インデックス粒度）を追加しました。[#4826](https://github.com/ClickHouse/ClickHouse/pull/4826) ([alesapin](https://github.com/alesapin))

#### 改善 {#improvements-1}


- `substringUTF8`関数に非定数および負のサイズと長さの引数のサポートを追加しました。[#4989](https://github.com/ClickHouse/ClickHouse/pull/4989) ([alexey-milovidov](https://github.com/alexey-milovidov))
- LEFT JOINにおける右テーブルへのプッシュダウン、RIGHT JOINにおける左テーブルへのプッシュダウン、およびFULL JOINにおける両テーブルへのプッシュダウンを無効化しました。これにより、一部のケースでJOINの誤った結果が修正されます。[#4846](https://github.com/ClickHouse/ClickHouse/pull/4846) ([Ivan](https://github.com/abyss7))
- `clickhouse-copier`: `--task-file`オプションからタスク設定を自動アップロード [#4876](https://github.com/ClickHouse/ClickHouse/pull/4876) ([proller](https://github.com/proller))
- ストレージファクトリとテーブル関数ファクトリにタイポハンドラを追加しました。[#4891](https://github.com/ClickHouse/ClickHouse/pull/4891) ([Danila Kutenin](https://github.com/danlark1))
- サブクエリなしの複数結合において、アスタリスクと修飾されたアスタリスクをサポート [#4898](https://github.com/ClickHouse/ClickHouse/pull/4898) ([Artem Zuikov](https://github.com/4ertus2))
- カラム欠落時のエラーメッセージをよりユーザーフレンドリーにしました。[#4915](https://github.com/ClickHouse/ClickHouse/pull/4915) ([Artem Zuikov](https://github.com/4ertus2))

#### パフォーマンス改善 {#performance-improvements-2}

- ASOF JOINの大幅な高速化 [#4924](https://github.com/ClickHouse/ClickHouse/pull/4924) ([Martijn Bakker](https://github.com/Gladdy))

#### 後方互換性のない変更 {#backward-incompatible-changes}

- 一貫性のため、HTTPヘッダー`Query-Id`を`X-ClickHouse-Query-Id`に名称変更しました。[#4972](https://github.com/ClickHouse/ClickHouse/pull/4972) ([Mikhail](https://github.com/fandyushin))

#### バグ修正 {#bug-fixes-4}

- `clickhouse-copier`における潜在的なヌルポインタ参照を修正しました。[#4900](https://github.com/ClickHouse/ClickHouse/pull/4900) ([proller](https://github.com/proller))
- JOIN + ARRAY JOINを含むクエリのエラーを修正しました。[#4938](https://github.com/ClickHouse/ClickHouse/pull/4938) ([Artem Zuikov](https://github.com/4ertus2))
- engine=Dictionaryのデータベースを介して辞書が別の辞書に依存している場合に、サーバー起動時にハングする問題を修正しました。[#4962](https://github.com/ClickHouse/ClickHouse/pull/4962) ([Vitaly Baranov](https://github.com/vitlibar))
- distributed_product_mode = localを部分的に修正しました。テーブルエイリアスを介して、where/having/order by/...においてローカルテーブルのカラムを許可できるようになりました。テーブルにエイリアスがない場合は例外をスローします。テーブルエイリアスなしでカラムにアクセスすることはまだできません。[#4986](https://github.com/ClickHouse/ClickHouse/pull/4986) ([Artem Zuikov](https://github.com/4ertus2))
- `JOIN`を伴う`SELECT DISTINCT`の潜在的に誤った結果を修正しました。[#5001](https://github.com/ClickHouse/ClickHouse/pull/5001) ([Artem Zuikov](https://github.com/4ertus2))
- system.columns、system.tables、system.parts、system.parts_tables、またはMergeファミリーのテーブルから少なくとも2つのSELECTを含むUNION ALLを使用したクエリを実行し、同時に関連テーブルのカラムに対してALTERを実行する際に発生する可能性のある、非常に稀なデータ競合状態を修正しました。[#5189](https://github.com/ClickHouse/ClickHouse/pull/5189) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvements-2}


- 別のホスト上で clickhouse-server を実行した際に発生するテストの失敗を修正。 [#4713](https://github.com/ClickHouse/ClickHouse/pull/4713) ([Vasily Nemkov](https://github.com/Enmk))
- clickhouse-test: 非 tty 環境でカラー制御シーケンスを無効化。 [#4937](https://github.com/ClickHouse/ClickHouse/pull/4937) ([alesapin](https://github.com/alesapin))
- clickhouse-test: 任意のテストデータベースを使用できるようにする（可能な箇所では `test.` 修飾子を削除）。 [#5008](https://github.com/ClickHouse/ClickHouse/pull/5008) ([proller](https://github.com/proller))
- ubsan のエラーを修正。 [#5037](https://github.com/ClickHouse/ClickHouse/pull/5037) ([Vitaly Baranov](https://github.com/vitlibar))
- segfault をより確実に検出するため、MarkCache と UncompressedCache のデータを異なる方法で割り当てる Yandex LFAlloc を ClickHouse に追加。 [#4995](https://github.com/ClickHouse/ClickHouse/pull/4995) ([Danila Kutenin](https://github.com/danlark1))
- バックポートとチェンジログ作成を支援する Python 製ユーティリティ。 [#4949](https://github.com/ClickHouse/ClickHouse/pull/4949) ([Ivan](https://github.com/abyss7))



## ClickHouse リリース 19.5 {#clickhouse-release-19-5}

### ClickHouse リリース 19.5.4.22, 2019-05-13 {#clickhouse-release-19-5-4-22-2019-05-13}

#### バグ修正 {#bug-fixes-5}

- bitmap\* 関数で発生する可能性のあったクラッシュを修正 [#5220](https://github.com/ClickHouse/ClickHouse/pull/5220) [#5228](https://github.com/ClickHouse/ClickHouse/pull/5228) ([Andy Yang](https://github.com/andyyzh))
- system.columns、system.tables、system.parts、system.parts_tables、または Merge ファミリーのテーブルから少なくとも2つの SELECT を含む UNION ALL クエリを実行し、同時に関連テーブルのカラムに対して ALTER を実行した場合に発生する可能性のあった非常に稀なデータ競合状態を修正 [#5189](https://github.com/ClickHouse/ClickHouse/pull/5189) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `Set for IN is not created yet in case of using single LowCardinality column in the left part of IN` というエラーを修正。このエラーは LowCardinality カラムがプライマリキーの一部である場合に発生していました。#5031 [#5154](https://github.com/ClickHouse/ClickHouse/pull/5154) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- retention 関数の変更: 行が最初の条件と N 番目の条件の両方を満たす場合、以前は最初に満たされた条件のみがデータ状態に追加されていました。現在は、データの行で満たされるすべての条件がデータ状態に追加されます。[#5119](https://github.com/ClickHouse/ClickHouse/pull/5119) ([小路](https://github.com/nicelulu))

### ClickHouse リリース 19.5.3.8, 2019-04-18 {#clickhouse-release-19-5-3-8-2019-04-18}

#### バグ修正 {#bug-fixes-6}

- 設定 `max_partitions_per_insert_block` の型を boolean から UInt64 に修正 [#5028](https://github.com/ClickHouse/ClickHouse/pull/5028) ([Mohammad Hossein Sekhavat](https://github.com/mhsekhavat))

### ClickHouse リリース 19.5.2.6, 2019-04-15 {#clickhouse-release-19-5-2-6-2019-04-15}

#### 新機能 {#new-features-4}


- [Hyperscan](https://github.com/intel/hyperscan) による複数の正規表現マッチング機能が追加されました(関数 `multiMatchAny`, `multiMatchAnyIndex`, `multiFuzzyMatchAny`, `multiFuzzyMatchAnyIndex`)。[#4780](https://github.com/ClickHouse/ClickHouse/pull/4780), [#4841](https://github.com/ClickHouse/ClickHouse/pull/4841) ([Danila Kutenin](https://github.com/danlark1))
- `multiSearchFirstPosition` 関数が追加されました。[#4780](https://github.com/ClickHouse/ClickHouse/pull/4780) ([Danila Kutenin](https://github.com/danlark1))
- テーブルに対する行ごとの事前定義式フィルタを実装しました。[#4792](https://github.com/ClickHouse/ClickHouse/pull/4792) ([Ivan](https://github.com/abyss7))
- ブルームフィルタに基づく新しいタイプのデータスキップインデックスが追加されました(`equal`、`in`、`like` 関数で使用可能)。[#4499](https://github.com/ClickHouse/ClickHouse/pull/4499) ([Nikita Vasilev](https://github.com/nikvas0))
- 既知の最新値に結合するクエリを実行できる `ASOF JOIN` が追加されました。[#4774](https://github.com/ClickHouse/ClickHouse/pull/4774) [#4867](https://github.com/ClickHouse/ClickHouse/pull/4867) [#4863](https://github.com/ClickHouse/ClickHouse/pull/4863) [#4875](https://github.com/ClickHouse/ClickHouse/pull/4875) ([Martijn Bakker](https://github.com/Gladdy), [Artem Zuikov](https://github.com/4ertus2))
- 複数の `COMMA JOIN` を `CROSS JOIN` に書き換えます。その後、可能であれば `INNER JOIN` に書き換えます。[#4661](https://github.com/ClickHouse/ClickHouse/pull/4661) ([Artem Zuikov](https://github.com/4ertus2))

#### 改善 {#improvement-9}


- `topK` および `topKWeighted` がカスタム `loadFactor` をサポートするようになりました (issue [#4252](https://github.com/ClickHouse/ClickHouse/issues/4252) を修正)。[#4634](https://github.com/ClickHouse/ClickHouse/pull/4634) ([Kirill Danshin](https://github.com/kirillDanshin))
- サンプリングのないテーブルでも `parallel_replicas_count > 1` を使用できるようになりました (この設定は単に無視されます)。以前のバージョンでは例外が発生していました。[#4637](https://github.com/ClickHouse/ClickHouse/pull/4637) ([Alexey Elymanov](https://github.com/digitalist))
- `CREATE OR REPLACE VIEW` をサポートしました。単一のステートメントでビューを作成または新しい定義を設定できます。[#4654](https://github.com/ClickHouse/ClickHouse/pull/4654) ([Boris Granveaud](https://github.com/bgranvea))
- `Buffer` テーブルエンジンが `PREWHERE` をサポートするようになりました。[#4671](https://github.com/ClickHouse/ClickHouse/pull/4671) ([Yangkuan Liu](https://github.com/LiuYangkuan))
- ZooKeeper にメタデータがない状態でレプリケートされたテーブルを `readonly` モードで起動できる機能を追加しました。[#4691](https://github.com/ClickHouse/ClickHouse/pull/4691) ([alesapin](https://github.com/alesapin))
- clickhouse-client のプログレスバーのちらつきを修正しました。この問題は、ストリーミングクエリで `FORMAT Null` を使用する際に最も顕著でした。[#4811](https://github.com/ClickHouse/ClickHouse/pull/4811) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 潜在的に過剰で制御不能なリソース使用を制限するため、ユーザーごとに `hyperscan` ライブラリを使用する関数を無効化できるようになりました。[#4816](https://github.com/ClickHouse/ClickHouse/pull/4816) ([alexey-milovidov](https://github.com/alexey-milovidov))
- すべてのエラーにバージョン番号のログ記録を追加しました。[#4824](https://github.com/ClickHouse/ClickHouse/pull/4824) ([proller](https://github.com/proller))
- `multiMatch` 関数に文字列サイズが `unsigned int` に収まることを要求する制限を追加しました。また、`multiSearch` 関数に引数数の制限を追加しました。[#4834](https://github.com/ClickHouse/ClickHouse/pull/4834) ([Danila Kutenin](https://github.com/danlark1))
- Hyperscan におけるスクラッチスペースの使用とエラー処理を改善しました。[#4866](https://github.com/ClickHouse/ClickHouse/pull/4866) ([Danila Kutenin](https://github.com/danlark1))
- `*GraphiteMergeTree` エンジンテーブルのテーブル設定から `system.graphite_detentions` を入力するようにしました。[#4584](https://github.com/ClickHouse/ClickHouse/pull/4584) ([Mikhail f. Shiryaev](https://github.com/Felixoid))
- `trigramDistance` 関数を `ngramDistance` に名称変更し、`CaseInsensitive` および `UTF` を持つ関数を追加しました。[#4602](https://github.com/ClickHouse/ClickHouse/pull/4602) ([Danila Kutenin](https://github.com/danlark1))
- データスキッピングインデックスの計算を改善しました。[#4640](https://github.com/ClickHouse/ClickHouse/pull/4640) ([Nikita Vasilev](https://github.com/nikvas0))
- 通常のカラム、`DEFAULT`、`MATERIALIZED`、`ALIAS` カラムを単一のリストに保持するようにしました (issue [#2867](https://github.com/ClickHouse/ClickHouse/issues/2867) を修正)。[#4707](https://github.com/ClickHouse/ClickHouse/pull/4707) ([Alex Zatelepin](https://github.com/ztlpn))

#### バグ修正 {#bug-fix-26}


* メモリ確保に失敗した場合に `std::terminate` が呼ばれないようにしました。これにより、期待どおり `std::bad_alloc` 例外がスローされるようになりました。 [#4665](https://github.com/ClickHouse/ClickHouse/pull/4665) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `capnproto` のバッファーからの読み込み処理を修正。HTTP によるファイルの読み込みが正常に完了しないことがある問題を修正。[#4674](https://github.com/ClickHouse/ClickHouse/pull/4674) ([Vladislav](https://github.com/smirnov-vs))
* `OPTIMIZE TABLE FINAL` クエリ実行後に発生するエラー `Unknown log entry type: 0` を修正。 [#4683](https://github.com/ClickHouse/ClickHouse/pull/4683) ([Amos Bird](https://github.com/amosbird))
* `hasAny` または `hasAll` 関数に誤った引数を渡すと、セグメンテーションフォルトが発生する可能性があります。 [#4698](https://github.com/ClickHouse/ClickHouse/pull/4698) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `DROP DATABASE dictionary` クエリの実行中にデッドロックが発生する可能性があります。 [#4701](https://github.com/ClickHouse/ClickHouse/pull/4701) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `median` と `quantile` 関数の未定義動作を修正。 [#4702](https://github.com/ClickHouse/ClickHouse/pull/4702) ([hcz](https://github.com/hczhcz))
* `network_compression_method` が小文字の場合の圧縮レベル検出を修正。v19.1 で不具合が発生していた。[#4706](https://github.com/ClickHouse/ClickHouse/pull/4706) ([proller](https://github.com/proller))
* `<timezone>UTC</timezone>` 設定が無視されていた問題を修正しました（issue [#4658](https://github.com/ClickHouse/ClickHouse/issues/4658) を修正）。 [#4718](https://github.com/ClickHouse/ClickHouse/pull/4718) ([proller](https://github.com/proller))
* `Distributed` テーブルでの `histogram` 関数の動作を修正。 [#4741](https://github.com/ClickHouse/ClickHouse/pull/4741) ([olegkv](https://github.com/olegkv))
* tsan レポート「destroy of a locked mutex」を修正しました。 [#4742](https://github.com/ClickHouse/ClickHouse/pull/4742) ([alexey-milovidov](https://github.com/alexey-milovidov))
* システムログの使用における競合状態が原因で、シャットダウン時に発生していた TSan レポートを修正しました。`part_log` が有効な場合にシャットダウン時に発生し得る use-after-free の不具合を修正しました。 [#4758](https://github.com/ClickHouse/ClickHouse/pull/4758) ([alexey-milovidov](https://github.com/alexey-milovidov))
* エラー発生時の `ReplicatedMergeTreeAlterThread` における再チェック処理を修正。 [#4772](https://github.com/ClickHouse/ClickHouse/pull/4772) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 中間集計関数状態に対する算術演算が、（サブクエリ結果などの）定数引数では動作していませんでした。 [#4776](https://github.com/ClickHouse/ClickHouse/pull/4776) ([alexey-milovidov](https://github.com/alexey-milovidov))
* メタデータ内では常にカラム名をバッククォートで囲んでください。そうしないと、`index` という名前のカラムを持つテーブルを作成できません（メタデータ内の不正な `ATTACH` クエリが原因でサーバーが再起動しなくなります）。 [#4782](https://github.com/ClickHouse/ClickHouse/pull/4782) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `Distributed` テーブルでの `ALTER ... MODIFY ORDER BY` 実行時に発生するクラッシュを修正。 [#4790](https://github.com/ClickHouse/ClickHouse/pull/4790) ([TCeason](https://github.com/TCeason))
* `enable_optimize_predicate_expression` を有効にした状態での `JOIN ON` で発生するセグメンテーションフォルトを修正。 [#4794](https://github.com/ClickHouse/ClickHouse/pull/4794) ([Winter Zhang](https://github.com/zhang2014))
* Kafka から protobuf メッセージを取り込んだ後に不要な行が追加されてしまうバグを修正。 [#4808](https://github.com/ClickHouse/ClickHouse/pull/4808) ([Vitaly Baranov](https://github.com/vitlibar))
* `JOIN` において、not-nullable 列と nullable 列の組み合わせで発生するクラッシュを修正。`ANY JOIN` および `join_use_nulls` 使用時の右側キーにおける `NULL` の扱いを修正。 [#4815](https://github.com/ClickHouse/ClickHouse/pull/4815) ([Artem Zuikov](https://github.com/4ertus2))
* `clickhouse-copier` のセグメンテーションフォルトを修正。 [#4835](https://github.com/ClickHouse/ClickHouse/pull/4835) ([proller](https://github.com/proller))
* `system.tables` からの `SELECT` において、テーブルのリネームや変更が同時に行われた場合に発生するレースコンディションを修正しました。 [#4836](https://github.com/ClickHouse/ClickHouse/pull/4836) ([alexey-milovidov](https://github.com/alexey-milovidov))
* すでに不要になっている data part をフェッチする際のデータ競合を修正しました。 [#4839](https://github.com/ClickHouse/ClickHouse/pull/4839) ([alexey-milovidov](https://github.com/alexey-milovidov))
* MergeTree ファミリーのテーブルに対する `RENAME` 実行中にまれに発生するデータレースを修正しました。 [#4844](https://github.com/ClickHouse/ClickHouse/pull/4844) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 関数 `arrayIntersect` で発生していたセグメンテーションフォルトを修正しました。定数引数と通常の引数が混在した状態で関数が呼び出された場合に、セグメンテーションフォルトが発生することがありました。 [#4847](https://github.com/ClickHouse/ClickHouse/pull/4847) ([Lixiang Qian](https://github.com/fancyqlx))
* 列に空配列が長く連続して含まれているというまれなケースで、`Array(LowCardinality)` 列からの読み取りを修正しました。 [#4850](https://github.com/ClickHouse/ClickHouse/pull/4850) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* `NULL` を許容する列と許容しない列を結合する `FULL/RIGHT JOIN` で発生していたクラッシュを修正。 [#4855](https://github.com/ClickHouse/ClickHouse/pull/4855) ([Artem Zuikov](https://github.com/4ertus2))
* レプリカ間でパーツをフェッチする際に発生する `No message received` 例外を修正しました。 [#4856](https://github.com/ClickHouse/ClickHouse/pull/4856) ([alesapin](https://github.com/alesapin))
* 単一の配列内に同じ値が複数回出現する場合に、`arrayIntersect` 関数が誤った結果を返す不具合を修正。 [#4871](https://github.com/ClickHouse/ClickHouse/pull/4871) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 同時に実行された `ALTER COLUMN` クエリでサーバークラッシュを引き起こす可能性があったレースコンディションを修正しました（issue [#3421](https://github.com/ClickHouse/ClickHouse/issues/3421) を修正）。[#4592](https://github.com/ClickHouse/ClickHouse/pull/4592)（[Alex Zatelepin](https://github.com/ztlpn)）
* `const` 列を含む `FULL/RIGHT JOIN` で生じる誤った結果を修正。 [#4723](https://github.com/ClickHouse/ClickHouse/pull/4723) ([Artem Zuikov](https://github.com/4ertus2))
* アスタリスクを伴う `GLOBAL JOIN` における重複を修正。 [#4705](https://github.com/ClickHouse/ClickHouse/pull/4705) ([Artem Zuikov](https://github.com/4ertus2))
* カラム型が指定されていない場合の、カラム `CODEC` に対する `ALTER MODIFY` でのパラメータ推論を修正。 [#4883](https://github.com/ClickHouse/ClickHouse/pull/4883) ([alesapin](https://github.com/alesapin))
* `URL` にフラグメントがありクエリが存在しない場合でも、`cutQueryStringAndFragment()` と `queryStringAndFragment()` 関数が正しく動作するようになりました。 [#4894](https://github.com/ClickHouse/ClickHouse/pull/4894) ([Vitaly Baranov](https://github.com/vitlibar))
* `min_bytes_to_use_direct_io` を 0 より大きい値に設定した場合に、スレッドがカラムファイル内で後方にシークしなければならないときに発生する、まれなバグを修正。 [#4897](https://github.com/ClickHouse/ClickHouse/pull/4897) ([alesapin](https://github.com/alesapin))
* 集約関数の `LowCardinality` 引数に対する不正な引数型を修正（issue [#4919](https://github.com/ClickHouse/ClickHouse/issues/4919) を修正）。[#4922](https://github.com/ClickHouse/ClickHouse/pull/4922)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）
* `GLOBAL JOIN` における誤った名前の修飾を修正。 [#4969](https://github.com/ClickHouse/ClickHouse/pull/4969) ([Artem Zuikov](https://github.com/4ertus2))
* 1970 年における `toISOWeek` 関数の結果を修正。[#4988](https://github.com/ClickHouse/ClickHouse/pull/4988) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `ReplicatedMergeTree*` テーブルファミリーに対して `ON CLUSTER` で実行した際に発生する `DROP`、`TRUNCATE`、`OPTIMIZE` クエリの重複を修正。 [#4991](https://github.com/ClickHouse/ClickHouse/pull/4991) ([alesapin](https://github.com/alesapin))

#### 後方互換性のない変更 {#backward-incompatible-change-8}

- 設定 `insert_sample_with_metadata` を `input_format_defaults_for_omitted_fields` に名称変更しました。[#4771](https://github.com/ClickHouse/ClickHouse/pull/4771) ([Artem Zuikov](https://github.com/4ertus2))
- 設定 `max_partitions_per_insert_block` を追加しました(デフォルト値は100)。挿入ブロックに含まれるパーティション数がこの値を超える場合、例外がスローされます。制限を解除する場合は0に設定してください(非推奨)。[#4845](https://github.com/ClickHouse/ClickHouse/pull/4845) ([alexey-milovidov](https://github.com/alexey-milovidov))
- マルチ検索関数の名称を変更しました(`multiPosition` を `multiSearchAllPositions` に、`multiSearch` を `multiSearchAny` に、`firstMatch` を `multiSearchFirstIndex` に)。[#4780](https://github.com/ClickHouse/ClickHouse/pull/4780) ([Danila Kutenin](https://github.com/danlark1))

#### パフォーマンス改善 {#performance-improvement-6}

- Volnitsky検索アルゴリズムをインライン化により最適化し、多数の検索パターンまたは類似したバイグラムを含むクエリで約5-10%の検索性能向上を実現しました。[#4862](https://github.com/ClickHouse/ClickHouse/pull/4862) ([Danila Kutenin](https://github.com/danlark1))
- 設定 `use_uncompressed_cache` がゼロより大きい場合に、読み取るデータがすべてキャッシュに含まれているときに発生していたパフォーマンス問題を修正しました。[#4913](https://github.com/ClickHouse/ClickHouse/pull/4913) ([alesapin](https://github.com/alesapin))

#### ビルド/テスト/パッケージング改善 {#buildtestingpackaging-improvement-10}


- デバッグビルドの堅牢化: より細かいメモリマッピングと ASLR を導入し、mark cache と index にメモリ保護を追加しました。これにより、ASan や MSan では検出できない場合でも、より多くのメモリ破壊バグを検出できるようになります。 [#4632](https://github.com/ClickHouse/ClickHouse/pull/4632) ([alexey-milovidov](https://github.com/alexey-milovidov))
- cmake 変数 `ENABLE_PROTOBUF`、`ENABLE_PARQUET`、`ENABLE_BROTLI` のサポートを追加し、これらの機能を有効化/無効化できるようにしました（librdkafka、mysql などと同様）。 [#4669](https://github.com/ClickHouse/ClickHouse/pull/4669) ([Silviu Caragea](https://github.com/silviucpp))
- テスト実行後に一部のクエリがハングした場合、すべてのスレッドのプロセスリストおよびスタックトレースを出力できるようにしました。 [#4675](https://github.com/ClickHouse/ClickHouse/pull/4675) ([alesapin](https://github.com/alesapin))
- `clickhouse-test` で `Connection loss` エラー発生時にリトライするようにしました。 [#4682](https://github.com/ClickHouse/ClickHouse/pull/4682) ([alesapin](https://github.com/alesapin))
- packager スクリプトに、vagrant を用いた FreeBSD ビルドと Thread Sanitizer 付きビルドを追加しました。 [#4712](https://github.com/ClickHouse/ClickHouse/pull/4712) [#4748](https://github.com/ClickHouse/ClickHouse/pull/4748) ([alesapin](https://github.com/alesapin))
- インストール時に、ユーザー `'default'` のパスワードを尋ねるようになりました。 [#4725](https://github.com/ClickHouse/ClickHouse/pull/4725) ([proller](https://github.com/proller))
- `rdkafka` ライブラリ内の警告を抑制しました。 [#4740](https://github.com/ClickHouse/ClickHouse/pull/4740) ([alexey-milovidov](https://github.com/alexey-milovidov))
- SSL なしでビルドできるようにしました。 [#4750](https://github.com/ClickHouse/ClickHouse/pull/4750) ([proller](https://github.com/proller))
- 任意のユーザーで clickhouse-server イメージを起動できる仕組みを追加しました。 [#4753](https://github.com/ClickHouse/ClickHouse/pull/4753) ([Mikhail f. Shiryaev](https://github.com/Felixoid))
- contrib の boost を 1.69 にアップグレードしました。 [#4793](https://github.com/ClickHouse/ClickHouse/pull/4793) ([proller](https://github.com/proller))
- Thread Sanitizer 付きでコンパイルされた場合、`mremap` の使用を無効化しました。意外なことに、TSan は `mremap` をフックせず（`mmap`、`munmap` はフックします）、その結果として誤検知が発生していました。stateful テストでの TSan レポートを修正しました。 [#4859](https://github.com/ClickHouse/ClickHouse/pull/4859) ([alexey-milovidov](https://github.com/alexey-milovidov))
- HTTP インターフェイス経由で format schema を使用するテストを追加しました。 [#4864](https://github.com/ClickHouse/ClickHouse/pull/4864) ([Vitaly Baranov](https://github.com/vitlibar))



## ClickHouse リリース 19.4 {#clickhouse-release-19-4}

### ClickHouse リリース 19.4.4.33, 2019-04-17 {#clickhouse-release-19-4-4-33-2019-04-17}

#### バグ修正 {#bug-fixes-7}


* メモリアロケーション失敗時に `std::terminate` を呼び出さないようにしました。これにより、想定どおり `std::bad_alloc` 例外がスローされるようになりました。 [#4665](https://github.com/ClickHouse/ClickHouse/pull/4665) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `capnproto` がバッファーから読み込む処理を修正しました。HTTP 経由でファイルが正常に読み込まれないことがある問題を修正しました。 [#4674](https://github.com/ClickHouse/ClickHouse/pull/4674) ([Vladislav](https://github.com/smirnov-vs))
* `OPTIMIZE TABLE FINAL` クエリ実行後に発生するエラー `Unknown log entry type: 0` を修正。 [#4683](https://github.com/ClickHouse/ClickHouse/pull/4683) ([Amos Bird](https://github.com/amosbird))
* `hasAny` または `hasAll` 関数に誤った引数を渡すと、セグメンテーションフォルトが発生する可能性があります。 [#4698](https://github.com/ClickHouse/ClickHouse/pull/4698) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `DROP DATABASE dictionary` クエリの実行中にデッドロックが発生することがあります。 [#4701](https://github.com/ClickHouse/ClickHouse/pull/4701) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `median` 関数および `quantile` 関数の未定義動作を修正。 [#4702](https://github.com/ClickHouse/ClickHouse/pull/4702) ([hcz](https://github.com/hczhcz))
* `network_compression_method` が小文字の場合の圧縮レベル検出を修正。v19.1 で壊れていた問題。[#4706](https://github.com/ClickHouse/ClickHouse/pull/4706) ([proller](https://github.com/proller))
* `<timezone>UTC</timezone>` 設定が無視される問題を修正しました（issue [#4658](https://github.com/ClickHouse/ClickHouse/issues/4658) を修正）。 [#4718](https://github.com/ClickHouse/ClickHouse/pull/4718) ([proller](https://github.com/proller))
* `Distributed` テーブルでの `histogram` 関数の挙動を修正。 [#4741](https://github.com/ClickHouse/ClickHouse/pull/4741) ([olegkv](https://github.com/olegkv))
* ロックされた mutex の破棄（`destroy of a locked mutex`）に関する tsan レポートを修正しました。 [#4742](https://github.com/ClickHouse/ClickHouse/pull/4742) ([alexey-milovidov](https://github.com/alexey-milovidov))
* システムログの使用における競合状態が原因で、シャットダウン時に発生していた TSan レポートを修正しました。`part_log` が有効な場合にシャットダウン時に発生しうる use-after-free の不具合を修正しました。 [#4758](https://github.com/ClickHouse/ClickHouse/pull/4758) ([alexey-milovidov](https://github.com/alexey-milovidov))
* エラー発生時の `ReplicatedMergeTreeAlterThread` におけるパーツ再チェック処理を修正。 [#4772](https://github.com/ClickHouse/ClickHouse/pull/4772) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 中間的な集約関数状態に対する算術演算が、（サブクエリの結果などの）定数引数に対しては動作していませんでした。 [#4776](https://github.com/ClickHouse/ClickHouse/pull/4776) ([alexey-milovidov](https://github.com/alexey-milovidov))
* メタデータ内では列名は必ずバッククォートで囲んでください。そうしないと、`index` という名前の列を持つテーブルを作成できません（メタデータ内の `ATTACH` クエリが不正な形式となり、サーバーが再起動しません）。 [#4782](https://github.com/ClickHouse/ClickHouse/pull/4782) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `Distributed` テーブルに対する `ALTER ... MODIFY ORDER BY` 実行時に発生していたクラッシュを修正。 [#4790](https://github.com/ClickHouse/ClickHouse/pull/4790) ([TCeason](https://github.com/TCeason))
* `enable_optimize_predicate_expression` が有効な場合の `JOIN ON` で発生するセグメンテーションフォルトを修正。 [#4794](https://github.com/ClickHouse/ClickHouse/pull/4794) ([Winter Zhang](https://github.com/zhang2014))
* Kafka から protobuf メッセージを取り込んだ後に余分な行が追加されるバグを修正。 [#4808](https://github.com/ClickHouse/ClickHouse/pull/4808) ([Vitaly Baranov](https://github.com/vitlibar))
* `clickhouse-copier` のセグメンテーションフォルトを修正。 [#4835](https://github.com/ClickHouse/ClickHouse/pull/4835) ([proller](https://github.com/proller))
* テーブルが同時にリネームまたは変更される場合に、`system.tables` からの `SELECT` で発生する競合状態を修正しました。 [#4836](https://github.com/ClickHouse/ClickHouse/pull/4836) ([alexey-milovidov](https://github.com/alexey-milovidov))
* すでに不用となっているデータパートをフェッチする際に発生していたデータ競合を修正しました。 [#4839](https://github.com/ClickHouse/ClickHouse/pull/4839) ([alexey-milovidov](https://github.com/alexey-milovidov))
* MergeTree ファミリーのテーブルに対する `RENAME` 実行中に、まれに発生しうるデータレースを修正しました。 [#4844](https://github.com/ClickHouse/ClickHouse/pull/4844) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 関数 `arrayIntersect` で発生していたセグメンテーションフォルトを修正しました。定数引数と通常の引数が混在した状態で関数が呼び出された場合に、セグメンテーションフォルトが発生する可能性がありました。 [#4847](https://github.com/ClickHouse/ClickHouse/pull/4847) ([Lixiang Qian](https://github.com/fancyqlx))
* 列に空配列が長く連続して含まれているというまれなケースで、`Array(LowCardinality)` 列からの読み取りを修正しました。 [#4850](https://github.com/ClickHouse/ClickHouse/pull/4850) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* レプリカ間でパーツをフェッチする際に発生する `No message received` 例外を修正。 [#4856](https://github.com/ClickHouse/ClickHouse/pull/4856) ([alesapin](https://github.com/alesapin))
* 単一の配列内に同じ値が複数回出現する場合に `arrayIntersect` 関数が誤った結果を返す問題を修正。 [#4871](https://github.com/ClickHouse/ClickHouse/pull/4871) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 同時に実行される `ALTER COLUMN` クエリ間で発生する競合状態を修正しました。これによりサーバーがクラッシュする可能性がありました（issue [#3421](https://github.com/ClickHouse/ClickHouse/issues/3421) を修正）。 [#4592](https://github.com/ClickHouse/ClickHouse/pull/4592) ([Alex Zatelepin](https://github.com/ztlpn))
* カラム型が指定されていない場合の、カラム `CODEC` に対する `ALTER MODIFY` におけるパラメータ推論を修正しました。 [#4883](https://github.com/ClickHouse/ClickHouse/pull/4883) ([alesapin](https://github.com/alesapin))
* `URL` にフラグメントが含まれ、クエリが含まれない場合に、`cutQueryStringAndFragment()` と `queryStringAndFragment()` 関数が正しく動作するようになりました。 [#4894](https://github.com/ClickHouse/ClickHouse/pull/4894) ([Vitaly Baranov](https://github.com/vitlibar))
* `min_bytes_to_use_direct_io` がゼロより大きい値に設定されていて、スレッドがカラムファイル内で後方へのシークを行わなければならない場合に発生する、まれなバグを修正しました。 [#4897](https://github.com/ClickHouse/ClickHouse/pull/4897) ([alesapin](https://github.com/alesapin))
* `LowCardinality` 引数を持つ集約関数に対する誤った引数型を修正しました（issue [#4919](https://github.com/ClickHouse/ClickHouse/issues/4919) の修正）。 [#4922](https://github.com/ClickHouse/ClickHouse/pull/4922) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 1970 年に対する関数 `toISOWeek` の結果を修正。[#4988](https://github.com/ClickHouse/ClickHouse/pull/4988)（[alexey-milovidov](https://github.com/alexey-milovidov)）
* `ReplicatedMergeTree*` テーブルファミリーに対して `ON CLUSTER` 付きで実行した際に発生していた `DROP`、`TRUNCATE`、`OPTIMIZE` クエリの重複実行を修正。 [#4991](https://github.com/ClickHouse/ClickHouse/pull/4991) ([alesapin](https://github.com/alesapin))

#### 改善 {#improvements-2}

- 通常のカラム、`DEFAULT`、`MATERIALIZED`、`ALIAS` カラムを単一のリストに保持するようにしました（issue [#2867](https://github.com/ClickHouse/ClickHouse/issues/2867) を修正）。[#4707](https://github.com/ClickHouse/ClickHouse/pull/4707) ([Alex Zatelepin](https://github.com/ztlpn))

### ClickHouse Release 19.4.3.11, 2019-04-02 {#clickhouse-release-19-4-3-11-2019-04-02}

#### バグ修正 {#bug-fixes-8}

- nullable と non-nullable を結合する際の `FULL/RIGHT JOIN` でのクラッシュを修正しました。[#4855](https://github.com/ClickHouse/ClickHouse/pull/4855) ([Artem Zuikov](https://github.com/4ertus2))
- `clickhouse-copier` でのセグメンテーション違反を修正しました。[#4835](https://github.com/ClickHouse/ClickHouse/pull/4835) ([proller](https://github.com/proller))

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-11}

- カスタムユーザーから clickhouse-server イメージを起動する方法を追加しました。[#4753](https://github.com/ClickHouse/ClickHouse/pull/4753) ([Mikhail f. Shiryaev](https://github.com/Felixoid))

### ClickHouse Release 19.4.2.7, 2019-03-30 {#clickhouse-release-19-4-2-7-2019-03-30}

#### バグ修正 {#bug-fixes-9}

- カラムに長い空配列のシーケンスが含まれている稀なケースにおいて、`Array(LowCardinality)` カラムからの読み取りを修正しました。[#4850](https://github.com/ClickHouse/ClickHouse/pull/4850) ([Nikolai Kochetov](https://github.com/KochetovNicolai))

### ClickHouse Release 19.4.1.3, 2019-03-19 {#clickhouse-release-19-4-1-3-2019-03-19}

#### バグ修正 {#bug-fixes-10}

- `LIMIT BY` と `LIMIT` の両方を含むリモートクエリを修正しました。以前は、リモートクエリで `LIMIT BY` と `LIMIT` が使用された場合、`LIMIT` が `LIMIT BY` の前に実行される可能性があり、結果が過度にフィルタリングされていました。[#4708](https://github.com/ClickHouse/ClickHouse/pull/4708) ([Constantin S. Pan](https://github.com/kvap))

### ClickHouse Release 19.4.0.49, 2019-03-09 {#clickhouse-release-19-4-0-49-2019-03-09}

#### 新機能 {#new-features-5}


- `Protobuf`フォーマットの完全サポートを追加（入力と出力、ネストされたデータ構造）。[#4174](https://github.com/ClickHouse/ClickHouse/pull/4174) [#4493](https://github.com/ClickHouse/ClickHouse/pull/4493) ([Vitaly Baranov](https://github.com/vitlibar))
- Roaring Bitmapsを使用したビットマップ関数を追加。[#4207](https://github.com/ClickHouse/ClickHouse/pull/4207) ([Andy Yang](https://github.com/andyyzh)) [#4568](https://github.com/ClickHouse/ClickHouse/pull/4568) ([Vitaly Baranov](https://github.com/vitlibar))
- Parquetフォーマットのサポート。[#4448](https://github.com/ClickHouse/ClickHouse/pull/4448) ([proller](https://github.com/proller))
- あいまい文字列比較のためのN-gram距離を追加。R言語のq-gramメトリクスに類似しています。[#4466](https://github.com/ClickHouse/ClickHouse/pull/4466) ([Danila Kutenin](https://github.com/danlark1))
- 専用の集約パターンと保持パターンからGraphiteロールアップのルールを統合。[#4426](https://github.com/ClickHouse/ClickHouse/pull/4426) ([Mikhail f. Shiryaev](https://github.com/Felixoid))
- リソース使用量を制限するために`max_execution_speed`と`max_execution_speed_bytes`を追加。`min_execution_speed`を補完する`min_execution_speed_bytes`設定を追加。[#4430](https://github.com/ClickHouse/ClickHouse/pull/4430) ([Winter Zhang](https://github.com/zhang2014))
- `flatten`関数を実装。[#4555](https://github.com/ClickHouse/ClickHouse/pull/4555) [#4409](https://github.com/ClickHouse/ClickHouse/pull/4409) ([alexey-milovidov](https://github.com/alexey-milovidov), [kzon](https://github.com/kzon))
- `arrayEnumerateDenseRanked`と`arrayEnumerateUniqRanked`関数を追加（`arrayEnumerateUniq`に似ていますが、多次元配列内部を調べるための配列深度の微調整が可能）。[#4475](https://github.com/ClickHouse/ClickHouse/pull/4475) ([proller](https://github.com/proller)) [#4601](https://github.com/ClickHouse/ClickHouse/pull/4601) ([alexey-milovidov](https://github.com/alexey-milovidov))
- いくつかの制限付きで複数のJOINをサポート：アスタリスク不可、ON/WHERE/GROUP BY/…での複雑なエイリアス不可。[#4462](https://github.com/ClickHouse/ClickHouse/pull/4462) ([Artem Zuikov](https://github.com/4ertus2))

#### バグ修正 {#bug-fixes-11}


* このリリースには、19.3 および 19.1 のすべてのバグ修正も含まれます。
* データスキッピングインデックスのバグを修正: `INSERT` 後のグラニュールの順序が正しくありませんでした。 [#4407](https://github.com/ClickHouse/ClickHouse/pull/4407) ([Nikita Vasilev](https://github.com/nikvas0))
* `Nullable` および `LowCardinality` カラムに対する `set` インデックスの問題を修正しました。以前は、`Nullable` または `LowCardinality` カラムに対して `set` インデックスを使用すると、SELECT 時に `Data type must be deserialized with multiple streams` というエラーが発生していました。 [#4594](https://github.com/ClickHouse/ClickHouse/pull/4594) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* `executable` 辞書のフル更新時に `update_time` が正しく設定されるよう修正しました。 [#4551](https://github.com/ClickHouse/ClickHouse/pull/4551) ([Tema Novikov](https://github.com/temoon))
* 19.3 で壊れていたプログレスバーを修正。 [#4627](https://github.com/ClickHouse/ClickHouse/pull/4627) ([filimonov](https://github.com/filimonov))
* 一部のケースでメモリ領域が縮小された際に、`MemoryTracker` の値が不整合になる問題を修正しました。 [#4619](https://github.com/ClickHouse/ClickHouse/pull/4619) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ThreadPool の未定義動作を修正しました。 [#4612](https://github.com/ClickHouse/ClickHouse/pull/4612) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `SELECT` と同時に `MergeTree` テーブルが削除された場合に発生する可能性があった、`mutex lock failed: Invalid argument` というメッセージを伴う非常にまれなクラッシュを修正しました。 [#4608](https://github.com/ClickHouse/ClickHouse/pull/4608) ([Alex Zatelepin](https://github.com/ztlpn))
* `LowCardinality` データ型に対する ODBC ドライバーの互換性。 [#4381](https://github.com/ClickHouse/ClickHouse/pull/4381) ([proller](https://github.com/proller))
* FreeBSD: `AIOcontextPool: Found io_event with unknown id 0` エラーの修正。 [#4438](https://github.com/ClickHouse/ClickHouse/pull/4438) ([urgordeadbeef](https://github.com/urgordeadbeef))
* `system.part_log` テーブルが設定に関係なく作成されていました。 [#4483](https://github.com/ClickHouse/ClickHouse/pull/4483) ([alexey-milovidov](https://github.com/alexey-milovidov))
* キャッシュディクショナリ向けの `dictIsIn` 関数における未定義動作を修正。 [#4515](https://github.com/ClickHouse/ClickHouse/pull/4515) ([alesapin](https://github.com/alesapin))
* 同時実行中の DDL クエリが存在する状況で、`SELECT` クエリが同じテーブルを複数回ロックする場合（例: 異なるスレッドからの実行や複数のサブクエリの実行）に発生していたデッドロックを修正しました。 [#4535](https://github.com/ClickHouse/ClickHouse/pull/4535) ([Alex Zatelepin](https://github.com/ztlpn))
* 独自の `llvm` contrib を用意し、`clang` と `asan` でテストできるようになるまで、デフォルトで compile&#95;expressions を無効化します。 [#4579](https://github.com/ClickHouse/ClickHouse/pull/4579) ([alesapin](https://github.com/alesapin))
* `clickhouse` 外部辞書ソースに対する `invalidate_query` が誤った結果セット（空、複数行、または複数列）を返した場合に `std::terminate` が発生しないようにしました。`lifetime` に関係なく `invalidate_query` が 5 秒ごとに実行されていた問題を修正しました。 [#4583](https://github.com/ClickHouse/ClickHouse/pull/4583) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `clickhouse` ソースを持つ辞書の `invalidate_query` に `system.dictionaries` テーブルまたは `Dictionaries` データベースが関わる場合（まれなケース）に発生していたデッドロックを回避しました。 [#4599](https://github.com/ClickHouse/ClickHouse/pull/4599) ([alexey-milovidov](https://github.com/alexey-milovidov))
* WHERE 句が空の CROSS JOIN に関する修正。 [#4598](https://github.com/ClickHouse/ClickHouse/pull/4598) ([Artem Zuikov](https://github.com/4ertus2))
* 定数引数が渡された際に関数 &quot;replicate&quot; で発生していたセグメンテーションフォールトを修正しました。 [#4603](https://github.com/ClickHouse/ClickHouse/pull/4603) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 述語オプティマイザを用いた `lambda` 関数の最適化処理を修正。 [#4408](https://github.com/ClickHouse/ClickHouse/pull/4408) ([Winter Zhang](https://github.com/zhang2014))
* 複数の JOIN に関する複数の修正。 [#4595](https://github.com/ClickHouse/ClickHouse/pull/4595) ([Artem Zuikov](https://github.com/4ertus2))

#### 改善 {#improvements-3}

- JOIN ON句で右テーブルのカラムに対するエイリアスをサポート。[#4412](https://github.com/ClickHouse/ClickHouse/pull/4412) ([Artem Zuikov](https://github.com/4ertus2))
- 複数のJOINの結果をサブセレクトで使用する際に正しい結果名が必要となる問題に対応。結果内のフラットエイリアスをソース名に置換。[#4474](https://github.com/ClickHouse/ClickHouse/pull/4474) ([Artem Zuikov](https://github.com/4ertus2))
- 結合ステートメントのプッシュダウンロジックを改善。[#4387](https://github.com/ClickHouse/ClickHouse/pull/4387) ([Ivan](https://github.com/abyss7))

#### パフォーマンス改善 {#performance-improvements-3}

- 「PREWHEREへの移動」最適化のヒューリスティックを改善。[#4405](https://github.com/ClickHouse/ClickHouse/pull/4405) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 8ビットおよび16ビットキーに対してHashTableのAPIを使用する適切なルックアップテーブルを使用。[#4536](https://github.com/ClickHouse/ClickHouse/pull/4536) ([Amos Bird](https://github.com/amosbird))
- 文字列比較のパフォーマンスを改善。[#4564](https://github.com/ClickHouse/ClickHouse/pull/4564) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 分散DDLタスクを処理するメインループの速度低下を防ぐため、分散DDLキューのクリーンアップを別スレッドで実行。[#4502](https://github.com/ClickHouse/ClickHouse/pull/4502) ([Alex Zatelepin](https://github.com/ztlpn))
- `min_bytes_to_use_direct_io`を1に設定した場合、読み取るデータサイズが圧縮ブロック1つ分だけ過小評価されることがあったため、すべてのファイルがO_DIRECTモードで開かれていなかった問題を修正。[#4526](https://github.com/ClickHouse/ClickHouse/pull/4526) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### ビルド/テスト/パッケージング改善 {#buildtestingpackaging-improvement-12}


- clang-9 のサポートを追加。[#4604](https://github.com/ClickHouse/ClickHouse/pull/4604) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 誤った `__asm__` 命令を修正（再度）。[#4621](https://github.com/ClickHouse/ClickHouse/pull/4621) ([Konstantin Podshumok](https://github.com/podshumok))
- コマンドラインから `clickhouse-performance-test` の設定を指定できるようにした。[#4437](https://github.com/ClickHouse/ClickHouse/pull/4437) ([alesapin](https://github.com/alesapin))
- 統合テストにディクショナリ用のテストを追加。[#4477](https://github.com/ClickHouse/ClickHouse/pull/4477) ([alesapin](https://github.com/alesapin))
- Web サイト上のベンチマークのクエリを自動パフォーマンステストに追加。[#4496](https://github.com/ClickHouse/ClickHouse/pull/4496) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `xxhash.h` は実装の詳細であり、そのシンボルは `XXH_NAMESPACE` マクロで名前空間化されているため、外部 lz4 には存在しません。lz4 を外部利用する場合、xxHash も外部にし、依存する側がそれにリンクする必要があります。[#4495](https://github.com/ClickHouse/ClickHouse/pull/4495) ([Orivej Desh](https://github.com/orivej))
- `quantileTiming` 集約関数が負の値または浮動小数点の引数で呼び出される場合の不具合を修正（undefined behaviour sanitizer を用いたファジングテストの問題を修正）。[#4506](https://github.com/ClickHouse/ClickHouse/pull/4506) ([alexey-milovidov](https://github.com/alexey-milovidov))
- スペルミスを修正。[#4531](https://github.com/ClickHouse/ClickHouse/pull/4531) ([sdk2](https://github.com/sdk2))
- Mac でのコンパイルエラーを修正。[#4371](https://github.com/ClickHouse/ClickHouse/pull/4371) ([Vitaly Baranov](https://github.com/vitlibar))
- FreeBSD および各種特殊なビルド構成向けのビルド修正。[#4444](https://github.com/ClickHouse/ClickHouse/pull/4444) ([proller](https://github.com/proller))



## ClickHouse リリース 19.3 {#clickhouse-release-19-3}

### ClickHouse リリース 19.3.9.1, 2019-04-02 {#clickhouse-release-19-3-9-1-2019-04-02}

#### バグ修正 {#bug-fixes-12}

- nullable と not nullable の結合時における `FULL/RIGHT JOIN` のクラッシュを修正しました。[#4855](https://github.com/ClickHouse/ClickHouse/pull/4855) ([Artem Zuikov](https://github.com/4ertus2))
- `clickhouse-copier` におけるセグメンテーション違反を修正しました。[#4835](https://github.com/ClickHouse/ClickHouse/pull/4835) ([proller](https://github.com/proller))
- カラムに長い空配列のシーケンスが含まれる稀なケースにおける `Array(LowCardinality)` カラムからの読み取りを修正しました。[#4850](https://github.com/ClickHouse/ClickHouse/pull/4850) ([Nikolai Kochetov](https://github.com/KochetovNicolai))

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvement-13}

- カスタムユーザーから clickhouse-server イメージを起動する方法を追加しました [#4753](https://github.com/ClickHouse/ClickHouse/pull/4753) ([Mikhail f. Shiryaev](https://github.com/Felixoid))

### ClickHouse リリース 19.3.7, 2019-03-12 {#clickhouse-release-19-3-7-2019-03-12}

#### バグ修正 {#bug-fixes-13}

- #3920 のエラーを修正しました。このエラーはランダムなキャッシュ破損（`Unknown codec family code`、`Cannot seek through file` というメッセージ）およびセグメンテーション違反として現れます。このバグはバージョン 19.1 で初めて出現し、バージョン 19.1.10 および 19.3.6 まで存在していました。[#4623](https://github.com/ClickHouse/ClickHouse/pull/4623) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.3.6, 2019-03-02 {#clickhouse-release-19-3-6-2019-03-02}

#### バグ修正 {#bug-fixes-14}

- スレッドプールに 1000 を超えるスレッドが存在する場合、スレッド終了時に `std::terminate` が発生する可能性がありました。[Azat Khuzhin](https://github.com/azat) [#4485](https://github.com/ClickHouse/ClickHouse/pull/4485) [#4505](https://github.com/ClickHouse/ClickHouse/pull/4505) ([alexey-milovidov](https://github.com/alexey-milovidov))
- デフォルト値のないカラムにコメントを持つ `ReplicatedMergeTree*` テーブル、およびコメントとデフォルト値のないカラムコーデックを持つテーブルの作成が可能になりました。また、コーデックの比較も修正しました。[#4523](https://github.com/ClickHouse/ClickHouse/pull/4523) ([alesapin](https://github.com/alesapin))
- 配列またはタプルを使用した JOIN におけるクラッシュを修正しました。[#4552](https://github.com/ClickHouse/ClickHouse/pull/4552) ([Artem Zuikov](https://github.com/4ertus2))
- `ThreadStatus not created` というメッセージを伴う clickhouse-copier のクラッシュを修正しました。[#4540](https://github.com/ClickHouse/ClickHouse/pull/4540) ([Artem Zuikov](https://github.com/4ertus2))
- 分散 DDL が使用されている場合のサーバーシャットダウン時のハングアップを修正しました。[#4472](https://github.com/ClickHouse/ClickHouse/pull/4472) ([Alex Zatelepin](https://github.com/ztlpn))
- 10 より大きい番号を持つカラムのテキスト形式解析に関するエラーメッセージで、誤ったカラム番号が出力されていました。[#4484](https://github.com/ClickHouse/ClickHouse/pull/4484) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvements-3}


- AVXを有効にしたビルドを修正しました。[#4527](https://github.com/ClickHouse/ClickHouse/pull/4527) ([alexey-milovidov](https://github.com/alexey-milovidov))
- コンパイル時のカーネルではなく、既知の適切なバージョンに基づいて拡張アカウンティングとIOアカウンティングを有効化しました。[#4541](https://github.com/ClickHouse/ClickHouse/pull/4541) ([nvartolomei](https://github.com/nvartolomei))
- core_dump.size_limitの設定をスキップできるようにし、制限の設定に失敗した場合は例外をスローする代わりに警告を表示するようにしました。[#4473](https://github.com/ClickHouse/ClickHouse/pull/4473) ([proller](https://github.com/proller))
- `Field.cpp`内の`void readBinary(...)`の`inline`タグを削除しました。また、冗長な`namespace DB`ブロックをマージしました。[#4530](https://github.com/ClickHouse/ClickHouse/pull/4530) ([hcz](https://github.com/hczhcz))

### ClickHouse リリース 19.3.5, 2019-02-21 {#clickhouse-release-19-3-5-2019-02-21}

#### バグ修正 {#bug-fixes-15}

- 大規模なHTTP挿入クエリの処理に関するバグを修正しました。[#4454](https://github.com/ClickHouse/ClickHouse/pull/4454) ([alesapin](https://github.com/alesapin))
- `send_logs_level`設定の誤った実装による旧バージョンとの後方互換性の問題を修正しました。[#4445](https://github.com/ClickHouse/ClickHouse/pull/4445) ([alexey-milovidov](https://github.com/alexey-milovidov))
- カラムコメントの導入により発生したテーブル関数`remote`の後方互換性の問題を修正しました。[#4446](https://github.com/ClickHouse/ClickHouse/pull/4446) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.3.4, 2019-02-16 {#clickhouse-release-19-3-4-2019-02-16}

#### 改善 {#improvements-4}

- `ATTACH TABLE`クエリ実行時にテーブルインデックスサイズがメモリ制限に計上されないようにしました。これにより、デタッチ後にテーブルをアタッチできなくなる可能性を回避しました。[#4396](https://github.com/ClickHouse/ClickHouse/pull/4396) ([alexey-milovidov](https://github.com/alexey-milovidov))
- ZooKeeperから受信する最大文字列サイズと配列サイズの制限をわずかに引き上げました。これにより、ZooKeeper上で`CLIENT_JVMFLAGS=-Djute.maxbuffer=...`のサイズを増やした場合でも動作を継続できるようになります。[#4398](https://github.com/ClickHouse/ClickHouse/pull/4398) ([alexey-milovidov](https://github.com/alexey-milovidov))
- キューに大量のノードが存在する場合でも、放棄されたレプリカを修復できるようにしました。[#4399](https://github.com/ClickHouse/ClickHouse/pull/4399) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `SET`インデックスに必須引数(最大保存行数)を1つ追加しました。[#4386](https://github.com/ClickHouse/ClickHouse/pull/4386) ([Nikita Vasilev](https://github.com/nikvas0))

#### バグ修正 {#bug-fixes-16}

- 単一の`LowCardinality`キーによるグループ化における`WITH ROLLUP`の結果を修正しました。[#4384](https://github.com/ClickHouse/ClickHouse/pull/4384) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- セットインデックスのバグ(`max_rows`行を超える行を含むグラニュールが削除される問題)を修正しました。[#4386](https://github.com/ClickHouse/ClickHouse/pull/4386) ([Nikita Vasilev](https://github.com/nikvas0))
- FreeBSDビルドに関する多数の修正を行いました。[#4397](https://github.com/ClickHouse/ClickHouse/pull/4397) ([proller](https://github.com/proller))
- 同じエイリアスを含むサブクエリを持つクエリにおけるエイリアス置換を修正しました(issue [#4110](https://github.com/ClickHouse/ClickHouse/issues/4110))。[#4351](https://github.com/ClickHouse/ClickHouse/pull/4351) ([Artem Zuikov](https://github.com/4ertus2))


#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvements-4}

- Dockerイメージ内でステートレステスト用に`clickhouse-server`を実行できる機能を追加。[#4347](https://github.com/ClickHouse/ClickHouse/pull/4347) ([Vasily Nemkov](https://github.com/Enmk))

### ClickHouse リリース 19.3.3, 2019-02-13 {#clickhouse-release-19-3-3-2019-02-13}

#### 新機能 {#new-features-6}


- 何らかの理由で停止したミューテーションを削除できる `KILL MUTATION` ステートメントを追加しました。トラブルシューティングを容易にするため、`system.mutations` テーブルに `latest_failed_part`、`latest_fail_time`、`latest_fail_reason` フィールドを追加しました。[#4287](https://github.com/ClickHouse/ClickHouse/pull/4287) ([Alex Zatelepin](https://github.com/ztlpn))
- シャノンエントロピーを計算する集約関数 `entropy` を追加しました。[#4238](https://github.com/ClickHouse/ClickHouse/pull/4238) ([Quid37](https://github.com/Quid37))
- `INSERT INTO tbl VALUES (....` クエリを `query` と `data` パートに分割せずにサーバーに送信できる機能を追加しました。[#4301](https://github.com/ClickHouse/ClickHouse/pull/4301) ([alesapin](https://github.com/alesapin))
- `arrayWithConstant` 関数の汎用実装を追加しました。[#4322](https://github.com/ClickHouse/ClickHouse/pull/4322) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `NOT BETWEEN` 比較演算子を実装しました。[#4228](https://github.com/ClickHouse/ClickHouse/pull/4228) ([Dmitry Naumov](https://github.com/nezed))
- `sumMap` で値を合計するキーの数を制限できるように `sumMapFiltered` を実装しました。[#4129](https://github.com/ClickHouse/ClickHouse/pull/4129) ([Léo Ercolanelli](https://github.com/ercolanelli-leo))
- `mysql` テーブル関数で `Nullable` 型のサポートを追加しました。[#4198](https://github.com/ClickHouse/ClickHouse/pull/4198) ([Emmanuel Donin de Rosière](https://github.com/edonin))
- `LIMIT` 句での任意の定数式のサポートを追加しました。[#4246](https://github.com/ClickHouse/ClickHouse/pull/4246) ([k3box](https://github.com/k3box))
- 重み(符号なし整数)を追加引数として受け取る集約関数 `topKWeighted` を追加しました。[#4245](https://github.com/ClickHouse/ClickHouse/pull/4245) ([Andrew Golman](https://github.com/andrewgolman))
- `StorageJoin` が同じキーの既存値を上書きできる `join_any_take_last_row` 設定をサポートするようになりました。[#3973](https://github.com/ClickHouse/ClickHouse/pull/3973) ([Amos Bird](https://github.com/amosbird)
- 関数 `toStartOfInterval` を追加しました。[#4304](https://github.com/ClickHouse/ClickHouse/pull/4304) ([Vitaly Baranov](https://github.com/vitlibar))
- `RowBinaryWithNamesAndTypes` フォーマットを追加しました。[#4200](https://github.com/ClickHouse/ClickHouse/pull/4200) ([Oleg V. Kozlyuk](https://github.com/DarkWanderer))
- `IPv4` および `IPv6` データ型を追加しました。`IPv*` 関数のより効率的な実装を追加しました。[#3669](https://github.com/ClickHouse/ClickHouse/pull/3669) ([Vasily Nemkov](https://github.com/Enmk))
- 関数 `toStartOfTenMinutes()` を追加しました。[#4298](https://github.com/ClickHouse/ClickHouse/pull/4298) ([Vitaly Baranov](https://github.com/vitlibar))
- `Protobuf` 出力フォーマットを追加しました。[#4005](https://github.com/ClickHouse/ClickHouse/pull/4005) [#4158](https://github.com/ClickHouse/ClickHouse/pull/4158) ([Vitaly Baranov](https://github.com/vitlibar))
- データインポート(INSERT)用のHTTPインターフェースにbrotliサポートを追加しました。[#4235](https://github.com/ClickHouse/ClickHouse/pull/4235) ([Mikhail](https://github.com/fandyushin))
- コマンドラインクライアントで関数名や型の入力ミスがあった場合のヒント表示を追加しました。[#4239](https://github.com/ClickHouse/ClickHouse/pull/4239) ([Danila Kutenin](https://github.com/danlark1))
- サーバーのHTTPレスポンスヘッダーに `Query-Id` を追加しました。[#4231](https://github.com/ClickHouse/ClickHouse/pull/4231) ([Mikhail](https://github.com/fandyushin))

#### 実験的機能 {#experimental-features-2}


- MergeTreeテーブルエンジンファミリーに`minmax`および`set`データスキップインデックスを追加しました。[#4143](https://github.com/ClickHouse/ClickHouse/pull/4143) ([Nikita Vasilev](https://github.com/nikvas0))
- 可能な場合に`CROSS JOIN`を`INNER JOIN`に変換する機能を追加しました。[#4221](https://github.com/ClickHouse/ClickHouse/pull/4221) [#4266](https://github.com/ClickHouse/ClickHouse/pull/4266) ([Artem Zuikov](https://github.com/4ertus2))

#### バグ修正 {#bug-fixes-17}


* `JOIN ON` セクション内の重複カラムに対して発生していた `Not found column` エラーを修正しました。 [#4279](https://github.com/ClickHouse/ClickHouse/pull/4279) ([Artem Zuikov](https://github.com/4ertus2))
* `START REPLICATED SENDS` コマンドでレプリケート送信を開始できるようにしました。 [#4229](https://github.com/ClickHouse/ClickHouse/pull/4229) ([nvartolomei](https://github.com/nvartolomei))
* `Array(LowCardinality)` 引数を持つ集約関数の実行を修正しました。 [#4055](https://github.com/ClickHouse/ClickHouse/pull/4055) ([KochetovNicolai](https://github.com/KochetovNicolai))
* `INSERT ... SELECT ... FROM file(...)` クエリを実行した際に、ファイル形式が `CSVWithNames` または `TSVWIthNames` で、最初のデータ行が欠落している場合に発生していた誤った動作を修正しました。 [#4297](https://github.com/ClickHouse/ClickHouse/pull/4297) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 辞書が利用できない場合に、辞書のリロード時に発生していたクラッシュを修正しました。このバグは 19.1.6 で導入されました。 [#4188](https://github.com/ClickHouse/ClickHouse/pull/4188) ([proller](https://github.com/proller))
* 右テーブルに重複行がある場合の `ALL JOIN` の問題を修正。 [#4184](https://github.com/ClickHouse/ClickHouse/pull/4184) ([Artem Zuikov](https://github.com/4ertus2))
* `use_uncompressed_cache=1` 使用時に発生していたセグメンテーションフォルトと、誤った非圧縮サイズによる例外を修正しました。このバグは 19.1.6 で発生していました。 [#4186](https://github.com/ClickHouse/ClickHouse/pull/4186) ([alesapin](https://github.com/alesapin))
* `int16` を超える大きな日付の比較における `compile_expressions` のバグを修正しました。 [#4341](https://github.com/ClickHouse/ClickHouse/pull/4341) ([alesapin](https://github.com/alesapin))
* テーブル関数 `numbers(0)` からの `SELECT` で発生していた無限ループを修正しました。 [#4280](https://github.com/ClickHouse/ClickHouse/pull/4280) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `ORDER BY` に対する述語最適化を一時的に無効化。 [#3890](https://github.com/ClickHouse/ClickHouse/pull/3890) ([Winter Zhang](https://github.com/zhang2014))
* 古い CPU 上で base64 関数を使用した際に発生する `Illegal instruction` エラーを修正しました。このエラーは、ClickHouse を gcc-8 でコンパイルした場合にのみ再現していました。 [#4275](https://github.com/ClickHouse/ClickHouse/pull/4275) ([alexey-milovidov](https://github.com/alexey-milovidov))
* TLS 接続経由で PostgreSQL ODBC Driver と対話する際に発生していた `No message received` エラーを修正しました。MySQL ODBC Driver 使用時に発生していたセグメンテーションフォールトも併せて修正しました。[#4170](https://github.com/ClickHouse/ClickHouse/pull/4170) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 条件演算子（関数 `if`）の分岐で `Date` および `DateTime` の引数が使用された場合に誤った結果になる問題を修正しました。関数 `if` に汎用的なケースを追加しました。 [#4243](https://github.com/ClickHouse/ClickHouse/pull/4243) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ClickHouse の辞書が `clickhouse` プロセス内で読み込まれるようになりました。 [#4166](https://github.com/ClickHouse/ClickHouse/pull/4166) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `No such file or directory` エラー発生後に `File` エンジンのテーブルに対する `SELECT` を再試行した際に発生していたデッドロックを修正。 [#4161](https://github.com/ClickHouse/ClickHouse/pull/4161) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `system.tables` からの `SELECT` 時に `table does not exist` エラーが発生する場合があったレースコンディションを修正。 [#4313](https://github.com/ClickHouse/ClickHouse/pull/4313) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 対話モードで実行された場合、コマンドライン補完候補のデータを読み込む処理中に、終了時に `clickhouse-client` がセグメンテーションフォルトを起こすことがあります。 [#4317](https://github.com/ClickHouse/ClickHouse/pull/4317) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `IN` 演算子を含む mutation の実行で誤った結果が返される不具合を修正しました。 [#4099](https://github.com/ClickHouse/ClickHouse/pull/4099) ([Alex Zatelepin](https://github.com/ztlpn))
* エラーを修正: `Dictionary` エンジンを使用するデータベースがある場合、すべての辞書がサーバー起動時に強制的にロードされるため、localhost 上の ClickHouse をソースとする辞書があると、その辞書をロードできない問題を修正。 [#4255](https://github.com/ClickHouse/ClickHouse/pull/4255) ([alexey-milovidov](https://github.com/alexey-milovidov))
* サーバー終了時にシステムログを再作成しようとした際に発生していたエラーを修正。 [#4254](https://github.com/ClickHouse/ClickHouse/pull/4254) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `joinGet` 関数で正しい型を返し、ロックを適切に処理するようにしました。 [#4153](https://github.com/ClickHouse/ClickHouse/pull/4153) ([Amos Bird](https://github.com/amosbird))
* `sumMapWithOverflow` 関数を追加しました。 [#4151](https://github.com/ClickHouse/ClickHouse/pull/4151) ([Léo Ercolanelli](https://github.com/ercolanelli-leo))
* `allow_experimental_multiple_joins_emulation` に起因するセグメンテーションフォールトを修正しました。 [52de2c](https://github.com/ClickHouse/ClickHouse/commit/52de2cd927f7b5257dd67e175f0a5560a48840d0) ([Artem Zuikov](https://github.com/4ertus2))
* `Date` と `DateTime` の比較が正しく行われない不具合を修正。 [#4237](https://github.com/ClickHouse/ClickHouse/pull/4237) ([valexey](https://github.com/valexey))
* undefined behavior sanitizer 下でのファジーテストを修正しました。`quantile*Weighted` 系関数に対してパラメーター型チェックを追加しました。 [#4145](https://github.com/ClickHouse/ClickHouse/pull/4145) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 古いデータパーツの削除時にまれに発生し、`File not found` エラーで失敗する可能性があったレースコンディションを修正しました。 [#4378](https://github.com/ClickHouse/ClickHouse/pull/4378) ([alexey-milovidov](https://github.com/alexey-milovidov))
* /etc/clickhouse-server/config.xml が含まれていないインストールパッケージを修正。 [#4343](https://github.com/ClickHouse/ClickHouse/pull/4343) ([proller](https://github.com/proller))

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvements-5}

- Debianパッケージ: 設定に従って /etc/clickhouse-server/preprocessed リンクを修正。[#4205](https://github.com/ClickHouse/ClickHouse/pull/4205) ([proller](https://github.com/proller))
- FreeBSD向けの各種ビルド修正。[#4225](https://github.com/ClickHouse/ClickHouse/pull/4225) ([proller](https://github.com/proller))
- perftestでテーブルの作成、データ投入、削除を行う機能を追加。[#4220](https://github.com/ClickHouse/ClickHouse/pull/4220) ([alesapin](https://github.com/alesapin))
- 重複するインクルードをチェックするスクリプトを追加。[#4326](https://github.com/ClickHouse/ClickHouse/pull/4326) ([alexey-milovidov](https://github.com/alexey-milovidov))
- パフォーマンステストでインデックスによるクエリ実行機能を追加。[#4264](https://github.com/ClickHouse/ClickHouse/pull/4264) ([alesapin](https://github.com/alesapin))
- デバッグシンボル付きパッケージのインストールを推奨。[#4274](https://github.com/ClickHouse/ClickHouse/pull/4274) ([alexey-milovidov](https://github.com/alexey-milovidov))
- performance-testのリファクタリング。ログ記録とシグナル処理を改善。[#4171](https://github.com/ClickHouse/ClickHouse/pull/4171) ([alesapin](https://github.com/alesapin))
- 匿名化されたYandex.Metricaデータセットのドキュメントを追加。[#4164](https://github.com/ClickHouse/ClickHouse/pull/4164) ([alesapin](https://github.com/alesapin))
- 古い月単位パーティションパートをカスタムパーティション形式に変換するツールを追加。[#4195](https://github.com/ClickHouse/ClickHouse/pull/4195) ([Alex Zatelepin](https://github.com/ztlpn))
- S3内の2つのデータセットに関するドキュメントを追加。[#4144](https://github.com/ClickHouse/ClickHouse/pull/4144) ([alesapin](https://github.com/alesapin))
- プルリクエストの説明からchangelogを作成するスクリプトを追加。[#4169](https://github.com/ClickHouse/ClickHouse/pull/4169) [#4173](https://github.com/ClickHouse/ClickHouse/pull/4173) ([KochetovNicolai](https://github.com/KochetovNicolai)) ([KochetovNicolai](https://github.com/KochetovNicolai))
- ClickHouse用のPuppetモジュールを追加。[#4182](https://github.com/ClickHouse/ClickHouse/pull/4182) ([Maxim Fedotov](https://github.com/MaxFedotov))
- ドキュメント化されていない関数群のドキュメントを追加。[#4168](https://github.com/ClickHouse/ClickHouse/pull/4168) ([Winter Zhang](https://github.com/zhang2014))
- ARMビルドの修正。[#4210](https://github.com/ClickHouse/ClickHouse/pull/4210)[#4306](https://github.com/ClickHouse/ClickHouse/pull/4306) [#4291](https://github.com/ClickHouse/ClickHouse/pull/4291) ([proller](https://github.com/proller)) ([proller](https://github.com/proller))
- ディクショナリテストが`ctest`から実行可能に。[#4189](https://github.com/ClickHouse/ClickHouse/pull/4189) ([proller](https://github.com/proller))
- SSL証明書のデフォルトディレクトリとして`/etc/ssl`を使用するように変更。[#4167](https://github.com/ClickHouse/ClickHouse/pull/4167) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 起動時にSSEおよびAVX命令のチェックを追加。[#4234](https://github.com/ClickHouse/ClickHouse/pull/4234) ([Igr](https://github.com/igron99))
- 初期化スクリプトがサーバーの起動を待機するように変更。[#4281](https://github.com/ClickHouse/ClickHouse/pull/4281) ([proller](https://github.com/proller))

#### 後方互換性のない変更 {#backward-incompatible-changes-1}


- `allow_experimental_low_cardinality_type`設定を削除しました。`LowCardinality`データ型は本番環境で使用できます。[#4323](https://github.com/ClickHouse/ClickHouse/pull/4323) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 利用可能なメモリ量に応じて、マークキャッシュサイズと非圧縮キャッシュサイズを削減します。[#4240](https://github.com/ClickHouse/ClickHouse/pull/4240) ([Lopatin Konstantin](https://github.com/k-lopatin)
- `CREATE TABLE`クエリに`INDEX`キーワードを追加しました。`index`という名前のカラムは、バッククォートまたはダブルクォートで囲む必要があります: `` `index` ``。[#4143](https://github.com/ClickHouse/ClickHouse/pull/4143) ([Nikita Vasilev](https://github.com/nikvas0))
- `sumMap`はオーバーフローではなく結果型を昇格するようになりました。以前の`sumMap`の動作は`sumMapWithOverflow`関数を使用することで取得できます。[#4151](https://github.com/ClickHouse/ClickHouse/pull/4151) ([Léo Ercolanelli](https://github.com/ercolanelli-leo))

#### パフォーマンスの改善 {#performance-improvements-4}

- `LIMIT`のないクエリで`std::sort`を`pdqsort`に置き換えました。[#4236](https://github.com/ClickHouse/ClickHouse/pull/4236) ([Evgenii Pravda](https://github.com/kvinty))
- サーバーがグローバルスレッドプールからスレッドを再利用するようになりました。これは一部のコーナーケースでパフォーマンスに影響します。[#4150](https://github.com/ClickHouse/ClickHouse/pull/4150) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### 改善 {#improvements-5}


- FreeBSD 向けの AIO サポートを実装しました。 [#4305](https://github.com/ClickHouse/ClickHouse/pull/4305) ([urgordeadbeef](https://github.com/urgordeadbeef))
- `SELECT * FROM a JOIN b USING a, b` は、左側のテーブルの `a` および `b` 列のみを返すようになりました。 [#4141](https://github.com/ClickHouse/ClickHouse/pull/4141) ([Artem Zuikov](https://github.com/4ertus2))
- クライアントの `-C` オプションが `-c` オプションと同様に動作するようになりました。 [#4232](https://github.com/ClickHouse/ClickHouse/pull/4232) ([syominsergey](https://github.com/syominsergey))
- 値なしで使用された `--password` オプションは、標準入力からパスワードを読み取るようになりました。 [#4230](https://github.com/ClickHouse/ClickHouse/pull/4230) ([BSD_Conqueror](https://github.com/bsd-conqueror))
- `LIKE` 式または正規表現を含む文字列リテラル内の、エスケープされていないメタ文字のハイライトを追加しました。 [#4327](https://github.com/ClickHouse/ClickHouse/pull/4327) ([alexey-milovidov](https://github.com/alexey-milovidov))
- クライアントソケットが切断された場合に、HTTP の読み取り専用クエリをキャンセルするようにしました。 [#4213](https://github.com/ClickHouse/ClickHouse/pull/4213) ([nvartolomei](https://github.com/nvartolomei))
- サーバーが進捗状況を報告してクライアント接続を維持するようになりました。 [#4215](https://github.com/ClickHouse/ClickHouse/pull/4215) ([Ivan](https://github.com/abyss7))
- `optimize_throw_if_noop` 設定が有効な場合の OPTIMIZE クエリについて、その理由を示すメッセージをやや改善しました。 [#4294](https://github.com/ClickHouse/ClickHouse/pull/4294) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `clickhouse-server` に `--version` オプションのサポートを追加しました。 [#4251](https://github.com/ClickHouse/ClickHouse/pull/4251) ([Lopatin Konstantin](https://github.com/k-lopatin))
- `clickhouse-server` に `--help/-h` オプションを追加しました。 [#4233](https://github.com/ClickHouse/ClickHouse/pull/4233) ([Yuriy Baranov](https://github.com/yurriy))
- 集約関数の状態を結果とするスカラサブクエリのサポートを追加しました。 [#4348](https://github.com/ClickHouse/ClickHouse/pull/4348) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- サーバーのシャットダウン時間と ALTER の待機時間を短縮しました。 [#4372](https://github.com/ClickHouse/ClickHouse/pull/4372) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `replicated_can_become_leader` 設定に関する情報を system.replicas に追加し、レプリカがリーダーになろうとしない場合にログを出力するようにしました。 [#4379](https://github.com/ClickHouse/ClickHouse/pull/4379) ([Alex Zatelepin](https://github.com/ztlpn))



## ClickHouse リリース 19.1 {#clickhouse-release-19-1}

### ClickHouse リリース 19.1.14, 2019-03-14 {#clickhouse-release-19-1-14-2019-03-14}

- `asterisk_left_columns_only` 設定が 1 に設定されている場合に `GLOBAL JOIN` と `SELECT *` を使用すると発生する可能性があった `Column ... queried more than once` エラーを修正しました（稀なケース）。この問題は 19.3 以降には存在しません。[6bac7d8d](https://github.com/ClickHouse/ClickHouse/pull/4692/commits/6bac7d8d11a9b0d6de0b32b53c47eb2f6f8e7062) ([Artem Zuikov](https://github.com/4ertus2))

### ClickHouse リリース 19.1.13, 2019-03-12 {#clickhouse-release-19-1-13-2019-03-12}

このリリースには 19.3.7 と完全に同じパッチセットが含まれています。

### ClickHouse リリース 19.1.10, 2019-03-03 {#clickhouse-release-19-1-10-2019-03-03}

このリリースには 19.3.6 と完全に同じパッチセットが含まれています。


## ClickHouseリリース19.1 {#clickhouse-release-19-1-1}

### ClickHouseリリース19.1.9、2019-02-21 {#clickhouse-release-19-1-9-2019-02-21}

#### バグ修正 {#bug-fixes-18}

- `send_logs_level`設定の誤った実装による旧バージョンとの後方互換性の問題を修正しました。[#4445](https://github.com/ClickHouse/ClickHouse/pull/4445) ([alexey-milovidov](https://github.com/alexey-milovidov))
- カラムコメントの導入によるテーブル関数`remote`の後方互換性の問題を修正しました。[#4446](https://github.com/ClickHouse/ClickHouse/pull/4446) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouseリリース19.1.8、2019-02-16 {#clickhouse-release-19-1-8-2019-02-16}

#### バグ修正 {#bug-fixes-19}

- /etc/clickhouse-server/config.xmlが欠落しているインストールパッケージの問題を修正しました。[#4343](https://github.com/ClickHouse/ClickHouse/pull/4343) ([proller](https://github.com/proller))


## ClickHouse リリース 19.1 {#clickhouse-release-19-1-2}

### ClickHouse リリース 19.1.7, 2019-02-15 {#clickhouse-release-19-1-7-2019-02-15}

#### バグ修正 {#bug-fixes-20}


* `joinGet` 関数で正しい型を返し、ロックを適切に処理するように修正。 [#4153](https://github.com/ClickHouse/ClickHouse/pull/4153) ([Amos Bird](https://github.com/amosbird))
* サーバーのシャットダウン時に `system` ログを再作成しようとした際に発生していたエラーを修正しました。 [#4254](https://github.com/ClickHouse/ClickHouse/pull/4254) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 不具合の修正: `Dictionary` エンジンを使用するデータベースが存在する場合、すべてのディクショナリがサーバー起動時に強制的にロードされ、さらにその中に localhost 上の ClickHouse をソースとするディクショナリがあると、そのディクショナリをロードできない問題を修正しました。 [#4255](https://github.com/ClickHouse/ClickHouse/pull/4255) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `IN` 演算子を含むミューテーションの実行で誤った結果が返される不具合を修正しました。 [#4099](https://github.com/ClickHouse/ClickHouse/pull/4099) ([Alex Zatelepin](https://github.com/ztlpn))
* `clickhouse-client` は、インタラクティブモードで実行された場合、コマンドライン補完用のデータを読み込む際に、終了時にセグメンテーションフォルトを起こすことがあります。 [#4317](https://github.com/ClickHouse/ClickHouse/pull/4317) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `system.tables` からの `SELECT` 時に `table does not exist` エラーが発生することがあった競合状態を修正。 [#4313](https://github.com/ClickHouse/ClickHouse/pull/4313) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `No such file or directory` エラー発生後に、`File` エンジンを使用するテーブルに対する `SELECT` を再試行した際に起きていたデッドロックを修正。 [#4161](https://github.com/ClickHouse/ClickHouse/pull/4161) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ローカル ClickHouse ディクショナリが TCP 経由で読み込まれていましたが、本来はプロセス内で読み込まれるべきだった問題を修正しました。 [#4166](https://github.com/ClickHouse/ClickHouse/pull/4166) ([alexey-milovidov](https://github.com/alexey-milovidov))
* TLS 接続経由で PostgreSQL ODBC Driver とやり取りする際に発生していた `No message received` エラーを修正。また、MySQL ODBC Driver 使用時に発生していたセグメンテーションフォルトも修正。 [#4170](https://github.com/ClickHouse/ClickHouse/pull/4170) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `ORDER BY` に対する述語最適化を一時的に無効化。 [#3890](https://github.com/ClickHouse/ClickHouse/pull/3890) ([Winter Zhang](https://github.com/zhang2014))
* テーブル関数 `numbers(0)` に対する `SELECT` で発生していた無限ループを修正しました。 [#4280](https://github.com/ClickHouse/ClickHouse/pull/4280) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `int16` を超える大きな日付の比較時に発生していた `compile_expressions` のバグを修正しました。 [#4341](https://github.com/ClickHouse/ClickHouse/pull/4341) ([alesapin](https://github.com/alesapin))
* `uncompressed_cache=1` のときに発生していたセグメンテーションフォルトと、非圧縮サイズが不正な場合に発生していた例外を修正しました。 [#4186](https://github.com/ClickHouse/ClickHouse/pull/4186) ([alesapin](https://github.com/alesapin))
* 右テーブルに重複行がある場合の `ALL JOIN` を修正しました。 [#4184](https://github.com/ClickHouse/ClickHouse/pull/4184) ([Artem Zuikov](https://github.com/4ertus2))
* `INSERT ... SELECT ... FROM file(...)` クエリを実行した際に、ファイルのフォーマットが `CSVWithNames` または `TSVWIthNames` で、最初のデータ行が欠落している場合に発生していた誤った動作を修正しました。 [#4297](https://github.com/ClickHouse/ClickHouse/pull/4297) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `Array(LowCardinality)` 引数を持つ集約関数の実行を修正しました。 [#4055](https://github.com/ClickHouse/ClickHouse/pull/4055) ([KochetovNicolai](https://github.com/KochetovNicolai))
* Debian パッケージ: 設定に従って `/etc/clickhouse-server/preprocessed` へのリンクを修正。 [#4205](https://github.com/ClickHouse/ClickHouse/pull/4205) ([proller](https://github.com/proller))
* undefined behavior sanitizer 実行時のファジングテストを修正：`quantile*Weighted` 関数ファミリーにパラメータ型チェックを追加。 [#4145](https://github.com/ClickHouse/ClickHouse/pull/4145) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `START REPLICATED SENDS` コマンドでレプリケート送信が開始されるようにしました。 [#4229](https://github.com/ClickHouse/ClickHouse/pull/4229) ([nvartolomei](https://github.com/nvartolomei))
* JOIN の ON 句で重複したカラムに対して発生していた `Not found column` エラーを修正。 [#4279](https://github.com/ClickHouse/ClickHouse/pull/4279) ([Artem Zuikov](https://github.com/4ertus2))
* SSL証明書のデフォルトディレクトリとして、`/etc/ssl` が使用されるようになりました。 [#4167](https://github.com/ClickHouse/ClickHouse/pull/4167) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 辞書が利用できない場合に、辞書のリロードで発生していたクラッシュを修正。 [#4188](https://github.com/ClickHouse/ClickHouse/pull/4188) ([proller](https://github.com/proller))
* `Date` および `DateTime` の比較が正しく行われなかった不具合を修正しました。 [#4237](https://github.com/ClickHouse/ClickHouse/pull/4237) ([valexey](https://github.com/valexey))
* 条件演算子（関数 `if`）の分岐で `Date` および `DateTime` 引数が使用された場合に誤った結果となる問題を修正しました。関数 `if` に汎用的なケースを追加しました。 [#4243](https://github.com/ClickHouse/ClickHouse/pull/4243) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.1.6, 2019-01-24 {#clickhouse-release-19-1-6-2019-01-24}

#### 新機能 {#new-features-7}

- テーブルのカラムごとのカスタム圧縮コーデック。[#3899](https://github.com/ClickHouse/ClickHouse/pull/3899) [#4111](https://github.com/ClickHouse/ClickHouse/pull/4111) ([alesapin](https://github.com/alesapin), [Winter Zhang](https://github.com/zhang2014), [Anatoly](https://github.com/Sindbag))
- 圧縮コーデック `Delta` を追加。[#4052](https://github.com/ClickHouse/ClickHouse/pull/4052) ([alesapin](https://github.com/alesapin))
- 圧縮コーデックの `ALTER` をサポート。[#4054](https://github.com/ClickHouse/ClickHouse/pull/4054) ([alesapin](https://github.com/alesapin))
- SQL標準互換性のために関数 `left`、`right`、`trim`、`ltrim`、`rtrim`、`timestampadd`、`timestampsub` を追加。[#3826](https://github.com/ClickHouse/ClickHouse/pull/3826) ([Ivan Blinkov](https://github.com/blinkov))
- `HDFS` テーブルおよび `hdfs` テーブル関数での書き込みをサポート。[#4084](https://github.com/ClickHouse/ClickHouse/pull/4084) ([alesapin](https://github.com/alesapin))
- 大きな検索対象から複数の定数文字列を検索する関数を追加: `multiPosition`、`multiSearch`、`firstMatch` およびそれらの `-UTF8`、`-CaseInsensitive`、`-CaseInsensitiveUTF8` バリアント。[#4053](https://github.com/ClickHouse/ClickHouse/pull/4053) ([Danila Kutenin](https://github.com/danlark1))
- `SELECT` クエリがシャーディングキーでフィルタリングする場合の未使用シャードの削減(設定 `optimize_skip_unused_shards`)。[#3851](https://github.com/ClickHouse/ClickHouse/pull/3851) ([Gleb Kanterov](https://github.com/kanterov), [Ivan](https://github.com/abyss7))
- `Kafka` エンジンがブロックごとに一定数のパースエラーを無視できるように許可。[#4094](https://github.com/ClickHouse/ClickHouse/pull/4094) ([Ivan](https://github.com/abyss7))
- `CatBoost` マルチクラスモデル評価のサポートを追加。関数 `modelEvaluate` はマルチクラスモデルのクラスごとの生予測値をタプルで返します。`libcatboostmodel.so` は [#607](https://github.com/catboost/catboost/pull/607) でビルドする必要があります。[#3959](https://github.com/ClickHouse/ClickHouse/pull/3959) ([KochetovNicolai](https://github.com/KochetovNicolai))
- 関数 `filesystemAvailable`、`filesystemFree`、`filesystemCapacity` を追加。[#4097](https://github.com/ClickHouse/ClickHouse/pull/4097) ([Boris Granveaud](https://github.com/bgranvea))
- ハッシュ関数 `xxHash64` および `xxHash32` を追加。[#3905](https://github.com/ClickHouse/ClickHouse/pull/3905) ([filimonov](https://github.com/filimonov))
- [gcc](https://github.com/gcc-mirror/gcc/blob/41d6b10e96a1de98e90a7c0378437c3255814b16/libstdc%2B%2B-v3/include/bits/functional_hash.h#L191) と同じハッシュシードを使用する `gccMurmurHash` ハッシュ関数(GCC版Murmurハッシュ)を追加。[#4000](https://github.com/ClickHouse/ClickHouse/pull/4000) ([sundyli](https://github.com/sundy-li))
- ハッシュ関数 `javaHash`、`hiveHash` を追加。[#3811](https://github.com/ClickHouse/ClickHouse/pull/3811) ([shangshujie365](https://github.com/shangshujie365))
- テーブル関数 `remoteSecure` を追加。この関数は `remote` と同様に動作しますが、セキュアな接続を使用します。[#4088](https://github.com/ClickHouse/ClickHouse/pull/4088) ([proller](https://github.com/proller))

#### 実験的機能 {#experimental-features-3}


- 複数のJOINエミュレーションを追加（`allow_experimental_multiple_joins_emulation`設定）。[#3946](https://github.com/ClickHouse/ClickHouse/pull/3946) ([Artem Zuikov](https://github.com/4ertus2))

#### バグ修正 {#bug-fixes-21}


* メモリ消費を抑えるため、`compiled_expression_cache_size` のデフォルト値に上限を設けました。 [#4041](https://github.com/ClickHouse/ClickHouse/pull/4041) ([alesapin](https://github.com/alesapin))
* Replicated テーブルに対して `ALTER` を実行するスレッドおよび ZooKeeper から設定を更新するスレッドでハングアップが発生する原因となっていたバグを修正しました。 [#2947](https://github.com/ClickHouse/ClickHouse/issues/2947) [#3891](https://github.com/ClickHouse/ClickHouse/issues/3891) [#3934](https://github.com/ClickHouse/ClickHouse/pull/3934) ([Alex Zatelepin](https://github.com/ztlpn))
* 分散 `ALTER` タスクの実行時に発生するレースコンディションを修正しました。このレースコンディションにより、複数のレプリカが同じタスクを実行しようとし、1つを除くすべてのレプリカが ZooKeeper エラーで失敗していました。 [#3904](https://github.com/ClickHouse/ClickHouse/pull/3904) ([Alex Zatelepin](https://github.com/ztlpn))
* ZooKeeper へのリクエストがタイムアウトした後に `from_zk` 設定要素がリフレッシュされないバグを修正。[#2947](https://github.com/ClickHouse/ClickHouse/issues/2947) [#3947](https://github.com/ClickHouse/ClickHouse/pull/3947) ([Alex Zatelepin](https://github.com/ztlpn))
* IPv4 サブネットマスクの誤ったプレフィックスに関するバグを修正。 [#3945](https://github.com/ClickHouse/ClickHouse/pull/3945) ([alesapin](https://github.com/alesapin))
* リソース枯渇により新しいスレッドを作成できないまれなケースで発生していたクラッシュ（`std::terminate`）を修正。 [#3956](https://github.com/ClickHouse/ClickHouse/pull/3956) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `remote` テーブル関数の実行時に、`getStructureOfRemoteTable` で誤った制限が使用されていたバグを修正。 [#4009](https://github.com/ClickHouse/ClickHouse/pull/4009) ([alesapin](https://github.com/alesapin))
* netlink ソケットのリークを修正。ソケットはプールに配置されていましたが決して削除されず、既存のすべてのソケットが使用中のときには、新しいスレッドの開始時に新しいソケットが作成されていました。 [#4017](https://github.com/ClickHouse/ClickHouse/pull/4017) ([Alex Zatelepin](https://github.com/ztlpn))
* `odbc-bridge` サブプロセスのフォーク後に、`/proc` からすべての fd を読み取る前に `/proc/self/fd` ディレクトリを早くクローズしてしまうバグを修正。 [#4120](https://github.com/ClickHouse/ClickHouse/pull/4120) ([alesapin](https://github.com/alesapin))
* `primary key` に `String` を使用している場合の FixedString から `UInt` への単調変換を修正。 [#3870](https://github.com/ClickHouse/ClickHouse/pull/3870) ([Winter Zhang](https://github.com/zhang2014))
* 整数変換関数の単調性判定における計算エラーを修正しました。 [#3921](https://github.com/ClickHouse/ClickHouse/pull/3921) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 一部の不正な引数が指定された場合に `arrayEnumerateUniq`、`arrayEnumerateDense` 関数で発生していたセグメンテーションフォルトを修正しました。 [#3909](https://github.com/ClickHouse/ClickHouse/pull/3909) ([alexey-milovidov](https://github.com/alexey-milovidov))
* StorageMerge の未定義動作 (UB) を修正。 [#3910](https://github.com/ClickHouse/ClickHouse/pull/3910) ([Amos Bird](https://github.com/amosbird))
* 関数 `addDays`、`subtractDays` で発生していたセグメンテーションフォールトを修正しました。 [#3913](https://github.com/ClickHouse/ClickHouse/pull/3913) ([alexey-milovidov](https://github.com/alexey-milovidov))
* エラー修正: 関数 `round`、`floor`、`trunc`、`ceil` が、整数の引数と大きな負のスケールで実行された場合に不正な結果を返すことがある問題を修正。 [#3914](https://github.com/ClickHouse/ClickHouse/pull/3914) ([alexey-milovidov](https://github.com/alexey-milovidov))
* &#39;kill query sync&#39; によって発生し、コアダンプを引き起こしていたバグを修正。 [#3916](https://github.com/ClickHouse/ClickHouse/pull/3916) ([muVulDeePecker](https://github.com/fancyqlx))
* レプリケーションキューが空になった後に長い遅延が発生するバグを修正。 [#3928](https://github.com/ClickHouse/ClickHouse/pull/3928) [#3932](https://github.com/ClickHouse/ClickHouse/pull/3932) ([alesapin](https://github.com/alesapin))
* `LowCardinality` の主キーを持つテーブルへの挿入時に発生していた過剰なメモリ使用を修正しました。 [#3955](https://github.com/ClickHouse/ClickHouse/pull/3955) ([KochetovNicolai](https://github.com/KochetovNicolai))
* 空配列の場合の `Native` 形式における `LowCardinality` のシリアライゼーションを修正。 [#3907](https://github.com/ClickHouse/ClickHouse/issues/3907) [#4011](https://github.com/ClickHouse/ClickHouse/pull/4011) ([KochetovNicolai](https://github.com/KochetovNicolai))
* 単一の LowCardinality 数値カラムに対して `distinct` を使用した際に誤った結果が返される問題を修正。 [#3895](https://github.com/ClickHouse/ClickHouse/issues/3895) [#4012](https://github.com/ClickHouse/ClickHouse/pull/4012) ([KochetovNicolai](https://github.com/KochetovNicolai))
* `compile` 設定が有効な場合の LowCardinality キーを用いた特殊な集計処理を修正しました。 [#3886](https://github.com/ClickHouse/ClickHouse/pull/3886) ([KochetovNicolai](https://github.com/KochetovNicolai))
* レプリケーテッドテーブルに対するクエリでの `user` および `password` の転送処理を修正。 [#3957](https://github.com/ClickHouse/ClickHouse/pull/3957) ([alesapin](https://github.com/alesapin)) ([小路](https://github.com/nicelulu))
* 辞書を再読み込みしている間に Dictionary データベース内のテーブルを一覧取得する際に、極めてまれに発生するレースコンディションを修正しました。 [#3970](https://github.com/ClickHouse/ClickHouse/pull/3970) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ROLLUP または CUBE と併用した HAVING によって誤った結果が返される問題を修正しました。 [#3756](https://github.com/ClickHouse/ClickHouse/issues/3756) [#3837](https://github.com/ClickHouse/ClickHouse/pull/3837) ([Sam Chou](https://github.com/reflection))
* `JOIN ON` 構文と分散テーブルを使用するクエリにおけるカラムエイリアスの扱いを修正しました。 [#3980](https://github.com/ClickHouse/ClickHouse/pull/3980) ([Winter Zhang](https://github.com/zhang2014))
* `quantileTDigest` の内部実装におけるエラーを修正しました（Artem Vakhrushev により発見）。このエラーが ClickHouse で発生することはなく、ClickHouse のコードベースをライブラリとして直接利用している場合にのみ影響するものでした。 [#3935](https://github.com/ClickHouse/ClickHouse/pull/3935) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### 改善 {#improvements-6}

- `ALTER TABLE ADD COLUMN`文で`IF NOT EXISTS`をサポート、`DROP/MODIFY/CLEAR/COMMENT COLUMN`で`IF EXISTS`をサポート。[#3900](https://github.com/ClickHouse/ClickHouse/pull/3900) ([Boris Granveaud](https://github.com/bgranvea))
- 関数`parseDateTimeBestEffort`: `DD.MM.YYYY`、`DD.MM.YY`、`DD-MM-YYYY`、`DD-Mon-YYYY`、`DD/Month/YYYY`および類似形式をサポート。[#3922](https://github.com/ClickHouse/ClickHouse/pull/3922) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `CapnProtoInputStream`がジャグ構造をサポート。[#4063](https://github.com/ClickHouse/ClickHouse/pull/4063) ([Odin Hultgren Van Der Horst](https://github.com/Miniwoffer))
- ユーザビリティの改善: サーバープロセスがデータディレクトリの所有者から起動されているかのチェックを追加。データが非rootユーザーに属している場合、rootからのサーバー起動を許可しないように変更。[#3785](https://github.com/ClickHouse/ClickHouse/pull/3785) ([sergey-v-galtsev](https://github.com/sergey-v-galtsev))
- JOINを含むクエリの解析時に必要なカラムをチェックするロジックを改善。[#3930](https://github.com/ClickHouse/ClickHouse/pull/3930) ([Artem Zuikov](https://github.com/4ertus2))
- 単一サーバー内に多数のDistributedテーブルがある場合の接続数を削減。[#3726](https://github.com/ClickHouse/ClickHouse/pull/3726) ([Winter Zhang](https://github.com/zhang2014))
- ODBCドライバーで`WITH TOTALS`クエリの合計行をサポート。[#3836](https://github.com/ClickHouse/ClickHouse/pull/3836) ([Maksim Koritckiy](https://github.com/nightweb))
- if関数内で`Enum`を整数として使用可能に変更。[#3875](https://github.com/ClickHouse/ClickHouse/pull/3875) ([Ivan](https://github.com/abyss7))
- `low_cardinality_allow_in_native_format`設定を追加。無効にすると、`Native`形式で`LowCardinality`型を使用しない。[#3879](https://github.com/ClickHouse/ClickHouse/pull/3879) ([KochetovNicolai](https://github.com/KochetovNicolai))
- メモリ使用量を削減するため、コンパイル済み式キャッシュから冗長なオブジェクトを削除。[#4042](https://github.com/ClickHouse/ClickHouse/pull/4042) ([alesapin](https://github.com/alesapin))
- `SET send_logs_level = 'value'`クエリが適切な値を受け入れるかのチェックを追加。[#3873](https://github.com/ClickHouse/ClickHouse/pull/3873) ([Sabyanin Maxim](https://github.com/s-mx))
- 型変換関数でのデータ型チェックを修正。[#3896](https://github.com/ClickHouse/ClickHouse/pull/3896) ([Winter Zhang](https://github.com/zhang2014))

#### パフォーマンス改善 {#performance-improvements-5}


- MergeTree設定`use_minimalistic_part_header_in_zookeeper`を追加しました。有効にすると、Replicatedテーブルはコンパクトなパートメタデータを単一のパートznodeに保存します。これにより、ZooKeeperスナップショットのサイズを大幅に削減できます(特にテーブルに多数のカラムがある場合)。この設定を有効にした後は、これをサポートしていないバージョンへのダウングレードができなくなることに注意してください。[#3960](https://github.com/ClickHouse/ClickHouse/pull/3960) ([Alex Zatelepin](https://github.com/ztlpn))
- パターンに時間が含まれていない場合の関数`sequenceMatch`および`sequenceCount`に対して、DFAベースの実装を追加しました。[#4004](https://github.com/ClickHouse/ClickHouse/pull/4004) ([Léo Ercolanelli](https://github.com/ercolanelli-leo))
- 整数のシリアライゼーションのパフォーマンスを改善しました。[#3968](https://github.com/ClickHouse/ClickHouse/pull/3968) ([Amos Bird](https://github.com/amosbird))
- PODArrayの左側をゼロパディングし、-1要素が常に有効でゼロになるようにしました。これはオフセットの分岐なし計算に使用されます。[#3920](https://github.com/ClickHouse/ClickHouse/pull/3920) ([Amos Bird](https://github.com/amosbird))
- パフォーマンス低下を引き起こした`jemalloc`バージョンを元に戻しました。[#4018](https://github.com/ClickHouse/ClickHouse/pull/4018) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### 後方互換性のない変更 {#backward-incompatible-changes-2}

- `ALTER MODIFY ORDER BY`コマンドに置き換えられたため、文書化されていない機能`ALTER MODIFY PRIMARY KEY`を削除しました。[#3887](https://github.com/ClickHouse/ClickHouse/pull/3887) ([Alex Zatelepin](https://github.com/ztlpn))
- 関数`shardByHash`を削除しました。[#3833](https://github.com/ClickHouse/ClickHouse/pull/3833) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 型`AggregateFunction`の結果を持つスカラーサブクエリの使用を禁止しました。[#3865](https://github.com/ClickHouse/ClickHouse/pull/3865) ([Ivan](https://github.com/abyss7))

#### ビルド/テスト/パッケージングの改善 {#buildtestingpackaging-improvements-6}


* PowerPC（`ppc64le`）向けビルドのサポートを追加。[#4132](https://github.com/ClickHouse/ClickHouse/pull/4132) ([Danila Kutenin](https://github.com/danlark1))
* ステートフルな機能テストが公開データセット上で実行されるようになりました。 [#3969](https://github.com/ClickHouse/ClickHouse/pull/3969) ([alexey-milovidov](https://github.com/alexey-milovidov))
* Docker または systemd-nspawn 環境で、`bash: /usr/bin/clickhouse-extract-from-config: Operation not permitted` というメッセージが表示されてサーバーを起動できない不具合を修正しました。 [#4136](https://github.com/ClickHouse/ClickHouse/pull/4136) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `rdkafka` ライブラリを v1.0.0-RC5 に更新し、生の C インターフェースの代わりに cppkafka を使用しました。 [#4025](https://github.com/ClickHouse/ClickHouse/pull/4025) ([Ivan](https://github.com/abyss7))
* `mariadb-client` ライブラリを更新しました。UBSan によって検出された問題の一つを修正しました。[#3924](https://github.com/ClickHouse/ClickHouse/pull/3924) ([alexey-milovidov](https://github.com/alexey-milovidov))
* UBSan ビルド向けの修正をいくつか行いました。 [#3926](https://github.com/ClickHouse/ClickHouse/pull/3926) [#3021](https://github.com/ClickHouse/ClickHouse/pull/3021) [#3948](https://github.com/ClickHouse/ClickHouse/pull/3948) ([alexey-milovidov](https://github.com/alexey-milovidov))
* UBSan ビルドでのテストをコミットごとに実行するように追加。
* PVS-Studio 静的解析ツールをコミットごとに実行するようにしました。
* PVS-Studio によって検出されたバグを修正しました。 [#4013](https://github.com/ClickHouse/ClickHouse/pull/4013) ([alexey-milovidov](https://github.com/alexey-milovidov))
* glibc の互換性問題を修正しました。 [#4100](https://github.com/ClickHouse/ClickHouse/pull/4100) ([alexey-milovidov](https://github.com/alexey-milovidov))
* Docker イメージを 18.10 に更新し、glibc &gt;= 2.28 向けの互換性ファイルを追加 [#3965](https://github.com/ClickHouse/ClickHouse/pull/3965) ([alesapin](https://github.com/alesapin))
* サーバーの Docker イメージ内でディレクトリに対して `chown` を実行したくない場合のための環境変数を追加。 [#3967](https://github.com/ClickHouse/ClickHouse/pull/3967) ([alesapin](https://github.com/alesapin))
* clang の `-Weverything` で有効になる警告のほとんどを有効化し、`-Wpedantic` を有効化しました。[#3986](https://github.com/ClickHouse/ClickHouse/pull/3986) ([alexey-milovidov](https://github.com/alexey-milovidov))
* clang 8 でのみ利用可能ないくつかの警告を追加しました。 [#3993](https://github.com/ClickHouse/ClickHouse/pull/3993) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 共有リンク時には、個別の LLVM ライブラリではなく `libLLVM` にリンクするようにしました。 [#3989](https://github.com/ClickHouse/ClickHouse/pull/3989) ([Orivej Desh](https://github.com/orivej))
* テストイメージ向けのサニタイザー変数を追加しました。 [#4072](https://github.com/ClickHouse/ClickHouse/pull/4072) ([alesapin](https://github.com/alesapin))
* `clickhouse-server` の Debian パッケージは、ケーパビリティを設定するための `setcap` ツールを使うために、`libcap2-bin` パッケージを推奨するようになります。これは任意です。 [#4093](https://github.com/ClickHouse/ClickHouse/pull/4093) ([alexey-milovidov](https://github.com/alexey-milovidov))
* コンパイル時間を短縮し、`include` を修正しました。 [#3898](https://github.com/ClickHouse/ClickHouse/pull/3898) ([proller](https://github.com/proller))
* ハッシュ関数のパフォーマンスベンチマークを追加しました。 [#3918](https://github.com/ClickHouse/ClickHouse/pull/3918) ([filimonov](https://github.com/filimonov))
* 循環的なライブラリ依存関係を修正。 [#3958](https://github.com/ClickHouse/ClickHouse/pull/3958) ([proller](https://github.com/proller))
* 利用可能なメモリが少ない環境でのコンパイル処理を改善しました。 [#4030](https://github.com/ClickHouse/ClickHouse/pull/4030) ([proller](https://github.com/proller))
* `jemalloc` の性能低下を再現するためのテストスクリプトを追加しました。 [#4036](https://github.com/ClickHouse/ClickHouse/pull/4036) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `dbms` 内のコメントと文字列リテラルの誤字を修正しました。 [#4122](https://github.com/ClickHouse/ClickHouse/pull/4122) ([maiha](https://github.com/maiha))
* コメント内の誤字を修正しました。 [#4089](https://github.com/ClickHouse/ClickHouse/pull/4089) ([Evgenii Pravda](https://github.com/kvinty))





## [2018年の変更履歴](./2018.md) {#changelog-for-2018}
