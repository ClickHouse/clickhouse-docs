---
slug: /whats-new/changelog/2019
sidebar_position: -2019
sidebar_label: '2019'
title: '2019 年の変更履歴'
description: '2019 年の変更履歴'
doc_type: 'changelog'
keywords: ['ClickHouse 2019', '2019年 変更履歴', 'リリースノート', 'バージョン履歴', 'レガシーリリース']
---

## ClickHouse リリース 19.17 \\{#clickhouse-release-v19-17\\}

### ClickHouse リリース 19.17.6.36, 2019-12-27 \\{#clickhouse-release-v19-17-6-36-2019-12-27\\}

#### 不具合修正 \\{#bug-fix\\}

* `decompress` における潜在的なバッファオーバーフローを修正しました。悪意のあるユーザーが、バッファ外の読み取りを引き起こすよう細工された圧縮データを渡すことで発生し得る問題がありました。この問題は Yandex の情報セキュリティチームに所属する Eldar Zaitov によって発見されました。 [#8404](https://github.com/ClickHouse/ClickHouse/pull/8404) ([alexey-milovidov](https://github.com/alexey-milovidov))
* サーバーが、UTF-8 検証を必要とする String データ型の値を含むデータを JSON または XML 形式で送信または書き込みできない場合、あるいは結果データを Brotli アルゴリズムで圧縮する場合、その他のいくつかのまれなケースにおいて `std::terminate` によりクラッシュする可能性があった問題を修正しました。 [#8384](https://github.com/ClickHouse/ClickHouse/pull/8384) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ClickHouse の `VIEW` をソースとする固定ディクショナリで、それらを読み取ると `There is no query` エラーが発生していた問題を修正しました。 [#8351](https://github.com/ClickHouse/ClickHouse/pull/8351) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* クライアントホストが users.xml で指定された host&#95;regexp によって許可されているかどうかのチェックを修正しました。 [#8241](https://github.com/ClickHouse/ClickHouse/pull/8241), [#8342](https://github.com/ClickHouse/ClickHouse/pull/8342) ([Vitaly Baranov](https://github.com/vitlibar))
* 分散テーブルに対する `RENAME TABLE` は、シャードに送信する前に挿入済みデータを含むフォルダーの名前を変更するようになりました。これにより、`tableA->tableB`、`tableC->tableA` のような連続したリネーム操作時の問題が修正されます。 [#8306](https://github.com/ClickHouse/ClickHouse/pull/8306) ([tavplubix](https://github.com/tavplubix))
* DDL クエリで作成される `range_hashed` 外部ディクショナリで、任意の数値型で範囲を指定できるようになりました。 [#8275](https://github.com/ClickHouse/ClickHouse/pull/8275) ([alesapin](https://github.com/alesapin))
* `INSERT INTO table SELECT ... FROM mysql(...)` テーブル関数の問題を修正しました。 [#8234](https://github.com/ClickHouse/ClickHouse/pull/8234) ([tavplubix](https://github.com/tavplubix))
* 存在しないファイルに対して `INSERT INTO TABLE FUNCTION file()` を実行した際に発生していたセグメンテーションフォルトを修正しました。この場合は、まずファイルが作成され、その後に INSERT 文が処理されるようになりました。 [#8177](https://github.com/ClickHouse/ClickHouse/pull/8177) ([Olga Khvostikova](https://github.com/stavrolia))
* 集約済みビットマップとスカラービットマップの積集合を取る際の `bitmapAnd` エラーを修正しました。 [#8082](https://github.com/ClickHouse/ClickHouse/pull/8082) ([Yue Huang](https://github.com/moon03432))
* `EXISTS t` のように、`TABLE` や `DICTIONARY` 修飾子なしで `EXISTS` クエリが使用された場合に発生していたセグメンテーションフォルトを修正しました。 [#8213](https://github.com/ClickHouse/ClickHouse/pull/8213) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `Nullable` な引数が指定された場合の `rand` および `randConstant` 関数の戻り値の型を修正しました。これらの関数は常に `UInt32` を返し、`Nullable(UInt32)` を返すことはなくなりました。 [#8204](https://github.com/ClickHouse/ClickHouse/pull/8204) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* `DROP DICTIONARY IF EXISTS db.dict` を修正し、`db` が存在しないときにも例外をスローしないようにしました。 [#8185](https://github.com/ClickHouse/ClickHouse/pull/8185) ([Vitaly Baranov](https://github.com/vitlibar))
* サーバークラッシュが原因でテーブルが完全に削除されなかった場合、サーバーはそのテーブルを復元して読み込もうとします [#8176](https://github.com/ClickHouse/ClickHouse/pull/8176) ([tavplubix](https://github.com/tavplubix))
* 2 つを超えるシャードのローカルテーブルを持つ分散テーブルに対する単純な `count` クエリを修正しました。 [#8164](https://github.com/ClickHouse/ClickHouse/pull/8164) ([小路](https://github.com/nicelulu))
* DB::BlockStreamProfileInfo::calculateRowsBeforeLimit() におけるデータレースの原因となっていたバグを修正 [#8143](https://github.com/ClickHouse/ClickHouse/pull/8143) ([Alexander Kazakov](https://github.com/Akazz))
* `ALTER table MOVE part` が指定されたパーツのマージ直後に即時実行されていた問題を修正しました。この不具合により、指定したパーツをマージした結果生成されたパーツを移動してしまう可能性がありました。現在は指定されたパーツのみを正しく移動します。 [#8104](https://github.com/ClickHouse/ClickHouse/pull/8104) ([Vladimir Chebotarev](https://github.com/excitoon))
* 辞書の式を文字列として指定できるようになりました。これは、ClickHouse 以外のソースからデータを抽出する際に属性を計算する場合に便利です。これにより、それらの式を ClickHouse 以外の構文で記述できます。 [#8098](https://github.com/ClickHouse/ClickHouse/pull/8098) ([alesapin](https://github.com/alesapin))
* ZXid のオーバーフローが原因で `clickhouse-copier` でごくまれに発生していたレースコンディションを修正しました。 [#8088](https://github.com/ClickHouse/ClickHouse/pull/8088) ([Ding Xiang Fei](https://github.com/dingxiangfei2009))
* クエリが失敗した後（例えばエラー &quot;Too many simultaneous queries&quot; による失敗）に外部テーブルの情報が読み取られず、次のリクエストがこの情報を次のクエリの開始として解釈し、`Unknown packet from client` のようなエラーを引き起こしていたバグを修正しました。 [#8084](https://github.com/ClickHouse/ClickHouse/pull/8084) ([Azat Khuzhin](https://github.com/azat))
* 「Unknown packet X from server」発生後のヌルデリファレンスを回避 [#8071](https://github.com/ClickHouse/ClickHouse/pull/8071) ([Azat Khuzhin](https://github.com/azat))
* すべての ICU ロケールのサポートを復元し、定数式に対して照合順序を適用できるようにし、`system.collations` テーブルに言語名を追加しました。 [#8051](https://github.com/ClickHouse/ClickHouse/pull/8051) ([alesapin](https://github.com/alesapin))
* `StorageFile` および `StorageHDFS` からの読み取りに使用されるストリーム数は、メモリ制限超過を防ぐために制限されるようになりました。 [#7981](https://github.com/ClickHouse/ClickHouse/pull/7981) ([alesapin](https://github.com/alesapin))
* キーを持たない `*MergeTree` テーブルに対する `CHECK TABLE` クエリを修正。 [#7979](https://github.com/ClickHouse/ClickHouse/pull/7979) ([alesapin](https://github.com/alesapin))
* ミューテーションが存在しない場合には、パート名からミューテーション番号を削除しました。これにより、古いバージョンとの互換性が向上しました。 [#8250](https://github.com/ClickHouse/ClickHouse/pull/8250) ([alesapin](https://github.com/alesapin))
* 一部のアタッチ済みパーツで、`data_version` がテーブルのミューテーションバージョンより大きい場合にミューテーションがスキップされてしまうバグを修正しました。 [#7812](https://github.com/ClickHouse/ClickHouse/pull/7812) ([Zhichang Yu](https://github.com/yuzhichang))
* パーツを別のデバイスに移動しても、その冗長コピーを残したままサーバーを起動できるようにしました。 [#7810](https://github.com/ClickHouse/ClickHouse/pull/7810) ([Vladimir Chebotarev](https://github.com/excitoon))
* 集約関数のカラムを使用した際に発生する可能性があったエラー「Sizes of columns does not match」を修正しました。[#7790](https://github.com/ClickHouse/ClickHouse/pull/7790) ([Boris Granveaud](https://github.com/bgranvea))
* 今後は、`LIMIT BY` と併用して `WITH TIES` を使用した場合に、例外がスローされます。また、`LIMIT BY` とともに `TOP` を使用できるようになりました。 [#7637](https://github.com/ClickHouse/ClickHouse/pull/7637) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))
* `invalidate_query` を持つディクショナリのリロード処理を修正し、以前の更新試行時に更新が停止したり例外が発生したりしていた問題を解消しました。 [#8029](https://github.com/ClickHouse/ClickHouse/pull/8029) ([alesapin](https://github.com/alesapin))

### ClickHouse リリース 19.17.4.11, 2019-11-22 \\{#clickhouse-release-v19-17-4-11-2019-11-22\\}

#### 後方互換性のない変更 \\{#backward-incompatible-change\\}

- スカラーサブクエリの結果を保存する際に、パフォーマンス向上のため AST ではなくカラムを使用するように変更しました。設定項目 `enable_scalar_subquery_optimization` は 19.17 で追加され、デフォルトで有効になっていました。このため、以前のバージョンから 19.17.2 または 19.17.3 へアップグレードする際に、[このような](https://github.com/ClickHouse/ClickHouse/issues/7851) エラーが発生していました。この設定は 19.17.4 ではデフォルトで無効となり、19.16 およびそれ以前のバージョンからエラーなくアップグレードできるようになりました。 [#7392](https://github.com/ClickHouse/ClickHouse/pull/7392) ([Amos Bird](https://github.com/amosbird))

#### 新機能 \\{#new-feature\\}

- DDL クエリでディクショナリを作成できる機能を追加しました。 [#7360](https://github.com/ClickHouse/ClickHouse/pull/7360) ([alesapin](https://github.com/alesapin))
- `bloom_filter` 型のインデックスが `LowCardinality` および `Nullable` をサポートするようにしました。 [#7363](https://github.com/ClickHouse/ClickHouse/issues/7363) [#7561](https://github.com/ClickHouse/ClickHouse/pull/7561) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- 渡された文字列が有効な JSON であるかを検査する関数 `isValidJSON` を追加しました。 [#5910](https://github.com/ClickHouse/ClickHouse/issues/5910) [#7293](https://github.com/ClickHouse/ClickHouse/pull/7293) ([Vdimir](https://github.com/Vdimir))
- `arrayCompact` 関数を実装しました。 [#7328](https://github.com/ClickHouse/ClickHouse/pull/7328) ([Memo](https://github.com/Joeywzr))
- Decimal 数値用の関数 `hex` を追加しました。これは `hex(reinterpretAsString())` と同様に動作しますが、末尾のゼロバイトを削除しません。 [#7355](https://github.com/ClickHouse/ClickHouse/pull/7355) ([Mikhail Korotov](https://github.com/millb))
- 配列内で、要素をその前後にある他の要素で置き換える `arrayFill` および `arrayReverseFill` 関数を追加しました。 [#7380](https://github.com/ClickHouse/ClickHouse/pull/7380) ([hcz](https://github.com/hczhcz))
- `CRC32IEEE()` / `CRC64()` のサポートを追加しました。 [#7480](https://github.com/ClickHouse/ClickHouse/pull/7480) ([Azat Khuzhin](https://github.com/azat))
- [MySQL](https://dev.mysql.com/doc/refman/8.0/en/string-functions.html#function_char) のものと同様の `char` 関数を実装しました。 [#7486](https://github.com/ClickHouse/ClickHouse/pull/7486) ([sundyli](https://github.com/sundy-li))
- `bitmapTransform` 関数を追加しました。これはビットマップ内の値の配列を別の値の配列へ変換し、その結果として新しいビットマップを返します。 [#7598](https://github.com/ClickHouse/ClickHouse/pull/7598) ([Zhichang Yu](https://github.com/yuzhichang))
- `javaHashUTF16LE()` 関数を実装しました。 [#7651](https://github.com/ClickHouse/ClickHouse/pull/7651) ([achimbab](https://github.com/achimbab))
- Distributed エンジン向けの仮想カラム `_shard_num` を追加しました。 [#7624](https://github.com/ClickHouse/ClickHouse/pull/7624) ([Azat Khuzhin](https://github.com/azat))

#### 実験的機能 \\{#experimental-feature\\}

- `MergeTree` における processors（新しいクエリ実行パイプライン）のサポートを追加しました。 [#7181](https://github.com/ClickHouse/ClickHouse/pull/7181) ([Nikolai Kochetov](https://github.com/KochetovNicolai))

#### バグ修正 \\{#bug-fix-1\\}

* `Values` で発生していた浮動小数点数の誤解析を修正 [#7817](https://github.com/ClickHouse/ClickHouse/issues/7817) [#7870](https://github.com/ClickHouse/ClickHouse/pull/7870) ([tavplubix](https://github.com/tavplubix))
* trace&#95;log 有効時にごくまれに発生するデッドロックを修正。 [#7838](https://github.com/ClickHouse/ClickHouse/pull/7838) ([filimonov](https://github.com/filimonov))
* それを参照する任意のマテリアライズドビュー (MV) を持つ Kafka テーブルにプロデュースする際のメッセージの重複を防止 [#7265](https://github.com/ClickHouse/ClickHouse/pull/7265) ([Ivan](https://github.com/abyss7))
* `IN` 句での `Array(LowCardinality(Nullable(String)))` のサポート。[#7364](https://github.com/ClickHouse/ClickHouse/issues/7364) [#7366](https://github.com/ClickHouse/ClickHouse/pull/7366) を解決 ([achimbab](https://github.com/achimbab))
* ODBC Bridge で `SQL_TINYINT` および `SQL_BIGINT` の取り扱いを追加し、`SQL_FLOAT` データソース型の取り扱いを修正。[#7491](https://github.com/ClickHouse/ClickHouse/pull/7491) ([Denis Glazachev](https://github.com/traceon))
* 空の decimal 列に対する集約（`avg` および分位数）の処理を修正 [#7431](https://github.com/ClickHouse/ClickHouse/pull/7431) ([Andrey Konyaev](https://github.com/akonyaev90))
* `MATERIALIZED` カラムを持つ Distributed テーブルへの `INSERT` を修正 [#7377](https://github.com/ClickHouse/ClickHouse/pull/7377) ([Azat Khuzhin](https://github.com/azat))
* パーティションの一部がすでに宛先ディスクまたはボリューム上にある場合でも `MOVE PARTITION` が動作するようにしました [#7434](https://github.com/ClickHouse/ClickHouse/pull/7434) ([Vladimir Chebotarev](https://github.com/excitoon))
* マルチディスク構成で、`ReplicatedMergeTree` の mutation 実行中にハードリンクの作成に失敗するバグを修正しました。 [#7558](https://github.com/ClickHouse/ClickHouse/pull/7558) ([Vladimir Chebotarev](https://github.com/excitoon))
* MergeTree でのミューテーションにおいて、パーツ全体が変更されない場合に、最適な配置先が別ディスクとして選択されると発生していたバグを修正しました [#7602](https://github.com/ClickHouse/ClickHouse/pull/7602) ([Vladimir Chebotarev](https://github.com/excitoon))
* ディスク設定から `keep_free_space_ratio` が読み込まれないバグを修正 [#7645](https://github.com/ClickHouse/ClickHouse/pull/7645) ([Vladimir Chebotarev](https://github.com/excitoon))
* `Tuple` 列または複雑なパスを持つ列のみから成るテーブルで発生していたバグを修正しました。 [7541](https://github.com/ClickHouse/ClickHouse/issues/7541) を修正。 [#7545](https://github.com/ClickHouse/ClickHouse/pull/7545) ([alesapin](https://github.com/alesapin))
* max&#95;memory&#95;usage 制限に Buffer エンジンのメモリを含めない [#7552](https://github.com/ClickHouse/ClickHouse/pull/7552) ([Azat Khuzhin](https://github.com/azat))
* `ORDER BY tuple()` が指定された `MergeTree` テーブルにおける final mark の扱いを修正しました。まれなケースで、SELECT 時に `Can't adjust last granule` エラーが発生する可能性がありました。 [#7639](https://github.com/ClickHouse/ClickHouse/pull/7639) ([Anton Popov](https://github.com/CurtizJ))
* コンテキストを必要とするアクション（たとえば JSON 関数）を含む述語を持つミューテーションに存在していたバグを修正しました。このバグにより、クラッシュや異常な例外が発生する可能性がありました。 [#7664](https://github.com/ClickHouse/ClickHouse/pull/7664) ([alesapin](https://github.com/alesapin))
* `data/` ディレクトリと `shadow/` ディレクトリにおけるデータベース名およびテーブル名のエスケープ方法の不一致を修正 [#7575](https://github.com/ClickHouse/ClickHouse/pull/7575) ([Alexander Burmak](https://github.com/Alex-Burmak))
* RIGHT|FULL JOIN における重複キーをサポート（例: `ON t.x = u.x AND t.x = u.y`）。このケースで発生していたクラッシュを修正。 [#7586](https://github.com/ClickHouse/ClickHouse/pull/7586) ([Artem Zuikov](https://github.com/4ertus2))
* 式による RIGHT または FULL JOIN の際に発生する `Not found column &lt;expression&gt; in block` エラーを修正。 [#7641](https://github.com/ClickHouse/ClickHouse/pull/7641) ([Artem Zuikov](https://github.com/4ertus2))
* `PrettySpace` フォーマットの無限ループを修正するための再試行 [#7591](https://github.com/ClickHouse/ClickHouse/pull/7591) ([Olga Khvostikova](https://github.com/stavrolia))
* すべての引数が同じサイズの `FixedString` の場合に発生していた `concat` 関数のバグを修正しました。 [#7635](https://github.com/ClickHouse/ClickHouse/pull/7635) ([alesapin](https://github.com/alesapin))
* S3、URL、HDFS ストレージを 1 つの引数のみで定義した場合に発生していた例外を修正しました。 [#7618](https://github.com/ClickHouse/ClickHouse/pull/7618) ([Vladimir Chebotarev](https://github.com/excitoon))
* ビューのクエリにおける InterpreterSelectQuery のスコープを修正 [#7601](https://github.com/ClickHouse/ClickHouse/pull/7601) ([Azat Khuzhin](https://github.com/azat))

#### 改良 \\{#improvement\\}

- `Nullable` カラムが認識され、NULL 値が ODBC-bridge によって正しく処理されるようにしました。[#7402](https://github.com/ClickHouse/ClickHouse/pull/7402) ([Vasily Nemkov](https://github.com/Enmk))
- 分散送信時に現在のバッチを書き込む処理をアトミックにしました。[#7600](https://github.com/ClickHouse/ClickHouse/pull/7600) ([Azat Khuzhin](https://github.com/azat))
- クエリ内のカラム名からテーブルを特定できない場合は、例外をスローするようにしました。[#7358](https://github.com/ClickHouse/ClickHouse/pull/7358) ([Artem Zuikov](https://github.com/4ertus2))
- `MergeTreeSettings` に `merge_max_block_size` 設定を追加しました。[#7412](https://github.com/ClickHouse/ClickHouse/pull/7412) ([Artem Zuikov](https://github.com/4ertus2))
- `HAVING` を含み `GROUP BY` を含まないクエリは、定数による `GROUP BY` を仮定するようにしました。そのため、`SELECT 1 HAVING 1` は結果を返すようになりました。[#7496](https://github.com/ClickHouse/ClickHouse/pull/7496) ([Amos Bird](https://github.com/amosbird))
- `(X,)` を Python と同様にタプルとしてパースできるようにしました。[#7501](https://github.com/ClickHouse/ClickHouse/pull/7501), [#7562](https://github.com/ClickHouse/ClickHouse/pull/7562) ([Amos Bird](https://github.com/amosbird))
- `range` 関数の挙動を、ほぼ Python と同じものにしました。[#7518](https://github.com/ClickHouse/ClickHouse/pull/7518) ([sundyli](https://github.com/sundy-li))
- テーブル `system.settings` に `constraints` カラムを追加しました。[#7553](https://github.com/ClickHouse/ClickHouse/pull/7553) ([Vitaly Baranov](https://github.com/vitlibar))
- TCP ハンドラー向けの Null フォーマットを改善し、`select ignore(<expression>) from table format Null` を clickhouse-client 経由でのパフォーマンス計測に利用できるようにしました。[#7606](https://github.com/ClickHouse/ClickHouse/pull/7606) ([Amos Bird](https://github.com/amosbird))
- `CREATE TABLE ... AS (SELECT (1, 2))` のようなクエリを正しくパースできるようにしました。[#7542](https://github.com/ClickHouse/ClickHouse/pull/7542) ([hcz](https://github.com/hczhcz))

#### パフォーマンスの改善 \\{#performance-improvement\\}

- 短い文字列キーに対する集約のパフォーマンスを改善しました。[#6243](https://github.com/ClickHouse/ClickHouse/pull/6243) ([Alexander Kuzmenkov](https://github.com/akuzm), [Amos Bird](https://github.com/amosbird))
- 定数述語が折り畳まれた後に、潜在的な最適化を得るため構文／式解析をもう一度実行するようにしました。[#7497](https://github.com/ClickHouse/ClickHouse/pull/7497) ([Amos Bird](https://github.com/amosbird))
- `SELECT count() FROM table;` のような自明なクエリを評価する際に、ストレージのメタ情報を使用するようにしました。[#7510](https://github.com/ClickHouse/ClickHouse/pull/7510) ([Amos Bird](https://github.com/amosbird), [alexey-milovidov](https://github.com/alexey-milovidov))
- Aggregator の `addBatch` と同様に、`arrayReduce` の処理をベクトル化しました。[#7608](https://github.com/ClickHouse/ClickHouse/pull/7608) ([Amos Bird](https://github.com/amosbird))
- `Kafka` のコンシューム処理のパフォーマンスをわずかに改善しました。[#7475](https://github.com/ClickHouse/ClickHouse/pull/7475) ([Ivan](https://github.com/abyss7))

#### ビルド/テスト/パッケージングの改善 \\{#buildtestingpackaging-improvement\\}

- CPU アーキテクチャ AARCH64 向けのクロスコンパイルサポートを追加。パッケージャースクリプトをリファクタリング。[#7370](https://github.com/ClickHouse/ClickHouse/pull/7370) [#7539](https://github.com/ClickHouse/ClickHouse/pull/7539) ([Ivan](https://github.com/abyss7))
- パッケージをビルドする際に、darwin-x86_64 と linux-aarch64 のツールチェーンをマウントされた Docker ボリュームに展開 [#7534](https://github.com/ClickHouse/ClickHouse/pull/7534) ([Ivan](https://github.com/abyss7))
- バイナリパッケージャー用の Docker イメージを更新 [#7474](https://github.com/ClickHouse/ClickHouse/pull/7474) ([Ivan](https://github.com/abyss7))
- macOS Catalina でのコンパイルエラーを修正 [#7585](https://github.com/ClickHouse/ClickHouse/pull/7585) ([Ernest Poletaev](https://github.com/ernestp))
- クエリ解析ロジックを一部リファクタリング：複雑なクラスをいくつかの単純なクラスに分割。[#7454](https://github.com/ClickHouse/ClickHouse/pull/7454) ([Artem Zuikov](https://github.com/4ertus2))
- サブモジュールなしでのビルドを修正 [#7295](https://github.com/ClickHouse/ClickHouse/pull/7295) ([proller](https://github.com/proller))
- CMake ファイル内の `add_globs` を改善 [#7418](https://github.com/ClickHouse/ClickHouse/pull/7418) ([Amos Bird](https://github.com/amosbird))
- `unwind` ターゲット内のハードコードされたパスを削除 [#7460](https://github.com/ClickHouse/ClickHouse/pull/7460) ([Konstantin Podshumok](https://github.com/podshumok))
- SSL なしで mysql フォーマットを使用できるようにする [#7524](https://github.com/ClickHouse/ClickHouse/pull/7524) ([proller](https://github.com/proller))

#### その他 \\{#other\\}

- ClickHouse SQL 方言向けの ANTLR4 文法を追加 [#7595](https://github.com/ClickHouse/ClickHouse/issues/7595) [#7596](https://github.com/ClickHouse/ClickHouse/pull/7596) ([alexey-milovidov](https://github.com/alexey-milovidov))

## ClickHouse リリース 19.16 \\{#clickhouse-release-v19-16\\}

#### ClickHouse リリース 19.16.14.65, 2020-03-25 \\{#clickhouse-release-v19-16-14-65-2020-03-25\\}

- 複数引数（10 個超）に対する三項論理演算子のバッチ計算に存在したバグを修正しました。 [#8718](https://github.com/ClickHouse/ClickHouse/pull/8718) ([Alexander Kazakov](https://github.com/Akazz)) このバグ修正は、Altinity からの特別な要望によりバージョン 19.16 にバックポートされました。

#### ClickHouse リリース 19.16.14.65, 2020-03-05 \\{#clickhouse-release-v19-16-14-65-2020-03-05\\}

- 古い ClickHouse バージョンとの分散サブクエリの非互換性を修正しました。[#7851](https://github.com/ClickHouse/ClickHouse/issues/7851) を修正。
    [(tabplubix)](https://github.com/tavplubix)
- `CREATE` クエリの実行時に、ストレージエンジン引数内の定数式を折りたたむようにしました。空のデータベース名は現在のデータベース名に置き換えるようにしました。[#6508](https://github.com/ClickHouse/ClickHouse/issues/6508)、[#3492](https://github.com/ClickHouse/ClickHouse/issues/3492) を修正。また、`ClickHouseDictionarySource` におけるローカルアドレスのチェックも修正しました。
    [#9262](https://github.com/ClickHouse/ClickHouse/pull/9262) [(tabplubix)](https://github.com/tavplubix)
- `*MergeTree` テーブルエンジンファミリーにおけるバックグラウンドマージが、ストレージポリシーのボリュームの順序をより正確に保持するようになりました。
    [#8549](https://github.com/ClickHouse/ClickHouse/pull/8549) ([Vladimir Chebotarev](https://github.com/excitoon))
- サフィックスを読み取った後、コミット前に例外が発生するというまれなケースで `Kafka` のデータが失われるのを防止しました。[#9378](https://github.com/ClickHouse/ClickHouse/issues/9378) を修正。関連: [#7175](https://github.com/ClickHouse/ClickHouse/issues/7175)
    [#9507](https://github.com/ClickHouse/ClickHouse/pull/9507) [(filimonov)](https://github.com/filimonov)
- 誤ったパラメータで作成された `Kafka` テーブルを使用／削除しようとした際にサーバーが終了してしまうバグを修正しました。[#9494](https://github.com/ClickHouse/ClickHouse/issues/9494) を修正。[#9507](https://github.com/ClickHouse/ClickHouse/issues/9507) を取り込みました。
    [#9513](https://github.com/ClickHouse/ClickHouse/pull/9513) [(filimonov)](https://github.com/filimonov)
- `Kafka` テーブルの上位にあるサブクエリで `MaterializedView` を使用できるようにしました。
    [#8197](https://github.com/ClickHouse/ClickHouse/pull/8197) ([filimonov](https://github.com/filimonov))

#### 新機能 \\{#new-feature-1\\}

- マテリアライズドビューを持つテーブルへの冪等な挿入の動作を制御するための `deduplicate_blocks_in_dependent_materialized_views` オプションを追加しました。この新機能は、Altinity からの特別な要望によりバグ修正リリースに追加されました。
    [#9070](https://github.com/ClickHouse/ClickHouse/pull/9070) [(urykhy)](https://github.com/urykhy)

### ClickHouse リリース 19.16.2.2, 2019-10-30 \\{#clickhouse-release-v19-16-2-2-2019-10-30\\}

#### 後方互換性のない変更 \\{#backward-incompatible-change-1\\}

- count/countIf に対する不足していた引数個数（arity）の検証を追加しました。
    [#7095](https://github.com/ClickHouse/ClickHouse/issues/7095)
    [#7298](https://github.com/ClickHouse/ClickHouse/pull/7298) ([Vdimir](https://github.com/Vdimir))
- レガシー設定 `asterisk_left_columns_only` を削除しました（デフォルトで無効化されていました）。
    [#7335](https://github.com/ClickHouse/ClickHouse/pull/7335) ([Artem
    Zuikov](https://github.com/4ertus2))
- Template データフォーマット用のフォーマット文字列は、ファイル内で指定するようになりました。
    [#7118](https://github.com/ClickHouse/ClickHouse/pull/7118)
    ([tavplubix](https://github.com/tavplubix))

#### 新機能 \\{#new-feature-2\\}

- UINT_MAX を超えるカーディナリティを計算するための uniqCombined64() を導入。
    [#7213](https://github.com/ClickHouse/ClickHouse/pull/7213),
    [#7222](https://github.com/ClickHouse/ClickHouse/pull/7222) ([Azat
    Khuzhin](https://github.com/azat))
- Array カラムに対する Bloom filter インデックスをサポート。
    [#6984](https://github.com/ClickHouse/ClickHouse/pull/6984)
    ([achimbab](https://github.com/achimbab))
- サーバー設定内の対応する `<macros>` の値を String として返す関数 `getMacro(name)` を追加。
    [#7240](https://github.com/ClickHouse/ClickHouse/pull/7240)
    ([alexey-milovidov](https://github.com/alexey-milovidov))
- HTTP ソースに基づくディクショナリ用に、`credentials` と
    `http-headers` の 2 つの設定オプションを追加。
    [#7092](https://github.com/ClickHouse/ClickHouse/pull/7092) ([Guillaume
    Tassery](https://github.com/YiuRULE))
- 起動されたバックグラウンドマージの回数をカウントする新しい ProfileEvent `Merge` を追加。
    [#7093](https://github.com/ClickHouse/ClickHouse/pull/7093) ([Mikhail
    Korotov](https://github.com/millb))
- 完全修飾ドメイン名を返す fullHostName 関数を追加。
    [#7263](https://github.com/ClickHouse/ClickHouse/issues/7263)
    [#7291](https://github.com/ClickHouse/ClickHouse/pull/7291) ([sundyli](https://github.com/sundy-li))
- 「切り取り」条件で配列を分割する `arraySplit` および `arrayReverseSplit` 関数を追加。
    時系列データの処理に有用。
    [#7294](https://github.com/ClickHouse/ClickHouse/pull/7294) ([hcz](https://github.com/hczhcz))
- multiMatch 系の関数において、一致したすべてのインデックスを含む Array を返す新しい関数を追加。
    [#7299](https://github.com/ClickHouse/ClickHouse/pull/7299) ([Danila
    Kutenin](https://github.com/danlark1))
- 多数の小さな -Log テーブルを保存するのに最適化された、新しいデータベースエンジン `Lazy` を追加。
    [#7171](https://github.com/ClickHouse/ClickHouse/pull/7171) ([Nikita
    Vasilev](https://github.com/nikvas0))
- ビットマップカラム向けの集約関数 groupBitmapAnd、-Or、-Xor を追加。
    [#7109](https://github.com/ClickHouse/ClickHouse/pull/7109) ([Zhichang
    Yu](https://github.com/yuzhichang))
- 集約対象が存在しない場合に null またはデフォルト値を返す集約関数コンビネータ -OrNull および -OrDefault を追加。
    [#7331](https://github.com/ClickHouse/ClickHouse/pull/7331)
    ([hcz](https://github.com/hczhcz))
- カスタムエスケープおよび区切りルールをサポートする CustomSeparated データ形式を導入。
    [#7118](https://github.com/ClickHouse/ClickHouse/pull/7118)
    ([tavplubix](https://github.com/tavplubix))
- 外部ディクショナリのソースとして Redis をサポート。
    [#4361](https://github.com/ClickHouse/ClickHouse/pull/4361) [#6962](https://github.com/ClickHouse/ClickHouse/pull/6962) ([comunodi](https://github.com/comunodi), [Anton
    Popov](https://github.com/CurtizJ))

#### バグ修正 \\{#bug-fix-2\\}

- `WHERE IN (SELECT ...)` セクションを含み、`optimize_read_in_order` が使用されている場合に誤ったクエリ結果が返される問題を修正しました。 [#7371](https://github.com/ClickHouse/ClickHouse/pull/7371) ([Anton
    Popov](https://github.com/CurtizJ))
- プロジェクト外のファイルに依存している MariaDB 認証プラグインを無効にしました。
    [#7140](https://github.com/ClickHouse/ClickHouse/pull/7140) ([Yuriy
    Baranov](https://github.com/yurriy))
- `now()`, `today()`,
    `yesterday()`, `randConstant()` 関数が使用されているときに、まれに発生することがあった例外 `Cannot convert column ... because it is constant but values of constants are different in source and result` を修正しました。
    [#7156](https://github.com/ClickHouse/ClickHouse/pull/7156) ([Nikolai
    Kochetov](https://github.com/KochetovNicolai))
- TCP keep-alive タイムアウトではなく HTTP keep-alive タイムアウトが使用されていた問題を修正しました。
    [#7351](https://github.com/ClickHouse/ClickHouse/pull/7351) ([Vasily
    Nemkov](https://github.com/Enmk))
- groupBitmapOr で発生するセグメンテーションフォルトを修正しました（issue [#7109](https://github.com/ClickHouse/ClickHouse/issues/7109)）。
    [#7289](https://github.com/ClickHouse/ClickHouse/pull/7289) ([Zhichang
    Yu](https://github.com/yuzhichang))
- マテリアライズドビューに対しては、すべてのデータが書き込まれた後に Kafka へのコミットが行われるようにしました。
    [#7175](https://github.com/ClickHouse/ClickHouse/pull/7175) ([Ivan](https://github.com/abyss7))
- `system.part_log` テーブル内の `duration_ms` の誤った値を修正しました。実際の値よりも 10 倍の誤差がありました。
    [#7172](https://github.com/ClickHouse/ClickHouse/pull/7172) ([Vladimir
    Chebotarev](https://github.com/excitoon))
- LIVE VIEW テーブルでのクラッシュを解消し、すべての LIVE VIEW テストを再度有効にするための簡易的な修正を行いました。
    [#7201](https://github.com/ClickHouse/ClickHouse/pull/7201)
    ([vzakaznikov](https://github.com/vzakaznikov))
- MergeTree パーツの min/max インデックスにおいて、NULL 値が正しくシリアライズされるようにしました。
    [#7234](https://github.com/ClickHouse/ClickHouse/pull/7234) ([Alexander
    Kuzmenkov](https://github.com/akuzm))
- テーブルが `CREATE TABLE AS` で作成される場合に、仮想カラムを .sql メタデータに含めないようにしました。
    [#7183](https://github.com/ClickHouse/ClickHouse/pull/7183) ([Ivan](https://github.com/abyss7))
- `ATTACH PART` クエリで発生するセグメンテーションフォルトを修正しました。
    [#7185](https://github.com/ClickHouse/ClickHouse/pull/7185)
    ([alesapin](https://github.com/alesapin))
- 空の IN サブクエリおよび空の INNER/RIGHT JOIN の最適化によって、一部のクエリで誤った結果が返される問題を修正しました。 [#7284](https://github.com/ClickHouse/ClickHouse/pull/7284) ([Nikolai
    Kochetov](https://github.com/KochetovNicolai))
- LIVE VIEW の getHeader() メソッドにおける AddressSanitizer エラーを修正しました。
    [#7271](https://github.com/ClickHouse/ClickHouse/pull/7271)
    ([vzakaznikov](https://github.com/vzakaznikov))

#### 改善 \\{#improvement-1\\}

- `queue_wait_max_ms` の待機が発生した場合にメッセージを出力。
    [#7390](https://github.com/ClickHouse/ClickHouse/pull/7390) ([Azat
    Khuzhin](https://github.com/azat))
- 設定 `s3_min_upload_part_size` をテーブルレベルの設定に変更。
    [#7059](https://github.com/ClickHouse/ClickHouse/pull/7059) ([Vladimir
    Chebotarev](https://github.com/excitoon))
- StorageFactory で有効期限 (TTL) をチェック。
    [#7304](https://github.com/ClickHouse/ClickHouse/pull/7304)
    ([sundyli](https://github.com/sundy-li))
- 部分マージ結合において左側ブロックをまとめて圧縮（最適化）。
    [#7122](https://github.com/ClickHouse/ClickHouse/pull/7122) ([Artem
    Zuikov](https://github.com/4ertus2))
- Replicated テーブルエンジンの mutation で非決定的な関数を許可しないように変更。これは
    レプリカ間の不整合を引き起こす可能性があるため。
    [#7247](https://github.com/ClickHouse/ClickHouse/pull/7247) ([Alexander
    Kazakov](https://github.com/Akazz))
- 例外スタックトレースを文字列に変換する際にメモリトラッカーを無効化。
    これにより、サーバー側で `Memory limit exceeded` 種別のエラーメッセージが失われ、
    クライアント側で `Attempt to read after eof` 例外を引き起こしていた問題を防止できる。
    [#7264](https://github.com/ClickHouse/ClickHouse/pull/7264)
    ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- 各種フォーマットを改善し、次の issue を解決。
    [#6033](https://github.com/ClickHouse/ClickHouse/issues/6033),
    [#2633](https://github.com/ClickHouse/ClickHouse/issues/2633),
    [#6611](https://github.com/ClickHouse/ClickHouse/issues/6611),
    [#6742](https://github.com/ClickHouse/ClickHouse/issues/6742)
    [#7215](https://github.com/ClickHouse/ClickHouse/pull/7215)
    ([tavplubix](https://github.com/tavplubix))
- ClickHouse は、`IN` 演算子の右辺にあって左辺の型に変換できない値を無視していた。
    複合型（Array および Tuple）でも正しく動作するように修正。
    [#7283](https://github.com/ClickHouse/ClickHouse/pull/7283) ([Alexander
    Kuzmenkov](https://github.com/akuzm))
- ASOF JOIN に対して不足していた不等比較演算をサポート。
    ON 句の構文で、ASOF 列に対して「以下」バリアントおよび厳密な「より大きい」「より小さい」
    バリアントで結合できるようになった。
    [#7282](https://github.com/ClickHouse/ClickHouse/pull/7282) ([Artem
    Zuikov](https://github.com/4ertus2))
- 部分マージ結合を最適化。
    [#7070](https://github.com/ClickHouse/ClickHouse/pull/7070)
    ([Artem Zuikov](https://github.com/4ertus2))
- `uniqCombined` 関数で 98 KB を超えるメモリを使用しないように変更。
    [#7236](https://github.com/ClickHouse/ClickHouse/pull/7236),
    [#7270](https://github.com/ClickHouse/ClickHouse/pull/7270) ([Azat
    Khuzhin](https://github.com/azat))
- メモリが不足している場合、PartialMergeJoin で右側の結合テーブルの一部を
    ディスクに書き出すように変更。必要に応じてデータを再読み込み。
    [#7186](https://github.com/ClickHouse/ClickHouse/pull/7186)
    ([Artem Zuikov](https://github.com/4ertus2))

#### パフォーマンスの改善 \\{#performance-improvement-1\\}

- データの重複を避けることで、定数引数を持つ `joinGet` を高速化。
    [#7359](https://github.com/ClickHouse/ClickHouse/pull/7359) ([Amos
    Bird](https://github.com/amosbird))
- サブクエリが空の場合は早期に復帰するように変更。
    [#7007](https://github.com/ClickHouse/ClickHouse/pull/7007) ([小路](https://github.com/nicelulu))
- `Values` 内の SQL 式のパースを最適化。
    [#6781](https://github.com/ClickHouse/ClickHouse/pull/6781)
    ([tavplubix](https://github.com/tavplubix))

#### ビルド／テスト／パッケージングの改善 \\{#buildtestingpackaging-improvement-1\\}

* Mac OS 向けのクロスコンパイルで一部の contrib を無効化。
  [#7101](https://github.com/ClickHouse/ClickHouse/pull/7101) ([Ivan](https://github.com/abyss7))
* clickhouse&#95;common&#95;io に対する PocoXML への不足していたリンクを追加。
  [#7200](https://github.com/ClickHouse/ClickHouse/pull/7200) ([Azat
  Khuzhin](https://github.com/azat))
* clickhouse-test で複数のテストフィルター引数を受け付けるようにする。
  [#7226](https://github.com/ClickHouse/ClickHouse/pull/7226) ([Alexander
  Kuzmenkov](https://github.com/akuzm))
* ARM 向けに musl と jemalloc を有効化。 [#7300](https://github.com/ClickHouse/ClickHouse/pull/7300)
  ([Amos Bird](https://github.com/amosbird))
* `clickhouse-test` に `--client-option` パラメータを追加し、クライアントに追加のパラメータを指定できるようにしました。
  [#7277](https://github.com/ClickHouse/ClickHouse/pull/7277) ([Nikolai
  Kochetov](https://github.com/KochetovNicolai))
* rpm パッケージのアップグレード時に既存の設定を保持するようになりました。
  [#7103](https://github.com/ClickHouse/ClickHouse/pull/7103)
  ([filimonov](https://github.com/filimonov))
* PVS が検出したエラーを修正。 [#7153](https://github.com/ClickHouse/ClickHouse/pull/7153) ([Artem
  Zuikov](https://github.com/4ertus2))
* Darwin 向けビルドを修正。 [#7149](https://github.com/ClickHouse/ClickHouse/pull/7149)
  ([Ivan](https://github.com/abyss7))
* glibc 2.29 との互換性。[#7142](https://github.com/ClickHouse/ClickHouse/pull/7142) ([Amos
  Bird](https://github.com/amosbird))
* `dh_clean` が候補となり得るソースファイルを処理しないようにする。
  [#7205](https://github.com/ClickHouse/ClickHouse/pull/7205) ([Amos
  Bird](https://github.com/amosbird))
* altinity RPM からの更新時に競合が発生しないように対応しました。設定ファイルは clickhouse-server-common で別パッケージとして提供されています。
  [#7073](https://github.com/ClickHouse/ClickHouse/pull/7073)
  ([filimonov](https://github.com/filimonov))
* 一部のヘッダーファイルを最適化し、再ビルド時間を短縮しました。
  [#7212](https://github.com/ClickHouse/ClickHouse/pull/7212),
  [#7231](https://github.com/ClickHouse/ClickHouse/pull/7231) ([Alexander
  Kuzmenkov](https://github.com/akuzm))
* Date と DateTime 型のパフォーマンステストを追加。[#7332](https://github.com/ClickHouse/ClickHouse/pull/7332) ([Vasily
  Nemkov](https://github.com/Enmk))
* 非決定的な変更を含んでいた一部のテストを修正。
  [#7132](https://github.com/ClickHouse/ClickHouse/pull/7132) ([Alexander
  Kazakov](https://github.com/Akazz))
* MemorySanitizer を有効にしたビルドを CI に追加。 [#7066](https://github.com/ClickHouse/ClickHouse/pull/7066)
  ([Alexander Kuzmenkov](https://github.com/akuzm))
* MetricsTransmitter で未初期化値が使用されないようにしました。
  [#7158](https://github.com/ClickHouse/ClickHouse/pull/7158) ([Azat
  Khuzhin](https://github.com/azat))
* MemorySanitizer によって検出された Fields のいくつかの問題を修正しました。
  [#7135](https://github.com/ClickHouse/ClickHouse/pull/7135),
  [#7179](https://github.com/ClickHouse/ClickHouse/pull/7179) ([Alexander
  Kuzmenkov](https://github.com/akuzm)), [#7376](https://github.com/ClickHouse/ClickHouse/pull/7376)
  ([Amos Bird](https://github.com/amosbird))
* murmurhash32 の未定義の動作を修正。 [#7388](https://github.com/ClickHouse/ClickHouse/pull/7388) ([Amos
  Bird](https://github.com/amosbird))
* StoragesInfoStream の未定義動作を修正 [#7384](https://github.com/ClickHouse/ClickHouse/pull/7384)
  ([tavplubix](https://github.com/tavplubix))
* 外部データベースエンジン（MySQL、ODBC、JDBC）に対する定数式のフォールディング処理を修正しました。以前のバージョンでは、複数の定数式に対しては機能せず、また Date、DateTime、UUID 型ではまったく機能していませんでした。これにより [#7245](https://github.com/ClickHouse/ClickHouse/issues/7245)
  [#7252](https://github.com/ClickHouse/ClickHouse/pull/7252)
  （[alexey-milovidov](https://github.com/alexey-milovidov)）が修正されました。
* LIVE VIEW で no&#95;users&#95;thread 変数にアクセスする際に ThreadSanitizer が報告するデータレースを修正。
  [#7353](https://github.com/ClickHouse/ClickHouse/pull/7353)
  ([vzakaznikov](https://github.com/vzakaznikov))
* libcommon の malloc シンボルを削除
  [#7134](https://github.com/ClickHouse/ClickHouse/pull/7134),
  [#7065](https://github.com/ClickHouse/ClickHouse/pull/7065) ([Amos
  Bird](https://github.com/amosbird))
* すべてのライブラリを無効化するためのグローバルフラグ ENABLE&#95;LIBRARIES を追加しました。
  [#7063](https://github.com/ClickHouse/ClickHouse/pull/7063)
  ([proller](https://github.com/proller))

#### コードのクリーンアップ \\{#code-cleanup\\}

- 辞書の DDL に備えて設定リポジトリを汎用化。
  [#7155](https://github.com/ClickHouse/ClickHouse/pull/7155)
    ([alesapin](https://github.com/alesapin))
- 意味解析を行わない辞書用 DDL パーサーを追加。
    [#7209](https://github.com/ClickHouse/ClickHouse/pull/7209)
    ([alesapin](https://github.com/alesapin))
- `ParserCreateQuery` を複数の小さいパーサーに分割。
    [#7253](https://github.com/ClickHouse/ClickHouse/pull/7253)
    ([alesapin](https://github.com/alesapin))
- 外部辞書まわりの小さなリファクタリングとリネーム。
    [#7111](https://github.com/ClickHouse/ClickHouse/pull/7111)
    ([alesapin](https://github.com/alesapin))
- ロールベースアクセス制御に備えて一部コードをリファクタリング。
  [#7235](https://github.com/ClickHouse/ClickHouse/pull/7235) ([Vitaly
    Baranov](https://github.com/vitlibar))
- `DatabaseOrdinary` のコードにいくつかの改善を実施。
    [#7086](https://github.com/ClickHouse/ClickHouse/pull/7086) ([Nikita
    Vasilev](https://github.com/nikvas0))
- ハッシュテーブルの `find()` および `emplace()` メソッドでイテレータを使用しないように変更。
    [#7026](https://github.com/ClickHouse/ClickHouse/pull/7026) ([Alexander
    Kuzmenkov](https://github.com/akuzm))
- パラメータ root が空でない場合の `getMultipleValuesFromConfig` の不具合を修正。
  [#7374](https://github.com/ClickHouse/ClickHouse/pull/7374)
    ([Mikhail Korotov](https://github.com/millb))
- 一部のコピーペーストコード（`TemporaryFile` と `TemporaryFileStream`）を削除。
    [#7166](https://github.com/ClickHouse/ClickHouse/pull/7166) ([Artem
    Zuikov](https://github.com/4ertus2))
- コードの可読性をわずかに改善（`MergeTreeData::getActiveContainingPart`）。
    [#7361](https://github.com/ClickHouse/ClickHouse/pull/7361) ([Vladimir
    Chebotarev](https://github.com/excitoon))
- `ThreadPool::schedule(...)` が例外をスローする場合、ローカルオブジェクトを使用しているすべてのスケジュール済みジョブを待機するように変更。
    `ThreadPool::schedule(...)` の名前を `ThreadPool::scheduleOrThrowOnError(...)` に変更し、
    例外をスローする可能性があることが明確になるようコメントを修正。
    [#7350](https://github.com/ClickHouse/ClickHouse/pull/7350)
    ([tavplubix](https://github.com/tavplubix))

## ClickHouse リリース 19.15 \\{#clickhouse-release-19-15\\}

### ClickHouse リリース 19.15.4.10, 2019-10-31 \\{#clickhouse-release-19-15-4-10-2019-10-31\\}

#### バグ修正 \\{#bug-fix-3\\}

- ODBC Bridge において、SQL_TINYINT と SQL_BIGINT の処理を追加し、SQL_FLOAT データソース型の処理を修正。
    [#7491](https://github.com/ClickHouse/ClickHouse/pull/7491) ([Denis Glazachev](https://github.com/traceon))
- MOVE PARTITION で、宛先ディスクまたはボリューム上に一部のパーツが既に存在していても許可するようにした。
    [#7434](https://github.com/ClickHouse/ClickHouse/pull/7434) ([Vladimir Chebotarev](https://github.com/excitoon))
- ODBC Bridge 経由の Nullable カラムにおける NULL 値の扱いを修正。
    [#7402](https://github.com/ClickHouse/ClickHouse/pull/7402) ([Vasily Nemkov](https://github.com/Enmk))
- MATERIALIZED カラムを持つ Distributed の非ローカルノードへの INSERT を修正。
    [#7377](https://github.com/ClickHouse/ClickHouse/pull/7377) ([Azat Khuzhin](https://github.com/azat))
- 関数 getMultipleValuesFromConfig を修正。
    [#7374](https://github.com/ClickHouse/ClickHouse/pull/7374) ([Mikhail Korotov](https://github.com/millb))
- TCP keep alive タイムアウトの代わりに HTTP keep alive タイムアウトを使用していた問題を修正。
    [#7351](https://github.com/ClickHouse/ClickHouse/pull/7351) ([Vasily Nemkov](https://github.com/Enmk))
- 例外発生時にすべてのジョブが完了するのを待機するようにした（まれなセグメンテーションフォルトを修正）。
    [#7350](https://github.com/ClickHouse/ClickHouse/pull/7350) ([tavplubix](https://github.com/tavplubix))
- Kafka テーブルへの挿入時に、マテリアライズドビューへプッシュしないようにした。
    [#7265](https://github.com/ClickHouse/ClickHouse/pull/7265) ([Ivan](https://github.com/abyss7))
- 例外スタックに対してはメモリトラッカーを無効化。
    [#7264](https://github.com/ClickHouse/ClickHouse/pull/7264) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- 外部データベース向けにクエリを変換するコードの不具合を修正。
    [#7252](https://github.com/ClickHouse/ClickHouse/pull/7252) ([alexey-milovidov](https://github.com/alexey-milovidov))
- MetricsTransmitter で未初期化の値を使用しないようにした。
    [#7158](https://github.com/ClickHouse/ClickHouse/pull/7158) ([Azat Khuzhin](https://github.com/azat))
- テスト用のマクロ付きサンプル設定を追加。
    ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.15.3.6, 2019-10-09 \\{#clickhouse-release-19-15-3-6-2019-10-09\\}

#### バグ修正 \\{#bug-fix-4\\}

- ハッシュ辞書における bad_variant を修正。
    ([alesapin](https://github.com/alesapin))
- ATTACH PART クエリでセグメンテーションフォルトが発生するバグを修正。
    ([alesapin](https://github.com/alesapin))
- `MergeTreeData` における時間計算を修正。
    ([Vladimir Chebotarev](https://github.com/excitoon))
- 書き込みが完了した後に、Kafka へのコミットを明示的に実行するようにした。
    [#7175](https://github.com/ClickHouse/ClickHouse/pull/7175) ([Ivan](https://github.com/abyss7))
- MergeTree パーツの min/max インデックスで NULL 値を正しくシリアライズするようにした。
    [#7234](https://github.com/ClickHouse/ClickHouse/pull/7234) ([Alexander Kuzmenkov](https://github.com/akuzm))

### ClickHouse リリース 19.15.2.2, 2019-10-01 \\{#clickhouse-release-19-15-2-2-2019-10-01\\}

#### 新機能 \\{#new-feature-3\\}

- 階層ストレージ: MergeTree エンジンを使用するテーブルに対して複数のストレージボリュームを利用するためのサポート。新しいデータを SSD に保存し、古いデータを自動的に HDD に移動できます。([例](https://clickhouse.github.io/clickhouse-presentations/meetup30/new_features/#12)) [#4918](https://github.com/ClickHouse/ClickHouse/pull/4918) ([Igr](https://github.com/ObjatieGroba)) [#6489](https://github.com/ClickHouse/ClickHouse/pull/6489) ([alesapin](https://github.com/alesapin))
- `INSERT SELECT` クエリで入力データを読み取るためのテーブル関数 `input` を追加。 [#5450](https://github.com/ClickHouse/ClickHouse/pull/5450) ([palasonic1](https://github.com/palasonic1)) [#6832](https://github.com/ClickHouse/ClickHouse/pull/6832) ([Anton Popov](https://github.com/CurtizJ))
- `hashed` レイアウトと機能的には同等だが、よりメモリ効率の高い `sparse_hashed` 辞書レイアウトを追加。値の取得が遅くなる代わりに、メモリ使用量は約半分になります。 [#6894](https://github.com/ClickHouse/ClickHouse/pull/6894) ([Azat Khuzhin](https://github.com/azat))
- 辞書へアクセス可能なユーザーのリストを定義できるように実装。現在は接続中のデータベースでのみ使用されます。 [#6907](https://github.com/ClickHouse/ClickHouse/pull/6907) ([Guillaume Tassery](https://github.com/YiuRULE))
- `SHOW` クエリに `LIMIT` オプションを追加。 [#6944](https://github.com/ClickHouse/ClickHouse/pull/6944) ([Philipp Malkovsky](https://github.com/malkfilipp))
- 集合内で `range_start` 以上である要素のうち最小の `limit` 個の値の部分集合を返す `bitmapSubsetLimit(bitmap, range_start, limit)` 関数を追加。 [#6957](https://github.com/ClickHouse/ClickHouse/pull/6957) ([Zhichang Yu](https://github.com/yuzhichang))
- `bitmapMin` および `bitmapMax` 関数を追加。 [#6970](https://github.com/ClickHouse/ClickHouse/pull/6970) ([Zhichang Yu](https://github.com/yuzhichang))
- [issue-6648](https://github.com/ClickHouse/ClickHouse/issues/6648) に関連する関数 `repeat` を追加。 [#6999](https://github.com/ClickHouse/ClickHouse/pull/6999) ([flynn](https://github.com/ucasFL))

#### 実験的機能 \\{#experimental-feature-1\\}

- 現在のパイプラインを変更しない（メモリ内の）Merge Join のバリアントを実装。結果はマージキーで部分的にソートされます。この機能を使用するには `partial_merge_join = 1` を設定します。Merge Join はまだ開発中です。 [#6940](https://github.com/ClickHouse/ClickHouse/pull/6940) ([Artem Zuikov](https://github.com/4ertus2))
- `S3` エンジンとテーブル関数を追加。まだ開発中であり（認証は未サポート）です。 [#5596](https://github.com/ClickHouse/ClickHouse/pull/5596) ([Vladimir Chebotarev](https://github.com/excitoon))

#### 改善 \\{#improvement-2\\}

- Kafka から読み取られた各メッセージはアトミックに挿入されます。これにより、Kafka エンジンに関する既知のほとんどの問題が解決されます。 [#6950](https://github.com/ClickHouse/ClickHouse/pull/6950) ([Ivan](https://github.com/abyss7))
- 分散クエリのフェイルオーバーを改善。復旧時間が短縮され、さらに設定可能になり、`system.clusters` で確認できるようになりました。 [#6399](https://github.com/ClickHouse/ClickHouse/pull/6399) ([Vasily Nemkov](https://github.com/Enmk))
- `IN` 句で Enum に対する数値を直接サポート。#6766 [#6941](https://github.com/ClickHouse/ClickHouse/pull/6941) ([dimarub2000](https://github.com/dimarub2000))
- URL ストレージでのリダイレクトをサポート（オプションで、デフォルトでは無効）。 [#6914](https://github.com/ClickHouse/ClickHouse/pull/6914) ([maqroll](https://github.com/maqroll))
- 古いバージョンのクライアントがサーバーに接続した際に情報メッセージを追加。 [#6893](https://github.com/ClickHouse/ClickHouse/pull/6893) ([Philipp Malkovsky](https://github.com/malkfilipp))
- Distributed テーブルでデータを送信する際の最大バックオフスリープ時間の制限を削除。 [#6895](https://github.com/ClickHouse/ClickHouse/pull/6895) ([Azat Khuzhin](https://github.com/azat))
- プロファイルイベント（カウンタ）を累積値として graphite に送信できるようにしました。サーバーの `config.xml` 内の `<events_cumulative>` で有効化できます。 [#6969](https://github.com/ClickHouse/ClickHouse/pull/6969) ([Azat Khuzhin](https://github.com/azat))
- HTTP 経由の Native 形式で `LowCardinality(T)` 型のカラムにデータを挿入する際に、型 `T` を自動的に `LowCardinality(T)` にキャストする機能を追加。 [#6891](https://github.com/ClickHouse/ClickHouse/pull/6891) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- `Float32`、`Float64` に対して `reinterpretAsString` を使用せずに関数 `hex` を使用できるようにしました。 [#7024](https://github.com/ClickHouse/ClickHouse/pull/7024) ([Mikhail Korotov](https://github.com/millb))

#### ビルド/テスト/パッケージングの改善 \\{#buildtestingpackaging-improvement-2\\}

- デバッグ情報付きの clickhouse バイナリに gdb-index を追加。これにより `gdb` の起動時間が短縮されます。 [#6947](https://github.com/ClickHouse/ClickHouse/pull/6947) ([alesapin](https://github.com/alesapin))
- `pigz` を使用するようにパッチ適用した dpkg-deb により deb パッケージングを高速化。 [#6960](https://github.com/ClickHouse/ClickHouse/pull/6960) ([alesapin](https://github.com/alesapin))
- `enable_fuzzing = 1` を設定して、プロジェクト全コードに対する libfuzzer のインストルメンテーションを有効化。 [#7042](https://github.com/ClickHouse/ClickHouse/pull/7042) ([kyprizel](https://github.com/kyprizel))
- CI に split build のスモークテストを追加。 [#7061](https://github.com/ClickHouse/ClickHouse/pull/7061) ([alesapin](https://github.com/alesapin))
- CI に MemorySanitizer を用いたビルドを追加。 [#7066](https://github.com/ClickHouse/ClickHouse/pull/7066) ([Alexander Kuzmenkov](https://github.com/akuzm))
- `libsparsehash` を `sparsehash-c11` に置き換え。 [#6965](https://github.com/ClickHouse/ClickHouse/pull/6965) ([Azat Khuzhin](https://github.com/azat))

#### バグ修正 \\{#bug-fix-5\\}

- 大きなテーブル上の複雑なキーに対するインデックス解析のパフォーマンス低下を修正しました。#6924 を修正します。 [#7075](https://github.com/ClickHouse/ClickHouse/pull/7075) ([alexey-milovidov](https://github.com/alexey-milovidov))
- Kafka の空のトピックからの SELECT 時にセグメンテーションフォルトを引き起こしていた論理エラーを修正しました。 [#6909](https://github.com/ClickHouse/ClickHouse/pull/6909) ([Ivan](https://github.com/abyss7))
- `MySQLBlockInputStream.cpp` において MySQL 接続が早期にクローズされてしまう問題を修正しました。 [#6882](https://github.com/ClickHouse/ClickHouse/pull/6882) ([Clément Rodriguez](https://github.com/clemrodriguez))
- 非常に古い Linux カーネルのサポートを再度有効にしました（[#6841](https://github.com/ClickHouse/ClickHouse/issues/6841) の修正）。 [#6853](https://github.com/ClickHouse/ClickHouse/pull/6853) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 入力ストリームに空のブロックが存在する場合に `insert select` クエリで発生し得るデータ損失の問題を修正しました。#6834 #6862 [#6911](https://github.com/ClickHouse/ClickHouse/pull/6911) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- パラメータに空配列を含む場合の関数 `АrrayEnumerateUniqRanked` の不具合を修正しました。 [#6928](https://github.com/ClickHouse/ClickHouse/pull/6928) ([proller](https://github.com/proller))
- ARRAY JOIN およびグローバルサブクエリを含む複雑なクエリに関する不具合を修正しました。 [#6934](https://github.com/ClickHouse/ClickHouse/pull/6934) ([Ivan](https://github.com/abyss7))
- 複数の JOIN を含む ORDER BY および GROUP BY で発生していた `Unknown identifier` エラーを修正しました。 [#7022](https://github.com/ClickHouse/ClickHouse/pull/7022) ([Artem Zuikov](https://github.com/4ertus2))
- `LowCardinality` 引数を取る関数の実行時に発生していた `MSan` 警告を修正しました。 [#7062](https://github.com/ClickHouse/ClickHouse/pull/7062) ([Nikolai Kochetov](https://github.com/KochetovNicolai))

#### 後方互換性のない変更 \\{#backward-incompatible-change-2\\}

- パフォーマンス向上のため、bitmap\* 集約関数の状態のシリアライズ形式を変更しました。以前のバージョンでシリアライズされた bitmap\* の状態は読み取ることができません。 [#6908](https://github.com/ClickHouse/ClickHouse/pull/6908) ([Zhichang Yu](https://github.com/yuzhichang))

## ClickHouse リリース 19.14 \\{#clickhouse-release-19-14\\}

### ClickHouse リリース 19.14.7.15, 2019-10-02 \\{#clickhouse-release-19-14-7-15-2019-10-02\\}

#### バグ修正 \\{#bug-fix-6\\}

- このリリースには、19.11.12.69 のすべてのバグ修正も含まれています。
- 19.14 とそれ以前のバージョン間の分散クエリの互換性を修正しました。これにより [#7068](https://github.com/ClickHouse/ClickHouse/issues/7068) が解決されています。 [#7069](https://github.com/ClickHouse/ClickHouse/pull/7069) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.14.6.12, 2019-09-19 \\{#clickhouse-release-19-14-6-12-2019-09-19\\}

#### バグ修正 \\{#bug-fix-7\\}

- パラメータに空配列が渡された場合の関数 `АrrayEnumerateUniqRanked` の動作を修正しました。 [#6928](https://github.com/ClickHouse/ClickHouse/pull/6928) ([proller](https://github.com/proller))
- `ARRAY JOIN` およびエイリアス付きの `GLOBAL IN subquery` を含むクエリにおけるサブクエリ名を修正しました。サブクエリのエイリアスが指定されている場合は、そのエイリアスを外部テーブル名として使用します。 [#6934](https://github.com/ClickHouse/ClickHouse/pull/6934) ([Ivan](https://github.com/abyss7))

#### ビルド/テスト/パッケージングの改善 \\{#buildtestingpackaging-improvement-3\\}

- ミューテーションの適用を待つ必要があるため、シェルスクリプトに書き換えることで、[flapping](https://clickhouse-test-reports.s3.yandex.net/6944/aab95fd5175a513413c7395a73a82044bdafb906/functional_stateless_tests_(debug).html) テスト `00715_fetch_merged_or_mutated_part_zookeeper` を修正しました。 [#6977](https://github.com/ClickHouse/ClickHouse/pull/6977) ([Alexander Kazakov](https://github.com/Akazz))
- 空の配列引数を取る関数 `groupUniqArray` における UBSan および MemSan のエラーを修正しました。これは、ゼロセル値のコンストラクタが呼び出されていなかったため、空の `PaddedPODArray` をハッシュテーブルのゼロセルに配置していたことが原因です。 [#6937](https://github.com/ClickHouse/ClickHouse/pull/6937) ([Amos Bird](https://github.com/amosbird))

### ClickHouse リリース 19.14.3.3, 2019-09-10 \\{#clickhouse-release-19-14-3-3-2019-09-10\\}

#### 新機能 \\{#new-feature-4\\}

* `ORDER BY` 向けの `WITH FILL` 修飾子。([#5069](https://github.com/ClickHouse/ClickHouse/issues/5069) の続き) [#6610](https://github.com/ClickHouse/ClickHouse/pull/6610) ([Anton Popov](https://github.com/CurtizJ))
* `LIMIT` 用の `WITH TIES` 修飾子。（[#5069](https://github.com/ClickHouse/ClickHouse/issues/5069) の続き） [#6610](https://github.com/ClickHouse/ClickHouse/pull/6610) ([Anton Popov](https://github.com/CurtizJ))
* クオートされていない `NULL` リテラルを NULL としてパースします（設定 `format_csv_unquoted_null_literal_as_null=1` の場合）。このフィールドのデータ型が Nullable 型でない場合は、NULL フィールドをデフォルト値で初期化します（設定 `input_format_null_as_default=1` の場合）。 [#5990](https://github.com/ClickHouse/ClickHouse/issues/5990) [#6055](https://github.com/ClickHouse/ClickHouse/pull/6055) ([tavplubix](https://github.com/tavplubix))
* テーブル関数 `file` および `hdfs` のパスでワイルドカードがサポートされるようになりました。パスにワイルドカードが含まれている場合、テーブルは読み取り専用として扱われます。使用例：`select * from hdfs('hdfs://hdfs1:9000/some_dir/another_dir/*/file{0..9}{0..9}')` および `select * from file('some_dir/{some_file,another_file,yet_another}.tsv', 'TSV', 'value UInt32')`。 [#6092](https://github.com/ClickHouse/ClickHouse/pull/6092)（[Olga Khvostikova](https://github.com/stavrolia)）
* 新しい `system.metric_log` テーブル。指定した時間間隔で `system.events` と `system.metrics` の値を保存します。 [#6363](https://github.com/ClickHouse/ClickHouse/issues/6363) [#6467](https://github.com/ClickHouse/ClickHouse/pull/6467) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)) [#6530](https://github.com/ClickHouse/ClickHouse/pull/6530) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ClickHouse のテキストログを `system.text_log` テーブルに書き込めるようになりました。 [#6037](https://github.com/ClickHouse/ClickHouse/issues/6037) [#6103](https://github.com/ClickHouse/ClickHouse/pull/6103) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov)) [#6164](https://github.com/ClickHouse/ClickHouse/pull/6164) ([alexey-milovidov](https://github.com/alexey-milovidov))
* スタックトレースにプライベートシンボルを表示できるようにしました（ELF ファイルのシンボルテーブルをパースすることで実現）。デバッグ情報が存在する場合、スタックトレースにファイル名および行番号を追加しました。プログラム内に存在するシンボルをインデックス化することで、シンボル名のルックアップを高速化しました。イントロスペクション用の新しい SQL 関数 `demangle` および `addressToLine` を追加しました。一貫性のため、関数 `symbolizeAddress` を `addressToSymbol` にリネームしました。関数 `addressToSymbol` はパフォーマンス上の理由からマングル済みの名前を返すため、`demangle` を適用する必要があります。デフォルトでは無効になっている設定 `allow_introspection_functions` を追加しました。 [#6201](https://github.com/ClickHouse/ClickHouse/pull/6201) ([alexey-milovidov](https://github.com/alexey-milovidov))
* テーブル関数 `values`（名前の大文字・小文字は区別されません）。この関数を使用すると、[#5984](https://github.com/ClickHouse/ClickHouse/issues/5984) で提案された `VALUES` リストから読み取ることができます。例: `SELECT * FROM VALUES('a UInt64, s String', (1, 'one'), (2, 'two'), (3, 'three'))`。[#6217](https://github.com/ClickHouse/ClickHouse/issues/6217)。[#6209](https://github.com/ClickHouse/ClickHouse/pull/6209)（[dimarub2000](https://github.com/dimarub2000)）
* ストレージ設定を変更できるようになりました。構文：`ALTER TABLE <table> MODIFY SETTING <setting> = <value>`. [#6366](https://github.com/ClickHouse/ClickHouse/pull/6366) [#6669](https://github.com/ClickHouse/ClickHouse/pull/6669) [#6685](https://github.com/ClickHouse/ClickHouse/pull/6685) ([alesapin](https://github.com/alesapin))
* デタッチされたパーツを削除する機能をサポートしました。構文: `ALTER TABLE <table_name> DROP DETACHED PART '<part_id>'`。[#6158](https://github.com/ClickHouse/ClickHouse/pull/6158) ([tavplubix](https://github.com/tavplubix))
* テーブル制約。テーブル定義に制約を追加でき、挿入時に検査されます。 [#5273](https://github.com/ClickHouse/ClickHouse/pull/5273) ([Gleb Novikov](https://github.com/NanoBjorn)) [#6652](https://github.com/ClickHouse/ClickHouse/pull/6652) ([alexey-milovidov](https://github.com/alexey-milovidov))
* カスケードマテリアライズドビューのサポート。 [#6324](https://github.com/ClickHouse/ClickHouse/pull/6324) ([Amos Bird](https://github.com/amosbird))
* デフォルトでクエリプロファイラを有効にし、すべてのクエリ実行スレッドを1秒ごとにサンプリングするようにしました。 [#6283](https://github.com/ClickHouse/ClickHouse/pull/6283) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 入力フォーマット `ORC` を追加。 [#6454](https://github.com/ClickHouse/ClickHouse/pull/6454) [#6703](https://github.com/ClickHouse/ClickHouse/pull/6703) ([akonyaev90](https://github.com/akonyaev90))
* 2 つの新しい関数 `sigmoid` と `tanh` を追加しました（機械学習用途で有用です）。 [#6254](https://github.com/ClickHouse/ClickHouse/pull/6254) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 関数 `hasToken(haystack, token)`、`hasTokenCaseInsensitive(haystack, token)` は、指定した token が haystack に含まれているかどうかを判定します。token は、2 つの英数字以外の ASCII 文字（または haystack の境界）に挟まれた、最大長の部分文字列です。token は定数文字列である必要があります。`tokenbf&#95;v1` インデックスの特殊化でサポートされています。 [#6596](https://github.com/ClickHouse/ClickHouse/pull/6596), [#6662](https://github.com/ClickHouse/ClickHouse/pull/6662) ([Vasily Nemkov](https://github.com/Enmk))
* 新しい関数 `neighbor(value, offset[, default_value])`。データブロック内の列において、直前／直後の値にアクセスできるようにします。 [#5925](https://github.com/ClickHouse/ClickHouse/pull/5925) ([Alex Krash](https://github.com/alex-krash)) [6685365ab8c5b74f9650492c88a012596eb1b0c6](https://github.com/ClickHouse/ClickHouse/commit/6685365ab8c5b74f9650492c88a012596eb1b0c6) [341e2e4587a18065c2da1ca888c73389f48ce36c](https://github.com/ClickHouse/ClickHouse/commit/341e2e4587a18065c2da1ca888c73389f48ce36c) [Alexey Milovidov](https://github.com/alexey-milovidov)
* 認証済みユーザーのログイン名を返す関数 `currentUser()` を追加しました。MySQL との互換性のためにエイリアス `user()` を追加しました。 [#6470](https://github.com/ClickHouse/ClickHouse/pull/6470) ([Alex Krash](https://github.com/alex-krash))
* [#5885](https://github.com/ClickHouse/ClickHouse/issues/5885) で提案された新しい集約関数 `quantilesExactInclusive` と `quantilesExactExclusive`。[#6477](https://github.com/ClickHouse/ClickHouse/pull/6477) ([dimarub2000](https://github.com/dimarub2000))
* `bitmapRange(bitmap, range_begin, range_end)` 関数は、指定した範囲（`range_end` は含まない）の要素からなる新しい集合を返します。 [#6314](https://github.com/ClickHouse/ClickHouse/pull/6314) ([Zhichang Yu](https://github.com/yuzhichang))
* 関数 `geohashesInBox(longitude_min, latitude_min, longitude_max, latitude_max, precision)` は、指定された領域をカバーする geohash ボックスを表す、precision 文字の文字列からなる配列を作成します。 [#6127](https://github.com/ClickHouse/ClickHouse/pull/6127) ([Vasily Nemkov](https://github.com/Enmk))
* `Kafka` テーブルに対する INSERT クエリのサポートを実装しました。 [#6012](https://github.com/ClickHouse/ClickHouse/pull/6012) ([Ivan](https://github.com/abyss7))
* Kafka エンジンに `_partition` および `_timestamp` 仮想カラムのサポートを追加しました。 [#6400](https://github.com/ClickHouse/ClickHouse/pull/6400) ([Ivan](https://github.com/abyss7))
* `query_log`、サーバーログ、プロセスリストから、正規表現ベースのルールを使って機密データを削除できるようにしました。[#5710](https://github.com/ClickHouse/ClickHouse/pull/5710) ([filimonov](https://github.com/filimonov))

#### 実験的機能 \\{#experimental-feature-2\\}

- 入出力データ形式 `Template`。入力および出力に対してカスタムフォーマット文字列を指定できます。[#4354](https://github.com/ClickHouse/ClickHouse/issues/4354) [#6727](https://github.com/ClickHouse/ClickHouse/pull/6727) ([tavplubix](https://github.com/tavplubix))
- `LIVE VIEW` テーブルの実装。これはもともと [#2898](https://github.com/ClickHouse/ClickHouse/pull/2898) で提案され、[#3925](https://github.com/ClickHouse/ClickHouse/issues/3925) で準備され、その後 [#5541](https://github.com/ClickHouse/ClickHouse/issues/5541) で更新されました。詳細な説明については [#5541](https://github.com/ClickHouse/ClickHouse/issues/5541) を参照してください。[#5541](https://github.com/ClickHouse/ClickHouse/issues/5541) ([vzakaznikov](https://github.com/vzakaznikov)) [#6425](https://github.com/ClickHouse/ClickHouse/pull/6425) ([Nikolai Kochetov](https://github.com/KochetovNicolai)) [#6656](https://github.com/ClickHouse/ClickHouse/pull/6656) ([vzakaznikov](https://github.com/vzakaznikov)) なお、`LIVE VIEW` 機能は今後のバージョンで削除される可能性があります。

#### バグ修正 \\{#bug-fix-8\\}

* このリリースには、19.13 および 19.11 のすべてのバグ修正も含まれています。
* テーブルにスキップインデックスがあり、垂直マージが行われた際にセグメンテーションフォルトが発生する問題を修正。 [#6723](https://github.com/ClickHouse/ClickHouse/pull/6723) ([alesapin](https://github.com/alesapin))
* 複雑なカラムデフォルトを持つカラムごとの TTL を修正しました。以前は、`OPTIMIZE ... FINAL` クエリによって TTL マージを強制した場合、期限切れの値がユーザー指定のカラムデフォルトではなく、型のデフォルト値で置き換えられていました。 [#6796](https://github.com/ClickHouse/ClickHouse/pull/6796) ([Anton Popov](https://github.com/CurtizJ))
* 通常のサーバー再起動時に発生する Kafka メッセージの重複問題を修正。 [#6597](https://github.com/ClickHouse/ClickHouse/pull/6597) ([Ivan](https://github.com/abyss7))
* Kafka メッセージの読み取り時に発生していた無限ループを修正しました。サブスクリプション時にはコンシューマの一時停止／再開を一切行わないようにしました。そうしないと、特定の状況ではコンシューマが無期限に一時停止されたままになる可能性があるためです。 [#6354](https://github.com/ClickHouse/ClickHouse/pull/6354) ([Ivan](https://github.com/abyss7))
* `bitmapContains` 関数で発生する `Key expression contains comparison between inconvertible types` という例外の問題を修正しました。 [#6136](https://github.com/ClickHouse/ClickHouse/issues/6136) [#6146](https://github.com/ClickHouse/ClickHouse/issues/6146) [#6156](https://github.com/ClickHouse/ClickHouse/pull/6156) ([dimarub2000](https://github.com/dimarub2000))
* `optimize_skip_unused_shards` 有効時にシャーディングキー未指定の場合に発生していたセグメンテーションフォルトを修正。 [#6384](https://github.com/ClickHouse/ClickHouse/pull/6384) ([Anton Popov](https://github.com/CurtizJ))
* メモリ破損を引き起こす可能性のあった mutation で使用されていた誤ったコードを修正しました。`system.parts` または `system.parts_columns` からの `SELECT` と `DROP TABLE` の同時実行によって発生しうる、アドレス `0x14c0` の読み取り時のセグメンテーションフォルトを修正しました。mutation クエリの準備処理で発生していた競合状態を修正しました。Replicated テーブルの `OPTIMIZE` と ALTER などの同時変更操作によって発生していたデッドロックを修正しました。 [#6514](https://github.com/ClickHouse/ClickHouse/pull/6514) ([alexey-milovidov](https://github.com/alexey-milovidov))
* MySQL インターフェイスでの不要に冗長なログ出力を削除しました [#6389](https://github.com/ClickHouse/ClickHouse/pull/6389) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 設定ファイル内で、&#39;true&#39; および &#39;false&#39; からブール値設定を解析できる機能を復元しました。 [#6278](https://github.com/ClickHouse/ClickHouse/pull/6278) ([alesapin](https://github.com/alesapin))
* `Nullable(Decimal128)` で発生する `quantile` および `median` 関数のクラッシュを修正。 [#6378](https://github.com/ClickHouse/ClickHouse/pull/6378) ([Artem Zuikov](https://github.com/4ertus2))
* 主キーに対する `WHERE` 句で Float 型への変換を含む `SELECT` クエリが、不完全な結果を返す可能性があった問題を修正しました。原因は、`toFloat` 関数における単調性の判定が誤っていたためです。 [#6248](https://github.com/ClickHouse/ClickHouse/issues/6248) [#6374](https://github.com/ClickHouse/ClickHouse/pull/6374) ([dimarub2000](https://github.com/dimarub2000))
* ミューテーション用の `max_expanded_ast_elements` 設定を確認します。`TRUNCATE TABLE` 実行後にミューテーションをクリアします。 [#6205](https://github.com/ClickHouse/ClickHouse/pull/6205) ([Winter Zhang](https://github.com/zhang2014))
* `join_use_nulls` を使用した場合のキー列に対する JOIN の結果を修正しました。列のデフォルト値ではなく NULL を設定するようにしました。 [#6249](https://github.com/ClickHouse/ClickHouse/pull/6249) ([Artem Zuikov](https://github.com/4ertus2))
* vertical merge および ALTER におけるスキップインデックスの問題を修正。`Bad size of marks file` 例外を修正。 [#6594](https://github.com/ClickHouse/ClickHouse/issues/6594) [#6713](https://github.com/ClickHouse/ClickHouse/pull/6713) ([alesapin](https://github.com/alesapin))
* マージ対象/変更対象のパーツのどちらかが空（0 行）の場合に発生する `ALTER MODIFY COLUMN` および垂直マージのまれなクラッシュを修正 [#6746](https://github.com/ClickHouse/ClickHouse/issues/6746) [#6780](https://github.com/ClickHouse/ClickHouse/pull/6780) ([alesapin](https://github.com/alesapin))
* `AggregateFunctionFactory` における `LowCardinality` 型の変換バグを修正しました。これにより [#6257](https://github.com/ClickHouse/ClickHouse/issues/6257) が解決されました。 [#6281](https://github.com/ClickHouse/ClickHouse/pull/6281) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* `topK` および `topKWeighted` 集約関数における誤った動作と、セグメンテーションフォルトを引き起こしうる問題を修正しました。 [#6404](https://github.com/ClickHouse/ClickHouse/pull/6404) ([Anton Popov](https://github.com/CurtizJ))
* `getIdentifier` 関数周辺の安全でないコードを修正。 [#6401](https://github.com/ClickHouse/ClickHouse/issues/6401) [#6409](https://github.com/ClickHouse/ClickHouse/pull/6409) ([alexey-milovidov](https://github.com/alexey-milovidov))
* MySQL クライアントから ClickHouse に接続する際に使用される MySQL ワイヤプロトコルのバグを修正しました。原因は `PacketPayloadWriteBuffer` におけるヒープバッファオーバーフローでした。 [#6212](https://github.com/ClickHouse/ClickHouse/pull/6212) ([Yuriy Baranov](https://github.com/yurriy))
* `bitmapSubsetInRange` 関数のメモリリークを修正しました。 [#6819](https://github.com/ClickHouse/ClickHouse/pull/6819) ([Zhichang Yu](https://github.com/yuzhichang))
* 粒度変更後に実行されたミューテーションでまれに発生するバグを修正。 [#6816](https://github.com/ClickHouse/ClickHouse/pull/6816) ([alesapin](https://github.com/alesapin))
* デフォルトで全フィールドを含む protobuf メッセージを許可。 [#6132](https://github.com/ClickHouse/ClickHouse/pull/6132) ([Vitaly Baranov](https://github.com/vitlibar))
* `nullIf` 関数において、第 2 引数として `NULL` を渡した場合に発生するバグを修正。 [#6446](https://github.com/ClickHouse/ClickHouse/pull/6446) ([Guillaume Tassery](https://github.com/YiuRULE))
* 文字列フィールドを含む複合キーキャッシュディクショナリにおいて、誤ったメモリの割り当て／解放処理によりメモリを無制限に消費してしまう（メモリリークのように見える）まれなバグを修正。バグは、文字列長が 8 から始まる 2 の累乗（8, 16, 32 など）の場合に再現する。[#6447](https://github.com/ClickHouse/ClickHouse/pull/6447) ([alesapin](https://github.com/alesapin))
* 短いシーケンスに対する Gorilla エンコーディングの不具合を修正し、`Cannot write after end of buffer` という例外が発生していた問題を解消しました。 [#6398](https://github.com/ClickHouse/ClickHouse/issues/6398) [#6444](https://github.com/ClickHouse/ClickHouse/pull/6444) ([Vasily Nemkov](https://github.com/Enmk))
* `join_use_nulls` が有効な場合でも、JOIN で NULL 非許容型を使用できるようにしました。 [#6705](https://github.com/ClickHouse/ClickHouse/pull/6705) ([Artem Zuikov](https://github.com/4ertus2))
* `clickhouse-client` のクエリ内での `Poco::AbstractConfiguration` による置換を無効化。 [#6706](https://github.com/ClickHouse/ClickHouse/pull/6706) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `REPLACE PARTITION` でのデッドロックの発生を回避。 [#6677](https://github.com/ClickHouse/ClickHouse/pull/6677) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `arrayReduce` を定数引数に対して使用すると、セグメンテーションフォルトが発生する可能性があります。 [#6242](https://github.com/ClickHouse/ClickHouse/issues/6242) [#6326](https://github.com/ClickHouse/ClickHouse/pull/6326) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `DROP PARTITION` の後にレプリカを復元した場合に一貫性のないパーツが現れることがある問題を修正。 [#6522](https://github.com/ClickHouse/ClickHouse/issues/6522) [#6523](https://github.com/ClickHouse/ClickHouse/pull/6523) ([tavplubix](https://github.com/tavplubix))
* `JSONExtractRaw` 関数がハングする問題を修正しました。 [#6195](https://github.com/ClickHouse/ClickHouse/issues/6195) [#6198](https://github.com/ClickHouse/ClickHouse/pull/6198) ([alexey-milovidov](https://github.com/alexey-milovidov))
* adaptive granularity 使用時における skip indices の誤ったシリアライゼーションおよび集約に関するバグを修正。 [#6594](https://github.com/ClickHouse/ClickHouse/issues/6594). [#6748](https://github.com/ClickHouse/ClickHouse/pull/6748) ([alesapin](https://github.com/alesapin))
* 二段階の集約を行う `GROUP BY` における `WITH ROLLUP` および `WITH CUBE` 修飾子を修正しました。 [#6225](https://github.com/ClickHouse/ClickHouse/pull/6225) ([Anton Popov](https://github.com/CurtizJ))
* アダプティブグラニュラリティ使用時のセカンダリインデックスのマークの書き込みに関するバグを修正。 [#6126](https://github.com/ClickHouse/ClickHouse/pull/6126) ([alesapin](https://github.com/alesapin))
* サーバー起動時の初期化順序を修正しました。`StorageMergeTree::background_task_handle` は `startup()` 内で初期化されるため、初期化が完了する前に `MergeTreeBlockOutputStream::write()` がそれを使用しようとする可能性があります。そのため、初期化済みかどうかを確認するようにしました。 [#6080](https://github.com/ClickHouse/ClickHouse/pull/6080) ([Ivan](https://github.com/abyss7))
* エラーで終了した前回の読み取り処理で使用したデータバッファをクリアするようにしました。 [#6026](https://github.com/ClickHouse/ClickHouse/pull/6026) ([Nikolay](https://github.com/bopohaa))
* Replicated*MergeTree テーブルの新しいレプリカを作成する際に `adaptive granularity` を有効にする処理に関する不具合を修正。 [#6394](https://github.com/ClickHouse/ClickHouse/issues/6394) [#6452](https://github.com/ClickHouse/ClickHouse/pull/6452) ([alesapin](https://github.com/alesapin))
* サーバー起動時に、初期化されていない `ThreadStatus` 構造体へのアクセス中に発生した例外を処理する際、`libunwind` 内でさらに例外が発生するとクラッシュする可能性があった問題を修正しました。 [#6456](https://github.com/ClickHouse/ClickHouse/pull/6456) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))
* `yandexConsistentHash` 関数で発生していたクラッシュを修正。fuzz テストで検出されました。 [#6304](https://github.com/ClickHouse/ClickHouse/issues/6304) [#6305](https://github.com/ClickHouse/ClickHouse/pull/6305) ([alexey-milovidov](https://github.com/alexey-milovidov))
* サーバーが過負荷になり、グローバルスレッドプールがほぼ上限に達した状態のときにクエリがハングする可能性があった問題を修正しました。分散クエリは各シャードへの接続ごとに 1 スレッドを割り当てるため、この問題はシャード数が多い（数百シャード規模の）クラスタで発生しやすくなります。たとえば、330 シャードのクラスタで 30 個の分散クエリを同時に処理している場合に、この問題が発生する可能性があります。この問題は 19.2 以降のすべてのバージョンに影響します。 [#6301](https://github.com/ClickHouse/ClickHouse/pull/6301) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `arrayEnumerateUniqRanked` 関数のロジックを修正しました。 [#6423](https://github.com/ClickHouse/ClickHouse/pull/6423) ([alexey-milovidov](https://github.com/alexey-milovidov))
* シンボルテーブルのデコード時に発生するセグメンテーションフォルトを修正。 [#6603](https://github.com/ClickHouse/ClickHouse/pull/6603) ([Amos Bird](https://github.com/amosbird))
* `LowCardinality(Nullable)` を Null を含まない Nullable ではない列にキャストする際に発生していた不要な例外を修正しました（例：`SELECT CAST(CAST('Hello' AS LowCardinality(Nullable(String))) AS String)` のようなクエリ）。 [#6094](https://github.com/ClickHouse/ClickHouse/issues/6094) [#6119](https://github.com/ClickHouse/ClickHouse/pull/6119) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* `system.settings` テーブル内の description 列に対して行われていた余分な引用符付けを削除しました。 [#6696](https://github.com/ClickHouse/ClickHouse/issues/6696) [#6699](https://github.com/ClickHouse/ClickHouse/pull/6699) ([alexey-milovidov](https://github.com/alexey-milovidov))
* Replicated テーブルの `TRUNCATE` で発生しうるデッドロックを回避。 [#6695](https://github.com/ClickHouse/ClickHouse/pull/6695) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ソートキー順での読み出し処理を修正。 [#6189](https://github.com/ClickHouse/ClickHouse/pull/6189) ([Anton Popov](https://github.com/CurtizJ))
* `enable_mixed_granularity_parts=1` のテーブルに対する `ALTER TABLE ... UPDATE` クエリを修正。 [#6543](https://github.com/ClickHouse/ClickHouse/pull/6543) ([alesapin](https://github.com/alesapin))
* [#4405](https://github.com/ClickHouse/ClickHouse/pull/4405)（19.4.0 以降）で報告されたバグを修正。MergeTree テーブル上の Distributed テーブルに対するクエリで、どのカラムも参照しないクエリ（`SELECT 1`）を実行した場合に発生する。[#6236](https://github.com/ClickHouse/ClickHouse/pull/6236)（[alesapin](https://github.com/alesapin)）
* 符号付き型から符号なし型への整数除算におけるオーバーフローを修正しました。動作は C や C++ 言語（整数型の昇格規則）とまったく同じであり、意外に感じられるかもしれません。なお、大きな符号付き整数を大きな符号なし整数で割る場合、あるいはその逆の場合には依然としてオーバーフローが発生し得ます（ただし、そのケースはあまり一般的ではありません）。この問題はすべてのサーバーバージョンに存在していました。 [#6214](https://github.com/ClickHouse/ClickHouse/issues/6214) [#6233](https://github.com/ClickHouse/ClickHouse/pull/6233) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `max_execution_speed` または `max_execution_speed_bytes` が設定されている場合のスロットリング動作時におけるスリープ時間の上限を制限しました。`Estimated query execution time (inf seconds) is too long` のような誤検知のエラーを修正しました。 [#5547](https://github.com/ClickHouse/ClickHouse/issues/5547) [#6232](https://github.com/ClickHouse/ClickHouse/pull/6232) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `MaterializedView` における `MATERIALIZED` カラムおよびエイリアスの使用に関する問題を修正。[#448](https://github.com/ClickHouse/ClickHouse/issues/448) [#3484](https://github.com/ClickHouse/ClickHouse/issues/3484) [#3450](https://github.com/ClickHouse/ClickHouse/issues/3450) [#2878](https://github.com/ClickHouse/ClickHouse/issues/2878) [#2285](https://github.com/ClickHouse/ClickHouse/issues/2285) [#3796](https://github.com/ClickHouse/ClickHouse/pull/3796) ([Amos Bird](https://github.com/amosbird)) [#6316](https://github.com/ClickHouse/ClickHouse/pull/6316) ([alexey-milovidov](https://github.com/alexey-milovidov))
* プロセッサとして実装されていない入力ストリームに対する `FormatFactory` の挙動を修正。 [#6495](https://github.com/ClickHouse/ClickHouse/pull/6495) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 誤字を修正しました。 [#6631](https://github.com/ClickHouse/ClickHouse/pull/6631) ([Alex Ryndin](https://github.com/alexryndin))
* エラーメッセージ内の誤植 (is → are)。 [#6839](https://github.com/ClickHouse/ClickHouse/pull/6839) ([Denis Zhuravlev](https://github.com/den-crane))
* 型にカンマが含まれている場合、文字列からカラムリストを解析する際に発生していたエラーを修正しました（この問題は `File`、`URL`、`HDFS` ストレージで発生していました）[#6217](https://github.com/ClickHouse/ClickHouse/issues/6217)。 [#6209](https://github.com/ClickHouse/ClickHouse/pull/6209) ([dimarub2000](https://github.com/dimarub2000))

#### セキュリティ修正 \\{#security-fix\\}

- このリリースには、19.13 および 19.11 のすべてのセキュリティ関連バグ修正も含まれています。
- SQL パーサーにおいて、細工されたクエリによりスタックオーバーフローが発生してサーバーがクラッシュする可能性を修正しました。Merge テーブルおよび Distributed テーブル、マテリアライズドビュー、サブクエリを含む行レベルセキュリティ条件におけるスタックオーバーフローの可能性も修正しました。 [#6433](https://github.com/ClickHouse/ClickHouse/pull/6433) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### 改善 \\{#improvement-3\\}

* `AND/OR` のための三値論理に基づく正しい実装。 [#6048](https://github.com/ClickHouse/ClickHouse/pull/6048) ([Alexander Kazakov](https://github.com/Akazz))
* これで、TTL 期限切れの値や行は、TTL 情報を持たない古いパーツや古い TTL 情報を持つパーツから、`ALTER ... MODIFY TTL` クエリ実行後などに `OPTIMIZE ... FINAL` クエリを実行することで削除されるようになりました。TTL を伴うマージの割り当ておよび、すべてのマージにおける期限切れ値のフィルタリングを禁止／許可するための `SYSTEM STOP/START TTL MERGES` クエリが追加されました。 [#6274](https://github.com/ClickHouse/ClickHouse/pull/6274) ([Anton Popov](https://github.com/CurtizJ))
* クライアントが使用する ClickHouse の履歴ファイルの保存先を `CLICKHOUSE_HISTORY_FILE` 環境変数で変更可能に。 [#6840](https://github.com/ClickHouse/ClickHouse/pull/6840) ([filimonov](https://github.com/filimonov))
* `InterpreterSelectQuery` から `dry_run` フラグを削除しました。... [#6375](https://github.com/ClickHouse/ClickHouse/pull/6375) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* `ON` 句を伴う `ASOF JOIN` をサポートしました。 [#6211](https://github.com/ClickHouse/ClickHouse/pull/6211) ([Artem Zuikov](https://github.com/4ertus2))
* ミューテーションおよびレプリケーションに対するスキップインデックスのサポートを改善しました。`MATERIALIZE/CLEAR INDEX ... IN PARTITION` クエリをサポートしました。`UPDATE x = x` は、カラム `x` を使用するすべてのインデックスを再計算します。 [#5053](https://github.com/ClickHouse/ClickHouse/pull/5053) ([Nikita Vasilev](https://github.com/nikvas0))
* `allow_experimental_live_view` 設定に関係なく、ライブビューを（たとえばサーバー起動時に）`ATTACH` できるようにしました。 [#6754](https://github.com/ClickHouse/ClickHouse/pull/6754) ([alexey-milovidov](https://github.com/alexey-milovidov))
* クエリプロファイラで収集されたスタックトレースから、クエリプロファイラ自身が生成したスタックフレームを除外するようにしました。 [#6250](https://github.com/ClickHouse/ClickHouse/pull/6250) ([alexey-milovidov](https://github.com/alexey-milovidov))
* テーブル関数 `values`、`file`、`url`、`hdfs` が ALIAS 列をサポートするようになりました。 [#6255](https://github.com/ClickHouse/ClickHouse/pull/6255) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `config.d` ファイルに、設定ファイルと同じルート要素が含まれていない場合は、例外をスローします。 [#6123](https://github.com/ClickHouse/ClickHouse/pull/6123) ([dimarub2000](https://github.com/dimarub2000))
* `no space left on device` 発生時の例外メッセージに追加情報を含めるようにしました。 [#6182](https://github.com/ClickHouse/ClickHouse/issues/6182), [#6252](https://github.com/ClickHouse/ClickHouse/issues/6252) [#6352](https://github.com/ClickHouse/ClickHouse/pull/6352) ([tavplubix](https://github.com/tavplubix))
* 読み取りクエリで対象とする `Distributed` テーブルのシャードを決定する際（`optimize_skip_unused_shards` = 1 の場合）、ClickHouse は SELECT 文の `prewhere` 句と `where` 句の両方の条件を確認するようになりました。 [#6521](https://github.com/ClickHouse/ClickHouse/pull/6521) ([Alexander Kazakov](https://github.com/Akazz))
* AVX2 は搭載していないが SSE 4.2 と PCLMUL 命令セットは備えているマシン向けに `SIMDJSON` を有効化しました。 [#6285](https://github.com/ClickHouse/ClickHouse/issues/6285) [#6320](https://github.com/ClickHouse/ClickHouse/pull/6320) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ClickHouse は、追加のチューニングなしで、`O_DIRECT` をサポートしないファイルシステム（ZFS や BtrFS など）上でも動作できます。 [#4449](https://github.com/ClickHouse/ClickHouse/issues/4449) [#6730](https://github.com/ClickHouse/ClickHouse/pull/6730) ([alexey-milovidov](https://github.com/alexey-milovidov))
* final サブクエリへの述語プッシュダウンをサポート。 [#6120](https://github.com/ClickHouse/ClickHouse/pull/6120) ([TCeason](https://github.com/TCeason)) [#6162](https://github.com/ClickHouse/ClickHouse/pull/6162) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `JOIN ON` キー抽出の改善 [#6131](https://github.com/ClickHouse/ClickHouse/pull/6131) ([Artem Zuikov](https://github.com/4ertus2))
* `SIMDJSON` を更新しました。 [#6285](https://github.com/ClickHouse/ClickHouse/issues/6285)。 [#6306](https://github.com/ClickHouse/ClickHouse/pull/6306) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `SELECT count()` クエリ向けに、最小サイズのカラムを選択する処理を最適化。 [#6344](https://github.com/ClickHouse/ClickHouse/pull/6344) ([Amos Bird](https://github.com/amosbird))
* `windowFunnel()` に `strict` パラメータを追加しました。`strict` が有効な場合、`windowFunnel()` は一意の値に対してのみ条件を適用します。 [#6548](https://github.com/ClickHouse/ClickHouse/pull/6548) ([achimbab](https://github.com/achimbab))
* `mysqlxx::Pool` のより安全なインターフェース。 [#6150](https://github.com/ClickHouse/ClickHouse/pull/6150) ([avasiliev](https://github.com/avasiliev))
* `--help` オプションで実行した際のオプション一覧の行幅が、ターミナルのサイズに応じて自動的に調整されるようになりました。 [#6590](https://github.com/ClickHouse/ClickHouse/pull/6590) ([dimarub2000](https://github.com/dimarub2000))
* キーなしの集約に対する「read in order」最適化を無効化。 [#6599](https://github.com/ClickHouse/ClickHouse/pull/6599) ([Anton Popov](https://github.com/CurtizJ))
* `INCORRECT_DATA` および `TYPE_MISMATCH` エラーコードに対する HTTP ステータスコードは、デフォルトの `500 Internal Server Error` から `400 Bad Request` に変更されました。 [#6271](https://github.com/ClickHouse/ClickHouse/pull/6271) ([Alexander Rodin](https://github.com/a-rodin))
* `Join` オブジェクトを `ExpressionAction` から `AnalyzedJoin` に移動しました。`ExpressionAnalyzer` と `ExpressionAction` はもはや `Join` クラスを意識しません。そのロジックは `AnalyzedJoin` インターフェースの背後に隠蔽されています。 [#6801](https://github.com/ClickHouse/ClickHouse/pull/6801) ([Artem Zuikov](https://github.com/4ertus2))
* 1 つのシャードが localhost であるにもかかわらず、クエリがネットワーク接続経由で送信される場合に発生しうる分散クエリのデッドロックの可能性を修正。 [#6759](https://github.com/ClickHouse/ClickHouse/pull/6759) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 複数テーブルに対する `RENAME` のセマンティクスを変更し、デッドロックが発生し得る状況を避けるようにしました。 [#6757](https://github.com/ClickHouse/ClickHouse/issues/6757)。 [#6756](https://github.com/ClickHouse/ClickHouse/pull/6756) ([alexey-milovidov](https://github.com/alexey-milovidov))
* MySQL 互換サーバーの実装を見直し、パケットのペイロード全体をメモリに読み込まないようにしました。各接続でのメモリ消費量をおよそ `2 * DBMS_DEFAULT_BUFFER_SIZE`（読み取り/書き込みバッファ）にまで削減しました。 [#5811](https://github.com/ClickHouse/ClickHouse/pull/5811) ([Yuriy Baranov](https://github.com/yurriy))
* クエリのセマンティクスを知る必要のないパーサーの外に、AST エイリアス解釈ロジックを移動。 [#6108](https://github.com/ClickHouse/ClickHouse/pull/6108) ([Artem Zuikov](https://github.com/4ertus2))
* `NamesAndTypesList` のパースをより安全にしました。 [#6408](https://github.com/ClickHouse/ClickHouse/issues/6408). [#6410](https://github.com/ClickHouse/ClickHouse/pull/6410) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `clickhouse-copier`: パーティションの存在を確認するクエリでも、設定内の `where_condition` で定義した `partition_key` エイリアスを使用できるようにしました（以前はデータ読み取りクエリでのみ使用されていました）。 [#6577](https://github.com/ClickHouse/ClickHouse/pull/6577) ([proller](https://github.com/proller))
* `throwIf` にオプションのメッセージ引数を追加しました。 ([#5772](https://github.com/ClickHouse/ClickHouse/issues/5772)) [#6329](https://github.com/ClickHouse/ClickHouse/pull/6329) ([Vdimir](https://github.com/Vdimir))
* データ挿入中に発生したサーバー側の例外が、クライアント側でも処理されるようになりました。 [#5891](https://github.com/ClickHouse/ClickHouse/issues/5891) [#6711](https://github.com/ClickHouse/ClickHouse/pull/6711) ([dimarub2000](https://github.com/dimarub2000))
* メトリクス `DistributedFilesToInsert` を追加しました。これは、Distributed テーブルによってリモートサーバーへ送信するために選択されたファイルシステム上のファイルの総数を示します。この値はすべてのシャードの合計です。 [#6600](https://github.com/ClickHouse/ClickHouse/pull/6600) ([alexey-milovidov](https://github.com/alexey-milovidov))
* JOIN の準備ロジックの大部分を `ExpressionAction/ExpressionAnalyzer` から `AnalyzedJoin` に移動。 [#6785](https://github.com/ClickHouse/ClickHouse/pull/6785) ([Artem Zuikov](https://github.com/4ertus2))
* TSan の[警告](https://clickhouse-test-reports.s3.yandex.net/6399/c1c1d1daa98e199e620766f1bd06a5921050a00d/functional_stateful_tests_\(thread\).html)「lock-order-inversion」を修正。 [#6740](https://github.com/ClickHouse/ClickHouse/pull/6740) ([Vasily Nemkov](https://github.com/Enmk))
* Linux のケーパビリティ不足に関する情報メッセージを改善しました。致命的なエラーを `fatal` レベルでログに記録するようにし、`system.text_log` で検索しやすくしました。 [#6441](https://github.com/ClickHouse/ClickHouse/pull/6441) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `GROUP BY`、`ORDER BY` の実行中にメモリ使用量を制限するために一時データをディスクへダンプする機能を有効にした場合でも、空きディスク容量を検査していませんでした。この不具合は、新しい設定項目 `min_free_disk_space` を追加することで修正され、空きディスク容量がこの閾値を下回る場合にはクエリを停止して `ErrorCodes::NOT_ENOUGH_SPACE` をスローするようになりました。 [#6678](https://github.com/ClickHouse/ClickHouse/pull/6678) ([Weiqing Xu](https://github.com/weiqxu)) [#6691](https://github.com/ClickHouse/ClickHouse/pull/6691) ([alexey-milovidov](https://github.com/alexey-milovidov))
* スレッドごとの再帰的な rwlock を削除しました。スレッドはクエリ間で再利用されるため、この仕組みには意味がありません。`SELECT` クエリはあるスレッドでロックを取得し、別のスレッドで取得したロックを保持したまま最初のスレッドの処理を抜ける可能性があります。その間に、最初のスレッドが `DROP` クエリで再利用されることがあります。これにより、誤って「Attempt to acquire exclusive lock recursively」というメッセージが出力されてしまいます。[#6771](https://github.com/ClickHouse/ClickHouse/pull/6771)（[alexey-milovidov](https://github.com/alexey-milovidov)）
* `ExpressionAnalyzer.appendJoin()` を分割し、`ExpressionAnalyzer` 内に `MergeJoin` 用の場所を用意。 [#6524](https://github.com/ClickHouse/ClickHouse/pull/6524) ([Artem Zuikov](https://github.com/4ertus2))
* MySQL互換サーバーに `mysql_native_password` 認証プラグインを追加しました。 [#6194](https://github.com/ClickHouse/ClickHouse/pull/6194) ([Yuriy Baranov](https://github.com/yurriy))
* `clock_gettime` の呼び出し回数を削減し、`Allocator` におけるデバッグ版とリリース版間の ABI 互換性を修正（影響の小さい問題）。 [#6197](https://github.com/ClickHouse/ClickHouse/pull/6197) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `collectUsedColumns` を `ExpressionAnalyzer` から `SyntaxAnalyzer` に移動しました。`SyntaxAnalyzer` は、`required_source_columns` を自前で生成するようになりました。 [#6416](https://github.com/ClickHouse/ClickHouse/pull/6416) ([Artem Zuikov](https://github.com/4ertus2))
* `FROM` 句に複数のテーブルが存在する場合（つまり JOIN を含むクエリ）に、サブセレクトおよびテーブル関数にエイリアスを必須とする設定 `joined_subquery_requires_alias` を追加。 [#6733](https://github.com/ClickHouse/ClickHouse/pull/6733) ([Artem Zuikov](https://github.com/4ertus2))
* `ExpressionAnalyzer` から `GetAggregatesVisitor` クラスを切り出し。 [#6458](https://github.com/ClickHouse/ClickHouse/pull/6458) ([Artem Zuikov](https://github.com/4ertus2))
* `system.query_log`: `type` 列のデータ型を `Enum` 型に変更。 [#6265](https://github.com/ClickHouse/ClickHouse/pull/6265) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))
* `sha256_password` 認証プラグインの静的リンク。 [#6512](https://github.com/ClickHouse/ClickHouse/pull/6512) ([Yuriy Baranov](https://github.com/yurriy))
* 設定 `compile` の動作に追加の依存関係が不要になりました。以前のバージョンでは、`cannot open crti.o`、`unable to find library -lc` などのエラーが発生する場合がありました。 [#6309](https://github.com/ClickHouse/ClickHouse/pull/6309) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 悪意のあるレプリカから送られてくる可能性のある入力に対する検証を強化。 [#6303](https://github.com/ClickHouse/ClickHouse/pull/6303) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 現在は、`clickhouse-obfuscator` ファイルは `clickhouse-client` パッケージに含まれています。以前のバージョンでは、`clickhouse obfuscator`（空白あり）として提供されていました。[#5816](https://github.com/ClickHouse/ClickHouse/issues/5816) [#6609](https://github.com/ClickHouse/ClickHouse/pull/6609) ([dimarub2000](https://github.com/dimarub2000))
* 少なくとも 2 つのクエリがあり、それらが 2 つ以上のテーブルを異なる順序で読み取り、さらに別のクエリがそのテーブルの 1 つに対して DDL 操作を実行する場合に発生するデッドロックを修正しました。別の非常にまれなデッドロックも修正しました。 [#6764](https://github.com/ClickHouse/ClickHouse/pull/6764) ([alexey-milovidov](https://github.com/alexey-milovidov))
* デバッグを容易にするため、`system.processes` および `system.query_log` に `os_thread_ids` カラムを追加しました。 [#6763](https://github.com/ClickHouse/ClickHouse/pull/6763) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `sha256_password` がデフォルトの認証プラグインとして使用されている場合に発生する PHP mysqlnd 拡張機能のバグに対する回避策（[#6031](https://github.com/ClickHouse/ClickHouse/issues/6031) で説明されています）。[#6113](https://github.com/ClickHouse/ClickHouse/pull/6113)（[Yuriy Baranov](https://github.com/yurriy)）
* null 許容性が変更されたカラムに関する不要な処理を削除。 [#6693](https://github.com/ClickHouse/ClickHouse/pull/6693) ([Artem Zuikov](https://github.com/4ertus2))
* `queue_max_wait_ms` のデフォルト値を 0 に変更しました。現在の値（5 秒）は妥当ではなく、この設定が有用となる状況はごくまれです。あいまいさを避けるために、`replace_running_query_max_wait_ms`、`kafka_max_wait_ms`、`connection_pool_max_wait_ms` の各設定を追加しました。 [#6692](https://github.com/ClickHouse/ClickHouse/pull/6692) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `ExpressionAnalyzer` から `SelectQueryExpressionAnalyzer` を抽出しました。`ExpressionAnalyzer` は非 SELECT クエリ用として残します。 [#6499](https://github.com/ClickHouse/ClickHouse/pull/6499) ([Artem Zuikov](https://github.com/4ertus2))
* 重複していた入力および出力フォーマットを削除しました。 [#6239](https://github.com/ClickHouse/ClickHouse/pull/6239) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 接続時にユーザーが `poll_interval` と `idle_connection_timeout` の設定を上書きできるようにしました。 [#6230](https://github.com/ClickHouse/ClickHouse/pull/6230) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `MergeTree` に、新たなオプション `ttl_only_drop_parts`（デフォルトでは無効）が追加されました。これはパーツの部分的なプルーニングを防ぎ、パーツ内のすべての行が期限切れになったときに、そのパーツ全体が削除されるようにするためのものです。 [#6191](https://github.com/ClickHouse/ClickHouse/pull/6191) ([Sergi Vladykin](https://github.com/svladykin))
* set index 関数に対する型チェックを追加。関数が誤った型を受け取った場合は例外をスローする。これにより UBSan を用いたファジングテストの失敗が修正される。 [#6511](https://github.com/ClickHouse/ClickHouse/pull/6511) ([Nikita Vasilev](https://github.com/nikvas0))

#### パフォーマンスの改善 \\{#performance-improvement-2\\}

- `MergeTree` テーブルで、ソートキーと先頭部分（プレフィックス）が一致する `expressions` を持つ場合に、`ORDER BY expressions` 句を用いたクエリを最適化しました。この最適化は `optimize_read_in_order` 設定で制御されます。 [#6054](https://github.com/ClickHouse/ClickHouse/pull/6054) [#6629](https://github.com/ClickHouse/ClickHouse/pull/6629) ([Anton Popov](https://github.com/CurtizJ))
- パーツの読み込みおよび削除処理で複数スレッドを使用可能にしました。 [#6372](https://github.com/ClickHouse/ClickHouse/issues/6372) [#6074](https://github.com/ClickHouse/ClickHouse/issues/6074) [#6438](https://github.com/ClickHouse/ClickHouse/pull/6438) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 集約関数状態を更新するバッチ方式の処理を実装しました。これによりパフォーマンス向上が見込めます。 [#6435](https://github.com/ClickHouse/ClickHouse/pull/6435) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 関数 `exp`、`log`、`sigmoid`、`tanh` に `FastOps` ライブラリを使用しました。FastOps は Michael Parakhin (Yandex CTO) による高速ベクトル数値計算ライブラリです。`exp` および `log` 関数の性能が 6 倍以上向上しました。`Float32` 引数に対する `exp` および `log` 関数は `Float32` を返すようになりました（以前のバージョンでは常に `Float64` を返していました）。現在は `exp(nan)` が `inf` を返す場合があります。`exp` および `log` 関数の結果は、真の解に対する機械表現可能な最も近い数値ではない場合があります。 [#6254](https://github.com/ClickHouse/ClickHouse/pull/6254) ([alexey-milovidov](https://github.com/alexey-milovidov)) FastOps を動作させるために Danila Kutenin によるバリアントを使用しました。 [#6317](https://github.com/ClickHouse/ClickHouse/pull/6317) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `UInt8/16` に対する連続キー最適化を無効化しました。 [#6298](https://github.com/ClickHouse/ClickHouse/pull/6298) [#6701](https://github.com/ClickHouse/ClickHouse/pull/6701) ([akuzm](https://github.com/akuzm))
- `ParsedJson::Iterator` で動的メモリアロケーションを排除することで、`simdjson` ライブラリのパフォーマンスを改善しました。 [#6479](https://github.com/ClickHouse/ClickHouse/pull/6479) ([Vitaly Baranov](https://github.com/vitlibar))
- `mmap()` によるメモリアロケーション時にページを事前にフォルトインするようにしました。 [#6667](https://github.com/ClickHouse/ClickHouse/pull/6667) ([akuzm](https://github.com/akuzm))
- `Decimal` の比較におけるパフォーマンスバグを修正しました。 [#6380](https://github.com/ClickHouse/ClickHouse/pull/6380) ([Artem Zuikov](https://github.com/4ertus2))

#### ビルド/テスト/パッケージングの改善 \\{#buildtestingpackaging-improvement-4\\}

* Compiler（ランタイムでのテンプレートインスタンシエーション）を削除しました。すでにその方式の性能を上回っているためです。 [#6646](https://github.com/ClickHouse/ClickHouse/pull/6646) ([alexey-milovidov](https://github.com/alexey-milovidov))
* gcc-9 における性能低下を、より独立した形で示すための性能テストを追加。 [#6302](https://github.com/ClickHouse/ClickHouse/pull/6302) ([alexey-milovidov](https://github.com/alexey-milovidov))
* テーブル関数 `numbers` のマルチスレッド対応版である `numbers_mt` を追加しました。ハッシュ関数を用いたパフォーマンステストを更新しました。 [#6554](https://github.com/ClickHouse/ClickHouse/pull/6554) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* `clickhouse-benchmark` の比較モード [#6220](https://github.com/ClickHouse/ClickHouse/issues/6220) [#6343](https://github.com/ClickHouse/ClickHouse/pull/6343) ([dimarub2000](https://github.com/dimarub2000))
* スタックトレース出力をベストエフォートで行うよう改善しました。さらに、実行中のスレッドのスタックトレースを出力するためのデバッグ用シグナルとして `SIGPROF` を追加しました。 [#6529](https://github.com/ClickHouse/ClickHouse/pull/6529) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 各関数をそれぞれ専用ファイルに分割（その10）。 [#6321](https://github.com/ClickHouse/ClickHouse/pull/6321) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 重複していた `TABLE_IS_READ_ONLY` の `const` 定義を削除。 [#6566](https://github.com/ClickHouse/ClickHouse/pull/6566) ([filimonov](https://github.com/filimonov))
* `StringHashMap` に関する PR [#5417](https://github.com/ClickHouse/ClickHouse/issues/5417) の書式変更。 [#6700](https://github.com/ClickHouse/ClickHouse/pull/6700) ([akuzm](https://github.com/akuzm))
* `ExpressionAnalyzer` における結合作成用サブクエリを改善。 [#6824](https://github.com/ClickHouse/ClickHouse/pull/6824) ([Artem Zuikov](https://github.com/4ertus2))
* PVS-Studio が検出した冗長な条件を削除。 [#6775](https://github.com/ClickHouse/ClickHouse/pull/6775) ([akuzm](https://github.com/akuzm))
* `ReverseIndex` 向けのハッシュテーブルインターフェイスを分離。 [#6672](https://github.com/ClickHouse/ClickHouse/pull/6672) ([akuzm](https://github.com/akuzm))
* 設定のリファクタリング。 [#6689](https://github.com/ClickHouse/ClickHouse/pull/6689) ([alesapin](https://github.com/alesapin))
* `set` インデックス関数にコメントを追加しました。 [#6319](https://github.com/ClickHouse/ClickHouse/pull/6319) ([Nikita Vasilev](https://github.com/nikvas0))
* Linux のデバッグビルドで OOM スコアを引き上げる。 [#6152](https://github.com/ClickHouse/ClickHouse/pull/6152) ([akuzm](https://github.com/akuzm))
* HDFS HA が debug ビルドでも動作するようになりました。 [#6650](https://github.com/ClickHouse/ClickHouse/pull/6650) ([Weiqing Xu](https://github.com/weiqxu))
* `transform_query_for_external_database` にテストを追加しました。[#6388](https://github.com/ClickHouse/ClickHouse/pull/6388) ([alexey-milovidov](https://github.com/alexey-milovidov))
* Kafka テーブルに対する複数のマテリアライズドビューのテストを追加。 [#6509](https://github.com/ClickHouse/ClickHouse/pull/6509) ([Ivan](https://github.com/abyss7))
* ビルドスキームを改善。 [#6500](https://github.com/ClickHouse/ClickHouse/pull/6500) ([Ivan](https://github.com/abyss7))
* `root` 以外のユーザーで実行された場合にも動作するように、`test_external_dictionaries` のインテグレーションテストを修正しました。 [#6507](https://github.com/ClickHouse/ClickHouse/pull/6507) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 書き込まれるパケットの合計サイズが `DBMS_DEFAULT_BUFFER_SIZE` を超えると、このバグが再現します。 [#6204](https://github.com/ClickHouse/ClickHouse/pull/6204) ([Yuriy Baranov](https://github.com/yurriy))
* テーブルの `RENAME` 操作における競合状態に対するテストを追加 [#6752](https://github.com/ClickHouse/ClickHouse/pull/6752) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `KILL QUERY` における Settings のレースコンディションを回避。 [#6753](https://github.com/ClickHouse/ClickHouse/pull/6753) ([alexey-milovidov](https://github.com/alexey-milovidov))
* キャッシュ辞書によるエラー処理を検証するインテグレーションテストを追加。 [#6755](https://github.com/ClickHouse/ClickHouse/pull/6755) ([Vitaly Baranov](https://github.com/vitlibar))
* Mac OS では不要なため、ELF オブジェクトファイルの解析を無効化します。 [#6578](https://github.com/ClickHouse/ClickHouse/pull/6578) ([alexey-milovidov](https://github.com/alexey-milovidov))
* チェンジログ生成ツールの改善を試み。 [#6327](https://github.com/ClickHouse/ClickHouse/pull/6327) ([alexey-milovidov](https://github.com/alexey-milovidov))
* GCC に `-Wshadow` スイッチを追加。 [#6325](https://github.com/ClickHouse/ClickHouse/pull/6325) ([kreuzerkrieg](https://github.com/kreuzerkrieg))
* `mimalloc` サポート用の不要なコードを削除しました。 [#6715](https://github.com/ClickHouse/ClickHouse/pull/6715) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `zlib-ng` は x86 の機能を検出し、その情報をグローバル変数に保存します。これは `deflateInit` の呼び出し時に行われますが、この呼び出しは複数のスレッドから同時に行われる可能性があります。マルチスレッド環境での書き込み競合を避けるため、ライブラリの初期化時に実行するようにしました。 [#6141](https://github.com/ClickHouse/ClickHouse/pull/6141) ([akuzm](https://github.com/akuzm))
* [#5192](https://github.com/ClickHouse/ClickHouse/issues/5192) で修正された JOIN で発生していたバグに対する回帰テスト。[#6147](https://github.com/ClickHouse/ClickHouse/pull/6147)（[Bakhtiyor Ruziev](https://github.com/theruziev)）
* MSan レポートを修正しました。 [#6144](https://github.com/ClickHouse/ClickHouse/pull/6144) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 不安定になっていた TTL テストを修正。 [#6782](https://github.com/ClickHouse/ClickHouse/pull/6782) ([Anton Popov](https://github.com/CurtizJ))
* `MergeTreeDataPart::is_frozen` フィールドで誤って報告されていたデータレースを修正しました。 [#6583](https://github.com/ClickHouse/ClickHouse/pull/6583) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ファジングテストにおけるタイムアウトを修正しました。以前のバージョンでは、クエリ `SELECT * FROM numbers_mt(gccMurmurHash(''))` でハングアップを誤検出していました。 [#6582](https://github.com/ClickHouse/ClickHouse/pull/6582) ([alexey-milovidov](https://github.com/alexey-milovidov))
* カラムの `static_cast` にデバッグ用チェックを追加しました。 [#6581](https://github.com/ClickHouse/ClickHouse/pull/6581) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 公式 RPM パッケージにおける Oracle Linux のサポート。 [#6356](https://github.com/ClickHouse/ClickHouse/issues/6356) [#6585](https://github.com/ClickHouse/ClickHouse/pull/6585) ([alexey-milovidov](https://github.com/alexey-milovidov))
* JSON のパフォーマンステストを `once` タイプから `loop` タイプに変更しました。 [#6536](https://github.com/ClickHouse/ClickHouse/pull/6536) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* `odbc-bridge.cpp` は `main()` を定義しているため、`clickhouse-lib` には含めないようにしました。 [#6538](https://github.com/ClickHouse/ClickHouse/pull/6538) ([Orivej Desh](https://github.com/orivej))
* 右テーブルのキーに null が含まれる場合に `FULL|RIGHT JOIN` がクラッシュする不具合のテスト。 [#6362](https://github.com/ClickHouse/ClickHouse/pull/6362) ([Artem Zuikov](https://github.com/4ertus2))
* 念のため、エイリアス展開の上限を検証するテストを追加しました。 [#6442](https://github.com/ClickHouse/ClickHouse/pull/6442) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 適切な箇所で `boost::filesystem` から `std::filesystem` に切り替えました。 [#6253](https://github.com/ClickHouse/ClickHouse/pull/6253) [#6385](https://github.com/ClickHouse/ClickHouse/pull/6385) ([alexey-milovidov](https://github.com/alexey-milovidov))
* RPM パッケージをウェブサイトに追加しました。 [#6251](https://github.com/ClickHouse/ClickHouse/pull/6251) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `IN` セクションでの `Unknown identifier` 例外修正用のテストを追加。 [#6708](https://github.com/ClickHouse/ClickHouse/pull/6708) ([Artem Zuikov](https://github.com/4ertus2))
* 理解しづらいという声があったため、`shared_ptr_helper` を簡素化しました。 [#6675](https://github.com/ClickHouse/ClickHouse/pull/6675) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 修正済み Gorilla および DoubleDelta コーデック用のパフォーマンステストを追加しました。 [#6179](https://github.com/ClickHouse/ClickHouse/pull/6179) ([Vasily Nemkov](https://github.com/Enmk))
* 統合テスト `test_dictionaries` を 4 つのテストに分割しました。 [#6776](https://github.com/ClickHouse/ClickHouse/pull/6776) ([Vitaly Baranov](https://github.com/vitlibar))
* `PipelineExecutor` での PVS-Studio 警告を修正。 [#6777](https://github.com/ClickHouse/ClickHouse/pull/6777) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* ASan 使用時に `library` 辞書ソースを使用できるようにしました。 [#6482](https://github.com/ClickHouse/ClickHouse/pull/6482) ([alexey-milovidov](https://github.com/alexey-milovidov))
* PR のリストから変更履歴を生成するオプションを追加しました。 [#6350](https://github.com/ClickHouse/ClickHouse/pull/6350) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `TinyLog` ストレージを読み取り時にロックするようにしました。 [#6226](https://github.com/ClickHouse/ClickHouse/pull/6226) ([akuzm](https://github.com/akuzm))
* CI で壊れたシンボリックリンクを検出。[#6634](https://github.com/ClickHouse/ClickHouse/pull/6634) ([alexey-milovidov](https://github.com/alexey-milovidov))
* デバッグビルドでは時間がかかる場合があるため、&quot;stack overflow&quot; テストのタイムアウト時間を延長しました。 [#6637](https://github.com/ClickHouse/ClickHouse/pull/6637) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 二重の空白を検出するためのチェックを追加しました。 [#6643](https://github.com/ClickHouse/ClickHouse/pull/6643) ([alexey-milovidov](https://github.com/alexey-milovidov))
* サニタイザ有効化ビルド時の `new/delete` メモリトラッキングを修正します。トラッキングの動作はまだ不明瞭で、現状ではテストでのメモリ制限例外を防ぐためだけに機能します。[#6450](https://github.com/ClickHouse/ClickHouse/pull/6450) ([Artem Zuikov](https://github.com/4ertus2))
* リンク時の未定義シンボルチェックを再度有効にした。 [#6453](https://github.com/ClickHouse/ClickHouse/pull/6453) ([Ivan](https://github.com/abyss7))
* `hyperscan` を毎日再ビルドしないようにする。 [#6307](https://github.com/ClickHouse/ClickHouse/pull/6307) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `ProtobufWriter` での UBSan レポートを修正しました。 [#6163](https://github.com/ClickHouse/ClickHouse/pull/6163) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 互換性がないため、Query Profiler をサニタイザーと併用できないようにしました。 [#6769](https://github.com/ClickHouse/ClickHouse/pull/6769) ([alexey-milovidov](https://github.com/alexey-milovidov))
* タイマー失敗後に辞書を再読み込みするテストを追加。 [#6114](https://github.com/ClickHouse/ClickHouse/pull/6114) ([Vitaly Baranov](https://github.com/vitlibar))
* `PipelineExecutor::prepareProcessor` の引数型の不整合を修正。 [#6494](https://github.com/ClickHouse/ClickHouse/pull/6494) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 無効な URI に対するテストを追加しました。 [#6493](https://github.com/ClickHouse/ClickHouse/pull/6493) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `CAST` 関数に対するチェックをさらに追加しました。これにより、ファジングテストで発生するセグメンテーションフォルトに関する情報をより多く取得できるようにしました。 [#6346](https://github.com/ClickHouse/ClickHouse/pull/6346) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* ローカルでイメージをビルドする `docker/builder` コンテナに `gcc-9` サポートを追加しました。 [#6333](https://github.com/ClickHouse/ClickHouse/pull/6333) ([Gleb Novikov](https://github.com/NanoBjorn))
* `LowCardinality(String)` を使用した主キーのテスト。 [#5044](https://github.com/ClickHouse/ClickHouse/issues/5044) [#6219](https://github.com/ClickHouse/ClickHouse/pull/6219) ([dimarub2000](https://github.com/dimarub2000))
* スタックトレースの出力が遅い問題の影響を受けていたテストを修正しました。 [#6315](https://github.com/ClickHouse/ClickHouse/pull/6315) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `groupUniqArray` で発生していたクラッシュを再現するテストケースを追加。修正は [#6029](https://github.com/ClickHouse/ClickHouse/pull/6029) を参照。 [#4402](https://github.com/ClickHouse/ClickHouse/issues/4402) [#6129](https://github.com/ClickHouse/ClickHouse/pull/6129) ([akuzm](https://github.com/akuzm))
* インデックスミューテーション関連のテストを修正しました。 [#6645](https://github.com/ClickHouse/ClickHouse/pull/6645) ([Nikita Vasilev](https://github.com/nikvas0))
* パフォーマンステストでは、実行していないクエリのクエリログは読み取らないようにしました。 [#6427](https://github.com/ClickHouse/ClickHouse/pull/6427) ([akuzm](https://github.com/akuzm))
* マテリアライズドビューは、疑わしい LowCardinality 型に関する設定にかかわらず、任意の LowCardinality 型で作成できるようになりました。 [#6428](https://github.com/ClickHouse/ClickHouse/pull/6428) ([Olga Khvostikova](https://github.com/stavrolia))
* `send_logs_level` 設定用のテストを更新。 [#6207](https://github.com/ClickHouse/ClickHouse/pull/6207) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* gcc-8.2 でのビルドを修正。 [#6196](https://github.com/ClickHouse/ClickHouse/pull/6196) ([Max Akhmedov](https://github.com/zlobober))
* 内蔵の libc++ を使ったビルドを修正。 [#6724](https://github.com/ClickHouse/ClickHouse/pull/6724) ([Ivan](https://github.com/abyss7))
* `rdkafka` ライブラリを用いた共有ビルドを修正 [#6101](https://github.com/ClickHouse/ClickHouse/pull/6101) ([Ivan](https://github.com/abyss7))
* Mac OS 向けビルドの修正（不完全）。 [#6390](https://github.com/ClickHouse/ClickHouse/pull/6390) ([alexey-milovidov](https://github.com/alexey-milovidov)) [#6429](https://github.com/ClickHouse/ClickHouse/pull/6429) ([alex-zaitsev](https://github.com/alex-zaitsev))
* 「splitted」ビルドの問題を修正。 [#6618](https://github.com/ClickHouse/ClickHouse/pull/6618) ([alexey-milovidov](https://github.com/alexey-milovidov))
* その他のビルド関連の修正: [#6186](https://github.com/ClickHouse/ClickHouse/pull/6186) ([Amos Bird](https://github.com/amosbird)) [#6486](https://github.com/ClickHouse/ClickHouse/pull/6486) [#6348](https://github.com/ClickHouse/ClickHouse/pull/6348) ([vxider](https://github.com/Vxider)) [#6744](https://github.com/ClickHouse/ClickHouse/pull/6744) ([Ivan](https://github.com/abyss7)) [#6016](https://github.com/ClickHouse/ClickHouse/pull/6016) [#6421](https://github.com/ClickHouse/ClickHouse/pull/6421) [#6491](https://github.com/ClickHouse/ClickHouse/pull/6491) ([proller](https://github.com/proller))

#### 後方互換性のない変更 \\{#backward-incompatible-change-3\\}

- 使用頻度の低いテーブル関数 `catBoostPool` およびストレージ `CatBoostPool` を削除しました。このテーブル関数を使用している場合は、`feedback@clickhouse.com` までメールをお送りください。なお、CatBoost 連携自体は引き続き提供され、サポートされます。 [#6279](https://github.com/ClickHouse/ClickHouse/pull/6279) ([alexey-milovidov](https://github.com/alexey-milovidov))
- デフォルトで `ANY RIGHT JOIN` および `ANY FULL JOIN` を無効化しました。これらを有効にするには、`any_join_distinct_right_table_keys` 設定を有効にしてください。 [#5126](https://github.com/ClickHouse/ClickHouse/issues/5126) [#6351](https://github.com/ClickHouse/ClickHouse/pull/6351) ([Artem Zuikov](https://github.com/4ertus2))

## ClickHouse リリース 19.13 \\{#clickhouse-release-19-13\\}

### ClickHouse リリース 19.13.6.51, 2019-10-02 \\{#clickhouse-release-19-13-6-51-2019-10-02\\}

#### バグ修正 \\{#bug-fix-9\\}

- このリリースには、19.11.12.69 のすべてのバグ修正も含まれています。

### ClickHouse リリース 19.13.5.44, 2019-09-20 \\{#clickhouse-release-19-13-5-44-2019-09-20\\}

#### バグ修正 \\{#bug-fix-10\\}

- このリリースには、19.14.6.12 のすべてのバグ修正も含まれています。
- ZooKeeper にアクセスできない状態でレプリケートされたテーブルに対して `DROP` クエリを実行した際に、テーブルが不整合な状態になる可能性があった問題を修正しました。 [#6045](https://github.com/ClickHouse/ClickHouse/issues/6045) [#6413](https://github.com/ClickHouse/ClickHouse/pull/6413) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))
- StorageMerge におけるデータ競合の問題を修正しました。 [#6717](https://github.com/ClickHouse/ClickHouse/pull/6717) ([alexey-milovidov](https://github.com/alexey-milovidov))
- ソケットからの受信 (`recv`) が無限に続いてしまう原因となっていた、クエリプロファイラで導入されたバグを修正しました。 [#6386](https://github.com/ClickHouse/ClickHouse/pull/6386) ([alesapin](https://github.com/alesapin))
- 真偽値に対して `JSONExtractRaw` 関数を実行した際の過剰な CPU 使用率を修正しました。 [#6208](https://github.com/ClickHouse/ClickHouse/pull/6208) ([Vitaly Baranov](https://github.com/vitlibar))
- マテリアライズドビューへデータをプッシュする際に発生していたリグレッションを修正しました。 [#6415](https://github.com/ClickHouse/ClickHouse/pull/6415) ([Ivan](https://github.com/abyss7))
- テーブル関数 `url` において、攻撃者が任意の HTTP ヘッダーをリクエストに挿入できてしまう脆弱性がありました。この問題は [Nikita Tikhomirov](https://github.com/NSTikhomirov) によって発見されました。 [#6466](https://github.com/ClickHouse/ClickHouse/pull/6466) ([alexey-milovidov](https://github.com/alexey-milovidov))
- Set インデックスにおける不要な `AST` チェックを修正しました。 [#6510](https://github.com/ClickHouse/ClickHouse/issues/6510) [#6651](https://github.com/ClickHouse/ClickHouse/pull/6651) ([Nikita Vasilev](https://github.com/nikvas0))
- クエリ内に埋め込まれた `AggregateFunction` 値のパース処理を修正しました。 [#6575](https://github.com/ClickHouse/ClickHouse/issues/6575) [#6773](https://github.com/ClickHouse/ClickHouse/pull/6773) ([Zhichang Yu](https://github.com/yuzhichang))
- `trim` 関数ファミリーの誤った動作を修正しました。 [#6647](https://github.com/ClickHouse/ClickHouse/pull/6647) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.13.4.32, 2019-09-10 \\{#clickhouse-release-19-13-4-32-2019-09-10\\}

#### バグ修正 \\{#bug-fix-11\\}

- このリリースには、19.11.9.52 および 19.11.10.54 のすべてのバグ修正とセキュリティ修正も含まれます。
- `system.parts` テーブルおよび `ALTER` クエリでのデータレースを修正しました。[#6245](https://github.com/ClickHouse/ClickHouse/issues/6245) [#6513](https://github.com/ClickHouse/ClickHouse/pull/6513) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `sample` と `prewhere` を使用して空の分散テーブルを読み取る場合に発生していた、ストリーム内のヘッダー不一致を修正しました。[#6167](https://github.com/ClickHouse/ClickHouse/issues/6167) ([Lixiang Qian](https://github.com/fancyqlx)) [#6823](https://github.com/ClickHouse/ClickHouse/pull/6823) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- タプルを含むサブクエリを `IN` 句で使用した場合にクラッシュする問題を修正しました。[#6125](https://github.com/ClickHouse/ClickHouse/issues/6125) [#6550](https://github.com/ClickHouse/ClickHouse/pull/6550) ([tavplubix](https://github.com/tavplubix))
- `GLOBAL JOIN ON` セクションで同じカラム名を使用した場合の問題を修正しました。[#6181](https://github.com/ClickHouse/ClickHouse/pull/6181) ([Artem Zuikov](https://github.com/4ertus2))
- 対応していない型を `Decimal` にキャストしたときにクラッシュする問題を修正しました。代わりに例外をスローするようにしました。[#6297](https://github.com/ClickHouse/ClickHouse/pull/6297) ([Artem Zuikov](https://github.com/4ertus2))
- `extractAll()` 関数でのクラッシュを修正しました。[#6644](https://github.com/ClickHouse/ClickHouse/pull/6644) ([Artem Zuikov](https://github.com/4ertus2))
- `MySQL`、`ODBC`、`JDBC` テーブル関数に対するクエリ変換が、複数の `AND` 式を含む `SELECT WHERE` クエリに対して正しく動作するようになりました。[#6381](https://github.com/ClickHouse/ClickHouse/issues/6381) [#6676](https://github.com/ClickHouse/ClickHouse/pull/6676) ([dimarub2000](https://github.com/dimarub2000))
- MySQL 8 連携向けに、既存の宣言に対するチェックを追加しました。[#6569](https://github.com/ClickHouse/ClickHouse/pull/6569) ([Rafael David Tinoco](https://github.com/rafaeldtinoco))

#### セキュリティ修正 \\{#security-fix-1\\}

- 伸長処理フェーズにおけるコーデックの 2 つの脆弱性を修正しました（悪意のあるユーザーが、伸長時にバッファオーバーフローを引き起こすよう細工した圧縮データを作成できてしまう問題）。[#6670](https://github.com/ClickHouse/ClickHouse/pull/6670) ([Artem Zuikov](https://github.com/4ertus2))

### ClickHouse リリース 19.13.3.26, 2019-08-22 \\{#clickhouse-release-19-13-3-26-2019-08-22\\}

#### バグ修正 \\{#bug-fix-12\\}

- `enable_mixed_granularity_parts=1` が設定されたテーブルに対する `ALTER TABLE ... UPDATE` クエリを修正しました。 [#6543](https://github.com/ClickHouse/ClickHouse/pull/6543) ([alesapin](https://github.com/alesapin))
- タプルを含むサブクエリを伴う IN 句を使用した際に発生する NPE を修正しました。 [#6125](https://github.com/ClickHouse/ClickHouse/issues/6125) [#6550](https://github.com/ClickHouse/ClickHouse/pull/6550) ([tavplubix](https://github.com/tavplubix))
- 古いレプリカが再度アクティブになった場合に、DROP PARTITION によって削除されたデータパーツを依然として保持してしまう可能性がある問題を修正しました。 [#6522](https://github.com/ClickHouse/ClickHouse/issues/6522) [#6523](https://github.com/ClickHouse/ClickHouse/pull/6523) ([tavplubix](https://github.com/tavplubix))
- CSV のパースに関する問題を修正しました。 [#6426](https://github.com/ClickHouse/ClickHouse/issues/6426) [#6559](https://github.com/ClickHouse/ClickHouse/pull/6559) ([tavplubix](https://github.com/tavplubix))
- `system.parts` テーブルおよび ALTER クエリにおけるデータレースを修正しました。これにより [#6245](https://github.com/ClickHouse/ClickHouse/issues/6245) の問題が解消されます。 [#6513](https://github.com/ClickHouse/ClickHouse/pull/6513) ([alexey-milovidov](https://github.com/alexey-milovidov))
- メモリ破損を引き起こす可能性のある mutation 処理内の誤ったコードを修正しました。`system.parts` または `system.parts_columns` に対する `DROP TABLE` と `SELECT` が同時に行われた場合に発生し得る、アドレス `0x14c0` 読み取り時のセグメンテーションフォールトを修正しました。mutation クエリ準備時の競合状態を修正しました。Replicated テーブルの `OPTIMIZE` と ALTER などの変更操作が同時に行われた場合に発生するデッドロックを修正しました。 [#6514](https://github.com/ClickHouse/ClickHouse/pull/6514) ([alexey-milovidov](https://github.com/alexey-milovidov))
- スキッピングインデックスを持つテーブルに対する `ALTER DELETE` クエリの実行後に、データが失われる可能性がある問題を修正しました。 [#6224](https://github.com/ClickHouse/ClickHouse/issues/6224) [#6282](https://github.com/ClickHouse/ClickHouse/pull/6282) ([Nikita Vasilev](https://github.com/nikvas0))

#### セキュリティ修正 \\{#security-fix-2\\}

- 攻撃者が ZooKeeper への書き込み権限を持ち、かつ ClickHouse が動作しているネットワークから到達可能なカスタムサーバーを実行できる場合、ClickHouse のレプリカとして動作し ZooKeeper に登録される、カスタムビルドされた悪意のあるサーバーを作成できる可能性があります。別のレプリカがこの悪意あるレプリカからデータパーツをフェッチすると、`clickhouse-server` にファイルシステム上の任意のパスへの書き込みを行わせることができるおそれがあります。Yandex の情報セキュリティチームの Eldar Zaitov によって発見されました。 [#6247](https://github.com/ClickHouse/ClickHouse/pull/6247) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.13.2.19, 2019-08-14 \\{#clickhouse-release-19-13-2-19-2019-08-14\\}

#### 新機能 \\{#new-feature-5\\}

- クエリ単位のサンプリングプロファイラ。 [例](https://gist.github.com/alexey-milovidov/92758583dd41c24c360fdb8d6a4da194)。 [#4247](https://github.com/ClickHouse/ClickHouse/issues/4247) ([laplab](https://github.com/laplab)) [#6124](https://github.com/ClickHouse/ClickHouse/pull/6124) ([alexey-milovidov](https://github.com/alexey-milovidov)) [#6250](https://github.com/ClickHouse/ClickHouse/pull/6250) [#6283](https://github.com/ClickHouse/ClickHouse/pull/6283) [#6386](https://github.com/ClickHouse/ClickHouse/pull/6386)
- `COLUMNS('regexp')` 式を使用して、`*` アスタリスクのより高機能な拡張版として動作する列リストを指定できるようになりました。 [#5951](https://github.com/ClickHouse/ClickHouse/pull/5951) ([mfridental](https://github.com/mfridental)), ([alexey-milovidov](https://github.com/alexey-milovidov))
- `CREATE TABLE AS table_function()` が可能になりました。 [#6057](https://github.com/ClickHouse/ClickHouse/pull/6057) ([dimarub2000](https://github.com/dimarub2000))
- 確率的勾配降下法に対する Adam オプティマイザが、`stochasticLinearRegression()` および `stochasticLogisticRegression()` 集約関数でデフォルトとして使用されるようになりました。ほとんどチューニングを行わなくても高い精度を示すためです。 [#6000](https://github.com/ClickHouse/ClickHouse/pull/6000) ([Quid37](https://github.com/Quid37))
- カスタム週番号を扱うための関数を追加しました。 [#5212](https://github.com/ClickHouse/ClickHouse/pull/5212) ([Andy Yang](https://github.com/andyyzh))
- `RENAME` クエリがすべてのストレージで動作するようになりました。 [#5953](https://github.com/ClickHouse/ClickHouse/pull/5953) ([Ivan](https://github.com/abyss7))
- クライアントは、サーバー設定で指定されたログレベルに関係なく、`send_logs_level` を設定することで、任意のレベルのログをサーバーから受信できるようになりました。 [#5964](https://github.com/ClickHouse/ClickHouse/pull/5964) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))

#### 後方互換性のない変更 \\{#backward-incompatible-change-4\\}

- 設定 `input_format_defaults_for_omitted_fields` がデフォルトで有効になりました。Distributed テーブルへの挿入では、この設定がクラスタ上で同一である必要があります（ローリングアップデートの前に設定する必要があります）。これにより、`JSONEachRow` および `CSV*` フォーマットにおいて、省略されたフィールドに対する複雑なデフォルト式の計算が有効になります。これは期待される振る舞いですが、ごくわずかなパフォーマンスの差異を引き起こす可能性があります。 [#6043](https://github.com/ClickHouse/ClickHouse/pull/6043) ([Artem Zuikov](https://github.com/4ertus2)), [#5625](https://github.com/ClickHouse/ClickHouse/pull/5625) ([akuzm](https://github.com/akuzm))

#### 実験的機能 \\{#experimental-features\\}

- 新しいクエリ処理パイプライン。`experimental_use_processors=1` オプションを使用して有効にします。自己責任で使用してください。 [#4914](https://github.com/ClickHouse/ClickHouse/pull/4914) ([Nikolai Kochetov](https://github.com/KochetovNicolai))

#### バグ修正 \\{#bug-fix-13\\}

- このバージョンで Kafka 統合機能が修正されました。
- `DoubleDelta` 値が大きい場合の `Int64` に対する `DoubleDelta` エンコーディングを修正し、`Int32` のランダムデータに対する `DoubleDelta` エンコーディングを改善しました。 [#5998](https://github.com/ClickHouse/ClickHouse/pull/5998) ([Vasily Nemkov](https://github.com/Enmk))
- 設定 `merge_tree_uniform_read_distribution` が 0 に設定されている場合の `max_rows_to_read` の過大評価を修正しました。 [#6019](https://github.com/ClickHouse/ClickHouse/pull/6019) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### 改良 \\{#improvement-4\\}

- `config.d` ファイルが、設定ファイルと対応するルート要素を持たない場合に例外をスローするようになりました。 [#6123](https://github.com/ClickHouse/ClickHouse/pull/6123) ([dimarub2000](https://github.com/dimarub2000))

#### パフォーマンスの改善 \\{#performance-improvement-3\\}

- `count()` を最適化。可能な場合、最も小さいサイズのカラムを使用するようになりました。 [#6028](https://github.com/ClickHouse/ClickHouse/pull/6028) ([Amos Bird](https://github.com/amosbird))

#### ビルド／テスト／パッケージングの改善 \\{#buildtestingpackaging-improvement-5\\}

- パフォーマンステストでメモリ使用量を報告するようにしました。 [#5899](https://github.com/ClickHouse/ClickHouse/pull/5899) ([akuzm](https://github.com/akuzm))
- 外部 `libcxx` を使用したビルドを修正しました。 [#6010](https://github.com/ClickHouse/ClickHouse/pull/6010) ([Ivan](https://github.com/abyss7))
- `rdkafka` ライブラリを使用した共有ビルドを修正しました。 [#6101](https://github.com/ClickHouse/ClickHouse/pull/6101) ([Ivan](https://github.com/abyss7))

## ClickHouse リリース 19.11 \\{#clickhouse-release-19-11\\}

### ClickHouse リリース 19.11.13.74, 2019-11-01 \\{#clickhouse-release-19-11-13-74-2019-11-01\\}

#### バグ修正 \\{#bug-fix-14\\}

- マージ／変更されるパーツのうちの 1 つが空（0 行）の場合に、`ALTER MODIFY COLUMN` および縦方向のマージでまれに発生していたクラッシュを修正。[#6780](https://github.com/ClickHouse/ClickHouse/pull/6780) ([alesapin](https://github.com/alesapin))
- `SIMDJSON` を手動で更新。この変更により、標準エラー出力ファイルが誤った JSON 診断メッセージで埋め尽くされる可能性を解消。[#7548](https://github.com/ClickHouse/ClickHouse/pull/7548) ([Alexander Kazakov](https://github.com/Akazz))
- 変更処理における `mrk` ファイル拡張子に関するバグを修正（[alesapin](https://github.com/alesapin)）

### ClickHouse リリース 19.11.12.69, 2019-10-02 \\{#clickhouse-release-19-11-12-69-2019-10-02\\}

#### バグ修正 \\{#bug-fix-15\\}

- 大規模テーブル上の複雑なキーに対するインデックス解析のパフォーマンス低下を修正。この修正は [#6924](https://github.com/ClickHouse/ClickHouse/issues/6924) に対応。[#7075](https://github.com/ClickHouse/ClickHouse/pull/7075) ([alexey-milovidov](https://github.com/alexey-milovidov))
- Distributed エンジンを使用したテーブルでデータ送信中に、まれに発生していた SIGSEGV を回避（`Failed to send batch: file with index XXXXX is absent`）。[#7032](https://github.com/ClickHouse/ClickHouse/pull/7032) ([Azat Khuzhin](https://github.com/azat))
- 複数の JOIN を行った際に発生する `Unknown identifier` を修正。この修正は [#5254](https://github.com/ClickHouse/ClickHouse/issues/5254) に対応。[#7022](https://github.com/ClickHouse/ClickHouse/pull/7022) ([Artem Zuikov](https://github.com/4ertus2))

### ClickHouse リリース 19.11.11.57, 2019-09-13 \\{#clickhouse-release-19-11-11-57-2019-09-13\\}

- Kafka の空のトピックから SELECT する際にセグメンテーションフォルトを引き起こしていた論理エラーを修正。[#6902](https://github.com/ClickHouse/ClickHouse/issues/6902) [#6909](https://github.com/ClickHouse/ClickHouse/pull/6909) ([Ivan](https://github.com/abyss7))
- パラメータ内に空配列を含む場合の関数 `АrrayEnumerateUniqRanked` を修正。[#6928](https://github.com/ClickHouse/ClickHouse/pull/6928) ([proller](https://github.com/proller))

### ClickHouse リリース 19.11.10.54, 2019-09-10 \\{#clickhouse-release-19-11-10-54-2019-09-10\\}

#### バグ修正 \\{#bug-fix-16\\}

- すべてのパーティションに対して一度にコミットできるよう、Kafka メッセージのオフセットを手動で保存するように変更。「1 コンシューマー - 複数パーティション」シナリオで重複が発生する可能性を修正。[#6872](https://github.com/ClickHouse/ClickHouse/pull/6872) ([Ivan](https://github.com/abyss7))

### ClickHouse リリース 19.11.9.52, 2019-09-6 \\{#clickhouse-release-19-11-9-52-2019-09-6\\}

- キャッシュ辞書のエラー処理を改善。 [#6737](https://github.com/ClickHouse/ClickHouse/pull/6737) ([Vitaly Baranov](https://github.com/vitlibar))
- 関数 `arrayEnumerateUniqRanked` のバグを修正。 [#6779](https://github.com/ClickHouse/ClickHouse/pull/6779) ([proller](https://github.com/proller))
- JSON から `Tuple` を抽出する際の `JSONExtract` 関数の動作を修正。 [#6718](https://github.com/ClickHouse/ClickHouse/pull/6718) ([Vitaly Baranov](https://github.com/vitlibar))
- スキッピングインデックスを持つテーブルに対する `ALTER DELETE` クエリの後に発生しうるデータ損失を修正。 [#6224](https://github.com/ClickHouse/ClickHouse/issues/6224) [#6282](https://github.com/ClickHouse/ClickHouse/pull/6282) ([Nikita Vasilev](https://github.com/nikvas0))
- パフォーマンステストを修正。 [#6392](https://github.com/ClickHouse/ClickHouse/pull/6392) ([alexey-milovidov](https://github.com/alexey-milovidov))
- Parquet: boolean カラムの読み取りを修正。 [#6579](https://github.com/ClickHouse/ClickHouse/pull/6579) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 定数引数に対する `nullIf` 関数の誤った動作を修正。 [#6518](https://github.com/ClickHouse/ClickHouse/pull/6518) ([Guillaume Tassery](https://github.com/YiuRULE)) [#6580](https://github.com/ClickHouse/ClickHouse/pull/6580) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 通常のサーバー再起動時に Kafka メッセージが重複する問題を修正。 [#6597](https://github.com/ClickHouse/ClickHouse/pull/6597) ([Ivan](https://github.com/abyss7))
- 長時間実行される `ALTER UPDATE` または `ALTER DELETE` により通常のマージが実行されなくなる問題を修正。利用可能な空きスレッドが十分に存在しない場合にはミューテーションが実行されないようにした。 [#6502](https://github.com/ClickHouse/ClickHouse/issues/6502) [#6617](https://github.com/ClickHouse/ClickHouse/pull/6617) ([tavplubix](https://github.com/tavplubix))
- サーバー設定ファイルで "timezone" を処理する際のエラーを修正。 [#6709](https://github.com/ClickHouse/ClickHouse/pull/6709) ([alexey-milovidov](https://github.com/alexey-milovidov))
- Kafka テストを修正。 [#6805](https://github.com/ClickHouse/ClickHouse/pull/6805) ([Ivan](https://github.com/abyss7))

#### セキュリティ修正 \\{#security-fix-3\\}

- 攻撃者が ZooKeeper への書き込み権限を持ち、かつ ClickHouse が動作しているネットワークから到達可能な独自サーバーを実行できる場合、ClickHouse レプリカとして動作し ZooKeeper に登録される、カスタムビルドの悪意あるサーバーを作成できます。別のレプリカがその悪意あるレプリカからデータパーツをフェッチする際、clickhouse-server にファイルシステム上の任意のパスへの書き込みを強制することが可能になります。Yandex の情報セキュリティチームの Eldar Zaitov によって発見されました。 [#6247](https://github.com/ClickHouse/ClickHouse/pull/6247) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.11.8.46, 2019-08-22 \\{#clickhouse-release-19-11-8-46-2019-08-22\\}

#### バグ修正 \\{#bug-fix-17\\}

- `enable_mixed_granularity_parts=1` のテーブルに対する `ALTER TABLE ... UPDATE` クエリを修正。 [#6543](https://github.com/ClickHouse/ClickHouse/pull/6543) ([alesapin](https://github.com/alesapin))
- タプルを含むサブクエリを伴う IN 句を使用した際に発生する NPE を修正。 [#6125](https://github.com/ClickHouse/ClickHouse/issues/6125) [#6550](https://github.com/ClickHouse/ClickHouse/pull/6550) ([tavplubix](https://github.com/tavplubix))
- 古いレプリカが再度アクティブになった場合に、DROP PARTITION によって削除されたデータパーツを依然として保持してしまう可能性がある問題を修正。 [#6522](https://github.com/ClickHouse/ClickHouse/issues/6522) [#6523](https://github.com/ClickHouse/ClickHouse/pull/6523) ([tavplubix](https://github.com/tavplubix))
- CSV のパースに関する問題を修正。 [#6426](https://github.com/ClickHouse/ClickHouse/issues/6426) [#6559](https://github.com/ClickHouse/ClickHouse/pull/6559) ([tavplubix](https://github.com/tavplubix))
- `system.parts` テーブルおよび ALTER クエリにおけるデータレースを修正。この修正により [#6245](https://github.com/ClickHouse/ClickHouse/issues/6245) の問題が解消されます。 [#6513](https://github.com/ClickHouse/ClickHouse/pull/6513) ([alexey-milovidov](https://github.com/alexey-milovidov))
- メモリ破損を引き起こす可能性のある mutation 処理内の誤ったコードを修正。`system.parts` または `system.parts_columns` に対する `DROP TABLE` と `SELECT` が同時に行われた場合に発生し得る、アドレス `0x14c0` 読み取り時のセグメンテーションフォールトを修正。mutation クエリ準備時の競合状態を修正。Replicated テーブルの `OPTIMIZE` と ALTER などの変更操作が同時に行われた場合に発生するデッドロックを修正。 [#6514](https://github.com/ClickHouse/ClickHouse/pull/6514) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.11.7.40, 2019-08-14 \\{#clickhouse-release-19-11-7-40-2019-08-14\\}

#### バグ修正 \\{#bug-fix-18\\}

- このバージョンで Kafka 統合が修正されました。
- 定数引数に対して `arrayReduce` を使用した際のセグメンテーションフォルトを修正しました。 [#6326](https://github.com/ClickHouse/ClickHouse/pull/6326) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `toFloat()` の単調性を修正しました。 [#6374](https://github.com/ClickHouse/ClickHouse/pull/6374) ([dimarub2000](https://github.com/dimarub2000))
- `optimize_skip_unused_shards` が有効でシャーディングキーが欠落している場合に発生するセグメンテーションフォルトを修正しました。 [#6384](https://github.com/ClickHouse/ClickHouse/pull/6384) ([CurtizJ](https://github.com/CurtizJ))
- `arrayEnumerateUniqRanked` 関数のロジックを修正しました。 [#6423](https://github.com/ClickHouse/ClickHouse/pull/6423) ([alexey-milovidov](https://github.com/alexey-milovidov))
- MySQL ハンドラーから不要な詳細ログ出力を削除しました。 [#6389](https://github.com/ClickHouse/ClickHouse/pull/6389) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 集約関数 `topK` および `topKWeighted` における誤った動作と、セグメンテーションフォルトが発生する可能性を修正しました。 [#6404](https://github.com/ClickHouse/ClickHouse/pull/6404) ([CurtizJ](https://github.com/CurtizJ))
- 後方互換性を維持するため、`system.columns` テーブルに仮想カラムを表示しないようにしました。 [#6406](https://github.com/ClickHouse/ClickHouse/pull/6406) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 複合キーキャッシュ辞書における文字列フィールドのメモリ割り当てに関するバグを修正しました。 [#6447](https://github.com/ClickHouse/ClickHouse/pull/6447) ([alesapin](https://github.com/alesapin))
- `Replicated*MergeTree` テーブルの新しいレプリカを作成する際に、アダプティブ粒度の有効化処理に関するバグを修正しました。 [#6452](https://github.com/ClickHouse/ClickHouse/pull/6452) ([alesapin](https://github.com/alesapin))
- Kafka メッセージ読み取り時に無限ループが発生する問題を修正しました。 [#6354](https://github.com/ClickHouse/ClickHouse/pull/6354) ([abyss7](https://github.com/abyss7))
- 細工されたクエリにより、SQL パーサでスタックオーバーフローが発生してサーバーがクラッシュする可能性、および `Merge` テーブルと `Distributed` テーブルでスタックオーバーフローが発生する可能性を修正しました。 [#6433](https://github.com/ClickHouse/ClickHouse/pull/6433) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 短いシーケンスでの Gorilla エンコードエラーを修正しました。 [#6444](https://github.com/ClickHouse/ClickHouse/pull/6444) ([Enmk](https://github.com/Enmk))

#### 改善 \\{#improvement-5\\}

- 接続時に `poll_interval` および `idle_connection_timeout` 設定をユーザーが上書きできるようにしました。 [#6230](https://github.com/ClickHouse/ClickHouse/pull/6230) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.11.5.28, 2019-08-05 \\{#clickhouse-release-19-11-5-28-2019-08-05\\}

#### バグ修正 \\{#bug-fix-19\\}

- サーバーが過負荷のときにクエリがハングする可能性を修正しました。 [#6301](https://github.com/ClickHouse/ClickHouse/pull/6301) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `yandexConsistentHash` 関数における FPE を修正しました。これにより [#6304](https://github.com/ClickHouse/ClickHouse/issues/6304) が解決されます。 [#6126](https://github.com/ClickHouse/ClickHouse/pull/6126) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `AggregateFunctionFactory` における `LowCardinality` 型の変換のバグを修正しました。これにより [#6257](https://github.com/ClickHouse/ClickHouse/issues/6257) が解決されます。 [#6281](https://github.com/ClickHouse/ClickHouse/pull/6281) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- 設定ファイル内で、`true` および `false` という文字列から `bool` 設定をパースする処理を修正しました。 [#6278](https://github.com/ClickHouse/ClickHouse/pull/6278) ([alesapin](https://github.com/alesapin))
- `WHERE` の一部が `PREWHERE` に移動した場合に、`MergeTree` テーブル上の `Distributed` テーブルへのクエリでストリームヘッダーの非互換が発生するまれなバグを修正しました。 [#6236](https://github.com/ClickHouse/ClickHouse/pull/6236) ([alesapin](https://github.com/alesapin))
- 符号付き型から符号なし型への整数除算で生じるオーバーフローを修正しました。これにより [#6214](https://github.com/ClickHouse/ClickHouse/issues/6214) が解決されます。 [#6233](https://github.com/ClickHouse/ClickHouse/pull/6233) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### 後方互換性のない変更 \\{#backward-incompatible-change-5\\}

- `Kafka` は依然として動作しません。

### ClickHouse リリース 19.11.4.24, 2019-08-01 \\{#clickhouse-release-19-11-4-24-2019-08-01\\}

#### バグ修正 \\{#bug-fix-20\\}

- アダプティブグラニュラリティ使用時に、セカンダリインデックスのマークを書き込む処理のバグを修正。 [#6126](https://github.com/ClickHouse/ClickHouse/pull/6126) ([alesapin](https://github.com/alesapin))
- 2 段階集約での `GROUP BY` の `WITH ROLLUP` および `WITH CUBE` 修飾子を修正。 [#6225](https://github.com/ClickHouse/ClickHouse/pull/6225) ([Anton Popov](https://github.com/CurtizJ))
- `JSONExtractRaw` 関数で発生していたハングを修正し、[#6195](https://github.com/ClickHouse/ClickHouse/issues/6195) [#6198](https://github.com/ClickHouse/ClickHouse/pull/6198) を解決。 ([alexey-milovidov](https://github.com/alexey-milovidov))
- ExternalLoader::reloadOutdated() でのセグメンテーションフォールトを修正。 [#6082](https://github.com/ClickHouse/ClickHouse/pull/6082) ([Vitaly Baranov](https://github.com/vitlibar))
- サーバーがリッスンソケットをクローズしてもシャットダウンせず、残りのクエリの処理を続ける場合がある問題を修正。この結果、2 つの clickhouse-server プロセスが同時に動作してしまう可能性がありました。残りのクエリに対してサーバーが `bad_function_call` エラーを返すことがある問題も修正。 [#6231](https://github.com/ClickHouse/ClickHouse/pull/6231) ([alexey-milovidov](https://github.com/alexey-milovidov))
- ODBC、MySQL、ClickHouse および HTTP を介した外部辞書の初回ロード時における、更新フィールドに対する無意味かつ不正確な条件を修正。これにより [#6069](https://github.com/ClickHouse/ClickHouse/issues/6069) [#6083](https://github.com/ClickHouse/ClickHouse/pull/6083) を解決。 ([alexey-milovidov](https://github.com/alexey-milovidov))
- `LowCardinality(Nullable)` から Null を含まない非 Nullable カラムへのキャスト時に、不要な例外が発生する問題を修正（例：`SELECT CAST(CAST('Hello' AS LowCardinality(Nullable(String))) AS String)` のようなクエリ）。 [#6094](https://github.com/ClickHouse/ClickHouse/issues/6094) [#6119](https://github.com/ClickHouse/ClickHouse/pull/6119) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- 極めてまれなケースで "uniq" 集約関数が非決定的な結果を返す問題を修正。このバグはすべての ClickHouse バージョンに存在していました。 [#6058](https://github.com/ClickHouse/ClickHouse/pull/6058) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 関数 `IPv6CIDRToRange` で CIDR をわずかに大きく設定しすぎた場合に発生するセグメンテーションフォールトを修正。 [#6068](https://github.com/ClickHouse/ClickHouse/pull/6068) ([Guillaume Tassery](https://github.com/YiuRULE))
- サーバーが多数の異なるコンテキストから多くの例外をスローする場合に発生していた小さなメモリリークを修正。 [#6144](https://github.com/ClickHouse/ClickHouse/pull/6144) ([alexey-milovidov](https://github.com/alexey-milovidov))
- コンシューマーがサブスクリプション前に一時停止され、その後再開されない状況を修正。 [#6075](https://github.com/ClickHouse/ClickHouse/pull/6075) ([Ivan](https://github.com/abyss7)) このバージョンでは Kafka が正常に動作しないことに注意してください。
- 以前の読み取り操作がエラーで終了した際に、Kafka データバッファをクリアする処理を追加。 [#6026](https://github.com/ClickHouse/ClickHouse/pull/6026) ([Nikolay](https://github.com/bopohaa)) このバージョンでは Kafka が正常に動作しないことに注意してください。
- `StorageMergeTree::background_task_handle` は `startup()` で初期化されるため、`MergeTreeBlockOutputStream::write()` が初期化前にこれを使用しようとする可能性があります。初期化されているかどうかを確認するように修正。 [#6080](https://github.com/ClickHouse/ClickHouse/pull/6080) ([Ivan](https://github.com/abyss7))

#### ビルド/テスト/パッケージングの改善 \\{#buildtestingpackaging-improvement-6\\}

- 公式の `rpm` パッケージを追加。[#5740](https://github.com/ClickHouse/ClickHouse/pull/5740) ([proller](https://github.com/proller)) ([alesapin](https://github.com/alesapin))
- `packager` スクリプトで `.rpm` と `.tgz` パッケージをビルドできる機能を追加。[#5769](https://github.com/ClickHouse/ClickHouse/pull/5769) ([alesapin](https://github.com/alesapin))
- 「Arcadia」ビルドシステム向けの修正。[#6223](https://github.com/ClickHouse/ClickHouse/pull/6223) ([proller](https://github.com/proller))

#### 後方互換性のない変更 \\{#backward-incompatible-change-6\\}

- このバージョンでは `Kafka` は動作しません。

### ClickHouse Release 19.11.3.11, 2019-07-18 \\{#clickhouse-release-19-11-3-11-2019-07-18\\}

#### 新機能 \\{#new-feature-6\\}

- プリペアドステートメントのサポートを追加。[#5331](https://github.com/ClickHouse/ClickHouse/pull/5331/) ([Alexander](https://github.com/sanych73)) [#5630](https://github.com/ClickHouse/ClickHouse/pull/5630) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `DoubleDelta` と `Gorilla` 列コーデック。[#5600](https://github.com/ClickHouse/ClickHouse/pull/5600) ([Vasily Nemkov](https://github.com/Enmk))
- クエリ処理スレッドの "nice" 値を制御できる `os_thread_priority` 設定を追加。これは OS が動的スケジューリング優先度を調整するために使用します。動作には `CAP_SYS_NICE` ケーパビリティが必要です。[#5858](https://github.com/ClickHouse/ClickHouse/issues/5858) [#5909](https://github.com/ClickHouse/ClickHouse/pull/5909) を実装。([alexey-milovidov](https://github.com/alexey-milovidov))
- Kafka エンジン向けに `_topic`, `_offset`, `_key` 列を実装。[#5382](https://github.com/ClickHouse/ClickHouse/pull/5382) ([Ivan](https://github.com/abyss7)) なお、このバージョンでは `Kafka` は動作しません。
- 集約関数コンビネーター `-Resample` を追加。[#5590](https://github.com/ClickHouse/ClickHouse/pull/5590) ([hcz](https://github.com/hczhcz))
- ウィンドウサイズの制限あり/なしで移動合計/平均を計算する集約関数 `groupArrayMovingSum(win_size)(x)` と `groupArrayMovingAvg(win_size)(x)` を追加。[#5595](https://github.com/ClickHouse/ClickHouse/pull/5595) ([inv2004](https://github.com/inv2004))
- 同義語 `arrayFlatten` \<-\> `flatten` を追加。[#5764](https://github.com/ClickHouse/ClickHouse/pull/5764) ([hcz](https://github.com/hczhcz))
- Uber 由来の H3 関数 `geoToH3` を統合。[#4724](https://github.com/ClickHouse/ClickHouse/pull/4724) ([Remen Ivan](https://github.com/BHYCHIK)) [#5805](https://github.com/ClickHouse/ClickHouse/pull/5805) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### バグ修正 \\{#bug-fix-21\\}

* 非同期更新を行う DNS キャッシュを実装しました。専用スレッドがすべてのホストを解決し、一定間隔（設定値 `dns_cache_update_period`）で DNS キャッシュを更新します。ホストの IP アドレスが頻繁に変更される場合に役立ちます。 [#5857](https://github.com/ClickHouse/ClickHouse/pull/5857) ([Anton Popov](https://github.com/CurtizJ))
* 32 ビット未満の値を扱う列に影響する `Delta` コーデックのセグメンテーションフォールトを修正しました。このバグによりメモリがランダムに破壊されていました。 [#5786](https://github.com/ClickHouse/ClickHouse/pull/5786) ([alesapin](https://github.com/alesapin))
* 非物理カラムを含むブロックにおける TTL マージで発生していたセグメンテーションフォールトを修正。 [#5819](https://github.com/ClickHouse/ClickHouse/pull/5819) ([Anton Popov](https://github.com/CurtizJ))
* `LowCardinality` カラムを含むパーツのチェック時にまれに発生するバグを修正しました。以前は、`LowCardinality` カラムを含むパーツに対して `checkDataPart` が常に失敗していました。 [#5832](https://github.com/ClickHouse/ClickHouse/pull/5832) ([alesapin](https://github.com/alesapin))
* サーバーのスレッドプールがいっぱいのときに、接続がハングアップしたままにならないようにします。これは、接続タイムアウトが長い場合の `remote` テーブル関数からの接続や、レプリカのないシャードへの接続にとって重要です。この変更により [#5878](https://github.com/ClickHouse/ClickHouse/issues/5878) [#5881](https://github.com/ClickHouse/ClickHouse/pull/5881) が修正されます（[alexey-milovidov](https://github.com/alexey-milovidov)）
* `evalMLModel` 関数で定数引数をサポートしました。これにより、[#5817](https://github.com/ClickHouse/ClickHouse/issues/5817) と [#5820](https://github.com/ClickHouse/ClickHouse/pull/5820) が修正されました（[alexey-milovidov](https://github.com/alexey-milovidov)）
* ClickHouse がデフォルトタイムゾーンを `UTC` ではなく `UCT` と判定してしまう問題を修正しました。これにより [#5804](https://github.com/ClickHouse/ClickHouse/issues/5804) が解決されました。 [#5828](https://github.com/ClickHouse/ClickHouse/pull/5828) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `visitParamExtractRaw` におけるバッファのアンダーフローを修正しました。この修正により [#5901](https://github.com/ClickHouse/ClickHouse/issues/5901) および [#5902](https://github.com/ClickHouse/ClickHouse/pull/5902) が解決されます（[alexey-milovidov](https://github.com/alexey-milovidov)）
* 分散実行される `DROP/ALTER/TRUNCATE/OPTIMIZE ON CLUSTER` クエリは、リーダーレプリカ上で直接実行されるようになりました。 [#5757](https://github.com/ClickHouse/ClickHouse/pull/5757) ([alesapin](https://github.com/alesapin))
* `ColumnConst` と `ColumnNullable` の組み合わせに対する `coalesce` の修正と、それに関連する変更。 [#5755](https://github.com/ClickHouse/ClickHouse/pull/5755) ([Artem Zuikov](https://github.com/4ertus2))
* `ReadBufferFromKafkaConsumer` を修正し、以前に停止していた場合でも `commit()` 後に新しいメッセージの読み取りを継続できるようにした [#5852](https://github.com/ClickHouse/ClickHouse/pull/5852) ([Ivan](https://github.com/abyss7))
* 右テーブルの `Nullable` キーで結合する際の `FULL` および `RIGHT` JOIN の結果を修正。 [#5859](https://github.com/ClickHouse/ClickHouse/pull/5859) ([Artem Zuikov](https://github.com/4ertus2))
* 低優先度クエリが無限にスリープし続けてしまう問題に対する修正候補。 [#5842](https://github.com/ClickHouse/ClickHouse/pull/5842) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `SYSTEM FLUSH LOGS` クエリの後に一部のクエリが `query_log` に記録されないことがあるレースコンディションの問題を修正。 [#5456](https://github.com/ClickHouse/ClickHouse/issues/5456) [#5685](https://github.com/ClickHouse/ClickHouse/pull/5685) ([Anton Popov](https://github.com/CurtizJ))
* watch が既に削除された copier オブジェクトを使用しようとしていたことにより発生していた、ClusterCopier 内の `heap-use-after-free` ASan 警告を修正しました。 [#5871](https://github.com/ClickHouse/ClickHouse/pull/5871) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* いくつかの実装において `IColumn::deserializeAndInsertFromArena` から誤った `StringRef` ポインタが返されていた問題を修正しました。このバグはユニットテストのみに影響していました。 [#5973](https://github.com/ClickHouse/ClickHouse/pull/5973) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* ソースおよび中間の array join 列が同名の列を隠してしまうことを防止。 [#5941](https://github.com/ClickHouse/ClickHouse/pull/5941) ([Artem Zuikov](https://github.com/4ertus2))
* MySQL スタイルの識別子のクオートを使用する MySQL エンジン向けの `INSERT` および `SELECT` クエリを修正。 [#5704](https://github.com/ClickHouse/ClickHouse/pull/5704) ([Winter Zhang](https://github.com/zhang2014))
* `CHECK TABLE` クエリが MergeTree エンジンファミリーでも動作するようになりました。各パーツ（より単純なエンジンの場合はファイル）ごとに、チェックのステータスと（存在する場合は）メッセージを返します。また、破損したパーツの取得に関するバグを修正しました。 [#5865](https://github.com/ClickHouse/ClickHouse/pull/5865) ([alesapin](https://github.com/alesapin))
* SPLIT&#95;SHARED&#95;LIBRARIES のランタイムを修正 [#5793](https://github.com/ClickHouse/ClickHouse/pull/5793) ([Danila Kutenin](https://github.com/danlark1))
* `/etc/localtime` が `../usr/share/zoneinfo/Asia/Istanbul` のような相対シンボリックリンクになっている場合のタイムゾーン初期化処理を修正 [#5922](https://github.com/ClickHouse/ClickHouse/pull/5922) ([alexey-milovidov](https://github.com/alexey-milovidov))
* clickhouse-copier: シャットダウン時に発生する use-after-free を修正 [#5752](https://github.com/ClickHouse/ClickHouse/pull/5752) ([proller](https://github.com/proller))
* `simdjson` を更新しました。ゼロバイトを含む一部の不正な JSON が正常にパースされてしまう問題を修正しました。 [#5938](https://github.com/ClickHouse/ClickHouse/pull/5938) ([alexey-milovidov](https://github.com/alexey-milovidov))
* SystemLogs のシャットダウンの問題を修正 [#5802](https://github.com/ClickHouse/ClickHouse/pull/5802) ([Anton Popov](https://github.com/CurtizJ))
* `invalidate_query` の条件が辞書に依存している場合にハングする問題を修正。 [#6011](https://github.com/ClickHouse/ClickHouse/pull/6011) ([Vitaly Baranov](https://github.com/vitlibar))

#### 改善点 \\{#improvement-6\\}

* クラスタ設定で名前解決できないアドレスの指定を許可します。それらは利用不可として扱われ、接続のたびに再度の名前解決が試みられます。これは特に Kubernetes 環境で有用です。これにより [#5714](https://github.com/ClickHouse/ClickHouse/issues/5714) [#5924](https://github.com/ClickHouse/ClickHouse/pull/5924) が修正されました（[alexey-milovidov](https://github.com/alexey-milovidov)）。
* アイドル状態の TCP 接続をクローズします（デフォルトのタイムアウトは 1 時間）。これは、すべてのサーバー上に複数の分散テーブルを持つ大規模クラスターでは特に重要です。各サーバーが他のすべてのサーバーへの接続プールを保持している可能性があり、ピーク時のクエリ並列実行後に接続がアイドル状態のまま残ってしまうためです。これにより [#5879](https://github.com/ClickHouse/ClickHouse/issues/5879) [#5880](https://github.com/ClickHouse/ClickHouse/pull/5880) が修正されました（[alexey-milovidov](https://github.com/alexey-milovidov)）。
* `topK` 関数の品質を向上。SavingSpace セットの挙動を変更し、新しい要素の重みが既存の要素より大きい場合は末尾の要素を削除するようにしました。 [#5833](https://github.com/ClickHouse/ClickHouse/issues/5833) [#5850](https://github.com/ClickHouse/ClickHouse/pull/5850) ([Guillaume Tassery](https://github.com/YiuRULE))
* ドメインを扱う URL 関数は、スキームのない不完全な URL に対しても動作するようになりました [#5725](https://github.com/ClickHouse/ClickHouse/pull/5725) ([alesapin](https://github.com/alesapin))
* チェックサムを`system.parts_columns`テーブルに追加しました。 [#5874](https://github.com/ClickHouse/ClickHouse/pull/5874) ([Nikita Mikhaylov](https://github.com/nikitamikhaylov))
* `Enum8` または `Enum16` のシノニムとして利用できる `Enum` データ型を追加しました。 [#5886](https://github.com/ClickHouse/ClickHouse/pull/5886) ([dimarub2000](https://github.com/dimarub2000))
* `T64` コーデック向けのフルビット転置バリアント。`zstd` を使用した場合に、圧縮率の向上が見込めます。 [#5742](https://github.com/ClickHouse/ClickHouse/pull/5742) ([Artem Zuikov](https://github.com/4ertus2))
* `startsWith` 関数を条件に用いる場合にプライマリキーを使用できるようになりました。これにより、[#5310](https://github.com/ClickHouse/ClickHouse/issues/5310)、[#5882](https://github.com/ClickHouse/ClickHouse/issues/5882)、[#5919](https://github.com/ClickHouse/ClickHouse/pull/5919) が修正されました（[dimarub2000](https://github.com/dimarub2000)）。
* 空のデータベース名の使用を許可することで、クロスレプリケーションクラスタートポロジで `clickhouse-copier` を使用可能にしました。 [#5745](https://github.com/ClickHouse/ClickHouse/pull/5745) ([nvartolomei](https://github.com/nvartolomei))
* `tzdata` が存在しないシステム（例: 素の Docker コンテナ）では、デフォルトのタイムゾーンとして `UTC` が使用されるようになりました。このパッチ以前は、`Could not determine local time zone` というエラーメッセージが出力され、サーバーやクライアントは起動しませんでした。 [#5827](https://github.com/ClickHouse/ClickHouse/pull/5827) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 後方互換性のため、関数 `quantileTiming` における浮動小数点引数のサポートを再導入しました。 [#5911](https://github.com/ClickHouse/ClickHouse/pull/5911) ([alexey-milovidov](https://github.com/alexey-milovidov))
* エラーメッセージに、列が不足しているテーブル名を表示するようにしました。 [#5768](https://github.com/ClickHouse/ClickHouse/pull/5768) ([Ivan](https://github.com/abyss7))
* 複数ユーザーによる同一の query&#95;id を持つクエリの実行を禁止 [#5430](https://github.com/ClickHouse/ClickHouse/pull/5430) ([proller](https://github.com/proller))
* Graphite へメトリクスを送信するためのより堅牢なコード。複数の `RENAME TABLE` 操作が長時間実行されている間でも動作します。 [#5875](https://github.com/ClickHouse/ClickHouse/pull/5875) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ThreadPool がタスクの実行をスケジュールできない場合に、より詳細なエラーメッセージが表示されるようになりました。これにより [#5305](https://github.com/ClickHouse/ClickHouse/issues/5305) [#5801](https://github.com/ClickHouse/ClickHouse/pull/5801) が修正されました（[alexey-milovidov](https://github.com/alexey-milovidov)）
* ngramSearch の挙動を反転し、より直感的にする [#5807](https://github.com/ClickHouse/ClickHouse/pull/5807) ([Danila Kutenin](https://github.com/danlark1))
* HDFS エンジンビルダーにユーザーのパース処理を追加 [#5946](https://github.com/ClickHouse/ClickHouse/pull/5946) ([akonyaev90](https://github.com/akonyaev90))
* `max_ast_elements` パラメータのデフォルト値を更新 [#5933](https://github.com/ClickHouse/ClickHouse/pull/5933) ([Artem Konovalov](https://github.com/izebit))
* 非推奨設定という概念を追加しました。非推奨設定である `allow_experimental_low_cardinality_type` は、指定しても動作に影響はありません。 [0f15c01c6802f7ce1a1494c12c846be8c98944cd](https://github.com/ClickHouse/ClickHouse/commit/0f15c01c6802f7ce1a1494c12c846be8c98944cd) [Alexey Milovidov](https://github.com/alexey-milovidov)

#### パフォーマンスの改善 \\{#performance-improvement-4\\}

- Merge テーブルに対する `SELECT` のストリーム数を増やし、スレッドの分散をより均一にします。設定 `max_streams_multiplier_for_merge_tables` を追加しました。これにより、[#5797](https://github.com/ClickHouse/ClickHouse/issues/5797) および [#5915](https://github.com/ClickHouse/ClickHouse/pull/5915) が修正されました ([alexey-milovidov](https://github.com/alexey-milovidov))

#### ビルド／テスト／パッケージングの改善 \\{#buildtestingpackaging-improvement-7\\}

* 異なるバージョンの ClickHouse 間でのクライアント/サーバー間通信に対する下位互換性テストを追加しました。 [#5868](https://github.com/ClickHouse/ClickHouse/pull/5868) ([alesapin](https://github.com/alesapin))
* 各コミットおよびプルリクエストごとにテストカバレッジ情報を提供。 [#5896](https://github.com/ClickHouse/ClickHouse/pull/5896) ([alesapin](https://github.com/alesapin))
* アドレスサニタイザと連携してカスタムアロケータ（`Arena` と `ArenaWithFreeLists`）をサポートし、「use-after-free」エラーのデバッグを容易にする。 [#5728](https://github.com/ClickHouse/ClickHouse/pull/5728) ([akuzm](https://github.com/akuzm))
* C++ の例外処理およびスタックトレース出力に [LLVM libunwind 実装](https://github.com/llvm-mirror/libunwind) を使用するように変更 [#4828](https://github.com/ClickHouse/ClickHouse/pull/4828)（[Nikita Lapkov](https://github.com/laplab)）
* -Weverything による警告をさらに 2 件追加 [#5923](https://github.com/ClickHouse/ClickHouse/pull/5923) ([alexey-milovidov](https://github.com/alexey-milovidov))
* Memory Sanitizer 対応の ClickHouse ビルドを可能にしました。 [#3949](https://github.com/ClickHouse/ClickHouse/pull/3949) ([alexey-milovidov](https://github.com/alexey-milovidov))
* fuzz テストにおける `bitTest` 関数に関する UBSan レポートを修正。[#5943](https://github.com/ClickHouse/ClickHouse/pull/5943) ([alexey-milovidov](https://github.com/alexey-milovidov))
* Docker: 認証が必要な ClickHouse インスタンスを初期化できるようになりました。 [#5727](https://github.com/ClickHouse/ClickHouse/pull/5727) ([Korviakov Andrey](https://github.com/shurshun))
* librdkafka をバージョン 1.1.0 に更新 [#5872](https://github.com/ClickHouse/ClickHouse/pull/5872) ([Ivan](https://github.com/abyss7))
* インテグレーションテスト向けのグローバルタイムアウトを追加し、一部のテストをテストコード内で無効化しました。 [#5741](https://github.com/ClickHouse/ClickHouse/pull/5741) ([alesapin](https://github.com/alesapin))
* いくつかの ThreadSanitizer のエラーを修正。[#5854](https://github.com/ClickHouse/ClickHouse/pull/5854) ([akuzm](https://github.com/akuzm))
* `--no-undefined` オプションは、リンク時にリンカにすべての外部シンボル名の存在チェックを強制します。分割ビルドモードにおいて、ライブラリ間の実際の依存関係を追跡するのに非常に有用です。 [#5855](https://github.com/ClickHouse/ClickHouse/pull/5855) ([Ivan](https://github.com/abyss7))
* [#5797](https://github.com/ClickHouse/ClickHouse/issues/5797) および [#5914](https://github.com/ClickHouse/ClickHouse/pull/5914) 向けのパフォーマンステストを追加しました ([alexey-milovidov](https://github.com/alexey-milovidov))
* gcc-7 との互換性を修正。 [#5840](https://github.com/ClickHouse/ClickHouse/pull/5840) ([alexey-milovidov](https://github.com/alexey-milovidov))
* gcc-9 のサポートを追加しました。これにより、[#5717](https://github.com/ClickHouse/ClickHouse/issues/5717) および [#5774](https://github.com/ClickHouse/ClickHouse/pull/5774) を修正しました（[alexey-milovidov](https://github.com/alexey-milovidov)）
* libunwind が誤ってリンクされる可能性がある不具合を修正しました。 [#5948](https://github.com/ClickHouse/ClickHouse/pull/5948) ([alexey-milovidov](https://github.com/alexey-milovidov))
* PVS-Studio によって検出された警告をいくつか修正しました。 [#5921](https://github.com/ClickHouse/ClickHouse/pull/5921) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `clang-tidy` 静的解析ツールの初期サポートを追加しました。 [#5806](https://github.com/ClickHouse/ClickHouse/pull/5806) ([alexey-milovidov](https://github.com/alexey-milovidov))
* BSD/Linux のエンディアンマクロ（&#39;be64toh&#39; と &#39;htobe64&#39;）を Mac OS X の同等マクロに変換する [#5785](https://github.com/ClickHouse/ClickHouse/pull/5785) ([Fu Chen](https://github.com/fredchenbj))
* 統合テストガイドを改善しました。 [#5796](https://github.com/ClickHouse/ClickHouse/pull/5796) ([Vladimir Chebotarev](https://github.com/excitoon))
* macOS + gcc9 環境でのビルドを修正 [#5822](https://github.com/ClickHouse/ClickHouse/pull/5822) ([filimonov](https://github.com/filimonov))
* 気付きにくいタイポを修正: aggreAGte -&gt; aggregate。 [#5753](https://github.com/ClickHouse/ClickHouse/pull/5753) ([akuzm](https://github.com/akuzm))
* FreeBSD 向けビルドの修正 [#5760](https://github.com/ClickHouse/ClickHouse/pull/5760) ([proller](https://github.com/proller))
* 実験的な YouTube チャンネルへのリンクを Web サイトに追加 [#5845](https://github.com/ClickHouse/ClickHouse/pull/5845) ([Ivan Blinkov](https://github.com/blinkov))
* CMake: カバレッジ用フラグのオプション WITH&#95;COVERAGE を追加 [#5776](https://github.com/ClickHouse/ClickHouse/pull/5776) ([proller](https://github.com/proller))
* いくつかのインライン PODArray の初期サイズを修正しました。 [#5787](https://github.com/ClickHouse/ClickHouse/pull/5787) ([akuzm](https://github.com/akuzm))
* clickhouse-server.postinst: CentOS 6 における OS の検出処理を修正 [#5788](https://github.com/ClickHouse/ClickHouse/pull/5788) ([proller](https://github.com/proller))
* Arch Linux 向けパッケージ生成を追加。 [#5719](https://github.com/ClickHouse/ClickHouse/pull/5719) ([Vladimir Chebotarev](https://github.com/excitoon))
* Common/config.h をライブラリ（dbms）単位に分割 [#5715](https://github.com/ClickHouse/ClickHouse/pull/5715) ([proller](https://github.com/proller))
* &quot;Arcadia&quot; ビルドプラットフォーム向けの修正 [#5795](https://github.com/ClickHouse/ClickHouse/pull/5795) ([proller](https://github.com/proller))
* 非標準ビルド (gcc9、サブモジュールなし) 向けの修正 [#5792](https://github.com/ClickHouse/ClickHouse/pull/5792) ([proller](https://github.com/proller))
* unalignedStore ではバグが発生しやすいことが判明したため、明示的な型指定を必須にした。[#5791](https://github.com/ClickHouse/ClickHouse/pull/5791) ([akuzm](https://github.com/akuzm))
* macOS 向けビルドを修正 [#5830](https://github.com/ClickHouse/ClickHouse/pull/5830) ([filimonov](https://github.com/filimonov))
* 新しい JIT 機能に関するパフォーマンステストを大規模データセットで実施（リクエスト元: [#5263](https://github.com/ClickHouse/ClickHouse/issues/5263) [#5887](https://github.com/ClickHouse/ClickHouse/pull/5887)（[Guillaume Tassery](https://github.com/YiuRULE)））
* ストレステストでステートフルテストを実行 [12693e568722f11e19859742f56428455501fd2a](https://github.com/ClickHouse/ClickHouse/commit/12693e568722f11e19859742f56428455501fd2a) ([alesapin](https://github.com/alesapin))

#### 後方互換性のない変更 \\{#backward-incompatible-change-7\\}

- このバージョンでは `Kafka` は正常に動作しません。
- 新しい `MergeTree` テーブルに対して、デフォルトで `adaptive_index_granularity` = 10MB を有効化しました。バージョン 19.11 以降で新しい MergeTree テーブルを作成した場合、19.6 より前のバージョンへのダウングレードは不可能になります。 [#5628](https://github.com/ClickHouse/ClickHouse/pull/5628) ([alesapin](https://github.com/alesapin))
- Yandex.Metrica で使用されていた、古い非公開の組み込みディクショナリを削除しました。関数 `OSIn`、`SEIn`、`OSToRoot`、`SEToRoot`、`OSHierarchy`、`SEHierarchy` は利用できなくなりました。これらの関数を使用している場合は、clickhouse-feedback@yandex-team.com までメールを送ってください。注記: 直前になって、当面のあいだこれらの関数を残すことを決定しました。 [#5780](https://github.com/ClickHouse/ClickHouse/pull/5780) ([alexey-milovidov](https://github.com/alexey-milovidov))

## ClickHouse リリース 19.10 \\{#clickhouse-release-19-10\\}

### ClickHouse リリース 19.10.1.5, 2019-07-12 \\{#clickhouse-release-19-10-1-5-2019-07-12\\}

#### 新機能 \\{#new-feature-7\\}

- 新しいカラムコーデック `T64` を追加。これは (U)IntX/EnumX/Date(Time)/DecimalX カラム向けに作られています。定数もしくは狭い範囲の値を持つカラムに適しています。このコーデックでは、再圧縮なしにデータ型を拡大・縮小できます。[#5557](https://github.com/ClickHouse/ClickHouse/pull/5557) ([Artem Zuikov](https://github.com/4ertus2))
- リモートの MySQL サーバー上のすべてのテーブルを参照できるデータベースエンジン `MySQL` を追加。[#5599](https://github.com/ClickHouse/ClickHouse/pull/5599) ([Winter Zhang](https://github.com/zhang2014))
- `bitmapContains` を実装。2 番目のビットマップが 1 要素のみを含む場合、`bitmapHasAny` より 2 倍高速です。[#5535](https://github.com/ClickHouse/ClickHouse/pull/5535) ([Zhichang Yu](https://github.com/yuzhichang))
- `crc32` 関数をサポート（MySQL や PHP と全く同じ動作）。ハッシュ関数が必要な場合には使用しないでください。[#5661](https://github.com/ClickHouse/ClickHouse/pull/5661) ([Remen Ivan](https://github.com/BHYCHIK))
- `Distributed` テーブルへの非同期挿入を制御するために、`SYSTEM START/STOP DISTRIBUTED SENDS` クエリを実装。[#4935](https://github.com/ClickHouse/ClickHouse/pull/4935) ([Winter Zhang](https://github.com/zhang2014))

#### バグ修正 \\{#bug-fix-22\\}

- ミューテーション実行中は、クエリ実行制限およびマージ制限用のパーツサイズ上限を無視するように修正。[#5659](https://github.com/ClickHouse/ClickHouse/pull/5659) ([Anton Popov](https://github.com/CurtizJ))
- 通常ブロックの重複排除（極めて稀）や重複ブロックの挿入（より高頻度）を引き起こす可能性のあるバグを修正。[#5549](https://github.com/ClickHouse/ClickHouse/pull/5549) ([alesapin](https://github.com/alesapin))
- 空配列を引数に取る場合の `arrayEnumerateUniqRanked` 関数の不具合を修正。[#5559](https://github.com/ClickHouse/ClickHouse/pull/5559) ([proller](https://github.com/proller))
- メッセージをポーリングする意図がない場合には、Kafka トピックを購読しないように変更。[#5698](https://github.com/ClickHouse/ClickHouse/pull/5698) ([Ivan](https://github.com/abyss7))
- Nullable の中に入ることができない型については、設定 `join_use_nulls` が影響を与えないように修正。[#5700](https://github.com/ClickHouse/ClickHouse/pull/5700) ([Olga Khvostikova](https://github.com/stavrolia))
- `Incorrect size of index granularity` エラーを修正。[#5720](https://github.com/ClickHouse/ClickHouse/pull/5720) ([coraxster](https://github.com/coraxster))
- Float から Decimal への変換時のオーバーフローを修正。[#5607](https://github.com/ClickHouse/ClickHouse/pull/5607) ([coraxster](https://github.com/coraxster))
- `WriteBufferFromHDFS` のデストラクタが呼び出された際にバッファをフラッシュするように変更。これにより `HDFS` への書き込みの問題が解消されます。[#5684](https://github.com/ClickHouse/ClickHouse/pull/5684) ([Xindong Peng](https://github.com/eejoin))

#### 改善 \\{#improvement-7\\}

- 設定 `input_format_defaults_for_omitted_fields` が有効な場合、`CSV` 内の空セルをデフォルト値として扱います。 [#5625](https://github.com/ClickHouse/ClickHouse/pull/5625) ([akuzm](https://github.com/akuzm))
- 外部辞書の非ブロッキング読み込み。 [#5567](https://github.com/ClickHouse/ClickHouse/pull/5567) ([Vitaly Baranov](https://github.com/vitlibar))
- ネットワークタイムアウトは、設定に従って、すでに確立されている接続に対して動的に変更できます。 [#4558](https://github.com/ClickHouse/ClickHouse/pull/4558) ([Konstantin Podshumok](https://github.com/podshumok))
- 関数 `firstSignificantSubdomain`、`cutToFirstSignificantSubdomain` で "public_suffix_list" を使用。`gperf` によって生成された完全ハッシュテーブルを、次のファイルから生成されたリストに対して使用します: https://publicsuffix.org/list/public_suffix_list.dat（例えば、現在ではドメイン `ac.uk` を重要でないドメインとして認識します）。 [#5030](https://github.com/ClickHouse/ClickHouse/pull/5030) ([Guillaume Tassery](https://github.com/YiuRULE))
- system テーブルで `IPv6` データ型を採用し、`system.processes` と `system.query_log` のクライアント情報列を統一しました。 [#5640](https://github.com/ClickHouse/ClickHouse/pull/5640) ([alexey-milovidov](https://github.com/alexey-milovidov))
- MySQL 互換プロトコルでの接続にセッションを使用。#5476 [#5646](https://github.com/ClickHouse/ClickHouse/pull/5646) ([Yuriy Baranov](https://github.com/yurriy))
- より多くの `ALTER` クエリでの `ON CLUSTER` をサポート。 [#5593](https://github.com/ClickHouse/ClickHouse/pull/5593) [#5613](https://github.com/ClickHouse/ClickHouse/pull/5613) ([sundyli](https://github.com/sundy-li))
- `clickhouse-local` の設定ファイルで `<logger>` セクションをサポート。 [#5540](https://github.com/ClickHouse/ClickHouse/pull/5540) ([proller](https://github.com/proller))
- `clickhouse-local` で `remote` テーブル関数を使ったクエリを実行可能にしました。 [#5627](https://github.com/ClickHouse/ClickHouse/pull/5627) ([proller](https://github.com/proller))

#### パフォーマンス改善 \\{#performance-improvement-5\\}

- MergeTree 列の末尾に最終マークを書き込む機能を追加しました。これにより、テーブルデータ範囲外のキーに対する不要な読み取りを回避できます。これは、アダプティブインデックス粒度が使用されている場合にのみ有効です。 [#5624](https://github.com/ClickHouse/ClickHouse/pull/5624) ([alesapin](https://github.com/alesapin))
- `stat` システムコールの回数を減らすことで、非常に遅いファイルシステム上での MergeTree テーブルのパフォーマンスを改善しました。 [#5648](https://github.com/ClickHouse/ClickHouse/pull/5648) ([alexey-milovidov](https://github.com/alexey-milovidov))
- バージョン 19.6 で導入された、MergeTree テーブルからの読み取りにおけるパフォーマンス低下を修正しました。#5631 を修正。 [#5633](https://github.com/ClickHouse/ClickHouse/pull/5633) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### ビルド／テスト／パッケージングの改善 \\{#buildtestingpackaging-improvement-8\\}

- テスト用の ZooKeeper インターフェイス実装として `TestKeeper` を導入しました [#5643](https://github.com/ClickHouse/ClickHouse/pull/5643) ([alexey-milovidov](https://github.com/alexey-milovidov)) ([levushkin aleksej](https://github.com/alexey-milovidov))
- 今後、`.sql` テストはサーバーごとに分離し、並列かつランダムなデータベース名で実行できるようになりました。これにより、テストをより高速に実行し、カスタムサーバー構成を使用した新しいテストを追加しつつ、異なるテスト同士が互いに影響しないことを保証できます。 [#5554](https://github.com/ClickHouse/ClickHouse/pull/5554) ([Ivan](https://github.com/abyss7))
- パフォーマンス テストから `<name>` と `<metrics>` を削除しました [#5672](https://github.com/ClickHouse/ClickHouse/pull/5672) ([Olga Khvostikova](https://github.com/stavrolia))
- `Pretty` フォーマット向けの「select_format」パフォーマンス テストを修正しました [#5642](https://github.com/ClickHouse/ClickHouse/pull/5642) ([alexey-milovidov](https://github.com/alexey-milovidov))

## ClickHouse Release 19.9 \\{#clickhouse-release-19-9\\}

### ClickHouse Release 19.9.3.31, 2019-07-05 \\{#clickhouse-release-19-9-3-31-2019-07-05\\}

#### バグ修正 \\{#bug-fix-23\\}

- 32 ビット未満のサイズの値を持つカラムに影響する Delta codec のセグメンテーションフォルトを修正。このバグにより、ランダムなメモリ破壊が発生していました。 [#5786](https://github.com/ClickHouse/ClickHouse/pull/5786) ([alesapin](https://github.com/alesapin))
- LowCardinality カラムを持つパーツのチェックにおけるまれなバグを修正。 [#5832](https://github.com/ClickHouse/ClickHouse/pull/5832) ([alesapin](https://github.com/alesapin))
- ブロック内の非物理カラムを含む TTL マージでのセグメンテーションフォルトを修正。 [#5819](https://github.com/ClickHouse/ClickHouse/pull/5819) ([Anton Popov](https://github.com/CurtizJ))
- 低優先度クエリが無限にスリープしうる可能性を修正。 [#5842](https://github.com/ClickHouse/ClickHouse/pull/5842) ([alexey-milovidov](https://github.com/alexey-milovidov))
- ClickHouse がデフォルトのタイムゾーンを UTC ではなく UCT と誤判定していた問題を修正。 [#5828](https://github.com/ClickHouse/ClickHouse/pull/5828) ([alexey-milovidov](https://github.com/alexey-milovidov))
- フォロワーレプリカで、リーダーレプリカより先に分散 `DROP`/`ALTER`/`TRUNCATE`/`OPTIMIZE ON CLUSTER` クエリが実行されるバグを修正。現在は、それらは直接リーダーレプリカ上で実行されます。 [#5757](https://github.com/ClickHouse/ClickHouse/pull/5757) ([alesapin](https://github.com/alesapin))
- `SYSTEM FLUSH LOGS` クエリの直後に、一部のクエリが `query_log` に即座に現れない原因となっていたレースコンディションを修正。 [#5685](https://github.com/ClickHouse/ClickHouse/pull/5685) ([Anton Popov](https://github.com/CurtizJ))
- `evalMLModel` 関数で、これまで未対応だった定数引数のサポートを追加。 [#5820](https://github.com/ClickHouse/ClickHouse/pull/5820) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse Release 19.9.2.4, 2019-06-24 \\{#clickhouse-release-19-9-2-4-2019-06-24\\}

#### 新機能 \\{#new-feature-8\\}

- `system.parts` テーブルで、フリーズされたパーツに関する情報を出力。 [#5471](https://github.com/ClickHouse/ClickHouse/pull/5471) ([proller](https://github.com/proller))
- 引数でパスワードが設定されていない場合、TTY 上で `clickhouse-client` 起動時にクライアントのパスワードを問い合わせるように変更。 [#5092](https://github.com/ClickHouse/ClickHouse/pull/5092) ([proller](https://github.com/proller))
- Decimal 型に対する `dictGet` および `dictGetOrDefault` 関数を実装。 [#5394](https://github.com/ClickHouse/ClickHouse/pull/5394) ([Artem Zuikov](https://github.com/4ertus2))

#### 改良 \\{#improvement-8\\}

- Debian init: サービス停止タイムアウトを追加。 [#5522](https://github.com/ClickHouse/ClickHouse/pull/5522) ([proller](https://github.com/proller))
- LowCardinality 用の疑わしい型を持つテーブル作成を、デフォルトで禁止する設定を追加。 [#5448](https://github.com/ClickHouse/ClickHouse/pull/5448) ([Olga Khvostikova](https://github.com/stavrolia))
- 回帰関数が、`evalMLMethod` 関数内で State として使用されていない場合にモデルの重みを返すように変更。 [#5411](https://github.com/ClickHouse/ClickHouse/pull/5411) ([Quid37](https://github.com/Quid37))
- 回帰メソッドの名称変更と改善。 [#5492](https://github.com/ClickHouse/ClickHouse/pull/5492) ([Quid37](https://github.com/Quid37))
- 文字列検索器のインターフェースをより明確に改善。 [#5586](https://github.com/ClickHouse/ClickHouse/pull/5586) ([Danila Kutenin](https://github.com/danlark1))

#### バグ修正 \\{#bug-fix-24\\}

* Kafka での潜在的なデータ損失を修正 [#5445](https://github.com/ClickHouse/ClickHouse/pull/5445) ([Ivan](https://github.com/abyss7))
* `PrettySpace` フォーマットが列数 0 で呼び出された場合に発生する可能性のある無限ループを修正 [#5560](https://github.com/ClickHouse/ClickHouse/pull/5560) ([Olga Khvostikova](https://github.com/stavrolia))
* 線形モデルにおける UInt32 のオーバーフローのバグを修正。非 const の model 引数に対して ML モデルの eval を許可。 [#5516](https://github.com/ClickHouse/ClickHouse/pull/5516) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 指定したインデックスが存在しない場合、`ALTER TABLE ... DROP INDEX IF EXISTS ...` は例外を発生させないようになりました [#5524](https://github.com/ClickHouse/ClickHouse/pull/5524) ([Gleb Novikov](https://github.com/NanoBjorn))
* スカラーサブクエリ内の `bitmapHasAny` によるセグメンテーションフォルトを修正 [#5528](https://github.com/ClickHouse/ClickHouse/pull/5528) ([Zhichang Yu](https://github.com/yuzhichang))
* DNS キャッシュが破棄された場合でも、レプリケーション接続プールがホスト名の再解決を再試行しない不具合を修正。 [#5534](https://github.com/ClickHouse/ClickHouse/pull/5534) ([alesapin](https://github.com/alesapin))
* ReplicatedMergeTree での `ALTER ... MODIFY TTL` の動作を修正しました。 [#5539](https://github.com/ClickHouse/ClickHouse/pull/5539) ([Anton Popov](https://github.com/CurtizJ))
* MATERIALIZED 列を含む Distributed テーブルへの INSERT を修正 [#5429](https://github.com/ClickHouse/ClickHouse/pull/5429) ([Azat Khuzhin](https://github.com/azat))
* Join ストレージの TRUNCATE 時に発生する bad alloc エラーを修正 [#5437](https://github.com/ClickHouse/ClickHouse/pull/5437) ([TCeason](https://github.com/TCeason))
* 最近のバージョンの tzdata パッケージでは、一部のファイルがシンボリックリンクになっています。デフォルトのタイムゾーンを検出する現在の仕組みが動作しなくなり、一部のタイムゾーンに対して誤った名前を返すようになっています。少なくとも現時点では、TZ が指定されている場合、その内容をタイムゾーン名として強制的に使用するようにしました。 [#5443](https://github.com/ClickHouse/ClickHouse/pull/5443) ([Ivan](https://github.com/abyss7))
* `sum` 内の定数 needle の合計長が少なくとも 16KB になる場合に発生する、MultiVolnitsky searcher におけるごくまれな不具合を修正しました。アルゴリズムが以前の結果を見逃したり上書きしてしまい、その結果として `multiSearchAny` が誤った結果を返す可能性がありました。 [#5588](https://github.com/ClickHouse/ClickHouse/pull/5588) ([Danila Kutenin](https://github.com/danlark1))
* ExternalData リクエストの設定で ClickHouse の設定を使用できなかった問題を修正しました。また、現時点では名前が紛らわしいため、設定 `date_time_input_format` と `low_cardinality_allow_in_native_format` は使用できません（外部データ側ではテーブルフォーマットとして解釈され得る一方で、クエリ側では設定として解釈され得るため）。 [#5455](https://github.com/ClickHouse/ClickHouse/pull/5455) ([Danila Kutenin](https://github.com/danlark1))
* パーツが ZooKeeper からドロップされず、ファイルシステム (FS) からのみ削除されていたバグを修正。 [#5520](https://github.com/ClickHouse/ClickHouse/pull/5520) ([alesapin](https://github.com/alesapin))
* MySQL プロトコルからデバッグロギングを削除 [#5478](https://github.com/ClickHouse/ClickHouse/pull/5478) ([alexey-milovidov](https://github.com/alexey-milovidov))
* DDL クエリ処理中に ZNONODE を無視 [#5489](https://github.com/ClickHouse/ClickHouse/pull/5489) ([Azat Khuzhin](https://github.com/azat))
* `UNION ALL` の結果列の型の混在を修正しました。結果列のデータおよびカラム型に不整合が生じるケースがありました。 [#5503](https://github.com/ClickHouse/ClickHouse/pull/5503) ([Artem Zuikov](https://github.com/4ertus2))
* `dictGetT` 関数で誤った整数値が渡された場合、クラッシュするのではなく例外をスローするようにしました。 [#5446](https://github.com/ClickHouse/ClickHouse/pull/5446) ([Artem Zuikov](https://github.com/4ertus2))
* `system.dictionaries` テーブルのハッシュ辞書における誤った `element_count` と `load_factor` の値を修正。 [#5440](https://github.com/ClickHouse/ClickHouse/pull/5440) ([Azat Khuzhin](https://github.com/azat))

#### ビルド／テスト／パッケージングの改善 \\{#buildtestingpackaging-improvement-9\\}

- `Brotli` HTTP 圧縮サポートなし（cmake 変数 `ENABLE_BROTLI=OFF`）でのビルドを修正。[#5521](https://github.com/ClickHouse/ClickHouse/pull/5521) ([Anton Yuzhaninov](https://github.com/citrin))
- roaring.h を roaring/roaring.h としてインクルード。[#5523](https://github.com/ClickHouse/ClickHouse/pull/5523) ([Orivej Desh](https://github.com/orivej))
- hyperscan における gcc9 の警告を修正（`#line` ディレクティブは悪だ！）。[#5546](https://github.com/ClickHouse/ClickHouse/pull/5546) ([Danila Kutenin](https://github.com/danlark1))
- gcc-9 でコンパイルしたときのすべての警告を修正。一部の contrib の問題を修正。gcc9 の ICE を修正し、bugzilla に報告。[#5498](https://github.com/ClickHouse/ClickHouse/pull/5498) ([Danila Kutenin](https://github.com/danlark1))
- lld でのリンクを修正。[#5477](https://github.com/ClickHouse/ClickHouse/pull/5477) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 辞書内の未使用の特殊化を削除。[#5452](https://github.com/ClickHouse/ClickHouse/pull/5452) ([Artem Zuikov](https://github.com/4ertus2))
- 異なる種類のファイルに対するテーブルのフォーマットおよびパースのパフォーマンステストを改善。[#5497](https://github.com/ClickHouse/ClickHouse/pull/5497) ([Olga Khvostikova](https://github.com/stavrolia))
- 並列テスト実行に関する修正。[#5506](https://github.com/ClickHouse/ClickHouse/pull/5506) ([proller](https://github.com/proller))
- Docker: clickhouse-test の設定を使用。[#5531](https://github.com/ClickHouse/ClickHouse/pull/5531) ([proller](https://github.com/proller))
- FreeBSD でのビルドを修正。[#5447](https://github.com/ClickHouse/ClickHouse/pull/5447) ([proller](https://github.com/proller))
- Boost を 1.70 にアップグレード。[#5570](https://github.com/ClickHouse/ClickHouse/pull/5570) ([proller](https://github.com/proller))
- サブモジュールとしての ClickHouse のビルドを修正。[#5574](https://github.com/ClickHouse/ClickHouse/pull/5574) ([proller](https://github.com/proller))
- JSONExtract のパフォーマンステストを改善。[#5444](https://github.com/ClickHouse/ClickHouse/pull/5444) ([Vitaly Baranov](https://github.com/vitlibar))

## ClickHouse リリース 19.8 \\{#clickhouse-release-19-8\\}

### ClickHouse リリース 19.8.3.8, 2019-06-11 \\{#clickhouse-release-19-8-3-8-2019-06-11\\}

#### 新機能 \\{#new-features\\}

* JSON を扱うための関数を追加しました。[#4686](https://github.com/ClickHouse/ClickHouse/pull/4686) ([hcz](https://github.com/hczhcz)) [#5124](https://github.com/ClickHouse/ClickHouse/pull/5124) ([Vitaly Baranov](https://github.com/vitlibar))
* 多くの言語に存在する `basename` 関数（Python の `os.path.basename`、PHP の `basename` など）と同様の挙動をする関数 `basename` を追加しました。UNIX 系パスと Windows パスの両方で動作します。 [#5136](https://github.com/ClickHouse/ClickHouse/pull/5136) ([Guillaume Tassery](https://github.com/YiuRULE))
* `LIMIT BY` 句に対してオフセット n を指定できるよう、`LIMIT n, m BY` または `LIMIT m OFFSET n BY` 構文を追加しました。 [#5138](https://github.com/ClickHouse/ClickHouse/pull/5138) ([Anton Popov](https://github.com/CurtizJ))
* `AggregatingMergeTree` 内で軽量な集約を行う列を定義できる新しいデータ型 `SimpleAggregateFunction` を追加しました。これは `any`、`anyLast`、`sum`、`min`、`max` のような単純な関数でのみ使用できます。 [#4629](https://github.com/ClickHouse/ClickHouse/pull/4629) ([Boris Granveaud](https://github.com/bgranvea))
* 関数 `ngramDistance` で非定数引数をサポートしました [#5198](https://github.com/ClickHouse/ClickHouse/pull/5198) ([Danila Kutenin](https://github.com/danlark1))
* `skewPop`、`skewSamp`、`kurtPop` および `kurtSamp` 関数を追加し、それぞれ母集団歪度、標本歪度、母集団尖度、標本尖度を計算できるようにしました。 [#5200](https://github.com/ClickHouse/ClickHouse/pull/5200) ([hcz](https://github.com/hczhcz))
* `MaterializeView` ストレージでのリネーム操作をサポート。 [#5209](https://github.com/ClickHouse/ClickHouse/pull/5209) ([Guillaume Tassery](https://github.com/YiuRULE))
* MySQL クライアントを使用して ClickHouse に接続できるサーバーを追加しました。 [#4715](https://github.com/ClickHouse/ClickHouse/pull/4715) ([Yuriy Baranov](https://github.com/yurriy))
* `toDecimal*OrZero` と `toDecimal*OrNull` 関数を追加しました。 [#5291](https://github.com/ClickHouse/ClickHouse/pull/5291) ([Artem Zuikov](https://github.com/4ertus2))
* 関数 `quantile`、`quantiles`、`median`、`quantileExactWeighted`、`quantilesExactWeighted`、`medianExactWeighted` に Decimal 型のサポートを追加。 [#5304](https://github.com/ClickHouse/ClickHouse/pull/5304) ([Artem Zuikov](https://github.com/4ertus2))
* 無効な UTF-8 文字をすべて置換文字 � (U+FFFD) に置き換える `toValidUTF8` 関数を追加しました。 [#5322](https://github.com/ClickHouse/ClickHouse/pull/5322) ([Danila Kutenin](https://github.com/danlark1))
* `format` 関数を追加しました。引数で指定した文字列を用いて、定数パターン（簡略化された Python の format パターン）を整形します。 [#5330](https://github.com/ClickHouse/ClickHouse/pull/5330) ([Danila Kutenin](https://github.com/danlark1))
* `MergeTree` テーブルのデタッチされたパーツに関する情報を含む `system.detached_parts` テーブルを追加しました。 [#5353](https://github.com/ClickHouse/ClickHouse/pull/5353) ([akuzm](https://github.com/akuzm))
* `needle` と `haystack` の間の非対称な差分を計算する `ngramSearch` 関数を追加しました。 [#5418](https://github.com/ClickHouse/ClickHouse/pull/5418)[#5422](https://github.com/ClickHouse/ClickHouse/pull/5422) ([Danila Kutenin](https://github.com/danlark1))
* 集約関数インターフェイスを使用した基本的な機械学習手法（確率的線形回帰およびロジスティック回帰）の実装。モデルの重みを更新するためのさまざまな戦略（単純な勾配降下法、モメンタム法、Nesterov 法）をサポートします。任意のサイズのミニバッチにも対応しています。 [#4943](https://github.com/ClickHouse/ClickHouse/pull/4943) ([Quid37](https://github.com/Quid37))
* `geohashEncode` および `geohashDecode` 関数の実装。[#5003](https://github.com/ClickHouse/ClickHouse/pull/5003) ([Vasily Nemkov](https://github.com/Enmk))
* 集約関数 `timeSeriesGroupSum` を追加しました。これは、サンプリング時刻（タイムスタンプ）が揃っていない異なる時系列を集約できます。2 つのサンプルタイムスタンプ間を線形補間し、その後に時系列を合算します。さらに、時系列のレート（変化率）を計算し、そのレートを合算する集約関数 `timeSeriesGroupRateSum` を追加しました。 [#4542](https://github.com/ClickHouse/ClickHouse/pull/4542) ([Yangkuan Liu](https://github.com/LiuYangkuan))
* CIDR を使用してサブネット内の IP アドレスの下限値および上限値を計算する関数 `IPv4CIDRtoIPv4Range` と `IPv6CIDRtoIPv6Range` を追加しました。 [#5095](https://github.com/ClickHouse/ClickHouse/pull/5095) ([Guillaume Tassery](https://github.com/YiuRULE))
* HTTP でクエリを送信する際に `send_progress_in_http_headers` 設定が有効な場合に、`X-ClickHouse-Summary` ヘッダーを追加します。通常の `X-ClickHouse-Progress` と同様の情報に加え、そのクエリで挿入された行数やバイト数などの追加情報を返します。 [#5116](https://github.com/ClickHouse/ClickHouse/pull/5116) ([Guillaume Tassery](https://github.com/YiuRULE))

#### 改善点 \\{#improvements\\}

* MergeTree ファミリーのテーブルに、パーティションキーの危険な指定を防止する `max_parts_in_total` 設定（デフォルト: 100 000）を追加しました #5166。 [#5171](https://github.com/ClickHouse/ClickHouse/pull/5171) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `clickhouse-obfuscator`: 初期シード値とカラム名を組み合わせて、カラムの位置ではなく各カラム固有のシード値を導出します。これは複数の関連テーブルからなるデータセットを変換することを想定しており、変換後もテーブル同士を JOIN 可能な状態に保つためのものです。 [#5178](https://github.com/ClickHouse/ClickHouse/pull/5178) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 関数 `JSONExtractRaw`、`JSONExtractKeyAndValues` を追加しました。関数 `jsonExtract&lt;type&gt;` を `JSONExtract&lt;type&gt;` にリネームしました。問題が発生した場合、これらの関数は `NULL` ではなく対応する値を返します。関数 `JSONExtract` を変更し、最後の引数から戻り値の型を取得し、Nullable を注入しないようにしました。AVX2 命令が利用できない場合は RapidJSON を用いるフォールバックを実装しました。Simdjson ライブラリを新しいバージョンに更新しました。[#5235](https://github.com/ClickHouse/ClickHouse/pull/5235)（[Vitaly Baranov](https://github.com/vitlibar)）
* `if` および `multiIf` 関数は、条件式の `Nullable` には依存せず、SQL との互換性のために分岐に依存するようになりました。 [#5238](https://github.com/ClickHouse/ClickHouse/pull/5238) ([Jian Wu](https://github.com/janplus))
* `In` 述語は、`Equal` 関数と同様に、`Null` 入力に対して `Null` 結果を返すようになりました。 [#5152](https://github.com/ClickHouse/ClickHouse/pull/5152) ([Jian Wu](https://github.com/janplus))
* Kafka からの読み込みにおいて、(flush&#95;interval / poll&#95;timeout) 行ごとに時間制限を確認するようにしました。これにより、Kafka コンシューマからの読み取りをより頻繁に区切り、トップレベルのストリームの時間制限を確認できるようになります [#5249](https://github.com/ClickHouse/ClickHouse/pull/5249) ([Ivan](https://github.com/abyss7))
* 同梱の SASL と rdkafka をリンクしました。これにより SASL SCRAM 認証を利用できるようになります [#5253](https://github.com/ClickHouse/ClickHouse/pull/5253) ([Ivan](https://github.com/abyss7))
* ALL JOINS 用の RowRefList のバッチ処理版。 [#5267](https://github.com/ClickHouse/ClickHouse/pull/5267) ([Artem Zuikov](https://github.com/4ertus2))
* clickhouse-server: listen エラー発生時のメッセージをより詳細にしました。 [#5268](https://github.com/ClickHouse/ClickHouse/pull/5268) ([proller](https://github.com/proller))
* clickhouse-copier において `<sharding_key>` 内の関数で辞書をサポート [#5270](https://github.com/ClickHouse/ClickHouse/pull/5270) ([proller](https://github.com/proller))
* Kafka のコミットポリシーを制御するための新しい設定 `kafka_commit_every_batch` を追加しました。
  この設定では、各メッセージバッチの処理が終わるたびにコミットするか、ストレージにブロック全体を書き込んだ後にコミットするかのモードを指定できます。これは、一部のメッセージを失う可能性と、極端な状況で同じメッセージを重複して読み取る可能性とのトレードオフです。 [#5308](https://github.com/ClickHouse/ClickHouse/pull/5308) ([Ivan](https://github.com/abyss7))
* `windowFunnel` が他の符号なし整数型にも対応しました。 [#5320](https://github.com/ClickHouse/ClickHouse/pull/5320) ([sundyli](https://github.com/sundy-li))
* Merge エンジンで仮想カラム `_table` をシャドー（上書き）できるようにしました。 [#5325](https://github.com/ClickHouse/ClickHouse/pull/5325) ([Ivan](https://github.com/abyss7))
* `sequenceMatch` 集約関数が他の符号なし整数型にも対応するようにする [#5339](https://github.com/ClickHouse/ClickHouse/pull/5339) ([sundyli](https://github.com/sundy-li))
* チェックサムの不一致がハードウェア障害に起因している可能性が高い場合に、より分かりやすいエラーメッセージが表示されるように改善しました。 [#5355](https://github.com/ClickHouse/ClickHouse/pull/5355) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 基盤となるテーブルが `StorageMerge` 用のサンプリングをサポートしていることを確認する [#5366](https://github.com/ClickHouse/ClickHouse/pull/5366) ([Ivan](https://github.com/abyss7))
* 外部辞書での使用後に MySQL 接続をクローズするよう変更しました。これは issue #893 に関連しています。 [#5395](https://github.com/ClickHouse/ClickHouse/pull/5395) ([Clément Rodriguez](https://github.com/clemrodriguez))
* MySQL Wire プロトコルの改善。フォーマット名を MySQLWire に変更。RSA&#95;free を呼び出すために RAII を使用。コンテキストを作成できない場合は SSL を無効化するよう変更。 [#5419](https://github.com/ClickHouse/ClickHouse/pull/5419) ([Yuriy Baranov](https://github.com/yurriy))
* clickhouse-client: 履歴ファイルにアクセスできない状態（読み取り専用、ディスク容量不足、ファイルがディレクトリである場合など）でも実行できるようにしました。 [#5431](https://github.com/ClickHouse/ClickHouse/pull/5431) ([proller](https://github.com/proller))
* Distributed テーブルへの非同期 INSERT でクエリ設定が反映されるようになりました。 [#4936](https://github.com/ClickHouse/ClickHouse/pull/4936) ([TCeason](https://github.com/TCeason))
* 関数 `leastSqr` を `simpleLinearRegression`、`LinearRegression` を `linearRegression`、`LogisticRegression` を `logisticRegression` に名前変更しました。 [#5391](https://github.com/ClickHouse/ClickHouse/pull/5391) ([Nikolai Kochetov](https://github.com/KochetovNicolai))

#### パフォーマンスの改善 \\{#performance-improvements\\}

- 非レプリケートの MergeTree テーブルのパーツ処理を `ALTER MODIFY` クエリで並列化。[#4639](https://github.com/ClickHouse/ClickHouse/pull/4639) ([Ivan Kush](https://github.com/IvanKush))
- 正規表現による抽出処理を最適化。[#5193](https://github.com/ClickHouse/ClickHouse/pull/5193) [#5191](https://github.com/ClickHouse/ClickHouse/pull/5191) ([Danila Kutenin](https://github.com/danlark1))
- `JOIN ON` 句でのみ使用されている場合は、右側の結合キー列を結合結果に追加しないように変更。[#5260](https://github.com/ClickHouse/ClickHouse/pull/5260) ([Artem Zuikov](https://github.com/4ertus2))
- 最初の空レスポンス後に Kafka バッファをフリーズするように変更。これにより、一部の行パースストリームで空結果に対して `ReadBuffer::next()` が複数回呼ばれることを防止。[#5283](https://github.com/ClickHouse/ClickHouse/pull/5283) ([Ivan](https://github.com/abyss7))
- 複数引数に対する `concat` 関数を最適化。[#5357](https://github.com/ClickHouse/ClickHouse/pull/5357) ([Danila Kutenin](https://github.com/danlark1))
- クエリ最適化。カンマ結合/クロス結合を内部結合に書き換える際に、`IN` 句のプッシュダウンを許可。[#5396](https://github.com/ClickHouse/ClickHouse/pull/5396) ([Artem Zuikov](https://github.com/4ertus2))
- LZ4 実装をリファレンス実装と同等のものに更新し、伸長処理を高速化。[#5070](https://github.com/ClickHouse/ClickHouse/pull/5070) ([Danila Kutenin](https://github.com/danlark1))
- MSD radix sort（kxsort ベース）と部分ソートを実装。[#5129](https://github.com/ClickHouse/ClickHouse/pull/5129) ([Evgenii Pravda](https://github.com/kvinty))

#### バグ修正 \\{#bug-fixes\\}

- `JOIN` における必須列のプッシュダウン処理を修正。[#5192](https://github.com/ClickHouse/ClickHouse/pull/5192) ([Winter Zhang](https://github.com/zhang2014))
- ClickHouse を systemd で実行している場合に、`sudo service clickhouse-server forcerestart` コマンドが期待どおりに動作しなかったバグを修正。[#5204](https://github.com/ClickHouse/ClickHouse/pull/5204) ([proller](https://github.com/proller))
- DataPartsExchange における HTTP エラーコードを修正（ポート 9009 のインターサーバー HTTP サーバーが、エラー時でも常にコード 200 を返していた問題）。[#5216](https://github.com/ClickHouse/ClickHouse/pull/5216) ([proller](https://github.com/proller))
- `String` が `MAX_SMALL_STRING_SIZE` より長い場合の `SimpleAggregateFunction` を修正。[#5311](https://github.com/ClickHouse/ClickHouse/pull/5311) ([Azat Khuzhin](https://github.com/azat))
- `IN` における `Decimal` から `Nullable(Decimal)` への変換エラーを修正。その他の Decimal 間の変換（スケールが異なる場合を含む）をサポート。[#5350](https://github.com/ClickHouse/ClickHouse/pull/5350) ([Artem Zuikov](https://github.com/4ertus2))
- simdjson ライブラリでの FPU レジスタ破壊が原因で、`uniqHLL` や `uniqCombined` 集約関数、および `log` などの数学関数が誤った計算結果となっていた問題を修正。[#5354](https://github.com/ClickHouse/ClickHouse/pull/5354) ([alexey-milovidov](https://github.com/alexey-milovidov))
- JSON 関数における定数/非定数が混在するケースの処理を修正。[#5435](https://github.com/ClickHouse/ClickHouse/pull/5435) ([Vitaly Baranov](https://github.com/vitlibar))
- `retention` 関数を修正。現在は、データの 1 行において満たされるすべての条件がデータ状態に追加されるようになっている。[#5119](https://github.com/ClickHouse/ClickHouse/pull/5119) ([小路](https://github.com/nicelulu))
- `quantileExact` の Decimals 使用時の結果型を修正。[#5304](https://github.com/ClickHouse/ClickHouse/pull/5304) ([Artem Zuikov](https://github.com/4ertus2))

#### ドキュメント \\{#documentation\\}

- `CollapsingMergeTree` のドキュメントを中国語に翻訳しました。 [#5168](https://github.com/ClickHouse/ClickHouse/pull/5168) ([张风啸](https://github.com/AlexZFX))
- テーブルエンジンに関する一部のドキュメントを中国語に翻訳しました。
    [#5134](https://github.com/ClickHouse/ClickHouse/pull/5134)
    [#5328](https://github.com/ClickHouse/ClickHouse/pull/5328)
    ([never lee](https://github.com/neverlee))

#### ビルド/テスト/パッケージングの改善 \\{#buildtestingpackaging-improvements\\}

- use-after-free が発生している可能性を示すいくつかのサニタイザーのレポートを修正しました。[#5139](https://github.com/ClickHouse/ClickHouse/pull/5139) [#5143](https://github.com/ClickHouse/ClickHouse/pull/5143) [#5393](https://github.com/ClickHouse/ClickHouse/pull/5393) ([Ivan](https://github.com/abyss7))
- 利便性のため、パフォーマンステストを個別ディレクトリから移動しました。 [#5158](https://github.com/ClickHouse/ClickHouse/pull/5158) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 誤ったパフォーマンステストを修正しました。 [#5255](https://github.com/ClickHouse/ClickHouse/pull/5255) ([alesapin](https://github.com/alesapin))
- ハードウェアの問題をデバッグするため、ビット反転によるチェックサムエラーを計算するツールを追加しました。 [#5334](https://github.com/ClickHouse/ClickHouse/pull/5334) ([alexey-milovidov](https://github.com/alexey-milovidov))
- runner スクリプトをより使いやすくしました。 [#5340](https://github.com/ClickHouse/ClickHouse/pull/5340)[#5360](https://github.com/ClickHouse/ClickHouse/pull/5360) ([filimonov](https://github.com/filimonov))
- パフォーマンステストの書き方に関する簡単な手順を追加しました。 [#5408](https://github.com/ClickHouse/ClickHouse/pull/5408) ([alesapin](https://github.com/alesapin))
- パフォーマンステストにおいて、create / fill / drop クエリ内で置換を行える機能を追加しました。 [#5367](https://github.com/ClickHouse/ClickHouse/pull/5367) ([Olga Khvostikova](https://github.com/stavrolia))

## ClickHouse リリース 19.7 \\{#clickhouse-release-19-7\\}

### ClickHouse リリース 19.7.5.29, 2019-07-05 \\{#clickhouse-release-19-7-5-29-2019-07-05\\}

#### バグ修正 \\{#bug-fix-25\\}

- 一部の JOIN を含むクエリで発生していたパフォーマンス低下を修正。 [#5192](https://github.com/ClickHouse/ClickHouse/pull/5192) ([Winter Zhang](https://github.com/zhang2014))

### ClickHouse リリース 19.7.5.27, 2019-06-09 \\{#clickhouse-release-19-7-5-27-2019-06-09\\}

#### 新機能 \\{#new-features-1\\}

- ビットマップ関連の関数 `bitmapHasAny` および `bitmapHasAll` を追加。配列用の関数 `hasAny` および `hasAll` と同等の機能を提供。 [#5279](https://github.com/ClickHouse/ClickHouse/pull/5279) ([Sergi Vladykin](https://github.com/svladykin))

#### バグ修正 \\{#bug-fixes-1\\}

- `minmax` INDEX に Null 値がある場合に発生するセグメンテーションフォールトを修正。[#5246](https://github.com/ClickHouse/ClickHouse/pull/5246) ([Nikita Vasilev](https://github.com/nikvas0))
- LIMIT BY 内のすべての入力カラムを出力必須としてマークするように変更。一部の分散クエリで発生していた「Not found column」エラーを修正。[#5407](https://github.com/ClickHouse/ClickHouse/pull/5407) ([Constantin S. Pan](https://github.com/kvap))
- DEFAULT を持つカラムに対する `SELECT .. PREWHERE` で発生する "Column '0' already exists" エラーを修正。[#5397](https://github.com/ClickHouse/ClickHouse/pull/5397) ([proller](https://github.com/proller))
- `ReplicatedMergeTree` に対する `ALTER MODIFY TTL` クエリを修正。[#5539](https://github.com/ClickHouse/ClickHouse/pull/5539/commits) ([Anton Popov](https://github.com/CurtizJ))
- Kafka コンシューマが起動に失敗した場合にサーバーがクラッシュしないように修正。[#5285](https://github.com/ClickHouse/ClickHouse/pull/5285) ([Ivan](https://github.com/abyss7))
- ビットマップ関数が誤った結果を返す問題を修正。[#5359](https://github.com/ClickHouse/ClickHouse/pull/5359) ([Andy Yang](https://github.com/andyyzh))
- ハッシュ Dictionary の element_count を修正（重複を含めないように変更）。[#5440](https://github.com/ClickHouse/ClickHouse/pull/5440) ([Azat Khuzhin](https://github.com/azat))
- タイムゾーン名として環境変数 TZ の内容を使用するように変更。一部のケースでデフォルトタイムゾーンを正しく検出できるようにした。[#5443](https://github.com/ClickHouse/ClickHouse/pull/5443) ([Ivan](https://github.com/abyss7))
- `dictGetT` 関数内で整数の変換を試みないように変更（正しく動作しないため）。代わりに例外をスローするようにした。[#5446](https://github.com/ClickHouse/ClickHouse/pull/5446) ([Artem Zuikov](https://github.com/4ertus2))
- ExternalData HTTP リクエスト内の設定を修正。[#5455](https://github.com/ClickHouse/ClickHouse/pull/5455) ([Danila
    Kutenin](https://github.com/danlark1))
- パーツがファイルシステムからのみ削除され、ZooKeeper からは削除されない不具合を修正。[#5520](https://github.com/ClickHouse/ClickHouse/pull/5520) ([alesapin](https://github.com/alesapin))
- `bitmapHasAny` 関数でのセグメンテーションフォールトを修正。[#5528](https://github.com/ClickHouse/ClickHouse/pull/5528) ([Zhichang Yu](https://github.com/yuzhichang))
- レプリケーション接続プールが、DNS キャッシュが破棄された後でもホストの解決を再試行しないエラーを修正。[#5534](https://github.com/ClickHouse/ClickHouse/pull/5534) ([alesapin](https://github.com/alesapin))
- `DROP INDEX IF EXISTS` クエリを修正。これにより、指定された索引が存在しない場合でも、`ALTER TABLE ... DROP INDEX IF EXISTS ...` クエリが例外をスローしないようになった。[#5524](https://github.com/ClickHouse/ClickHouse/pull/5524) ([Gleb Novikov](https://github.com/NanoBjorn))
- `UNION ALL` のスーパータイプのカラムを修正。結果カラムでデータおよびカラム型が不整合となるケースがあった。[#5503](https://github.com/ClickHouse/ClickHouse/pull/5503) ([Artem Zuikov](https://github.com/4ertus2))
- DDL クエリ処理中に ZNONODE をスキップするように修正。以前は、別のノードがタスクキュー内の znode を削除した場合、そのタスクをまだ処理していないが、すでに子ノード一覧を取得していたノードが DDLWorker スレッドを終了させていた。[#5489](https://github.com/ClickHouse/ClickHouse/pull/5489) ([Azat Khuzhin](https://github.com/azat))
- MATERIALIZED カラムを持つ Distributed() テーブルへの INSERT を修正。[#5429](https://github.com/ClickHouse/ClickHouse/pull/5429) ([Azat Khuzhin](https://github.com/azat))

### ClickHouse Release 19.7.3.9, 2019-05-30 \\{#clickhouse-release-19-7-3-9-2019-05-30\\}

#### 新機能 \\{#new-features-2\\}

- ユーザーが指定できる設定値の範囲を制限できるようにしました。
    これらの制約はユーザー設定プロファイルで構成できます。
    [#4931](https://github.com/ClickHouse/ClickHouse/pull/4931) ([Vitaly
    Baranov](https://github.com/vitlibar))
- 結果配列のサイズを制限するためのオプションの `max_size` パラメータを持つ関数 `groupUniqArray` の第 2 バージョンを追加しました。
    この動作は `groupArray(max_size)(x)` 関数と同様です。
    [#5026](https://github.com/ClickHouse/ClickHouse/pull/5026) ([Guillaume
    Tassery](https://github.com/YiuRULE))
- TSVWithNames/CSVWithNames 入力ファイル形式において、カラム順序をファイルヘッダから判定できるようにしました。
    これは `input_format_with_names_use_header` パラメータで制御されます。
    [#5081](https://github.com/ClickHouse/ClickHouse/pull/5081)
    ([Alexander](https://github.com/Akazz))

#### バグ修正 \\{#bug-fixes-2\\}

- merge 中の uncompressed_cache + JOIN によるクラッシュ (#5197)
    [#5133](https://github.com/ClickHouse/ClickHouse/pull/5133) ([Danila
    Kutenin](https://github.com/danlark1))
- system テーブルに対する clickhouse-client クエリでセグメンテーションフォルトが発生する問題。#5066
    [#5127](https://github.com/ClickHouse/ClickHouse/pull/5127)
    ([Ivan](https://github.com/abyss7))
- KafkaEngine 経由の高負荷時に発生するデータ損失 (#4736)
    [#5080](https://github.com/ClickHouse/ClickHouse/pull/5080)
    ([Ivan](https://github.com/abyss7))
- 少なくとも 2 つ以上の system.columns、system.tables、system.parts、system.parts_tables、または Merge ファミリーのテーブルからの SELECT を含む UNION ALL クエリを実行している際に、関連テーブルのカラムに対する ALTER を同時に実行すると、ごくまれに発生しうるデータレース状態を修正しました。[#5189](https://github.com/ClickHouse/ClickHouse/pull/5189) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### パフォーマンスの改善 \\{#performance-improvements-1\\}

- `LIMIT` なしで単一の数値カラムでの `ORDER BY` を行う場合に、ソートに radix ソートを使用するようにしました。
    [#5106](https://github.com/ClickHouse/ClickHouse/pull/5106),
    [#4439](https://github.com/ClickHouse/ClickHouse/pull/4439)
    ([Evgenii Pravda](https://github.com/kvinty),
    [alexey-milovidov](https://github.com/alexey-milovidov))

#### ドキュメント \\{#documentation-1\\}

- 一部のテーブルエンジンに関するドキュメントを中国語に翻訳しました。
    [#5107](https://github.com/ClickHouse/ClickHouse/pull/5107),
    [#5094](https://github.com/ClickHouse/ClickHouse/pull/5094),
    [#5087](https://github.com/ClickHouse/ClickHouse/pull/5087)
    ([张风啸](https://github.com/AlexZFX)),
    [#5068](https://github.com/ClickHouse/ClickHouse/pull/5068) ([never
    lee](https://github.com/neverlee))

#### ビルド／テスト／パッケージングの改善 \\{#buildtestingpackaging-improvements-1\\}

- `clickhouse-test` で UTF-8 文字を正しく出力するようにする。
    [#5084](https://github.com/ClickHouse/ClickHouse/pull/5084)
    ([alexey-milovidov](https://github.com/alexey-milovidov))
- clickhouse-client に、サジェストデータを常に読み込むためのコマンドラインパラメータを追加。
    [#5102](https://github.com/ClickHouse/ClickHouse/pull/5102)
    ([alexey-milovidov](https://github.com/alexey-milovidov))
- 一部の PVS-Studio 警告を解消。
    [#5082](https://github.com/ClickHouse/ClickHouse/pull/5082)
    ([alexey-milovidov](https://github.com/alexey-milovidov))
- LZ4 を更新。
    [#5040](https://github.com/ClickHouse/ClickHouse/pull/5040) ([Danila
    Kutenin](https://github.com/danlark1))
- 今後のプルリクエスト #5030 に備えて、ビルド要件に gperf を追加。
    [#5110](https://github.com/ClickHouse/ClickHouse/pull/5110)
    ([proller](https://github.com/proller))

## ClickHouse リリース 19.6 \\{#clickhouse-release-19-6\\}

### ClickHouse リリース 19.6.3.18, 2019-06-13 \\{#clickhouse-release-19-6-3-18-2019-06-13\\}

#### バグ修正 \\{#bug-fixes-3\\}

- テーブル関数 `mysql` と `odbc` およびそれに対応するテーブルエンジンに対するクエリで、IN 条件のプッシュダウンを修正しました。これにより #3540 と #2384 が解決されます。 [#5313](https://github.com/ClickHouse/ClickHouse/pull/5313) ([alexey-milovidov](https://github.com/alexey-milovidov))
- Zookeeper におけるデッドロックを修正しました。 [#5297](https://github.com/ClickHouse/ClickHouse/pull/5297) ([github1youlc](https://github.com/github1youlc))
- CSV で引用符付きの 10 進数を許可しました。 [#5284](https://github.com/ClickHouse/ClickHouse/pull/5284) ([Artem Zuikov](https://github.com/4ertus2)
- float の Inf/NaN から Decimals への変換を禁止しました（例外をスローします）。 [#5282](https://github.com/ClickHouse/ClickHouse/pull/5282) ([Artem Zuikov](https://github.com/4ertus2))
- rename クエリでのデータレースを修正しました。 [#5247](https://github.com/ClickHouse/ClickHouse/pull/5247) ([Winter Zhang](https://github.com/zhang2014))
- 一時的に LFAlloc を無効化しました。LFAlloc を使用すると、UncompressedCache の割り当て時に多数の MAP_FAILED が発生し、その結果、高負荷のサーバー上でクエリがクラッシュする可能性があります。 [cfdba93](https://github.com/ClickHouse/ClickHouse/commit/cfdba938ce22f16efeec504f7f90206a515b1280)([Danila Kutenin](https://github.com/danlark1))

### ClickHouse リリース 19.6.2.11, 2019-05-13 \\{#clickhouse-release-19-6-2-11-2019-05-13\\}

#### 新機能 \\{#new-features-3\\}

- カラムおよびテーブルに対する TTL 式をサポートしました。 [#4212](https://github.com/ClickHouse/ClickHouse/pull/4212) ([Anton Popov](https://github.com/CurtizJ))
- HTTP レスポンスに対する `brotli` 圧縮（Accept-Encoding: br）のサポートを追加しました。 [#4388](https://github.com/ClickHouse/ClickHouse/pull/4388) ([Mikhail](https://github.com/fandyushin))
- バイト列が正しく UTF-8 エンコードされているかを検証するための新しい関数 `isValidUTF8` を追加しました。 [#4934](https://github.com/ClickHouse/ClickHouse/pull/4934) ([Danila Kutenin](https://github.com/danlark1))
- 新しいロードバランシングポリシー `first_or_random` を追加しました。これは、クエリをまず最初に指定されたホストへ送信し、それが到達不能な場合はシャード内のランダムなホストへクエリを送信します。クロスレプリケーションのトポロジ構成に有用です。 [#5012](https://github.com/ClickHouse/ClickHouse/pull/5012) ([nvartolomei](https://github.com/nvartolomei))

#### 実験的機能 \\{#experimental-features-1\\}

- MergeTree\* テーブルファミリー向けに、`index_granularity_bytes`（アダプティブインデックス粒度）設定を追加しました。 [#4826](https://github.com/ClickHouse/ClickHouse/pull/4826) ([alesapin](https://github.com/alesapin))

#### 改善点 \\{#improvements-1\\}

- 関数 `substringUTF8` に対して、非定数および負の size / length 引数のサポートを追加。 [#4989](https://github.com/ClickHouse/ClickHouse/pull/4989) ([alexey-milovidov](https://github.com/alexey-milovidov))
- LEFT JOIN における右テーブル、RIGHT JOIN における左テーブル、FULL JOIN における両テーブルへのプッシュダウンを無効化。これにより一部のケースで発生していた誤った JOIN 結果を修正。 [#4846](https://github.com/ClickHouse/ClickHouse/pull/4846) ([Ivan](https://github.com/abyss7))
- `clickhouse-copier`: `--task-file` オプションからタスク設定を自動的にアップロードする機能を追加。 [#4876](https://github.com/ClickHouse/ClickHouse/pull/4876) ([proller](https://github.com/proller))
- storage factory および table functions factory 向けのタイポハンドラーを追加。 [#4891](https://github.com/ClickHouse/ClickHouse/pull/4891) ([Danila Kutenin](https://github.com/danlark1))
- サブクエリを使わない複数の JOIN に対して、アスタリスクおよび修飾アスタリスクをサポート。 [#4898](https://github.com/ClickHouse/ClickHouse/pull/4898) ([Artem Zuikov](https://github.com/4ertus2))
- 存在しないカラムに対するエラーメッセージをよりユーザーフレンドリーに改善。 [#4915](https://github.com/ClickHouse/ClickHouse/pull/4915) ([Artem Zuikov](https://github.com/4ertus2))

#### パフォーマンスの改善 \\{#performance-improvements-2\\}

- ASOF JOIN を大幅に高速化。 [#4924](https://github.com/ClickHouse/ClickHouse/pull/4924) ([Martijn Bakker](https://github.com/Gladdy))

#### 後方互換性のない変更 \\{#backward-incompatible-changes\\}

- 一貫性のため、HTTP ヘッダー `Query-Id` の名前を `X-ClickHouse-Query-Id` に変更。 [#4972](https://github.com/ClickHouse/ClickHouse/pull/4972) ([Mikhail](https://github.com/fandyushin))

#### バグ修正 \\{#bug-fixes-4\\}

- `clickhouse-copier` 内で発生しうるヌルポインタ参照を修正。 [#4900](https://github.com/ClickHouse/ClickHouse/pull/4900) ([proller](https://github.com/proller))
- JOIN + ARRAY JOIN を含むクエリでのエラーを修正。 [#4938](https://github.com/ClickHouse/ClickHouse/pull/4938) ([Artem Zuikov](https://github.com/4ertus2))
- engine=Dictionary のデータベースを介して、ある辞書が別の辞書に依存している場合に、サーバー起動時にハングする問題を修正。 [#4962](https://github.com/ClickHouse/ClickHouse/pull/4962) ([Vitaly Baranov](https://github.com/vitlibar))
- `distributed_product_mode = local` を部分的に修正。テーブルエイリアスを用いることで、WHERE/HAVING/ORDER BY/... でローカルテーブルのカラムを使用できるようにした。テーブルにエイリアスがない場合は例外をスローする。現時点ではテーブルエイリアスなしでカラムへアクセスすることはまだできない。 [#4986](https://github.com/ClickHouse/ClickHouse/pull/4986) ([Artem Zuikov](https://github.com/4ertus2))
- `JOIN` を伴う `SELECT DISTINCT` で結果が誤る可能性がある問題を修正。 [#5001](https://github.com/ClickHouse/ClickHouse/pull/5001) ([Artem Zuikov](https://github.com/4ertus2))
- 少なくとも 2 つの SELECT が system.columns、system.tables、system.parts、system.parts_tables、あるいは Merge 系のテーブルからの SELECT を含む UNION ALL クエリを実行中に、関連テーブルのカラムに対する ALTER を同時に実行した場合に、ごくまれに発生しうるデータレース状態を修正。 [#5189](https://github.com/ClickHouse/ClickHouse/pull/5189) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### ビルド／テスト／パッケージングの改善 \\{#buildtestingpackaging-improvements-2\\}

- 異なるホスト上で clickhouse-server を実行した際のテスト失敗を修正しました [#4713](https://github.com/ClickHouse/ClickHouse/pull/4713) ([Vasily Nemkov](https://github.com/Enmk))
- clickhouse-test: 非TTY環境でカラー制御シーケンスを無効化しました [#4937](https://github.com/ClickHouse/ClickHouse/pull/4937) ([alesapin](https://github.com/alesapin))
- clickhouse-test: 任意のテストデータベースを使用できるようにし、可能な箇所では `test.` 修飾子を削除しました [#5008](https://github.com/ClickHouse/ClickHouse/pull/5008) ([proller](https://github.com/proller))
- ubsan エラーを修正しました [#5037](https://github.com/ClickHouse/ClickHouse/pull/5037) ([Vitaly Baranov](https://github.com/vitlibar))
- Yandex LFAlloc を ClickHouse に追加し、MarkCache と UncompressedCache のデータを異なる方法で確保することで、セグメンテーションフォルトをより確実に検出できるようにしました [#4995](https://github.com/ClickHouse/ClickHouse/pull/4995) ([Danila Kutenin](https://github.com/danlark1))
- バックポートおよびチェンジログ作成を支援する Python ユーティリティを追加しました [#4949](https://github.com/ClickHouse/ClickHouse/pull/4949) ([Ivan](https://github.com/abyss7))

## ClickHouse リリース 19.5 \\{#clickhouse-release-19-5\\}

### ClickHouse リリース 19.5.4.22, 2019-05-13 \\{#clickhouse-release-19-5-4-22-2019-05-13\\}

#### バグ修正 \\{#bug-fixes-5\\}

- bitmap\* 関数で発生しうるクラッシュを修正しました。 [#5220](https://github.com/ClickHouse/ClickHouse/pull/5220) [#5228](https://github.com/ClickHouse/ClickHouse/pull/5228) ([Andy Yang](https://github.com/andyyzh))
- 次の条件で発生しうる、非常にまれなデータレースを修正しました。`system.columns`、`system.tables`、`system.parts`、`system.parts_tables` または Merge ファミリのテーブルからの少なくとも 2 つの `SELECT` を含む `UNION ALL` を実行している最中に、関連するテーブルのカラムに対して `ALTER` を並行して実行した場合です。 [#5189](https://github.com/ClickHouse/ClickHouse/pull/5189) ([alexey-milovidov](https://github.com/alexey-milovidov))
- エラー `Set for IN is not created yet in case of using single LowCardinality column in the left part of IN` を修正しました。このエラーは、`LowCardinality` カラムが主キーの一部である場合に発生していました。 #5031 [#5154](https://github.com/ClickHouse/ClickHouse/pull/5154) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- `retention` 関数の動作を変更しました。以前は、ある行が最初の条件と N 番目の条件の両方を満たす場合、データ状態には最初に満たされた条件だけが追加されていました。現在は、その行で満たされるすべての条件がデータ状態に追加されます。 [#5119](https://github.com/ClickHouse/ClickHouse/pull/5119) ([小路](https://github.com/nicelulu))

### ClickHouse リリース 19.5.3.8, 2019-04-18 \\{#clickhouse-release-19-5-3-8-2019-04-18\\}

#### バグ修正 \\{#bug-fixes-6\\}

- 設定 `max_partitions_per_insert_block` の型を boolean から UInt64 に修正しました。 [#5028](https://github.com/ClickHouse/ClickHouse/pull/5028) ([Mohammad Hossein Sekhavat](https://github.com/mhsekhavat))

### ClickHouse リリース 19.5.2.6, 2019-04-15 \\{#clickhouse-release-19-5-2-6-2019-04-15\\}

#### 新機能 \\{#new-features-4\\}

- [Hyperscan](https://github.com/intel/hyperscan) による複数の正規表現マッチングが追加されました（関数 `multiMatchAny`、`multiMatchAnyIndex`、`multiFuzzyMatchAny`、`multiFuzzyMatchAnyIndex`）。 [#4780](https://github.com/ClickHouse/ClickHouse/pull/4780), [#4841](https://github.com/ClickHouse/ClickHouse/pull/4841) ([Danila Kutenin](https://github.com/danlark1))
- 関数 `multiSearchFirstPosition` が追加されました。 [#4780](https://github.com/ClickHouse/ClickHouse/pull/4780) ([Danila Kutenin](https://github.com/danlark1))
- テーブルに対して、行ごとの事前定義済み式フィルタを実装しました。 [#4792](https://github.com/ClickHouse/ClickHouse/pull/4792) ([Ivan](https://github.com/abyss7))
- Bloom filter に基づく新しい種類のデータスキップインデックスを追加しました（`equal`、`in`、`like` 関数で使用可能）。 [#4499](https://github.com/ClickHouse/ClickHouse/pull/4499) ([Nikita Vasilev](https://github.com/nikvas0))
- 直近の既知の値に対して JOIN するクエリを実行できる `ASOF JOIN` を追加しました。 [#4774](https://github.com/ClickHouse/ClickHouse/pull/4774) [#4867](https://github.com/ClickHouse/ClickHouse/pull/4867) [#4863](https://github.com/ClickHouse/ClickHouse/pull/4863) [#4875](https://github.com/ClickHouse/ClickHouse/pull/4875) ([Martijn Bakker](https://github.com/Gladdy), [Artem Zuikov](https://github.com/4ertus2))
- 複数の `COMMA JOIN` を `CROSS JOIN` に書き換えるようにしました。さらに、可能であれば `INNER JOIN` に書き換えます。 [#4661](https://github.com/ClickHouse/ClickHouse/pull/4661) ([Artem Zuikov](https://github.com/4ertus2))

#### 改善 \\{#improvement-9\\}

- `topK` と `topKWeighted` でカスタム `loadFactor` をサポートしました（issue [#4252](https://github.com/ClickHouse/ClickHouse/issues/4252) を修正）。[#4634](https://github.com/ClickHouse/ClickHouse/pull/4634) ([Kirill Danshin](https://github.com/kirillDanshin))
- サンプリングなしのテーブルでも `parallel_replicas_count > 1` を使用できるようにしました（そのようなテーブルではこの設定は単に無視されます）。以前のバージョンでは例外が発生していました。[#4637](https://github.com/ClickHouse/ClickHouse/pull/4637) ([Alexey Elymanov](https://github.com/digitalist))
- `CREATE OR REPLACE VIEW` をサポートしました。1つのステートメントでビューの作成と新しい定義の設定を行えるようになりました。[#4654](https://github.com/ClickHouse/ClickHouse/pull/4654) ([Boris Granveaud](https://github.com/bgranvea))
- `Buffer` テーブルエンジンが `PREWHERE` をサポートしました。[#4671](https://github.com/ClickHouse/ClickHouse/pull/4671) ([Yangkuan Liu](https://github.com/LiuYangkuan))
- ZooKeeper にメタデータが存在しない状態でも、`readonly` モードでレプリケーテッドテーブルを起動できるようにしました。[#4691](https://github.com/ClickHouse/ClickHouse/pull/4691) ([alesapin](https://github.com/alesapin))
- clickhouse-client におけるプログレスバーのちらつきを修正しました。この問題は、ストリーミングクエリで `FORMAT Null` を使用した場合に最も顕著でした。[#4811](https://github.com/ClickHouse/ClickHouse/pull/4811) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 潜在的に過剰かつ制御不能なリソース使用を抑制するため、ユーザーごとに `hyperscan` ライブラリを用いる関数を無効化できるようにしました。[#4816](https://github.com/ClickHouse/ClickHouse/pull/4816) ([alexey-milovidov](https://github.com/alexey-milovidov))
- すべてのエラーにバージョン番号のロギングを追加しました。[#4824](https://github.com/ClickHouse/ClickHouse/pull/4824) ([proller](https://github.com/proller))
- `multiMatch` 関数に対し、文字列サイズが `unsigned int` に収まることを要求する制約を追加しました。また、`multiSearch` 関数には引数数の上限を追加しました。[#4834](https://github.com/ClickHouse/ClickHouse/pull/4834) ([Danila Kutenin](https://github.com/danlark1))
- Hyperscan におけるスクラッチ領域の利用方法とエラーハンドリングを改善しました。[#4866](https://github.com/ClickHouse/ClickHouse/pull/4866) ([Danila Kutenin](https://github.com/danlark1))
- `*GraphiteMergeTree` エンジンのテーブル設定に基づいて `system.graphite_detentions` を埋めるようにしました。[#4584](https://github.com/ClickHouse/ClickHouse/pull/4584) ([Mikhail f. Shiryaev](https://github.com/Felixoid))
- `trigramDistance` 関数の名称を `ngramDistance` に変更し、`CaseInsensitive` および `UTF` を伴う追加の関数を追加しました。[#4602](https://github.com/ClickHouse/ClickHouse/pull/4602) ([Danila Kutenin](https://github.com/danlark1))
- データスキッピングインデックスの計算を改善しました。[#4640](https://github.com/ClickHouse/ClickHouse/pull/4640) ([Nikita Vasilev](https://github.com/nikvas0))
- 通常のカラム、`DEFAULT`、`MATERIALIZED`、`ALIAS` カラムを単一のリストとして保持するようにしました（issue [#2867](https://github.com/ClickHouse/ClickHouse/issues/2867) を修正）。[#4707](https://github.com/ClickHouse/ClickHouse/pull/4707) ([Alex Zatelepin](https://github.com/ztlpn))

#### バグ修正 \\{#bug-fix-26\\}

* メモリ割り当て失敗時に `std::terminate` が呼び出されないようにしました。これにより、期待どおり `std::bad_alloc` 例外がスローされるようになりました。 [#4665](https://github.com/ClickHouse/ClickHouse/pull/4665) ([alexey-milovidov](https://github.com/alexey-milovidov))
* バッファからの読み込み時の `capnproto` の処理を修正。HTTP 経由でファイルが正常に読み込まれないことがある問題を修正。[#4674](https://github.com/ClickHouse/ClickHouse/pull/4674) ([Vladislav](https://github.com/smirnov-vs))
* `OPTIMIZE TABLE FINAL` クエリ実行後に発生するエラー `Unknown log entry type: 0` を修正。 [#4683](https://github.com/ClickHouse/ClickHouse/pull/4683) ([Amos Bird](https://github.com/amosbird))
* `hasAny` または `hasAll` 関数に誤った引数を指定すると、セグメンテーションフォルトが発生する可能性があります。 [#4698](https://github.com/ClickHouse/ClickHouse/pull/4698) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `DROP DATABASE dictionary` クエリの実行中にデッドロックが発生する可能性があります。 [#4701](https://github.com/ClickHouse/ClickHouse/pull/4701) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `median` 関数および `quantile` 関数における未定義の動作を修正。[#4702](https://github.com/ClickHouse/ClickHouse/pull/4702) ([hcz](https://github.com/hczhcz))
* `network_compression_method` が小文字指定の場合の圧縮レベル検出を修正。v19.1 で正しく動作していなかった不具合。[#4706](https://github.com/ClickHouse/ClickHouse/pull/4706) ([proller](https://github.com/proller))
* `<timezone>UTC</timezone>` 設定が無視されていた問題を修正しました（issue [#4658](https://github.com/ClickHouse/ClickHouse/issues/4658) に対応）。[#4718](https://github.com/ClickHouse/ClickHouse/pull/4718)（[proller](https://github.com/proller)）
* `Distributed` テーブルにおける `histogram` 関数の挙動を修正。 [#4741](https://github.com/ClickHouse/ClickHouse/pull/4741) ([olegkv](https://github.com/olegkv))
* `destroy of a locked mutex` に関する TSan レポートを修正しました。 [#4742](https://github.com/ClickHouse/ClickHouse/pull/4742) ([alexey-milovidov](https://github.com/alexey-milovidov))
* system logs の使用における競合状態が原因で、シャットダウン時に発生していた TSan レポートを修正。part&#95;log が有効な場合にシャットダウン時に発生する可能性のあった use-after-free を修正。[#4758](https://github.com/ClickHouse/ClickHouse/pull/4758) ([alexey-milovidov](https://github.com/alexey-milovidov))
* エラー発生時に `ReplicatedMergeTreeAlterThread` におけるパーツの再チェック処理を修正。 [#4772](https://github.com/ClickHouse/ClickHouse/pull/4772) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 集約関数の中間状態に対する算術演算が、（サブクエリ結果などの）定数引数では動作していませんでした。 [#4776](https://github.com/ClickHouse/ClickHouse/pull/4776) ([alexey-milovidov](https://github.com/alexey-milovidov))
* メタデータ内のカラム名は常にバッククォートで囲んでください。そうしないと、`index` という名前のカラムを持つテーブルを作成できません（メタデータ内の形式不正な `ATTACH` クエリが原因でサーバーが再起動しなくなります）。 [#4782](https://github.com/ClickHouse/ClickHouse/pull/4782) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `Distributed` テーブルでの `ALTER ... MODIFY ORDER BY` 実行時に発生していたクラッシュを修正。 [#4790](https://github.com/ClickHouse/ClickHouse/pull/4790) ([TCeason](https://github.com/TCeason))
* `enable_optimize_predicate_expression` が有効な場合に `JOIN ON` で発生するセグメンテーションフォールトを修正。 [#4794](https://github.com/ClickHouse/ClickHouse/pull/4794) ([Winter Zhang](https://github.com/zhang2014))
* Kafka から Protobuf メッセージを読み込んだ後に余分な行が追加される不具合を修正。 [#4808](https://github.com/ClickHouse/ClickHouse/pull/4808) ([Vitaly Baranov](https://github.com/vitlibar))
* `JOIN` が not-nullable 列と nullable 列を扱う際にクラッシュする問題を修正しました。`ANY JOIN` と `join_use_nulls` における右側キーの `NULL` の扱いを修正しました。[#4815](https://github.com/ClickHouse/ClickHouse/pull/4815) ([Artem Zuikov](https://github.com/4ertus2))
* `clickhouse-copier` におけるセグメンテーションフォルトを修正。 [#4835](https://github.com/ClickHouse/ClickHouse/pull/4835) ([proller](https://github.com/proller))
* テーブルが並行してリネームまたは変更された場合の、`system.tables` からの `SELECT` における競合状態を修正しました。 [#4836](https://github.com/ClickHouse/ClickHouse/pull/4836) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 既に無効になっているデータパートを取得する際に発生していたデータレースを修正しました。 [#4839](https://github.com/ClickHouse/ClickHouse/pull/4839) ([alexey-milovidov](https://github.com/alexey-milovidov))
* MergeTree ファミリーのテーブルに対する `RENAME` 実行中にまれに発生しうるデータレースを修正しました。 [#4844](https://github.com/ClickHouse/ClickHouse/pull/4844) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `arrayIntersect` 関数で発生していたセグメンテーションフォルトを修正しました。定数引数と通常の引数が混在した状態で関数が呼び出されると、セグメンテーションフォルトが発生する場合がありました。 [#4847](https://github.com/ClickHouse/ClickHouse/pull/4847) ([Lixiang Qian](https://github.com/fancyqlx))
* `Array(LowCardinality)` 列において、列に空配列が長く連続して含まれているというまれなケースでの読み取り処理を修正しました。 [#4850](https://github.com/ClickHouse/ClickHouse/pull/4850) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* NULL 許容と非 NULL 許容のカラムを結合条件に含む `FULL/RIGHT JOIN` がクラッシュする問題を修正。 [#4855](https://github.com/ClickHouse/ClickHouse/pull/4855) ([Artem Zuikov](https://github.com/4ertus2))
* レプリカ間でパーツを取得する際に発生していた `No message received` 例外を修正。 [#4856](https://github.com/ClickHouse/ClickHouse/pull/4856) ([alesapin](https://github.com/alesapin))
* 単一の配列内に同じ値が複数回出現する場合に、`arrayIntersect` 関数が誤った結果を返す問題を修正しました。 [#4871](https://github.com/ClickHouse/ClickHouse/pull/4871) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 同時に実行される `ALTER COLUMN` クエリ間で発生しうるレースコンディションを修正し、サーバーがクラッシュする可能性があった問題を解消しました（issue [#3421](https://github.com/ClickHouse/ClickHouse/issues/3421) を修正）。[#4592](https://github.com/ClickHouse/ClickHouse/pull/4592) ([Alex Zatelepin](https://github.com/ztlpn))
* 定数カラムを含む `FULL/RIGHT JOIN` で誤った結果が返される問題を修正。 [#4723](https://github.com/ClickHouse/ClickHouse/pull/4723) ([Artem Zuikov](https://github.com/4ertus2))
* `GLOBAL JOIN` におけるアスタリスク指定時の重複を修正。 [#4705](https://github.com/ClickHouse/ClickHouse/pull/4705) ([Artem Zuikov](https://github.com/4ertus2))
* カラム型が指定されていない場合の `ALTER MODIFY` における `CODEC` カラムのパラメータ推論を修正。 [#4883](https://github.com/ClickHouse/ClickHouse/pull/4883) ([alesapin](https://github.com/alesapin))
* `URL` にフラグメントが含まれ、クエリが存在しない場合にも、関数 `cutQueryStringAndFragment()` と `queryStringAndFragment()` が正しく動作するようになりました。 [#4894](https://github.com/ClickHouse/ClickHouse/pull/4894) ([Vitaly Baranov](https://github.com/vitlibar))
* `min_bytes_to_use_direct_io` を 0 より大きい値に設定した際に、スレッドがカラムファイル内で後方にシークする必要が生じた場合に発生するまれなバグを修正。 [#4897](https://github.com/ClickHouse/ClickHouse/pull/4897) ([alesapin](https://github.com/alesapin))
* `LowCardinality` 引数を持つ集約関数での誤った引数型を修正しました（issue [#4919](https://github.com/ClickHouse/ClickHouse/issues/4919) を修正）。[#4922](https://github.com/ClickHouse/ClickHouse/pull/4922)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）
* `GLOBAL JOIN` における不正な名前修飾を修正。 [#4969](https://github.com/ClickHouse/ClickHouse/pull/4969) ([Artem Zuikov](https://github.com/4ertus2))
* 1970 年に対する関数 `toISOWeek` の結果を修正。 [#4988](https://github.com/ClickHouse/ClickHouse/pull/4988) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `ReplicatedMergeTree*` テーブルファミリーに対して `ON CLUSTER` で実行された場合に、`DROP`、`TRUNCATE`、`OPTIMIZE` クエリが重複して実行される不具合を修正。
  [#4991](https://github.com/ClickHouse/ClickHouse/pull/4991) ([alesapin](https://github.com/alesapin))

#### 後方互換性のない変更 \\{#backward-incompatible-change-8\\}

- 設定 `insert_sample_with_metadata` を `input_format_defaults_for_omitted_fields` に名称変更しました。 [#4771](https://github.com/ClickHouse/ClickHouse/pull/4771) ([Artem Zuikov](https://github.com/4ertus2))
- 設定 `max_partitions_per_insert_block` を追加しました（デフォルト値は 100）。挿入されるブロックにこれより多くのパーティションが含まれている場合、例外がスローされます。上限を撤廃したい場合は 0 に設定してください（非推奨）。 [#4845](https://github.com/ClickHouse/ClickHouse/pull/4845) ([alexey-milovidov](https://github.com/alexey-milovidov))
- マルチサーチ関数の名称を変更しました（`multiPosition` から `multiSearchAllPositions`、`multiSearch` から `multiSearchAny`、`firstMatch` から `multiSearchFirstIndex`）。 [#4780](https://github.com/ClickHouse/ClickHouse/pull/4780) ([Danila Kutenin](https://github.com/danlark1))

#### パフォーマンスの改善 \\{#performance-improvement-6\\}

- インライン化により Volnitsky サーチャーを最適化し、多数の needle または多数の類似 bigram を含むクエリに対して、検索性能を約 5〜10% 向上させました。 [#4862](https://github.com/ClickHouse/ClickHouse/pull/4862) ([Danila Kutenin](https://github.com/danlark1))
- すべての読み取りデータがキャッシュ内に含まれている場合に発生していた、設定 `use_uncompressed_cache` が 0 より大きいときのパフォーマンス問題を修正しました。 [#4913](https://github.com/ClickHouse/ClickHouse/pull/4913) ([alesapin](https://github.com/alesapin))

#### ビルド/テスト/パッケージングの改善 \\{#buildtestingpackaging-improvement-10\\}

- デバッグビルドのハードニング: より細かいメモリマップと ASLR を導入し、mark cache と index にメモリ保護を追加しました。これにより、ASan や MSan では検出できない場合でも、より多くのメモリ破壊バグを発見できるようになります。 [#4632](https://github.com/ClickHouse/ClickHouse/pull/4632) ([alexey-milovidov](https://github.com/alexey-milovidov))
- CMake 変数 `ENABLE_PROTOBUF`、`ENABLE_PARQUET`、`ENABLE_BROTLI` のサポートを追加し、上記の機能を有効/無効にできるようにしました（librdkafka や mysql などで行えることと同様）。 [#4669](https://github.com/ClickHouse/ClickHouse/pull/4669) ([Silviu Caragea](https://github.com/silviucpp))
- テスト実行後に一部のクエリがハングした場合に、プロセスリストとすべてのスレッドのスタックトレースを出力できる機能を追加しました。 [#4675](https://github.com/ClickHouse/ClickHouse/pull/4675) ([alesapin](https://github.com/alesapin))
- `clickhouse-test` で `Connection loss` エラー発生時にリトライを行うようにしました。 [#4682](https://github.com/ClickHouse/ClickHouse/pull/4682) ([alesapin](https://github.com/alesapin))
- packager スクリプトに、Vagrant を用いた FreeBSD ビルドおよび Thread Sanitizer を用いたビルドを追加しました。 [#4712](https://github.com/ClickHouse/ClickHouse/pull/4712) [#4748](https://github.com/ClickHouse/ClickHouse/pull/4748) ([alesapin](https://github.com/alesapin))
- インストール時に、`'default'` ユーザーのパスワード入力を求めるようにしました。 [#4725](https://github.com/ClickHouse/ClickHouse/pull/4725) ([proller](https://github.com/proller))
- `rdkafka` ライブラリでの警告を抑制しました。 [#4740](https://github.com/ClickHouse/ClickHouse/pull/4740) ([alexey-milovidov](https://github.com/alexey-milovidov))
- SSL なしでビルドできるようにしました。 [#4750](https://github.com/ClickHouse/ClickHouse/pull/4750) ([proller](https://github.com/proller))
- 任意のユーザーとして clickhouse-server イメージを起動できるようにする手段を追加しました。 [#4753](https://github.com/ClickHouse/ClickHouse/pull/4753) ([Mikhail f. Shiryaev](https://github.com/Felixoid))
- contrib の Boost を 1.69 にアップグレードしました。 [#4793](https://github.com/ClickHouse/ClickHouse/pull/4793) ([proller](https://github.com/proller))
- Thread Sanitizer を用いてコンパイルした場合に `mremap` の使用を無効化しました。驚くべきことに、TSan は `mmap` や `munmap` はフックしますが `mremap` はフックせず、その結果として誤検知が発生していました。stateful テストでの TSan レポートを修正しました。 [#4859](https://github.com/ClickHouse/ClickHouse/pull/4859) ([alexey-milovidov](https://github.com/alexey-milovidov))
- HTTP インターフェイス経由で format schema を使用するテストを追加しました。 [#4864](https://github.com/ClickHouse/ClickHouse/pull/4864) ([Vitaly Baranov](https://github.com/vitlibar))

## ClickHouse リリース 19.4 \\{#clickhouse-release-19-4\\}

### ClickHouse リリース 19.4.4.33, 2019-04-17 \\{#clickhouse-release-19-4-4-33-2019-04-17\\}

#### バグ修正 \\{#bug-fixes-7\\}

* メモリ割り当てが失敗した場合に `std::terminate` を呼び出さないようにしました。これにより、期待どおりに `std::bad_alloc` 例外が送出されるようになりました。 [#4665](https://github.com/ClickHouse/ClickHouse/pull/4665) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `capnproto` によるバッファからの読み込み処理を修正。HTTP 経由でファイルが正常に読み込めないことがありました。 [#4674](https://github.com/ClickHouse/ClickHouse/pull/4674) ([Vladislav](https://github.com/smirnov-vs))
* `OPTIMIZE TABLE FINAL` クエリの実行後に発生するエラー `Unknown log entry type: 0` を修正。 [#4683](https://github.com/ClickHouse/ClickHouse/pull/4683) ([Amos Bird](https://github.com/amosbird))
* `hasAny` または `hasAll` 関数への誤った引数指定により、セグメンテーションフォルトが発生する可能性があります。 [#4698](https://github.com/ClickHouse/ClickHouse/pull/4698) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `DROP DATABASE dictionary` クエリの実行中にデッドロックが発生することがあります。 [#4701](https://github.com/ClickHouse/ClickHouse/pull/4701) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `median` 関数および `quantile` 関数における未定義動作を修正。 [#4702](https://github.com/ClickHouse/ClickHouse/pull/4702) ([hcz](https://github.com/hczhcz))
* `network_compression_method` が小文字の場合の圧縮レベルの検出を修正。v19.1 で発生していた不具合。[#4706](https://github.com/ClickHouse/ClickHouse/pull/4706) ([proller](https://github.com/proller))
* `<timezone>UTC</timezone>` 設定が無視されていた問題を修正しました（issue [#4658](https://github.com/ClickHouse/ClickHouse/issues/4658) を修正）。[#4718](https://github.com/ClickHouse/ClickHouse/pull/4718)（[proller](https://github.com/proller)）
* `Distributed` テーブルにおける `histogram` 関数の動作を修正。 [#4741](https://github.com/ClickHouse/ClickHouse/pull/4741) ([olegkv](https://github.com/olegkv))
* TSan レポート `destroy of a locked mutex` を修正しました。 [#4742](https://github.com/ClickHouse/ClickHouse/pull/4742) ([alexey-milovidov](https://github.com/alexey-milovidov))
* システムログの利用時の競合状態によりシャットダウン時に発生していた TSan レポートを修正しました。`part_log` が有効な場合にシャットダウン時に発生する可能性があった use-after-free の問題を修正しました。 [#4758](https://github.com/ClickHouse/ClickHouse/pull/4758) ([alexey-milovidov](https://github.com/alexey-milovidov))
* エラー時の `ReplicatedMergeTreeAlterThread` における再チェック処理を修正しました。 [#4772](https://github.com/ClickHouse/ClickHouse/pull/4772) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 集約関数の中間状態に対する算術演算が、サブクエリ結果などの定数引数については正しく動作していませんでした。 [#4776](https://github.com/ClickHouse/ClickHouse/pull/4776) ([alexey-milovidov](https://github.com/alexey-milovidov))
* メタデータ内の列名は常にバッククォートで囲んでください。そうしない場合、`index` という名前の列を持つテーブルを作成できず（メタデータ内の `ATTACH` クエリが不正になりサーバーが起動できなくなるため）、問題が発生します。 [#4782](https://github.com/ClickHouse/ClickHouse/pull/4782) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `Distributed` テーブルに対する `ALTER ... MODIFY ORDER BY` でクラッシュする問題を修正。 [#4790](https://github.com/ClickHouse/ClickHouse/pull/4790) ([TCeason](https://github.com/TCeason))
* `enable_optimize_predicate_expression` が有効な場合に `JOIN ON` で発生するセグメンテーションフォールトを修正。 [#4794](https://github.com/ClickHouse/ClickHouse/pull/4794) ([Winter Zhang](https://github.com/zhang2014))
* Kafka から protobuf メッセージを取り込んだ後に余計な行が追加されてしまうバグを修正。[#4808](https://github.com/ClickHouse/ClickHouse/pull/4808) ([Vitaly Baranov](https://github.com/vitlibar))
* `clickhouse-copier` のセグメンテーションフォルトを修正。[#4835](https://github.com/ClickHouse/ClickHouse/pull/4835) ([proller](https://github.com/proller))
* `system.tables` からの `SELECT` において、テーブルが並行してリネームまたは ALTER 文で変更された場合に発生する競合状態を修正しました。 [#4836](https://github.com/ClickHouse/ClickHouse/pull/4836) ([alexey-milovidov](https://github.com/alexey-milovidov))
* すでに無効になっているデータパートをフェッチする際に発生していたデータレースを修正しました。 [#4839](https://github.com/ClickHouse/ClickHouse/pull/4839) ([alexey-milovidov](https://github.com/alexey-milovidov))
* MergeTree ファミリーのテーブルに対する `RENAME` 実行時に稀に発生しうるデータレースを修正しました。 [#4844](https://github.com/ClickHouse/ClickHouse/pull/4844) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 関数 `arrayIntersect` におけるセグメンテーションフォルトを修正しました。定数引数と通常の引数が混在した状態で関数が呼び出されると、セグメンテーションフォルトが発生する可能性がありました。 [#4847](https://github.com/ClickHouse/ClickHouse/pull/4847) ([Lixiang Qian](https://github.com/fancyqlx))
* 列に空配列が長く連続して含まれているというまれなケースでの `Array(LowCardinality)` 型列からの読み取りを修正しました。 [#4850](https://github.com/ClickHouse/ClickHouse/pull/4850) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* レプリカ間でパーツをフェッチする際に発生していた `No message received` 例外を修正。 [#4856](https://github.com/ClickHouse/ClickHouse/pull/4856) ([alesapin](https://github.com/alesapin))
* 1 つの配列内に同じ値が複数回含まれている場合に、`arrayIntersect` 関数が誤った結果を返していた問題を修正。 [#4871](https://github.com/ClickHouse/ClickHouse/pull/4871) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* 同時に実行される `ALTER COLUMN` クエリ間でサーバークラッシュを引き起こし得たレースコンディションを修正（issue [#3421](https://github.com/ClickHouse/ClickHouse/issues/3421) を修正）。[#4592](https://github.com/ClickHouse/ClickHouse/pull/4592)（[Alex Zatelepin](https://github.com/ztlpn)）
* `CODEC` カラムに対する `ALTER MODIFY` において、カラム型が指定されていない場合のパラメータ推論を修正しました。 [#4883](https://github.com/ClickHouse/ClickHouse/pull/4883) ([alesapin](https://github.com/alesapin))
* `URL` にフラグメントを含み、クエリが存在しない場合でも、関数 `cutQueryStringAndFragment()` と `queryStringAndFragment()` が正しく動作するようになりました。 [#4894](https://github.com/ClickHouse/ClickHouse/pull/4894) ([Vitaly Baranov](https://github.com/vitlibar))
* `min_bytes_to_use_direct_io` が 0 より大きい値に設定されている場合に、スレッドがカラムファイル内で後方にシークしなければならないときにまれに発生していたバグを修正。 [#4897](https://github.com/ClickHouse/ClickHouse/pull/4897) ([alesapin](https://github.com/alesapin))
* `LowCardinality` 引数を持つ集約関数に対する不正な引数型を修正（issue [#4919](https://github.com/ClickHouse/ClickHouse/issues/4919) を修正）。 [#4922](https://github.com/ClickHouse/ClickHouse/pull/4922)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）
* 関数 `toISOWeek` における 1970 年の結果を修正しました。 [#4988](https://github.com/ClickHouse/ClickHouse/pull/4988) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `ReplicatedMergeTree*` テーブルファミリーに対して `ON CLUSTER` で実行した際に発生していた、`DROP`、`TRUNCATE`、`OPTIMIZE` クエリの重複実行を修正しました。 [#4991](https://github.com/ClickHouse/ClickHouse/pull/4991) ([alesapin](https://github.com/alesapin))

#### 改善 \\{#improvements-2\\}

- 通常のカラムと `DEFAULT`、`MATERIALIZED`、`ALIAS` カラムを、1 つのリストとしてまとめて保持するようにしました（issue [#2867](https://github.com/ClickHouse/ClickHouse/issues/2867) の修正）。[#4707](https://github.com/ClickHouse/ClickHouse/pull/4707)（[Alex Zatelepin](https://github.com/ztlpn)）

### ClickHouse Release 19.4.3.11, 2019-04-02 \\{#clickhouse-release-19-4-3-11-2019-04-02\\}

#### 不具合修正 \\{#bug-fixes-8\\}

- `FULL/RIGHT JOIN` において、nullable カラムと non-nullable カラムを結合する場合にクラッシュする問題を修正しました。[#4855](https://github.com/ClickHouse/ClickHouse/pull/4855)（[Artem Zuikov](https://github.com/4ertus2)）
- `clickhouse-copier` におけるセグメンテーションフォルトを修正しました。[#4835](https://github.com/ClickHouse/ClickHouse/pull/4835)（[proller](https://github.com/proller)）

#### ビルド / テスト / パッケージングの改善 \\{#buildtestingpackaging-improvement-11\\}

- 任意のユーザーで clickhouse-server イメージを起動できるようにしました。[#4753](https://github.com/ClickHouse/ClickHouse/pull/4753)（[Mikhail f. Shiryaev](https://github.com/Felixoid)）

### ClickHouse Release 19.4.2.7, 2019-03-30 \\{#clickhouse-release-19-4-2-7-2019-03-30\\}

#### 不具合修正 \\{#bug-fixes-9\\}

- カラムに空配列の長いシーケンスが含まれているというまれなケースで、`Array(LowCardinality)` カラムからの読み取りが失敗する問題を修正しました。[#4850](https://github.com/ClickHouse/ClickHouse/pull/4850)（[Nikolai Kochetov](https://github.com/KochetovNicolai)）

### ClickHouse Release 19.4.1.3, 2019-03-19 \\{#clickhouse-release-19-4-1-3-2019-03-19\\}

#### 不具合修正 \\{#bug-fixes-10\\}

- `LIMIT BY` と `LIMIT` の両方を含むリモートクエリを修正しました。以前は、リモートクエリで `LIMIT BY` と `LIMIT` を使用すると、`LIMIT BY` の前に `LIMIT` が適用されることがあり、その結果として過剰に絞り込まれた結果が返されていました。[#4708](https://github.com/ClickHouse/ClickHouse/pull/4708)（[Constantin S. Pan](https://github.com/kvap)）

### ClickHouse Release 19.4.0.49, 2019-03-09 \\{#clickhouse-release-19-4-0-49-2019-03-09\\}

#### 新機能 \\{#new-features-5\\}

- `Protobuf` フォーマット（入力および出力、ネストしたデータ構造）を完全にサポート。 [#4174](https://github.com/ClickHouse/ClickHouse/pull/4174) [#4493](https://github.com/ClickHouse/ClickHouse/pull/4493) ([Vitaly Baranov](https://github.com/vitlibar))
- Roaring Bitmap を用いたビットマップ関数を追加。 [#4207](https://github.com/ClickHouse/ClickHouse/pull/4207) ([Andy Yang](https://github.com/andyyzh)) [#4568](https://github.com/ClickHouse/ClickHouse/pull/4568) ([Vitaly Baranov](https://github.com/vitlibar))
- Parquet フォーマットのサポートを追加。 [#4448](https://github.com/ClickHouse/ClickHouse/pull/4448) ([proller](https://github.com/proller))
- あいまい文字列比較のために N グラム距離を追加。R 言語における q グラム指標に類似。 [#4466](https://github.com/ClickHouse/ClickHouse/pull/4466) ([Danila Kutenin](https://github.com/danlark1))
- 専用の集約パターンおよび保持パターンを組み合わせて、Graphite ロールアップのルールを統合。 [#4426](https://github.com/ClickHouse/ClickHouse/pull/4426) ([Mikhail f. Shiryaev](https://github.com/Felixoid))
- リソース使用量を制限するために `max_execution_speed` と `max_execution_speed_bytes` を追加。`min_execution_speed` を補完する設定として `min_execution_speed_bytes` を追加。 [#4430](https://github.com/ClickHouse/ClickHouse/pull/4430) ([Winter Zhang](https://github.com/zhang2014))
- 関数 `flatten` を実装。 [#4555](https://github.com/ClickHouse/ClickHouse/pull/4555) [#4409](https://github.com/ClickHouse/ClickHouse/pull/4409) ([alexey-milovidov](https://github.com/alexey-milovidov), [kzon](https://github.com/kzon))
- 関数 `arrayEnumerateDenseRanked` と `arrayEnumerateUniqRanked` を追加（`arrayEnumerateUniq` に似ているが、多次元配列の内部を参照するための配列の深さを細かく調整可能）。 [#4475](https://github.com/ClickHouse/ClickHouse/pull/4475) ([proller](https://github.com/proller)) [#4601](https://github.com/ClickHouse/ClickHouse/pull/4601) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 制限付きで複数の JOIN をサポート：アスタリスクの使用禁止、ON/WHERE/GROUP BY/… での複雑なエイリアス禁止。 [#4462](https://github.com/ClickHouse/ClickHouse/pull/4462) ([Artem Zuikov](https://github.com/4ertus2))

#### バグ修正 \\{#bug-fixes-11\\}

* このリリースには、19.3 および 19.1 でのすべてのバグ修正も含まれています。
* data skipping index におけるバグを修正: INSERT 後の granule の順序が誤っていました。 [#4407](https://github.com/ClickHouse/ClickHouse/pull/4407) ([Nikita Vasilev](https://github.com/nikvas0))
* `Nullable` および `LowCardinality` カラムに対する `set` インデックスを修正しました。以前は、`Nullable` または `LowCardinality` カラムに対する `set` インデックスを用いて SELECT クエリを実行すると、`Data type must be deserialized with multiple streams` というエラーが発生していました。 [#4594](https://github.com/ClickHouse/ClickHouse/pull/4594) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
* `executable` 辞書のフル更新時に `update_time` が正しく設定されるように修正。 [#4551](https://github.com/ClickHouse/ClickHouse/pull/4551) ([Tema Novikov](https://github.com/temoon))
* バージョン 19.3 で壊れていた進捗バーを修正。 [#4627](https://github.com/ClickHouse/ClickHouse/pull/4627) ([filimonov](https://github.com/filimonov))
* 一部のケースでメモリ領域が縮小された際に、`MemoryTracker` の値が不整合になる問題を修正しました。 [#4619](https://github.com/ClickHouse/ClickHouse/pull/4619) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ThreadPool での未定義動作を修正しました。 [#4612](https://github.com/ClickHouse/ClickHouse/pull/4612) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `SELECT` の実行中に `MergeTree` テーブルが同時に `DROP` された場合に、非常にまれに発生する `mutex lock failed: Invalid argument` というメッセージ付きのクラッシュを修正しました。 [#4608](https://github.com/ClickHouse/ClickHouse/pull/4608) ([Alex Zatelepin](https://github.com/ztlpn))
* ODBC ドライバーの `LowCardinality` データ型対応。 [#4381](https://github.com/ClickHouse/ClickHouse/pull/4381) ([proller](https://github.com/proller))
* FreeBSD: `AIOcontextPool: Found io_event with unknown id 0` エラーの修正。 [#4438](https://github.com/ClickHouse/ClickHouse/pull/4438) ([urgordeadbeef](https://github.com/urgordeadbeef))
* `system.part_log` テーブルが設定にかかわらず作成されていました。 [#4483](https://github.com/ClickHouse/ClickHouse/pull/4483) ([alexey-milovidov](https://github.com/alexey-milovidov))
* キャッシュ辞書での `dictIsIn` 関数の未定義動作を修正。 [#4515](https://github.com/ClickHouse/ClickHouse/pull/4515) ([alesapin](https://github.com/alesapin))
* `SELECT` クエリが同一テーブルに対して複数回ロックを取得する場合（例: 別スレッドから実行される場合や、複数のサブクエリを実行する場合）に、同時に `DDL` クエリが実行されていると発生していたデッドロックを修正しました。 [#4535](https://github.com/ClickHouse/ClickHouse/pull/4535) ([Alex Zatelepin](https://github.com/ztlpn))
* 独自の `llvm` contrib を用意し、`clang` と `asan` でテストできるようになるまで、デフォルトでは compile&#95;expressions を無効にする。 [#4579](https://github.com/ClickHouse/ClickHouse/pull/4579) ([alesapin](https://github.com/alesapin))
* `clickhouse` 外部ディクショナリのソースに対する `invalidate_query` が不正な結果セット（空、複数行、または複数列）を返した場合に `std::terminate` が発生しないようにしました。`lifetime` に関係なく `invalidate_query` が 5 秒ごとに実行されていた問題を修正しました。 [#4583](https://github.com/ClickHouse/ClickHouse/pull/4583) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `clickhouse` ソースを持つ辞書に対する `invalidate_query` が `system.dictionaries` テーブルまたは `Dictionaries` データベースを参照していた場合に発生する可能性があるデッドロックを回避しました（まれなケース）。 [#4599](https://github.com/ClickHouse/ClickHouse/pull/4599) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 空の WHERE 句を伴う CROSS JOIN の不具合を修正。 [#4598](https://github.com/ClickHouse/ClickHouse/pull/4598) ([Artem Zuikov](https://github.com/4ertus2))
* 定数引数が渡された場合に関数 &quot;replicate&quot; で発生していたセグメンテーションフォルトを修正しました。 [#4603](https://github.com/ClickHouse/ClickHouse/pull/4603) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 述語オプティマイザ使用時の lambda 関数の不具合を修正。 [#4408](https://github.com/ClickHouse/ClickHouse/pull/4408) ([Winter Zhang](https://github.com/zhang2014))
* 複数の JOIN に関する不具合を修正。 [#4595](https://github.com/ClickHouse/ClickHouse/pull/4595) ([Artem Zuikov](https://github.com/4ertus2))

#### 改良点 \\{#improvements-3\\}

- 右側のテーブル列に対して、JOIN の ON 句でエイリアスをサポート。 [#4412](https://github.com/ClickHouse/ClickHouse/pull/4412) ([Artem Zuikov](https://github.com/4ertus2))
- 複数の JOIN の結果をサブセレクトで使用するには、正しい結果列名が必要となるため、結果内のフラットなエイリアスを元のソース名に置き換え。 [#4474](https://github.com/ClickHouse/ClickHouse/pull/4474) ([Artem Zuikov](https://github.com/4ertus2))
- 結合されたステートメントに対するプッシュダウンロジックを改善。 [#4387](https://github.com/ClickHouse/ClickHouse/pull/4387) ([Ivan](https://github.com/abyss7))

#### パフォーマンスの改善 \\{#performance-improvements-3\\}

- "move to PREWHERE" 最適化のヒューリスティクスを改善。 [#4405](https://github.com/ClickHouse/ClickHouse/pull/4405) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 8-bit および 16-bit キー向けに、HashTable の API を使用する適切なルックアップテーブルを利用。 [#4536](https://github.com/ClickHouse/ClickHouse/pull/4536) ([Amos Bird](https://github.com/amosbird))
- 文字列比較のパフォーマンスを改善。 [#4564](https://github.com/ClickHouse/ClickHouse/pull/4564) ([alexey-milovidov](https://github.com/alexey-milovidov))
- distributed DDL キューを別スレッドでクリーンアップし、distributed DDL タスクを処理するメインループを遅くしないようにした。 [#4502](https://github.com/ClickHouse/ClickHouse/pull/4502) ([Alex Zatelepin](https://github.com/ztlpn))
- `min_bytes_to_use_direct_io` が 1 に設定されている場合、読み取るデータサイズが圧縮ブロック 1 つ分のサイズで過小評価されることがあり、そのため一部のファイルが O_DIRECT モードでオープンされていなかった問題を修正。 [#4526](https://github.com/ClickHouse/ClickHouse/pull/4526) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### ビルド／テスト／パッケージングの改善 \\{#buildtestingpackaging-improvement-12\\}

- clang-9 のサポートを追加。[#4604](https://github.com/ClickHouse/ClickHouse/pull/4604) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 誤った `__asm__` 命令を再度修正。[#4621](https://github.com/ClickHouse/ClickHouse/pull/4621) ([Konstantin Podshumok](https://github.com/podshumok))
- コマンドラインから `clickhouse-performance-test` の設定を指定できる機能を追加。[#4437](https://github.com/ClickHouse/ClickHouse/pull/4437) ([alesapin](https://github.com/alesapin))
- 統合テストに dictionaries のテストを追加。[#4477](https://github.com/ClickHouse/ClickHouse/pull/4477) ([alesapin](https://github.com/alesapin))
- Web サイト上のベンチマークに含まれるクエリを自動パフォーマンステストに追加。[#4496](https://github.com/ClickHouse/ClickHouse/pull/4496) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `xxhash.h` は外部 lz4 には存在しません。これは実装の詳細であり、そのシンボルは `XXH_NAMESPACE` マクロでネームスペース化されているためです。lz4 が外部である場合、xxHash も外部でなければならず、依存側はそれにリンクする必要があります。[#4495](https://github.com/ClickHouse/ClickHouse/pull/4495) ([Orivej Desh](https://github.com/orivej))
- `quantileTiming` 集約関数が負の値または浮動小数点の引数で呼び出される場合がある問題を修正（これにより undefined behaviour sanitizer を用いた fuzz テストが修正されます）。[#4506](https://github.com/ClickHouse/ClickHouse/pull/4506) ([alexey-milovidov](https://github.com/alexey-milovidov))
- スペルミスを修正。[#4531](https://github.com/ClickHouse/ClickHouse/pull/4531) ([sdk2](https://github.com/sdk2))
- macOS でのコンパイルを修正。[#4371](https://github.com/ClickHouse/ClickHouse/pull/4371) ([Vitaly Baranov](https://github.com/vitlibar))
- FreeBSD およびさまざまな変則的なビルド構成向けのビルド修正。[#4444](https://github.com/ClickHouse/ClickHouse/pull/4444) ([proller](https://github.com/proller))

## ClickHouse リリース 19.3 \\{#clickhouse-release-19-3\\}

### ClickHouse リリース 19.3.9.1, 2019-04-02 \\{#clickhouse-release-19-3-9-1-2019-04-02\\}

#### バグ修正 \\{#bug-fixes-12\\}

- `FULL/RIGHT JOIN` で、NULL 許容列と非 NULL 許容列を結合したときに発生するクラッシュを修正。[#4855](https://github.com/ClickHouse/ClickHouse/pull/4855) ([Artem Zuikov](https://github.com/4ertus2))
- `clickhouse-copier` でのセグメンテーションフォルトを修正。[#4835](https://github.com/ClickHouse/ClickHouse/pull/4835) ([proller](https://github.com/proller))
- 列に長い空配列のシーケンスが含まれているというまれなケースにおいて、`Array(LowCardinality)` 列の読み取り時に発生する不具合を修正。[#4850](https://github.com/ClickHouse/ClickHouse/pull/4850) ([Nikolai Kochetov](https://github.com/KochetovNicolai))

#### ビルド / テスト / パッケージングの改善 \\{#buildtestingpackaging-improvement-13\\}

- カスタムユーザーから `clickhouse-server` イメージを起動する方法を追加。[#4753](https://github.com/ClickHouse/ClickHouse/pull/4753) ([Mikhail f. Shiryaev](https://github.com/Felixoid))

### ClickHouse リリース 19.3.7, 2019-03-12 \\{#clickhouse-release-19-3-7-2019-03-12\\}

#### バグ修正 \\{#bug-fixes-13\\}

- #3920 のエラーを修正。このエラーは、ランダムなキャッシュ破損（`Unknown codec family code`、`Cannot seek through file` といったメッセージ）およびセグメンテーションフォルトとして現れる。このバグはバージョン 19.1 で初めて発生し、19.1.10 および 19.3.6 までのバージョンに存在する。[#4623](https://github.com/ClickHouse/ClickHouse/pull/4623) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.3.6, 2019-03-02 \\{#clickhouse-release-19-3-6-2019-03-02\\}

#### バグ修正 \\{#bug-fixes-14\\}

- スレッドプールに 1000 を超えるスレッドがある場合、スレッド終了時に `std::terminate` が発生する可能性がある。[Azat Khuzhin](https://github.com/azat) [#4485](https://github.com/ClickHouse/ClickHouse/pull/4485) [#4505](https://github.com/ClickHouse/ClickHouse/pull/4505) ([alexey-milovidov](https://github.com/alexey-milovidov))
- デフォルトのない列にコメントを付けた `ReplicatedMergeTree*` テーブル、ならびにコメントやデフォルトのない列コーデックを持つテーブルを作成できるようになった。また、コーデックの比較の不具合を修正。[#4523](https://github.com/ClickHouse/ClickHouse/pull/4523) ([alesapin](https://github.com/alesapin))
- 配列またはタプルを伴う JOIN でのクラッシュを修正。[#4552](https://github.com/ClickHouse/ClickHouse/pull/4552) ([Artem Zuikov](https://github.com/4ertus2))
- `ThreadStatus not created` というメッセージとともに発生する `clickhouse-copier` のクラッシュを修正。[#4540](https://github.com/ClickHouse/ClickHouse/pull/4540) ([Artem Zuikov](https://github.com/4ertus2))
- 分散 DDL が使用されている場合に、サーバーのシャットダウン時にハングアップする問題を修正。[#4472](https://github.com/ClickHouse/ClickHouse/pull/4472) ([Alex Zatelepin](https://github.com/ztlpn))
- 列番号が 10 を超える列に対してテキスト形式をパースする際のエラーメッセージで、誤った列番号が出力されていた問題を修正。[#4484](https://github.com/ClickHouse/ClickHouse/pull/4484) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### ビルド／テスト／パッケージングの改善 \\{#buildtestingpackaging-improvements-3\\}

- AVX を有効にしたビルドを修正。[#4527](https://github.com/ClickHouse/ClickHouse/pull/4527) ([alexey-milovidov](https://github.com/alexey-milovidov))
- コンパイル時のカーネルではなく、既知の安定バージョンに基づいて拡張アカウンティングおよび I/O アカウンティングを有効化。[#4541](https://github.com/ClickHouse/ClickHouse/pull/4541) ([nvartolomei](https://github.com/nvartolomei))
- `core_dump.size_limit` の設定をスキップできるようにし、制限の設定に失敗した場合は例外スローではなく警告を出すように変更。[#4473](https://github.com/ClickHouse/ClickHouse/pull/4473) ([proller](https://github.com/proller))
- `Field.cpp` 内の `void readBinary(...)` の `inline` 指定を削除。また、冗長な `namespace DB` ブロックを統合。[#4530](https://github.com/ClickHouse/ClickHouse/pull/4530) ([hcz](https://github.com/hczhcz))

### ClickHouse Release 19.3.5, 2019-02-21 \\{#clickhouse-release-19-3-5-2019-02-21\\}

#### バグ修正 \\{#bug-fixes-15\\}

- 大きな HTTP 経由の INSERT クエリの処理に関するバグを修正。[#4454](https://github.com/ClickHouse/ClickHouse/pull/4454) ([alesapin](https://github.com/alesapin))
- `send_logs_level` 設定の誤った実装により発生していた古いバージョンとの後方互換性の問題を修正。[#4445](https://github.com/ClickHouse/ClickHouse/pull/4445) ([alexey-milovidov](https://github.com/alexey-milovidov))
- カラムコメント導入時に発生したテーブル関数 `remote` の後方互換性の問題を修正。[#4446](https://github.com/ClickHouse/ClickHouse/pull/4446) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse Release 19.3.4, 2019-02-16 \\{#clickhouse-release-19-3-4-2019-02-16\\}

#### 改善 \\{#improvements-4\\}

- `ATTACH TABLE` クエリの実行時、テーブルインデックスのサイズはメモリ制限に含めないよう変更。これにより、デタッチ後にテーブルをアタッチできなくなる可能性を回避。[#4396](https://github.com/ClickHouse/ClickHouse/pull/4396) ([alexey-milovidov](https://github.com/alexey-milovidov))
- ZooKeeper から受信する文字列および配列の最大サイズ制限をわずかに引き上げ。これにより、ZooKeeper 側で `CLIENT_JVMFLAGS=-Djute.maxbuffer=...` によってサイズを増やした場合でも処理を継続可能。[#4398](https://github.com/ClickHouse/ClickHouse/pull/4398) ([alexey-milovidov](https://github.com/alexey-milovidov))
- キュー内に非常に多くのノードが存在する場合でも、放棄されたレプリカを修復できるように対応。[#4399](https://github.com/ClickHouse/ClickHouse/pull/4399) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `SET` インデックスに 1 つの必須引数（保存される最大行数）を追加。[#4386](https://github.com/ClickHouse/ClickHouse/pull/4386) ([Nikita Vasilev](https://github.com/nikvas0))

#### バグ修正 \\{#bug-fixes-16\\}

- 単一の `LowCardinality` キーでの `WITH ROLLUP` の結果を修正。[#4384](https://github.com/ClickHouse/ClickHouse/pull/4384) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- `SET` インデックスのバグを修正（`max_rows` を超える行数を含むグラニュールを削除してしまう問題）。[#4386](https://github.com/ClickHouse/ClickHouse/pull/4386) ([Nikita Vasilev](https://github.com/nikvas0))
- FreeBSD 向けビルドに関する多数の修正。[#4397](https://github.com/ClickHouse/ClickHouse/pull/4397) ([proller](https://github.com/proller))
- 同じエイリアスを含むサブクエリを持つクエリでのエイリアス置換を修正（issue [#4110](https://github.com/ClickHouse/ClickHouse/issues/4110)）。[#4351](https://github.com/ClickHouse/ClickHouse/pull/4351) ([Artem Zuikov](https://github.com/4ertus2))

#### ビルド／テスト／パッケージングの改善 \\{#buildtestingpackaging-improvements-4\\}

- Docker イメージ内でステートレステスト用に `clickhouse-server` を実行できるようになりました。 [#4347](https://github.com/ClickHouse/ClickHouse/pull/4347) ([Vasily Nemkov](https://github.com/Enmk))

### ClickHouse リリース 19.3.3, 2019-02-13 \\{#clickhouse-release-19-3-3-2019-02-13\\}

#### 新機能 \\{#new-features-6\\}

- 何らかの理由でスタックしてしまった mutation を削除できるようにする `KILL MUTATION` ステートメントを追加しました。トラブルシューティングを容易にするため、`system.mutations` テーブルに `latest_failed_part`、`latest_fail_time`、`latest_fail_reason` フィールドを追加しました。 [#4287](https://github.com/ClickHouse/ClickHouse/pull/4287) ([Alex Zatelepin](https://github.com/ztlpn))
- Shannon エントロピーを計算する集約関数 `entropy` を追加しました。 [#4238](https://github.com/ClickHouse/ClickHouse/pull/4238) ([Quid37](https://github.com/Quid37))
- クエリ `INSERT INTO tbl VALUES (....` を `query` 部分と `data` 部分に分割せずにサーバーへ送信できるようにしました。 [#4301](https://github.com/ClickHouse/ClickHouse/pull/4301) ([alesapin](https://github.com/alesapin))
- `arrayWithConstant` 関数の汎用実装を追加しました。 [#4322](https://github.com/ClickHouse/ClickHouse/pull/4322) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `NOT BETWEEN` 比較演算子を実装しました。 [#4228](https://github.com/ClickHouse/ClickHouse/pull/4228) ([Dmitry Naumov](https://github.com/nezed))
- `sumMap` によって値が集計されるキーの数を制限できるようにするため、`sumMapFiltered` を実装しました。 [#4129](https://github.com/ClickHouse/ClickHouse/pull/4129) ([Léo Ercolanelli](https://github.com/ercolanelli-leo))
- `mysql` テーブル関数で `Nullable` 型をサポートしました。 [#4198](https://github.com/ClickHouse/ClickHouse/pull/4198) ([Emmanuel Donin de Rosière](https://github.com/edonin))
- `LIMIT` 句で任意の定数式をサポートしました。 [#4246](https://github.com/ClickHouse/ClickHouse/pull/4246) ([k3box](https://github.com/k3box))
- 追加の引数として（符号なし整数の）重みを受け取る集約関数 `topKWeighted` を追加しました。 [#4245](https://github.com/ClickHouse/ClickHouse/pull/4245) ([Andrew Golman](https://github.com/andrewgolman))
- `StorageJoin` に、同一キーの既存値を上書きできる `join_any_take_last_row` 設定のサポートを追加しました。 [#3973](https://github.com/ClickHouse/ClickHouse/pull/3973) ([Amos Bird](https://github.com/amosbird))
- 関数 `toStartOfInterval` を追加しました。 [#4304](https://github.com/ClickHouse/ClickHouse/pull/4304) ([Vitaly Baranov](https://github.com/vitlibar))
- `RowBinaryWithNamesAndTypes` フォーマットを追加しました。 [#4200](https://github.com/ClickHouse/ClickHouse/pull/4200) ([Oleg V. Kozlyuk](https://github.com/DarkWanderer))
- `IPv4` および `IPv6` データ型を追加しました。`IPv*` 関数のより効率的な実装を追加しました。 [#3669](https://github.com/ClickHouse/ClickHouse/pull/3669) ([Vasily Nemkov](https://github.com/Enmk))
- 関数 `toStartOfTenMinutes()` を追加しました。 [#4298](https://github.com/ClickHouse/ClickHouse/pull/4298) ([Vitaly Baranov](https://github.com/vitlibar))
- `Protobuf` 出力フォーマットを追加しました。 [#4005](https://github.com/ClickHouse/ClickHouse/pull/4005) [#4158](https://github.com/ClickHouse/ClickHouse/pull/4158) ([Vitaly Baranov](https://github.com/vitlibar))
- データインポート（INSERT）用の HTTP インターフェースで brotli をサポートしました。 [#4235](https://github.com/ClickHouse/ClickHouse/pull/4235) ([Mikhail](https://github.com/fandyushin))
- コマンドラインクライアントで関数名や型にタイプミスがある場合にヒントを表示するようにしました。 [#4239](https://github.com/ClickHouse/ClickHouse/pull/4239) ([Danila Kutenin](https://github.com/danlark1))
- サーバーの HTTP レスポンスヘッダーに `Query-Id` を追加しました。 [#4231](https://github.com/ClickHouse/ClickHouse/pull/4231) ([Mikhail](https://github.com/fandyushin))

#### 実験的機能 \\{#experimental-features-2\\}

- MergeTree テーブルエンジンファミリー向けに、`minmax` および `set` データスキップインデックスを追加しました。 [#4143](https://github.com/ClickHouse/ClickHouse/pull/4143) ([Nikita Vasilev](https://github.com/nikvas0))
- 可能な場合に、`CROSS JOIN` を `INNER JOIN` に変換する機能を追加しました。 [#4221](https://github.com/ClickHouse/ClickHouse/pull/4221) [#4266](https://github.com/ClickHouse/ClickHouse/pull/4266) ([Artem Zuikov](https://github.com/4ertus2))

#### 不具合修正 \\{#bug-fixes-17\\}

* 重複した列がある場合に `JOIN ON` 句で発生していた `Not found column` エラーを修正しました。 [#4279](https://github.com/ClickHouse/ClickHouse/pull/4279) ([Artem Zuikov](https://github.com/4ertus2))
* `START REPLICATED SENDS` コマンドでレプリケート送信を開始できるようにした。 [#4229](https://github.com/ClickHouse/ClickHouse/pull/4229) ([nvartolomei](https://github.com/nvartolomei))
* `Array(LowCardinality)` 引数を取る集約関数の実行に関する不具合を修正しました。 [#4055](https://github.com/ClickHouse/ClickHouse/pull/4055) ([KochetovNicolai](https://github.com/KochetovNicolai))
* `INSERT ... SELECT ... FROM file(...)` クエリを実行した際に、ファイルのフォーマットが `CSVWithNames` または `TSVWIthNames` で、最初のデータ行が存在しない場合に発生していた誤動作を修正しました。 [#4297](https://github.com/ClickHouse/ClickHouse/pull/4297) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 辞書が利用できない状態でリロードを行うとクラッシュする問題を修正しました。このバグは 19.1.6 で導入されました。 [#4188](https://github.com/ClickHouse/ClickHouse/pull/4188) ([proller](https://github.com/proller))
* 右テーブルに重複行がある場合の `ALL JOIN` の不具合を修正。 [#4184](https://github.com/ClickHouse/ClickHouse/pull/4184) ([Artem Zuikov](https://github.com/4ertus2))
* `use_uncompressed_cache=1` の場合に発生していたセグメンテーションフォルトと、誤った非圧縮サイズによる例外を修正しました。このバグは 19.1.6 で導入されました。 [#4186](https://github.com/ClickHouse/ClickHouse/pull/4186) ([alesapin](https://github.com/alesapin))
* `compile_expressions` での int16 を超える日付値の比較に関するバグを修正しました。 [#4341](https://github.com/ClickHouse/ClickHouse/pull/4341) ([alesapin](https://github.com/alesapin))
* テーブル関数 `numbers(0)` からの SELECT の実行時に発生していた無限ループを修正。 [#4280](https://github.com/ClickHouse/ClickHouse/pull/4280) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `ORDER BY` の述語の最適化を一時的に無効化。[#3890](https://github.com/ClickHouse/ClickHouse/pull/3890) ([Winter Zhang](https://github.com/zhang2014))
* 古い CPU で base64 関数を使用すると発生する `Illegal instruction` エラーを修正しました。このエラーは、ClickHouse を gcc-8 でコンパイルした場合にのみ確認されています。 [#4275](https://github.com/ClickHouse/ClickHouse/pull/4275) ([alexey-milovidov](https://github.com/alexey-milovidov))
* TLS 接続経由で PostgreSQL ODBC Driver とやり取りする際に発生していた `No message received` エラーを修正しました。MySQL ODBC Driver 使用時に発生していたセグメンテーションフォルトも修正しました。 [#4170](https://github.com/ClickHouse/ClickHouse/pull/4170) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 条件演算子（関数 `if`）の分岐で `Date` および `DateTime` 引数が使用された場合に誤った結果が返される問題を修正しました。関数 `if` に汎用ケースを追加しました。 [#4243](https://github.com/ClickHouse/ClickHouse/pull/4243) ([alexey-milovidov](https://github.com/alexey-milovidov))
* ClickHouse の辞書は `clickhouse` プロセス内で読み込まれるようになりました。 [#4166](https://github.com/ClickHouse/ClickHouse/pull/4166) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `File` エンジンを使用するテーブルに対する `SELECT` が `No such file or directory` エラー後に再試行された際に発生していたデッドロックを修正。 [#4161](https://github.com/ClickHouse/ClickHouse/pull/4161) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `system.tables` から SELECT した際に `table does not exist` エラーが発生する可能性があったレースコンディションを修正しました。 [#4313](https://github.com/ClickHouse/ClickHouse/pull/4313) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `clickhouse-client` は、インタラクティブモードで実行された場合、コマンドライン補完用のデータを読み込む際に終了時にセグメンテーションフォルトを起こすことがあります。 [#4317](https://github.com/ClickHouse/ClickHouse/pull/4317) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `IN` 演算子を含むミューテーションの実行で誤った結果が返されていた不具合を修正しました。 [#4099](https://github.com/ClickHouse/ClickHouse/pull/4099) ([Alex Zatelepin](https://github.com/ztlpn))
* エラーを修正: `Dictionary` エンジンを使用するデータベースが存在する場合、すべてのディクショナリがサーバー起動時に強制的にロードされ、localhost 上の ClickHouse をソースとするディクショナリがあると、そのディクショナリがロードできない問題を修正しました。 [#4255](https://github.com/ClickHouse/ClickHouse/pull/4255) ([alexey-milovidov](https://github.com/alexey-milovidov))
* サーバーのシャットダウン時にシステムログを再作成しようとすると発生していたエラーを修正。 [#4254](https://github.com/ClickHouse/ClickHouse/pull/4254) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `joinGet` 関数が正しい型を返し、ロックを適切に処理するよう修正。 [#4153](https://github.com/ClickHouse/ClickHouse/pull/4153) ([Amos Bird](https://github.com/amosbird))
* `sumMapWithOverflow` 関数を追加しました。 [#4151](https://github.com/ClickHouse/ClickHouse/pull/4151) ([Léo Ercolanelli](https://github.com/ercolanelli-leo))
* `allow_experimental_multiple_joins_emulation` で発生するセグメンテーションフォールトを修正。 [52de2c](https://github.com/ClickHouse/ClickHouse/commit/52de2cd927f7b5257dd67e175f0a5560a48840d0) ([Artem Zuikov](https://github.com/4ertus2))
* 誤った `Date` と `DateTime` の比較を引き起こすバグを修正しました。 [#4237](https://github.com/ClickHouse/ClickHouse/pull/4237) ([valexey](https://github.com/valexey))
* 未定義動作サニタイザ有効時のファジングテストを修正し、`quantile*Weighted` 関数群にパラメータ型チェックを追加しました。 [#4145](https://github.com/ClickHouse/ClickHouse/pull/4145) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 古いデータパーツの削除処理時に `File not found` エラーで失敗する可能性があった、まれなレースコンディションを修正。 [#4378](https://github.com/ClickHouse/ClickHouse/pull/4378) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `/etc/clickhouse-server/config.xml` が欠落していたインストールパッケージの問題を修正。 [#4343](https://github.com/ClickHouse/ClickHouse/pull/4343) ([proller](https://github.com/proller))

#### ビルド／テスト／パッケージングの改善 \\{#buildtestingpackaging-improvements-5\\}

- Debian パッケージ: 設定に従って /etc/clickhouse-server/preprocessed のリンクを修正。 [#4205](https://github.com/ClickHouse/ClickHouse/pull/4205) ([proller](https://github.com/proller))
- FreeBSD 向けの各種ビルド修正。 [#4225](https://github.com/ClickHouse/ClickHouse/pull/4225) ([proller](https://github.com/proller))
- perftest 内でテーブルの作成、データ投入、削除ができる機能を追加。 [#4220](https://github.com/ClickHouse/ClickHouse/pull/4220) ([alesapin](https://github.com/alesapin))
- 重複した include をチェックするスクリプトを追加。 [#4326](https://github.com/ClickHouse/ClickHouse/pull/4326) ([alexey-milovidov](https://github.com/alexey-milovidov))
- パフォーマンステストでインデックスを指定してクエリを実行できる機能を追加。 [#4264](https://github.com/ClickHouse/ClickHouse/pull/4264) ([alesapin](https://github.com/alesapin))
- デバッグシンボル付きパッケージのインストールを推奨。 [#4274](https://github.com/ClickHouse/ClickHouse/pull/4274) ([alexey-milovidov](https://github.com/alexey-milovidov))
- performance-test のリファクタリング。ログ出力とシグナル処理を改善。 [#4171](https://github.com/ClickHouse/ClickHouse/pull/4171) ([alesapin](https://github.com/alesapin))
- 匿名化された Yandex.Metrica データセット向けのドキュメントを追加。 [#4164](https://github.com/ClickHouse/ClickHouse/pull/4164) ([alesapin](https://github.com/alesapin))
- 古い月単位パーティションのパートをカスタムパーティション形式に変換するツールを追加。 [#4195](https://github.com/ClickHouse/ClickHouse/pull/4195) ([Alex Zatelepin](https://github.com/ztlpn))
- S3 上の 2 つのデータセットに関するドキュメントを追加。 [#4144](https://github.com/ClickHouse/ClickHouse/pull/4144) ([alesapin](https://github.com/alesapin))
- プルリクエストの説明から changelog を生成するスクリプトを追加。 [#4169](https://github.com/ClickHouse/ClickHouse/pull/4169) [#4173](https://github.com/ClickHouse/ClickHouse/pull/4173) ([KochetovNicolai](https://github.com/KochetovNicolai)) ([KochetovNicolai](https://github.com/KochetovNicolai))
- ClickHouse 向け Puppet モジュールを追加。 [#4182](https://github.com/ClickHouse/ClickHouse/pull/4182) ([Maxim Fedotov](https://github.com/MaxFedotov))
- 未ドキュメントの関数群に関するドキュメントを追加。 [#4168](https://github.com/ClickHouse/ClickHouse/pull/4168) ([Winter Zhang](https://github.com/zhang2014))
- ARM ビルドの修正。 [#4210](https://github.com/ClickHouse/ClickHouse/pull/4210)[#4306](https://github.com/ClickHouse/ClickHouse/pull/4306) [#4291](https://github.com/ClickHouse/ClickHouse/pull/4291) ([proller](https://github.com/proller)) ([proller](https://github.com/proller))
- Dictionary テストを `ctest` から実行できるように変更。 [#4189](https://github.com/ClickHouse/ClickHouse/pull/4189) ([proller](https://github.com/proller))
- デフォルトの SSL 証明書ディレクトリとして `/etc/ssl` を使用するよう変更。 [#4167](https://github.com/ClickHouse/ClickHouse/pull/4167) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 起動時に SSE および AVX 命令の有無をチェックする機能を追加。 [#4234](https://github.com/ClickHouse/ClickHouse/pull/4234) ([Igr](https://github.com/igron99))
- init スクリプトがサーバーの起動完了まで待機するよう変更。 [#4281](https://github.com/ClickHouse/ClickHouse/pull/4281) ([proller](https://github.com/proller))

#### 後方互換性のない変更 \\{#backward-incompatible-changes-1\\}

- `allow_experimental_low_cardinality_type` 設定を削除しました。`LowCardinality` データ型は本番運用に対応しました。[#4323](https://github.com/ClickHouse/ClickHouse/pull/4323) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 利用可能なメモリ量に応じて、mark キャッシュサイズおよび非圧縮キャッシュサイズを削減するようにしました。[#4240](https://github.com/ClickHouse/ClickHouse/pull/4240) ([Lopatin Konstantin](https://github.com/k-lopatin)
- `CREATE TABLE` クエリにキーワード `INDEX` を追加しました。名前が `index` のカラムは、バッククォートまたは二重引用符で囲む必要があります: `` `index` ``。[#4143](https://github.com/ClickHouse/ClickHouse/pull/4143) ([Nikita Vasilev](https://github.com/nikvas0))
- `sumMap` は、これまでオーバーフローしていた場合に結果型を昇格させるようになりました。従来の `sumMap` の挙動は、`sumMapWithOverflow` 関数を使用することで再現できます。[#4151](https://github.com/ClickHouse/ClickHouse/pull/4151) ([Léo Ercolanelli](https://github.com/ercolanelli-leo))

#### パフォーマンスの改善 \\{#performance-improvements-4\\}

- `LIMIT` を含まないクエリで `std::sort` を `pdqsort` に置き換えました。[#4236](https://github.com/ClickHouse/ClickHouse/pull/4236) ([Evgenii Pravda](https://github.com/kvinty))
- サーバーがグローバルスレッドプールからスレッドを再利用するようになりました。これにより、一部の特殊なケースでパフォーマンスに影響があります。[#4150](https://github.com/ClickHouse/ClickHouse/pull/4150) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### 改善 \\{#improvements-5\\}

- FreeBSD 向けの AIO サポートを実装しました。 [#4305](https://github.com/ClickHouse/ClickHouse/pull/4305) ([urgordeadbeef](https://github.com/urgordeadbeef))
- `SELECT * FROM a JOIN b USING a, b` は、左側のテーブルからの `a` および `b` カラムのみを返すようになりました。 [#4141](https://github.com/ClickHouse/ClickHouse/pull/4141) ([Artem Zuikov](https://github.com/4ertus2))
- クライアントの `-C` オプションを `-c` オプションと同様に動作するようにしました。 [#4232](https://github.com/ClickHouse/ClickHouse/pull/4232) ([syominsergey](https://github.com/syominsergey))
- 値なしで使用した `--password` オプションは、stdin からのパスワード入力を要求するようになりました。 [#4230](https://github.com/ClickHouse/ClickHouse/pull/4230) ([BSD_Conqueror](https://github.com/bsd-conqueror))
- `LIKE` 式または正規表現を含む文字列リテラル内の、エスケープされていないメタ文字をハイライト表示する機能を追加しました。 [#4327](https://github.com/ClickHouse/ClickHouse/pull/4327) ([alexey-milovidov](https://github.com/alexey-milovidov))
- クライアントソケットが切断された場合に HTTP 読み取り専用クエリをキャンセルする機能を追加しました。 [#4213](https://github.com/ClickHouse/ClickHouse/pull/4213) ([nvartolomei](https://github.com/nvartolomei))
- サーバーが進捗を報告して、クライアントとの接続を維持するようになりました。 [#4215](https://github.com/ClickHouse/ClickHouse/pull/4215) ([Ivan](https://github.com/abyss7))
- `optimize_throw_if_noop` 設定が有効な場合の OPTIMIZE クエリに対する理由メッセージをわずかに改善しました。 [#4294](https://github.com/ClickHouse/ClickHouse/pull/4294) ([alexey-milovidov](https://github.com/alexey-milovidov))
- clickhouse server で `--version` オプションをサポートしました。 [#4251](https://github.com/ClickHouse/ClickHouse/pull/4251) ([Lopatin Konstantin](https://github.com/k-lopatin))
- `clickhouse-server` に `--help/-h` オプションを追加しました。 [#4233](https://github.com/ClickHouse/ClickHouse/pull/4233) ([Yuriy Baranov](https://github.com/yurriy))
- 集約関数の状態を結果とするスカラサブクエリのサポートを追加しました。 [#4348](https://github.com/ClickHouse/ClickHouse/pull/4348) ([Nikolai Kochetov](https://github.com/KochetovNicolai))
- サーバーのシャットダウン時間と ALTER の待機時間を改善しました。 [#4372](https://github.com/ClickHouse/ClickHouse/pull/4372) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `replicated_can_become_leader` 設定に関する情報を system.replicas に追加し、レプリカがリーダーになろうとしない場合にログを出力するようにしました。 [#4379](https://github.com/ClickHouse/ClickHouse/pull/4379) ([Alex Zatelepin](https://github.com/ztlpn))

## ClickHouse リリース 19.1 \\{#clickhouse-release-19-1\\}

### ClickHouse リリース 19.1.14, 2019-03-14 \\{#clickhouse-release-19-1-14-2019-03-14\\}

- 設定 `asterisk_left_columns_only` が 1 に設定されており、`SELECT *` を伴う `GLOBAL JOIN` を使用している場合（まれなケース）に発生する可能性のある `Column ... queried more than once` エラーを修正しました。この問題は 19.3 以降のバージョンには存在しません。 [6bac7d8d](https://github.com/ClickHouse/ClickHouse/pull/4692/commits/6bac7d8d11a9b0d6de0b32b53c47eb2f6f8e7062) ([Artem Zuikov](https://github.com/4ertus2))

### ClickHouse リリース 19.1.13, 2019-03-12 \\{#clickhouse-release-19-1-13-2019-03-12\\}

このリリースには、19.3.7 とまったく同じパッチセットが含まれます。

### ClickHouse リリース 19.1.10, 2019-03-03 \\{#clickhouse-release-19-1-10-2019-03-03\\}

このリリースには、19.3.6 とまったく同じパッチセットが含まれます。

## ClickHouse リリース 19.1 \\{#clickhouse-release-19-1-1\\}

### ClickHouse リリース 19.1.9, 2019-02-21 \\{#clickhouse-release-19-1-9-2019-02-21\\}

#### バグ修正 \\{#bug-fixes-18\\}

- `send_logs_level` 設定の誤った実装により発生していた、古いバージョンとの後方非互換性を修正しました。 [#4445](https://github.com/ClickHouse/ClickHouse/pull/4445) ([alexey-milovidov](https://github.com/alexey-milovidov))
- カラムコメントの導入に伴って発生した、テーブル関数 `remote` の後方非互換性を修正しました。 [#4446](https://github.com/ClickHouse/ClickHouse/pull/4446) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.1.8, 2019-02-16 \\{#clickhouse-release-19-1-8-2019-02-16\\}

#### バグ修正 \\{#bug-fixes-19\\}

- /etc/clickhouse-server/config.xml が欠落していたインストールパッケージを修正しました。 [#4343](https://github.com/ClickHouse/ClickHouse/pull/4343) ([proller](https://github.com/proller))

## ClickHouse リリース 19.1 \\{#clickhouse-release-19-1-2\\}

### ClickHouse リリース 19.1.7, 2019-02-15 \\{#clickhouse-release-19-1-7-2019-02-15\\}

#### 不具合修正 \\{#bug-fixes-20\\}

* `joinGet` 関数が正しい型を返し、ロックを適切に処理するように修正しました。 [#4153](https://github.com/ClickHouse/ClickHouse/pull/4153) ([Amos Bird](https://github.com/amosbird))
* サーバーのシャットダウン時にシステムログを再作成しようとした際に発生していたエラーを修正しました。 [#4254](https://github.com/ClickHouse/ClickHouse/pull/4254) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 不具合の修正: `Dictionary` エンジンを使用するデータベースが存在する場合、すべてのディクショナリがサーバー起動時に強制的にロードされており、さらに localhost 上の ClickHouse をソースとするディクショナリがあると、そのディクショナリをロードできない問題を修正しました。 [#4255](https://github.com/ClickHouse/ClickHouse/pull/4255) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `IN` 演算子を含むミューテーションの実行で不正な結果が返されるバグを修正しました。 [#4099](https://github.com/ClickHouse/ClickHouse/pull/4099) ([Alex Zatelepin](https://github.com/ztlpn))
* 対話モードで実行された場合、コマンドラインのサジェスト用データを読み込む際に、終了時に `clickhouse-client` がセグメンテーションフォルトを起こすことがあります。 [#4317](https://github.com/ClickHouse/ClickHouse/pull/4317) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `system.tables` からの SELECT 中に `table does not exist` エラーが発生する可能性があったレースコンディションを修正しました。 [#4313](https://github.com/ClickHouse/ClickHouse/pull/4313) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `File` エンジンのテーブルに対する `SELECT` が `No such file or directory` エラー後にリトライされた際に発生していたデッドロックを修正。 [#4161](https://github.com/ClickHouse/ClickHouse/pull/4161) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 問題を修正しました: ローカル ClickHouse 辞書が TCP 経由でロードされていましたが、本来は同一プロセス内でロードされるべきでした。 [#4166](https://github.com/ClickHouse/ClickHouse/pull/4166) ([alexey-milovidov](https://github.com/alexey-milovidov))
* TLS 接続経由で PostgreSQL ODBC Driver とやり取りする際に発生していた `No message received` エラーを修正しました。MySQL ODBC Driver 使用時に発生していたセグメンテーションフォルトも修正しました。[#4170](https://github.com/ClickHouse/ClickHouse/pull/4170) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `ORDER BY` に対する述語最適化を一時的に無効化しました。 [#3890](https://github.com/ClickHouse/ClickHouse/pull/3890) ([Winter Zhang](https://github.com/zhang2014))
* テーブル関数 `numbers(0)` から SELECT した際に発生していた無限ループを修正。 [#4280](https://github.com/ClickHouse/ClickHouse/pull/4280) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `int16` を超える大きさの日付を比較する際に発生していた `compile_expressions` のバグを修正しました。 [#4341](https://github.com/ClickHouse/ClickHouse/pull/4341) ([alesapin](https://github.com/alesapin))
* `uncompressed_cache=1` 使用時のセグメンテーションフォルトと、非圧縮サイズが不正な場合に発生する例外を修正しました。 [#4186](https://github.com/ClickHouse/ClickHouse/pull/4186) ([alesapin](https://github.com/alesapin))
* 右テーブルに重複行がある場合の `ALL JOIN` の動作を修正。 [#4184](https://github.com/ClickHouse/ClickHouse/pull/4184) ([Artem Zuikov](https://github.com/4ertus2))
* `INSERT ... SELECT ... FROM file(...)` クエリで、ファイルの形式が `CSVWithNames` または `TSVWIthNames` で最初のデータ行が欠落している場合に誤動作していた問題を修正しました。 [#4297](https://github.com/ClickHouse/ClickHouse/pull/4297) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `Array(LowCardinality)` 引数を取る集約関数の実行処理を修正。 [#4055](https://github.com/ClickHouse/ClickHouse/pull/4055) ([KochetovNicolai](https://github.com/KochetovNicolai))
* Debian パッケージ: 設定に応じて /etc/clickhouse-server/preprocessed へのリンクを正しく設定。 [#4205](https://github.com/ClickHouse/ClickHouse/pull/4205) ([proller](https://github.com/proller))
* 未定義動作サニタイザ使用時のファジングテストを修正しました：`quantile*Weighted` 系関数に対してパラメータ型チェックを追加しました。 [#4145](https://github.com/ClickHouse/ClickHouse/pull/4145) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `START REPLICATED SENDS` コマンドでレプリケート送信が開始されるようにしました。 [#4229](https://github.com/ClickHouse/ClickHouse/pull/4229) ([nvartolomei](https://github.com/nvartolomei))
* JOIN の ON 句で列が重複している場合に `Not found column` エラーが発生する問題を修正しました。 [#4279](https://github.com/ClickHouse/ClickHouse/pull/4279) ([Artem Zuikov](https://github.com/4ertus2))
* `/etc/ssl` が SSL 証明書のデフォルトディレクトリとして使用されるようになりました。 [#4167](https://github.com/ClickHouse/ClickHouse/pull/4167) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 辞書が利用できない状態での辞書リロード時に発生していたクラッシュを修正。 [#4188](https://github.com/ClickHouse/ClickHouse/pull/4188) ([proller](https://github.com/proller))
* `Date` および `DateTime` の比較が誤って行われる不具合を修正。 [#4237](https://github.com/ClickHouse/ClickHouse/pull/4237) ([valexey](https://github.com/valexey))
* 条件演算子（関数 `if`）の分岐で `Date` および `DateTime` 引数が使用された場合に誤った結果が返される問題を修正しました。関数 `if` に汎用的なケースを追加しました。 [#4243](https://github.com/ClickHouse/ClickHouse/pull/4243) ([alexey-milovidov](https://github.com/alexey-milovidov))

### ClickHouse リリース 19.1.6, 2019-01-24 \\{#clickhouse-release-19-1-6-2019-01-24\\}

#### 新機能 \\{#new-features-7\\}

- テーブルに対するカラムごとのカスタム圧縮コーデック。 [#3899](https://github.com/ClickHouse/ClickHouse/pull/3899) [#4111](https://github.com/ClickHouse/ClickHouse/pull/4111) ([alesapin](https://github.com/alesapin), [Winter Zhang](https://github.com/zhang2014), [Anatoly](https://github.com/Sindbag))
- 圧縮コーデック `Delta` を追加。 [#4052](https://github.com/ClickHouse/ClickHouse/pull/4052) ([alesapin](https://github.com/alesapin))
- 圧縮コーデックに対する `ALTER` を許可。 [#4054](https://github.com/ClickHouse/ClickHouse/pull/4054) ([alesapin](https://github.com/alesapin))
- SQL 標準との互換性のため、関数 `left`, `right`, `trim`, `ltrim`, `rtrim`, `timestampadd`, `timestampsub` を追加。 [#3826](https://github.com/ClickHouse/ClickHouse/pull/3826) ([Ivan Blinkov](https://github.com/blinkov))
- `HDFS` テーブルおよび `hdfs` テーブル関数への書き込みをサポート。 [#4084](https://github.com/ClickHouse/ClickHouse/pull/4084) ([alesapin](https://github.com/alesapin))
- 大きな文字列から複数の定数文字列を検索するための関数 `multiPosition`, `multiSearch`, `firstMatch` を追加。`-UTF8`, `-CaseInsensitive`, `-CaseInsensitiveUTF8` の各バリアントも追加。 [#4053](https://github.com/ClickHouse/ClickHouse/pull/4053) ([Danila Kutenin](https://github.com/danlark1))
- `SELECT` クエリがシャーディングキーでフィルタする場合に未使用シャードをスキップする最適化（設定 `optimize_skip_unused_shards`）。 [#3851](https://github.com/ClickHouse/ClickHouse/pull/3851) ([Gleb Kanterov](https://github.com/kanterov), [Ivan](https://github.com/abyss7))
- `Kafka` エンジンが、ブロックごとに一定数のパースエラーを無視できるように。 [#4094](https://github.com/ClickHouse/ClickHouse/pull/4094) ([Ivan](https://github.com/abyss7))
- `CatBoost` のマルチクラスモデル評価をサポート。関数 `modelEvaluate` は、マルチクラスモデルに対してクラスごとの生の予測値をタプルで返す。`libcatboostmodel.so` は [#607](https://github.com/catboost/catboost/pull/607) に従ってビルドする必要がある。 [#3959](https://github.com/ClickHouse/ClickHouse/pull/3959) ([KochetovNicolai](https://github.com/KochetovNicolai))
- 関数 `filesystemAvailable`, `filesystemFree`, `filesystemCapacity` を追加。 [#4097](https://github.com/ClickHouse/ClickHouse/pull/4097) ([Boris Granveaud](https://github.com/bgranvea))
- ハッシュ関数 `xxHash64` および `xxHash32` を追加。 [#3905](https://github.com/ClickHouse/ClickHouse/pull/3905) ([filimonov](https://github.com/filimonov))
- ハッシュ関数 `gccMurmurHash`（GCC 互換の Murmur ハッシュ）を追加。これは [gcc](https://github.com/gcc-mirror/gcc/blob/41d6b10e96a1de98e90a7c0378437c3255814b16/libstdc%2B%2B-v3/include/bits/functional_hash.h#L191) と同じハッシュシードを使用する。 [#4000](https://github.com/ClickHouse/ClickHouse/pull/4000) ([sundyli](https://github.com/sundy-li))
- ハッシュ関数 `javaHash`, `hiveHash` を追加。 [#3811](https://github.com/ClickHouse/ClickHouse/pull/3811) ([shangshujie365](https://github.com/shangshujie365))
- テーブル関数 `remoteSecure` を追加。この関数は `remote` と同様に動作するが、安全な接続を使用する。 [#4088](https://github.com/ClickHouse/ClickHouse/pull/4088) ([proller](https://github.com/proller))

#### 実験的機能 \\{#experimental-features-3\\}

- 複数の JOIN のエミュレーションを追加しました（`allow_experimental_multiple_joins_emulation` 設定）。[#3946](https://github.com/ClickHouse/ClickHouse/pull/3946) ([Artem Zuikov](https://github.com/4ertus2))

#### バグ修正 \\{#bug-fixes-21\\}

* メモリ消費を抑えるため、`compiled_expression_cache_size` 設定にデフォルトで上限を設けました。 [#4041](https://github.com/ClickHouse/ClickHouse/pull/4041) ([alesapin](https://github.com/alesapin))
* Replicated テーブルに対する ALTER を実行するスレッドと、ZooKeeper から構成を更新するスレッドでハングアップが発生する原因となっていたバグを修正。 [#2947](https://github.com/ClickHouse/ClickHouse/issues/2947) [#3891](https://github.com/ClickHouse/ClickHouse/issues/3891) [#3934](https://github.com/ClickHouse/ClickHouse/pull/3934) ([Alex Zatelepin](https://github.com/ztlpn))
* 分散 `ALTER` タスクの実行時に発生していたレースコンディションを修正しました。このレースコンディションにより、複数のレプリカが同じタスクを実行しようとし、1つを除くすべてのレプリカが ZooKeeper エラーで失敗していました。 [#3904](https://github.com/ClickHouse/ClickHouse/pull/3904) ([Alex Zatelepin](https://github.com/ztlpn))
* ZooKeeper へのリクエストがタイムアウトした場合に `from_zk` 設定要素が更新されない不具合を修正。 [#2947](https://github.com/ClickHouse/ClickHouse/issues/2947) [#3947](https://github.com/ClickHouse/ClickHouse/pull/3947) ([Alex Zatelepin](https://github.com/ztlpn))
* IPv4 サブネットマスクのプレフィックスが誤っていたバグを修正。 [#3945](https://github.com/ClickHouse/ClickHouse/pull/3945) ([alesapin](https://github.com/alesapin))
* リソース枯渇により新しいスレッドを作成できない、まれなケースで発生していたクラッシュ（`std::terminate`）を修正しました。 [#3956](https://github.com/ClickHouse/ClickHouse/pull/3956) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `remote` テーブル関数の実行時に、`getStructureOfRemoteTable` で誤った制限が適用されていた不具合を修正。 [#4009](https://github.com/ClickHouse/ClickHouse/pull/4009) ([alesapin](https://github.com/alesapin))
* netlink ソケットのリークを修正しました。これらはプールに保持されていましたが決して解放されず、既存のソケットがすべて使用中のときには、新しいスレッドの開始時に新たなソケットが作成されていました。 [#4017](https://github.com/ClickHouse/ClickHouse/pull/4017) ([Alex Zatelepin](https://github.com/ztlpn))
* `odbc-bridge` サブプロセスを fork した後、`/proc` からすべての fd を読み込む前に `/proc/self/fd` ディレクトリをクローズしてしまうバグを修正しました。 [#4120](https://github.com/ClickHouse/ClickHouse/pull/4120) ([alesapin](https://github.com/alesapin))
* 主キーに String 型を使用している場合の、String から UInt への単調変換を修正。 [#3870](https://github.com/ClickHouse/ClickHouse/pull/3870) ([Winter Zhang](https://github.com/zhang2014))
* 整数変換関数における単調性計算の誤りを修正しました。 [#3921](https://github.com/ClickHouse/ClickHouse/pull/3921) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 特定の不正な引数が指定された場合に `arrayEnumerateUniq`、`arrayEnumerateDense` 関数で発生していたセグメンテーションフォールトを修正しました。 [#3909](https://github.com/ClickHouse/ClickHouse/pull/3909) ([alexey-milovidov](https://github.com/alexey-milovidov))
* StorageMerge の未定義動作 (UB) を修正。 [#3910](https://github.com/ClickHouse/ClickHouse/pull/3910) ([Amos Bird](https://github.com/amosbird))
* 関数 `addDays` および `subtractDays` におけるセグメンテーションフォルトを修正。 [#3913](https://github.com/ClickHouse/ClickHouse/pull/3913) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 不具合を修正: 関数 `round`、`floor`、`trunc`、`ceil` が、整数引数に対して大きな負のスケールで実行された場合に誤った結果を返す可能性がある問題を修正しました。 [#3914](https://github.com/ClickHouse/ClickHouse/pull/3914) ([alexey-milovidov](https://github.com/alexey-milovidov))
* &#39;kill query sync&#39; によりコアダンプが発生する不具合を修正しました。 [#3916](https://github.com/ClickHouse/ClickHouse/pull/3916) ([muVulDeePecker](https://github.com/fancyqlx))
* レプリケーションキューが空になった後に長い遅延が発生するバグを修正。 [#3928](https://github.com/ClickHouse/ClickHouse/pull/3928) [#3932](https://github.com/ClickHouse/ClickHouse/pull/3932) ([alesapin](https://github.com/alesapin))
* `LowCardinality` 主キーを持つテーブルへの挿入時に過剰なメモリ使用量が発生していた問題を修正しました。 [#3955](https://github.com/ClickHouse/ClickHouse/pull/3955) ([KochetovNicolai](https://github.com/KochetovNicolai))
* `Native` フォーマットで空配列を扱う際の `LowCardinality` のシリアライゼーションを修正しました。 [#3907](https://github.com/ClickHouse/ClickHouse/issues/3907) [#4011](https://github.com/ClickHouse/ClickHouse/pull/4011) ([KochetovNicolai](https://github.com/KochetovNicolai))
* 単一の LowCardinality 数値カラムに対して DISTINCT を使用した際に誤った結果が返される問題を修正しました。 [#3895](https://github.com/ClickHouse/ClickHouse/issues/3895) [#4012](https://github.com/ClickHouse/ClickHouse/pull/4012) ([KochetovNicolai](https://github.com/KochetovNicolai))
* `compile` 設定が有効な場合における LowCardinality キーを用いる専用の集約処理を修正しました。 [#3886](https://github.com/ClickHouse/ClickHouse/pull/3886) ([KochetovNicolai](https://github.com/KochetovNicolai))
* レプリケートテーブルのクエリにおけるユーザーおよびパスワードの転送を修正。 [#3957](https://github.com/ClickHouse/ClickHouse/pull/3957) ([alesapin](https://github.com/alesapin)) ([小路](https://github.com/nicelulu))
* 辞書をリロードしている間に Dictionary データベース内のテーブルを一覧するときに、ごくまれに発生する競合状態を修正しました。 [#3970](https://github.com/ClickHouse/ClickHouse/pull/3970) ([alexey-milovidov](https://github.com/alexey-milovidov))
* HAVING を ROLLUP または CUBE と一緒に使用した場合に誤った結果が返される問題を修正しました。 [#3756](https://github.com/ClickHouse/ClickHouse/issues/3756) [#3837](https://github.com/ClickHouse/ClickHouse/pull/3837) ([Sam Chou](https://github.com/reflection))
* `JOIN ON` 構文と分散テーブルを使用するクエリにおけるカラムエイリアスを修正。 [#3980](https://github.com/ClickHouse/ClickHouse/pull/3980) ([Winter Zhang](https://github.com/zhang2014))
* `quantileTDigest` の内部実装の不具合を修正しました（Artem Vakhrushev によって発見されました）。この不具合は通常の ClickHouse の利用では発生せず、ClickHouse のコードベースをライブラリとして直接利用している場合にのみ影響がありました。 [#3935](https://github.com/ClickHouse/ClickHouse/pull/3935) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### 改善点 \\{#improvements-6\\}

- `ALTER TABLE ADD COLUMN` 文における `IF NOT EXISTS` のサポートと、`DROP/MODIFY/CLEAR/COMMENT COLUMN` における `IF EXISTS` のサポートを追加。 [#3900](https://github.com/ClickHouse/ClickHouse/pull/3900) ([Boris Granveaud](https://github.com/bgranvea))
- 関数 `parseDateTimeBestEffort`: `DD.MM.YYYY`、`DD.MM.YY`、`DD-MM-YYYY`、`DD-Mon-YYYY`、`DD/Month/YYYY` などの形式をサポート。 [#3922](https://github.com/ClickHouse/ClickHouse/pull/3922) ([alexey-milovidov](https://github.com/alexey-milovidov))
- `CapnProtoInputStream` がジャギー（不揃いな）構造をサポートするように。 [#4063](https://github.com/ClickHouse/ClickHouse/pull/4063) ([Odin Hultgren Van Der Horst](https://github.com/Miniwoffer))
- 利便性の向上: サーバープロセスがデータディレクトリの所有者として起動されているかを確認するチェックを追加。データが非 root ユーザーに属している場合、root からサーバーを起動することを禁止。 [#3785](https://github.com/ClickHouse/ClickHouse/pull/3785) ([sergey-v-galtsev](https://github.com/sergey-v-galtsev))
- JOIN を含むクエリの解析時に、必須列をチェックするロジックを改善。 [#3930](https://github.com/ClickHouse/ClickHouse/pull/3930) ([Artem Zuikov](https://github.com/4ertus2))
- 1 つのサーバー内に多数の Distributed テーブルが存在する場合の接続数を削減。 [#3726](https://github.com/ClickHouse/ClickHouse/pull/3726) ([Winter Zhang](https://github.com/zhang2014))
- ODBC ドライバーにおいて、`WITH TOTALS` クエリの合計行（totals row）をサポート。 [#3836](https://github.com/ClickHouse/ClickHouse/pull/3836) ([Maksim Koritckiy](https://github.com/nightweb))
- `if` 関数内で `Enum` を整数として使用できるようにした。 [#3875](https://github.com/ClickHouse/ClickHouse/pull/3875) ([Ivan](https://github.com/abyss7))
- `low_cardinality_allow_in_native_format` 設定を追加。無効化されている場合、`Native` フォーマットでは `LowCadrinality` 型を使用しない。 [#3879](https://github.com/ClickHouse/ClickHouse/pull/3879) ([KochetovNicolai](https://github.com/KochetovNicolai))
- メモリ使用量を下げるため、コンパイル済み式キャッシュから一部の冗長なオブジェクトを削除。 [#4042](https://github.com/ClickHouse/ClickHouse/pull/4042) ([alesapin](https://github.com/alesapin))
- `SET send_logs_level = 'value'` クエリが適切な値のみを受け付けるようにするチェックを追加。 [#3873](https://github.com/ClickHouse/ClickHouse/pull/3873) ([Sabyanin Maxim](https://github.com/s-mx))
- 型変換関数におけるデータ型チェックを修正。 [#3896](https://github.com/ClickHouse/ClickHouse/pull/3896) ([Winter Zhang](https://github.com/zhang2014))

#### パフォーマンスの改善 \\{#performance-improvements-5\\}

- MergeTree の設定 `use_minimalistic_part_header_in_zookeeper` を追加。これを有効にすると、Replicated テーブルではコンパクトなパートメタデータを単一のパート znode に保存します。これにより ZooKeeper のスナップショットサイズが大幅に削減される可能性があります（特にテーブルのカラム数が多い場合）。この設定を有効化すると、それをサポートしないバージョンへのダウングレードはできなくなる点に注意してください。 [#3960](https://github.com/ClickHouse/ClickHouse/pull/3960) ([Alex Zatelepin](https://github.com/ztlpn))
- パターンに時間が含まれない場合に、関数 `sequenceMatch` と `sequenceCount` 用の DFA ベースの実装を追加。 [#4004](https://github.com/ClickHouse/ClickHouse/pull/4004) ([Léo Ercolanelli](https://github.com/ercolanelli-leo))
- 整数値のシリアライゼーションのパフォーマンスを改善。 [#3968](https://github.com/ClickHouse/ClickHouse/pull/3968) ([Amos Bird](https://github.com/amosbird))
- PODArray の左側をゼロでパディングして、インデックス -1 の要素が常に有効かつゼロ化されるように変更。これは分岐のないオフセット計算に使用されます。 [#3920](https://github.com/ClickHouse/ClickHouse/pull/3920) ([Amos Bird](https://github.com/amosbird))
- パフォーマンス低下を引き起こしていた `jemalloc` のバージョンを元に戻した。 [#4018](https://github.com/ClickHouse/ClickHouse/pull/4018) ([alexey-milovidov](https://github.com/alexey-milovidov))

#### 後方互換性のない変更 \\{#backward-incompatible-changes-2\\}

- ドキュメント化されていなかった機能 `ALTER MODIFY PRIMARY KEY` を削除。この機能は `ALTER MODIFY ORDER BY` コマンドに置き換えられました。 [#3887](https://github.com/ClickHouse/ClickHouse/pull/3887) ([Alex Zatelepin](https://github.com/ztlpn))
- 関数 `shardByHash` を削除。 [#3833](https://github.com/ClickHouse/ClickHouse/pull/3833) ([alexey-milovidov](https://github.com/alexey-milovidov))
- 結果の型が `AggregateFunction` のスカラーサブクエリの使用を禁止。 [#3865](https://github.com/ClickHouse/ClickHouse/pull/3865) ([Ivan](https://github.com/abyss7))

#### ビルド／テスト／パッケージングの改善 \\{#buildtestingpackaging-improvements-6\\}

* PowerPC（`ppc64le`）向けビルドのサポートを追加しました。 [#4132](https://github.com/ClickHouse/ClickHouse/pull/4132) ([Danila Kutenin](https://github.com/danlark1))
* ステートフルな機能テストが一般公開されているデータセット上で実行されるようになりました。 [#3969](https://github.com/ClickHouse/ClickHouse/pull/3969) ([alexey-milovidov](https://github.com/alexey-milovidov))
* Docker または systemd-nspawn 内で `bash: /usr/bin/clickhouse-extract-from-config: Operation not permitted` というメッセージが表示され、サーバーが起動できない問題を修正しました。 [#4136](https://github.com/ClickHouse/ClickHouse/pull/4136) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `rdkafka` ライブラリを v1.0.0-RC5 に更新し、生の C インターフェースの代わりに cppkafka を使用するようにしました。 [#4025](https://github.com/ClickHouse/ClickHouse/pull/4025) ([Ivan](https://github.com/abyss7))
* `mariadb-client` ライブラリを更新しました。UBSan によって検出された問題のうち一つを修正しました。 [#3924](https://github.com/ClickHouse/ClickHouse/pull/3924) ([alexey-milovidov](https://github.com/alexey-milovidov))
* UBSan ビルドに対するいくつかの修正。 [#3926](https://github.com/ClickHouse/ClickHouse/pull/3926) [#3021](https://github.com/ClickHouse/ClickHouse/pull/3021) [#3948](https://github.com/ClickHouse/ClickHouse/pull/3948) ([alexey-milovidov](https://github.com/alexey-milovidov))
* UBSan ビルドでコミットごとにテストが実行されるようになりました。
* コミットごとに PVS-Studio の静的解析を実行するようにしました。
* PVS-Studio により検出されたバグを修正しました。[#4013](https://github.com/ClickHouse/ClickHouse/pull/4013) ([alexey-milovidov](https://github.com/alexey-milovidov))
* glibcの互換性問題を修正しました。 [#4100](https://github.com/ClickHouse/ClickHouse/pull/4100) ([alexey-milovidov](https://github.com/alexey-milovidov))
* Docker イメージを 18.10 に更新し、glibc &gt;= 2.28 向けの互換性ファイルを追加 [#3965](https://github.com/ClickHouse/ClickHouse/pull/3965) ([alesapin](https://github.com/alesapin))
* サーバーの Docker イメージ内でディレクトリに `chown` を実行したくないユーザー向けに、環境変数を追加。 [#3967](https://github.com/ClickHouse/ClickHouse/pull/3967) ([alesapin](https://github.com/alesapin))
* clang の `-Weverything` に含まれる警告の大半を有効にし、`-Wpedantic` も有効にしました。 [#3986](https://github.com/ClickHouse/ClickHouse/pull/3986) ([alexey-milovidov](https://github.com/alexey-milovidov))
* clang 8 でのみ有効な警告をさらにいくつか追加しました。 [#3993](https://github.com/ClickHouse/ClickHouse/pull/3993) ([alexey-milovidov](https://github.com/alexey-milovidov))
* 共有ライブラリでリンクする場合は、個々の LLVM ライブラリではなく `libLLVM` にリンクするようにしました。 [#3989](https://github.com/ClickHouse/ClickHouse/pull/3989) ([Orivej Desh](https://github.com/orivej))
* テストイメージ向けのサニタイザー変数を追加。 [#4072](https://github.com/ClickHouse/ClickHouse/pull/4072) ([alesapin](https://github.com/alesapin))
* `clickhouse-server` の Debian パッケージは、ケーパビリティを設定するために `setcap` ツールを利用できるよう、`libcap2-bin` パッケージを推奨します。これは必須ではありません。 [#4093](https://github.com/ClickHouse/ClickHouse/pull/4093) ([alexey-milovidov](https://github.com/alexey-milovidov))
* コンパイル時間を短縮し、インクルードを修正。 [#3898](https://github.com/ClickHouse/ClickHouse/pull/3898) ([proller](https://github.com/proller))
* ハッシュ関数の性能テストを追加しました。 [#3918](https://github.com/ClickHouse/ClickHouse/pull/3918) ([filimonov](https://github.com/filimonov))
* ライブラリ間の循環依存関係を修正しました。 [#3958](https://github.com/ClickHouse/ClickHouse/pull/3958) ([proller](https://github.com/proller))
* 利用可能メモリが少ない環境でのコンパイル処理を改善。 [#4030](https://github.com/ClickHouse/ClickHouse/pull/4030) ([proller](https://github.com/proller))
* `jemalloc` におけるパフォーマンス低下を再現するためのテストスクリプトを追加しました。 [#4036](https://github.com/ClickHouse/ClickHouse/pull/4036) ([alexey-milovidov](https://github.com/alexey-milovidov))
* `dbms` 内のコメントおよび文字列リテラル中のスペルミスを修正しました。 [#4122](https://github.com/ClickHouse/ClickHouse/pull/4122) ([maiha](https://github.com/maiha))
* コメント内の誤字を修正しました。 [#4089](https://github.com/ClickHouse/ClickHouse/pull/4089) ([Evgenii Pravda](https://github.com/kvinty))

## [2018年の変更履歴](./2018.md) \\{#changelog-for-2018\\}