---
slug: /whats-new/changelog/2018
sidebar_position: 9
sidebar_label: '2018'
title: '2018年の変更履歴'
description: '2018年の変更履歴'
doc_type: 'changelog'
keywords: ['ClickHouse 2018', '2018 変更履歴', 'リリースノート', 'バージョン履歴', 'レガシーリリース']
---



## ClickHouse リリース 18.16 {#clickhouse-release-18-16}

### ClickHouse リリース 18.16.1, 2018-12-21 {#clickhouse-release-18-16-1-2018-12-21}

#### バグ修正: {#bug-fixes}

- ODBCソースを使用した辞書の更新時に問題を引き起こしていたエラーを修正しました。[#3825](https://github.com/ClickHouse/ClickHouse/issues/3825), [#3829](https://github.com/ClickHouse/ClickHouse/issues/3829)
- 集約関数のJITコンパイルがLowCardinalityカラムで動作するようになりました。[#3838](https://github.com/ClickHouse/ClickHouse/issues/3838)

#### 改善: {#improvements}

- `low_cardinality_allow_in_native_format`設定を追加しました（デフォルトで有効）。無効にすると、SELECTクエリではLowCardinalityカラムが通常のカラムに変換され、INSERTクエリでは通常のカラムが想定されます。[#3879](https://github.com/ClickHouse/ClickHouse/pull/3879)

#### ビルドの改善: {#build-improvements}

- macOSおよびARMでのビルドに関する修正。

### ClickHouse リリース 18.16.0, 2018-12-14 {#clickhouse-release-18-16-0-2018-12-14}

#### 新機能: {#new-features}


- 半構造化入力フォーマット（`JSONEachRow`、`TSKV`）でデータを読み込む際、欠落しているフィールドに対して`DEFAULT`式が評価されます。この機能は`insert_sample_with_metadata`設定で有効化されます。[#3555](https://github.com/ClickHouse/ClickHouse/pull/3555)
- `ALTER TABLE`クエリに、テーブルカラムの追加または削除時にソートキーを変更するための`MODIFY ORDER BY`アクションが追加されました。これは、`SummingMergeTree`、`AggregatingMergeTree`などのように、このソートキーに基づいてマージ時に追加のタスクを実行する`MergeTree`ファミリーのテーブルで有用です。[#3581](https://github.com/ClickHouse/ClickHouse/pull/3581) [#3755](https://github.com/ClickHouse/ClickHouse/pull/3755)
- `MergeTree`ファミリーのテーブルでは、異なるソートキー（`ORDER BY`）とインデックス（`PRIMARY KEY`）を指定できるようになりました。ソートキーはインデックスよりも長くすることができます。[#3581](https://github.com/ClickHouse/ClickHouse/pull/3581)
- HDFSへのデータのインポートおよびエクスポートのために、`hdfs`テーブル関数と`HDFS`テーブルエンジンが追加されました。[chenxing-xc](https://github.com/ClickHouse/ClickHouse/pull/3617)
- base64を扱うための関数が追加されました：`base64Encode`、`base64Decode`、`tryBase64Decode`。[Alexander Krasheninnikov](https://github.com/ClickHouse/ClickHouse/pull/3350)
- `uniqCombined`集約関数の精度を設定するためのパラメータ（HyperLogLogセルの数を選択）が使用できるようになりました。[#3406](https://github.com/ClickHouse/ClickHouse/pull/3406)
- ClickHouseにコミットを行ったすべての人の名前を含む`system.contributors`テーブルが追加されました。[#3452](https://github.com/ClickHouse/ClickHouse/pull/3452)
- すべてのパーティションを一度にバックアップするために、`ALTER TABLE ... FREEZE`クエリでパーティションを省略できる機能が追加されました。[#3514](https://github.com/ClickHouse/ClickHouse/pull/3514)
- 戻り値の型を指定する必要がない`dictGet`および`dictGetOrDefault`関数が追加されました。型は辞書の定義から自動的に決定されます。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3564)
- テーブル定義でカラムにコメントを指定し、`ALTER`を使用して変更できるようになりました。[#3377](https://github.com/ClickHouse/ClickHouse/pull/3377)
- シンプルキーを持つ`Join`型テーブルの読み取りがサポートされました。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3728)
- `Join`型テーブルの作成時に、`join_use_nulls`、`max_rows_in_join`、`max_bytes_in_join`、`join_overflow_mode`のオプションを指定できるようになりました。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3728)
- `Join`型テーブルを辞書のように使用できる`joinGet`関数が追加されました。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3728)
- テーブルキーに関する情報を提供するために、`system.tables`テーブルに`partition_key`、`sorting_key`、`primary_key`、`sampling_key`カラムが追加されました。[#3609](https://github.com/ClickHouse/ClickHouse/pull/3609)
- `system.columns`テーブルに`is_in_partition_key`、`is_in_sorting_key`、`is_in_primary_key`、`is_in_sampling_key`カラムが追加されました。[#3609](https://github.com/ClickHouse/ClickHouse/pull/3609)
- `system.parts`テーブルに`min_time`および`max_time`カラムが追加されました。これらのカラムは、パーティショニングキーが`DateTime`カラムで構成される式である場合に値が設定されます。[Emmanuel Donin de Rosière](https://github.com/ClickHouse/ClickHouse/pull/3800)

#### バグ修正: {#bug-fixes-1}


* `LowCardinality` データ型に関する修正およびパフォーマンス改善。`LowCardinality(Nullable(...))` を使用した `GROUP BY`。`extremes` の値の取得。高階関数の処理。`LEFT ARRAY JOIN`。分散 `GROUP BY`。`Array` を返す関数。`ORDER BY` の実行。`Distributed` テーブルへの書き込み (nicelulu)。`Native` プロトコルを実装する旧クライアントからの `INSERT` クエリに対する後方互換性。`JOIN` における `LowCardinality` のサポート。単一ストリームで動作する場合のパフォーマンス改善。 [#3823](https://github.com/ClickHouse/ClickHouse/pull/3823) [#3803](https://github.com/ClickHouse/ClickHouse/pull/3803) [#3799](https://github.com/ClickHouse/ClickHouse/pull/3799) [#3769](https://github.com/ClickHouse/ClickHouse/pull/3769) [#3744](https://github.com/ClickHouse/ClickHouse/pull/3744) [#3681](https://github.com/ClickHouse/ClickHouse/pull/3681) [#3651](https://github.com/ClickHouse/ClickHouse/pull/3651) [#3649](https://github.com/ClickHouse/ClickHouse/pull/3649) [#3641](https://github.com/ClickHouse/ClickHouse/pull/3641) [#3632](https://github.com/ClickHouse/ClickHouse/pull/3632) [#3568](https://github.com/ClickHouse/ClickHouse/pull/3568) [#3523](https://github.com/ClickHouse/ClickHouse/pull/3523) [#3518](https://github.com/ClickHouse/ClickHouse/pull/3518)
* `select_sequential_consistency` オプションの動作を修正しました。以前はこの設定を有効にすると、新しいパーティションへの書き込みを開始した後に、不完全な結果が返されることがありました。 [#2863](https://github.com/ClickHouse/ClickHouse/pull/2863)
* DDL の `ON CLUSTER` クエリおよび `ALTER UPDATE/DELETE` を実行する際に、データベースが正しく指定されるようになりました。 [#3772](https://github.com/ClickHouse/ClickHouse/pull/3772) [#3460](https://github.com/ClickHouse/ClickHouse/pull/3460)
* VIEW 内のサブクエリに対してデータベースが正しく指定されるようになりました。 [#3521](https://github.com/ClickHouse/ClickHouse/pull/3521)
* `VersionedCollapsingMergeTree` に対して `FINAL` を使用した際の `PREWHERE` のバグを修正しました。 [7167bfd7](https://github.com/ClickHouse/ClickHouse/commit/7167bfd7b365538f7a91c4307ad77e552ab4e8c1)
* `KILL QUERY` を使用して、テーブルのロック待ちのためまだ開始されていないクエリをキャンセルできるようになりました。 [#3517](https://github.com/ClickHouse/ClickHouse/pull/3517)
* 時計が真夜中に戻された場合の日付と時刻の計算を修正しました（これはイランで発生し、1981年から1983年まではモスクワでも発生していました）。以前は、必要な場合よりも1日早く時刻がリセットされてしまい、テキスト形式での日付と時刻の書式も誤っていました。 [#3819](https://github.com/ClickHouse/ClickHouse/pull/3819)
* データベース名を省略した `VIEW` やサブクエリで発生する一部の不具合を修正しました。 [Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3521)
* 内部の `MATERIALIZED VIEW` にロックを取得していなかったため、`MATERIALIZED VIEW` からの読み取りと `MATERIALIZED VIEW` の削除を同時に行った場合に発生する競合状態を修正しました。 [#3404](https://github.com/ClickHouse/ClickHouse/pull/3404) [#3694](https://github.com/ClickHouse/ClickHouse/pull/3694)
* `Lock handler cannot be nullptr.` というエラーを修正しました。 [#3689](https://github.com/ClickHouse/ClickHouse/pull/3689)
* `compile_expressions` オプションが有効な場合（デフォルトで有効）のクエリ処理を修正しました。`now` 関数のような非決定的な定数式は、これ以上展開されなくなりました。 [#3457](https://github.com/ClickHouse/ClickHouse/pull/3457)
* `toDecimal32/64/128` 関数で非定数の scale 引数を指定した場合に発生していたクラッシュを修正しました。
* `input_format_values_interpret_expressions` = 1 の場合に、`Nullable` でない `Array` 型カラムに対して、`Values` 形式で `NULL` 要素を含む配列を挿入しようとすると発生していたエラーを修正。 [#3487](https://github.com/ClickHouse/ClickHouse/pull/3487) [#3503](https://github.com/ClickHouse/ClickHouse/pull/3503)
* ZooKeeper が利用できない場合に `DDLWorker` で継続的に発生していたエラーログ出力を修正しました。 [8f50c620](https://github.com/ClickHouse/ClickHouse/commit/8f50c620334988b28018213ec0092fe6423847e2)
* `Date` および `DateTime` 型の引数に対する `quantile*` 関数の戻り値の型を修正しました。 [#3580](https://github.com/ClickHouse/ClickHouse/pull/3580)
* 式を伴わない単純なエイリアスのみを指定している `WITH` 句の挙動を修正しました。 [#3570](https://github.com/ClickHouse/ClickHouse/pull/3570)
* `enable_optimize_predicate_expression` が有効な場合に、名前付きサブクエリおよび修飾列名を持つクエリの処理を修正しました。 [Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3588)
* マテリアライズドビューの使用時に発生していた `Attempt to attach to nullptr thread group` エラーを修正しました。 [Marek Vavruša](https://github.com/ClickHouse/ClickHouse/pull/3623)
* `arrayReverse` 関数に特定の誤った引数を渡すとクラッシュする問題を修正しました。 [73e3a7b6](https://github.com/ClickHouse/ClickHouse/commit/73e3a7b662161d6005e7727d8a711b930386b871)
* `extractURLParameter` 関数のバッファオーバーフローを修正しました。パフォーマンスを改善しました。ゼロバイトを含む文字列を正しく処理できるようにしました。 [141e9799](https://github.com/ClickHouse/ClickHouse/commit/141e9799e49201d84ea8e951d1bed4fb6d3dacb5)
* `lowerUTF8` および `upperUTF8` 関数におけるバッファオーバーフローの不具合を修正しました。これらの関数を `FixedString` 型の引数に対して実行できないようにしました。 [#3662](https://github.com/ClickHouse/ClickHouse/pull/3662)
* `MergeTree` テーブルの削除時にまれに発生するレースコンディションを修正しました。 [#3680](https://github.com/ClickHouse/ClickHouse/pull/3680)
* `Buffer` テーブルからの読み取りと、対象テーブルに対する `ALTER` または `DROP` の同時実行時に発生するレースコンディションを修正しました。 [#3719](https://github.com/ClickHouse/ClickHouse/pull/3719)
* `max_temporary_non_const_columns` の制限を超えた場合に発生していたセグメンテーションフォルトを修正しました。 [#3788](https://github.com/ClickHouse/ClickHouse/pull/3788)

#### 改善点: {#improvements-1}


* サーバーは、処理済みの設定ファイルを `/etc/clickhouse-server/` ディレクトリには書き込みません。代わりに、それらを `path` 内の `preprocessed_configs` ディレクトリに保存します。これは、`clickhouse` ユーザーが `/etc/clickhouse-server/` ディレクトリへの書き込み権限を持たず、その結果セキュリティが向上することを意味します。 [#2443](https://github.com/ClickHouse/ClickHouse/pull/2443)
* `min_merge_bytes_to_use_direct_io` オプションはデフォルトで 10 GiB に設定されています。MergeTree ファミリーのテーブルの大部分を形成するようなマージは `O_DIRECT` モードで実行され、このモードによって過度なページキャッシュの追い出しが防止されます。 [#3504](https://github.com/ClickHouse/ClickHouse/pull/3504)
* 非常に多くのテーブルが存在する場合のサーバー起動を高速化。 [#3398](https://github.com/ClickHouse/ClickHouse/pull/3398)
* レプリカ間の接続に、接続プールと HTTP `Keep-Alive` を追加しました。 [#3594](https://github.com/ClickHouse/ClickHouse/pull/3594)
* クエリ構文が無効な場合、`HTTP` インターフェイスでは `400 Bad Request` コードが返されます（以前は `500` が返されていました）。[31bc680a](https://github.com/ClickHouse/ClickHouse/commit/31bc680ac5f4bb1d0360a8ba4696fa84bb47d6ab)
* 互換性を保つため、`join_default_strictness` オプションのデフォルト値は `ALL` に設定されています。 [120e2cbe](https://github.com/ClickHouse/ClickHouse/commit/120e2cbe2ff4fbad626c28042d9b28781c805afe)
* 無効または複雑な正規表現に対して、`re2` ライブラリが `stderr` へ出力していたログを削除しました。 [#3723](https://github.com/ClickHouse/ClickHouse/pull/3723)
* `Kafka` テーブルエンジンに、Kafka からの読み取り開始前にサブスクリプションをチェックする機能と、テーブル用の kafka&#95;max&#95;block&#95;size 設定を追加しました。 [Marek Vavruša](https://github.com/ClickHouse/ClickHouse/pull/3396)
* `cityHash64`、`farmHash64`、`metroHash64`、`sipHash64`、`halfMD5`、`murmurHash2_32`、`murmurHash2_64`、`murmurHash3_32`、`murmurHash3_64` 関数は、任意の数の引数およびタプル形式の引数に対して動作するようになりました。 [#3451](https://github.com/ClickHouse/ClickHouse/pull/3451) [#3519](https://github.com/ClickHouse/ClickHouse/pull/3519)
* `arrayReverse` 関数が、あらゆる型の配列で動作するようになりました。 [73e3a7b6](https://github.com/ClickHouse/ClickHouse/commit/73e3a7b662161d6005e7727d8a711b930386b871)
* `timeSlots` 関数にスロットサイズを指定するオプションのパラメータを追加しました。 [Kirill Shvakov](https://github.com/ClickHouse/ClickHouse/pull/3724)
* `FULL` および `RIGHT JOIN` の場合、右テーブル側の結合されなかったデータストリームに対して `max_block_size` 設定が使用されます。 [Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3699)
* TLS を有効化するため、`clickhouse-benchmark` および `clickhouse-performance-test` に `--secure` コマンドラインパラメータを追加しました。 [#3688](https://github.com/ClickHouse/ClickHouse/pull/3688) [#3690](https://github.com/ClickHouse/ClickHouse/pull/3690)
* `Buffer` 型テーブルの構造が移送先テーブルの構造と一致しない場合の型変換。[Vitaly Baranov](https://github.com/ClickHouse/ClickHouse/pull/3603)
* 指定した時間非アクティブ状態が続いた後にキープアライブパケットを送信できるようにする `tcp_keep_alive_timeout` オプションを追加しました。 [#3441](https://github.com/ClickHouse/ClickHouse/pull/3441)
* `system.parts` テーブルにおいて、パーティションキーが単一カラムで構成されている場合、その値に対する不要なクオートを削除しました。 [#3652](https://github.com/ClickHouse/ClickHouse/pull/3652)
* `Date` および `DateTime` データ型に対して modulo 関数が利用できるようになりました。 [#3385](https://github.com/ClickHouse/ClickHouse/pull/3385)
* `POWER`、`LN`、`LCASE`、`UCASE`、`REPLACE`、`LOCATE`、`SUBSTR`、`MID` 関数に同義語を追加しました。 [#3774](https://github.com/ClickHouse/ClickHouse/pull/3774) [#3763](https://github.com/ClickHouse/ClickHouse/pull/3763) 一部の関数名は、SQL 標準との互換性のために大文字小文字を区別しません。SQL との互換性のために、構文糖 `SUBSTRING(expr FROM start FOR length)` を追加しました。 [#3804](https://github.com/ClickHouse/ClickHouse/pull/3804)
* `clickhouse-server` の実行可能コードに対応するメモリページを `mlock` し、メモリから強制的に追い出されるのを防ぐ機能を追加しました。この機能はデフォルトでは無効になっています。 [#3553](https://github.com/ClickHouse/ClickHouse/pull/3553)
* `O_DIRECT` からの読み込み時のパフォーマンスが向上しました（`min_bytes_to_use_direct_io` オプション有効時）。 [#3405](https://github.com/ClickHouse/ClickHouse/pull/3405)
* 定数キー引数と非定数のデフォルト引数を持つ `dictGet...OrDefault` 関数のパフォーマンスを改善。 [Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3563)
* `firstSignificantSubdomain` 関数は、`gov`、`mil`、および `edu` ドメインも処理するようになりました。[Igor Hatarist](https://github.com/ClickHouse/ClickHouse/pull/3601) によりパフォーマンスが改善されました。 [#3628](https://github.com/ClickHouse/ClickHouse/pull/3628)
* `/etc/default/clickhouse` 内で `CLICKHOUSE_PROGRAM_ENV` を定義することで、`SYS-V init.d` スクリプトを使用して `clickhouse-server` を起動する際に用いるカスタム環境変数を指定できるようになりました。
  [Pavlo Bashynskyi](https://github.com/ClickHouse/ClickHouse/pull/3612)
* clickhouse-server の init スクリプトのリターンコードを修正。[#3516](https://github.com/ClickHouse/ClickHouse/pull/3516)
* `system.metrics` テーブルに `VersionInteger` メトリクスが追加され、`system.build_options` には ClickHouse バージョンの数値形式（例：`18016000`）を含む `VERSION_INTEGER` という行が追加されました。 [#3644](https://github.com/ClickHouse/ClickHouse/pull/3644)
* `Date` 型を数値と比較することはできなくなりました。これは、日付の引用符を誤って省略してしまう `date = 2018-12-17` のような潜在的なエラーを避けるためです。 [#3687](https://github.com/ClickHouse/ClickHouse/pull/3687)
* `rowNumberInAllBlocks` のようなステートフル関数の動作を修正しました。これらはクエリ解析中から処理を開始していたため、以前は結果が 1 だけ大きい値として出力されていました。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3729)
* `force_restore_data` ファイルを削除できない場合、エラーメッセージが表示されます。 [Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3794)

#### ビルドの改善: {#build-improvements-1}

- `jemalloc`ライブラリを更新し、潜在的なメモリリークを修正しました。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3557)
- デバッグビルドにおいて、`jemalloc`によるプロファイリングがデフォルトで有効になりました。[2cc82f5c](https://github.com/ClickHouse/ClickHouse/commit/2cc82f5cbe266421cd4c1165286c2c47e5ffcb15)
- システムに`Docker`のみがインストールされている場合でも統合テストを実行できる機能を追加しました。[#3650](https://github.com/ClickHouse/ClickHouse/pull/3650)
- SELECTクエリにファズ式テストを追加しました。[#3442](https://github.com/ClickHouse/ClickHouse/pull/3442)
- コミット用のストレステストを追加しました。これは機能テストを並列かつランダムな順序で実行し、より多くの競合状態を検出します。[#3438](https://github.com/ClickHouse/ClickHouse/pull/3438)
- Dockerイメージ内でclickhouse-serverを起動する方法を改善しました。[Elghazal Ahmed](https://github.com/ClickHouse/ClickHouse/pull/3663)
- Dockerイメージにおいて、`/docker-entrypoint-initdb.d`ディレクトリ内のファイルを使用したデータベース初期化のサポートを追加しました。[Konstantin Lebedev](https://github.com/ClickHouse/ClickHouse/pull/3695)
- ARM上でのビルドの修正を行いました。[#3709](https://github.com/ClickHouse/ClickHouse/pull/3709)

#### 後方互換性のない変更: {#backward-incompatible-changes}

- `Date`型と数値を比較する機能を削除しました。`toDate('2018-12-18') = 17883`の代わりに、明示的な型変換`= toDate(17883)`を使用する必要があります。[#3687](https://github.com/ClickHouse/ClickHouse/pull/3687)


## ClickHouse リリース 18.14 {#clickhouse-release-18-14}

### ClickHouse リリース 18.14.19, 2018-12-19 {#clickhouse-release-18-14-19-2018-12-19}

#### バグ修正: {#bug-fixes-2}

- ODBCソースを使用した辞書の更新時に問題を引き起こしていたエラーを修正しました。[#3825](https://github.com/ClickHouse/ClickHouse/issues/3825), [#3829](https://github.com/ClickHouse/ClickHouse/issues/3829)
- DDL `ON CLUSTER`クエリの実行時にデータベースが正しく指定されるようになりました。[#3460](https://github.com/ClickHouse/ClickHouse/pull/3460)
- `max_temporary_non_const_columns`制限を超えた場合に発生するセグメンテーション違反を修正しました。[#3788](https://github.com/ClickHouse/ClickHouse/pull/3788)

#### ビルドの改善: {#build-improvements-2}

- ARM環境でのビルドに関する修正を行いました。

### ClickHouse リリース 18.14.18, 2018-12-04 {#clickhouse-release-18-14-18-2018-12-04}

#### バグ修正: {#bug-fixes-3}

- `range`型の辞書に対する`dictGet...`関数において、引数の一方が定数で他方が非定数の場合に発生するエラーを修正しました。[#3751](https://github.com/ClickHouse/ClickHouse/pull/3751)
- 比較的新しいバージョンのLinuxカーネルでのみ発生していた、Linuxカーネルログに`netlink: '...': attribute type 1 has an invalid length`というメッセージが出力される問題を修正しました。[#3749](https://github.com/ClickHouse/ClickHouse/pull/3749)
- `FixedString`型の引数に対する`empty`関数で発生するセグメンテーション違反を修正しました。[Daniel, Dao Quang Minh](https://github.com/ClickHouse/ClickHouse/pull/3703)
- `max_query_size`設定に大きな値を使用した場合の過剰なメモリ割り当てを修正しました(`max_query_size`バイトのメモリチャンクが一度に事前割り当てされていました)。[#3720](https://github.com/ClickHouse/ClickHouse/pull/3720)

#### ビルドの変更: {#build-changes}

- OSパッケージからのバージョン7のLLVM/Clangライブラリを使用したビルドを修正しました(これらのライブラリは実行時クエリコンパイルに使用されます)。[#3582](https://github.com/ClickHouse/ClickHouse/pull/3582)

### ClickHouse リリース 18.14.17, 2018-11-30 {#clickhouse-release-18-14-17-2018-11-30}

#### バグ修正: {#bug-fixes-4}

- ODBCブリッジプロセスがメインサーバープロセスと共に終了しないケースを修正しました。[#3642](https://github.com/ClickHouse/ClickHouse/pull/3642)
- リモートテーブルのカラムリストと異なるカラムリストを持つ`Distributed`テーブルへの同期挿入を修正しました。[#3673](https://github.com/ClickHouse/ClickHouse/pull/3673)
- MergeTreeテーブルを削除する際にクラッシュを引き起こす可能性のある稀な競合状態を修正しました。[#3643](https://github.com/ClickHouse/ClickHouse/pull/3643)
- クエリスレッドの作成が`Resource temporarily unavailable`エラーで失敗した場合に発生するクエリデッドロックを修正しました。[#3643](https://github.com/ClickHouse/ClickHouse/pull/3643)
- `CREATE AS table`構文が使用され、`ENGINE`句が`AS table`の前に指定された場合の`ENGINE`句の解析を修正しました(このエラーにより指定されたエンジンが無視されていました)。[#3692](https://github.com/ClickHouse/ClickHouse/pull/3692)

### ClickHouse リリース 18.14.15, 2018-11-21 {#clickhouse-release-18-14-15-2018-11-21}

#### バグ修正: {#bug-fixes-5}

- `Array(String)`型のカラムをデシリアライズする際にメモリチャンクのサイズが過大評価され、「メモリ制限超過」エラーが発生していました。この問題はバージョン18.12.13で発生しました。[#3589](https://github.com/ClickHouse/ClickHouse/issues/3589)

### ClickHouse リリース 18.14.14, 2018-11-20 {#clickhouse-release-18-14-14-2018-11-20}

#### バグ修正: {#bug-fixes-6}


- クラスタがセキュア設定（`<secure>`フラグ）されている場合の`ON CLUSTER`クエリを修正しました。[#3599](https://github.com/ClickHouse/ClickHouse/pull/3599)

#### ビルド変更: {#build-changes-1}

- 問題を修正しました（システムからのllvm-7、macOS）[#3582](https://github.com/ClickHouse/ClickHouse/pull/3582)

### ClickHouse リリース 18.14.13、2018-11-08 {#clickhouse-release-18-14-13-2018-11-08}

#### バグ修正: {#bug-fixes-7}

- `Block structure mismatch in MergingSorted stream`エラーを修正しました。[#3162](https://github.com/ClickHouse/ClickHouse/issues/3162)
- クラスタ設定でセキュア接続が有効化されている場合（`<secure>`フラグ）の`ON CLUSTER`クエリを修正しました。[#3465](https://github.com/ClickHouse/ClickHouse/pull/3465)
- `SAMPLE`、`PREWHERE`、およびエイリアス列を使用するクエリのエラーを修正しました。[#3543](https://github.com/ClickHouse/ClickHouse/pull/3543)
- `min_bytes_to_use_direct_io`設定が有効化されている場合に稀に発生する`unknown compression method`エラーを修正しました。[3544](https://github.com/ClickHouse/ClickHouse/pull/3544)

#### パフォーマンス改善: {#performance-improvements}

- AMD EPYCプロセッサ上で実行する際のUInt16型またはDate型の列による`GROUP BY`クエリのパフォーマンス低下を修正しました。[Igor Lapko](https://github.com/ClickHouse/ClickHouse/pull/3512)
- 長い文字列を処理するクエリのパフォーマンス低下を修正しました。[#3530](https://github.com/ClickHouse/ClickHouse/pull/3530)

#### ビルド改善: {#build-improvements-3}

- Arcadiaビルドを簡素化するための改善を行いました。[#3475](https://github.com/ClickHouse/ClickHouse/pull/3475)、[#3535](https://github.com/ClickHouse/ClickHouse/pull/3535)

### ClickHouse リリース 18.14.12、2018-11-02 {#clickhouse-release-18-14-12-2018-11-02}

#### バグ修正: {#bug-fixes-8}

- 2つの無名サブクエリを結合する際のクラッシュを修正しました。[#3505](https://github.com/ClickHouse/ClickHouse/pull/3505)
- 外部データベースをクエリする際に不正なクエリ（空の`WHERE`句）が生成される問題を修正しました。[hotid](https://github.com/ClickHouse/ClickHouse/pull/3477)
- ODBC辞書で不正なタイムアウト値が使用される問題を修正しました。[Marek Vavruša](https://github.com/ClickHouse/ClickHouse/pull/3511)

### ClickHouse リリース 18.14.11、2018-10-29 {#clickhouse-release-18-14-11-2018-10-29}

#### バグ修正: {#bug-fixes-9}

- LIMITクエリでの`Block structure mismatch in UNION stream: different number of columns`エラーを修正しました。[#2156](https://github.com/ClickHouse/ClickHouse/issues/2156)
- Nested構造内に配列を含むテーブルでデータをマージする際のエラーを修正しました。[#3397](https://github.com/ClickHouse/ClickHouse/pull/3397)
- `merge_tree_uniform_read_distribution`設定が無効化されている場合（デフォルトでは有効）に不正なクエリ結果が返される問題を修正しました。[#3429](https://github.com/ClickHouse/ClickHouse/pull/3429)
- Native形式でのDistributedテーブルへの挿入時のエラーを修正しました。[#3411](https://github.com/ClickHouse/ClickHouse/issues/3411)

### ClickHouse リリース 18.14.10、2018-10-23 {#clickhouse-release-18-14-10-2018-10-23}

- `compile_expressions`設定（式のJITコンパイル）がデフォルトで無効化されました。[#3410](https://github.com/ClickHouse/ClickHouse/pull/3410)
- `enable_optimize_predicate_expression`設定がデフォルトで無効化されました。

### ClickHouse リリース 18.14.9、2018-10-16 {#clickhouse-release-18-14-9-2018-10-16}

#### 新機能: {#new-features-1}


- `GROUP BY`の`WITH CUBE`修飾子(代替構文`GROUP BY CUBE(...)`も利用可能です)。[#3172](https://github.com/ClickHouse/ClickHouse/pull/3172)
- `formatDateTime`関数を追加しました。[Alexandr Krasheninnikov](https://github.com/ClickHouse/ClickHouse/pull/2770)
- `JDBC`テーブルエンジンと`jdbc`テーブル関数を追加しました(clickhouse-jdbc-bridgeのインストールが必要です)。[Alexandr Krasheninnikov](https://github.com/ClickHouse/ClickHouse/pull/3210)
- ISO週番号を扱うための関数を追加しました:`toISOWeek`、`toISOYear`、`toStartOfISOYear`、`toDayOfYear`。[#3146](https://github.com/ClickHouse/ClickHouse/pull/3146)
- `MySQL`および`ODBC`テーブルで`Nullable`カラムを使用できるようになりました。[#3362](https://github.com/ClickHouse/ClickHouse/pull/3362)
- ネストされたデータ構造を`JSONEachRow`形式でネストされたオブジェクトとして読み取ることができるようになりました。`input_format_import_nested_json`設定を追加しました。[Veloman Yunkan](https://github.com/ClickHouse/ClickHouse/pull/3144)
- データ挿入時に複数の`MATERIALIZED VIEW`に対して並列処理が利用可能になりました。`parallel_view_processing`設定を参照してください。[Marek Vavruša](https://github.com/ClickHouse/ClickHouse/pull/3208)
- `SYSTEM FLUSH LOGS`クエリを追加しました(`query_log`などのシステムテーブルへの強制的なログフラッシュ)。[#3321](https://github.com/ClickHouse/ClickHouse/pull/3321)
- `Replicated`テーブルを宣言する際に、事前定義された`database`および`table`マクロを使用できるようになりました。[#3251](https://github.com/ClickHouse/ClickHouse/pull/3251)
- `Decimal`型の値を工学表記(10の累乗を示す)で読み取る機能を追加しました。[#3153](https://github.com/ClickHouse/ClickHouse/pull/3153)

#### 実験的機能: {#experimental-features}

- `LowCardinality`データ型に対するGROUP BY句の最適化。[#3138](https://github.com/ClickHouse/ClickHouse/pull/3138)
- `LowCardinality`データ型に対する式の計算を最適化しました。[#3200](https://github.com/ClickHouse/ClickHouse/pull/3200)

#### 改善: {#improvements-2}


* `ORDER BY` および `LIMIT` を含むクエリのメモリ使用量を大幅に削減しました。`max_bytes_before_remerge_sort` 設定を参照してください。 [#3205](https://github.com/ClickHouse/ClickHouse/pull/3205)
* `JOIN`（`LEFT`、`INNER` など）が指定されていない場合、`INNER JOIN` が使用されます。 [#3147](https://github.com/ClickHouse/ClickHouse/pull/3147)
* `JOIN` を含むクエリで修飾アスタリスクが正しく動作するようになりました。 [Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3202)
* `ODBC` テーブルエンジンが、リモートデータベースの SQL 方言に応じて識別子のクオート方法を正しく選択するようになりました。 [Alexandr Krasheninnikov](https://github.com/ClickHouse/ClickHouse/pull/3210)
* `compile_expressions` 設定（式の JIT コンパイル）は、デフォルトで有効です。
* `DROP DATABASE/TABLE IF EXISTS` と `CREATE DATABASE/TABLE IF NOT EXISTS` を同時に実行した場合の動作を修正しました。以前は、`CREATE DATABASE ... IF NOT EXISTS` クエリがエラーメッセージ「File ... already exists」を返すことがあり、また `CREATE TABLE ... IF NOT EXISTS` および `DROP TABLE IF EXISTS` クエリが「Table ... is creating or attaching right now」を返すことがありました。 [#3101](https://github.com/ClickHouse/ClickHouse/pull/3101)
* 右辺が定数である LIKE および IN 式は、MySQL または ODBC テーブルに対するクエリ実行時にリモートサーバーへ渡されます。 [#3182](https://github.com/ClickHouse/ClickHouse/pull/3182)
* MySQL および ODBC テーブルに対してクエリを実行する際、`WHERE` 句内の定数式との比較もリモートサーバーに渡されるようになりました。以前は、定数との単純な比較のみが渡されていました。 [#3182](https://github.com/ClickHouse/ClickHouse/pull/3182)
* `Pretty` フォーマットにおいて、ターミナル上での行幅を正しく計算できるようにし、漢字などの表意文字を含む文字列にも対応しました。 [Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/3257).
* `ALTER UPDATE` クエリに `ON CLUSTER` を指定できます。
* `JSONEachRow` フォーマットでのデータ読み取り性能を改善。 [#3332](https://github.com/ClickHouse/ClickHouse/pull/3332)
* 互換性のために、`LENGTH` 関数および `CHARACTER_LENGTH` 関数に別名を追加しました。`CONCAT` 関数は大文字と小文字を区別しなくなりました。[#3306](https://github.com/ClickHouse/ClickHouse/pull/3306)
* `DateTime` 型の別名として `TIMESTAMP` を追加しました。 [#3390](https://github.com/ClickHouse/ClickHouse/pull/3390)
* サーバーログでは、ログ行がクエリに関連していない場合でも、常に `query_id` 用の領域が確保されています。これにより、サードパーティ製ツールでサーバーのテキストログを解析しやすくなります。
* クエリによるメモリ消費量が、整数ギガバイト単位のしきい値を超えたときにログに記録されるようになりました。 [#3205](https://github.com/ClickHouse/ClickHouse/pull/3205)
* Native プロトコルを使用するクライアントライブラリが、`INSERT` クエリに対してサーバーが想定している列数よりも誤って少ない列しか送信しない場合の互換モードを追加しました。このケースは `clickhouse-cpp` ライブラリを使用しているときに発生する可能性がありました。従来は、このケースによりサーバーがクラッシュしていました。[#3171](https://github.com/ClickHouse/ClickHouse/pull/3171)
* `clickhouse-copier` のユーザー定義 WHERE 式で、`partition_key` エイリアス（ソーステーブルのパーティションによる追加フィルタリング用）を使用できるようになりました。これは、コピー中にパーティショニング方式が変わるが、変更内容がわずかな場合に有用です。 [#3166](https://github.com/ClickHouse/ClickHouse/pull/3166)
* 高負荷時にデータ読み取り速度を自動的に抑制するため、`Kafka` エンジンのワークフローはバックグラウンドスレッドプールに移行されました。 [Marek Vavruša](https://github.com/ClickHouse/ClickHouse/pull/3215)。
* `Cap'n'Proto format` において、`struct` のような構造に対する `Tuple` および `Nested` 値の読み取りをサポート。 [Marek Vavruša](https://github.com/ClickHouse/ClickHouse/pull/3216)
* `firstSignificantSubdomain` 関数で使用されるトップレベルドメインの一覧に、`biz` ドメインが追加されました。 [decaseal](https://github.com/ClickHouse/ClickHouse/pull/3219)
* 外部辞書の設定では、`null_value` はそのデータ型のデフォルト値として解釈されます。 [#3330](https://github.com/ClickHouse/ClickHouse/pull/3330)
* `Decimal` 用の `intDiv` および `intDivOrZero` 関数のサポート。 [b48402e8](https://github.com/ClickHouse/ClickHouse/commit/b48402e8712e2b9b151e0eef8193811d433a1264)
* `sumMap` 集約関数のキーとして `Date`、`DateTime`、`UUID`、`Decimal` 型をサポート。 [#3281](https://github.com/ClickHouse/ClickHouse/pull/3281)
* 外部ディクショナリでの `Decimal` データ型のサポート。 [#3324](https://github.com/ClickHouse/ClickHouse/pull/3324)
* `SummingMergeTree` テーブルでの `Decimal` データ型のサポート。 [#3348](https://github.com/ClickHouse/ClickHouse/pull/3348)
* `if` で `UUID` 向けの特殊化を追加しました。 [#3366](https://github.com/ClickHouse/ClickHouse/pull/3366)
* `MergeTree table` からの読み込み時に発生する `open` および `close` システムコールの回数を削減しました。 [#3283](https://github.com/ClickHouse/ClickHouse/pull/3283)
* `TRUNCATE TABLE` クエリは、どのレプリカ上でも実行できます（クエリはリーダーレプリカに転送されます）。[Kirill Shvakov](https://github.com/ClickHouse/ClickHouse/pull/3375)

#### バグ修正: {#bug-fixes-10}


* `range_hashed` 辞書用の `Dictionary` テーブルに関する問題を修正しました。この問題はバージョン 18.12.17 で発生していました。 [#1702](https://github.com/ClickHouse/ClickHouse/pull/1702)
* `range_hashed` 辞書を読み込む際に発生していたエラー（メッセージ `Unsupported type Nullable (...)`）を修正しました。このエラーはバージョン 18.12.17 で発生していました。 [#3362](https://github.com/ClickHouse/ClickHouse/pull/3362)
* 互いに近接した多数の頂点を持つポリゴンにおいて、不正確な計算が累積することで発生していた `pointInPolygon` 関数のエラーを修正しました。 [#3331](https://github.com/ClickHouse/ClickHouse/pull/3331) [#3341](https://github.com/ClickHouse/ClickHouse/pull/3341)
* データパーツをマージした後に、生成されたパーツのチェックサムが、別のレプリカで同じマージ処理を行った結果のチェックサムと異なる場合、マージ結果は削除され、そのデータパーツは別のレプリカからダウンロードされます（これは正しい動作です）。しかしデータパーツをダウンロードした後、すでにそのパーツが存在するというエラーのために、作業セットに追加できないことがありました（マージ後、データパーツの削除に遅延が生じるためです）。この結果、同じデータを繰り返しダウンロードしようとする動作が発生していました。 [#3194](https://github.com/ClickHouse/ClickHouse/pull/3194)
* クエリ全体の合計メモリ消費量の誤った計算を修正しました（この誤った計算により、`max_memory_usage_for_all_queries` 設定が正しく動作せず、`MemoryTracking` メトリクスの値も不正確になっていました）。このエラーはバージョン 18.12.13 で発生しました。 [Marek Vavruša](https://github.com/ClickHouse/ClickHouse/pull/3344)
* `CREATE TABLE ... ON CLUSTER ... AS SELECT ...` の動作を修正しました。このエラーはバージョン 18.12.13 で発生していました。 [#3247](https://github.com/ClickHouse/ClickHouse/pull/3247)
* `JOIN` がリモートサーバー上でのみ実行される場合に、クエリを開始したサーバー側で `JOIN` 用のデータ構造を不要に準備していた問題を修正。 [#3340](https://github.com/ClickHouse/ClickHouse/pull/3340)
* `Kafka` エンジンのバグを修正しました。データ読み取り開始時の例外発生後に起きるデッドロックと、処理完了時に発生するロックに対する修正です [Marek Vavruša](https://github.com/ClickHouse/ClickHouse/pull/3215)。
* `Kafka` テーブルに対して、オプションの `schema` パラメータ（`Cap'n'Proto` フォーマットのスキーマ）が渡されていませんでした。 [Vojtech Splichal](https://github.com/ClickHouse/ClickHouse/pull/3150)
* ZooKeeper サーバーのアンサンブル内に、接続は受け付けるものの、ハンドシェイクに応答する代わりに直ちに接続を閉じてしまうサーバーがある場合、ClickHouse は別のサーバーへの接続を選択するようになりました。以前は、この状況で `Cannot read all data. Bytes read: 0. Bytes expected: 4.` というエラーが発生し、サーバーを起動できませんでした。 [8218cf3a](https://github.com/ClickHouse/ClickHouse/commit/8218cf3a5f39a43401953769d6d12a0bb8d29da9)
* ZooKeeper サーバー群に、DNS クエリでエラーが返されるサーバーが含まれている場合、それらのサーバーは無視されます。[17b8e209](https://github.com/ClickHouse/ClickHouse/commit/17b8e209221061325ad7ba0539f03c6e65f87f29)
* `VALUES` フォーマットでデータを挿入する際の `Date` 型と `DateTime` 型の相互変換を修正しました（`input_format_values_interpret_expressions = 1` の場合）。以前は、Unix Epoch における経過日数の数値と Unix タイムスタンプとの間で変換が行われており、そのため予期しない結果が発生していました。 [#3229](https://github.com/ClickHouse/ClickHouse/pull/3229)
* `Decimal` 型と整数型の間の型変換を修正しました。 [#3211](https://github.com/ClickHouse/ClickHouse/pull/3211)
* `enable_optimize_predicate_expression` 設定に関する不具合を修正しました。 [Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3231)
* `;` などデフォルト以外の CSV セパレータが使用されている場合に、浮動小数点数を含む CSV フォーマットで発生していたパースエラーを修正しました [#3155](https://github.com/ClickHouse/ClickHouse/pull/3155)
* `arrayCumSumNonNegative` 関数を修正しました（アキュムレータが 0 未満の場合は、負の値を累積しないようになりました）。[Aleksey Studnev](https://github.com/ClickHouse/ClickHouse/pull/3163)
* `PREWHERE` 使用時に、`Distributed` テーブル上にある `Merge` テーブルの動作を修正しました。 [#3165](https://github.com/ClickHouse/ClickHouse/pull/3165)
* `ALTER UPDATE` クエリのバグ修正。
* バージョン 18.12 で発生した `odbc` テーブル関数のバグを修正。 [#3197](https://github.com/ClickHouse/ClickHouse/pull/3197)
* `StateArray` コンビネータを使用する集約関数の動作を修正しました。 [#3188](https://github.com/ClickHouse/ClickHouse/pull/3188)
* `Decimal` 値をゼロで除算した際に発生していたクラッシュを修正しました。 [69dd6609](https://github.com/ClickHouse/ClickHouse/commit/69dd6609193beb4e7acd3e6ad216eca0ccfb8179)
* `Decimal` と整数の引数を使う演算の結果型の出力を修正しました。 [#3224](https://github.com/ClickHouse/ClickHouse/pull/3224)
* `Decimal128` に対する `GROUP BY` で発生していたセグメンテーションフォールトを修正しました。 [3359ba06](https://github.com/ClickHouse/ClickHouse/commit/3359ba06c39fcd05bfdb87d6c64154819621e13a)
* `log_query_threads` 設定（クエリ実行の各スレッドに関する情報をログ出力する設定）は、`log_queries` オプション（クエリに関する情報をログ出力する設定）が 1 に設定されている場合にのみ有効になるようになりました。`log_query_threads` オプションはデフォルトで有効になっているため、以前はクエリのログ出力が無効になっていてもスレッドに関する情報が記録されていました。 [#3241](https://github.com/ClickHouse/ClickHouse/pull/3241)
* `quantiles` 集約関数の分散処理で発生していたエラー（エラーメッセージ `Not found column quantile...`）を修正しました。 [292a8855](https://github.com/ClickHouse/ClickHouse/commit/292a885533b8e3b41ce8993867069d14cbd5a664)
* 18.12.17 バージョンのサーバーとそれ以前のバージョンのサーバーから成るクラスタを同時に扱う際の互換性の問題を修正しました。固定長と可変長の両方の `GROUP BY` キーを持つ分散クエリで、集約対象のデータ量が多い場合に、返されるデータが常に完全に集約されず（2 つの異なる行が同じ集約キーを持つ）、不完全な結果となることがありました。 [#3254](https://github.com/ClickHouse/ClickHouse/pull/3254)
* テストで宣言された代入の一部しかクエリに含まれていない場合における、`clickhouse-performance-test` の代入処理を修正しました。 [#3263](https://github.com/ClickHouse/ClickHouse/pull/3263)
* `FINAL` と `PREWHERE` の併用時に発生していたエラーを修正しました。 [#3298](https://github.com/ClickHouse/ClickHouse/pull/3298)
* `ALTER` によって追加されたカラムに対して `PREWHERE` を使用した際に発生していたエラーを修正しました。 [#3298](https://github.com/ClickHouse/ClickHouse/pull/3298)
* `DEFAULT` および `MATERIALIZED` 式で `arrayJoin` が使用されていないことを検証するチェックを追加しました。以前は、データ挿入時に `arrayJoin` を使用するとエラーが発生していました。 [#3337](https://github.com/ClickHouse/ClickHouse/pull/3337)
* `PREWHERE` 句に `arrayJoin` が含まれていないことを検査するチェックを追加しました。これまでは、クエリ実行時に `Size ... does not match` や `Unknown compression method` といったメッセージが出力されていました。 [#3357](https://github.com/ClickHouse/ClickHouse/pull/3357)
* 等価比較の AND チェーンを対応する IN 式に置き換える最適化の後に、まれに発生する可能性があったセグメンテーションフォルトを修正しました。 [liuyimin-bytedance](https://github.com/ClickHouse/ClickHouse/pull/3339)
* `clickhouse-benchmark` に対する軽微な修正: これまではクライアント情報がサーバーに送信されていませんでしたが、シャットダウン時およびイテレーション回数の制限を行う際に、実行されたクエリ数がより正確に算出されるようになりました。 [#3351](https://github.com/ClickHouse/ClickHouse/pull/3351) [#3352](https://github.com/ClickHouse/ClickHouse/pull/3352)

#### 後方互換性のない変更: {#backward-incompatible-changes-1}

- `allow_experimental_decimal_type`オプションを削除しました。`Decimal`データ型はデフォルトで利用可能です。[#3329](https://github.com/ClickHouse/ClickHouse/pull/3329)


## ClickHouse リリース 18.12 {#clickhouse-release-18-12}

### ClickHouse リリース 18.12.17, 2018-09-16 {#clickhouse-release-18-12-17-2018-09-16}

#### 新機能: {#new-features-2}

- `clickhouse`ソースに対して`invalidate_query`(外部ディクショナリの更新が必要かどうかを確認するクエリを指定する機能)が実装されました。[#3126](https://github.com/ClickHouse/ClickHouse/pull/3126)
- 範囲の境界を定義する`range_hashed`外部ディクショナリキーとして、`UInt*`、`Int*`、`DateTime`データ型(`Date`型と共に)を使用できるようになりました。また、`NULL`を使用して開いた範囲を指定できるようになりました。[Vasily Nemkov](https://github.com/ClickHouse/ClickHouse/pull/3123)
- `Decimal`型が`var*`および`stddev*`集約関数をサポートするようになりました。[#3129](https://github.com/ClickHouse/ClickHouse/pull/3129)
- `Decimal`型が数学関数(`exp`、`sin`など)をサポートするようになりました。[#3129](https://github.com/ClickHouse/ClickHouse/pull/3129)
- `system.part_log`テーブルに`partition_id`カラムが追加されました。[#3089](https://github.com/ClickHouse/ClickHouse/pull/3089)

#### バグ修正: {#bug-fixes-11}

- `Merge`が`Distributed`テーブルで正しく動作するようになりました。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3159)
- `Ubuntu Precise`および古いバージョンでClickHouseを実行できなくなっていた非互換性(`glibc`バージョンへの不要な依存関係)を修正しました。この非互換性はバージョン18.12.13で発生していました。[#3130](https://github.com/ClickHouse/ClickHouse/pull/3130)
- `enable_optimize_predicate_expression`設定のエラーを修正しました。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3107)
- 18.12.13より前のバージョンのレプリカクラスタで作業し、同時に新しいバージョンのサーバーでテーブルの新しいレプリカを作成する際に発生していた後方互換性に関する軽微な問題を修正しました(メッセージ`Can not clone replica, because the ... updated to new ClickHouse version`に表示されていましたが、これは論理的ではあるものの発生すべきではありませんでした)。[#3122](https://github.com/ClickHouse/ClickHouse/pull/3122)

#### 後方互換性のない変更: {#backward-incompatible-changes-2}

- `enable_optimize_predicate_expression`オプションがデフォルトで有効になりました(これはかなり楽観的な設定です)。カラム名の検索に関連するクエリ解析エラーが発生する場合は、`enable_optimize_predicate_expression`を0に設定してください。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3107)

### ClickHouse リリース 18.12.14, 2018-09-13 {#clickhouse-release-18-12-14-2018-09-13}

#### 新機能: {#new-features-3}

- `ALTER UPDATE`クエリのサポートが追加されました。[#3035](https://github.com/ClickHouse/ClickHouse/pull/3035)
- ユーザーのDDLクエリへのアクセスを制限する`allow_ddl`オプションが追加されました。[#3104](https://github.com/ClickHouse/ClickHouse/pull/3104)
- `MergeTree`エンジンに`min_merge_bytes_to_use_direct_io`オプションが追加され、マージの合計サイズのしきい値を設定できるようになりました(しきい値を超えると、データパートファイルはO_DIRECTを使用して処理されます)。[#3117](https://github.com/ClickHouse/ClickHouse/pull/3117)
- `system.merges`システムテーブルに`partition_id`カラムが含まれるようになりました。[#3099](https://github.com/ClickHouse/ClickHouse/pull/3099)

#### 改善 {#improvements-3}

- ミューテーション中にデータパートが変更されない場合、レプリカによってダウンロードされなくなりました。[#3103](https://github.com/ClickHouse/ClickHouse/pull/3103)
- `clickhouse-client`で作業する際に、設定名のオートコンプリートが利用可能になりました。[#3106](https://github.com/ClickHouse/ClickHouse/pull/3106)

#### バグ修正: {#bug-fixes-12}


- 挿入時に`Nested`型フィールドの要素である配列のサイズチェックを追加しました。[#3118](https://github.com/ClickHouse/ClickHouse/pull/3118)
- `ODBC`ソースと`hashed`ストレージを使用した外部ディクショナリの更新エラーを修正しました。このエラーはバージョン18.12.13で発生していました。
- `IN`条件を含むクエリから一時テーブルを作成する際のクラッシュを修正しました。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3098)
- `NULL`要素を含む可能性のある配列に対する集約関数のエラーを修正しました。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/3097)

### ClickHouse リリース 18.12.13, 2018-09-10 {#clickhouse-release-18-12-13-2018-09-10}

#### 新機能: {#new-features-4}


* `DECIMAL(digits, scale)` データ型（`Decimal32(scale)`、`Decimal64(scale)`、`Decimal128(scale)`）が追加されました。これを有効にするには、設定 `allow_experimental_decimal_type` を使用してください。 [#2846](https://github.com/ClickHouse/ClickHouse/pull/2846) [#2970](https://github.com/ClickHouse/ClickHouse/pull/2970) [#3008](https://github.com/ClickHouse/ClickHouse/pull/3008) [#3047](https://github.com/ClickHouse/ClickHouse/pull/3047)
* `GROUP BY` 用の新しい `WITH ROLLUP` 修飾子（代替構文: `GROUP BY ROLLUP(...)`）。 [#2948](https://github.com/ClickHouse/ClickHouse/pull/2948)
* `JOIN` を含むクエリでは、SQL 標準に従い、アスタリスクはすべてのテーブルのカラムのリストに展開されます。ユーザー設定レベルで `asterisk_left_columns_only` を 1 に設定することで、従来の動作に戻すことができます。 [Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2787)
* テーブル関数との JOIN をサポートしました。 [Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2907)
* clickhouse-client で Tab キーによるオートコンプリートに対応。 [Sergey Shcherbin](https://github.com/ClickHouse/ClickHouse/pull/2447)
* clickhouse-client で Ctrl+C を押すと、入力したクエリがクリアされます。 [#2877](https://github.com/ClickHouse/ClickHouse/pull/2877)
* `join_default_strictness` 設定（値: `"`, `'any'`, `'all'`）を追加しました。これにより、`JOIN` で `ANY` または `ALL` を明示的に指定する必要がなくなります。 [#2982](https://github.com/ClickHouse/ClickHouse/pull/2982)
* クエリ処理に関連するサーバーログの各行にクエリ ID が表示されます。 [#2482](https://github.com/ClickHouse/ClickHouse/pull/2482)
* `clickhouse-client` でクエリ実行ログを取得できるようになりました（`send_logs_level` 設定を使用してください）。分散クエリ処理では、すべてのサーバーからのログが段階的に集約されます。 [#2482](https://github.com/ClickHouse/ClickHouse/pull/2482)
* `system.query_log` および `system.processes`（`SHOW PROCESSLIST`）テーブルに、クエリ実行時に変更されたすべての設定に関する情報（`Settings` データの入れ子構造）が含まれるようになりました。`log_query_settings` 設定を追加しました。 [#2482](https://github.com/ClickHouse/ClickHouse/pull/2482)
* `system.query_log` と `system.processes` テーブルに、クエリの実行に参加しているスレッド数に関する情報が表示されるようになりました（`thread_numbers` 列を参照）。 [#2482](https://github.com/ClickHouse/ClickHouse/pull/2482)
* ネットワーク経由での読み取りおよび書き込み、ディスクへの読み取りおよび書き込みに要した時間、ネットワークエラーの発生回数、さらにネットワーク帯域幅が制限されている場合の待機時間を計測する `ProfileEvents` カウンタを追加しました。 [#2482](https://github.com/ClickHouse/ClickHouse/pull/2482)
* `rusage` 由来のシステムメトリクス（ユーザ空間およびカーネルにおける CPU 使用率、ページフォルト、コンテキストスイッチに関する情報を取得するために使用できます）および `taskstats` メトリクス（I/O 待ち時間、CPU 待ち時間、ページキャッシュの有無それぞれについての読み取り・書き込みデータ量に関する情報を取得するために使用できます）を含む `ProfileEvents` カウンタを追加しました。 [#2482](https://github.com/ClickHouse/ClickHouse/pull/2482)
* `ProfileEvents` カウンタは、グローバルおよび各クエリ単位に加えて、各クエリ実行スレッドごとにも適用されるため、クエリごとのリソース消費を詳細にプロファイリングできます。 [#2482](https://github.com/ClickHouse/ClickHouse/pull/2482)
* 各クエリ実行スレッドに関する情報を保持する `system.query_thread_log` テーブルを追加しました。`log_query_threads` 設定を追加しました。 [#2482](https://github.com/ClickHouse/ClickHouse/pull/2482)
* `system.metrics` と `system.events` テーブルに、組み込みドキュメントが追加されました。 [#3016](https://github.com/ClickHouse/ClickHouse/pull/3016)
* `arrayEnumerateDense` 関数を追加しました。 [Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2975)
* `arrayCumSumNonNegative` 関数および `arrayDifference` 関数を追加しました。 [Aleksey Studnev](https://github.com/ClickHouse/ClickHouse/pull/2942)
* `retention` 集約関数を追加しました。 [Sundy Li](https://github.com/ClickHouse/ClickHouse/pull/2887)
* これで、`+` 演算子を使用して集約関数の状態を加算（マージ）できるようになり、さらに集約関数の状態に非負の定数を掛けて乗算できるようになりました。 [#3062](https://github.com/ClickHouse/ClickHouse/pull/3062) [#3034](https://github.com/ClickHouse/ClickHouse/pull/3034)
* MergeTree ファミリーのテーブルに、仮想カラム `_partition_id` が追加されました。 [#3089](https://github.com/ClickHouse/ClickHouse/pull/3089)

#### 実験的機能: {#experimental-features-1}

- `LowCardinality(T)` データ型を追加しました。このデータ型は値のローカル辞書を自動的に作成し、辞書を展開することなくデータ処理を行うことができます。[#2830](https://github.com/ClickHouse/ClickHouse/pull/2830)
- JITコンパイルされた関数のキャッシュと、コンパイル前の使用回数カウンターを追加しました。式をJITコンパイルするには、`compile_expressions` 設定を有効にしてください。[#2990](https://github.com/ClickHouse/ClickHouse/pull/2990) [#3077](https://github.com/ClickHouse/ClickHouse/pull/3077)

#### 改善: {#improvements-4}


* 放棄されたレプリカが存在する場合に、レプリケーションログが無制限に蓄積されてしまう問題を修正しました。大きな遅延が発生しているレプリカ向けに、効率的なリカバリーモードを追加しました。
* `GROUP BY` で複数の集計フィールドがあり、そのうち 1 つが文字列型で他が固定長型である場合のパフォーマンスを改善。
* `PREWHERE` の使用時および式が暗黙的に `PREWHERE` に転送される場合のパフォーマンスが向上しました。
* テキストフォーマット（`CSV`、`TSV`）のパース性能を向上。 [Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2977) [#2980](https://github.com/ClickHouse/ClickHouse/pull/2980)
* バイナリ形式における文字列および配列の読み取り性能を向上しました。 [Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2955)
* 単一サーバー上に非常に多数のテーブルが存在する場合に、`system.tables` および `system.columns` へのクエリのパフォーマンスが向上し、メモリ使用量が削減されました。 [#2953](https://github.com/ClickHouse/ClickHouse/pull/2953)
* 大量のクエリストリームがエラーになる場合のパフォーマンス問題を修正しました（`perf top` に `_dl_addr` 関数は表示されているものの、サーバー自体の CPU 使用率はそれほど高くない状況）。 [#2938](https://github.com/ClickHouse/ClickHouse/pull/2938)
* `enable_optimize_predicate_expression` が有効な場合、条件はビューにキャストされます。 [Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2907)
* `UUID` データ型の機能が改善されました。 [#3074](https://github.com/ClickHouse/ClickHouse/pull/3074) [#2985](https://github.com/ClickHouse/ClickHouse/pull/2985)
* `UUID` データ型が The-Alchemist 辞書でサポートされました。 [#2822](https://github.com/ClickHouse/ClickHouse/pull/2822)
* `visitParamExtractRaw` 関数はネストされた構造でも正しく動作します。 [Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2974)
* `input_format_skip_unknown_fields` 設定が有効な場合、`JSONEachRow` 形式でオブジェクトのフィールドが正しくスキップされるようになりました。 [BlahGeek](https://github.com/ClickHouse/ClickHouse/pull/2958)
* 条件付きの `CASE` 式では、`ELSE` を省略できるようになりました。これは `ELSE NULL` と同等です。 [#2920](https://github.com/ClickHouse/ClickHouse/pull/2920)
* ZooKeeper を使用する際に、操作のタイムアウトを設定できるようになりました。 [urykhy](https://github.com/ClickHouse/ClickHouse/pull/2971)
* `LIMIT n, m` のオフセット部分は、`LIMIT n OFFSET m` として指定できます。 [#2840](https://github.com/ClickHouse/ClickHouse/pull/2840)
* `LIMIT` の代替として、`SELECT TOP n` 構文を使用できます。 [#2840](https://github.com/ClickHouse/ClickHouse/pull/2840)
* システムテーブルへの書き込みキューのサイズを拡大し、`SystemLog parameter queue is full` エラーの発生頻度を低減しました。
* `windowFunnel` 集約関数が、複数の条件を満たすイベントにも対応するようになりました。 [Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2801)
* `JOIN` の `USING` 句で重複したカラムを使用できるようになりました。 [#3006](https://github.com/ClickHouse/ClickHouse/pull/3006)
* `Pretty` フォーマットに、列の幅揃えに対する上限が追加されました。`output_format_pretty_max_column_pad_width` 設定を使用してください。値がこの幅より大きい場合でも値自体は完全に表示されますが、テーブル内の他のセルが過度に広くならないようになります。 [#3003](https://github.com/ClickHouse/ClickHouse/pull/3003)
* `odbc` テーブル関数で、データベース名やスキーマ名を指定できるようになりました。 [Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2885)
* `clickhouse-client` の設定ファイルで指定されたユーザー名を利用できるようになりました。 [Vladimir Kozbin](https://github.com/ClickHouse/ClickHouse/pull/2909)
* `ZooKeeperExceptions` カウンターは、`ZooKeeperUserExceptions`、`ZooKeeperHardwareExceptions`、`ZooKeeperOtherExceptions` の 3 つのカウンターに分割されました。
* `ALTER DELETE` クエリはマテリアライズドビューに対しても実行できます。
* 非常に多数の `ReplicatedMergeTree` テーブルが存在する場合に定期的な負荷スパイクが発生するのを避けるため、`ReplicatedMergeTree` テーブルに対してクリーンアップスレッドを定期的に実行する処理にランダム化を追加しました。
* `ATTACH TABLE ... ON CLUSTER` クエリのサポートを追加。[#3025](https://github.com/ClickHouse/ClickHouse/pull/3025)

#### バグ修正: {#bug-fixes-13}


* `Dictionary` テーブルでの問題（`Size of offsets does not match size of column` や `Unknown compression method` という例外がスローされる）が修正されました。このバグはバージョン 18.10.3 で発生しました。 [#2913](https://github.com/ClickHouse/ClickHouse/issues/2913)
* `CollapsingMergeTree` テーブルをマージする際、データパーツの一つが空であり（すべてのデータが削除された場合、マージ処理中または `ALTER DELETE` 実行時にこのようなパーツが生成される）、かつマージに `vertical` アルゴリズムが使用されている場合に発生していたバグを修正しました。 [#3049](https://github.com/ClickHouse/ClickHouse/pull/3049)
* `Memory` テーブルに対して `SELECT` と同時に実行される `DROP` または `TRUNCATE` の処理中に発生するレースコンディションを修正しました。この問題はサーバークラッシュを引き起こす可能性がありました。このバグはバージョン 1.1.54388 で導入されました。 [#3038](https://github.com/ClickHouse/ClickHouse/pull/3038)
* `Session is expired` エラーが返された場合に、`Replicated` テーブルへの挿入時にデータが失われる可能性があった問題を修正しました（データ損失は `ReplicatedDataLoss` メトリクスで検出できます）。このエラーはバージョン 1.1.54378 で発生していました。 [#2939](https://github.com/ClickHouse/ClickHouse/pull/2939) [#2949](https://github.com/ClickHouse/ClickHouse/pull/2949) [#2964](https://github.com/ClickHouse/ClickHouse/pull/2964)
* `JOIN ... ON` 実行時に発生していたセグメンテーションフォルトを修正しました。 [#3000](https://github.com/ClickHouse/ClickHouse/pull/3000)
* `WHERE table.column` のように `WHERE` 式が完全に修飾された列名のみで構成されている場合に、列名の検索時に発生していたエラーを修正しました。 [#2994](https://github.com/ClickHouse/ClickHouse/pull/2994)
* サブクエリを含む IN 式で構成される単一の列のみがリモートサーバーから要求された場合に、分散クエリの実行時に発生していた「Not found column」エラーを修正しました。 [#3087](https://github.com/ClickHouse/ClickHouse/pull/3087)
* 分散クエリにおいて、一方のシャードがローカルで他方がローカルでない場合に、`PREWHERE` への移動最適化が有効化されると発生していた `Block structure mismatch in UNION stream: different number of columns` エラーを修正しました。 [#2226](https://github.com/ClickHouse/ClickHouse/pull/2226) [#3037](https://github.com/ClickHouse/ClickHouse/pull/3037) [#3055](https://github.com/ClickHouse/ClickHouse/pull/3055) [#3065](https://github.com/ClickHouse/ClickHouse/pull/3065) [#3073](https://github.com/ClickHouse/ClickHouse/pull/3073) [#3090](https://github.com/ClickHouse/ClickHouse/pull/3090) [#3093](https://github.com/ClickHouse/ClickHouse/pull/3093)
* 非凸ポリゴンのいくつかのケースに対して、`pointInPolygon` 関数を修正しました。 [#2910](https://github.com/ClickHouse/ClickHouse/pull/2910)
* `nan` を整数と比較したときに結果が誤っていた問題を修正しました。 [#3024](https://github.com/ClickHouse/ClickHouse/pull/3024)
* まれなケースでセグメンテーションフォールトを引き起こす可能性があった `zlib-ng` ライブラリの不具合を修正しました。 [#2854](https://github.com/ClickHouse/ClickHouse/pull/2854)
* 集約関数の状態が単純ではなく（個別にメモリを割り当てる）、かつ 1 回の挿入リクエストで複数の小さなブロックが生成される場合に、`AggregateFunction` 列を持つテーブルへの挿入時に発生していたメモリリークを修正しました。 [#3084](https://github.com/ClickHouse/ClickHouse/pull/3084)
* 同じ `Buffer` または `MergeTree` テーブルを同時に作成および削除する際に発生していたレースコンディションを修正しました。
* 特定の非自明な型（`tuple` など）から構成されるタプル同士を比較する際に、セグメンテーションフォルトが発生する可能性があった問題を修正しました。 [#2989](https://github.com/ClickHouse/ClickHouse/pull/2989)
* 特定の `ON CLUSTER` クエリを実行した際にセグメンテーションフォールトが発生し得る問題を修正しました。 [Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2960)
* `Nullable` 配列要素に対する `arrayDistinct` 関数の不具合を修正しました。 [#2845](https://github.com/ClickHouse/ClickHouse/pull/2845) [#2937](https://github.com/ClickHouse/ClickHouse/pull/2937)
* `enable_optimize_predicate_expression` オプションが、`SELECT *` を用いるケースも正しくサポートするようになりました。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2929)
* ZooKeeper セッションの再初期化時に発生していたセグメンテーションフォルトを修正しました。 [#2917](https://github.com/ClickHouse/ClickHouse/pull/2917)
* ZooKeeper を使用する際に発生しうるブロッキングの問題を修正しました。
* `SummingMergeTree` でネストしたデータ構造を追加するコードの誤りを修正しました。
* 集約関数の状態用にメモリを割り当てる際にアラインメントが正しく考慮されるようになり、集約関数の状態を実装する際にアラインメントを必要とする操作を使用できるようになりました。[chenxing-xc](https://github.com/ClickHouse/ClickHouse/pull/2808)

#### セキュリティ修正: {#security-fix}

- ODBCデータソースの安全な使用。ODBCドライバとの連携には、別プロセスの`clickhouse-odbc-bridge`を使用します。サードパーティのODBCドライバのエラーが、サーバの安定性や脆弱性の問題を引き起こすことはなくなりました。[#2828](https://github.com/ClickHouse/ClickHouse/pull/2828) [#2879](https://github.com/ClickHouse/ClickHouse/pull/2879) [#2886](https://github.com/ClickHouse/ClickHouse/pull/2886) [#2893](https://github.com/ClickHouse/ClickHouse/pull/2893) [#2921](https://github.com/ClickHouse/ClickHouse/pull/2921)
- `catBoostPool`テーブル関数におけるファイルパスの不正な検証を修正しました。[#2894](https://github.com/ClickHouse/ClickHouse/pull/2894)
- システムテーブル（`tables`、`databases`、`parts`、`columns`、`parts_columns`、`merges`、`mutations`、`replicas`、`replication_queue`）の内容は、ユーザに設定されたデータベースへのアクセス権（`allow_databases`）に従ってフィルタリングされます。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2856)

#### 後方互換性のない変更: {#backward-incompatible-changes-3}

- JOINを含むクエリにおいて、アスタリスク文字はSQL標準に準拠し、すべてのテーブルの列リストに展開されます。ユーザ設定レベルで`asterisk_left_columns_only`を1に設定することで、以前の動作に戻すことができます。

#### ビルドの変更: {#build-changes-2}

- ほとんどの統合テストがコミット単位で実行できるようになりました。
- コードスタイルチェックもコミット単位で実行できるようになりました。
- CentOS7/Fedora上でビルドする際に、`memcpy`の実装が正しく選択されるようになりました。[Etienne Champetier](https://github.com/ClickHouse/ClickHouse/pull/2912)
- clangを使用してビルドする際、通常の`-Wall-Wextra -Werror`に加えて、`-Weverything`からいくつかの警告が追加されました。[#2957](https://github.com/ClickHouse/ClickHouse/pull/2957)
- ビルドのデバッグには`jemalloc`のデバッグオプションを使用します。
- ZooKeeperと連携するためのライブラリのインターフェースが抽象として宣言されました。[#2950](https://github.com/ClickHouse/ClickHouse/pull/2950)


## ClickHouse リリース 18.10 {#clickhouse-release-18-10}

### ClickHouse リリース 18.10.3, 2018-08-13 {#clickhouse-release-18-10-3-2018-08-13}

#### 新機能: {#new-features-5}

- レプリケーションでHTTPSを使用できるようになりました。[#2760](https://github.com/ClickHouse/ClickHouse/pull/2760)
- 既存の`murmurHash2_32`に加えて、`murmurHash2_64`、`murmurHash3_32`、`murmurHash3_64`、`murmurHash3_128`関数を追加しました。[#2791](https://github.com/ClickHouse/ClickHouse/pull/2791)
- ClickHouse ODBCドライバー(`ODBCDriver2`出力形式)でNullable型をサポートしました。[#2834](https://github.com/ClickHouse/ClickHouse/pull/2834)
- キー列で`UUID`をサポートしました。

#### 改善: {#improvements-5}

- 設定ファイルから削除された場合、サーバーを再起動せずにクラスターを削除できるようになりました。[#2777](https://github.com/ClickHouse/ClickHouse/pull/2777)
- 設定ファイルから削除された場合、サーバーを再起動せずに外部ディクショナリを削除できるようになりました。[#2779](https://github.com/ClickHouse/ClickHouse/pull/2779)
- `Kafka`テーブルエンジンに`SETTINGS`サポートを追加しました。[Alexander Marshalov](https://github.com/ClickHouse/ClickHouse/pull/2781)
- `UUID`データ型の改善(まだ完全ではありません)。[#2618](https://github.com/ClickHouse/ClickHouse/pull/2618)
- `SummingMergeTree`、`CollapsingMergeTree`、`VersionedCollapsingMergeTree`エンジンでマージ後の空のパートをサポートしました。[#2815](https://github.com/ClickHouse/ClickHouse/pull/2815)
- 完了したミューテーションの古いレコードが削除されるようになりました(`ALTER DELETE`)。[#2784](https://github.com/ClickHouse/ClickHouse/pull/2784)
- `system.merge_tree_settings`テーブルを追加しました。[Kirill Shvakov](https://github.com/ClickHouse/ClickHouse/pull/2841)
- `system.tables`テーブルに依存関係列`dependencies_database`と`dependencies_table`が追加されました。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2851)
- `max_partition_size_to_drop`設定オプションを追加しました。[#2782](https://github.com/ClickHouse/ClickHouse/pull/2782)
- `output_format_json_escape_forward_slashes`オプションを追加しました。[Alexander Bocharov](https://github.com/ClickHouse/ClickHouse/pull/2812)
- `max_fetch_partition_retries_count`設定を追加しました。[#2831](https://github.com/ClickHouse/ClickHouse/pull/2831)
- ローカルレプリカの優先を無効にし、プロセス間通信なしでローカルレプリカにアクセスするための`prefer_localhost_replica`設定を追加しました。[#2832](https://github.com/ClickHouse/ClickHouse/pull/2832)
- `quantileExact`集約関数は、空の`Float32`または`Float64`セットに対する集約の場合に`nan`を返すようになりました。[Sundy Li](https://github.com/ClickHouse/ClickHouse/pull/2855)

#### バグ修正: {#bug-fixes-14}


- ODBC接続文字列パラメータの不要なエスケープ処理を削除しました。この処理により接続の確立が不可能になっていました。このエラーはバージョン18.6.0で発生しました。
- レプリケーションキューにおける`REPLACE PARTITION`コマンドの処理ロジックを修正しました。同一パーティションに対して2つの`REPLACE`コマンドが存在する場合、誤ったロジックによりそのうちの1つがレプリケーションキューに残り実行されない可能性がありました。[#2814](https://github.com/ClickHouse/ClickHouse/pull/2814)
- すべてのデータパートが空の場合のマージバグを修正しました(マージから形成されたパート、またはすべてのデータが削除された場合の`ALTER DELETE`から形成されたパート)。このバグはバージョン18.1.0で発生しました。[#2930](https://github.com/ClickHouse/ClickHouse/pull/2930)
- 並行`Set`または`Join`のエラーを修正しました。[Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2823)
- サブクエリ内の`UNION ALL`クエリにおいて、いずれかの`SELECT`クエリに重複したカラム名が含まれている場合に発生していた`Block structure mismatch in UNION stream: different number of columns`エラーを修正しました。[Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2094)
- MySQLサーバーへの接続時に例外が発生した場合のメモリリークを修正しました。
- クエリエラー発生時のclickhouse-clientの誤った応答コードを修正しました。
- DISTINCTを含むマテリアライズドビューの誤った動作を修正しました。[#2795](https://github.com/ClickHouse/ClickHouse/issues/2795)

#### 後方互換性のない変更 {#backward-incompatible-changes-4}

- Distributedテーブルに対するCHECK TABLEクエリのサポートを削除しました。

#### ビルドの変更: {#build-changes-3}

- アロケータを置き換えました:`tcmalloc`の代わりに`jemalloc`を使用するようになりました。一部のシナリオでは、最大20%の速度向上が見られます。ただし、最大20%遅くなるクエリも存在します。一部のシナリオではメモリ消費量が約10%削減され、安定性が向上しました。高負荷時において、ユーザースペースおよびシステムのCPU使用率はわずかに増加します。[#2773](https://github.com/ClickHouse/ClickHouse/pull/2773)
- サブモジュールからlibresslを使用するようになりました。[#1983](https://github.com/ClickHouse/ClickHouse/pull/1983) [#2807](https://github.com/ClickHouse/ClickHouse/pull/2807)
- サブモジュールからunixodbcを使用するようになりました。[#2789](https://github.com/ClickHouse/ClickHouse/pull/2789)
- サブモジュールからmariadb-connector-cを使用するようになりました。[#2785](https://github.com/ClickHouse/ClickHouse/pull/2785)
- テストデータの可用性に依存する機能テストファイルをリポジトリに追加しました(現時点ではテストデータ自体は含まれていません)。


## ClickHouse リリース 18.6 {#clickhouse-release-18-6}

### ClickHouse リリース 18.6.0, 2018-08-02 {#clickhouse-release-18-6-0-2018-08-02}

#### 新機能: {#new-features-6}

- JOIN ON 構文の ON 式のサポートを追加:
  `JOIN ON Expr([table.]column ...) = Expr([table.]column, ...) [AND Expr([table.]column, ...) = Expr([table.]column, ...) ...]`
  式は AND 演算子で結合された等式のチェーンである必要があります。等式の各辺は、いずれかのテーブルの列に対する任意の式を指定できます。右側のテーブルに対しては、完全修飾列名(`table.name`、`database.table.name`、`table_alias.name`、`subquery_alias.name`)の使用がサポートされています。[#2742](https://github.com/ClickHouse/ClickHouse/pull/2742)
- レプリケーションで HTTPS を有効化できるようになりました。[#2760](https://github.com/ClickHouse/ClickHouse/pull/2760)

#### 改善: {#improvements-6}

- サーバーがバージョンのパッチコンポーネントをクライアントに渡すようになりました。パッチバージョンコンポーネントに関するデータは `system.processes` と `query_log` に含まれています。[#2646](https://github.com/ClickHouse/ClickHouse/pull/2646)


## ClickHouse リリース 18.5 {#clickhouse-release-18-5}

### ClickHouse リリース 18.5.1, 2018-07-31 {#clickhouse-release-18-5-1-2018-07-31}

#### 新機能: {#new-features-7}

- ハッシュ関数 `murmurHash2_32` を追加しました [#2756](https://github.com/ClickHouse/ClickHouse/pull/2756)。

#### 改善: {#improvements-7}

- 環境変数から設定ファイルの値を設定するために `from_env` [#2741](https://github.com/ClickHouse/ClickHouse/pull/2741) 属性を使用できるようになりました。
- `coalesce`、`ifNull`、`nullIf` 関数の大文字小文字を区別しないバージョンを追加しました [#2752](https://github.com/ClickHouse/ClickHouse/pull/2752)。

#### バグ修正: {#bug-fixes-15}

- レプリカ起動時に発生する可能性のあるバグを修正しました [#2759](https://github.com/ClickHouse/ClickHouse/pull/2759)。


## ClickHouse リリース 18.4 {#clickhouse-release-18-4}

### ClickHouse リリース 18.4.0, 2018-07-28 {#clickhouse-release-18-4-0-2018-07-28}

#### 新機能: {#new-features-8}

- システムテーブルを追加: `formats`、`data_type_families`、`aggregate_function_combinators`、`table_functions`、`table_engines`、`collations` [#2721](https://github.com/ClickHouse/ClickHouse/pull/2721)。
- `remote` または `cluster table function` の引数として、テーブルの代わりにテーブル関数を使用できる機能を追加 [#2708](https://github.com/ClickHouse/ClickHouse/pull/2708)。
- レプリケーションプロトコルで `HTTP Basic` 認証をサポート [#2727](https://github.com/ClickHouse/ClickHouse/pull/2727)。
- `has` 関数で `Enum` 値の配列内の数値を検索できるようになりました [Maxim Khrisanfov](https://github.com/ClickHouse/ClickHouse/pull/2699)。
- `Kafka` からの読み取り時に任意のメッセージ区切り文字を追加できるようになりました [Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2701)。

#### 改善: {#improvements-8}

- `ALTER TABLE t DELETE WHERE` クエリは、WHERE 条件の影響を受けなかったデータパートを書き換えないようになりました [#2694](https://github.com/ClickHouse/ClickHouse/pull/2694)。
- `ReplicatedMergeTree` テーブルの `use_minimalistic_checksums_in_zookeeper` オプションがデフォルトで有効になりました。この設定はバージョン 1.1.54378 (2018-04-16) で追加されました。1.1.54378 より古いバージョンはインストールできなくなりました。
- `ON CLUSTER` を指定した `KILL` および `OPTIMIZE` クエリの実行をサポート [Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2689)。

#### バグ修正: {#bug-fixes-16}

- IN 式を使用した集計における `Column ... is not under an aggregate function and not in GROUP BY` エラーを修正しました。このバグはバージョン 18.1.0 で発生していました。([bbdd780b](https://github.com/ClickHouse/ClickHouse/commit/bbdd780be0be06a0f336775941cdd536878dd2c2))
- `windowFunnel` 集計関数のバグを修正 [Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2735)。
- `anyHeavy` 集計関数のバグを修正 ([a2101df2](https://github.com/ClickHouse/ClickHouse/commit/a2101df25a6a0fba99aa71f8793d762af2b801ee))
- `countArray()` 集計関数を使用した際のサーバークラッシュを修正しました。

#### 後方互換性のない変更: {#backward-incompatible-changes-5}

- `Kafka` エンジンのパラメータが `Kafka(kafka_broker_list, kafka_topic_list, kafka_group_name, kafka_format[, kafka_schema, kafka_num_consumers])` から `Kafka(kafka_broker_list, kafka_topic_list, kafka_group_name, kafka_format[, kafka_row_delimiter, kafka_schema, kafka_num_consumers])` に変更されました。テーブルで `kafka_schema` または `kafka_num_consumers` パラメータを使用している場合は、メタデータファイル `path/metadata/database/table.sql` を手動で編集し、`kafka_row_delimiter` パラメータを `''` の値で追加する必要があります。


## ClickHouse リリース 18.1 {#clickhouse-release-18-1}

### ClickHouse リリース 18.1.0, 2018-07-23 {#clickhouse-release-18-1-0-2018-07-23}

#### 新機能: {#new-features-9}

- 非レプリケート MergeTree テーブルに対する `ALTER TABLE t DELETE WHERE` クエリのサポート ([#2634](https://github.com/ClickHouse/ClickHouse/pull/2634))。
- `uniq*` 系の集約関数における任意の型のサポート ([#2010](https://github.com/ClickHouse/ClickHouse/issues/2010))。
- 比較演算子における任意の型のサポート ([#2026](https://github.com/ClickHouse/ClickHouse/issues/2026))。
- `users.xml` ファイルで `10.0.0.1/255.255.255.0` 形式のサブネットマスクの設定が可能になりました。これは、中間にゼロを含む IPv6 ネットワークのマスクを使用するために必要です ([#2637](https://github.com/ClickHouse/ClickHouse/pull/2637))。
- `arrayDistinct` 関数を追加 ([#2670](https://github.com/ClickHouse/ClickHouse/pull/2670))。
- SummingMergeTree エンジンが AggregateFunction 型のカラムに対応 ([Constantin S. Pan](https://github.com/ClickHouse/ClickHouse/pull/2566))。

#### 改善: {#improvements-9}

- リリースバージョンの番号付けスキームを変更しました。現在、最初の部分にはリリース年(西暦、モスクワタイムゾーン、2000を引いた値)が含まれ、2番目の部分には主要な変更の番号(ほとんどのリリースで増加)が含まれ、3番目の部分はパッチバージョンです。変更履歴に特に記載がない限り、リリースは引き続き後方互換性を保ちます。
- 浮動小数点数から文字列への変換を高速化 ([Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2664))。
- パースエラーにより挿入中に一部の行がスキップされた場合(`input_allow_errors_num` および `input_allow_errors_ratio` 設定が有効な場合に発生する可能性があります)、スキップされた行数がサーバーログに記録されるようになりました ([Leonardo Cecchi](https://github.com/ClickHouse/ClickHouse/pull/2669))。

#### バグ修正: {#bug-fixes-17}

- 一時テーブルに対する TRUNCATE コマンドを修正 ([Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2624))。
- レスポンスの読み取り中にネットワークエラーが発生した際に ZooKeeper クライアントライブラリで稀に発生するデッドロックを修正 ([c315200](https://github.com/ClickHouse/ClickHouse/commit/c315200e64b87e44bdf740707fc857d1fdf7e947))。
- Nullable 型への CAST 時のエラーを修正 ([#1322](https://github.com/ClickHouse/ClickHouse/issues/1322))。
- 区間の境界が一致する場合の `maxIntersection()` 関数の誤った結果を修正 ([Michael Furmur](https://github.com/ClickHouse/ClickHouse/pull/2657))。
- 関数引数内の OR 式チェーンの誤った変換を修正 ([chenxing-xc](https://github.com/ClickHouse/ClickHouse/pull/2663))。
- 別のサブクエリ内に `IN (subquery)` 式を含むクエリのパフォーマンス低下を修正 ([#2571](https://github.com/ClickHouse/ClickHouse/issues/2571))。
- 大文字でない `CAST` 関数を使用する分散クエリにおける、異なるバージョンのサーバー間の非互換性を修正 ([fe8c4d6](https://github.com/ClickHouse/ClickHouse/commit/fe8c4d64e434cacd4ceef34faa9005129f2190a5))。
- 外部 DBMS へのクエリにおける識別子の引用符の欠落を修正 ([#2635](https://github.com/ClickHouse/ClickHouse/issues/2635))。

#### 後方互換性のない変更: {#backward-incompatible-changes-6}

- 数値ゼロを含む文字列から DateTime への変換は機能しません。例: `SELECT toDateTime('0')`。これは、テーブルで `DateTime DEFAULT '0'` が機能しない理由でもあり、辞書での `<null_value>0</null_value>` も同様です。解決策: `0` を `0000-00-00 00:00:00` に置き換えてください。


## ClickHouseリリース1.1 {#clickhouse-release-1-1}

### ClickHouseリリース1.1.54394、2018年7月12日 {#clickhouse-release-1-1-54394-2018-07-12}

#### 新機能: {#new-features-10}

- `histogram`集約関数を追加しました([Mikhail Surin](https://github.com/ClickHouse/ClickHouse/pull/2521))。
- `ReplicatedMergeTree`でパーティションを指定せずに`OPTIMIZE TABLE ... FINAL`を使用できるようになりました([Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2600))。

#### バグ修正: {#bug-fixes-18}

- レプリケートされたデータの送受信時における読み書き用ソケットのタイムアウトが非常に短い(1秒)問題を修正しました。この問題により、ネットワークまたはディスクに負荷がある場合、大きなパーツのダウンロードが不可能になり、パーツのダウンロードが循環的に試行される結果となっていました。このエラーはバージョン1.1.54388で発生していました。
- テーブルに重複したデータブロックを挿入した場合のZooKeeperでのchrootの使用に関する問題を修正しました。
- `has`関数がNullable要素を持つ配列に対して正しく動作するようになりました([#2115](https://github.com/ClickHouse/ClickHouse/issues/2115))。
- `system.tables`テーブルが分散クエリで使用される際に正しく動作するようになりました。`metadata_modification_time`および`engine_full`カラムは非仮想カラムになりました。これらのカラムのみがテーブルからクエリされた場合に発生していたエラーを修正しました。
- 空のデータブロックを挿入した後の空の`TinyLog`テーブルの動作を修正しました([#2563](https://github.com/ClickHouse/ClickHouse/issues/2563))。
- ZooKeeperのノードの値がNULLの場合でも`system.zookeeper`テーブルが動作するようになりました。

### ClickHouseリリース1.1.54390、2018年7月6日 {#clickhouse-release-1-1-54390-2018-07-06}

#### 新機能: {#new-features-11}

- クエリを`multipart/form-data`形式(`query`フィールド内)で送信できるようになりました。これは、クエリ処理のために外部データも送信される場合に便利です([Olga Hvostikova](https://github.com/ClickHouse/ClickHouse/pull/2490))。
- CSV形式でデータを読み取る際に、シングルクォートまたはダブルクォートの処理を有効または無効にする機能を追加しました。これは`format_csv_allow_single_quotes`および`format_csv_allow_double_quotes`設定で構成できます([Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2574))。
- `MergeTree`の非レプリケート版でパーティションを指定せずに`OPTIMIZE TABLE ... FINAL`を使用できるようになりました([Amos Bird](https://github.com/ClickHouse/ClickHouse/pull/2599))。

#### 改善: {#improvements-10}

- テーブルインデックスが使用できる場合のIN演算子の使用時におけるパフォーマンスの向上、メモリ消費の削減、および正確なメモリ消費追跡を実現しました([#2584](https://github.com/ClickHouse/ClickHouse/pull/2584))。
- データパーツを追加する際の冗長なチェックサム検証を削除しました。これは、レプリカの数が多い場合に重要です。なぜなら、これらのケースでは検証の総数がN^2に等しくなっていたためです。
- `arrayEnumerateUniq`関数に`Array(Tuple(...))`引数のサポートを追加しました([#2573](https://github.com/ClickHouse/ClickHouse/pull/2573))。
- `runningDifference`関数に`Nullable`のサポートを追加しました([#2594](https://github.com/ClickHouse/ClickHouse/pull/2594))。
- 非常に多数の式がある場合のクエリ解析パフォーマンスを改善しました([#2572](https://github.com/ClickHouse/ClickHouse/pull/2572))。
- `ReplicatedMergeTree`テーブルでのマージ用データパーツの選択を高速化しました。ZooKeeperセッションの回復を高速化しました([#2597](https://github.com/ClickHouse/ClickHouse/pull/2597))。
- `MergeTree`テーブルの`format_version.txt`ファイルが欠落している場合に再作成されるようになりました。これは、ファイルなしでディレクトリ構造をコピーした後にClickHouseを起動する場合に有用です([Ciprian Hacman](https://github.com/ClickHouse/ClickHouse/pull/2593))。

#### バグ修正: {#bug-fixes-19}


- ZooKeeperとの連携において、サーバー再起動前にテーブルのセッションおよび読み取り専用状態を復旧できなくなる可能性があったバグを修正しました。
- ZooKeeperとの連携において、セッションが中断された場合に古いノードが削除されない可能性があったバグを修正しました。
- Float引数に対する`quantileTDigest`関数のエラーを修正しました(このバグはバージョン1.1.54388で導入されました)([Mikhail Surin](https://github.com/ClickHouse/ClickHouse/pull/2553))。
- 主キー列が同じサイズの符号付き整数と符号なし整数間の型変換関数内に配置されている場合、MergeTreeテーブルのインデックスに関するバグを修正しました([#2603](https://github.com/ClickHouse/ClickHouse/pull/2603))。
- `macros`が使用されているが設定ファイルに存在しない場合のセグメンテーション違反を修正しました([#2570](https://github.com/ClickHouse/ClickHouse/pull/2570))。
- クライアント再接続時にデフォルトデータベースへ切り替わらない問題を修正しました([#2583](https://github.com/ClickHouse/ClickHouse/pull/2583))。
- `use_index_for_in_with_subqueries`設定が無効化されている場合に発生していたバグを修正しました。

#### セキュリティ修正: {#security-fix-1}

- MySQLに接続している場合、ファイル送信ができなくなりました(`LOAD DATA LOCAL INFILE`)。

### ClickHouse リリース 1.1.54388, 2018-06-28 {#clickhouse-release-1-1-54388-2018-06-28}

#### 新機能: {#new-features-12}

- レプリケートされたテーブルに対する`ALTER TABLE t DELETE WHERE`クエリのサポート。このタイプのクエリの進行状況を追跡するための`system.mutations`テーブルを追加しました。
- \*MergeTreeテーブルに対する`ALTER TABLE t [REPLACE|ATTACH] PARTITION`クエリのサポート。
- `TRUNCATE TABLE`クエリのサポート([Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2260))
- レプリケートされたテーブル用の複数の新しい`SYSTEM`クエリ(`RESTART REPLICAS`、`SYNC REPLICA`、`[STOP|START] [MERGES|FETCHES|SENDS REPLICATED|REPLICATION QUEUES]`)。
- MySQLエンジンを使用したテーブルおよび対応するテーブル関数への書き込み機能を追加しました([sundy-li](https://github.com/ClickHouse/ClickHouse/pull/2294))。
- `url()`テーブル関数と`URL`テーブルエンジンを追加しました([Alexander Sapin](https://github.com/ClickHouse/ClickHouse/pull/2501))。
- `windowFunnel`集約関数を追加しました([sundy-li](https://github.com/ClickHouse/ClickHouse/pull/2352))。
- 文字列用の新しい`startsWith`および`endsWith`関数([Vadim Plakhtinsky](https://github.com/ClickHouse/ClickHouse/pull/2429))。
- `numbers()`テーブル関数でオフセットを指定できるようになりました([Winter Zhang](https://github.com/ClickHouse/ClickHouse/pull/2535))。
- `clickhouse-client`のパスワードを対話的に入力できるようになりました。
- サーバーログをsyslogに送信できるようになりました([Alexander Krasheninnikov](https://github.com/ClickHouse/ClickHouse/pull/2459))。
- 共有ライブラリソースを使用した辞書でのログ記録のサポート([Alexander Sapin](https://github.com/ClickHouse/ClickHouse/pull/2472))。
- カスタムCSV区切り文字のサポート([Ivan Zhukov](https://github.com/ClickHouse/ClickHouse/pull/2263))
- `date_time_input_format`設定を追加しました。この設定を`'best_effort'`に切り替えると、DateTime値が幅広い形式で読み取られます。
- データ難読化のための`clickhouse-obfuscator`ユーティリティを追加しました。使用例: パフォーマンステストで使用されるデータの公開。

#### 実験的機能: {#experimental-features-2}

- 必要な場所でのみ`and`引数を計算する機能を追加しました([Anastasia Tsarkova](https://github.com/ClickHouse/ClickHouse/pull/2272))
- 一部の式に対してネイティブコードへのJITコンパイルが利用可能になりました([pyos](https://github.com/ClickHouse/ClickHouse/pull/2277))。

#### バグ修正: {#bug-fixes-20}


- `DISTINCT`と`ORDER BY`を使用したクエリで重複が表示されなくなりました。
- `ARRAY JOIN`と`arrayFilter`を使用したクエリが誤った結果を返さなくなりました。
- Nested構造から配列カラムを読み取る際のエラーを修正しました([#2066](https://github.com/ClickHouse/ClickHouse/issues/2066))。
- `HAVING tuple IN (...)`のようなHAVING句を含むクエリを解析する際のエラーを修正しました。
- 再帰的なエイリアスを含むクエリを解析する際のエラーを修正しました。
- すべての行をフィルタリングするPREWHERE条件を使用してReplacingMergeTreeから読み取る際のエラーを修正しました([#2525](https://github.com/ClickHouse/ClickHouse/issues/2525))。
- HTTPインターフェースでセッションを使用する際にユーザープロファイル設定が適用されない問題を修正しました。
- clickhouse-localでコマンドラインパラメータから設定が適用される方法を修正しました。
- ZooKeeperクライアントライブラリがサーバーから受信したセッションタイムアウトを使用するようになりました。
- クライアントがタイムアウトよりも長くサーバーの応答を待機していたZooKeeperクライアントライブラリのバグを修正しました。
- パーティションキーカラムに条件を持つクエリのパーツプルーニングを修正しました([#2342](https://github.com/ClickHouse/ClickHouse/issues/2342))。
- `CLEAR COLUMN IN PARTITION`の後にマージが可能になりました([#2315](https://github.com/ClickHouse/ClickHouse/issues/2315))。
- ODBCテーブル関数の型マッピングを修正しました([sundy-li](https://github.com/ClickHouse/ClickHouse/pull/2268))。
- タイムゾーンありとなしの`DateTime`の型比較を修正しました([Alexander Bocharov](https://github.com/ClickHouse/ClickHouse/pull/2400))。
- `CAST`演算子の構文解析とフォーマットを修正しました。
- Distributedテーブルエンジンのマテリアライズドビューへの挿入を修正しました([Babacar Diassé](https://github.com/ClickHouse/ClickHouse/pull/2411))。
- `Kafka`エンジンからマテリアライズドビューにデータを書き込む際の競合状態を修正しました([Yangkuan Liu](https://github.com/ClickHouse/ClickHouse/pull/2448))。
- remote()テーブル関数のSSRFを修正しました。
- マルチラインモードでの`clickhouse-client`の終了動作を修正しました([#2510](https://github.com/ClickHouse/ClickHouse/issues/2510))。

#### 改善: {#improvements-11}

- レプリケートされたテーブルのバックグラウンドタスクが、個別のスレッドではなくスレッドプールで実行されるようになりました([Silviu Caragea](https://github.com/ClickHouse/ClickHouse/pull/1722))。
- LZ4圧縮のパフォーマンスを改善しました。
- 多数のJOINとサブクエリを含むクエリの解析を高速化しました。
- ネットワークエラーが多すぎる場合にDNSキャッシュが自動的に更新されるようになりました。
- マテリアライズドビューの1つにパーツが多すぎて挿入できない場合、テーブルへの挿入が行われなくなりました。
- イベントカウンター`Query`、`SelectQuery`、`InsertQuery`の不一致を修正しました。
- タプル型が一致する場合、`tuple IN (SELECT tuple)`のような式が許可されるようになりました。
- ZooKeeperを設定していない場合でも、レプリケートされたテーブルを持つサーバーを起動できるようになりました。
- 利用可能なCPUコア数を計算する際に、cgroupsの制限が考慮されるようになりました([Atri Sharma](https://github.com/ClickHouse/ClickHouse/pull/2325))。
- systemd設定ファイルに設定ディレクトリのchownを追加しました([Mikhail Shiryaev](https://github.com/ClickHouse/ClickHouse/pull/2421))。

#### ビルドの変更: {#build-changes-4}

- gcc8コンパイラをビルドに使用できるようになりました。
- サブモジュールからllvmをビルドする機能を追加しました。
- librdkafkaライブラリのバージョンをv0.11.4に更新しました。
- システムのlibcpuidライブラリを使用する機能を追加しました。ライブラリのバージョンを0.4.0に更新しました。
- vectorclassライブラリを使用したビルドを修正しました([Babacar Diassé](https://github.com/ClickHouse/ClickHouse/pull/2274))。
- Cmakeがデフォルトでninjaのファイルを生成するようになりました(`-G Ninja`を使用した場合と同様)。
- libtermcapの代わりにlibtinoライブラリを使用する機能を追加しました([Georgy Kondratiev](https://github.com/ClickHouse/ClickHouse/pull/2519))。
- Fedora Rawhideでのヘッダーファイルの競合を修正しました([#2520](https://github.com/ClickHouse/ClickHouse/issues/2520))。

#### 後方互換性のない変更: {#backward-incompatible-changes-7}


- `Vertical`および`Pretty*`フォーマットでのエスケープ処理を削除し、`VerticalRaw`フォーマットを廃止しました。
- 分散クエリでバージョン1.1.54388(またはそれ以降)のサーバーと古いバージョンのサーバーを同時に使用し、クエリに`AS`キーワードを含まない`cast(x, 'Type')`式があり、かつ`cast`という単語が大文字でない場合、`Not found column cast(0, 'UInt8') in block`のようなメッセージで例外がスローされます。解決策:クラスタ全体でサーバーを更新してください。

### ClickHouse リリース 1.1.54385, 2018-06-01 {#clickhouse-release-1-1-54385-2018-06-01}

#### バグ修正: {#bug-fixes-21}

- 特定の状況でZooKeeper操作がブロックされる原因となっていたエラーを修正しました。

### ClickHouse リリース 1.1.54383, 2018-05-22 {#clickhouse-release-1-1-54383-2018-05-22}

#### バグ修正: {#bug-fixes-22}

- テーブルに多数のレプリカがある場合のレプリケーションキューの速度低下を修正しました。

### ClickHouse リリース 1.1.54381, 2018-05-14 {#clickhouse-release-1-1-54381-2018-05-14}

#### バグ修正: {#bug-fixes-23}

- ClickHouseがZooKeeperサーバーへの接続を失った際に発生するZooKeeperのノードリークを修正しました。

### ClickHouse リリース 1.1.54380, 2018-04-21 {#clickhouse-release-1-1-54380-2018-04-21}

#### 新機能: {#new-features-13}

- テーブル関数`file(path, format, structure)`を追加しました。`/dev/urandom`からバイトを読み取る例:`ln -s /dev/urandom /var/lib/clickhouse/user_files/random``clickhouse-client -q "SELECT * FROM file('random', 'RowBinary', 'd UInt8') LIMIT 10"`。

#### 改善: {#improvements-12}

- サブクエリを`()`括弧で囲むことでクエリの可読性を向上できるようになりました。例:`(SELECT 1) UNION ALL (SELECT 1)`。
- `system.processes`テーブルからの単純な`SELECT`クエリは`max_concurrent_queries`制限に含まれなくなりました。

#### バグ修正: {#bug-fixes-24}

- `MATERIALIZED VIEW`から選択する際の`IN`演算子の不正な動作を修正しました。
- `partition_key_column IN (...)`のような式におけるパーティションインデックスによる不正なフィルタリングを修正しました。
- テーブルに対して`RENAME`が実行された場合に非リーダーレプリカで`OPTIMIZE`クエリを実行できない問題を修正しました。
- 非リーダーレプリカで`OPTIMIZE`または`ALTER`クエリを実行する際の認証エラーを修正しました。
- `KILL QUERY`のフリーズを修正しました。
- ZooKeeper設定で空でない`chroot`プレフィックスが使用されている場合に、ウォッチの喪失、分散DDLキューのフリーズ、レプリケーションキューの速度低下を引き起こしていたZooKeeperクライアントライブラリのエラーを修正しました。

#### 後方互換性のない変更: {#backward-incompatible-changes-8}

- `(a, b) IN (SELECT (a, b))`のような式のサポートを削除しました(同等の式`(a, b) IN (SELECT a, b)`を使用できます)。以前のリリースでは、これらの式は不確定な`WHERE`フィルタリングを引き起こすか、エラーの原因となっていました。

### ClickHouse リリース 1.1.54378, 2018-04-16 {#clickhouse-release-1-1-54378-2018-04-16}

#### 新機能: {#new-features-14}


- サーバーを再起動せずにログレベルを変更できるようになりました。
- `SHOW CREATE DATABASE`クエリを追加しました。
- `query_id`を`clickhouse-client`に渡せるようになりました（elBroom）。
- 新しい設定：`max_network_bandwidth_for_all_users`。
- `MATERIALIZED VIEW`に対する`ALTER TABLE ... PARTITION ...`のサポートを追加しました。
- システムテーブルに非圧縮形式でのデータパーツのサイズに関する情報を追加しました。
- 分散テーブルのサーバー間暗号化サポート（`<remote_servers>`内のレプリカ設定で`<secure>1</secure>`を指定）。
- Zookeeperに保存されるデータ量を最小化するための`ReplicatedMergeTree`ファミリーのテーブルレベル設定：`use_minimalistic_checksums_in_zookeeper = 1`
- `clickhouse-client`プロンプトの設定。デフォルトでサーバー名がプロンプトに出力されるようになりました。サーバーの表示名は変更可能です。また、`X-ClickHouse-Display-Name` HTTPヘッダーでも送信されます（Kirill Shvakov）。
- `Kafka`エンジンに対して、カンマ区切りで複数の`topics`を指定できるようになりました（Tobias Adamson）
- `KILL QUERY`または`replace_running_query`によってクエリが停止された場合、クライアントは不完全な結果の代わりに`Query was canceled`例外を受け取るようになりました。

#### 改善点： {#improvements-13}

- `ALTER TABLE ... DROP/DETACH PARTITION`クエリがレプリケーションキューの先頭で実行されるようになりました。
- テーブルに単一のデータパーツしかない場合でも、`SELECT ... FINAL`と`OPTIMIZE ... FINAL`を使用できるようになりました。
- `query_log`テーブルが手動で削除された場合、動的に再作成されるようになりました（Kirill Shvakov）。
- `lengthUTF8`関数の実行速度が向上しました（zhang2014）。
- シャード数が非常に多い場合の`Distributed`テーブルにおける同期挿入（`insert_distributed_sync = 1`）のパフォーマンスが向上しました。
- サーバーはクライアントから`send_timeout`と`receive_timeout`の設定を受け取り、クライアントへの接続時にそれらを適用するようになりました（逆順で適用されます：サーバーソケットの`send_timeout`はクライアントから受け取った`receive_timeout`の値に設定され、その逆も同様です）。
- `Distributed`テーブルへの非同期挿入におけるクラッシュリカバリがより堅牢になりました。
- `countEqual`関数の戻り値の型が`UInt32`から`UInt64`に変更されました（谢磊）。

#### バグ修正： {#bug-fixes-25}

- 式の左辺が`Nullable`の場合の`IN`のエラーを修正しました。
- タプルの一部のコンポーネントがテーブルインデックスに含まれている場合に、`IN`でタプルを使用した際に正しい結果が返されるようになりました。
- `max_execution_time`制限が分散クエリで正しく機能するようになりました。
- `system.columns`テーブルで複合カラムのサイズを計算する際のエラーを修正しました。
- 一時テーブル`CREATE TEMPORARY TABLE IF NOT EXISTS`を作成する際のエラーを修正しました。
- `StorageKafka`のエラーを修正しました（##2075）
- 特定の集約関数の無効な引数によるサーバークラッシュを修正しました。
- `DETACH DATABASE`クエリが`ReplicatedMergeTree`テーブルのバックグラウンドタスクを停止できなかったエラーを修正しました。
- 集約されたマテリアライズドビューへの挿入時に`Too many parts`状態が発生しにくくなりました（##2084）。
- 同じレベルで置換の後に別の置換が続く必要がある場合の、設定における置換の再帰的処理を修正しました。
- `UNION ALL`を使用したクエリを含む`VIEW`を作成する際のメタデータファイルの構文を修正しました。
- `SummingMergeTree`が複合キーを持つネストされたデータ構造の合計に対して正しく動作するようになりました。
- `ReplicatedMergeTree`テーブルのリーダーを選択する際の競合状態の可能性を修正しました。

#### ビルドの変更： {#build-changes-5}

- ビルドが`make`の代わりに`ninja`をサポートし、リリースのビルドにデフォルトで`ninja`を使用するようになりました。
- パッケージ名を変更しました：`clickhouse-server-base`を`clickhouse-common-static`に、`clickhouse-server-common`を`clickhouse-server`に、`clickhouse-common-dbg`を`clickhouse-common-static-dbg`に変更しました。インストールには`clickhouse-server clickhouse-client`を使用してください。後方互換性のため、古い名前のパッケージは引き続きリポジトリで読み込まれます。

#### 後方互換性のない変更： {#backward-incompatible-changes-9}


- 配列が左辺に指定された場合のIN式の特殊な解釈を削除しました。以前は、式 `arr IN (set)` は「少なくとも1つの `arr` 要素が `set` に属する」と解釈されていました。新しいバージョンで同じ動作を得るには、`arrayExists(x -> x IN (set), arr)` と記述してください。
- Pocoライブラリでデフォルトで誤って有効化されていたソケットオプション `SO_REUSEPORT` の不適切な使用を無効化しました。なお、Linuxでは、listenに対してアドレス `::` と `0.0.0.0` を同時に指定する理由はもはやありません。`::` のみを使用してください。これにより、IPv4とIPv6の両方で接続をリッスンできます(デフォルトのカーネル設定の場合)。設定ファイルに `<listen_reuse_port>1</listen_reuse_port>` を指定することで、以前のバージョンの動作に戻すこともできます。

### ClickHouse Release 1.1.54370, 2018-03-16 {#clickhouse-release-1-1-54370-2018-03-16}

#### 新機能: {#new-features-15}

- `system.macros` テーブルと、設定ファイルが変更された際のマクロの自動更新を追加しました。
- `SYSTEM RELOAD CONFIG` クエリを追加しました。
- 同時に交差する区間 `[left; right]` の最大数を返す集約関数 `maxIntersections(left_col, right_col)` を追加しました。`maxIntersectionsPosition(left, right)` 関数は「最大」区間の開始位置を返します。([Michael Furmur](https://github.com/ClickHouse/ClickHouse/pull/2012))。

#### 改善: {#improvements-14}

- `Replicated` テーブルへのデータ挿入時に、`ZooKeeper` へのリクエスト数が削減されました(また、ユーザーレベルのエラーのほとんどが `ZooKeeper` ログから消失しました)。
- データセットのエイリアスを作成する機能を追加しました。例: `WITH (1, 2, 3) AS set SELECT number IN set FROM system.numbers LIMIT 10`。

#### バグ修正: {#bug-fixes-26}

- `Distributed` テーブルのMergeテーブルからの読み取り時に発生していた `Illegal PREWHERE` エラーを修正しました。
- IPv4のみのDockerコンテナでclickhouse-serverを起動できるようにする修正を追加しました。
- システムテーブル `system.parts_columns` からの読み取り時の競合状態を修正しました。
- `Distributed` テーブルへの同期挿入時の二重バッファリングを削除しました。これにより接続タイムアウトが発生する可能性がありました。
- `SELECT` クエリの開始前に利用不可能なレプリカを過度に長く待機するバグを修正しました。
- `system.parts` テーブルの不正な日付を修正しました。
- `ZooKeeper` クラスタの設定で `chroot` が空でない場合に `Replicated` テーブルへのデータ挿入ができなくなるバグを修正しました。
- 空の `ORDER BY` テーブルに対する垂直マージアルゴリズムを修正しました。
- リモートテーブルへのクエリでディクショナリを使用する機能を復元しました。これは、リクエスト元サーバーにこれらのディクショナリが存在しない場合でも機能します。この機能はリリース1.1.54362で失われていました。
- `SELECT * FROM remote('server2', default.table) WHERE col IN (SELECT col2 FROM default.table)` のようなクエリの動作を復元しました。`IN` の右辺がローカルではなくリモートの `default.table` を使用すべき場合の動作です。この動作はバージョン1.1.54358で破損していました。
- `Not found column ... in block` の不要なエラーレベルのログ出力を削除しました。

### ClickHouse Release 1.1.54362, 2018-03-11 {#clickhouse-release-1-1-54362-2018-03-11}

#### 新機能: {#new-features-16}


* 空の集合に対する `GROUP BY` なしの集約（例: `SELECT count(*) FROM table WHERE 0`）は、SQL 標準に準拠して、集約関数に対して null 値を持つ 1 行の結果を返すようになりました。以前の動作（空の結果を返す）に戻すには、`empty_result_for_aggregation_by_empty_set` を 1 に設定します。
* `UNION ALL` に対する型変換を追加しました。SQL 標準に準拠し、`UNION ALL` における `SELECT` 句では異なるエイリアス名を使用できるようになりました。
* `LIMIT BY` 句で任意の式がサポートされるようになりました。以前は、`SELECT` で得られたカラムのみを使用できました。
* `MergeTree` テーブルのインデックスは、主キーを構成するカラムの式タプルに対して `IN` が適用される場合に使用されます。例: `WHERE (UserID, EventDate) IN ((123, '2000-01-01'), ...)` (Anastasiya Tsarkova)。
* クラスター間コピーおよびデータの再シャーディング用のツールとして `clickhouse-copier` を追加しました（ベータ版）。
* 一貫ハッシュ関数 `yandexConsistentHash`、`jumpConsistentHash`、`sumburConsistentHash` を追加しました。これらは後続のリシャーディング時のネットワークトラフィック量を削減するためのシャーディングキーとして使用できます。
* 追加された関数: `arrayAny`, `arrayAll`, `hasAny`, `hasAll`, `arrayIntersect`, `arrayResize`.
* `arrayCumSum` 関数を追加しました（Javi Santana）。
* `parseDateTimeBestEffort`、`parseDateTimeBestEffortOrZero`、`parseDateTimeBestEffortOrNull` 関数を追加し、さまざまな形式のテキストを含む文字列から DateTime を読み取れるようにしました。
* 更新時に外部ディクショナリからデータを部分的に再ロードできるようになりました（指定したフィールドの値が前回のロード時より大きいレコードだけを読み込む）（Arsen Hakobyan）。
* `cluster` テーブル関数を追加しました。例: `cluster(cluster_name, db, table)`。`remote` テーブル関数は、クラスタ名が識別子として指定されている場合、最初の引数としてそれを受け取ることができます。
* `remote` および `cluster` テーブル関数は、`INSERT` クエリで使用できます。
* `system.tables` テーブルに `create_table_query` および `engine_full` の仮想列を追加しました。`metadata_modification_time` 列も仮想列です。
* `system.tables` および `system.databases` テーブルに `data_path` 列と `metadata_path` 列を追加し、さらに `system.parts` および `system.parts_columns` テーブルに `path` 列を追加しました。
* `system.part_log` テーブルのマージに関する追加情報を追記しました。
* `system.query_log` テーブルで任意のパーティションキーを使用できるようになりました（Kirill Shvakov）。
* `SHOW TABLES` クエリで一時テーブルも表示されるようになりました。`system.tables` に一時テーブルと `is_temporary` 列を追加しました (zhang2014)。
* `DROP TEMPORARY TABLE` および `EXISTS TEMPORARY TABLE` クエリを追加しました（zhang2014）。
* 一時テーブル向けの `SHOW CREATE TABLE` サポート (zhang2014)。
* 内部プロセスで使用される設定用に、`system_profile` 構成パラメータを追加しました。
* `MongoDB` ディクショナリで `object_id` を属性としてロードする機能のサポート (Pavel Litvinenko)。
* `MongoDB` ソースを使用する外部ディクショナリにデータをロードする際に、デフォルト値として `null` を読み取れるようにする機能（Pavel Litvinenko）。
* シングルクォートなしの Unix タイムスタンプから、`Values` フォーマットで `DateTime` 値を読み込む。
* `remote` テーブル関数では、要求されたテーブルが一部のレプリカに存在しない場合でもフェイルオーバーがサポートされます。
* `clickhouse-server` を実行するときに、コマンドラインから設定を上書きできます。例：`clickhouse-server -- --logger.level=information`。
* `FixedString` 引数に対する `empty` 関数を実装しました。この関数は、文字列がすべてヌルバイトだけで構成されている場合に 1 を返します (zhang2014)。
* いくつかのアドレスで待ち受けできない場合でもプロセスを終了せずに、少なくとも1つの listen アドレスで待ち受けを行うための `listen_try` 設定パラメータを追加しました（IPv4 または IPv6 のサポートが無効化されているシステムで有用です）。
* `VersionedCollapsingMergeTree` テーブルエンジンを追加しました。
* `library` 辞書ソースで、行および任意の数値型をサポート。
* `MergeTree` テーブルは、主キーなしでも使用できます（`ORDER BY tuple()` を指定する必要があります）。
* 引数が `NULL` でない場合、`Nullable` 型は非 `Nullable` 型へ `CAST` できます。
* `RENAME TABLE` は `VIEW` に対しても実行できます。
* `throwIf` 関数を追加。
* ODBC ソースから読み込まれる値の最大サイズを拡張できる `odbc_default_field_size` オプションを追加しました（既定値は 1024）。
* `system.processes` テーブルと `SHOW PROCESSLIST` に、`is_cancelled` 列と `peak_memory_usage` 列が追加されました。

#### 改善点: {#improvements-15}

- `INSERT SELECT`クエリや`SELECT`サブクエリの中間データに対して、結果の制限とクォータが適用されなくなりました。
- サーバー起動時に`Replicated`テーブルのステータスをチェックする際の`force_restore_data`の誤検知が減少しました。
- `allow_distributed_ddl`オプションが追加されました。
- `MergeTree`テーブルキーの式において、非決定的関数が許可されなくなりました。
- `config.d`ディレクトリからの置換を含むファイルがアルファベット順に読み込まれるようになりました。
- 要素の1つとして空の配列を含む定数多次元配列の場合における`arrayElement`関数のパフォーマンスが向上しました。例:`[[1], []][x]`。
- 非常に大きな置換(例えば、非常に大きなIPネットワークのリスト)を含む設定ファイルを使用する場合のサーバー起動が高速化されました。
- クエリ実行時に、テーブル値関数が1回だけ実行されるようになりました。以前は、`remote`および`mysql`テーブル値関数がリモートサーバーからテーブル構造を取得するために同じクエリを2回実行していました。
- `MkDocs`ドキュメントジェネレーターが使用されるようになりました。
- 他のカラムの`DEFAULT`/`MATERIALIZED`式が依存しているテーブルカラムを削除しようとすると、例外がスローされるようになりました(zhang2014)。
- テキスト形式において、`Float`データ型の空行を数値0として解析する機能が追加されました。この機能は以前利用可能でしたが、リリース1.1.54342で失われていました。
- `Enum`値が`min`、`max`、`sum`およびその他の一部の関数で使用できるようになりました。これらの場合、対応する数値が使用されます。この機能は以前利用可能でしたが、リリース1.1.54337で失われていました。
- エイリアスを再帰的に展開した後のASTのサイズを制限するために`max_expanded_ast_elements`が追加されました。

#### バグ修正: {#bug-fixes-27}

- サブクエリから不要なカラムが誤って削除される、または`UNION ALL`を含むサブクエリから削除されないケースを修正しました。
- `ReplacingMergeTree`テーブルのマージにおけるバグを修正しました。
- `Distributed`テーブルにおける同期挿入(`insert_distributed_sync = 1`)を修正しました。
- サブクエリ内の重複カラムを伴う`FULL`および`RIGHT JOIN`の特定の使用におけるセグメンテーション違反を修正しました。
- `replace_running_query`および`KILL QUERY`の特定の使用におけるセグメンテーション違反を修正しました。
- `system.dictionaries`テーブルにおける`source`および`last_exception`カラムの順序を修正しました。
- `DROP DATABASE`クエリがメタデータを含むファイルを削除しないバグを修正しました。
- `Dictionary`データベースに対する`DROP DATABASE`クエリを修正しました。
- 1億件を超えるカーディナリティに対する`uniqHLL12`および`uniqCombined`関数の精度の低さを修正しました(Alex Bocharov)。
- `INSERT`クエリにおいて明示的なデフォルト式を同時に計算する必要がある場合の暗黙的なデフォルト値の計算を修正しました(zhang2014)。
- `MergeTree`テーブルへのクエリが完了しない稀なケースを修正しました(chenxing-xc)。
- すべてのシャードがローカルである場合に`Distributed`テーブルに対して`CHECK`クエリを実行した際に発生するクラッシュを修正しました(chenxing.xc)。
- 正規表現を使用する関数における軽微なパフォーマンス低下を修正しました。
- 複雑な式から多次元配列を作成する際のパフォーマンス低下を修正しました。
- メタデータを含む`.sql`ファイルに余分な`FORMAT`セクションが表示される可能性があるバグを修正しました。
- 明示的に指定されたテーブルを参照する`MATERIALIZED VIEW`を削除しようとする際に`max_table_size_to_drop`制限が適用されるバグを修正しました。
- 古いクライアントとの非互換性を修正しました(古いクライアントは、理解できない`DateTime('timezone')`型のデータを送信されることがありました)。
- `ALTER`を使用して追加されたが古いパーティションでは空である構造の`Nested`カラム要素を読み取る際に、これらのカラムの条件が`PREWHERE`に移動した場合のバグを修正しました。
- `Merge`テーブルへのクエリにおいて仮想`_table`カラムでテーブルをフィルタリングする際のバグを修正しました。
- `Distributed`テーブルで`ALIAS`カラムを使用する際のバグを修正しました。
- `quantile`ファミリーの集約関数を含むクエリに対する動的コンパイルを不可能にするバグを修正しました。
- 多数のテーブルを持つ`Merge`テーブルを使用する場合、および`GLOBAL`サブクエリを使用する場合に非常に稀に発生するクエリ実行パイプラインにおける競合状態を修正しました。
- 複数の引数からの集約関数を使用する際に、異なるサイズの配列を`arrayReduce`関数に渡した場合のクラッシュを修正しました。
- `MATERIALIZED VIEW`における`UNION ALL`を含むクエリの使用を禁止しました。
- サーバー起動時の`part_log`システムテーブルの初期化中のエラーを修正しました(デフォルトでは、`part_log`は無効です)。

#### 後方互換性のない変更: {#backward-incompatible-changes-10}


- `distributed_ddl_allow_replicated_alter`オプションを削除しました。この動作はデフォルトで有効になっています。
- `strict_insert_defaults`設定を削除しました。この機能を使用していた場合は、`feedback@clickhouse.com`までご連絡ください。
- `UnsortedMergeTree`エンジンを削除しました。

### ClickHouse Release 1.1.54343, 2018-02-05 {#clickhouse-release-1-1-54343-2018-02-05}

- 分散DDLクエリおよびDistributedテーブルのコンストラクタでクラスタ名を定義するためのマクロサポートを追加しました：`CREATE TABLE distr ON CLUSTER '{cluster}' (...) ENGINE = Distributed('{cluster}', 'db', 'table')`。
- `SELECT ... FROM table WHERE expr IN (subquery)`のようなクエリが`table`インデックスを使用して処理されるようになりました。
- Replicatedテーブルへの挿入時の重複処理を改善し、レプリケーションキューの実行が遅延しなくなりました。

### ClickHouse Release 1.1.54342, 2018-01-22 {#clickhouse-release-1-1-54342-2018-01-22}

このリリースには、前回のリリース1.1.54337のバグ修正が含まれています：

- 1.1.54337のリグレッションを修正：デフォルトユーザーが読み取り専用アクセス権を持つ場合、サーバーが`Cannot create database in readonly mode`というメッセージで起動を拒否する問題を修正しました。
- 1.1.54337のリグレッションを修正：systemdを使用するシステムでは、設定に関係なくログが常にsyslogに書き込まれる問題を修正しました。watchdogスクリプトは引き続きinit.dを使用します。
- 1.1.54337のリグレッションを修正：Dockerイメージのデフォルト設定が誤っていた問題を修正しました。
- GraphiteMergeTreeの非決定的な動作を修正しました（ログメッセージ`Data after merge is not byte-identical to the data on another replicas`で確認できます）。
- ReplicatedテーブルへのOPTIMIZEクエリ後に一貫性のないマージが発生する可能性があるバグを修正しました（ログメッセージ`Part ... intersects the previous part`で確認できます）。
- 宛先テーブルにMATERIALIZEDカラムが存在する場合にBufferテーブルが正しく動作するようになりました（zhang2014による）。
- NULLの実装におけるバグを修正しました。

### ClickHouse Release 1.1.54337, 2018-01-18 {#clickhouse-release-1-1-54337-2018-01-18}

#### 新機能： {#new-features-17}


- テーブルにおける多次元配列とタプル（`Tuple`データ型）の格納をサポートしました。
- `DESCRIBE`および`INSERT`クエリでのテーブル関数をサポートしました。`DESCRIBE`でのサブクエリのサポートを追加しました。例：`DESC TABLE remote('host', default.hits)`; `DESC TABLE (SELECT 1)`; `INSERT INTO TABLE FUNCTION remote('host', default.hits)`。`INSERT INTO`に加えて`INSERT INTO TABLE`をサポートしました。
- タイムゾーンのサポートを改善しました。`DateTime`データ型には、テキスト形式での解析とフォーマットに使用されるタイムゾーンを注釈として付けることができます。例：`DateTime('Asia/Istanbul')`。`DateTime`引数を持つ関数でタイムゾーンが指定されている場合、戻り値の型はタイムゾーンを追跡し、値は期待通りに表示されます。
- `toTimeZone`、`timeDiff`、`toQuarter`、`toRelativeQuarterNum`関数を追加しました。`toRelativeHour`/`Minute`/`Second`関数は、`Date`型の値を引数として受け取ることができます。`now`関数名は大文字小文字を区別します。
- `toStartOfFifteenMinutes`関数を追加しました（Kirill Shvakov）。
- クエリをフォーマットするための`clickhouse format`ツールを追加しました。
- `format_schema_path`設定パラメータを追加しました（Marek Vavruşa）。これは`Cap'n Proto`形式のスキーマを指定するために使用されます。スキーマファイルは指定されたディレクトリ内にのみ配置できます。
- 外部ディクショナリとモデルの設定における設定置換（`incl`および`conf.d`）のサポートを追加しました（Pavel Yakunin）。
- `system.settings`テーブルにドキュメント用のカラムを追加しました（Kirill Shvakov）。
- `MergeTree`テーブルの各データパートにおけるカラムサイズに関する情報を含む`system.parts_columns`テーブルを追加しました。
- ロードされた`CatBoost`機械学習モデルに関する情報を含む`system.models`テーブルを追加しました。
- リモートデータベースにアクセスするための`mysql`および`odbc`テーブル関数と、対応する`MySQL`および`ODBC`テーブルエンジンを追加しました。この機能はベータ段階です。
- `groupArray`集約関数に`AggregateFunction`型の引数を渡す機能を追加しました（これにより、ある集約関数の状態の配列を作成できます）。
- 集約関数コンビネータのさまざまな組み合わせに関する制限を削除しました。例えば、異なる動作を持つ`avgForEachIf`および`avgIfForEach`集約関数を使用できます。
- `-ForEach`集約関数コンビネータを、複数の引数を持つ集約関数の場合に拡張しました。
- 関数が非`Nullable`の結果を返す場合でも、`Nullable`引数の集約関数のサポートを追加しました（Silviu Carageaの貢献により追加）。例：`groupArray`、`groupUniqArray`、`topK`。
- `clickhouse-client`に`max_client_network_bandwidth`を追加しました（Kirill Shvakov）。
- `readonly = 2`設定を持つユーザーは、TEMPORARYテーブルでの作業（CREATE、DROP、INSERT...）が許可されます（Kirill Shvakov）。
- `Kafka`エンジンで複数のコンシューマーを使用するサポートを追加しました。`Kafka`の設定オプションを拡張しました（Marek Vavruša）。
- `intExp3`および`intExp4`関数を追加しました。
- `sumKahan`集約関数を追加しました。
- to \* Number\* OrNull関数を追加しました。ここで\* Number\*は数値型です。
- `INSERT SELECT`クエリでの`WITH`句のサポートを追加しました（作成者：zhang2014）。
- 設定を追加しました：`http_connection_timeout`、`http_send_timeout`、`http_receive_timeout`。特に、これらの設定はレプリケーション用のデータパートのダウンロードに使用されます。これらの設定を変更することで、ネットワークが過負荷の場合により高速なフェイルオーバーが可能になります。
- `Null`型のテーブルに対する`ALTER`のサポートを追加しました（Anastasiya Tsarkova）。
- `reinterpretAsString`関数を、メモリ内に連続して格納されるすべてのデータ型に拡張しました。
- `clickhouse-local`ツールに`--silent`オプションを追加しました。これにより、stderrへのクエリ実行情報の出力が抑制されます。
- 月および/または日が2桁ではなく1桁で指定されている形式のテキストから`Date`型の値を読み取るサポートを追加しました（Amos Bird）。

#### パフォーマンスの最適化: {#performance-optimizations}


- 文字列引数を使用する集約関数 `min`、`max`、`any`、`anyLast`、`anyHeavy`、`argMin`、`argMax` のパフォーマンスが向上しました。
- 関数 `isInfinite`、`isFinite`、`isNaN`、`roundToExp2` のパフォーマンスが向上しました。
- テキスト形式における `Date` および `DateTime` 型の値の解析とフォーマットのパフォーマンスが向上しました。
- 浮動小数点数の解析のパフォーマンスと精度が向上しました。
- 左側と右側の部分が `USING` に含まれない同一名のカラムを持つ場合の `JOIN` のメモリ使用量が削減されました。
- 計算の安定性を犠牲にすることで、集約関数 `varSamp`、`varPop`、`stddevSamp`、`stddevPop`、`covarSamp`、`covarPop`、`corr` のパフォーマンスが向上しました。従来の関数は `varSampStable`、`varPopStable`、`stddevSampStable`、`stddevPopStable`、`covarSampStable`、`covarPopStable`、`corrStable` という名前で利用可能です。

#### バグ修正: {#bug-fixes-28}


- `DROP`または`DETACH PARTITION`クエリ実行後のデータ重複排除を修正しました。以前のバージョンでは、パーティションを削除して同じデータを再度挿入すると、挿入されたブロックが重複とみなされるため正常に動作しませんでした。
- `POPULATE`を使用した`CREATE MATERIALIZED VIEW`クエリの`WHERE`句が誤って解釈される可能性があるバグを修正しました。
- `zookeeper_servers`設定における`root_path`パラメータの使用に関するバグを修正しました。
- `toStartOfDay`に`Date`引数を渡した際の予期しない結果を修正しました。
- 結果が前年になる場合の`addMonths`および`subtractMonths`関数と`INTERVAL n MONTH`の演算を修正しました。
- `DISTINCT`、`JOIN`、`uniq`集約関数および外部ディクショナリに対する`UUID`データ型のサポートを追加しました（Evgeniy Ivanov）。`UUID`のサポートはまだ不完全です。
- 行の合計がゼロになる場合の`SummingMergeTree`の動作を修正しました。
- `Kafka`エンジンに対する各種修正（Marek Vavruša）。
- `Join`テーブルエンジンの誤った動作を修正しました（Amos Bird）。
- FreeBSDおよびOS Xにおけるアロケータの誤った動作を修正しました。
- `extractAll`関数が空のマッチをサポートするようになりました。
- `openssl`の代わりに`libressl`を使用することを妨げていたエラーを修正しました。
- 一時テーブルからの`CREATE TABLE AS SELECT`クエリを修正しました。
- レプリケーションキューの更新における非アトミック性を修正しました。これにより、サーバーが再起動するまでレプリカが同期しなくなる可能性がありました。
- `gcd`、`lcm`、`modulo`（`%`演算子）における可能性のあるオーバーフローを修正しました（Maks Skorokhod）。
- `-preprocessed`ファイルが`umask`の変更後に作成されるようになりました（`umask`は設定で変更可能です）。
- カスタムパーティションキーを使用する際のパーツのバックグラウンドチェック（`MergeTreePartChecker`）におけるバグを修正しました。
- テキスト形式におけるタプル（`Tuple`データ型の値）の解析を修正しました。
- `multiIf`、`array`およびその他の一部の関数に渡された互換性のない型に関するエラーメッセージを改善しました。
- `Nullable`型のサポートを再設計しました。サーバークラッシュにつながる可能性のあるバグを修正しました。`NULL`サポートに関連するほぼすべてのバグを修正しました：INSERT SELECTにおける誤った型変換、HAVINGおよびPREWHEREにおけるNullableの不十分なサポート、`join_use_nulls`モード、`OR`演算子の引数としてのNullable型など。
- データ型の内部セマンティクスに関連する各種バグを修正しました。例：`SummingMergeTree`における`Enum`型フィールドの不要な合計、`Pretty`形式における`Enum`型の配置など。
- 複合カラムの許可される組み合わせに対するより厳格なチェックを実施しました。
- `FixedString`データ型に非常に大きなパラメータを指定した際のオーバーフローを修正しました。
- 一般的なケースにおける`topK`集約関数のバグを修正しました。
- `-Array`コンビネータを持つ集約関数のn項バリアントの引数における配列サイズの等価性チェックを追加しました。
- `clickhouse-client`の`--pager`におけるバグを修正しました（作成者：ks1322）。
- `exp10`関数の精度を修正しました。
- ドキュメントへのより良い準拠のために`visitParamExtract`関数の動作を修正しました。
- 誤ったデータ型が指定された際のクラッシュを修正しました。
- すべてのカラムが定数である場合の`DISTINCT`の動作を修正しました。
- タプル要素インデックスとして複雑な定数式を使用した`tupleElement`関数を使用する場合のクエリフォーマットを修正しました。
- `range_hashed`ディクショナリの`Dictionary`テーブルにおけるバグを修正しました。
- `FULL`および`RIGHT JOIN`の結果に過剰な行が生じるバグを修正しました（Amos Bird）。
- 設定の再読み込み中に`config.d`ディレクトリ内の一時ファイルを作成および削除する際のサーバークラッシュを修正しました。
- `SYSTEM DROP DNS CACHE`クエリを修正しました：キャッシュはフラッシュされましたが、クラスタノードのアドレスが更新されませんでした。
- ビュー配下のテーブルに対して`DETACH TABLE`を実行した後の`MATERIALIZED VIEW`の動作を修正しました（Marek Vavruša）。

#### ビルドの改善: {#build-improvements-4}


- ビルドには `pbuilder` ツールを使用します。ビルドプロセスはビルドホスト環境からほぼ完全に独立しています。
- 単一のビルドを異なるOSバージョンで使用します。パッケージとバイナリは幅広いLinuxシステムと互換性を持つように作成されています。
- `clickhouse-test` パッケージを追加しました。機能テストの実行に使用できます。
- ソースtarballをリポジトリに公開できるようになりました。GitHubを使用せずにビルドを再現するために使用できます。
- Travis CIとの限定的な統合を追加しました。Travisのビルド時間制限により、デバッグビルドのみがテストされ、限定されたテストのサブセットが実行されます。
- デフォルトビルドに `Cap'n'Proto` のサポートを追加しました。
- ドキュメントソースの形式を `Restricted Text` から `Markdown` に変更しました。
- `systemd` のサポートを追加しました(Vladimir Smirnov)。一部のOSイメージとの非互換性のためデフォルトでは無効になっており、手動で有効化できます。
- 動的コード生成のため、`clang` と `lld` を `clickhouse` バイナリに組み込みました。これらは `clickhouse clang` および `clickhouse lld` として呼び出すこともできます。
- コードからGNU拡張の使用を削除しました。`-Wextra` オプションを有効化しました。`clang` でビルドする場合、デフォルトは `libstdc++` ではなく `libc++` になります。
- 各種ツールのビルドを高速化するため、`clickhouse_parsers` および `clickhouse_common_io` ライブラリを抽出しました。

#### 後方互換性のない変更: {#backward-incompatible-changes-11}

- `Nullable` カラムを含む `Log` 型テーブルのマーク形式が後方互換性のない方法で変更されました。これらのテーブルをお持ちの場合は、新しいサーバーバージョンを起動する前に `TinyLog` 型に変換する必要があります。これを行うには、`metadata` ディレクトリ内の対応する `.sql` ファイルで `ENGINE = Log` を `ENGINE = TinyLog` に置き換えてください。テーブルに `Nullable` カラムがない場合、またはテーブルの型が `Log` でない場合は、何もする必要はありません。
- `experimental_allow_extended_storage_definition_syntax` 設定を削除しました。この機能は現在デフォルトで有効になっています。
- 混乱を避けるため、`runningIncome` 関数を `runningDifferenceStartingWithFirstvalue` に名称変更しました。
- テーブルなしでFROMの直後にARRAY JOINが指定される場合の `FROM ARRAY JOIN arr` 構文を削除しました(Amos Bird)。
- デモンストレーション目的のみで使用されていた `BlockTabSeparated` 形式を削除しました。
- 集約関数 `varSamp`、`varPop`、`stddevSamp`、`stddevPop`、`covarSamp`、`covarPop`、`corr` の状態形式を変更しました。これらの集約関数の状態をテーブルに保存している場合(`AggregateFunction` データ型または対応する状態を持つマテリアライズドビューを使用)、feedback@clickhouse.com までご連絡ください。
- 以前のサーバーバージョンには文書化されていない機能がありました:集約関数がパラメータに依存する場合でも、AggregateFunction データ型でパラメータなしで指定できました。例: `AggregateFunction(quantiles(0.5, 0.9), UInt64)` の代わりに `AggregateFunction(quantiles, UInt64)`。この機能は失われました。文書化されていませんでしたが、将来のリリースで再びサポートする予定です。
- Enumデータ型はmin/max集約関数で使用できません。この機能は次のリリースで復元される予定です。

#### アップグレード時の注意事項: {#please-note-when-upgrading}

- クラスタでローリングアップデートを実行する際、一部のレプリカが旧バージョンのClickHouseを実行し、一部が新バージョンを実行している時点で、レプリケーションが一時的に停止し、ログに `unknown parameter 'shard'` というメッセージが表示されます。クラスタのすべてのレプリカが更新された後、レプリケーションは継続されます。
- クラスタサーバーで異なるバージョンのClickHouseが実行されている場合、次の関数を使用する分散クエリが不正な結果を返す可能性があります: `varSamp`、`varPop`、`stddevSamp`、`stddevPop`、`covarSamp`、`covarPop`、`corr`。すべてのクラスタノードを更新する必要があります。


## [2017年の変更履歴](./2017.md) {#changelog-for-2017}
