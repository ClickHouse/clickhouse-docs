---
slug: /clickhouse-operator/install/kubectl
title: 'kubectl を使用して ClickHouse Operator をインストールする'
keywords: ['kubernetes']
description: 'このガイドでは、kubectl とマニフェストファイルを使用して ClickHouse Operator をインストールする手順について説明します。'
doc_type: 'guide'
sidebar_label: 'kubectl'
---

このガイドでは、kubectl とマニフェストファイルを使用して ClickHouse Operator をインストールする手順について説明します。

## 前提条件 \{#prerequisites\}

- v1.33.0 以降の Kubernetes クラスター
- v1.33.0 以降の kubectl
- クラスター管理者権限

## リリースマニフェストからインストール \{#install-from-release-manifests\}

:::note
webhook 用証明書を発行するために cert-manager が必要です。
:::

最新リリースからオペレーターと CRD をインストールします。

```bash
kubectl apply -f https://github.com/ClickHouse/clickhouse-operator/releases/latest/download/clickhouse-operator.yaml
```

これにより、次の処理が実行されます。

1. `clickhouse-operator-system` ネームスペースを作成する
2. ClickHouseCluster と KeeperCluster 用の CustomResourceDefinition (CRD) をインストールする
3. 必要な ServiceAccount、Role、RoleBinding を作成する
4. オペレーターのコントローラー マネージャーをデプロイする
5. リソース検証およびデフォルト値設定用の Webhook を登録する
6. cert-manager を使用して SSL 証明書を設定する
7. メトリクス エンドポイントを有効にする


## インストールを検証する \{#verify-installation\}

オペレータが稼働していることを確認します：

```bash
kubectl get pods -n clickhouse-operator-system
```

想定される出力:

```
NAME                                                 READY   STATUS    RESTARTS   AGE
clickhouse-operator-controller-manager-xxxxxxxxxx    1/1     Running   0          1m
```

CRD がインストールされていることを確認してください：

```bash
kubectl get crd | grep clickhouse.com
```

想定される出力:

```
clickhouseclusters.clickhouse.com    2025-01-06T00:00:00Z
keeperclusters.clickhouse.com        2025-01-06T00:00:00Z
```


## カスタムデプロイメントオプションの設定 \{#configure-custom-deployment-options\}

オペレーターのデプロイメントオプションをカスタマイズする場合は、以下の手順に従ってください。

### 1. リポジトリをクローンする \{#clone-the-repository\}

```bash
git clone https://github.com/ClickHouse/clickhouse-operator.git
cd clickhouse-operator
```


### 2. インストールオプションを設定する \{#configure-installation-options\}

必要に応じて機能を有効化/無効化するには、config/default/kustomization.yaml を編集します。

* Webhook を無効化するには、`[WEBHOOK]` と `[CERTMANAGER]` セクションをコメントアウトします。
* セキュアな metrics エンドポイントを有効化するには、`[METRICS]` セクションをコメントアウトし、`[METRICS SECURE]` と `[CERTMANAGER]` セクションのコメントを解除します。
* Prometheus Operator 向けの ServiceMonitor を有効化するには、`[PROMETHEUS]` セクションのコメントを解除します。
* オペレーターの NetworkPolicy を有効化するには、`[NETWORK POLICY]` セクションのコメントを解除します。

### 3. ビルドとデプロイ \{#build-and-deploy\}

オペレーターのマニフェストをビルドして適用します。

```bash
make build-installer VERSION=<required operator version> [IMG=<custom registry path>]
kubectl apply -k dist/install.yaml
```
