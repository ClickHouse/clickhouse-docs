---
description: 'ClickHouse におけるサードパーティコンポーネントの利用状況と、サードパーティ製ライブラリの追加および保守方法について説明するページ。'
sidebar_label: 'サードパーティ製ライブラリ'
sidebar_position: 60
slug: /development/contrib
title: 'サードパーティ製ライブラリ'
doc_type: 'reference'
---



# サードパーティライブラリ

ClickHouse はさまざまな目的でサードパーティライブラリを利用します。例えば、他のデータベースへの接続、ディスクへの読み込み／保存時のデータのデコード／エンコード、特殊な SQL 関数の実装などです。
ターゲットシステムで利用可能なライブラリに依存しないようにするため、各サードパーティライブラリは Git サブモジュールとして ClickHouse のソースツリーに取り込まれ、ClickHouse とともにコンパイルおよびリンクされます。
サードパーティライブラリとそのライセンスの一覧は、次のクエリで取得できます。

```sql
SELECT library_name, license_type, license_path FROM system.licenses ORDER BY library_name COLLATE 'en';
```

ここに一覧表示されているライブラリは、ClickHouse リポジトリの `contrib/` ディレクトリにあるものだけである点に注意してください。
ビルドオプションによっては、一部のライブラリがコンパイルされておらず、その結果、実行時にその機能が利用できない場合があります。

[例](https://sql.clickhouse.com?query_id=478GCPU7LRTSZJBNY3EJT3)


## サードパーティライブラリの追加と保守 {#adding-and-maintaining-third-party-libraries}

各サードパーティライブラリは、ClickHouseリポジトリの`contrib/`ディレクトリ配下の専用ディレクトリに配置する必要があります。
外部コードのコピーをライブラリディレクトリに直接配置することは避けてください。
代わりに、外部のアップストリームリポジトリからサードパーティコードを取得するためのGitサブモジュールを作成してください。

ClickHouseで使用されるすべてのサブモジュールは、`.gitmodule`ファイルに記載されています。

- ライブラリをそのまま使用できる場合(デフォルトのケース)は、アップストリームリポジトリを直接参照できます。
- ライブラリにパッチが必要な場合は、[GitHub上のClickHouse組織](https://github.com/ClickHouse)でアップストリームリポジトリのフォークを作成してください。

後者の場合、カスタムパッチをアップストリームのコミットから可能な限り分離することを目指します。
そのために、統合したいブランチまたはタグから`ClickHouse/`プレフィックスを持つブランチを作成してください。例えば、`ClickHouse/2024_2`(ブランチ`2024_2`の場合)や`ClickHouse/release/vX.Y.Z`(タグ`release/vX.Y.Z`の場合)などです。
アップストリームの開発ブランチ`master`/`main`/`dev`を追跡することは避けてください(つまり、フォークリポジトリ内の`ClickHouse/master`/`ClickHouse/main`/`ClickHouse/dev`というプレフィックスブランチ)。
このようなブランチは変動するターゲットであり、適切なバージョン管理を困難にします。
「プレフィックスブランチ」により、アップストリームリポジトリからフォークへのプルが、カスタムの`ClickHouse/`ブランチに影響を与えないことが保証されます。
`contrib/`内のサブモジュールは、フォークされたサードパーティリポジトリの`ClickHouse/`ブランチのみを追跡する必要があります。

パッチは、外部ライブラリの`ClickHouse/`ブランチに対してのみ適用されます。

これを行うには2つの方法があります:

- フォークリポジトリ内の`ClickHouse/`プレフィックスブランチに対して新しい修正を行う場合(例:サニタイザーの修正)。この場合、修正を`ClickHouse/`プレフィックスを持つブランチとしてプッシュします(例:`ClickHouse/fix-sanitizer-disaster`)。次に、新しいブランチからカスタム追跡ブランチに対してPRを作成し(例:`ClickHouse/2024_2 <-- ClickHouse/fix-sanitizer-disaster`)、PRをマージします。
- サブモジュールを更新し、以前のパッチを再適用する必要がある場合。この場合、古いPRを再作成するのは過剰です。代わりに、古いコミットを新しい`ClickHouse/`ブランチ(新しいバージョンに対応)に単純にチェリーピックしてください。複数のコミットを持つPRのコミットはスカッシュしても構いません。最良の場合、カスタムパッチをアップストリームに貢献しており、新しいバージョンではパッチを省略できます。

サブモジュールが更新されたら、ClickHouse内のサブモジュールをフォーク内の新しいハッシュを指すように更新してください。

サードパーティライブラリのパッチは、公式リポジトリを念頭に置いて作成し、パッチをアップストリームリポジトリに貢献することを検討してください。
これにより、他のユーザーもパッチの恩恵を受けることができ、ClickHouseチームにとって保守の負担にならないことが保証されます。
