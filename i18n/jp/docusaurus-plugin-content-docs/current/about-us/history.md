---
slug: /about-us/history
sidebar_label: 'ClickHouse の歴史'
sidebar_position: 40
description: 'ClickHouse 開発の歩み'
keywords: ['history','development','Metrica']
title: 'ClickHouse の歴史'
doc_type: 'reference'
---



# ClickHouseの歴史 {#clickhouse-history}

ClickHouseは当初、[世界第2位のウェブ解析プラットフォーム](http://w3techs.com/technologies/overview/traffic_analysis/all)である[Yandex.Metrica](https://metrica.yandex.com/)を支えるために開発され、現在もそのコアコンポーネントであり続けています。データベースに13兆件を超えるレコードと1日あたり200億件を超えるイベントを抱える中、ClickHouseは集約前のデータから直接、カスタムレポートをオンザフライで生成することを可能にしています。本記事では、ClickHouseの開発初期段階における目標について簡潔に説明します。

Yandex.Metricaは、ユーザーが定義した任意のセグメントを用いて、ヒットとセッションに基づいたカスタマイズレポートをオンザフライで構築します。これを実現するには、ユニークユーザー数などの複雑な集計を構築する必要があり、レポート構築のための新しいデータはリアルタイムで到着します。

2014年4月時点で、Yandex.Metricaは1日あたり約120億件のイベント(ページビューとクリック)を追跡していました。カスタムレポートを構築するために、これらすべてのイベントを保存する必要がありました。単一のクエリで、数百ミリ秒以内に数百万行をスキャンするか、わずか数秒で数億行をスキャンする必要がある場合もありました。


## Yandex.Metricaおよびその他のYandexサービスでの使用 {#usage-in-yandex-metrica-and-other-yandex-services}

ClickHouseはYandex.Metricaにおいて複数の用途で使用されています。
主な役割は、非集計データを使用してオンラインモードでレポートを構築することです。374台のサーバーで構成されるクラスタを使用しており、データベースには20.3兆行を超えるデータが格納されています。圧縮データの容量は約2 PBで、これは重複とレプリカを除いた値です。非圧縮データ(TSV形式)の容量は約17 PBになります。

ClickHouseは以下のプロセスにおいても重要な役割を果たしています:

- Yandex.MetricaのSession Replay用データの保存
- 中間データの処理
- Analyticsを使用したグローバルレポートの構築
- Yandex.Metricaエンジンのデバッグ用クエリの実行
- APIおよびユーザーインターフェースからのログの分析

現在、Yandexの他のサービスや部門には数十のClickHouseインストールが存在しています。検索バーティカル、eコマース、広告、ビジネス分析、モバイル開発、パーソナルサービスなどが含まれます。


## 集約データと非集約データ {#aggregated-and-non-aggregated-data}

統計を効率的に計算するには、データ量を削減するためにデータを集約する必要があるという考え方が広く浸透しています。

しかし、データ集約には多くの制約があります:

- 必要なレポートを事前に定義しておく必要があります。
- ユーザーはカスタムレポートを作成できません。
- 多数の異なるキーで集約する場合、データ量はほとんど削減されないため、集約の効果がありません。
- 多数のレポートに対しては、集約のバリエーションが多すぎます(組み合わせ爆発)。
- 高カーディナリティのキー(URLなど)を集約する場合、データ量はあまり削減されません(2倍未満)。
- このため、集約によってデータ量が縮小するどころか、増加する可能性があります。
- ユーザーは生成されたすべてのレポートを閲覧するわけではありません。それらの計算の大部分は無駄になります。
- さまざまな集約において、データの論理的整合性が損なわれる可能性があります。

何も集約せずに非集約データを扱う場合、計算量を削減できる可能性があります。

しかし、集約を使用する場合、作業の大部分はオフラインで実行され、比較的余裕を持って完了できます。対照的に、オンライン計算ではユーザーが結果を待っているため、可能な限り高速に計算する必要があります。

Yandex.Metricaには、Metrageと呼ばれるデータ集約用の専用システムがあり、大部分のレポートに使用されていました。
2009年以降、Yandex.Metricaは非集約データ用の専用OLAPデータベースであるOLAPServerも使用しており、これは以前レポートビルダーに使用されていました。
OLAPServerは非集約データに対して良好に機能しましたが、すべてのレポートに望ましい形で使用することを妨げる多くの制約がありました。これには、データ型のサポート不足(数値のみ)や、リアルタイムでデータを増分更新できないこと(日次でデータを書き換えることによってのみ可能)が含まれていました。OLAPServerはDBMSではなく、専用データベースです。

ClickHouseの当初の目標は、OLAPServerの制約を取り除き、すべてのレポートに対して非集約データを扱う問題を解決することでしたが、長年にわたり、幅広い分析タスクに適した汎用データベース管理システムへと成長しました。
