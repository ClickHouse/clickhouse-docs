---
description: "RecipeNLGデータセット、220万のレシピを含む"
slug: /getting-started/example-datasets/recipes
sidebar_label: レシピデータセット
title: "レシピデータセット"
---

RecipeNLGデータセットは、[ここ](https://recipenlg.cs.put.poznan.pl/dataset)からダウンロードできます。220万のレシピが含まれており、サイズは約1 GB未満です。
## データセットのダウンロードと解凍 {#download-and-unpack-the-dataset}

1. ダウンロードページに移動します [https://recipenlg.cs.put.poznan.pl/dataset](https://recipenlg.cs.put.poznan.pl/dataset)。
2. 利用規約に同意し、zipファイルをダウンロードします。
3. オプション: `md5sum dataset.zip`を使用してzipファイルを検証し、`3a168dfd0912bb034225619b3586ce76`と等しいことを確認します。
4. `unzip dataset.zip`を使ってzipファイルを解凍します。これにより、`dataset`ディレクトリ内に`full_dataset.csv`ファイルが生成されます。
## テーブルの作成 {#create-a-table}

clickhouse-clientを実行し、次のCREATEクエリを実行します:

``` sql
CREATE TABLE recipes
(
    title String,
    ingredients Array(String),
    directions Array(String),
    link String,
    source LowCardinality(String),
    NER Array(String)
) ENGINE = MergeTree ORDER BY title;
```
## データの挿入 {#insert-the-data}

次のコマンドを実行します:

``` bash
clickhouse-client --query "
    INSERT INTO recipes
    SELECT
        title,
        JSONExtract(ingredients, 'Array(String)'),
        JSONExtract(directions, 'Array(String)'),
        link,
        source,
        JSONExtract(NER, 'Array(String)')
    FROM input('num UInt32, title String, ingredients String, directions String, link String, source LowCardinality(String), NER String')
    FORMAT CSVWithNames
" --input_format_with_names_use_header 0 --format_csv_allow_single_quote 0 --input_format_allow_errors_num 10 < full_dataset.csv
```

これはカスタムCSVを解析する方法のショーケースであり、複数の調整が必要です。

説明:
- データセットはCSV形式ですが、挿入時にいくつかの前処理が必要です。テーブル関数 [input](../../sql-reference/table-functions/input.md) を使用して前処理を実行します。
- CSVファイルの構造はテーブル関数 `input` の引数で指定されます。
- `num`（行番号）のフィールドは不要です - 我々はファイルから解析し、無視します。
- `FORMAT CSVWithNames`を使用しますが、CSVのヘッダーは無視されます（コマンドラインパラメータ`--input_format_with_names_use_header 0`によって）、最初のフィールドの名前がヘッダーに含まれていないためです。
- ファイルはCSV文字列を囲むためにのみ二重引用符を使用しています; 一部の文字列は二重引用符で囲まれておらず、単一の引用符は文字列の囲みとして解析してはいけません - そのため、`--format_csv_allow_single_quote 0` パラメータも追加しています。
- CSVの一部の文字列は解析できません。なぜなら、それらは値の先頭に `\M/` シーケンスを含んでいるからです; CSVでバックスラッシュで始まる唯一の値は `\N` であり、これはSQL NULLとして解析されます。`--input_format_allow_errors_num 10` パラメータを追加し、最大10件の不正なレコードをスキップできるようにします。
- 材料、指示、NERフィールドに対して配列があります; これらの配列は不規則な形式で表現されています: JSONとして文字列にシリアル化され、CSVに置かれています - それらをStringとして解析し、その後 [JSONExtract](../../sql-reference/functions/json-functions.md) 関数を用いてArrayに変換します。
## 挿入されたデータの検証 {#validate-the-inserted-data}

行数を確認することで検証します:

クエリ:

``` sql
SELECT count() FROM recipes;
```

結果:

``` text
┌─count()─┐
│ 2231142 │
└─────────┘
```
## 例クエリ {#example-queries}
### レシピ数によるトップコンポーネント: {#top-components-by-the-number-of-recipes}

この例では、[arrayJoin](../../sql-reference/functions/array-join.md) 関数を使用して配列を行のセットに展開する方法を学びます。

クエリ:

``` sql
SELECT
    arrayJoin(NER) AS k,
    count() AS c
FROM recipes
GROUP BY k
ORDER BY c DESC
LIMIT 50
```

結果:

``` text
┌─k────────────────────┬──────c─┐
│ salt                 │ 890741 │
│ sugar                │ 620027 │
│ butter               │ 493823 │
│ flour                │ 466110 │
│ eggs                 │ 401276 │
│ onion                │ 372469 │
│ garlic               │ 358364 │
│ milk                 │ 346769 │
│ water                │ 326092 │
│ vanilla              │ 270381 │
│ olive oil            │ 197877 │
│ pepper               │ 179305 │
│ brown sugar          │ 174447 │
│ tomatoes             │ 163933 │
│ egg                  │ 160507 │
│ baking powder        │ 148277 │
│ lemon juice          │ 146414 │
│ Salt                 │ 122558 │
│ cinnamon             │ 117927 │
│ sour cream           │ 116682 │
│ cream cheese         │ 114423 │
│ margarine            │ 112742 │
│ celery               │ 112676 │
│ baking soda          │ 110690 │
│ parsley              │ 102151 │
│ chicken              │ 101505 │
│ onions               │  98903 │
│ vegetable oil        │  91395 │
│ oil                  │  85600 │
│ mayonnaise           │  84822 │
│ pecans               │  79741 │
│ nuts                 │  78471 │
│ potatoes             │  75820 │
│ carrots              │  75458 │
│ pineapple            │  74345 │
│ soy sauce            │  70355 │
│ black pepper         │  69064 │
│ thyme                │  68429 │
│ mustard              │  65948 │
│ chicken broth        │  65112 │
│ bacon                │  64956 │
│ honey                │  64626 │
│ oregano              │  64077 │
│ ground beef          │  64068 │
│ unsalted butter      │  63848 │
│ mushrooms            │  61465 │
│ Worcestershire sauce │  59328 │
│ cornstarch           │  58476 │
│ green pepper         │  58388 │
│ Cheddar cheese       │  58354 │
└──────────────────────┴────────┘

50行のセット。経過時間: 0.112秒。2.23百万行を処理、361.57 MB (19.99百万行/秒、3.24 GB/秒)。
```
### いちごを使った最も複雑なレシピ {#the-most-complex-recipes-with-strawberry}

``` sql
SELECT
    title,
    length(NER),
    length(directions)
FROM recipes
WHERE has(NER, 'strawberry')
ORDER BY length(directions) DESC
LIMIT 10
```

結果:

``` text
┌─title────────────────────────────────────────────────────────────┬─length(NER)─┬─length(directions)─┐
│ チョコレート・ストロベリー・オレンジ・ウエディングケーキ                      │          24 │                126 │
│ ストロベリークリームチーズクランブルタルト                           │          19 │                 47 │
│ シャルロットスタイルアイスクリーム                                     │          11 │                 45 │
│ 極悪に美味しい百万層チョコレートレイヤーケーキ、ストロベリー添え              │          31 │                 45 │
│ エルダーフラワーシャーベット添えの甘いベリー                            │          24 │                 44 │
│ チョコレート・ストロベリー・ムースケーキ                                  │          15 │                 42 │
│ ストロベリーとラムのルバーブシャルロット                                  │          20 │                 42 │
│ シェフ・ジョーイのストロベリー・バニラタルト                             │           7 │                 37 │
│ オールドファッションアイスクリームサンデーケーキ                          │          17 │                 37 │
│ スイカケーキ                                                       │          16 │                 36 │
└──────────────────────────────────────────────────────────────────┴─────────────┴────────────────────┘

10行に対して. 経過時間: 0.215秒. 2.23百万行を処理し、1.48 GB (10.35百万行/秒, 6.86 GB/秒).
```

この例では、[has](../../sql-reference/functions/array-functions.md#hasarr-elem)関数を使用して配列要素でフィルタリングし、指示の数でソートしています。

全126ステップのウエディングケーキがあります！その指示を表示します:

クエリ:

``` sql
SELECT arrayJoin(directions)
FROM recipes
WHERE title = 'チョコレート・ストロベリー・オレンジ・ウエディングケーキ'
```

結果:

``` text
┌─arrayJoin(directions)───────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ オーブンの中央に1つ、下の3分の1に1つラックを置き、350Fに予熱します。                                                                                                 │
│ 直径5インチ、2インチ高のケーキパンを1つ、直径8インチ、2インチ高のケーキパンを1つ、直径12インチ、2インチ高のケーキパンを1つバターで塗ります。                                     │
│ 型に小麦粉を振りかけ、底にパーチメントを敷きます。                                                                                                                           │
│ 1/3カップのオレンジジュースと2オンスの無糖チョコレートを重い小鍋に入れます。                                                                                                                 │
│ 中火弱で混ぜ、チョコレートが溶けるまでかき混ぜます。                                                                                                                       │
│ 火から下ろします。                                                                                                                                                           │
│ 1 2/3カップのオレンジジュースを徐々に混ぜます。                                                                                                                                   │
│ 中くらいのボウルに、小麦粉3カップ、ココア2/3カップ、ベーキングソーダ2ティースプーン、塩1ティースプーン、ベーキングパウダー1/2ティースプーンをふるい入れます。                                                 │
│ 電動ミキサーを使用して、大きなボウルにバター1カップ（2本）と砂糖3カップを混ぜます（混合物はざらざらに見えます）。                                                         │
│ 卵4個を1個ずつ加え、混ぜ合わせます。                                                                                                                                           │
│ オレンジの皮1テーブルスプーンとバニラエキス1テーブルスプーンを加えます。                                                                                                         │
│ 乾燥した材料をオレンジジュースの混合物と交互に3回に分けて加え、それぞれよく混ぜます。                                                                                      │
│ チョコレートチップ1カップを混ぜます。                                                                                                                                               │
│ 5インチの型には1カッププラス2テーブルスプーン、8インチの型には3カップ、12インチの型には残りの生地（約6カップ）を移します。                    │
│ 5インチと8インチの型をオーブンの中央ラックに置きます。                                                                                                                        │
│ 12インチの型をオーブンの下のラックに置きます。                                                                                                                                    │
│ ケーキを焼いて、中心に挿したテスターがきれいに出てくるまで、約35分焼きます。                                                                                             │
│ 型からケーキをラックに移し、完全に冷まします。                                                                                                                                  │
│ 6インチの厚紙ケーキラウンドの1つに直径4インチの円をマークします。                                                                                                       │
│ マークした円を切り取ります。                                                                                                                                                     │
│ 8インチの厚紙ケーキラウンドの1つに直径7インチの円をマークします。                                                                                                       │
│ マークした円を切り取ります。                                                                                                                                                     │
│ 12インチの厚紙ケーキラウンドの1つに直径11インチの円をマークします。                                                                                                          │
│ マークした円を切り取ります。                                                                                                                                                     │
│ 5インチのケーキの側面をこそぎます。                                                                                                                                              │
│ 厚紙を型の上に置きます。                                                                                                                                                    │
│ 厚紙と型を一緒に持ち、ケーキを厚紙の上に反転させます。                                                                                                                │
│ パーチメントを剥がします。ケーキをその厚紙にアルミホイルで包みます。                                                                                                        │
│ 対照的に、8インチケーキには7インチの厚紙、12インチケーキには11インチの厚紙を使用して、そのプロセスを繰り返します。                                                                  │
│ 残りの材料を使って、もう1つのバッチのケーキ生地を作り、上記と同様に3層のケーキを焼きます。                                                                       │
│ ケーキを型の中で冷やします。                                                                                                                                                      │
│ ケーキを型の中でアルミホイルで密閉します。                                                                                                                                        │
│ （予め用意できます。                                                                                                                                                          │
│ 常温で最大1日置いたり、全てのケーキ層を二重に包装して最大1週間冷凍したりできます。）                                                                                                 │
│ 最初の12インチのケーキを作業台の厚紙の上に置きます。                                                                                                                     │
│ ケーキの上に2 3/4カップのガナッシュを塗り、端まで広げます。                                                                                                                │
│ ガナッシュの上に2/3カップのジャムを塗り、端に1/2インチのチョコレートの境界を残します。                                                                                               │
│ ジャムの上に1 3/4カップのホワイトチョコレートのフロスティングをスプーンで落とします。                                                                                   │
│ ジャムの上にフロスティングを優しく広げ、端に1/2インチのチョコレートの境界を残します。                                                                                           │
│ 2つ目の12インチの厚紙をココアパウダーで擦ります。                                                                                                                                   │
│ 2つ目の12インチのケーキの側面を切り取ります。                                                                                                                                     │
│ 厚紙を型の上に、ココア側を下にして置きます。                                                                                                                                   │
│ ケーキを厚紙の上に反転させます。                                                                                                                                                  │
│ パーチメントを剥がします。                                                                                                                                                     │
│ ケーキを厚紙から注意深くスライドさせて、最初の12インチのケーキのフィリングの上に置きます。                                                                           │
│ 冷やします。                                                                                                                                                                   │
│ 最初の8インチのケーキを作業台の厚紙の上に置きます。                                                                                                                            │
│ ケーキの上に1カップのガナッシュを端まで広げます。                                                                                                                            │
│ 1/4カップのジャムを上に広げ、端に1/2インチのチョコレートの境界を残します。                                                                                                 │
│ ジャムの上に1カップのホワイトチョコレートのフロスティングをスプーンで落とします。                                                                                                 │
│ ジャムの上にフロスティングを優しく広げ、端に1/2インチのチョコレートの境界を残します。                                                                                             │
│ 2つ目の8インチの厚紙をココアで擦ります。                                                                                                                                      │
│ 2つ目の8インチのケーキの側面をこそぎます。                                                                                                                                       │
│ 厚紙を型の上に、ココア側を下にして置きます。                                                                                                                                  │
│ ケーキを厚紙の上に反転させます。                                                                                                                                                  │
│ パーチメントを剥がします。                                                                                                                                                     │
│ ケーキを厚紙からスライドさせて、最初の8インチのケーキのフィリングの上に置きます。                                                                                           │
│ 冷やします。                                                                                                                                                                   │
│ 最初の5インチのケーキを作業台の厚紙の上に置きます。                                                                                                                           │
│ ケーキの上に1/2カップのガナッシュを端まで広げます。                                                                                                                          │
│ 2テーブルスプーンのジャムをその上に広げ、端に1/2インチのチョコレートの境界を残します。                                                                                          │
│ ジャムの上に1/3カップのホワイトチョコレートのフロスティングをスプーンで落とします。                                                                                          │
│ ジャムの上にフロスティングを優しく広げ、端に1/2インチのチョコレートの境界を残します。                                                                                          │
│ 2つ目の6インチの厚紙をココアで擦ります。                                                                                                                                           │
│ 2つ目の5インチのケーキの側面をこそぎます。                                                                                                                                     │
│ 厚紙を型の上に、ココア側を下にして置きます。                                                                                                                                   │
│ ケーキを厚紙の上に反転させます。                                                                                                                                                  │
│ パーチメントを剥がします。                                                                                                                                                      │
│ ケーキを厚紙からスライドさせて、最初の5インチのケーキのフィリングの上に置きます。                                                                                          │
│ 全てのケーキを1時間冷やしてフィリングを固めます。                                                                                                                                 │
│ 12インチのティアードケーキを回転ケーキスタンドの厚紙の上に置きます。                                                                                                          │
│ ケーキの上と側面に2 2/3カップのフロスティングを一回塗ります。                                                                                                                      │
│ ケーキを冷やします。                                                                                                                                                             │
│ 8インチのティアードケーキをケーキスタンドの厚紙の上に置きます。                                                                                                               │
│ ケーキの上と側面に1 1/4カップのフロスティングを一回塗ります。                                                                                                                      │
│ ケーキを冷やします。                                                                                                                                                             │
│ 5インチのティアードケーキをケーキスタンドの厚紙の上に置きます。                                                                                                                      │
│ ケーキの上と側面に3/4カップのフロスティングを一回塗ります。                                                                                                                    │
│ ケーキの上にフロスティングが固まるまで、全てのケーキを冷蔵庫に置きます、約1時間。                                                                                              │
│ （このポイントまで、ケーキは最大1日前に作ることができます; カバーして冷やしておく。）                                                                                        │
│ フロスティングの残りの材料を使って2回目のバッチを準備します。そして、1回目のバッチの手順に従います。                                                                  │
│ 小さな星型の口金をつけたパティシエバッグに2カップのフロスティングを入れます。                                                                                                │
│ 12インチのケーキを大きな平皿の厚紙の上に置きます。                                                                                                                             │
│ 皿をケーキスタンドの上に置きます。                                                                                                                                              │
│ アイシングスパチュラを用いて、ケーキの上と側面に2 1/2カップのフロスティングを広げ、上を滑らかにします。                                                                              │
│ フィルされたパティシエバッグを使用して、ケーキの上部の周りに装飾的な境界を絞ります。                                                                                                  │
│ 皿のケーキを冷やします。                                                                                                                                                           │
│ 8インチのケーキをケーキスタンドの厚紙の上に置きます。                                                                                                                            │
│ アイシングスパチュラを用いて、ケーキの上と側面に1 1/2カップのフロスティングを広げ、上を滑らかにします。                                                                          │
│ パティシエバッグを使用して、ケーキの上部の周りに装飾的な境界を絞ります。                                                                                                        │
│ 厚紙の上で冷却します。                                                                                                                                                            │
│ 5インチのケーキをケーキスタンドの厚紙の上に置きます。                                                                                                                           │
│ アイシングスパチュラを用いて、ケーキの上と側面に3/4カップのフロスティングを広げ、上を滑らかにします。                                                                            │
│ パティシエバッグを用いて、ケーキの上の部分に装飾的な境界を絞ります。必要に応じて、バッグにフロスティングをもっと追加します。                                                        │
│ 厚紙の上で冷却します。                                                                                                                                                            │
│ すべてのケーキがフロスティングが固まるまで冷蔵庫に置きます、約2時間。                                                                                                       │
│ （最大2日前に準備が可能です。                                                                                                                                                     │
│ ゆるく覆い、冷蔵しておきます。）                                                                                                                                                 │
│ 作業台の上に12インチのケーキを置きます。                                                                                                                                       │
│ 一本の木のダウエルをケーキの中心にまっすぐに押し込み、完全に貫通させます。                                                                                                     │
│ ダウエルをフロスティングの上の1/4インチでマークします。                                                                                                                         │
│ ダウエルを外し、マークした点で鋸歯状ナイフで切ります。                                                                                                                       │
│ 4本のダウエルを同じ長さに切ります。                                                                                                                                             │
│ 1本の切ったダウエルをケーキの中央に戻します。                                                                                                                                  │
│ 残りの4本の切ったダウエルをケーキに押し込み、ケーキの端から3 1/2インチ内側に配置し、均等にスペースを設けます。                                                                   │
│ 8インチのケーキを作業台の上に置きます。                                                                                                                                          │
│ 1本のダウエルをまっすぐに押し込み、ケーキの中心に完全に貫通させます。                                                                                                         │
│ ダウエルをフロスティングの上の1/4インチでマークします。                                                                                                                         │
│ ダウエルを外し、マークした点で鋸歯状ナイフで切ります。                                                                                                                       │
│ 3本のダウエルを同じ長さに切ります。                                                                                                                                             │
│ 1本の切ったダウエルをケーキの中央に戻します。                                                                                                                                  │
│ 残りの3本の切ったダウエルをケーキに押し込み、端から2 1/2インチ内側に配置し、均等にスペースを設けます。                                                                  │
│ 大きな金属スパチュラを使って、8インチのケーキを12インチのケーキのダウエルの上に置き、慎重に中心に配置します。                                                                     │
│ 5インチのケーキを8インチのケーキのダウエルの上に、慎重に中心に配置します。                                                                                                   │
│ シトラスストリッパーを使用して、オレンジの皮の長いストリップをオレンジから切り出します。                                                                                   │
│ ストリップを長いセグメントに切り分けます。                                                                                                                                          │
│ オレンジの皮のコイルを作るために、皮のセグメントを木のスプーンのハンドルの周りに巻きつけます。ハンドルから優しく皮を外し、皮が巻かれた形を保持するようにします。                              │
│ ケーキをオレンジの皮のコイル、アイビーまたはミントの小枝、いくつかのベリーで飾ります。                                                                                          │
│ （組み立てたケーキは最大8時間前に作ることができます。                                                                                                                          │
│ 冷たい室温で置いておきます。）                                                                                                                                                 │
│ 上部と中間のケーキのティアを取り外します。                                                                                                                                     │
│ ケーキからダウエルを取り外します。                                                                                                                                               │
│ 上部と中間のケーキをスライスします。                                                                                                                                           │
│ 12インチのケーキを切る: 端から3インチ内側から始め、ナイフをまっすぐ下に挿入し、トップからボトムまで切り、ケーキの中心に直径6インチの円を作ります。                          │
│ ケーキの外側の部分をスライスし、内側の部分をスライスしてストロベリーとともに出します。                                                                              │
└─────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘

126行に対して. 経過時間: 0.011秒. 8.19千行を処理し、5.34 MB (737.75千行/秒, 480.59 MB/秒).
```
### オンラインプレイグラウンド {#online-playground}

データセットは[オンラインプレイグラウンド](https://sql.clickhouse.com?query_id=HQXNQZE26Z1QWYP9KC76ML)でも利用可能です。
