---
description: '各要素の重みを考慮して、数値データ列の分位数を厳密に計算します。'
slug: /sql-reference/aggregate-functions/reference/quantileexactweighted
title: 'quantileExactWeighted'
doc_type: 'reference'
---

# quantileExactWeighted \{#quantileexactweighted\}

数値データ列に対して、各要素の重みを考慮した[分位数](https://en.wikipedia.org/wiki/Quantile)を厳密に計算します。

厳密な値を取得するために、渡されたすべての値は配列にまとめられ、部分的にソートされます。各値は、その値が `weight` 回存在するかのように、その重み分だけカウントされます。アルゴリズムではハッシュテーブルが使用されます。このため、渡される値に同じ値が頻出する場合、この関数は [quantileExact](/sql-reference/aggregate-functions/reference/quantileExact.md) より少ない RAM を消費します。この関数を `quantileExact` の代わりに使用し、重みとして 1 を指定することもできます。

1 つのクエリ内で、異なるレベルを持つ複数の `quantile*` 関数を使用する場合、内部状態はマージされません（つまり、クエリは本来可能な場合ほど効率的には動作しません）。このような場合は、[quantiles](../../../sql-reference/aggregate-functions/reference/quantiles.md) 関数を使用してください。

**構文**

```sql
quantileExactWeighted(level)(expr, weight)
```

別名: `medianExactWeighted`.

**引数**

* `level` — 分位数のレベル。省略可能なパラメータ。0 から 1 までの定数の浮動小数点数。`level` の値は `[0.01, 0.99]` の範囲で指定することを推奨します。デフォルト値は 0.5 です。`level=0.5` の場合、この関数は[メディアン](https://en.wikipedia.org/wiki/Median)を計算します。
* `expr` — 数値[データ型](/sql-reference/data-types)、[Date](../../../sql-reference/data-types/date.md) または [DateTime](../../../sql-reference/data-types/datetime.md) を結果とするカラム値に対する式。
* `weight` — シーケンス要素の重みを格納したカラム。重みは、その値の出現回数を表す [Unsigned integer types](../../../sql-reference/data-types/int-uint.md) の数値です。

**戻り値**

* 指定したレベルの分位数。

型:

* 数値データ型入力の場合は [Float64](../../../sql-reference/data-types/float.md)。
* 入力値が `Date` 型の場合は [Date](../../../sql-reference/data-types/date.md)。
* 入力値が `DateTime` 型の場合は [DateTime](../../../sql-reference/data-types/datetime.md)。

**例**

入力テーブル:

```text
┌─n─┬─val─┐
│ 0 │   3 │
│ 1 │   2 │
│ 2 │   1 │
│ 5 │   4 │
└───┴─────┘
```

クエリ：

```sql
SELECT quantileExactWeighted(n, val) FROM t
```

結果:

```text
┌─quantileExactWeighted(n, val)─┐
│                             1 │
└───────────────────────────────┘
```

**関連項目**

* [median](/sql-reference/aggregate-functions/reference/median)
* [quantiles](/sql-reference/aggregate-functions/reference/quantiles)

{/*AUTOGENERATED_START*/ }

{/*AUTOGENERATED_END*/ }
