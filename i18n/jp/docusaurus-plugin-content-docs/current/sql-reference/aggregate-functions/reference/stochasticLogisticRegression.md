---
description: 'この関数は確率的ロジスティック回帰を実装します。二値分類問題に利用でき、stochasticLinearRegression と同じカスタムパラメーターをサポートし、動作も同様です。'
slug: /sql-reference/aggregate-functions/reference/stochasticlogisticregression
title: 'stochasticLogisticRegression'
doc_type: 'reference'
---

{/*AUTOGENERATED_START*/ }

## stochasticLogisticRegression \{#stochasticLogisticRegression\}

導入: v20.1

この関数は確率的ロジスティック回帰を実装しています。
二値分類問題に使用でき、[`stochasticLinearRegression`](/sql-reference/aggregate-functions/reference/stochasticlinearregression)と同じカスタムパラメータをサポートし、同様に動作します。

**使用法**

この関数は2段階で使用します:

1. 学習

フィッティングには、次のようなクエリを使用できます:

```sql
CREATE TABLE IF NOT EXISTS train_data
(
    param1 Float64,
    param2 Float64,
    target Float64
) ENGINE = Memory;

CREATE TABLE your_model ENGINE = Memory AS SELECT
stochasticLogisticRegression(0.1, 0.0, 5, 'SGD')(target, x1, x2)
AS state FROM train_data;
```

ここでは、`train_data`テーブルにデータを挿入する必要もあります。
パラメータの数は固定されておらず、`logisticRegressionState`に渡される引数の数のみに依存します。
すべて数値である必要があります。
目的変数(予測対象の値)を含むカラムは、最初の引数として挿入されることに注意してください。

予測ラベルは [-1, 1] の範囲内でなければなりません。

2. 予測

保存された状態を使用することで、オブジェクトがラベル `1` を持つ確率を予測できます。

```sql
WITH (SELECT state FROM your_model) AS model SELECT
evalMLMethod(model, param1, param2) FROM test_data
```

クエリは確率のカラムを返します。
`evalMLMethod`の第1引数は`AggregateFunctionState`オブジェクトで、その後に特徴量のカラムが続きます。

確率の閾値を設定することで、要素を異なるラベルに割り当てることもできます。

```sql
SELECT result < 1.1 AND result > 0.5 FROM
(WITH (SELECT state FROM your_model) AS model SELECT
evalMLMethod(model, param1, param2) AS result FROM test_data)
```

その結果はラベルとなります。

`test_data`は`train_data`と同様のテーブルですが、目的変数を含まない場合があります。

**構文**

```sql
stochasticLogisticRegression([learning_rate, l2_regularization_coef, mini_batch_size, method])(target, x1, x2, ...)
```

**引数**

* `learning_rate` — 勾配降下ステップを実行する際のステップ長にかかる係数です。学習率が大きすぎると、モデルの重みが発散してしまう可能性があります。デフォルトは `0.00001` です。[`Float64`](/sql-reference/data-types/float)
* `l2_regularization_coef` — 過学習の防止に役立つ場合がある L2 正則化係数です。デフォルトは `0.1`。[`Float64`](/sql-reference/data-types/float)
* `mini_batch_size` — 勾配降下の1ステップを実行するために、勾配を計算して合計する要素数を設定します。純粋な確率的勾配降下法では1要素のみを使用しますが、小さなバッチ（約10要素）を使用すると、勾配ステップがより安定します。デフォルト値は `15` です。[`UInt64`](/sql-reference/data-types/int-uint)
* `method` — 重みを更新するためのメソッド: デフォルトは `Adam` で、他に `SGD`、`Momentum`、`Nesterov` を指定できます。`Momentum` と `Nesterov` は計算量とメモリ使用量がやや増加しますが、確率的勾配法における収束速度と安定性の面で有用な場合があります。[`String`](/sql-reference/data-types/string)
* `target` — 目的変数となる二値分類ラベル。範囲は [-1, 1] でなければなりません。[`Float`](/sql-reference/data-types/float)
* `x1, x2, ...` — 特徴量（独立変数）の値。すべて数値型である必要があります。[`Float`](/sql-reference/data-types/float)

**返り値**

学習済みロジスティック回帰モデルの重みを返します。予測には`evalMLMethod`を使用します。これはオブジェクトがラベル`1`を持つ確率を返します。[`Array(Float64)`](/sql-reference/data-types/array)

**例**

**モデルの学習**

```sql title=Query
CREATE TABLE your_model
ENGINE = MergeTree
ORDER BY tuple()
AS SELECT
stochasticLogisticRegressionState(1.0, 1.0, 10, 'SGD')(target, x1, x2)
AS state FROM train_data
```

```response title=Response
Saves trained model state to table
```

**予測の実行**

```sql title=Query
WITH (SELECT state FROM your_model) AS model
SELECT
evalMLMethod(model, x1, x2)
FROM test_data
```

```response title=Response
Returns probability values for test data
```

**閾値による分類**

```sql title=Query
SELECT result < 1.1 AND result > 0.5
FROM (
WITH (SELECT state FROM your_model) AS model SELECT
evalMLMethod(model, x1, x2) AS result FROM test_data)
```

```response title=Response
Returns binary classification labels using probability threshold
```

{/*AUTOGENERATED_END*/ }

**関連項目**

* [stochasticLinearRegression](/sql-reference/aggregate-functions/reference/stochasticlogisticregression)
* [線形回帰とロジスティック回帰の違い](https://stackoverflow.com/questions/12146914/what-is-the-difference-between-linear-regression-and-logistic-regression)
