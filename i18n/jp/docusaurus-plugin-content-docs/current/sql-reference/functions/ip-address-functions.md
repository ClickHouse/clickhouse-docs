---
description: 'IPv4 および IPv6 アドレスを操作する関数に関するドキュメント'
sidebar_label: 'IP アドレス'
slug: /sql-reference/functions/ip-address-functions
title: 'IPv4 および IPv6 アドレスを操作する関数'
doc_type: 'reference'
---

# IPv4 および IPv6 アドレスを扱うための関数 \\{#functions-for-working-with-ipv4-and-ipv6-addresses\\}

{/* 
  以下のタグの内部の内容は、ドキュメントフレームワークのビルド時に
  system.functions から自動生成されたドキュメントで置き換えられます。タグを変更したり削除したりしないでください。
  詳細は https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md を参照してください。
  */ }

{/*AUTOGENERATED_START*/ }

## IPv4CIDRToRange \\{#IPv4CIDRToRange\\}

導入バージョン: v20.1

クラスレス ドメイン間ルーティング (CIDR) のプレフィックス長付き IPv4 アドレスを受け取り、そのサブネットのアドレス範囲を、サブネット内の最初と最後のアドレスを表す 2 つの IPv4 値から成るタプルとして返します。
IPv6 版については [`IPv6CIDRToRange`](#IPv4CIDRToRange) を参照してください。

**構文**

```sql
IPv4CIDRToRange(ipv4, cidr)
```

**引数**

* `ipv4` — IPv4 アドレス。[`IPv4`](/sql-reference/data-types/ipv4) または [`String`](/sql-reference/data-types/string)
* `cidr` — CIDR 値。[`UInt8`](/sql-reference/data-types/int-uint)

**戻り値**

サブネット範囲を表す 2 つの IPv4 アドレスからなるタプルを返します。[`Tuple(IPv4, IPv4)`](/sql-reference/data-types/tuple)

**例**

**使用例**

```sql title=Query
SELECT IPv4CIDRToRange(toIPv4('192.168.5.2'), 16);
```

```response title=Response
┌─IPv4CIDRToRange(toIPv4('192.168.5.2'), 16)─┐
│ ('192.168.0.0','192.168.255.255')          │
└────────────────────────────────────────────┘
```

## IPv4NumToString \\{#IPv4NumToString\\}

導入バージョン: v1.1

32ビット整数を、ドット区切りの10進数表記（A.B.C.D 形式）の IPv4 アドレス文字列表現に変換します。
入力はビッグエンディアンのバイトオーダーとして解釈されます。

**構文**

```sql
IPv4NumToString(num)
```

**別名**: `INET_NTOA`

**引数**

* `num` — UInt32 型の数値として表される IPv4 アドレス。[`UInt32`](/sql-reference/data-types/int-uint)

**戻り値**

MAC アドレスを表す数値、または形式が無効な場合は `0` を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
IPv4NumToString(3232235521)
```

```response title=Response
192.168.0.1
```

## IPv4NumToStringClassC \\{#IPv4NumToStringClassC\\}

導入バージョン: v1.1

32ビット整数を、ドット区切り10進表記（A.B.C.D形式）のIPv4アドレス文字列表現に変換します。
[`IPv4NumToString`](#IPv4NumToString) と同様ですが、最後のオクテットの代わりに `xxx` を使用します。

**構文**

```sql
IPv4NumToStringClassC(num)
```

**引数**

* `num` — UInt32 値として表される IPv4 アドレス。[`UInt32`](/sql-reference/data-types/int-uint)

**返される値**

最後のオクテットを xxx に置き換えた IPv4 アドレスを表す文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**集計を伴う基本的な例**

```sql title=Query
SELECT
    IPv4NumToStringClassC(ClientIP) AS k,
    count() AS c
FROM test.hits
GROUP BY k
ORDER BY c DESC
LIMIT 10
```

```response title=Response
┌─k──────────────┬─────c─┐
│ 83.149.9.xxx   │ 26238 │
│ 217.118.81.xxx │ 26074 │
│ 213.87.129.xxx │ 25481 │
│ 83.149.8.xxx   │ 24984 │
│ 217.118.83.xxx │ 22797 │
│ 78.25.120.xxx  │ 22354 │
│ 213.87.131.xxx │ 21285 │
│ 78.25.121.xxx  │ 20887 │
│ 188.162.65.xxx │ 19694 │
│ 83.149.48.xxx  │ 17406 │
└────────────────┴───────┘
```

## IPv4StringToNum \\{#IPv4StringToNum\\}

導入バージョン: v1.1

ドット区切りの 10 進表記（A.B.C.D 形式）の IPv4 アドレス文字列を、対応する 32ビット整数表現に変換します（[`IPv4NumToString`](#IPv4NumToString) の逆の処理です）。\
IPv4 アドレス文字列の形式が無効な場合は、例外がスローされます。

**構文**

```sql
IPv4StringToNum(string)
```

**別名**: `INET_ATON`

**引数**

* `string` — IPv4 アドレス文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

IPv4 アドレスを返します。[`UInt32`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
IPv4StringToNum('192.168.0.1')
```

```response title=Response
3232235521
```

## IPv4StringToNumOrDefault \\{#IPv4StringToNumOrDefault\\}

導入: v22.3

ドット区切り10進表記（A.B.C.D 形式）の IPv4 アドレス文字列を対応する 32 ビット整数表現に変換します。IPv4 アドレスの形式が不正な場合は `0` を返します。

**構文**

```sql
IPv4StringToNumOrDefault(string)
```

**引数**

* `string` — IPv4 アドレス文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

IPv4 アドレスを返します。無効な場合は `0` を返します。[`UInt32`](/sql-reference/data-types/int-uint)

**例**

**無効なアドレスの例**

```sql title=Query
SELECT
    IPv4StringToNumOrDefault('127.0.0.1') AS valid,
    IPv4StringToNumOrDefault('invalid') AS invalid;
```

```response title=Response
┌──────valid─┬─invalid─┐
│ 2130706433 │       0 │
└────────────┴─────────┘
```

## IPv4StringToNumOrNull \\{#IPv4StringToNumOrNull\\}

導入バージョン: v22.3

32ビット整数を IPv4 アドレスの文字列表現（A.B.C.D 形式のドット区切りの 10 進表記）に変換します。ただし、IPv4 アドレスの形式が不正な場合は `NULL` を返します。

**構文**

```sql
IPv4StringToNumOrNull(string)
```

**引数**

* `string` — IPv4 アドレス文字列。[`String`](/sql-reference/data-types/string)

**返される値**

IPv4 アドレスを返し、無効な場合は `NULL` を返します。[`Nullable(UInt32)`](/sql-reference/data-types/nullable)

**例**

**無効なアドレスの例**

```sql title=Query
SELECT
IPv4StringToNumOrNull('127.0.0.1') AS valid,
IPv4StringToNumOrNull('invalid') AS invalid;
```

```response title=Response
┌──────valid─┬─invalid─┐
│ 2130706433 │    ᴺᵁᴸᴸ │
└────────────┴─────────┘
```

## IPv4ToIPv6 \\{#IPv4ToIPv6\\}

導入バージョン: v1.1

(ビッグエンディアンの) 32 ビット整数値を IPv4 アドレスとして解釈し、それを対応する IPv6 アドレスの `FixedString(16)` 表現に変換します。

**構文**

```sql
IPv4ToIPv6(x)
```

**引数**

* `x` — IPv4アドレス。[`UInt32` 型](/sql-reference/data-types/int-uint)

**戻り値**

バイナリ形式の IPv6アドレスを返します。[`FixedString(16)` 型](/sql-reference/data-types/fixedstring)

**例**

**使用例**

```sql title=Query
SELECT IPv6NumToString(IPv4ToIPv6(IPv4StringToNum('192.168.0.1'))) AS addr;
```

```response title=Response
┌─addr───────────────┐
│ ::ffff:192.168.0.1 │
└────────────────────┘
```

## IPv6CIDRToRange \\{#IPv6CIDRToRange\\}

導入バージョン: v20.1

クラスレスドメイン間ルーティング (CIDR) のプレフィックス長付き IPv6 アドレスを受け取り、そのサブネットのアドレス範囲を、最小アドレスと最大アドレスの 2 つの IPv6 値からなるタプルとして返します。
IPv4 版については [`IPv4CIDRToRange`](#IPv4CIDRToRange) を参照してください。

**構文**

```sql
IPv6CIDRToRange(ipv6, cidr)
```

**引数**

* `ipv6` — IPv6 アドレス。[`IPv6`](/sql-reference/data-types/ipv6) または [`String`](/sql-reference/data-types/string)
* `cidr` — CIDR 値。[`UInt8`](/sql-reference/data-types/int-uint)

**返される値**

サブネット範囲を表す 2 つの IPv6 アドレスからなるタプルを返します。[`Tuple(IPv6, IPv6)`](/sql-reference/data-types/tuple)

**例**

**使用例**

```sql title=Query
SELECT IPv6CIDRToRange(toIPv6('2001:0db8:0000:85a3:0000:0000:ac1f:8001'), 32);
```

```response title=Response
┌─IPv6CIDRToRange(toIPv6('2001:0db8:0000:85a3:0000:0000:ac1f:8001'), 32)─┐
│ ('2001:db8::','2001:db8:ffff:ffff:ffff:ffff:ffff:ffff')                │
└────────────────────────────────────────────────────────────────────────┘
```

## IPv6NumToString \\{#IPv6NumToString\\}

導入: v1.1

IPv6 アドレスをバイナリ形式 (FixedString(16)) から標準的なテキスト表現に変換します。
IPv4 にマップされた IPv6 アドレスは、`::ffff:111.222.33.44` の形式で表示されます。

**構文**

```sql
IPv6NumToString(x)
```

**別名**: `INET6_NTOA`

**引数**

* `x` — バイナリ形式の IPv6 アドレス。[`FixedString(16)`](/sql-reference/data-types/fixedstring) または [`IPv6`](/sql-reference/data-types/ipv6)

**戻り値**

テキスト形式の IPv6 アドレス文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT IPv6NumToString(toFixedString(unhex('2A0206B8000000000000000000000011'), 16)) AS addr;
```

```response title=Response
┌─addr─────────┐
│ 2a02:6b8::11 │
└──────────────┘
```

**IPv6 を用いたヒット分析**

```sql title=Query
SELECT
    IPv6NumToString(ClientIP6 AS k),
    count() AS c
FROM hits_all
WHERE EventDate = today() AND substring(ClientIP6, 1, 12) != unhex('00000000000000000000FFFF')
GROUP BY k
ORDER BY c DESC
LIMIT 10
```

```response title=Response
┌─IPv6NumToString(ClientIP6)──────────────┬─────c─┐
│ 2a02:2168:aaa:bbbb::2                   │ 24695 │
│ 2a02:2698:abcd:abcd:abcd:abcd:8888:5555 │ 22408 │
│ 2a02:6b8:0:fff::ff                      │ 16389 │
│ 2a01:4f8:111:6666::2                    │ 16016 │
│ 2a02:2168:888:222::1                    │ 15896 │
│ 2a01:7e00::ffff:ffff:ffff:222           │ 14774 │
│ 2a02:8109:eee:ee:eeee:eeee:eeee:eeee    │ 14443 │
│ 2a02:810b:8888:888:8888:8888:8888:8888  │ 14345 │
│ 2a02:6b8:0:444:4444:4444:4444:4444      │ 14279 │
│ 2a01:7e00::ffff:ffff:ffff:ffff          │ 13880 │
└─────────────────────────────────────────┴───────┘
```

**IPv6 マップド IPv4 アドレス**

```sql title=Query
SELECT
    IPv6NumToString(ClientIP6 AS k),
    count() AS c
FROM hits_all
WHERE EventDate = today()
GROUP BY k
ORDER BY c DESC
LIMIT 10
```

```response title=Response
┌─IPv6NumToString(ClientIP6)─┬──────c─┐
│ ::ffff:94.26.111.111       │ 747440 │
│ ::ffff:37.143.222.4        │ 529483 │
│ ::ffff:5.166.111.99        │ 317707 │
│ ::ffff:46.38.11.77         │ 263086 │
│ ::ffff:79.105.111.111      │ 186611 │
│ ::ffff:93.92.111.88        │ 176773 │
│ ::ffff:84.53.111.33        │ 158709 │
│ ::ffff:217.118.11.22       │ 154004 │
│ ::ffff:217.118.11.33       │ 148449 │
│ ::ffff:217.118.11.44       │ 148243 │
└────────────────────────────┴────────┘
```

## IPv6StringToNum \\{#IPv6StringToNum\\}

導入バージョン: v1.1

IPv6 アドレスを、その標準テキスト表現からバイナリ形式（`FixedString(16)`）に変換します。
`::ffff:111.222.33.44.` 形式の IPv4 マップド IPv6 アドレスを受け付けます。
IPv6 アドレスの形式が不正な場合は、例外がスローされます。

入力文字列に有効な IPv4 アドレスが含まれている場合は、対応する IPv6 アドレスを返します。
16 進数表記は大文字・小文字のいずれでもかまいません。

**構文**

```sql
IPv6StringToNum(string)
```

**エイリアス**: `INET6_ATON`

**引数**

* `string` — IPv6 アドレス文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

IPv6 アドレスをバイナリ形式で返します。[`FixedString(16)`](/sql-reference/data-types/fixedstring)

**例**

**基本例**

```sql title=Query
SELECT addr, cutIPv6(IPv6StringToNum(addr), 0, 0) FROM (SELECT ['notaddress', '127.0.0.1', '1111::ffff'] AS addr) ARRAY JOIN addr;
```

```response title=Response
┌─addr───────┬─cutIPv6(IPv6StringToNum(addr), 0, 0)─┐
│ notaddress │ ::                                   │
│ 127.0.0.1  │ ::ffff:127.0.0.1                     │
│ 1111::ffff │ 1111::ffff                           │
└────────────┴──────────────────────────────────────┘
```

## IPv6StringToNumOrDefault \\{#IPv6StringToNumOrDefault\\}

導入バージョン: v22.3

IPv6 アドレスを標準的な文字列表現からバイナリ形式（`FixedString(16)`）に変換します。
`::ffff:111.222.33.44.` 形式の IPv4 マップド IPv6 アドレスを受け付けます。
IPv6 アドレスの形式が無効な場合は、デフォルト値の `::` を返します。

**構文**

```sql
IPv6StringToNumOrDefault(string)
```

**引数**

* `string` — IPv6 アドレス文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

バイナリ形式の IPv6 アドレス、または無効な場合はゼロ埋めされた FixedString(16)。[`FixedString(16)`](/sql-reference/data-types/fixedstring)

**例**

**無効なアドレスを使用した基本的な例**

```sql title=Query
SELECT
    IPv6NumToString(IPv6StringToNumOrDefault('2001:db8::1')) AS valid,
    IPv6NumToString(IPv6StringToNumOrDefault('invalid')) AS invalid;
```

```response title=Response
┌─valid───────┬─invalid─┐
│ 2001:db8::1 │ ::      │
└─────────────┴─────────┘
```

## IPv6StringToNumOrNull \\{#IPv6StringToNumOrNull\\}

導入バージョン: v22.3

IPv6 アドレスを標準的なテキスト表現からバイナリ形式（`FixedString(16)`）に変換します。
`::ffff:111.222.33.44.` 形式の IPv4 マップド IPv6 アドレスを受け付けます。
IPv6 アドレスの形式が不正な場合は、`NULL` を返します。

**構文**

```sql
IPv6StringToNumOrNull(string)
```

**引数**

* `string` — IPv6 アドレス文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

IPv6 アドレスをバイナリ形式で返し、無効な場合は `NULL` を返します。[`Nullable(FixedString(16))`](/sql-reference/data-types/nullable)

**例**

**無効なアドレスを使用した基本的な例**

```sql title=Query
SELECT
    IPv6NumToString(IPv6StringToNumOrNull('2001:db8::1')) AS valid,
    IPv6StringToNumOrNull('invalid') AS invalid;
```

```response title=Response
┌─valid───────┬─invalid─┐
│ 2001:db8::1 │    ᴺᵁᴸᴸ │
└─────────────┴─────────┘
```

## cutIPv6 \\{#cutIPv6\\}

導入バージョン: v1.1

バイナリ形式の IPv6 アドレスを格納した `FixedString(16)` 型の値を受け取ります。
指定したバイト数を削除したアドレスをテキスト形式で返します。

**構文**

```sql
cutIPv6(x, bytesToCutForIPv6, bytesToCutForIPv4)
```

**引数**

* `x` — バイナリ形式の IPv6 アドレス。[`FixedString(16)`](/sql-reference/data-types/fixedstring) または [`IPv6`](/sql-reference/data-types/ipv6)
* `bytesToCutForIPv6` — IPv6 から削除するバイト数。[`UInt8`](/sql-reference/data-types/int-uint)
* `bytesToCutForIPv4` — IPv4 から削除するバイト数。[`UInt8`](/sql-reference/data-types/int-uint)

**戻り値**

指定したバイト数を削除した IPv6 アドレスをテキスト形式で含む文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
WITH
    IPv6StringToNum('2001:0DB8:AC10:FE01:FEED:BABE:CAFE:F00D') AS ipv6,
    IPv4ToIPv6(IPv4StringToNum('192.168.0.1')) AS ipv4
SELECT
    cutIPv6(ipv6, 2, 0),
    cutIPv6(ipv4, 0, 2)
```

```response title=Response
┌─cutIPv6(ipv6, 2, 0)─────────────────┬─cutIPv6(ipv4, 0, 2)─┐
│ 2001:db8:ac10:fe01:feed:babe:cafe:0 │ ::ffff:192.168.0.0  │
└─────────────────────────────────────┴─────────────────────┘
```

## isIPAddressInRange \\{#isIPAddressInRange\\}

導入: v21.4

IPアドレスが [Classless Inter-Domain Routing (CIDR)](https://en.wikipedia.org/wiki/Classless_Inter-Domain_Routing) 表記で表されるネットワーク内に含まれているかどうかを判定します。

この関数は、文字列として表現された IPv4 および IPv6 のアドレス（およびネットワーク）の両方を受け付けます。アドレスと CIDR の IP バージョンが一致しない場合は `0` を返します。

**構文**

```sql
isIPAddressInRange(address, prefix)
```

**引数**

* `address` — IPv4 または IPv6 アドレス。[`String`](/sql-reference/data-types/string)
* `prefix` — CIDR 表記の IPv4 または IPv6 ネットワークプレフィックス。[`String`](/sql-reference/data-types/string)

**戻り値**

アドレスと CIDR の IP バージョンが一致する場合は `1`、それ以外の場合は `0` を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**範囲内の IPv4 アドレス**

```sql title=Query
SELECT isIPAddressInRange('127.0.0.1', '127.0.0.0/8')
```

```response title=Response
1
```

**IPv4 アドレスが有効な範囲内にありません**

```sql title=Query
SELECT isIPAddressInRange('127.0.0.1', 'ffff::/16')
```

```response title=Response
0
```

**IPv6 アドレスが範囲外です**

```sql title=Query
SELECT isIPAddressInRange('::ffff:192.168.0.1', '::ffff:192.168.0.4/128')
```

```response title=Response
0
```

## isIPv4String \\{#isIPv4String\\}

導入バージョン: v21.1

入力文字列が IPv4 アドレスかどうかを判定します。
IPv6 版については [`isIPv6String`](#isIPv6String) を参照してください。

**構文**

```sql
isIPv4String(string)
```

**引数**

* `string` — 判定対象の IP アドレス文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

`string` が IPv4 アドレスであれば `1`、それ以外の場合は `0` を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT addr, isIPv4String(addr)
FROM(
SELECT ['0.0.0.0', '127.0.0.1', '::ffff:127.0.0.1'] AS addr
)
ARRAY JOIN addr;
```

```response title=Response
┌─addr─────────────┬─isIPv4String(addr)─┐
│ 0.0.0.0          │                  1 │
│ 127.0.0.1        │                  1 │
│ ::ffff:127.0.0.1 │                  0 │
└──────────────────┴────────────────────┘
```

## isIPv6String \\{#isIPv6String\\}

導入バージョン: v21.1

入力文字列が IPv6 アドレスかどうかを判定します。
IPv4 版については [`isIPv4String`](#isIPv4String) を参照してください。

**構文**

```sql
isIPv6String(string)
```

**引数**

* `string` — チェック対象の IP アドレス文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

`string` が IPv6 アドレスの場合は `1` を、そうでない場合は `0` を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT addr, isIPv6String(addr)
FROM(SELECT ['::', '1111::ffff', '::ffff:127.0.0.1', '127.0.0.1'] AS addr)
ARRAY JOIN addr;
```

```response title=Response
┌─addr─────────────┬─isIPv6String(addr)─┐
│ ::               │                  1 │
│ 1111::ffff       │                  1 │
│ ::ffff:127.0.0.1 │                  1 │
│ 127.0.0.1        │                  0 │
└──────────────────┴────────────────────┘
```

## toIPv4 \\{#toIPv4\\}

導入バージョン: v20.1

IPv4 アドレスの文字列または UInt32 形式を IPv4 型に変換します。
[`IPv4StringToNum`](/sql-reference/functions/ip-address-functions#IPv4StringToNum) 関数および [`IPv4NumToString`](/sql-reference/functions/ip-address-functions#IPv4NumToString) 関数に類似していますが、入力引数として文字列型と符号なし整数型の両方を受け付けます。

**構文**

```sql
toIPv4(x)
```

**引数**

* `x` — IPv4 アドレスを表す [`String`](/sql-reference/data-types/string) または [`UInt8/16/32`](/sql-reference/data-types/int-uint)

**戻り値**

IPv4 アドレス（[`IPv4`](/sql-reference/data-types/ipv4)）を返します。

**例**

**使用例**

```sql title=Query
SELECT toIPv4('171.225.130.45');
```

```response title=Response
┌─toIPv4('171.225.130.45')─┐
│ 171.225.130.45           │
└──────────────────────────┘
```

**IPv4StringToNum 関数および IPv4NumToString 関数との比較**

```sql title=Query
WITH
    '171.225.130.45' AS IPv4_string
SELECT
    hex(IPv4StringToNum(IPv4_string)),
    hex(toIPv4(IPv4_string))
```

```response title=Response
┌─hex(IPv4StringToNum(IPv4_string))─┬─hex(toIPv4(IPv4_string))─┐
│ ABE1822D                          │ ABE1822D                 │
└───────────────────────────────────┴──────────────────────────┘
```

**整数値からの変換**

```sql title=Query
SELECT toIPv4(2130706433);
```

```response title=Response
┌─toIPv4(2130706433)─┐
│ 127.0.0.1          │
└────────────────────┘
```

## toIPv4OrDefault \\{#toIPv4OrDefault\\}

導入バージョン: v22.3

文字列または UInt32 形式の IPv4 アドレスを [`IPv4`](../data-types/ipv4.md) 型に変換します。
IPv4 アドレスの形式が無効な場合は、`0.0.0.0`（IPv4 の 0 アドレス）、または指定されたデフォルトの IPv4 を返します。

**構文**

```sql
toIPv4OrDefault(文字列[, デフォルト])
```

**引数**

* `string` — 変換対象の IP アドレス文字列。[`String`](/sql-reference/data-types/string)
* `default` — 省略可能。`string` が無効な IPv4 アドレスの場合に返す値。[`IPv4`](/sql-reference/data-types/ipv4)

**戻り値**

文字列を IPv4 アドレスに変換した値、または変換に失敗した場合はデフォルト値を返します。[`IPv4`](/sql-reference/data-types/ipv4)

**例**

**有効および無効な IPv4 文字列**

```sql title=Query
WITH
    '192.168.1.1' AS valid_IPv4_string,
    '999.999.999.999' AS invalid_IPv4_string,
    'not_an_ip' AS malformed_string
SELECT
    toIPv4OrDefault(valid_IPv4_string) AS valid,
    toIPv4OrDefault(invalid_IPv4_string) AS default_value,
    toIPv4OrDefault(malformed_string, toIPv4('8.8.8.8')) AS provided_default;
```

```response title=Response
┌─有効─────────┬─デフォルト値─┬─指定デフォルト値─┐
│ 192.168.1.1   │ 0.0.0.0       │ 8.8.8.8          │
└───────────────┴───────────────┴──────────────────┘
```

## toIPv4OrNull \\{#toIPv4OrNull\\}

導入バージョン: v22.3

入力値を型 `IPv4` の値に変換しますが、エラーが発生した場合は `NULL` を返します。
[`toIPv4`](#toIPv4) と同様ですが、変換エラー時に例外をスローする代わりに `NULL` を返します。

サポートされる引数:

* ドット区切りの 10 進表記による IPv4 アドレスの文字列表現。
* IPv4 アドレスの整数表現。

サポートされない引数（`NULL` を返します）:

* 無効な IP アドレス形式。
* IPv6 アドレス。
* 範囲外の値。
* 不正な形式のアドレス。

**構文**

```sql
toIPv4OrNull(x)
```

**引数**

* `x` — IPv4 アドレスの文字列または整数による表現。[`String`](/sql-reference/data-types/string) または [`Integer`](/sql-reference/data-types/int-uint)

**返される値**

成功時は IPv4 アドレスを返し、それ以外は `NULL` を返します。[`IPv4`](/sql-reference/data-types/ipv4) または [`NULL`](/sql-reference/syntax#null)

**例**

**使用例**

```sql title=Query
SELECT
    toIPv4OrNull('192.168.1.1') AS valid_ip,
    toIPv4OrNull('invalid.ip') AS invalid_ip
```

```response title=Response
┌─valid_ip────┬─invalid_ip─┐
│ 192.168.1.1 │       ᴺᵁᴸᴸ │
└─────────────┴────────────┘
```

## toIPv4OrZero \\{#toIPv4OrZero\\}

導入バージョン: v23.1

入力値を [IPv4](../data-types/ipv4.md) 型の値に変換しますが、エラーが発生した場合はゼロ値の IPv4 アドレスを返します。
[`toIPv4`](#toIPv4) と同様ですが、変換エラー時に例外を送出する代わりに、ゼロ値の IPv4 アドレス (`0.0.0.0`) を返します。

サポートされる引数:

* ドット区切り 10 進数表記の IPv4 アドレス文字列表現。
* IPv4 アドレスの整数表現。

サポートされない引数（ゼロ値の IPv4 アドレスを返す）:

* 無効な IP アドレス形式。
* IPv6 アドレス。
* 範囲外の値。

**構文**

```sql
toIPv4OrZero(x)
```

**引数**

* `x` — IPv4 アドレスの文字列または整数による表現。[`String`](/sql-reference/data-types/string) または [`Integer`](/sql-reference/data-types/int-uint)

**返される値**

成功した場合は IPv4 アドレスを返し、失敗した場合はゼロの IPv4 アドレス (`0.0.0.0`) を返します。[`IPv4`](/sql-reference/data-types/ipv4)

**例**

**使用例**

```sql title=Query
SELECT
    toIPv4OrZero('192.168.1.1') AS valid_ip,
    toIPv4OrZero('invalid.ip') AS invalid_ip
```

```response title=Response
┌─valid_ip────┬─invalid_ip─┐
│ 192.168.1.1 │ 0.0.0.0    │
└─────────────┴────────────┘
```

## toIPv6 \\{#toIPv6\\}

導入バージョン: v20.1

IPv6 アドレスの文字列または `UInt128` 表現を [`IPv6`](../data-types/ipv6.md) 型に変換します。
文字列の場合、IPv6 アドレスの形式が無効なときは空の値を返します。
IPv6 アドレスをバイナリ形式（`FixedString(16)`）に変換したり、その逆を行う [`IPv6StringToNum`](/sql-reference/functions/ip-address-functions#IPv6StringToNum) 関数および [`IPv6NumToString`](/sql-reference/functions/ip-address-functions#IPv6NumToString) 関数と類似しています。

入力文字列に有効な IPv4 アドレスが含まれている場合、その IPv4 アドレスに対応する IPv6 アドレスが返されます。

**構文**

```sql
toIPv6(x)
```

**引数**

* `x` — IP アドレス。[`String`](/sql-reference/data-types/string) または [`UInt128`](/sql-reference/data-types/int-uint)

**戻り値**

IPv6 アドレスを返します。[`IPv6`](/sql-reference/data-types/ipv6)

**例**

**使用例**

```sql title=Query
WITH '2001:438:ffff::407d:1bc1' AS IPv6_string
SELECT
    hex(IPv6StringToNum(IPv6_string)),
    hex(toIPv6(IPv6_string));
```

```response title=Response
┌─hex(IPv6StringToNum(IPv6_string))─┬─hex(toIPv6(IPv6_string))─────────┐
│ 20010438FFFF000000000000407D1BC1  │ 20010438FFFF000000000000407D1BC1 │
└───────────────────────────────────┴──────────────────────────────────┘
```

**IPv4 から IPv6 へのマッピング**

```sql title=Query
SELECT toIPv6('127.0.0.1');
```

```response title=Response
┌─toIPv6('127.0.0.1')─┐
│ ::ffff:127.0.0.1    │
└─────────────────────┘
```

## toIPv6OrDefault \\{#toIPv6OrDefault\\}

導入: v22.3

文字列または IPv6 アドレスの UInt128 形式を [`IPv6`](../data-types/ipv6.md) 型に変換します。
IPv6 アドレスの形式が不正な場合は、`::` (0 IPv6) または指定されたデフォルトの IPv6 アドレスを返します。

**構文**

```sql
toIPv6OrDefault(string[, default])
```

**引数**

* `string` — 変換する IP アドレス文字列。
* `default` — 省略可能。`string` の形式が無効な場合に返す値。

**返り値**

IPv6 アドレスを返します。`string` 引数の形式が無効な場合は `::` を返すか、指定されている場合は `default` の値を返します。[`IPv6`](/sql-reference/data-types/ipv6)

**例**

**有効および無効な IPv6 文字列**

```sql title=Query
WITH
    '2001:0db8:85a3:0000:0000:8a2e:0370:7334' AS 有効なIPv6文字列,
    '2001:0db8:85a3::8a2e:370g:7334' AS 無効なIPv6文字列,
    'not_an_ipv6' AS 不正な形式の文字列
SELECT
    toIPv6OrDefault(有効なIPv6文字列) AS 有効,
    toIPv6OrDefault(無効なIPv6文字列) AS デフォルト値,
    toIPv6OrDefault(不正な形式の文字列, toIPv6('::1')) AS 指定デフォルト;
```

```response title=Response
┌─有効──────────────────────────────────┬─デフォルト値─┬─指定されたデフォルト値─┐
│ 2001:db8:85a3::8a2e:370:7334           │ ::            │ ::1              │
└────────────────────────────────────────┴───────────────┴──────────────────┘
```

## toIPv6OrNull \\{#toIPv6OrNull\\}

導入バージョン: v22.3

入力値を `IPv6` 型の値に変換しますが、エラーが発生した場合は `NULL` を返します。
[`toIPv6`](#toIPv6) と同様ですが、変換エラー時に例外をスローする代わりに `NULL` を返します。

サポートされる引数:

* 標準表記による IPv6 アドレスの文字列表現。
* IPv4 マップド IPv6 アドレスに変換される、IPv4 アドレスの文字列表現。
* IPv6 アドレスのバイナリ表現。

サポートされていない引数（`NULL` を返す）:

* 無効な IP アドレス形式。
* 不正な形式の IPv6 アドレス。
* 範囲外の値。
* 無効な表記。

**構文**

```sql
toIPv6OrNull(x)
```

**引数**

* `x` — IPv6 または IPv4 アドレスの文字列表現。[`String`](/sql-reference/data-types/string)

**戻り値**

成功した場合は IPv6 アドレスを、失敗した場合は `NULL` を返します。[`IPv6`](/sql-reference/data-types/ipv6) または [`NULL`](/sql-reference/syntax#null)

**例**

**使用例**

```sql title=Query
SELECT
    toIPv6OrNull('2001:0db8:85a3:0000:0000:8a2e:0370:7334') AS valid_ipv6,
    toIPv6OrNull('invalid::ip') AS invalid_ipv6
```

```response title=Response
┌─valid_ipv6──────────────────────────┬─invalid_ipv6─┐
│ 2001:db8:85a3::8a2e:370:7334        │         ᴺᵁᴸᴸ │
└─────────────────────────────────────┴──────────────┘
```

## toIPv6OrZero \\{#toIPv6OrZero\\}

導入バージョン: v23.1

入力値を[IPv6](../data-types/ipv6.md)型の値に変換しますが、エラー時にはゼロの IPv6 アドレスを返します。
[`toIPv6`](#toIPv6) と同様に動作しますが、変換エラー時に例外をスローする代わりにゼロの IPv6 アドレス（`::`）を返します。

サポートされる引数:

* 標準表記による IPv6 アドレスの文字列表現。
* IPv4 マップド IPv6 アドレスに変換される IPv4 アドレスの文字列表現。
* IPv6 アドレスのバイナリ表現。

サポートされない引数（ゼロの IPv6 アドレスを返す）:

* 無効な IP アドレス形式。
* 不正形式の IPv6 アドレス。
* 範囲外の値。

**構文**

```sql
toIPv6OrZero(x)
```

**引数**

* `x` — IPv6 または IPv4 アドレスの文字列表現。[`String`](/sql-reference/data-types/string)

**戻り値**

成功した場合は IPv6 アドレスを返し、失敗した場合はゼロの IPv6 アドレス (`::`) を返します。[`IPv6`](/sql-reference/data-types/ipv6)

**例**

**使用例**

```sql title=Query
SELECT
    toIPv6OrZero('2001:0db8:85a3:0000:0000:8a2e:0370:7334') AS valid_ipv6,
    toIPv6OrZero('invalid::ip') AS invalid_ipv6
```

```response title=Response
┌─valid_ipv6──────────────────────────┬─invalid_ipv6─┐
│ 2001:db8:85a3::8a2e:370:7334        │ ::           │
└─────────────────────────────────────┴──────────────┘
```

{/*AUTOGENERATED_END*/ }
