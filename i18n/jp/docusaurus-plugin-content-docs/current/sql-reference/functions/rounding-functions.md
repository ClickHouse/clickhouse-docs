---
description: '丸め関数に関するドキュメント'
sidebar_label: '丸め'
slug: /sql-reference/functions/rounding-functions
title: '丸め関数'
doc_type: 'reference'
---

# 丸め関数 \\{#rounding-functions\\}

:::note
以下のドキュメントは、`system.functions` システムテーブルから自動生成されたものです。
:::

{/* 
  以下のタグ内の内容は、ドキュメントフレームワークのビルド時に
  system.functions から自動生成されたドキュメントで置き換えられます。タグを変更または削除しないでください。
  詳細は https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md を参照してください。
  */ }

{/*AUTOGENERATED_START*/ }

## ceil \\{#ceil\\}

導入バージョン: v1.1

[`floor`](#floor) と同様ですが、`x` 以上となるように丸められた最小の数値を返します。
丸めによってオーバーフローが発生した場合（例: `ceiling(255, -1)`）、結果は未定義です。

**構文**

```sql
ceiling(x[, N])
```

**エイリアス**: `ceiling`

**引数**

* `x` — 丸める値。[`Float*`](/sql-reference/data-types/float) または [`Decimal*`](/sql-reference/data-types/decimal) または [`(U)Int*`](/sql-reference/data-types/int-uint)
* `N` — 省略可。丸める小数点以下の桁数。デフォルトは 0 で、これは整数への丸めを意味します。負の値も指定可能です。[`(U)Int*`](/sql-reference/data-types/int-uint)

**返される値**

`x` と同じ型の丸められた数値を返します。[`Float*`](/sql-reference/data-types/float) または [`Decimal*`](/sql-reference/data-types/decimal) または [`(U)Int*`](/sql-reference/data-types/int-uint)

**例**

**基本的な使用例**

```sql title=Query
SELECT ceiling(123.45, 1) AS rounded
```

```response title=Response
┌─rounded─┐
│   123.5 │
└─────────┘
```

**負の精度**

```sql title=Query
SELECT ceiling(123.45, -1)
```

```response title=Response
┌─ceiling(123.45, -1)─┐
│                 130 │
└─────────────────────┘
```

## floor \\{#floor\\}

導入: v1.1

`x` 以下で最大となる丸め後の数値を返します。この丸め後の数値は `1 / 10 * N` の倍数であるか、`1 / 10 * N` が正確に表現できない場合は、対応するデータ型で表現可能な最も近い数値です。

整数の引数は、`N` を負の値にすることで丸めることができます。
`N` が負でない場合、この関数は `x` をそのまま返します。

丸めによってオーバーフローが発生した場合（例: `floor(-128, -1)`）、結果は未定義です。

**構文**

```sql
floor(x[, N])
```

**引数**

* `x` — 丸め対象の値。[`Float*`](/sql-reference/data-types/float) または [`Decimal*`](/sql-reference/data-types/decimal) または [`(U)Int*`](/sql-reference/data-types/int-uint)
* `N` — 省略可。丸め先の小数桁数。既定値は 0 で、この場合は整数に丸めます。負の値も指定可能です。[`(U)Int*`](/sql-reference/data-types/int-uint)

**返される値**

`x` と同じ型の丸め後の数値を返します。[`Float*`](/sql-reference/data-types/float) または [`Decimal*`](/sql-reference/data-types/decimal) または [`(U)Int*`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT floor(123.45, 1) AS rounded
```

```response title=Response
┌─rounded─┐
│   123.4 │
└─────────┘
```

**負の精度**

```sql title=Query
SELECT floor(123.45, -1)
```

```response title=Response
┌─floor(123.45, -1)─┐
│               120 │
└───────────────────┘
```

## round \\{#round\\}

導入バージョン: v1.1

値を `N` で指定された小数桁数に丸めます。

* `N > 0` の場合、小数点の右側の桁に丸めます。
* `N < 0` の場合、小数点の左側の桁に丸めます。
* `N = 0` の場合、最も近い整数に丸めます。

この関数は、指定された桁における最も近い数値を返します。
入力値が両隣の数値から等距離の場合、`Float*` 型の入力に対してはバンカーズラウンディング（銀行丸め）を使用し、それ以外の数値型（`Decimal*`）に対してはゼロから遠ざかる方向に丸めます。

丸めによってオーバーフローが発生する場合（例: `round(255, -1)`）、結果は未定義です。

**構文**

```sql
round(x[, N])
```

**引数**

* `x` — 丸める対象の数値。[`Float*`](/sql-reference/data-types/float) または [`Decimal*`](/sql-reference/data-types/decimal) または [`(U)Int*`](/sql-reference/data-types/int-uint)
* `N` — 省略可能。丸める小数点以下の桁数を指定します。省略時は `0` です。[`(U)Int*`](/sql-reference/data-types/int-uint)

**戻り値**

`x` と同じ型の丸められた数値を返します。[`Float*`](/sql-reference/data-types/float) または [`Decimal*`](/sql-reference/data-types/decimal) または [`(U)Int*`](/sql-reference/data-types/int-uint)

**例**

**Float 型の入力**

```sql title=Query
SELECT number / 2 AS x, round(x) FROM system.numbers LIMIT 3;
```

```response title=Response
┌───x─┬─round(x)─┐
│   0 │        0 │
│ 0.5 │        0 │
│   1 │        1 │
└─────┴──────────┘
```

**10進数の入力**

```sql title=Query
SELECT cast(number / 2 AS  Decimal(10,4)) AS x, round(x) FROM system.numbers LIMIT 3;
```

```response title=Response
┌───x─┬─round(x)─┐
│   0 │        0 │
│ 0.5 │        1 │
│   1 │        1 │
└─────┴──────────┘
```

## roundAge \\{#roundAge\\}

導入バージョン: v1.1

人の年齢を表す数値を受け取り、標準的な年齢帯と比較し、その数値が属する年齢帯の上限または下限の値を返します。

* `age < 1` の場合、`0` を返します。
* `1 ≤ age ≤ 17` の場合、`17` を返します。
* `18 ≤ age ≤ 24` の場合、`18` を返します。
* `25 ≤ age ≤ 34` の場合、`25` を返します。
* `35 ≤ age ≤ 44` の場合、`35` を返します。
* `45 ≤ age ≤ 54` の場合、`45` を返します。
* `age ≥ 55` の場合、`55` を返します。

**構文**

```sql
roundAge(num)
```

**引数**

* `age` — 年齢（年単位）を表す数値。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float)

**返り値**

`age` が属する範囲の、上限または下限のいずれかの年齢を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT *, roundAge(*) FROM system.numbers WHERE number IN (0, 5, 20, 31, 37, 54, 72);
```

```response title=Response
┌─number─┬─roundAge(number)─┐
│      0 │                0 │
│      5 │               17 │
│     20 │               18 │
│     31 │               25 │
│     37 │               35 │
│     54 │               45 │
│     72 │               55 │
└────────┴──────────────────┘
```

## roundBankers \\{#roundBankers\\}

導入バージョン: v20.1

数値を指定した小数桁 `N` に丸めます。
丸め対象の値が 2 つの数値のちょうど中間の場合、この関数は、IEEE 754 で浮動小数点数のデフォルトの丸め方法として規定されている、バンカーズラウンディング（銀行丸め）と呼ばれる方式で丸めを行います。

* `N > 0` の場合、小数点より右側を丸めます
* `N < 0` の場合、小数点より左側を丸めます
* `N = 0` の場合、最も近い整数に丸めます

:::info Notes

* 丸め対象の値が 2 つの数値のちょうど中間の場合、指定した小数桁において、最も近い偶数の桁に丸められます。
  例: `3.5` は `4` に切り上げられ、`2.5` は `2` に切り下げられます。
* `round` 関数は、浮動小数点数に対して同じ丸めを行います。
* `roundBankers` 関数は整数に対しても同じ方法で丸めを行います。例えば、`roundBankers(45, -1) = 40` となります。
* その他の場合、この関数は最も近い整数へ丸めます。
  :::

:::tip 合計や減算にはバンカーズラウンディングを使用する
バンカーズラウンディングを使用することで、丸めがそれらの合計値や差分の結果に与える影響を軽減できます。

例として、`1.5, 2.5, 3.5, 4.5` を異なる丸め方法で合計します:

* 丸めなし: `1.5 + 2.5 + 3.5 + 4.5 = 12`。
* バンカーズラウンディング: `2 + 2 + 4 + 4 = 12`。
* 最も近い整数への丸め: `2 + 3 + 4 + 5 = 14`。
  :::

**構文**

```sql
roundBankers(x[, N])
```

**引数**

* `x` — 丸め対象の数値。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Decimal*`](/sql-reference/data-types/decimal) または [`Float*`](/sql-reference/data-types/float)
* `[, N]` — 省略可能。丸める小数点以下の桁数。指定しない場合は `0`。[`(U)Int*`](/sql-reference/data-types/int-uint)

**返される値**

銀行丸め（banker&#39;s rounding）方式で丸められた値を返します。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Decimal*`](/sql-reference/data-types/decimal) または [`Float*`](/sql-reference/data-types/float)

**例**

**基本的な使い方**

```sql title=Query
SELECT number / 2 AS x, roundBankers(x, 0) AS b FROM system.numbers LIMIT 10
```

```response title=Response
┌───x─┬─b─┐
│   0 │ 0 │
│ 0.5 │ 0 │
│   1 │ 1 │
│ 1.5 │ 2 │
│   2 │ 2 │
│ 2.5 │ 2 │
│   3 │ 3 │
│ 3.5 │ 4 │
│   4 │ 4 │
│ 4.5 │ 4 │
└─────┴───┘
```

## roundDown \\{#roundDown\\}

導入バージョン: v20.1

数値を指定された配列内のいずれかの要素に切り捨てます。
値が下限値より小さい場合は、下限値が返されます。

**構文**

```sql
roundDown(num, arr)
```

**引数**

* `num` — 切り捨てる対象の数値。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Decimal*`](/sql-reference/data-types/decimal) または [`Float*`](/sql-reference/data-types/float)
* `arr` — `num` を切り捨てる先となる値の配列。[`Array((U)Int*)`](/sql-reference/data-types/array) または [`Array(Float*)`](/sql-reference/data-types/array)

**戻り値**

`arr` 内の要素のうち、`num` を切り捨てた結果の値を返します。値が配列内の最小値より小さい場合は、その最小値を返します。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float)

**例**

**使用例**

```sql title=Query
SELECT *, roundDown(*, [3, 4, 5]) FROM system.numbers WHERE number IN (0, 1, 2, 3, 4, 5)
```

```response title=Response
┌─number─┬─roundDown(number, [3, 4, 5])─┐
│      0 │                            3 │
│      1 │                            3 │
│      2 │                            3 │
│      3 │                            3 │
│      4 │                            4 │
│      5 │                            5 │
└────────┴──────────────────────────────┘
```

## roundDuration \\{#roundDuration\\}

導入バージョン: v1.1

一般的に使用される時間間隔 `1, 10, 30, 60, 120, 180, 240, 300, 600, 1200, 1800, 3600, 7200, 18000, 36000` の集合の中から、与えられた数値をそれ以下で最も近い値に切り捨てます。\
数値が 1 未満の場合は `0` を返します。

**構文**

```sql
roundDuration(num)
```

**引数**

* `num` — 一般的によく使われる継続時間の集合のいずれかの値に丸める数値。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float)

**戻り値**

`num` &lt; 1 の場合は `0` を返します。それ以外の場合は、次のいずれかの値を返します: `1, 10, 30, 60, 120, 180, 240, 300, 600, 1200, 1800, 3600, 7200, 18000, 36000`。[`UInt16`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT *, roundDuration(*) FROM system.numbers WHERE number IN (0, 9, 19, 47, 101, 149, 205, 271, 421, 789, 1423, 2345, 4567, 9876, 24680, 42573)
```

```response title=Response
┌─number─┬─roundDuration(number)─┐
│      0 │                     0 │
│      9 │                     1 │
│     19 │                    10 │
│     47 │                    30 │
│    101 │                    60 │
│    149 │                   120 │
│    205 │                   180 │
│    271 │                   240 │
│    421 │                   300 │
│    789 │                   600 │
│   1423 │                  1200 │
│   2345 │                  1800 │
│   4567 │                  3600 │
│   9876 │                  7200 │
│  24680 │                 18000 │
│  42573 │                 36000 │
└────────┴───────────────────────┘
```

## roundToExp2 \\{#roundToExp2\\}

導入バージョン: v1.1

数値を、それ以下で最も近い（非負の整数）2 の冪に切り下げます。
数値が 1 未満の場合は `0` を返します。

**構文**

```sql
roundToExp2(num)
```

**引数**

* `num` — 丸める数値。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float)

**戻り値**

`num` 以下で最大の（0 以上の整数の）2 のべき乗に切り下げた値を返します。`num < 1` の場合は `0` を返します。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float)

**例**

**使用例**

```sql title=Query
SELECT *, roundToExp2(*) FROM system.numbers WHERE number IN (0, 2, 5, 10, 19, 50)
```

```response title=Response
┌─number─┬─roundToExp2(number)─┐
│      0 │                   0 │
│      2 │                   2 │
│      5 │                   4 │
│     10 │                   8 │
│     19 │                  16 │
│     50 │                  32 │
└────────┴─────────────────────┘
```

## trunc \\{#trunc\\}

導入バージョン: v1.1

[`floor`](#floor) に似ていますが、`x` の絶対値以下で可能な限り大きな絶対値となるように丸めた値を返します。

**構文**

```sql
truncate(x[, N])
```

**別名**: `truncate`

**引数**

* `x` — 丸める値。[`Float*`](/sql-reference/data-types/float) または [`Decimal*`](/sql-reference/data-types/decimal) または [`(U)Int*`](/sql-reference/data-types/int-uint)
* `N` — 省略可能。丸める小数桁数。既定値は 0 で、この場合は整数に丸めます。[`(U)Int*`](/sql-reference/data-types/int-uint)

**戻り値**

`x` と同じ型の丸められた値を返します。[`Float*`](/sql-reference/data-types/float) または [`Decimal*`](/sql-reference/data-types/decimal) または [`(U)Int*`](/sql-reference/data-types/int-uint)

**例**

**基本的な使用例**

```sql title=Query
SELECT truncate(123.499, 1) AS res;
```

```response title=Response
┌───res─┐
│ 123.4 │
└───────┘
```

{/*AUTOGENERATED_END*/ }
