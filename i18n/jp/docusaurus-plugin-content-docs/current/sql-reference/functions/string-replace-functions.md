---
description: '文字列置換関数のドキュメント'
sidebar_label: '文字列置換'
slug: /sql-reference/functions/string-replace-functions
title: '文字列置換関数'
doc_type: 'reference'
keywords: ['文字列置換']
---



# 文字列置換関数

[一般的な文字列関数](string-functions.md)と[文字列内検索関数](string-search-functions.md)については別途説明しています。

:::note
以下のドキュメントは`system.functions`システムテーブルから自動生成されています。
:::

<!--
以下のタグ内のコンテンツは、ドキュメントフレームワークのビルド時にsystem.functionsから生成されたドキュメントで置き換えられます。タグの変更や削除は行わないでください。
参照: https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
-->


<!--AUTOGENERATED_START-->

## format {#format}

導入バージョン: v20.1

引数に指定された値(文字列、整数など)を使用して`pattern`文字列をフォーマットします。Pythonのフォーマット機能と同様の動作をします。
パターン文字列には、中括弧`{}`で囲まれた置換フィールドを含めることができます。
中括弧に含まれていない部分はリテラルテキストとして扱われ、そのまま出力にコピーされます。
リテラルの中括弧文字は、二重の中括弧`{{`および`}}`でエスケープできます。
フィールド名には数値(ゼロから開始)または空を指定できます(空の場合は暗黙的に単調増加する数値が割り当てられます)。

**構文**

```sql
format(pattern, s0[, s1, ...])
```

**引数**

- `pattern` — プレースホルダーを含むフォーマット文字列。[`String`](/sql-reference/data-types/string)
- `s0[, s1, ...]` — パターンに置換する1つ以上の値。[`Any`](/sql-reference/data-types)

**戻り値**

フォーマットされた文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**番号付きプレースホルダー**

```sql title=クエリ
SELECT format('{1} {0} {1}', 'World', 'Hello')
```

```response title=結果
┌─format('{1} {0} {1}', 'World', 'Hello')─┐
│ Hello World Hello                       │
└─────────────────────────────────────────┘
```

**暗黙的な番号付け**

```sql title=クエリ
SELECT format('{} {}', 'Hello', 'World')
```

```response title=結果
┌─format('{} {}', 'Hello', 'World')─┐
│ Hello World                       │
└───────────────────────────────────┘
```


## overlay {#overlay}

導入バージョン: v24.9

文字列 `input` の一部を別の文字列 `replace` で置き換えます。置き換えは1ベースのインデックス `offset` から開始されます。

**構文**

```sql
overlay(s, replace, offset[, length])
```

**引数**

- `s` — 入力文字列。[`String`](/sql-reference/data-types/string)
- `replace` — 置き換え文字列。[`const String`](/sql-reference/data-types/string)
- `offset` — 整数型 `Int`(1ベース)。`offset` が負の場合、文字列 `s` の末尾から数えられます。[`Int`](/sql-reference/data-types/int-uint)
- `length` — オプション。整数型 `Int`。`length` は入力文字列 `s` 内で置き換えられる部分の長さを指定します。`length` が指定されていない場合、`s` から削除されるバイト数は `replace` の長さと等しくなります。それ以外の場合は `length` バイトが削除されます。[`Int`](/sql-reference/data-types/int-uint)

**戻り値**

置き換え後の文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**基本的な置き換え**

```sql title=Query
SELECT overlay('My father is from Mexico.', 'mother', 4) AS res;
```

```response title=Response
┌─res──────────────────────┐
│ My mother is from Mexico.│
└──────────────────────────┘
```

**長さを指定した置き換え**

```sql title=Query
SELECT overlay('My father is from Mexico.', 'dad', 4, 6) AS res;
```

```response title=Response
┌─res───────────────────┐
│ My dad is from Mexico.│
└───────────────────────┘
```


## overlayUTF8 {#overlayUTF8}

導入バージョン: v24.9

1ベースのインデックス `offset` を開始位置として、文字列 `s` の一部を別の文字列 `replace` で置き換えます。
文字列が有効なUTF-8エンコードテキストを含むことを前提としています。
この前提が満たされない場合、例外はスローされず、結果は未定義となります。

**構文**

```sql
overlayUTF8(s, replace, offset[, length])
```

**引数**

- `s` — 入力文字列。[`String`](/sql-reference/data-types/string)
- `replace` — 置き換え文字列。[`const String`](/sql-reference/data-types/string)
- `offset` — 整数型 `Int`(1ベース)。`offset` が負の場合、入力文字列 `s` の末尾からカウントされます。[`(U)Int*`](/sql-reference/data-types/int-uint)
- `length` — オプション。入力文字列 `s` 内で置き換える部分の長さを指定します。`length` が指定されていない場合、`s` から削除される文字数は `replace` の長さと等しくなります。指定されている場合は `length` 文字が削除されます。[`(U)Int*`](/sql-reference/data-types/int-uint)

**戻り値**

置き換え後の文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**UTF-8置き換え**

```sql title=Query
SELECT overlayUTF8('Mein Vater ist aus Österreich.', 'der Türkei', 20) AS res;
```

```response title=Response
┌─res───────────────────────────┐
│ Mein Vater ist aus der Türkei.│
└───────────────────────────────┘
```


## printf {#printf}

導入バージョン: v24.8

`printf`関数は、C++のprintf関数と同様に、引数に指定された値(文字列、整数、浮動小数点数など)を使用して文字列をフォーマットします。
フォーマット文字列には、`%`文字で始まるフォーマット指定子を含めることができます。
`%`とそれに続くフォーマット指定子以外の部分は、リテラルテキストとして扱われ、そのまま出力にコピーされます。
リテラルの`%`文字は`%%`でエスケープできます。

**構文**

```sql
printf(format[, sub1, sub2, ...])
```

**引数**

- `format` — `%`指定子を含むフォーマット文字列。[`String`](/sql-reference/data-types/string)
- `sub1, sub2, ...` — オプション。フォーマット文字列に置換する0個以上の値。[`Any`](/sql-reference/data-types)

**戻り値**

フォーマットされた文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**C++スタイルのフォーマット**

```sql title=Query
SELECT printf('%%%s %s %d', 'Hello', 'World', 2024);
```

```response title=Response
┌─printf('%%%s %s %d', 'Hello', 'World', 2024)─┐
│ %Hello World 2024                            │
└──────────────────────────────────────────────┘
```


## regexpQuoteMeta {#regexpQuoteMeta}

導入バージョン: v20.1

正規表現において特別な意味を持つ次の文字の前にバックスラッシュを追加します: `\0`, `\\`, `|`, `(`, `)`, `^`, `$`, `.`, `[`, `]`, `?`, `*`, `+`, `{`, `:`, `-`。
この実装は re2::RE2::QuoteMeta とわずかに異なります。
ゼロバイトを `\x00` ではなく `\0` としてエスケープし、必要な文字のみをエスケープします。

**構文**

```sql
regexpQuoteMeta(s)
```

**引数**

- `s` — 正規表現用にエスケープする文字を含む入力文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

正規表現の特殊文字がエスケープされた文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**正規表現の特殊文字をエスケープ**

```sql title=Query
SELECT regexpQuoteMeta('Hello. [World]? (Yes)*') AS res
```

```response title=Response
┌─res───────────────────────────┐
│ Hello\. \[World\]\? \(Yes\)\* │
└───────────────────────────────┘
```


## replaceAll {#replaceAll}

導入バージョン: v1.1

`haystack` 内の部分文字列 `pattern` のすべての出現箇所を `replacement` 文字列で置き換えます。

**構文**

```sql
replaceAll(haystack, pattern, replacement)
```

**エイリアス**: `replace`

**引数**

- `haystack` — 検索対象の入力文字列。[`String`](/sql-reference/data-types/string)
- `pattern` — 検索して置き換える部分文字列。[`const String`](/sql-reference/data-types/string)
- `replacement` — パターンを置き換える文字列。[`const String`](/sql-reference/data-types/string)

**戻り値**

パターンのすべての出現箇所が置き換えられた文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**すべての出現箇所を置き換え**

```sql title=クエリ
SELECT replaceAll('Hello, Hello world', 'Hello', 'Hi') AS res;
```

```response title=レスポンス
┌─res──────────┐
│ Hi, Hi world │
└──────────────┘
```


## replaceOne {#replaceOne}

導入バージョン: v1.1

`haystack` 内の部分文字列 `pattern` の最初の出現を `replacement` 文字列で置換します。

**構文**

```sql
replaceOne(haystack, pattern, replacement)
```

**引数**

- `haystack` — 検索対象の入力文字列。[`String`](/sql-reference/data-types/string)
- `pattern` — 検索して置換する部分文字列。[`const String`](/sql-reference/data-types/string)
- `replacement` — パターンを置換する文字列。[`const String`](/sql-reference/data-types/string)

**戻り値**

パターンの最初の出現が置換された文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**最初の出現を置換**

```sql title=クエリ
SELECT replaceOne('Hello, Hello world', 'Hello', 'Hi') AS res;
```

```response title=レスポンス
┌─res─────────────┐
│ Hi, Hello world │
└─────────────────┘
```


## replaceRegexpAll {#replaceRegexpAll}

導入バージョン: v1.1

`replaceRegexpOne`と同様ですが、パターンのすべての出現箇所を置換します。
例外として、正規表現が空の部分文字列にマッチした場合、置換は1回のみ行われます。

**構文**

```sql
replaceRegexpAll(haystack, pattern, replacement)
```

**エイリアス**: `REGEXP_REPLACE`

**引数**

- `haystack` — 検索対象の入力文字列。[`String`](/sql-reference/data-types/string)
- `pattern` — 検索する正規表現パターン。[`const String`](/sql-reference/data-types/string)
- `replacement` — パターンを置換する文字列。後方参照を含めることができます。[`const String`](/sql-reference/data-types/string)

**戻り値**

すべての正規表現マッチが置換された文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**すべての文字を2倍にして置換**

```sql title=クエリ
SELECT replaceRegexpAll('Hello123', '.', '\\\\0\\\\0') AS res
```

```response title=結果
┌─res──────────────────┐
│ HHeelllloo112233     │
└──────────────────────┘
```

**空の部分文字列の置換例**

```sql title=クエリ
SELECT replaceRegexpAll('Hello, World!', '^', 'here: ') AS res
```

```response title=結果
┌─res─────────────────┐
│ here: Hello, World! │
└─────────────────────┘
```


## replaceRegexpOne {#replaceRegexpOne}

導入バージョン: v1.1

`haystack` 内で正規表現 `pattern`(re2構文)に一致する最初の部分文字列を `replacement` 文字列で置換します。
`replacement` には置換記号 `\0-\9` を含めることができます。
置換記号 `\1-\9` は1番目から9番目のキャプチャグループ(サブマッチ)に対応し、置換記号 `\0` はマッチ全体に対応します。
`pattern` または `replacement` 文字列内でリテラルの `\` 文字を使用するには、`\` でエスケープしてください。
また、文字列リテラルには追加のエスケープが必要であることに注意してください。

**構文**

```sql
replaceRegexpOne(haystack, pattern, replacement)
```

**引数**

- `haystack` — 検索対象の入力文字列。[`String`](/sql-reference/data-types/string)
- `pattern` — 検索する正規表現パターン。[`const String`](/sql-reference/data-types/string)
- `replacement` — パターンを置換する文字列。置換記号を含めることができます。[`const String`](/sql-reference/data-types/string)

**戻り値**

最初の正規表現マッチが置換された文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**ISO日付をアメリカ形式に変換**

```sql title=クエリ
SELECT DISTINCT
    EventDate,
    replaceRegexpOne(toString(EventDate), '(\\d{4})-(\\d{2})-(\\d{2})', '\\2/\\3/\\1') AS res
FROM test.hits
LIMIT 7
FORMAT TabSeparated
```

```response title=レスポンス
2014-03-17      03/17/2014
2014-03-18      03/18/2014
2014-03-19      03/19/2014
2014-03-20      03/20/2014
2014-03-21      03/21/2014
2014-03-22      03/22/2014
2014-03-23      03/23/2014
```

**文字列を10回コピー**

```sql title=クエリ
SELECT replaceRegexpOne('Hello, World!', '.*', '\\\\0\\\\0\\\\0\\\\0\\\\0\\\\0\\\\0\\\\0\\\\0\\\\0') AS res
```

```response title=レスポンス
┌─res────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ Hello, World!Hello, World!Hello, World!Hello, World!Hello, World!Hello, World!Hello, World!Hello, World!Hello, World!Hello, World! │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```


## translate {#translate}

導入バージョン: v22.7

文字列 `s` 内の文字を、`from` と `to` の文字列で定義された一対一の文字マッピングを使用して置換します。
`from` と `to` は定数のASCII文字列である必要があります。
`from` と `to` が同じ長さの場合、`s` 内の `from` の1文字目の各出現箇所は `to` の1文字目に置換され、`s` 内の `from` の2文字目は `to` の2文字目に置換される、といった具合に処理されます。
`from` が `to` よりも多くの文字を含む場合、`to` に対応する文字がない `from` の末尾の文字のすべての出現箇所は `s` から削除されます。
`s` 内の非ASCII文字はこの関数によって変更されません。

**構文**

```sql
translate(s, from, to)
```

**引数**

- `s` — 変換対象の入力文字列。[`String`](/sql-reference/data-types/string)
- `from` — 置換する文字を含む定数ASCII文字列。[`const String`](/sql-reference/data-types/string)
- `to` — 置換後の文字を含む定数ASCII文字列。[`const String`](/sql-reference/data-types/string)

**戻り値**

文字変換が適用された文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**文字マッピング**

```sql title=Query
SELECT translate('Hello, World!', 'delor', 'DELOR') AS res
```

```response title=Response
┌─res───────────┐
│ HELLO, WORLD! │
└───────────────┘
```

**異なる長さ**

```sql title=Query
SELECT translate('clickhouse', 'clickhouse', 'CLICK') AS res
```

```response title=Response
┌─res───┐
│ CLICK │
└───────┘
```


## translateUTF8 {#translateUTF8}

導入バージョン: v22.7

[`translate`](#translate)と同様ですが、`s`、`from`、`to`がUTF-8エンコードされた文字列であることを前提とします。

**構文**

```sql
translateUTF8(s, from, to)
```

**引数**

- `s` — 変換するUTF-8入力文字列。[`String`](/sql-reference/data-types/string)
- `from` — 置換対象の文字を含む定数UTF-8文字列。[`const String`](/sql-reference/data-types/string)
- `to` — 置換後の文字を含む定数UTF-8文字列。[`const String`](/sql-reference/data-types/string)

**戻り値**

`String`データ型の値を返します。[`String`](/sql-reference/data-types/string)

**例**

**UTF-8文字の変換**

```sql title=Query
SELECT translateUTF8('Münchener Straße', 'üß', 'us') AS res;
```

```response title=Response
┌─res──────────────┐
│ Munchener Strase │
└──────────────────┘
```

<!--AUTOGENERATED_END-->
