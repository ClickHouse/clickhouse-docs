---
description: '「その他」カテゴリの関数に関するドキュメント'
sidebar_label: 'その他'
slug: /sql-reference/functions/other-functions
title: 'その他の関数'
doc_type: 'reference'
---

import ExperimentalBadge from '@theme/badges/ExperimentalBadge';
import CloudNotSupportedBadge from '@theme/badges/CloudNotSupportedBadge';
import DeprecatedBadge from '@theme/badges/DeprecatedBadge';


# その他の関数

:::note
以下の関数のドキュメントは、`system.functions` システムテーブルから自動生成されています。
:::

{/* 
  以下のタグ内のコンテンツは、ドキュメントフレームワークのビルド時に
  system.functions から自動生成されたドキュメントで置き換えられます。タグを変更または削除しないでください。
  詳細は次を参照してください: https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
  */ }


{/*AUTOGENERATED_START*/ }

## FQDN

導入バージョン: v20.1

ClickHouse サーバーの完全修飾ドメイン名を返します。

**構文**

```sql
fqdn()
```

**別名**: `fullHostName`

**引数**

* なし。

**戻り値**

ClickHouse サーバーの完全修飾ドメイン名を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT fqdn()
```

```response title=Response
┌─FQDN()──────────────────────────┐
│ clickhouse.us-east-2.internal │
└─────────────────────────────────┘
```


## MACNumToString

導入バージョン: v1.1

[`UInt64`](/sql-reference/data-types/int-uint) 数値をビッグエンディアン形式の MAC アドレスとして解釈します。
対応する MAC アドレスを、`AA:BB:CC:DD:EE:FF`（コロン区切りの 16 進数表記）の文字列として返します。

**構文**

```sql
MACNumToString(num)
```

**引数**

* `num` — UInt64 の整数値。[`UInt64`](/sql-reference/data-types/int-uint)

**戻り値**

AA:BB:CC:DD:EE:FF 形式の MAC アドレスを返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT MACNumToString(149809441867716) AS mac_address;
```

```response title=Response
┌─mac_address───────┐
│ 88:00:11:22:33:44 │
└───────────────────┘
```


## MACStringToNum

導入バージョン: v1.1

MACNumToString の逆関数です。MAC アドレスの形式が無効な場合は 0 を返します。

**構文**

```sql
MACStringToNum(s)
```

**引数**

* `s` — MAC アドレスの文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

`UInt64` 型の数値を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT MACStringToNum('01:02:03:04:05:06') AS mac_numeric;
```

```response title=Response
1108152157446
```


## MACStringToOUI

導入バージョン: v1.1

AA:BB:CC:DD:EE:FF 形式（コロン区切りの16進数）で表された MAC アドレスを受け取り、先頭3オクテットを UInt64 型の整数値として返します。MAC アドレスの形式が不正な場合は 0 を返します。

**構文**

```sql
MACStringToOUI(s)
```

**引数**

* `s` — MAC アドレス文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

先頭 3 オクテットを `UInt64` 型の数値として返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT MACStringToOUI('00:50:56:12:34:56') AS oui;
```

```response title=Response
20566
```


## &#95;&#95;filterContains

導入バージョン: v25.10

JOIN のランタイムフィルタリング用の専用関数です。

**構文**

```sql
__filterContains(filter_name, key)
```

**引数**

* `filter_name` — ランタイムフィルタの内部名。BuildRuntimeFilterStep によって構築されます。[`String`](/sql-reference/data-types/string)
* `key` — フィルタに含まれているかどうかを検査する任意の型の値

**戻り値**

フィルタ内にキーが存在する場合は True を返します。[`Bool`](/sql-reference/data-types/boolean)

**使用例**

**例**

```sql title=Query
この関数はユーザークエリでの使用を想定していません。最適化処理中にクエリプランへ追加される可能性があります。
```

```response title=Response
```


## &#95;&#95;patchPartitionID

導入バージョン: v25.5

内部関数です。パーツ名と、パッチパーツの列名のハッシュ値を受け取り、パッチパーツが属するパーティション名を返します。引数には正しいパーツ名を指定する必要があり、そうでない場合の動作は未定義です。

**構文**

```sql
```

**引数**

* なし

**戻り値**

**例**


## authenticatedUser

導入バージョン: v25.11

EXECUTE AS コマンドを使用してセッションユーザーが切り替えられている場合、この関数は認証およびセッションの作成に使用された元のユーザー名を返します。
エイリアス: authUser()

**構文**

```sql
authenticatedUser()
```

**別名**: `authUser`

**引数**

* なし。

**戻り値**

認証されたユーザーの名前。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
EXECUTE as u1;
            SELECT currentUser(), authenticatedUser();
```

```response title=Response
┌─currentUser()─┬─authenticatedUser()─┐
│ u1            │ default             │
└───────────────┴─────────────────────┘
```


## bar

導入バージョン: v1.1

棒グラフを作成します。
幅が (x - min) に比例し、x = max のとき幅が width 文字となる帯を描画します。
帯は、1 文字幅を 1/8 に分割した精度で描画されます。

**構文**

```sql
bar(x, min, max[, width])
```

**引数**

* `x` — 表示するサイズ。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float) または [`Decimal`](/sql-reference/data-types/decimal)
* `min` — 最小値。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float) または [`Decimal`](/sql-reference/data-types/decimal)
* `max` — 最大値。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float) または [`Decimal`](/sql-reference/data-types/decimal)
* `width` — 省略可能。バーの幅（文字数）。デフォルトは `80`。[`const (U)Int*`](/sql-reference/data-types/int-uint) または [`const Float*`](/sql-reference/data-types/float) または [`const Decimal`](/sql-reference/data-types/decimal)

**返される値**

Unicode 文字を用いたバーを表す文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT
toHour(EventTime) AS h,
count() AS c,
bar(c, 0, 600000, 20) AS bar
FROM test.hits
GROUP BY h
ORDER BY h ASC
```

```response title=Response
┌──h─┬──────c─┬─bar────────────────┐
│  0 │ 292907 │ █████████▋         │
│  1 │ 180563 │ ██████             │
│  2 │ 114861 │ ███▋               │
│  3 │  85069 │ ██▋                │
│  4 │  68543 │ ██▎                │
│  5 │  78116 │ ██▌                │
│  6 │ 113474 │ ███▋               │
│  7 │ 170678 │ █████▋             │
│  8 │ 278380 │ █████████▎         │
│  9 │ 391053 │ █████████████      │
│ 10 │ 457681 │ ███████████████▎   │
│ 11 │ 493667 │ ████████████████▍  │
│ 12 │ 509641 │ ████████████████▊  │
│ 13 │ 522947 │ █████████████████▍ │
│ 14 │ 539954 │ █████████████████▊ │
│ 15 │ 528460 │ █████████████████▌ │
│ 16 │ 539201 │ █████████████████▊ │
│ 17 │ 523539 │ █████████████████▍ │
│ 18 │ 506467 │ ████████████████▊  │
│ 19 │ 520915 │ █████████████████▎ │
│ 20 │ 521665 │ █████████████████▍ │
│ 21 │ 542078 │ ██████████████████ │
│ 22 │ 493642 │ ████████████████▍  │
│ 23 │ 400397 │ █████████████▎     │
└────┴────────┴────────────────────┘
```


## blockNumber

導入バージョン: v1.1

行を含んでいる[ブロック](../../development/architecture.md#block)の単調に増加するシーケンス番号を返します。
返されるブロック番号の更新はベストエフォートで行われるため、完全に正確でない場合があります。

**構文**

```sql
blockNumber()
```

**引数**

* なし。

**戻り値**

行が格納されているデータブロックのシーケンス番号。[`UInt64`](/sql-reference/data-types/int-uint)

**使用例**

**基本的な使い方**

```sql title=Query
SELECT blockNumber()
FROM
(
    SELECT *
    FROM system.numbers
    LIMIT 10
) SETTINGS max_block_size = 2
```

```response title=Response
┌─blockNumber()─┐
│             7 │
│             7 │
└───────────────┘
┌─blockNumber()─┐
│             8 │
│             8 │
└───────────────┘
┌─blockNumber()─┐
│             9 │
│             9 │
└───────────────┘
┌─blockNumber()─┐
│            10 │
│            10 │
└───────────────┘
┌─blockNumber()─┐
│            11 │
│            11 │
└───────────────┘
```


## blockSerializedSize

導入バージョン: v20.3

ディスク上にある値ブロックの非圧縮サイズ（バイト単位）を返します。

**構文**

```sql
blockSerializedSize(x1[, x2[, ...]])
```

**引数**

* `x1[, x2, ...]` — 非圧縮時のブロックサイズを取得する対象となる任意個数の値。[`Any`](/sql-reference/data-types)

**返される値**

圧縮なしで値のブロックがディスクに書き込まれる際のバイト数を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT blockSerializedSize(maxState(1)) AS x;
```

```response title=Response
┌─x─┐
│ 2 │
└───┘
```


## blockSize

導入バージョン: v1.1

ClickHouse では、クエリは [blocks](/development/architecture#block)（チャンク）単位で処理されます。
この関数は、呼び出されたブロックのサイズ（行数）を返します。

**構文**

```sql
blockSize()
```

**引数**

* なし。

**戻り値**

現在のブロック内の行数を返します（[`UInt64`](/sql-reference/data-types/int-uint)）。

**例**

**使用例**

```sql title=Query
SELECT blockSize()
FROM system.numbers LIMIT 5
```

```response title=Response
┌─blockSize()─┐
│           5 │
│           5 │
│           5 │
│           5 │
│           5 │
└─────────────┘
```


## byteSize

導入: v21.1

引数の非圧縮時におけるメモリ上のバイトサイズを推定して返します。
`String` 型の引数に対しては、文字列の長さ + 8（長さ）を返します。
関数が複数の引数を持つ場合は、それぞれのバイトサイズを合計します。

**構文**

```sql
byteSize(arg1[, arg2, ...])
```

**引数**

* `arg1[, arg2, ...]` — 非圧縮時のバイトサイズを推定する対象となる、任意のデータ型の値。[`Any`](/sql-reference/data-types)

**返り値**

引数のメモリ上におけるバイトサイズの推定値を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT byteSize('string')
```

```response title=Response
┌─byteSize('string')─┐
│                 15 │
└────────────────────┘
```

**複数引数**

```sql title=Query
SELECT byteSize(NULL, 1, 0.3, '')
```

```response title=Response
┌─byteSize(NULL, 1, 0.3, '')─┐
│                         19 │
└────────────────────────────┘
```


## catboostEvaluate

導入バージョン: v22.9

外部の CatBoost モデルを評価します。[CatBoost](https://catboost.ai) は、Yandex によって機械学習向けに開発されたオープンソースの勾配ブースティングライブラリです。
CatBoost モデルのパスと、そのモデルに渡す引数（特徴量）を受け取ります。

**前提条件**

1. CatBoost 評価ライブラリをビルドする

CatBoost モデルを評価する前に、`libcatboostmodel.<so|dylib>` ライブラリを利用可能にしておく必要があります。コンパイル手順については [CatBoost のドキュメント](https://catboost.ai/docs/concepts/c-plus-plus-api_dynamic-c-pluplus-wrapper.html) を参照してください。

次に、`libcatboostmodel.<so|dylib>` へのパスを ClickHouse の設定で指定します。

```xml
<clickhouse>
...
    <catboost_lib_path>/path/to/libcatboostmodel.so</catboost_lib_path>
...
</clickhouse>
```

セキュリティおよびアイソレーションの観点から、モデル評価はサーバープロセス内ではなく、clickhouse-library-bridge プロセス内で実行されます。
`catboostEvaluate()` が最初に実行されるとき、サーバーはライブラリブリッジプロセスがまだ起動していない場合には新たに起動します。両プロセス間の通信は
HTTP インターフェイスを通じて行われます。デフォルトではポート `9012` が使用されます。ポート `9012` がすでに別のサービスに割り当てられている場合などには、
以下のようにして別のポートを指定することができます。

```xml
<library_bridge>
    <port>9019</port>
</library_bridge>
```

2. libcatboost を使用して catboost モデルを学習する

catboost モデルの学習方法については、学習用データセットを使用した手順を含めて、[Training and applying models](https://catboost.ai/docs/features/training.html#training) を参照してください。

**構文**

```sql
catboostEvaluate(path_to_model, feature_1[, feature_2, ..., feature_n])
```

**引数**

* `path_to_model` — CatBoost モデルファイルへのパス。[`const String`](/sql-reference/data-types/string)
* `feature` — 1 つ以上のモデル特徴量/引数。[`Float*`](/sql-reference/data-types/float)

**返り値**

モデル評価の結果を返します。[`Float64`](/sql-reference/data-types/float)

**例**

**catboostEvaluate**

```sql title=Query
SELECT catboostEvaluate('/root/occupy.bin', Temperature, Humidity, Light, CO2, HumidityRatio) AS prediction FROM occupancy LIMIT 1
```

```response title=Response
4.695691092573497
```


## colorOKLCHToSRGB

導入バージョン: v25.7

**OKLCH** 知覚的色空間の色を、一般的な **sRGB** 色空間の色に変換します。

`L` が `[0...1]` の範囲外、`C` が負、または `H` が `[0...360]` の範囲外の場合、結果は実装依存です。

:::note
**OKLCH** は OKLab 色空間の円柱座標版です。
その 3 つの座標は、`L`（明度。範囲 `[0...1]`）、`C`（クロマ（彩度）。`>= 0`）、`H`（色相。度で `[0...360]` の範囲）です。
OKLab/OKLCH は、計算コストを低く抑えつつ、知覚的に一様になるように設計されています。
:::

この変換は [`colorSRGBToOKLCH`](#colorSRGBToOKLCH) の逆変換です:

1. OKLCH から OKLab へ
2. OKLab から線形 sRGB へ
3. 線形 sRGB から sRGB へ

2 番目の引数 `gamma` は最後の段階で使用されます。

OKLCH 空間における色と、それらが sRGB の色とどのように対応するかについては、[https://oklch.com/](https://oklch.com/) を参照してください。

**構文**

```sql
colorOKLCHToSRGB(tuple [, gamma])
```

**引数**

* `tuple` — 数値 `L`、`C`、`H` からなる 3 つ組のタプル。`L` は範囲 `[0...1]`、`C >= 0`、`H` は範囲 `[0...360]`。[`Tuple(Float64, Float64, Float64)`](/sql-reference/data-types/tuple)
* `gamma` — 省略可。線形 sRGB を、各チャネル `x` に対して `(x ^ (1 / gamma)) * 255` を適用することで sRGB に戻す際に使用される指数。既定値は `2.2`。[`Float64`](/sql-reference/data-types/float)

**戻り値**

sRGB カラー値を表すタプル (R, G, B) を返します。[`Tuple(Float64, Float64, Float64)`](/sql-reference/data-types/tuple)

**使用例**

**OKLCH を sRGB に変換**

```sql title=Query
SELECT colorOKLCHToSRGB((0.4466, 0.0991, 45.44), 2.2) AS rgb
WITH colorOKLCHToSRGB((0.7, 0.1, 54)) as t SELECT tuple(toUInt8(t.1), toUInt8(t.2), toUInt8(t.3)) AS RGB
```

```response title=Response
┌─rgb──────────────────────────────────────────────────────┐
│ (127.03349738778945,66.06672044472008,37.11802592155851) │
└──────────────────────────────────────────────────────────┘
┌─RGB──────────┐
│ (205,139,97) │
└──────────────┘
```


## colorSRGBToOKLCH

導入バージョン: v25.7

**sRGB** 色空間で符号化された色を、知覚的に均一な **OKLCH** 色空間に変換します。

いずれかの入力チャネルが `[0...255]` の範囲外、またはガンマ値が正でない場合、その動作は実装依存です。

:::note
**OKLCH** は OKLab 色空間の円柱座標版です。
その 3 つの座標は `L`（明度、範囲 `[0...1]`）、`C`（クロマ（彩度）、`>= 0`）、`H`（色相、度数で `[0...360]`）です。
OKLab/OKLCH は、計算コストを低く抑えつつ知覚的な均一性を実現するように設計されています。
:::

変換は次の 3 段階で構成されます:

1. sRGB から線形 sRGB への変換
2. 線形 sRGB から OKLab への変換
3. OKLab から OKLCH への変換

OKLCH 空間における色の例と、それらが sRGB の色にどのように対応するかについては、[https://OKLCH.com/](https://OKLCH.com/) を参照してください。

**構文**

```sql
colorSRGBToOKLCH(tuple[, gamma])
```

**引数**

* `tuple` — `[0...255]` の範囲の R, G, B の 3 要素からなるタプル。[`Tuple(UInt8, UInt8, UInt8)`](/sql-reference/data-types/tuple)
* `gamma` — 省略可。各チャネルの値 `x` に対して `(x / 255)^gamma` を適用して sRGB を線形化する際に使用される指数。デフォルトは `2.2`。[`Float64`](/sql-reference/data-types/float)

**戻り値**

OKLCH 色空間の値を表すタプル (L, C, H) を返します。[`Tuple(Float64, Float64, Float64)`](/sql-reference/data-types/tuple)

**使用例**

**sRGB を OKLCH に変換**

```sql title=Query
SELECT colorSRGBToOKLCH((128, 64, 32), 2.2) AS lch
```

```response title=Response
┌─lch─────────────────────────────────────────────────────────┐
│ (0.4436238384931984,0.10442699545678624,45.907345481930236) │
└─────────────────────────────────────────────────────────────┘
```


## connectionId

導入バージョン: v21.3

現在のクエリを送信したクライアントの接続 ID を返します。
この関数は、デバッグ時に最も有用です。
MySQL の `CONNECTION_ID` 関数との互換性のために作成されました。
本番環境のクエリで使用されることは一般的ではありません。

**構文**

```sql
connectionId()
```

**引数**

* なし。

**戻り値**

現在のクライアントの接続 ID（[`UInt64`](/sql-reference/data-types/int-uint)）を返します。

**例**

**使用例**

```sql title=Query
SELECT connectionId();
```

```response title=Response
┌─connectionId()─┐
│              0 │
└────────────────┘
```


## countDigits

導入バージョン: v20.8

値を表現するのに必要な 10 進数の桁数を返します。

:::note
この関数は Decimal 型のスケールを考慮します。つまり、基になる整数型（`(value * scale)`）に対して結果を計算します。

例えば:

* `countDigits(42) = 2`
* `countDigits(42.000) = 5`
* `countDigits(0.04200) = 4`
  :::

:::tip
`Decimal64` のオーバーフローは `countDigits(x) > 18` で検出できますが、
[`isDecimalOverflow`](#isDecimalOverflow) よりも低速です。
:::

**構文**

```sql
countDigits(x)
```

**引数**

* `x` — 整数または 10 進小数値。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Decimal`](/sql-reference/data-types/decimal)

**返り値**

`x` を表現するのに必要な桁数を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT countDigits(toDecimal32(1, 9)), countDigits(toDecimal32(-1, 9)),
       countDigits(toDecimal64(1, 18)), countDigits(toDecimal64(-1, 18)),
       countDigits(toDecimal128(1, 38)), countDigits(toDecimal128(-1, 38));
```

```response title=Response
┌─countDigits(toDecimal32(1, 9))─┬─countDigits(toDecimal32(-1, 9))─┬─countDigits(toDecimal64(1, 18))─┬─countDigits(toDecimal64(-1, 18))─┬─countDigits(toDecimal128(1, 38))─┬─countDigits(toDecimal128(-1, 38))─┐
│                             10 │                              10 │                              19 │                               19 │                               39 │                                39 │
└────────────────────────────────┴─────────────────────────────────┴─────────────────────────────────┴──────────────────────────────────┴──────────────────────────────────┴───────────────────────────────────┘
```


## currentDatabase

導入バージョン: v1.1

現在のデータベース名を返します。
データベースを指定する必要がある `CREATE TABLE` クエリのテーブルエンジンのパラメータで便利です。

[`SET` 文](/sql-reference/statements/use)も参照してください。

**構文**

```sql
currentDatabase()
```

**別名**: `current_database`, `SCHEMA`, `DATABASE`

**引数**

* なし。

**戻り値**

現在のデータベース名を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT currentDatabase()
```

```response title=Response
┌─currentDatabase()─┐
│ default           │
└───────────────────┘
```


## currentProfiles

導入されたバージョン: v21.9

現在のユーザーに有効な設定プロファイルの配列を返します。

**構文**

```sql
currentProfiles()
```

**引数**

* なし。

**返り値**

現在のユーザー向けの設定プロファイルを要素とする配列を返します。 [`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
SELECT currentProfiles();
```

```response title=Response
┌─currentProfiles()─────────────────────────────┐
│ ['default', 'readonly_user', 'web_analytics'] │
└───────────────────────────────────────────────┘
```


## currentQueryID

導入バージョン: v

現在のクエリ ID を返します。

**構文**

```sql
currentQueryID()
```

**エイリアス**: `current_query_id`

**引数**

* なし

**戻り値**

**例**

**例**

```sql title=Query
SELECT currentQueryID();
```

```response title=Response
┌─currentQueryID()─────────────────────┐
│ 1280d0e8-1a08-4524-be6e-77975bb68e7d │
└──────────────────────────────────────┘
```


## currentRoles

導入バージョン: v21.9

現在のユーザーに割り当てられているロールを配列で返します。

**構文**

```sql
currentRoles()
```

**引数**

* なし。

**戻り値**

現在のユーザーに割り当てられているロールの配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
SELECT currentRoles();
```

```response title=Response
┌─currentRoles()─────────────────────────────────┐
│ ['sql-console-role:jane.smith@clickhouse.com'] │
└────────────────────────────────────────────────┘
```


## currentSchemas

導入バージョン: v23.7

関数 [`currentDatabase`](#currentDatabase) と同じですが、次の点が異なります。

* 無視される boolean（ブール値）引数を受け取る
* データベース名を単一要素の配列として返す

関数 `currentSchemas` は PostgreSQL との互換性のためだけに存在します。
代わりに `currentDatabase` を使用してください。

[`SET` ステートメント](/sql-reference/statements/use) も参照してください。

**構文**

```sql
currentSchemas(bool)
```

**別名**: `current_schemas`

**引数**

* `bool` — 無視されるブール値。[`Bool`](/sql-reference/data-types/boolean)

**返り値**

現在のデータベース名を唯一の要素とする 1 要素の配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
SELECT currentSchemas(true)
```

```response title=Response
┌─currentSchemas(true)─┐
│ ['default']          │
└──────────────────────┘
```


## currentUser

導入: v20.1

現在のユーザー名を返します。
分散クエリの場合は、そのクエリを実行したユーザーの名前を返します。

**構文**

```sql
currentUser()
```

**別名**: `current_user`, `user`

**引数**

* なし。

**返される値**

現在のユーザー名を返します。そうでない場合は、クエリを開始したユーザーのログイン名を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT currentUser()
```

```response title=Response
┌─currentUser()─┐
│ default       │
└───────────────┘
```


## defaultProfiles

導入: v21.9

現在のユーザーのデフォルトの設定プロファイル名の配列を返します。

**構文**

```sql
defaultProfiles()
```

**引数**

* なし。

**戻り値**

現在のユーザーのデフォルトの設定プロファイル名の配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
SELECT defaultProfiles();
```

```response title=Response
┌─defaultProfiles()─┐
│ ['default']       │
└───────────────────┘
```


## defaultRoles

導入バージョン: v21.9

現在のユーザーに設定されているデフォルトのロールを配列で返します。

**構文**

```sql
defaultRoles()
```

**引数**

* なし。

**戻り値**

現在のユーザーに設定されているデフォルトロールの配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
SELECT defaultRoles();
```

```response title=Response
┌─defaultRoles()─────────────────────────────────┐
│ ['sql-console-role:jane.smith@clickhouse.com'] │
└────────────────────────────────────────────────┘
```


## defaultValueOfArgumentType

導入バージョン: v1.1

指定されたデータ型に対するデフォルト値を返します。
ユーザーが設定したカスタム列のデフォルト値は含まれません。

**構文**

```sql
defaultValueOfArgumentType(expression)
```

**引数**

* `expression` — 任意の型の値、または任意の型の値を返す式。[`Any`](/sql-reference/data-types)

**戻り値**

数値に対しては `0`、文字列に対しては空文字列、Nullable 型に対しては `NULL` を返します。戻り値の型は [`UInt8`](/sql-reference/data-types/int-uint)、[`String`](/sql-reference/data-types/string)、または [`NULL`](/sql-reference/syntax#null) です。

**例**

**使用例**

```sql title=Query
SELECT defaultValueOfArgumentType(CAST(1 AS Int8));
```

```response title=Response
┌─defaultValueOfArgumentType(CAST(1, 'Int8'))─┐
│                                           0 │
└─────────────────────────────────────────────┘
```

**Nullable 型の例**

```sql title=Query
SELECT defaultValueOfArgumentType(CAST(1 AS Nullable(Int8)));
```

```response title=Response
┌─defaultValueOfArgumentType(CAST(1, 'Nullable(Int8)'))─┐
│                                                  ᴺᵁᴸᴸ │
└───────────────────────────────────────────────────────┘
```


## defaultValueOfTypeName

導入バージョン: v1.1

指定された型名のデフォルト値を返します。

**構文**

```sql
defaultValueOfTypeName(type)
```

**引数**

* `type` — 型名を表す文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

指定された型名に対するデフォルト値を返します。数値型なら `0`、文字列型なら空文字列、Nullable 型の [`UInt8`](/sql-reference/data-types/int-uint) または [`String`](/sql-reference/data-types/string)、あるいは [`NULL`](/sql-reference/syntax#null) の場合は `NULL` を返します。

**例**

**使用例**

```sql title=Query
SELECT defaultValueOfTypeName('Int8');
```

```response title=Response
┌─defaultValueOfTypeName('Int8')─┐
│                              0 │
└────────────────────────────────┘
```

**Nullable の使用例**

```sql title=Query
SELECT defaultValueOfTypeName('Nullable(Int8)');
```

```response title=Response
┌─defaultValueOfTypeName('Nullable(Int8)')─┐
│                                     ᴺᵁᴸᴸ │
└──────────────────────────────────────────┘
```


## displayName

導入: v22.11

[config](/operations/configuration-files) の `display_name` の値、または設定されていない場合はサーバーの完全修飾ドメイン名 (FQDN) を返します。

**構文**

```sql
displayName()
```

**引数**

* なし。

**戻り値**

設定で指定された `display_name` の値、または未設定の場合はサーバーの FQDN を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT displayName();
```

```response title=Response
┌─displayName()─┐
│ production    │
└───────────────┘
```


## dumpColumnStructure

導入: v1.1

列とそのデータ型の内部構造を詳細に出力します。

**構文**

```sql
dumpColumnStructure(x)
```

**引数**

* `x` — 構造の説明を取得する値。[`Any`](/sql-reference/data-types)

**戻り値**

値を表現するために使用されるカラム構造の説明を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT dumpColumnStructure(CAST('2018-01-01 01:02:03', 'DateTime'));
```

```response title=Response
┌─dumpColumnStructure(CAST('2018-01-01 01:02:03', 'DateTime'))─┐
│ DateTime, Const(size = 1, UInt32(size = 1))                  │
└──────────────────────────────────────────────────────────────┘
```


## enabledProfiles

導入バージョン: v21.9

現在のユーザーに対して有効な設定プロファイル名の配列を返します。

**構文**

```sql
enabledProfiles()
```

**引数**

* なし。

**戻り値**

現在のユーザーに対して有効な設定プロファイル名の配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
SELECT enabledProfiles();
```

```response title=Response
┌─enabledProfiles()─────────────────────────────────────────────────┐
│ ['default', 'readonly_user', 'web_analytics', 'batch_processing'] │
└───────────────────────────────────────────────────────────────────┘
```


## enabledRoles

導入バージョン: v21.9

現在のユーザーに対して有効なロールの配列を返します。

**構文**

```sql
enabledRoles()
```

**引数**

* なし。

**戻り値**

現在のユーザーに対して有効なロール名の配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
SELECT enabledRoles();
```

```response title=Response
┌─enabledRoles()─────────────────────────────────────────────────┐
│ ['general_data', 'sql-console-role:jane.smith@clickhouse.com'] │
└────────────────────────────────────────────────────────────────┘
```


## errorCodeToName

導入バージョン: v20.12

数値の ClickHouse エラーコードに対応するエラー名（文字列表現）を返します。
数値エラーコードとエラー名の対応は[こちら](https://github.com/ClickHouse/ClickHouse/blob/master/src/Common/ErrorCodes.cpp)で確認できます。

**構文**

```sql
errorCodeToName(error_code)
```

**引数**

* `error_code` — ClickHouse のエラーコード。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float) または [`Decimal`](/sql-reference/data-types/decimal)

**戻り値**

`error_code` の名称を文字列として返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT errorCodeToName(252);
```

```response title=Response
┌─errorCodeToName(252)─┐
│ TOO_MANY_PARTS       │
└──────────────────────┘
```


## file

導入バージョン: v21.3

ファイルを文字列として読み込み、指定されたカラムにデータを読み込みます。
ファイルの内容は解釈されません。

[`file`](../table-functions/file.md) テーブル関数も参照してください。

**構文**

```sql
file(path[, default])
```

**引数**

* `path` — `user_files_path` からの相対パスで指定するファイルのパス。ワイルドカード `*`、`**`、`?`、`{abc,def}`、`{N..M}` をサポートします。ここで `N`、`M` は数値、`'abc'`、`'def'` は文字列です。[`String`](/sql-reference/data-types/string)
* `default` — ファイルが存在しないか、アクセスできない場合に返される値。[`String`](/sql-reference/data-types/string) または [`NULL`](/sql-reference/syntax#null)

**戻り値**

ファイルの内容を文字列として返します。[`String`](/sql-reference/data-types/string)

**使用例**

**ファイルをテーブルに挿入する**

```sql title=Query
INSERT INTO table SELECT file('a.txt'), file('b.txt');
```

```response title=Response
```


## filesystemAvailable

導入バージョン: v20.1

データベースの永続ストレージが置かれているファイルシステム上の空き容量を返します。
一部の領域がオペレーティングシステム用に予約されているため、返される値は常にファイルシステム全体の空き容量（[`filesystemUnreserved`](../../sql-reference/functions/other-functions.md#filesystemUnreserved)）よりも小さくなります。

**構文**

```sql
filesystemAvailable([disk_name])
```

**引数**

* `disk_name` — 省略可能。空き容量を取得するディスク名。指定しない場合、デフォルトディスクが使用されます。[`String`](/sql-reference/data-types/string) または [`FixedString`](/sql-reference/data-types/fixedstring)

**戻り値**

利用可能な空き容量をバイト数で返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT formatReadableSize(filesystemAvailable()) AS "利用可能な容量";
```

```response title=Response
┌─利用可能な容量─┐
│ 30.75 GiB      │
└────────────────┘
```


## filesystemCapacity

導入バージョン: v20.1

ファイルシステムの容量をバイト単位で返します。
データディレクトリへの [path](../../operations/server-configuration-parameters/settings.md#path) が設定されている必要があります。

**構文**

```sql
filesystemCapacity([disk_name])
```

**引数**

* `disk_name` — 省略可。容量を取得するディスク名。指定しない場合はデフォルトのディスクが使用されます。[`String`](/sql-reference/data-types/string) または [`FixedString`](/sql-reference/data-types/fixedstring)

**戻り値**

ファイルシステムの容量をバイト単位で返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT formatReadableSize(filesystemCapacity()) AS "容量";
```

```response title=Response
┌─容量──┐
│ 39.32 GiB │
└───────────┘
```


## filesystemUnreserved

導入バージョン: v22.12

データベースの永続データが格納されているファイルシステム上の、予約されていない空き容量の合計を返します（以前の名称は `filesystemFree`）。
[`filesystemAvailable`](#filesystemAvailable) も参照してください。

**構文**

```sql
filesystemUnreserved([disk_name])
```

**引数**

* `disk_name` — 省略可。空き容量の合計を取得する対象ディスクの名前。省略した場合はデフォルトディスクを使用します。[`String`](/sql-reference/data-types/string) または [`FixedString`](/sql-reference/data-types/fixedstring)

**戻り値**

空き容量をバイト単位で返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT formatReadableSize(filesystemUnreserved()) AS "空き容量";
```

```response title=Response
┌─空き容量─┐
│ 32.39 GiB │
└──────────┘
```


## finalizeAggregation

導入: v1.1

この関数は集約状態を受け取り、集約結果（または [-State](../../sql-reference/aggregate-functions/combinators.md#-state) コンビネータを使用している場合は、最終化された状態）を返します。

**構文**

```sql
finalizeAggregation(state)
```

**引数**

* `state` — 集約の状態。[`AggregateFunction`](/sql-reference/data-types/aggregatefunction)

**戻り値**

集約の最終結果を返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=Query
SELECT finalizeAggregation(arrayReduce('maxState', [1, 2, 3]));
```

```response title=Response
┌─finalizeAggregation(arrayReduce('maxState', [1, 2, 3]))─┐
│                                                       3 │
└─────────────────────────────────────────────────────────┘
```

**initializeAggregation と併用**

```sql title=Query
WITH initializeAggregation('sumState', number) AS one_row_sum_state
SELECT
    number,
    finalizeAggregation(one_row_sum_state) AS one_row_sum,
    runningAccumulate(one_row_sum_state) AS cumulative_sum
FROM numbers(5);
```

```response title=Response
┌─number─┬─one_row_sum─┬─cumulative_sum─┐
│      0 │           0 │              0 │
│      1 │           1 │              1 │
│      2 │           2 │              3 │
│      3 │           3 │              6 │
│      4 │           4 │             10 │
└────────┴─────────────┴────────────────┘
```


## flipCoordinates

導入バージョン: v25.10

`Point`、`Ring`、`Polygon`、`MultiPolygon` の座標を反転します。`Point` の場合は座標を入れ替えます。配列の場合は、各座標ペアに対して同じ変換を再帰的に適用します。

**構文**

```sql
flipCoordinates(geometry)
```

**引数**

* `geometry` — 座標を入れ替える対象のジオメトリ。サポートされている型: Point (Tuple(Float64, Float64)), Ring (Array(Point)), Polygon (Array(Ring)), MultiPolygon (Array(Polygon))。

**戻り値**

座標を入れ替えたジオメトリ。型は入力と同じです。[`Point`](/sql-reference/data-types/geo#point) または [`Ring`](/sql-reference/data-types/geo#ring) または [`Polygon`](/sql-reference/data-types/geo#polygon) または [`MultiPolygon`](/sql-reference/data-types/geo#multipolygon)

**例**

**basic&#95;point**

```sql title=Query
SELECT flipCoordinates((1.0, 2.0));
```

```response title=Response
(2.0, 1.0)
```

**リング**

```sql title=Query
SELECT flipCoordinates([(1.0, 2.0), (3.0, 4.0)]);
```

```response title=Response
[(2.0, 1.0), (4.0, 3.0)]
```

**ポリゴン**

```sql title=Query
SELECT flipCoordinates([[(1.0, 2.0), (3.0, 4.0)], [(5.0, 6.0), (7.0, 8.0)]]);
```

```response title=Response
[[(2.0, 1.0), (4.0, 3.0)], [(6.0, 5.0), (8.0, 7.0)]]
```


## formatQuery

導入バージョン: v

指定された SQL クエリを、必要に応じて複数行を含むフォーマット済みの形式で返します。パースエラーが発生した場合は例外を送出します。
[example:multiline]

**構文**

```sql
formatQuery(query)
```

**引数**

* `query` — 整形対象の SQL クエリ。[String](../../sql-reference/data-types/string.md)

**戻り値**

整形されたクエリ [`String`](/sql-reference/data-types/string)

**例**

**multiline**

```sql title=Query
SELECT formatQuery('select a,    b FRom tab WHERE a > 3 and  b < 3');
```

```response title=Response
SELECT
    a,
    b
FROM tab
WHERE (a > 3) AND (b < 3)
```


## formatQueryOrNull

導入バージョン: v

指定された SQL クエリを整形し、必要に応じて複数行となる形式で返します。パースエラーが発生した場合は NULL を返します。
[example:multiline]

**構文**

```sql
formatQueryOrNull(query)
```

**引数**

* `query` — 整形する SQL クエリ。[String](../../sql-reference/data-types/string.md)

**戻り値**

整形済みクエリ [`String`](/sql-reference/data-types/string)

**例**

**multiline**

```sql title=Query
SELECT formatQuery('select a,    b FRom tab WHERE a > 3 and  b < 3');
```

```response title=Response
SELECT
    a,
    b
FROM tab
WHERE (a > 3) AND (b < 3)
```


## formatQuerySingleLine

導入バージョン: v

formatQuery() と同様ですが、返される整形済み文字列には改行が含まれません。パースエラーが発生した場合には例外をスローします。
[example:multiline]

**構文**

```sql
formatQuerySingleLine(query)
```

**引数**

* `query` — フォーマットする SQL クエリ。[String](../../sql-reference/data-types/string.md)

**戻り値**

フォーマットされたクエリ [`String`](/sql-reference/data-types/string)

**例**

**multiline**

```sql title=Query
SELECT formatQuerySingleLine('select a,    b FRom tab WHERE a > 3 and  b < 3');
```

```response title=Response
SELECT a, b FROM tab WHERE (a > 3) AND (b < 3)
```


## formatQuerySingleLineOrNull

導入バージョン: v

formatQuery() と同様ですが、返される整形済みの文字列には改行が含まれません。構文解析エラーが発生した場合は NULL を返します。
[例:複数行]

**構文**

```sql
formatQuerySingleLineOrNull(query)
```

**引数**

* `query` — 整形対象の SQL クエリ。[`String`](/sql-reference/data-types/string)

**返り値**

整形されたクエリを表す [`String`](/sql-reference/data-types/string)

**例**

**複数行**

```sql title=Query
SELECT formatQuerySingleLine('select a,    b FRom tab WHERE a > 3 and  b < 3');
```

```response title=Response
SELECT a, b FROM tab WHERE (a > 3) AND (b < 3)
```


## formatReadableDecimalSize

導入バージョン: v22.11

サイズ（バイト数）を指定すると、この関数は接尾辞（KB、MB など）付きの、人間が読みやすいように丸めたサイズを文字列として返します。

この関数と逆の処理を行う関数は [`parseReadableSize`](#parseReadableSize) です。

**構文**

```sql
formatReadableDecimalSize(x)
```

**引数**

* `x` — バイト単位のサイズ。[`UInt64`](/sql-reference/data-types/int-uint)

**戻り値**

人間が読みやすい形式の、単位接尾辞付きで丸められたサイズを文字列として返します。[`String`](/sql-reference/data-types/string)

**例**

**ファイルサイズを整形する**

```sql title=Query
SELECT
    arrayJoin([1, 1024, 1024*1024, 192851925]) AS filesize_bytes,
    formatReadableDecimalSize(filesize_bytes) AS filesize
```

```response title=Response
┌─filesize_bytes─┬─filesize───┐
│              1 │ 1.00 B     │
│           1024 │ 1.02 KB    │
│        1048576 │ 1.05 MB    │
│      192851925 │ 192.85 MB  │
└────────────────┴────────────┘
```


## formatReadableQuantity

導入バージョン: v20.10

数値を指定すると、この関数はその数値を四捨五入し、接尾辞（千、百万、十億 など）を付けた文字列として返します。

この関数は任意の数値型を入力として受け取りますが、内部的には `Float64` にキャストして処理します。
非常に大きな値に対しては、結果が必ずしも最適にならない場合があります。

**構文**

```sql
formatReadableQuantity(x)
```

**引数**

* `x` — 書式設定する数値。[`UInt64`](/sql-reference/data-types/int-uint)

**戻り値**

接尾辞付きの丸められた数値を文字列として返します。[`String`](/sql-reference/data-types/string)

**使用例**

**接尾辞付きで数値を書式設定する**

```sql title=Query
SELECT
    arrayJoin([1024, 1234 * 1000, (4567 * 1000) * 1000, 98765432101234]) AS number,
    formatReadableQuantity(number) AS number_for_humans
```

```response title=Response
┌─────────number─┬─number_for_humans─┐
│           1024 │ 1.02 千           │
│        1234000 │ 1.23 百万         │
│     4567000000 │ 4.57 十億         │
│ 98765432101234 │ 98.77 兆          │
└────────────────┴───────────────────┘
```


## formatReadableSize

導入: v1.1

サイズ（バイト数）を指定すると、この関数は接尾辞（KiB、MiB など）付きの、読みやすく丸められたサイズを文字列として返します。

この関数と逆の変換を行う関数は、[`parseReadableSize`](#parseReadableSize)、[`parseReadableSizeOrZero`](#parseReadableSizeOrZero)、[`parseReadableSizeOrNull`](#parseReadableSizeOrNull) です。
この関数は任意の数値型を入力として受け付けますが、内部的にはそれらを `Float64` にキャストします。非常に大きな値では結果が望ましくない場合があります。

**構文**

```sql
formatReadableSize(x)
```

**エイリアス**: `FORMAT_BYTES`

**引数**

* `x` — バイト単位のサイズ。[`UInt64`](/sql-reference/data-types/int-uint)

**返り値**

単位の接尾辞付きで、読みやすいように丸めたサイズを文字列として返します。[`String`](/sql-reference/data-types/string)

**使用例**

**ファイルサイズをフォーマットする**

```sql title=Query
SELECT
    arrayJoin([1, 1024, 1024*1024, 192851925]) AS filesize_bytes,
    formatReadableSize(filesize_bytes) AS filesize
```

```response title=Response
┌─filesize_bytes─┬─filesize───┐
│              1 │ 1.00 B     │
│           1024 │ 1.00 KiB   │
│        1048576 │ 1.00 MiB   │
│      192851925 │ 183.92 MiB │
└────────────────┴────────────┘
```


## formatReadableTimeDelta

導入バージョン: v20.12

秒単位の時間間隔（デルタ）を指定すると、この関数は年/月/日/時/分/秒/ミリ秒/マイクロ秒/ナノ秒を含む時間差を文字列で返します。

この関数は任意の数値型を入力として受け取りますが、内部的にはそれらを `Float64` にキャストします。大きな値の場合、結果が望ましくない可能性があります。

**構文**

```sql
formatReadableTimeDelta(column[, maximum_unit, minimum_unit])
```

**引数**

* `column` — 数値型の時間差を格納するカラム。[`Float64`](/sql-reference/data-types/float)
* `maximum_unit` — 省略可。表示する最大単位。指定可能な値: `nanoseconds`, `microseconds`, `milliseconds`, `seconds`, `minutes`, `hours`, `days`, `months`, `years`。デフォルト値: `years`。[`const String`](/sql-reference/data-types/string)
* `minimum_unit` — 省略可。表示する最小単位。これより小さい単位は切り捨てられます。指定可能な値: `nanoseconds`, `microseconds`, `milliseconds`, `seconds`, `minutes`, `hours`, `days`, `months`, `years`。明示的に指定した値が `maximum_unit` より大きい場合は、例外がスローされます。デフォルト値: `maximum_unit` が `seconds` 以上の場合は `seconds`、それ以外の場合は `nanoseconds`。[`const String`](/sql-reference/data-types/string)

**戻り値**

時間差を文字列として返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT
    arrayJoin([100, 12345, 432546534]) AS elapsed,
    formatReadableTimeDelta(elapsed) AS time_delta
```

```response title=Response
┌────elapsed─┬─time_delta─────────────────────────────────────────────────────┐
│        100 │ 1分40秒                                                         │
│      12345 │ 3時間25分45秒                                                   │
│  432546534 │ 13年8ヶ月17日7時間48分54秒                                      │
└────────────┴────────────────────────────────────────────────────────────────┘
```

**最大の単位を使用**

```sql title=Query
SELECT
    arrayJoin([100, 12345, 432546534]) AS elapsed,
    formatReadableTimeDelta(elapsed, 'minutes') AS time_delta
```

```response title=Response
┌────elapsed─┬─time_delta─────────────────────────────────────────────────────┐
│        100 │ 1分40秒                                                          │
│      12345 │ 205分45秒                                                        │
│  432546534 │ 7209108分54秒                                                    │
└────────────┴─────────────────────────────────────────────────────────────────┘
```


## generateRandomStructure

導入バージョン: v23.5

`column1_name column1_type, column2_name column2_type, ...` という形式のランダムなテーブル構造を生成します。

**構文**

```sql
generateRandomStructure([number_of_columns, seed])
```

**引数**

* `number_of_columns` — 結果のテーブル構造における列数。0 または `Null` に設定した場合、列数は 1 から 128 の間でランダムに決定されます。デフォルト値: `Null`。[`UInt64`](/sql-reference/data-types/int-uint)
* `seed` — 安定した結果を得るための乱数シード。`seed` が指定されていないか `Null` に設定されている場合、乱数シードがランダムに生成されます。[`UInt64`](/sql-reference/data-types/int-uint)

**戻り値**

ランダムに生成されたテーブル構造。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT generateRandomStructure()
```

```response title=Response
c1 Decimal32(5), c2 Date, c3 Tuple(LowCardinality(String), Int128, UInt64, UInt16, UInt8, IPv6), c4 Array(UInt128), c5 UInt32, c6 IPv4, c7 Decimal256(64), c8 Decimal128(3), c9 UInt256, c10 UInt64, c11 DateTime
```

**列数を指定して**

```sql title=Query
SELECT generateRandomStructure(1)
```

```response title=Response
c1 Map(UInt256, UInt16)
```

**シード値を指定**

```sql title=Query
SELECT generateRandomStructure(NULL, 33)
```

```response title=Response
c1 DateTime, c2 Enum8('c2V0' = 0, 'c2V1' = 1, 'c2V2' = 2, 'c2V3' = 3), c3 LowCardinality(Nullable(FixedString(30))), c4 Int16, c5 Enum8('c5V0' = 0, 'c5V1' = 1, 'c5V2' = 2, 'c5V3' = 3), c6 Nullable(UInt8), c7 String, c8 Nested(e1 IPv4, e2 UInt8, e3 UInt16, e4 UInt16, e5 Int32, e6 Map(Date, Decimal256(70)))
```


## generateSerialID

導入バージョン: v25.1

前回のカウンター値から連番を生成して返します。
この関数は文字列引数（シリーズ識別子）と、任意の開始値を受け取ります。
サーバーは Keeper を使用するように設定されている必要があります。
シリーズは、サーバー設定の [`series_keeper_path`](/operations/server-configuration-parameters/settings#series_keeper_path) で指定されたパス配下の Keeper ノードに保存されます。

**構文**

```sql
generateSerialID(series_identifier[, start_value])
```

**引数**

* `series_identifier` — シリーズ識別子 [`const String`](/sql-reference/data-types/string)
* `start_value` — 省略可能。カウンタの開始値。デフォルトは 0。注意: この値は新しいシリーズを作成する場合にのみ使用され、シリーズが既に存在する場合は無視されます [`UInt*`](/sql-reference/data-types/int-uint)

**返り値**

前回のカウンタ値に続く連番を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**最初の呼び出し**

```sql title=Query
SELECT generateSerialID('id1')
```

```response title=Response
┌─generateSerialID('id1')──┐
│                        1 │
└──────────────────────────┘
```

**2回目の呼び出し**

```sql title=Query
SELECT generateSerialID('id1')
```

```response title=Response
┌─generateSerialID('id1')──┐
│                        2 │
└──────────────────────────┘
```

**カラム参照**

```sql title=Query
SELECT *, generateSerialID('id1') FROM test_table
```

```response title=Response
┌─CounterID─┬─UserID─┬─ver─┬─generateSerialID('id1')──┐
│         1 │      3 │   3 │                        3 │
│         1 │      1 │   1 │                        4 │
│         1 │      2 │   2 │                        5 │
│         1 │      5 │   5 │                        6 │
│         1 │      4 │   4 │                        7 │
└───────────┴────────┴─────┴──────────────────────────┘
```

**開始値あり**

```sql title=Query
SELECT generateSerialID('id2', 100)
```

```response title=Response
┌─generateSerialID('id2', 100)──┐
│                           100 │
└───────────────────────────────┘
```

**開始値指定時の2回目の呼び出し**

```sql title=Query
SELECT generateSerialID('id2', 100)
```

```response title=Response
┌─generateSerialID('id2', 100)──┐
│                           101 │
└───────────────────────────────┘
```


## getClientHTTPHeader

導入バージョン: v24.5

HTTP ヘッダーの値を取得します。
そのようなヘッダーが存在しない場合、または現在のリクエストが HTTP インターフェイス経由で実行されていない場合、この関数は空文字列を返します。
一部の HTTP ヘッダー（例: `Authentication` および `X-ClickHouse-*`）は制限されています。

:::note `allow_get_client_http_header` の設定が必須
この関数を使用するには、設定 `allow_get_client_http_header` を有効にする必要があります。
`Cookie` など一部のヘッダーには機密情報が含まれる可能性があるため、この設定はセキュリティ上の理由からデフォルトでは無効になっています。
:::

この関数において、HTTP ヘッダーは大文字と小文字が区別されます。
分散クエリのコンテキストで関数が使用される場合、クエリを開始したノード上でのみ空ではない結果を返します。

**構文**

```sql
getClientHTTPHeader(name)
```

**引数**

* `name` — HTTP ヘッダー名。[`String`](/sql-reference/data-types/string)

**戻り値**

ヘッダーの値を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT getClientHTTPHeader('Content-Type');
```

```response title=Response
┌─getClientHTTPHeader('Content-Type')─┐
│ application/x-www-form-urlencoded   │
└─────────────────────────────────────┘
```


## getMacro

導入バージョン: v20.1

サーバー設定ファイルに定義されたマクロの値を返します。
マクロは設定ファイルの [`<macros>`](/operations/server-configuration-parameters/settings#macros) セクションで定義され、ホスト名が複雑な場合でも、サーバーを分かりやすい名前で識別するために使用できます。
関数が分散テーブルのコンテキストで実行される場合、各シャードに対応する値を持つ通常の列を生成します。

**構文**

```sql
getMacro(name)
```

**引数**

* `name` — 取得するマクロの名前。[`const String`](/sql-reference/data-types/string)

**戻り値**

指定したマクロの値を返します。[`String`](/sql-reference/data-types/string)

**例**

**基本的な使い方**

```sql title=Query
SELECT getMacro('test');
```

```response title=Response
┌─getMacro('test')─┐
│ Value            │
└──────────────────┘
```


## getMaxTableNameLengthForDatabase

導入バージョン: v

指定したデータベースで使用可能なテーブル名の最大長を返します。

**構文**

```sql
getMaxTableNameLengthForDatabase(database_name)
```

**引数**

* `database_name` — 指定したデータベースの名前。[`String`](/sql-reference/data-types/string)

**戻り値**

テーブル名の最大長を表す整数値を返します。

**例**

**一般的な使用例**

```sql title=Query
SELECT getMaxTableNameLengthForDatabase('default');
```

```response title=Response
┌─getMaxTableNameLengthForDatabase('default')─┐
            │                                         206 │
            └─────────────────────────────────────────────┘
```


## getMergeTreeSetting

導入バージョン: v25.6

MergeTree 設定の現在の値を返します。

**構文**

```sql
getMergeTreeSetting(setting_name)
```

**引数**

* `setting_name` — 設定名。[`String`](/sql-reference/data-types/string)

**返される値**

MergeTree 設定の現在の値を返します。

**例**

**使用例**

```sql title=Query
SELECT getMergeTreeSetting('index_granularity');
```

```response title=Response
┌─getMergeTreeSetting('index_granularity')─┐
│                                     8192 │
└──────────────────────────────────────────┘
```


## getOSKernelVersion

導入バージョン: v21.11

OS カーネルのバージョンを示す文字列を返します。

**構文**

```sql
getOSKernelVersion()
```

**引数**

* なし。

**戻り値**

現在の OS カーネルのバージョンを返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT getOSKernelVersion();
```

```response title=Response
┌─getOSKernelVersion()────┐
│ Linux 4.15.0-55-generic │
└─────────────────────────┘
```


## getServerPort

導入バージョン: v21.10

特定のプロトコル用のサーバーポート番号を返します。

**構文**

```sql
getServerPort(port_name)
```

**引数**

* `port_name` — ポートの名前。[`String`](/sql-reference/data-types/string)

**返り値**

サーバーのポート番号を返します。[`UInt16`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT getServerPort('tcp_port');
```

```response title=Response
┌─getServerPort('tcp_port')─┐
│                      9000 │
└───────────────────────────┘
```


## getServerSetting

導入されたバージョン: v25.6

サーバー設定名を指定すると、その設定の現在の値を返します。

**構文**

```sql
getServerSetting(setting_name')
```

**引数**

* `setting_name` — サーバー設定の名前。[`String`](/sql-reference/data-types/string)

**戻り値**

サーバー設定の現在の値を返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=Query
SELECT getServerSetting('allow_use_jemalloc_memory');
```

```response title=Response
┌─getServerSetting('allow_use_jemalloc_memory')─┐
│ true                                          │
└───────────────────────────────────────────────┘
```


## getSetting

導入: v20.7

設定の現在の値を返します。

**構文**

```sql
getSetting(setting_name)
```

**引数**

* `setting_Name` — 設定の名前。[`const String`](/sql-reference/data-types/string)

**返される値**

設定の現在の値を返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=Query
SELECT getSetting('enable_analyzer');
SET enable_analyzer = false;
SELECT getSetting('enable_analyzer');
```

```response title=Response
┌─getSetting('⋯_analyzer')─┐
│ true                     │
└──────────────────────────┘
┌─getSetting('⋯_analyzer')─┐
│ false                    │
└──────────────────────────┘
```


## getSettingOrDefault

導入バージョン: v24.10

設定の現在の値を返します。現在のプロファイルでその設定が指定されていない場合は、第 2 引数で指定したデフォルト値を返します。

**構文**

```sql
getSettingOrDefault(setting_name, default_value)
```

**引数**

* `setting_name` — 設定名。[`String`](/sql-reference/data-types/string)
* `default_value` — `custom_setting` が設定されていない場合に返す値。任意のデータ型または Null の値を指定可能。

**戻り値**

指定した設定の現在の値、または設定されていない場合は `default_value` を返します。

**例**

**使用例**

```sql title=Query
SELECT getSettingOrDefault('custom_undef1', 'my_value');
SELECT getSettingOrDefault('custom_undef2', 100);
SELECT getSettingOrDefault('custom_undef3', NULL);
```

```response title=Response
my_value
100
NULL
```


## getSizeOfEnumType

導入: v1.1

指定された [`Enum`](../../sql-reference/data-types/enum.md) 型に含まれるフィールド数を返します。

**構文**

```sql
getSizeOfEnumType(x)
```

**引数**

* `x` — `Enum` 型の値。[`Enum`](/sql-reference/data-types/enum)

**戻り値**

`Enum` 型の入力値を持つフィールドの数を返します。[`UInt8/16`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT getSizeOfEnumType(CAST('a' AS Enum8('a' = 1, 'b' = 2))) AS x;
```

```response title=Response
┌─x─┐
│ 2 │
└───┘
```


## getSubcolumn

導入バージョン: v

式または識別子と、サブカラム名を表す定数文字列を受け取ります。

式から指定されたサブカラムを抽出して返します。

**構文**

```sql
```

**引数**

* なし。

**戻り値**

**例**

**getSubcolumn**

```sql title=Query
SELECT getSubcolumn(array_col, 'size0'), getSubcolumn(tuple_col, 'elem_name')
```

```response title=Response
```


## getTypeSerializationStreams

導入されたバージョン: v22.6

データ型のシリアライズストリームのパスを列挙します。
この関数は開発用途での使用を想定しています。

**構文**

```sql
getTypeSerializationStreams(col)
```

**引数**

* `col` — データ型を検出する対象となるデータ型を表す列、またはその文字列表現。 [`Any`](/sql-reference/data-types)

**戻り値**

すべてのシリアル化サブストリームのパスを含む配列を返します。 [`Array(String)`](/sql-reference/data-types/array)

**使用例**

**tuple**

```sql title=Query
SELECT getTypeSerializationStreams(tuple('a', 1, 'b', 2))
```

```response title=Response
['{TupleElement(1), Regular}','{TupleElement(2), Regular}','{TupleElement(3), Regular}','{TupleElement(4), Regular}']
```

**map**

```sql title=Query
SELECT getTypeSerializationStreams('Map(String, Int64)')
```

```response title=Response
['{ArraySizes}','{ArrayElements, TupleElement(keys), Regular}','{ArrayElements, TupleElement(values), Regular}']
```


## globalVariable

導入バージョン: v20.5

定数の文字列引数を取り、その名前を持つグローバル変数の値を返します。この関数は MySQL との互換性のために用意されており、通常の ClickHouse の運用上は必要なく、有用でもありません。ごく少数のダミーのグローバル変数のみが定義されています。

**構文**

```sql
globalVariable(name)
```

**引数**

* `name` — グローバル変数の名前。[`String`](/sql-reference/data-types/string)

**戻り値**

変数 `name` の値を返します。[`Any`](/sql-reference/data-types)

**使用例**

**globalVariable**

```sql title=Query
SELECT globalVariable('max_allowed_packet')
```

```response title=Response
67108864
```


## hasColumnInTable

導入: v1.1

この関数は、特定の列がデータベーステーブル内に存在するかどうかを確認します。
ネストされたデータ構造内の要素に対しては、その列が存在するかどうかをチェックします。
ネストされたデータ構造そのものに対しては、`0` を返します。

**構文**

```sql
hasColumnInTable([hostname[, username[, password]],]database, table, column)
```

**引数**

* `database` — データベース名。[`const String`](/sql-reference/data-types/string)
* `table` — テーブル名。[`const String`](/sql-reference/data-types/string)
* `column` — カラム名。[`const String`](/sql-reference/data-types/string)
* `hostname` — 省略可。チェックを実行するリモートサーバー名。[`const String`](/sql-reference/data-types/string)
* `username` — 省略可。リモートサーバー用のユーザー名。[`const String`](/sql-reference/data-types/string)
* `password` — 省略可。リモートサーバー用のパスワード。[`const String`](/sql-reference/data-types/string)

**戻り値**

指定したカラムが存在する場合は `1`、それ以外は `0` を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**既存カラムの確認**

```sql title=Query
SELECT hasColumnInTable('system','metrics','metric')
```

```response title=Response
1
```

**存在しない列を確認する**

```sql title=Query
SELECT hasColumnInTable('system','metrics','non-existing_column')
```

```response title=Response
0
```


## hasThreadFuzzer

導入バージョン: v20.6

スレッドファザー（thread fuzzer）が有効になっているかどうかを返します。
この関数はテストおよびデバッグ目的にのみ有用です。

**構文**

```sql
hasThreadFuzzer()
```

**引数**

* なし。

**返り値**

Thread Fuzzer が有効かどうかを返します。型は [`UInt8`](/sql-reference/data-types/int-uint) です。

**例**

**Thread Fuzzer の状態を確認**

```sql title=Query
SELECT hasThreadFuzzer()
```

```response title=Response
┌─hasThreadFuzzer()─┐
│                 0 │
└───────────────────┘
```


## hostName

導入バージョン: v20.5

この関数が実行されたホストの名前を返します。
関数がリモートサーバー（分散処理）で実行される場合は、そのリモートサーバーの名前を返します。
関数が分散テーブルのコンテキストで実行される場合は、各シャードに対応する値を持つ通常の列を生成します。
それ以外の場合は、定数値を返します。

**構文**

```sql
hostName()
```

**別名**: `hostname`

**引数**

* なし

**戻り値**

ホスト名を返します。型は[`String`](/sql-reference/data-types/string)です。

**例**

**使用例**

```sql title=Query
SELECT hostName()
```

```response title=Response
┌─hostName()─┐
│ clickhouse │
└────────────┘
```


## icebergBucket

導入バージョン: v25.5

[iceberg bucket transform](https://iceberg.apache.org/spec/#bucket-transform-details.) のロジックを実装します。

**構文**

```sql
icebergBucket(N, value)
```

**引数**

* `N` — バケット数（剰余演算の法）。[`const (U)Int*`](/sql-reference/data-types/int-uint)
* `value` — 変換対象の元の値。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Bool`](/sql-reference/data-types/boolean) または [`Decimal`](/sql-reference/data-types/decimal) または [`Float*`](/sql-reference/data-types/float) または [`String`](/sql-reference/data-types/string) または [`FixedString`](/sql-reference/data-types/fixedstring) または [`UUID`](/sql-reference/data-types/uuid) または [`Date`](/sql-reference/data-types/date) または [`Time`](/sql-reference/data-types/time) または [`DateTime`](/sql-reference/data-types/datetime)

**返される値**

元の値の 32 ビットのハッシュ値を返します。[`Int32`](/sql-reference/data-types/int-uint)

**例**

**例**

```sql title=Query
SELECT icebergBucket(5, 1.0 :: Float32)
```

```response title=Response
4
```


## icebergTruncate

導入バージョン: v25.3

Iceberg の truncate 変換ロジックを実装します。詳細は [https://iceberg.apache.org/spec/#truncate-transform-details](https://iceberg.apache.org/spec/#truncate-transform-details) を参照してください。

**構文**

```sql
icebergTruncate(N, value)
```

**引数**

* `value` — 変換対象の値。[`String`](/sql-reference/data-types/string) または [`(U)Int*`](/sql-reference/data-types/int-uint) または [`Decimal`](/sql-reference/data-types/decimal)

**戻り値**

引数と同じ型です

**使用例**

**例**

```sql title=Query
SELECT icebergTruncate(3, 'iceberg')
```

```response title=Response
ice
```


## identity

導入バージョン: v1.1

この関数は渡された引数をそのまま返すため、デバッグやテストに役立ちます。また、インデックスを使用せずにフルスキャン時のパフォーマンスを確認したい場合にも利用できます。クエリアナライザーは、インデックスの利用を検討する際に `identity` 関数内の内容を無視し、定数畳み込みも無効化します。

**構文**

```sql
identity(x)
```

**引数**

* `x` — 入力値。[`Any`](/sql-reference/data-types)

**戻り値**

入力値を変更せずに返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=Query
SELECT identity(42)
```

```response title=Response
42
```


## ignore

導入バージョン: v1.1

任意の引数を受け取り、無条件に `0` を返します。

**構文**

```sql
ignore(x)
```

**引数**

* `x` — 構文エラーを避けるためだけに渡される、実際には使用されない入力値。[`Any`](/sql-reference/data-types)

**返り値**

常に `0` を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT ignore(0, 'ClickHouse', NULL)
```

```response title=Response
┌─ignore(0, 'ClickHouse', NULL)─┐
│                             0 │
└───────────────────────────────┘
```


## indexHint

導入バージョン: v1.1

この関数はデバッグおよび内部状態の確認のために使用されます。
この関数は引数を無視して、常に 1 を返します。
引数は評価されません。

ただし、インデックス解析時には、この関数の引数は `indexHint` でラップされていないものとして扱われます。
これにより、対応する条件によってインデックス範囲内のデータを選択しつつも、その条件によるさらなるフィルタリングを行わないことができます。
ClickHouse におけるインデックスは疎であり、`indexHint` を使用すると、同じ条件を直接指定した場合よりも多くのデータが返されます。

**構文**

```sql
indexHint(式)
```

**引数**

* `expression` — インデックス範囲の選択に用いる任意の式。[`Expression`](/sql-reference/data-types/special-data-types/expression)

**返される値**

常に `1` を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**日付フィルタリングを用いた利用例**

```sql title=Query
SELECT FlightDate AS k, count() FROM ontime WHERE indexHint(k = '2025-09-15') GROUP BY k ORDER BY k ASC;
```

```response title=Response
┌──────────k─┬─count()─┐
│ 2025-09-14 │    7071 │
│ 2025-09-15 │   16428 │
│ 2025-09-16 │    1077 │
│ 2025-09-30 │    8167 │
└────────────┴─────────┘
```


## initialQueryID

導入バージョン: v1.1

現在のクエリの初期クエリの ID を返します。
クエリのその他のパラメータは、[`system.query_log`](../../operations/system-tables/query_log.md) のフィールド `initial_query_id` から取得できます。

[`queryID`](/sql-reference/functions/other-functions#queryID) 関数とは対照的に、`initialQueryID` は異なるシャード間でも同じ結果を返します。

**構文**

```sql
initialQueryID()
```

**別名**: `initial_query_id`

**引数**

* なし。

**返される値**

現在のクエリの初期クエリ ID を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
CREATE TABLE tmp (str String) ENGINE = Log;
INSERT INTO tmp (*) VALUES ('a');
SELECT count(DISTINCT t) FROM (SELECT initialQueryID() AS t FROM remote('127.0.0.{1..3}', currentDatabase(), 'tmp') GROUP BY queryID());
```

```response title=Response
┌─count(DISTINCT t)─┐
│                 1 │
└───────────────────┘
```


## initialQueryStartTime

導入バージョン: v25.4

現在実行中の元クエリの開始時刻を返します。
`initialQueryStartTime` は、異なるシャード間でも同じ結果を返します。

**構文**

```sql
initialQueryStartTime()
```

**別名**: `initial_query_start_time`

**引数**

* なし。

**返り値**

現在のクエリの初回実行の開始時刻を返します。[`DateTime`](/sql-reference/data-types/datetime)

**例**

**使用例**

```sql title=Query
CREATE TABLE tmp (str String) ENGINE = Log;
INSERT INTO tmp (*) VALUES ('a');
SELECT count(DISTINCT t) FROM (SELECT initialQueryStartTime() AS t FROM remote('127.0.0.{1..3}', currentDatabase(), 'tmp') GROUP BY queryID());
```

```response title=Response
┌─count(DISTINCT t)─┐
│                 1 │
└───────────────────┘
```


## initializeAggregation

導入バージョン: v20.6

単一の値に基づいて集約関数の結果を計算します。
この関数は、[-State](../../sql-reference/aggregate-functions/combinators.md#-state) コンビネータを持つ集約関数を初期化するために使用できます。
集約関数の状態を作成して、[`AggregateFunction`](../../sql-reference/data-types/aggregatefunction.md) 型のカラムに挿入したり、初期化済みの集約結果をデフォルト値として使用したりできます。

**構文**

```sql
initializeAggregation(aggregate_function, arg1[, arg2, ...])
```

**引数**

* `aggregate_function` — 初期化する集約関数の名前。[`String`](/sql-reference/data-types/string)
* `arg1[, arg2, ...]` — 集約関数の引数。[`Any`](/sql-reference/data-types)

**戻り値**

関数に渡された各行ごとの集約結果を返します。戻り値の型は、`initializeAggregation` が最初の引数として受け取る関数の戻り値の型と同じです。[`Any`](/sql-reference/data-types)

**例**

**uniqState を使った基本的な使用例**

```sql title=Query
SELECT uniqMerge(state) FROM (SELECT initializeAggregation('uniqState', number % 3) AS state FROM numbers(10000));
```

```response title=Response
┌─uniqMerge(state)─┐
│                3 │
└──────────────────┘
```

**sumState と finalizeAggregation の使用**

```sql title=Query
SELECT finalizeAggregation(state), toTypeName(state) FROM (SELECT initializeAggregation('sumState', number % 3) AS state FROM numbers(5));
```

```response title=Response
┌─finalizeAggregation(state)─┬─toTypeName(state)─────────────┐
│                          0 │ AggregateFunction(sum, UInt8) │
│                          1 │ AggregateFunction(sum, UInt8) │
│                          2 │ AggregateFunction(sum, UInt8) │
│                          0 │ AggregateFunction(sum, UInt8) │
│                          1 │ AggregateFunction(sum, UInt8) │
└────────────────────────────┴───────────────────────────────┘
```


## isConstant

導入バージョン: v20.3

引数が定数式かどうかを返します。
定数式とは、実行前、すなわちクエリ解析時点で結果が分かっている式です。
たとえば、[リテラル](/sql-reference/syntax#literals) を用いた式は定数式です。
この関数は主に開発、デバッグ、およびデモ用途を想定しています。

**構文**

```sql
isConstant(x)
```

**引数**

* `x` — 判定する式。[`Any`](/sql-reference/data-types)

**戻り値**

`x` が定数の場合は `1`、定数でない場合は `0` を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**定数式**

```sql title=Query
SELECT isConstant(x + 1)
FROM (SELECT 43 AS x)
```

```response title=Response
┌─isConstant(plus(x, 1))─┐
│                      1 │
└────────────────────────┘
```

**関数を用いた定数**

```sql title=Query
WITH 3.14 AS pi
SELECT isConstant(cos(pi))
```

```response title=Response
┌─isConstant(cos(pi))─┐
│                   1 │
└─────────────────────┘
```

**非定数式**

```sql title=Query
SELECT isConstant(number)
FROM numbers(1)
```

```response title=Response
┌─isConstant(number)─┐
│                  0 │
└────────────────────┘
```

**`now()` 関数の挙動**

```sql title=Query
SELECT isConstant(now())
```

```response title=Response
┌─isConstant(now())─┐
│                 1 │
└───────────────────┘
```


## isDecimalOverflow

導入バージョン: v20.8

10 進数が、指定された精度を持つ `Decimal` データ型に正しく格納できないほどの桁数になっているかどうかを判定します。

**構文**

```sql
isDecimalOverflow(value[, precision])
```

**引数**

* `value` — チェック対象の Decimal 型の値。[`Decimal`](/sql-reference/data-types/decimal)
* `precision` — 省略可能。Decimal 型の精度。省略された場合は、第1引数の初期の精度が使用されます。[`UInt8`](/sql-reference/data-types/int-uint)

**返り値**

Decimal 値がその精度で許容される桁数を超えている場合は `1`、指定した精度を満たしている場合は `0` を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT isDecimalOverflow(toDecimal32(1000000000, 0), 9),
       isDecimalOverflow(toDecimal32(1000000000, 0)),
       isDecimalOverflow(toDecimal32(-1000000000, 0), 9),
       isDecimalOverflow(toDecimal32(-1000000000, 0));
```

```response title=Response
┌─isDecimalOverflow(toDecimal32(1000000000, 0), 9)─┬─isDecimalOverflow(toDecimal32(1000000000, 0))─┬─isDecimalOverflow(toDecimal32(-1000000000, 0), 9)─┬─isDecimalOverflow(toDecimal32(-1000000000, 0))─┐
│                                                1 │                                             1 │                                                 1 │                                              1 │
└──────────────────────────────────────────────────┴───────────────────────────────────────────────┴───────────────────────────────────────────────────┴────────────────────────────────────────────────┘
```


## joinGet

導入バージョン: v18.16

テーブルから、ディクショナリと同じ方法でデータを抽出できる関数です。
指定した結合キーを使って、Join テーブルからデータを取得します。

:::note
`ENGINE = Join(ANY, LEFT, <join_keys>)` [ステートメント](/engines/table-engines/special/join) で作成されたテーブルにのみ対応しています。
:::

**構文**

```sql
joinGet(join_storage_table_name, value_column, join_keys)
```

**引数**

* `join_storage_table_name` — 検索を実行するテーブルを示す識別子。識別子はデフォルトデータベース内で検索されます（設定ファイルのパラメータ `default_database` を参照）。デフォルトデータベースを変更するには、`USE database_name` クエリを使用するか、`database_name.table_name` のようにドットで区切ってデータベース名とテーブル名を指定します。[`String`](/sql-reference/data-types/string)
* `value_column` — 必要なデータを含むテーブルのカラム名。[`const String`](/sql-reference/data-types/string)
* `join_keys` — 結合キーのリスト。[`Any`](/sql-reference/data-types)

**戻り値**

キーのリストに対応する値のリストを返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=Query
CREATE TABLE db_test.id_val(`id` UInt32, `val` UInt32) ENGINE = Join(ANY, LEFT, id);
INSERT INTO db_test.id_val VALUES (1,11)(2,12)(4,13);

SELECT joinGet(db_test.id_val, 'val', toUInt32(1));
```

```response title=Response
┌─joinGet(db_test.id_val, 'val', toUInt32(1))─┐
│                                          11 │
└─────────────────────────────────────────────┘
```

**現在のデータベース内のテーブルを使用する場合**

```sql title=Query
USE db_test;
SELECT joinGet(id_val, 'val', toUInt32(2));
```

```response title=Response
┌─joinGet(id_val, 'val', toUInt32(2))─┐
│                                  12 │
└─────────────────────────────────────┘
```

**配列を JOIN キーとして使用する**

```sql title=Query
CREATE TABLE some_table (id1 UInt32, id2 UInt32, name String) ENGINE = Join(ANY, LEFT, id1, id2);
INSERT INTO some_table VALUES (1, 11, 'a') (2, 12, 'b') (3, 13, 'c');

SELECT joinGet(some_table, 'name', 1, 11);
```

```response title=Response
┌─joinGet(some_table, 'name', 1, 11)─┐
│ a                                  │
└────────────────────────────────────┘
```


## joinGetOrNull

導入バージョン: v20.4

テーブルから辞書と同様の方法でデータを抽出できます。
指定された結合キーを使用して、Join エンジンのテーブルからデータを取得します。
[`joinGet`](#joinGet) とは異なり、キーが存在しない場合は `NULL` を返します。

:::note
`ENGINE = Join(ANY, LEFT, <join_keys>)` [ステートメント](/engines/table-engines/special/join)で作成されたテーブルにのみ対応します。
:::

**構文**

```sql
joinGetOrNull(join_storage_table_name, value_column, join_keys)
```

**引数**

* `join_storage_table_name` — 検索を実行する場所を示す識別子。識別子はデフォルトデータベース内で検索されます（設定ファイルのパラメータ `default_database` を参照）。デフォルトデータベースを変更するには、`USE database_name` クエリを使用するか、`database_name.table_name` のようにドット区切りでデータベースとテーブルを指定します。[`String`](/sql-reference/data-types/string)
* `value_column` — 必要なデータを含むテーブルの列名。[`const String`](/sql-reference/data-types/string)
* `join_keys` — 結合キーのリスト。[`Any`](/sql-reference/data-types)

**戻り値**

キーのリストに対応する値のリストを返し、キーが見つからない場合は `NULL` を返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=Query
CREATE TABLE db_test.id_val(`id` UInt32, `val` UInt32) ENGINE = Join(ANY, LEFT, id);
INSERT INTO db_test.id_val VALUES (1,11)(2,12)(4,13);

SELECT joinGetOrNull(db_test.id_val, 'val', toUInt32(1)), joinGetOrNull(db_test.id_val, 'val', toUInt32(999));
```

```response title=Response
┌─joinGetOrNull(db_test.id_val, 'val', toUInt32(1))─┬─joinGetOrNull(db_test.id_val, 'val', toUInt32(999))─┐
│                                                11 │                                                ᴺᵁᴸᴸ │
└───────────────────────────────────────────────────┴─────────────────────────────────────────────────────┘
```


## lowCardinalityIndices

導入バージョン: v18.12

[LowCardinality](../data-types/lowcardinality.md) 列の辞書内における値の位置を返します。位置は 1 から始まります。LowCardinality にはデータパーツごとに個別の辞書があるため、この関数は同じ値であっても、パーツが異なれば異なる位置を返す可能性があります。

**構文**

```sql
lowCardinalityIndices(col)
```

**引数**

* `col` — 低カーディナリティの列。[`LowCardinality`](/sql-reference/data-types/lowcardinality)

**戻り値**

現在のパートにおける辞書内での値の位置。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
DROP TABLE IF EXISTS test;
CREATE TABLE test (s LowCardinality(String)) ENGINE = Memory;

-- 2つのパートを作成:

INSERT INTO test VALUES ('ab'), ('cd'), ('ab'), ('ab'), ('df');
INSERT INTO test VALUES ('ef'), ('cd'), ('ab'), ('cd'), ('ef');

SELECT s, lowCardinalityIndices(s) FROM test;
```

```response title=Response
┌─s──┬─lowCardinalityIndices(s)─┐
│ ab │                        1 │
│ cd │                        2 │
│ ab │                        1 │
│ ab │                        1 │
│ df │                        3 │
└────┴──────────────────────────┘
┌─s──┬─lowCardinalityIndices(s)─┐
│ ef │                        1 │
│ cd │                        2 │
│ ab │                        3 │
│ cd │                        2 │
│ ef │                        1 │
└────┴──────────────────────────┘
```


## lowCardinalityKeys

導入バージョン: v18.12

[LowCardinality](../data-types/lowcardinality.md) 列の辞書値を返します。
ブロックのサイズが辞書サイズより小さいか大きい場合、結果は切り詰められるか、デフォルト値で拡張されます。
LowCardinality はパートごとに辞書を持つため、この関数はパートごとに異なる辞書値を返すことがあります。

**構文**

```sql
lowCardinalityKeys(col)
```

**引数**

* `col` — 低カーディナリティの列。[`LowCardinality`](/sql-reference/data-types/lowcardinality)

**戻り値**

辞書のキーを返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**lowCardinalityKeys**

```sql title=Query
DROP TABLE IF EXISTS test;
CREATE TABLE test (s LowCardinality(String)) ENGINE = Memory;

-- 2つのパートを作成:

INSERT INTO test VALUES ('ab'), ('cd'), ('ab'), ('ab'), ('df');
INSERT INTO test VALUES ('ef'), ('cd'), ('ab'), ('cd'), ('ef');

SELECT s, lowCardinalityKeys(s) FROM test;
```

```response title=Response
┌─s──┬─lowCardinalityKeys(s)─┐
│ ef │                       │
│ cd │ ef                    │
│ ab │ cd                    │
│ cd │ ab                    │
│ ef │                       │
└────┴───────────────────────┘
┌─s──┬─lowCardinalityKeys(s)─┐
│ ab │                       │
│ cd │ ab                    │
│ ab │ cd                    │
│ ab │ df                    │
│ df │                       │
└────┴───────────────────────┘
```


## materialize

導入: v1.1

定数を、単一の値のみを含む通常のカラム（フルカラム）に変換します。
フルカラムと定数はメモリ上では異なる形式で表現されます。
関数は通常、通常の引数と定数引数に対して異なるコードを実行しますが、結果自体は通常同じになるはずです。
この関数は、そのような挙動をデバッグするために使用できます。

**構文**

```sql
materialize(x)
```

**引数**

* `x` — 定数。[`Any`](/sql-reference/data-types)

**戻り値**

定数値のみを含むカラム全体を返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=Query
-- 以下の例では、`countMatches`関数は第2引数に定数を必要とします。
-- この動作は、`materialize`関数を使用して定数を完全なカラムに変換することでデバッグでき、
-- 非定数引数に対して関数がエラーをスローすることを確認できます。

SELECT countMatches('foobarfoo', 'foo');
SELECT countMatches('foobarfoo', materialize('foo'));
```

```response title=Response
2
コード: 44. DB::Exception: localhost:9000から受信。DB::Exception: 関数countMatchesの引数#2 'pattern'の型が不正です。定数String型が期待されていますが、String型を受け取りました
```


## minSampleSizeContinuous

導入バージョン: v23.10

2つのサンプルにおける連続値の指標の平均を比較する A/B テストに必要な最小サンプルサイズを計算します。

[この記事](https://towardsdatascience.com/required-sample-size-for-a-b-testing-6f6608dd330a)で説明されている式を使用します。
処置群と対照群のサンプル数が等しいと仮定します。
1つのグループに必要なサンプルサイズを返します（つまり、実験全体に必要なサンプルサイズは返り値の2倍です）。
また、処置群と対照群でテスト対象の指標の分散が等しいことも仮定します。

**構文**

```sql
minSampleSizeContinuous(baseline, sigma, mde, power, alpha)
```

**別名**: `minSampleSizeContinous`

**引数**

* `baseline` — 指標のベースライン値。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float)
* `sigma` — 指標のベースライン標準偏差。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float)
* `mde` — ベースライン値に対する最小検出可能効果 (MDE) を、ベースライン値に対する比率（パーセンテージ）で指定した値（例: ベースライン値が 112.25 のとき、MDE 0.03 は 112.25 ± 112.25*0.03 への変化を想定）。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float)
* `power` — テストに要求される統計的検出力（1 - 第 II 種の誤りの確率）。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float)
* `alpha` — テストに要求される有意水準（第 I 種の誤りの確率）。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float)

**戻り値**

3 要素からなる名前付き Tuple を返します: `minimum_sample_size`, `detect_range_lower`, `detect_range_upper`。これらはそれぞれ、必要なサンプルサイズ、返された必要サンプルサイズでは検出できない値の範囲の下限（`baseline * (1 - mde)` で計算）、および返された必要サンプルサイズでは検出できない値の範囲の上限（`baseline * (1 + mde)` で計算）です（いずれも Float64）。[`Tuple(Float64, Float64, Float64)`](/sql-reference/data-types/tuple)

**例**

**minSampleSizeContinuous**

```sql title=Query
SELECT minSampleSizeContinuous(112.25, 21.1, 0.03, 0.80, 0.05) AS sample_size
```

```response title=Response
(616.2931945826209,108.8825,115.6175)
```


## minSampleSizeConversion

導入バージョン: v22.6

2つのサンプル間でコンバージョン（比率）を比較する A/B テストに必要な最小サンプルサイズを計算します。

[この記事](https://towardsdatascience.com/required-sample-size-for-a-b-testing-6f6608dd330a)で説明されている式を使用します。介入群と対照群のサイズが等しいと仮定します。1つのグループに必要なサンプルサイズを返します（つまり、実験全体に必要なサンプルサイズは返り値の2倍になります）。

**構文**

```sql
minSampleSizeConversion(baseline, mde, power, alpha)
```

**引数**

* `baseline` — ベースラインのコンバージョン率。[`Float*`](/sql-reference/data-types/float)
* `mde` — 最小検出可能効果 (MDE) をパーセンテージポイントで指定（例: ベースラインコンバージョンが 0.25 のとき、MDE 0.03 は期待される変化が 0.25 ± 0.03 であることを意味します）。[`Float*`](/sql-reference/data-types/float)
* `power` — テストに必要な検出力（統計的パワー、1 - 第 II 種の誤りの確率）。[`Float*`](/sql-reference/data-types/float)
* `alpha` — テストに必要な有意水準（第 I 種の誤りの確率）。[`Float*`](/sql-reference/data-types/float)

**戻り値**

3 つの要素 `minimum_sample_size`、`detect_range_lower`、`detect_range_upper` を持つ名前付き Tuple を返します。これらはそれぞれ、必要なサンプルサイズ、返された必要サンプルサイズでは検出できない値の範囲の下限（`baseline - mde` で計算）、返された必要サンプルサイズでは検出できない値の範囲の上限（`baseline + mde` で計算）です。[`Tuple(Float64, Float64, Float64)`](/sql-reference/data-types/tuple)

**使用例**

**minSampleSizeConversion**

```sql title=Query
SELECT minSampleSizeConversion(0.25, 0.03, 0.80, 0.05) AS sample_size
```

```response title=Response
(3396.077603219163,0.22,0.28)
```


## neighbor

導入バージョン: v20.1

現在の行から指定されたオフセット位置にある列の値を返します。
この関数はデータブロックの物理的な順序に対して動作するため、ユーザーが想定する論理的な順序と一致しない場合があり、非推奨でありエラーを引き起こしやすいものです。
代わりに、適切なウィンドウ関数の使用を検討してください。

この関数は `allow_deprecated_error_prone_window_functions = 1` を設定することで有効化できます。

**構文**

```sql
neighbor(column, offset[, default_value])
```

**引数**

* `column` — 対象となるカラム。[`Any`](/sql-reference/data-types)
* `offset` — 現在の行からのオフセット。正の値は先の行、負の値は前の行を参照します。[`Integer`](/sql-reference/data-types/int-uint)
* `default_value` — 省略可。オフセットがデータ範囲外になった場合に返す値。指定しない場合は、そのカラム型のデフォルト値が使用されます。[`Any`](/sql-reference/data-types)

**戻り値**

指定したオフセット位置の値、または範囲外の場合はデフォルト値を返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=Query
SELECT number, neighbor(number, 2) FROM system.numbers LIMIT 10;
```

```response title=Response
┌─number─┬─neighbor(number, 2)─┐
│      0 │                   2 │
│      1 │                   3 │
│      2 │                   4 │
│      3 │                   5 │
│      4 │                   6 │
│      5 │                   7 │
│      6 │                   8 │
│      7 │                   9 │
│      8 │                   0 │
│      9 │                   0 │
└────────┴─────────────────────┘
```

**デフォルト値あり**

```sql title=Query
SELECT number, neighbor(number, 2, 999) FROM system.numbers LIMIT 10;
```

```response title=Response
┌─number─┬─neighbor(number, 2, 999)─┐
│      0 │                        2 │
│      1 │                        3 │
│      2 │                        4 │
│      3 │                        5 │
│      4 │                        6 │
│      5 │                        7 │
│      6 │                        8 │
│      7 │                        9 │
│      8 │                      999 │
│      9 │                      999 │
└────────┴──────────────────────────┘
```


## nested

導入バージョン: v

これは ClickHouse エンジン内部で使用される関数であり、直接の利用は想定されていません。

複数の配列からタプルの配列を返します。

最初の引数は、結果として得られる `Tuple` のフィールド名を決定する、`String` 型の定数配列でなければなりません。
その他の引数は、同じ長さの配列でなければなりません。

**構文**

```sql
```

**引数**

* なし。

**戻り値**

**例**

**ネスト**

```sql title=Query
SELECT nested(['keys', 'values'], ['key_1', 'key_2'], ['value_1','value_2'])
```

```response title=Response
```


## normalizeQuery

導入バージョン: v20.8

リテラル、連続するリテラル、および複雑なエイリアス（空白を含むもの、3 桁以上の数字を含むもの、または UUID のように少なくとも 36 バイトの長さがあるもの）をプレースホルダー `?` に置き換えます。

**構文**

```sql
normalizeQuery(x)
```

**引数**

* `x` — 文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

指定された文字列を、プレースホルダーを含んだ形で返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT normalizeQuery('[1, 2, 3, x]') AS query
```

```response title=Response
┌─query────┐
│ [?.., x] │
└──────────┘
```


## normalizeQueryKeepNames

導入バージョン: v21.2

リテラルおよびリテラルの並びをプレースホルダー `?` に置き換えますが、複雑なエイリアス（空白文字を含むもの、3 桁以上の数字を含むもの、または UUID のように 36 バイト以上の長さのもの）は置き換えません。
これにより、複雑なクエリログをより適切に分析できます。

**構文**

```sql
normalizeQueryKeepNames(x)
```

**引数**

* `x` — 文字のシーケンス。[`String`](/sql-reference/data-types/string)

**戻り値**

プレースホルダを含む、指定された文字のシーケンスを返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT normalizeQuery('SELECT 1 AS aComplexName123'), normalizeQueryKeepNames('SELECT 1 AS aComplexName123')
```

```response title=Response
┌─normalizeQuery('SELECT 1 AS aComplexName123')─┬─normalizeQueryKeepNames('SELECT 1 AS aComplexName123')─┐
│ SELECT ? AS `?`                               │ SELECT ? AS aComplexName123                            │
└───────────────────────────────────────────────┴────────────────────────────────────────────────────────┘
```


## normalizedQueryHash

導入バージョン: v20.8

類似したクエリに対して、リテラルの値を無視して同一の 64 ビットハッシュ値を返します。
クエリログの分析に役立ちます。

**構文**

```sql
normalizedQueryHash(x)
```

**引数**

* `x` — 文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

64ビットのハッシュ値を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT normalizedQueryHash('SELECT 1 AS `xyz`') != normalizedQueryHash('SELECT 1 AS `abc`') AS res
```

```response title=Response
┌─res─┐
│   1 │
└─────┘
```


## normalizedQueryHashKeepNames

導入バージョン: v21.2

[`normalizedQueryHash`](#normalizedQueryHash) と同様に、類似したクエリに対してリテラル値を除いた同一の 64 ビットハッシュ値を返しますが、ハッシュ化の前に複雑なエイリアス（空白を含むもの、2 桁を超える数字を含むもの、または UUID のように少なくとも 36 バイトの長さがあるもの）をプレースホルダーに置き換えません。
クエリログの分析に役立ちます。

**構文**

```sql
normalizedQueryHashKeepNames(x)
```

**引数**

* `x` — 文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

64 ビットのハッシュ値を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT normalizedQueryHash('SELECT 1 AS `xyz123`') != normalizedQueryHash('SELECT 1 AS `abc123`') AS normalizedQueryHash;
SELECT normalizedQueryHashKeepNames('SELECT 1 AS `xyz123`') != normalizedQueryHashKeepNames('SELECT 1 AS `abc123`') AS normalizedQueryHashKeepNames;
```

```response title=Response
┌─normalizedQueryHash─┐
│                   0 │
└─────────────────────┘
┌─normalizedQueryHashKeepNames─┐
│                            1 │
└──────────────────────────────┘
```


## parseReadableSize

導入バージョン: v24.6

バイトサイズと、単位として `B`、`KiB`、`KB`、`MiB`、`MB` など（すなわち [ISO/IEC 80000-13](https://en.wikipedia.org/wiki/ISO/IEC_80000) もしくは 10 進バイト単位）から成る文字列を引数として渡すと、この関数は対応するバイト数を返します。
入力値を解析できない場合、この関数は例外をスローします。

この関数の逆操作は [`formatReadableSize`](#formatReadableSize) および [`formatReadableDecimalSize`](#formatReadableDecimalSize) です。

**構文**

```sql
parseReadableSize(x)
```

**引数**

* `x` — ISO/IEC 80000-13 または 10 進バイト単位で表現された、人間にとって読みやすいサイズ。[`String`](/sql-reference/data-types/string)

**返される値**

端数を切り上げた整数のバイト数を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT arrayJoin(['1 B', '1 KiB', '3 MB', '5.314 KiB']) AS readable_sizes, parseReadableSize(readable_sizes) AS sizes;
```

```response title=Response
┌─readable_sizes─┬───sizes─┐
│ 1 B            │       1 │
│ 1 KiB          │    1024 │
│ 3 MB           │ 3000000 │
│ 5.314 KiB      │    5442 │
└────────────────┴─────────┘
```


## parseReadableSizeOrNull

導入バージョン: v24.6

`B`、`KiB`、`KB`、`MiB`、`MB` などの単位（[ISO/IEC 80000-13](https://en.wikipedia.org/wiki/ISO/IEC_80000) に準拠した単位または 10進バイト単位）付きのバイトサイズを表す文字列を渡すと、この関数は対応するバイト数を返します。
入力値を解析できない場合、この関数は `NULL` を返します。

この関数の逆演算は [`formatReadableSize`](#formatReadableSize) と [`formatReadableDecimalSize`](#formatReadableDecimalSize) です。

**構文**

```sql
parseReadableSizeOrNull(x)
```

**引数**

* `x` — ISO/IEC 80000-13 形式または 10 進数バイト単位で表記された人間が読みやすいサイズ。[`String`](/sql-reference/data-types/string)

**戻り値**

バイト数を切り上げた整数値、または入力を解析できない場合は `NULL` を返します。[`Nullable(UInt64)`](/sql-reference/data-types/nullable)

**例**

**使用例**

```sql title=Query
SELECT arrayJoin(['1 B', '1 KiB', '3 MB', '5.314 KiB', 'invalid']) AS readable_sizes, parseReadableSizeOrNull(readable_sizes) AS sizes;
```

```response title=Response
┌─readable_sizes─┬───sizes─┐
│ 1 B            │       1 │
│ 1 KiB          │    1024 │
│ 3 MB           │ 3000000 │
│ 5.314 KiB      │    5442 │
│ invalid        │    ᴺᵁᴸᴸ │
└────────────────┴─────────┘
```


## parseReadableSizeOrZero

導入バージョン: v24.6

`B`、`KiB`、`KB`、`MiB`、`MB` などの単位（すなわち [ISO/IEC 80000-13](https://en.wikipedia.org/wiki/ISO/IEC_80000) で定義される単位または 10 進表記のバイト単位）を含むバイトサイズ表現の文字列が与えられた場合、この関数は対応するバイト数を返します。
入力値をパースできない場合、この関数は `0` を返します。

この関数の逆変換となる操作は、[`formatReadableSize`](#formatReadableSize) および [`formatReadableDecimalSize`](#formatReadableDecimalSize) です。

**構文**

```sql
parseReadableSizeOrZero(x)
```

**引数**

* `x` — ISO/IEC 80000-13 または 10 進バイト単位で表現された、人間にとって読みやすい形式のサイズ。[`String`](/sql-reference/data-types/string)

**返される値**

バイト数を端数切り上げした整数値、または入力を解析できない場合は `0` を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT arrayJoin(['1 B', '1 KiB', '3 MB', '5.314 KiB', 'invalid']) AS readable_sizes, parseReadableSizeOrZero(readable_sizes) AS sizes;
```

```response title=Response
┌─readable_sizes─┬───sizes─┐
│ 1 B            │       1 │
│ 1 KiB          │    1024 │
│ 3 MB           │ 3000000 │
│ 5.314 KiB      │    5442 │
│ invalid        │       0 │
└────────────────┴─────────┘
```


## parseTimeDelta

導入バージョン: v22.7

時間単位を表す文字列が後続する数値列をパースします。

時間差（time delta）を表す文字列では、次の時間単位指定を使用できます:

* `years`, `year`, `yr`, `y`
* `months`, `month`, `mo`
* `weeks`, `week`, `w`
* `days`, `day`, `d`
* `hours`, `hour`, `hr`, `h`
* `minutes`, `minute`, `min`, `m`
* `seconds`, `second`, `sec`, `s`
* `milliseconds`, `millisecond`, `millisec`, `ms`
* `microseconds`, `microsecond`, `microsec`, `μs`, `µs`, `us`
* `nanoseconds`, `nanosecond`, `nanosec`, `ns`

複数の時間単位は、区切り文字（スペース、`;`、`-`、`+`、`,`、`:`）で組み合わせることができます。

年および月の長さは近似値です: 年は 365 日、月は 30.5 日です。

**構文**

```sql
parseTimeDelta(timestr)
```

**引数**

* `timestr` — 数値列の後に、時間単位のようなものが続く文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

秒数。[`Float64`](/sql-reference/data-types/float)

**例**

**使用例**

```sql title=Query
SELECT parseTimeDelta('11s+22min')
```

```response title=Response
┌─parseTimeDelta('11s+22min')─┐
│                        1331 │
└─────────────────────────────┘
```

**複雑な時間単位**

```sql title=Query
SELECT parseTimeDelta('1yr2mo')
```

```response title=Response
┌─parseTimeDelta('1yr2mo')─┐
│                 36806400 │
└──────────────────────────┘
```


## partitionId

導入バージョン: v21.4

[パーティション ID](../../engines/table-engines/mergetree-family/custom-partitioning-key.md)を計算します。

:::note
この関数は低速であるため、大量の行に対して呼び出すべきではありません。
:::

**構文**

```sql
partitionId(column1[, column2, ...])
```

**別名**: `partitionID`

**引数**

* `column1, column2, ...` — パーティション ID を取得するカラム。

**戻り値**

行が属するパーティション ID を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
DROP TABLE IF EXISTS tab;

CREATE TABLE tab
(
  i int,
  j int
)
ENGINE = MergeTree
PARTITION BY i
ORDER BY tuple();

INSERT INTO tab VALUES (1, 1), (1, 2), (1, 3), (2, 4), (2, 5), (2, 6);

SELECT i, j, partitionId(i), _partition_id FROM tab ORDER BY i, j;
```

```response title=Response
┌─i─┬─j─┬─partitionId(i)─┬─_partition_id─┐
│ 1 │ 1 │ 1              │ 1             │
│ 1 │ 2 │ 1              │ 1             │
│ 1 │ 3 │ 1              │ 1             │
│ 2 │ 4 │ 2              │ 2             │
│ 2 │ 5 │ 2              │ 2             │
│ 2 │ 6 │ 2              │ 2             │
└───┴───┴────────────────┴───────────────┘
```


## queryID

導入バージョン: v21.9

現在のクエリの ID を返します。
クエリのその他のパラメータは、[`system.query_log`](../../operations/system-tables/query_log.md) テーブルの `query_id` フィールドから取得できます。

[`initialQueryID`](#initialQueryID) 関数とは対照的に、`queryID` は異なるシャードでは異なる結果を返す場合があります。

**構文**

```sql
queryID()
```

**別名**: `query_id`

**引数**

* なし。

**戻り値**

現在のクエリのIDを返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
CREATE TABLE tmp (str String) ENGINE = Log;
INSERT INTO tmp (*) VALUES ('a');
SELECT count(DISTINCT t) FROM (SELECT queryID() AS t FROM remote('127.0.0.{1..3}', currentDatabase(), 'tmp') GROUP BY queryID());
```

```response title=Response
┌─count(DISTINCT t)─┐
│                 3 │
└───────────────────┘
```


## revision

導入バージョン: v22.7

現在の ClickHouse サーバーのリビジョンを返します。

**構文**

```sql
revision()
```

**引数**

* なし。

**戻り値**

現在の ClickHouse サーバーのリビジョン番号を返します。[`UInt32`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT revision()
```

```response title=Response
┌─revision()─┐
│      54485 │
└────────────┘
```


## rowNumberInAllBlocks

導入バージョン: v1.1

処理される各行に対して、一意の行番号を返します。

**構文**

```sql
rowNumberInAllBlocks()
```

**引数**

* なし。

**戻り値**

データブロック内の行の行番号を `0` から始めて返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT rowNumberInAllBlocks()
FROM
(
    SELECT *
    FROM system.numbers_mt
    LIMIT 10
)
SETTINGS max_block_size = 2
```

```response title=Response
┌─rowNumberInAllBlocks()─┐
│                      0 │
│                      1 │
└────────────────────────┘
┌─rowNumberInAllBlocks()─┐
│                      4 │
│                      5 │
└────────────────────────┘
┌─rowNumberInAllBlocks()─┐
│                      2 │
│                      3 │
└────────────────────────┘
┌─rowNumberInAllBlocks()─┐
│                      6 │
│                      7 │
└────────────────────────┘
┌─rowNumberInAllBlocks()─┐
│                      8 │
│                      9 │
└────────────────────────┘
```


## rowNumberInBlock

導入: v1.1

`rowNumberInBlock` によって処理される各[ブロック](../../development/architecture.md#block)に対して、現在の行番号を返します。

返される番号は、各ブロックごとに 0 から始まります。

**構文**

```sql
rowNumberInBlock()
```

**引数**

* なし。

**戻り値**

データブロック内の行の番号を、`0` から始めて返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT rowNumberInBlock()
FROM
(
    SELECT *
    FROM system.numbers_mt
    LIMIT 10
) SETTINGS max_block_size = 2
```

```response title=Response
┌─rowNumberInBlock()─┐
│                  0 │
│                  1 │
└────────────────────┘
┌─rowNumberInBlock()─┐
│                  0 │
│                  1 │
└────────────────────┘
┌─rowNumberInBlock()─┐
│                  0 │
│                  1 │
└────────────────────┘
┌─rowNumberInBlock()─┐
│                  0 │
│                  1 │
└────────────────────┘
┌─rowNumberInBlock()─┐
│                  0 │
│                  1 │
└────────────────────┘
```


## runningAccumulate

導入バージョン: v1.1

データブロック内の各行に対して、集約関数の状態を累積します。

:::warning 非推奨
状態は、新しいデータブロックごとにリセットされます。
このようにエラーを招きやすい挙動であるため、この関数は非推奨となっており、代わりに [window functions](/sql-reference/window-functions) の使用が推奨されます。
この関数の使用を許可するには、設定 [`allow_deprecated_error_prone_window_functions`](/operations/settings/settings#allow_deprecated_error_prone_window_functions) を有効にしてください。
:::

**構文**

```sql
runningAccumulate(agg_state[, grouping])
```

**引数**

* `agg_state` — 集約関数の状態。[`AggregateFunction`](/sql-reference/data-types/aggregatefunction)
* `grouping` — 省略可。グルーピングキー。`grouping` の値が変わると、関数の状態はリセットされます。等価演算子が定義されている、サポートされている任意のデータ型を使用できます。[`Any`](/sql-reference/data-types)

**戻り値**

各行について、累積された結果を返します。[`Any`](/sql-reference/data-types)

**例**

**initializeAggregation を使用した例**

```sql title=Query
WITH initializeAggregation('sumState', number) AS one_row_sum_state
SELECT
    number,
    finalizeAggregation(one_row_sum_state) AS one_row_sum,
    runningAccumulate(one_row_sum_state) AS cumulative_sum
FROM numbers(5);
```

```response title=Response
┌─number─┬─one_row_sum─┬─cumulative_sum─┐
│      0 │           0 │              0 │
│      1 │           1 │              1 │
│      2 │           2 │              3 │
│      3 │           3 │              6 │
│      4 │           4 │             10 │
└────────┴─────────────┴────────────────┘
```


## runningConcurrency

導入バージョン: v21.3

同時に発生しているイベントの数を計算します。
各イベントには開始時刻と終了時刻があります。
開始時刻はイベントに含まれますが、終了時刻は含まれません。
開始時刻と終了時刻を表す列は、同じデータ型でなければなりません。
この関数は、各イベントの開始時刻ごとに、アクティブ（同時実行）なイベントの合計数を計算します。

:::tip Requirements
イベントは開始時刻で昇順に並んでいる必要があります。
この要件に違反した場合、関数は例外をスローします。
各データブロックは個別に処理されます。
異なるデータブロックに属するイベントが重なっている場合、それらは正しく処理されません。
:::

:::warning Deprecated
代わりに [window functions](/sql-reference/window-functions) を使用することが推奨されます。
:::

**構文**

```sql
runningConcurrency(start, end)
```

**引数**

* `start` — イベントの開始時刻を含む列。[`Date`](/sql-reference/data-types/date) または [`DateTime`](/sql-reference/data-types/datetime) または [`DateTime64`](/sql-reference/data-types/datetime64)
* `end` — イベントの終了時刻を含む列。[`Date`](/sql-reference/data-types/date) または [`DateTime`](/sql-reference/data-types/datetime) または [`DateTime64`](/sql-reference/data-types/datetime64)

**戻り値**

各イベントの開始時刻における同時発生中のイベント数を返します。[`UInt32`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT start, runningConcurrency(start, end) FROM example_table;
```

```response title=Response
┌──────start─┬─runningConcurrency(start, end)─┐
│ 2025-03-03 │                              1 │
│ 2025-03-06 │                              2 │
│ 2025-03-07 │                              3 │
│ 2025-03-11 │                              2 │
└────────────┴────────────────────────────────┘
```


## runningDifference

導入バージョン: v1.1

データブロック内の連続する 2 つの行の値の差を計算します。
最初の行については `0` を返し、それ以降の行については直前の行との差を返します。

:::warning Deprecated
現在処理中のデータブロック内でのみ差分を返します。
このようにエラーを招きやすい挙動のため、この関数は非推奨です。
代わりに [window functions](/sql-reference/window-functions) の使用が推奨されます。

この関数の使用を許可するには、設定 [`allow_deprecated_error_prone_window_functions`](/operations/settings/settings#allow_deprecated_error_prone_window_functions) を有効にしてください。
:::

関数の結果は、対象となるデータブロックと、そのブロック内のデータの順序に依存します。
`runningDifference()` の計算時における行の順序は、ユーザーに返される行の順序と異なる場合があります。
これを防ぐには、[`ORDER BY`](../../sql-reference/statements/select/order-by.md) を使用したサブクエリを作成し、そのサブクエリの外側からこの関数を呼び出します。
ブロックサイズが結果に影響することに注意してください。
`runningDifference` の内部状態は、新しいブロックごとにリセットされます。

**構文**

```sql
runningDifference(x)
```

**引数**

* `x` — ランニング差分（連続する行同士の差分）を計算する対象のカラム。[`Any`](/sql-reference/data-types)

**戻り値**

連続する値同士の差分を返します。最初の行については 0 を返します。

**例**

**使用例**

```sql title=Query
SELECT
    EventID,
    EventTime,
    runningDifference(EventTime) AS delta
FROM
(
    SELECT
        EventID,
        EventTime
    FROM events
    WHERE EventDate = '2025-11-24'
    ORDER BY EventTime ASC
    LIMIT 5
);
```

```response title=Response
┌─EventID─┬───────────EventTime─┬─delta─┐
│    1106 │ 2025-11-24 00:00:04 │     0 │
│    1107 │ 2025-11-24 00:00:05 │     1 │
│    1108 │ 2025-11-24 00:00:05 │     0 │
│    1109 │ 2025-11-24 00:00:09 │     4 │
│    1110 │ 2025-11-24 00:00:10 │     1 │
└─────────┴─────────────────────┴───────┘
```

**ブロックサイズが与える影響の例**

```sql title=Query
SELECT
    number,
    runningDifference(number + 1) AS diff
FROM numbers(100000)
WHERE diff != 1;
```

```response title=Response
┌─number─┬─diff─┐
│      0 │    0 │
└────────┴──────┘
┌─number─┬─diff─┐
│  65536 │    0 │
└────────┴──────┘
```


## runningDifferenceStartingWithFirstValue

導入バージョン: v1.1

データブロック内の連続する行の値の差分を計算します。ただし [`runningDifference`](#runningDifference) と異なり、最初の行については `0` ではなく実際の値を返します。

:::warning Deprecated
現在処理中のデータブロック内でのみ差分を返します。
このような誤用を招きやすい挙動のため、この関数は非推奨です。
代わりに [ウィンドウ関数](/sql-reference/window-functions) を使用することを推奨します。

設定 `allow_deprecated_error_prone_window_functions` を有効にすると、この関数を使用できます。
:::

**構文**

```sql
runningDifferenceStartingWithFirstValue(x)
```

**引数**

* `x` — 連続する行の差分（running difference）を計算する列。[`Any`](/sql-reference/data-types)

**戻り値**

連続する値同士の差分を返し、最初の行についてはその行自身の値を返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=Query
SELECT
    number,
    runningDifferenceStartingWithFirstValue(number) AS diff
FROM numbers(5);
```

```response title=Response
┌─number─┬─diff─┐
│      0 │    0 │
│      1 │    1 │
│      2 │    1 │
│      3 │    1 │
│      4 │    1 │
└────────┴──────┘
```


## serverUUID

導入バージョン: v20.1

サーバーが最初に起動したときに生成される、ランダムかつ一意な UUID (v4) を返します。
この UUID は永続化されており、2 回目、3 回目以降のサーバー起動でも同じ UUID が返されます。

**構文**

```sql
serverUUID()
```

**引数**

* なし。

**戻り値**

サーバーのランダムな UUID を返します。[`UUID`](/sql-reference/data-types/uuid)

**例**

**使用例**

```sql title=Query
SELECT serverUUID();
```

```response title=Response
┌─serverUUID()─────────────────────────────┐
│ 7ccc9260-000d-4d5c-a843-5459abaabb5f     │
└──────────────────────────────────────────┘
```


## shardCount

導入されたバージョン: v21.9

分散クエリのシャード数の合計を返します。
クエリが分散クエリでない場合は、定数値 `0` が返されます。

**構文**

```sql
shardCount()
```

**引数**

* なし

**戻り値**

シャードの総数、または `0` を返します。[`UInt32`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
-- shardCount()も示す上記のshardNum()の例を参照してください
CREATE TABLE shard_count_example (dummy UInt8)
ENGINE=Distributed(test_cluster_two_shards_localhost, system, one, dummy);
SELECT shardCount() FROM shard_count_example;
```

```response title=Response
┌─shardCount()─┐
│            2 │
│            2 │
└──────────────┘
```


## shardNum

導入バージョン: v21.9

分散クエリでデータの一部を処理するシャードのインデックスを返します。
インデックスは `1` から始まります。
クエリが分散クエリでない場合は、定数値 `0` が返されます。

**構文**

```sql
shardNum()
```

**引数**

* なし。

**戻り値**

シャードインデックスの値、または定数 `0` を返します。[`UInt32`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
CREATE TABLE shard_num_example (dummy UInt8)
ENGINE=Distributed(test_cluster_two_shards_localhost, system, one, dummy);
SELECT dummy, shardNum(), shardCount() FROM shard_num_example;
```

```response title=Response
┌─dummy─┬─shardNum()─┬─shardCount()─┐
│     0 │          1 │            2 │
│     0 │          2 │            2 │
└───────┴────────────┴──────────────┘
```


## showCertificate

導入バージョン: v22.6

現在のサーバーに Secure Sockets Layer (SSL) 証明書が構成されている場合、その証明書に関する情報を表示します。
ClickHouse で OpenSSL 証明書を使用して接続を検証する方法の詳細については、[Configuring SSL-TLS](/guides/sre/configuring-ssl) を参照してください。

**構文**

```sql
showCertificate()
```

**引数**

* なし。

**戻り値**

設定された SSL 証明書に関連するキーと値のペアからなるマップを返します。[`Map(String, String)`](/sql-reference/data-types/map)

**例**

**使用例**

```sql title=Query
SELECT showCertificate() FORMAT LineAsString;
```

```response title=Response
{'version':'1','serial_number':'2D9071D64530052D48308473922C7ADAFA85D6C5','signature_algo':'sha256WithRSAEncryption','issuer':'/CN=marsnet.local CA','not_before':'May  7 17:01:21 2024 GMT','not_after':'May  7 17:01:21 2025 GMT','subject':'/CN=chnode1','pkey_algo':'rsaEncryption'}
```


## sleep

導入バージョン: v1.1

クエリの実行を、指定した秒数だけ一時停止します。
この関数は主にテストやデバッグの目的で使用されます。

`sleep()` 関数は、クエリのパフォーマンスやシステムの応答性に悪影響を与える可能性があるため、一般的には本番環境での使用は推奨されません。
ただし、次のようなシナリオでは有用な場合があります。

1. **テスト**: ClickHouse のテストやベンチマークを行う際、遅延をシミュレートしたり、一時停止を挿入して、特定の条件下でシステムがどのように動作するかを観察したい場合があります。
2. **デバッグ**: 特定時点でのシステムの状態やクエリ実行状況を確認する必要がある場合、`sleep()` を使用して一時停止を挿入し、その間に関連情報を確認または収集できます。
3. **シミュレーション**: ネットワーク遅延や外部システム依存など、現実のシナリオで発生する遅延や一時停止をシミュレートしたいケースがあります。

:::warning
`sleep()` 関数は、ClickHouse システム全体のパフォーマンスや応答性に影響を与える可能性があるため、必要な場合に限り慎重に使用することが重要です。
:::

セキュリティ上の理由から、この関数はデフォルトのユーザープロファイル（`allow_sleep` が有効になっているもの）でのみ実行できます。

**構文**

```sql
sleep(秒)
```

**引数**

* `seconds` — クエリの実行を一時停止する秒数。最大 3 秒まで指定できます。小数秒を指定する場合は浮動小数点値を使用します。[`const UInt*`](/sql-reference/data-types/int-uint) または [`const Float*`](/sql-reference/data-types/float)

**戻り値**

`0` を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
-- このクエリは完了前に2秒間一時停止します。
-- この間、結果は返されず、クエリがハングまたは応答していないように見えます。
SELECT sleep(2);
```

```response title=Response
┌─sleep(2)─┐
│        0 │
└──────────┘
1 row in set. Elapsed: 2.012 sec.
```


## sleepEachRow

導入バージョン：v1.1

結果セット内の各行について、指定した秒数だけクエリの実行を一時停止します。

`sleepEachRow()` 関数は主にテストおよびデバッグ目的で使用され、[`sleep()`](#sleep) 関数と同様の役割を持ちます。
各行の処理に遅延や一時停止を挿入してシミュレートでき、次のようなシナリオで有用です。

1. **テスト**: 特定の条件下での ClickHouse のパフォーマンスをテストまたはベンチマークする際に、`sleepEachRow()` を使用して、処理される各行ごとに遅延や一時停止をシミュレートできます。
2. **デバッグ**: 処理される各行について、システムの状態やクエリの実行状況を確認する必要がある場合に、`sleepEachRow()` を使用して一時停止を挿入し、その間に関連情報を検査または収集できます。
3. **シミュレーション**: 外部システムとの連携やネットワーク遅延など、各行の処理ごとに遅延や一時停止が発生する実運用に近いシナリオを再現したい場合に使用できます。

:::warning
`sleep()` 関数と同様に、`sleepEachRow()` は ClickHouse システム全体のパフォーマンスおよび応答性に大きな影響を与える可能性があるため、特に大きな結果セットを扱う場合には、必要な場合にのみ慎重に使用することが重要です。
:::

**構文**

```sql
sleepEachRow(秒)
```

**引数**

* `seconds` — 結果セット内の各行ごとに、クエリ実行を一時停止する秒数（最大 3 秒まで）。浮動小数点数を使用して秒未満の値も指定できます。[`const UInt*`](/sql-reference/data-types/int-uint) または [`const Float*`](/sql-reference/data-types/float)

**戻り値**

各行に対して `0` を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
-- 出力は遅延され、各行の間に0.5秒の間隔が設けられます。
SELECT number, sleepEachRow(0.5) FROM system.numbers LIMIT 5;
```

```response title=Response
┌─number─┬─sleepEachRow(0.5)─┐
│      0 │                 0 │
│      1 │                 0 │
│      2 │                 0 │
│      3 │                 0 │
│      4 │                 0 │
└────────┴───────────────────┘
```


## structureToCapnProtoSchema

導入バージョン: v

ClickHouse テーブルの構造を CapnProto 形式のスキーマに変換する関数。

**構文**

```sql
```

**引数**

* なし。

**戻り値**

**使用例**

**random**

```sql title=Query
SELECT structureToCapnProtoSchema('s String, x UInt32', 'MessageName') format TSVRaw
```

```response title=Response
struct MessageName
{
    s @0 : Data;
    x @1 : UInt32;
}
```


## structureToProtobufSchema

導入バージョン: v23.8

ClickHouse のテーブル構造を Protobuf 形式のスキーマに変換します。

この関数は、ClickHouse のテーブル構造定義を受け取り、それを Protocol Buffers (Protobuf)
の proto3 構文によるスキーマ定義に変換します。これは、データ交換のために ClickHouse
のテーブル構造と一致する Protobuf スキーマを生成する際に有用です。

**構文**

```sql
structureToProtobufSchema(structure, message_name)
```

**引数**

* `structure` — ClickHouse テーブルの構造定義を表す文字列（例: &#39;column1 Type1, column2 Type2&#39;）。[`String`](/sql-reference/data-types/string)
* `message_name` — 生成されるスキーマで使用する Protobuf メッセージ型の名前。[`String`](/sql-reference/data-types/string)

**戻り値**

入力された ClickHouse の構造定義に対応する、proto3 構文の Protobuf スキーマ定義を返します。[`String`](/sql-reference/data-types/string)

**例**

**ClickHouse 構造を Protobuf スキーマに変換する**

```sql title=Query
SELECT structureToProtobufSchema('s String, x UInt32', 'MessageName') FORMAT TSVRaw;
```

```response title=Response
syntax = "proto3";

message MessageName
{
    bytes s = 1;
    uint32 x = 2;
}
```


## tcpPort

導入バージョン: v20.12

サーバーが待ち受けている [ネイティブインターフェイス](../../interfaces/tcp.md) の TCP ポート番号を返します。
分散テーブルのコンテキストで実行した場合、この関数は各シャードに対応する値を持つ通常の列を生成します。
それ以外の場合は定数値を返します。

**構文**

```sql
tcpPort()
```

**引数**

* なし。

**戻り値**

TCP ポート番号（[`UInt16`](/sql-reference/data-types/int-uint)）を返します。

**例**

**使用例**

```sql title=Query
SELECT tcpPort()
```

```response title=Response
┌─tcpPort()─┐
│      9000 │
└───────────┘
```


## throwIf

導入されたバージョン: v1.1

引数 x が true の場合に例外をスローします。
`error_code` 引数を使用するには、設定パラメータ `allow_custom_error_code_in_throw` を有効にする必要があります。

**構文**

```sql
throwIf(x[, message[, error_code]])
```

**引数**

* `x` — チェックする条件。[`Any`](/sql-reference/data-types)
* `message` — 省略可。カスタムエラーメッセージ。[`const String`](/sql-reference/data-types/string)
* `error_code` — 省略可。カスタムエラーコード。[`const Int8/16/32`](/sql-reference/data-types/int-uint)

**返り値**

条件が偽の場合は `0` を返し、条件が真の場合は例外をスローします。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT throwIf(number = 3, 'Too many') FROM numbers(10);
```

```response title=Response
↙ Progress: 0.00 rows, 0.00 B (0.00 rows/s., 0.00 B/s.) サーバーから例外を受信しました (version 19.14.1):
Code: 395. DB::Exception: Received from localhost:9000. DB::Exception: Too many.
```


## toColumnTypeName

導入: v1.1

指定された値のデータ型の内部名を返します。
関数 [`toTypeName`](#toTypeName) と異なり、返されるデータ型には `Const` や `LowCardinality` のような内部的なラッパー列が含まれる場合があります。

**構文**

```sql
toColumnTypeName(value)
```

**引数**

* `value` — 内部データ型を取得する対象の値。[`Any`](/sql-reference/data-types)

**戻り値**

値を表現するために使用される内部データ型を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT toColumnTypeName(CAST('2025-01-01 01:02:03' AS DateTime));
```

```response title=Response
┌─toColumnTypeName(CAST('2025-01-01 01:02:03', 'DateTime'))─┐
│ Const(UInt32)                                             │
└───────────────────────────────────────────────────────────┘
```


## toTypeName

導入バージョン: v1.1

渡された引数の型名を返します。
`NULL` が渡された場合、この関数は型 `Nullable(Nothing)` を返します。これは ClickHouse の内部の `NULL` 表現に対応します。

**構文**

```sql
toTypeName(x)
```

**引数**

* `x` — 任意の型の値。[`Any`](/sql-reference/data-types)

**戻り値**

入力値のデータ型名を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT toTypeName(123)
```

```response title=Response
┌─toTypeName(123)─┐
│ UInt8           │
└─────────────────┘
```


## transactionID

導入バージョン: v22.6

<ExperimentalBadge />

<CloudNotSupportedBadge />

トランザクションの ID を返します。

:::note
この関数は実験的な機能セットの一部です。
[設定ファイル](/operations/configuration-files) に次の設定を追加して、実験的なトランザクション機能を有効にします。

```xml
<clickhouse>
    <allow_experimental_transactions>1</allow_experimental_transactions>
</clickhouse>
```

詳細については、[Transactional (ACID) support](/guides/developer/transactional#transactions-commit-and-rollback) ページを参照してください。
:::

**構文**

```sql
transactionID()
```

**引数**

* なし。

**返り値**

`start_csn`、`local_tid`、`host_id` から成るタプルを返します。

* `start_csn`: グローバルな連番で、このトランザクションの開始時点で観測された最新のコミットタイムスタンプ。
* `local_tid`: 特定の `start_csn` の下で、このホストが開始した各トランザクションごとに一意となるローカルな連番。
* `host_id`: このトランザクションを開始したホストの UUID。
  [`Tuple(UInt64, UInt64, UUID)`](/sql-reference/data-types/tuple)

**例**

**使用例**

```sql title=Query
BEGIN TRANSACTION;
SELECT transactionID();
ROLLBACK;
```

```response title=Response
┌─transactionID()────────────────────────────────┐
│ (32,34,'0ee8b069-f2bb-4748-9eae-069c85b5252b') │
└────────────────────────────────────────────────┘
```


## transactionLatestSnapshot

導入バージョン: v22.6

<ExperimentalBadge />

<CloudNotSupportedBadge />

読み取り可能な [transaction](/guides/developer/transactional#transactions-commit-and-rollback) の最新のスナップショット（コミットシーケンス番号）を返します。

:::note
この関数は実験的な機能セットの一部です。トランザクションの実験的サポート機能を有効にするには、次の設定を構成に追加してください。

```xml
<clickhouse>
    <allow_experimental_transactions>1</allow_experimental_transactions>
</clickhouse>
```

詳細については、[Transactional (ACID) support](/guides/developer/transactional#transactions-commit-and-rollback)ページを参照してください。
:::

**構文**

```sql
transactionLatestSnapshot()
```

**引数**

* なし。

**戻り値**

トランザクションの最新スナップショット（CSN）を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
BEGIN TRANSACTION;
SELECT transactionLatestSnapshot();
ROLLBACK;
```

```response title=Response
┌─transactionLatestSnapshot()─┐
│                          32 │
└─────────────────────────────┘
```


## transactionOldestSnapshot

導入バージョン: v22.6

<ExperimentalBadge />

<CloudNotSupportedBadge />

実行中のいずれかの[トランザクション](/guides/developer/transactional#transactions-commit-and-rollback)から可視な、最も古いスナップショット（コミットシーケンス番号, Commit Sequence Number）を返します。

:::note
この関数は実験的機能セットの一部です。実験的なトランザクションサポートを有効にするには、次の設定を設定に追加してください。

```xml
<clickhouse>
    <allow_experimental_transactions>1</allow_experimental_transactions>
</clickhouse>
```

詳細については、[トランザクション（ACID）サポート](/guides/developer/transactional#transactions-commit-and-rollback)のページを参照してください。
:::

**構文**

```sql
transactionOldestSnapshot()
```

**引数**

* なし

**戻り値**

トランザクションの最も古いスナップショット（CSN）を返します。型は [`UInt64`](/sql-reference/data-types/int-uint) です。

**例**

**使用例**

```sql title=Query
BEGIN TRANSACTION;
SELECT transactionOldestSnapshot();
ROLLBACK;
```

```response title=Response
┌─transactionOldestSnapshot()─┐
│                          32 │
└─────────────────────────────┘
```


## transform

導入バージョン: v1.1

明示的に定義された、ある要素から別の要素へのマッピングに従って値を変換します。

この関数には 2 つのバリエーションがあります:

* `transform(x, array_from, array_to, default)` - マッピング用配列を用いて `x` を変換し、一致しない要素にはデフォルト値を使用します
* `transform(x, array_from, array_to)` - 同じ変換を行いますが、一致が見つからない場合は元の `x` を返します

この関数は `array_from` 内で `x` を検索し、同じインデックス位置の `array_to` の要素を返します。
`array_from` 内で `x` が見つからない場合は、`default` 値（4 パラメータ版）または元の `x`（3 パラメータ版）を返します。
`array_from` に複数の一致する要素が存在する場合は、最初に一致した要素に対応する要素を返します。

要件:

* `array_from` と `array_to` は同じ要素数でなければなりません
* 4 パラメータ版: `transform(T, Array(T), Array(U), U) -> U` であり、`T` と `U` は互換性のある異なる型でもかまいません
* 3 パラメータ版: `transform(T, Array(T), Array(T)) -> T` であり、すべての型が同一でなければなりません

**構文**

```sql
transform(x, array_from, array_to[, default])
```

**引数**

* `x` — 変換する値。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Decimal`](/sql-reference/data-types/decimal) または [`Float*`](/sql-reference/data-types/float) または [`String`](/sql-reference/data-types/string) または [`Date`](/sql-reference/data-types/date) または [`DateTime`](/sql-reference/data-types/datetime)
* `array_from` — 一致する値を検索するための定数配列。[`Array((U)Int*)`](/sql-reference/data-types/array) または [`Array(Decimal)`](/sql-reference/data-types/array) または [`Array(Float*)`](/sql-reference/data-types/array) または [`Array(String)`](/sql-reference/data-types/array) または [`Array(Date)`](/sql-reference/data-types/array) または [`Array(DateTime)`](/sql-reference/data-types/array)
* `array_to` — `array_from` 内の一致に対応して返す値の定数配列。[`Array((U)Int*)`](/sql-reference/data-types/array) または [`Array(Decimal)`](/sql-reference/data-types/array) または [`Array(Float*)`](/sql-reference/data-types/array) または [`Array(String)`](/sql-reference/data-types/array) または [`Array(Date)`](/sql-reference/data-types/array) または [`Array(DateTime)`](/sql-reference/data-types/array)
* `default` — 省略可能。`x` が `array_from` に見つからない場合に返す値。省略された場合は、変更されていない `x` を返す。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Decimal`](/sql-reference/data-types/decimal) または [`Float*`](/sql-reference/data-types/float) または [`String`](/sql-reference/data-types/string) または [`Date`](/sql-reference/data-types/date) または [`DateTime`](/sql-reference/data-types/datetime)

**返される値**

`x` が `array_from` の要素と一致する場合は `array_to` から対応する値を返し、それ以外の場合は `default` が指定されていれば `default` を、指定されていなければ `x` を返す。[`Any`](/sql-reference/data-types)

**例**

**transform(T, Array(T), Array(U), U) -&gt; U**

```sql title=Query
SELECT
transform(SearchEngineID, [2, 3], ['Yandex', 'Google'], 'その他') AS title,
count() AS c
FROM test.hits
WHERE SearchEngineID != 0
GROUP BY title
ORDER BY c DESC
```

```response title=Response
┌─title─────┬──────c─┐
│ Yandex    │ 498635 │
│ Google    │ 229872 │
│ Other     │ 104472 │
└───────────┴────────┘
```

**transform(T, Array(T), Array(T)) -&gt; T**

```sql title=Query
SELECT
transform(domain(Referer), ['yandex.ru', 'google.ru', 'vkontakte.ru'], ['www.yandex', 'example.com', 'vk.com']) AS s, count() AS c
FROM test.hits
GROUP BY domain(Referer)
ORDER BY count() DESC
LIMIT 10
```


```response title=Response
┌─s──────────────┬───────c─┐
│                │ 2906259 │
│ www.yandex     │  867767 │
│ ███████.ru     │  313599 │
│ mail.yandex.ru │  107147 │
│ ██████.ru      │  100355 │
│ █████████.ru   │   65040 │
│ news.yandex.ru │   64515 │
│ ██████.net     │   59141 │
│ example.com    │   57316 │
└────────────────┴─────────┘
```


## uniqThetaIntersect

導入バージョン: v22.9

2つの uniqThetaSketch オブジェクトに対して共通部分（集合演算 ∩）の計算を行い、その結果として新しい uniqThetaSketch を返します。

**構文**

```sql
uniqThetaIntersect(uniqThetaSketch,uniqThetaSketch)
```

**引数**

* `uniqThetaSketch` — uniqThetaSketch オブジェクト。[`Tuple`](/sql-reference/data-types/tuple) または [`Array`](/sql-reference/data-types/array) または [`Date`](/sql-reference/data-types/date) または [`DateTime`](/sql-reference/data-types/datetime) または [`String`](/sql-reference/data-types/string) または [`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float) または [`Decimal`](/sql-reference/data-types/decimal)

**戻り値**

積集合の結果を含む新しい uniqThetaSketch オブジェクト。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT finalizeAggregation(uniqThetaIntersect(a, b)) AS a_intersect_b, finalizeAggregation(a) AS a_cardinality, finalizeAggregation(b) AS b_cardinality
FROM
(SELECT arrayReduce('uniqThetaState', [1, 2]) AS a, arrayReduce('uniqThetaState', [2, 3, 4]) AS b);
```

```response title=Response
┌─a_intersect_b─┬─a_cardinality─┬─b_cardinality─┐
│             1 │             2 │             3 │
└───────────────┴───────────────┴───────────────┘
```


## uniqThetaNot

導入バージョン: v22.9

2 つの uniqThetaSketch オブジェクトに対して a&#95;not&#95;b 計算（集合演算 ×）を行い、その結果として新しい uniqThetaSketch を生成します。

**構文**

```sql
uniqThetaNot(uniqThetaSketch,uniqThetaSketch)
```

**引数**

* `uniqThetaSketch` — uniqThetaSketch オブジェクト。[`Tuple`](/sql-reference/data-types/tuple) または [`Array`](/sql-reference/data-types/array) または [`Date`](/sql-reference/data-types/date) または [`DateTime`](/sql-reference/data-types/datetime) または [`String`](/sql-reference/data-types/string) または [`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float) または [`Decimal`](/sql-reference/data-types/decimal)

**戻り値**

a&#95;not&#95;b の結果を含む新しい uniqThetaSketch オブジェクトを返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT finalizeAggregation(uniqThetaNot(a, b)) AS a_not_b, finalizeAggregation(a) AS a_cardinality, finalizeAggregation(b) AS b_cardinality
FROM
(SELECT arrayReduce('uniqThetaState', [2, 3, 4]) AS a, arrayReduce('uniqThetaState', [1, 2]) AS b);
```

```response title=Response
┌─a_not_b─┬─a_cardinality─┬─b_cardinality─┐
│       2 │             3 │             2 │
└─────────┴───────────────┴───────────────┘
```


## uniqThetaUnion

導入バージョン: v22.9

2 つの uniqThetaSketch オブジェクトの和集合（集合演算 ∪）を計算し、その結果として新しい uniqThetaSketch を返します。

**構文**

```sql
uniqThetaUnion(uniqThetaSketch,uniqThetaSketch)
```

**引数**

* `uniqThetaSketch` — uniqThetaSketch オブジェクト。[`Tuple`](/sql-reference/data-types/tuple) または [`Array`](/sql-reference/data-types/array) または [`Date`](/sql-reference/data-types/date) または [`DateTime`](/sql-reference/data-types/datetime) または [`String`](/sql-reference/data-types/string) または [`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float) または [`Decimal`](/sql-reference/data-types/decimal)

**戻り値**

和集合の結果を含む新しい uniqThetaSketch を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT finalizeAggregation(uniqThetaUnion(a, b)) AS a_union_b, finalizeAggregation(a) AS a_cardinality, finalizeAggregation(b) AS b_cardinality
FROM
(SELECT arrayReduce('uniqThetaState', [1, 2]) AS a, arrayReduce('uniqThetaState', [2, 3, 4]) AS b);
```

```response title=Response
┌─a_union_b─┬─a_cardinality─┬─b_cardinality─┐
│         4 │             2 │             3 │
└───────────┴───────────────┴───────────────┘
```


## uptime

導入バージョン: v1.1

サーバーの稼働時間（アップタイム）を秒単位で返します。
分散テーブルのコンテキストで実行された場合、この関数は各シャードに応じた値を持つ通常の列を生成します。
それ以外の場合は、定数値を返します。

**構文**

```sql
uptime()
```

**引数**

* なし。

**返り値**

サーバーの稼働時間を秒単位の [`UInt32`](/sql-reference/data-types/int-uint) で返します。

**例**

**使用例**

```sql title=Query
SELECT uptime() AS Uptime
```

```response title=Response
┌─稼働時間─┐
│  55867 │
└────────┘
```


## variantElement

導入バージョン: v25.2

`Variant` 列から、指定した型のカラムを抽出します。

**構文**

```sql
variantElement(variant, type_name[, default_value])
```

**引数**

* `variant` — Variant 列。[`Variant`](/sql-reference/data-types/variant)
* `type_name` — 抽出する Variant 型の名前。[`String`](/sql-reference/data-types/string)
* `default_value` — `variant` に指定された型の Variant 値が存在しない場合に使用されるデフォルト値。任意の型を指定可能。省略可。[`Any`](/sql-reference/data-types)

**戻り値**

Variant 列から指定された Variant 型の値を抽出した列を返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=Query
CREATE TABLE test (v Variant(UInt64, String, Array(UInt64))) ENGINE = Memory;
INSERT INTO test VALUES (NULL), (42), ('Hello, World!'), ([1, 2, 3]);
SELECT v, variantElement(v, 'String'), variantElement(v, 'UInt64'), variantElement(v, 'Array(UInt64)') FROM test;
```

```response title=Response
┌─v─────────────┬─variantElement(v, 'String')─┬─variantElement(v, 'UInt64')─┬─variantElement(v, 'Array(UInt64)')─┐
│ ᴺᵁᴸᴸ          │ ᴺᵁᴸᴸ                        │                        ᴺᵁᴸᴸ │ []                                 │
│ 42            │ ᴺᵁᴸᴸ                        │                          42 │ []                                 │
│ Hello, World! │ Hello, World!               │                        ᴺᵁᴸᴸ │ []                                 │
│ [1,2,3]       │ ᴺᵁᴸᴸ                        │                        ᴺᵁᴸᴸ │ [1,2,3]                            │
└───────────────┴─────────────────────────────┴─────────────────────────────┴────────────────────────────────────┘
```


## variantType

導入バージョン: v24.2

`Variant` 列の各行に対して、そのバリアント型の名前を返します。行に NULL が含まれている場合、その行については &#39;None&#39; を返します。

**構文**

```sql
variantType(variant)
```

**引数**

* `variant` — Variant 列。[`Variant`](/sql-reference/data-types/variant)

**戻り値**

各行の Variant 型名を含む Enum 列を返します。[`Enum`](/sql-reference/data-types/enum)

**例**

**使用例**

```sql title=Query
CREATE TABLE test (v Variant(UInt64, String, Array(UInt64))) ENGINE = Memory;
INSERT INTO test VALUES (NULL), (42), ('Hello, World!'), ([1, 2, 3]);
SELECT variantType(v) FROM test;
```

```response title=Response
┌─variantType(v)─┐
│ None           │
│ UInt64         │
│ String         │
│ Array(UInt64)  │
└────────────────┘
```


## version

導入バージョン: v1.1

ClickHouse の現在のバージョンを、`major_version.minor_version.patch_version.number_of_commits_since_the_previous_stable_release` という形式の文字列として返します。
分散テーブルのコンテキストで実行された場合、この関数は各シャードに対応する値を持つ通常のカラムを生成します。
それ以外の場合は、定数値を返します。

**構文**

```sql
version()
```

**引数**

* なし。

**戻り値**

ClickHouse の現在のバージョンを返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT version()
```

```response title=Response
┌─version()─┐
│ 24.2.1.1  │
└───────────┘
```


## visibleWidth

導入: v1.1

値をテキスト形式（タブ区切り）でコンソールに出力する際のおおよその表示幅を計算します。
この関数は、システム内部で Pretty フォーマットを実装するために使用されます。
Pretty フォーマットでは、`NULL` は `NULL` に対応する文字列として表現されます。

**構文**

```sql
visibleWidth(x)
```

**引数**

* `x` — 任意のデータ型の値。[`Any`](/sql-reference/data-types)

**戻り値**

値をテキスト形式で表示したときのおおよその表示幅を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**NULL の表示幅を計算する**

```sql title=Query
SELECT visibleWidth(NULL)
```

```response title=Response
┌─visibleWidth(NULL)─┐
│                  4 │
└────────────────────┘
```


## zookeeperSessionUptime

導入: v21.11

現在の ZooKeeper セッションの稼働時間を秒単位で返します。

**構文**

```sql
zookeeperSessionUptime()
```

**引数**

* なし。

**戻り値**

現在の ZooKeeper セッションの稼働時間（秒）を返します。[`UInt32`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT zookeeperSessionUptime();
```

```response title=Response
┌─zookeeperSessionUptime()─┐
│                      286 │
└──────────────────────────┘
```

{/*AUTOGENERATED_END*/ }
