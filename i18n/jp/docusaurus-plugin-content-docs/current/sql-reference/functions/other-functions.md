---
description: '「その他」関数カテゴリのドキュメント'
sidebar_label: 'その他'
slug: /sql-reference/functions/other-functions
title: 'その他の関数'
doc_type: 'reference'
---

import ExperimentalBadge from '@theme/badges/ExperimentalBadge';
import CloudNotSupportedBadge from '@theme/badges/CloudNotSupportedBadge';
import DeprecatedBadge from '@theme/badges/DeprecatedBadge';


# その他の関数

:::note
以下の関数ドキュメントは `system.functions` システムテーブルから生成されています。
:::

<!--
以下のタグ内のコンテンツは、ドキュメントフレームワークのビルド時に
system.functions から生成されたドキュメントに置き換えられます。タグを変更または削除しないでください。
参照: https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
-->


<!--AUTOGENERATED_START-->

## FQDN {#FQDN}

導入バージョン: v20.1

ClickHouseサーバーの完全修飾ドメイン名(FQDN)を返します。

**構文**

```sql
fqdn()
```

**エイリアス**: `fullHostName`

**引数**

- なし

**戻り値**

ClickHouseサーバーの完全修飾ドメイン名を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT fqdn()
```

```response title=Response
┌─FQDN()──────────────────────────┐
│ clickhouse.us-east-2.internal │
└─────────────────────────────────┘
```


## MACNumToString {#MACNumToString}

導入バージョン: v1.1

[`UInt64`](/sql-reference/data-types/int-uint)数値をビッグエンディアン形式のMACアドレスとして解釈します。
対応するMACアドレスを`AA:BB:CC:DD:EE:FF`形式(コロン区切りの16進数)の文字列として返します。

**構文**

```sql
MACNumToString(num)
```

**引数**

- `num` — UInt64数値。[`UInt64`](/sql-reference/data-types/int-uint)

**戻り値**

AA:BB:CC:DD:EE:FF形式のMACアドレスを返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=クエリ
SELECT MACNumToString(149809441867716) AS mac_address;
```

```response title=レスポンス
┌─mac_address───────┐
│ 88:00:11:22:33:44 │
└───────────────────┘
```


## MACStringToNum {#MACStringToNum}

導入バージョン: v1.1

MACNumToStringの逆関数です。MACアドレスの形式が無効な場合は0を返します。

**構文**

```sql
MACStringToNum(s)
```

**引数**

- `s` — MACアドレス文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

UInt64型の数値を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT MACStringToNum('01:02:03:04:05:06') AS mac_numeric;
```

```response title=レスポンス
1108152157446
```


## MACStringToOUI {#MACStringToOUI}

導入バージョン: v1.1

AA:BB:CC:DD:EE:FF形式（コロンで区切られた16進数）のMACアドレスを受け取り、最初の3オクテットをUInt64数値として返します。MACアドレスの形式が無効な場合は0を返します。

**構文**

```sql
MACStringToOUI(s)
```

**引数**

- `s` — MACアドレス文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

最初の3オクテットのUInt64数値。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT MACStringToOUI('00:50:56:12:34:56') AS oui;
```

```response title=Response
20566
```


## **filterContains {#**filterContains}

導入バージョン: v25.10

JOIN実行時フィルタリング用の特殊関数。

**構文**

```sql
__filterContains(filter_name, key)
```

**引数**

- `filter_name` — 実行時フィルタの内部名。BuildRuntimeFilterStepによって構築されます。[`String`](/sql-reference/data-types/string)
- `key` — フィルタ内に存在するかチェックされる任意の型の値

**戻り値**

キーがフィルタ内で見つかった場合はTrue [`Bool`](/sql-reference/data-types/boolean)

**例**

**例**

```sql title=Query
この関数はユーザークエリでの使用を想定していません。最適化中にクエリプランに追加される場合があります。
```

```response title=Response

```


## **patchPartitionID {#**patchPartitionID}

導入バージョン: v25.5

内部関数です。パートの名前とパッチパートのカラム名のハッシュを受け取り、パッチパートのパーティション名を返します。引数は正しいパート名である必要があり、それ以外の場合の動作は未定義です。

**構文**

```sql

```

**引数**

- なし

**戻り値**

**例**


## authenticatedUser {#authenticatedUser}

導入バージョン: v25.11

EXECUTE ASコマンドを使用してセッションユーザーが切り替えられた場合、この関数は認証およびセッション作成に使用された元のユーザーの名前を返します。
エイリアス: authUser()

**構文**

```sql
authenticatedUser()
```

**エイリアス**: `authUser`

**引数**

- なし

**戻り値**

認証されたユーザーの名前。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=クエリ
EXECUTE as u1;
            SELECT currentUser(), authenticatedUser();
```

```response title=レスポンス
┌─currentUser()─┬─authenticatedUser()─┐
│ u1            │ default             │
└───────────────┴─────────────────────┘
```


## bar {#bar}

導入バージョン: v1.1

棒グラフを作成します。
x = max のとき、(x - min) に比例した幅で width 文字分のバーを描画します。
バーは記号の8分の1の精度で描画されます。

**構文**

```sql
bar(x, min, max[, width])
```

**引数**

- `x` — 表示するサイズ。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float) または [`Decimal`](/sql-reference/data-types/decimal)
- `min` — 最小値。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float) または [`Decimal`](/sql-reference/data-types/decimal)
- `max` — 最大値。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float) または [`Decimal`](/sql-reference/data-types/decimal)
- `width` — オプション。バーの幅を文字数で指定します。デフォルトは `80` です。[`const (U)Int*`](/sql-reference/data-types/int-uint) または [`const Float*`](/sql-reference/data-types/float) または [`const Decimal`](/sql-reference/data-types/decimal)

**戻り値**

Unicode アートのバー文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=クエリ
SELECT
toHour(EventTime) AS h,
count() AS c,
bar(c, 0, 600000, 20) AS bar
FROM test.hits
GROUP BY h
ORDER BY h ASC
```

```response title=レスポンス
┌──h─┬──────c─┬─bar────────────────┐
│  0 │ 292907 │ █████████▋         │
│  1 │ 180563 │ ██████             │
│  2 │ 114861 │ ███▋               │
│  3 │  85069 │ ██▋                │
│  4 │  68543 │ ██▎                │
│  5 │  78116 │ ██▌                │
│  6 │ 113474 │ ███▋               │
│  7 │ 170678 │ █████▋             │
│  8 │ 278380 │ █████████▎         │
│  9 │ 391053 │ █████████████      │
│ 10 │ 457681 │ ███████████████▎   │
│ 11 │ 493667 │ ████████████████▍  │
│ 12 │ 509641 │ ████████████████▊  │
│ 13 │ 522947 │ █████████████████▍ │
│ 14 │ 539954 │ █████████████████▊ │
│ 15 │ 528460 │ █████████████████▌ │
│ 16 │ 539201 │ █████████████████▊ │
│ 17 │ 523539 │ █████████████████▍ │
│ 18 │ 506467 │ ████████████████▊  │
│ 19 │ 520915 │ █████████████████▎ │
│ 20 │ 521665 │ █████████████████▍ │
│ 21 │ 542078 │ ██████████████████ │
│ 22 │ 493642 │ ████████████████▍  │
│ 23 │ 400397 │ █████████████▎     │
└────┴────────┴────────────────────┘
```


## blockNumber {#blockNumber}

導入バージョン: v1.1

行を含む[ブロック](../../development/architecture.md#block)の単調増加するシーケンス番号を返します。
返されるブロック番号はベストエフォートで更新されるため、完全に正確でない場合があります。

**構文**

```sql
blockNumber()
```

**引数**

- なし

**戻り値**

行が存在するデータブロックのシーケンス番号。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**基本的な使用方法**

```sql title=Query
SELECT blockNumber()
FROM
(
    SELECT *
    FROM system.numbers
    LIMIT 10
) SETTINGS max_block_size = 2
```

```response title=Response
┌─blockNumber()─┐
│             7 │
│             7 │
└───────────────┘
┌─blockNumber()─┐
│             8 │
│             8 │
└───────────────┘
┌─blockNumber()─┐
│             9 │
│             9 │
└───────────────┘
┌─blockNumber()─┐
│            10 │
│            10 │
└───────────────┘
┌─blockNumber()─┐
│            11 │
│            11 │
└───────────────┘
```


## blockSerializedSize {#blockSerializedSize}

導入バージョン: v20.3

ディスク上の値のブロックの非圧縮サイズをバイト単位で返します。

**構文**

```sql
blockSerializedSize(x1[, x2[, ...]])
```

**引数**

- `x1[, x2, ...]` — ブロックの非圧縮サイズを取得する任意の数の値。[`Any`](/sql-reference/data-types)

**戻り値**

圧縮なしで値のブロックに対してディスクに書き込まれるバイト数を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT blockSerializedSize(maxState(1)) AS x;
```

```response title=レスポンス
┌─x─┐
│ 2 │
└───┘
```


## blockSize {#blockSize}

導入バージョン: v1.1

ClickHouseでは、クエリは[ブロック](/development/architecture#block)（チャンク）単位で処理されます。
この関数は、関数が呼び出されたブロックのサイズ（行数）を返します。

**構文**

```sql
blockSize()
```

**引数**

- なし

**戻り値**

現在のブロック内の行数を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT blockSize()
FROM system.numbers LIMIT 5
```

```response title=レスポンス
┌─blockSize()─┐
│           5 │
│           5 │
│           5 │
│           5 │
│           5 │
└─────────────┘
```


## byteSize {#byteSize}

導入バージョン: v21.1

メモリ内の引数の非圧縮バイトサイズの推定値を返します。
`String`型の引数の場合、関数は文字列の長さ + 8（長さ情報分）を返します。
複数の引数がある場合、関数はそれらのバイトサイズを累積します。

**構文**

```sql
byteSize(arg1[, arg2, ...])
```

**引数**

- `arg1[, arg2, ...]` — 非圧縮バイトサイズを推定する任意のデータ型の値。[`Any`](/sql-reference/data-types)

**戻り値**

メモリ内の引数のバイトサイズの推定値を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT byteSize('string')
```

```response title=結果
┌─byteSize('string')─┐
│                 15 │
└────────────────────┘
```

**複数の引数**

```sql title=クエリ
SELECT byteSize(NULL, 1, 0.3, '')
```

```response title=結果
┌─byteSize(NULL, 1, 0.3, '')─┐
│                         19 │
└────────────────────────────┘
```


## catboostEvaluate {#catboostEvaluate}

導入バージョン: v22.9

外部のCatBoostモデルを評価します。[CatBoost](https://catboost.ai)は、Yandexが機械学習のために開発したオープンソースの勾配ブースティングライブラリです。
CatBoostモデルへのパスとモデル引数(特徴量)を受け取ります。

**前提条件**

1. CatBoost評価ライブラリのビルド

CatBoostモデルを評価する前に、`libcatboostmodel.<so|dylib>`ライブラリを利用可能にする必要があります。コンパイル方法については、[CatBoostドキュメント](https://catboost.ai/docs/concepts/c-plus-plus-api_dynamic-c-pluplus-wrapper.html)を参照してください。

次に、ClickHouse設定ファイルで`libcatboostmodel.<so|dylib>`へのパスを指定します:

```xml
<clickhouse>
...
    <catboost_lib_path>/path/to/libcatboostmodel.so</catboost_lib_path>
...
</clickhouse>
```

セキュリティと分離の理由から、モデル評価はサーバープロセスではなく、clickhouse-library-bridgeプロセスで実行されます。
`catboostEvaluate()`の初回実行時に、library bridgeプロセスがまだ実行されていない場合、サーバーはそれを起動します。両プロセスは
HTTPインターフェースを使用して通信します。デフォルトでは、ポート`9012`が使用されます。以下のように異なるポートを指定することもできます。これは、ポート
`9012`が既に別のサービスに割り当てられている場合に便利です。

```xml
<library_bridge>
    <port>9019</port>
</library_bridge>
```

2. libcatboostを使用したCatBoostモデルのトレーニング

トレーニングデータセットからCatBoostモデルをトレーニングする方法については、[モデルのトレーニングと適用](https://catboost.ai/docs/features/training.html#training)を参照してください。

**構文**

```sql
catboostEvaluate(path_to_model, feature_1[, feature_2, ..., feature_n])
```

**引数**

- `path_to_model` — CatBoostモデルへのパス。[`const String`](/sql-reference/data-types/string)
- `feature` — 1つ以上のモデル特徴量/引数。[`Float*`](/sql-reference/data-types/float)

**戻り値**

モデル評価結果を返します。[`Float64`](/sql-reference/data-types/float)

**例**

**catboostEvaluate**

```sql title=Query
SELECT catboostEvaluate('/root/occupy.bin', Temperature, Humidity, Light, CO2, HumidityRatio) AS prediction FROM occupancy LIMIT 1
```

```response title=Response
4.695691092573497
```


## colorOKLCHToSRGB {#colorOKLCHToSRGB}

導入バージョン: v25.7

**OKLCH**知覚色空間から一般的な**sRGB**色空間へ色を変換します。

`L`が範囲`[0...1]`外にある場合、`C`が負の値の場合、または`H`が範囲`[0...360]`外にある場合、結果は実装依存となります。

:::note
**OKLCH**はOKLab色空間の円筒座標版です。
3つの座標は`L`(範囲`[0...1]`の明度)、`C`(彩度`>= 0`)、`H`(色相、`[0...360]`の角度)\*\*です。
OKLab/OKLCHは、計算コストを抑えながら知覚的に均一になるよう設計されています。
:::

この変換は[`colorSRGBToOKLCH`](#colorSRGBToOKLCH)の逆変換です:

1. OKLCHからOKLabへ
2. OKLabから線形sRGBへ
3. 線形sRGBからsRGBへ

第2引数gammaは最終段階で使用されます。

OKLCH空間における色の参照、およびそれらがsRGB色にどのように対応するかについては、[https://oklch.com/](https://oklch.com/)を参照してください。

**構文**

```sql
colorOKLCHToSRGB(tuple [, gamma])
```

**引数**

- `tuple` — 3つの数値`L`、`C`、`H`のタプル。`L`は範囲`[0...1]`、`C >= 0`、`H`は範囲`[0...360]`です。[`Tuple(Float64, Float64, Float64)`](/sql-reference/data-types/tuple)
- `gamma` — オプション。各チャネル`x`に対して`(x ^ (1 / gamma)) * 255`を適用することで、線形sRGBをsRGBに変換するために使用される指数。デフォルトは`2.2`です。[`Float64`](/sql-reference/data-types/float)

**返り値**

sRGB色値を表すタプル(R, G, B)を返します。[`Tuple(Float64, Float64, Float64)`](/sql-reference/data-types/tuple)

**例**

**OKLCHをsRGBに変換**

```sql title=Query
SELECT colorOKLCHToSRGB((0.4466, 0.0991, 45.44), 2.2) AS rgb
WITH colorOKLCHToSRGB((0.7, 0.1, 54)) as t SELECT tuple(toUInt8(t.1), toUInt8(t.2), toUInt8(t.3)) AS RGB
```

```response title=Response
┌─rgb──────────────────────────────────────────────────────┐
│ (127.03349738778945,66.06672044472008,37.11802592155851) │
└──────────────────────────────────────────────────────────┘
┌─RGB──────────┐
│ (205,139,97) │
└──────────────┘
```


## colorSRGBToOKLCH {#colorSRGBToOKLCH}

導入バージョン: v25.7

**sRGB**色空間でエンコードされた色を、知覚的に均一な**OKLCH**色空間に変換します。

入力チャネルが`[0...255]`の範囲外である場合、またはガンマ値が非正の場合、動作は実装依存となります。

:::note
**OKLCH**はOKLab色空間の円筒座標版です。
3つの座標は、`L`（明度、範囲`[0...1]`）、`C`（彩度`>= 0`）、`H`（色相、`[0...360]`度）です。
OKLab/OKLCHは、計算コストを抑えながら知覚的に均一になるように設計されています。
:::

変換は3つの段階で構成されます：

1. sRGBから線形sRGBへ
2. 線形sRGBからOKLabへ
3. OKLabからOKLCHへ

OKLCH空間における色の参照、およびsRGB色との対応については、[https://OKLCH.com/](https://OKLCH.com/)を参照してください。

**構文**

```sql
colorSRGBToOKLCH(tuple[, gamma])
```

**引数**

- `tuple` — 範囲`[0...255]`のR、G、Bの3つの値のタプル。[`Tuple(UInt8, UInt8, UInt8)`](/sql-reference/data-types/tuple)
- `gamma` — オプション。各チャネル`x`に`(x / 255)^gamma`を適用してsRGBを線形化するために使用される指数。デフォルトは`2.2`。[`Float64`](/sql-reference/data-types/float)

**返り値**

OKLCH色空間の値を表すタプル(L, C, H)を返します。[`Tuple(Float64, Float64, Float64)`](/sql-reference/data-types/tuple)

**例**

**sRGBをOKLCHに変換**

```sql title=Query
SELECT colorSRGBToOKLCH((128, 64, 32), 2.2) AS lch
```

```response title=Response
┌─lch─────────────────────────────────────────────────────────┐
│ (0.4436238384931984,0.10442699545678624,45.907345481930236) │
└─────────────────────────────────────────────────────────────┘
```


## connectionId {#connectionId}

導入バージョン: v21.3

現在のクエリを送信したクライアントの接続IDを返します。
この関数はデバッグシナリオで最も有用です。
MySQLの`CONNECTION_ID`関数との互換性のために作成されました。
本番環境のクエリでは通常使用されません。

**構文**

```sql
connectionId()
```

**引数**

- なし

**戻り値**

現在のクライアントの接続IDを返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT connectionId();
```

```response title=レスポンス
┌─connectionId()─┐
│              0 │
└────────────────┘
```


## countDigits {#countDigits}

導入バージョン: v20.8

値を表現するために必要な10進数の桁数を返します。

:::note
この関数は10進数値のスケールを考慮します。つまり、基礎となる整数型 `(value * scale)` に対して結果を計算します。

例:

- `countDigits(42) = 2`
- `countDigits(42.000) = 5`
- `countDigits(0.04200) = 4`
  :::

:::tip
`countDigits(x) > 18` を使用して `Decimal64` の10進数オーバーフローをチェックできますが、[`isDecimalOverflow`](#isDecimalOverflow) よりも低速です。
:::

**構文**

```sql
countDigits(x)
```

**引数**

- `x` — 整数または10進数値。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Decimal`](/sql-reference/data-types/decimal)

**戻り値**

`x` を表現するために必要な桁数を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT countDigits(toDecimal32(1, 9)), countDigits(toDecimal32(-1, 9)),
       countDigits(toDecimal64(1, 18)), countDigits(toDecimal64(-1, 18)),
       countDigits(toDecimal128(1, 38)), countDigits(toDecimal128(-1, 38));
```

```response title=レスポンス
┌─countDigits(toDecimal32(1, 9))─┬─countDigits(toDecimal32(-1, 9))─┬─countDigits(toDecimal64(1, 18))─┬─countDigits(toDecimal64(-1, 18))─┬─countDigits(toDecimal128(1, 38))─┬─countDigits(toDecimal128(-1, 38))─┐
│                             10 │                              10 │                              19 │                               19 │                               39 │                                39 │
└────────────────────────────────┴─────────────────────────────────┴─────────────────────────────────┴──────────────────────────────────┴──────────────────────────────────┴───────────────────────────────────┘
```


## currentDatabase {#currentDatabase}

Introduced in: v1.1

現在のデータベース名を返します。
データベースを指定する必要がある`CREATE TABLE`クエリのテーブルエンジンパラメータで役立ちます。

[`SET`ステートメント](/sql-reference/statements/use)も参照してください。

**構文**

```sql
currentDatabase()
```

**エイリアス**: `current_database`、`SCHEMA`、`DATABASE`

**引数**

- なし。

**戻り値**

現在のデータベース名を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=クエリ
SELECT currentDatabase()
```

```response title=レスポンス
┌─currentDatabase()─┐
│ default           │
└───────────────────┘
```


## currentProfiles {#currentProfiles}

導入バージョン: v21.9

現在のユーザーに適用されている設定プロファイルの配列を返します。

**構文**

```sql
currentProfiles()
```

**引数**

- なし

**戻り値**

現在のユーザーに適用されている設定プロファイルの配列を返します。 [`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=クエリ
SELECT currentProfiles();
```

```response title=レスポンス
┌─currentProfiles()─────────────────────────────┐
│ ['default', 'readonly_user', 'web_analytics'] │
└───────────────────────────────────────────────┘
```


## currentQueryID {#currentQueryID}

導入バージョン: v

現在のクエリIDを返します。

**構文**

```sql
currentQueryID()
```

**エイリアス**: `current_query_id`

**引数**

- なし

**戻り値**

**例**

**例**

```sql title=クエリ
SELECT currentQueryID();
```

```response title=レスポンス
┌─currentQueryID()─────────────────────┐
│ 1280d0e8-1a08-4524-be6e-77975bb68e7d │
└──────────────────────────────────────┘
```


## currentRoles {#currentRoles}

導入バージョン: v21.9

現在のユーザーに割り当てられているロールの配列を返します。

**構文**

```sql
currentRoles()
```

**引数**

- なし

**戻り値**

現在のユーザーに割り当てられているロールの配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=クエリ
SELECT currentRoles();
```

```response title=レスポンス
┌─currentRoles()─────────────────────────────────┐
│ ['sql-console-role:jane.smith@clickhouse.com'] │
└────────────────────────────────────────────────┘
```


## currentSchemas {#currentSchemas}

導入バージョン: v23.7

関数 [`currentDatabase`](#currentDatabase) と同様ですが、以下の点が異なります。

- 無視されるブール値引数を受け取ります
- データベース名を単一の値を持つ配列として返します

関数 `currentSchemas` は PostgreSQL との互換性のためにのみ存在します。
代わりに `currentDatabase` を使用してください。

[`SET` ステートメント](/sql-reference/statements/use) も参照してください。

**構文**

```sql
currentSchemas(bool)
```

**エイリアス**: `current_schemas`

**引数**

- `bool` — 無視されるブール値。[`Bool`](/sql-reference/data-types/boolean)

**戻り値**

現在のデータベース名を含む単一要素の配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=クエリ
SELECT currentSchemas(true)
```

```response title=レスポンス
┌─currentSchemas(true)─┐
│ ['default']          │
└──────────────────────┘
```


## currentUser {#currentUser}

導入バージョン: v20.1

現在のユーザーの名前を返します。
分散クエリの場合、クエリを開始したユーザーの名前が返されます。

**構文**

```sql
currentUser()
```

**エイリアス**: `current_user`, `user`

**引数**

- なし

**戻り値**

現在のユーザーの名前を返します。分散クエリの場合は、クエリを開始したユーザーのログイン名を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT currentUser()
```

```response title=Response
┌─currentUser()─┐
│ default       │
└───────────────┘
```


## defaultProfiles {#defaultProfiles}

導入バージョン: v21.9

現在のユーザーのデフォルト設定プロファイル名の配列を返します。

**構文**

```sql
defaultProfiles()
```

**引数**

- なし

**戻り値**

現在のユーザーのデフォルト設定プロファイル名の配列を返します。 [`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=クエリ
SELECT defaultProfiles();
```

```response title=レスポンス
┌─defaultProfiles()─┐
│ ['default']       │
└───────────────────┘
```


## defaultRoles {#defaultRoles}

導入バージョン: v21.9

現在のユーザーのデフォルトロールの配列を返します。

**構文**

```sql
defaultRoles()
```

**引数**

- なし

**戻り値**

現在のユーザーのデフォルトロールの配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
SELECT defaultRoles();
```

```response title=Response
┌─defaultRoles()─────────────────────────────────┐
│ ['sql-console-role:jane.smith@clickhouse.com'] │
└────────────────────────────────────────────────┘
```


## defaultValueOfArgumentType {#defaultValueOfArgumentType}

導入バージョン: v1.1

指定されたデータ型のデフォルト値を返します。
ユーザーが設定したカスタムカラムのデフォルト値は含まれません。

**構文**

```sql
defaultValueOfArgumentType(expression)
```

**引数**

- `expression` — 任意の型の値、または任意の型の値を返す式。[`Any`](/sql-reference/data-types)

**戻り値**

数値の場合は `0`、文字列の場合は空文字列、Nullable型の場合は `NULL` を返します。[`UInt8`](/sql-reference/data-types/int-uint) または [`String`](/sql-reference/data-types/string) または [`NULL`](/sql-reference/syntax#null)

**例**

**使用例**

```sql title=クエリ
SELECT defaultValueOfArgumentType(CAST(1 AS Int8));
```

```response title=レスポンス
┌─defaultValueOfArgumentType(CAST(1, 'Int8'))─┐
│                                           0 │
└─────────────────────────────────────────────┘
```

**Nullableの例**

```sql title=クエリ
SELECT defaultValueOfArgumentType(CAST(1 AS Nullable(Int8)));
```

```response title=レスポンス
┌─defaultValueOfArgumentType(CAST(1, 'Nullable(Int8)'))─┐
│                                                  ᴺᵁᴸᴸ │
└───────────────────────────────────────────────────────┘
```


## defaultValueOfTypeName {#defaultValueOfTypeName}

導入バージョン: v1.1

指定された型名のデフォルト値を返します。

**構文**

```sql
defaultValueOfTypeName(type)
```

**引数**

- `type` — 型名を表す文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

指定された型名のデフォルト値を返します。数値型の場合は `0`、文字列型の場合は空文字列、Nullable型の場合は `NULL` を返します。[`UInt8`](/sql-reference/data-types/int-uint)、[`String`](/sql-reference/data-types/string)、[`NULL`](/sql-reference/syntax#null)

**例**

**使用例**

```sql title=クエリ
SELECT defaultValueOfTypeName('Int8');
```

```response title=結果
┌─defaultValueOfTypeName('Int8')─┐
│                              0 │
└────────────────────────────────┘
```

**Nullable型の例**

```sql title=クエリ
SELECT defaultValueOfTypeName('Nullable(Int8)');
```

```response title=結果
┌─defaultValueOfTypeName('Nullable(Int8)')─┐
│                                     ᴺᵁᴸᴸ │
└──────────────────────────────────────────┘
```


## displayName {#displayName}

導入バージョン: v22.11

[config](/operations/configuration-files)から`display_name`の値を返します。設定されていない場合は、サーバーの完全修飾ドメイン名(FQDN)を返します。

**構文**

```sql
displayName()
```

**引数**

- なし

**戻り値**

configから`display_name`の値を返します。設定されていない場合はサーバーのFQDNを返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT displayName();
```

```response title=Response
┌─displayName()─┐
│ production    │
└───────────────┘
```


## dumpColumnStructure {#dumpColumnStructure}

導入バージョン: v1.1

カラムとそのデータ型の内部構造に関する詳細な説明を出力します。

**構文**

```sql
dumpColumnStructure(x)
```

**引数**

- `x` — 説明を取得する対象の値。[`Any`](/sql-reference/data-types)

**戻り値**

値を表現するために使用されるカラム構造の説明を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=クエリ
SELECT dumpColumnStructure(CAST('2018-01-01 01:02:03', 'DateTime'));
```

```response title=レスポンス
┌─dumpColumnStructure(CAST('2018-01-01 01:02:03', 'DateTime'))─┐
│ DateTime, Const(size = 1, UInt32(size = 1))                  │
└──────────────────────────────────────────────────────────────┘
```


## enabledProfiles {#enabledProfiles}

導入バージョン: v21.9

現在のユーザーに対して有効になっている設定プロファイル名の配列を返します。

**構文**

```sql
enabledProfiles()
```

**引数**

- なし

**戻り値**

現在のユーザーに対して有効になっている設定プロファイル名の配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
SELECT enabledProfiles();
```

```response title=Response
┌─enabledProfiles()─────────────────────────────────────────────────┐
│ ['default', 'readonly_user', 'web_analytics', 'batch_processing'] │
└───────────────────────────────────────────────────────────────────┘
```


## enabledRoles {#enabledRoles}

導入バージョン: v21.9

現在のユーザーで有効になっているロール名の配列を返します。

**構文**

```sql
enabledRoles()
```

**引数**

- なし

**戻り値**

現在のユーザーで有効になっているロール名の配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
SELECT enabledRoles();
```

```response title=Response
┌─enabledRoles()─────────────────────────────────────────────────┐
│ ['general_data', 'sql-console-role:jane.smith@clickhouse.com'] │
└────────────────────────────────────────────────────────────────┘
```


## errorCodeToName {#errorCodeToName}

導入バージョン: v20.12

数値のClickHouseエラーコードに対応するテキスト名を返します。
数値エラーコードからエラー名へのマッピングは[こちら](https://github.com/ClickHouse/ClickHouse/blob/master/src/Common/ErrorCodes.cpp)で確認できます。

**構文**

```sql
errorCodeToName(error_code)
```

**引数**

- `error_code` — ClickHouseエラーコード。[`(U)Int*`](/sql-reference/data-types/int-uint)、[`Float*`](/sql-reference/data-types/float)、または[`Decimal`](/sql-reference/data-types/decimal)

**戻り値**

`error_code`のテキスト名を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT errorCodeToName(252);
```

```response title=Response
┌─errorCodeToName(252)─┐
│ TOO_MANY_PARTS       │
└──────────────────────┘
```


## file {#file}

導入バージョン: v21.3

ファイルを文字列として読み込み、指定されたカラムにデータをロードします。
ファイルの内容は解釈されません。

[`file`](../table-functions/file.md) テーブル関数も参照してください。

**構文**

```sql
file(path[, default])
```

**引数**

- `path` — `user_files_path` からの相対ファイルパス。ワイルドカード `*`、`**`、`?`、`{abc,def}`、および `{N..M}` をサポートします。ここで `N`、`M` は数値、`'abc'`、`'def'` は文字列です。[`String`](/sql-reference/data-types/string)
- `default` — ファイルが存在しない、またはアクセスできない場合に返される値。[`String`](/sql-reference/data-types/string) または [`NULL`](/sql-reference/syntax#null)

**戻り値**

ファイルの内容を文字列として返します。[`String`](/sql-reference/data-types/string)

**例**

**テーブルへのファイルの挿入**

```sql title=クエリ
INSERT INTO table SELECT file('a.txt'), file('b.txt');
```

```response title=レスポンス

```


## filesystemAvailable {#filesystemAvailable}

導入バージョン: v20.1

データベースの永続化を行うファイルシステムの空き容量を返します。
返される値は、オペレーティングシステム用に予約されている領域があるため、常に総空き容量（[`filesystemUnreserved`](../../sql-reference/functions/other-functions.md#filesystemUnreserved)）よりも小さくなります。

**構文**

```sql
filesystemAvailable([disk_name])
```

**引数**

- `disk_name` — オプション。空き容量を調べるディスク名。省略した場合はデフォルトディスクを使用します。[`String`](/sql-reference/data-types/string)または[`FixedString`](/sql-reference/data-types/fixedstring)

**戻り値**

利用可能な残り容量をバイト単位で返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT formatReadableSize(filesystemAvailable()) AS "利用可能な容量";
```

```response title=レスポンス
┌─利用可能な容量─┐
│ 30.75 GiB      │
└────────────────┘
```


## filesystemCapacity {#filesystemCapacity}

導入バージョン: v20.1

ファイルシステムの容量をバイト単位で返します。
データディレクトリへの[path](../../operations/server-configuration-parameters/settings.md#path)を設定する必要があります。

**構文**

```sql
filesystemCapacity([disk_name])
```

**引数**

- `disk_name` — オプション。容量を取得するディスク名。省略した場合、デフォルトのディスクが使用されます。[`String`](/sql-reference/data-types/string)または[`FixedString`](/sql-reference/data-types/fixedstring)

**戻り値**

ファイルシステムの容量をバイト単位で返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT formatReadableSize(filesystemCapacity()) AS "Capacity";
```

```response title=Response
┌─Capacity──┐
│ 39.32 GiB │
└───────────┘
```


## filesystemUnreserved {#filesystemUnreserved}

導入バージョン: v22.12

データベースの永続化をホストするファイルシステム上の空き容量の合計を返します（以前は `filesystemFree`）。
[`filesystemAvailable`](#filesystemAvailable) も参照してください。

**構文**

```sql
filesystemUnreserved([disk_name])
```

**引数**

- `disk_name` — オプション。空き容量の合計を取得するディスク名。省略した場合はデフォルトディスクを使用します。[`String`](/sql-reference/data-types/string) または [`FixedString`](/sql-reference/data-types/fixedstring)

**戻り値**

空き容量をバイト単位で返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT formatReadableSize(filesystemUnreserved()) AS "Free space";
```

```response title=レスポンス
┌─Free space─┐
│ 32.39 GiB  │
└────────────┘
```


## finalizeAggregation {#finalizeAggregation}

導入バージョン: v1.1

集約状態が与えられると、この関数は集約結果（または[-State](../../sql-reference/aggregate-functions/combinators.md#-state)コンビネータを使用している場合は最終化された状態）を返します。

**構文**

```sql
finalizeAggregation(state)
```

**引数**

- `state` — 集約の状態。[`AggregateFunction`](/sql-reference/data-types/aggregatefunction)

**戻り値**

集約の最終化された結果を返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=クエリ
SELECT finalizeAggregation(arrayReduce('maxState', [1, 2, 3]));
```

```response title=レスポンス
┌─finalizeAggregation(arrayReduce('maxState', [1, 2, 3]))─┐
│                                                       3 │
└─────────────────────────────────────────────────────────┘
```

**initializeAggregationとの組み合わせ**

```sql title=クエリ
WITH initializeAggregation('sumState', number) AS one_row_sum_state
SELECT
    number,
    finalizeAggregation(one_row_sum_state) AS one_row_sum,
    runningAccumulate(one_row_sum_state) AS cumulative_sum
FROM numbers(5);
```

```response title=レスポンス
┌─number─┬─one_row_sum─┬─cumulative_sum─┐
│      0 │           0 │              0 │
│      1 │           1 │              1 │
│      2 │           2 │              3 │
│      3 │           3 │              6 │
│      4 │           4 │             10 │
└────────┴─────────────┴────────────────┘
```


## flipCoordinates {#flipCoordinates}

導入バージョン: v25.10

Point、Ring、Polygon、またはMultiPolygonの座標を反転します。Pointの場合は座標を入れ替えます。配列の場合は、各座標ペアに対して同じ変換を再帰的に適用します。

**構文**

```sql
flipCoordinates(geometry)
```

**引数**

- `geometry` — 変換するジオメトリ。サポートされる型: Point (Tuple(Float64, Float64))、Ring (Array(Point))、Polygon (Array(Ring))、MultiPolygon (Array(Polygon))。

**戻り値**

座標が反転されたジオメトリ。型は入力と同じです。[`Point`](/sql-reference/data-types/geo#point)、[`Ring`](/sql-reference/data-types/geo#ring)、[`Polygon`](/sql-reference/data-types/geo#polygon)、または[`MultiPolygon`](/sql-reference/data-types/geo#multipolygon)

**例**

**basic_point**

```sql title=クエリ
SELECT flipCoordinates((1.0, 2.0));
```

```response title=レスポンス
(2.0, 1.0)
```

**ring**

```sql title=クエリ
SELECT flipCoordinates([(1.0, 2.0), (3.0, 4.0)]);
```

```response title=レスポンス
[(2.0, 1.0), (4.0, 3.0)]
```

**polygon**

```sql title=クエリ
SELECT flipCoordinates([[(1.0, 2.0), (3.0, 4.0)], [(5.0, 6.0), (7.0, 8.0)]]);
```

```response title=レスポンス
[[(2.0, 1.0), (4.0, 3.0)], [(6.0, 5.0), (8.0, 7.0)]]
```


## formatQuery {#formatQuery}

Introduced in: v

指定されたSQLクエリを整形し、複数行になる可能性のあるバージョンを返します。解析エラーが発生した場合は例外をスローします。
[example:multiline]

**構文**

```sql
formatQuery(query)
```

**引数**

- `query` — 整形するSQLクエリ。[String](../../sql-reference/data-types/string.md)

**戻り値**

整形されたクエリ [`String`](/sql-reference/data-types/string)

**例**

**multiline**

```sql title=クエリ
SELECT formatQuery('select a,    b FRom tab WHERE a > 3 and  b < 3');
```

```response title=レスポンス
SELECT
    a,
    b
FROM tab
WHERE (a > 3) AND (b < 3)
```


## formatQueryOrNull {#formatQueryOrNull}

Introduced in: v

指定されたSQLクエリを整形し、複数行になる可能性のある形式で返します。解析エラーが発生した場合はNULLを返します。
[example:multiline]

**構文**

```sql
formatQueryOrNull(query)
```

**引数**

- `query` — 整形するSQLクエリ。[String](../../sql-reference/data-types/string.md)

**戻り値**

整形されたクエリ [`String`](/sql-reference/data-types/string)

**例**

**multiline**

```sql title=Query
SELECT formatQuery('select a,    b FRom tab WHERE a > 3 and  b < 3');
```

```response title=Response
SELECT
    a,
    b
FROM tab
WHERE (a > 3) AND (b < 3)
```


## formatQuerySingleLine {#formatQuerySingleLine}

導入バージョン: v

formatQuery()と同様ですが、返される整形済み文字列には改行が含まれません。解析エラーが発生した場合は例外をスローします。
[example:multiline]

**構文**

```sql
formatQuerySingleLine(query)
```

**引数**

- `query` — 整形するSQLクエリ。[String](../../sql-reference/data-types/string.md)

**戻り値**

整形されたクエリ [`String`](/sql-reference/data-types/string)

**例**

**複数行**

```sql title=クエリ
SELECT formatQuerySingleLine('select a,    b FRom tab WHERE a > 3 and  b < 3');
```

```response title=レスポンス
SELECT a, b FROM tab WHERE (a > 3) AND (b < 3)
```


## formatQuerySingleLineOrNull {#formatQuerySingleLineOrNull}

Introduced in: v

formatQuery()と同様ですが、返されるフォーマット済み文字列には改行が含まれません。解析エラーの場合はNULLを返します。
[example:multiline]

**構文**

```sql
formatQuerySingleLineOrNull(query)
```

**引数**

- `query` — フォーマット対象のSQLクエリ。[`String`](/sql-reference/data-types/string)

**戻り値**

フォーマット済みのクエリ [`String`](/sql-reference/data-types/string)

**例**

**multiline**

```sql title=クエリ
SELECT formatQuerySingleLine('select a,    b FRom tab WHERE a > 3 and  b < 3');
```

```response title=レスポンス
SELECT a, b FROM tab WHERE (a > 3) AND (b < 3)
```


## formatReadableDecimalSize {#formatReadableDecimalSize}

導入バージョン: v22.11

サイズ(バイト数)を指定すると、この関数は接尾辞(KB、MBなど)付きの読みやすく丸められたサイズを文字列として返します。

この関数の逆操作は[`parseReadableSize`](#parseReadableSize)です。

**構文**

```sql
formatReadableDecimalSize(x)
```

**引数**

- `x` — バイト単位のサイズ。[`UInt64`](/sql-reference/data-types/int-uint)

**戻り値**

接尾辞付きの読みやすく丸められたサイズを文字列として返します。[`String`](/sql-reference/data-types/string)

**例**

**ファイルサイズのフォーマット**

```sql title=クエリ
SELECT
    arrayJoin([1, 1024, 1024*1024, 192851925]) AS filesize_bytes,
    formatReadableDecimalSize(filesize_bytes) AS filesize
```

```response title=レスポンス
┌─filesize_bytes─┬─filesize───┐
│              1 │ 1.00 B     │
│           1024 │ 1.02 KB    │
│        1048576 │ 1.05 MB    │
│      192851925 │ 192.85 MB  │
└────────────────┴────────────┘
```


## formatReadableQuantity {#formatReadableQuantity}

導入バージョン: v20.10

数値を受け取り、接尾辞（thousand、million、billionなど）を付けた丸められた数値を文字列として返します。

この関数は任意の数値型を入力として受け付けますが、内部的には`Float64`にキャストされます。
大きな値では結果が最適でない場合があります。

**構文**

```sql
formatReadableQuantity(x)
```

**引数**

- `x` — フォーマットする数値。[`UInt64`](/sql-reference/data-types/int-uint)

**戻り値**

接尾辞を付けた丸められた数値を文字列として返します。[`String`](/sql-reference/data-types/string)

**例**

**接尾辞付きで数値をフォーマット**

```sql title=クエリ
SELECT
    arrayJoin([1024, 1234 * 1000, (4567 * 1000) * 1000, 98765432101234]) AS number,
    formatReadableQuantity(number) AS number_for_humans
```

```response title=レスポンス
┌─────────number─┬─number_for_humans─┐
│           1024 │ 1.02 thousand     │
│        1234000 │ 1.23 million      │
│     4567000000 │ 4.57 billion      │
│ 98765432101234 │ 98.77 trillion    │
└────────────────┴───────────────────┘
```


## formatReadableSize {#formatReadableSize}

導入バージョン: v1.1

サイズ(バイト数)を指定すると、この関数は接尾辞(KiB、MiBなど)を付けた読みやすく丸められたサイズを文字列として返します。

この関数の逆操作は[`parseReadableSize`](#parseReadableSize)、[`parseReadableSizeOrZero`](#parseReadableSizeOrZero)、および[`parseReadableSizeOrNull`](#parseReadableSizeOrNull)です。
この関数は任意の数値型を入力として受け付けますが、内部的には`Float64`にキャストされます。大きな値では結果が最適でない場合があります。

**構文**

```sql
formatReadableSize(x)
```

**エイリアス**: `FORMAT_BYTES`

**引数**

- `x` — バイト単位のサイズ。[`UInt64`](/sql-reference/data-types/int-uint)

**戻り値**

接尾辞を付けた読みやすく丸められたサイズを文字列として返します。[`String`](/sql-reference/data-types/string)

**例**

**ファイルサイズのフォーマット**

```sql title=クエリ
SELECT
    arrayJoin([1, 1024, 1024*1024, 192851925]) AS filesize_bytes,
    formatReadableSize(filesize_bytes) AS filesize
```

```response title=レスポンス
┌─filesize_bytes─┬─filesize───┐
│              1 │ 1.00 B     │
│           1024 │ 1.00 KiB   │
│        1048576 │ 1.00 MiB   │
│      192851925 │ 183.92 MiB │
└────────────────┴────────────┘
```


## formatReadableTimeDelta {#formatReadableTimeDelta}

導入バージョン: v20.12

秒単位の時間間隔(デルタ)が与えられると、この関数は年/月/日/時/分/秒/ミリ秒/マイクロ秒/ナノ秒の形式で時間デルタを文字列として返します。

この関数は任意の数値型を入力として受け付けますが、内部的には`Float64`にキャストされます。大きな値の場合、結果が最適でない可能性があります。

**構文**

```sql
formatReadableTimeDelta(column[, maximum_unit, minimum_unit])
```

**引数**

- `column` — 数値型の時間デルタを含むカラム。[`Float64`](/sql-reference/data-types/float)
- `maximum_unit` — オプション。表示する最大単位。指定可能な値: `nanoseconds`、`microseconds`、`milliseconds`、`seconds`、`minutes`、`hours`、`days`、`months`、`years`。デフォルト値: `years`。[`const String`](/sql-reference/data-types/string)
- `minimum_unit` — オプション。表示する最小単位。これより小さい単位はすべて切り捨てられます。指定可能な値: `nanoseconds`、`microseconds`、`milliseconds`、`seconds`、`minutes`、`hours`、`days`、`months`、`years`。明示的に指定された値が`maximum_unit`より大きい場合、例外がスローされます。デフォルト値: `maximum_unit`が`seconds`以上の場合は`seconds`、それ以外の場合は`nanoseconds`。[`const String`](/sql-reference/data-types/string)

**戻り値**

時間デルタを文字列として返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=クエリ
SELECT
    arrayJoin([100, 12345, 432546534]) AS elapsed,
    formatReadableTimeDelta(elapsed) AS time_delta
```

```response title=レスポンス
┌────elapsed─┬─time_delta─────────────────────────────────────────────────────┐
│        100 │ 1 minute and 40 seconds                                        │
│      12345 │ 3 hours, 25 minutes and 45 seconds                             │
│  432546534 │ 13 years, 8 months, 17 days, 7 hours, 48 minutes and 54 seconds│
└────────────┴────────────────────────────────────────────────────────────────┘
```

**最大単位を指定した場合**

```sql title=クエリ
SELECT
    arrayJoin([100, 12345, 432546534]) AS elapsed,
    formatReadableTimeDelta(elapsed, 'minutes') AS time_delta
```

```response title=レスポンス
┌────elapsed─┬─time_delta─────────────────────────────────────────────────────┐
│        100 │ 1 minute and 40 seconds                                         │
│      12345 │ 205 minutes and 45 seconds                                      │
│  432546534 │ 7209108 minutes and 54 seconds                                  │
└────────────┴─────────────────────────────────────────────────────────────────┘
```


## generateRandomStructure {#generateRandomStructure}

導入バージョン: v23.5

`column1_name column1_type, column2_name column2_type, ...` の形式でランダムなテーブル構造を生成します。

**構文**

```sql
generateRandomStructure([number_of_columns, seed])
```

**引数**

- `number_of_columns` — 生成するテーブル構造のカラム数。0または`Null`に設定した場合、カラム数は1から128の範囲でランダムに決定されます。デフォルト値: `Null`。[`UInt64`](/sql-reference/data-types/int-uint)
- `seed` — 安定した結果を生成するためのランダムシード。シードが指定されていないか`Null`に設定されている場合、ランダムに生成されます。[`UInt64`](/sql-reference/data-types/int-uint)

**戻り値**

ランダムに生成されたテーブル構造。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=クエリ
SELECT generateRandomStructure()
```

```response title=レスポンス
c1 Decimal32(5), c2 Date, c3 Tuple(LowCardinality(String), Int128, UInt64, UInt16, UInt8, IPv6), c4 Array(UInt128), c5 UInt32, c6 IPv4, c7 Decimal256(64), c8 Decimal128(3), c9 UInt256, c10 UInt64, c11 DateTime
```

**カラム数を指定した場合**

```sql title=クエリ
SELECT generateRandomStructure(1)
```

```response title=レスポンス
c1 Map(UInt256, UInt16)
```

**シードを指定した場合**

```sql title=クエリ
SELECT generateRandomStructure(NULL, 33)
```

```response title=レスポンス
c1 DateTime, c2 Enum8('c2V0' = 0, 'c2V1' = 1, 'c2V2' = 2, 'c2V3' = 3), c3 LowCardinality(Nullable(FixedString(30))), c4 Int16, c5 Enum8('c5V0' = 0, 'c5V1' = 1, 'c5V2' = 2, 'c5V3' = 3), c6 Nullable(UInt8), c7 String, c8 Nested(e1 IPv4, e2 UInt8, e3 UInt16, e4 UInt16, e5 Int32, e6 Map(Date, Decimal256(70)))
```


## generateSerialID {#generateSerialID}

導入バージョン: v25.1

前回のカウンター値から始まる連番を生成して返します。
この関数は文字列引数（シリーズ識別子）と、オプションの開始値を受け取ります。
サーバーはKeeperで構成されている必要があります。
シリーズはKeeperノードのパス配下に保存され、このパスはサーバー設定の[`series_keeper_path`](/operations/server-configuration-parameters/settings#series_keeper_path)で設定できます。

**構文**

```sql
generateSerialID(series_identifier[, start_value])
```

**引数**

- `series_identifier` — シリーズ識別子 [`const String`](/sql-reference/data-types/string)
- `start_value` — オプション。カウンターの開始値。デフォルトは0。注意: この値は新しいシリーズを作成する際にのみ使用され、シリーズが既に存在する場合は無視されます [`UInt*`](/sql-reference/data-types/int-uint)

**戻り値**

前回のカウンター値から始まる連番を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**最初の呼び出し**

```sql title=クエリ
SELECT generateSerialID('id1')
```

```response title=レスポンス
┌─generateSerialID('id1')──┐
│                        1 │
└──────────────────────────┘
```

**2回目の呼び出し**

```sql title=クエリ
SELECT generateSerialID('id1')
```

```response title=レスポンス
┌─generateSerialID('id1')──┐
│                        2 │
└──────────────────────────┘
```

**カラムでの呼び出し**

```sql title=クエリ
SELECT *, generateSerialID('id1') FROM test_table
```

```response title=レスポンス
┌─CounterID─┬─UserID─┬─ver─┬─generateSerialID('id1')──┐
│         1 │      3 │   3 │                        3 │
│         1 │      1 │   1 │                        4 │
│         1 │      2 │   2 │                        5 │
│         1 │      5 │   5 │                        6 │
│         1 │      4 │   4 │                        7 │
└───────────┴────────┴─────┴──────────────────────────┘
```

**開始値を指定した場合**

```sql title=クエリ
SELECT generateSerialID('id2', 100)
```

```response title=レスポンス
┌─generateSerialID('id2', 100)──┐
│                           100 │
└───────────────────────────────┘
```

**開始値を指定した場合の2回目の呼び出し**

```sql title=クエリ
SELECT generateSerialID('id2', 100)
```

```response title=レスポンス
┌─generateSerialID('id2', 100)──┐
│                           101 │
└───────────────────────────────┘
```


## getClientHTTPHeader {#getClientHTTPHeader}

導入バージョン: v24.5

HTTPヘッダーの値を取得します。
該当するヘッダーが存在しない場合、または現在のリクエストがHTTPインターフェース経由で実行されていない場合、この関数は空文字列を返します。
特定のHTTPヘッダー(例: `Authentication`、`X-ClickHouse-*`)は制限されています。

:::note 設定`allow_get_client_http_header`が必要です
この関数を使用するには、設定`allow_get_client_http_header`を有効にする必要があります。
この設定は、`Cookie`などの一部のヘッダーに機密情報が含まれる可能性があるため、セキュリティ上の理由からデフォルトでは有効になっていません。
:::

この関数ではHTTPヘッダーは大文字小文字を区別します。
分散クエリのコンテキストでこの関数を使用する場合、イニシエーターノードでのみ空でない結果を返します。

**構文**

```sql
getClientHTTPHeader(name)
```

**引数**

- `name` — HTTPヘッダー名。[`String`](/sql-reference/data-types/string)

**戻り値**

ヘッダーの値を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT getClientHTTPHeader('Content-Type');
```

```response title=Response
┌─getClientHTTPHeader('Content-Type')─┐
│ application/x-www-form-urlencoded   │
└─────────────────────────────────────┘
```


## getMacro {#getMacro}

導入バージョン: v20.1

サーバー設定ファイルからマクロの値を返します。
マクロは設定ファイルの[`<macros>`](/operations/server-configuration-parameters/settings#macros)セクションで定義され、複雑なホスト名を持つサーバーであっても、わかりやすい名前で区別するために使用できます。
この関数が分散テーブルのコンテキストで実行される場合、各シャードに関連する値を持つ通常のカラムを生成します。

**構文**

```sql
getMacro(name)
```

**引数**

- `name` — 取得するマクロの名前。[`const String`](/sql-reference/data-types/string)

**戻り値**

指定されたマクロの値を返します。[`String`](/sql-reference/data-types/string)

**例**

**基本的な使用方法**

```sql title=クエリ
SELECT getMacro('test');
```

```response title=レスポンス
┌─getMacro('test')─┐
│ Value            │
└──────────────────┘
```


## getMaxTableNameLengthForDatabase {#getMaxTableNameLengthForDatabase}

Introduced in: v

指定されたデータベース内の最大テーブル名長を返します。

**構文**

```sql
getMaxTableNameLengthForDatabase(database_name)
```

**引数**

- `database_name` — 指定するデータベースの名前。[`String`](/sql-reference/data-types/string)

**戻り値**

最大テーブル名の長さを整数値で返します。

**例**

**典型的な使用例**

```sql title=Query
SELECT getMaxTableNameLengthForDatabase('default');
```

```response title=Response
┌─getMaxTableNameLengthForDatabase('default')─┐
            │                                         206 │
            └─────────────────────────────────────────────┘
```


## getMergeTreeSetting {#getMergeTreeSetting}

導入バージョン: v25.6

MergeTree設定の現在の値を返します。

**構文**

```sql
getMergeTreeSetting(setting_name)
```

**引数**

- `setting_name` — 設定名。[`String`](/sql-reference/data-types/string)

**戻り値**

MergeTree設定の現在の値を返します。

**例**

**使用例**

```sql title=Query
SELECT getMergeTreeSetting('index_granularity');
```

```response title=Response
┌─getMergeTreeSetting('index_granularity')─┐
│                                     8192 │
└──────────────────────────────────────────┘
```


## getOSKernelVersion {#getOSKernelVersion}

導入バージョン: v21.11

OSカーネルのバージョンを文字列で返します。

**構文**

```sql
getOSKernelVersion()
```

**引数**

- なし

**戻り値**

現在のOSカーネルバージョンを返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=クエリ
SELECT getOSKernelVersion();
```

```response title=レスポンス
┌─getOSKernelVersion()────┐
│ Linux 4.15.0-55-generic │
└─────────────────────────┘
```


## getServerPort {#getServerPort}

導入バージョン: v21.10

指定されたプロトコルのサーバーポート番号を返します。

**構文**

```sql
getServerPort(port_name)
```

**引数**

- `port_name` — ポート名。[`String`](/sql-reference/data-types/string)

**戻り値**

サーバーポート番号。[`UInt16`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT getServerPort('tcp_port');
```

```response title=レスポンス
┌─getServerPort('tcp_port')─┐
│                      9000 │
└───────────────────────────┘
```


## getServerSetting {#getServerSetting}

導入バージョン: v25.6

サーバー設定名を指定して、現在設定されている値を返します。

**構文**

```sql
getServerSetting(setting_name')
```

**引数**

- `setting_name` — サーバー設定名。[`String`](/sql-reference/data-types/string)

**戻り値**

サーバー設定の現在の値を返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=クエリ
SELECT getServerSetting('allow_use_jemalloc_memory');
```

```response title=レスポンス
┌─getServerSetting('allow_use_jemalloc_memory')─┐
│ true                                          │
└───────────────────────────────────────────────┘
```


## getSetting {#getSetting}

導入バージョン: v20.7

設定の現在の値を返します。

**構文**

```sql
getSetting(setting_name)
```

**引数**

- `setting_Name` — 設定名。[`const String`](/sql-reference/data-types/string)

**戻り値**

設定の現在の値を返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=クエリ
SELECT getSetting('enable_analyzer');
SET enable_analyzer = false;
SELECT getSetting('enable_analyzer');
```

```response title=レスポンス
┌─getSetting('⋯_analyzer')─┐
│ true                     │
└──────────────────────────┘
┌─getSetting('⋯_analyzer')─┐
│ false                    │
└──────────────────────────┘
```


## getSettingOrDefault {#getSettingOrDefault}

導入バージョン: v24.10

設定の現在の値を返します。現在のプロファイルで設定が定義されていない場合は、第2引数で指定されたデフォルト値を返します。

**構文**

```sql
getSettingOrDefault(setting_name, default_value)
```

**引数**

- `setting_name` — 設定名。[`String`](/sql-reference/data-types/string)
- `default_value` — 設定が定義されていない場合に返す値。任意のデータ型またはNullを指定できます。

**戻り値**

指定された設定の現在の値を返します。設定が定義されていない場合は`default_value`を返します。

**例**

**使用例**

```sql title=Query
SELECT getSettingOrDefault('custom_undef1', 'my_value');
SELECT getSettingOrDefault('custom_undef2', 100);
SELECT getSettingOrDefault('custom_undef3', NULL);
```

```response title=Response
my_value
100
NULL
```


## getSizeOfEnumType {#getSizeOfEnumType}

導入バージョン: v1.1

指定された[`Enum`](../../sql-reference/data-types/enum.md)のフィールド数を返します。

**構文**

```sql
getSizeOfEnumType(x)
```

**引数**

- `x` — `Enum`型の値。[`Enum`](/sql-reference/data-types/enum)

**戻り値**

`Enum`入力値に含まれるフィールド数を返します。[`UInt8/16`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT getSizeOfEnumType(CAST('a' AS Enum8('a' = 1, 'b' = 2))) AS x;
```

```response title=レスポンス
┌─x─┐
│ 2 │
└───┘
```


## getSubcolumn {#getSubcolumn}

導入バージョン: v

式または識別子と、サブカラム名を含む定数文字列を受け取ります。

式から抽出された指定されたサブカラムを返します。

**構文**

```sql

```

**引数**

- なし。

**戻り値**

**例**

**getSubcolumn**

```sql title=クエリ
SELECT getSubcolumn(array_col, 'size0'), getSubcolumn(tuple_col, 'elem_name')
```

```response title=レスポンス

```


## getTypeSerializationStreams {#getTypeSerializationStreams}

導入バージョン: v22.6

データ型のストリームパスを列挙します。
この関数は開発用途を想定しています。

**構文**

```sql
getTypeSerializationStreams(col)
```

**引数**

- `col` — データ型が検出される列またはデータ型の文字列表現。[`Any`](/sql-reference/data-types)

**戻り値**

すべてのシリアライゼーションサブストリームパスを含む配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**タプル**

```sql title=クエリ
SELECT getTypeSerializationStreams(tuple('a', 1, 'b', 2))
```

```response title=レスポンス
['{TupleElement(1), Regular}','{TupleElement(2), Regular}','{TupleElement(3), Regular}','{TupleElement(4), Regular}']
```

**マップ**

```sql title=クエリ
SELECT getTypeSerializationStreams('Map(String, Int64)')
```

```response title=レスポンス
['{ArraySizes}','{ArrayElements, TupleElement(keys), Regular}','{ArrayElements, TupleElement(values), Regular}']
```


## globalVariable {#globalVariable}

導入バージョン: v20.5

定数文字列引数を受け取り、その名前のグローバル変数の値を返します。この関数はMySQLとの互換性のために提供されており、ClickHouseの通常の運用では必要なく、有用でもありません。いくつかのダミーグローバル変数のみが定義されています。

**構文**

```sql
globalVariable(name)
```

**引数**

- `name` — グローバル変数名。[`String`](/sql-reference/data-types/string)

**戻り値**

変数`name`の値を返します。[`Any`](/sql-reference/data-types)

**例**

**globalVariable**

```sql title=クエリ
SELECT globalVariable('max_allowed_packet')
```

```response title=レスポンス
67108864
```


## hasColumnInTable {#hasColumnInTable}

導入バージョン: v1.1

データベーステーブルに特定のカラムが存在するかどうかを確認します。
ネストされたデータ構造の要素については、カラムの存在を確認します。
ネストされたデータ構造自体については、`0` を返します。

**構文**

```sql
hasColumnInTable([hostname[, username[, password]],]database, table, column)
```

**引数**

- `database` — データベース名。[`const String`](/sql-reference/data-types/string)
- `table` — テーブル名。[`const String`](/sql-reference/data-types/string)
- `column` — カラム名。[`const String`](/sql-reference/data-types/string)
- `hostname` — オプション。確認を実行するリモートサーバー名。[`const String`](/sql-reference/data-types/string)
- `username` — オプション。リモートサーバーのユーザー名。[`const String`](/sql-reference/data-types/string)
- `password` — オプション。リモートサーバーのパスワード。[`const String`](/sql-reference/data-types/string)

**戻り値**

指定されたカラムが存在する場合は `1`、存在しない場合は `0` を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**既存のカラムを確認**

```sql title=クエリ
SELECT hasColumnInTable('system','metrics','metric')
```

```response title=レスポンス
1
```

**存在しないカラムを確認**

```sql title=クエリ
SELECT hasColumnInTable('system','metrics','non-existing_column')
```

```response title=レスポンス
0
```


## hasThreadFuzzer {#hasThreadFuzzer}

導入バージョン: v20.6

スレッドファザーが有効かどうかを返します。
この関数はテストとデバッグの目的でのみ有用です。

**構文**

```sql
hasThreadFuzzer()
```

**引数**

- なし

**返り値**

スレッドファザーが有効かどうかを返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**スレッドファザーのステータスを確認**

```sql title=Query
SELECT hasThreadFuzzer()
```

```response title=Response
┌─hasThreadFuzzer()─┐
│                 0 │
└───────────────────┘
```


## hostName {#hostName}

導入バージョン: v20.5

この関数が実行されたホストの名前を返します。
関数がリモートサーバー上で実行される場合（分散処理）、リモートサーバー名が返されます。
関数が分散テーブルのコンテキストで実行される場合、各シャードに関連する値を持つ通常のカラムを生成します。
それ以外の場合は定数値を生成します。

**構文**

```sql
hostName()
```

**エイリアス**: `hostname`

**引数**

- なし

**戻り値**

ホスト名を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=クエリ
SELECT hostName()
```

```response title=レスポンス
┌─hostName()─┐
│ clickhouse │
└────────────┘
```


## icebergBucket {#icebergBucket}

導入バージョン: v25.5

[iceberg bucket transform](https://iceberg.apache.org/spec/#bucket-transform-details.)のロジックを実装します。

**構文**

```sql
icebergBucket(N, value)
```

**引数**

- `N` — バケット数(モジュロ)。[`const (U)Int*`](/sql-reference/data-types/int-uint)
- `value` — 変換対象のソース値。[`(U)Int*`](/sql-reference/data-types/int-uint)、[`Bool`](/sql-reference/data-types/boolean)、[`Decimal`](/sql-reference/data-types/decimal)、[`Float*`](/sql-reference/data-types/float)、[`String`](/sql-reference/data-types/string)、[`FixedString`](/sql-reference/data-types/fixedstring)、[`UUID`](/sql-reference/data-types/uuid)、[`Date`](/sql-reference/data-types/date)、[`Time`](/sql-reference/data-types/time)、または[`DateTime`](/sql-reference/data-types/datetime)

**戻り値**

ソース値の32ビットハッシュを返します。[`Int32`](/sql-reference/data-types/int-uint)

**例**

**例**

```sql title=クエリ
SELECT icebergBucket(5, 1.0 :: Float32)
```

```response title=レスポンス
4
```


## icebergTruncate {#icebergTruncate}

導入バージョン: v25.3

Icebergのtruncate変換のロジックを実装します: https://iceberg.apache.org/spec/#truncate-transform-details.

**構文**

```sql
icebergTruncate(N, value)
```

**引数**

- `value` — 変換する値。[`String`](/sql-reference/data-types/string)、[`(U)Int*`](/sql-reference/data-types/int-uint)、または[`Decimal`](/sql-reference/data-types/decimal)

**戻り値**

引数と同じ型

**例**

**例**

```sql title=クエリ
SELECT icebergTruncate(3, 'iceberg')
```

```response title=レスポンス
ice
```


## identity {#identity}

導入バージョン: v1.1

この関数は、渡された引数をそのまま返します。デバッグやテストに便利です。インデックスの使用をバイパスして、代わりにフルスキャンのパフォーマンスを確認できます。クエリアナライザーは、使用するインデックスを検索する際にidentity関数内の内容を無視し、定数の畳み込みも無効化します。

**構文**

```sql
identity(x)
```

**引数**

- `x` — 入力値。[`Any`](/sql-reference/data-types)

**戻り値**

入力値を変更せずに返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=クエリ
SELECT identity(42)
```

```response title=レスポンス
42
```


## ignore {#ignore}

導入バージョン: v1.1

任意の引数を受け取り、無条件で `0` を返します。

**構文**

```sql
ignore(x)
```

**引数**

- `x` — 使用されない入力値。構文エラーを回避するためだけに渡されます。[`Any`](/sql-reference/data-types)

**戻り値**

常に `0` を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT ignore(0, 'ClickHouse', NULL)
```

```response title=Response
┌─ignore(0, 'ClickHouse', NULL)─┐
│                             0 │
└───────────────────────────────┘
```


## indexHint {#indexHint}

導入バージョン: v1.1

この関数はデバッグと内部検査を目的としています。
引数を無視し、常に1を返します。
引数は評価されません。

ただし、インデックス解析時には、この関数の引数は`indexHint`でラップされていないものとして扱われます。
これにより、対応する条件でインデックス範囲内のデータを選択できますが、この条件による追加のフィルタリングは行われません。
ClickHouseのインデックスはスパースであるため、`indexHint`を使用すると、同じ条件を直接指定する場合よりも多くのデータが取得されます。

**構文**

```sql
indexHint(expression)
```

**引数**

- `expression` — インデックス範囲選択のための任意の式。[`Expression`](/sql-reference/data-types/special-data-types/expression)

**戻り値**

すべての場合において`1`を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**日付フィルタリングの使用例**

```sql title=クエリ
SELECT FlightDate AS k, count() FROM ontime WHERE indexHint(k = '2025-09-15') GROUP BY k ORDER BY k ASC;
```

```response title=レスポンス
┌──────────k─┬─count()─┐
│ 2025-09-14 │    7071 │
│ 2025-09-15 │   16428 │
│ 2025-09-16 │    1077 │
│ 2025-09-30 │    8167 │
└────────────┴─────────┘
```


## initialQueryID {#initialQueryID}

導入バージョン: v1.1

初期クエリのIDを返します。
クエリの他のパラメータは、[`system.query_log`](../../operations/system-tables/query_log.md)の`initial_query_id`フィールドから取得できます。

[`queryID`](/sql-reference/functions/other-functions#queryID)関数とは異なり、`initialQueryID`は異なるシャード間で同じ結果を返します。

**構文**

```sql
initialQueryID()
```

**エイリアス**: `initial_query_id`

**引数**

- なし

**返り値**

初期クエリのIDを返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=クエリ
CREATE TABLE tmp (str String) ENGINE = Log;
INSERT INTO tmp (*) VALUES ('a');
SELECT count(DISTINCT t) FROM (SELECT initialQueryID() AS t FROM remote('127.0.0.{1..3}', currentDatabase(), 'tmp') GROUP BY queryID());
```

```response title=レスポンス
┌─count(DISTINCT t)─┐
│                 1 │
└───────────────────┘
```


## initialQueryStartTime {#initialQueryStartTime}

導入バージョン: v25.4

初期クエリの開始時刻を返します。
`initialQueryStartTime`は異なるシャード間で同じ結果を返します。

**構文**

```sql
initialQueryStartTime()
```

**エイリアス**: `initial_query_start_time`

**引数**

- なし。

**戻り値**

初期クエリの開始時刻を返します。[`DateTime`](/sql-reference/data-types/datetime)

**例**

**使用例**

```sql title=Query
CREATE TABLE tmp (str String) ENGINE = Log;
INSERT INTO tmp (*) VALUES ('a');
SELECT count(DISTINCT t) FROM (SELECT initialQueryStartTime() AS t FROM remote('127.0.0.{1..3}', currentDatabase(), 'tmp') GROUP BY queryID());
```

```response title=Response
┌─count(DISTINCT t)─┐
│                 1 │
└───────────────────┘
```


## initializeAggregation {#initializeAggregation}

導入バージョン: v20.6

単一の値に基づいて集約関数の結果を計算します。
この関数は、コンビネータ[-State](../../sql-reference/aggregate-functions/combinators.md#-state)を持つ集約関数を初期化するために使用できます。
集約関数の状態を作成して[`AggregateFunction`](../../sql-reference/data-types/aggregatefunction.md)型のカラムに挿入したり、初期化された集約をデフォルト値として使用したりできます。

**構文**

```sql
initializeAggregation(aggregate_function, arg1[, arg2, ...])
```

**引数**

- `aggregate_function` — 初期化する集約関数の名前。[`String`](/sql-reference/data-types/string)
- `arg1[, arg2, ...]` — 集約関数の引数。[`Any`](/sql-reference/data-types)

**戻り値**

関数に渡された各行の集約結果を返します。戻り値の型は、`initializeAggregation`が第1引数として受け取る関数の戻り値の型と同じです。[`Any`](/sql-reference/data-types)

**例**

**uniqStateを使用した基本的な使用例**

```sql title=Query
SELECT uniqMerge(state) FROM (SELECT initializeAggregation('uniqState', number % 3) AS state FROM numbers(10000));
```

```response title=Response
┌─uniqMerge(state)─┐
│                3 │
└──────────────────┘
```

**sumStateとfinalizeAggregationを使用した使用例**

```sql title=Query
SELECT finalizeAggregation(state), toTypeName(state) FROM (SELECT initializeAggregation('sumState', number % 3) AS state FROM numbers(5));
```

```response title=Response
┌─finalizeAggregation(state)─┬─toTypeName(state)─────────────┐
│                          0 │ AggregateFunction(sum, UInt8) │
│                          1 │ AggregateFunction(sum, UInt8) │
│                          2 │ AggregateFunction(sum, UInt8) │
│                          0 │ AggregateFunction(sum, UInt8) │
│                          1 │ AggregateFunction(sum, UInt8) │
└────────────────────────────┴───────────────────────────────┘
```


## isConstant {#isConstant}

導入バージョン: v20.3

引数が定数式であるかどうかを返します。
定数式とは、クエリ解析時(すなわち実行前)に結果が確定する式のことです。
例えば、[リテラル](/sql-reference/syntax#literals)を使用した式は定数式です。
この関数は主に開発、デバッグ、およびデモンストレーションを目的としています。

**構文**

```sql
isConstant(x)
```

**引数**

- `x` — チェックする式。[`Any`](/sql-reference/data-types)

**戻り値**

`x`が定数の場合は`1`を、定数でない場合は`0`を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**定数式**

```sql title=クエリ
SELECT isConstant(x + 1)
FROM (SELECT 43 AS x)
```

```response title=レスポンス
┌─isConstant(plus(x, 1))─┐
│                      1 │
└────────────────────────┘
```

**関数を含む定数**

```sql title=クエリ
WITH 3.14 AS pi
SELECT isConstant(cos(pi))
```

```response title=レスポンス
┌─isConstant(cos(pi))─┐
│                   1 │
└─────────────────────┘
```

**非定数式**

```sql title=クエリ
SELECT isConstant(number)
FROM numbers(1)
```

```response title=レスポンス
┌─isConstant(number)─┐
│                  0 │
└────────────────────┘
```

**now()関数の動作**

```sql title=クエリ
SELECT isConstant(now())
```

```response title=レスポンス
┌─isConstant(now())─┐
│                 1 │
└───────────────────┘
```


## isDecimalOverflow {#isDecimalOverflow}

導入バージョン: v20.8

指定された精度のDecimal型に収まるかどうかを確認するため、10進数の桁数をチェックします。

**構文**

```sql
isDecimalOverflow(value[, precision])
```

**引数**

- `value` — チェックする10進数値。[`Decimal`](/sql-reference/data-types/decimal)
- `precision` — オプション。Decimal型の精度。省略した場合、第1引数の元の精度が使用されます。[`UInt8`](/sql-reference/data-types/int-uint)

**戻り値**

10進数値が精度で許可される桁数を超えている場合は`1`、指定された精度を満たしている場合は`0`を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT isDecimalOverflow(toDecimal32(1000000000, 0), 9),
       isDecimalOverflow(toDecimal32(1000000000, 0)),
       isDecimalOverflow(toDecimal32(-1000000000, 0), 9),
       isDecimalOverflow(toDecimal32(-1000000000, 0));
```

```response title=Response
┌─isDecimalOverflow(toDecimal32(1000000000, 0), 9)─┬─isDecimalOverflow(toDecimal32(1000000000, 0))─┬─isDecimalOverflow(toDecimal32(-1000000000, 0), 9)─┬─isDecimalOverflow(toDecimal32(-1000000000, 0))─┐
│                                                1 │                                             1 │                                                 1 │                                              1 │
└──────────────────────────────────────────────────┴───────────────────────────────────────────────┴───────────────────────────────────────────────────┴────────────────────────────────────────────────┘
```


## joinGet {#joinGet}

導入バージョン: v18.16

辞書と同じ方法でテーブルからデータを抽出できます。
指定された結合キーを使用してJoinテーブルからデータを取得します。

:::note
`ENGINE = Join(ANY, LEFT, <join_keys>)` [ステートメント](/engines/table-engines/special/join)で作成されたテーブルのみサポートされます。
:::

**構文**

```sql
joinGet(join_storage_table_name, value_column, join_keys)
```

**引数**

- `join_storage_table_name` — 検索を実行する場所を示す識別子。識別子はデフォルトデータベースで検索されます(設定ファイルの`default_database`パラメータを参照)。デフォルトデータベースを上書きするには、`USE database_name`クエリを使用するか、`database_name.table_name`のようにドット区切りでデータベースとテーブルを指定します。[`String`](/sql-reference/data-types/string)
- `value_column` — 必要なデータを含むテーブルのカラム名。[`const String`](/sql-reference/data-types/string)
- `join_keys` — 結合キーのリスト。[`Any`](/sql-reference/data-types)

**戻り値**

キーのリストに対応する値のリストを返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=クエリ
CREATE TABLE db_test.id_val(`id` UInt32, `val` UInt32) ENGINE = Join(ANY, LEFT, id);
INSERT INTO db_test.id_val VALUES (1,11)(2,12)(4,13);

SELECT joinGet(db_test.id_val, 'val', toUInt32(1));
```

```response title=レスポンス
┌─joinGet(db_test.id_val, 'val', toUInt32(1))─┐
│                                          11 │
└─────────────────────────────────────────────┘
```

**現在のデータベースのテーブルを使用する場合**

```sql title=クエリ
USE db_test;
SELECT joinGet(id_val, 'val', toUInt32(2));
```

```response title=レスポンス
┌─joinGet(id_val, 'val', toUInt32(2))─┐
│                                  12 │
└─────────────────────────────────────┘
```

**配列を結合キーとして使用する場合**

```sql title=クエリ
CREATE TABLE some_table (id1 UInt32, id2 UInt32, name String) ENGINE = Join(ANY, LEFT, id1, id2);
INSERT INTO some_table VALUES (1, 11, 'a') (2, 12, 'b') (3, 13, 'c');

SELECT joinGet(some_table, 'name', 1, 11);
```

```response title=レスポンス
┌─joinGet(some_table, 'name', 1, 11)─┐
│ a                                  │
└────────────────────────────────────┘
```


## joinGetOrNull {#joinGetOrNull}

導入バージョン: v20.4

ディクショナリと同じ方法でテーブルからデータを抽出できます。
指定された結合キーを使用してJoinテーブルからデータを取得します。
[`joinGet`](#joinGet)とは異なり、キーが存在しない場合は`NULL`を返します。

:::note
`ENGINE = Join(ANY, LEFT, <join_keys>)` [ステートメント](/engines/table-engines/special/join)で作成されたテーブルのみサポートします。
:::

**構文**

```sql
joinGetOrNull(join_storage_table_name, value_column, join_keys)
```

**引数**

- `join_storage_table_name` — 検索を実行する場所を示す識別子。識別子はデフォルトデータベースで検索されます（設定ファイルのdefault_databaseパラメータを参照）。デフォルトデータベースを上書きするには、`USE database_name`クエリを使用するか、`database_name.table_name`のようにドット区切りでデータベースとテーブルを指定します。[`String`](/sql-reference/data-types/string)
- `value_column` — 必要なデータを含むテーブルのカラム名。[`const String`](/sql-reference/data-types/string)
- `join_keys` — 結合キーのリスト。[`Any`](/sql-reference/data-types)

**戻り値**

キーのリストに対応する値のリストを返します。キーが見つからない場合は`NULL`を返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=クエリ
CREATE TABLE db_test.id_val(`id` UInt32, `val` UInt32) ENGINE = Join(ANY, LEFT, id);
INSERT INTO db_test.id_val VALUES (1,11)(2,12)(4,13);

SELECT joinGetOrNull(db_test.id_val, 'val', toUInt32(1)), joinGetOrNull(db_test.id_val, 'val', toUInt32(999));
```

```response title=レスポンス
┌─joinGetOrNull(db_test.id_val, 'val', toUInt32(1))─┬─joinGetOrNull(db_test.id_val, 'val', toUInt32(999))─┐
│                                                11 │                                                ᴺᵁᴸᴸ │
└───────────────────────────────────────────────────┴─────────────────────────────────────────────────────┘
```


## lowCardinalityIndices {#lowCardinalityIndices}

導入バージョン: v18.12

[LowCardinality](../data-types/lowcardinality.md)カラムの辞書内における値の位置を返します。位置は1から始まります。LowCardinalityはパートごとに辞書を持つため、この関数は異なるパート内の同じ値に対して異なる位置を返す可能性があります。

**構文**

```sql
lowCardinalityIndices(col)
```

**引数**

- `col` — 低カーディナリティカラム。[`LowCardinality`](/sql-reference/data-types/lowcardinality)

**戻り値**

現在のパートの辞書内における値の位置。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
DROP TABLE IF EXISTS test;
CREATE TABLE test (s LowCardinality(String)) ENGINE = Memory;

-- 2つのパートを作成:

INSERT INTO test VALUES ('ab'), ('cd'), ('ab'), ('ab'), ('df');
INSERT INTO test VALUES ('ef'), ('cd'), ('ab'), ('cd'), ('ef');

SELECT s, lowCardinalityIndices(s) FROM test;
```

```response title=Response
┌─s──┬─lowCardinalityIndices(s)─┐
│ ab │                        1 │
│ cd │                        2 │
│ ab │                        1 │
│ ab │                        1 │
│ df │                        3 │
└────┴──────────────────────────┘
┌─s──┬─lowCardinalityIndices(s)─┐
│ ef │                        1 │
│ cd │                        2 │
│ ab │                        3 │
│ cd │                        2 │
│ ef │                        1 │
└────┴──────────────────────────┘
```


## lowCardinalityKeys {#lowCardinalityKeys}

導入バージョン: v18.12

[LowCardinality](../data-types/lowcardinality.md)カラムの辞書値を返します。
ブロックが辞書サイズより小さいまたは大きい場合、結果は切り詰められるか、デフォルト値で拡張されます。
LowCardinalityはパートごとに辞書を持つため、この関数は異なるパートで異なる辞書値を返す可能性があります。

**構文**

```sql
lowCardinalityKeys(col)
```

**引数**

- `col` — 低カーディナリティカラム。[`LowCardinality`](/sql-reference/data-types/lowcardinality)

**戻り値**

辞書キーを返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**lowCardinalityKeys**

```sql title=Query
DROP TABLE IF EXISTS test;
CREATE TABLE test (s LowCardinality(String)) ENGINE = Memory;

-- 2つのパートを作成:

INSERT INTO test VALUES ('ab'), ('cd'), ('ab'), ('ab'), ('df');
INSERT INTO test VALUES ('ef'), ('cd'), ('ab'), ('cd'), ('ef');

SELECT s, lowCardinalityKeys(s) FROM test;
```

```response title=Response
┌─s──┬─lowCardinalityKeys(s)─┐
│ ef │                       │
│ cd │ ef                    │
│ ab │ cd                    │
│ cd │ ab                    │
│ ef │                       │
└────┴───────────────────────┘
┌─s──┬─lowCardinalityKeys(s)─┐
│ ab │                       │
│ cd │ ab                    │
│ ab │ cd                    │
│ ab │ df                    │
│ df │                       │
└────┴───────────────────────┘
```


## materialize {#materialize}

導入バージョン: v1.1

定数を単一の値を含む完全なカラムに変換します。
完全なカラムと定数はメモリ内で異なる方法で表現されます。
関数は通常、通常の引数と定数の引数に対して異なるコードを実行しますが、結果は通常同じになるはずです。
この関数はこの動作をデバッグするために使用できます。

**構文**

```sql
materialize(x)
```

**引数**

- `x` — 定数。[`Any`](/sql-reference/data-types)

**戻り値**

定数値を含む完全なカラムを返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=Query
-- 以下の例では、`countMatches`関数は定数の第2引数を期待しています。
-- この動作は、`materialize`関数を使用して定数を完全なカラムに変換することでデバッグでき、
-- 非定数の引数に対して関数がエラーをスローすることを確認できます。

SELECT countMatches('foobarfoo', 'foo');
SELECT countMatches('foobarfoo', materialize('foo'));
```

```response title=レスポンス
2
Code: 44. DB::Exception: Received from localhost:9000. DB::Exception: Illegal type of argument #2 'pattern' of function countMatches, expected constant String, got String
```


## minSampleSizeContinuous {#minSampleSizeContinuous}

導入バージョン: v23.10

2つのサンプルにおける連続指標の平均を比較するA/Bテストに必要な最小サンプルサイズを計算します。

[この記事](https://towardsdatascience.com/required-sample-size-for-a-b-testing-6f6608dd330a)で説明されている数式を使用します。
処置群と対照群のサイズが等しいことを前提としています。
1つのグループに必要なサンプルサイズを返します(つまり、実験全体に必要なサンプルサイズは返される値の2倍です)。
また、処置群と対照群におけるテスト指標の分散が等しいことも前提としています。

**構文**

```sql
minSampleSizeContinuous(baseline, sigma, mde, power, alpha)
```

**エイリアス**: `minSampleSizeContinous`

**引数**

- `baseline` — 指標のベースライン値。[`(U)Int*`](/sql-reference/data-types/int-uint)または[`Float*`](/sql-reference/data-types/float)
- `sigma` — 指標のベースライン標準偏差。[`(U)Int*`](/sql-reference/data-types/int-uint)または[`Float*`](/sql-reference/data-types/float)
- `mde` — ベースライン値に対する割合としての最小検出可能効果(MDE)(例: ベースライン値が112.25の場合、MDE 0.03は112.25 ± 112.25*0.03への変化を意味します)。[`(U)Int*`](/sql-reference/data-types/int-uint)または[`Float\*`](/sql-reference/data-types/float)
- `power` — テストに必要な統計的検出力(1 - 第二種過誤の確率)。[`(U)Int*`](/sql-reference/data-types/int-uint)または[`Float*`](/sql-reference/data-types/float)
- `alpha` — テストに必要な有意水準(第一種過誤の確率)。[`(U)Int*`](/sql-reference/data-types/int-uint)または[`Float*`](/sql-reference/data-types/float)

**戻り値**

3つの要素を持つ名前付きタプルを返します: `minimum_sample_size`、`detect_range_lower`、`detect_range_upper`。これらはそれぞれ、必要なサンプルサイズ、返された必要なサンプルサイズでは検出できない値の範囲の下限(`baseline * (1 - mde)`として計算)、返された必要なサンプルサイズでは検出できない値の範囲の上限(`baseline * (1 + mde)`として計算)(Float64)です。[`Tuple(Float64, Float64, Float64)`](/sql-reference/data-types/tuple)

**例**

**minSampleSizeContinuous**

```sql title=Query
SELECT minSampleSizeContinuous(112.25, 21.1, 0.03, 0.80, 0.05) AS sample_size
```

```response title=Response
(616.2931945826209,108.8825,115.6175)
```


## minSampleSizeConversion {#minSampleSizeConversion}

導入バージョン: v22.6

2つのサンプルにおけるコンバージョン率（比率）を比較するA/Bテストに必要な最小サンプルサイズを計算します。

[この記事](https://towardsdatascience.com/required-sample-size-for-a-b-testing-6f6608dd330a)で説明されている数式を使用します。処置群と対照群のサイズが等しいことを前提としています。1つのグループに必要なサンプルサイズを返します（つまり、実験全体に必要なサンプルサイズは返される値の2倍になります）。

**構文**

```sql
minSampleSizeConversion(baseline, mde, power, alpha)
```

**引数**

- `baseline` — ベースラインコンバージョン率。[`Float*`](/sql-reference/data-types/float)
- `mde` — パーセントポイントで表される最小検出可能効果（MDE）（例：ベースラインコンバージョン率が0.25の場合、MDE 0.03は0.25 ± 0.03への変化を意味します）。[`Float*`](/sql-reference/data-types/float)
- `power` — テストに必要な統計的検出力（1 - 第二種過誤の確率）。[`Float*`](/sql-reference/data-types/float)
- `alpha` — テストに必要な有意水準（第一種過誤の確率）。[`Float*`](/sql-reference/data-types/float)

**返される値**

3つの要素を持つ名前付きタプルを返します：`minimum_sample_size`、`detect_range_lower`、`detect_range_upper`。これらはそれぞれ、必要なサンプルサイズ、返された必要サンプルサイズでは検出できない値の範囲の下限（`baseline - mde`として計算）、返された必要サンプルサイズでは検出できない値の範囲の上限（`baseline + mde`として計算）を表します。[`Tuple(Float64, Float64, Float64)`](/sql-reference/data-types/tuple)

**例**

**minSampleSizeConversion**

```sql title=クエリ
SELECT minSampleSizeConversion(0.25, 0.03, 0.80, 0.05) AS sample_size
```

```response title=レスポンス
(3396.077603219163,0.22,0.28)
```


## neighbor {#neighbor}

導入バージョン: v20.1

現在の行から指定されたオフセット位置にある列の値を返します。
この関数は非推奨であり、データブロックの物理的な順序で動作するため、ユーザーが期待する論理的な順序と一致しない可能性があり、エラーが発生しやすくなっています。
代わりに適切なウィンドウ関数の使用を検討してください。

この関数は `allow_deprecated_error_prone_window_functions = 1` を設定することで有効化できます。

**構文**

```sql
neighbor(column, offset[, default_value])
```

**引数**

- `column` — ソース列。[`Any`](/sql-reference/data-types)
- `offset` — 現在の行からのオフセット。正の値は前方を、負の値は後方を参照します。[`Integer`](/sql-reference/data-types/int-uint)
- `default_value` — オプション。オフセットがデータの範囲を超えた場合に返す値。指定されない場合は、列の型のデフォルト値が使用されます。[`Any`](/sql-reference/data-types)

**戻り値**

指定されたオフセット位置の値を返します。範囲外の場合はデフォルト値を返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=クエリ
SELECT number, neighbor(number, 2) FROM system.numbers LIMIT 10;
```

```response title=レスポンス
┌─number─┬─neighbor(number, 2)─┐
│      0 │                   2 │
│      1 │                   3 │
│      2 │                   4 │
│      3 │                   5 │
│      4 │                   6 │
│      5 │                   7 │
│      6 │                   8 │
│      7 │                   9 │
│      8 │                   0 │
│      9 │                   0 │
└────────┴─────────────────────┘
```

**デフォルト値を指定した場合**

```sql title=クエリ
SELECT number, neighbor(number, 2, 999) FROM system.numbers LIMIT 10;
```

```response title=レスポンス
┌─number─┬─neighbor(number, 2, 999)─┐
│      0 │                        2 │
│      1 │                        3 │
│      2 │                        4 │
│      3 │                        5 │
│      4 │                        6 │
│      5 │                        7 │
│      6 │                        8 │
│      7 │                        9 │
│      8 │                      999 │
│      9 │                      999 │
└────────┴──────────────────────────┘
```


## nested {#nested}

Introduced in: v

これはClickHouseエンジンが内部的に使用する関数であり、直接使用することを想定していません。

複数の配列からタプルの配列を返します。

最初の引数は、結果として得られるタプルの名前を決定する文字列の定数配列である必要があります。
その他の引数は同じサイズの配列である必要があります。

**構文**

```sql

```

**引数**

- なし。

**戻り値**

**例**

**nested**

```sql title=Query
SELECT nested(['keys', 'values'], ['key_1', 'key_2'], ['value_1','value_2'])
```

```response title=Response

```


## normalizeQuery {#normalizeQuery}

導入バージョン: v20.8

リテラル、リテラルのシーケンス、および複雑なエイリアス（空白を含む、3桁以上の数字を含む、またはUUIDのように少なくとも36バイト長のもの）をプレースホルダー`?`に置き換えます。

**構文**

```sql
normalizeQuery(x)
```

**引数**

- `x` — 文字のシーケンス。[`String`](/sql-reference/data-types/string)

**戻り値**

プレースホルダーを含む文字のシーケンスを返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=クエリ
SELECT normalizeQuery('[1, 2, 3, x]') AS query
```

```response title=レスポンス
┌─query────┐
│ [?.., x] │
└──────────┘
```


## normalizeQueryKeepNames {#normalizeQueryKeepNames}

導入バージョン: v21.2

リテラルおよびリテラルのシーケンスをプレースホルダー `?` に置き換えますが、複雑なエイリアス(空白を含む、2桁を超える数字を含む、またはUUIDのように36バイト以上の長さを持つもの)は置き換えません。
これにより、複雑なクエリログの分析が容易になります。

**構文**

```sql
normalizeQueryKeepNames(x)
```

**引数**

- `x` — 文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

プレースホルダーを含む文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT normalizeQuery('SELECT 1 AS aComplexName123'), normalizeQueryKeepNames('SELECT 1 AS aComplexName123')
```

```response title=Response
┌─normalizeQuery('SELECT 1 AS aComplexName123')─┬─normalizeQueryKeepNames('SELECT 1 AS aComplexName123')─┐
│ SELECT ? AS `?`                               │ SELECT ? AS aComplexName123                            │
└───────────────────────────────────────────────┴────────────────────────────────────────────────────────┘
```


## normalizedQueryHash {#normalizedQueryHash}

導入バージョン: v20.8

類似したクエリに対して、リテラル値を除いた同一の64ビットハッシュ値を返します。
クエリログの分析に役立ちます。

**構文**

```sql
normalizedQueryHash(x)
```

**引数**

- `x` — 文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

64ビットハッシュ値を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT normalizedQueryHash('SELECT 1 AS `xyz`') != normalizedQueryHash('SELECT 1 AS `abc`') AS res
```

```response title=Response
┌─res─┐
│   1 │
└─────┘
```


## normalizedQueryHashKeepNames {#normalizedQueryHashKeepNames}

導入バージョン: v21.2

[`normalizedQueryHash`](#normalizedQueryHash)と同様に、類似したクエリに対してリテラル値を除いた同一の64ビットハッシュ値を返しますが、ハッシュ化の前に複雑なエイリアス(空白文字を含む、3桁以上の数字を含む、またはUUIDのように36バイト以上の長さを持つもの)をプレースホルダーに置き換えることはありません。
クエリログの分析に役立ちます。

**構文**

```sql
normalizedQueryHashKeepNames(x)
```

**引数**

- `x` — 文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

64ビットハッシュ値を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
SELECT normalizedQueryHash('SELECT 1 AS `xyz123`') != normalizedQueryHash('SELECT 1 AS `abc123`') AS normalizedQueryHash;
SELECT normalizedQueryHashKeepNames('SELECT 1 AS `xyz123`') != normalizedQueryHashKeepNames('SELECT 1 AS `abc123`') AS normalizedQueryHashKeepNames;
```

```response title=Response
┌─normalizedQueryHash─┐
│                   0 │
└─────────────────────┘
┌─normalizedQueryHashKeepNames─┐
│                            1 │
└──────────────────────────────┘
```


## parseReadableSize {#parseReadableSize}

導入バージョン: v24.6

バイトサイズと `B`、`KiB`、`KB`、`MiB`、`MB` などの単位を含む文字列(すなわち [ISO/IEC 80000-13](https://en.wikipedia.org/wiki/ISO/IEC_80000) または10進数バイト単位)を指定すると、この関数は対応するバイト数を返します。
関数が入力値を解析できない場合は、例外をスローします。

この関数の逆操作は [`formatReadableSize`](#formatReadableSize) および [`formatReadableDecimalSize`](#formatReadableDecimalSize) です。

**構文**

```sql
parseReadableSize(x)
```

**引数**

- `x` — ISO/IEC 80000-13 または10進数バイト単位による読み取り可能なサイズ。[`String`](/sql-reference/data-types/string)

**戻り値**

最も近い整数に切り上げられたバイト数を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT arrayJoin(['1 B', '1 KiB', '3 MB', '5.314 KiB']) AS readable_sizes, parseReadableSize(readable_sizes) AS sizes;
```

```response title=レスポンス
┌─readable_sizes─┬───sizes─┐
│ 1 B            │       1 │
│ 1 KiB          │    1024 │
│ 3 MB           │ 3000000 │
│ 5.314 KiB      │    5442 │
└────────────────┴─────────┘
```


## parseReadableSizeOrNull {#parseReadableSizeOrNull}

導入バージョン: v24.6

バイトサイズと `B`、`KiB`、`KB`、`MiB`、`MB` などの単位を含む文字列（[ISO/IEC 80000-13](https://en.wikipedia.org/wiki/ISO/IEC_80000) または10進数バイト単位）を指定すると、この関数は対応するバイト数を返します。
入力値の解析ができない場合は `NULL` を返します。

この関数の逆操作は [`formatReadableSize`](#formatReadableSize) および [`formatReadableDecimalSize`](#formatReadableDecimalSize) です。

**構文**

```sql
parseReadableSizeOrNull(x)
```

**引数**

- `x` — ISO/IEC 80000-13 または10進数バイト単位で表された読みやすいサイズ。[`String`](/sql-reference/data-types/string)

**戻り値**

最も近い整数に切り上げられたバイト数を返します。入力の解析ができない場合は `NULL` を返します。[`Nullable(UInt64)`](/sql-reference/data-types/nullable)

**例**

**使用例**

```sql title=クエリ
SELECT arrayJoin(['1 B', '1 KiB', '3 MB', '5.314 KiB', 'invalid']) AS readable_sizes, parseReadableSizeOrNull(readable_sizes) AS sizes;
```

```response title=レスポンス
┌─readable_sizes─┬───sizes─┐
│ 1 B            │       1 │
│ 1 KiB          │    1024 │
│ 3 MB           │ 3000000 │
│ 5.314 KiB      │    5442 │
│ invalid        │    ᴺᵁᴸᴸ │
└────────────────┴─────────┘
```


## parseReadableSizeOrZero {#parseReadableSizeOrZero}

導入バージョン: v24.6

バイトサイズと単位(`B`、`KiB`、`KB`、`MiB`、`MB`など、すなわち[ISO/IEC 80000-13](https://en.wikipedia.org/wiki/ISO/IEC_80000)または10進数バイト単位)を含む文字列が与えられた場合、この関数は対応するバイト数を返します。
入力値の解析ができない場合は、`0`を返します。

この関数の逆操作は[`formatReadableSize`](#formatReadableSize)および[`formatReadableDecimalSize`](#formatReadableDecimalSize)です。

**構文**

```sql
parseReadableSizeOrZero(x)
```

**引数**

- `x` — ISO/IEC 80000-13または10進数バイト単位で表された読みやすいサイズ。[`String`](/sql-reference/data-types/string)

**戻り値**

最も近い整数に切り上げられたバイト数を返します。入力の解析ができない場合は`0`を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT arrayJoin(['1 B', '1 KiB', '3 MB', '5.314 KiB', 'invalid']) AS readable_sizes, parseReadableSizeOrZero(readable_sizes) AS sizes;
```

```response title=レスポンス
┌─readable_sizes─┬───sizes─┐
│ 1 B            │       1 │
│ 1 KiB          │    1024 │
│ 3 MB           │ 3000000 │
│ 5.314 KiB      │    5442 │
│ invalid        │       0 │
└────────────────┴─────────┘
```


## parseTimeDelta {#parseTimeDelta}

導入バージョン: v22.7

数値の並びとそれに続く時間単位を表す文字列を解析します。

時間差分文字列では、以下の時間単位指定を使用します:

- `years`, `year`, `yr`, `y`
- `months`, `month`, `mo`
- `weeks`, `week`, `w`
- `days`, `day`, `d`
- `hours`, `hour`, `hr`, `h`
- `minutes`, `minute`, `min`, `m`
- `seconds`, `second`, `sec`, `s`
- `milliseconds`, `millisecond`, `millisec`, `ms`
- `microseconds`, `microsecond`, `microsec`, `μs`, `µs`, `us`
- `nanoseconds`, `nanosecond`, `nanosec`, `ns`

複数の時間単位は区切り文字(スペース、`;`、`-`、`+`、`,`、`:`)で組み合わせることができます。

年と月の長さは近似値です: 年は365日、月は30.5日として計算されます。

**構文**

```sql
parseTimeDelta(timestr)
```

**引数**

- `timestr` — 数値の並びとそれに続く時間単位を表す文字列。[`String`](/sql-reference/data-types/string)

**戻り値**

秒数。[`Float64`](/sql-reference/data-types/float)

**例**

**使用例**

```sql title=クエリ
SELECT parseTimeDelta('11s+22min')
```

```response title=結果
┌─parseTimeDelta('11s+22min')─┐
│                        1331 │
└─────────────────────────────┘
```

**複合時間単位**

```sql title=クエリ
SELECT parseTimeDelta('1yr2mo')
```

```response title=結果
┌─parseTimeDelta('1yr2mo')─┐
│                 36806400 │
└──────────────────────────┘
```


## partitionId {#partitionId}

導入バージョン: v21.4

[パーティションID](../../engines/table-engines/mergetree-family/custom-partitioning-key.md)を計算します。

:::note
この関数は処理速度が遅いため、大量の行に対して呼び出すべきではありません。
:::

**構文**

```sql
partitionId(column1[, column2, ...])
```

**エイリアス**: `partitionID`

**引数**

- `column1, column2, ...` — パーティションIDを返す対象のカラム。

**戻り値**

行が属するパーティションIDを返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=クエリ
DROP TABLE IF EXISTS tab;

CREATE TABLE tab
(
  i int,
  j int
)
ENGINE = MergeTree
PARTITION BY i
ORDER BY tuple();

INSERT INTO tab VALUES (1, 1), (1, 2), (1, 3), (2, 4), (2, 5), (2, 6);

SELECT i, j, partitionId(i), _partition_id FROM tab ORDER BY i, j;
```

```response title=レスポンス
┌─i─┬─j─┬─partitionId(i)─┬─_partition_id─┐
│ 1 │ 1 │ 1              │ 1             │
│ 1 │ 2 │ 1              │ 1             │
│ 1 │ 3 │ 1              │ 1             │
│ 2 │ 4 │ 2              │ 2             │
│ 2 │ 5 │ 2              │ 2             │
│ 2 │ 6 │ 2              │ 2             │
└───┴───┴────────────────┴───────────────┘
```


## queryID {#queryID}

Introduced in: v21.9

現在のクエリのIDを返します。
クエリの他のパラメータは、[`system.query_log`](../../operations/system-tables/query_log.md)テーブルの`query_id`フィールドから取得できます。

[`initialQueryID`](#initialQueryID)関数とは異なり、`queryID`は異なるシャードで異なる結果を返す可能性があります。

**構文**

```sql
queryID()
```

**エイリアス**: `query_id`

**引数**

- なし

**戻り値**

現在のクエリのIDを返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
CREATE TABLE tmp (str String) ENGINE = Log;
INSERT INTO tmp (*) VALUES ('a');
SELECT count(DISTINCT t) FROM (SELECT queryID() AS t FROM remote('127.0.0.{1..3}', currentDatabase(), 'tmp') GROUP BY queryID());
```

```response title=Response
┌─count(DISTINCT t)─┐
│                 3 │
└───────────────────┘
```


## revision {#revision}

導入バージョン: v22.7

現在のClickHouseサーバーのリビジョンを返します。

**構文**

```sql
revision()
```

**引数**

- なし

**戻り値**

現在のClickHouseサーバーのリビジョンを返します。[`UInt32`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT revision()
```

```response title=レスポンス
┌─revision()─┐
│      54485 │
└────────────┘
```


## rowNumberInAllBlocks {#rowNumberInAllBlocks}

導入バージョン: v1.1

処理される各行に対して一意の行番号を返します。

**構文**

```sql
rowNumberInAllBlocks()
```

**引数**

- なし

**返り値**

データブロック内の行の序数を`0`から始まる値で返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT rowNumberInAllBlocks()
FROM
(
    SELECT *
    FROM system.numbers_mt
    LIMIT 10
)
SETTINGS max_block_size = 2
```

```response title=レスポンス
┌─rowNumberInAllBlocks()─┐
│                      0 │
│                      1 │
└────────────────────────┘
┌─rowNumberInAllBlocks()─┐
│                      4 │
│                      5 │
└────────────────────────┘
┌─rowNumberInAllBlocks()─┐
│                      2 │
│                      3 │
└────────────────────────┘
┌─rowNumberInAllBlocks()─┐
│                      6 │
│                      7 │
└────────────────────────┘
┌─rowNumberInAllBlocks()─┐
│                      8 │
│                      9 │
└────────────────────────┘
```


## rowNumberInBlock {#rowNumberInBlock}

導入バージョン: v1.1

`rowNumberInBlock`で処理される各[ブロック](../../development/architecture.md#block)について、現在の行番号を返します。

返される番号は各ブロックごとに0から始まります。

**構文**

```sql
rowNumberInBlock()
```

**引数**

- なし

**戻り値**

データブロック内の行の序数を`0`から始まる値で返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT rowNumberInBlock()
FROM
(
    SELECT *
    FROM system.numbers_mt
    LIMIT 10
) SETTINGS max_block_size = 2
```

```response title=レスポンス
┌─rowNumberInBlock()─┐
│                  0 │
│                  1 │
└────────────────────┘
┌─rowNumberInBlock()─┐
│                  0 │
│                  1 │
└────────────────────┘
┌─rowNumberInBlock()─┐
│                  0 │
│                  1 │
└────────────────────┘
┌─rowNumberInBlock()─┐
│                  0 │
│                  1 │
└────────────────────┘
┌─rowNumberInBlock()─┐
│                  0 │
│                  1 │
└────────────────────┘
```


## runningAccumulate {#runningAccumulate}

導入バージョン: v1.1

データブロックの各行に対して集約関数の状態を累積します。

:::warning 非推奨
状態は新しいデータブロックごとにリセットされます。
このエラーが発生しやすい動作のため、この関数は非推奨となっており、代わりに[ウィンドウ関数](/sql-reference/window-functions)の使用を推奨します。
この関数の使用を許可するには、設定[`allow_deprecated_error_prone_window_functions`](/operations/settings/settings#allow_deprecated_error_prone_window_functions)を使用できます。
:::

**構文**

```sql
runningAccumulate(agg_state[, grouping])
```

**引数**

- `agg_state` — 集約関数の状態。[`AggregateFunction`](/sql-reference/data-types/aggregatefunction)
- `grouping` — オプション。グループ化キー。`grouping`の値が変更されると関数の状態がリセットされます。等価演算子が定義されているサポート対象のデータ型であれば何でも指定できます。[`Any`](/sql-reference/data-types)

**戻り値**

各行の累積結果を返します。[`Any`](/sql-reference/data-types)

**例**

**initializeAggregationを使用した使用例**

```sql title=クエリ
WITH initializeAggregation('sumState', number) AS one_row_sum_state
SELECT
    number,
    finalizeAggregation(one_row_sum_state) AS one_row_sum,
    runningAccumulate(one_row_sum_state) AS cumulative_sum
FROM numbers(5);
```

```response title=レスポンス
┌─number─┬─one_row_sum─┬─cumulative_sum─┐
│      0 │           0 │              0 │
│      1 │           1 │              1 │
│      2 │           2 │              3 │
│      3 │           3 │              6 │
│      4 │           4 │             10 │
└────────┴─────────────┴────────────────┘
```


## runningConcurrency {#runningConcurrency}

導入バージョン: v21.3

同時実行イベントの数を計算します。
各イベントには開始時刻と終了時刻があります。
開始時刻はイベントに含まれますが、終了時刻は除外されます。
開始時刻と終了時刻のカラムは同じデータ型である必要があります。
この関数は、各イベントの開始時刻における実行中（同時実行）イベントの総数を計算します。

:::tip 要件
イベントは開始時刻の昇順でソートされている必要があります。
この要件が満たされない場合、関数は例外を発生させます。
各データブロックは個別に処理されます。
異なるデータブロックのイベントが重複する場合、正しく処理できません。
:::

:::warning 非推奨
代わりに[ウィンドウ関数](/sql-reference/window-functions)の使用を推奨します。
:::

**構文**

```sql
runningConcurrency(start, end)
```

**引数**

- `start` — イベントの開始時刻を持つカラム。[`Date`](/sql-reference/data-types/date)、[`DateTime`](/sql-reference/data-types/datetime)、または[`DateTime64`](/sql-reference/data-types/datetime64)
- `end` — イベントの終了時刻を持つカラム。[`Date`](/sql-reference/data-types/date)、[`DateTime`](/sql-reference/data-types/datetime)、または[`DateTime64`](/sql-reference/data-types/datetime64)

**戻り値**

各イベントの開始時刻における同時実行イベントの数を返します。[`UInt32`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT start, runningConcurrency(start, end) FROM example_table;
```

```response title=レスポンス
┌──────start─┬─runningConcurrency(start, end)─┐
│ 2025-03-03 │                              1 │
│ 2025-03-06 │                              2 │
│ 2025-03-07 │                              3 │
│ 2025-03-11 │                              2 │
└────────────┴────────────────────────────────┘
```


## runningDifference {#runningDifference}

導入バージョン: v1.1

データブロック内の連続する2つの行の値の差分を計算します。
最初の行には`0`を返し、それ以降の行には前の行との差分を返します。

:::warning 非推奨
現在処理中のデータブロック内の差分のみを返します。
このエラーが発生しやすい動作のため、この関数は非推奨となっています。
代わりに[ウィンドウ関数](/sql-reference/window-functions)の使用を推奨します。

この関数の使用を許可するには、設定[`allow_deprecated_error_prone_window_functions`](/operations/settings/settings#allow_deprecated_error_prone_window_functions)を使用できます。
:::

関数の結果は、影響を受けるデータブロックとブロック内のデータの順序に依存します。
`runningDifference()`の計算中の行の順序は、ユーザーに返される行の順序と異なる場合があります。
これを防ぐには、[`ORDER BY`](../../sql-reference/statements/select/order-by.md)を使用してサブクエリを作成し、サブクエリの外部から関数を呼び出すことができます。
ブロックサイズが結果に影響することに注意してください。
`runningDifference`の内部状態は、新しいブロックごとにリセットされます。

**構文**

```sql
runningDifference(x)
```

**引数**

- `x` — 連続差分を計算する対象のカラム。[`Any`](/sql-reference/data-types)

**戻り値**

連続する値の差分を返します。最初の行には0を返します。

**例**

**使用例**

```sql title=Query
SELECT
    EventID,
    EventTime,
    runningDifference(EventTime) AS delta
FROM
(
    SELECT
        EventID,
        EventTime
    FROM events
    WHERE EventDate = '2025-11-24'
    ORDER BY EventTime ASC
    LIMIT 5
);
```

```response title=Response
┌─EventID─┬───────────EventTime─┬─delta─┐
│    1106 │ 2025-11-24 00:00:04 │     0 │
│    1107 │ 2025-11-24 00:00:05 │     1 │
│    1108 │ 2025-11-24 00:00:05 │     0 │
│    1109 │ 2025-11-24 00:00:09 │     4 │
│    1110 │ 2025-11-24 00:00:10 │     1 │
└─────────┴─────────────────────┴───────┘
```

**ブロックサイズの影響の例**

```sql title=Query
SELECT
    number,
    runningDifference(number + 1) AS diff
FROM numbers(100000)
WHERE diff != 1;
```

```response title=Response
┌─number─┬─diff─┐
│      0 │    0 │
└────────┴──────┘
┌─number─┬─diff─┐
│  65536 │    0 │
└────────┴──────┘
```


## runningDifferenceStartingWithFirstValue {#runningDifferenceStartingWithFirstValue}

導入バージョン: v1.1

データブロック内の連続する行の値の差分を計算しますが、[`runningDifference`](#runningDifference)とは異なり、最初の行には`0`ではなく実際の値を返します。

:::warning 非推奨
現在処理中のデータブロック内の差分のみを返します。
このエラーが発生しやすい動作のため、この関数は非推奨となっています。
代わりに[ウィンドウ関数](/sql-reference/window-functions)の使用を推奨します。

この関数を使用するには、`allow_deprecated_error_prone_window_functions`設定を有効にしてください。
:::

**構文**

```sql
runningDifferenceStartingWithFirstValue(x)
```

**引数**

- `x` — 連続差分を計算する対象のカラム。[`Any`](/sql-reference/data-types)

**戻り値**

連続する値の差分を返します。最初の行には最初の行の値が返されます。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=Query
SELECT
    number,
    runningDifferenceStartingWithFirstValue(number) AS diff
FROM numbers(5);
```

```response title=Response
┌─number─┬─diff─┐
│      0 │    0 │
│      1 │    1 │
│      2 │    1 │
│      3 │    1 │
│      4 │    1 │
└────────┴──────┘
```


## serverUUID {#serverUUID}

導入バージョン: v20.1

サーバーが最初に起動されたときに生成されるランダムかつ一意なUUID (v4) を返します。
UUIDは永続化されるため、2回目、3回目以降のサーバー起動時には同じUUIDが返されます。

**構文**

```sql
serverUUID()
```

**引数**

- なし

**戻り値**

サーバーのランダムなUUIDを返します。[`UUID`](/sql-reference/data-types/uuid)

**例**

**使用例**

```sql title=クエリ
SELECT serverUUID();
```

```response title=レスポンス
┌─serverUUID()─────────────────────────────┐
│ 7ccc9260-000d-4d5c-a843-5459abaabb5f     │
└──────────────────────────────────────────┘
```


## shardCount {#shardCount}

導入バージョン: v21.9

分散クエリのシャード総数を返します。
クエリが分散されていない場合は、定数値 `0` が返されます。

**構文**

```sql
shardCount()
```

**引数**

- なし

**戻り値**

シャードの総数または `0` を返します。[`UInt32`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
-- shardCount() の動作も示している上記の shardNum() の例を参照してください
CREATE TABLE shard_count_example (dummy UInt8)
ENGINE=Distributed(test_cluster_two_shards_localhost, system, one, dummy);
SELECT shardCount() FROM shard_count_example;
```

```response title=Response
┌─shardCount()─┐
│            2 │
│            2 │
└──────────────┘
```


## shardNum {#shardNum}

導入バージョン: v21.9

分散クエリでデータの一部を処理するシャードのインデックスを返します。
インデックスは `1` から始まります。
クエリが分散されていない場合は、定数値 `0` が返されます。

**Syntax**

```sql
shardNum()
```

**引数**

- なし

**戻り値**

シャードインデックスまたは定数 `0` を返します。[`UInt32`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
CREATE TABLE shard_num_example (dummy UInt8)
ENGINE=Distributed(test_cluster_two_shards_localhost, system, one, dummy);
SELECT dummy, shardNum(), shardCount() FROM shard_num_example;
```

```response title=レスポンス
┌─dummy─┬─shardNum()─┬─shardCount()─┐
│     0 │          1 │            2 │
│     0 │          2 │            2 │
└───────┴────────────┴──────────────┘
```


## showCertificate {#showCertificate}

導入バージョン: v22.6

現在のサーバーに設定されているSecure Sockets Layer (SSL)証明書の情報を表示します。
ClickHouseでOpenSSL証明書を使用して接続を検証するための設定方法の詳細については、[SSL-TLSの設定](/guides/sre/configuring-ssl)を参照してください。

**構文**

```sql
showCertificate()
```

**引数**

- なし

**戻り値**

設定されたSSL証明書に関連するキーと値のペアのマップを返します。[`Map(String, String)`](/sql-reference/data-types/map)

**例**

**使用例**

```sql title=クエリ
SELECT showCertificate() FORMAT LineAsString;
```

```response title=レスポンス
{'version':'1','serial_number':'2D9071D64530052D48308473922C7ADAFA85D6C5','signature_algo':'sha256WithRSAEncryption','issuer':'/CN=marsnet.local CA','not_before':'May  7 17:01:21 2024 GMT','not_after':'May  7 17:01:21 2025 GMT','subject':'/CN=chnode1','pkey_algo':'rsaEncryption'}
```


## sleep {#sleep}

導入バージョン: v1.1

指定された秒数だけクエリの実行を一時停止します。
この関数は主にテストとデバッグの目的で使用されます。

`sleep()` 関数は、クエリのパフォーマンスとシステムの応答性に悪影響を与える可能性があるため、本番環境では通常使用すべきではありません。
ただし、以下のシナリオでは有用です:

1. **テスト**: ClickHouseのテストやベンチマークを行う際、特定の条件下でシステムがどのように動作するかを観察するために、遅延をシミュレートしたり一時停止を導入したりできます。
2. **デバッグ**: 特定の時点でシステムの状態やクエリの実行を調査する必要がある場合、`sleep()` を使用して一時停止を導入し、関連情報を検査または収集できます。
3. **シミュレーション**: ネットワーク遅延や外部システムへの依存関係など、遅延や一時停止が発生する実際のシナリオをシミュレートしたい場合があります。

:::warning
`sleep()` 関数は、ClickHouseシステム全体のパフォーマンスと応答性に影響を与える可能性があるため、慎重に、必要な場合にのみ使用することが重要です。
:::

セキュリティ上の理由から、この関数はデフォルトのユーザープロファイル(`allow_sleep` が有効)でのみ実行できます。

**構文**

```sql
sleep(seconds)
```

**引数**

- `seconds` — クエリの実行を一時停止する秒数(最大3秒)。小数秒を指定するために浮動小数点値を使用できます。[`const UInt*`](/sql-reference/data-types/int-uint) または [`const Float*`](/sql-reference/data-types/float)

**戻り値**

`0` を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
-- このクエリは完了する前に2秒間一時停止します。
-- この間、結果は返されず、クエリはハングまたは応答なしの状態に見えます。
SELECT sleep(2);
```

```response title=Response
┌─sleep(2)─┐
│        0 │
└──────────┘
1 row in set. Elapsed: 2.012 sec.
```


## sleepEachRow {#sleepEachRow}

導入バージョン: v1.1

結果セットの各行に対して、指定された秒数だけクエリの実行を一時停止します。

`sleepEachRow()`関数は、[`sleep()`](#sleep)関数と同様に、主にテストおよびデバッグ目的で使用されます。
各行の処理において遅延をシミュレートしたり、一時停止を導入したりすることができ、以下のようなシナリオで有用です:

1. **テスト**: 特定の条件下でClickHouseのパフォーマンスをテストまたはベンチマークする際、`sleepEachRow()`を使用して処理される各行に対して遅延をシミュレートしたり、一時停止を導入したりできます。
2. **デバッグ**: 処理される各行に対してシステムの状態やクエリの実行を検証する必要がある場合、`sleepEachRow()`を使用して一時停止を導入し、関連情報を検査または収集できます。
3. **シミュレーション**: 外部システムやネットワーク遅延を扱う場合など、処理される各行に対して遅延や一時停止が発生する実際のシナリオをシミュレートしたい場合があります。

:::warning
`sleep()`関数と同様に、`sleepEachRow()`は慎重に、必要な場合にのみ使用することが重要です。特に大規模な結果セットを扱う場合、ClickHouseシステム全体のパフォーマンスと応答性に大きな影響を与える可能性があります。
:::

**構文**

```sql
sleepEachRow(seconds)
```

**引数**

- `seconds` — 結果セットの各行に対してクエリの実行を一時停止する秒数。最大3秒まで指定可能です。小数秒を指定するために浮動小数点値を使用できます。[`const UInt*`](/sql-reference/data-types/int-uint)または[`const Float*`](/sql-reference/data-types/float)

**返り値**

各行に対して`0`を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
-- 出力は遅延され、各行の間に0.5秒の一時停止が発生します。
SELECT number, sleepEachRow(0.5) FROM system.numbers LIMIT 5;
```

```response title=Response
┌─number─┬─sleepEachRow(0.5)─┐
│      0 │                 0 │
│      1 │                 0 │
│      2 │                 0 │
│      3 │                 0 │
│      4 │                 0 │
└────────┴───────────────────┘
```


## structureToCapnProtoSchema {#structureToCapnProtoSchema}

導入バージョン: v

ClickHouseテーブル構造をCapnProto形式スキーマに変換する関数

**構文**

```sql

```

**引数**

- なし

**戻り値**

**例**

**ランダム**

```sql title=クエリ
SELECT structureToCapnProtoSchema('s String, x UInt32', 'MessageName') format TSVRaw
```

```response title=レスポンス
struct MessageName
{
    s @0 : Data;
    x @1 : UInt32;
}
```


## structureToProtobufSchema {#structureToProtobufSchema}

導入バージョン: v23.8

ClickHouseのテーブル構造をProtobuf形式のスキーマに変換します。

この関数は、ClickHouseのテーブル構造定義を受け取り、proto3構文のProtocol Buffers（Protobuf）スキーマ定義に変換します。データ交換のために、ClickHouseのテーブル構造に対応するProtobufスキーマを生成する際に便利です。

**構文**

```sql
structureToProtobufSchema(structure, message_name)
```

**引数**

- `structure` — 文字列形式で指定するClickHouseのテーブル構造定義（例: 'column1 Type1, column2 Type2'）。[`String`](/sql-reference/data-types/string)
- `message_name` — 生成されるスキーマ内のProtobufメッセージ型の名前。[`String`](/sql-reference/data-types/string)

**戻り値**

入力されたClickHouse構造に対応する、proto3構文のProtobufスキーマ定義を返します。[`String`](/sql-reference/data-types/string)

**例**

**ClickHouse構造をProtobufスキーマに変換**

```sql title=Query
SELECT structureToProtobufSchema('s String, x UInt32', 'MessageName') FORMAT TSVRaw;
```

```response title=Response
syntax = "proto3";

message MessageName
{
    bytes s = 1;
    uint32 x = 2;
}
```


## tcpPort {#tcpPort}

導入バージョン: v20.12

サーバーがリッスンしている[ネイティブインターフェース](../../interfaces/tcp.md)のTCPポート番号を返します。
分散テーブルのコンテキストで実行された場合、この関数は各シャードに関連する値を持つ通常のカラムを生成します。
それ以外の場合は定数値を返します。

**構文**

```sql
tcpPort()
```

**引数**

- なし

**戻り値**

TCPポート番号を返します。[`UInt16`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT tcpPort()
```

```response title=レスポンス
┌─tcpPort()─┐
│      9000 │
└───────────┘
```


## throwIf {#throwIf}

導入バージョン: v1.1

引数xがtrueの場合に例外をスローします。
`error_code`引数を使用するには、設定パラメータ`allow_custom_error_code_in_throw`を有効にする必要があります。

**構文**

```sql
throwIf(x[, message[, error_code]])
```

**引数**

- `x` — チェックする条件。[`Any`](/sql-reference/data-types)
- `message` — オプション。カスタムエラーメッセージ。[`const String`](/sql-reference/data-types/string)
- `error_code` — オプション。カスタムエラーコード。[`const Int8/16/32`](/sql-reference/data-types/int-uint)

**戻り値**

条件がfalseの場合は`0`を返し、条件がtrueの場合は例外をスローします。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT throwIf(number = 3, 'Too many') FROM numbers(10);
```

```response title=レスポンス
↙ Progress: 0.00 rows, 0.00 B (0.00 rows/s., 0.00 B/s.) Received exception from server (version 19.14.1):
Code: 395. DB::Exception: Received from localhost:9000. DB::Exception: Too many.
```


## toColumnTypeName {#toColumnTypeName}

導入バージョン: v1.1

指定された値のデータ型の内部名を返します。
関数[`toTypeName`](#toTypeName)とは異なり、返されるデータ型には`Const`や`LowCardinality`などの内部ラッパーカラムが含まれる場合があります。

**構文**

```sql
toColumnTypeName(value)
```

**引数**

- `value` — 内部データ型を返す対象の値。[`Any`](/sql-reference/data-types)

**戻り値**

値を表現するために使用される内部データ型を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=クエリ
SELECT toColumnTypeName(CAST('2025-01-01 01:02:03' AS DateTime));
```

```response title=レスポンス
┌─toColumnTypeName(CAST('2025-01-01 01:02:03', 'DateTime'))─┐
│ Const(UInt32)                                             │
└───────────────────────────────────────────────────────────┘
```


## toTypeName {#toTypeName}

導入バージョン: v1.1

渡された引数の型名を返します。
`NULL`が渡された場合、この関数は`Nullable(Nothing)`型を返します。これはClickHouseの内部的な`NULL`表現に対応します。

**構文**

```sql
toTypeName(x)
```

**引数**

- `x` — 任意の型の値。[`Any`](/sql-reference/data-types)

**戻り値**

入力値のデータ型名を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT toTypeName(123)
```

```response title=Response
┌─toTypeName(123)─┐
│ UInt8           │
└─────────────────┘
```


## transactionID {#transactionID}

導入バージョン: v22.6

<ExperimentalBadge />
<CloudNotSupportedBadge />

トランザクションのIDを返します。

:::note
この関数は実験的機能セットの一部です。
[設定ファイル](/operations/configuration-files)に以下の設定を追加することで、実験的なトランザクションサポートを有効にできます:

```xml
<clickhouse>
    <allow_experimental_transactions>1</allow_experimental_transactions>
</clickhouse>
```

詳細については、[トランザクション(ACID)サポート](/guides/developer/transactional#transactions-commit-and-rollback)のページを参照してください。
:::

**構文**

```sql
transactionID()
```

**引数**

- なし

**戻り値**

`start_csn`、`local_tid`、`host_id`から構成されるタプルを返します。

- `start_csn`: グローバルシーケンス番号。このトランザクションが開始された時点で確認された最新のコミットタイムスタンプ。
- `local_tid`: ローカルシーケンス番号。特定のstart_csn内でこのホストによって開始された各トランザクションに対して一意。
- `host_id`: このトランザクションを開始したホストのUUID。
  [`Tuple(UInt64, UInt64, UUID)`](/sql-reference/data-types/tuple)

**例**

**使用例**

```sql title=クエリ
BEGIN TRANSACTION;
SELECT transactionID();
ROLLBACK;
```

```response title=レスポンス
┌─transactionID()────────────────────────────────┐
│ (32,34,'0ee8b069-f2bb-4748-9eae-069c85b5252b') │
└────────────────────────────────────────────────┘
```


## transactionLatestSnapshot {#transactionLatestSnapshot}

導入バージョン: v22.6

<ExperimentalBadge />
<CloudNotSupportedBadge />

読み取り可能な[トランザクション](/guides/developer/transactional#transactions-commit-and-rollback)の最新スナップショット（コミットシーケンス番号）を返します。

:::note
この関数は実験的機能セットの一部です。以下の設定を構成に追加することで、実験的トランザクションサポートを有効にできます：

```xml
<clickhouse>
    <allow_experimental_transactions>1</allow_experimental_transactions>
</clickhouse>
```

詳細については、[トランザクショナル（ACID）サポート](/guides/developer/transactional#transactions-commit-and-rollback)のページを参照してください。
:::

**構文**

```sql
transactionLatestSnapshot()
```

**引数**

- なし

**戻り値**

トランザクションの最新スナップショット（CSN）を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
BEGIN TRANSACTION;
SELECT transactionLatestSnapshot();
ROLLBACK;
```

```response title=Response
┌─transactionLatestSnapshot()─┐
│                          32 │
└─────────────────────────────┘
```


## transactionOldestSnapshot {#transactionOldestSnapshot}

導入バージョン: v22.6

<ExperimentalBadge />
<CloudNotSupportedBadge />

実行中の[トランザクション](/guides/developer/transactional#transactions-commit-and-rollback)から参照可能な最も古いスナップショット(コミットシーケンス番号)を返します。

:::note
この関数は実験的機能セットの一部です。設定ファイルに以下の項目を追加することで、実験的なトランザクションサポートを有効化できます:

```xml
<clickhouse>
    <allow_experimental_transactions>1</allow_experimental_transactions>
</clickhouse>
```

詳細については、[トランザクション(ACID)サポート](/guides/developer/transactional#transactions-commit-and-rollback)のページを参照してください。
:::

**構文**

```sql
transactionOldestSnapshot()
```

**引数**

- なし

**戻り値**

トランザクションの最も古いスナップショット(CSN)を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
BEGIN TRANSACTION;
SELECT transactionOldestSnapshot();
ROLLBACK;
```

```response title=レスポンス
┌─transactionOldestSnapshot()─┐
│                          32 │
└─────────────────────────────┘
```


## transform {#transform}

導入バージョン: v1.1

明示的に定義された要素間のマッピングに従って値を変換します。

この関数には2つのバリエーションがあります:

- `transform(x, array_from, array_to, default)` - マッピング配列を使用して `x` を変換し、一致しない要素にはデフォルト値を使用します
- `transform(x, array_from, array_to)` - 同じ変換を行いますが、一致が見つからない場合は元の `x` を返します

この関数は `array_from` 内で `x` を検索し、同じインデックス位置にある `array_to` の対応する要素を返します。
`x` が `array_from` 内に見つからない場合、`default` 値(4パラメータ版)または元の `x`(3パラメータ版)を返します。
`array_from` 内に複数の一致する要素が存在する場合、最初の一致に対応する要素を返します。

要件:

- `array_from` と `array_to` は同じ要素数である必要があります
- 4パラメータ版の場合: `transform(T, Array(T), Array(U), U) -> U` ここで `T` と `U` は互換性のある異なる型を使用できます
- 3パラメータ版の場合: `transform(T, Array(T), Array(T)) -> T` ここですべての型は同じである必要があります

**構文**

```sql
transform(x, array_from, array_to[, default])
```

**引数**

- `x` — 変換する値。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Decimal`](/sql-reference/data-types/decimal) または [`Float*`](/sql-reference/data-types/float) または [`String`](/sql-reference/data-types/string) または [`Date`](/sql-reference/data-types/date) または [`DateTime`](/sql-reference/data-types/datetime)
- `array_from` — 一致を検索する値の定数配列。[`Array((U)Int*)`](/sql-reference/data-types/array) または [`Array(Decimal)`](/sql-reference/data-types/array) または [`Array(Float*)`](/sql-reference/data-types/array) または [`Array(String)`](/sql-reference/data-types/array) または [`Array(Date)`](/sql-reference/data-types/array) または [`Array(DateTime)`](/sql-reference/data-types/array)
- `array_to` — `array_from` 内の対応する一致に対して返す値の定数配列。[`Array((U)Int*)`](/sql-reference/data-types/array) または [`Array(Decimal)`](/sql-reference/data-types/array) または [`Array(Float*)`](/sql-reference/data-types/array) または [`Array(String)`](/sql-reference/data-types/array) または [`Array(Date)`](/sql-reference/data-types/array) または [`Array(DateTime)`](/sql-reference/data-types/array)
- `default` — オプション。`x` が `array_from` 内に見つからない場合に返す値。省略した場合、x を変更せずに返します。[`(U)Int*`](/sql-reference/data-types/int-uint) または [`Decimal`](/sql-reference/data-types/decimal) または [`Float*`](/sql-reference/data-types/float) または [`String`](/sql-reference/data-types/string) または [`Date`](/sql-reference/data-types/date) または [`DateTime`](/sql-reference/data-types/datetime)

**戻り値**

x が `array_from` 内の要素と一致する場合、`array_to` から対応する値を返します。それ以外の場合、default(指定されている場合)または x(default が指定されていない場合)を返します。[`Any`](/sql-reference/data-types)

**例**

**transform(T, Array(T), Array(U), U) -> U**

```sql title=Query
SELECT
transform(SearchEngineID, [2, 3], ['Yandex', 'Google'], 'Other') AS title,
count() AS c
FROM test.hits
WHERE SearchEngineID != 0
GROUP BY title
ORDER BY c DESC
```

```response title=Response
┌─title─────┬──────c─┐
│ Yandex    │ 498635 │
│ Google    │ 229872 │
│ Other     │ 104472 │
└───────────┴────────┘
```

**transform(T, Array(T), Array(T)) -> T**

```sql title=Query
SELECT
transform(domain(Referer), ['yandex.ru', 'google.ru', 'vkontakte.ru'], ['www.yandex', 'example.com', 'vk.com']) AS s, count() AS c
FROM test.hits
GROUP BY domain(Referer)
ORDER BY count() DESC
LIMIT 10
```


```response title=Response
┌─s──────────────┬───────c─┐
│                │ 2906259 │
│ www.yandex     │  867767 │
│ ███████.ru     │  313599 │
│ mail.yandex.ru │  107147 │
│ ██████.ru      │  100355 │
│ █████████.ru   │   65040 │
│ news.yandex.ru │   64515 │
│ ██████.net     │   59141 │
│ example.com    │   57316 │
└────────────────┴─────────┘
```


## uniqThetaIntersect {#uniqThetaIntersect}

導入バージョン: v22.9

2つのuniqThetaSketchオブジェクトに対して積集合演算(集合演算 ∩)を実行し、結果として新しいuniqThetaSketchを返します。

**構文**

```sql
uniqThetaIntersect(uniqThetaSketch,uniqThetaSketch)
```

**引数**

- `uniqThetaSketch` — uniqThetaSketchオブジェクト。[`Tuple`](/sql-reference/data-types/tuple)、[`Array`](/sql-reference/data-types/array)、[`Date`](/sql-reference/data-types/date)、[`DateTime`](/sql-reference/data-types/datetime)、[`String`](/sql-reference/data-types/string)、[`(U)Int*`](/sql-reference/data-types/int-uint)、[`Float*`](/sql-reference/data-types/float)、または[`Decimal`](/sql-reference/data-types/decimal)

**返り値**

積集合の結果を含む新しいuniqThetaSketch。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT finalizeAggregation(uniqThetaIntersect(a, b)) AS a_intersect_b, finalizeAggregation(a) AS a_cardinality, finalizeAggregation(b) AS b_cardinality
FROM
(SELECT arrayReduce('uniqThetaState', [1, 2]) AS a, arrayReduce('uniqThetaState', [2, 3, 4]) AS b);
```

```response title=レスポンス
┌─a_intersect_b─┬─a_cardinality─┬─b_cardinality─┐
│             1 │             2 │             3 │
└───────────────┴───────────────┴───────────────┘
```


## uniqThetaNot {#uniqThetaNot}

導入バージョン: v22.9

2つのuniqThetaSketchオブジェクトに対してa_not_b計算（集合演算の差集合）を実行し、結果として新しいuniqThetaSketchを返します。

**構文**

```sql
uniqThetaNot(uniqThetaSketch,uniqThetaSketch)
```

**引数**

- `uniqThetaSketch` — uniqThetaSketchオブジェクト。[`Tuple`](/sql-reference/data-types/tuple)、[`Array`](/sql-reference/data-types/array)、[`Date`](/sql-reference/data-types/date)、[`DateTime`](/sql-reference/data-types/datetime)、[`String`](/sql-reference/data-types/string)、[`(U)Int*`](/sql-reference/data-types/int-uint)、[`Float*`](/sql-reference/data-types/float)、または[`Decimal`](/sql-reference/data-types/decimal)

**戻り値**

a_not_b結果を含む新しいuniqThetaSketchを返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT finalizeAggregation(uniqThetaNot(a, b)) AS a_not_b, finalizeAggregation(a) AS a_cardinality, finalizeAggregation(b) AS b_cardinality
FROM
(SELECT arrayReduce('uniqThetaState', [2, 3, 4]) AS a, arrayReduce('uniqThetaState', [1, 2]) AS b);
```

```response title=レスポンス
┌─a_not_b─┬─a_cardinality─┬─b_cardinality─┐
│       2 │             3 │             2 │
└─────────┴───────────────┴───────────────┘
```


## uniqThetaUnion {#uniqThetaUnion}

導入バージョン: v22.9

2つのuniqThetaSketchオブジェクトに対して和集合演算(集合演算 ∪)を実行し、結果として新しいuniqThetaSketchを返します。

**構文**

```sql
uniqThetaUnion(uniqThetaSketch,uniqThetaSketch)
```

**引数**

- `uniqThetaSketch` — uniqThetaSketchオブジェクト。[`Tuple`](/sql-reference/data-types/tuple)、[`Array`](/sql-reference/data-types/array)、[`Date`](/sql-reference/data-types/date)、[`DateTime`](/sql-reference/data-types/datetime)、[`String`](/sql-reference/data-types/string)、[`(U)Int*`](/sql-reference/data-types/int-uint)、[`Float*`](/sql-reference/data-types/float)、または[`Decimal`](/sql-reference/data-types/decimal)

**戻り値**

和集合の結果を含む新しいuniqThetaSketchを返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT finalizeAggregation(uniqThetaUnion(a, b)) AS a_union_b, finalizeAggregation(a) AS a_cardinality, finalizeAggregation(b) AS b_cardinality
FROM
(SELECT arrayReduce('uniqThetaState', [1, 2]) AS a, arrayReduce('uniqThetaState', [2, 3, 4]) AS b);
```

```response title=レスポンス
┌─a_union_b─┬─a_cardinality─┬─b_cardinality─┐
│         4 │             2 │             3 │
└───────────┴───────────────┴───────────────┘
```


## uptime {#uptime}

導入バージョン: v1.1

サーバーの稼働時間を秒単位で返します。
分散テーブルのコンテキストで実行された場合、この関数は各シャードに関連する値を持つ通常の列を生成します。
それ以外の場合は定数値を生成します。

**構文**

```sql
uptime()
```

**引数**

- なし

**戻り値**

サーバーの稼働時間を秒単位で返します。[`UInt32`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT uptime() AS Uptime
```

```response title=レスポンス
┌─Uptime─┐
│  55867 │
└────────┘
```


## variantElement {#variantElement}

導入バージョン: v25.2

`Variant`カラムから指定された型のカラムを抽出します。

**構文**

```sql
variantElement(variant, type_name[, default_value])
```

**引数**

- `variant` — Variantカラム。[`Variant`](/sql-reference/data-types/variant)
- `type_name` — 抽出するバリアント型の名前。[`String`](/sql-reference/data-types/string)
- `default_value` — 指定された型のバリアントが存在しない場合に使用されるデフォルト値。任意の型を指定可能。省略可能。[`Any`](/sql-reference/data-types)

**戻り値**

Variantカラムから抽出された指定されたバリアント型のカラムを返します。[`Any`](/sql-reference/data-types)

**例**

**使用例**

```sql title=クエリ
CREATE TABLE test (v Variant(UInt64, String, Array(UInt64))) ENGINE = Memory;
INSERT INTO test VALUES (NULL), (42), ('Hello, World!'), ([1, 2, 3]);
SELECT v, variantElement(v, 'String'), variantElement(v, 'UInt64'), variantElement(v, 'Array(UInt64)') FROM test;
```

```response title=レスポンス
┌─v─────────────┬─variantElement(v, 'String')─┬─variantElement(v, 'UInt64')─┬─variantElement(v, 'Array(UInt64)')─┐
│ ᴺᵁᴸᴸ          │ ᴺᵁᴸᴸ                        │                        ᴺᵁᴸᴸ │ []                                 │
│ 42            │ ᴺᵁᴸᴸ                        │                          42 │ []                                 │
│ Hello, World! │ Hello, World!               │                        ᴺᵁᴸᴸ │ []                                 │
│ [1,2,3]       │ ᴺᵁᴸᴸ                        │                        ᴺᵁᴸᴸ │ [1,2,3]                            │
└───────────────┴─────────────────────────────┴─────────────────────────────┴────────────────────────────────────┘
```


## variantType {#variantType}

導入バージョン: v24.2

`Variant`カラムの各行のバリアント型名を返します。行にNULLが含まれている場合は、'None'を返します。

**構文**

```sql
variantType(variant)
```

**引数**

- `variant` — Variantカラム。[`Variant`](/sql-reference/data-types/variant)

**戻り値**

各行のバリアント型名を持つEnumカラムを返します。[`Enum`](/sql-reference/data-types/enum)

**例**

**使用例**

```sql title=クエリ
CREATE TABLE test (v Variant(UInt64, String, Array(UInt64))) ENGINE = Memory;
INSERT INTO test VALUES (NULL), (42), ('Hello, World!'), ([1, 2, 3]);
SELECT variantType(v) FROM test;
```

```response title=レスポンス
┌─variantType(v)─┐
│ None           │
│ UInt64         │
│ String         │
│ Array(UInt64)  │
└────────────────┘
```


## version {#version}

導入バージョン: v1.1

ClickHouseの現在のバージョンを文字列として返します。形式は `major_version.minor_version.patch_version.number_of_commits_since_the_previous_stable_release` です。
分散テーブルのコンテキストで実行された場合、この関数は各シャードに関連する値を持つ通常のカラムを生成します。
それ以外の場合は、定数値を返します。

**構文**

```sql
version()
```

**引数**

- なし

**戻り値**

ClickHouseの現在のバージョンを返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=クエリ
SELECT version()
```

```response title=レスポンス
┌─version()─┐
│ 24.2.1.1  │
└───────────┘
```


## visibleWidth {#visibleWidth}

導入バージョン: v1.1

テキスト形式（タブ区切り）でコンソールに値を出力する際の概算幅を計算します。
この関数はシステムがPretty形式を実装するために使用されます。
`NULL`はPretty形式において`NULL`に対応する文字列として表現されます。

**構文**

```sql
visibleWidth(x)
```

**引数**

- `x` — 任意のデータ型の値。[`Any`](/sql-reference/data-types)

**戻り値**

テキスト形式で表示される際の値の概算幅を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**NULLの表示幅を計算**

```sql title=クエリ
SELECT visibleWidth(NULL)
```

```response title=レスポンス
┌─visibleWidth(NULL)─┐
│                  4 │
└────────────────────┘
```


## zookeeperSessionUptime {#zookeeperSessionUptime}

導入バージョン: v21.11

現在のZooKeeperセッションの稼働時間を秒単位で返します。

**構文**

```sql
zookeeperSessionUptime()
```

**引数**

- なし

**戻り値**

現在のZooKeeperセッションの稼働時間を秒単位で返します。[`UInt32`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT zookeeperSessionUptime();
```

```response title=レスポンス
┌─zookeeperSessionUptime()─┐
│                      286 │
└──────────────────────────┘
```

<!--AUTOGENERATED_END-->
