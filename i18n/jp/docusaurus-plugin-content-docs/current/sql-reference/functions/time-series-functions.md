---
description: '時系列データを扱う関数のドキュメント'
sidebar_label: 'TimeSeries'
slug: /sql-reference/functions/time-series-functions
title: '時系列データを扱う関数'
doc_type: 'reference'
---

# 時系列関数

以下の関数は、`timeSeries*()` 集約関数（例えば
[timeSeriesInstantRateToGrid](../aggregate-functions/reference/timeSeriesInstantRateToGrid.md)、
[timeSeriesLastToGrid](../aggregate-functions/reference/timeSeriesResampleToGridWithStaleness.md)
など）と併用することを想定して設計されています。

## timeSeriesRange

タイムスタンプの範囲を生成します。

**構文**

```sql
timeSeriesRange(start_timestamp, end_timestamp, step)
```

**引数**

* `start_timestamp` - 範囲の開始時刻。
* `end_timestamp` - 範囲の終了時刻。
* `step` - 範囲のステップ幅（秒単位）。

**戻り値**

* タイムスタンプの範囲 `[start_timestamp, start_timestamp + step, start_timestamp + 2 * step, ..., end_timestamp]` を返します。

**例**

クエリ:

```sql
SELECT timeSeriesRange('2025-06-01 00:00:00'::DateTime64(3), '2025-06-01 00:01:00'::DateTime64(3), 30) AS rng;
```

結果:

```text
┌────────────────────────────────────result─────────────────────────────────────────┐
│ ['2025-06-01 00:00:00.000', '2025-06-01 00:00:30.000', '2025-06-01 00:01:00.000'] │
└───────────────────────────────────────────────────────────────────────────────────┘
```

**注記**

* 関数 `timeSeriesRange()` が `start_timestamp` と `end_timestamp` が等しい状態で呼び出された場合、
  そのタイムスタンプのみを要素とする 1 要素の配列 `[start_timestamp]` を返します。
* 関数 `timeSeriesRange()` は関数 [range](../functions/array-functions.md#range) と類似しています。
  例えば、タイムスタンプの型が `DateTime64(3)` で、かつ `start_timestamp < end_timestamp` の場合、
  `timeSeriesRange(start_timestamp, end_timestamp, step)` は次の式と同じ結果を返します。

```sql
range(start_timestamp::Int64, end_timestamp::Int64 + 1, step::Int64)::Array(DateTime64(3))
```


## timeSeriesFromGrid

配列 `[value1, value2, value3, ..., valueN]` を、タプルの配列
`[(start_timestamp, value1), (start_timestamp + step, value2), (start_timestamp + 2 * step, value3), ..., (end_timestamp, valueN)]` に変換します。

値 `[value1, value2, value3, ...]` の一部が `NULL` の場合、関数はその NULL 値を結果配列にはコピーしませんが、
現在のタイムスタンプは進めます。例えば `[value1, NULL, value2]` に対しては、
`[(start_timestamp, value1), (start_timestamp + 2 * step, value2)]` を返します。

現在のタイムスタンプは end&#95;timestamp を超えるまで step ずつ増加し、各タイムスタンプは指定された値配列の要素と組み合わされます。
値の個数がタイムスタンプの個数と一致しない場合、関数は例外をスローします。

**構文**

```sql
timeSeriesFromGrid(start_timestamp, end_timestamp, step, values);
```

**引数**

* `start_timestamp` - グリッドの開始時刻。
* `end_timestamp` - グリッドの終了時刻。
* `step` - グリッドのステップ（秒単位）。
* `values` - 値の配列 `[value1, value2, ..., valueN]`。

**戻り値**

* `start_timestamp` と `step` で定義される等間隔の時間グリッド上で、タイムスタンプと組み合わせた元の値配列の値を返します。

**例**

クエリ:

```sql
SELECT timeSeriesFromGrid('2025-06-01 00:00:00'::DateTime64(3), '2025-06-01 00:01:30.000'::DateTime64(3), 30, [10, 20, NULL, 30]) AS result;
```

結果：

```text
┌─────────────────────────────────────────────result─────────────────────────────────────────────┐
│ [('2025-06-01 00:00:00.000',10),('2025-06-01 00:00:30.000',20),('2025-06-01 00:01:30.000',30)] │
└────────────────────────────────────────────────────────────────────────────────────────────────┘
```

**注記**
関数 `timeSeriesFromGrid(start_timestamp, end_timestamp, step, values)` は、次の式と同じ結果を返します。

```sql
arrayFilter(x -> x.2 IS NOT NULL, arrayZip(timeSeriesRange(start_timestamp, end_timestamp, step), values))
```

{/* 
  以下のタグ内の内容は、ドキュメントフレームワークのビルド時に、
  system.functions から生成されたドキュメントに置き換えられます。
  タグを変更したり削除したりしないでください。
  詳細は https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md を参照してください。
  */ }

{/*AUTOGENERATED_START*/ }

{/*AUTOGENERATED_END*/ }
