---
description: '財務関数のドキュメント'
sidebar_label: '財務'
slug: /sql-reference/functions/financial-functions
title: '財務関数'
keywords: ['財務', '利回り', '正味現在価値']
doc_type: 'reference'
---

# 財務関数 \\{#financial-functions\\}

:::note
以下のドキュメントは、`system.functions` システムテーブルを元に自動生成されています。
:::

{/* 
  以下のタグ内の内容は、ドキュメントフレームワークのビルド時に
  system.functions から自動生成されたドキュメントに置き換えられます。タグを変更または削除しないでください。
  詳細は https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md を参照してください。
  */ }

{/*AUTOGENERATED_START*/ }

## financialInternalRateOfReturn \\{#financialInternalRateOfReturn\\}

導入バージョン: v25.7

一定間隔で発生する一連のキャッシュフローの内部収益率 (IRR) を計算します。
IRR は、正味現在価値 (NPV) がゼロとなる割引率です。

IRR は次の方程式を満たす割引率として求められます:

$$
\sum&#95;{i=0}^n \frac{cashflow_i}{(1 + irr)^i} = 0
$$

**構文**

```sql
financialInternalRateOfReturn(cashflows[, guess])
```

**引数**

* `cashflows` — キャッシュフローの配列。各値は支払い（負の値）または収入（正の値）を表します。[`Array(Int8/16/32/64)`](/sql-reference/data-types/array) または [`Array(Float*)`](/sql-reference/data-types/array)
* `[, guess]` — 内部収益率の初期推定値（定数値、既定値は 0.1）。省略可能な引数です。[`Float*`](/sql-reference/data-types/float)

**返り値**

内部収益率を返します。計算が収束しない場合、入力配列が空または要素が 1 つだけの場合、すべてのキャッシュフローが 0 の場合、またはその他の計算エラーが発生した場合は `NaN` を返します。[`Float64`](/sql-reference/data-types/float)

**例**

**simple&#95;example**

```sql title=Query
SELECT financialInternalRateOfReturn([-100, 39, 59, 55, 20])
```

```response title=Response
0.2809484211599611
```

**simple&#95;example&#95;with&#95;guess**

```sql title=Query
SELECT financialInternalRateOfReturn([-100, 39, 59, 55, 20], 0.1)
```

```response title=Response
0.2809484211599611
```

## financialInternalRateOfReturnExtended \\{#financialInternalRateOfReturnExtended\\}

導入バージョン: v25.7

不規則な間隔で発生する一連のキャッシュフローに対して拡張内部収益率（XIRR）を計算します。XIRRは、すべてのキャッシュフローの正味現在価値（NPV）がゼロになる割引率です。

XIRRは以下の方程式を解きます（`ACT_365F`の例）：

$$
\sum_{i=0}^n \frac{cashflow_i}{(1 + rate)^{(date_i - date_0)/365}} = 0
$$

配列は日付の昇順でソートされている必要があります。日付は一意である必要があります。

**構文**

```sql
financialInternalRateOfReturnExtended(cashflow, date [, guess, daycount])
```

**引数**

- `cashflow` — 第2パラメータの日付に対応するキャッシュフローの配列。[`Array(Int8/16/32/64)`](/sql-reference/data-types/array)または[`Array(Float*)`](/sql-reference/data-types/array)
- `date` — キャッシュフローに対応する一意の日付のソート済み配列。[`Array(Date)`](/sql-reference/data-types/array)または[`Array(Date32)`](/sql-reference/data-types/array)
- `[, guess]` — オプション。XIRR計算の初期推定値（定数値）。[`Float*`](/sql-reference/data-types/float)
- `[, daycount]` —
  オプション。日数計算規則（デフォルトは'ACT_365F'）。サポートされる値：
- 'ACT_365F' - Actual/365 Fixed：日付間の実際の日数を365で除算
- 'ACT_365_25' - Actual/365.25：日付間の実際の日数を365.25で除算
  [`String`](/sql-reference/data-types/string)

**返り値**

XIRR値を返します。計算を実行できない場合はNaNを返します。[`Float64`](/sql-reference/data-types/float)

**例**

**基本的な例**

```sql title=Query
SELECT financialInternalRateOfReturnExtended([-10000, 5750, 4250, 3250], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')])
```

```response title=Response
0.6342972615260243
```

**推定値を指定した例**

```sql title=Query
SELECT financialInternalRateOfReturnExtended([-10000, 5750, 4250, 3250], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')], 0.5)
```

```response title=Response
0.6342972615260243
```

**日数計算規則を指定した例**

```sql title=Query
SELECT round(financialInternalRateOfReturnExtended([100000, -110000], [toDate('2020-01-01'), toDate('2021-01-01')], 0.1, 'ACT_365_25'), 6) AS xirr_365_25
```

```response title=Response
0.099785
```

## financialNetPresentValue \\{#financialNetPresentValue\\}

導入バージョン: v25.7

等間隔で発生するキャッシュフロー系列の正味現在価値（NPV: Net Present Value）を計算します。

デフォルトのバリアント（`start_from_zero` = true）の場合:

$$
\sum&#95;{i=0}^{N-1} \frac{values_i}{(1 + rate)^i}
$$

Excel互換のバリアント（`start_from_zero` = false）の場合:

$$
\sum&#95;{i=1}^{N} \frac{values_i}{(1 + rate)^i}
$$

**構文**

```sql
financialNetPresentValue(rate, cashflows[, start_from_zero])
```

**引数**

* `rate` — 適用する割引率。[`Float*`](/sql-reference/data-types/float)
* `cashflows` — キャッシュフローの配列。各値は支払い（負の値）または収入（正の値）を表します。[`Array(Int8/16/32/64)`](/sql-reference/data-types/array) または [`Array(Float*)`](/sql-reference/data-types/array)
* `[, start_from_zero]` — NPV を期間 `0`（true）から計算するか、期間 `1`（false、Excel 互換）から計算するかを示すオプションのブール値型パラメータ。デフォルト: true。[`Bool`](/sql-reference/data-types/boolean)

**戻り値**

正味現在価値 (NPV) を Float64 値として返します。[`Float64`](/sql-reference/data-types/float)

**例**

**default&#95;calculation**

```sql title=Query
SELECT financialNetPresentValue(0.08, [-40000., 5000., 8000., 12000., 30000.])
```

```response title=Response
3065.2226681795255
```

**excel&#95;compatible&#95;calculation**

```sql title=Query
SELECT financialNetPresentValue(0.08, [-40000., 5000., 8000., 12000., 30000.], false)
```

```response title=Response
2838.1691372032656
```

## financialNetPresentValueExtended \\{#financialNetPresentValueExtended\\}

導入バージョン: v25.7

不規則な間隔で発生する一連のキャッシュフローに対して拡張正味現在価値（XNPV）を計算します。XNPVは現在価値を計算する際に各キャッシュフローの具体的なタイミングを考慮します。

`ACT_365F`のXNPV計算式:

$$
XNPV=\sum_{i=1}^n \frac{cashflow_i}{(1 + rate)^{(date_i - date_0)/365}}
$$

配列は日付の昇順でソートする必要があります。日付は一意である必要があります。

**構文**

```sql
financialNetPresentValueExtended(rate, cashflows, dates[, daycount])
```

**引数**

- `rate` — 適用する割引率。[`Float*`](/sql-reference/data-types/float)
- `cashflows` — キャッシュフローの配列。各値は支払い（負の値）または収入（正の値）を表します。少なくとも1つの正の値と1つの負の値を含む必要があります。[`Array(Int8/16/32/64)`](/sql-reference/data-types/array)または[`Array(Float*)`](/sql-reference/data-types/array)
- `dates` — 各キャッシュフローに対応する日付の配列。cashflows配列と同じサイズである必要があります。[`Array(Date)`](/sql-reference/data-types/array)または[`Array(Date32)`](/sql-reference/data-types/array)
- `[, daycount]` — オプションの日数計算規則。サポートされる値: `'ACT_365F'`（デフォルト）— Actual/365 Fixed、`'ACT_365_25'` — Actual/365.25。[`String`](/sql-reference/data-types/string)

**戻り値**

正味現在価値をFloat64値として返します。[`Float64`](/sql-reference/data-types/float)

**例**

**基本的な使用方法**

```sql title=クエリ
SELECT financialNetPresentValueExtended(0.1, [-10000., 5750., 4250., 3250.], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')])
```

```response title=レスポンス
2506.579458169746
```

**異なる日数計算規則の使用**

```sql title=クエリ
SELECT financialNetPresentValueExtended(0.1, [-10000., 5750., 4250., 3250.], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')], 'ACT_365_25')
```

```response title=レスポンス
2507.067268742502
```

<!--AUTOGENERATED_END-->

## 関連リソース \\{#related-resources\\}

- [ClickHouse の財務関数を解説した動画](https://www.youtube.com/watch?v=BePLPVa0w_o)
