---
description: '財務関数のドキュメント'
sidebar_label: '財務'
slug: /sql-reference/functions/financial-functions
title: '財務関数'
keywords: ['財務', '利回り', '正味現在価値']
doc_type: 'reference'
---

# 財務関数 {#financial-functions}

:::note
以下のドキュメントは、`system.functions` システムテーブルを元に自動生成されています。
:::

{/* 
  以下のタグ内の内容は、ドキュメントフレームワークのビルド時に
  system.functions から自動生成されたドキュメントに置き換えられます。タグを変更または削除しないでください。
  詳細は https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md を参照してください。
  */ }

{/*AUTOGENERATED_START*/ }

## financialInternalRateOfReturn {#financialInternalRateOfReturn}

導入バージョン: v25.7

一定間隔で発生する一連のキャッシュフローの内部収益率 (IRR) を計算します。
IRR は、正味現在価値 (NPV) がゼロとなる割引率です。

IRR は次の方程式を満たす割引率として求められます:

$$
\sum&#95;{i=0}^n \frac{cashflow_i}{(1 + irr)^i} = 0
$$

**構文**

```sql
financialInternalRateOfReturn(cashflows[, guess])
```

**引数**

* `cashflows` — キャッシュフローの配列。各値は支払い（負の値）または収入（正の値）を表します。[`Array(Int8/16/32/64)`](/sql-reference/data-types/array) または [`Array(Float*)`](/sql-reference/data-types/array)
* `[, guess]` — 内部収益率の初期推定値（定数値、既定値は 0.1）。省略可能な引数です。[`Float*`](/sql-reference/data-types/float)

**返り値**

内部収益率を返します。計算が収束しない場合、入力配列が空または要素が 1 つだけの場合、すべてのキャッシュフローが 0 の場合、またはその他の計算エラーが発生した場合は `NaN` を返します。[`Float64`](/sql-reference/data-types/float)

**例**

**simple&#95;example**

```sql title=Query
SELECT financialInternalRateOfReturn([-100, 39, 59, 55, 20])
```

```response title=Response
0.2809484211599611
```

**simple_example_with_guess**

```sql title=Query
SELECT financialInternalRateOfReturn([-100, 39, 59, 55, 20], 0.1)
```

```response title=Response
0.2809484211599611
```



## financialInternalRateOfReturnExtended {#financialInternalRateOfReturnExtended}

Introduced in: v25.7


Calculates the Extended Internal Rate of Return (XIRR) for a series of cash flows occurring at irregular intervals. XIRR is the discount rate at which the net present value (NPV) of all cash flows equals zero.

XIRR attempts to solve the following equation (example for `ACT_365F`):

$$
\sum_{i=0}^n \frac{cashflow_i}{(1 + rate)^{(date_i - date_0)/365}} = 0
$$

Arrays should be sorted by date in ascending order. Dates need to be unique.
    

**Syntax**

```sql
financialInternalRateOfReturnExtended(cashflow, date [, guess, daycount])
```

**Arguments**

- `cashflow` — An array of cash flows corresponding to the dates in second param. [`Array(Int8/16/32/64)`](/sql-reference/data-types/array) or [`Array(Float*)`](/sql-reference/data-types/array)
- `date` — A sorted array of unique dates corresponding to the cash flows. [`Array(Date)`](/sql-reference/data-types/array) or [`Array(Date32)`](/sql-reference/data-types/array)
- `[, guess]` — Optional. Initial guess (constant value) for the XIRR calculation. [`Float*`](/sql-reference/data-types/float)
- `[, daycount]` — 
Optional day count convention (default 'ACT_365F'). Supported values:
- 'ACT_365F' - Actual/365 Fixed: Uses actual number of days between dates divided by 365
- 'ACT_365_25' - Actual/365.25: Uses actual number of days between dates divided by 365.25
             [`String`](/sql-reference/data-types/string)


**Returned value**

Returns the XIRR value. If the calculation cannot be performed, it returns NaN. [`Float64`](/sql-reference/data-types/float)

**Examples**

**simple_example**

```sql title=Query
SELECT financialInternalRateOfReturnExtended([-10000, 5750, 4250, 3250], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')])
```

```response title=Response
0.6342972615260243
```

**simple_example_with_guess**

```sql title=Query
SELECT financialInternalRateOfReturnExtended([-10000, 5750, 4250, 3250], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')], 0.5)
```

```response title=Response
0.6342972615260243
```

**simple_example_daycount**

```sql title=Query
SELECT round(financialInternalRateOfReturnExtended([100000, -110000], [toDate('2020-01-01'), toDate('2021-01-01')], 0.1, 'ACT_365_25'), 6) AS xirr_365_25
```

```response title=Response
0.099785
```



## financialNetPresentValue {#financialNetPresentValue}

Introduced in: v25.7


Calculates the Net Present Value (NPV) of a series of cash flows assuming equal time intervals between each cash flow.

Default variant (`start_from_zero` = true):

$$
\sum_{i=0}^{N-1} \frac{values_i}{(1 + rate)^i}
$$

Excel-compatible variant (`start_from_zero` = false):

$$
\sum_{i=1}^{N} \frac{values_i}{(1 + rate)^i}
$$
    

**Syntax**

```sql
financialNetPresentValue(rate, cashflows[, start_from_zero])
```

**Arguments**

- `rate` — The discount rate to apply. [`Float*`](/sql-reference/data-types/float)
- `cashflows` — Array of cash flows. Each value represents a payment (negative value) or income (positive value). [`Array(Int8/16/32/64)`](/sql-reference/data-types/array) or [`Array(Float*)`](/sql-reference/data-types/array)
- `[, start_from_zero]` — Optional boolean parameter indicating whether to start the NPV calculation from period `0` (true) or period `1` (false, Excel-compatible). Default: true. [`Bool`](/sql-reference/data-types/boolean)


**Returned value**

Returns the net present value as a Float64 value. [`Float64`](/sql-reference/data-types/float)

**Examples**

**default_calculation**

```sql title=Query
SELECT financialNetPresentValue(0.08, [-40000., 5000., 8000., 12000., 30000.])
```

```response title=Response
3065.2226681795255
```

**excel_compatible_calculation**

```sql title=Query
SELECT financialNetPresentValue(0.08, [-40000., 5000., 8000., 12000., 30000.], false)
```

```response title=Response
2838.1691372032656
```



## financialNetPresentValueExtended {#financialNetPresentValueExtended}

Introduced in: v25.7


Calculates the Extended Net Present Value (XNPV) for a series of cash flows occurring at irregular intervals. XNPV considers the specific timing of each cash flow when calculating present value.

XNPV equation for `ACT_365F`:

$$
XNPV=\sum_{i=1}^n \frac{cashflow_i}{(1 + rate)^{(date_i - date_0)/365}}
$$

Arrays should be sorted by date in ascending order. Dates need to be unique.
    

**Syntax**

```sql
financialNetPresentValueExtended(rate, cashflows, dates[, daycount])
```

**Arguments**

- `rate` — The discount rate to apply. [`Float*`](/sql-reference/data-types/float)
- `cashflows` — Array of cash flows. Each value represents a payment (negative value) or income (positive value). Must contain at least one positive and one negative value. [`Array(Int8/16/32/64)`](/sql-reference/data-types/array) or [`Array(Float*)`](/sql-reference/data-types/array)
- `dates` — Array of dates corresponding to each cash flow. Must have the same size as cashflows array. [`Array(Date)`](/sql-reference/data-types/array) or [`Array(Date32)`](/sql-reference/data-types/array)
- `[, daycount]` — Optional day count convention. Supported values: `'ACT_365F'` (default) — Actual/365 Fixed, `'ACT_365_25'` — Actual/365.25. [`String`](/sql-reference/data-types/string)


**Returned value**

Returns the net present value as a Float64 value. [`Float64`](/sql-reference/data-types/float)

**Examples**

**Basic usage**

```sql title=クエリ
SELECT financialNetPresentValueExtended(0.1, [-10000., 5750., 4250., 3250.], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')])
```

```response title=レスポンス
2506.579458169746
```

**Using different day count convention**

```sql title=クエリ
SELECT financialNetPresentValueExtended(0.1, [-10000., 5750., 4250., 3250.], [toDate('2020-01-01'), toDate('2020-03-01'), toDate('2020-10-30'), toDate('2021-02-15')], 'ACT_365_25')
```

```response title=レスポンス
2507.067268742502
```

<!--AUTOGENERATED_END-->

## 関連リソース {#related-resources}

- [ClickHouse の財務関数を解説した動画](https://www.youtube.com/watch?v=BePLPVa0w_o)
