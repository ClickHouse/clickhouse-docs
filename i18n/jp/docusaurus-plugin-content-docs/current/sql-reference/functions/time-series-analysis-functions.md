---
'description': 'Functions for Time-Series Analysisに関するドキュメント'
'sidebar_label': '時系列分析'
'slug': '/sql-reference/functions/time-series-analysis-functions'
'title': '時系列分析のための関数'
'doc_type': 'reference'
---


# 時系列分析のための関数

以下の関数は、系列データ分析に使用されます。

## seriesOutliersDetectTukey {#seriesoutliersdetecttukey}

[Tukey Fences](https://en.wikipedia.org/wiki/Outlier#Tukey%27s_fences)を使用して、系列データ内の外れ値を検出します。

**構文**

```sql
seriesOutliersDetectTukey(series);
seriesOutliersDetectTukey(series, min_percentile, max_percentile, K);
```

**引数**

- `series` - 数値の配列。
- `min_percentile` - 四分位範囲 [(IQR)](https://en.wikipedia.org/wiki/Interquartile_range) を計算するために使用される最小パーセンタイル。値は [0.02,0.98] の範囲内である必要があります。デフォルトは0.25です。
- `max_percentile` - 四分位範囲（IQR）を計算するために使用される最大パーセンタイル。値は [0.02,0.98] の範囲内である必要があります。デフォルトは0.75です。
- `K` - 軽度または強い外れ値を検出するための非負の定数値。デフォルト値は1.5です。

外れ値を検出するには、`series`内に少なくとも4つのデータポイントが必要です。

**返される値**

- 入力配列と同じ長さの配列を返します。各値は系列の対応する要素の異常スコアを表します。ゼロ以外のスコアは、可能な異常を示します。[Array](../data-types/array.md)。

**例**

クエリ:

```sql
SELECT seriesOutliersDetectTukey([-3, 2, 15, 3, 5, 6, 4, 5, 12, 45, 12, 3, 3, 4, 5, 6]) AS print_0;
```

結果:

```text
┌───────────print_0─────────────────┐
│[0,0,0,0,0,0,0,0,0,27,0,0,0,0,0,0] │
└───────────────────────────────────┘
```

クエリ:

```sql
SELECT seriesOutliersDetectTukey([-3, 2, 15, 3, 5, 6, 4.50, 5, 12, 45, 12, 3.40, 3, 4, 5, 6], 0.2, 0.8, 1.5) AS print_0;
```

結果:

```text
┌─print_0──────────────────────────────┐
│ [0,0,0,0,0,0,0,0,0,19.5,0,0,0,0,0,0] │
└──────────────────────────────────────┘
```

## seriesPeriodDetectFFT {#seriesperioddetectfft}

FFT - [高速フーリエ変換](https://en.wikipedia.org/wiki/Fast_Fourier_transform) を使用して、与えられた系列データの周期を見つけます。

**構文**

```sql
seriesPeriodDetectFFT(series);
```

**引数**

- `series` - 数値の配列

**返される値**

- 系列データの周期に等しい実数値。データポイントの数が4未満の場合はNaN。[Float64](../data-types/float.md)。

**例**

クエリ:

```sql
SELECT seriesPeriodDetectFFT([1, 4, 6, 1, 4, 6, 1, 4, 6, 1, 4, 6, 1, 4, 6, 1, 4, 6, 1, 4, 6]) AS print_0;
```

結果:

```text
┌───────────print_0──────┐
│                      3 │
└────────────────────────┘
```

```sql
SELECT seriesPeriodDetectFFT(arrayMap(x -> abs((x % 6) - 3), range(1000))) AS print_0;
```

結果:

```text
┌─print_0─┐
│       6 │
└─────────┘
```

## seriesDecomposeSTL {#seriesdecomposestl}

STL [(Loessに基づく季節的トレンド分解手順)](https://www.wessa.net/download/stl.pdf) を使用して、系列データを季節成分、トレンド、および残差成分に分解します。

**構文**

```sql
seriesDecomposeSTL(series, period);
```

**引数**

- `series` - 数値の配列
- `period` - 正の整数

`series`内のデータポイント数は、`period`の値の2倍以上である必要があります。

**返される値**

- 四つの配列からなる配列を返します。最初の配列は季節成分、2番目の配列はトレンド、3番目の配列は残差成分、4番目の配列は基準（季節 + トレンド）成分です。[Array](../data-types/array.md)。

**例**

クエリ:

```sql
SELECT seriesDecomposeSTL([10.1, 20.45, 40.34, 10.1, 20.45, 40.34, 10.1, 20.45, 40.34, 10.1, 20.45, 40.34, 10.1, 20.45, 40.34, 10.1, 20.45, 40.34, 10.1, 20.45, 40.34, 10.1, 20.45, 40.34], 3) AS print_0;
```

結果:

```text
┌───────────print_0──────────────────────────────────────────────────────────────────────────────────────────────────────┐
│ [[
        -13.529999, -3.1799996, 16.71,      -13.53,     -3.1799996, 16.71,      -13.53,     -3.1799996,
        16.71,      -13.530001, -3.18,      16.710001,  -13.530001, -3.1800003, 16.710001,  -13.530001,
        -3.1800003, 16.710001,  -13.530001, -3.1799994, 16.71,      -13.529999, -3.1799994, 16.709997
    ],
    [
        23.63,     23.63,     23.630003, 23.630001, 23.630001, 23.630001, 23.630001, 23.630001,
        23.630001, 23.630001, 23.630001, 23.63,     23.630001, 23.630001, 23.63,     23.630001,
        23.630001, 23.63,     23.630001, 23.630001, 23.630001, 23.630001, 23.630001, 23.630003
    ],
    [
        0, 0.0000019073486, -0.0000019073486, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, -0.0000019073486, 0,
        0
    ],
    [
        10.1, 20.449999, 40.340004, 10.100001, 20.45, 40.34, 10.100001, 20.45, 40.34, 10.1, 20.45, 40.34,
        10.1, 20.45, 40.34, 10.1, 20.45, 40.34, 10.1, 20.45, 40.34, 10.100002, 20.45, 40.34
    ]]                                                                                                                   │
└────────────────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

<!-- 
The inner content of the tags below are replaced at doc framework build time with 
docs generated from system.functions. Please do not modify or remove the tags.
See: https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
-->

<!--AUTOGENERATED_START-->
<!--AUTOGENERATED_END-->
