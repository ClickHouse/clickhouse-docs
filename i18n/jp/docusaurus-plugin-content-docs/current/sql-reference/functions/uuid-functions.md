---
description: 'UUID を扱う関数のドキュメント'
sidebar_label: 'UUID 関数'
slug: /sql-reference/functions/uuid-functions
title: 'UUID を扱う関数'
doc_type: 'reference'
---

import DeprecatedBadge from '@theme/badges/DeprecatedBadge';

# UUID を操作する関数 {#functions-for-working-with-uuids}

## UUIDv7 の生成 {#uuidv7-generation}

生成される UUID は、Unix エポックミリ秒の 48 ビットのタイムスタンプに続いて、バージョン「7」（4 ビット）、1 ミリ秒内で UUID を区別するためのカウンタ（バリアントフィールド「2」（2 ビット）を含む 42 ビット）、およびランダムフィールド（32 ビット）で構成されます。
任意のタイムスタンプ（`unix_ts_ms`）に対して、カウンタはランダムな値から開始し、タイムスタンプが変化するまで、新しい UUID が生成されるたびに 1 ずつ増加します。カウンタがオーバーフローした場合は、タイムスタンプフィールドが 1 増加し、カウンタは新しいランダムな開始値にリセットされます。
UUID 生成関数は、同時に実行されているスレッドおよびクエリにおけるすべての関数呼び出しにわたって、同一タイムスタンプ内のカウンタフィールドが単調に増加することを保証します。

```text
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤
|                           unix_ts_ms                          |
├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤
|          unix_ts_ms           |  ver  |   counter_high_bits   |
├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤
|var|                   counter_low_bits                        |
├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤
|                            rand_b                             |
└─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┘
```

## Snowflake ID の生成 {#snowflake-id-generation}

生成される Snowflake ID には、現在の Unix タイムスタンプ（ミリ秒単位、41 ビット + 先頭のゼロ 1 ビット）、それに続くマシン ID（10 ビット）、および同一ミリ秒内で ID を区別するためのカウンタ（12 ビット）が含まれます。任意のタイムスタンプ（`unix_ts_ms`）に対して、カウンタは 0 から開始し、新しい Snowflake ID が生成されるたびに 1 ずつインクリメントされ、タイムスタンプが変わるまで続きます。カウンタがオーバーフローした場合、タイムスタンプフィールドが 1 増加し、カウンタは 0 にリセットされます。

:::note
生成される Snowflake ID は UNIX エポック 1970-01-01 を基準としています。Snowflake ID のエポックについて標準化された規格や推奨値は存在せず、他のシステムでの実装では異なるエポックを使用している場合があります（例: Twitter/X は 2010-11-04、Mastodon は 2015-01-01）。
:::

```text
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
├─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤
|0|                         timestamp                           |
├─┼                 ┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┼─┤
|                   |     machine_id    |    machine_seq_num    |
└─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┴─┘
```

{/*
  以下のタグ内の内容は、ドキュメントフレームワークのビルド時に
  system.functions から生成されたドキュメントに置き換えられます。タグは変更したり削除したりしないでください。
  詳細は https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md を参照してください。
  */ }

{/*AUTOGENERATED_START*/ }


## UUIDNumToString {#UUIDNumToString}

導入バージョン: v1.1

UUID のバイナリ表現を受け取り、その形式をオプション引数 `variant`（既定値は `Big-endian`）で指定し、テキスト形式の 36 文字からなる文字列を返します。

**構文**

```sql
UUIDNumToString(binary[, variant])
```

**引数**

* `binary` — UUID のバイナリ表現。[`FixedString(16)`](/sql-reference/data-types/fixedstring)
* `variant` — [RFC4122](https://datatracker.ietf.org/doc/html/rfc4122#section-4.1.1) で規定されているバリアント。1 = `Big-endian` (デフォルト)、2 = `Microsoft`。[`(U)Int*`](/sql-reference/data-types/int-uint)

**戻り値**

UUID を文字列表現として返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT
    'a/<@];!~p{jTj={)' AS bytes,
    UUIDNumToString(toFixedString(bytes, 16)) AS uuid
```

```response title=Response
┌─bytes────────────┬─uuid─────────────────────────────────┐
│ a/<@];!~p{jTj={) │ 612f3c40-5d3b-217e-707b-6a546a3d7b29 │
└──────────────────┴──────────────────────────────────────┘
```

**Microsoft 形式**

```sql title=Query
SELECT
    '@</a;]~!p{jTj={)' AS bytes,
    UUIDNumToString(toFixedString(bytes, 16), 2) AS uuid
```

```response title=Response
┌─bytes────────────┬─uuid─────────────────────────────────┐
│ @</a;]~!p{jTj={) │ 612f3c40-5d3b-217e-707b-6a546a3d7b29 │
└──────────────────┴──────────────────────────────────────┘
```


## UUIDStringToNum {#UUIDStringToNum}

導入: v1.1

`xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx` という形式の 36 文字の文字列を受け取り、そのバイナリ表現として [FixedString(16)](../data-types/fixedstring.md) を返します。フォーマットはオプションで `variant` で指定でき、デフォルトは `Big-endian` です。

**構文**

```sql
UUIDStringToNum(string[, variant = 1])
```

**引数**

* `string` — 36 文字の文字列または固定長文字列。[`String`](/sql-reference/data-types/string) または [`FixedString(36)`](/sql-reference/data-types/fixedstring)
* `variant` — [RFC4122](https://datatracker.ietf.org/doc/html/rfc4122#section-4.1.1) で定義されるバリアント。1 = `Big-endian` (デフォルト)、2 = `Microsoft`。[`(U)Int*`](/sql-reference/data-types/int-uint)

**返り値**

`string` のバイナリ表現を返します。[`FixedString(16)`](/sql-reference/data-types/fixedstring)

**例**

**使用例**

```sql title=Query
SELECT
    '612f3c40-5d3b-217e-707b-6a546a3d7b29' AS uuid,
    UUIDStringToNum(uuid) AS bytes
```

```response title=Response
┌─uuid─────────────────────────────────┬─bytes────────────┐
│ 612f3c40-5d3b-217e-707b-6a546a3d7b29 │ a/<@];!~p{jTj={) │
└──────────────────────────────────────┴──────────────────┘
```

**Microsoft バリアント**

```sql title=Query
SELECT
    '612f3c40-5d3b-217e-707b-6a546a3d7b29' AS uuid,
    UUIDStringToNum(uuid, 2) AS bytes
```

```response title=Response
┌─uuid─────────────────────────────────┬─bytes────────────┐
│ 612f3c40-5d3b-217e-707b-6a546a3d7b29 │ @</a;]~!p{jTj={) │
└──────────────────────────────────────┴──────────────────┘
```


## UUIDToNum {#UUIDToNum}

導入バージョン: v24.5

[UUID](../data-types/uuid.md) を受け取り、そのバイナリ表現を [FixedString(16)](../data-types/fixedstring.md) 型として返します。フォーマットはオプションの `variant` で指定でき、デフォルトは `Big-endian` です。
この関数は、`UUIDStringToNum(toString(uuid))` という 2 つの関数呼び出しの組み合わせを置き換えるものであり、UUID からバイト列を取り出す際に中間の文字列変換が不要になります。

**構文**

```sql
UUIDToNum(uuid[, variant = 1])
```

**引数**

* `uuid` — UUID。[`String`](/sql-reference/data-types/string) または [`FixedString`](/sql-reference/data-types/fixedstring)
* `variant` — [RFC4122](https://datatracker.ietf.org/doc/html/rfc4122#section-4.1.1) で規定されているバリアント。1 = `Big-endian`（デフォルト）、2 = `Microsoft`。[`(U)Int*`](/sql-reference/data-types/int-uint)

**返り値**

UUID のバイナリ表現を返します。[`FixedString(16)`](/sql-reference/data-types/fixedstring)

**例**

**使用例**

```sql title=Query
SELECT
    toUUID('612f3c40-5d3b-217e-707b-6a546a3d7b29') AS uuid,
    UUIDToNum(uuid) AS bytes
```

```response title=Response
┌─uuid─────────────────────────────────┬─bytes────────────┐
│ 612f3c40-5d3b-217e-707b-6a546a3d7b29 │ a/<@];!~p{jTj={) │
└──────────────────────────────────────┴──────────────────┘
```

**Microsoft バリアント**

```sql title=Query
SELECT
    toUUID('612f3c40-5d3b-217e-707b-6a546a3d7b29') AS uuid,
    UUIDToNum(uuid, 2) AS bytes
```

```response title=Response
┌─uuid─────────────────────────────────┬─bytes────────────┐
│ 612f3c40-5d3b-217e-707b-6a546a3d7b29 │ @</a;]~!p{jTj={) │
└──────────────────────────────────────┴──────────────────┘
```


## UUIDv7ToDateTime {#UUIDv7ToDateTime}

導入バージョン: v24.5

UUID バージョン 7 のタイムスタンプ部分を返します。

**構文**

```sql
UUIDv7ToDateTime(uuid[, timezone])
```

**引数**

* `uuid` — バージョン 7 の UUID。[`String`](/sql-reference/data-types/string)
* `timezone` — 省略可能。返される値に対する[タイムゾーン名](../../operations/server-configuration-parameters/settings.md#timezone)。[`String`](/sql-reference/data-types/string)

**返り値**

ミリ秒精度のタイムスタンプを返します。UUID が有効なバージョン 7 UUID でない場合は、`1970-01-01 00:00:00.000` を返します。[`DateTime64(3)`](/sql-reference/data-types/datetime64)

**例**

**使用例**

```sql title=Query
SELECT UUIDv7ToDateTime(toUUID('018f05c9-4ab8-7b86-b64e-c9f03fbd45d1'))
```

```response title=Response
┌─UUIDv7ToDateTime(toUUID('018f05c9-4ab8-7b86-b64e-c9f03fbd45d1'))─┐
│                                          2024-04-22 15:30:29.048 │
└──────────────────────────────────────────────────────────────────┘
```

**タイムゾーン付き**

```sql title=Query
SELECT UUIDv7ToDateTime(toUUID('018f05c9-4ab8-7b86-b64e-c9f03fbd45d1'), 'America/New_York')
```

```response title=Response
┌─UUIDv7ToDateTime(toUUID('018f05c9-4ab8-7b86-b64e-c9f03fbd45d1'), 'America/New_York')─┐
│                                                             2024-04-22 11:30:29.048 │
└─────────────────────────────────────────────────────────────────────────────────────┘
```


## dateTime64ToSnowflake {#dateTime64ToSnowflake}

導入バージョン: v21.10

<DeprecatedBadge />

:::warning
この関数は非推奨で、設定 [`allow_deprecated_snowflake_conversion_functions`](../../operations/settings/settings.md#allow_deprecated_snowflake_conversion_functions) が有効になっている場合にのみ使用できます。
この関数は将来のある時点で削除される予定です。

代わりに [dateTime64ToSnowflakeID](#dateTime64ToSnowflakeID) 関数を使用してください。
:::

[DateTime64](../data-types/datetime64.md) を、与えられた時刻における最初の [Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID) に変換します。

**構文**

```sql
dateTime64ToSnowflake(value)
```

**引数**

* `value` — 時刻を含む日付。[`DateTime64`](/sql-reference/data-types/datetime64)

**返される値**

指定した時刻に対応する最初の Snowflake ID に変換した値を返します。[`Int64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
WITH toDateTime64('2021-08-15 18:57:56.492', 3, 'Asia/Shanghai') AS dt64 SELECT dateTime64ToSnowflake(dt64);
```

```response title=Response
┌─dateTime64ToSnowflake(dt64)─┐
│         1426860704886947840 │
└─────────────────────────────┘
```


## dateTime64ToSnowflakeID {#dateTime64ToSnowflakeID}

導入バージョン: v24.6

[DateTime64](../data-types/datetime64.md) の値を、指定された時刻における最初の [Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID) に変換します。

**構文**

```sql
dateTime64ToSnowflakeID(value[, epoch])
```

**引数**

* `value` — 日時。[`DateTime64`](/sql-reference/data-types/datetime64)
* `epoch` — Snowflake ID のエポックを、1970-01-01 からの経過ミリ秒で指定します。デフォルトは 0（1970-01-01）です。Twitter/X のエポック（2015-01-01）の場合は 1288834974657 を指定します。[`UInt*`](/sql-reference/data-types/int-uint)

**返される値**

入力値を [`UInt64`](/sql-reference/data-types/int-uint) に変換した値

**例**

**simple**

```sql title=Query
SELECT dateTime64ToSnowflakeID(toDateTime64('2021-08-15 18:57:56', 3, 'Asia/Shanghai'))
```

```response title=Response
6832626394434895872
```


## dateTimeToSnowflake {#dateTimeToSnowflake}

導入バージョン: v21.10

<DeprecatedBadge />

:::warning
この関数は非推奨となっており、[`allow_deprecated_snowflake_conversion_functions`](../../operations/settings/settings.md#allow_deprecated_snowflake_conversion_functions) 設定が有効な場合にのみ使用できます。
この関数は将来的に削除される予定です。

代わりに [dateTimeToSnowflakeID](#dateTimeToSnowflakeID) 関数を使用してください。
:::

[DateTime](../data-types/datetime.md) の値を、その時刻における最初の [Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID) に変換します。

**構文**

```sql
dateTimeToSnowflake(value)
```

**引数**

* `value` — 日時。[`DateTime`](/sql-reference/data-types/datetime)

**戻り値**

指定した時刻における最初の Snowflake ID を表す値を返します。[`Int64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
WITH toDateTime('2021-08-15 18:57:56', 'Asia/Shanghai') AS dt SELECT dateTimeToSnowflake(dt);
```

```response title=Response
┌─dateTimeToSnowflake(dt)─┐
│     1426860702823350272 │
└─────────────────────────┘
```


## dateTimeToSnowflakeID {#dateTimeToSnowflakeID}

導入バージョン: v24.6

[DateTime](../data-types/datetime.md) の値を、指定した時刻に対応する最初の [Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID) に変換します。

**構文**

```sql
dateTimeToSnowflakeID(value[, epoch])
```

**引数**

* `value` — 時刻付きの日付。[`DateTime`](/sql-reference/data-types/datetime)
* `epoch` — Snowflake ID のエポックを、1970-01-01 からのミリ秒で指定します。デフォルトは 0 (1970-01-01) です。Twitter/X のエポック (2015-01-01) の場合は 1288834974657 を指定します。[`UInt*`](/sql-reference/data-types/int-uint)

**戻り値**

入力値を [`UInt64`](/sql-reference/data-types/int-uint) に変換した値を返します。

**例**

**簡単な例**

```sql title=Query
SELECT dateTimeToSnowflakeID(toDateTime('2021-08-15 18:57:56', 'Asia/Shanghai'))
```

```response title=Response
6832626392367104000
```


## dateTimeToUUIDv7 {#dateTimeToUUIDv7}

導入バージョン: v25.9

与えられた時刻の [DateTime](../data-types/datetime.md) 値を基に、その時刻の [UUIDv7](https://en.wikipedia.org/wiki/UUID#Version_7) を生成します。

UUID の構造、カウンター管理、および並行性に関する保証の詳細については、「[UUIDv7 generation](#uuidv7-generation)」セクションを参照してください。

:::note
2025年9月時点では、バージョン 7 UUID はドラフト段階であり、そのレイアウトは将来変更される可能性があります。
:::

**構文**

```sql
dateTimeToUUIDv7(value)
```

**引数**

* `value` — 日時。[`DateTime`](/sql-reference/data-types/datetime)

**戻り値**

UUIDv7 を返します。[`UUID`](/sql-reference/data-types/uuid)

**例**

**使用例**

```sql title=Query
SELECT dateTimeToUUIDv7(toDateTime('2021-08-15 18:57:56', 'Asia/Shanghai'));
```

```response title=Response
┌─dateTimeToUUIDv7(toDateTime('2021-08-15 18:57:56', 'Asia/Shanghai'))─┐
│ 018f05af-f4a8-778f-beee-1bedbc95c93b                                   │
└─────────────────────────────────────────────────────────────────────────┘
```

**同じタイムスタンプに対する複数の UUID**

```sql title=Query
SELECT dateTimeToUUIDv7(toDateTime('2021-08-15 18:57:56'));
SELECT dateTimeToUUIDv7(toDateTime('2021-08-15 18:57:56'));
```

```response title=Response
┌─dateTimeToUUIDv7(t⋯08-15 18:57:56'))─┐
│ 017b4b2d-7720-76ed-ae44-bbcc23a8c550 │
└──────────────────────────────────────┘
┌─dateTimeToUUIDv7(t⋯08-15 18:57:56'))─┐
│ 017b4b2d-7720-76ed-ae44-bbcf71ed0fd3 │
└──────────────────────────────────────┘
```


## generateSnowflakeID {#generateSnowflakeID}

導入: v24.6

[Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID) を生成します。

関数 `generateSnowflakeID` は、並行実行されるスレッドおよびクエリでのすべての関数呼び出し間で、タイムスタンプに含まれるカウンターフィールドが単調に増加し続けることを保証します。

実装の詳細については、セクション「[Snowflake ID generation](#snowflake-id-generation)」を参照してください。

**構文**

```sql
generateSnowflakeID([expr, [machine_id]])
```

**引数**

* `expr` — クエリ内で関数が複数回呼び出される場合に、[共通部分式除去](/sql-reference/functions/overview#common-subexpression-elimination) を回避するために使用される任意の[式](/sql-reference/syntax#expressions)。この式の値は、返される Snowflake ID に影響しません。省略可能。
* `machine_id` — マシン ID。下位 10 ビットが使用されます。[Int64](../data-types/int-uint.md)。省略可能。

**戻り値**

Snowflake ID を返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=Query
CREATE TABLE tab (id UInt64)
ENGINE = MergeTree()
ORDER BY tuple();

INSERT INTO tab SELECT generateSnowflakeID();

SELECT * FROM tab;
```

```response title=Response
┌──────────────────id─┐
│ 7199081390080409600 │
└─────────────────────┘
```

**1 行あたりに複数の Snowflake ID が生成される**

```sql title=Query
SELECT generateSnowflakeID(1), generateSnowflakeID(2);
```

```response title=Response
┌─generateSnowflakeID(1)─┬─generateSnowflakeID(2)─┐
│    7199081609652224000 │    7199081609652224001 │
└────────────────────────┴────────────────────────┘
```

**式とマシン ID を指定する場合**

```sql title=Query
SELECT generateSnowflakeID('expr', 1);
```

```response title=Response
┌─generateSnowflakeID('expr', 1)─┐
│            7201148511606784002 │
└────────────────────────────────┘
```


## generateUUIDv4 {#generateUUIDv4}

導入バージョン: v1.1

[バージョン 4](https://tools.ietf.org/html/rfc4122#section-4.4)の[UUID](../data-types/uuid.md)を生成します。

**構文**

```sql
generateUUIDv4([expr])
```

**引数**

* `expr` — 省略可。クエリ内で関数が複数回呼び出される場合に、[common subexpression elimination](/sql-reference/functions/overview#common-subexpression-elimination) を回避するために使用される任意の式。この式の値は、返される UUID には影響しません。

**戻り値**

UUIDv4 を返します。[`UUID`](/sql-reference/data-types/uuid)

**例**

**使用例**

```sql title=Query
SELECT generateUUIDv4(number) FROM numbers(3);
```

```response title=Response
┌─generateUUIDv4(number)───────────────┐
│ fcf19b77-a610-42c5-b3f5-a13c122f65b6 │
│ 07700d36-cb6b-4189-af1d-0972f23dc3bc │
│ 68838947-1583-48b0-b9b7-cf8268dd343d │
└──────────────────────────────────────┘
```

**共通部分式の除去**

```sql title=Query
SELECT generateUUIDv4(1), generateUUIDv4(1);
```

```response title=Response
┌─generateUUIDv4(1)────────────────────┬─generateUUIDv4(2)────────────────────┐
│ 2d49dc6e-ddce-4cd0-afb8-790956df54c1 │ 2d49dc6e-ddce-4cd0-afb8-790956df54c1 │
└──────────────────────────────────────┴──────────────────────────────────────┘
```


## generateUUIDv7 {#generateUUIDv7}

導入バージョン: v24.5

[バージョン7](https://datatracker.ietf.org/doc/html/draft-peabody-dispatch-new-uuid-format-04)の[UUID](../data-types/uuid.md)を生成します。

UUIDの構造、カウンター管理、および並行性に関する保証の詳細については、[「UUIDv7 generation」](#uuidv7-generation)セクションを参照してください。

:::note
2025年9月時点では、バージョン7 UUIDはドラフト状態であり、将来的にレイアウトが変更される可能性があります。
:::

**構文**

```sql
generateUUIDv7([expr])
```

**引数**

* `expr` — 省略可能。クエリ内でこの関数が複数回呼び出される際に、[common subexpression elimination](/sql-reference/functions/overview#common-subexpression-elimination) を回避するために使用される任意の式です。式の値は返される UUID には影響しません。[`Any`](/sql-reference/data-types)

**戻り値**

UUIDv7 を返します。[`UUID`](/sql-reference/data-types/uuid)

**例**

**使用例**

```sql title=Query
SELECT generateUUIDv7(number) FROM numbers(3);
```

```response title=Response
┌─generateUUIDv7(number)───────────────┐
│ 019947fb-5766-7ed0-b021-d906f8f7cebb │
│ 019947fb-5766-7ed0-b021-d9072d0d1e07 │
│ 019947fb-5766-7ed0-b021-d908dca2cf63 │
└──────────────────────────────────────┘
```

**共通部分式の除去**

```sql title=Query
SELECT generateUUIDv7(1), generateUUIDv7(1);
```

```response title=Response
┌─generateUUIDv7(1)────────────────────┬─generateUUIDv7(1)────────────────────┐
│ 019947ff-0f87-7d88-ace0-8b5b3a66e0c1 │ 019947ff-0f87-7d88-ace0-8b5b3a66e0c1 │
└──────────────────────────────────────┴──────────────────────────────────────┘
```


## snowflakeIDToDateTime {#snowflakeIDToDateTime}

導入: v24.6

[Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID) のタイムスタンプ部分を、型 [DateTime](../data-types/datetime.md) の値として返します。

**構文**

```sql
snowflakeIDToDateTime(value[, epoch[, time_zone]])
```

**引数**

* `value` — Snowflake ID。[`UInt64`](/sql-reference/data-types/int-uint)
* `epoch` — オプション。Snowflake ID のエポックを、1970-01-01 からのミリ秒で指定します。デフォルトは 0（1970-01-01）。Twitter/X のエポック（2015-01-01）の場合は 1288834974657 を指定します。[`UInt*`](/sql-reference/data-types/int-uint)
* `time_zone` — オプション。[Timezone](/operations/server-configuration-parameters/settings.md#timezone)。この関数は、タイムゾーンに従って `time_string` を解析します。[`String`](/sql-reference/data-types/string)

**返り値**

`value` のタイムスタンプ部分を返します。[`DateTime`](/sql-reference/data-types/datetime)

**例**

**使用例**

```sql title=Query
SELECT snowflakeIDToDateTime(7204436857747984384) AS res
```

```response title=Response
┌─────────────────res─┐
│ 2024-06-06 10:59:58 │
└─────────────────────┘
```


## snowflakeIDToDateTime64 {#snowflakeIDToDateTime64}

導入バージョン: v24.6

[Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID) のタイムスタンプ部分を、[DateTime64](../data-types/datetime64.md) 型の値として返します。

**構文**

```sql
snowflakeIDToDateTime64(value[, epoch[, time_zone]])
```

**引数**

* `value` — Snowflake ID。[`UInt64`](/sql-reference/data-types/int-uint)
* `epoch` — オプション。1970-01-01 からの経過ミリ秒で表した Snowflake ID のエポック。デフォルトは 0（1970-01-01）。Twitter/X のエポック（2015-01-01）の場合は 1288834974657 を指定します。[`UInt*`](/sql-reference/data-types/int-uint)
* `time_zone` — オプション。[Timezone](/operations/server-configuration-parameters/settings.md#timezone)。関数は指定されたタイムゾーンに従って `time_string` を解釈します。[`String`](/sql-reference/data-types/string)

**戻り値**

`value` のタイムスタンプ部分を、スケール = 3（ミリ秒精度）の `DateTime64` として返します。[`DateTime64`](/sql-reference/data-types/datetime64)

**例**

**使用例**

```sql title=Query
SELECT snowflakeIDToDateTime64(7204436857747984384) AS res
```

```response title=Response
┌─────────────────res─┐
│ 2024-06-06 10:59:58 │
└─────────────────────┘
```


## snowflakeToDateTime {#snowflakeToDateTime}

導入バージョン: v21.10

<DeprecatedBadge />

:::warning
この関数は非推奨であり、[`allow_deprecated_snowflake_conversion_functions`](../../operations/settings/settings.md#allow_deprecated_snowflake_conversion_functions) 設定が有効な場合にのみ使用できます。
この関数は将来のある時点で削除されます。

代わりに [`snowflakeIDToDateTime`](#snowflakeIDToDateTime) 関数を使用してください。
:::

[Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID) のタイムスタンプ部分を抽出し、[DateTime](../data-types/datetime.md) 形式で返します。

**構文**

```sql
snowflakeToDateTime(value[, time_zone])
```

**引数**

* `value` — Snowflake ID。[`Int64`](/sql-reference/data-types/int-uint)
* `time_zone` — 省略可能。[Timezone](/operations/server-configuration-parameters/settings.md#timezone)。この関数は、指定されたタイムゾーンに従って `time_string` を解析します。[`String`](/sql-reference/data-types/string)

**戻り値**

`value` のタイムスタンプ部分を返します。[`DateTime`](/sql-reference/data-types/datetime)

**例**

**使用例**

```sql title=Query
SELECT snowflakeToDateTime(CAST('1426860702823350272', 'Int64'), 'UTC');
```

```response title=Response
┌─snowflakeToDateTime(CAST('1426860702823350272', 'Int64'), 'UTC')─┐
│                                              2021-08-15 10:57:56 │
└──────────────────────────────────────────────────────────────────┘
```


## snowflakeToDateTime64 {#snowflakeToDateTime64}

導入バージョン: v21.10

<DeprecatedBadge />

:::warning
この関数は非推奨であり、設定 [`allow_deprecated_snowflake_conversion_functions`](../../operations/settings/settings.md#allow_deprecated_snowflake_conversion_functions) が有効な場合にのみ使用できます。
この関数は将来、いずれかの時点で削除されます。

代わりに [`snowflakeIDToDateTime64`](#snowflakeIDToDateTime64) 関数を使用してください。
:::

[Snowflake ID](https://en.wikipedia.org/wiki/Snowflake_ID) のタイムスタンプ部分を [DateTime64](../data-types/datetime64.md) 形式で抽出します。

**構文**

```sql
snowflakeToDateTime64(value[, time_zone])
```

**引数**

* `value` — Snowflake ID。[`Int64`](/sql-reference/data-types/int-uint)
* `time_zone` — 省略可能。[Timezone](/operations/server-configuration-parameters/settings.md#timezone)。この関数は、そのタイムゾーンに従って `time_string` を解析します。[`String`](/sql-reference/data-types/string)

**戻り値**

`value` のタイムスタンプ部分を返します。[`DateTime64(3)`](/sql-reference/data-types/datetime64)

**例**

**使用例**

```sql title=Query
SELECT snowflakeToDateTime64(CAST('1426860802823350272', 'Int64'), 'UTC');
```

```response title=Response
┌─snowflakeToDateTime64(CAST('1426860802823350272', 'Int64'), 'UTC')─┐
│                                            2021-08-15 10:58:19.841 │
└────────────────────────────────────────────────────────────────────┘
```


## toUUIDOrDefault {#toUUIDOrDefault}

導入バージョン: v21.1

String 型の値を UUID 型に変換します。変換に失敗した場合は、エラーをスローせずに指定されたデフォルトの UUID 値を返します。

この関数は、標準的な UUID 形式（xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx）の 36 文字の文字列のパースを試みます。
文字列を有効な UUID に変換できない場合、関数は指定されたデフォルトの UUID 値を返します。

**構文**

```sql
toUUIDOrDefault(string, default)
```

**引数**

* `string` — UUID に変換する 36 文字の文字列、または FixedString(36)。 - `default` — 最初の引数を UUID 型に変換できない場合に返される UUID 値。

**戻り値**

変換に成功した場合は変換後の UUID を返し、変換に失敗した場合はデフォルトの UUID を返します。 [`UUID`](/sql-reference/data-types/uuid)

**例**

**変換に成功するとパースされた UUID を返します**

```sql title=Query
SELECT toUUIDOrDefault('61f0c404-5cb3-11e7-907b-a6006ad3dba0', toUUID('59f0c404-5cb3-11e7-907b-a6006ad3dba0'));
```

```response title=Response
┌─toUUIDOrDefault('61f0c404-5cb3-11e7-907b-a6006ad3dba0', toUUID('59f0c404-5cb3-11e7-907b-a6006ad3dba0'))─┐
│ 61f0c404-5cb3-11e7-907b-a6006ad3dba0                                                                     │
└──────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```

**変換に失敗した場合、デフォルトの UUID を返す**

```sql title=Query
SELECT toUUIDOrDefault('-----61f0c404-5cb3-11e7-907b-a6006ad3dba0', toUUID('59f0c404-5cb3-11e7-907b-a6006ad3dba0'));
```

```response title=Response
┌─toUUIDOrDefault('-----61f0c404-5cb3-11e7-907b-a6006ad3dba0', toUUID('59f0c404-5cb3-11e7-907b-a6006ad3dba0'))─┐
│ 59f0c404-5cb3-11e7-907b-a6006ad3dba0                                                                          │
└───────────────────────────────────────────────────────────────────────────────────────────────────────────────┘
```


## toUUIDOrNull {#toUUIDOrNull}

導入バージョン: v20.12

入力値を `UUID` 型に変換しますが、エラーが発生した場合は `NULL` を返します。

変換エラー時に例外をスローする代わりに `NULL` を返す点を除き、[`toUUID`](/sql-reference/functions/type-conversion-functions#toUUID) と同様です。

サポートされる引数:

* UUID の文字列表現（標準形式: 8-4-4-4-12 個の 16 進数字）。
* ハイフンなしの UUID の文字列表現（32 個の 16 進数字）。

サポートされない引数（`NULL` を返す）:

* 無効な文字列形式。
* 文字列以外の型。
* 不正な UUID。

**構文**

```sql
toUUIDOrNull(x)
```

**引数**

* `x` — UUID の文字列表現。[`String`](/sql-reference/data-types/string)

**返される値**

成功した場合は UUID 値を返し、失敗した場合は `NULL` を返します。[`UUID`](/sql-reference/data-types/uuid) または [`NULL`](/sql-reference/syntax#null)

**例**

**使用例**

```sql title=Query
SELECT
    toUUIDOrNull('550e8400-e29b-41d4-a716-446655440000') AS valid_uuid,
    toUUIDOrNull('invalid-uuid') AS invalid_uuid
```

```response title=Response
┌─valid_uuid───────────────────────────┬─invalid_uuid─┐
│ 550e8400-e29b-41d4-a716-446655440000 │         ᴺᵁᴸᴸ │
└──────────────────────────────────────┴──────────────┘
```

{/*AUTOGENERATED_END*/ }
