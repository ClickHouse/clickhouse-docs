---
description: '距離関数に関するドキュメント'
sidebar_label: '距離'
slug: /sql-reference/functions/distance-functions
title: '距離関数'
keywords: ['距離関数', 'ノルム', '距離', 'ベクトル']
doc_type: 'reference'
---

# 距離関数 \{#distance-functions\}

{/* 
  以下のタグの内側の内容は、ドキュメントフレームワークのビルド時に
  system.functions から自動生成されたドキュメントに置き換えられます。タグを変更したり削除したりしないでください。
  詳細は https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md を参照してください。
  */ }

{/*AUTOGENERATED_START*/ }

## L1Distance \{#L1Distance\}

導入バージョン: v21.11

`L1` 空間（1-ノルム（[タクシー幾何](https://en.wikipedia.org/wiki/Taxicab_geometry) における距離））において、2 つの点（ベクトルの要素を座標とみなしたもの）間の距離を計算します。

**構文**

```sql
L1Distance(vector1, vector2)
```

**別名**: `distanceL1`

**引数**

* `vector1` — 第1ベクトル。[`Tuple(T)`](/sql-reference/data-types/tuple) または [`Array(T)`](/sql-reference/data-types/array)
* `vector2` — 第2ベクトル。[`Tuple(T)`](/sql-reference/data-types/tuple) または [`Array(T)`](/sql-reference/data-types/array)

**戻り値**

1-ノルム距離を返します。[`UInt32`](/sql-reference/data-types/int-uint) または [`Float64`](/sql-reference/data-types/float)

**使用例**

**基本的な使用方法**

```sql title=Query
SELECT L1Distance((1, 2), (2, 3))
```

```response title=Response
┌─L1Distance((1, 2), (2, 3))─┐
│                          2 │
└────────────────────────────┘
```

## L1Norm \{#L1Norm\}

導入バージョン: v21.11

ベクトルの各要素の絶対値の総和を計算します。

**構文**

```sql
L1Norm(vector)
```

**別名**: `normL1`

**引数**

* `vector` — 数値のベクトルまたはタプル。[`Array(T)`](/sql-reference/data-types/array) または [`Tuple(T)`](/sql-reference/data-types/tuple)

**戻り値**

L1 ノルム（[taxicab geometry](https://en.wikipedia.org/wiki/Taxicab_geometry) における距離）を返します。[`UInt*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float) または [`Decimal`](/sql-reference/data-types/decimal)

**例**

**基本的な使用例**

```sql title=Query
SELECT L1Norm((1, 2))
```

```response title=Response
┌─L1Norm((1, 2))─┐
│              3 │
└────────────────┘
```

## L1Normalize \{#L1Normalize\}

導入バージョン: v21.11

与えられたベクトル（タプルの要素が座標）について、`L1` 空間（[タクシー幾何学](https://en.wikipedia.org/wiki/Taxicab_geometry)）における単位ベクトルを計算します。

**構文**

```sql
L1Normalize(tuple)
```

**別名**: `normalizeL1`

**引数**

* `tuple` — 数値からなるタプル。[`Tuple(T)`](/sql-reference/data-types/tuple)

**返り値**

単位ベクトルを返します。[`Tuple(Float64)`](/sql-reference/data-types/tuple)

**例**

**基本的な使用例**

```sql title=Query
SELECT L1Normalize((1, 2))
```

```response title=Response
┌─L1Normalize((1, 2))─────────────────────┐
│ (0.3333333333333333,0.6666666666666666) │
└─────────────────────────────────────────┘
```

## L2Distance \{#L2Distance\}

導入バージョン: v21.11

ユークリッド空間において、2 つの点（ベクトルの要素が座標を表す）間の距離（[Euclidean distance](https://en.wikipedia.org/wiki/Euclidean_distance)）を計算します。

**構文**

```sql
L2Distance(vector1, vector2)
```

**別名**: `distanceL2`

**引数**

* `vector1` — 最初のベクトル。[`Tuple(T)`](/sql-reference/data-types/tuple) または [`Array(T)`](/sql-reference/data-types/array)
* `vector2` — 2 つ目のベクトル。[`Tuple(T)`](/sql-reference/data-types/tuple) または [`Array(T)`](/sql-reference/data-types/array)

**戻り値**

2-ノルム距離を返します。[`Float64`](/sql-reference/data-types/float)

**例**

**基本的な使い方**

```sql title=Query
SELECT L2Distance((1, 2), (2, 3))
```

```response title=Response
┌─L2Distance((1, 2), (2, 3))─┐
│         1.4142135623730951 │
└────────────────────────────┘
```

## L2DistanceTransposed \{#L2DistanceTransposed\}

v25.10 で導入。

ユークリッド空間において、2 点間のユークリッド距離（ベクトルの値を座標とみなす）の近似値を計算します（[Euclidean distance](https://en.wikipedia.org/wiki/Euclidean_distance)）。

**構文**

```sql
L2DistanceTransposed(vector1, vector2, p)
```

**別名**: `distanceL2Transposed`

**引数**

* `vectors` — ベクトル。[`QBit(T, UInt64)`](/sql-reference/data-types/qbit)
* `reference` — 参照ベクトル。[`Array(T)`](/sql-reference/data-types/array)
* `p` — 距離計算において各ベクトル要素から使用するビット数（1 から要素のビット幅まで）。量子化レベルは精度と速度のトレードオフを制御します。使用するビット数を減らすと I/O と計算が高速になりますが精度は低下し、ビット数を増やすと性能を犠牲にして精度が向上します。[`UInt`](/sql-reference/data-types/int-uint)

**返される値**

近似的な 2-ノルム距離を返します。[`Float64`](/sql-reference/data-types/float)

**例**

**基本的な使用方法**

```sql title=Query
CREATE TABLE qbit (id UInt32, vec QBit(Float64, 2)) ENGINE = Memory;
INSERT INTO qbit VALUES (1, [0, 1]);
SELECT L2DistanceTransposed(vec, array(1, 2), 16) FROM qbit;
```

```response title=Response
┌─L2DistanceTransposed([0, 1], [1, 2], 16)─┐
│                       1.4142135623730951 │
└──────────────────────────────────────────┘
```

## L2Norm \{#L2Norm\}

導入バージョン: v21.11

ベクトルの各要素の二乗和の平方根を計算します。

**構文**

```sql
L2Norm(vector)
```

**エイリアス**: `normL2`

**引数**

* `vector` — 数値のベクトルまたはタプル。[`Tuple(T)`](/sql-reference/data-types/tuple) または [`Array(T)`](/sql-reference/data-types/array)

**戻り値**

L2 ノルム、または [ユークリッド距離](https://en.wikipedia.org/wiki/Euclidean_distance) を返します。[`UInt*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float)

**例**

**基本的な使用方法**

```sql title=Query
SELECT L2Norm((1, 2))
```

```response title=Response
┌───L2Norm((1, 2))─┐
│ 2.23606797749979 │
└──────────────────┘
```

## L2Normalize \{#L2Normalize\}

導入バージョン: v21.11

ユークリッド空間において（[ユークリッド距離](https://en.wikipedia.org/wiki/Euclidean_distance) を用いて）、与えられたベクトル（タプルの要素が座標）に対する単位ベクトルを計算します。

**構文**

```sql
L2Normalize(tuple)
```

**別名**: `normalizeL2`

**引数**

* `tuple` — 数値のタプル。[`Tuple(T)`](/sql-reference/data-types/tuple)

**返される値**

単位ベクトルを返します。[`Tuple(Float64)`](/sql-reference/data-types/tuple)

**例**

**基本的な使用法**

```sql title=Query
SELECT L2Normalize((3, 4))
```

```response title=Response
┌─L2Normalize((3, 4))─┐
│ (0.6,0.8)           │
└─────────────────────┘
```

## L2SquaredDistance \{#L2SquaredDistance\}

導入バージョン: v22.7

2つのベクトルにおける対応する要素同士の差の二乗和を計算します。

**構文**

```sql
L2SquaredDistance(vector1, vector2)
```

**別名**: `distanceL2Squared`

**引数**

* `vector1` — 1つ目のベクトル。[`Tuple(T)`](/sql-reference/data-types/tuple) または [`Array(T)`](/sql-reference/data-types/array)
* `vector2` — 2つ目のベクトル。[`Tuple(T)`](/sql-reference/data-types/tuple) または [`Array(T)`](/sql-reference/data-types/array)

**戻り値**

2つのベクトルにおける対応する要素間の差の二乗和を返します。[`Float64`](/sql-reference/data-types/float)

**例**

**基本的な使用例**

```sql title=Query
SELECT L2SquaredDistance([1, 2, 3], [0, 0, 0])
```

```response title=Response
┌─L2SquaredDis⋯ [0, 0, 0])─┐
│                       14 │
└──────────────────────────┘
```

## L2SquaredNorm \{#L2SquaredNorm\}

導入バージョン: v22.7

ベクトル要素の二乗和の平方根（[`L2Norm`](#L2Norm)）の二乗を計算します。

**構文**

```sql
L2SquaredNorm(vector)
```

**別名**: `normL2Squared`

**引数**

* `vector` — 数値からなるベクトルまたはタプル。[`Array(T)`](/sql-reference/data-types/array) または [`Tuple(T)`](/sql-reference/data-types/tuple)

**戻り値**

L2 ノルムの二乗を返します。[`UInt*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float) または [`Decimal`](/sql-reference/data-types/decimal)

**使用例**

**基本的な使い方**

```sql title=Query
SELECT L2SquaredNorm((1, 2))
```

```response title=Response
┌─L2SquaredNorm((1, 2))─┐
│                     5 │
└───────────────────────┘
```

## LinfDistance \{#LinfDistance\}

導入バージョン: v21.11

`L_{inf}` 空間（[最大ノルム](https://en.wikipedia.org/wiki/Norm_\(mathematics\)#Maximum_norm_\(special_case_of:_infinity_norm,_uniform_norm,_or_supremum_norm\))）において、2 点（ベクトルの要素を座標とみなした点）間の距離を計算します。

**構文**

```sql
LinfDistance(vector1, vector2)
```

**エイリアス**: `distanceLinf`

**引数**

* `vector1` — 1 番目のベクトル。[`Tuple(T)`](/sql-reference/data-types/tuple) または [`Array(T)`](/sql-reference/data-types/array)
* `vector2` — 2 番目のベクトル。[`Tuple(T)`](/sql-reference/data-types/tuple) または [`Array(T)`](/sql-reference/data-types/array)

**返される値**

無限ノルム (Infinity-norm) による距離を返します。[`Float64`](/sql-reference/data-types/float)

**使用例**

**基本的な使い方**

```sql title=Query
SELECT LinfDistance((1, 2), (2, 3))
```

```response title=Response
┌─LinfDistance((1, 2), (2, 3))─┐
│                            1 │
└──────────────────────────────┘
```

## LinfNorm \{#LinfNorm\}

導入されたバージョン: v21.11

ベクトルの要素の絶対値の最大値を計算します。

**構文**

```sql
LinfNorm(vector)
```

**別名**: `normLinf`

**引数**

* `vector` — 数値のベクトルまたはタプル。[`Array(T)`](/sql-reference/data-types/array) または [`Tuple(T)`](/sql-reference/data-types/tuple)

**戻り値**

Linf ノルム、または最大絶対値を返します。[`Float64`](/sql-reference/data-types/float)

**例**

**基本的な使い方**

```sql title=Query
SELECT LinfNorm((1, -2))
```

```response title=Response
┌─LinfNorm((1, -2))─┐
│                 2 │
└───────────────────┘
```

## LinfNormalize \{#LinfNormalize\}

導入: v21.11

与えられたベクトル（タプルの要素が座標）について、`L_{inf}` 空間における単位ベクトルを（[最大ノルム](https://en.wikipedia.org/wiki/Norm_\(mathematics\)#Maximum_norm_\(special_case_of:_infinity_norm,_uniform_norm,_or_supremum_norm\))を用いて）計算します。

**構文**

```sql
LinfNormalize(tuple)
```

**別名**: `normalizeLinf`

**引数**

* `tuple` — 数値を要素とするタプル。[`Tuple(T)`](/sql-reference/data-types/tuple)

**返り値**

単位ベクトルを返します。[`Tuple(Float64)`](/sql-reference/data-types/tuple)

**使用例**

**基本的な使い方**

```sql title=Query
SELECT LinfNormalize((3, 4))
```

```response title=Response
┌─LinfNormalize((3, 4))─┐
│ (0.75,1)              │
└───────────────────────┘
```

## LpDistance \{#LpDistance\}

導入バージョン: v21.11

`Lp` 空間における 2 点間の距離（ベクトルの要素を座標とみなしたときの距離）を計算します（[p-ノルム距離](https://en.wikipedia.org/wiki/Norm_\(mathematics\)#p-norm)）。

**構文**

```sql
LpDistance(vector1, vector2, p)
```

**別名**: `distanceLp`

**引数**

* `vector1` — 1 番目のベクトル。[`Tuple(T)`](/sql-reference/data-types/tuple) または [`Array(T)`](/sql-reference/data-types/array)
* `vector2` — 2 番目のベクトル。[`Tuple(T)`](/sql-reference/data-types/tuple) または [`Array(T)`](/sql-reference/data-types/array)
* `p` — 冪指数。取りうる値は `[1; inf)` の実数。[`UInt*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float)

**返される値**

p-ノルム距離を返します。[`Float64`](/sql-reference/data-types/float)

**例**

**基本的な使用例**

```sql title=Query
SELECT LpDistance((1, 2), (2, 3), 3)
```

```response title=Response
┌─LpDistance((1, 2), (2, 3), 3)─┐
│            1.2599210498948732 │
└───────────────────────────────┘
```

## LpNorm \{#LpNorm\}

導入バージョン: v21.11

ベクトルの p-ノルム（p 次ノルム）を計算します。これは、その要素の絶対値を p 乗したものの総和の p 乗根です。

特別なケース:

* p=1 のとき、L1Norm（マンハッタン距離）と等価です。
* p=2 のとき、L2Norm（ユークリッド距離）と等価です。
* p=∞ のとき、LinfNorm（最大ノルム）と等価です。

**構文**

```sql
LpNorm(vector, p)
```

**別名**: `normLp`

**引数**

* `vector` — 数値のベクトルまたはタプル。[`Tuple(T)`](/sql-reference/data-types/tuple) または [`Array(T)`](/sql-reference/data-types/array)
* `p` — べき指数。取り得る値は `[1; inf)` の範囲の実数です。[`UInt*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float)

**返される値**

[Lp ノルム](https://en.wikipedia.org/wiki/Norm_\(mathematics\)#p-norm) を返します。[`Float64`](/sql-reference/data-types/float)

**例**

**基本的な使い方**

```sql title=Query
SELECT LpNorm((1, -2), 2)
```

```response title=Response
┌─LpNorm((1, -2), 2)─┐
│   2.23606797749979 │
└────────────────────┘
```

## LpNormalize \{#LpNormalize\}

導入: v21.11

与えられたベクトル（タプルの要素が座標）について、`Lp` 空間における単位ベクトルを（[p-norm](https://en.wikipedia.org/wiki/Norm_\(mathematics\)#p-norm) を使用して）計算します。

**構文**

```sql
LpNormalize(tuple, p)
```

**別名**: `normalizeLp`

**引数**

* `tuple` — 数値のタプル。[`Tuple(T)`](/sql-reference/data-types/tuple)
* `p` — べき指数。取りうる値は `[1; inf)` の範囲の任意の数値です。[`UInt*`](/sql-reference/data-types/int-uint) または [`Float*`](/sql-reference/data-types/float)

**戻り値**

単位ベクトルを返します。[`Tuple(Float64)`](/sql-reference/data-types/tuple)

**例**

**使用例**

```sql title=Query
SELECT LpNormalize((3, 4), 5)
```

```response title=Response
┌─LpNormalize((3, 4), 5)──────────────────┐
│ (0.7187302630182624,0.9583070173576831) │
└─────────────────────────────────────────┘
```

## cosineDistance \{#cosineDistance\}

導入バージョン: v1.1

2 つのベクトル間の[コサイン距離](https://en.wikipedia.org/wiki/Cosine_similarity#Cosine_distance)を計算します（タプルの各要素は座標を表します）。返される値が小さいほど、ベクトル同士の類似度が高くなります。

**構文**

```sql
cosineDistance(vector1, vector2)
```

**別名**: `distanceCosine`

**引数**

* `vector1` — 1 番目のタプル。[`Tuple(T)`](/sql-reference/data-types/tuple) または [`Array(T)`](/sql-reference/data-types/array)
* `vector2` — 2 番目のタプル。[`Tuple(T)`](/sql-reference/data-types/tuple) または [`Array(T)`](/sql-reference/data-types/array)

**返される値**

2 つのベクトルのなす角の余弦から 1 を引いた値を返します。[`Float64`](/sql-reference/data-types/float)

**使用例**

**基本的な使い方**

```sql title=Query
SELECT cosineDistance((1, 2), (2, 3));
```

```response title=Response
┌─cosineDistance((1, 2), (2, 3))─┐
│           0.007722123286332261 │
└────────────────────────────────┘
```

## cosineDistanceTransposed \{#cosineDistanceTransposed\}

導入バージョン: v26.1

2 つの点間の近似的な[コサイン距離](https://en.wikipedia.org/wiki/Cosine_similarity#Cosine_distance)を計算します（ベクトルの値を座標とみなします）。返される値が小さいほど、ベクトル同士はより類似しています。

**構文**

```sql
cosineDistanceTransposed(vector1, vector2, p)
```

**別名**: `distanceCosineTransposed`

**引数**

* `vectors` — ベクトル。[`QBit(T, UInt64)`](/sql-reference/data-types/qbit)
* `reference` — 参照ベクトル。[`Array(T)`](/sql-reference/data-types/array)
* `p` — 距離計算において各ベクトル要素から使用するビット数（1 から要素のビット幅まで）。量子化レベルにより、精度と速度のトレードオフが決まります。使用するビット数が少ないほど I/O と計算は高速になりますが精度は低下し、ビット数が多いほど精度は向上しますがパフォーマンスは低下します。[`UInt`](/sql-reference/data-types/int-uint)

**返される値**

2 つのベクトル間の角度の余弦の近似値を 1 から引いた値を返します。[`Float64`](/sql-reference/data-types/float)

**例**

**基本的な使用例**

```sql title=Query
CREATE TABLE qbit (id UInt32, vec QBit(Float64, 2)) ENGINE = Memory;
INSERT INTO qbit VALUES (1, [0, 1]);
SELECT cosineDistanceTransposed(vec, array(1, 2), 16) FROM qbit;
```

```response title=Response
┌─cosineDistanceTransposed([0, 1], [1, 2], 16)─┐
│                          0.10557281085638826 │
└──────────────────────────────────────────────┘
```

{/*AUTOGENERATED_END*/ }
