---
description: 'イントロスペクション関数に関するドキュメント'
sidebar_label: 'イントロスペクション'
slug: /sql-reference/functions/introspection
title: 'イントロスペクション関数'
doc_type: 'reference'
---



# イントロスペクション関数

この章で説明する関数を使用して、クエリプロファイリングのために[ELF](https://en.wikipedia.org/wiki/Executable_and_Linkable_Format)および[DWARF](https://en.wikipedia.org/wiki/DWARF)をイントロスペクトできます。

:::note
これらの関数は処理速度が遅く、セキュリティ上の考慮が必要になる場合があります。
:::

イントロスペクション関数を適切に動作させるには:

- `clickhouse-common-static-dbg`パッケージをインストールします。

- [allow_introspection_functions](../../operations/settings/settings.md#allow_introspection_functions)設定を1に設定します。

        セキュリティ上の理由により、イントロスペクション関数はデフォルトで無効になっています。

ClickHouseはプロファイラレポートを[trace_log](/operations/system-tables/trace_log)システムテーブルに保存します。テーブルとプロファイラが適切に設定されていることを確認してください。

<!--
The inner content of the tags below are replaced at doc framework build time with
docs generated from system.functions. Please do not modify or remove the tags.
See: https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md
-->


<!--AUTOGENERATED_START-->

## demangle {#demangle}

導入バージョン: v20.1

シンボルをC++関数名に変換します。
シンボルは通常、`addressToSymbol`関数から返されます。

**構文**

```sql
demangle(symbol)
```

**引数**

- `symbol` — オブジェクトファイルのシンボル。[`String`](/sql-reference/data-types/string)

**戻り値**

C++関数名を返します。シンボルが無効な場合は空文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**`trace_log`システムテーブルから最初の行を選択**

```sql title=クエリ
SELECT * FROM system.trace_log LIMIT 1 \G;
```

```response title=レスポンス
-- `trace`フィールドには、サンプリング時点のスタックトレースが含まれます。
Row 1:
──────
event_date:    2019-11-20
event_time:    2019-11-20 16:57:59
revision:      54429
timer_type:    Real
thread_number: 48
query_id:      724028bf-f550-45aa-910d-2af6212b94ac
trace:         [94138803686098,94138815010911,94138815096522,94138815101224,94138815102091,94138814222988,94138806823642,94138814457211,94138806823642,94138814457211,94138806823642,94138806795179,94138806796144,94138753770094,94138753771646,94138753760572,94138852407232,140399185266395,140399178045583]
```

**単一アドレスの関数名を取得**

```sql title=クエリ
SET allow_introspection_functions=1;
SELECT demangle(addressToSymbol(94138803686098)) \G;
```

```response title=レスポンス
Row 1:
──────
demangle(addressToSymbol(94138803686098)): DB::IAggregateFunctionHelper<DB::AggregateFunctionSum<unsigned long, unsigned long, DB::AggregateFunctionSumData<unsigned long> > >::addBatchSinglePlace(unsigned long, char*, DB::IColumn const**, DB::Arena*) const
```

**スタックトレース全体に関数を適用**

```sql title=クエリ
SET allow_introspection_functions=1;

-- arrayMap関数を使用すると、trace配列の各要素をdemangle関数で処理できます。
-- この処理結果は、出力のtrace_functions列に表示されます。

SELECT
    arrayStringConcat(arrayMap(x -> demangle(addressToSymbol(x)), trace), '\n') AS trace_functions
FROM system.trace_log
LIMIT 1
\G
```


```response title=Response
行 1:
──────
trace_functions: DB::IAggregateFunctionHelper<DB::AggregateFunctionSum<unsigned long, unsigned long, DB::AggregateFunctionSumData<unsigned long> > >::addBatchSinglePlace(unsigned long, char*, DB::IColumn const**, DB::Arena*) const
DB::Aggregator::executeWithoutKeyImpl(char*&, unsigned long, DB::Aggregator::AggregateFunctionInstruction*, DB::Arena*) const
DB::Aggregator::executeOnBlock(std::vector<COW<DB::IColumn>::immutable_ptr<DB::IColumn>, std::allocator<COW<DB::IColumn>::immutable_ptr<DB::IColumn> > >, unsigned long, DB::AggregatedDataVariants&, std::vector<DB::IColumn const*, std::allocator<DB::IColumn const*> >&, std::vector<std::vector<DB::IColumn const*, std::allocator<DB::IColumn const*> >, std::allocator<std::vector<DB::IColumn const*, std::allocator<DB::IColumn const*> > > >&, bool&)
DB::Aggregator::executeOnBlock(DB::Block const&, DB::AggregatedDataVariants&, std::vector<DB::IColumn const*, std::allocator<DB::IColumn const*> >&, std::vector<std::vector<DB::IColumn const*, std::allocator<DB::IColumn const*> >, std::allocator<std::vector<DB::IColumn const*, std::allocator<DB::IColumn const*> > > >&, bool&)
DB::Aggregator::execute(std::shared_ptr<DB::IBlockInputStream> const&, DB::AggregatedDataVariants&)
DB::AggregatingBlockInputStream::readImpl()
DB::IBlockInputStream::read()
DB::ExpressionBlockInputStream::readImpl()
DB::IBlockInputStream::read()
DB::ExpressionBlockInputStream::readImpl()
DB::IBlockInputStream::read()
DB::AsynchronousBlockInputStream::calculate()
std::_Function_handler<void (), DB::AsynchronousBlockInputStream::next()::{lambda()#1}>::_M_invoke(std::_Any_data const&)
ThreadPoolImpl<ThreadFromGlobalPool>::worker(std::_List_iterator<ThreadFromGlobalPool>)
ThreadFromGlobalPool::ThreadFromGlobalPool<ThreadPoolImpl<ThreadFromGlobalPool>::scheduleImpl<void>(std::function<void ()>, int, std::optional<unsigned long>)::{lambda()#3}>(ThreadPoolImpl<ThreadFromGlobalPool>::scheduleImpl<void>(std::function<void ()>, int, std::optional<unsigned long>)::{lambda()#3}&&)::{lambda()#1}::operator()() const
ThreadPoolImpl<std::thread>::worker(std::_List_iterator<std::thread>)
execute_native_thread_routine
start_thread
clone
```


## isMergeTreePartCoveredBy {#isMergeTreePartCoveredBy}

導入バージョン: v25.6

第1引数のパートが第2引数のパートに含まれているかどうかを確認する関数です。

**構文**

```sql
isMergeTreePartCoveredBy(nested_part, covering_part)
```

**引数**

- `nested_part` — 内包されるパートの名前。[`String`](/sql-reference/data-types/string)
- `covering_part` — 内包するパートの名前。[`String`](/sql-reference/data-types/string)

**返り値**

内包している場合は`1`を、そうでない場合は`0`を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**基本的な例**

```sql title=クエリ
WITH 'all_12_25_7_4' AS lhs, 'all_7_100_10_20' AS rhs
SELECT isMergeTreePartCoveredBy(rhs, lhs), isMergeTreePartCoveredBy(lhs, rhs);
```

```response title=レスポンス
┌─isMergeTreePartCoveredBy(rhs, lhs)─┬─isMergeTreePartCoveredBy(lhs, rhs)─┐
│                                  0 │                                  1 │
└────────────────────────────────────┴────────────────────────────────────┘
```


## logTrace {#logTrace}

導入バージョン: v20.12

各[Block](/development/architecture/#block)に対してトレースログメッセージをサーバーログに出力します。

**構文**

```sql
logTrace(message)
```

**引数**

- `message` — サーバーログに出力されるメッセージ。[`const String`](/sql-reference/data-types/string)

**戻り値**

常に`0`を返します。[`UInt8`](/sql-reference/data-types/int-uint)

**例**

**基本的な例**

```sql title=Query
SELECT logTrace('logTrace message');
```

```response title=Response
┌─logTrace('logTrace message')─┐
│                            0 │
└──────────────────────────────┘
```


## mergeTreePartInfo {#mergeTreePartInfo}

導入バージョン: v25.6

`MergeTree`パート名から有用な値を抽出するための関数です。

**構文**

```sql
mergeTreePartInfo(part_name)
```

**引数**

- `part_name` — 解析するパートの名前。[`String`](/sql-reference/data-types/string)

**戻り値**

サブカラム`partition_id`、`min_block`、`max_block`、`level`、`mutation`を含むタプルを返します。[`Tuple`](/sql-reference/data-types/tuple)

**例**

**基本的な例**

```sql title=Query
WITH mergeTreePartInfo('all_12_25_7_4') AS info
SELECT info.partition_id, info.min_block, info.max_block, info.level, info.mutation;
```

```response title=Response
┌─info.partition_id─┬─info.min_block─┬─info.max_block─┬─info.level─┬─info.mutation─┐
│ all               │             12 │             25 │          7 │             4 │
└───────────────────┴────────────────┴────────────────┴────────────┴───────────────┘
```


## tid {#tid}

導入バージョン: v20.12

現在の[Block](/development/architecture/#block)が処理されているスレッドのIDを返します。

**構文**

```sql
tid()
```

**引数**

- なし

**返される値**

現在のスレッドIDを返します。[`UInt64`](/sql-reference/data-types/int-uint)

**例**

**使用例**

```sql title=クエリ
SELECT tid();
```

```response title=レスポンス
┌─tid()─┐
│  3878 │
└───────┘
```

<!--AUTOGENERATED_END-->
