---
description: '文字列分割関数のドキュメント'
sidebar_label: '文字列分割'
slug: /sql-reference/functions/splitting-merging-functions
title: '文字列分割関数'
doc_type: 'reference'
---

import DeprecatedBadge from '@theme/badges/DeprecatedBadge';


# 文字列を分割する関数

:::note
本ドキュメントは `system.functions` システムテーブルから生成されています。
:::

{/* 
  以下のタグ内の内容は、ドキュメントフレームワークのビルド時に
  system.functions から自動生成されるドキュメントに置き換えられます。タグは変更したり削除したりしないでください。
  詳細は https://github.com/ClickHouse/clickhouse-docs/blob/main/contribute/autogenerated-documentation-from-source.md を参照してください。
  */ }

{/*AUTOGENERATED_START*/ }


## alphaTokens

導入バージョン: v1.1

`a-z` および `A-Z` の範囲に含まれる連続したバイト列からなる部分文字列を抽出し、それらの部分文字列を要素とする配列を返します。

**構文**

```sql
alphaTokens(s[, max_substrings])
```

**別名**: `splitByAlpha`

**引数**

* `s` — 分割対象の文字列。[`String`](/sql-reference/data-types/string)
* `max_substrings` — 省略可能。`max_substrings > 0` の場合、返される部分文字列の数は `max_substrings` を超えません。それ以外の場合は、可能な限り多くの部分文字列を返します。[`Int64`](/sql-reference/data-types/int-uint)

**返り値**

`s` から選択された部分文字列の配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
SELECT alphaTokens('abca1abc');
```

```response title=Response
┌─alphaTokens('abca1abc')─┐
│ ['abca','abc']          │
└─────────────────────────┘
```


## arrayStringConcat

導入バージョン: v1.1

配列内に列挙された値の文字列表現を、指定されたセパレータで連結します。セパレータは省略可能な引数で、指定しない場合はデフォルトで空文字列になります。

**構文**

```sql
arrayStringConcat(arr[, separator])
```

**引数**

* `arr` — 連結する配列。[`Array(T)`](/sql-reference/data-types/array)
* `separator` — 省略可。区切り用の文字列。デフォルトは空文字列です。[`const String`](/sql-reference/data-types/string)

**戻り値**

連結された文字列を返します。[`String`](/sql-reference/data-types/string)

**例**

**使用例**

```sql title=Query
SELECT arrayStringConcat(['12/05/2021', '12:50:00'], ' ') AS DateString;
```

```response title=Response
┌─DateString──────────┐
│ 12/05/2021 12:50:00 │
└─────────────────────┘
```


## extractAllGroupsVertical

導入バージョン: v20.5

正規表現を使用して文字列内のすべてのグループに対するマッチを取得し、配列の配列を返します。各配列には、入力文字列内に出現した順序で、各グループからマッチした部分文字列が含まれます。

**構文**

```sql
extractAllGroupsVertical(s, regexp)
```

**別名**: `extractAllGroups`

**引数**

* `s` — 抽出対象となる入力文字列。[`String`](/sql-reference/data-types/string) または [`FixedString`](/sql-reference/data-types/fixedstring)
* `regexp` — マッチに使用する正規表現。[`const String`](/sql-reference/data-types/string) または [`const FixedString`](/sql-reference/data-types/fixedstring)

**戻り値**

配列の配列を返し、各内側の配列には 1 回のマッチで取得されたキャプチャグループが含まれます。各マッチは、正規表現内のキャプチャグループ（グループ 1、グループ 2 など）に対応する要素を持つ配列を生成します。マッチが 1 つも見つからない場合は、空の配列を返します。[`Array(Array(String))`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
WITH '< Server: nginx
< Date: Tue, 22 Jan 2019 00:26:14 GMT
< Content-Type: text/html; charset=UTF-8
< Connection: keep-alive
' AS s
SELECT extractAllGroupsVertical(s, '< ([\\w\\-]+): ([^\\r\\n]+)');
```

```response title=Response
[['Server','nginx'],['Date','Tue, 22 Jan 2019 00:26:14 GMT'],['Content-Type','text/html; charset=UTF-8'],['Connection','keep-alive']]
```


## ngrams

導入バージョン: v21.11

UTF-8 文字列を長さ `N` の n-gram に分割します。

**構文**

```sql
ngrams(s, N)
```

**引数**

* `s` — 入力文字列。[`String`](/sql-reference/data-types/string) または [`FixedString`](/sql-reference/data-types/fixedstring)
* `N` — n-gram の長さ。[`const UInt8/16/32/64`](/sql-reference/data-types/int-uint)

**戻り値**

n-gram の配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
SELECT ngrams('ClickHouse', 3);
```

```response title=Response
['Cli','lic','ick','ckH','kHo','Hou','ous','use']
```


## splitByChar

導入バージョン: v1.1

長さがちょうど 1 文字の定数文字列 `separator` を区切り文字として、対象の文字列を部分文字列の配列に分割します。
区切り文字が文字列の先頭または末尾に現れる場合、または複数の区切り文字が連続している場合は、空の部分文字列が結果に含まれることがあります。

:::note
[`splitby_max_substrings_includes_remaining_string`](../../operations/settings/settings.md#splitby_max_substrings_includes_remaining_string)（デフォルト: `0`）の設定により、引数 `max_substrings > 0` のときに残りの文字列を結果配列の最後の要素に含めるかどうかを制御します。
:::

以下の場合、空の部分文字列が結果に含まれることがあります:

* 区切り文字が文字列の先頭または末尾に現れる場合
* 複数の区切り文字が連続している場合
* 元の文字列 `s` が空の場合

**構文**

```sql
splitByChar(separator, s[, max_substrings])
```

**引数**

* `separator` — 区切り文字。1 バイト文字である必要があります。 [`String`](/sql-reference/data-types/string)
* `s` — 分割する文字列。 [`String`](/sql-reference/data-types/string)
* `max_substrings` — 省略可能。`max_substrings > 0` の場合、返される配列には最大で `max_substrings` 個までの部分文字列が含まれます。0 以下の場合は、可能な限り多くの部分文字列を返します。デフォルト値は `0` です。  [`Int64`](/sql-reference/data-types/int-uint)

**戻り値**

選択された部分文字列の配列を返します。 [`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
SELECT splitByChar(',', '1,2,3,abcde');
```

```response title=Response
┌─splitByChar(⋯2,3,abcde')─┐
│ ['1','2','3','abcde']    │
└──────────────────────────┘
```


## splitByNonAlpha

導入バージョン: v21.9

空白文字および句読点文字で区切られた文字列を、部分文字列の配列に分割します。

:::note
[`splitby_max_substrings_includes_remaining_string`](../../operations/settings/settings.md#splitby_max_substrings_includes_remaining_string)（デフォルト: `0`）は、引数 `max_substrings > 0` の場合に、残りの文字列を結果配列の最後の要素に含めるかどうかを制御します。
:::

**構文**

```sql
splitByNonAlpha(s[, max_substrings])
```

**引数**

* `s` — 分割対象の文字列。[`String`](/sql-reference/data-types/string)
* `max_substrings` — 省略可能。`max_substrings > 0` の場合、返される部分文字列の数は `max_substrings` を上限とし、それ以外の場合は可能な限り多くの部分文字列を返します。デフォルト値: `0`。[`Int64`](/sql-reference/data-types/int-uint)

**戻り値**

`s` から取得した部分文字列の配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
SELECT splitByNonAlpha('user@domain.com');
```

```response title=Response
['user','domain','com']
```


## splitByRegexp

導入: v21.6

指定された正規表現で区切ることで、文字列を部分文字列の配列に分割します。
指定された正規表現が空文字列の場合、文字列は 1 文字ずつの配列に分割されます。
正規表現にマッチしない場合、文字列は分割されません。

以下のような場合、空の部分文字列が生成されることがあります:

* 空でない正規表現のマッチが文字列の先頭または末尾にある場合
* 空でない正規表現のマッチが連続して複数回現れる場合
* 元の文字列が空で、正規表現が空でない場合

:::note
[`splitby_max_substrings_includes_remaining_string`](../../operations/settings/settings.md#splitby_max_substrings_includes_remaining_string)（デフォルト: `0`）は、引数 `max_substrings > 0` のときに、残りの文字列を結果配列の最後の要素に含めるかどうかを制御します。
:::

**構文**

```sql
splitByRegexp(regexp, s[, max_substrings])
```

**引数**

* `regexp` — 正規表現。定数。[`String`](/sql-reference/data-types/string) または [`FixedString`](/sql-reference/data-types/fixedstring)
* `s` — 分割対象の文字列。[`String`](/sql-reference/data-types/string)
* `max_substrings` — 省略可能。`max_substrings > 0` の場合、返される部分文字列の数は `max_substrings` を超えません。それ以外の場合、関数は可能な限り多くの部分文字列を返します。既定値: `0`。[`Int64`](/sql-reference/data-types/int-uint)

**返される値**

`s` から抽出された部分文字列の配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
SELECT splitByRegexp('\\d+', 'a12bc23de345f');
```

```response title=Response
┌─splitByRegex⋯c23de345f')─┐
│ ['a12bc23de345f']        │
└──────────────────────────┘
```

**空の正規表現**

```sql title=Query
SELECT splitByRegexp('', 'abcde');
```

```response title=Response
┌─splitByRegexp('', 'abcde')─┐
│ ['a','b','c','d','e']      │
└────────────────────────────┘
```


## splitByString

導入バージョン: v1.1

複数文字から成る定数 `separator` で文字列を分割し、部分文字列の配列にします。
文字列 `separator` が空文字列の場合、文字列 `s` を単一文字ごとの配列に分割します。

次のような場合、空の部分文字列が生成される場合があります:

* 空でないセパレータが文字列の先頭または末尾に現れる場合
* 複数の空でないセパレータが連続している場合
* セパレータは空でない一方で、元の文字列 `s` が空文字列である場合

:::note
[`splitby_max_substrings_includes_remaining_string`](../../operations/settings/settings.md#splitby_max_substrings_includes_remaining_string)（デフォルト: `0`）は、引数 `max_substrings > 0` のときに、残りの文字列を結果配列の最後の要素に含めるかどうかを制御します。
:::

**構文**

```sql
splitByString(separator, s[, max_substrings])
```

**引数**

* `separator` — 区切り文字。[`String`](/sql-reference/data-types/string)
* `s` — 分割対象の文字列。[`String`](/sql-reference/data-types/string)
* `max_substrings` — 省略可能。`max_substrings > 0` の場合、返される部分文字列の数は最大で `max_substrings` 個になり、それ以外の場合は可能な限り多くの部分文字列を返します。デフォルト値: `0`。[`Int64`](/sql-reference/data-types/int-uint)

**返される値**

`s` から抽出された部分文字列の配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
SELECT splitByString(', ', '1, 2 3, 4,5, abcde');
```

```response title=Response
┌─splitByStrin⋯4,5, abcde')─┐
│ ['1','2 3','4,5','abcde'] │
└───────────────────────────┘
```

**空のセパレーター**

```sql title=Query
SELECT splitByString('', 'abcde');
```

```response title=Response
┌─splitByString('', 'abcde')─┐
│ ['a','b','c','d','e']      │
└────────────────────────────┘
```


## splitByWhitespace

導入バージョン: v21.9

空白文字で区切られた文字列を部分文字列の配列に分割します。

:::note
[`splitby_max_substrings_includes_remaining_string`](../../operations/settings/settings.md#splitby_max_substrings_includes_remaining_string)（デフォルト: `0`）は、引数 `max_substrings > 0` の場合に、残りの文字列を結果配列の最後の要素に含めるかどうかを制御します。
:::

**構文**

```sql
splitByWhitespace(s[, max_substrings])
```

**引数**

* `s` — 分割対象の文字列。[`String`](/sql-reference/data-types/string)
* `max_substrings` — 省略可能。`max_substrings > 0` の場合、返される部分文字列数は最大で `max_substrings` 個となり、それ以外の場合は可能な限り多くの部分文字列を返します。デフォルト値: `0`。[`Int64`](/sql-reference/data-types/int-uint)

**戻り値**

`s` から抽出された部分文字列の配列を返します。[`Array(String)`](/sql-reference/data-types/array)

**例**

**使用例**

```sql title=Query
SELECT splitByWhitespace('  1!  a,  b.  ');
```

```response title=Response
['1!','a,','b.']
```


## tokens \

導入バージョン: v21.11

指定したトークナイザを使用して、文字列をトークンに分割します。
デフォルトのトークナイザは、英数字以外の ASCII 文字を区切り文字として使用します。

`split` トークナイザの場合、トークンが [接頭辞コード](https://en.wikipedia.org/wiki/Prefix_code) を構成しないときは、より長い区切り文字を優先してマッチさせたい場合が多いでしょう。
そのためには、区切り文字を長い順（降順）に並べて渡します。
たとえば、separators = `['%21', '%']` のとき、文字列 `%21abc` は `['abc']` としてトークナイズされますが、separators = `['%', '%21']` の場合は `['21ac']` にトークナイズされます（これはおそらく意図した結果ではありません）。

**構文**

```sql
tokens(value[, tokenizer[, ngrams[, separators]]])
```

**引数**

* `value` — 入力文字列。[`String`](/sql-reference/data-types/string) または [`FixedString`](/sql-reference/data-types/fixedstring)
* `tokenizer` — 使用するトークナイザー。有効な引数は `splitByNonAlpha`、`ngrams`、`splitByString`、`array`、`sparseGrams`。省略可能で、明示的に指定しない場合は `splitByNonAlpha` がデフォルトになります。[`const String`](/sql-reference/data-types/string)
* `ngrams` — 引数 `tokenizer` が `ngrams` の場合にのみ有効: n-gram の長さを定義するオプションのパラメーター。明示的に指定しない場合はデフォルトで `3` になります。[`const UInt8`](/sql-reference/data-types/int-uint)
* `separators` — 引数 `tokenizer` が `split` の場合にのみ有効: セパレーターとなる文字列を定義するオプションのパラメーター。明示的に指定しない場合はデフォルトで `[' ']` になります。[`const Array(String)`](/sql-reference/data-types/array)

**戻り値**

入力文字列から生成されたトークンの配列を返します。[`Array`](/sql-reference/data-types/array)

**使用例**

**デフォルトのトークナイザー**

```sql title=Query
SELECT tokens('test1,;\\\\ test2,;\\\\ test3,;\\\\   test4') AS tokens;
```

```response title=Response
['test1','test2','test3','test4']
```

**N-gram トークナイザ**

```sql title=Query
SELECT tokens('abc def', 'ngrams', 3) AS tokens;
```

```response title=Response
['abc','bc ','c d',' de','def']
```

{/*AUTOGENERATED_END*/ }
