---
slug: /guides/sre/scaling-clusters
sidebar_label: 'シャードのリバランス'
sidebar_position: 20
description: 'ClickHouse は自動シャードリバランスをサポートしていないため、シャードをリバランスするためのベストプラクティスをいくつか紹介します。'
title: 'データのリバランス'
doc_type: 'guide'
keywords: ['scaling', 'clusters', 'horizontal scaling', 'capacity planning', 'performance']
---

# データのリバランス

ClickHouse は自動シャードリバランスをサポートしていません。ただし、優先度順に次のようなシャードのリバランス方法があります。

1. [distributed table](/engines/table-engines/special/distributed.md) のシャード設定を調整し、書き込みが新しいシャードに偏るようにします。これにより、クラスタ内で負荷の不均衡やホットスポットが発生する可能性がありますが、書き込みスループットが極端に高くないほとんどのシナリオでは有効です。ユーザーが書き込み先を変更する必要はなく（つまり、書き込み先は distributed table のままで構いません）。なお、この方法では既存データのリバランスは行えません。

2. (1) の代替として、既存のクラスタ構成を変更し、クラスタのバランスが取れるまで新しいシャードのみに書き込むようにします（書き込みの重み付けを手動で行う）。これは (1) と同じ制約があります。

3. 既存データのリバランスが必要で、かつデータをパーティション分割している場合は、パーティションをデタッチし、別のノードに手動で移動してから新しいシャードに再アタッチすることを検討してください。これは後述の手法よりも手動操作が多くなりますが、より高速かつリソース消費も少なく済む可能性があります。手動操作であるため、データ全体のリバランスを考慮した上で実施する必要があります。

4. [INSERT FROM SELECT](/sql-reference/statements/insert-into.md/#inserting-the-results-of-select) を使用して、元のクラスタから新しいクラスタへデータをエクスポートします。非常に大きなデータセットではパフォーマンスが出ず、元のクラスタで多大な I/O が発生し、ネットワークリソースも相当量消費する可能性があります。これは最後の手段と考えてください。