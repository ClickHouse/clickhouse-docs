---
slug: /guides/sre/scaling-clusters
sidebar_label: 'シャードの再バランス'
sidebar_position: 20
description: 'ClickHouse は自動シャード再バランスをサポートしていないため、シャードを再バランスする際のベストプラクティスをいくつか紹介します。'
title: 'データの再バランス'
doc_type: 'guide'
keywords: ['scaling', 'clusters', 'horizontal scaling', 'capacity planning', 'performance']
---

# データのリバランス

ClickHouse は自動的なシャードのリバランシングをサポートしていません。ただし、優先度の高いものから順に、シャードをリバランスする方法として次のようなものがあります。

1. [distributed table](/engines/table-engines/special/distributed.md) のシャード構成を調整し、新しいシャードへの書き込みを優先させます。これによりクラスタ内で負荷の不均衡やホットスポットが発生する可能性はありますが、書き込みスループットが極端に高くないほとんどのシナリオでは有効です。ユーザーが書き込み先を変更する必要はなく、書き込み先は従来どおり distributed table のままで構いません。ただし、既存データのリバランスには寄与しません。

2. (1) の代替として、既存のクラスタ構成を変更し、クラスタ全体のバランスが取れるまで新しいシャードのみに書き込む（手動で書き込みの重み付けを行う）方法があります。これは (1) と同じ制約があります。

3. 既存データのリバランスが必要で、かつデータをパーティション分割している場合は、パーティションをデタッチして別ノードに手動で移動し、その後新しいシャードに再アタッチすることを検討してください。これは後述の手法より手作業が多くなりますが、より高速かつリソース消費が少ない場合があります。手動操作であるため、データのリバランスを考慮した計画的な実行が必要です。

4. [INSERT FROM SELECT](/sql-reference/statements/insert-into.md/#inserting-the-results-of-select) を使用して、ソースクラスタから新しいクラスタへデータをエクスポートします。非常に大きなデータセットでは性能が出にくく、ソースクラスタ側で多くの I/O が発生し、ネットワークリソースも多く消費する可能性があります。これは最後の手段として扱うべき方法です。