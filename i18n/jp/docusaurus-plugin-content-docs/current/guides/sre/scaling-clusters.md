---
slug: /guides/sre/scaling-clusters
sidebar_label: 'シャードのリバランス'
sidebar_position: 20
description: 'ClickHouse はシャードの自動リバランスをサポートしていないため、手動でシャードをリバランスする際のベストプラクティスをいくつか紹介します。'
title: 'データのリバランス'
doc_type: 'guide'
keywords: ['スケーリング', 'クラスター', '水平スケーリング', 'キャパシティプランニング', 'パフォーマンス']
---

# データのリバランス

ClickHouse は自動シャードリバランスをサポートしていません。ただし、優先度の高いものから順に、次のようなシャードのリバランス方法があります。

1. [distributed table](/engines/table-engines/special/distributed.md) のシャード構成を調整し、新しいシャードへの書き込みを優先させます。これにより、クラスター内で負荷の偏りやホットスポットが発生する可能性がありますが、書き込みスループットが極端に高くないほとんどのシナリオでは実用的です。ユーザーが書き込み先を変更する必要はなく、書き込み先は引き続き distributed table のままにできます。ただし、既存データのリバランスには寄与しません。

2. (1) の代替として、既存のクラスター設定を変更し、クラスター全体のバランスが取れるまで新しいシャードのみに書き込む（書き込みの重み付けを手動で行う）方法があります。これは (1) と同じ制約を持ちます。

3. 既存データのリバランスが必要で、かつデータをパーティション分割している場合は、パーティションをデタッチして別ノードに手動で移動し、新しいシャードに再アタッチすることを検討してください。これは以降の手法よりも手動作業が多くなりますが、より高速かつリソース消費が少なくなる場合があります。手動操作であるため、データのバランスをどのようにとるかを考慮して実施する必要があります。

4. [INSERT FROM SELECT](/sql-reference/statements/insert-into.md/#inserting-the-results-of-select) を使用して、ソースクラスターから新しいクラスターへデータをエクスポートします。非常に大きなデータセットでは高いパフォーマンスは期待できず、ソースクラスターで多大な I/O が発生し、ネットワークリソースも大きく消費する可能性があります。これは最後の手段となります。