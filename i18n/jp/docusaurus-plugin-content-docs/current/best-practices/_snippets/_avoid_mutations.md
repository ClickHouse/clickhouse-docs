ClickHouse における**ミューテーション (mutation)** とは、テーブル内に既に存在するデータを変更または削除する操作を指し、一般的には `ALTER TABLE ... DELETE` や `ALTER TABLE ... UPDATE` が用いられます。これらの文は標準的な SQL の操作と見た目は似ていますが、その内部的な動作は本質的に異なります。

行をその場で更新するのではなく、ClickHouse におけるミューテーションは、変更の影響を受ける [データパーツ](/parts) 全体を書き換える非同期のバックグラウンド処理として実行されます。これは、ClickHouse のカラム指向かつ不変なストレージモデルのために必要なアプローチであり、その結果として大きな I/O とリソース消費につながる可能性があります。

ミューテーションが発行されると、ClickHouse は新しい**ミューテーション後のパーツ (mutated parts)** の作成をスケジューリングし、新しいパーツが準備完了になるまで元のパーツには手を触れません。準備ができると、ミューテーション後のパーツが元のパーツをアトミックに置き換えます。ただし、この操作はパーツ全体を書き換えるため、単一行の更新のようなごく小さな変更でも、大規模な再書き込みや過度な書き込み増幅につながる可能性があります。

大規模なデータセットでは、これによりディスク I/O の大きなスパイクが発生し、クラスタ全体のパフォーマンス低下を招くことがあります。マージと異なり、ミューテーションはいったん送信されるとロールバックすることはできず、明示的にキャンセルしない限り、サーバー再起動後も実行を続けます。詳細は [`KILL MUTATION`](/sql-reference/statements/kill#kill-mutation) を参照してください。

:::tip ClickHouse でアクティブまたはキューに入っているミューテーション数の監視
アクティブまたはキューに入っているミューテーション数の監視方法については、次の[ナレッジベース記事](/knowledgebase/view_number_of_active_mutations)を参照してください。
:::

ミューテーションは**完全順序付けされた (totally ordered)** 操作です。ミューテーションが発行される前に挿入されたデータに対して適用され、それ以降に挿入された新しいデータには影響しません。挿入をブロックすることはありませんが、他の進行中のクエリと重なる場合があります。ミューテーションの実行中に走っている SELECT は、ミューテーション後のパーツと未変更のパーツが混在した状態を読み取る可能性があり、その実行中にデータの不整合なビューが見えることがあります。ClickHouse はパーツごとにミューテーションを並列実行するため、特に `x IN (SELECT ...)` のような複雑なサブクエリが関わる場合、メモリおよび CPU 使用率がさらに高まる可能性があります。

原則として、**頻繁または大規模なミューテーションは避けてください**。特に高ボリュームなテーブルでは注意が必要です。その代わりに、[ReplacingMergeTree](/guides/replacing-merge-tree) や [CollapsingMergeTree](/engines/table-engines/mergetree-family/collapsingmergetree) などの代替テーブルエンジンを利用することを検討してください。これらは、クエリ時またはマージ時にデータ修正を効率的に処理するよう設計されています。ミューテーションがどうしても必要な場合は、`system.mutations` テーブルで慎重に監視し、プロセスがハングしたり異常な挙動を示したりしている場合は `KILL MUTATION` を使用してください。ミューテーションの誤用は、パフォーマンス低下や、過度なストレージの書き換え、サービスの不安定化につながる可能性があるため、慎重かつ節度を持って適用する必要があります。

データ削除については、[Lightweight deletes](/guides/developer/lightweight-delete) や、[パーティション](/best-practices/choosing-a-partitioning-key) を利用したデータ管理も検討できます。これにより、パーツ全体を[効率的に DROP](/sql-reference/statements/alter/partition#drop-partitionpart) することが可能です。