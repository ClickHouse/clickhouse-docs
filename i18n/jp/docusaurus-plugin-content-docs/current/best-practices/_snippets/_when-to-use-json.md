## `JSON` 型をいつ使用するか \{#when-to-use-json-type\}

`JSON` 型は、構造が動的または予測が難しい JSON オブジェクト内の特定フィールドに対して、クエリ、フィルタリング、集計を行うために設計されています。これは、JSON オブジェクトを個別のサブカラムに分割することで実現され、`Map` や文字列のパースといった代替手段と比べて、選択したフィールドに対するデータ読み取り量を大幅に削減し、クエリを高速化します。

**ただし、これには重要なトレードオフがあります。**

- `INSERT` が遅くなる - JSON をサブカラムに分割し、型推論を行い、柔軟なストレージ構造を管理する必要があるため、JSON を単純な `String` カラムとして保存する場合と比べて挿入が遅くなります。
- オブジェクト全体を読む場合は遅くなる - 特定のフィールドではなく完全な JSON ドキュメントを取得する必要がある場合、`JSON` 型は `String` カラムから読み取るよりも遅くなります。サブカラムからオブジェクトを再構築するためのオーバーヘッドは、フィールド単位のクエリを行わない場合には何の利点ももたらしません。
- ストレージのオーバーヘッド - 個別のサブカラムを維持することにより、JSON を単一の文字列値として保存する場合と比べて構造的オーバーヘッドが増加します。

### `JSON` 型を使用するのは次のような場合: \{#use-json-type\}

- データの構造が動的または予測困難で、ドキュメントごとにキーが異なる場合
- フィールド型やスキーマが時間の経過とともに、またはレコード間で変化する場合
- 事前に構造を予測できない JSON オブジェクト内の特定のパスに対して、クエリ、フィルタリング、集計を行う必要がある場合
- ログ、イベント、ユーザー生成コンテンツといった、スキーマが一貫しない半構造化データを扱うユースケースである場合

### 次のような場合は `String` カラム（または構造化型）を使用する: \{#use-string-type\}

- データ構造が既知で一貫している場合 — このようなケースでは、通常のカラムや `Tuple`、`Array`、`Dynamic`、`Variant` 型などを代わりに使用する
- `JSON` ドキュメントを、フィールドレベルでの解析を行わず、全体としてのみ保存・取得される不透明な blob として扱う場合
- データベース内で個々の JSON フィールドに対してクエリやフィルタを行う必要がない場合
- `JSON` が単なる転送/保存フォーマットであり、ClickHouse 内で解析されない場合

:::tip
`JSON` がデータベース内部で解析されず、保存および取得のみを行う不透明なドキュメントである場合、それは `String` フィールドとして保存すべきです。`JSON` 型の利点が発揮されるのは、動的な `JSON` 構造内の特定フィールドに対して、クエリ、フィルタ、集約を効率的に行う必要がある場合だけです。

アプローチを組み合わせることもできます。予測可能なトップレベルフィールドには標準カラムを使用し、ペイロード内の動的な部分には `JSON` カラムを使用します。
:::