## `JSON` 型を使用するタイミング {#when-to-use-json-type}

`JSON` 型は、構造が動的または予測しにくい JSON オブジェクト内の特定フィールドに対して、クエリ・フィルタリング・集計を行うために設計されています。JSON オブジェクトを個別のサブカラムに分割することでこれを実現しており、`Map` や文字列パースを用いる場合と比べて、特定フィールドの読み取りデータ量を大幅に削減し、そのフィールドに対するクエリを高速化します。

**ただし、これにはいくつか重要なトレードオフがあります。**

- `INSERT` が遅くなる - JSON をサブカラムに分割し、型推論を行い、柔軟なストレージ構造を管理する必要があるため、JSON を単純な `String` カラムとして保存する場合と比べて挿入は遅くなります。
- オブジェクト全体の読み取り時は遅い - 特定フィールドではなく完全な JSON ドキュメントを取得する必要がある場合、`JSON` 型は `String` カラムから読み取る場合よりも遅くなります。サブカラムからオブジェクトを再構築するオーバーヘッドは、フィールド単位のクエリを行わない場合にはまったくメリットをもたらしません。
- ストレージのオーバーヘッド - 個別のサブカラムを維持することにより、JSON を 1 つの文字列値として保存する場合と比べて構造的なオーバーヘッドが発生します。

### `JSON` 型を使うべきケース {#use-json-type}

- ドキュメントごとにキーが異なるなど、データ構造が動的または予測しづらい場合
- フィールド型やスキーマが時間とともに変化したり、レコード間で異なったりする場合
- 構造を事前に予測できない JSON オブジェクト内の特定パスに対して、クエリ、フィルタリング、集計を行う必要がある場合
- ログ、イベント、ユーザー生成コンテンツのような、スキーマが一貫しないセミ構造化データを扱うユースケースである場合

### `String` カラム（または構造化型）を使用する状況 {#use-string-type}

- データ構造が既知で一貫している場合 ─ この場合は、通常のカラムや `Nested`、`Tuple`、`Array`、`Dynamic`、`Variant` 型などを代わりに使用する
- `JSON` ドキュメントを、フィールド単位での解析を行わず、全体をそのまま保存・取得するだけの不透明な blob として扱う場合
- データベース内で個々の JSON フィールドに対してクエリやフィルタを行う必要がない場合
- `JSON` が ClickHouse 内で解析されず、単なる転送／保存フォーマットとしてのみ使用される場合

:::tip
`JSON` がデータベース内部で解析されず、単に保存して取り出すだけの不透明なドキュメントである場合は、`String` フィールドとして保存するべきです。`JSON` 型の利点が発揮されるのは、動的な `JSON` 構造内の特定フィールドに対して、効率的にクエリ、フィルタ、集約を行う必要がある場合のみです。

また、アプローチを組み合わせることも可能です。予測可能なトップレベルのフィールドには標準のカラムを使い、ペイロードの動的な部分には `JSON` カラムを使用します。
:::